<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /backup/util/dbops/restore_dbops.class.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='backup/util/dbops';
filename='restore_dbops.class.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/backup/util/dbops/</a> -> <a href="restore_dbops.class.php.html">restore_dbops.class.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="restore_dbops.class.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="restore_dbops.class.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">//</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">//</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">//</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * @package    moodlecore</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @subpackage backup-dbops</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright  2010 onwards Eloy Lafuente (stronk7) {@link http://stronk7.com}</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment">/**</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * Base abstract class for all the helper classes providing DB operations</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> *</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * TODO: Finish phpdocs</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> */</span>
<a name="l30"><span class="linenum">  30</span></a>  abstract class restore_dbops {
<a name="l31"><span class="linenum">  31</span></a>      <span class="comment">/**</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment">     * Keep cache of backup records.</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment">     * @var array</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment">     * @todo MDL-25290 static should be replaced with MUC code.</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment">     */</span>
<a name="l36"><span class="linenum">  36</span></a>      private static <a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a> = array();
<a name="l37"><span class="linenum">  37</span></a>      <span class="comment">/**</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">     * Keep track of backup ids which are cached.</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">     * @var array</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">     * @todo MDL-25290 static should be replaced with MUC code.</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">     */</span>
<a name="l42"><span class="linenum">  42</span></a>      private static <a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a> = array();
<a name="l43"><span class="linenum">  43</span></a>      <span class="comment">/**</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment">     * Count is expensive, so manually keeping track of</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">     * backupidscache, to avoid memory issues.</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment">     * @var int</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment">     * @todo MDL-25290 static should be replaced with MUC code.</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">     */</span>
<a name="l49"><span class="linenum">  49</span></a>      private static <a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a> = 2048;
<a name="l50"><span class="linenum">  50</span></a>      <span class="comment">/**</span>
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment">     * Count is expensive, so manually keeping track of</span>
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment">     * backupidsexist, to avoid memory issues.</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">     * @var int</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     * @todo MDL-25290 static should be replaced with MUC code.</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment">     */</span>
<a name="l56"><span class="linenum">  56</span></a>      private static <a class="var it38822" onMouseOver="hilite(38822)" onMouseOut="lolite()" onClick="logVariable('backupidsexistsize')" href="../../../_variables/backupidsexistsize.html">$backupidsexistsize</a> = 10240;
<a name="l57"><span class="linenum">  57</span></a>      <span class="comment">/**</span>
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment">     * Slice backupids cache to add more data.</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment">     * @var int</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">     * @todo MDL-25290 static should be replaced with MUC code.</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">     */</span>
<a name="l62"><span class="linenum">  62</span></a>      private static <a class="var it38823" onMouseOver="hilite(38823)" onMouseOut="lolite()" onClick="logVariable('backupidsslice')" href="../../../_variables/backupidsslice.html">$backupidsslice</a> = 512;
<a name="l63"><span class="linenum">  63</span></a>  
<a name="l64"><span class="linenum">  64</span></a>      <span class="comment">/**</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment">     * Return one array containing all the tasks that have been included</span>
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment">     * in the restore process. Note that these tasks aren't built (they</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment">     * haven't steps nor ids data available)</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">     */</span>
<a name="l69"><span class="linenum">  69</span></a>      public static function <a class="function" onClick="logFunction('get_included_tasks')" href="../../../_functions/get_included_tasks.html" onMouseOver="funcPopup(event,'get_included_tasks')">get_included_tasks</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>) {
<a name="l70"><span class="linenum">  70</span></a>          <a class="var it2287" onMouseOver="hilite(2287)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../../../_variables/rc.html">$rc</a> = restore_controller_dbops::<a class="function" onClick="logFunction('load_controller')" href="../../../_functions/load_controller.html" onMouseOver="funcPopup(event,'load_controller')">load_controller</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>);
<a name="l71"><span class="linenum">  71</span></a>          <a class="var it110" onMouseOver="hilite(110)" onMouseOut="lolite()" onClick="logVariable('tasks')" href="../../../_variables/tasks.html">$tasks</a> = <a class="var it2287" onMouseOver="hilite(2287)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../../../_variables/rc.html">$rc</a>-&gt;<a class="function" onClick="logFunction('get_plan')" href="../../../_functions/get_plan.html" onMouseOver="funcPopup(event,'get_plan')">get_plan</a>()-&gt;<a class="function" onClick="logFunction('get_tasks')" href="../../../_functions/get_tasks.html" onMouseOver="funcPopup(event,'get_tasks')">get_tasks</a>();
<a name="l72"><span class="linenum">  72</span></a>          <a class="var it38824" onMouseOver="hilite(38824)" onMouseOut="lolite()" onClick="logVariable('includedtasks')" href="../../../_variables/includedtasks.html">$includedtasks</a> = array();
<a name="l73"><span class="linenum">  73</span></a>          foreach (<a class="var it110" onMouseOver="hilite(110)" onMouseOut="lolite()" onClick="logVariable('tasks')" href="../../../_variables/tasks.html">$tasks</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a>) {
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">            // Calculate if the task is being included</span>
<a name="l75"><span class="linenum">  75</span></a>              <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('included')" href="../../../_variables/included.html">$included</a> = false;
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">            // blocks, based in blocks setting and parent activity/course</span>
<a name="l77"><span class="linenum">  77</span></a>              if (<a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a> instanceof restore_block_task) {
<a name="l78"><span class="linenum">  78</span></a>                  if (!<a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('blocks')) { // Blocks not included, continue
<a name="l79"><span class="linenum">  79</span></a>                      continue;
<a name="l80"><span class="linenum">  80</span></a>                  }
<a name="l81"><span class="linenum">  81</span></a>                  <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../../_variables/parent.html">$parent</a> = <a class="phpfunction" onClick="logFunction('basename')" href="../../../_functions/basename.html" onMouseOver="phpfuncPopup(event,'basename')">basename</a>(<a class="phpfunction" onClick="logFunction('dirname')" href="../../../_functions/dirname.html" onMouseOver="phpfuncPopup(event,'dirname')">dirname</a>(<a class="phpfunction" onClick="logFunction('dirname')" href="../../../_functions/dirname.html" onMouseOver="phpfuncPopup(event,'dirname')">dirname</a>(<a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a>-&gt;<a class="function" onClick="logFunction('get_taskbasepath')" href="../../../_functions/get_taskbasepath.html" onMouseOver="funcPopup(event,'get_taskbasepath')">get_taskbasepath</a>())));
<a name="l82"><span class="linenum">  82</span></a>                  if (<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../../_variables/parent.html">$parent</a> == 'course') { // Parent is course, always included if present
<a name="l83"><span class="linenum">  83</span></a>                      <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('included')" href="../../../_variables/included.html">$included</a> = true;
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>                  } else { // Look for activity_included setting
<a name="l86"><span class="linenum">  86</span></a>                      <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('included')" href="../../../_variables/included.html">$included</a> = <a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>(<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../../_variables/parent.html">$parent</a> . '_included');
<a name="l87"><span class="linenum">  87</span></a>                  }
<a name="l88"><span class="linenum">  88</span></a>  
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">            // ativities, based on included setting</span>
<a name="l90"><span class="linenum">  90</span></a>              } else if (<a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a> instanceof restore_activity_task) {
<a name="l91"><span class="linenum">  91</span></a>                  <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('included')" href="../../../_variables/included.html">$included</a> = <a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('included');
<a name="l92"><span class="linenum">  92</span></a>  
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">            // sections, based on included setting</span>
<a name="l94"><span class="linenum">  94</span></a>              } else if (<a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a> instanceof restore_section_task) {
<a name="l95"><span class="linenum">  95</span></a>                  <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('included')" href="../../../_variables/included.html">$included</a> = <a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('included');
<a name="l96"><span class="linenum">  96</span></a>  
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">            // course always included if present</span>
<a name="l98"><span class="linenum">  98</span></a>              } else if (<a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a> instanceof restore_course_task) {
<a name="l99"><span class="linenum">  99</span></a>                  <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('included')" href="../../../_variables/included.html">$included</a> = true;
<a name="l100"><span class="linenum"> 100</span></a>              }
<a name="l101"><span class="linenum"> 101</span></a>  
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">            // If included, add it</span>
<a name="l103"><span class="linenum"> 103</span></a>              if (<a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('included')" href="../../../_variables/included.html">$included</a>) {
<a name="l104"><span class="linenum"> 104</span></a>                  <a class="var it38824" onMouseOver="hilite(38824)" onMouseOut="lolite()" onClick="logVariable('includedtasks')" href="../../../_variables/includedtasks.html">$includedtasks</a>[] = <a class="function" onClick="logFunction('clone')" href="../../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it720" onMouseOver="hilite(720)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../../_variables/task.html">$task</a>); <span class="comment">// A clone is enough. In fact we only need the basepath.</span>
<a name="l105"><span class="linenum"> 105</span></a>              }
<a name="l106"><span class="linenum"> 106</span></a>          }
<a name="l107"><span class="linenum"> 107</span></a>          <a class="var it2287" onMouseOver="hilite(2287)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../../../_variables/rc.html">$rc</a>-&gt;<a class="function" onClick="logFunction('destroy')" href="../../../_functions/destroy.html" onMouseOver="funcPopup(event,'destroy')">destroy</a>(); <span class="comment">// Always need to destroy.</span>
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>          return <a class="var it38824" onMouseOver="hilite(38824)" onMouseOut="lolite()" onClick="logVariable('includedtasks')" href="../../../_variables/includedtasks.html">$includedtasks</a>;
<a name="l110"><span class="linenum"> 110</span></a>      }
<a name="l111"><span class="linenum"> 111</span></a>  
<a name="l112"><span class="linenum"> 112</span></a>      <span class="comment">/**</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment">     * Load one inforef.xml file to backup_ids table for future reference</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment">     *</span>
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment">     * @param string $restoreid Restore id</span>
<a name="l116"><span class="linenum"> 116</span></a>  <span class="comment">     * @param string $inforeffile File path</span>
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">     * @param \core\progress\base $progress Progress tracker</span>
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment">     */</span>
<a name="l119"><span class="linenum"> 119</span></a>      public static function <a class="function" onClick="logFunction('load_inforef_to_tempids')" href="../../../_functions/load_inforef_to_tempids.html" onMouseOver="funcPopup(event,'load_inforef_to_tempids')">load_inforef_to_tempids</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it10897" onMouseOver="hilite(10897)" onMouseOut="lolite()" onClick="logVariable('inforeffile')" href="../../../_variables/inforeffile.html">$inforeffile</a>,
<a name="l120"><span class="linenum"> 120</span></a>              \core\progress\base <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a> = null) {
<a name="l121"><span class="linenum"> 121</span></a>  
<a name="l122"><span class="linenum"> 122</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it10897" onMouseOver="hilite(10897)" onMouseOut="lolite()" onClick="logVariable('inforeffile')" href="../../../_variables/inforeffile.html">$inforeffile</a>)) { // Shouldn't happen ever, but...
<a name="l123"><span class="linenum"> 123</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_helper_exception')" href="../../../_classes/backup_helper_exception.html" onMouseOver="classPopup(event,'backup_helper_exception')">backup_helper_exception</a>('missing_inforef_xml_file', <a class="var it10897" onMouseOver="hilite(10897)" onMouseOut="lolite()" onClick="logVariable('inforeffile')" href="../../../_variables/inforeffile.html">$inforeffile</a>);
<a name="l124"><span class="linenum"> 124</span></a>          }
<a name="l125"><span class="linenum"> 125</span></a>  
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">        // Set up progress tracking (indeterminate).</span>
<a name="l127"><span class="linenum"> 127</span></a>          if (!<a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>) {
<a name="l128"><span class="linenum"> 128</span></a>              <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a> = new \core\progress\none();
<a name="l129"><span class="linenum"> 129</span></a>          }
<a name="l130"><span class="linenum"> 130</span></a>          <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>('Loading inforef.xml file');
<a name="l131"><span class="linenum"> 131</span></a>  
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">        // Let's parse, custom processor will do its work, sending info to DB</span>
<a name="l133"><span class="linenum"> 133</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progressive_parser')" href="../../../_classes/progressive_parser.html" onMouseOver="classPopup(event,'progressive_parser')">progressive_parser</a>();
<a name="l134"><span class="linenum"> 134</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_file')" href="../../../_functions/set_file.html" onMouseOver="funcPopup(event,'set_file')">set_file</a>(<a class="var it10897" onMouseOver="hilite(10897)" onMouseOut="lolite()" onClick="logVariable('inforeffile')" href="../../../_variables/inforeffile.html">$inforeffile</a>);
<a name="l135"><span class="linenum"> 135</span></a>          <a class="var it28121" onMouseOver="hilite(28121)" onMouseOut="lolite()" onClick="logVariable('xmlprocessor')" href="../../../_variables/xmlprocessor.html">$xmlprocessor</a> = <span class="keyword">new </span><a class="class" onClick="logClass('restore_inforef_parser_processor')" href="../../../_classes/restore_inforef_parser_processor.html" onMouseOver="classPopup(event,'restore_inforef_parser_processor')">restore_inforef_parser_processor</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>);
<a name="l136"><span class="linenum"> 136</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_processor')" href="../../../_functions/set_processor.html" onMouseOver="funcPopup(event,'set_processor')">set_processor</a>(<a class="var it28121" onMouseOver="hilite(28121)" onMouseOut="lolite()" onClick="logVariable('xmlprocessor')" href="../../../_variables/xmlprocessor.html">$xmlprocessor</a>);
<a name="l137"><span class="linenum"> 137</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_progress')" href="../../../_functions/set_progress.html" onMouseOver="funcPopup(event,'set_progress')">set_progress</a>(<a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>);
<a name="l138"><span class="linenum"> 138</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('process')" href="../../../_functions/process.html" onMouseOver="funcPopup(event,'process')">process</a>();
<a name="l139"><span class="linenum"> 139</span></a>  
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">        // Finish progress</span>
<a name="l141"><span class="linenum"> 141</span></a>          <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l142"><span class="linenum"> 142</span></a>      }
<a name="l143"><span class="linenum"> 143</span></a>  
<a name="l144"><span class="linenum"> 144</span></a>      <span class="comment">/**</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">     * Load the needed role.xml file to backup_ids table for future reference</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">     */</span>
<a name="l147"><span class="linenum"> 147</span></a>      public static function <a class="function" onClick="logFunction('load_roles_to_tempids')" href="../../../_functions/load_roles_to_tempids.html" onMouseOver="funcPopup(event,'load_roles_to_tempids')">load_roles_to_tempids</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it38825" onMouseOver="hilite(38825)" onMouseOut="lolite()" onClick="logVariable('rolesfile')" href="../../../_variables/rolesfile.html">$rolesfile</a>) {
<a name="l148"><span class="linenum"> 148</span></a>  
<a name="l149"><span class="linenum"> 149</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it38825" onMouseOver="hilite(38825)" onMouseOut="lolite()" onClick="logVariable('rolesfile')" href="../../../_variables/rolesfile.html">$rolesfile</a>)) { // Shouldn't happen ever, but...
<a name="l150"><span class="linenum"> 150</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_helper_exception')" href="../../../_classes/backup_helper_exception.html" onMouseOver="classPopup(event,'backup_helper_exception')">backup_helper_exception</a>('missing_roles_xml_file', <a class="var it38825" onMouseOver="hilite(38825)" onMouseOut="lolite()" onClick="logVariable('rolesfile')" href="../../../_variables/rolesfile.html">$rolesfile</a>);
<a name="l151"><span class="linenum"> 151</span></a>          }
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment">        // Let's parse, custom processor will do its work, sending info to DB</span>
<a name="l153"><span class="linenum"> 153</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progressive_parser')" href="../../../_classes/progressive_parser.html" onMouseOver="classPopup(event,'progressive_parser')">progressive_parser</a>();
<a name="l154"><span class="linenum"> 154</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_file')" href="../../../_functions/set_file.html" onMouseOver="funcPopup(event,'set_file')">set_file</a>(<a class="var it38825" onMouseOver="hilite(38825)" onMouseOut="lolite()" onClick="logVariable('rolesfile')" href="../../../_variables/rolesfile.html">$rolesfile</a>);
<a name="l155"><span class="linenum"> 155</span></a>          <a class="var it28121" onMouseOver="hilite(28121)" onMouseOut="lolite()" onClick="logVariable('xmlprocessor')" href="../../../_variables/xmlprocessor.html">$xmlprocessor</a> = <span class="keyword">new </span><a class="class" onClick="logClass('restore_roles_parser_processor')" href="../../../_classes/restore_roles_parser_processor.html" onMouseOver="classPopup(event,'restore_roles_parser_processor')">restore_roles_parser_processor</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>);
<a name="l156"><span class="linenum"> 156</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_processor')" href="../../../_functions/set_processor.html" onMouseOver="funcPopup(event,'set_processor')">set_processor</a>(<a class="var it28121" onMouseOver="hilite(28121)" onMouseOut="lolite()" onClick="logVariable('xmlprocessor')" href="../../../_variables/xmlprocessor.html">$xmlprocessor</a>);
<a name="l157"><span class="linenum"> 157</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('process')" href="../../../_functions/process.html" onMouseOver="funcPopup(event,'process')">process</a>();
<a name="l158"><span class="linenum"> 158</span></a>      }
<a name="l159"><span class="linenum"> 159</span></a>  
<a name="l160"><span class="linenum"> 160</span></a>      <span class="comment">/**</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment">     * Precheck the loaded roles, return empty array if everything is ok, and</span>
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment">     * array with 'errors', 'warnings' elements (suitable to be used by restore_prechecks)</span>
<a name="l163"><span class="linenum"> 163</span></a>  <span class="comment">     * with any problem found. At the same time, store all the mapping into backup_ids_temp</span>
<a name="l164"><span class="linenum"> 164</span></a>  <span class="comment">     * and also put the information into $rolemappings (controller-&gt;info), so it can be reworked later by</span>
<a name="l165"><span class="linenum"> 165</span></a>  <span class="comment">     * post-precheck stages while at the same time accept modified info in the same object coming from UI</span>
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">     */</span>
<a name="l167"><span class="linenum"> 167</span></a>      public static function <a class="function" onClick="logFunction('precheck_included_roles')" href="../../../_functions/precheck_included_roles.html" onMouseOver="funcPopup(event,'precheck_included_roles')">precheck_included_roles</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('rolemappings')" href="../../../_variables/rolemappings.html">$rolemappings</a>) {
<a name="l168"><span class="linenum"> 168</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l169"><span class="linenum"> 169</span></a>  
<a name="l170"><span class="linenum"> 170</span></a>          <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a> = array(); <span class="comment">// To store warnings/errors</span>
<a name="l171"><span class="linenum"> 171</span></a>  
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment">        // Get loaded roles from backup_ids</span>
<a name="l173"><span class="linenum"> 173</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('backup_ids_temp', array('backupid' =&gt; <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'itemname' =&gt; 'role'), '', 'itemid, info');
<a name="l174"><span class="linenum"> 174</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> as <a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>) {
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">            // If the rolemappings-&gt;modified flag is set, that means that we are coming from</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">            // manually modified mappings (by UI), so accept those mappings an put them to backup_ids</span>
<a name="l177"><span class="linenum"> 177</span></a>              if (<a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('rolemappings')" href="../../../_variables/rolemappings.html">$rolemappings</a>-&gt;<a onClick="logVariable('modified')" class="var it43606" onMouseOver="hilite(43606)" onMouseOut="lolite()" href="../../../_variables/modified.html">modified</a>) {
<a name="l178"><span class="linenum"> 178</span></a>                  <a class="var it713" onMouseOver="hilite(713)" onMouseOut="lolite()" onClick="logVariable('target')" href="../../../_variables/target.html">$target</a> = <a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('rolemappings')" href="../../../_variables/rolemappings.html">$rolemappings</a>-&gt;<a onClick="logVariable('mappings')" class="var it43606" onMouseOver="hilite(43606)" onMouseOut="lolite()" href="../../../_variables/mappings.html">mappings</a>[<a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>-&gt;<a onClick="logVariable('itemid')" class="var it45165" onMouseOver="hilite(45165)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>]-&gt;targetroleid;
<a name="l179"><span class="linenum"> 179</span></a>                  self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'role', <a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>-&gt;<a onClick="logVariable('itemid')" class="var it45165" onMouseOver="hilite(45165)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>, <a class="var it713" onMouseOver="hilite(713)" onMouseOut="lolite()" onClick="logVariable('target')" href="../../../_variables/target.html">$target</a>);
<a name="l180"><span class="linenum"> 180</span></a>  
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">            // Else, we haven't any info coming from UI, let's calculate the mappings, matching</span>
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment">            // in multiple ways and checking permissions. Note mapping to 0 means &quot;skip&quot;</span>
<a name="l183"><span class="linenum"> 183</span></a>              } else {
<a name="l184"><span class="linenum"> 184</span></a>                  <a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a> = (object)backup_controller_dbops::<a class="function" onClick="logFunction('decode_backup_temp_info')" href="../../../_functions/decode_backup_temp_info.html" onMouseOver="funcPopup(event,'decode_backup_temp_info')">decode_backup_temp_info</a>(<a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>-&gt;<a onClick="logVariable('info')" class="var it45165" onMouseOver="hilite(45165)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>);
<a name="l185"><span class="linenum"> 185</span></a>                  <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a> = self::<a class="function" onClick="logFunction('get_best_assignable_role')" href="../../../_functions/get_best_assignable_role.html" onMouseOver="funcPopup(event,'get_best_assignable_role')">get_best_assignable_role</a>(<a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>);
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment">                // Send match to backup_ids</span>
<a name="l187"><span class="linenum"> 187</span></a>                  self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'role', <a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>-&gt;<a onClick="logVariable('itemid')" class="var it45165" onMouseOver="hilite(45165)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>, <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a>);
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment">                // Build the rolemappings element for controller</span>
<a name="l189"><span class="linenum"> 189</span></a>                  unset(<a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it42915" onMouseOver="hilite(42915)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l190"><span class="linenum"> 190</span></a>                  unset(<a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('nameincourse')" class="var it42915" onMouseOver="hilite(42915)" onMouseOut="lolite()" href="../../../_variables/nameincourse.html">nameincourse</a>);
<a name="l191"><span class="linenum"> 191</span></a>                  <a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('targetroleid')" class="var it42915" onMouseOver="hilite(42915)" onMouseOut="lolite()" href="../../../_variables/targetroleid.html">targetroleid</a> = <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a>;
<a name="l192"><span class="linenum"> 192</span></a>                  <a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('rolemappings')" href="../../../_variables/rolemappings.html">$rolemappings</a>-&gt;<a onClick="logVariable('mappings')" class="var it43606" onMouseOver="hilite(43606)" onMouseOut="lolite()" href="../../../_variables/mappings.html">mappings</a>[<a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>-&gt;<a onClick="logVariable('itemid')" class="var it45165" onMouseOver="hilite(45165)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>] = <a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>;
<a name="l193"><span class="linenum"> 193</span></a>  <span class="comment">                // Prepare warning if no match found</span>
<a name="l194"><span class="linenum"> 194</span></a>                  if (!<a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a>) {
<a name="l195"><span class="linenum"> 195</span></a>                      <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>['warnings'][] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('cannotfindassignablerole', 'backup', <a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('name')" class="var it42915" onMouseOver="hilite(42915)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>);
<a name="l196"><span class="linenum"> 196</span></a>                  }
<a name="l197"><span class="linenum"> 197</span></a>              }
<a name="l198"><span class="linenum"> 198</span></a>          }
<a name="l199"><span class="linenum"> 199</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l200"><span class="linenum"> 200</span></a>          return <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>;
<a name="l201"><span class="linenum"> 201</span></a>      }
<a name="l202"><span class="linenum"> 202</span></a>  
<a name="l203"><span class="linenum"> 203</span></a>      <span class="comment">/**</span>
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment">     * Return cached backup id's</span>
<a name="l205"><span class="linenum"> 205</span></a>  <span class="comment">     *</span>
<a name="l206"><span class="linenum"> 206</span></a>  <span class="comment">     * @param int $restoreid id of backup</span>
<a name="l207"><span class="linenum"> 207</span></a>  <span class="comment">     * @param string $itemname name of the item</span>
<a name="l208"><span class="linenum"> 208</span></a>  <span class="comment">     * @param int $itemid id of item</span>
<a name="l209"><span class="linenum"> 209</span></a>  <span class="comment">     * @return array backup id's</span>
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment">     * @todo MDL-25290 replace static backupids* with MUC code</span>
<a name="l211"><span class="linenum"> 211</span></a>  <span class="comment">     */</span>
<a name="l212"><span class="linenum"> 212</span></a>      protected static function <a class="function" onClick="logFunction('get_backup_ids_cached')" href="../../../_functions/get_backup_ids_cached.html" onMouseOver="funcPopup(event,'get_backup_ids_cached')">get_backup_ids_cached</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a>) {
<a name="l213"><span class="linenum"> 213</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l214"><span class="linenum"> 214</span></a>  
<a name="l215"><span class="linenum"> 215</span></a>          <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> = &quot;<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a> <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a> <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>&quot;;
<a name="l216"><span class="linenum"> 216</span></a>  
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment">        // If record exists in cache then return.</span>
<a name="l218"><span class="linenum"> 218</span></a>          if (isset(self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]) &amp;&amp; isset(self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>])) {
<a name="l219"><span class="linenum"> 219</span></a>  <span class="comment">            // Return a copy of cached data, to avoid any alterations in cached data.</span>
<a name="l220"><span class="linenum"> 220</span></a>              return clone self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>];
<a name="l221"><span class="linenum"> 221</span></a>          }
<a name="l222"><span class="linenum"> 222</span></a>  
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment">        // Clean cache, if it's full.</span>
<a name="l224"><span class="linenum"> 224</span></a>          if (self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a> &lt;= 0) {
<a name="l225"><span class="linenum"> 225</span></a>  <span class="comment">            // Remove some records, to keep memory in limit.</span>
<a name="l226"><span class="linenum"> 226</span></a>              self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a> = <a class="phpfunction" onClick="logFunction('array_slice')" href="../../../_functions/array_slice.html" onMouseOver="phpfuncPopup(event,'array_slice')">array_slice</a>(self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>, self::<a class="var it38823" onMouseOver="hilite(38823)" onMouseOut="lolite()" onClick="logVariable('backupidsslice')" href="../../../_variables/backupidsslice.html">$backupidsslice</a>, null, true);
<a name="l227"><span class="linenum"> 227</span></a>              self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a> = self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a> + self::<a class="var it38823" onMouseOver="hilite(38823)" onMouseOut="lolite()" onClick="logVariable('backupidsslice')" href="../../../_variables/backupidsslice.html">$backupidsslice</a>;
<a name="l228"><span class="linenum"> 228</span></a>          }
<a name="l229"><span class="linenum"> 229</span></a>          if (self::<a class="var it38822" onMouseOver="hilite(38822)" onMouseOut="lolite()" onClick="logVariable('backupidsexistsize')" href="../../../_variables/backupidsexistsize.html">$backupidsexistsize</a> &lt;= 0) {
<a name="l230"><span class="linenum"> 230</span></a>              self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a> = <a class="phpfunction" onClick="logFunction('array_slice')" href="../../../_functions/array_slice.html" onMouseOver="phpfuncPopup(event,'array_slice')">array_slice</a>(self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a>, self::<a class="var it38823" onMouseOver="hilite(38823)" onMouseOut="lolite()" onClick="logVariable('backupidsslice')" href="../../../_variables/backupidsslice.html">$backupidsslice</a>, null, true);
<a name="l231"><span class="linenum"> 231</span></a>              self::<a class="var it38822" onMouseOver="hilite(38822)" onMouseOut="lolite()" onClick="logVariable('backupidsexistsize')" href="../../../_variables/backupidsexistsize.html">$backupidsexistsize</a> = self::<a class="var it38822" onMouseOver="hilite(38822)" onMouseOut="lolite()" onClick="logVariable('backupidsexistsize')" href="../../../_variables/backupidsexistsize.html">$backupidsexistsize</a> + self::<a class="var it38823" onMouseOver="hilite(38823)" onMouseOut="lolite()" onClick="logVariable('backupidsslice')" href="../../../_variables/backupidsslice.html">$backupidsslice</a>;
<a name="l232"><span class="linenum"> 232</span></a>          }
<a name="l233"><span class="linenum"> 233</span></a>  
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment">        // Retrive record from database.</span>
<a name="l235"><span class="linenum"> 235</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a> = array(
<a name="l236"><span class="linenum"> 236</span></a>              'backupid' =&gt; <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>,
<a name="l237"><span class="linenum"> 237</span></a>              'itemname' =&gt; <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a>,
<a name="l238"><span class="linenum"> 238</span></a>              'itemid'   =&gt; <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a>
<a name="l239"><span class="linenum"> 239</span></a>          );
<a name="l240"><span class="linenum"> 240</span></a>          if (<a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('backup_ids_temp', <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>)) {
<a name="l241"><span class="linenum"> 241</span></a>              self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a>-&gt;<a onClick="logVariable('id')" class="var it45023" onMouseOver="hilite(45023)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l242"><span class="linenum"> 242</span></a>              self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a>;
<a name="l243"><span class="linenum"> 243</span></a>              self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a>--;
<a name="l244"><span class="linenum"> 244</span></a>              self::<a class="var it38822" onMouseOver="hilite(38822)" onMouseOut="lolite()" onClick="logVariable('backupidsexistsize')" href="../../../_variables/backupidsexistsize.html">$backupidsexistsize</a>--;
<a name="l245"><span class="linenum"> 245</span></a>              return <a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a>;
<a name="l246"><span class="linenum"> 246</span></a>          } else {
<a name="l247"><span class="linenum"> 247</span></a>              return false;
<a name="l248"><span class="linenum"> 248</span></a>          }
<a name="l249"><span class="linenum"> 249</span></a>      }
<a name="l250"><span class="linenum"> 250</span></a>  
<a name="l251"><span class="linenum"> 251</span></a>      <span class="comment">/**</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment">     * Cache backup ids'</span>
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment">     *</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment">     * @param int $restoreid id of backup</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">     * @param string $itemname name of the item</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment">     * @param int $itemid id of item</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">     * @param array $extrarecord extra record which needs to be updated</span>
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment">     * @return void</span>
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment">     * @todo MDL-25290 replace static BACKUP_IDS_* with MUC code</span>
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment">     */</span>
<a name="l261"><span class="linenum"> 261</span></a>      protected static function <a class="function" onClick="logFunction('set_backup_ids_cached')" href="../../../_functions/set_backup_ids_cached.html" onMouseOver="funcPopup(event,'set_backup_ids_cached')">set_backup_ids_cached</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a>, <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>) {
<a name="l262"><span class="linenum"> 262</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l263"><span class="linenum"> 263</span></a>  
<a name="l264"><span class="linenum"> 264</span></a>          <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> = &quot;<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a> <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a> <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>&quot;;
<a name="l265"><span class="linenum"> 265</span></a>  
<a name="l266"><span class="linenum"> 266</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a> = array(
<a name="l267"><span class="linenum"> 267</span></a>              'backupid' =&gt; <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>,
<a name="l268"><span class="linenum"> 268</span></a>              'itemname' =&gt; <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a>,
<a name="l269"><span class="linenum"> 269</span></a>              'itemid'   =&gt; <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a>,
<a name="l270"><span class="linenum"> 270</span></a>          );
<a name="l271"><span class="linenum"> 271</span></a>  
<a name="l272"><span class="linenum"> 272</span></a>  <span class="comment">        // If record is not cached then add one.</span>
<a name="l273"><span class="linenum"> 273</span></a>          if (!isset(self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>])) {
<a name="l274"><span class="linenum"> 274</span></a>  <span class="comment">            // If we have this record in db, then just update this.</span>
<a name="l275"><span class="linenum"> 275</span></a>              if (<a class="var it38829" onMouseOver="hilite(38829)" onMouseOut="lolite()" onClick="logVariable('existingrecord')" href="../../../_variables/existingrecord.html">$existingrecord</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('backup_ids_temp', <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>)) {
<a name="l276"><span class="linenum"> 276</span></a>                  self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it38829" onMouseOver="hilite(38829)" onMouseOut="lolite()" onClick="logVariable('existingrecord')" href="../../../_variables/existingrecord.html">$existingrecord</a>-&gt;<a onClick="logVariable('id')" class="var it45166" onMouseOver="hilite(45166)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l277"><span class="linenum"> 277</span></a>                  self::<a class="var it38822" onMouseOver="hilite(38822)" onMouseOut="lolite()" onClick="logVariable('backupidsexistsize')" href="../../../_variables/backupidsexistsize.html">$backupidsexistsize</a>--;
<a name="l278"><span class="linenum"> 278</span></a>                  self::<a class="function" onClick="logFunction('update_backup_cached_record')" href="../../../_functions/update_backup_cached_record.html" onMouseOver="funcPopup(event,'update_backup_cached_record')">update_backup_cached_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>, <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>, <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>, <a class="var it38829" onMouseOver="hilite(38829)" onMouseOut="lolite()" onClick="logVariable('existingrecord')" href="../../../_variables/existingrecord.html">$existingrecord</a>);
<a name="l279"><span class="linenum"> 279</span></a>              } else {
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment">                // Add new record to cache and db.</span>
<a name="l281"><span class="linenum"> 281</span></a>                  <a class="var it38830" onMouseOver="hilite(38830)" onMouseOut="lolite()" onClick="logVariable('recorddefault')" href="../../../_variables/recorddefault.html">$recorddefault</a> = array (
<a name="l282"><span class="linenum"> 282</span></a>                      'newitemid' =&gt; 0,
<a name="l283"><span class="linenum"> 283</span></a>                      'parentitemid' =&gt; null,
<a name="l284"><span class="linenum"> 284</span></a>                      'info' =&gt; null);
<a name="l285"><span class="linenum"> 285</span></a>                  <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>, <a class="var it38830" onMouseOver="hilite(38830)" onMouseOut="lolite()" onClick="logVariable('recorddefault')" href="../../../_variables/recorddefault.html">$recorddefault</a>, <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>);
<a name="l286"><span class="linenum"> 286</span></a>                  <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>['id'] = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('backup_ids_temp', <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>);
<a name="l287"><span class="linenum"> 287</span></a>                  self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>['id'];
<a name="l288"><span class="linenum"> 288</span></a>                  self::<a class="var it38822" onMouseOver="hilite(38822)" onMouseOut="lolite()" onClick="logVariable('backupidsexistsize')" href="../../../_variables/backupidsexistsize.html">$backupidsexistsize</a>--;
<a name="l289"><span class="linenum"> 289</span></a>                  if (self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a> &gt; 0) {
<a name="l290"><span class="linenum"> 290</span></a>  <span class="comment">                    // Cache new records if we haven't got many yet.</span>
<a name="l291"><span class="linenum"> 291</span></a>                      self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = (object) <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>;
<a name="l292"><span class="linenum"> 292</span></a>                      self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a>--;
<a name="l293"><span class="linenum"> 293</span></a>                  }
<a name="l294"><span class="linenum"> 294</span></a>              }
<a name="l295"><span class="linenum"> 295</span></a>          } else {
<a name="l296"><span class="linenum"> 296</span></a>              self::<a class="function" onClick="logFunction('update_backup_cached_record')" href="../../../_functions/update_backup_cached_record.html" onMouseOver="funcPopup(event,'update_backup_cached_record')">update_backup_cached_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>, <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>, <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>);
<a name="l297"><span class="linenum"> 297</span></a>          }
<a name="l298"><span class="linenum"> 298</span></a>      }
<a name="l299"><span class="linenum"> 299</span></a>  
<a name="l300"><span class="linenum"> 300</span></a>      <span class="comment">/**</span>
<a name="l301"><span class="linenum"> 301</span></a>  <span class="comment">     * Updates existing backup record</span>
<a name="l302"><span class="linenum"> 302</span></a>  <span class="comment">     *</span>
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment">     * @param array $record record which needs to be updated</span>
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment">     * @param array $extrarecord extra record which needs to be updated</span>
<a name="l305"><span class="linenum"> 305</span></a>  <span class="comment">     * @param string $key unique key which is used to identify cached record</span>
<a name="l306"><span class="linenum"> 306</span></a>  <span class="comment">     * @param stdClass $existingrecord (optional) existing record</span>
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">     */</span>
<a name="l308"><span class="linenum"> 308</span></a>      protected static function <a class="function" onClick="logFunction('update_backup_cached_record')" href="../../../_functions/update_backup_cached_record.html" onMouseOver="funcPopup(event,'update_backup_cached_record')">update_backup_cached_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>, <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>, <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>, <a class="var it38829" onMouseOver="hilite(38829)" onMouseOut="lolite()" onClick="logVariable('existingrecord')" href="../../../_variables/existingrecord.html">$existingrecord</a> = null) {
<a name="l309"><span class="linenum"> 309</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment">        // Update only if extrarecord is not empty.</span>
<a name="l311"><span class="linenum"> 311</span></a>          if (!empty(<a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>)) {
<a name="l312"><span class="linenum"> 312</span></a>              <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>['id'] = self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>];
<a name="l313"><span class="linenum"> 313</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('backup_ids_temp', <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>);
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">            // Update existing cache or add new record to cache.</span>
<a name="l315"><span class="linenum"> 315</span></a>              if (isset(self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>])) {
<a name="l316"><span class="linenum"> 316</span></a>                  <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>((array)self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>], <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>);
<a name="l317"><span class="linenum"> 317</span></a>                  self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = (object) <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>;
<a name="l318"><span class="linenum"> 318</span></a>              } else if (self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a> &gt; 0) {
<a name="l319"><span class="linenum"> 319</span></a>                  if (<a class="var it38829" onMouseOver="hilite(38829)" onMouseOut="lolite()" onClick="logVariable('existingrecord')" href="../../../_variables/existingrecord.html">$existingrecord</a>) {
<a name="l320"><span class="linenum"> 320</span></a>                      self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it38829" onMouseOver="hilite(38829)" onMouseOut="lolite()" onClick="logVariable('existingrecord')" href="../../../_variables/existingrecord.html">$existingrecord</a>;
<a name="l321"><span class="linenum"> 321</span></a>                  } else {
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment">                    // Retrive record from database and cache updated records.</span>
<a name="l323"><span class="linenum"> 323</span></a>                      self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('backup_ids_temp', <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>);
<a name="l324"><span class="linenum"> 324</span></a>                  }
<a name="l325"><span class="linenum"> 325</span></a>                  <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>((array)self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>], <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>);
<a name="l326"><span class="linenum"> 326</span></a>                  self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = (object) <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>;
<a name="l327"><span class="linenum"> 327</span></a>                  self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a>--;
<a name="l328"><span class="linenum"> 328</span></a>              }
<a name="l329"><span class="linenum"> 329</span></a>          }
<a name="l330"><span class="linenum"> 330</span></a>      }
<a name="l331"><span class="linenum"> 331</span></a>  
<a name="l332"><span class="linenum"> 332</span></a>      <span class="comment">/**</span>
<a name="l333"><span class="linenum"> 333</span></a>  <span class="comment">     * Reset the ids caches completely</span>
<a name="l334"><span class="linenum"> 334</span></a>  <span class="comment">     *</span>
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment">     * Any destructive operation (partial delete, truncate, drop or recreate) performed</span>
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">     * with the backup_ids table must cause the backup_ids caches to be</span>
<a name="l337"><span class="linenum"> 337</span></a>  <span class="comment">     * invalidated by calling this method. See MDL-33630.</span>
<a name="l338"><span class="linenum"> 338</span></a>  <span class="comment">     *</span>
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment">     * Note that right now, the only operation of that type is the recreation</span>
<a name="l340"><span class="linenum"> 340</span></a>  <span class="comment">     * (drop &amp; restore) of the table that may happen once the prechecks have ended. All</span>
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment">     * the rest of operations are always routed via {@link set_backup_ids_record()}, 1 by 1,</span>
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment">     * keeping the caches on sync.</span>
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment">     *</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment">     * @todo MDL-25290 static should be replaced with MUC code.</span>
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment">     */</span>
<a name="l346"><span class="linenum"> 346</span></a>      public static function <a class="function" onClick="logFunction('reset_backup_ids_cached')" href="../../../_functions/reset_backup_ids_cached.html" onMouseOver="funcPopup(event,'reset_backup_ids_cached')">reset_backup_ids_cached</a>() {
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment">        // Reset the ids cache.</span>
<a name="l348"><span class="linenum"> 348</span></a>          <a class="var it38831" onMouseOver="hilite(38831)" onMouseOut="lolite()" onClick="logVariable('cachetoadd')" href="../../../_variables/cachetoadd.html">$cachetoadd</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a>);
<a name="l349"><span class="linenum"> 349</span></a>          self::<a class="var it38819" onMouseOver="hilite(38819)" onMouseOut="lolite()" onClick="logVariable('backupidscache')" href="../../../_variables/backupidscache.html">$backupidscache</a> = array();
<a name="l350"><span class="linenum"> 350</span></a>          self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a> = self::<a class="var it38821" onMouseOver="hilite(38821)" onMouseOut="lolite()" onClick="logVariable('backupidscachesize')" href="../../../_variables/backupidscachesize.html">$backupidscachesize</a> + <a class="var it38831" onMouseOver="hilite(38831)" onMouseOut="lolite()" onClick="logVariable('cachetoadd')" href="../../../_variables/cachetoadd.html">$cachetoadd</a>;
<a name="l351"><span class="linenum"> 351</span></a>  <span class="comment">        // Reset the exists cache.</span>
<a name="l352"><span class="linenum"> 352</span></a>          <a class="var it38832" onMouseOver="hilite(38832)" onMouseOut="lolite()" onClick="logVariable('existstoadd')" href="../../../_variables/existstoadd.html">$existstoadd</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a>);
<a name="l353"><span class="linenum"> 353</span></a>          self::<a class="var it38820" onMouseOver="hilite(38820)" onMouseOut="lolite()" onClick="logVariable('backupidsexist')" href="../../../_variables/backupidsexist.html">$backupidsexist</a> = array();
<a name="l354"><span class="linenum"> 354</span></a>          self::<a class="var it38822" onMouseOver="hilite(38822)" onMouseOut="lolite()" onClick="logVariable('backupidsexistsize')" href="../../../_variables/backupidsexistsize.html">$backupidsexistsize</a> = self::<a class="var it38822" onMouseOver="hilite(38822)" onMouseOut="lolite()" onClick="logVariable('backupidsexistsize')" href="../../../_variables/backupidsexistsize.html">$backupidsexistsize</a> + <a class="var it38832" onMouseOver="hilite(38832)" onMouseOut="lolite()" onClick="logVariable('existstoadd')" href="../../../_variables/existstoadd.html">$existstoadd</a>;
<a name="l355"><span class="linenum"> 355</span></a>      }
<a name="l356"><span class="linenum"> 356</span></a>  
<a name="l357"><span class="linenum"> 357</span></a>      <span class="comment">/**</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment">     * Given one role, as loaded from XML, perform the best possible matching against the assignable</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment">     * roles, using different fallback alternatives (shortname, archetype, editingteacher =&gt; teacher, defaultcourseroleid)</span>
<a name="l360"><span class="linenum"> 360</span></a>  <span class="comment">     * returning the id of the best matching role or 0 if no match is found</span>
<a name="l361"><span class="linenum"> 361</span></a>  <span class="comment">     */</span>
<a name="l362"><span class="linenum"> 362</span></a>      protected static function <a class="function" onClick="logFunction('get_best_assignable_role')" href="../../../_functions/get_best_assignable_role.html" onMouseOver="funcPopup(event,'get_best_assignable_role')">get_best_assignable_role</a>(<a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>) {
<a name="l363"><span class="linenum"> 363</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l364"><span class="linenum"> 364</span></a>  
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment">        // Gather various information about roles</span>
<a name="l366"><span class="linenum"> 366</span></a>          <a class="var it8535" onMouseOver="hilite(8535)" onMouseOut="lolite()" onClick="logVariable('coursectx')" href="../../../_variables/coursectx.html">$coursectx</a> = <a class="class" onClick="logClass('context_course')" href="../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>);
<a name="l367"><span class="linenum"> 367</span></a>          <a class="var it38833" onMouseOver="hilite(38833)" onMouseOut="lolite()" onClick="logVariable('assignablerolesshortname')" href="../../../_variables/assignablerolesshortname.html">$assignablerolesshortname</a> = <a class="function" onClick="logFunction('get_assignable_roles')" href="../../../_functions/get_assignable_roles.html" onMouseOver="funcPopup(event,'get_assignable_roles')">get_assignable_roles</a>(<a class="var it8535" onMouseOver="hilite(8535)" onMouseOut="lolite()" onClick="logVariable('coursectx')" href="../../../_variables/coursectx.html">$coursectx</a>, <a class="constant" onClick="logConstant('ROLENAME_SHORT')" href="../../../_constants/ROLENAME_SHORT.html" onMouseOver="constPopup(event,'ROLENAME_SHORT')">ROLENAME_SHORT</a>, false, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>);
<a name="l368"><span class="linenum"> 368</span></a>  
<a name="l369"><span class="linenum"> 369</span></a>  <span class="comment">        // Note: under 1.9 we had one function restore_samerole() that performed one complete</span>
<a name="l370"><span class="linenum"> 370</span></a>  <span class="comment">        // matching of roles (all caps) and if match was found the mapping was availabe bypassing</span>
<a name="l371"><span class="linenum"> 371</span></a>  <span class="comment">        // any assignable_roles() security. IMO that was wrong and we must not allow such</span>
<a name="l372"><span class="linenum"> 372</span></a>  <span class="comment">        // mappings anymore. So we have left that matching strategy out in 2.0</span>
<a name="l373"><span class="linenum"> 373</span></a>  
<a name="l374"><span class="linenum"> 374</span></a>  <span class="comment">        // Empty assignable roles, mean no match possible</span>
<a name="l375"><span class="linenum"> 375</span></a>          if (empty(<a class="var it38833" onMouseOver="hilite(38833)" onMouseOut="lolite()" onClick="logVariable('assignablerolesshortname')" href="../../../_variables/assignablerolesshortname.html">$assignablerolesshortname</a>)) {
<a name="l376"><span class="linenum"> 376</span></a>              return 0;
<a name="l377"><span class="linenum"> 377</span></a>          }
<a name="l378"><span class="linenum"> 378</span></a>  
<a name="l379"><span class="linenum"> 379</span></a>  <span class="comment">        // Match by shortname</span>
<a name="l380"><span class="linenum"> 380</span></a>          if (<a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a> = <a class="phpfunction" onClick="logFunction('array_search')" href="../../../_functions/array_search.html" onMouseOver="phpfuncPopup(event,'array_search')">array_search</a>(<a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it42915" onMouseOver="hilite(42915)" onMouseOut="lolite()" href="../../../_variables/shortname.html">shortname</a>, <a class="var it38833" onMouseOver="hilite(38833)" onMouseOut="lolite()" onClick="logVariable('assignablerolesshortname')" href="../../../_variables/assignablerolesshortname.html">$assignablerolesshortname</a>)) {
<a name="l381"><span class="linenum"> 381</span></a>              return <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a>;
<a name="l382"><span class="linenum"> 382</span></a>          }
<a name="l383"><span class="linenum"> 383</span></a>  
<a name="l384"><span class="linenum"> 384</span></a>  <span class="comment">        // Match by archetype</span>
<a name="l385"><span class="linenum"> 385</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28850" onMouseOver="hilite(28850)" onMouseOut="lolite()" onClick="logVariable('in_sql')" href="../../../_variables/in_sql.html">$in_sql</a>, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('in_params')" href="../../../_variables/in_params.html">$in_params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it38833" onMouseOver="hilite(38833)" onMouseOut="lolite()" onClick="logVariable('assignablerolesshortname')" href="../../../_variables/assignablerolesshortname.html">$assignablerolesshortname</a>));
<a name="l386"><span class="linenum"> 386</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(array(<a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('archetype')" class="var it42915" onMouseOver="hilite(42915)" onMouseOut="lolite()" href="../../../_variables/archetype.html">archetype</a>), <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('in_params')" href="../../../_variables/in_params.html">$in_params</a>);
<a name="l387"><span class="linenum"> 387</span></a>          if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_select')" href="../../../_functions/get_record_select.html" onMouseOver="funcPopup(event,'get_record_select')">get_record_select</a>('role', &quot;archetype = ? AND id <a class="var it28850" onMouseOver="hilite(28850)" onMouseOut="lolite()" onClick="logVariable('in_sql')" href="../../../_variables/in_sql.html">$in_sql</a>&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>, 'id', <a class="constant" onClick="logConstant('IGNORE_MULTIPLE')" href="../../../_constants/IGNORE_MULTIPLE.html" onMouseOver="constPopup(event,'IGNORE_MULTIPLE')">IGNORE_MULTIPLE</a>)) {
<a name="l388"><span class="linenum"> 388</span></a>              return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l389"><span class="linenum"> 389</span></a>          }
<a name="l390"><span class="linenum"> 390</span></a>  
<a name="l391"><span class="linenum"> 391</span></a>  <span class="comment">        // Match editingteacher to teacher (happens a lot, from 1.9)</span>
<a name="l392"><span class="linenum"> 392</span></a>          if (<a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it42915" onMouseOver="hilite(42915)" onMouseOut="lolite()" href="../../../_variables/shortname.html">shortname</a> == 'editingteacher' &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('teacher', <a class="var it38833" onMouseOver="hilite(38833)" onMouseOut="lolite()" onClick="logVariable('assignablerolesshortname')" href="../../../_variables/assignablerolesshortname.html">$assignablerolesshortname</a>)) {
<a name="l393"><span class="linenum"> 393</span></a>              return <a class="phpfunction" onClick="logFunction('array_search')" href="../../../_functions/array_search.html" onMouseOver="phpfuncPopup(event,'array_search')">array_search</a>('teacher', <a class="var it38833" onMouseOver="hilite(38833)" onMouseOut="lolite()" onClick="logVariable('assignablerolesshortname')" href="../../../_variables/assignablerolesshortname.html">$assignablerolesshortname</a>);
<a name="l394"><span class="linenum"> 394</span></a>          }
<a name="l395"><span class="linenum"> 395</span></a>  
<a name="l396"><span class="linenum"> 396</span></a>  <span class="comment">        // No match, return 0</span>
<a name="l397"><span class="linenum"> 397</span></a>          return 0;
<a name="l398"><span class="linenum"> 398</span></a>      }
<a name="l399"><span class="linenum"> 399</span></a>  
<a name="l400"><span class="linenum"> 400</span></a>  
<a name="l401"><span class="linenum"> 401</span></a>      <span class="comment">/**</span>
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">     * Process the loaded roles, looking for their best mapping or skipping</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment">     * Any error will cause exception. Note this is one wrapper over</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment">     * precheck_included_roles, that contains all the logic, but returns</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment">     * errors/warnings instead and is executed as part of the restore prechecks</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">     */</span>
<a name="l407"><span class="linenum"> 407</span></a>       public static function <a class="function" onClick="logFunction('process_included_roles')" href="../../../_functions/process_included_roles.html" onMouseOver="funcPopup(event,'process_included_roles')">process_included_roles</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('rolemappings')" href="../../../_variables/rolemappings.html">$rolemappings</a>) {
<a name="l408"><span class="linenum"> 408</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l409"><span class="linenum"> 409</span></a>  
<a name="l410"><span class="linenum"> 410</span></a>  <span class="comment">        // Just let precheck_included_roles() to do all the hard work</span>
<a name="l411"><span class="linenum"> 411</span></a>          <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a> = self::<a class="function" onClick="logFunction('precheck_included_roles')" href="../../../_functions/precheck_included_roles.html" onMouseOver="funcPopup(event,'precheck_included_roles')">precheck_included_roles</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('rolemappings')" href="../../../_variables/rolemappings.html">$rolemappings</a>);
<a name="l412"><span class="linenum"> 412</span></a>  
<a name="l413"><span class="linenum"> 413</span></a>  <span class="comment">        // With problems of type error, throw exception, shouldn't happen if prechecks executed</span>
<a name="l414"><span class="linenum"> 414</span></a>          if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('errors', <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>)) {
<a name="l415"><span class="linenum"> 415</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('restore_dbops_exception')" href="../../../_classes/restore_dbops_exception.html" onMouseOver="classPopup(event,'restore_dbops_exception')">restore_dbops_exception</a>('restore_problems_processing_roles', null, <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>['errors']));
<a name="l416"><span class="linenum"> 416</span></a>          }
<a name="l417"><span class="linenum"> 417</span></a>      }
<a name="l418"><span class="linenum"> 418</span></a>  
<a name="l419"><span class="linenum"> 419</span></a>      <span class="comment">/**</span>
<a name="l420"><span class="linenum"> 420</span></a>  <span class="comment">     * Load the needed users.xml file to backup_ids table for future reference</span>
<a name="l421"><span class="linenum"> 421</span></a>  <span class="comment">     *</span>
<a name="l422"><span class="linenum"> 422</span></a>  <span class="comment">     * @param string $restoreid Restore id</span>
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment">     * @param string $usersfile File path</span>
<a name="l424"><span class="linenum"> 424</span></a>  <span class="comment">     * @param \core\progress\base $progress Progress tracker</span>
<a name="l425"><span class="linenum"> 425</span></a>  <span class="comment">     */</span>
<a name="l426"><span class="linenum"> 426</span></a>      public static function <a class="function" onClick="logFunction('load_users_to_tempids')" href="../../../_functions/load_users_to_tempids.html" onMouseOver="funcPopup(event,'load_users_to_tempids')">load_users_to_tempids</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it36925" onMouseOver="hilite(36925)" onMouseOut="lolite()" onClick="logVariable('usersfile')" href="../../../_variables/usersfile.html">$usersfile</a>,
<a name="l427"><span class="linenum"> 427</span></a>              \core\progress\base <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a> = null) {
<a name="l428"><span class="linenum"> 428</span></a>  
<a name="l429"><span class="linenum"> 429</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it36925" onMouseOver="hilite(36925)" onMouseOut="lolite()" onClick="logVariable('usersfile')" href="../../../_variables/usersfile.html">$usersfile</a>)) { // Shouldn't happen ever, but...
<a name="l430"><span class="linenum"> 430</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_helper_exception')" href="../../../_classes/backup_helper_exception.html" onMouseOver="classPopup(event,'backup_helper_exception')">backup_helper_exception</a>('missing_users_xml_file', <a class="var it36925" onMouseOver="hilite(36925)" onMouseOut="lolite()" onClick="logVariable('usersfile')" href="../../../_variables/usersfile.html">$usersfile</a>);
<a name="l431"><span class="linenum"> 431</span></a>          }
<a name="l432"><span class="linenum"> 432</span></a>  
<a name="l433"><span class="linenum"> 433</span></a>  <span class="comment">        // Set up progress tracking (indeterminate).</span>
<a name="l434"><span class="linenum"> 434</span></a>          if (!<a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>) {
<a name="l435"><span class="linenum"> 435</span></a>              <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a> = new \core\progress\none();
<a name="l436"><span class="linenum"> 436</span></a>          }
<a name="l437"><span class="linenum"> 437</span></a>          <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>('Loading users into temporary table');
<a name="l438"><span class="linenum"> 438</span></a>  
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">        // Let's parse, custom processor will do its work, sending info to DB</span>
<a name="l440"><span class="linenum"> 440</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progressive_parser')" href="../../../_classes/progressive_parser.html" onMouseOver="classPopup(event,'progressive_parser')">progressive_parser</a>();
<a name="l441"><span class="linenum"> 441</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_file')" href="../../../_functions/set_file.html" onMouseOver="funcPopup(event,'set_file')">set_file</a>(<a class="var it36925" onMouseOver="hilite(36925)" onMouseOut="lolite()" onClick="logVariable('usersfile')" href="../../../_variables/usersfile.html">$usersfile</a>);
<a name="l442"><span class="linenum"> 442</span></a>          <a class="var it28121" onMouseOver="hilite(28121)" onMouseOut="lolite()" onClick="logVariable('xmlprocessor')" href="../../../_variables/xmlprocessor.html">$xmlprocessor</a> = <span class="keyword">new </span><a class="class" onClick="logClass('restore_users_parser_processor')" href="../../../_classes/restore_users_parser_processor.html" onMouseOver="classPopup(event,'restore_users_parser_processor')">restore_users_parser_processor</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>);
<a name="l443"><span class="linenum"> 443</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_processor')" href="../../../_functions/set_processor.html" onMouseOver="funcPopup(event,'set_processor')">set_processor</a>(<a class="var it28121" onMouseOver="hilite(28121)" onMouseOut="lolite()" onClick="logVariable('xmlprocessor')" href="../../../_variables/xmlprocessor.html">$xmlprocessor</a>);
<a name="l444"><span class="linenum"> 444</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_progress')" href="../../../_functions/set_progress.html" onMouseOver="funcPopup(event,'set_progress')">set_progress</a>(<a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>);
<a name="l445"><span class="linenum"> 445</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('process')" href="../../../_functions/process.html" onMouseOver="funcPopup(event,'process')">process</a>();
<a name="l446"><span class="linenum"> 446</span></a>  
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">        // Finish progress.</span>
<a name="l448"><span class="linenum"> 448</span></a>          <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l449"><span class="linenum"> 449</span></a>      }
<a name="l450"><span class="linenum"> 450</span></a>  
<a name="l451"><span class="linenum"> 451</span></a>      <span class="comment">/**</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">     * Load the needed questions.xml file to backup_ids table for future reference</span>
<a name="l453"><span class="linenum"> 453</span></a>  <span class="comment">     */</span>
<a name="l454"><span class="linenum"> 454</span></a>      public static function <a class="function" onClick="logFunction('load_categories_and_questions_to_tempids')" href="../../../_functions/load_categories_and_questions_to_tempids.html" onMouseOver="funcPopup(event,'load_categories_and_questions_to_tempids')">load_categories_and_questions_to_tempids</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it38834" onMouseOver="hilite(38834)" onMouseOut="lolite()" onClick="logVariable('questionsfile')" href="../../../_variables/questionsfile.html">$questionsfile</a>) {
<a name="l455"><span class="linenum"> 455</span></a>  
<a name="l456"><span class="linenum"> 456</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it38834" onMouseOver="hilite(38834)" onMouseOut="lolite()" onClick="logVariable('questionsfile')" href="../../../_variables/questionsfile.html">$questionsfile</a>)) { // Shouldn't happen ever, but...
<a name="l457"><span class="linenum"> 457</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_helper_exception')" href="../../../_classes/backup_helper_exception.html" onMouseOver="classPopup(event,'backup_helper_exception')">backup_helper_exception</a>('missing_questions_xml_file', <a class="var it38834" onMouseOver="hilite(38834)" onMouseOut="lolite()" onClick="logVariable('questionsfile')" href="../../../_variables/questionsfile.html">$questionsfile</a>);
<a name="l458"><span class="linenum"> 458</span></a>          }
<a name="l459"><span class="linenum"> 459</span></a>  <span class="comment">        // Let's parse, custom processor will do its work, sending info to DB</span>
<a name="l460"><span class="linenum"> 460</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progressive_parser')" href="../../../_classes/progressive_parser.html" onMouseOver="classPopup(event,'progressive_parser')">progressive_parser</a>();
<a name="l461"><span class="linenum"> 461</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_file')" href="../../../_functions/set_file.html" onMouseOver="funcPopup(event,'set_file')">set_file</a>(<a class="var it38834" onMouseOver="hilite(38834)" onMouseOut="lolite()" onClick="logVariable('questionsfile')" href="../../../_variables/questionsfile.html">$questionsfile</a>);
<a name="l462"><span class="linenum"> 462</span></a>          <a class="var it28121" onMouseOver="hilite(28121)" onMouseOut="lolite()" onClick="logVariable('xmlprocessor')" href="../../../_variables/xmlprocessor.html">$xmlprocessor</a> = <span class="keyword">new </span><a class="class" onClick="logClass('restore_questions_parser_processor')" href="../../../_classes/restore_questions_parser_processor.html" onMouseOver="classPopup(event,'restore_questions_parser_processor')">restore_questions_parser_processor</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>);
<a name="l463"><span class="linenum"> 463</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('set_processor')" href="../../../_functions/set_processor.html" onMouseOver="funcPopup(event,'set_processor')">set_processor</a>(<a class="var it28121" onMouseOver="hilite(28121)" onMouseOut="lolite()" onClick="logVariable('xmlprocessor')" href="../../../_variables/xmlprocessor.html">$xmlprocessor</a>);
<a name="l464"><span class="linenum"> 464</span></a>          <a class="var it28120" onMouseOver="hilite(28120)" onMouseOut="lolite()" onClick="logVariable('xmlparser')" href="../../../_variables/xmlparser.html">$xmlparser</a>-&gt;<a class="function" onClick="logFunction('process')" href="../../../_functions/process.html" onMouseOver="funcPopup(event,'process')">process</a>();
<a name="l465"><span class="linenum"> 465</span></a>      }
<a name="l466"><span class="linenum"> 466</span></a>  
<a name="l467"><span class="linenum"> 467</span></a>      <span class="comment">/**</span>
<a name="l468"><span class="linenum"> 468</span></a>  <span class="comment">     * Check all the included categories and questions, deciding the action to perform</span>
<a name="l469"><span class="linenum"> 469</span></a>  <span class="comment">     * for each one (mapping / creation) and returning one array of problems in case</span>
<a name="l470"><span class="linenum"> 470</span></a>  <span class="comment">     * something is wrong.</span>
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment">     *</span>
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment">     * There are some basic rules that the method below will always try to enforce:</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">     *</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment">     * Rule1: Targets will be, always, calculated for *whole* question banks (a.k.a. contexid source),</span>
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">     *     so, given 2 question categories belonging to the same bank, their target bank will be</span>
<a name="l476"><span class="linenum"> 476</span></a>  <span class="comment">     *     always the same. If not, we can be incurring into &quot;fragmentation&quot;, leading to random/cloze</span>
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">     *     problems (qtypes having &quot;child&quot; questions).</span>
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">     *</span>
<a name="l479"><span class="linenum"> 479</span></a>  <span class="comment">     * Rule2: The 'moodle/question:managecategory' and 'moodle/question:add' capabilities will be</span>
<a name="l480"><span class="linenum"> 480</span></a>  <span class="comment">     *     checked before creating any category/question respectively and, if the cap is not allowed</span>
<a name="l481"><span class="linenum"> 481</span></a>  <span class="comment">     *     into upper contexts (system, coursecat)) but in lower ones (course), the *whole* question bank</span>
<a name="l482"><span class="linenum"> 482</span></a>  <span class="comment">     *     will be created there.</span>
<a name="l483"><span class="linenum"> 483</span></a>  <span class="comment">     *</span>
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment">     * Rule3: Coursecat question banks not existing in the target site will be created as course</span>
<a name="l485"><span class="linenum"> 485</span></a>  <span class="comment">     *     (lower ctx) question banks, never as &quot;guessed&quot; coursecat question banks base on depth or so.</span>
<a name="l486"><span class="linenum"> 486</span></a>  <span class="comment">     *</span>
<a name="l487"><span class="linenum"> 487</span></a>  <span class="comment">     * Rule4: System question banks will be created at system context if user has perms to do so. Else they</span>
<a name="l488"><span class="linenum"> 488</span></a>  <span class="comment">     *     will created as course (lower ctx) question banks (similary to rule3). In other words, course ctx</span>
<a name="l489"><span class="linenum"> 489</span></a>  <span class="comment">     *     if always a fallback for system and coursecat question banks.</span>
<a name="l490"><span class="linenum"> 490</span></a>  <span class="comment">     *</span>
<a name="l491"><span class="linenum"> 491</span></a>  <span class="comment">     * Also, there are some notes to clarify the scope of this method:</span>
<a name="l492"><span class="linenum"> 492</span></a>  <span class="comment">     *</span>
<a name="l493"><span class="linenum"> 493</span></a>  <span class="comment">     * Note1: This method won't create any question category nor question at all. It simply will calculate</span>
<a name="l494"><span class="linenum"> 494</span></a>  <span class="comment">     *     which actions (create/map) must be performed for each element and where, validating that all those</span>
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment">     *     actions are doable by the user executing the restore operation. Any problem found will be</span>
<a name="l496"><span class="linenum"> 496</span></a>  <span class="comment">     *     returned in the problems array, causing the restore process to stop with error.</span>
<a name="l497"><span class="linenum"> 497</span></a>  <span class="comment">     *</span>
<a name="l498"><span class="linenum"> 498</span></a>  <span class="comment">     * Note2: To decide if one question bank (all its question categories and questions) is going to be remapped,</span>
<a name="l499"><span class="linenum"> 499</span></a>  <span class="comment">     *     then all the categories and questions must exist in the same target bank. If able to do so, missing</span>
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">     *     qcats and qs will be created (rule2). But if, at the end, something is missing, the whole question bank</span>
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment">     *     will be recreated at course ctx (rule1), no matter if that duplicates some categories/questions.</span>
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment">     *</span>
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment">     * Note3: We'll be using the newitemid column in the temp_ids table to store the action to be performed</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">     *     with each question category and question. newitemid = 0 means the qcat/q needs to be created and</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment">     *     any other value means the qcat/q is mapped. Also, for qcats, parentitemid will contain the target</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment">     *     context where the categories have to be created (but for module contexts where we'll keep the old</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment">     *     one until the activity is created)</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment">     *</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment">     * Note4: All these &quot;actions&quot; will be &quot;executed&quot; later by {@link restore_create_categories_and_questions}</span>
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment">     */</span>
<a name="l511"><span class="linenum"> 511</span></a>      public static function <a class="function" onClick="logFunction('precheck_categories_and_questions')" href="../../../_functions/precheck_categories_and_questions.html" onMouseOver="funcPopup(event,'precheck_categories_and_questions')">precheck_categories_and_questions</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>) {
<a name="l512"><span class="linenum"> 512</span></a>  
<a name="l513"><span class="linenum"> 513</span></a>          <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a> = array();
<a name="l514"><span class="linenum"> 514</span></a>  
<a name="l515"><span class="linenum"> 515</span></a>  <span class="comment">        // TODO: Check all qs, looking their qtypes are restorable</span>
<a name="l516"><span class="linenum"> 516</span></a>  
<a name="l517"><span class="linenum"> 517</span></a>  <span class="comment">        // Precheck all qcats and qs looking for target contexts / warnings / errors</span>
<a name="l518"><span class="linenum"> 518</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it38835" onMouseOver="hilite(38835)" onMouseOut="lolite()" onClick="logVariable('syserr')" href="../../../_variables/syserr.html">$syserr</a>, <a class="var it38836" onMouseOver="hilite(38836)" onMouseOut="lolite()" onClick="logVariable('syswarn')" href="../../../_variables/syswarn.html">$syswarn</a>) = self::<a class="function" onClick="logFunction('prechek_precheck_qbanks_by_level')" href="../../../_functions/prechek_precheck_qbanks_by_level.html" onMouseOver="funcPopup(event,'prechek_precheck_qbanks_by_level')">prechek_precheck_qbanks_by_level</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../../../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>);
<a name="l519"><span class="linenum"> 519</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it38837" onMouseOver="hilite(38837)" onMouseOut="lolite()" onClick="logVariable('caterr')" href="../../../_variables/caterr.html">$caterr</a>, <a class="var it38838" onMouseOver="hilite(38838)" onMouseOut="lolite()" onClick="logVariable('catwarn')" href="../../../_variables/catwarn.html">$catwarn</a>) = self::<a class="function" onClick="logFunction('prechek_precheck_qbanks_by_level')" href="../../../_functions/prechek_precheck_qbanks_by_level.html" onMouseOver="funcPopup(event,'prechek_precheck_qbanks_by_level')">prechek_precheck_qbanks_by_level</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../../../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>);
<a name="l520"><span class="linenum"> 520</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it38839" onMouseOver="hilite(38839)" onMouseOut="lolite()" onClick="logVariable('couerr')" href="../../../_variables/couerr.html">$couerr</a>, <a class="var it38840" onMouseOver="hilite(38840)" onMouseOut="lolite()" onClick="logVariable('couwarn')" href="../../../_variables/couwarn.html">$couwarn</a>) = self::<a class="function" onClick="logFunction('prechek_precheck_qbanks_by_level')" href="../../../_functions/prechek_precheck_qbanks_by_level.html" onMouseOver="funcPopup(event,'prechek_precheck_qbanks_by_level')">prechek_precheck_qbanks_by_level</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>);
<a name="l521"><span class="linenum"> 521</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it38841" onMouseOver="hilite(38841)" onMouseOut="lolite()" onClick="logVariable('moderr')" href="../../../_variables/moderr.html">$moderr</a>, <a class="var it38842" onMouseOver="hilite(38842)" onMouseOut="lolite()" onClick="logVariable('modwarn')" href="../../../_variables/modwarn.html">$modwarn</a>) = self::<a class="function" onClick="logFunction('prechek_precheck_qbanks_by_level')" href="../../../_functions/prechek_precheck_qbanks_by_level.html" onMouseOver="funcPopup(event,'prechek_precheck_qbanks_by_level')">prechek_precheck_qbanks_by_level</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>);
<a name="l522"><span class="linenum"> 522</span></a>  
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">        // Acummulate and handle errors and warnings</span>
<a name="l524"><span class="linenum"> 524</span></a>          <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>   = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it38835" onMouseOver="hilite(38835)" onMouseOut="lolite()" onClick="logVariable('syserr')" href="../../../_variables/syserr.html">$syserr</a>, <a class="var it38837" onMouseOver="hilite(38837)" onMouseOut="lolite()" onClick="logVariable('caterr')" href="../../../_variables/caterr.html">$caterr</a>, <a class="var it38839" onMouseOver="hilite(38839)" onMouseOut="lolite()" onClick="logVariable('couerr')" href="../../../_variables/couerr.html">$couerr</a>, <a class="var it38841" onMouseOver="hilite(38841)" onMouseOut="lolite()" onClick="logVariable('moderr')" href="../../../_variables/moderr.html">$moderr</a>);
<a name="l525"><span class="linenum"> 525</span></a>          <a class="var it3500" onMouseOver="hilite(3500)" onMouseOut="lolite()" onClick="logVariable('warnings')" href="../../../_variables/warnings.html">$warnings</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it38836" onMouseOver="hilite(38836)" onMouseOut="lolite()" onClick="logVariable('syswarn')" href="../../../_variables/syswarn.html">$syswarn</a>, <a class="var it38838" onMouseOver="hilite(38838)" onMouseOut="lolite()" onClick="logVariable('catwarn')" href="../../../_variables/catwarn.html">$catwarn</a>, <a class="var it38840" onMouseOver="hilite(38840)" onMouseOut="lolite()" onClick="logVariable('couwarn')" href="../../../_variables/couwarn.html">$couwarn</a>, <a class="var it38842" onMouseOver="hilite(38842)" onMouseOut="lolite()" onClick="logVariable('modwarn')" href="../../../_variables/modwarn.html">$modwarn</a>);
<a name="l526"><span class="linenum"> 526</span></a>          if (!empty(<a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>)) {
<a name="l527"><span class="linenum"> 527</span></a>              <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>['errors'] = <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>;
<a name="l528"><span class="linenum"> 528</span></a>          }
<a name="l529"><span class="linenum"> 529</span></a>          if (!empty(<a class="var it3500" onMouseOver="hilite(3500)" onMouseOut="lolite()" onClick="logVariable('warnings')" href="../../../_variables/warnings.html">$warnings</a>)) {
<a name="l530"><span class="linenum"> 530</span></a>              <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>['warnings'] = <a class="var it3500" onMouseOver="hilite(3500)" onMouseOut="lolite()" onClick="logVariable('warnings')" href="../../../_variables/warnings.html">$warnings</a>;
<a name="l531"><span class="linenum"> 531</span></a>          }
<a name="l532"><span class="linenum"> 532</span></a>          return <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>;
<a name="l533"><span class="linenum"> 533</span></a>      }
<a name="l534"><span class="linenum"> 534</span></a>  
<a name="l535"><span class="linenum"> 535</span></a>      <span class="comment">/**</span>
<a name="l536"><span class="linenum"> 536</span></a>  <span class="comment">     * This function will process all the question banks present in restore</span>
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment">     * at some contextlevel (from CONTEXT_SYSTEM to CONTEXT_MODULE), finding</span>
<a name="l538"><span class="linenum"> 538</span></a>  <span class="comment">     * the target contexts where each bank will be restored and returning</span>
<a name="l539"><span class="linenum"> 539</span></a>  <span class="comment">     * warnings/errors as needed.</span>
<a name="l540"><span class="linenum"> 540</span></a>  <span class="comment">     *</span>
<a name="l541"><span class="linenum"> 541</span></a>  <span class="comment">     * Some contextlevels (system, coursecat), will delegate process to</span>
<a name="l542"><span class="linenum"> 542</span></a>  <span class="comment">     * course level if any problem is found (lack of permissions, non-matching</span>
<a name="l543"><span class="linenum"> 543</span></a>  <span class="comment">     * target context...). Other contextlevels (course, module) will</span>
<a name="l544"><span class="linenum"> 544</span></a>  <span class="comment">     * cause return error if some problem is found.</span>
<a name="l545"><span class="linenum"> 545</span></a>  <span class="comment">     *</span>
<a name="l546"><span class="linenum"> 546</span></a>  <span class="comment">     * At the end, if no errors were found, all the categories in backup_temp_ids</span>
<a name="l547"><span class="linenum"> 547</span></a>  <span class="comment">     * will be pointing (parentitemid) to the target context where they must be</span>
<a name="l548"><span class="linenum"> 548</span></a>  <span class="comment">     * created later in the restore process.</span>
<a name="l549"><span class="linenum"> 549</span></a>  <span class="comment">     *</span>
<a name="l550"><span class="linenum"> 550</span></a>  <span class="comment">     * Note: at the time these prechecks are executed, activities haven't been</span>
<a name="l551"><span class="linenum"> 551</span></a>  <span class="comment">     * created yet so, for CONTEXT_MODULE banks, we keep the old contextid</span>
<a name="l552"><span class="linenum"> 552</span></a>  <span class="comment">     * in the parentitemid field. Once the activity (and its context) has been</span>
<a name="l553"><span class="linenum"> 553</span></a>  <span class="comment">     * created, we'll update that context in the required qcats</span>
<a name="l554"><span class="linenum"> 554</span></a>  <span class="comment">     *</span>
<a name="l555"><span class="linenum"> 555</span></a>  <span class="comment">     * Caller {@link precheck_categories_and_questions} will, simply, execute</span>
<a name="l556"><span class="linenum"> 556</span></a>  <span class="comment">     * this function for all the contextlevels, acting as a simple controller</span>
<a name="l557"><span class="linenum"> 557</span></a>  <span class="comment">     * of warnings and errors.</span>
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment">     *</span>
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">     * The function returns 2 arrays, one containing errors and another containing</span>
<a name="l560"><span class="linenum"> 560</span></a>  <span class="comment">     * warnings. Both empty if no errors/warnings are found.</span>
<a name="l561"><span class="linenum"> 561</span></a>  <span class="comment">     */</span>
<a name="l562"><span class="linenum"> 562</span></a>      public static function <a class="function" onClick="logFunction('prechek_precheck_qbanks_by_level')" href="../../../_functions/prechek_precheck_qbanks_by_level.html" onMouseOver="funcPopup(event,'prechek_precheck_qbanks_by_level')">prechek_precheck_qbanks_by_level</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l563"><span class="linenum"> 563</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l564"><span class="linenum"> 564</span></a>  
<a name="l565"><span class="linenum"> 565</span></a>  <span class="comment">        // To return any errors and warnings found</span>
<a name="l566"><span class="linenum"> 566</span></a>          <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>   = array();
<a name="l567"><span class="linenum"> 567</span></a>          <a class="var it3500" onMouseOver="hilite(3500)" onMouseOut="lolite()" onClick="logVariable('warnings')" href="../../../_variables/warnings.html">$warnings</a> = array();
<a name="l568"><span class="linenum"> 568</span></a>  
<a name="l569"><span class="linenum"> 569</span></a>  <span class="comment">        // Specify which fallbacks must be performed</span>
<a name="l570"><span class="linenum"> 570</span></a>          <a class="var it38843" onMouseOver="hilite(38843)" onMouseOut="lolite()" onClick="logVariable('fallbacks')" href="../../../_variables/fallbacks.html">$fallbacks</a> = array(
<a name="l571"><span class="linenum"> 571</span></a>              <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../../../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a> =&gt; <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>,
<a name="l572"><span class="linenum"> 572</span></a>              <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../../../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a> =&gt; <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>);
<a name="l573"><span class="linenum"> 573</span></a>  
<a name="l574"><span class="linenum"> 574</span></a>  <span class="comment">        // For any contextlevel, follow this process logic:</span>
<a name="l575"><span class="linenum"> 575</span></a>  <span class="comment">        //</span>
<a name="l576"><span class="linenum"> 576</span></a>  <span class="comment">        // 0) Iterate over each context (qbank)</span>
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment">        // 1) Iterate over each qcat in the context, matching by stamp for the found target context</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment">        //     2a) No match, check if user can create qcat and q</span>
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment">        //         3a) User can, mark the qcat and all dependent qs to be created in that target context</span>
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment">        //         3b) User cannot, check if we are in some contextlevel with fallback</span>
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment">        //             4a) There is fallback, move ALL the qcats to fallback, warn. End qcat loop</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment">        //             4b) No fallback, error. End qcat loop.</span>
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment">        //     2b) Match, mark qcat to be mapped and iterate over each q, matching by stamp and version</span>
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment">        //         5a) No match, check if user can add q</span>
<a name="l585"><span class="linenum"> 585</span></a>  <span class="comment">        //             6a) User can, mark the q to be created</span>
<a name="l586"><span class="linenum"> 586</span></a>  <span class="comment">        //             6b) User cannot, check if we are in some contextlevel with fallback</span>
<a name="l587"><span class="linenum"> 587</span></a>  <span class="comment">        //                 7a) There is fallback, move ALL the qcats to fallback, warn. End qcat loop</span>
<a name="l588"><span class="linenum"> 588</span></a>  <span class="comment">        //                 7b) No fallback, error. End qcat loop</span>
<a name="l589"><span class="linenum"> 589</span></a>  <span class="comment">        //         5b) Match, mark q to be mapped</span>
<a name="l590"><span class="linenum"> 590</span></a>  
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment">        // Get all the contexts (question banks) in restore for the given contextlevel</span>
<a name="l592"><span class="linenum"> 592</span></a>          <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../../_variables/contexts.html">$contexts</a> = self::<a class="function" onClick="logFunction('restore_get_question_banks')" href="../../../_functions/restore_get_question_banks.html" onMouseOver="funcPopup(event,'restore_get_question_banks')">restore_get_question_banks</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>);
<a name="l593"><span class="linenum"> 593</span></a>  
<a name="l594"><span class="linenum"> 594</span></a>  <span class="comment">        // 0) Iterate over each context (qbank)</span>
<a name="l595"><span class="linenum"> 595</span></a>          foreach (<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../../_variables/contexts.html">$contexts</a> as <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a> =&gt; <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment">            // Init some perms</span>
<a name="l597"><span class="linenum"> 597</span></a>              <a class="var it38844" onMouseOver="hilite(38844)" onMouseOut="lolite()" onClick="logVariable('canmanagecategory')" href="../../../_variables/canmanagecategory.html">$canmanagecategory</a> = false;
<a name="l598"><span class="linenum"> 598</span></a>              <a class="var it29564" onMouseOver="hilite(29564)" onMouseOut="lolite()" onClick="logVariable('canadd')" href="../../../_variables/canadd.html">$canadd</a>            = false;
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment">            // get categories in context (bank)</span>
<a name="l600"><span class="linenum"> 600</span></a>              <a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../../_variables/categories.html">$categories</a> = self::<a class="function" onClick="logFunction('restore_get_question_categories')" href="../../../_functions/restore_get_question_categories.html" onMouseOver="funcPopup(event,'restore_get_question_categories')">restore_get_question_categories</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>);
<a name="l601"><span class="linenum"> 601</span></a>  <span class="comment">            // cache permissions if $targetcontext is found</span>
<a name="l602"><span class="linenum"> 602</span></a>              if (<a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a> = self::<a class="function" onClick="logFunction('restore_find_best_target_context')" href="../../../_functions/restore_find_best_target_context.html" onMouseOver="funcPopup(event,'restore_find_best_target_context')">restore_find_best_target_context</a>(<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../../_variables/categories.html">$categories</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>)) {
<a name="l603"><span class="linenum"> 603</span></a>                  <a class="var it38844" onMouseOver="hilite(38844)" onMouseOut="lolite()" onClick="logVariable('canmanagecategory')" href="../../../_variables/canmanagecategory.html">$canmanagecategory</a> = <a class="function" onClick="logFunction('has_capability')" href="../../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/question:managecategory', <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>);
<a name="l604"><span class="linenum"> 604</span></a>                  <a class="var it29564" onMouseOver="hilite(29564)" onMouseOut="lolite()" onClick="logVariable('canadd')" href="../../../_variables/canadd.html">$canadd</a>            = <a class="function" onClick="logFunction('has_capability')" href="../../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/question:add', <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>);
<a name="l605"><span class="linenum"> 605</span></a>              }
<a name="l606"><span class="linenum"> 606</span></a>  <span class="comment">            // 1) Iterate over each qcat in the context, matching by stamp for the found target context</span>
<a name="l607"><span class="linenum"> 607</span></a>              foreach (<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../../_variables/categories.html">$categories</a> as <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>) {
<a name="l608"><span class="linenum"> 608</span></a>                  <a class="var it38846" onMouseOver="hilite(38846)" onMouseOut="lolite()" onClick="logVariable('matchcat')" href="../../../_variables/matchcat.html">$matchcat</a> = false;
<a name="l609"><span class="linenum"> 609</span></a>                  if (<a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a>) {
<a name="l610"><span class="linenum"> 610</span></a>                      <a class="var it38846" onMouseOver="hilite(38846)" onMouseOut="lolite()" onClick="logVariable('matchcat')" href="../../../_variables/matchcat.html">$matchcat</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('question_categories', array(
<a name="l611"><span class="linenum"> 611</span></a>                                      'contextid' =&gt; <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a>-&gt;<a onClick="logVariable('id')" class="var it45167" onMouseOver="hilite(45167)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l612"><span class="linenum"> 612</span></a>                                      'stamp' =&gt; <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('stamp')" class="var it42970" onMouseOver="hilite(42970)" onMouseOut="lolite()" href="../../../_variables/stamp.html">stamp</a>));
<a name="l613"><span class="linenum"> 613</span></a>                  }
<a name="l614"><span class="linenum"> 614</span></a>  <span class="comment">                // 2a) No match, check if user can create qcat and q</span>
<a name="l615"><span class="linenum"> 615</span></a>                  if (!<a class="var it38846" onMouseOver="hilite(38846)" onMouseOut="lolite()" onClick="logVariable('matchcat')" href="../../../_variables/matchcat.html">$matchcat</a>) {
<a name="l616"><span class="linenum"> 616</span></a>  <span class="comment">                    // 3a) User can, mark the qcat and all dependent qs to be created in that target context</span>
<a name="l617"><span class="linenum"> 617</span></a>                      if (<a class="var it38844" onMouseOver="hilite(38844)" onMouseOut="lolite()" onClick="logVariable('canmanagecategory')" href="../../../_variables/canmanagecategory.html">$canmanagecategory</a> &amp;&amp; <a class="var it29564" onMouseOver="hilite(29564)" onMouseOut="lolite()" onClick="logVariable('canadd')" href="../../../_variables/canadd.html">$canadd</a>) {
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment">                        // Set parentitemid to targetcontext, BUT for CONTEXT_MODULE categories, where</span>
<a name="l619"><span class="linenum"> 619</span></a>  <span class="comment">                        // we keep the source contextid unmodified (for easier matching later when the</span>
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment">                        // activities are created)</span>
<a name="l621"><span class="linenum"> 621</span></a>                          <a class="var it12860" onMouseOver="hilite(12860)" onMouseOut="lolite()" onClick="logVariable('parentitemid')" href="../../../_variables/parentitemid.html">$parentitemid</a> = <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a>-&gt;<a onClick="logVariable('id')" class="var it45167" onMouseOver="hilite(45167)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l622"><span class="linenum"> 622</span></a>                          if (<a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l623"><span class="linenum"> 623</span></a>                              <a class="var it12860" onMouseOver="hilite(12860)" onMouseOut="lolite()" onClick="logVariable('parentitemid')" href="../../../_variables/parentitemid.html">$parentitemid</a> = null; <span class="comment">// null means &quot;not modify&quot; a.k.a. leave original contextid</span>
<a name="l624"><span class="linenum"> 624</span></a>                          }
<a name="l625"><span class="linenum"> 625</span></a>                          self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'question_category', <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('id')" class="var it42970" onMouseOver="hilite(42970)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 0, <a class="var it12860" onMouseOver="hilite(12860)" onMouseOut="lolite()" onClick="logVariable('parentitemid')" href="../../../_variables/parentitemid.html">$parentitemid</a>);
<a name="l626"><span class="linenum"> 626</span></a>  <span class="comment">                        // Nothing else to mark, newitemid = 0 means create</span>
<a name="l627"><span class="linenum"> 627</span></a>  
<a name="l628"><span class="linenum"> 628</span></a>  <span class="comment">                    // 3b) User cannot, check if we are in some contextlevel with fallback</span>
<a name="l629"><span class="linenum"> 629</span></a>                      } else {
<a name="l630"><span class="linenum"> 630</span></a>  <span class="comment">                        // 4a) There is fallback, move ALL the qcats to fallback, warn. End qcat loop</span>
<a name="l631"><span class="linenum"> 631</span></a>                          if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>, <a class="var it38843" onMouseOver="hilite(38843)" onMouseOut="lolite()" onClick="logVariable('fallbacks')" href="../../../_variables/fallbacks.html">$fallbacks</a>)) {
<a name="l632"><span class="linenum"> 632</span></a>                              foreach (<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../../_variables/categories.html">$categories</a> as <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>) {
<a name="l633"><span class="linenum"> 633</span></a>                                  <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it45168" onMouseOver="hilite(45168)" onMouseOut="lolite()" href="../../../_variables/contextlevel.html">contextlevel</a> = <a class="var it38843" onMouseOver="hilite(38843)" onMouseOut="lolite()" onClick="logVariable('fallbacks')" href="../../../_variables/fallbacks.html">$fallbacks</a>[<a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>];
<a name="l634"><span class="linenum"> 634</span></a>                                  self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'question_category', <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>-&gt;<a onClick="logVariable('id')" class="var it45168" onMouseOver="hilite(45168)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 0, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>, <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>);
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment">                                // Warn about the performed fallback</span>
<a name="l636"><span class="linenum"> 636</span></a>                                  <a class="var it3500" onMouseOver="hilite(3500)" onMouseOut="lolite()" onClick="logVariable('warnings')" href="../../../_variables/warnings.html">$warnings</a>[] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('qcategory2coursefallback', 'backup', <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>);
<a name="l637"><span class="linenum"> 637</span></a>                              }
<a name="l638"><span class="linenum"> 638</span></a>  
<a name="l639"><span class="linenum"> 639</span></a>  <span class="comment">                        // 4b) No fallback, error. End qcat loop.</span>
<a name="l640"><span class="linenum"> 640</span></a>                          } else {
<a name="l641"><span class="linenum"> 641</span></a>                              <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>[] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('qcategorycannotberestored', 'backup', <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>);
<a name="l642"><span class="linenum"> 642</span></a>                          }
<a name="l643"><span class="linenum"> 643</span></a>                          break; <span class="comment">// out from qcat loop (both 4a and 4b), we have decided about ALL categories in context (bank)</span>
<a name="l644"><span class="linenum"> 644</span></a>                      }
<a name="l645"><span class="linenum"> 645</span></a>  
<a name="l646"><span class="linenum"> 646</span></a>  <span class="comment">                // 2b) Match, mark qcat to be mapped and iterate over each q, matching by stamp and version</span>
<a name="l647"><span class="linenum"> 647</span></a>                  } else {
<a name="l648"><span class="linenum"> 648</span></a>                      self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'question_category', <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('id')" class="var it42970" onMouseOver="hilite(42970)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it38846" onMouseOver="hilite(38846)" onMouseOut="lolite()" onClick="logVariable('matchcat')" href="../../../_variables/matchcat.html">$matchcat</a>-&gt;<a onClick="logVariable('id')" class="var it45169" onMouseOver="hilite(45169)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a>-&gt;<a onClick="logVariable('id')" class="var it45167" onMouseOver="hilite(45167)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l649"><span class="linenum"> 649</span></a>                      <a class="var it256" onMouseOver="hilite(256)" onMouseOut="lolite()" onClick="logVariable('questions')" href="../../../_variables/questions.html">$questions</a> = self::<a class="function" onClick="logFunction('restore_get_questions')" href="../../../_functions/restore_get_questions.html" onMouseOver="funcPopup(event,'restore_get_questions')">restore_get_questions</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('id')" class="var it42970" onMouseOver="hilite(42970)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l650"><span class="linenum"> 650</span></a>  
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">                    // Collect all the questions for this category into memory so we only talk to the DB once.</span>
<a name="l652"><span class="linenum"> 652</span></a>                      <a class="var it38848" onMouseOver="hilite(38848)" onMouseOut="lolite()" onClick="logVariable('questioncache')" href="../../../_variables/questioncache.html">$questioncache</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql_menu')" href="../../../_functions/get_records_sql_menu.html" onMouseOver="funcPopup(event,'get_records_sql_menu')">get_records_sql_menu</a>(&quot;SELECT &quot;.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../../../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('stamp', &quot;' '&quot;, 'version').&quot;, id
<a name="l653"><span class="linenum"> 653</span></a>                                                                    FROM {question}
<a name="l654"><span class="linenum"> 654</span></a>                                                                   WHERE category = ?&quot;, array(<a class="var it38846" onMouseOver="hilite(38846)" onMouseOut="lolite()" onClick="logVariable('matchcat')" href="../../../_variables/matchcat.html">$matchcat</a>-&gt;<a onClick="logVariable('id')" class="var it45169" onMouseOver="hilite(45169)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l655"><span class="linenum"> 655</span></a>  
<a name="l656"><span class="linenum"> 656</span></a>                      foreach (<a class="var it256" onMouseOver="hilite(256)" onMouseOut="lolite()" onClick="logVariable('questions')" href="../../../_variables/questions.html">$questions</a> as <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>) {
<a name="l657"><span class="linenum"> 657</span></a>                          if (isset(<a class="var it38848" onMouseOver="hilite(38848)" onMouseOut="lolite()" onClick="logVariable('questioncache')" href="../../../_variables/questioncache.html">$questioncache</a>[<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('stamp')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/stamp.html">stamp</a>.&quot; &quot;.<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('version')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/version.html">version</a>])) {
<a name="l658"><span class="linenum"> 658</span></a>                              <a class="var it38849" onMouseOver="hilite(38849)" onMouseOut="lolite()" onClick="logVariable('matchqid')" href="../../../_variables/matchqid.html">$matchqid</a> = <a class="var it38848" onMouseOver="hilite(38848)" onMouseOut="lolite()" onClick="logVariable('questioncache')" href="../../../_variables/questioncache.html">$questioncache</a>[<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('stamp')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/stamp.html">stamp</a>.&quot; &quot;.<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('version')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/version.html">version</a>];
<a name="l659"><span class="linenum"> 659</span></a>                          } else {
<a name="l660"><span class="linenum"> 660</span></a>                              <a class="var it38849" onMouseOver="hilite(38849)" onMouseOut="lolite()" onClick="logVariable('matchqid')" href="../../../_variables/matchqid.html">$matchqid</a> = false;
<a name="l661"><span class="linenum"> 661</span></a>                          }
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment">                        // 5a) No match, check if user can add q</span>
<a name="l663"><span class="linenum"> 663</span></a>                          if (!<a class="var it38849" onMouseOver="hilite(38849)" onMouseOut="lolite()" onClick="logVariable('matchqid')" href="../../../_variables/matchqid.html">$matchqid</a>) {
<a name="l664"><span class="linenum"> 664</span></a>  <span class="comment">                            // 6a) User can, mark the q to be created</span>
<a name="l665"><span class="linenum"> 665</span></a>                              if (<a class="var it29564" onMouseOver="hilite(29564)" onMouseOut="lolite()" onClick="logVariable('canadd')" href="../../../_variables/canadd.html">$canadd</a>) {
<a name="l666"><span class="linenum"> 666</span></a>  <span class="comment">                                // Nothing to mark, newitemid means create</span>
<a name="l667"><span class="linenum"> 667</span></a>  
<a name="l668"><span class="linenum"> 668</span></a>  <span class="comment">                             // 6b) User cannot, check if we are in some contextlevel with fallback</span>
<a name="l669"><span class="linenum"> 669</span></a>                              } else {
<a name="l670"><span class="linenum"> 670</span></a>  <span class="comment">                                // 7a) There is fallback, move ALL the qcats to fallback, warn. End qcat loo</span>
<a name="l671"><span class="linenum"> 671</span></a>                                  if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>, <a class="var it38843" onMouseOver="hilite(38843)" onMouseOut="lolite()" onClick="logVariable('fallbacks')" href="../../../_variables/fallbacks.html">$fallbacks</a>)) {
<a name="l672"><span class="linenum"> 672</span></a>                                      foreach (<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../../_variables/categories.html">$categories</a> as <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>) {
<a name="l673"><span class="linenum"> 673</span></a>                                          <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it45168" onMouseOver="hilite(45168)" onMouseOut="lolite()" href="../../../_variables/contextlevel.html">contextlevel</a> = <a class="var it38843" onMouseOver="hilite(38843)" onMouseOut="lolite()" onClick="logVariable('fallbacks')" href="../../../_variables/fallbacks.html">$fallbacks</a>[<a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>];
<a name="l674"><span class="linenum"> 674</span></a>                                          self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'question_category', <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>-&gt;<a onClick="logVariable('id')" class="var it45168" onMouseOver="hilite(45168)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 0, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>, <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>);
<a name="l675"><span class="linenum"> 675</span></a>  <span class="comment">                                        // Warn about the performed fallback</span>
<a name="l676"><span class="linenum"> 676</span></a>                                          <a class="var it3500" onMouseOver="hilite(3500)" onMouseOut="lolite()" onClick="logVariable('warnings')" href="../../../_variables/warnings.html">$warnings</a>[] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('question2coursefallback', 'backup', <a class="var it38847" onMouseOver="hilite(38847)" onMouseOut="lolite()" onClick="logVariable('movedcat')" href="../../../_variables/movedcat.html">$movedcat</a>);
<a name="l677"><span class="linenum"> 677</span></a>                                      }
<a name="l678"><span class="linenum"> 678</span></a>  
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment">                                // 7b) No fallback, error. End qcat loop</span>
<a name="l680"><span class="linenum"> 680</span></a>                                  } else {
<a name="l681"><span class="linenum"> 681</span></a>                                      <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>[] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('questioncannotberestored', 'backup', <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l682"><span class="linenum"> 682</span></a>                                  }
<a name="l683"><span class="linenum"> 683</span></a>                                  break 2; <span class="comment">// out from qcat loop (both 7a and 7b), we have decided about ALL categories in context (bank)</span>
<a name="l684"><span class="linenum"> 684</span></a>                              }
<a name="l685"><span class="linenum"> 685</span></a>  
<a name="l686"><span class="linenum"> 686</span></a>  <span class="comment">                        // 5b) Match, mark q to be mapped</span>
<a name="l687"><span class="linenum"> 687</span></a>                          } else {
<a name="l688"><span class="linenum"> 688</span></a>                              self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'question', <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it38849" onMouseOver="hilite(38849)" onMouseOut="lolite()" onClick="logVariable('matchqid')" href="../../../_variables/matchqid.html">$matchqid</a>);
<a name="l689"><span class="linenum"> 689</span></a>                          }
<a name="l690"><span class="linenum"> 690</span></a>                      }
<a name="l691"><span class="linenum"> 691</span></a>                  }
<a name="l692"><span class="linenum"> 692</span></a>              }
<a name="l693"><span class="linenum"> 693</span></a>          }
<a name="l694"><span class="linenum"> 694</span></a>  
<a name="l695"><span class="linenum"> 695</span></a>          return array(<a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>, <a class="var it3500" onMouseOver="hilite(3500)" onMouseOut="lolite()" onClick="logVariable('warnings')" href="../../../_variables/warnings.html">$warnings</a>);
<a name="l696"><span class="linenum"> 696</span></a>      }
<a name="l697"><span class="linenum"> 697</span></a>  
<a name="l698"><span class="linenum"> 698</span></a>      <span class="comment">/**</span>
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment">     * Return one array of contextid =&gt; contextlevel pairs</span>
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment">     * of question banks to be checked for one given restore operation</span>
<a name="l701"><span class="linenum"> 701</span></a>  <span class="comment">     * ordered from CONTEXT_SYSTEM downto CONTEXT_MODULE</span>
<a name="l702"><span class="linenum"> 702</span></a>  <span class="comment">     * If contextlevel is specified, then only banks corresponding to</span>
<a name="l703"><span class="linenum"> 703</span></a>  <span class="comment">     * that level are returned</span>
<a name="l704"><span class="linenum"> 704</span></a>  <span class="comment">     */</span>
<a name="l705"><span class="linenum"> 705</span></a>      public static function <a class="function" onClick="logFunction('restore_get_question_banks')" href="../../../_functions/restore_get_question_banks.html" onMouseOver="funcPopup(event,'restore_get_question_banks')">restore_get_question_banks</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a> = null) {
<a name="l706"><span class="linenum"> 706</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l707"><span class="linenum"> 707</span></a>  
<a name="l708"><span class="linenum"> 708</span></a>          <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a> = array();
<a name="l709"><span class="linenum"> 709</span></a>          <a class="var it15463" onMouseOver="hilite(15463)" onMouseOut="lolite()" onClick="logVariable('qcats')" href="../../../_variables/qcats.html">$qcats</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(&quot;SELECT itemid, parentitemid AS contextid, info
<a name="l710"><span class="linenum"> 710</span></a>                                           FROM {backup_ids_temp}
<a name="l711"><span class="linenum"> 711</span></a>                                         WHERE backupid = ?
<a name="l712"><span class="linenum"> 712</span></a>                                           AND itemname = 'question_category'&quot;, array(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>));
<a name="l713"><span class="linenum"> 713</span></a>          foreach (<a class="var it15463" onMouseOver="hilite(15463)" onMouseOut="lolite()" onClick="logVariable('qcats')" href="../../../_variables/qcats.html">$qcats</a> as <a class="var it7673" onMouseOver="hilite(7673)" onMouseOut="lolite()" onClick="logVariable('qcat')" href="../../../_variables/qcat.html">$qcat</a>) {
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment">            // If this qcat context haven't been acummulated yet, do that</span>
<a name="l715"><span class="linenum"> 715</span></a>              if (!isset(<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>[<a class="var it7673" onMouseOver="hilite(7673)" onMouseOut="lolite()" onClick="logVariable('qcat')" href="../../../_variables/qcat.html">$qcat</a>-&gt;<a onClick="logVariable('contextid')" class="var it43911" onMouseOver="hilite(43911)" onMouseOut="lolite()" href="../../../_variables/contextid.html">contextid</a>])) {
<a name="l716"><span class="linenum"> 716</span></a>                  <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a> = backup_controller_dbops::<a class="function" onClick="logFunction('decode_backup_temp_info')" href="../../../_functions/decode_backup_temp_info.html" onMouseOver="funcPopup(event,'decode_backup_temp_info')">decode_backup_temp_info</a>(<a class="var it7673" onMouseOver="hilite(7673)" onMouseOut="lolite()" onClick="logVariable('qcat')" href="../../../_variables/qcat.html">$qcat</a>-&gt;<a onClick="logVariable('info')" class="var it43911" onMouseOver="hilite(43911)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>);
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment">                // Filter by contextlevel if necessary</span>
<a name="l718"><span class="linenum"> 718</span></a>                  if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>) || <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a> == <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42982" onMouseOver="hilite(42982)" onMouseOut="lolite()" href="../../../_variables/contextlevel.html">contextlevel</a>) {
<a name="l719"><span class="linenum"> 719</span></a>                      <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>[<a class="var it7673" onMouseOver="hilite(7673)" onMouseOut="lolite()" onClick="logVariable('qcat')" href="../../../_variables/qcat.html">$qcat</a>-&gt;<a onClick="logVariable('contextid')" class="var it43911" onMouseOver="hilite(43911)" onMouseOut="lolite()" href="../../../_variables/contextid.html">contextid</a>] = <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42982" onMouseOver="hilite(42982)" onMouseOut="lolite()" href="../../../_variables/contextlevel.html">contextlevel</a>;
<a name="l720"><span class="linenum"> 720</span></a>                  }
<a name="l721"><span class="linenum"> 721</span></a>              }
<a name="l722"><span class="linenum"> 722</span></a>          }
<a name="l723"><span class="linenum"> 723</span></a>          <a class="var it15463" onMouseOver="hilite(15463)" onMouseOut="lolite()" onClick="logVariable('qcats')" href="../../../_variables/qcats.html">$qcats</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment">        // Sort by value (contextlevel from CONTEXT_SYSTEM downto CONTEXT_MODULE)</span>
<a name="l725"><span class="linenum"> 725</span></a>          <a class="phpfunction" onClick="logFunction('asort')" href="../../../_functions/asort.html" onMouseOver="phpfuncPopup(event,'asort')">asort</a>(<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>);
<a name="l726"><span class="linenum"> 726</span></a>          return <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>;
<a name="l727"><span class="linenum"> 727</span></a>      }
<a name="l728"><span class="linenum"> 728</span></a>  
<a name="l729"><span class="linenum"> 729</span></a>      <span class="comment">/**</span>
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment">     * Return one array of question_category records for</span>
<a name="l731"><span class="linenum"> 731</span></a>  <span class="comment">     * a given restore operation and one restore context (question bank)</span>
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment">     */</span>
<a name="l733"><span class="linenum"> 733</span></a>      public static function <a class="function" onClick="logFunction('restore_get_question_categories')" href="../../../_functions/restore_get_question_categories.html" onMouseOver="funcPopup(event,'restore_get_question_categories')">restore_get_question_categories</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>) {
<a name="l734"><span class="linenum"> 734</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l735"><span class="linenum"> 735</span></a>  
<a name="l736"><span class="linenum"> 736</span></a>          <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a> = array();
<a name="l737"><span class="linenum"> 737</span></a>          <a class="var it15463" onMouseOver="hilite(15463)" onMouseOut="lolite()" onClick="logVariable('qcats')" href="../../../_variables/qcats.html">$qcats</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(&quot;SELECT itemid, info
<a name="l738"><span class="linenum"> 738</span></a>                                           FROM {backup_ids_temp}
<a name="l739"><span class="linenum"> 739</span></a>                                          WHERE backupid = ?
<a name="l740"><span class="linenum"> 740</span></a>                                            AND itemname = 'question_category'
<a name="l741"><span class="linenum"> 741</span></a>                                            AND parentitemid = ?&quot;, array(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>));
<a name="l742"><span class="linenum"> 742</span></a>          foreach (<a class="var it15463" onMouseOver="hilite(15463)" onMouseOut="lolite()" onClick="logVariable('qcats')" href="../../../_variables/qcats.html">$qcats</a> as <a class="var it7673" onMouseOver="hilite(7673)" onMouseOut="lolite()" onClick="logVariable('qcat')" href="../../../_variables/qcat.html">$qcat</a>) {
<a name="l743"><span class="linenum"> 743</span></a>              <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>[<a class="var it7673" onMouseOver="hilite(7673)" onMouseOut="lolite()" onClick="logVariable('qcat')" href="../../../_variables/qcat.html">$qcat</a>-&gt;<a onClick="logVariable('itemid')" class="var it43911" onMouseOver="hilite(43911)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>] = backup_controller_dbops::<a class="function" onClick="logFunction('decode_backup_temp_info')" href="../../../_functions/decode_backup_temp_info.html" onMouseOver="funcPopup(event,'decode_backup_temp_info')">decode_backup_temp_info</a>(<a class="var it7673" onMouseOver="hilite(7673)" onMouseOut="lolite()" onClick="logVariable('qcat')" href="../../../_variables/qcat.html">$qcat</a>-&gt;<a onClick="logVariable('info')" class="var it43911" onMouseOver="hilite(43911)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>);
<a name="l744"><span class="linenum"> 744</span></a>          }
<a name="l745"><span class="linenum"> 745</span></a>          <a class="var it15463" onMouseOver="hilite(15463)" onMouseOut="lolite()" onClick="logVariable('qcats')" href="../../../_variables/qcats.html">$qcats</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l746"><span class="linenum"> 746</span></a>  
<a name="l747"><span class="linenum"> 747</span></a>          return <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>;
<a name="l748"><span class="linenum"> 748</span></a>      }
<a name="l749"><span class="linenum"> 749</span></a>  
<a name="l750"><span class="linenum"> 750</span></a>      <span class="comment">/**</span>
<a name="l751"><span class="linenum"> 751</span></a>  <span class="comment">     * Calculates the best context found to restore one collection of qcats,</span>
<a name="l752"><span class="linenum"> 752</span></a>  <span class="comment">     * al them belonging to the same context (question bank), returning the</span>
<a name="l753"><span class="linenum"> 753</span></a>  <span class="comment">     * target context found (object) or false</span>
<a name="l754"><span class="linenum"> 754</span></a>  <span class="comment">     */</span>
<a name="l755"><span class="linenum"> 755</span></a>      public static function <a class="function" onClick="logFunction('restore_find_best_target_context')" href="../../../_functions/restore_find_best_target_context.html" onMouseOver="funcPopup(event,'restore_find_best_target_context')">restore_find_best_target_context</a>(<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../../_variables/categories.html">$categories</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l756"><span class="linenum"> 756</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l757"><span class="linenum"> 757</span></a>  
<a name="l758"><span class="linenum"> 758</span></a>          <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a> = false;
<a name="l759"><span class="linenum"> 759</span></a>  
<a name="l760"><span class="linenum"> 760</span></a>  <span class="comment">        // Depending of $contextlevel, we perform different actions</span>
<a name="l761"><span class="linenum"> 761</span></a>          switch (<a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../../../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l762"><span class="linenum"> 762</span></a>  <span class="comment">             // For system is easy, the best context is the system context</span>
<a name="l763"><span class="linenum"> 763</span></a>               case <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../../../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>:
<a name="l764"><span class="linenum"> 764</span></a>                   <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a> = <a class="class" onClick="logClass('context_system')" href="../../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l765"><span class="linenum"> 765</span></a>                   break;
<a name="l766"><span class="linenum"> 766</span></a>  
<a name="l767"><span class="linenum"> 767</span></a>  <span class="comment">             // For coursecat, we are going to look for stamps in all the</span>
<a name="l768"><span class="linenum"> 768</span></a>  <span class="comment">             // course categories between CONTEXT_SYSTEM and CONTEXT_COURSE</span>
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment">             // (i.e. in all the course categories in the path)</span>
<a name="l770"><span class="linenum"> 770</span></a>  <span class="comment">             //</span>
<a name="l771"><span class="linenum"> 771</span></a>  <span class="comment">             // And only will return one &quot;best&quot; target context if all the</span>
<a name="l772"><span class="linenum"> 772</span></a>  <span class="comment">             // matches belong to ONE and ONLY ONE context. If multiple</span>
<a name="l773"><span class="linenum"> 773</span></a>  <span class="comment">             // matches are found, that means that there is some annoying</span>
<a name="l774"><span class="linenum"> 774</span></a>  <span class="comment">             // qbank &quot;fragmentation&quot; in the categories, so we'll fallback</span>
<a name="l775"><span class="linenum"> 775</span></a>  <span class="comment">             // to create the qbank at course level</span>
<a name="l776"><span class="linenum"> 776</span></a>               case <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../../../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>:
<a name="l777"><span class="linenum"> 777</span></a>  <span class="comment">                 // Build the array of stamps we are going to match</span>
<a name="l778"><span class="linenum"> 778</span></a>                   <a class="var it38850" onMouseOver="hilite(38850)" onMouseOut="lolite()" onClick="logVariable('stamps')" href="../../../_variables/stamps.html">$stamps</a> = array();
<a name="l779"><span class="linenum"> 779</span></a>                   foreach (<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../../_variables/categories.html">$categories</a> as <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>) {
<a name="l780"><span class="linenum"> 780</span></a>                       <a class="var it38850" onMouseOver="hilite(38850)" onMouseOut="lolite()" onClick="logVariable('stamps')" href="../../../_variables/stamps.html">$stamps</a>[] = <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('stamp')" class="var it42970" onMouseOver="hilite(42970)" onMouseOut="lolite()" href="../../../_variables/stamp.html">stamp</a>;
<a name="l781"><span class="linenum"> 781</span></a>                   }
<a name="l782"><span class="linenum"> 782</span></a>                   <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../../_variables/contexts.html">$contexts</a> = array();
<a name="l783"><span class="linenum"> 783</span></a>  <span class="comment">                 // Build the array of contexts we are going to look</span>
<a name="l784"><span class="linenum"> 784</span></a>                   <a class="var it15387" onMouseOver="hilite(15387)" onMouseOut="lolite()" onClick="logVariable('systemctx')" href="../../../_variables/systemctx.html">$systemctx</a> = <a class="class" onClick="logClass('context_system')" href="../../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l785"><span class="linenum"> 785</span></a>                   <a class="var it8535" onMouseOver="hilite(8535)" onMouseOut="lolite()" onClick="logVariable('coursectx')" href="../../../_variables/coursectx.html">$coursectx</a> = <a class="class" onClick="logClass('context_course')" href="../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>);
<a name="l786"><span class="linenum"> 786</span></a>                   <a class="var it38851" onMouseOver="hilite(38851)" onMouseOut="lolite()" onClick="logVariable('parentctxs')" href="../../../_variables/parentctxs.html">$parentctxs</a> = <a class="var it8535" onMouseOver="hilite(8535)" onMouseOut="lolite()" onClick="logVariable('coursectx')" href="../../../_variables/coursectx.html">$coursectx</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../../../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>();
<a name="l787"><span class="linenum"> 787</span></a>                   foreach (<a class="var it38851" onMouseOver="hilite(38851)" onMouseOut="lolite()" onClick="logVariable('parentctxs')" href="../../../_variables/parentctxs.html">$parentctxs</a> as <a class="var it38852" onMouseOver="hilite(38852)" onMouseOut="lolite()" onClick="logVariable('parentctx')" href="../../../_variables/parentctx.html">$parentctx</a>) {
<a name="l788"><span class="linenum"> 788</span></a>  <span class="comment">                     // Exclude system context</span>
<a name="l789"><span class="linenum"> 789</span></a>                       if (<a class="var it38852" onMouseOver="hilite(38852)" onMouseOut="lolite()" onClick="logVariable('parentctx')" href="../../../_variables/parentctx.html">$parentctx</a> == <a class="var it15387" onMouseOver="hilite(15387)" onMouseOut="lolite()" onClick="logVariable('systemctx')" href="../../../_variables/systemctx.html">$systemctx</a>-&gt;<a onClick="logVariable('id')" class="var it45170" onMouseOver="hilite(45170)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>) {
<a name="l790"><span class="linenum"> 790</span></a>                           continue;
<a name="l791"><span class="linenum"> 791</span></a>                       }
<a name="l792"><span class="linenum"> 792</span></a>                       <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../../_variables/contexts.html">$contexts</a>[] = <a class="var it38852" onMouseOver="hilite(38852)" onMouseOut="lolite()" onClick="logVariable('parentctx')" href="../../../_variables/parentctx.html">$parentctx</a>;
<a name="l793"><span class="linenum"> 793</span></a>                   }
<a name="l794"><span class="linenum"> 794</span></a>                   if (!empty(<a class="var it38850" onMouseOver="hilite(38850)" onMouseOut="lolite()" onClick="logVariable('stamps')" href="../../../_variables/stamps.html">$stamps</a>) &amp;&amp; !empty(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../../_variables/contexts.html">$contexts</a>)) {
<a name="l795"><span class="linenum"> 795</span></a>  <span class="comment">                     // Prepare the query</span>
<a name="l796"><span class="linenum"> 796</span></a>                       <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it38853" onMouseOver="hilite(38853)" onMouseOut="lolite()" onClick="logVariable('stamp_sql')" href="../../../_variables/stamp_sql.html">$stamp_sql</a>, <a class="var it38854" onMouseOver="hilite(38854)" onMouseOut="lolite()" onClick="logVariable('stamp_params')" href="../../../_variables/stamp_params.html">$stamp_params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it38850" onMouseOver="hilite(38850)" onMouseOut="lolite()" onClick="logVariable('stamps')" href="../../../_variables/stamps.html">$stamps</a>);
<a name="l797"><span class="linenum"> 797</span></a>                       <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it38855" onMouseOver="hilite(38855)" onMouseOut="lolite()" onClick="logVariable('context_sql')" href="../../../_variables/context_sql.html">$context_sql</a>, <a class="var it38856" onMouseOver="hilite(38856)" onMouseOut="lolite()" onClick="logVariable('context_params')" href="../../../_variables/context_params.html">$context_params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../../_variables/contexts.html">$contexts</a>);
<a name="l798"><span class="linenum"> 798</span></a>                       <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT contextid
<a name="l799"><span class="linenum"> 799</span></a>                                 FROM {question_categories}
<a name="l800"><span class="linenum"> 800</span></a>                                WHERE stamp <a class="var it38853" onMouseOver="hilite(38853)" onMouseOut="lolite()" onClick="logVariable('stamp_sql')" href="../../../_variables/stamp_sql.html">$stamp_sql</a>
<a name="l801"><span class="linenum"> 801</span></a>                                  AND contextid <a class="var it38855" onMouseOver="hilite(38855)" onMouseOut="lolite()" onClick="logVariable('context_sql')" href="../../../_variables/context_sql.html">$context_sql</a>&quot;;
<a name="l802"><span class="linenum"> 802</span></a>                       <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it38854" onMouseOver="hilite(38854)" onMouseOut="lolite()" onClick="logVariable('stamp_params')" href="../../../_variables/stamp_params.html">$stamp_params</a>, <a class="var it38856" onMouseOver="hilite(38856)" onMouseOut="lolite()" onClick="logVariable('context_params')" href="../../../_variables/context_params.html">$context_params</a>);
<a name="l803"><span class="linenum"> 803</span></a>                       <a class="var it38857" onMouseOver="hilite(38857)" onMouseOut="lolite()" onClick="logVariable('matchingcontexts')" href="../../../_variables/matchingcontexts.html">$matchingcontexts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>);
<a name="l804"><span class="linenum"> 804</span></a>  <span class="comment">                     // Only if ONE and ONLY ONE context is found, use it as valid target</span>
<a name="l805"><span class="linenum"> 805</span></a>                       if (<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it38857" onMouseOver="hilite(38857)" onMouseOut="lolite()" onClick="logVariable('matchingcontexts')" href="../../../_variables/matchingcontexts.html">$matchingcontexts</a>) == 1) {
<a name="l806"><span class="linenum"> 806</span></a>                           <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../../../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="phpfunction" onClick="logFunction('reset')" href="../../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it38857" onMouseOver="hilite(38857)" onMouseOut="lolite()" onClick="logVariable('matchingcontexts')" href="../../../_variables/matchingcontexts.html">$matchingcontexts</a>)-&gt;contextid);
<a name="l807"><span class="linenum"> 807</span></a>                       }
<a name="l808"><span class="linenum"> 808</span></a>                   }
<a name="l809"><span class="linenum"> 809</span></a>                   break;
<a name="l810"><span class="linenum"> 810</span></a>  
<a name="l811"><span class="linenum"> 811</span></a>  <span class="comment">             // For course is easy, the best context is the course context</span>
<a name="l812"><span class="linenum"> 812</span></a>               case <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>:
<a name="l813"><span class="linenum"> 813</span></a>                   <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a> = <a class="class" onClick="logClass('context_course')" href="../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>);
<a name="l814"><span class="linenum"> 814</span></a>                   break;
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>  <span class="comment">             // For module is easy, there is not best context, as far as the</span>
<a name="l817"><span class="linenum"> 817</span></a>  <span class="comment">             // activity hasn't been created yet. So we return context course</span>
<a name="l818"><span class="linenum"> 818</span></a>  <span class="comment">             // for them, so permission checks and friends will work. Note this</span>
<a name="l819"><span class="linenum"> 819</span></a>  <span class="comment">             // case is handled by {@link prechek_precheck_qbanks_by_level}</span>
<a name="l820"><span class="linenum"> 820</span></a>  <span class="comment">             // in an special way</span>
<a name="l821"><span class="linenum"> 821</span></a>               case <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>:
<a name="l822"><span class="linenum"> 822</span></a>                   <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a> = <a class="class" onClick="logClass('context_course')" href="../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>);
<a name="l823"><span class="linenum"> 823</span></a>                   break;
<a name="l824"><span class="linenum"> 824</span></a>          }
<a name="l825"><span class="linenum"> 825</span></a>          return <a class="var it38845" onMouseOver="hilite(38845)" onMouseOut="lolite()" onClick="logVariable('targetcontext')" href="../../../_variables/targetcontext.html">$targetcontext</a>;
<a name="l826"><span class="linenum"> 826</span></a>      }
<a name="l827"><span class="linenum"> 827</span></a>  
<a name="l828"><span class="linenum"> 828</span></a>      <span class="comment">/**</span>
<a name="l829"><span class="linenum"> 829</span></a>  <span class="comment">     * Return one array of question records for</span>
<a name="l830"><span class="linenum"> 830</span></a>  <span class="comment">     * a given restore operation and one question category</span>
<a name="l831"><span class="linenum"> 831</span></a>  <span class="comment">     */</span>
<a name="l832"><span class="linenum"> 832</span></a>      public static function <a class="function" onClick="logFunction('restore_get_questions')" href="../../../_functions/restore_get_questions.html" onMouseOver="funcPopup(event,'restore_get_questions')">restore_get_questions</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it38858" onMouseOver="hilite(38858)" onMouseOut="lolite()" onClick="logVariable('qcatid')" href="../../../_variables/qcatid.html">$qcatid</a>) {
<a name="l833"><span class="linenum"> 833</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l834"><span class="linenum"> 834</span></a>  
<a name="l835"><span class="linenum"> 835</span></a>          <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a> = array();
<a name="l836"><span class="linenum"> 836</span></a>          <a class="var it8185" onMouseOver="hilite(8185)" onMouseOut="lolite()" onClick="logVariable('qs')" href="../../../_variables/qs.html">$qs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(&quot;SELECT itemid, info
<a name="l837"><span class="linenum"> 837</span></a>                                        FROM {backup_ids_temp}
<a name="l838"><span class="linenum"> 838</span></a>                                       WHERE backupid = ?
<a name="l839"><span class="linenum"> 839</span></a>                                         AND itemname = 'question'
<a name="l840"><span class="linenum"> 840</span></a>                                         AND parentitemid = ?&quot;, array(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it38858" onMouseOver="hilite(38858)" onMouseOut="lolite()" onClick="logVariable('qcatid')" href="../../../_variables/qcatid.html">$qcatid</a>));
<a name="l841"><span class="linenum"> 841</span></a>          foreach (<a class="var it8185" onMouseOver="hilite(8185)" onMouseOut="lolite()" onClick="logVariable('qs')" href="../../../_variables/qs.html">$qs</a> as <a class="var it445" onMouseOver="hilite(445)" onMouseOut="lolite()" onClick="logVariable('q')" href="../../../_variables/q.html">$q</a>) {
<a name="l842"><span class="linenum"> 842</span></a>              <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>[<a class="var it445" onMouseOver="hilite(445)" onMouseOut="lolite()" onClick="logVariable('q')" href="../../../_variables/q.html">$q</a>-&gt;<a onClick="logVariable('itemid')" class="var it43090" onMouseOver="hilite(43090)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>] = backup_controller_dbops::<a class="function" onClick="logFunction('decode_backup_temp_info')" href="../../../_functions/decode_backup_temp_info.html" onMouseOver="funcPopup(event,'decode_backup_temp_info')">decode_backup_temp_info</a>(<a class="var it445" onMouseOver="hilite(445)" onMouseOut="lolite()" onClick="logVariable('q')" href="../../../_variables/q.html">$q</a>-&gt;<a onClick="logVariable('info')" class="var it43090" onMouseOver="hilite(43090)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>);
<a name="l843"><span class="linenum"> 843</span></a>          }
<a name="l844"><span class="linenum"> 844</span></a>          <a class="var it8185" onMouseOver="hilite(8185)" onMouseOut="lolite()" onClick="logVariable('qs')" href="../../../_variables/qs.html">$qs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l845"><span class="linenum"> 845</span></a>          return <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>;
<a name="l846"><span class="linenum"> 846</span></a>      }
<a name="l847"><span class="linenum"> 847</span></a>  
<a name="l848"><span class="linenum"> 848</span></a>      <span class="comment">/**</span>
<a name="l849"><span class="linenum"> 849</span></a>  <span class="comment">     * Given one component/filearea/context and</span>
<a name="l850"><span class="linenum"> 850</span></a>  <span class="comment">     * optionally one source itemname to match itemids</span>
<a name="l851"><span class="linenum"> 851</span></a>  <span class="comment">     * put the corresponding files in the pool</span>
<a name="l852"><span class="linenum"> 852</span></a>  <span class="comment">     *</span>
<a name="l853"><span class="linenum"> 853</span></a>  <span class="comment">     * If you specify a progress reporter, it will get called once per file with</span>
<a name="l854"><span class="linenum"> 854</span></a>  <span class="comment">     * indeterminate progress.</span>
<a name="l855"><span class="linenum"> 855</span></a>  <span class="comment">     *</span>
<a name="l856"><span class="linenum"> 856</span></a>  <span class="comment">     * @param string $basepath the full path to the root of unzipped backup file</span>
<a name="l857"><span class="linenum"> 857</span></a>  <span class="comment">     * @param string $restoreid the restore job's identification</span>
<a name="l858"><span class="linenum"> 858</span></a>  <span class="comment">     * @param string $component</span>
<a name="l859"><span class="linenum"> 859</span></a>  <span class="comment">     * @param string $filearea</span>
<a name="l860"><span class="linenum"> 860</span></a>  <span class="comment">     * @param int $oldcontextid</span>
<a name="l861"><span class="linenum"> 861</span></a>  <span class="comment">     * @param int $dfltuserid default $file-&gt;user if the old one can't be mapped</span>
<a name="l862"><span class="linenum"> 862</span></a>  <span class="comment">     * @param string|null $itemname</span>
<a name="l863"><span class="linenum"> 863</span></a>  <span class="comment">     * @param int|null $olditemid</span>
<a name="l864"><span class="linenum"> 864</span></a>  <span class="comment">     * @param int|null $forcenewcontextid explicit value for the new contextid (skip mapping)</span>
<a name="l865"><span class="linenum"> 865</span></a>  <span class="comment">     * @param bool $skipparentitemidctxmatch</span>
<a name="l866"><span class="linenum"> 866</span></a>  <span class="comment">     * @param \core\progress\base $progress Optional progress reporter</span>
<a name="l867"><span class="linenum"> 867</span></a>  <span class="comment">     * @return array of result object</span>
<a name="l868"><span class="linenum"> 868</span></a>  <span class="comment">     */</span>
<a name="l869"><span class="linenum"> 869</span></a>      public static function <a class="function" onClick="logFunction('send_files_to_pool')" href="../../../_functions/send_files_to_pool.html" onMouseOver="funcPopup(event,'send_files_to_pool')">send_files_to_pool</a>(<a class="var it2356" onMouseOver="hilite(2356)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../../_variables/basepath.html">$basepath</a>, <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a>,
<a name="l870"><span class="linenum"> 870</span></a>              <a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it38859" onMouseOver="hilite(38859)" onMouseOut="lolite()" onClick="logVariable('dfltuserid')" href="../../../_variables/dfltuserid.html">$dfltuserid</a>, <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a> = null, <a class="var it15456" onMouseOver="hilite(15456)" onMouseOut="lolite()" onClick="logVariable('olditemid')" href="../../../_variables/olditemid.html">$olditemid</a> = null,
<a name="l871"><span class="linenum"> 871</span></a>              <a class="var it38860" onMouseOver="hilite(38860)" onMouseOut="lolite()" onClick="logVariable('forcenewcontextid')" href="../../../_variables/forcenewcontextid.html">$forcenewcontextid</a> = null, <a class="var it38861" onMouseOver="hilite(38861)" onMouseOut="lolite()" onClick="logVariable('skipparentitemidctxmatch')" href="../../../_variables/skipparentitemidctxmatch.html">$skipparentitemidctxmatch</a> = false,
<a name="l872"><span class="linenum"> 872</span></a>              \core\progress\base <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a> = null) {
<a name="l873"><span class="linenum"> 873</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>;
<a name="l874"><span class="linenum"> 874</span></a>  
<a name="l875"><span class="linenum"> 875</span></a>          <a class="var it37499" onMouseOver="hilite(37499)" onMouseOut="lolite()" onClick="logVariable('backupinfo')" href="../../../_variables/backupinfo.html">$backupinfo</a> = backup_general_helper::<a class="function" onClick="logFunction('get_backup_information')" href="../../../_functions/get_backup_information.html" onMouseOver="funcPopup(event,'get_backup_information')">get_backup_information</a>(<a class="phpfunction" onClick="logFunction('basename')" href="../../../_functions/basename.html" onMouseOver="phpfuncPopup(event,'basename')">basename</a>(<a class="var it2356" onMouseOver="hilite(2356)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../../_variables/basepath.html">$basepath</a>));
<a name="l876"><span class="linenum"> 876</span></a>          <a class="var it38862" onMouseOver="hilite(38862)" onMouseOut="lolite()" onClick="logVariable('includesfiles')" href="../../../_variables/includesfiles.html">$includesfiles</a> = <a class="var it37499" onMouseOver="hilite(37499)" onMouseOut="lolite()" onClick="logVariable('backupinfo')" href="../../../_variables/backupinfo.html">$backupinfo</a>-&gt;<a onClick="logVariable('include_files')" class="var it45171" onMouseOver="hilite(45171)" onMouseOut="lolite()" href="../../../_variables/include_files.html">include_files</a>;
<a name="l877"><span class="linenum"> 877</span></a>  
<a name="l878"><span class="linenum"> 878</span></a>          <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a> = array();
<a name="l879"><span class="linenum"> 879</span></a>  
<a name="l880"><span class="linenum"> 880</span></a>          if (<a class="var it38860" onMouseOver="hilite(38860)" onMouseOut="lolite()" onClick="logVariable('forcenewcontextid')" href="../../../_variables/forcenewcontextid.html">$forcenewcontextid</a>) {
<a name="l881"><span class="linenum"> 881</span></a>  <span class="comment">            // Some components can have &quot;forced&quot; new contexts (example: questions can end belonging to non-standard context mappings,</span>
<a name="l882"><span class="linenum"> 882</span></a>  <span class="comment">            // with questions originally at system/coursecat context in source being restored to course context in target). So we need</span>
<a name="l883"><span class="linenum"> 883</span></a>  <span class="comment">            // to be able to force the new contextid</span>
<a name="l884"><span class="linenum"> 884</span></a>              <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a> = <a class="var it38860" onMouseOver="hilite(38860)" onMouseOut="lolite()" onClick="logVariable('forcenewcontextid')" href="../../../_variables/forcenewcontextid.html">$forcenewcontextid</a>;
<a name="l885"><span class="linenum"> 885</span></a>          } else {
<a name="l886"><span class="linenum"> 886</span></a>  <span class="comment">            // Get new context, must exist or this will fail</span>
<a name="l887"><span class="linenum"> 887</span></a>              <a class="var it38864" onMouseOver="hilite(38864)" onMouseOut="lolite()" onClick="logVariable('newcontextrecord')" href="../../../_variables/newcontextrecord.html">$newcontextrecord</a> = self::<a class="function" onClick="logFunction('get_backup_ids_record')" href="../../../_functions/get_backup_ids_record.html" onMouseOver="funcPopup(event,'get_backup_ids_record')">get_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'context', <a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../../_variables/oldcontextid.html">$oldcontextid</a>);
<a name="l888"><span class="linenum"> 888</span></a>              if (!<a class="var it38864" onMouseOver="hilite(38864)" onMouseOut="lolite()" onClick="logVariable('newcontextrecord')" href="../../../_variables/newcontextrecord.html">$newcontextrecord</a> || !<a class="var it38864" onMouseOver="hilite(38864)" onMouseOut="lolite()" onClick="logVariable('newcontextrecord')" href="../../../_variables/newcontextrecord.html">$newcontextrecord</a>-&gt;<a onClick="logVariable('newitemid')" class="var it45172" onMouseOver="hilite(45172)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>) {
<a name="l889"><span class="linenum"> 889</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('restore_dbops_exception')" href="../../../_classes/restore_dbops_exception.html" onMouseOver="classPopup(event,'restore_dbops_exception')">restore_dbops_exception</a>('unknown_context_mapping', <a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../../_variables/oldcontextid.html">$oldcontextid</a>);
<a name="l890"><span class="linenum"> 890</span></a>              }
<a name="l891"><span class="linenum"> 891</span></a>              <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a> = <a class="var it38864" onMouseOver="hilite(38864)" onMouseOut="lolite()" onClick="logVariable('newcontextrecord')" href="../../../_variables/newcontextrecord.html">$newcontextrecord</a>-&gt;<a onClick="logVariable('newitemid')" class="var it45172" onMouseOver="hilite(45172)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>;
<a name="l892"><span class="linenum"> 892</span></a>          }
<a name="l893"><span class="linenum"> 893</span></a>  
<a name="l894"><span class="linenum"> 894</span></a>  <span class="comment">        // Sometimes it's possible to have not the oldcontextids stored into backup_ids_temp-&gt;parentitemid</span>
<a name="l895"><span class="linenum"> 895</span></a>  <span class="comment">        // columns (because we have used them to store other information). This happens usually with</span>
<a name="l896"><span class="linenum"> 896</span></a>  <span class="comment">        // all the question related backup_ids_temp records. In that case, it's safe to ignore that</span>
<a name="l897"><span class="linenum"> 897</span></a>  <span class="comment">        // matching as far as we are always restoring for well known oldcontexts and olditemids</span>
<a name="l898"><span class="linenum"> 898</span></a>          <a class="var it38865" onMouseOver="hilite(38865)" onMouseOut="lolite()" onClick="logVariable('parentitemctxmatchsql')" href="../../../_variables/parentitemctxmatchsql.html">$parentitemctxmatchsql</a> = ' AND i.parentitemid = f.contextid ';
<a name="l899"><span class="linenum"> 899</span></a>          if (<a class="var it38861" onMouseOver="hilite(38861)" onMouseOut="lolite()" onClick="logVariable('skipparentitemidctxmatch')" href="../../../_variables/skipparentitemidctxmatch.html">$skipparentitemidctxmatch</a>) {
<a name="l900"><span class="linenum"> 900</span></a>              <a class="var it38865" onMouseOver="hilite(38865)" onMouseOut="lolite()" onClick="logVariable('parentitemctxmatchsql')" href="../../../_variables/parentitemctxmatchsql.html">$parentitemctxmatchsql</a> = '';
<a name="l901"><span class="linenum"> 901</span></a>          }
<a name="l902"><span class="linenum"> 902</span></a>  
<a name="l903"><span class="linenum"> 903</span></a>  <span class="comment">        // Important: remember how files have been loaded to backup_files_temp</span>
<a name="l904"><span class="linenum"> 904</span></a>  <span class="comment">        //   - info: contains the whole original object (times, names...)</span>
<a name="l905"><span class="linenum"> 905</span></a>  <span class="comment">        //   (all them being original ids as loaded from xml)</span>
<a name="l906"><span class="linenum"> 906</span></a>  
<a name="l907"><span class="linenum"> 907</span></a>  <span class="comment">        // itemname = null, we are going to match only by context, no need to use itemid (all them are 0)</span>
<a name="l908"><span class="linenum"> 908</span></a>          if (<a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a> == null) {
<a name="l909"><span class="linenum"> 909</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT id AS bftid, contextid, component, filearea, itemid, itemid AS newitemid, info
<a name="l910"><span class="linenum"> 910</span></a>                        FROM {backup_files_temp}
<a name="l911"><span class="linenum"> 911</span></a>                       WHERE backupid = ?
<a name="l912"><span class="linenum"> 912</span></a>                         AND contextid = ?
<a name="l913"><span class="linenum"> 913</span></a>                         AND component = ?
<a name="l914"><span class="linenum"> 914</span></a>                         AND filearea  = ?&quot;;
<a name="l915"><span class="linenum"> 915</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a>);
<a name="l916"><span class="linenum"> 916</span></a>  
<a name="l917"><span class="linenum"> 917</span></a>  <span class="comment">        // itemname not null, going to join with backup_ids to perform the old-new mapping of itemids</span>
<a name="l918"><span class="linenum"> 918</span></a>          } else {
<a name="l919"><span class="linenum"> 919</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT f.id AS bftid, f.contextid, f.component, f.filearea, f.itemid, i.newitemid, f.info
<a name="l920"><span class="linenum"> 920</span></a>                        FROM {backup_files_temp} f
<a name="l921"><span class="linenum"> 921</span></a>                        JOIN {backup_ids_temp} i ON i.backupid = f.backupid
<a name="l922"><span class="linenum"> 922</span></a>                                                <a class="var it38865" onMouseOver="hilite(38865)" onMouseOut="lolite()" onClick="logVariable('parentitemctxmatchsql')" href="../../../_variables/parentitemctxmatchsql.html">$parentitemctxmatchsql</a>
<a name="l923"><span class="linenum"> 923</span></a>                                                AND i.itemid = f.itemid
<a name="l924"><span class="linenum"> 924</span></a>                       WHERE f.backupid = ?
<a name="l925"><span class="linenum"> 925</span></a>                         AND f.contextid = ?
<a name="l926"><span class="linenum"> 926</span></a>                         AND f.component = ?
<a name="l927"><span class="linenum"> 927</span></a>                         AND f.filearea = ?
<a name="l928"><span class="linenum"> 928</span></a>                         AND i.itemname = ?&quot;;
<a name="l929"><span class="linenum"> 929</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a>, <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a>);
<a name="l930"><span class="linenum"> 930</span></a>              if (<a class="var it15456" onMouseOver="hilite(15456)" onMouseOut="lolite()" onClick="logVariable('olditemid')" href="../../../_variables/olditemid.html">$olditemid</a> !== null) { // Just process ONE olditemid intead of the whole itemname
<a name="l931"><span class="linenum"> 931</span></a>                  <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> .= ' AND i.itemid = ?';
<a name="l932"><span class="linenum"> 932</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>[] = <a class="var it15456" onMouseOver="hilite(15456)" onMouseOut="lolite()" onClick="logVariable('olditemid')" href="../../../_variables/olditemid.html">$olditemid</a>;
<a name="l933"><span class="linenum"> 933</span></a>              }
<a name="l934"><span class="linenum"> 934</span></a>          }
<a name="l935"><span class="linenum"> 935</span></a>  
<a name="l936"><span class="linenum"> 936</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();         <span class="comment">// Get moodle file storage</span>
<a name="l937"><span class="linenum"> 937</span></a>          <a class="var it2356" onMouseOver="hilite(2356)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../../_variables/basepath.html">$basepath</a> = <a class="var it2356" onMouseOver="hilite(2356)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../../_variables/basepath.html">$basepath</a> . '/files/';<span class="comment">// Get backup file pool base</span>
<a name="l938"><span class="linenum"> 938</span></a>  <span class="comment">        // Report progress before query.</span>
<a name="l939"><span class="linenum"> 939</span></a>          if (<a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>) {
<a name="l940"><span class="linenum"> 940</span></a>              <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('progress')" href="../../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>();
<a name="l941"><span class="linenum"> 941</span></a>          }
<a name="l942"><span class="linenum"> 942</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>);
<a name="l943"><span class="linenum"> 943</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> as <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>) {
<a name="l944"><span class="linenum"> 944</span></a>  <span class="comment">            // Report progress each time around loop.</span>
<a name="l945"><span class="linenum"> 945</span></a>              if (<a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>) {
<a name="l946"><span class="linenum"> 946</span></a>                  <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('progress')" href="../../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>();
<a name="l947"><span class="linenum"> 947</span></a>              }
<a name="l948"><span class="linenum"> 948</span></a>  
<a name="l949"><span class="linenum"> 949</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a> = (object)backup_controller_dbops::<a class="function" onClick="logFunction('decode_backup_temp_info')" href="../../../_functions/decode_backup_temp_info.html" onMouseOver="funcPopup(event,'decode_backup_temp_info')">decode_backup_temp_info</a>(<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('info')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>);
<a name="l950"><span class="linenum"> 950</span></a>  
<a name="l951"><span class="linenum"> 951</span></a>  <span class="comment">            // ignore root dirs (they are created automatically)</span>
<a name="l952"><span class="linenum"> 952</span></a>              if (<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filepath')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filepath.html">filepath</a> == '/' &amp;&amp; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filename')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filename.html">filename</a> == '.') {
<a name="l953"><span class="linenum"> 953</span></a>                  continue;
<a name="l954"><span class="linenum"> 954</span></a>              }
<a name="l955"><span class="linenum"> 955</span></a>  
<a name="l956"><span class="linenum"> 956</span></a>  <span class="comment">            // set the best possible user</span>
<a name="l957"><span class="linenum"> 957</span></a>              <a class="var it38866" onMouseOver="hilite(38866)" onMouseOut="lolite()" onClick="logVariable('mappeduser')" href="../../../_variables/mappeduser.html">$mappeduser</a> = self::<a class="function" onClick="logFunction('get_backup_ids_record')" href="../../../_functions/get_backup_ids_record.html" onMouseOver="funcPopup(event,'get_backup_ids_record')">get_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'user', <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('userid')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a>);
<a name="l958"><span class="linenum"> 958</span></a>              <a class="var it38867" onMouseOver="hilite(38867)" onMouseOut="lolite()" onClick="logVariable('mappeduserid')" href="../../../_variables/mappeduserid.html">$mappeduserid</a> = !empty(<a class="var it38866" onMouseOver="hilite(38866)" onMouseOut="lolite()" onClick="logVariable('mappeduser')" href="../../../_variables/mappeduser.html">$mappeduser</a>) ? <a class="var it38866" onMouseOver="hilite(38866)" onMouseOut="lolite()" onClick="logVariable('mappeduser')" href="../../../_variables/mappeduser.html">$mappeduser</a>-&gt;<a onClick="logVariable('newitemid')" class="var it45173" onMouseOver="hilite(45173)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a> : <a class="var it38859" onMouseOver="hilite(38859)" onMouseOut="lolite()" onClick="logVariable('dfltuserid')" href="../../../_variables/dfltuserid.html">$dfltuserid</a>;
<a name="l959"><span class="linenum"> 959</span></a>  
<a name="l960"><span class="linenum"> 960</span></a>  <span class="comment">            // dir found (and not root one), let's create it</span>
<a name="l961"><span class="linenum"> 961</span></a>              if (<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filename')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filename.html">filename</a> == '.') {
<a name="l962"><span class="linenum"> 962</span></a>                  <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_directory')" href="../../../_functions/create_directory.html" onMouseOver="funcPopup(event,'create_directory')">create_directory</a>(<a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a>, <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('newitemid')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filepath')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filepath.html">filepath</a>, <a class="var it38867" onMouseOver="hilite(38867)" onMouseOut="lolite()" onClick="logVariable('mappeduserid')" href="../../../_variables/mappeduserid.html">$mappeduserid</a>);
<a name="l963"><span class="linenum"> 963</span></a>                  continue;
<a name="l964"><span class="linenum"> 964</span></a>              }
<a name="l965"><span class="linenum"> 965</span></a>  
<a name="l966"><span class="linenum"> 966</span></a>  <span class="comment">            // The file record to restore.</span>
<a name="l967"><span class="linenum"> 967</span></a>              <a class="var it9407" onMouseOver="hilite(9407)" onMouseOut="lolite()" onClick="logVariable('file_record')" href="../../../_variables/file_record.html">$file_record</a> = array(
<a name="l968"><span class="linenum"> 968</span></a>                  'contextid'   =&gt; <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>,
<a name="l969"><span class="linenum"> 969</span></a>                  'component'   =&gt; <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>,
<a name="l970"><span class="linenum"> 970</span></a>                  'filearea'    =&gt; <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a>,
<a name="l971"><span class="linenum"> 971</span></a>                  'itemid'      =&gt; <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('newitemid')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>,
<a name="l972"><span class="linenum"> 972</span></a>                  'filepath'    =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filepath')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filepath.html">filepath</a>,
<a name="l973"><span class="linenum"> 973</span></a>                  'filename'    =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filename')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filename.html">filename</a>,
<a name="l974"><span class="linenum"> 974</span></a>                  'timecreated' =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/timecreated.html">timecreated</a>,
<a name="l975"><span class="linenum"> 975</span></a>                  'timemodified'=&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/timemodified.html">timemodified</a>,
<a name="l976"><span class="linenum"> 976</span></a>                  'userid'      =&gt; <a class="var it38867" onMouseOver="hilite(38867)" onMouseOut="lolite()" onClick="logVariable('mappeduserid')" href="../../../_variables/mappeduserid.html">$mappeduserid</a>,
<a name="l977"><span class="linenum"> 977</span></a>                  'source'      =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('source')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/source.html">source</a>,
<a name="l978"><span class="linenum"> 978</span></a>                  'author'      =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('author')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/author.html">author</a>,
<a name="l979"><span class="linenum"> 979</span></a>                  'license'     =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('license')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/license.html">license</a>,
<a name="l980"><span class="linenum"> 980</span></a>                  'sortorder'   =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;sortorder
<a name="l981"><span class="linenum"> 981</span></a>              );
<a name="l982"><span class="linenum"> 982</span></a>  
<a name="l983"><span class="linenum"> 983</span></a>              if (empty(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('repositoryid')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/repositoryid.html">repositoryid</a>)) {
<a name="l984"><span class="linenum"> 984</span></a>  <span class="comment">                // If contenthash is empty then gracefully skip adding file.</span>
<a name="l985"><span class="linenum"> 985</span></a>                  if (empty(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('contenthash')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/contenthash.html">contenthash</a>)) {
<a name="l986"><span class="linenum"> 986</span></a>                      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = new stdClass();
<a name="l987"><span class="linenum"> 987</span></a>                      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('code')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/code.html">code</a> = 'file_missing_in_backup';
<a name="l988"><span class="linenum"> 988</span></a>                      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('message')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/message.html">message</a> = sprintf('missing <a class="phpfunction" onClick="logFunction('file')" href="../../../_functions/file.html" onMouseOver="phpfuncPopup(event,'file')">file</a> (%s) contenthash in backup for component %s', <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filename')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filename.html">filename</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>);
<a name="l989"><span class="linenum"> 989</span></a>                      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('level')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/level.html">level</a> = backup::LOG_WARNING;
<a name="l990"><span class="linenum"> 990</span></a>                      <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>[] = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l991"><span class="linenum"> 991</span></a>                      continue;
<a name="l992"><span class="linenum"> 992</span></a>                  }
<a name="l993"><span class="linenum"> 993</span></a>  <span class="comment">                // this is a regular file, it must be present in the backup pool</span>
<a name="l994"><span class="linenum"> 994</span></a>                  <a class="var it37489" onMouseOver="hilite(37489)" onMouseOut="lolite()" onClick="logVariable('backuppath')" href="../../../_variables/backuppath.html">$backuppath</a> = <a class="var it2356" onMouseOver="hilite(2356)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../../_variables/basepath.html">$basepath</a> . <a class="class" onClick="logClass('backup_file_manager')" href="../../../_classes/backup_file_manager.html" onMouseOver="classPopup(event,'backup_file_manager')">backup_file_manager</a>::<a class="function" onClick="logFunction('get_backup_content_file_location')" href="../../../_functions/get_backup_content_file_location.html" onMouseOver="funcPopup(event,'get_backup_content_file_location')">get_backup_content_file_location</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('contenthash')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/contenthash.html">contenthash</a>);
<a name="l995"><span class="linenum"> 995</span></a>  
<a name="l996"><span class="linenum"> 996</span></a>  <span class="comment">                // Some file types do not include the files as they should already be</span>
<a name="l997"><span class="linenum"> 997</span></a>  <span class="comment">                // present. We still need to create entries into the files table.</span>
<a name="l998"><span class="linenum"> 998</span></a>                  if (<a class="var it38862" onMouseOver="hilite(38862)" onMouseOut="lolite()" onClick="logVariable('includesfiles')" href="../../../_variables/includesfiles.html">$includesfiles</a>) {
<a name="l999"><span class="linenum"> 999</span></a>  <span class="comment">                    // The file is not found in the backup.</span>
<a name="l1000"><span class="linenum">1000</span></a>                      if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it37489" onMouseOver="hilite(37489)" onMouseOut="lolite()" onClick="logVariable('backuppath')" href="../../../_variables/backuppath.html">$backuppath</a>)) {
<a name="l1001"><span class="linenum">1001</span></a>                          <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>[] = self::<a class="function" onClick="logFunction('get_missing_file_result')" href="../../../_functions/get_missing_file_result.html" onMouseOver="funcPopup(event,'get_missing_file_result')">get_missing_file_result</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>);
<a name="l1002"><span class="linenum">1002</span></a>                          continue;
<a name="l1003"><span class="linenum">1003</span></a>                      }
<a name="l1004"><span class="linenum">1004</span></a>  
<a name="l1005"><span class="linenum">1005</span></a>  <span class="comment">                    // create the file in the filepool if it does not exist yet</span>
<a name="l1006"><span class="linenum">1006</span></a>                      if (!<a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a>-&gt;<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a>, <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('newitemid')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filepath')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filepath.html">filepath</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filename')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filename.html">filename</a>)) {
<a name="l1007"><span class="linenum">1007</span></a>  
<a name="l1008"><span class="linenum">1008</span></a>  <span class="comment">                        // If no license found, use default.</span>
<a name="l1009"><span class="linenum">1009</span></a>                          if (<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('license')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/license.html">license</a> == null){
<a name="l1010"><span class="linenum">1010</span></a>                              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('license')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/license.html">license</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('sitedefaultlicense')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/sitedefaultlicense.html">sitedefaultlicense</a>;
<a name="l1011"><span class="linenum">1011</span></a>                          }
<a name="l1012"><span class="linenum">1012</span></a>  
<a name="l1013"><span class="linenum">1013</span></a>                          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_file_from_pathname')" href="../../../_functions/create_file_from_pathname.html" onMouseOver="funcPopup(event,'create_file_from_pathname')">create_file_from_pathname</a>(<a class="var it9407" onMouseOver="hilite(9407)" onMouseOut="lolite()" onClick="logVariable('file_record')" href="../../../_variables/file_record.html">$file_record</a>, <a class="var it37489" onMouseOver="hilite(37489)" onMouseOut="lolite()" onClick="logVariable('backuppath')" href="../../../_variables/backuppath.html">$backuppath</a>);
<a name="l1014"><span class="linenum">1014</span></a>                      }
<a name="l1015"><span class="linenum">1015</span></a>                  } else {
<a name="l1016"><span class="linenum">1016</span></a>  <span class="comment">                    // This backup does not include the files - they should be available in moodle filestorage already.</span>
<a name="l1017"><span class="linenum">1017</span></a>  
<a name="l1018"><span class="linenum">1018</span></a>  <span class="comment">                    // Create the file in the filepool if it does not exist yet.</span>
<a name="l1019"><span class="linenum">1019</span></a>                      if (!<a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a>-&gt;<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a>, <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('newitemid')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filepath')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filepath.html">filepath</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filename')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filename.html">filename</a>)) {
<a name="l1020"><span class="linenum">1020</span></a>  
<a name="l1021"><span class="linenum">1021</span></a>  <span class="comment">                        // Even if a file has been deleted since the backup was made, the file metadata will remain in the</span>
<a name="l1022"><span class="linenum">1022</span></a>  <span class="comment">                        // files table, and the file will not be moved to the trashdir.</span>
<a name="l1023"><span class="linenum">1023</span></a>  <span class="comment">                        // Files are not cleared from the files table by cron until several days after deletion.</span>
<a name="l1024"><span class="linenum">1024</span></a>                          if (<a class="var it38868" onMouseOver="hilite(38868)" onMouseOut="lolite()" onClick="logVariable('foundfiles')" href="../../../_variables/foundfiles.html">$foundfiles</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('files', array('contenthash' =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('contenthash')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/contenthash.html">contenthash</a>), '', '*', 0, 1)) {
<a name="l1025"><span class="linenum">1025</span></a>  <span class="comment">                            // Only grab one of the foundfiles - the file content should be the same for all entries.</span>
<a name="l1026"><span class="linenum">1026</span></a>                              <a class="var it38869" onMouseOver="hilite(38869)" onMouseOut="lolite()" onClick="logVariable('foundfile')" href="../../../_variables/foundfile.html">$foundfile</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it38868" onMouseOver="hilite(38868)" onMouseOut="lolite()" onClick="logVariable('foundfiles')" href="../../../_variables/foundfiles.html">$foundfiles</a>);
<a name="l1027"><span class="linenum">1027</span></a>                              <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_file_from_storedfile')" href="../../../_functions/create_file_from_storedfile.html" onMouseOver="funcPopup(event,'create_file_from_storedfile')">create_file_from_storedfile</a>(<a class="var it9407" onMouseOver="hilite(9407)" onMouseOut="lolite()" onClick="logVariable('file_record')" href="../../../_variables/file_record.html">$file_record</a>, <a class="var it38869" onMouseOver="hilite(38869)" onMouseOut="lolite()" onClick="logVariable('foundfile')" href="../../../_variables/foundfile.html">$foundfile</a>-&gt;<a onClick="logVariable('id')" class="var it45174" onMouseOver="hilite(45174)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l1028"><span class="linenum">1028</span></a>                          } else {
<a name="l1029"><span class="linenum">1029</span></a>  <span class="comment">                            // A matching existing file record was not found in the database.</span>
<a name="l1030"><span class="linenum">1030</span></a>                              <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>[] = self::<a class="function" onClick="logFunction('get_missing_file_result')" href="../../../_functions/get_missing_file_result.html" onMouseOver="funcPopup(event,'get_missing_file_result')">get_missing_file_result</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>);
<a name="l1031"><span class="linenum">1031</span></a>                              continue;
<a name="l1032"><span class="linenum">1032</span></a>                          }
<a name="l1033"><span class="linenum">1033</span></a>                      }
<a name="l1034"><span class="linenum">1034</span></a>                  }
<a name="l1035"><span class="linenum">1035</span></a>  
<a name="l1036"><span class="linenum">1036</span></a>  <span class="comment">                // store the the new contextid and the new itemid in case we need to remap</span>
<a name="l1037"><span class="linenum">1037</span></a>  <span class="comment">                // references to this file later</span>
<a name="l1038"><span class="linenum">1038</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('backup_files_temp', array(
<a name="l1039"><span class="linenum">1039</span></a>                      'id' =&gt; <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('bftid')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/bftid.html">bftid</a>,
<a name="l1040"><span class="linenum">1040</span></a>                      'newcontextid' =&gt; <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>,
<a name="l1041"><span class="linenum">1041</span></a>                      'newitemid' =&gt; <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('newitemid')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>), true);
<a name="l1042"><span class="linenum">1042</span></a>  
<a name="l1043"><span class="linenum">1043</span></a>              } else {
<a name="l1044"><span class="linenum">1044</span></a>  <span class="comment">                // this is an alias - we can't create it yet so we stash it in a temp</span>
<a name="l1045"><span class="linenum">1045</span></a>  <span class="comment">                // table and will let the final task to deal with it</span>
<a name="l1046"><span class="linenum">1046</span></a>                  if (!<a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a>-&gt;<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a>, <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('newitemid')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filepath')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filepath.html">filepath</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filename')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filename.html">filename</a>)) {
<a name="l1047"><span class="linenum">1047</span></a>                      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a> = new stdClass();
<a name="l1048"><span class="linenum">1048</span></a>  <span class="comment">                    // oldfile holds the raw information stored in MBZ (including reference-related info)</span>
<a name="l1049"><span class="linenum">1049</span></a>                      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>-&gt;<a onClick="logVariable('oldfile')" class="var it42982" onMouseOver="hilite(42982)" onMouseOut="lolite()" href="../../../_variables/oldfile.html">oldfile</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>;
<a name="l1050"><span class="linenum">1050</span></a>  <span class="comment">                    // newfile holds the info for the new file_record with the context, user and itemid mapped</span>
<a name="l1051"><span class="linenum">1051</span></a>                      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>-&gt;<a onClick="logVariable('newfile')" class="var it42982" onMouseOver="hilite(42982)" onMouseOut="lolite()" href="../../../_variables/newfile.html">newfile</a> = (object) <a class="var it9407" onMouseOver="hilite(9407)" onMouseOut="lolite()" onClick="logVariable('file_record')" href="../../../_variables/file_record.html">$file_record</a>;
<a name="l1052"><span class="linenum">1052</span></a>  
<a name="l1053"><span class="linenum">1053</span></a>                      restore_dbops::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'file_aliases_queue', <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('id')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 0, null, <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>);
<a name="l1054"><span class="linenum">1054</span></a>                  }
<a name="l1055"><span class="linenum">1055</span></a>              }
<a name="l1056"><span class="linenum">1056</span></a>          }
<a name="l1057"><span class="linenum">1057</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1058"><span class="linenum">1058</span></a>          return <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>;
<a name="l1059"><span class="linenum">1059</span></a>      }
<a name="l1060"><span class="linenum">1060</span></a>  
<a name="l1061"><span class="linenum">1061</span></a>      <span class="comment">/**</span>
<a name="l1062"><span class="linenum">1062</span></a>  <span class="comment">     * Returns suitable entry to include in log when there is a missing file.</span>
<a name="l1063"><span class="linenum">1063</span></a>  <span class="comment">     *</span>
<a name="l1064"><span class="linenum">1064</span></a>  <span class="comment">     * @param stdClass $file File definition</span>
<a name="l1065"><span class="linenum">1065</span></a>  <span class="comment">     * @return stdClass Log entry</span>
<a name="l1066"><span class="linenum">1066</span></a>  <span class="comment">     */</span>
<a name="l1067"><span class="linenum">1067</span></a>      protected static function <a class="function" onClick="logFunction('get_missing_file_result')" href="../../../_functions/get_missing_file_result.html" onMouseOver="funcPopup(event,'get_missing_file_result')">get_missing_file_result</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>) {
<a name="l1068"><span class="linenum">1068</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = new stdClass();
<a name="l1069"><span class="linenum">1069</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('code')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/code.html">code</a> = 'file_missing_in_backup';
<a name="l1070"><span class="linenum">1070</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('message')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/message.html">message</a> = 'Missing file in backup: ' . <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filepath')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filepath.html">filepath</a>  . <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filename')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filename.html">filename</a> .
<a name="l1071"><span class="linenum">1071</span></a>                  ' (old context ' . <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('contextid')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/contextid.html">contextid</a> . ', component ' . <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('component')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/component.html">component</a> .
<a name="l1072"><span class="linenum">1072</span></a>                  ', filearea ' . <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('filearea')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/filearea.html">filearea</a> . ', old itemid ' . <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a onClick="logVariable('itemid')" class="var it43043" onMouseOver="hilite(43043)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a> . ')';
<a name="l1073"><span class="linenum">1073</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('level')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/level.html">level</a> = backup::LOG_WARNING;
<a name="l1074"><span class="linenum">1074</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l1075"><span class="linenum">1075</span></a>      }
<a name="l1076"><span class="linenum">1076</span></a>  
<a name="l1077"><span class="linenum">1077</span></a>      <span class="comment">/**</span>
<a name="l1078"><span class="linenum">1078</span></a>  <span class="comment">     * Given one restoreid, create in DB all the users present</span>
<a name="l1079"><span class="linenum">1079</span></a>  <span class="comment">     * in backup_ids having newitemid = 0, as far as</span>
<a name="l1080"><span class="linenum">1080</span></a>  <span class="comment">     * precheck_included_users() have left them there</span>
<a name="l1081"><span class="linenum">1081</span></a>  <span class="comment">     * ready to be created. Also, annotate their newids</span>
<a name="l1082"><span class="linenum">1082</span></a>  <span class="comment">     * once created for later reference.</span>
<a name="l1083"><span class="linenum">1083</span></a>  <span class="comment">     *</span>
<a name="l1084"><span class="linenum">1084</span></a>  <span class="comment">     * This function will start and end a new progress section in the progress</span>
<a name="l1085"><span class="linenum">1085</span></a>  <span class="comment">     * object.</span>
<a name="l1086"><span class="linenum">1086</span></a>  <span class="comment">     *</span>
<a name="l1087"><span class="linenum">1087</span></a>  <span class="comment">     * @param string $basepath Base path of unzipped backup</span>
<a name="l1088"><span class="linenum">1088</span></a>  <span class="comment">     * @param string $restoreid Restore ID</span>
<a name="l1089"><span class="linenum">1089</span></a>  <span class="comment">     * @param int $userid Default userid for files</span>
<a name="l1090"><span class="linenum">1090</span></a>  <span class="comment">     * @param \core\progress\base $progress Object used for progress tracking</span>
<a name="l1091"><span class="linenum">1091</span></a>  <span class="comment">     */</span>
<a name="l1092"><span class="linenum">1092</span></a>      public static function <a class="function" onClick="logFunction('create_included_users')" href="../../../_functions/create_included_users.html" onMouseOver="funcPopup(event,'create_included_users')">create_included_users</a>(<a class="var it2356" onMouseOver="hilite(2356)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../../_variables/basepath.html">$basepath</a>, <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l1093"><span class="linenum">1093</span></a>              \core\progress\base <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>) {
<a name="l1094"><span class="linenum">1094</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1095"><span class="linenum">1095</span></a>          <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>('Creating included users');
<a name="l1096"><span class="linenum">1096</span></a>  
<a name="l1097"><span class="linenum">1097</span></a>          <a class="var it38871" onMouseOver="hilite(38871)" onMouseOut="lolite()" onClick="logVariable('authcache')" href="../../../_variables/authcache.html">$authcache</a> = array(); <span class="comment">// Cache to get some bits from authentication plugins</span>
<a name="l1098"><span class="linenum">1098</span></a>          <a class="var it3124" onMouseOver="hilite(3124)" onMouseOut="lolite()" onClick="logVariable('languages')" href="../../../_variables/languages.html">$languages</a> = <a class="function" onClick="logFunction('get_string_manager')" href="../../../_functions/get_string_manager.html" onMouseOver="funcPopup(event,'get_string_manager')">get_string_manager</a>()-&gt;<a class="function" onClick="logFunction('get_list_of_translations')" href="../../../_functions/get_list_of_translations.html" onMouseOver="funcPopup(event,'get_list_of_translations')">get_list_of_translations</a>(); <span class="comment">// Get languages for quick search later</span>
<a name="l1099"><span class="linenum">1099</span></a>          <a class="var it3122" onMouseOver="hilite(3122)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../../_variables/themes.html">$themes</a>    = <a class="function" onClick="logFunction('get_list_of_themes')" href="../../../_functions/get_list_of_themes.html" onMouseOver="funcPopup(event,'get_list_of_themes')">get_list_of_themes</a>(); <span class="comment">// Get themes for quick search later</span>
<a name="l1100"><span class="linenum">1100</span></a>  
<a name="l1101"><span class="linenum">1101</span></a>  <span class="comment">        // Iterate over all the included users with newitemid = 0, have to create them</span>
<a name="l1102"><span class="linenum">1102</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('backup_ids_temp', array('backupid' =&gt; <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'itemname' =&gt; 'user', 'newitemid' =&gt; 0), '', 'itemid, parentitemid, info');
<a name="l1103"><span class="linenum">1103</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> as <a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>) {
<a name="l1104"><span class="linenum">1104</span></a>              <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('progress')" href="../../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>();
<a name="l1105"><span class="linenum">1105</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a> = (object)backup_controller_dbops::<a class="function" onClick="logFunction('decode_backup_temp_info')" href="../../../_functions/decode_backup_temp_info.html" onMouseOver="funcPopup(event,'decode_backup_temp_info')">decode_backup_temp_info</a>(<a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>-&gt;<a onClick="logVariable('info')" class="var it45175" onMouseOver="hilite(45175)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>);
<a name="l1106"><span class="linenum">1106</span></a>  
<a name="l1107"><span class="linenum">1107</span></a>  <span class="comment">            // if user lang doesn't exist here, use site default</span>
<a name="l1108"><span class="linenum">1108</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lang')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/lang.html">lang</a>, <a class="var it3124" onMouseOver="hilite(3124)" onMouseOut="lolite()" onClick="logVariable('languages')" href="../../../_variables/languages.html">$languages</a>)) {
<a name="l1109"><span class="linenum">1109</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lang')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/lang.html">lang</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('lang')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/lang.html">lang</a>;
<a name="l1110"><span class="linenum">1110</span></a>              }
<a name="l1111"><span class="linenum">1111</span></a>  
<a name="l1112"><span class="linenum">1112</span></a>  <span class="comment">            // if user theme isn't available on target site or they are disabled, reset theme</span>
<a name="l1113"><span class="linenum">1113</span></a>              if (!empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('theme')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/theme.html">theme</a>)) {
<a name="l1114"><span class="linenum">1114</span></a>                  if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('allowuserthemes')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/allowuserthemes.html">allowuserthemes</a>) || !<a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('theme')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/theme.html">theme</a>, <a class="var it3122" onMouseOver="hilite(3122)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../../_variables/themes.html">$themes</a>)) {
<a name="l1115"><span class="linenum">1115</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('theme')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/theme.html">theme</a> = '';
<a name="l1116"><span class="linenum">1116</span></a>                  }
<a name="l1117"><span class="linenum">1117</span></a>              }
<a name="l1118"><span class="linenum">1118</span></a>  
<a name="l1119"><span class="linenum">1119</span></a>  <span class="comment">            // if user to be created has mnet auth and its mnethostid is $CFG-&gt;mnet_localhost_id</span>
<a name="l1120"><span class="linenum">1120</span></a>  <span class="comment">            // that's 100% impossible as own server cannot be accesed over mnet. Change auth to email/manual</span>
<a name="l1121"><span class="linenum">1121</span></a>              if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a> == 'mnet' &amp;&amp; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a> == <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>) {
<a name="l1122"><span class="linenum">1122</span></a>  <span class="comment">                // Respect registerauth</span>
<a name="l1123"><span class="linenum">1123</span></a>                  if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('registerauth')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/registerauth.html">registerauth</a> == 'email') {
<a name="l1124"><span class="linenum">1124</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a> = 'email';
<a name="l1125"><span class="linenum">1125</span></a>                  } else {
<a name="l1126"><span class="linenum">1126</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a> = 'manual';
<a name="l1127"><span class="linenum">1127</span></a>                  }
<a name="l1128"><span class="linenum">1128</span></a>              }
<a name="l1129"><span class="linenum">1129</span></a>              unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethosturl')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethosturl.html">mnethosturl</a>); <span class="comment">// Not needed anymore</span>
<a name="l1130"><span class="linenum">1130</span></a>  
<a name="l1131"><span class="linenum">1131</span></a>  <span class="comment">            // Disable pictures based on global setting</span>
<a name="l1132"><span class="linenum">1132</span></a>              if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('disableuserimages')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/disableuserimages.html">disableuserimages</a>)) {
<a name="l1133"><span class="linenum">1133</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('picture')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/picture.html">picture</a> = 0;
<a name="l1134"><span class="linenum">1134</span></a>              }
<a name="l1135"><span class="linenum">1135</span></a>  
<a name="l1136"><span class="linenum">1136</span></a>  <span class="comment">            // We need to analyse the AUTH field to recode it:</span>
<a name="l1137"><span class="linenum">1137</span></a>  <span class="comment">            //   - if the auth isn't enabled in target site, $CFG-&gt;registerauth will decide</span>
<a name="l1138"><span class="linenum">1138</span></a>  <span class="comment">            //   - finally, if the auth resulting isn't enabled, default to 'manual'</span>
<a name="l1139"><span class="linenum">1139</span></a>              if (!<a class="function" onClick="logFunction('is_enabled_auth')" href="../../../_functions/is_enabled_auth.html" onMouseOver="funcPopup(event,'is_enabled_auth')">is_enabled_auth</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a>)) {
<a name="l1140"><span class="linenum">1140</span></a>                  if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('registerauth')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/registerauth.html">registerauth</a> == 'email') {
<a name="l1141"><span class="linenum">1141</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a> = 'email';
<a name="l1142"><span class="linenum">1142</span></a>                  } else {
<a name="l1143"><span class="linenum">1143</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a> = 'manual';
<a name="l1144"><span class="linenum">1144</span></a>                  }
<a name="l1145"><span class="linenum">1145</span></a>              }
<a name="l1146"><span class="linenum">1146</span></a>              if (!<a class="function" onClick="logFunction('is_enabled_auth')" href="../../../_functions/is_enabled_auth.html" onMouseOver="funcPopup(event,'is_enabled_auth')">is_enabled_auth</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a>)) { // Final auth check verify, default to manual if not enabled
<a name="l1147"><span class="linenum">1147</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a> = 'manual';
<a name="l1148"><span class="linenum">1148</span></a>              }
<a name="l1149"><span class="linenum">1149</span></a>  
<a name="l1150"><span class="linenum">1150</span></a>  <span class="comment">            // Now that we know the auth method, for users to be created without pass</span>
<a name="l1151"><span class="linenum">1151</span></a>  <span class="comment">            // if password handling is internal and reset password is available</span>
<a name="l1152"><span class="linenum">1152</span></a>  <span class="comment">            // we set the password to &quot;restored&quot; (plain text), so the login process</span>
<a name="l1153"><span class="linenum">1153</span></a>  <span class="comment">            // will know how to handle that situation in order to allow the user to</span>
<a name="l1154"><span class="linenum">1154</span></a>  <span class="comment">            // recover the password. MDL-20846</span>
<a name="l1155"><span class="linenum">1155</span></a>              if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/password.html">password</a>)) { // Only if restore comes without password
<a name="l1156"><span class="linenum">1156</span></a>                  if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a>, <a class="var it38871" onMouseOver="hilite(38871)" onMouseOut="lolite()" onClick="logVariable('authcache')" href="../../../_variables/authcache.html">$authcache</a>)) { // Not in cache
<a name="l1157"><span class="linenum">1157</span></a>                      <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../../../_variables/userauth.html">$userauth</a> = new stdClass();
<a name="l1158"><span class="linenum">1158</span></a>                      <a class="var it365" onMouseOver="hilite(365)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../../../_variables/authplugin.html">$authplugin</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../../../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a>);
<a name="l1159"><span class="linenum">1159</span></a>                      <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../../../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('preventpassindb')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../../../_variables/preventpassindb.html">preventpassindb</a> = <a class="var it365" onMouseOver="hilite(365)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../../../_variables/authplugin.html">$authplugin</a>-&gt;<a class="function" onClick="logFunction('prevent_local_passwords')" href="../../../_functions/prevent_local_passwords.html" onMouseOver="funcPopup(event,'prevent_local_passwords')">prevent_local_passwords</a>();
<a name="l1160"><span class="linenum">1160</span></a>                      <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../../../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('isinternal')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../../../_variables/isinternal.html">isinternal</a>      = <a class="var it365" onMouseOver="hilite(365)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../../../_variables/authplugin.html">$authplugin</a>-&gt;<a class="function" onClick="logFunction('is_internal')" href="../../../_functions/is_internal.html" onMouseOver="funcPopup(event,'is_internal')">is_internal</a>();
<a name="l1161"><span class="linenum">1161</span></a>                      <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../../../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('canresetpwd')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../../../_variables/canresetpwd.html">canresetpwd</a>     = <a class="var it365" onMouseOver="hilite(365)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../../../_variables/authplugin.html">$authplugin</a>-&gt;<a class="function" onClick="logFunction('can_reset_password')" href="../../../_functions/can_reset_password.html" onMouseOver="funcPopup(event,'can_reset_password')">can_reset_password</a>();
<a name="l1162"><span class="linenum">1162</span></a>                      <a class="var it38871" onMouseOver="hilite(38871)" onMouseOut="lolite()" onClick="logVariable('authcache')" href="../../../_variables/authcache.html">$authcache</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a>] = <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../../../_variables/userauth.html">$userauth</a>;
<a name="l1163"><span class="linenum">1163</span></a>                  } else {
<a name="l1164"><span class="linenum">1164</span></a>                      <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../../../_variables/userauth.html">$userauth</a> = <a class="var it38871" onMouseOver="hilite(38871)" onMouseOut="lolite()" onClick="logVariable('authcache')" href="../../../_variables/authcache.html">$authcache</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/auth.html">auth</a>]; <span class="comment">// Get from cache</span>
<a name="l1165"><span class="linenum">1165</span></a>                  }
<a name="l1166"><span class="linenum">1166</span></a>  
<a name="l1167"><span class="linenum">1167</span></a>  <span class="comment">                // Most external plugins do not store passwords locally</span>
<a name="l1168"><span class="linenum">1168</span></a>                  if (!empty(<a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../../../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('preventpassindb')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../../../_variables/preventpassindb.html">preventpassindb</a>)) {
<a name="l1169"><span class="linenum">1169</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/password.html">password</a> = <a class="constant" onClick="logConstant('AUTH_PASSWORD_NOT_CACHED')" href="../../../_constants/AUTH_PASSWORD_NOT_CACHED.html" onMouseOver="constPopup(event,'AUTH_PASSWORD_NOT_CACHED')">AUTH_PASSWORD_NOT_CACHED</a>;
<a name="l1170"><span class="linenum">1170</span></a>  
<a name="l1171"><span class="linenum">1171</span></a>  <span class="comment">                // If Moodle is responsible for storing/validating pwd and reset functionality is available, mark</span>
<a name="l1172"><span class="linenum">1172</span></a>                  } else if (<a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../../../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('isinternal')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../../../_variables/isinternal.html">isinternal</a> and <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../../../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('canresetpwd')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../../../_variables/canresetpwd.html">canresetpwd</a>) {
<a name="l1173"><span class="linenum">1173</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/password.html">password</a> = 'restored';
<a name="l1174"><span class="linenum">1174</span></a>                  }
<a name="l1175"><span class="linenum">1175</span></a>              }
<a name="l1176"><span class="linenum">1176</span></a>  
<a name="l1177"><span class="linenum">1177</span></a>  <span class="comment">            // Creating new user, we must reset the policyagreed always</span>
<a name="l1178"><span class="linenum">1178</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('policyagreed')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/policyagreed.html">policyagreed</a> = 0;
<a name="l1179"><span class="linenum">1179</span></a>  
<a name="l1180"><span class="linenum">1180</span></a>  <span class="comment">            // Set time created if empty</span>
<a name="l1181"><span class="linenum">1181</span></a>              if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/timecreated.html">timecreated</a>)) {
<a name="l1182"><span class="linenum">1182</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1183"><span class="linenum">1183</span></a>              }
<a name="l1184"><span class="linenum">1184</span></a>  
<a name="l1185"><span class="linenum">1185</span></a>  <span class="comment">            // Done, let's create the user and annotate its id</span>
<a name="l1186"><span class="linenum">1186</span></a>              <a class="var it15410" onMouseOver="hilite(15410)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../../../_variables/newuserid.html">$newuserid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('user', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>);
<a name="l1187"><span class="linenum">1187</span></a>              self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'user', <a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>-&gt;<a onClick="logVariable('itemid')" class="var it45175" onMouseOver="hilite(45175)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>, <a class="var it15410" onMouseOver="hilite(15410)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../../../_variables/newuserid.html">$newuserid</a>);
<a name="l1188"><span class="linenum">1188</span></a>  <span class="comment">            // Let's create the user context and annotate it (we need it for sure at least for files)</span>
<a name="l1189"><span class="linenum">1189</span></a>  <span class="comment">            // but for deleted users that don't have a context anymore (MDL-30192). We are done for them</span>
<a name="l1190"><span class="linenum">1190</span></a>  <span class="comment">            // and nothing else (custom fields, prefs, tags, files...) will be created.</span>
<a name="l1191"><span class="linenum">1191</span></a>              if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('deleted')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/deleted.html">deleted</a>)) {
<a name="l1192"><span class="linenum">1192</span></a>                  <a class="var it38876" onMouseOver="hilite(38876)" onMouseOut="lolite()" onClick="logVariable('newuserctxid')" href="../../../_variables/newuserctxid.html">$newuserctxid</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('deleted')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/deleted.html">deleted</a> ? 0 : <a class="class" onClick="logClass('context_user')" href="../../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it15410" onMouseOver="hilite(15410)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../../../_variables/newuserid.html">$newuserid</a>)-&gt;id;
<a name="l1193"><span class="linenum">1193</span></a>                  self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'context', <a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>-&gt;<a onClick="logVariable('parentitemid')" class="var it45175" onMouseOver="hilite(45175)" onMouseOut="lolite()" href="../../../_variables/parentitemid.html">parentitemid</a>, <a class="var it38876" onMouseOver="hilite(38876)" onMouseOut="lolite()" onClick="logVariable('newuserctxid')" href="../../../_variables/newuserctxid.html">$newuserctxid</a>);
<a name="l1194"><span class="linenum">1194</span></a>  
<a name="l1195"><span class="linenum">1195</span></a>  <span class="comment">                // Process custom fields</span>
<a name="l1196"><span class="linenum">1196</span></a>                  if (isset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('custom_fields')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/custom_fields.html">custom_fields</a>)) { // if present in backup
<a name="l1197"><span class="linenum">1197</span></a>                      foreach(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('custom_fields')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/custom_fields.html">custom_fields</a>['custom_field'] as <a class="var it38878" onMouseOver="hilite(38878)" onMouseOut="lolite()" onClick="logVariable('udata')" href="../../../_variables/udata.html">$udata</a>) {
<a name="l1198"><span class="linenum">1198</span></a>                          <a class="var it38878" onMouseOver="hilite(38878)" onMouseOut="lolite()" onClick="logVariable('udata')" href="../../../_variables/udata.html">$udata</a> = (object)<a class="var it38878" onMouseOver="hilite(38878)" onMouseOut="lolite()" onClick="logVariable('udata')" href="../../../_variables/udata.html">$udata</a>;
<a name="l1199"><span class="linenum">1199</span></a>  <span class="comment">                        // If the profile field has data and the profile shortname-datatype is defined in server</span>
<a name="l1200"><span class="linenum">1200</span></a>                          if (<a class="var it38878" onMouseOver="hilite(38878)" onMouseOut="lolite()" onClick="logVariable('udata')" href="../../../_variables/udata.html">$udata</a>-&gt;<a onClick="logVariable('field_data')" class="var it45176" onMouseOver="hilite(45176)" onMouseOut="lolite()" href="../../../_variables/field_data.html">field_data</a>) {
<a name="l1201"><span class="linenum">1201</span></a>                              if (<a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../../_variables/field.html">$field</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user_info_field', array('shortname'=&gt;<a class="var it38878" onMouseOver="hilite(38878)" onMouseOut="lolite()" onClick="logVariable('udata')" href="../../../_variables/udata.html">$udata</a>-&gt;<a onClick="logVariable('field_name')" class="var it45176" onMouseOver="hilite(45176)" onMouseOut="lolite()" href="../../../_variables/field_name.html">field_name</a>, 'datatype'=&gt;<a class="var it38878" onMouseOver="hilite(38878)" onMouseOut="lolite()" onClick="logVariable('udata')" href="../../../_variables/udata.html">$udata</a>-&gt;<a onClick="logVariable('field_type')" class="var it45176" onMouseOver="hilite(45176)" onMouseOut="lolite()" href="../../../_variables/field_type.html">field_type</a>))) {
<a name="l1202"><span class="linenum">1202</span></a>  <span class="comment">                            /// Insert the user_custom_profile_field</span>
<a name="l1203"><span class="linenum">1203</span></a>                                  <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = new stdClass();
<a name="l1204"><span class="linenum">1204</span></a>                                  <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('userid')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a>  = <a class="var it15410" onMouseOver="hilite(15410)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../../../_variables/newuserid.html">$newuserid</a>;
<a name="l1205"><span class="linenum">1205</span></a>                                  <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('fieldid')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/fieldid.html">fieldid</a> = <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../../_variables/field.html">$field</a>-&gt;<a onClick="logVariable('id')" class="var it43302" onMouseOver="hilite(43302)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1206"><span class="linenum">1206</span></a>                                  <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('data')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/data.html">data</a>    = <a class="var it38878" onMouseOver="hilite(38878)" onMouseOut="lolite()" onClick="logVariable('udata')" href="../../../_variables/udata.html">$udata</a>-&gt;<a onClick="logVariable('field_data')" class="var it45176" onMouseOver="hilite(45176)" onMouseOut="lolite()" href="../../../_variables/field_data.html">field_data</a>;
<a name="l1207"><span class="linenum">1207</span></a>                                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('user_info_data', <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>);
<a name="l1208"><span class="linenum">1208</span></a>                              }
<a name="l1209"><span class="linenum">1209</span></a>                          }
<a name="l1210"><span class="linenum">1210</span></a>                      }
<a name="l1211"><span class="linenum">1211</span></a>                  }
<a name="l1212"><span class="linenum">1212</span></a>  
<a name="l1213"><span class="linenum">1213</span></a>  <span class="comment">                // Process tags</span>
<a name="l1214"><span class="linenum">1214</span></a>                  if (<a class="class" onClick="logClass('core_tag_tag')" href="../../../_classes/core_tag_tag.html" onMouseOver="classPopup(event,'core_tag_tag')">core_tag_tag</a>::<a class="function" onClick="logFunction('is_enabled')" href="../../../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>('core', 'user') &amp;&amp; isset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('tags')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/tags.html">tags</a>)) { // If enabled in server and present in backup.
<a name="l1215"><span class="linenum">1215</span></a>                      <a class="var it2145" onMouseOver="hilite(2145)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../../_variables/tags.html">$tags</a> = array();
<a name="l1216"><span class="linenum">1216</span></a>                      foreach(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('tags')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/tags.html">tags</a>['tag'] as <a class="var it38879" onMouseOver="hilite(38879)" onMouseOut="lolite()" onClick="logVariable('usertag')" href="../../../_variables/usertag.html">$usertag</a>) {
<a name="l1217"><span class="linenum">1217</span></a>                          <a class="var it38879" onMouseOver="hilite(38879)" onMouseOut="lolite()" onClick="logVariable('usertag')" href="../../../_variables/usertag.html">$usertag</a> = (object)<a class="var it38879" onMouseOver="hilite(38879)" onMouseOut="lolite()" onClick="logVariable('usertag')" href="../../../_variables/usertag.html">$usertag</a>;
<a name="l1218"><span class="linenum">1218</span></a>                          <a class="var it2145" onMouseOver="hilite(2145)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../../_variables/tags.html">$tags</a>[] = <a class="var it38879" onMouseOver="hilite(38879)" onMouseOut="lolite()" onClick="logVariable('usertag')" href="../../../_variables/usertag.html">$usertag</a>-&gt;<a onClick="logVariable('rawname')" class="var it45177" onMouseOver="hilite(45177)" onMouseOut="lolite()" href="../../../_variables/rawname.html">rawname</a>;
<a name="l1219"><span class="linenum">1219</span></a>                      }
<a name="l1220"><span class="linenum">1220</span></a>                      <a class="class" onClick="logClass('core_tag_tag')" href="../../../_classes/core_tag_tag.html" onMouseOver="classPopup(event,'core_tag_tag')">core_tag_tag</a>::<a class="function" onClick="logFunction('set_item_tags')" href="../../../_functions/set_item_tags.html" onMouseOver="funcPopup(event,'set_item_tags')">set_item_tags</a>('core', 'user', <a class="var it15410" onMouseOver="hilite(15410)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../../../_variables/newuserid.html">$newuserid</a>,
<a name="l1221"><span class="linenum">1221</span></a>                              <a class="class" onClick="logClass('context_user')" href="../../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it15410" onMouseOver="hilite(15410)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../../../_variables/newuserid.html">$newuserid</a>), <a class="var it2145" onMouseOver="hilite(2145)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../../_variables/tags.html">$tags</a>);
<a name="l1222"><span class="linenum">1222</span></a>                  }
<a name="l1223"><span class="linenum">1223</span></a>  
<a name="l1224"><span class="linenum">1224</span></a>  <span class="comment">                // Process preferences</span>
<a name="l1225"><span class="linenum">1225</span></a>                  if (isset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('preferences')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/preferences.html">preferences</a>)) { // if present in backup
<a name="l1226"><span class="linenum">1226</span></a>                      foreach(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('preferences')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/preferences.html">preferences</a>['preference'] as <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>) {
<a name="l1227"><span class="linenum">1227</span></a>                          <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a> = (object)<a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>;
<a name="l1228"><span class="linenum">1228</span></a>  <span class="comment">                        // Prepare the record and insert it</span>
<a name="l1229"><span class="linenum">1229</span></a>                          <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>-&gt;<a onClick="logVariable('userid')" class="var it44283" onMouseOver="hilite(44283)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a> = <a class="var it15410" onMouseOver="hilite(15410)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../../../_variables/newuserid.html">$newuserid</a>;
<a name="l1230"><span class="linenum">1230</span></a>                          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('user_preferences', <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>);
<a name="l1231"><span class="linenum">1231</span></a>                      }
<a name="l1232"><span class="linenum">1232</span></a>                  }
<a name="l1233"><span class="linenum">1233</span></a>  <span class="comment">                // Special handling for htmleditor which was converted to a preference.</span>
<a name="l1234"><span class="linenum">1234</span></a>                  if (isset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('htmleditor')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/htmleditor.html">htmleditor</a>)) {
<a name="l1235"><span class="linenum">1235</span></a>                      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('htmleditor')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/htmleditor.html">htmleditor</a> == 0) {
<a name="l1236"><span class="linenum">1236</span></a>                          <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a> = new stdClass();
<a name="l1237"><span class="linenum">1237</span></a>                          <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>-&gt;<a onClick="logVariable('userid')" class="var it44283" onMouseOver="hilite(44283)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a> = <a class="var it15410" onMouseOver="hilite(15410)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../../../_variables/newuserid.html">$newuserid</a>;
<a name="l1238"><span class="linenum">1238</span></a>                          <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>-&gt;<a onClick="logVariable('name')" class="var it44283" onMouseOver="hilite(44283)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> = 'htmleditor';
<a name="l1239"><span class="linenum">1239</span></a>                          <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>-&gt;<a onClick="logVariable('value')" class="var it44283" onMouseOver="hilite(44283)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a> = 'textarea';
<a name="l1240"><span class="linenum">1240</span></a>                          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('user_preferences', <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>);
<a name="l1241"><span class="linenum">1241</span></a>                      }
<a name="l1242"><span class="linenum">1242</span></a>                  }
<a name="l1243"><span class="linenum">1243</span></a>  
<a name="l1244"><span class="linenum">1244</span></a>  <span class="comment">                // Create user files in pool (profile, icon, private) by context</span>
<a name="l1245"><span class="linenum">1245</span></a>                  restore_dbops::<a class="function" onClick="logFunction('send_files_to_pool')" href="../../../_functions/send_files_to_pool.html" onMouseOver="funcPopup(event,'send_files_to_pool')">send_files_to_pool</a>(<a class="var it2356" onMouseOver="hilite(2356)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../../_variables/basepath.html">$basepath</a>, <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'user', 'icon',
<a name="l1246"><span class="linenum">1246</span></a>                          <a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>-&gt;<a onClick="logVariable('parentitemid')" class="var it45175" onMouseOver="hilite(45175)" onMouseOut="lolite()" href="../../../_variables/parentitemid.html">parentitemid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, null, null, null, false, <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>);
<a name="l1247"><span class="linenum">1247</span></a>                  restore_dbops::<a class="function" onClick="logFunction('send_files_to_pool')" href="../../../_functions/send_files_to_pool.html" onMouseOver="funcPopup(event,'send_files_to_pool')">send_files_to_pool</a>(<a class="var it2356" onMouseOver="hilite(2356)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../../_variables/basepath.html">$basepath</a>, <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'user', 'profile',
<a name="l1248"><span class="linenum">1248</span></a>                          <a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>-&gt;<a onClick="logVariable('parentitemid')" class="var it45175" onMouseOver="hilite(45175)" onMouseOut="lolite()" href="../../../_variables/parentitemid.html">parentitemid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, null, null, null, false, <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>);
<a name="l1249"><span class="linenum">1249</span></a>              }
<a name="l1250"><span class="linenum">1250</span></a>          }
<a name="l1251"><span class="linenum">1251</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1252"><span class="linenum">1252</span></a>          <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l1253"><span class="linenum">1253</span></a>      }
<a name="l1254"><span class="linenum">1254</span></a>  
<a name="l1255"><span class="linenum">1255</span></a>      <span class="comment">/**</span>
<a name="l1256"><span class="linenum">1256</span></a>  <span class="comment">    * Given one user object (from backup file), perform all the neccesary</span>
<a name="l1257"><span class="linenum">1257</span></a>  <span class="comment">    * checks is order to decide how that user will be handled on restore.</span>
<a name="l1258"><span class="linenum">1258</span></a>  <span class="comment">    *</span>
<a name="l1259"><span class="linenum">1259</span></a>  <span class="comment">    * Note the function requires $user-&gt;mnethostid to be already calculated</span>
<a name="l1260"><span class="linenum">1260</span></a>  <span class="comment">    * so it's caller responsibility to set it</span>
<a name="l1261"><span class="linenum">1261</span></a>  <span class="comment">    *</span>
<a name="l1262"><span class="linenum">1262</span></a>  <span class="comment">    * This function is used both by @restore_precheck_users() and</span>
<a name="l1263"><span class="linenum">1263</span></a>  <span class="comment">    * @restore_create_users() to get consistent results in both places</span>
<a name="l1264"><span class="linenum">1264</span></a>  <span class="comment">    *</span>
<a name="l1265"><span class="linenum">1265</span></a>  <span class="comment">    * It returns:</span>
<a name="l1266"><span class="linenum">1266</span></a>  <span class="comment">    *   - one user object (from DB), if match has been found and user will be remapped</span>
<a name="l1267"><span class="linenum">1267</span></a>  <span class="comment">    *   - boolean true if the user needs to be created</span>
<a name="l1268"><span class="linenum">1268</span></a>  <span class="comment">    *   - boolean false if some conflict happened and the user cannot be handled</span>
<a name="l1269"><span class="linenum">1269</span></a>  <span class="comment">    *</span>
<a name="l1270"><span class="linenum">1270</span></a>  <span class="comment">    * Each test is responsible for returning its results and interrupt</span>
<a name="l1271"><span class="linenum">1271</span></a>  <span class="comment">    * execution. At the end, boolean true (user needs to be created) will be</span>
<a name="l1272"><span class="linenum">1272</span></a>  <span class="comment">    * returned if no test has interrupted that.</span>
<a name="l1273"><span class="linenum">1273</span></a>  <span class="comment">    *</span>
<a name="l1274"><span class="linenum">1274</span></a>  <span class="comment">    * Here it's the logic applied, keep it updated:</span>
<a name="l1275"><span class="linenum">1275</span></a>  <span class="comment">    *</span>
<a name="l1276"><span class="linenum">1276</span></a>  <span class="comment">    *  If restoring users from same site backup:</span>
<a name="l1277"><span class="linenum">1277</span></a>  <span class="comment">    *      1A - Normal check: If match by id and username and mnethost  =&gt; ok, return target user</span>
<a name="l1278"><span class="linenum">1278</span></a>  <span class="comment">    *      1B - If restoring an 'anonymous' user (created via the 'Anonymize user information' option) try to find a</span>
<a name="l1279"><span class="linenum">1279</span></a>  <span class="comment">    *           match by username only =&gt; ok, return target user MDL-31484</span>
<a name="l1280"><span class="linenum">1280</span></a>  <span class="comment">    *      1C - Handle users deleted in DB and &quot;alive&quot; in backup file:</span>
<a name="l1281"><span class="linenum">1281</span></a>  <span class="comment">    *           If match by id and mnethost and user is deleted in DB and</span>
<a name="l1282"><span class="linenum">1282</span></a>  <span class="comment">    *           (match by username LIKE 'backup_email.%' or by non empty email = md5(username)) =&gt; ok, return target user</span>
<a name="l1283"><span class="linenum">1283</span></a>  <span class="comment">    *      1D - Handle users deleted in backup file and &quot;alive&quot; in DB:</span>
<a name="l1284"><span class="linenum">1284</span></a>  <span class="comment">    *           If match by id and mnethost and user is deleted in backup file</span>
<a name="l1285"><span class="linenum">1285</span></a>  <span class="comment">    *           and match by email = email_without_time(backup_email) =&gt; ok, return target user</span>
<a name="l1286"><span class="linenum">1286</span></a>  <span class="comment">    *      1E - Conflict: If match by username and mnethost and doesn't match by id =&gt; conflict, return false</span>
<a name="l1287"><span class="linenum">1287</span></a>  <span class="comment">    *      1F - None of the above, return true =&gt; User needs to be created</span>
<a name="l1288"><span class="linenum">1288</span></a>  <span class="comment">    *</span>
<a name="l1289"><span class="linenum">1289</span></a>  <span class="comment">    *  if restoring from another site backup (cannot match by id here, replace it by email/firstaccess combination):</span>
<a name="l1290"><span class="linenum">1290</span></a>  <span class="comment">    *      2A - Normal check:</span>
<a name="l1291"><span class="linenum">1291</span></a>  <span class="comment">    *           2A1 - If match by username and mnethost and (email or non-zero firstaccess) =&gt; ok, return target user</span>
<a name="l1292"><span class="linenum">1292</span></a>  <span class="comment">    *           2A2 - Exceptional handling (MDL-21912): Match &quot;admin&quot; username. Then, if import_general_duplicate_admin_allowed is</span>
<a name="l1293"><span class="linenum">1293</span></a>  <span class="comment">    *                 enabled, attempt to map the admin user to the user 'admin_[oldsiteid]' if it exists. If not,</span>
<a name="l1294"><span class="linenum">1294</span></a>  <span class="comment">    *                 the user 'admin_[oldsiteid]' will be created in precheck_included users</span>
<a name="l1295"><span class="linenum">1295</span></a>  <span class="comment">    *      2B - Handle users deleted in DB and &quot;alive&quot; in backup file:</span>
<a name="l1296"><span class="linenum">1296</span></a>  <span class="comment">    *           2B1 - If match by mnethost and user is deleted in DB and not empty email = md5(username) and</span>
<a name="l1297"><span class="linenum">1297</span></a>  <span class="comment">    *                 (username LIKE 'backup_email.%' or non-zero firstaccess) =&gt; ok, return target user</span>
<a name="l1298"><span class="linenum">1298</span></a>  <span class="comment">    *           2B2 - If match by mnethost and user is deleted in DB and</span>
<a name="l1299"><span class="linenum">1299</span></a>  <span class="comment">    *                 username LIKE 'backup_email.%' and non-zero firstaccess) =&gt; ok, return target user</span>
<a name="l1300"><span class="linenum">1300</span></a>  <span class="comment">    *                 (to cover situations were md5(username) wasn't implemented on delete we requiere both)</span>
<a name="l1301"><span class="linenum">1301</span></a>  <span class="comment">    *      2C - Handle users deleted in backup file and &quot;alive&quot; in DB:</span>
<a name="l1302"><span class="linenum">1302</span></a>  <span class="comment">    *           If match mnethost and user is deleted in backup file</span>
<a name="l1303"><span class="linenum">1303</span></a>  <span class="comment">    *           and by email = email_without_time(backup_email) and non-zero firstaccess=&gt; ok, return target user</span>
<a name="l1304"><span class="linenum">1304</span></a>  <span class="comment">    *      2D - Conflict: If match by username and mnethost and not by (email or non-zero firstaccess) =&gt; conflict, return false</span>
<a name="l1305"><span class="linenum">1305</span></a>  <span class="comment">    *      2E - None of the above, return true =&gt; User needs to be created</span>
<a name="l1306"><span class="linenum">1306</span></a>  <span class="comment">    *</span>
<a name="l1307"><span class="linenum">1307</span></a>  <span class="comment">    * Note: for DB deleted users email is stored in username field, hence we</span>
<a name="l1308"><span class="linenum">1308</span></a>  <span class="comment">    *       are looking there for emails. See delete_user()</span>
<a name="l1309"><span class="linenum">1309</span></a>  <span class="comment">    * Note: for DB deleted users md5(username) is stored *sometimes* in the email field,</span>
<a name="l1310"><span class="linenum">1310</span></a>  <span class="comment">    *       hence we are looking there for usernames if not empty. See delete_user()</span>
<a name="l1311"><span class="linenum">1311</span></a>  <span class="comment">    */</span>
<a name="l1312"><span class="linenum">1312</span></a>      protected static function <a class="function" onClick="logFunction('precheck_user')" href="../../../_functions/precheck_user.html" onMouseOver="funcPopup(event,'precheck_user')">precheck_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="var it38881" onMouseOver="hilite(38881)" onMouseOut="lolite()" onClick="logVariable('siteid')" href="../../../_variables/siteid.html">$siteid</a> = null) {
<a name="l1313"><span class="linenum">1313</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1314"><span class="linenum">1314</span></a>  
<a name="l1315"><span class="linenum">1315</span></a>  <span class="comment">        // Handle checks from same site backups</span>
<a name="l1316"><span class="linenum">1316</span></a>          if (<a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a> &amp;&amp; empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forcedifferentsitecheckingusersonrestore')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/forcedifferentsitecheckingusersonrestore.html">forcedifferentsitecheckingusersonrestore</a>)) {
<a name="l1317"><span class="linenum">1317</span></a>  
<a name="l1318"><span class="linenum">1318</span></a>  <span class="comment">            // 1A - If match by id and username and mnethost =&gt; ok, return target user</span>
<a name="l1319"><span class="linenum">1319</span></a>              if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 'username'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>, 'mnethostid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a>))) {
<a name="l1320"><span class="linenum">1320</span></a>                  return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>; <span class="comment">// Matching user found, return it</span>
<a name="l1321"><span class="linenum">1321</span></a>              }
<a name="l1322"><span class="linenum">1322</span></a>  
<a name="l1323"><span class="linenum">1323</span></a>  <span class="comment">            // 1B - If restoring an 'anonymous' user (created via the 'Anonymize user information' option) try to find a</span>
<a name="l1324"><span class="linenum">1324</span></a>  <span class="comment">            // match by username only =&gt; ok, return target user MDL-31484</span>
<a name="l1325"><span class="linenum">1325</span></a>  <span class="comment">            // This avoids username / id mis-match problems when restoring subsequent anonymized backups.</span>
<a name="l1326"><span class="linenum">1326</span></a>              if (<a class="class" onClick="logClass('backup_anonymizer_helper')" href="../../../_classes/backup_anonymizer_helper.html" onMouseOver="classPopup(event,'backup_anonymizer_helper')">backup_anonymizer_helper</a>::<a class="function" onClick="logFunction('is_anonymous_user')" href="../../../_functions/is_anonymous_user.html" onMouseOver="funcPopup(event,'is_anonymous_user')">is_anonymous_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>)) {
<a name="l1327"><span class="linenum">1327</span></a>                  if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('username' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>))) {
<a name="l1328"><span class="linenum">1328</span></a>                      return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>; <span class="comment">// Matching anonymous user found - return it</span>
<a name="l1329"><span class="linenum">1329</span></a>                  }
<a name="l1330"><span class="linenum">1330</span></a>              }
<a name="l1331"><span class="linenum">1331</span></a>  
<a name="l1332"><span class="linenum">1332</span></a>  <span class="comment">            // 1C - Handle users deleted in DB and &quot;alive&quot; in backup file</span>
<a name="l1333"><span class="linenum">1333</span></a>  <span class="comment">            // Note: for DB deleted users email is stored in username field, hence we</span>
<a name="l1334"><span class="linenum">1334</span></a>  <span class="comment">            //       are looking there for emails. See delete_user()</span>
<a name="l1335"><span class="linenum">1335</span></a>  <span class="comment">            // Note: for DB deleted users md5(username) is stored *sometimes* in the email field,</span>
<a name="l1336"><span class="linenum">1336</span></a>  <span class="comment">            //       hence we are looking there for usernames if not empty. See delete_user()</span>
<a name="l1337"><span class="linenum">1337</span></a>  <span class="comment">            // If match by id and mnethost and user is deleted in DB and</span>
<a name="l1338"><span class="linenum">1338</span></a>  <span class="comment">            // match by username LIKE 'backup_email.%' or by non empty email = md5(username) =&gt; ok, return target user</span>
<a name="l1339"><span class="linenum">1339</span></a>              if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT *
<a name="l1340"><span class="linenum">1340</span></a>                                                FROM {user} u
<a name="l1341"><span class="linenum">1341</span></a>                                               WHERE id = ?
<a name="l1342"><span class="linenum">1342</span></a>                                                 AND mnethostid = ?
<a name="l1343"><span class="linenum">1343</span></a>                                                 AND deleted = 1
<a name="l1344"><span class="linenum">1344</span></a>                                                 AND (
<a name="l1345"><span class="linenum">1345</span></a>                                                         <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(username) LIKE <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(?)
<a name="l1346"><span class="linenum">1346</span></a>                                                      <a class="function" onClick="logFunction('OR')" href="../../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (
<a name="l1347"><span class="linenum">1347</span></a>                                                             &quot;.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_isnotempty')" href="../../../_functions/sql_isnotempty.html" onMouseOver="funcPopup(event,'sql_isnotempty')">sql_isnotempty</a>('user', 'email', false, false).&quot;
<a name="l1348"><span class="linenum">1348</span></a>                                                         AND email = ?
<a name="l1349"><span class="linenum">1349</span></a>                                                         )
<a name="l1350"><span class="linenum">1350</span></a>                                                     )&quot;,
<a name="l1351"><span class="linenum">1351</span></a>                                             array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a>.'.%', md5(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>)))) {
<a name="l1352"><span class="linenum">1352</span></a>                  return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>; <span class="comment">// Matching user, deleted in DB found, return it</span>
<a name="l1353"><span class="linenum">1353</span></a>              }
<a name="l1354"><span class="linenum">1354</span></a>  
<a name="l1355"><span class="linenum">1355</span></a>  <span class="comment">            // 1D - Handle users deleted in backup file and &quot;alive&quot; in DB</span>
<a name="l1356"><span class="linenum">1356</span></a>  <span class="comment">            // If match by id and mnethost and user is deleted in backup file</span>
<a name="l1357"><span class="linenum">1357</span></a>  <span class="comment">            // and match by email = email_without_time(backup_email) =&gt; ok, return target user</span>
<a name="l1358"><span class="linenum">1358</span></a>              if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('deleted')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/deleted.html">deleted</a>) {
<a name="l1359"><span class="linenum">1359</span></a>  <span class="comment">                // Note: for DB deleted users email is stored in username field, hence we</span>
<a name="l1360"><span class="linenum">1360</span></a>  <span class="comment">                //       are looking there for emails. See delete_user()</span>
<a name="l1361"><span class="linenum">1361</span></a>  <span class="comment">                // Trim time() from email</span>
<a name="l1362"><span class="linenum">1362</span></a>                  <a class="var it38883" onMouseOver="hilite(38883)" onMouseOut="lolite()" onClick="logVariable('trimemail')" href="../../../_variables/trimemail.html">$trimemail</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/(.*?)\.[0-9]+.?$/', '\\1', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>);
<a name="l1363"><span class="linenum">1363</span></a>                  if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT *
<a name="l1364"><span class="linenum">1364</span></a>                                                    FROM {user} u
<a name="l1365"><span class="linenum">1365</span></a>                                                   WHERE id = ?
<a name="l1366"><span class="linenum">1366</span></a>                                                     AND mnethostid = ?
<a name="l1367"><span class="linenum">1367</span></a>                                                     AND <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(email) = <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(?)&quot;,
<a name="l1368"><span class="linenum">1368</span></a>                                                 array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a>, <a class="var it38883" onMouseOver="hilite(38883)" onMouseOut="lolite()" onClick="logVariable('trimemail')" href="../../../_variables/trimemail.html">$trimemail</a>))) {
<a name="l1369"><span class="linenum">1369</span></a>                      return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>; <span class="comment">// Matching user, deleted in backup file found, return it</span>
<a name="l1370"><span class="linenum">1370</span></a>                  }
<a name="l1371"><span class="linenum">1371</span></a>              }
<a name="l1372"><span class="linenum">1372</span></a>  
<a name="l1373"><span class="linenum">1373</span></a>  <span class="comment">            // 1E - If match by username and mnethost and doesn't match by id =&gt; conflict, return false</span>
<a name="l1374"><span class="linenum">1374</span></a>              if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('username'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>, 'mnethostid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a>))) {
<a name="l1375"><span class="linenum">1375</span></a>                  if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> != <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it43253" onMouseOver="hilite(43253)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>) {
<a name="l1376"><span class="linenum">1376</span></a>                      return false; <span class="comment">// Conflict, username already exists and belongs to another id</span>
<a name="l1377"><span class="linenum">1377</span></a>                  }
<a name="l1378"><span class="linenum">1378</span></a>              }
<a name="l1379"><span class="linenum">1379</span></a>  
<a name="l1380"><span class="linenum">1380</span></a>  <span class="comment">        // Handle checks from different site backups</span>
<a name="l1381"><span class="linenum">1381</span></a>          } else {
<a name="l1382"><span class="linenum">1382</span></a>  
<a name="l1383"><span class="linenum">1383</span></a>  <span class="comment">            // 2A1 - If match by username and mnethost and</span>
<a name="l1384"><span class="linenum">1384</span></a>  <span class="comment">            //     (email or non-zero firstaccess) =&gt; ok, return target user</span>
<a name="l1385"><span class="linenum">1385</span></a>              if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT *
<a name="l1386"><span class="linenum">1386</span></a>                                                FROM {user} u
<a name="l1387"><span class="linenum">1387</span></a>                                               WHERE username = ?
<a name="l1388"><span class="linenum">1388</span></a>                                                 AND mnethostid = ?
<a name="l1389"><span class="linenum">1389</span></a>                                                 AND (
<a name="l1390"><span class="linenum">1390</span></a>                                                         <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(email) = <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(?)
<a name="l1391"><span class="linenum">1391</span></a>                                                      <a class="function" onClick="logFunction('OR')" href="../../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (
<a name="l1392"><span class="linenum">1392</span></a>                                                             firstaccess != 0
<a name="l1393"><span class="linenum">1393</span></a>                                                         AND firstaccess = ?
<a name="l1394"><span class="linenum">1394</span></a>                                                         )
<a name="l1395"><span class="linenum">1395</span></a>                                                     )&quot;,
<a name="l1396"><span class="linenum">1396</span></a>                                             array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstaccess')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/firstaccess.html">firstaccess</a>))) {
<a name="l1397"><span class="linenum">1397</span></a>                  return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>; <span class="comment">// Matching user found, return it</span>
<a name="l1398"><span class="linenum">1398</span></a>              }
<a name="l1399"><span class="linenum">1399</span></a>  
<a name="l1400"><span class="linenum">1400</span></a>  <span class="comment">            // 2A2 - If we're allowing conflicting admins, attempt to map user to admin_[oldsiteid].</span>
<a name="l1401"><span class="linenum">1401</span></a>              if (<a class="function" onClick="logFunction('get_config')" href="../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup', 'import_general_duplicate_admin_allowed') &amp;&amp; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a> === 'admin' &amp;&amp; <a class="var it38881" onMouseOver="hilite(38881)" onMouseOut="lolite()" onClick="logVariable('siteid')" href="../../../_variables/siteid.html">$siteid</a>
<a name="l1402"><span class="linenum">1402</span></a>                      &amp;&amp; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a> == <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>) {
<a name="l1403"><span class="linenum">1403</span></a>                  if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('username' =&gt; 'admin_' . <a class="var it38881" onMouseOver="hilite(38881)" onMouseOut="lolite()" onClick="logVariable('siteid')" href="../../../_variables/siteid.html">$siteid</a>))) {
<a name="l1404"><span class="linenum">1404</span></a>                      return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>;
<a name="l1405"><span class="linenum">1405</span></a>                  }
<a name="l1406"><span class="linenum">1406</span></a>              }
<a name="l1407"><span class="linenum">1407</span></a>  
<a name="l1408"><span class="linenum">1408</span></a>  <span class="comment">            // 2B - Handle users deleted in DB and &quot;alive&quot; in backup file</span>
<a name="l1409"><span class="linenum">1409</span></a>  <span class="comment">            // Note: for DB deleted users email is stored in username field, hence we</span>
<a name="l1410"><span class="linenum">1410</span></a>  <span class="comment">            //       are looking there for emails. See delete_user()</span>
<a name="l1411"><span class="linenum">1411</span></a>  <span class="comment">            // Note: for DB deleted users md5(username) is stored *sometimes* in the email field,</span>
<a name="l1412"><span class="linenum">1412</span></a>  <span class="comment">            //       hence we are looking there for usernames if not empty. See delete_user()</span>
<a name="l1413"><span class="linenum">1413</span></a>  <span class="comment">            // 2B1 - If match by mnethost and user is deleted in DB and not empty email = md5(username) and</span>
<a name="l1414"><span class="linenum">1414</span></a>  <span class="comment">            //       (by username LIKE 'backup_email.%' or non-zero firstaccess) =&gt; ok, return target user</span>
<a name="l1415"><span class="linenum">1415</span></a>              if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT *
<a name="l1416"><span class="linenum">1416</span></a>                                                FROM {user} u
<a name="l1417"><span class="linenum">1417</span></a>                                               WHERE mnethostid = ?
<a name="l1418"><span class="linenum">1418</span></a>                                                 AND deleted = 1
<a name="l1419"><span class="linenum">1419</span></a>                                                 AND &quot;.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_isnotempty')" href="../../../_functions/sql_isnotempty.html" onMouseOver="funcPopup(event,'sql_isnotempty')">sql_isnotempty</a>('user', 'email', false, false).&quot;
<a name="l1420"><span class="linenum">1420</span></a>                                                 AND email = ?
<a name="l1421"><span class="linenum">1421</span></a>                                                 AND (
<a name="l1422"><span class="linenum">1422</span></a>                                                         <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(username) LIKE <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(?)
<a name="l1423"><span class="linenum">1423</span></a>                                                      <a class="function" onClick="logFunction('OR')" href="../../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (
<a name="l1424"><span class="linenum">1424</span></a>                                                             firstaccess != 0
<a name="l1425"><span class="linenum">1425</span></a>                                                         AND firstaccess = ?
<a name="l1426"><span class="linenum">1426</span></a>                                                         )
<a name="l1427"><span class="linenum">1427</span></a>                                                     )&quot;,
<a name="l1428"><span class="linenum">1428</span></a>                                             array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a>, md5(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>), <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a>.'.%', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstaccess')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/firstaccess.html">firstaccess</a>))) {
<a name="l1429"><span class="linenum">1429</span></a>                  return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>; <span class="comment">// Matching user found, return it</span>
<a name="l1430"><span class="linenum">1430</span></a>              }
<a name="l1431"><span class="linenum">1431</span></a>  
<a name="l1432"><span class="linenum">1432</span></a>  <span class="comment">            // 2B2 - If match by mnethost and user is deleted in DB and</span>
<a name="l1433"><span class="linenum">1433</span></a>  <span class="comment">            //       username LIKE 'backup_email.%' and non-zero firstaccess) =&gt; ok, return target user</span>
<a name="l1434"><span class="linenum">1434</span></a>  <span class="comment">            //       (this covers situations where md5(username) wasn't being stored so we require both</span>
<a name="l1435"><span class="linenum">1435</span></a>  <span class="comment">            //        the email &amp; non-zero firstaccess to match)</span>
<a name="l1436"><span class="linenum">1436</span></a>              if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT *
<a name="l1437"><span class="linenum">1437</span></a>                                                FROM {user} u
<a name="l1438"><span class="linenum">1438</span></a>                                               WHERE mnethostid = ?
<a name="l1439"><span class="linenum">1439</span></a>                                                 AND deleted = 1
<a name="l1440"><span class="linenum">1440</span></a>                                                 AND <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(username) LIKE <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(?)
<a name="l1441"><span class="linenum">1441</span></a>                                                 AND firstaccess != 0
<a name="l1442"><span class="linenum">1442</span></a>                                                 AND firstaccess = ?&quot;,
<a name="l1443"><span class="linenum">1443</span></a>                                             array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a>.'.%', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstaccess')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/firstaccess.html">firstaccess</a>))) {
<a name="l1444"><span class="linenum">1444</span></a>                  return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>; <span class="comment">// Matching user found, return it</span>
<a name="l1445"><span class="linenum">1445</span></a>              }
<a name="l1446"><span class="linenum">1446</span></a>  
<a name="l1447"><span class="linenum">1447</span></a>  <span class="comment">            // 2C - Handle users deleted in backup file and &quot;alive&quot; in DB</span>
<a name="l1448"><span class="linenum">1448</span></a>  <span class="comment">            // If match mnethost and user is deleted in backup file</span>
<a name="l1449"><span class="linenum">1449</span></a>  <span class="comment">            // and match by email = email_without_time(backup_email) and non-zero firstaccess=&gt; ok, return target user</span>
<a name="l1450"><span class="linenum">1450</span></a>              if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('deleted')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/deleted.html">deleted</a>) {
<a name="l1451"><span class="linenum">1451</span></a>  <span class="comment">                // Note: for DB deleted users email is stored in username field, hence we</span>
<a name="l1452"><span class="linenum">1452</span></a>  <span class="comment">                //       are looking there for emails. See delete_user()</span>
<a name="l1453"><span class="linenum">1453</span></a>  <span class="comment">                // Trim time() from email</span>
<a name="l1454"><span class="linenum">1454</span></a>                  <a class="var it38883" onMouseOver="hilite(38883)" onMouseOut="lolite()" onClick="logVariable('trimemail')" href="../../../_variables/trimemail.html">$trimemail</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/(.*?)\.[0-9]+.?$/', '\\1', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>);
<a name="l1455"><span class="linenum">1455</span></a>                  if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT *
<a name="l1456"><span class="linenum">1456</span></a>                                                    FROM {user} u
<a name="l1457"><span class="linenum">1457</span></a>                                                   WHERE mnethostid = ?
<a name="l1458"><span class="linenum">1458</span></a>                                                     AND <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(email) = <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(?)
<a name="l1459"><span class="linenum">1459</span></a>                                                     AND firstaccess != 0
<a name="l1460"><span class="linenum">1460</span></a>                                                     AND firstaccess = ?&quot;,
<a name="l1461"><span class="linenum">1461</span></a>                                                 array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a>, <a class="var it38883" onMouseOver="hilite(38883)" onMouseOut="lolite()" onClick="logVariable('trimemail')" href="../../../_variables/trimemail.html">$trimemail</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstaccess')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/firstaccess.html">firstaccess</a>))) {
<a name="l1462"><span class="linenum">1462</span></a>                      return <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a>; <span class="comment">// Matching user, deleted in backup file found, return it</span>
<a name="l1463"><span class="linenum">1463</span></a>                  }
<a name="l1464"><span class="linenum">1464</span></a>              }
<a name="l1465"><span class="linenum">1465</span></a>  
<a name="l1466"><span class="linenum">1466</span></a>  <span class="comment">            // 2D - If match by username and mnethost and not by (email or non-zero firstaccess) =&gt; conflict, return false</span>
<a name="l1467"><span class="linenum">1467</span></a>              if (<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT *
<a name="l1468"><span class="linenum">1468</span></a>                                                FROM {user} u
<a name="l1469"><span class="linenum">1469</span></a>                                               WHERE username = ?
<a name="l1470"><span class="linenum">1470</span></a>                                                 AND mnethostid = ?
<a name="l1471"><span class="linenum">1471</span></a>                                             AND <a class="function" onClick="logFunction('NOT')" href="../../../_functions/not.html" onMouseOver="funcPopup(event,'not')">NOT</a> (
<a name="l1472"><span class="linenum">1472</span></a>                                                         <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(email) = <a class="function" onClick="logFunction('UPPER')" href="../../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(?)
<a name="l1473"><span class="linenum">1473</span></a>                                                      <a class="function" onClick="logFunction('OR')" href="../../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (
<a name="l1474"><span class="linenum">1474</span></a>                                                             firstaccess != 0
<a name="l1475"><span class="linenum">1475</span></a>                                                         AND firstaccess = ?
<a name="l1476"><span class="linenum">1476</span></a>                                                         )
<a name="l1477"><span class="linenum">1477</span></a>                                                     )&quot;,
<a name="l1478"><span class="linenum">1478</span></a>                                             array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstaccess')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/firstaccess.html">firstaccess</a>))) {
<a name="l1479"><span class="linenum">1479</span></a>                  return false; <span class="comment">// Conflict, username/mnethostid already exist and belong to another user (by email/firstaccess)</span>
<a name="l1480"><span class="linenum">1480</span></a>              }
<a name="l1481"><span class="linenum">1481</span></a>          }
<a name="l1482"><span class="linenum">1482</span></a>  
<a name="l1483"><span class="linenum">1483</span></a>  <span class="comment">        // Arrived here, return true as the user will need to be created and no</span>
<a name="l1484"><span class="linenum">1484</span></a>  <span class="comment">        // conflicts have been found in the logic above. This covers:</span>
<a name="l1485"><span class="linenum">1485</span></a>  <span class="comment">        // 1E - else =&gt; user needs to be created, return true</span>
<a name="l1486"><span class="linenum">1486</span></a>  <span class="comment">        // 2E - else =&gt; user needs to be created, return true</span>
<a name="l1487"><span class="linenum">1487</span></a>          return true;
<a name="l1488"><span class="linenum">1488</span></a>      }
<a name="l1489"><span class="linenum">1489</span></a>  
<a name="l1490"><span class="linenum">1490</span></a>      <span class="comment">/**</span>
<a name="l1491"><span class="linenum">1491</span></a>  <span class="comment">     * Check all the included users, deciding the action to perform</span>
<a name="l1492"><span class="linenum">1492</span></a>  <span class="comment">     * for each one (mapping / creation) and returning one array</span>
<a name="l1493"><span class="linenum">1493</span></a>  <span class="comment">     * of problems in case something is wrong (lack of permissions,</span>
<a name="l1494"><span class="linenum">1494</span></a>  <span class="comment">     * conficts)</span>
<a name="l1495"><span class="linenum">1495</span></a>  <span class="comment">     *</span>
<a name="l1496"><span class="linenum">1496</span></a>  <span class="comment">     * @param string $restoreid Restore id</span>
<a name="l1497"><span class="linenum">1497</span></a>  <span class="comment">     * @param int $courseid Course id</span>
<a name="l1498"><span class="linenum">1498</span></a>  <span class="comment">     * @param int $userid User id</span>
<a name="l1499"><span class="linenum">1499</span></a>  <span class="comment">     * @param bool $samesite True if restore is to same site</span>
<a name="l1500"><span class="linenum">1500</span></a>  <span class="comment">     * @param \core\progress\base $progress Progress reporter</span>
<a name="l1501"><span class="linenum">1501</span></a>  <span class="comment">     */</span>
<a name="l1502"><span class="linenum">1502</span></a>      public static function <a class="function" onClick="logFunction('precheck_included_users')" href="../../../_functions/precheck_included_users.html" onMouseOver="funcPopup(event,'precheck_included_users')">precheck_included_users</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>,
<a name="l1503"><span class="linenum">1503</span></a>              \core\progress\base <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>) {
<a name="l1504"><span class="linenum">1504</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1505"><span class="linenum">1505</span></a>  
<a name="l1506"><span class="linenum">1506</span></a>  <span class="comment">        // To return any problem found</span>
<a name="l1507"><span class="linenum">1507</span></a>          <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a> = array();
<a name="l1508"><span class="linenum">1508</span></a>  
<a name="l1509"><span class="linenum">1509</span></a>  <span class="comment">        // We are going to map mnethostid, so load all the available ones</span>
<a name="l1510"><span class="linenum">1510</span></a>          <a class="var it19956" onMouseOver="hilite(19956)" onMouseOut="lolite()" onClick="logVariable('mnethosts')" href="../../../_variables/mnethosts.html">$mnethosts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('mnet_host', array(), 'wwwroot', 'wwwroot, id');
<a name="l1511"><span class="linenum">1511</span></a>  
<a name="l1512"><span class="linenum">1512</span></a>  <span class="comment">        // Calculate the context we are going to use for capability checking</span>
<a name="l1513"><span class="linenum">1513</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>);
<a name="l1514"><span class="linenum">1514</span></a>  
<a name="l1515"><span class="linenum">1515</span></a>  <span class="comment">        // TODO: Some day we must kill this dependency and change the process</span>
<a name="l1516"><span class="linenum">1516</span></a>  <span class="comment">        // to pass info around without loading a controller copy.</span>
<a name="l1517"><span class="linenum">1517</span></a>  <span class="comment">        // When conflicting users are detected we may need original site info.</span>
<a name="l1518"><span class="linenum">1518</span></a>          <a class="var it2287" onMouseOver="hilite(2287)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../../../_variables/rc.html">$rc</a> = restore_controller_dbops::<a class="function" onClick="logFunction('load_controller')" href="../../../_functions/load_controller.html" onMouseOver="funcPopup(event,'load_controller')">load_controller</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>);
<a name="l1519"><span class="linenum">1519</span></a>          <a class="var it31827" onMouseOver="hilite(31827)" onMouseOut="lolite()" onClick="logVariable('restoreinfo')" href="../../../_variables/restoreinfo.html">$restoreinfo</a> = <a class="var it2287" onMouseOver="hilite(2287)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../../../_variables/rc.html">$rc</a>-&gt;<a class="function" onClick="logFunction('get_info')" href="../../../_functions/get_info.html" onMouseOver="funcPopup(event,'get_info')">get_info</a>();
<a name="l1520"><span class="linenum">1520</span></a>          <a class="var it2287" onMouseOver="hilite(2287)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../../../_variables/rc.html">$rc</a>-&gt;<a class="function" onClick="logFunction('destroy')" href="../../../_functions/destroy.html" onMouseOver="funcPopup(event,'destroy')">destroy</a>(); <span class="comment">// Always need to destroy.</span>
<a name="l1521"><span class="linenum">1521</span></a>  
<a name="l1522"><span class="linenum">1522</span></a>  <span class="comment">        // Calculate if we have perms to create users, by checking:</span>
<a name="l1523"><span class="linenum">1523</span></a>  <span class="comment">        // to 'moodle/restore:createuser' and 'moodle/restore:userinfo'</span>
<a name="l1524"><span class="linenum">1524</span></a>  <span class="comment">        // and also observe $CFG-&gt;disableusercreationonrestore</span>
<a name="l1525"><span class="linenum">1525</span></a>          <a class="var it38884" onMouseOver="hilite(38884)" onMouseOut="lolite()" onClick="logVariable('cancreateuser')" href="../../../_variables/cancreateuser.html">$cancreateuser</a> = false;
<a name="l1526"><span class="linenum">1526</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/restore:createuser', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>) and
<a name="l1527"><span class="linenum">1527</span></a>              <a class="function" onClick="logFunction('has_capability')" href="../../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/restore:userinfo', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>) and
<a name="l1528"><span class="linenum">1528</span></a>              empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('disableusercreationonrestore')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/disableusercreationonrestore.html">disableusercreationonrestore</a>)) { // Can create users
<a name="l1529"><span class="linenum">1529</span></a>  
<a name="l1530"><span class="linenum">1530</span></a>              <a class="var it38884" onMouseOver="hilite(38884)" onMouseOut="lolite()" onClick="logVariable('cancreateuser')" href="../../../_variables/cancreateuser.html">$cancreateuser</a> = true;
<a name="l1531"><span class="linenum">1531</span></a>          }
<a name="l1532"><span class="linenum">1532</span></a>  
<a name="l1533"><span class="linenum">1533</span></a>  <span class="comment">        // Prepare for reporting progress.</span>
<a name="l1534"><span class="linenum">1534</span></a>          <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../../_variables/conditions.html">$conditions</a> = array('backupid' =&gt; <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'itemname' =&gt; 'user');
<a name="l1535"><span class="linenum">1535</span></a>          <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../../_variables/max.html">$max</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('backup_ids_temp', <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../../_variables/conditions.html">$conditions</a>);
<a name="l1536"><span class="linenum">1536</span></a>          <a class="var it552" onMouseOver="hilite(552)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../../_variables/done.html">$done</a> = 0;
<a name="l1537"><span class="linenum">1537</span></a>          <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>('Checking users', <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../../_variables/max.html">$max</a>);
<a name="l1538"><span class="linenum">1538</span></a>  
<a name="l1539"><span class="linenum">1539</span></a>  <span class="comment">        // Iterate over all the included users</span>
<a name="l1540"><span class="linenum">1540</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('backup_ids_temp', <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../../_variables/conditions.html">$conditions</a>, '', 'itemid, info');
<a name="l1541"><span class="linenum">1541</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> as <a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>) {
<a name="l1542"><span class="linenum">1542</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a> = (object)backup_controller_dbops::<a class="function" onClick="logFunction('decode_backup_temp_info')" href="../../../_functions/decode_backup_temp_info.html" onMouseOver="funcPopup(event,'decode_backup_temp_info')">decode_backup_temp_info</a>(<a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>-&gt;<a onClick="logVariable('info')" class="var it45175" onMouseOver="hilite(45175)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>);
<a name="l1543"><span class="linenum">1543</span></a>  
<a name="l1544"><span class="linenum">1544</span></a>  <span class="comment">            // Find the correct mnethostid for user before performing any further check</span>
<a name="l1545"><span class="linenum">1545</span></a>              if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethosturl')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethosturl.html">mnethosturl</a>) || <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethosturl')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethosturl.html">mnethosturl</a> === <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/wwwroot.html">wwwroot</a>) {
<a name="l1546"><span class="linenum">1546</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>;
<a name="l1547"><span class="linenum">1547</span></a>              } else {
<a name="l1548"><span class="linenum">1548</span></a>  <span class="comment">                // fast url-to-id lookups</span>
<a name="l1549"><span class="linenum">1549</span></a>                  if (isset(<a class="var it19956" onMouseOver="hilite(19956)" onMouseOut="lolite()" onClick="logVariable('mnethosts')" href="../../../_variables/mnethosts.html">$mnethosts</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethosturl')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethosturl.html">mnethosturl</a>])) {
<a name="l1550"><span class="linenum">1550</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a> = <a class="var it19956" onMouseOver="hilite(19956)" onMouseOut="lolite()" onClick="logVariable('mnethosts')" href="../../../_variables/mnethosts.html">$mnethosts</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethosturl')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethosturl.html">mnethosturl</a>]-&gt;id;
<a name="l1551"><span class="linenum">1551</span></a>                  } else {
<a name="l1552"><span class="linenum">1552</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>;
<a name="l1553"><span class="linenum">1553</span></a>                  }
<a name="l1554"><span class="linenum">1554</span></a>              }
<a name="l1555"><span class="linenum">1555</span></a>  
<a name="l1556"><span class="linenum">1556</span></a>  <span class="comment">            // Now, precheck that user and, based on returned results, annotate action/problem</span>
<a name="l1557"><span class="linenum">1557</span></a>              <a class="var it38886" onMouseOver="hilite(38886)" onMouseOut="lolite()" onClick="logVariable('usercheck')" href="../../../_variables/usercheck.html">$usercheck</a> = self::<a class="function" onClick="logFunction('precheck_user')" href="../../../_functions/precheck_user.html" onMouseOver="funcPopup(event,'precheck_user')">precheck_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="var it31827" onMouseOver="hilite(31827)" onMouseOut="lolite()" onClick="logVariable('restoreinfo')" href="../../../_variables/restoreinfo.html">$restoreinfo</a>-&gt;<a onClick="logVariable('original_site_identifier_hash')" class="var it45178" onMouseOver="hilite(45178)" onMouseOut="lolite()" href="../../../_variables/original_site_identifier_hash.html">original_site_identifier_hash</a>);
<a name="l1558"><span class="linenum">1558</span></a>  
<a name="l1559"><span class="linenum">1559</span></a>              if (<a class="phpfunction" onClick="logFunction('is_object')" href="../../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it38886" onMouseOver="hilite(38886)" onMouseOut="lolite()" onClick="logVariable('usercheck')" href="../../../_variables/usercheck.html">$usercheck</a>)) { // No problem, we have found one user in DB to be mapped to
<a name="l1560"><span class="linenum">1560</span></a>  <span class="comment">                // Annotate it, for later process. Set newitemid to mapping user-&gt;id</span>
<a name="l1561"><span class="linenum">1561</span></a>                  self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'user', <a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>-&gt;<a onClick="logVariable('itemid')" class="var it45175" onMouseOver="hilite(45175)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>, <a class="var it38886" onMouseOver="hilite(38886)" onMouseOut="lolite()" onClick="logVariable('usercheck')" href="../../../_variables/usercheck.html">$usercheck</a>-&gt;<a onClick="logVariable('id')" class="var it45179" onMouseOver="hilite(45179)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l1562"><span class="linenum">1562</span></a>  
<a name="l1563"><span class="linenum">1563</span></a>              } else if (<a class="var it38886" onMouseOver="hilite(38886)" onMouseOut="lolite()" onClick="logVariable('usercheck')" href="../../../_variables/usercheck.html">$usercheck</a> === false) { // Found conflict, report it as problem
<a name="l1564"><span class="linenum">1564</span></a>                  if (!<a class="function" onClick="logFunction('get_config')" href="../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup', 'import_general_duplicate_admin_allowed')) {
<a name="l1565"><span class="linenum">1565</span></a>                      <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>[] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('restoreuserconflict', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>);
<a name="l1566"><span class="linenum">1566</span></a>                  } else if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a> == 'admin') {
<a name="l1567"><span class="linenum">1567</span></a>                      if (!<a class="var it38884" onMouseOver="hilite(38884)" onMouseOut="lolite()" onClick="logVariable('cancreateuser')" href="../../../_variables/cancreateuser.html">$cancreateuser</a>) {
<a name="l1568"><span class="linenum">1568</span></a>                          <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>[] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('restorecannotcreateuser', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>);
<a name="l1569"><span class="linenum">1569</span></a>                      }
<a name="l1570"><span class="linenum">1570</span></a>                      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/mnethostid.html">mnethostid</a> != <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>) {
<a name="l1571"><span class="linenum">1571</span></a>                          <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>[] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('restoremnethostidmismatch', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>);
<a name="l1572"><span class="linenum">1572</span></a>                      }
<a name="l1573"><span class="linenum">1573</span></a>                      if (!<a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>) {
<a name="l1574"><span class="linenum">1574</span></a>  <span class="comment">                        // Duplicate admin allowed, append original site idenfitier to username.</span>
<a name="l1575"><span class="linenum">1575</span></a>                          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a> .= '_' . <a class="var it31827" onMouseOver="hilite(31827)" onMouseOut="lolite()" onClick="logVariable('restoreinfo')" href="../../../_variables/restoreinfo.html">$restoreinfo</a>-&gt;<a onClick="logVariable('original_site_identifier_hash')" class="var it45178" onMouseOver="hilite(45178)" onMouseOut="lolite()" href="../../../_variables/original_site_identifier_hash.html">original_site_identifier_hash</a>;
<a name="l1576"><span class="linenum">1576</span></a>                          self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'user', <a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>-&gt;<a onClick="logVariable('itemid')" class="var it45175" onMouseOver="hilite(45175)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>, 0, null, (array)<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>);
<a name="l1577"><span class="linenum">1577</span></a>                      }
<a name="l1578"><span class="linenum">1578</span></a>                  }
<a name="l1579"><span class="linenum">1579</span></a>  
<a name="l1580"><span class="linenum">1580</span></a>              } else if (<a class="var it38886" onMouseOver="hilite(38886)" onMouseOut="lolite()" onClick="logVariable('usercheck')" href="../../../_variables/usercheck.html">$usercheck</a> === true) { // User needs to be created, check if we are able
<a name="l1581"><span class="linenum">1581</span></a>                  if (<a class="var it38884" onMouseOver="hilite(38884)" onMouseOut="lolite()" onClick="logVariable('cancreateuser')" href="../../../_variables/cancreateuser.html">$cancreateuser</a>) { // Can create user, set newitemid to 0 so will be created later
<a name="l1582"><span class="linenum">1582</span></a>                      self::<a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'user', <a class="var it38872" onMouseOver="hilite(38872)" onMouseOut="lolite()" onClick="logVariable('recuser')" href="../../../_variables/recuser.html">$recuser</a>-&gt;<a onClick="logVariable('itemid')" class="var it45175" onMouseOver="hilite(45175)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>, 0, null, (array)<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>);
<a name="l1583"><span class="linenum">1583</span></a>  
<a name="l1584"><span class="linenum">1584</span></a>                  } else { // Cannot create user, report it as problem
<a name="l1585"><span class="linenum">1585</span></a>                      <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>[] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('restorecannotcreateuser', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>);
<a name="l1586"><span class="linenum">1586</span></a>                  }
<a name="l1587"><span class="linenum">1587</span></a>  
<a name="l1588"><span class="linenum">1588</span></a>              } else { // Shouldn't arrive here ever, something is for sure wrong. Exception
<a name="l1589"><span class="linenum">1589</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('restore_dbops_exception')" href="../../../_classes/restore_dbops_exception.html" onMouseOver="classPopup(event,'restore_dbops_exception')">restore_dbops_exception</a>('restore_error_processing_user', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../../_variables/username.html">username</a>);
<a name="l1590"><span class="linenum">1590</span></a>              }
<a name="l1591"><span class="linenum">1591</span></a>              <a class="var it552" onMouseOver="hilite(552)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../../_variables/done.html">$done</a>++;
<a name="l1592"><span class="linenum">1592</span></a>              <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('progress')" href="../../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>(<a class="var it552" onMouseOver="hilite(552)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../../_variables/done.html">$done</a>);
<a name="l1593"><span class="linenum">1593</span></a>          }
<a name="l1594"><span class="linenum">1594</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1595"><span class="linenum">1595</span></a>          <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l1596"><span class="linenum">1596</span></a>          return <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>;
<a name="l1597"><span class="linenum">1597</span></a>      }
<a name="l1598"><span class="linenum">1598</span></a>  
<a name="l1599"><span class="linenum">1599</span></a>      <span class="comment">/**</span>
<a name="l1600"><span class="linenum">1600</span></a>  <span class="comment">     * Process the needed users in order to decide</span>
<a name="l1601"><span class="linenum">1601</span></a>  <span class="comment">     * which action to perform with them (create/map)</span>
<a name="l1602"><span class="linenum">1602</span></a>  <span class="comment">     *</span>
<a name="l1603"><span class="linenum">1603</span></a>  <span class="comment">     * Just wrap over precheck_included_users(), returning</span>
<a name="l1604"><span class="linenum">1604</span></a>  <span class="comment">     * exception if any problem is found</span>
<a name="l1605"><span class="linenum">1605</span></a>  <span class="comment">     *</span>
<a name="l1606"><span class="linenum">1606</span></a>  <span class="comment">     * @param string $restoreid Restore id</span>
<a name="l1607"><span class="linenum">1607</span></a>  <span class="comment">     * @param int $courseid Course id</span>
<a name="l1608"><span class="linenum">1608</span></a>  <span class="comment">     * @param int $userid User id</span>
<a name="l1609"><span class="linenum">1609</span></a>  <span class="comment">     * @param bool $samesite True if restore is to same site</span>
<a name="l1610"><span class="linenum">1610</span></a>  <span class="comment">     * @param \core\progress\base $progress Optional progress tracker</span>
<a name="l1611"><span class="linenum">1611</span></a>  <span class="comment">     */</span>
<a name="l1612"><span class="linenum">1612</span></a>      public static function <a class="function" onClick="logFunction('process_included_users')" href="../../../_functions/process_included_users.html" onMouseOver="funcPopup(event,'process_included_users')">process_included_users</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>,
<a name="l1613"><span class="linenum">1613</span></a>              \core\progress\base <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a> = null) {
<a name="l1614"><span class="linenum">1614</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1615"><span class="linenum">1615</span></a>  
<a name="l1616"><span class="linenum">1616</span></a>  <span class="comment">        // Just let precheck_included_users() to do all the hard work</span>
<a name="l1617"><span class="linenum">1617</span></a>          <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a> = self::<a class="function" onClick="logFunction('precheck_included_users')" href="../../../_functions/precheck_included_users.html" onMouseOver="funcPopup(event,'precheck_included_users')">precheck_included_users</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>, <a class="var it1049" onMouseOver="hilite(1049)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../../_variables/progress.html">$progress</a>);
<a name="l1618"><span class="linenum">1618</span></a>  
<a name="l1619"><span class="linenum">1619</span></a>  <span class="comment">        // With problems, throw exception, shouldn't happen if prechecks were originally</span>
<a name="l1620"><span class="linenum">1620</span></a>  <span class="comment">        // executed, so be radical here.</span>
<a name="l1621"><span class="linenum">1621</span></a>          if (!empty(<a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>)) {
<a name="l1622"><span class="linenum">1622</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('restore_dbops_exception')" href="../../../_classes/restore_dbops_exception.html" onMouseOver="classPopup(event,'restore_dbops_exception')">restore_dbops_exception</a>('restore_problems_processing_users', null, <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>));
<a name="l1623"><span class="linenum">1623</span></a>          }
<a name="l1624"><span class="linenum">1624</span></a>      }
<a name="l1625"><span class="linenum">1625</span></a>  
<a name="l1626"><span class="linenum">1626</span></a>      <span class="comment">/**</span>
<a name="l1627"><span class="linenum">1627</span></a>  <span class="comment">     * Process the needed question categories and questions</span>
<a name="l1628"><span class="linenum">1628</span></a>  <span class="comment">     * to check all them, deciding about the action to perform</span>
<a name="l1629"><span class="linenum">1629</span></a>  <span class="comment">     * (create/map) and target.</span>
<a name="l1630"><span class="linenum">1630</span></a>  <span class="comment">     *</span>
<a name="l1631"><span class="linenum">1631</span></a>  <span class="comment">     * Just wrap over precheck_categories_and_questions(), returning</span>
<a name="l1632"><span class="linenum">1632</span></a>  <span class="comment">     * exception if any problem is found</span>
<a name="l1633"><span class="linenum">1633</span></a>  <span class="comment">     */</span>
<a name="l1634"><span class="linenum">1634</span></a>      public static function <a class="function" onClick="logFunction('process_categories_and_questions')" href="../../../_functions/process_categories_and_questions.html" onMouseOver="funcPopup(event,'process_categories_and_questions')">process_categories_and_questions</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>) {
<a name="l1635"><span class="linenum">1635</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1636"><span class="linenum">1636</span></a>  
<a name="l1637"><span class="linenum">1637</span></a>  <span class="comment">        // Just let precheck_included_users() to do all the hard work</span>
<a name="l1638"><span class="linenum">1638</span></a>          <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a> = self::<a class="function" onClick="logFunction('precheck_categories_and_questions')" href="../../../_functions/precheck_categories_and_questions.html" onMouseOver="funcPopup(event,'precheck_categories_and_questions')">precheck_categories_and_questions</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it10887" onMouseOver="hilite(10887)" onMouseOut="lolite()" onClick="logVariable('samesite')" href="../../../_variables/samesite.html">$samesite</a>);
<a name="l1639"><span class="linenum">1639</span></a>  
<a name="l1640"><span class="linenum">1640</span></a>  <span class="comment">        // With problems of type error, throw exception, shouldn't happen if prechecks were originally</span>
<a name="l1641"><span class="linenum">1641</span></a>  <span class="comment">        // executed, so be radical here.</span>
<a name="l1642"><span class="linenum">1642</span></a>          if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('errors', <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>)) {
<a name="l1643"><span class="linenum">1643</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('restore_dbops_exception')" href="../../../_classes/restore_dbops_exception.html" onMouseOver="classPopup(event,'restore_dbops_exception')">restore_dbops_exception</a>('restore_problems_processing_questions', null, <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a>['errors']));
<a name="l1644"><span class="linenum">1644</span></a>          }
<a name="l1645"><span class="linenum">1645</span></a>      }
<a name="l1646"><span class="linenum">1646</span></a>  
<a name="l1647"><span class="linenum">1647</span></a>      public static function <a class="function" onClick="logFunction('set_backup_files_record')" href="../../../_functions/set_backup_files_record.html" onMouseOver="funcPopup(event,'set_backup_files_record')">set_backup_files_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it38887" onMouseOver="hilite(38887)" onMouseOut="lolite()" onClick="logVariable('filerec')" href="../../../_variables/filerec.html">$filerec</a>) {
<a name="l1648"><span class="linenum">1648</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1649"><span class="linenum">1649</span></a>  
<a name="l1650"><span class="linenum">1650</span></a>  <span class="comment">        // Store external files info in `info` field</span>
<a name="l1651"><span class="linenum">1651</span></a>          <a class="var it38887" onMouseOver="hilite(38887)" onMouseOut="lolite()" onClick="logVariable('filerec')" href="../../../_variables/filerec.html">$filerec</a>-&gt;<a onClick="logVariable('info')" class="var it45180" onMouseOver="hilite(45180)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>     = backup_controller_dbops::<a class="function" onClick="logFunction('encode_backup_temp_info')" href="../../../_functions/encode_backup_temp_info.html" onMouseOver="funcPopup(event,'encode_backup_temp_info')">encode_backup_temp_info</a>(<a class="var it38887" onMouseOver="hilite(38887)" onMouseOut="lolite()" onClick="logVariable('filerec')" href="../../../_variables/filerec.html">$filerec</a>); <span class="comment">// Encode the whole record into info.</span>
<a name="l1652"><span class="linenum">1652</span></a>          <a class="var it38887" onMouseOver="hilite(38887)" onMouseOut="lolite()" onClick="logVariable('filerec')" href="../../../_variables/filerec.html">$filerec</a>-&gt;<a onClick="logVariable('backupid')" class="var it45180" onMouseOver="hilite(45180)" onMouseOut="lolite()" href="../../../_variables/backupid.html">backupid</a> = <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>;
<a name="l1653"><span class="linenum">1653</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('backup_files_temp', <a class="var it38887" onMouseOver="hilite(38887)" onMouseOut="lolite()" onClick="logVariable('filerec')" href="../../../_variables/filerec.html">$filerec</a>);
<a name="l1654"><span class="linenum">1654</span></a>      }
<a name="l1655"><span class="linenum">1655</span></a>  
<a name="l1656"><span class="linenum">1656</span></a>      public static function <a class="function" onClick="logFunction('set_backup_ids_record')" href="../../../_functions/set_backup_ids_record.html" onMouseOver="funcPopup(event,'set_backup_ids_record')">set_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('newitemid')" href="../../../_variables/newitemid.html">$newitemid</a> = 0, <a class="var it12860" onMouseOver="hilite(12860)" onMouseOut="lolite()" onClick="logVariable('parentitemid')" href="../../../_variables/parentitemid.html">$parentitemid</a> = null, <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a> = null) {
<a name="l1657"><span class="linenum">1657</span></a>  <span class="comment">        // Build conditionally the extra record info</span>
<a name="l1658"><span class="linenum">1658</span></a>          <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a> = array();
<a name="l1659"><span class="linenum">1659</span></a>          if (<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('newitemid')" href="../../../_variables/newitemid.html">$newitemid</a> != 0) {
<a name="l1660"><span class="linenum">1660</span></a>              <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>['newitemid'] = <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('newitemid')" href="../../../_variables/newitemid.html">$newitemid</a>;
<a name="l1661"><span class="linenum">1661</span></a>          }
<a name="l1662"><span class="linenum">1662</span></a>          if (<a class="var it12860" onMouseOver="hilite(12860)" onMouseOut="lolite()" onClick="logVariable('parentitemid')" href="../../../_variables/parentitemid.html">$parentitemid</a> != null) {
<a name="l1663"><span class="linenum">1663</span></a>              <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>['parentitemid'] = <a class="var it12860" onMouseOver="hilite(12860)" onMouseOut="lolite()" onClick="logVariable('parentitemid')" href="../../../_variables/parentitemid.html">$parentitemid</a>;
<a name="l1664"><span class="linenum">1664</span></a>          }
<a name="l1665"><span class="linenum">1665</span></a>          if (<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a> != null) {
<a name="l1666"><span class="linenum">1666</span></a>              <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>['info'] = backup_controller_dbops::<a class="function" onClick="logFunction('encode_backup_temp_info')" href="../../../_functions/encode_backup_temp_info.html" onMouseOver="funcPopup(event,'encode_backup_temp_info')">encode_backup_temp_info</a>(<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>);
<a name="l1667"><span class="linenum">1667</span></a>          }
<a name="l1668"><span class="linenum">1668</span></a>  
<a name="l1669"><span class="linenum">1669</span></a>          self::<a class="function" onClick="logFunction('set_backup_ids_cached')" href="../../../_functions/set_backup_ids_cached.html" onMouseOver="funcPopup(event,'set_backup_ids_cached')">set_backup_ids_cached</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a>, <a class="var it38828" onMouseOver="hilite(38828)" onMouseOut="lolite()" onClick="logVariable('extrarecord')" href="../../../_variables/extrarecord.html">$extrarecord</a>);
<a name="l1670"><span class="linenum">1670</span></a>      }
<a name="l1671"><span class="linenum">1671</span></a>  
<a name="l1672"><span class="linenum">1672</span></a>      public static function <a class="function" onClick="logFunction('get_backup_ids_record')" href="../../../_functions/get_backup_ids_record.html" onMouseOver="funcPopup(event,'get_backup_ids_record')">get_backup_ids_record</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a>) {
<a name="l1673"><span class="linenum">1673</span></a>          <a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a> = self::<a class="function" onClick="logFunction('get_backup_ids_cached')" href="../../../_functions/get_backup_ids_cached.html" onMouseOver="funcPopup(event,'get_backup_ids_cached')">get_backup_ids_cached</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../../_variables/itemname.html">$itemname</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a>);
<a name="l1674"><span class="linenum">1674</span></a>  
<a name="l1675"><span class="linenum">1675</span></a>  <span class="comment">        // We must test if info is a string, as the cache stores info in object form.</span>
<a name="l1676"><span class="linenum">1676</span></a>          if (<a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a> &amp;&amp; isset(<a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a>-&gt;<a onClick="logVariable('info')" class="var it45023" onMouseOver="hilite(45023)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_string')" href="../../../_functions/is_string.html" onMouseOver="phpfuncPopup(event,'is_string')">is_string</a>(<a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a>-&gt;<a onClick="logVariable('info')" class="var it45023" onMouseOver="hilite(45023)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>)) {
<a name="l1677"><span class="linenum">1677</span></a>              <a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a>-&gt;<a onClick="logVariable('info')" class="var it45023" onMouseOver="hilite(45023)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a> = backup_controller_dbops::<a class="function" onClick="logFunction('decode_backup_temp_info')" href="../../../_functions/decode_backup_temp_info.html" onMouseOver="funcPopup(event,'decode_backup_temp_info')">decode_backup_temp_info</a>(<a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a>-&gt;<a onClick="logVariable('info')" class="var it45023" onMouseOver="hilite(45023)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>);
<a name="l1678"><span class="linenum">1678</span></a>          }
<a name="l1679"><span class="linenum">1679</span></a>  
<a name="l1680"><span class="linenum">1680</span></a>          return <a class="var it4900" onMouseOver="hilite(4900)" onMouseOut="lolite()" onClick="logVariable('dbrec')" href="../../../_variables/dbrec.html">$dbrec</a>;
<a name="l1681"><span class="linenum">1681</span></a>      }
<a name="l1682"><span class="linenum">1682</span></a>  
<a name="l1683"><span class="linenum">1683</span></a>      <span class="comment">/**</span>
<a name="l1684"><span class="linenum">1684</span></a>  <span class="comment">     * Given on courseid, fullname and shortname, calculate the correct fullname/shortname to avoid dupes</span>
<a name="l1685"><span class="linenum">1685</span></a>  <span class="comment">     */</span>
<a name="l1686"><span class="linenum">1686</span></a>      public static function <a class="function" onClick="logFunction('calculate_course_names')" href="../../../_functions/calculate_course_names.html" onMouseOver="funcPopup(event,'calculate_course_names')">calculate_course_names</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../../_variables/fullname.html">$fullname</a>, <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../../_variables/shortname.html">$shortname</a>) {
<a name="l1687"><span class="linenum">1687</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1688"><span class="linenum">1688</span></a>  
<a name="l1689"><span class="linenum">1689</span></a>          <a class="var it38888" onMouseOver="hilite(38888)" onMouseOut="lolite()" onClick="logVariable('currentfullname')" href="../../../_variables/currentfullname.html">$currentfullname</a> = '';
<a name="l1690"><span class="linenum">1690</span></a>          <a class="var it38889" onMouseOver="hilite(38889)" onMouseOut="lolite()" onClick="logVariable('currentshortname')" href="../../../_variables/currentshortname.html">$currentshortname</a> = '';
<a name="l1691"><span class="linenum">1691</span></a>          <a class="var it3434" onMouseOver="hilite(3434)" onMouseOut="lolite()" onClick="logVariable('counter')" href="../../../_variables/counter.html">$counter</a> = 0;
<a name="l1692"><span class="linenum">1692</span></a>  <span class="comment">        // Iteratere while the name exists</span>
<a name="l1693"><span class="linenum">1693</span></a>          do {
<a name="l1694"><span class="linenum">1694</span></a>              if (<a class="var it3434" onMouseOver="hilite(3434)" onMouseOut="lolite()" onClick="logVariable('counter')" href="../../../_variables/counter.html">$counter</a>) {
<a name="l1695"><span class="linenum">1695</span></a>                  <a class="var it38890" onMouseOver="hilite(38890)" onMouseOut="lolite()" onClick="logVariable('suffixfull')" href="../../../_variables/suffixfull.html">$suffixfull</a>  = ' ' . <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('copyasnoun') . ' ' . <a class="var it3434" onMouseOver="hilite(3434)" onMouseOut="lolite()" onClick="logVariable('counter')" href="../../../_variables/counter.html">$counter</a>;
<a name="l1696"><span class="linenum">1696</span></a>                  <a class="var it38891" onMouseOver="hilite(38891)" onMouseOut="lolite()" onClick="logVariable('suffixshort')" href="../../../_variables/suffixshort.html">$suffixshort</a> = '_' . <a class="var it3434" onMouseOver="hilite(3434)" onMouseOut="lolite()" onClick="logVariable('counter')" href="../../../_variables/counter.html">$counter</a>;
<a name="l1697"><span class="linenum">1697</span></a>              } else {
<a name="l1698"><span class="linenum">1698</span></a>                  <a class="var it38890" onMouseOver="hilite(38890)" onMouseOut="lolite()" onClick="logVariable('suffixfull')" href="../../../_variables/suffixfull.html">$suffixfull</a>  = '';
<a name="l1699"><span class="linenum">1699</span></a>                  <a class="var it38891" onMouseOver="hilite(38891)" onMouseOut="lolite()" onClick="logVariable('suffixshort')" href="../../../_variables/suffixshort.html">$suffixshort</a> = '';
<a name="l1700"><span class="linenum">1700</span></a>              }
<a name="l1701"><span class="linenum">1701</span></a>              <a class="var it38888" onMouseOver="hilite(38888)" onMouseOut="lolite()" onClick="logVariable('currentfullname')" href="../../../_variables/currentfullname.html">$currentfullname</a> = <a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../../_variables/fullname.html">$fullname</a>.<a class="var it38890" onMouseOver="hilite(38890)" onMouseOut="lolite()" onClick="logVariable('suffixfull')" href="../../../_variables/suffixfull.html">$suffixfull</a>;
<a name="l1702"><span class="linenum">1702</span></a>              <a class="var it38889" onMouseOver="hilite(38889)" onMouseOut="lolite()" onClick="logVariable('currentshortname')" href="../../../_variables/currentshortname.html">$currentshortname</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../../_variables/shortname.html">$shortname</a>, 0, 100 - <a class="function" onClick="logFunction('strlen')" href="../../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it38891" onMouseOver="hilite(38891)" onMouseOut="lolite()" onClick="logVariable('suffixshort')" href="../../../_variables/suffixshort.html">$suffixshort</a>)).<a class="var it38891" onMouseOver="hilite(38891)" onMouseOut="lolite()" onClick="logVariable('suffixshort')" href="../../../_variables/suffixshort.html">$suffixshort</a>; <span class="comment">// &lt; 100cc</span>
<a name="l1703"><span class="linenum">1703</span></a>              <a class="var it38892" onMouseOver="hilite(38892)" onMouseOut="lolite()" onClick="logVariable('coursefull')" href="../../../_variables/coursefull.html">$coursefull</a>  = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_select')" href="../../../_functions/get_record_select.html" onMouseOver="funcPopup(event,'get_record_select')">get_record_select</a>('course', 'fullname = ? AND id != ?',
<a name="l1704"><span class="linenum">1704</span></a>                      array(<a class="var it38888" onMouseOver="hilite(38888)" onMouseOut="lolite()" onClick="logVariable('currentfullname')" href="../../../_variables/currentfullname.html">$currentfullname</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>), '*', <a class="constant" onClick="logConstant('IGNORE_MULTIPLE')" href="../../../_constants/IGNORE_MULTIPLE.html" onMouseOver="constPopup(event,'IGNORE_MULTIPLE')">IGNORE_MULTIPLE</a>);
<a name="l1705"><span class="linenum">1705</span></a>              <a class="var it38893" onMouseOver="hilite(38893)" onMouseOut="lolite()" onClick="logVariable('courseshort')" href="../../../_variables/courseshort.html">$courseshort</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_select')" href="../../../_functions/get_record_select.html" onMouseOver="funcPopup(event,'get_record_select')">get_record_select</a>('course', 'shortname = ? AND id != ?', array(<a class="var it38889" onMouseOver="hilite(38889)" onMouseOut="lolite()" onClick="logVariable('currentshortname')" href="../../../_variables/currentshortname.html">$currentshortname</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>));
<a name="l1706"><span class="linenum">1706</span></a>              <a class="var it3434" onMouseOver="hilite(3434)" onMouseOut="lolite()" onClick="logVariable('counter')" href="../../../_variables/counter.html">$counter</a>++;
<a name="l1707"><span class="linenum">1707</span></a>          } while (<a class="var it38892" onMouseOver="hilite(38892)" onMouseOut="lolite()" onClick="logVariable('coursefull')" href="../../../_variables/coursefull.html">$coursefull</a> || <a class="var it38893" onMouseOver="hilite(38893)" onMouseOut="lolite()" onClick="logVariable('courseshort')" href="../../../_variables/courseshort.html">$courseshort</a>);
<a name="l1708"><span class="linenum">1708</span></a>  
<a name="l1709"><span class="linenum">1709</span></a>  <span class="comment">        // Return results</span>
<a name="l1710"><span class="linenum">1710</span></a>          return array(<a class="var it38888" onMouseOver="hilite(38888)" onMouseOut="lolite()" onClick="logVariable('currentfullname')" href="../../../_variables/currentfullname.html">$currentfullname</a>, <a class="var it38889" onMouseOver="hilite(38889)" onMouseOut="lolite()" onClick="logVariable('currentshortname')" href="../../../_variables/currentshortname.html">$currentshortname</a>);
<a name="l1711"><span class="linenum">1711</span></a>      }
<a name="l1712"><span class="linenum">1712</span></a>  
<a name="l1713"><span class="linenum">1713</span></a>      <span class="comment">/**</span>
<a name="l1714"><span class="linenum">1714</span></a>  <span class="comment">     * For the target course context, put as many custom role names as possible</span>
<a name="l1715"><span class="linenum">1715</span></a>  <span class="comment">     */</span>
<a name="l1716"><span class="linenum">1716</span></a>      public static function <a class="function" onClick="logFunction('set_course_role_names')" href="../../../_functions/set_course_role_names.html" onMouseOver="funcPopup(event,'set_course_role_names')">set_course_role_names</a>(<a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>) {
<a name="l1717"><span class="linenum">1717</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1718"><span class="linenum">1718</span></a>  
<a name="l1719"><span class="linenum">1719</span></a>  <span class="comment">        // Get the course context</span>
<a name="l1720"><span class="linenum">1720</span></a>          <a class="var it8535" onMouseOver="hilite(8535)" onMouseOut="lolite()" onClick="logVariable('coursectx')" href="../../../_variables/coursectx.html">$coursectx</a> = <a class="class" onClick="logClass('context_course')" href="../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>);
<a name="l1721"><span class="linenum">1721</span></a>  <span class="comment">        // Get all the mapped roles we have</span>
<a name="l1722"><span class="linenum">1722</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('backup_ids_temp', array('backupid' =&gt; <a class="var it3716" onMouseOver="hilite(3716)" onMouseOut="lolite()" onClick="logVariable('restoreid')" href="../../../_variables/restoreid.html">$restoreid</a>, 'itemname' =&gt; 'role'), '', 'itemid, info, newitemid');
<a name="l1723"><span class="linenum">1723</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> as <a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>) {
<a name="l1724"><span class="linenum">1724</span></a>              <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a> = backup_controller_dbops::<a class="function" onClick="logFunction('decode_backup_temp_info')" href="../../../_functions/decode_backup_temp_info.html" onMouseOver="funcPopup(event,'decode_backup_temp_info')">decode_backup_temp_info</a>(<a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>-&gt;<a onClick="logVariable('info')" class="var it45165" onMouseOver="hilite(45165)" onMouseOut="lolite()" href="../../../_variables/info.html">info</a>);
<a name="l1725"><span class="linenum">1725</span></a>  <span class="comment">            // If it's one mapped role and we have one name for it</span>
<a name="l1726"><span class="linenum">1726</span></a>              if (!empty(<a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>-&gt;<a onClick="logVariable('newitemid')" class="var it45165" onMouseOver="hilite(45165)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>) &amp;&amp; !empty(<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>['nameincourse'])) {
<a name="l1727"><span class="linenum">1727</span></a>  <span class="comment">                // If role name doesn't exist, add it</span>
<a name="l1728"><span class="linenum">1728</span></a>                  <a class="var it912" onMouseOver="hilite(912)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../../../_variables/rolename.html">$rolename</a> = new stdclass();
<a name="l1729"><span class="linenum">1729</span></a>                  <a class="var it912" onMouseOver="hilite(912)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../../../_variables/rolename.html">$rolename</a>-&gt;<a onClick="logVariable('roleid')" class="var it44397" onMouseOver="hilite(44397)" onMouseOut="lolite()" href="../../../_variables/roleid.html">roleid</a> = <a class="var it38826" onMouseOver="hilite(38826)" onMouseOut="lolite()" onClick="logVariable('recrole')" href="../../../_variables/recrole.html">$recrole</a>-&gt;<a onClick="logVariable('newitemid')" class="var it45165" onMouseOver="hilite(45165)" onMouseOut="lolite()" href="../../../_variables/newitemid.html">newitemid</a>;
<a name="l1730"><span class="linenum">1730</span></a>                  <a class="var it912" onMouseOver="hilite(912)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../../../_variables/rolename.html">$rolename</a>-&gt;<a onClick="logVariable('contextid')" class="var it44397" onMouseOver="hilite(44397)" onMouseOut="lolite()" href="../../../_variables/contextid.html">contextid</a> = <a class="var it8535" onMouseOver="hilite(8535)" onMouseOut="lolite()" onClick="logVariable('coursectx')" href="../../../_variables/coursectx.html">$coursectx</a>-&gt;<a onClick="logVariable('id')" class="var it43119" onMouseOver="hilite(43119)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1731"><span class="linenum">1731</span></a>                  if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('role_names', (array)<a class="var it912" onMouseOver="hilite(912)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../../../_variables/rolename.html">$rolename</a>)) {
<a name="l1732"><span class="linenum">1732</span></a>                      <a class="var it912" onMouseOver="hilite(912)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../../../_variables/rolename.html">$rolename</a>-&gt;<a onClick="logVariable('name')" class="var it44397" onMouseOver="hilite(44397)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> = <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>['nameincourse'];
<a name="l1733"><span class="linenum">1733</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('role_names', <a class="var it912" onMouseOver="hilite(912)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../../../_variables/rolename.html">$rolename</a>);
<a name="l1734"><span class="linenum">1734</span></a>                  }
<a name="l1735"><span class="linenum">1735</span></a>              }
<a name="l1736"><span class="linenum">1736</span></a>          }
<a name="l1737"><span class="linenum">1737</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1738"><span class="linenum">1738</span></a>      }
<a name="l1739"><span class="linenum">1739</span></a>  
<a name="l1740"><span class="linenum">1740</span></a>      <span class="comment">/**</span>
<a name="l1741"><span class="linenum">1741</span></a>  <span class="comment">     * Creates a skeleton record within the database using the passed parameters</span>
<a name="l1742"><span class="linenum">1742</span></a>  <span class="comment">     * and returns the new course id.</span>
<a name="l1743"><span class="linenum">1743</span></a>  <span class="comment">     *</span>
<a name="l1744"><span class="linenum">1744</span></a>  <span class="comment">     * @global moodle_database $DB</span>
<a name="l1745"><span class="linenum">1745</span></a>  <span class="comment">     * @param string $fullname</span>
<a name="l1746"><span class="linenum">1746</span></a>  <span class="comment">     * @param string $shortname</span>
<a name="l1747"><span class="linenum">1747</span></a>  <span class="comment">     * @param int $categoryid</span>
<a name="l1748"><span class="linenum">1748</span></a>  <span class="comment">     * @return int The new course id</span>
<a name="l1749"><span class="linenum">1749</span></a>  <span class="comment">     */</span>
<a name="l1750"><span class="linenum">1750</span></a>      public static function <a class="function" onClick="logFunction('create_new_course')" href="../../../_functions/create_new_course.html" onMouseOver="funcPopup(event,'create_new_course')">create_new_course</a>(<a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../../_variables/fullname.html">$fullname</a>, <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../../_variables/shortname.html">$shortname</a>, <a class="var it904" onMouseOver="hilite(904)" onMouseOut="lolite()" onClick="logVariable('categoryid')" href="../../../_variables/categoryid.html">$categoryid</a>) {
<a name="l1751"><span class="linenum">1751</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1752"><span class="linenum">1752</span></a>          <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course_categories', array('id'=&gt;<a class="var it904" onMouseOver="hilite(904)" onMouseOut="lolite()" onClick="logVariable('categoryid')" href="../../../_variables/categoryid.html">$categoryid</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1753"><span class="linenum">1753</span></a>  
<a name="l1754"><span class="linenum">1754</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a> = new stdClass;
<a name="l1755"><span class="linenum">1755</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('fullname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/fullname.html">fullname</a> = <a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../../_variables/fullname.html">$fullname</a>;
<a name="l1756"><span class="linenum">1756</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/shortname.html">shortname</a> = <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../../_variables/shortname.html">$shortname</a>;
<a name="l1757"><span class="linenum">1757</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('category')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> = <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('id')" class="var it42970" onMouseOver="hilite(42970)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1758"><span class="linenum">1758</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/sortorder.html">sortorder</a> = 0;
<a name="l1759"><span class="linenum">1759</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/timecreated.html">timecreated</a>  = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1760"><span class="linenum">1760</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/timemodified.html">timemodified</a> = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/timecreated.html">timecreated</a>;
<a name="l1761"><span class="linenum">1761</span></a>  <span class="comment">        // forcing skeleton courses to be hidden instead of going by $category-&gt;visible , until MDL-27790 is resolved.</span>
<a name="l1762"><span class="linenum">1762</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('visible')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/visible.html">visible</a> = 0;
<a name="l1763"><span class="linenum">1763</span></a>  
<a name="l1764"><span class="linenum">1764</span></a>          <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('course', <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>);
<a name="l1765"><span class="linenum">1765</span></a>  
<a name="l1766"><span class="linenum">1766</span></a>          <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('coursecount')" class="var it42970" onMouseOver="hilite(42970)" onMouseOut="lolite()" href="../../../_variables/coursecount.html">coursecount</a>++;
<a name="l1767"><span class="linenum">1767</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('course_categories', <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>);
<a name="l1768"><span class="linenum">1768</span></a>  
<a name="l1769"><span class="linenum">1769</span></a>          return <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>;
<a name="l1770"><span class="linenum">1770</span></a>      }
<a name="l1771"><span class="linenum">1771</span></a>  
<a name="l1772"><span class="linenum">1772</span></a>      <span class="comment">/**</span>
<a name="l1773"><span class="linenum">1773</span></a>  <span class="comment">     * Deletes all of the content associated with the given course (courseid)</span>
<a name="l1774"><span class="linenum">1774</span></a>  <span class="comment">     * @param int $courseid</span>
<a name="l1775"><span class="linenum">1775</span></a>  <span class="comment">     * @param array $options</span>
<a name="l1776"><span class="linenum">1776</span></a>  <span class="comment">     * @return bool True for success</span>
<a name="l1777"><span class="linenum">1777</span></a>  <span class="comment">     */</span>
<a name="l1778"><span class="linenum">1778</span></a>      public static function <a class="function" onClick="logFunction('delete_course_content')" href="../../../_functions/delete_course_content.html" onMouseOver="funcPopup(event,'delete_course_content')">delete_course_content</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, array <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> = null) {
<a name="l1779"><span class="linenum">1779</span></a>          return <a class="function" onClick="logFunction('remove_course_contents')" href="../../../_functions/remove_course_contents.html" onMouseOver="funcPopup(event,'remove_course_contents')">remove_course_contents</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, false, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>);
<a name="l1780"><span class="linenum">1780</span></a>      }
<a name="l1781"><span class="linenum">1781</span></a>  }
<a name="l1782"><span class="linenum">1782</span></a>  
<a name="l1783"><span class="linenum">1783</span></a>  <span class="comment">/*</span>
<a name="l1784"><span class="linenum">1784</span></a>  <span class="comment"> * Exception class used by all the @dbops stuff</span>
<a name="l1785"><span class="linenum">1785</span></a>  <span class="comment"> */</span>
<a name="l1786"><span class="linenum">1786</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('restore_dbops_exception')" href="../../../_classes/restore_dbops_exception.html" onMouseOver="classPopup(event,'restore_dbops_exception')">restore_dbops_exception</a> extends backup_exception {
<a name="l1787"><span class="linenum">1787</span></a>  
<a name="l1788"><span class="linenum">1788</span></a>      public function <a class="function" onClick="logFunction('__construct')" href="../../../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../../../_variables/errorcode.html">$errorcode</a>, <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>=NULL, <a class="var it263" onMouseOver="hilite(263)" onMouseOut="lolite()" onClick="logVariable('debuginfo')" href="../../../_variables/debuginfo.html">$debuginfo</a>=null) {
<a name="l1789"><span class="linenum">1789</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../../../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../../../_variables/errorcode.html">$errorcode</a>, 'error', '', <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>, null, <a class="var it263" onMouseOver="hilite(263)" onMouseOut="lolite()" onClick="logVariable('debuginfo')" href="../../../_variables/debuginfo.html">$debuginfo</a>);
<a name="l1790"><span class="linenum">1790</span></a>      }
<a name="l1791"><span class="linenum">1791</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'set_course_role_names': ['set_course_role_names', 'For the target course context, put as many custom role names as possible ', [['backup/util/dbops','restore_dbops.class.php',1713]], 1],
'remove_course_contents': ['remove_course_contents', 'Clear a course out completely, deleting all content but don\'t delete the course itself. ', [['lib','moodlelib.php',4736]], 4],
'set_progress': ['set_progress', 'Sets the progress tracker for the parser. If set, the tracker will be called to report indeterminate progress for each chunk of XML. ', [['backup/util/xml/parser','progressive_parser.class.php',130],['backup/controller','base_controller.class.php',46]], 10],
'process': ['process', '', [['lib/yuilib/3.17.2/datatable-base','datatable-base.js',370],['backup/moodle2','backup_xml_transformer.class.php',60],['lib/yuilib/3.17.2/datatable-table','datatable-table.js',412],['backup/util/ui','restore_ui.class.php',124],['backup/util/helper','restore_decode_content.class.php',63],['lib','csslib.php',589],['lib/minify/lib/Minify','HTML.php',85],['lib/google/src/Google/Service','MapsEngine.php',1827],['lib/google/src/Google/Service','MapsEngine.php',2436],['lib/google/src/Google/Service','MapsEngine.php',2741],['lib/google/src/Google/Service','MapsEngine.php',3004],['backup/moodle2','backup_custom_fields.php',113],['lib/minify/lib/Minify/CSS','Compressor.php',23],['backup/util/structure','backup_attribute.class.php',34],['course','dnduploadlib.php',449],['message/tests','inbound_test.php',641],['backup/util/interfaces','processable.class.php',35],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',16782],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',16881],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',17049],['backup/util/ui','base_ui.class.php',119],['lib/yuilib/3.17.2/datatable-table','datatable-table-debug.js',412],['backup/util/structure','backup_nested_element.class.php',66],['backup/util/xml/parser','progressive_parser.class.php',145],['lib/pear/HTML','QuickForm.php',1596],['backup/converter/moodle1','lib.php',781],['lib/minify/lib/Minify','ImportProcessor.php',25],['backup/util/plan','restore_structure_step.class.php',117],['backup/util/structure','backup_final_element.class.php',34],['backup/util/structure','backup_optigroup.class.php',59],['backup/util/loggers','base_logger.class.php',115],['lib/google/src/Google/Http','MediaFileUpload.php',222],['lib/yuilib/3.17.2/datatable-core','datatable-core-debug.js',663],['lib/yuilib/3.17.2/datatable-core','datatable-core-debug.js',758],['backup/util/ui','backup_ui_stage.class.php',89],['backup/util/ui','backup_ui_stage.class.php',244],['backup/util/ui','backup_ui_stage.class.php',397],['backup/util/ui','backup_ui_stage.class.php',526],['grade/report/singleview/classes/local/screen','screen.php',260],['lib/minify/lib/Minify','CommentPreserver.php',29],['admin/tool/log/classes/log','manager.php',76],['grade/report/singleview/classes/local/screen','user.php',316],['lib/yuilib/3.17.2/datatable-base','datatable-base-debug.js',370],['backup/util/structure','backup_optigroup_element.class.php',110],['backup/util/helper','restore_log_rule.class.php',100],['grade/report/singleview/classes/local/screen','grade.php',301],['lib/classes/message/inbound','address_manager.php',285],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/paste','editor_plugin_src.js',79],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/paste','editor_plugin_src.js',348],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/paste','editor_plugin_src.js',768],['lib/yuilib/3.17.2/datatable-core','datatable-core.js',663],['lib/yuilib/3.17.2/datatable-core','datatable-core.js',756],['enrol/manual','locallib.php',184],['enrol/manual','locallib.php',344],['lib/jabber/XMPP','XMLStream.php',431],['backup/util/xml/tests','writer_test.php',320],['backup/util/ui','restore_ui_stage.class.php',285],['backup/util/ui','restore_ui_stage.class.php',469],['backup/util/ui','restore_ui_stage.class.php',602],['backup/util/ui','restore_ui_stage.class.php',714],['backup/util/ui','restore_ui_stage.class.php',862],['backup/util/ui','restore_ui_stage.class.php',968],['backup/converter/moodle1','handlerlib.php',562]], 350],
'set_backup_ids_cached': ['set_backup_ids_cached', 'Cache backup ids\' ', [['backup/util/dbops','restore_dbops.class.php',251]], 1],
'create_file_from_storedfile': ['create_file_from_storedfile', 'Create new file from stored file - make sure params are valid. ', [['lib/filebrowser','file_info.php',405],['lib/filebrowser','file_info_stored.php',584],['lib/filestorage','file_storage.php',1186]], 47],
'get_backup_ids_record': ['get_backup_ids_record', '', [['backup/util/dbops','restore_dbops.class.php',1672]], 29],
'not': ['not', 'NOT ', [['lib/phpexcel/PHPExcel/Calculation','Logical.php',187]], 351],
'get_info': ['get_info', 'Returns file information. ', [['lib/filestorage','zip_archive.php',250],['lib','filelib.php',3524],['backup/util/plan','restore_task.class.php',46],['mod/feedback/item/multichoice','lib.php',411],['backup/util/plan','restore_plan.class.php',107],['mod/feedback/item/multichoicerated','lib.php',359],['backup/controller','restore_controller.class.php',317]], 67],
'create_file_from_pathname': ['create_file_from_pathname', 'Create new file from pathname - make sure params are valid. ', [['lib/filebrowser','file_info.php',392],['lib/filebrowser','file_info_stored.php',537],['lib/filestorage','file_storage.php',1367]], 54],
'restore_get_question_categories': ['restore_get_question_categories', 'Return one array of question_category records for a given restore operation and one restore context (question bank) ', [['backup/util/dbops','restore_dbops.class.php',729]], 1],
'is_internal': ['is_internal', 'Returns true if this authentication plugin is \'internal\'. ', [['auth/radius','auth.php',152],['auth/nntp','auth.php',90],['auth/email','auth.php',174],['auth/mnet','auth.php',589],['auth/imap','auth.php',111],['auth/webservice','auth.php',100],['auth/shibboleth','auth.php',171],['auth/pam','auth.php',102],['auth/manual','auth.php',113],['auth/none','auth.php',90],['auth/ldap','auth.php',1592],['lib','authlib.php',203],['auth/fc','auth.php',171],['auth/pop3','auth.php',107],['auth/nologin','auth.php',72],['auth/cas','auth.php',77],['auth/db','auth.php',677]], 19],
'get_best_assignable_role': ['get_best_assignable_role', 'Given one role, as loaded from XML, perform the best possible matching against the assignable roles, using different fallback alternatives (shortname, archetype, editingteacher => teacher, defaultcourseroleid) returning the id of the best matching role or 0 if no match is found ', [['backup/util/dbops','restore_dbops.class.php',357]], 1],
'get_tasks': ['get_tasks', 'Gets all backup tasks from the controller ', [['backup/util/ui','base_ui.class.php',183],['backup/util/plan','base_plan.class.php',78]], 21],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as an moodle_recordset.  $sql must be a complete SQL query. Since this method is a little less readable, use of it should be restricted to code where it\'s possible there might be large datasets being returned.  For known small datasets use get_records_sql - it leads to simpler code. ', [['lib/dml','pdo_moodle_database.php',252],['lib/dml','oci_native_moodle_database.php',1106],['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','mssql_native_moodle_database.php',736],['lib/dml','mysqli_native_moodle_database.php',993],['lib/dml','sqlsrv_native_moodle_database.php',811],['lib/dml/tests','dml_test.php',5544]], 283],
'get_record_select': ['get_record_select', 'Get a single database record as an object which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1481]], 19],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'update_backup_cached_record': ['update_backup_cached_record', 'Updates existing backup record ', [['backup/util/dbops','restore_dbops.class.php',300]], 2],
'clone': ['clone', '', [['lib/editor/tinymce/tiny_mce/3.5.11/plugins/media/js','media.js',11]], 370],
'can_reset_password': ['can_reset_password', 'Returns true if plugin allows resetting of internal password. ', [['auth/email','auth.php',203],['auth/webservice','auth.php',131],['auth/manual','auth.php',142],['auth/none','auth.php',119],['auth/ldap','auth.php',490],['lib','authlib.php',288],['auth/nologin','auth.php',91],['auth/db','auth.php',740]], 3],
'load_controller': ['load_controller', 'Loads the restore controller if we are tracking one ', [['backup/util/ui','restore_ui.class.php',272],['backup/util/dbops','backup_controller_dbops.class.php',102],['backup/util/ui','base_ui.class.php',258],['backup/util/ui','backup_ui.class.php',141],['backup/controller','backup_controller.class.php',345],['backup/util/dbops','restore_controller_dbops.class.php',92],['backup/controller','restore_controller.class.php',423]], 19],
'get_missing_file_result': ['get_missing_file_result', 'Returns suitable entry to include in log when there is a missing file. ', [['backup/util/dbops','restore_dbops.class.php',1061]], 2],
'is_enabled': ['is_enabled', 'Tools cannot be disabled. ', [['lib/classes/plugininfo','tool.php',39],['admin/tool/recyclebin/classes','category_bin.php',54],['admin/tool/log/classes/plugininfo','logstore.php',35],['admin/tool/recyclebin/classes','course_bin.php',54],['mod/assign/feedback/offline','locallib.php',380],['admin/tool/recyclebin/classes','base_bin.php',38],['lib','adminlib.php',1955],['search/classes','base.php',190],['lib','medialib.php',318],['lib','medialib.php',635],['lib','medialib.php',1268],['admin/tool/health','index.php',393],['lib/classes/plugininfo','mnetservice.php',33],['lib/classes/message/inbound','manager.php',37],['mod/assignment/classes/plugininfo','assignment.php',32],['competency/classes','api.php',49],['mod/assign','assignmentplugin.php',223],['lib/classes/plugininfo','orphaned.php',37],['search/tests/fixtures','mock_search_area.php',38],['tag/classes','area.php',106],['lib/classes/plugininfo','base.php',383],['mod/assign/feedback/editpdf','locallib.php',340],['tag/classes','tag.php',1269],['mod/assign/submission/comments','locallib.php',172],['lib','completionlib.php',269]], 276],
'reset_backup_ids_cached': ['reset_backup_ids_cached', 'Reset the ids caches completely ', [['backup/util/dbops','restore_dbops.class.php',332]], 1],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'get_recordset': ['get_recordset', 'Get the recordset. ', [['mod/glossary/classes','entry_query_builder.php',305],['lib/dml','moodle_database.php',1162]], 92],
'load_users_to_tempids': ['load_users_to_tempids', 'Load the needed users.xml file to backup_ids table for future reference ', [['backup/util/dbops','restore_dbops.class.php',419]], 2],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',6144]], 546],
'get_auth_plugin': ['get_auth_plugin', 'Returns an authentication plugin instance. ', [['lib','moodlelib.php',3608]], 81],
'start_progress': ['start_progress', 'Marks the start of an operation that will display progress. ', [['lib/classes/progress','base.php',77]], 85],
'calculate_course_names': ['calculate_course_names', 'Given on courseid, fullname and shortname, calculate the correct fullname/shortname to avoid dupes ', [['backup/util/dbops','restore_dbops.class.php',1683]], 2],
'set_backup_ids_record': ['set_backup_ids_record', '', [['backup/util/dbops','restore_dbops.class.php',1656]], 30],
'record_exists': ['record_exists', 'Check if a record exists by ID. ', [['competency/classes','persistent.php',842],['lib/dml','moodle_database.php',1817]], 901],
'strlen': ['strlen', 'Counts the number of characters. Unit-tested by Kasper (single byte charsets only) ', [['lib/typo3','class.t3lib_cs.php',1520],['lib/classes','text.php',305]], 1649],
'get_parent_context_ids': ['get_parent_context_ids', 'Returns parent contexts of this context in reversed order, i.e. parent first, then grand parent, etc. ', [['lib','accesslib.php',5725]], 55],
'load_categories_and_questions_to_tempids': ['load_categories_and_questions_to_tempids', 'Load the needed questions.xml file to backup_ids table for future reference ', [['backup/util/dbops','restore_dbops.class.php',451]], 2],
'get_assignable_roles': ['get_assignable_roles', 'Gets a list of roles that this user can assign in this context ', [['lib','accesslib.php',3415],['enrol','locallib.php',600]], 48],
'prevent_local_passwords': ['prevent_local_passwords', '', [['auth/radius','auth.php',148],['auth/nntp','auth.php',86],['auth/email','auth.php',170],['auth/mnet','auth.php',585],['auth/imap','auth.php',107],['auth/shibboleth','auth.php',167],['auth/pam','auth.php',98],['auth/manual','auth.php',109],['auth/none','auth.php',86],['auth/ldap','auth.php',1583],['lib','authlib.php',224],['auth/fc','auth.php',167],['auth/pop3','auth.php',103],['auth/nologin','auth.php',67],['auth/cas','auth.php',59],['auth/db','auth.php',673]], 2],
'set_backup_files_record': ['set_backup_files_record', '', [['backup/util/dbops','restore_dbops.class.php',1647]], 1],
'get_records_sql_menu': ['get_records_sql_menu', 'Get the first two columns from a number of records as an associative array using a SQL statement. ', [['lib/dml','moodle_database.php',1436]], 30],
'create_directory': ['create_directory', 'Create new directory, may throw exception - make sure params are valid. ', [['lib/filebrowser','file_info.php',367],['lib/filebrowser','file_info_stored.php',461],['lib/filestorage','file_storage.php',1100]], 23],
'upper': ['upper', 'Makes a string uppercase. ', [['lib/horde/framework/Horde','String.php',203]], 33],
'get_included_tasks': ['get_included_tasks', 'Return one array containing all the tasks that have been included in the restore process. Note that these tasks aren\'t built (they haven\'t steps nor ids data available) ', [['backup/util/dbops','restore_dbops.class.php',64]], 2],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'decode_backup_temp_info': ['decode_backup_temp_info', 'Decode the info field from backup_ids_temp or backup_files_temp. ', [['backup/util/dbops','backup_controller_dbops.class.php',169]], 15],
'precheck_user': ['precheck_user', 'Given one user object (from backup file), perform all the neccesary checks is order to decide how that user will be handled on restore. ', [['backup/util/dbops','restore_dbops.class.php',1255]], 1],
'sql_isnotempty': ['sql_isnotempty', 'Returns the proper SQL to know if one field is not empty. ', [['lib/dml','moodle_database.php',2228]], 21],
'set_processor': ['set_processor', '', [['backup/util/xml/parser','progressive_parser.class.php',123]], 20],
'restore_find_best_target_context': ['restore_find_best_target_context', 'Calculates the best context found to restore one collection of qcats, al them belonging to the same context (question bank), returning the target context found (object) or false ', [['backup/util/dbops','restore_dbops.class.php',750]], 1],
'precheck_categories_and_questions': ['precheck_categories_and_questions', 'Check all the included categories and questions, deciding the action to perform for each one (mapping / creation) and returning one array of problems in case something is wrong. ', [['backup/util/dbops','restore_dbops.class.php',467]], 2],
'send_files_to_pool': ['send_files_to_pool', 'Given one component/filearea/context and optionally one source itemname to match itemids put the corresponding files in the pool ', [['backup/util/dbops','restore_dbops.class.php',848]], 13],
'get_setting_value': ['get_setting_value', 'Returns the value of one (task/plan) setting ', [['backup/moodle2','backup_plugin.class.php',68],['backup/moodle2','restore_plugin.class.php',230],['backup/util/ui','base_ui.class.php',330],['backup/moodle2','restore_subplugin.class.php',169],['backup/moodle2','backup_subplugin.class.php',68],['backup/util/plan','base_step.class.php',98],['backup/util/plan','base_task.class.php',105]], 142],
'count_records': ['count_records', 'Count a list of records. ', [['competency/classes','persistent.php',815],['mod/glossary/classes','entry_query_builder.php',152],['lib/dml','moodle_database.php',1766]], 1630],
'destroy': ['destroy', 'Destroys a variable in the context. ', [['lib/htmlpurifier/HTMLPurifier','Context.php',57],['backup/util/settings','base_setting.class.php',125],['backup/converter','convertlib.php',255],['lib/adodb','adodb-xmlschema.inc.php',156],['lib/adodb','adodb-xmlschema.inc.php',2190],['backup/util/ui','backup_ui_setting.class.php',78],['backup/util/ui','base_ui.class.php',97],['backup/util/structure','base_final_element.class.php',53],['backup/util/plan','backup_plan.class.php',51],['backup/util/settings','setting_dependency.class.php',81],['backup/util/loggers','base_logger.class.php',74],['lib/adodb','adodb-xmlschema03.inc.php',174],['lib/adodb','adodb-xmlschema03.inc.php',2372],['backup/util/plan','base_plan.class.php',192],['backup/util/plan','restore_plan.class.php',62],['backup/controller','backup_controller.class.php',146],['backup/util/structure','base_nested_element.class.php',62],['repository/flickr_public','image.php',65],['backup/util/plan','base_step.class.php',60],['backup/util/ui','restore_ui_stage.class.php',208],['backup/controller','restore_controller.class.php',158],['backup/util/plan','base_task.class.php',199]], 504],
'is_anonymous_user': ['is_anonymous_user', 'Determine if the given user is an \'anonymous\' user, based on their username, firstname, lastname and email address. ', [['backup/util/helper','backup_anonymizer_helper.class.php',49]], 1],
'is_enabled_auth': ['is_enabled_auth', 'Checks if a given plugin is in the list of enabled authentication plugins. ', [['lib','moodlelib.php',3592]], 38],
'restore_get_questions': ['restore_get_questions', 'Return one array of question records for a given restore operation and one question category ', [['backup/util/dbops','restore_dbops.class.php',828]], 1],
'process_categories_and_questions': ['process_categories_and_questions', 'Process the needed question categories and questions to check all them, deciding about the action to perform (create/map) and target. ', [['backup/util/dbops','restore_dbops.class.php',1626]], 1],
'get_string_manager': ['get_string_manager', 'Returns current string_manager instance. ', [['lib','moodlelib.php',6678]], 163],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'__construct': ['__construct', '', [['lib/adodb/drivers','adodb-odbc_mssql.inc.php',50],['lib/adodb/drivers','adodb-odbc_mssql.inc.php',359],['question/classes/statistics/responses','analyser.php',69],['auth/radius','auth.php',38],['lib/xmldb','xmldb_file.php',43],['lib/lessphp/Tree/Mixin','Definition.php',18],['cache/stores/static','lib.php',127],['lib/classes/session','file.php',40],['lib/htmlpurifier/HTMLPurifier/Lexer','DOMLex.php',35],['backup/util/ui','base_moodleform.class.php',68],['lib/simplepie/library/SimplePie','Author.php',81],['lib/filestorage','zip_archive.php',66],['backup/util/structure','restore_path_element.class.php',47],['backup/util/structure','restore_path_element.class.php',128],['lib/htmlpurifier/HTMLPurifier/ChildDef','Chameleon.php',36],['lib/phpexcel/PHPExcel','HashTable.php',44],['mod/quiz/tests','repaginate_test.php',39],['lib/form','modvisible.php',43],['lib/phpexcel/PHPExcel/Worksheet','Row.php',44],['cache','disabledlib.php',44],['lib/phpexcel/PHPExcel/Worksheet','Dimension.php',58],['lib/mustache/src/Mustache/Cache','FilesystemCache.php',27],['question/type/ddwtos','question.php',61],['mnet/xmlrpc','client.php',25],['lib/horde/framework/Horde/Imap/Client','Url.php',112],['lib/classes','useragent.php',115],['lib/pear/HTML/QuickForm','advcheckbox.php',66],['lib/classes/update','checker_exception.php',37],['lib/phpexcel/PHPExcel/Reader','Excel2007.php',53],['lib/jabber/XMPP','XMPP.php',101],['lib/form','radio.php',44],['lib/spout/src/Spout/Reader/XLSX/Helper','StyleHelper.php',45],['auth/cas/CAS/CAS/ProxiedService/Http','Abstract.php',58],['lib/phpexcel/PHPExcel/Style','Border.php',67],['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',182],['lib/adodb/drivers','adodb-oci8quercus.inc.php',31],['lib/adodb/drivers','adodb-oci8quercus.inc.php',45],['lib/spout/src/Spout/Reader/XLSX','SheetIterator.php',29],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',91],['lib/phpexcel/PHPExcel','DocumentProperties.php',123],['lib/typo3','class.t3lib_cs.php',509],['mod/workshop/allocation/scheduled','lib.php',48],['lib/adodb/drivers','adodb-netezza.inc.php',53],['lib/adodb/drivers','adodb-netezza.inc.php',144],['mod/feedback/classes','complete_form.php',58],['search/classes','document.php',188],['webservice/rest','locallib.php',40],['lib/dml','mssql_native_moodle_recordset.php',34],['mod/assign/feedback/editpdf/fpdi','fpdi_pdf_parser.php',57],['lib/htmlpurifier/HTMLPurifier','TokenFactory.php',43],['backup/moodle2','backup_block_task.class.php',43],['lib/lessphp/Tree','Negative.php',14],['lib/minify/lib/Minify/Cache','APC.php',19],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',54],['lib/pear/HTML/QuickForm','header.php',33],['lib/spout/src/Spout/Reader/XLSX/Helper/SharedStringsCaching','InMemoryStrategy.php',26],['lib/phpexcel/PHPExcel/Worksheet','RowCellIterator.php',51],['lib/simplepie/library/SimplePie/XML/Declaration','Parser.php',110],['lib/phpexcel/PHPExcel/Worksheet','ColumnIterator.php',60],['lib/spout/src/Spout/Reader/ODS','Sheet.php',33],['question/type/calculated/tests','helper.php',205],['lib/adodb/drivers','adodb-odbtp.inc.php',38],['lib/adodb/drivers','adodb-odbtp.inc.php',673],['lib/adodb/drivers','adodb-odbtp.inc.php',796],['lib/adodb/drivers','adodb-odbtp.inc.php',806],['lib/adodb/drivers','adodb-odbtp.inc.php',816],['lib/adodb/drivers','adodb-odbtp.inc.php',826],['lib/adodb/drivers','adodb-odbtp.inc.php',836],['enrol/lti/ims-blti','blti.php',28],['backup/cc','cc2moodle.php',105],['mod/chat','locallib.php',181],['mod/chat','locallib.php',229],['user/filters','simpleselect.php',45],['lib/phpexcel/PHPExcel/CachedObjectStorage','Memcache.php',244],['lib/dml','pdo_moodle_database.php',42],['lib/adodb/drivers','adodb-sqlite3.inc.php',36],['lib/adodb/drivers','adodb-sqlite3.inc.php',350],['lib/pear/HTML/QuickForm','static.php',44],['competency/classes/external','comment_area_exporter.php',48],['lib/lessphp/Tree','Selector.php',31],['auth/cas/CAS/CAS','TypeMismatchException.php',43],['auth/fc','fcFPP.php',33],['lib/xmldb','xmldb_key.php',43],['grade/grading/form/rubric','rubriceditor.php',56],['lib/google/src/Google/Service','Cloudlatencytest.php',40],['course','moodleform_mod.php',69],['auth/nntp','auth.php',35],['grade/report/grader','lib.php',111],['admin/tool/generator/classes','course_backend.php',116],['lib/minify/lib','FirePHP.php',189],['lib/adodb/drivers','adodb-sqlitepo.inc.php',38],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',67],['lib/phpexcel/PHPExcel/CachedObjectStorage','CacheBase.php',66],['lib/lessphp/Tree','Rule.php',24],['lib/behat/features/bootstrap','behat_init_context.php',45],['lib','dmllib.php',69],['lib','dmllib.php',84],['lib','dmllib.php',104],['lib','dmllib.php',129],['lib','dmllib.php',159],['lib','dmllib.php',187],['lib','dmllib.php',240],['lib','dmllib.php',270],['lib/google/src/Google/Service','DataTransfer.php',44],['lib/google/src/Google/Http','Batch.php',42],['backup/util/structure','base_processor.class.php',49],['admin/tool/lpmigrate/classes','framework_mapper.php',50],['lib/phpexcel/PHPExcel/Reader','OOCalc.php',46],['lib/lessphp/Tree','NameValue.php',22],['mod/quiz/classes','admin_review_setting.php',82],['lib/htmlpurifier/HTMLPurifier','Generator.php',67],['mod/quiz/report','attemptsreport_table.php',76],['blocks/lp/classes/output','summary.php',59],['lib/google/src/Google/IO','Stream.php',45],['lib/google/src/Google/Service','Freebase.php',38],['grade/tests','reportlib_test.php',36],['search/classes','manager.php',100],['question/behaviour/adaptive','behaviour.php',310],['admin/tool/lp/classes/form','framework_autocomplete.php',48],['lib/minify/lib','JSMinPlus.php',193],['lib/minify/lib','JSMinPlus.php',726],['lib/minify/lib','JSMinPlus.php',1638],['lib/minify/lib','JSMinPlus.php',1656],['lib/minify/lib','JSMinPlus.php',1748],['lib/simplepie/library/SimplePie','Copyright.php',73],['lib/phpexcel/PHPExcel/Style','Conditional.php',93],['lib/google/src/Google/Task','Runner.php',76],['backup/util/settings/root','root_backup_setting.class.php',34],['lib','componentlib.class.php',179],['lib','componentlib.class.php',610],['lib','componentlib.class.php',834],['lib/google/src/Google/Service','AdSense.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef','Clone.php',18],['lib/spout/src/Spout/Reader/CSV','Sheet.php',24],['lib/filebrowser','file_info_context_system.php',37],['lib/grade','grade_item.php',260],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nstring.php',27],['repository/boxnet','lib.php',56],['auth/email','auth.php',34],['mod/wiki/editors','wikifiletable.php',40],['lib/google/src/Google/Service','Replicapool.php',51],['lib/dtl','database_exporter.php',55],['lib/horde/framework/Horde/Imap/Client/Namespace','List.php',34],['lib/phpexcel/PHPExcel/Writer','CSV.php',79],['lib/google/src/Google/Service','Tasks.php',44],['lib/dml','mysqli_native_moodle_recordset.php',42],['lib/google/src/Google/Service','GamesManagement.php',50],['lib/minify/lib/Minify','Source.php',43],['lib/jabber/XMPP','Roster.php',48],['lib/lessphp/Tree','Element.php',19],['lib/classes','string_manager_install.php',43],['question/type','questiontypebase.php',55],['question/type','questiontypebase.php',1442],['lib/form','filemanager.php',54],['lib/form','filemanager.php',316],['lib/htmlpurifier/HTMLPurifier/ChildDef','Custom.php',36],['backup/util/ui','renderer.php',813],['lib/simplepie/library/SimplePie','Rating.php',73],['lib/phpexcel/PHPExcel/Cell','Hyperlink.php',44],['question/classes/statistics/questions','calculator.php',66],['backup/moodle2','backup_xml_transformer.class.php',50],['lib/google/src/Google/Service','Resource.php',62],['lib/form','autocomplete.php',56],['lib/phpexcel/PHPExcel/Worksheet','RowIterator.php',60],['mod/lesson/classes','file_info.php',45],['question/type/tests','question_first_matching_answer_grading_strategy_test.php',40],['lib/google/src/Google/Service','Partners.php',43],['cache','lib.php',66],['cache','lib.php',109],['cache','lib.php',138],['cache','lib.php',183],['grade/edit/tree','lib.php',57],['grade/edit/tree','lib.php',635],['grade/edit/tree','lib.php',668],['grade/edit/tree','lib.php',834],['lib/simplepie/library/SimplePie','Cache.php',69],['mod/wiki/diff','difflib.php',277],['mod/wiki/diff','difflib.php',381],['mod/wiki/diff','difflib.php',478],['lib/pear/HTML/QuickForm','select.php',58],['lib/classes/output','mustache_javascript_helper.php',40],['lib/phpexcel/PHPExcel/Reader/Excel2007','Theme.php',68],['mod/data','export_form.php',16],['lib/pear/HTML/QuickForm','autocomplete.php',67],['question/type/shortanswer','question.php',44],['lib/google/src/Google/Service','AndroidPublisher.php',52],['lib/google/src/Google/Verifier','Pem.php',31],['lib/classes/antivirus','scanner.php',41],['lib/phpexcel/PHPExcel/Reader','Excel5.php',414],['lib/horde/framework/Horde/Imap/Client/Auth','DigestMD5.php',69],['lib/classes/output','mustache_filesystem_loader.php',39],['lib/classes/output','inplace_editable.php',107],['lib/adodb/drivers','adodb-informix.inc.php',37],['competency/classes','competency_rule.php',45],['lib/phpexcel/PHPExcel','RichText.php',37],['lib/phpexcel/PHPExcel/Shared/JAMA','Matrix.php',59],['lib/pear/HTML/QuickForm','input.php',38],['repository/picasa','lib.php',41],['mod/feedback/classes','structure.php',48],['backup/util/plan','backup_structure_step.class.php',38],['question/classes/bank','random_question_loader.php',61],['mod/quiz/report/statistics/classes','calculated.php',43],['lib/horde/framework/Horde/Stream','String.php',27],['backup/util/helper','restore_decode_content.class.php',50],['backup/util/helper','restore_decode_content.class.php',125],['mod/workshop/backup/moodle1','lib.php',308],['lib/google/src/Google/Service','YouTubeReporting.php',47],['grade/export/txt','grade_export_txt.php',27],['lib/mustache/src/Mustache/Exception','SyntaxException.php',23],['lib/tcpdf','tcpdf_barcodes_2d.php',58],['mod/imscp','locallib.php',289],['lib/form','selectyesno.php',42],['lib/horde/framework/Horde/Mail/Transport','Smtphorde.php',62],['mod/lti/service/toolsettings/classes/local/service','toolsettings.php',41],['mod/lti/service/profile/classes/local/service','profile.php',41],['repository/flickr_public','lib.php',49],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','BackgroundPosition.php',57],['admin/tool/lp/classes/output','template_cohorts_table.php',53],['lib/simplepie/library','SimplePie.php',611],['lib/horde/framework/Horde/Imap/Client/Base','Debug.php',55],['lib/google/src/Google/Service','Reseller.php',44],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Border.php',18],['lib/testing/generator','component_generator_base.php',45],['lib/horde/framework/Horde/Translation/Handler','Gettext.php',34],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooter.php',175],['lib/classes','plugin_manager.php',91],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',28],['lib/horde/framework/Horde/Support','CombineStream.php',29],['lib/xmldb','xmldb_field.php',84],['lib/adodb/drivers','adodb-ibase.inc.php',59],['lib/adodb/drivers','adodb-ibase.inc.php',764],['lib/htmlpurifier/HTMLPurifier/AttrDef','URI.php',23],['admin/roles/classes','view_role_definition_table.php',28],['lib/google/src/Google/Cache','Memcache.php',44],['lib/pear/HTML/QuickForm','radio.php',48],['lib/filebrowser','file_info_context_coursecat.php',39],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',37],['mod/workshop/eval/best','lib.php',44],['lib/phpexcel/PHPExcel/Writer/PDF','DomPDF.php',38],['grade/report','lib.php',156],['lib','csslib.php',1501],['lib','csslib.php',1587],['lib','csslib.php',2068],['lib','csslib.php',2136],['lib','csslib.php',2242],['availability/classes','info_module.php',40],['mod/book','locallib.php',414],['question/engine','datalib.php',68],['question/engine','datalib.php',1331],['question/engine','datalib.php',1632],['question/engine','datalib.php',1740],['question/engine','datalib.php',1870],['question/engine','datalib.php',1941],['webservice','lib.php',745],['webservice','lib.php',841],['lib/adodb/drivers','adodb-informix72.inc.php',59],['lib/adodb/drivers','adodb-informix72.inc.php',399],['lib/adodb','adodb-pager.inc.php',60],['user/classes/output/myprofile','category.php',68],['lib/lessphp/Visitor','extendFinder.php',15],['backup/util/settings','base_setting.class.php',89],['backup/util/settings','base_setting.class.php',556],['lib','filelib.php',2720],['lib','filelib.php',3601],['lib/phpunit/classes','database_driver_testcase.php',55],['lib/phpexcel/PHPExcel/Shared/OLE/PPS','File.php',32],['report/competency/classes/output','report.php',56],['lib/google/src/Google/Service','Computeaccounts.php',49],['question/type','edit_question_form.php',96],['lib/filebrowser','file_info_context_user.php',39],['admin/tool/lp/classes/output','template_plans_page.php',37],['lib/phpexcel/PHPExcel','Style.php',93],['lib/minify/lib/Minify','HTML.php',49],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ListStyle.php',20],['lib/form','password.php',44],['backup','backup.class.php',146],['mod/feedback/classes','course_select_form.php',39],['lib/google/src/Google/Auth','AppIdentity.php',39],['lib/adodb','adodb-active-record.inc.php',121],['lib/phpexcel/PHPExcel','Chart.php',169],['lib/horde/framework/Horde/Mail/Rfc822','List.php',61],['admin/roles/classes','allow_switch_page.php',33],['lib/grade','grade_object.php',80],['lib/google/src/Google/IO','Exception.php',29],['auth/lti','auth.php',38],['mod/quiz/report/statistics/classes','calculator.php',39],['lib/htmlpurifier','HTMLPurifier.php',104],['admin/tool/lp/classes/output','user_competency_summary_in_plan.php',47],['mod/assign/feedback/editpdf/classes','widget.php',53],['lib/evalmath','evalmath.class.php',120],['lib/form','url.php',46],['lib/dml','pdo_moodle_recordset.php',41],['lib/htmlpurifier/HTMLPurifier/TagTransform','Simple.php',19],['backup/cc/cc_lib','xmlbase.php',52],['badges/lib','bakerlib.php',52],['lib/google/src/Google/Signer','P12.php',35],['availability/classes','info_section.php',40],['lib/form','static.php',47],['backup/converter','convertlib.php',52],['backup/converter','convertlib.php',277],['lib/google/src/Google/Service','YouTubeAnalytics.php',56],['admin/roles/classes','check_capability_table.php',40],['lib/htmlpurifier/HTMLPurifier','AttrTypes.php',14],['lib/adodb/drivers','adodb-postgres64.inc.php',127],['lib/adodb/drivers','adodb-postgres64.inc.php',919],['backup/util/helper','restore_prechecks_helper.class.php',213],['user/profile','lib.php',59],['lib/google/src/Google/Service','Admin.php',40],['lib/spout/src/Spout/Reader/CSV','RowIterator.php',62],['lib/google/src/Google/Service','MapsEngine.php',66],['lib','listlib.php',82],['lib','listlib.php',485],['lib/phpexcel/PHPExcel/Writer','HTML.php',128],['backup/moodle2','restore_activity_task.class.php',48],['lib/htmlpurifier/HTMLPurifier','HTMLModuleManager.php',68],['lib/simplepie/library/SimplePie','Source.php',61],['completion','data_object.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','ID.php',28],['grade/report/singleview/classes/local/ui','dropdown_attribute.php',49],['lib/horde/framework/Horde/Support','Stack.php',18],['lib/google/src/Google/Cache','File.php',41],['lib/horde/framework/Horde/Mail/Transport','Mock.php',76],['backup/util/ui','backup_moodleform.class.php',41],['availability/condition/grouping/classes','condition.php',46],['lib/classes/session','memcache.php',50],['cache/classes','dummystore.php',62],['badges/classes','assertion.php',49],['lib/xhprof/xhprof_lib/utils','xhprof_runs.php',87],['availability/tests/fixtures','mock_condition.php',52],['lib/mustache/src/Mustache/Loader','FilesystemLoader.php',33],['mod/quiz/report','attemptsreport_options.php',95],['lib/phpexcel/PHPExcel/Writer/PDF','tcPDF.php',39],['lib/minify/lib/Minify/CSS','Compressor.php',51],['lib/google/src/Google/Service','Dns.php',53],['question/type/calculatedmulti','edit_calculatedmulti_form.php',47],['backup/moodle2','restore_block_task.class.php',45],['lib/phpexcel/PHPExcel/Worksheet','AutoFilter.php',54],['lib/form','recaptcha.php',48],['lib','csvlib.class.php',64],['lib','csvlib.class.php',398],['lib/simplepie/library/SimplePie/Cache','File.php',82],['lib/phpexcel/PHPExcel/Chart','Legend.php',75],['lib/phpexcel/PHPExcel','WorksheetIterator.php',44],['cache/classes','loaders.php',196],['cache/classes','loaders.php',1189],['cache/classes','loaders.php',1586],['lib/google/src/Google/Service','Appengine.php',44],['admin/tool/lp/classes/output','template_cohorts_page.php',37],['search/classes','engine.php',77],['backup/cc/cc_lib','cc_assesment_essay.php',25],['lib/classes/progress','display.php',48],['lib/lessphp/Tree','Call.php',19],['course/format','lib.php',78],['question/type/calculated','datasetdefinitions_form.php',53],['lib/google/src/Google/Service','Translate.php',40],['enrol/database','settingslib.php',34],['lib/lessphp/Tree/Mixin','Call.php',14],['admin/tool/log/store/standard/classes/log','store.php',37],['lib/google/src/Google/Service','Urlshortener.php',40],['lib/horde/framework/Horde/Imap/Client','Socket.php',168],['lib/tests','collator_test.php',310],['lib/google/src/Google/Auth','Simple.php',31],['backup/cc/cc_lib','cc_manifest.php',45],['lib/bennu','iCalendar_properties.php',28],['lib/bennu','iCalendar_properties.php',220],['lib/bennu','iCalendar_properties.php',238],['lib/bennu','iCalendar_properties.php',259],['lib/bennu','iCalendar_properties.php',275],['lib/bennu','iCalendar_properties.php',296],['lib/bennu','iCalendar_properties.php',343],['lib/bennu','iCalendar_properties.php',358],['lib/bennu','iCalendar_properties.php',376],['lib/bennu','iCalendar_properties.php',391],['lib/bennu','iCalendar_properties.php',406],['lib/bennu','iCalendar_properties.php',447],['lib/bennu','iCalendar_properties.php',462],['lib/bennu','iCalendar_properties.php',485],['lib/bennu','iCalendar_properties.php',509],['lib/bennu','iCalendar_properties.php',524],['lib/bennu','iCalendar_properties.php',555],['lib/bennu','iCalendar_properties.php',573],['lib/bennu','iCalendar_properties.php',594],['lib/bennu','iCalendar_properties.php',637],['lib/bennu','iCalendar_properties.php',680],['lib/bennu','iCalendar_properties.php',724],['lib/bennu','iCalendar_properties.php',747],['lib/bennu','iCalendar_properties.php',782],['lib/bennu','iCalendar_properties.php',808],['lib/bennu','iCalendar_properties.php',849],['lib/bennu','iCalendar_properties.php',864],['lib/bennu','iCalendar_properties.php',905],['lib/bennu','iCalendar_properties.php',938],['lib/bennu','iCalendar_properties.php',952],['lib/bennu','iCalendar_properties.php',965],['lib/bennu','iCalendar_properties.php',987],['lib/bennu','iCalendar_properties.php',1017],['lib/bennu','iCalendar_properties.php',1031],['lib/bennu','iCalendar_properties.php',1061],['lib/bennu','iCalendar_properties.php',1075],['lib/bennu','iCalendar_properties.php',1098],['lib/bennu','iCalendar_properties.php',1110],['lib/bennu','iCalendar_properties.php',1139],['lib/bennu','iCalendar_properties.php',1160],['lib/bennu','iCalendar_properties.php',1181],['lib/bennu','iCalendar_properties.php',1203],['lib/bennu','iCalendar_properties.php',1227],['lib/bennu','iCalendar_properties.php',1260],['lib/bennu','iCalendar_properties.php',1386],['lib/bennu','iCalendar_properties.php',1407],['lib/bennu','iCalendar_properties.php',1429],['lib/bennu','iCalendar_properties.php',1450],['lib/mustache/src/Mustache/Exception','UnknownTemplateException.php',22],['lib/phpmailer','moodle_phpmailer.php',47],['availability/tests/fixtures','mock_info.php',40],['lib/horde/framework/Horde/Mail/Transport','Smtpmx.php',138],['admin/tool/lp/classes/form','persistent.php',68],['lib/adodb/drivers','adodb-mysqlt.inc.php',32],['lib/adodb/drivers','adodb-mysqlt.inc.php',96],['webservice/tests','lib_test.php',213],['lib/horde/framework/Horde/Imap/Client/Data/Format','Mailbox.php',35],['filter','local_settings_form.php',33],['mod/quiz/accessrule','accessrulebase.php',52],['lib/horde/framework/Horde/Exception','Wrapped.php',16],['mod/assign/feedback/editpdf/fpdi','pdf_parser.php',170],['lib/lessphp/Tree','Dimension.php',15],['lib/minify/lib/HTTP','ConditionalGet.php',109],['lib/adodb/perf','perf-oci8.inc.php',203],['lib/phpexcel','PHPExcel.php',361],['backup/util/helper','restore_questions_parser_processor.class.php',42],['backup/moodle2','backup_plugin.class.php',44],['lib/classes/antivirus','scanner_exception.php',38],['webservice/xmlrpc','lib.php',43],['report/loglive/classes','renderable.php',73],['course','dnduploadlib.php',109],['course','dnduploadlib.php',407],['lib/filebrowser','file_info.php',43],['lib/adodb/drivers','adodb-access.inc.php',34],['lib/adodb/drivers','adodb-access.inc.php',83],['mod/feedback/classes','responses_table.php',54],['lib/editor/tinymce','adminlib.php',36],['admin/tool/monitor/classes','rule.php',44],['lib/google/src/Google/Service','AdExchangeBuyer.php',55],['lib/filebrowser','virtual_root_file.php',45],['lib/phpexcel/PHPExcel/RichText','Run.php',35],['admin/tool/monitor/classes/output/managesubs','subs.php',51],['auth/cas/CAS/CAS','ProxyChain.php',48],['lib/htmlpurifier/HTMLPurifier','DefinitionCache.php',22],['lib/google/src/Google/Service','CivicInfo.php',40],['mod/feedback/classes/output','summary.php',52],['lib/minify/lib/Minify','Build.php',77],['lib/adodb/drivers','adodb-ado_mssql.inc.php',146],['lib/adodb/drivers','adodb-odbc.inc.php',44],['lib/adodb/drivers','adodb-odbc.inc.php',611],['lib','moodlelib.php',9421],['lib','moodlelib.php',9632],['user/selector','lib.php',85],['user/selector','lib.php',674],['admin/tool/lp/classes/output','plan_page.php',49],['repository/dropbox','lib.php',49],['lib/horde/framework/Horde/Mime','Part.php',261],['lib/spout/src/Spout/Reader/XLSX/Helper/SharedStringsCaching','CachingStrategyFactory.php',56],['lib/phpexcel/PHPExcel/Chart','Layout.php',143],['lib/mustache/src/Mustache/Loader','CascadingLoader.php',20],['lib/phpexcel/PHPExcel/Shared/JAMA','EigenvalueDecomposition.php',777],['lib/google/src/Google/Service','Books.php',60],['lib/google/src/Google/Service','Oauth2.php',50],['admin/tool/log/classes/log','store.php',30],['admin/tool/recyclebin/classes','category_bin.php',45],['lib/phpexcel/PHPExcel/Style','Color.php',64],['lib/phpexcel/PHPExcel/Worksheet','SheetView.php',69],['lib/htmlpurifier/HTMLPurifier/Token','Text.php',34],['lib/classes/update','checker.php',50],['lib/horde/framework/Horde/Socket','Client.php',52],['lib/phpexcel/PHPExcel/CachedObjectStorage','APC.php',243],['lib/horde/framework/Horde/Imap/Client/Cache','Backend.php',33],['lib/phpexcel/PHPExcel/Chart','Title.php',45],['lib/horde/framework/Horde/Imap/Client/Data','Format.php',32],['lib/adodb/drivers','adodb-text.inc.php',93],['lib/adodb/drivers','adodb-text.inc.php',379],['lib/phpexcel/PHPExcel','Calculation.php',2071],['lib/adodb/drivers','adodb-sqlite.inc.php',36],['lib/adodb/drivers','adodb-sqlite.inc.php',367],['lib/google/src/Google/Service','Analytics.php',77],['blocks/lp/classes/output','plans_to_review_page.php',48],['lib/google/src/Google/Service','Coordinate.php',48],['availability/condition/group/classes','condition.php',43],['lib/lessphp/Exception','Chunk.php',19],['lib/htmlpurifier/HTMLPurifier','PropertyListIterator.php',22],['backup/cc/cc_lib','cc_resources.php',102],['lib/horde/framework/Horde/Mail/Rfc822','Group.php',45],['backup/util/structure','base_optigroup.class.php',35],['backup/util/structure','base_optigroup.class.php',169],['question/classes/statistics/questions','calculated.php',181],['lib/horde/framework/Horde/Imap/Client/Interaction','Command.php',72],['lib/htmlpurifier/HTMLPurifier/Strategy','Core.php',8],['lib/htmlpurifier/HTMLPurifier/Filter','ExtractStyleBlocks.php',57],['backup/cc/cc_lib','cc_converter_url.php',29],['lib/xmldb','xmldb_structure.php',40],['lib/ddl','sqlite_sql_generator.php',73],['lib/pear/HTML/QuickForm','Renderer.php',31],['backup/util/helper','restore_moodlexml_parser_processor.class.php',38],['lib/pear/HTML/QuickForm','file.php',54],['lib/minify/lib/Minify/Cache','File.php',9],['lib/pear/HTML/QuickForm','xbutton.php',39],['lib/htmlpurifier','locallib.php',134],['admin/tool/recyclebin/classes','course_bin.php',45],['backup/util/plan','backup_task.class.php',32],['backup/util/plan','backup_task.class.php',56],['lib/phpexcel/PHPExcel/CachedObjectStorage','PHPTemp.php',174],['backup/util/helper','backup_helper.class.php',381],['lib/form','htmleditor.php',48],['lib','oauthlib.php',65],['lib','oauthlib.php',409],['auth/cas/CAS/CAS/PGTStorage','File.php',105],['auth/cas/CAS/CAS/ProxiedService','Imap.php',51],['repository/skydrive','lib.php',42],['lib/htmlpurifier/HTMLPurifier','ErrorCollector.php',57],['lib/classes/lock','postgres_lock_factory.php',81],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite.php',260],['lib/horde/framework/Horde/Support','ConsistentHash.php',56],['lib/horde/framework/Horde/Exception','Pear.php',22],['lib/portfolio','exceptions.php',50],['backup/moodle2','restore_plugin.class.php',43],['lib/phpexcel/PHPExcel/CachedObjectStorage','DiscISAM.php',177],['lib/google/src/Google/Service','DoubleClickBidManager.php',40],['lib/minify/lib/Minify/JS','ClosureCompiler.php',101],['lib/horde/framework/Horde/Imap/Client/Data/Format','String.php',38],['lib/form','dateselector.php',70],['lib/spout/src/Spout/Common/Helper','EncodingHelper.php',38],['report/competency/classes/output','user_course_navigation.php',51],['lib/adodb/drivers','adodb-postgres7.inc.php',98],['lib/adodb/drivers','adodb-postgres7.inc.php',311],['lib/adodb/drivers','adodb-postgres7.inc.php',342],['lib/lessphp/Tree','Alpha.php',13],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',46],['lib/tcpdf','tcpdf.php',1822],['lib/adodb/drivers','adodb-sybase.inc.php',47],['lib/adodb/drivers','adodb-sybase.inc.php',313],['lib/adodb/drivers','adodb-sybase.inc.php',394],['lib/phpexcel/PHPExcel/Chart','PlotArea.php',44],['lib/phpexcel/PHPExcel/Chart','DataSeries.php',136],['mod/lesson','editpage_form.php',41],['question/classes/statistics/responses','analysis_for_question.php',58],['lib/horde/framework/Horde','Domhtml.php',53],['lib','formslib.php',142],['lib','formslib.php',1442],['lib','formslib.php',2653],['rating','lib.php',114],['rating','lib.php',1070],['lib/phpexcel/PHPExcel/Worksheet','Column.php',44],['lib/google/src/Google/Service','Script.php',67],['lib/adodb','adodb-xmlschema.inc.php',118],['lib/adodb','adodb-xmlschema.inc.php',245],['lib/adodb','adodb-xmlschema.inc.php',637],['lib/adodb','adodb-xmlschema.inc.php',781],['lib/adodb','adodb-xmlschema.inc.php',982],['lib/adodb','adodb-xmlschema.inc.php',1295],['lib/google/src/Google/Service','DeploymentManager.php',54],['mod/quiz','attemptlib.php',41],['mod/quiz','attemptlib.php',82],['mod/quiz','attemptlib.php',546],['mod/quiz','attemptlib.php',2337],['mod/quiz','attemptlib.php',2392],['backup/cc/cc_lib','cc_converter_forum.php',29],['lib','boxlib.php',264],['lib/simplepie/library/SimplePie','Restriction.php',81],['admin/roles/classes','allow_assign_page.php',31],['lib/adodb/drivers','adodb-pdo.inc.php',90],['lib/adodb/drivers','adodb-pdo.inc.php',553],['lib/adodb/drivers','adodb-pdo.inc.php',630],['tag/classes/output','tagareacollection.php',40],['admin/tool/lp/classes','template_statistics.php',62],['lib','weblib.php',313],['lib','weblib.php',3183],['lib','weblib.php',3483],['lib','weblib.php',3518],['lib','weblib.php',3593],['backup/cc/cc_lib','cc_converter_basiclti.php',29],['lib/html2text','Html2Text.php',232],['mod/assign/feedback/editpdf/classes','annotation.php',66],['lib/pear/HTML/QuickForm/Renderer','Array.php',143],['question/engine','lib.php',774],['question/engine','lib.php',1011],['question/engine','lib.php',1059],['lib/jabber/XMPP','XMLObj.php',76],['lib/horde/framework/Horde/Exception','PermissionDenied.php',15],['lib/editor/atto','adminlib.php',109],['lib/pear/HTML/QuickForm/Renderer','Tableless.php',116],['grade/report/history/classes/output','tablelog.php',72],['lib/google/src/Google/IO','Curl.php',38],['lib/editor/tinymce/plugins/spellchecker/classes/utils','Logger.php',31],['lib/pear/HTML/QuickForm','hiddenselect.php',41],['backup/util/ui','backup_ui_setting.class.php',70],['backup/util/ui','backup_ui_setting.class.php',200],['backup/util/ui','backup_ui_setting.class.php',398],['backup/util/ui','backup_ui_setting.class.php',504],['backup/util/ui','backup_ui_setting.class.php',583],['lib/adodb/drivers','adodb-mysqlpo.inc.php',35],['lib/adodb/drivers','adodb-mysqlpo.inc.php',82],['lib/adodb/drivers','adodb-mysqlpo.inc.php',119],['lib/google/src/Google/Service','Blogger.php',50],['backup/util/xml/output','file_xml_output.class.php',37],['lib/form','tags.php',75],['admin/tool/installaddon/classes','installer.php',219],['lib/htmlpurifier/HTMLPurifier/AttrDef','Enum.php',30],['lib/simplepie/library/SimplePie','IRI.php',252],['comment','locallib.php',39],['question/engine','states.php',61],['lib/spout/src/Spout/Reader/XLSX/Helper','CellValueFormatter.php',52],['lib/google/src/Google/Service','Dataflow.php',45],['mod/data','locallib.php',66],['mod/data','locallib.php',433],['lib/horde/framework/Horde','Variables.php',60],['backup/util/ui','base_ui.class.php',84],['lib/simplepie/library/SimplePie','Registry.php',99],['cache/locks/file','lib.php',66],['question/classes/statistics/responses','analysis_for_class.php',68],['lib/filebrowser','file_info_stored.php',51],['tag/classes/output','tagcollname.php',42],['competency/classes','persistent.php',54],['admin/tool/lp/classes/output','competency_plan_navigation.php',54],['lib/phpexcel/PHPExcel/Cell','DataValidation.php',146],['lib/pear/HTML/QuickForm','textarea.php',48],['lib/lessphp','Visitor.php',14],['lib/google/src/Google/Service','CloudUserAccounts.php',52],['question/classes/bank','column_base.php',44],['lib/minify/lib/MrClay','Cli.php',74],['lib','outputcomponents.php',80],['lib','outputcomponents.php',204],['lib','outputcomponents.php',469],['lib','outputcomponents.php',523],['lib','outputcomponents.php',589],['lib','outputcomponents.php',665],['lib','outputcomponents.php',783],['lib','outputcomponents.php',925],['lib','outputcomponents.php',1009],['lib','outputcomponents.php',2183],['lib','outputcomponents.php',2222],['lib','outputcomponents.php',2295],['lib','outputcomponents.php',2376],['lib','outputcomponents.php',2579],['lib','outputcomponents.php',2627],['lib','outputcomponents.php',2687],['lib','outputcomponents.php',2860],['lib','outputcomponents.php',3030],['lib','outputcomponents.php',3134],['lib','outputcomponents.php',3201],['lib','outputcomponents.php',3329],['lib','outputcomponents.php',3613],['lib','outputcomponents.php',3642],['lib','outputcomponents.php',3668],['lib','outputcomponents.php',3690],['lib','outputcomponents.php',3719],['lib','outputcomponents.php',3751],['lib/google/src/Google/Service','Pagespeedonline.php',39],['lib/phpexcel/PHPExcel','Cell.php',114],['lib/dml','sqlsrv_native_moodle_recordset.php',40],['repository/wikimedia','wikimedia.php',35],['lib/phpexcel/PHPExcel/Style','Fill.php',81],['lib/google/src/Google/Service','Cloudresourcemanager.php',42],['lib/editor/tinymce/classes','plugin.php',49],['mod/wiki/parser/markups','html.php',21],['lib/simplepie/library/SimplePie/Parse','Date.php',536],['lib/horde/framework/Horde/Support','Inflector.php',115],['question/type/gapselect','question.php',55],['lib/google/src/Google','Config.php',33],['badges/criteria','award_criteria_activity.php',45],['backup/util/xml/output','xml_output.class.php',52],['backup/util/xml/output','xml_output.class.php',158],['course/format/topics','renderer.php',38],['lib/adodb/drivers','adodb-oci8po.inc.php',33],['lib/adodb/drivers','adodb-oci8po.inc.php',99],['mod/workshop/allocation/random','lib.php',52],['mod/workshop/allocation/random','lib.php',727],['backup/util/structure','base_final_element.class.php',38],['backup/util/structure','base_final_element.class.php',239],['backup/util/structure','base_final_element.class.php',256],['lib/htmlpurifier/HTMLPurifier','Zipper.php',25],['lib/horde/framework/Horde/Imap/Client/Data','Thread.php',41],['lib/mustache/src/Mustache/Exception','UnknownHelperException.php',22],['backup/util/settings/activity','activity_backup_setting.class.php',25],['lib/filestorage','tgz_packer.php',749],['lib/filestorage','tgz_packer.php',831],['tag/classes','index_builder.php',96],['lib/pear/HTML/QuickForm','reset.php',37],['lib/classes/lock','lock.php',55],['admin/roles/classes','assign_user_selector_base.php',40],['backup/util/output','output_controller.class.php',44],['question/type/randomsamatch','question.php',114],['lib/google/src/Google/Service','Customsearch.php',38],['lib/lessphp/Tree','Extend.php',28],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',215],['lib/google/src/Google/Service','TagManager.php',67],['question/type/gapselect/tests','edit_form_test.php',41],['mod/lesson','locallib.php',2004],['mod/lesson','locallib.php',2611],['backup/util/helper','restore_structure_parser_processor.class.php',41],['course','renderer.php',52],['backup/util/xml/parser/processors','selective_exact_parser_processor.class.php',35],['lib','modinfolib.php',429],['lib','modinfolib.php',1665],['lib','modinfolib.php',2492],['lib','tablelib.php',128],['lib','tablelib.php',1468],['lib','tablelib.php',1633],['lib','tablelib.php',1698],['user/filters','cohort.php',36],['user/filters','text.php',37],['lib','outputrenderers.php',120],['lib','outputrenderers.php',285],['lib','outputrenderers.php',408],['lib','outputrenderers.php',4578],['lib','outputrenderers.php',4831],['repository','lib.php',116],['repository','lib.php',533],['lib','adminlib.php',791],['lib','adminlib.php',1138],['lib','adminlib.php',1212],['lib','adminlib.php',1355],['lib','adminlib.php',1556],['lib','adminlib.php',1928],['lib','adminlib.php',2040],['lib','adminlib.php',2106],['lib','adminlib.php',2199],['lib','adminlib.php',2260],['lib','adminlib.php',2302],['lib','adminlib.php',2341],['lib','adminlib.php',2429],['lib','adminlib.php',2463],['lib','adminlib.php',2621],['lib','adminlib.php',2706],['lib','adminlib.php',2935],['lib','adminlib.php',3091],['lib','adminlib.php',3233],['lib','adminlib.php',3324],['lib','adminlib.php',3488],['lib','adminlib.php',3571],['lib','adminlib.php',3682],['lib','adminlib.php',3833],['lib','adminlib.php',4067],['lib','adminlib.php',4134],['lib','adminlib.php',4352],['lib','adminlib.php',4381],['lib','adminlib.php',4410],['lib','adminlib.php',4434],['lib','adminlib.php',4464],['lib','adminlib.php',4500],['lib','adminlib.php',4535],['lib','adminlib.php',4567],['lib','adminlib.php',4657],['lib','adminlib.php',4690],['lib','adminlib.php',4748],['lib','adminlib.php',4790],['lib','adminlib.php',4814],['lib','adminlib.php',4840],['lib','adminlib.php',4863],['lib','adminlib.php',4880],['lib','adminlib.php',4925],['lib','adminlib.php',4943],['lib','adminlib.php',5002],['lib','adminlib.php',5045],['lib','adminlib.php',5080],['lib','adminlib.php',5123],['lib','adminlib.php',5206],['lib','adminlib.php',5336],['lib','adminlib.php',5378],['lib','adminlib.php',5423],['lib','adminlib.php',5480],['lib','adminlib.php',5496],['lib','adminlib.php',5552],['lib','adminlib.php',5777],['lib','adminlib.php',5831],['lib','adminlib.php',5885],['lib','adminlib.php',5902],['lib','adminlib.php',5950],['lib','adminlib.php',5992],['lib','adminlib.php',6043],['lib','adminlib.php',6099],['lib','adminlib.php',6328],['lib','adminlib.php',6508],['lib','adminlib.php',6688],['lib','adminlib.php',6782],['lib','adminlib.php',6931],['lib','adminlib.php',7088],['lib','adminlib.php',7712],['lib','adminlib.php',8147],['lib','adminlib.php',8330],['lib','adminlib.php',8617],['lib','adminlib.php',8764],['lib','adminlib.php',8924],['lib','adminlib.php',9071],['lib','adminlib.php',9235],['lib','adminlib.php',9428],['lib','adminlib.php',9482],['lib','adminlib.php',9544],['lib','adminlib.php',9589],['lib','adminlib.php',9626],['backup/cc/cc_lib','cc_organization.php',47],['backup/cc/cc_lib','cc_organization.php',145],['lib/phpexcel/PHPExcel/Chart','DataSeriesValues.php',81],['lib/horde/framework/Horde/Mail/Rfc822','Identification.php',34],['question/type/numerical','questiontype.php',507],['auth/mnet','auth.php',35],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Cache.php',68],['lib/htmlpurifier/HTMLPurifier','PropertyList.php',29],['auth/imap','auth.php',35],['tag/classes/output','taglist.php',54],['lib','pdflib.php',161],['lib/phpexcel/PHPExcel/RichText','TextElement.php',35],['lib/dml','database_column_info.php',112],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportExtension.php',33],['mod/wiki/editors','wikieditor.php',36],['lib/lessphp/SourceMap','Base64VLQ.php',67],['repository/s3','lib.php',44],['admin/tool/uploadcourse/classes','course.php',111],['lib/google/src/Google/Service','Replicapoolupdater.php',51],['lib/horde/framework/Horde/Imap/Client/Data/Format','Date.php',25],['lib/bennu','iCalendar_components.php',21],['lib/bennu','iCalendar_components.php',333],['lib/bennu','iCalendar_components.php',355],['lib/bennu','iCalendar_components.php',433],['lib/bennu','iCalendar_components.php',513],['lib/bennu','iCalendar_components.php',551],['lib/bennu','iCalendar_components.php',602],['lib/bennu','iCalendar_components.php',659],['lib/bennu','iCalendar_components.php',679],['lib/phpexcel/PHPExcel/Calculation','FormulaToken.php',102],['mod/feedback/item','feedback_item_class.php',28],['lib/adodb/drivers','adodb-mssql_n.inc.php',245],['lib','badgeslib.php',133],['lib/pear/HTML/QuickForm','text.php',38],['lib/simplepie/library/SimplePie','Enclosure.php',219],['calendar/classes','rrule_manager.php',182],['auth/webservice','auth.php',35],['lib','outputrequirementslib.php',171],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',44],['lib','questionlib.php',1261],['lib','questionlib.php',1505],['lib','uploadlib.php',40],['lib/spout/src/Spout/Writer/Common/Helper','ZipHelper.php',28],['lib/google/src/Google/Service','Cloudsearch.php',40],['backup/util/structure','backup_nested_element.class.php',44],['lib/spout/src/Spout/Writer/Common','Sheet.php',39],['question/behaviour','behaviourbase.php',50],['blocks/rss_client/classes/output','footer.php',47],['lib/dtl','file_xml_database_importer.php',34],['admin/roles/classes','capability_table_with_risks.php',45],['lib/adodb/drivers','adodb-mssql.inc.php',110],['lib/adodb/drivers','adodb-mssql.inc.php',870],['lib/adodb/drivers','adodb-mssql.inc.php',1077],['lib/google/src/Google/Service','Bigquery.php',62],['lib/google/src/Google/Service','ShoppingContent.php',50],['mod/lti','OAuth.php',73],['mod/lti','OAuth.php',89],['mod/lti','OAuth.php',244],['mod/lti','OAuth.php',499],['repository/equella','lib.php',42],['lib/phpexcel/PHPExcel/Worksheet','PageMargins.php',80],['backup/cc/cc_lib','cc_converter_quiz.php',33],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',60],['lib/phpexcel/PHPExcel/Shared/trend','polynomialBestFitClass.php',199],['backup/util/helper','restore_decode_processor.class.php',47],['backup/util/helper','restore_decode_processor.class.php',182],['cache/classes','helper.php',90],['lib/simplepie/library/SimplePie','Credit.php',81],['lib/classes','chart_series.php',62],['lib/classes/dml','recordset_walk.php',64],['lib/google/src/Google/Service','Webmasters.php',47],['lib/tcpdf/include/barcodes','qrcode.php',631],['backup/moodle2','backup_settingslib.php',42],['backup/moodle2','backup_settingslib.php',138],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',40],['course/tests/fixtures','course_capability_assignment.php',60],['mod/forum/classes','subscriber_selector_base.php',53],['lib','blocklib.php',54],['lib','blocklib.php',152],['report/loglive/classes','table_log.php',50],['lib','navigationlib.php',147],['lib','navigationlib.php',1015],['lib','navigationlib.php',2825],['lib','navigationlib.php',3086],['lib','navigationlib.php',3412],['lib','navigationlib.php',3459],['lib','navigationlib.php',4888],['lib','navigationlib.php',5070],['lib/phpexcel/PHPExcel/Shared/JAMA','CholeskyDecomposition.php',41],['grade/report/history/classes/output','user_button.php',40],['user/filters','courserole.php',34],['lib/phpexcel/PHPExcel','IOFactory.php',69],['lib/lessphp/Tree','Color.php',15],['lib/phpexcel/PHPExcel/Worksheet','MemoryDrawing.php',70],['lib/adodb/drivers','adodb-vfp.inc.php',72],['lib/horde/framework/Horde/Support','Backtrace.php',20],['lib/google/src/Google/Service','Clouddebugger.php',50],['lib/horde/framework/Horde/Exception','NotFound.php',15],['admin/tool/lp/classes/output','user_competency_course_navigation.php',55],['lib/lessphp/Tree','UnicodeDescriptor.php',14],['lib/phpexcel/PHPExcel/Worksheet','PageSetup.php',277],['grade/report/singleview/classes/local/ui','bulk_insert.php',40],['lib','mathslib.php',45],['lib/filestorage','tgz_extractor.php',119],['lib/horde/framework/Horde/Imap/Client/Interaction/Command','Continuation.php',42],['lib/horde/framework/Horde/Imap/Client','Exception.php',247],['filter/emoticon/tests','filter_test.php',68],['mnet/xmlrpc','xmlparser.php',15],['lib/spout/src/Spout/Reader/XLSX','Sheet.php',31],['admin/roles/classes','capability_table_base.php',51],['lib/simplepie/library/SimplePie','Item.php',82],['lib/form','selectgroups.php',57],['auth/shibboleth','auth.php',38],['admin/tool/langimport/classes','controller.php',48],['lib/form','warning.php',49],['lib/filestorage','stored_file.php',63],['grade/grading/form/guide','guideeditor.php',49],['lib/pear/HTML/QuickForm','group.php',80],['backup/moodle2','restore_subplugin.class.php',45],['grade/export','lib.php',60],['grade/export','lib.php',625],['lib/phpexcel/PHPExcel/Style','NumberFormat.php',98],['backup/moodle2','backup_section_task.class.php',40],['lib/htmlpurifier/HTMLPurifier','Config.php',100],['lib','flickrlib.php',53],['mod/assign/classes/output','grading_app.php',59],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',47],['user/profile/field/menu','field.class.php',39],['lib/spout/src/Spout/Writer/Common/Internal','AbstractWorkbook.php',30],['lib/portfolio','exporter.php',113],['lib','ddllib.php',80],['lib','ddllib.php',93],['lib','ddllib.php',107],['lib','ddllib.php',126],['lib','ddllib.php',140],['lib/horde/framework/Horde/Crypt','Blowfish.php',54],['lib/horde/framework/Horde','Secret.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef','Integer.php',36],['lib/classes/update','info.php',48],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','ValidatorAtom.php',31],['lib/lessphp/Tree','Anonymous.php',21],['admin/tool/lp/classes','course_competencies_form_element.php',43],['lib/lessphp/Tree','Comment.php',17],['auth/cas/CAS/CAS','OutOfSequenceBeforeAuthenticationCallException.php',47],['question/type/calculatedsimple','edit_calculatedsimple_form.php',72],['lib/adodb/drivers','adodb-mysql.inc.php',54],['lib/adodb/drivers','adodb-mysql.inc.php',717],['lib/adodb/drivers','adodb-mysql.inc.php',880],['enrol/ldap','lib.php',43],['mod/quiz/report/statistics','statistics_table.php',45],['lib/form','listing.php',68],['lib/google/src/Google/Service','Container.php',43],['mod/quiz','accessmanager.php',45],['lib/classes/message/inbound','processing_failed_exception.php',36],['blocks/online_users/classes','fetcher.php',45],['lib/pear/HTML/QuickForm','checkbox.php',48],['auth/cas/CAS/CAS','OutOfSequenceBeforeProxyException.php',48],['mod/lti/service/toolproxy/classes/local/service','toolproxy.php',41],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','URI.php',15],['lib/classes','chart_axis.php',65],['mod/glossary/classes','entry_query_builder.php',83],['mod/feedback/item/label','lib.php',26],['lib/adodb/drivers','adodb-mssqlnative.inc.php',131],['lib/adodb/drivers','adodb-mssqlnative.inc.php',847],['lib/adodb/drivers','adodb-mssqlnative.inc.php',1099],['lib/horde/framework/Horde/Imap/Client','Ids.php',78],['lib/form','editor.php',62],['lib','environmentlib.php',1258],['mod/workshop','fileinfolib.php',43],['mod/workshop','fileinfolib.php',198],['mod/feedback/classes','templates_table.php',39],['tag/classes','manage_table.php',44],['lib/adodb/drivers','adodb-odbc_db2.inc.php',115],['lib/adodb/drivers','adodb-odbc_db2.inc.php',309],['backup/cc/cc_lib/gral_lib','cssparser.php',21],['lib/horde/framework/Horde/Support','Array.php',21],['lib/google/src/Google/Service','GroupsMigration.php',40],['admin/tool/lp/classes/output','user_evidence_list_page.php',61],['lib/google/src/Google/Service','Audit.php',39],['lib/simplepie/library/SimplePie','File.php',68],['lib/horde/framework/Horde/Imap/Client','Mailbox.php',62],['enrol/lti/classes','manage_table.php',62],['lib/simplepie/library/SimplePie/Content/Type','Sniffer.php',69],['question/type','questionbase.php',124],['question/type','questionbase.php',438],['question/type','questionbase.php',531],['question/type','questionbase.php',750],['question/type','questionbase.php',835],['question/type','questionbase.php',868],['question/type','questionbase.php',914],['question/type','questionbase.php',1013],['question/type/ddimageortext','question.php',64],['question/type/ddimageortext','question.php',122],['lib','excellib.class.php',47],['lib','excellib.class.php',155],['lib','excellib.class.php',456],['lib/minify/lib','CSSmin.php',43],['lib/dml','moodle_temptables.php',51],['lib/minify/lib/Minify/Cache','ZendPlatform.php',23],['backup/util/xml/parser','progressive_parser.class.php',79],['backup/util/xml/parser','progressive_parser.class.php',305],['blocks/rss_client/classes/output','block.php',47],['question/type/ddmarker','question.php',417],['question/type/ddmarker','question.php',469],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Percentage.php',18],['admin/tool/lp/classes/output','user_competency_summary_in_course.php',51],['backup/util/helper','convert_helper.class.php',378],['lib/classes/update','validator.php',265],['lib/lessphp/Tree','Attribute.php',16],['admin/tool/generator/classes','backend.php',84],['backup/util/loggers','file_logger.class.php',35],['lib/adodb','adodb-exceptions.inc.php',30],['lib/google/src/Google','Client.php',70],['user/filters','profilefield.php',36],['backup/util/helper','restore_inforef_parser_processor.class.php',37],['cache/tests/fixtures','lib.php',326],['mod/lti/service/profile/classes/local/resource','profile.php',43],['competency/classes','invalid_persistent_exception.php',38],['backup/util/plan','backup_plan.class.php',36],['backup/util/plan','backup_plan.class.php',130],['lib/phpexcel/PHPExcel/Writer/Excel2007','WriterPart.php',63],['backup/util/settings','setting_dependency.class.php',68],['backup/util/settings','setting_dependency.class.php',175],['backup/util/settings','setting_dependency.class.php',328],['backup/util/settings','setting_dependency.class.php',439],['backup/util/settings','setting_dependency.class.php',465],['backup/util/settings','setting_dependency.class.php',491],['backup/util/settings','setting_dependency.class.php',556],['backup/util/xml','xml_writer.class.php',57],['backup/util/xml','xml_writer.class.php',284],['enrol/imsenterprise','locallib.php',38],['enrol/imsenterprise','locallib.php',115],['lib/dml','moodle_database.php',139],['search/classes','base.php',69],['admin/tool/lp/classes/output','competency_summary.php',54],['lib','upgradelib.php',45],['lib','upgradelib.php',61],['lib','upgradelib.php',76],['lib','upgradelib.php',94],['lib','upgradelib.php',111],['lib/htmlpurifier/HTMLPurifier/AttrTransform','NameSync.php',11],['mod/workshop/form/rubric','lib.php',105],['grade','lib.php',103],['grade','lib.php',927],['grade','lib.php',1089],['grade','lib.php',2053],['grade','lib.php',2213],['lib/horde/framework/Horde/Imap/Client/Data','Acl.php',32],['lib/phpexcel/PHPExcel/Reader/Excel5','RC4.php',35],['lib/google/src/Google/Service','Datastore.php',46],['admin/tool/lpmigrate/classes','framework_processor.php',98],['lib/dtl','database_importer.php',61],['lib/horde/framework/Horde/Imap/Client/Password','Xoauth2.php',44],['badges/lib','awardlib.php',55],['backup/util/helper','backup_array_iterator.class.php',39],['admin/tool/monitor/classes','subscription.php',43],['question/type/calculated','edit_calculated_form.php',51],['lib/spout/src/Spout/Reader/XLSX/Helper/SharedStringsCaching','FileBasedStrategy.php',57],['lib/form','datetimeselector.php',72],['lib/horde/framework/Horde/Imap/Client','Base.php',153],['lib/classes','collator.php',58],['admin/tool/lp/classes','course_competency_statistics.php',48],['lib/google/src/Google/Service','Storage.php',57],['lib/spout/src/Spout/Reader/CSV','SheetIterator.php',28],['lib/lessphp/Tree','Paren.php',14],['mod/lti/classes','service_exception_handler.php',63],['lib/tcpdf/include/barcodes','pdf417.php',523],['mod/assign/feedback/offline','importgradeslib.php',66],['lib/filestorage','file_exceptions.php',36],['lib/filestorage','file_exceptions.php',57],['lib/filestorage','file_exceptions.php',89],['lib/filestorage','file_exceptions.php',108],['lib/filestorage','file_exceptions.php',129],['lib/horde/framework/Horde/Mail/Transport','Smtp.php',100],['lib/htmlpurifier/HTMLPurifier/ConfigSchema/Interchange','Id.php',17],['question/engine/upgrade','upgradelib.php',283],['question/engine/upgrade','upgradelib.php',384],['question/type/numerical','question.php',323],['lib/pear/PEAR','Exception.php',107],['course/format','renderer.php',44],['lib/dml','oci_native_moodle_recordset.php',34],['question/behaviour','behaviourtypebase.php',133],['lib/pear/HTML','QuickForm.php',246],['lib/pear/HTML','QuickForm.php',1979],['backup/util/structure','base_atom.class.php',41],['backup/util/structure','base_atom.class.php',114],['backup/util/structure','base_atom.class.php',135],['backup/util/structure','base_atom.class.php',156],['lib/horde/framework/Horde/Imap/Client/Data','BaseSubject.php',39],['lib/google/src/Google/Auth','LoginTicket.php',37],['lib/adodb/drivers','adodb-csv.inc.php',41],['lib/adodb/drivers','adodb-csv.inc.php',196],['user/filters','yesno.php',33],['mod/wiki/parser','parser.php',98],['lib/htmlpurifier/HTMLPurifier/Token','Comment.php',19],['lib/phpexcel/PHPExcel/Calculation','FormulaParser.php',87],['backup/cc/cc_lib','cc_assesment_truefalse.php',27],['lib/htmlpurifier/HTMLPurifier','Encoder.php',10],['admin/tool/lpmigrate/classes/form','migrate_framework.php',45],['backup/util/xml/parser/tests','parser_test.php',797],['lib/htmlpurifier/HTMLPurifier/AttrTransform','EnumToCSS.php',34],['lib/tests','medialib_test.php',644],['lib/google/src/Google/Service','QPXExpress.php',39],['tag/classes/output','tagname.php',41],['lib/mustache/src/Mustache','Context.php',20],['lib/adodb/drivers','adodb-oracle.inc.php',32],['lib/adodb/drivers','adodb-oracle.inc.php',224],['backup/moodle2','restore_section_task.class.php',42],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Composite.php',25],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Nofollow.php',16],['mod/forum/classes/output','forum_post.php',110],['admin/tool/assignmentupgrade','locallib.php',50],['admin/tool/assignmentupgrade','locallib.php',93],['repository/googledocs','lib.php',65],['cache/stores/memcache','lib.php',120],['lib/filestorage','file_storage.php',78],['admin/tool/monitor/classes/output/managerules','renderable.php',56],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',45],['lib/form','duration.php',55],['lib','outputlib.php',480],['lib','outputlib.php',2038],['filter/tex','latex.php',13],['backup/moodle2','backup_course_task.class.php',39],['lib/adodb','adodb.inc.php',310],['lib/adodb','adodb.inc.php',3035],['lib/adodb','adodb.inc.php',3160],['lib/adodb','adodb.inc.php',3242],['lib/adodb','adodb.inc.php',4353],['lib/horde/framework/Horde/Support','Randomid.php',26],['lib/google/src/Google/Logger','File.php',51],['admin/roles/classes','allow_role_page.php',37],['mod/quiz/report/overview','overview_table.php',41],['lib/lessphp/Tree','Keyword.php',17],['lib/htmlpurifier/HTMLPurifier/Node','Comment.php',19],['question/type/ddmarker','questiontype.php',48],['mod/folder','renderer.php',159],['lib','portfoliolib.php',101],['tag/classes/output','tagcollsearchable.php',40],['webservice/soap/classes','wsdl.php',88],['lib/lessphp/Exception','Parser.php',30],['badges','renderer.php',973],['badges','renderer.php',1014],['badges','renderer.php',1078],['badges','renderer.php',1111],['badges','renderer.php',1137],['competency/classes/external','exporter.php',56],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',47],['lib/google/src/Google/Service','Genomics.php',63],['lib/phpexcel/PHPExcel/Writer','PDF.php',38],['lib/phpexcel/PHPExcel/Shared/trend','exponentialBestFitClass.php',125],['lib/google/src/Google/Service','Games.php',60],['backup/converter/moodle1','lib.php',725],['backup/converter/moodle1','lib.php',865],['backup/converter/moodle1','lib.php',1145],['backup/converter/moodle1','lib.php',1190],['backup/converter/moodle1','lib.php',1480],['backup/util/helper','restore_logs_processor.class.php',45],['backup/util/helper','restore_logs_processor.class.php',141],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Input.php',14],['lib/google/src/Google/Service','Licensing.php',40],['mod/workshop/form/comments','lib.php',99],['backup/util/settings/section','section_backup_setting.class.php',25],['lib/htmlpurifier/HTMLPurifier','Doctype.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Font.php',22],['lib/google/src/Google/Service','Fitness.php',58],['blocks/private_files','renderer.php',83],['lib/phpexcel/PHPExcel/Worksheet','ColumnCellIterator.php',51],['enrol/flatfile','adminlib.php',35],['lib/xmldb','xmldb_object.php',55],['lib/google/src/Google/Service','Reports.php',47],['question/classes/statistics/responses','analysis_for_actual_response.php',70],['auth/pam','auth.php',53],['lib/horde/framework/Horde','Stream.php',50],['comment','lib.php',100],['lib/htmlpurifier/HTMLPurifier','URIParser.php',10],['lib/htmlpurifier/HTMLPurifier/Node','Text.php',35],['lib/phpexcel/PHPExcel/Worksheet','RowDimension.php',53],['lib/google/src/Google/Service','Gmail.php',64],['lib/google/src/Google/Service','Taskqueue.php',44],['lib/minify/lib/Minify','ImportProcessor.php',48],['lib/horde/framework/Horde/Mime','Related.php',32],['blocks','moodleblock.class.php',111],['lib/tcpdf','tcpdf_parser.php',92],['backup/util/plan','restore_structure_step.class.php',46],['blocks/rss_client/classes/output','channel_image.php',61],['lib/pear/HTML/QuickForm','hierselect.php',105],['question/type/numerical/tests','form_test.php',40],['badges/lib','backpacklib.php',40],['mod/workshop/allocation/manual','lib.php',51],['mod/quiz/report/responses','last_responses_table.php',39],['lib/simplepie','autoloader.php',62],['lib/spout/src/Spout/Common/Helper','StringHelper.php',21],['lib/phpexcel/PHPExcel/Worksheet','BaseDrawing.php',121],['lib/pear/Crypt','CHAP.php',82],['lib/pear/Crypt','CHAP.php',170],['lib/pear/Crypt','CHAP.php',424],['lib/spout/src/Spout/Writer/Common/Helper','AbstractStyleHelper.php',22],['backup/util/xml/parser/processors','progressive_parser_processor.class.php',57],['mod/quiz/classes/question','qubaids_for_users_attempts.php',37],['lib/spout/src/Spout/Reader/XLSX','RowIterator.php',63],['lib/phpexcel/PHPExcel/Reader/Excel5','Escher.php',77],['lib/simplepie/library/SimplePie','gzdecode.php',186],['mod/wiki','renderer.php',540],['lib/adodb','adodb-active-recordx.inc.php',138],['availability/classes','result.php',46],['lib','accesslib.php',5352],['lib','accesslib.php',5897],['lib','accesslib.php',6167],['lib','accesslib.php',6408],['lib','accesslib.php',6595],['lib','accesslib.php',6827],['lib','accesslib.php',7049],['lib','accesslib.php',7291],['lib/phpexcel/PHPExcel/Shared/OLE','PPS.php',110],['grade/grading/form','lib.php',82],['grade/grading/form','lib.php',766],['question/engine','questionusage.php',78],['question/engine','questionusage.php',973],['auth/manual','auth.php',46],['question/engine/upgrade','behaviourconverters.php',78],['mod/wiki/diff','diff_nwiki.php',35],['mod/wiki/diff','diff_nwiki.php',50],['mod/wiki/diff','diff_nwiki.php',63],['mod/wiki/diff','diff_nwiki.php',76],['mod/wiki/diff','diff_nwiki.php',495],['mod/wiki/diff','diff_nwiki.php',640],['mod/wiki/diff','diff_nwiki.php',850],['mod/wiki/diff','diff_nwiki.php',901],['mod/wiki/diff','diff_nwiki.php',953],['lib/adodb/drivers','adodb-proxy.inc.php',28],['lib/classes/lock','file_lock_factory.php',57],['lib/google/src/Google/Auth','OAuth2.php',55],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Pixels.php',17],['lib/filebrowser','file_info_context_module.php',47],['auth/none','auth.php',34],['lib/simplepie/library/SimplePie/Cache','Base.php',70],['lib/htmlpurifier/HTMLPurifier','Queue.php',24],['lib/horde/framework/Horde/Text','Flowed.php',75],['admin/tool/log/store/legacy/classes/log','store.php',33],['lib/mustache/src/Mustache','HelperCollection.php',19],['backup/util/structure','backup_structure_processor.class.php',45],['backup/util/structure','backup_structure_processor.class.php',133],['admin/tool/lp/classes/output','related_competencies.php',47],['mod/quiz/classes/question/bank','custom_view.php',44],['files','renderer.php',1083],['lib/form','text.php',47],['lib/phpexcel/PHPExcel/Shared/trend','bestFitClass.php',398],['backup/cc','cc112moodle.php',59],['admin/tool/cohortroles/classes/output','cohort_role_assignments_table.php',45],['lib/horde/framework/Horde/Imap/Client/Data','Envelope.php',46],['lib/google/src/Google/Service','Logging.php',39],['lib/lessphp/Tree','Expression.php',16],['mod/lti/classes/local/ltiservice','service_base.php',63],['lib/phpexcel/PHPExcel/Reader','HTML.php',118],['search/engine/solr/classes','schema.php',60],['backup/util/xml/parser/processors','simplified_parser_processor.class.php',46],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',50],['lib/adodb/drivers','adodb-ado5.inc.php',42],['lib/adodb/drivers','adodb-ado5.inc.php',380],['mod/assign/feedback/editpdf/classes','comment.php',58],['cache/classes','interfaces.php',473],['lib/phpexcel/PHPExcel/Worksheet','Protection.php',157],['repository/merlot','lib.php',37],['lib/adodb/drivers','adodb-firebird.inc.php',69],['backup/util/settings','backup_setting.class.php',43],['lib/adodb/drivers','adodb-fbsql.inc.php',28],['lib/adodb/drivers','adodb-fbsql.inc.php',167],['mnet/xmlrpc','serverlib.php',674],['webservice/soap','lib.php',45],['admin/tool/log/store/database/classes/log','store.php',47],['lib/google/src/Google/Service','Doubleclicksearch.php',43],['lib/form','passwordunmask.php',46],['lib/lessphp/Tree','Variable.php',20],['report/log/classes','renderable.php',96],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',43],['question/classes/bank','view.php',70],['grade/report/singleview/classes/local/ui','range.php',38],['lib/simplepie/library/SimplePie/Cache','MySQL.php',80],['admin/roles/classes','define_role_table_basic.php',31],['backup/cc/cc_lib','cc_converter_resource.php',28],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Mongo.php',78],['blocks/rss_client','editfeed.php',36],['admin/tool/lpmigrate/classes/output','migrate_framework_results.php',55],['blocks/lp/classes/output','competencies_to_review_page.php',49],['lib/horde/framework/Horde/Crypt/Blowfish/Php','Base.php',318],['backup/util/loggers','base_logger.class.php',42],['backup/util/loggers','base_logger.class.php',187],['mod/assign/feedback/file','renderable.php',44],['backup/cc/cc_lib','cc_utils.php',313],['backup/cc/cc_lib','cc_utils.php',381],['backup/cc/cc_lib','cc_utils.php',437],['lib/adodb/drivers','adodb-db2.inc.php',66],['lib/adodb/drivers','adodb-db2.inc.php',731],['lib/adodb','adodb-xmlschema03.inc.php',136],['lib/adodb','adodb-xmlschema03.inc.php',270],['lib/adodb','adodb-xmlschema03.inc.php',678],['lib/adodb','adodb-xmlschema03.inc.php',823],['lib/adodb','adodb-xmlschema03.inc.php',1081],['lib/adodb','adodb-xmlschema03.inc.php',1399],['repository/youtube','lib.php',58],['lib/phpexcel/PHPExcel/Writer/PDF','mPDF.php',38],['auth/cas/CAS/CAS','GracefullTerminationException.php',48],['lib/adodb/drivers','adodb-sybase_ase.inc.php',25],['lib/adodb/drivers','adodb-sybase_ase.inc.php',115],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Background.php',20],['lib/adodb','adodb-memcache.lib.inc.php',53],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','FrameTarget.php',19],['lib/phpexcel/PHPExcel/Writer','Excel2007.php',118],['lib/minify/lib/MrClay/Cli','Arg.php',82],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter','Column.php',117],['lib/simplepie','moodle_simplepie.php',50],['lib/simplepie','moodle_simplepie.php',121],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','FontFamily.php',11],['lib/simplepie/library/SimplePie/Decode/HTML','Entities.php',80],['lib/spout/src/Spout/Common/Helper','FileSystemHelper.php',22],['lib/pear/HTML/QuickForm','button.php',37],['lib/google/src/Google/Service','Autoscaler.php',46],['lib/mustache/src/Mustache','Engine.php',63],['lib/google/src/Google/Http','MediaFileUpload.php',75],['lib/phpexcel/PHPExcel','Worksheet.php',327],['mod/assign','gradingtable.php',68],['lib/google/src/Google/Service','AdExchangeSeller.php',53],['question/engine/tests','helpers.php',582],['question/engine/tests','helpers.php',594],['question/engine/tests','helpers.php',608],['question/engine/tests','helpers.php',623],['question/engine/tests','helpers.php',637],['question/engine/tests','helpers.php',652],['question/engine/tests','helpers.php',665],['question/engine/tests','helpers.php',676],['question/engine/tests','helpers.php',1196],['repository/webdav','lib.php',38],['tag/classes/output','tagisstandard.php',39],['lib/google/src/Google/Service','Appsactivity.php',52],['badges/criteria','award_criteria_course.php',47],['lib','searchlib.php',53],['lib','searchlib.php',95],['lib/lessphp/Output','Mapped.php',39],['availability/classes','tree.php',118],['lib/lessphp/Tree','Javascript.php',20],['lib/horde/framework/Horde/Imap/Client','Cache.php',53],['lib/htmlpurifier/HTMLPurifier','AttrCollections.php',16],['lib/mustache/src/Mustache/Loader','InlineLoader.php',56],['repository/url','lib.php',46],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite3.php',293],['lib/lessphp/Tree','Ruleset.php',45],['tag/classes/output','tagindex.php',52],['backup/util/ui','backup_ui_stage.class.php',43],['backup/util/ui','backup_ui_stage.class.php',79],['backup/util/ui','backup_ui_stage.class.php',234],['backup/util/ui','backup_ui_stage.class.php',387],['backup/util/ui','backup_ui_stage.class.php',516],['backup/util/ui','backup_ui_stage.class.php',575],['grade/report/singleview/classes/local/screen','screen.php',67],['lib/tcpdf/include/barcodes','datamatrix.php',229],['lib/horde/framework/Horde/Imap/Client/Socket','Catenate.php',37],['lib/google/src/Google/Service','Prediction.php',51],['lib/classes/output','notification.php',101],['lib/lessphp/Tree','Unit.php',16],['backup/util/settings/course','course_backup_setting.class.php',25],['lib/spout/src/Spout/Writer','AbstractWriter.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','DenyElementDecorator.php',21],['lib','outputfactories.php',120],['lib','outputfactories.php',367],['lib','dtllib.php',66],['mod/assign','assignmentplugin.php',50],['mnet/service/enrol','locallib.php',48],['mnet/service/enrol','locallib.php',466],['mnet/service/enrol','locallib.php',537],['backup/cc/cc_lib','cc_version11.php',57],['availability/condition/completion/classes','condition.php',48],['admin/roles/classes','allow_override_page.php',31],['mod/workshop/allocation','lib.php',103],['lib/htmlpurifier/HTMLPurifier/AttrTransform','BoolToCSS.php',24],['lib/horde/framework/Horde/Imap/Client/Base','Mailbox.php',59],['lib/spout/src/Spout/Reader/Wrapper','SimpleXMLElement.php',23],['lib/google/src/Google/Service','SiteVerification.php',43],['lib/phpexcel/PHPExcel/Calculation','Function.php',64],['availability/classes','capability_checker.php',49],['lib/google/src/Google/Service','Drive.php',76],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',12],['lib/phpexcel/PHPExcel/Shared/JAMA','LUDecomposition.php',56],['lib','setuplib.php',67],['lib','setuplib.php',113],['lib','setuplib.php',165],['lib','setuplib.php',184],['lib','setuplib.php',199],['lib','setuplib.php',219],['lib','setuplib.php',249],['lib','setuplib.php',271],['lib','setuplib.php',287],['lib','setuplib.php',309],['lib','setuplib.php',328],['lib','setuplib.php',346],['lib/form','textarea.php',50],['webservice/soap','locallib.php',57],['availability/classes','info.php',55],['lib/tcpdf','tcpdf_barcodes_1d.php',58],['lib/spout/src/Spout/Reader/XLSX/Helper','SheetHelper.php',49],['filter/urltolink/tests','filter_test.php',209],['lib/simplepie/library/SimplePie','Category.php',81],['admin/tool/lp/classes/output','manage_competencies_page.php',65],['lib/markdown','Markdown.php',99],['mod/assign','locallib.php',160],['mod/assign','locallib.php',8131],['lib/adodb/drivers','adodb-ldap.inc.php',48],['lib/adodb/drivers','adodb-ldap.inc.php',297],['lib/editor/tinymce/plugins/spellchecker/classes/utils','JSON.php',32],['lib/editor/tinymce/plugins/spellchecker/classes/utils','JSON.php',373],['lib','odslib.class.php',42],['lib','odslib.class.php',124],['lib','odslib.class.php',422],['lib','odslib.class.php',827],['lib/horde/framework/Horde/Crypt/Blowfish','Base.php',56],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',36],['grade/report/singleview/classes/local/ui','checkbox_attribute.php',42],['lib/lessphp/Tree','Quoted.php',20],['mod/lesson','mod_form.php',36],['blocks/rss_client/classes/output','item.php',89],['lib/google/src/Google/Service','IdentityToolkit.php',38],['lib/horde/framework/Horde/Stream','Temp.php',25],['tag/classes/output','tagflag.php',39],['admin/tool/monitor/classes/output/managesubs','rules.php',56],['lib/htmlpurifier/HTMLPurifier/ChildDef','Table.php',57],['lib/behat/form_field','behat_form_field.php',59],['lib/phpexcel/PHPExcel/Worksheet/Drawing','Shadow.php',93],['lib/spout/src/Spout/Reader/ODS/Helper','CellValueFormatter.php',42],['tag/classes','collections_table.php',36],['lib/google/src/Google/Service','Spectrum.php',38],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Length.php',19],['admin/tool/lp/classes/output','user_competency_summary.php',49],['lib/phpexcel/PHPExcel','NamedRange.php',65],['lib/pear/HTML/QuickForm','image.php',36],['lib/htmlpurifier/HTMLPurifier/AttrDef/URI','Host.php',15],['lib/form','searchableselector.php',44],['lib/phpexcel/PHPExcel/Shared/JAMA','SingularValueDecomposition.php',52],['lib/adodb/drivers','adodb-oci805.inc.php',51],['lib/google/src/Google','Service.php',28],['lib/google/src/Google/IO','Abstract.php',50],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',46],['lib/form','header.php',45],['question/type/randomsamatch/tests','helper.php',121],['mod/workshop/form/accumulative','lib.php',99],['lib/phpexcel/PHPExcel/Shared/trend','linearBestFitClass.php',89],['lib/form','submit.php',41],['report/log/classes','table_log.php',45],['admin/roles/classes','admins_potential_selector.php',30],['question/classes/engine/variants','least_used_strategy.php',51],['question/engine/upgrade','logger.php',42],['question/engine/upgrade','logger.php',87],['mod/data','lib.php',68],['mod/data','lib.php',2278],['mod/data','lib.php',2552],['mod/data','lib.php',2573],['backup/util/xml/parser/processors','grouped_parser_processor.class.php',67],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportPop3.php',26],['mod/scorm','renderer.php',129],['lib/phpunit/classes','advanced_testcase.php',45],['lib/spout/src/Spout/Reader/ODS','SheetIterator.php',41],['backup/cc/cc_lib','cc_version1.php',57],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','LinkTypes.php',21],['tag/classes','areas_table.php',36],['lib/phpexcel/PHPExcel/Shared/trend','powerBestFitClass.php',125],['lib/portfolio/formats/leap2a','lib.php',62],['lib/portfolio/formats/leap2a','lib.php',258],['lib/portfolio/formats/leap2a','lib.php',503],['lib/google/src/Google/Service','Proximitybeacon.php',42],['lib/pear','PEAR.php',139],['lib/pear','PEAR.php',818],['competency/classes/external','persistent_exporter.php',42],['lib/google/src/Google/Service','Groupssettings.php',40],['lib/phpexcel/PHPExcel/Reader','CSV.php',87],['lib/horde/framework/Horde/Exception','LastError.php',16],['lib/google/src/Google/Service','Directory.php',134],['lib/google/src/Google/Service','Fusiontables.php',48],['question/type/missingtype','edit_missingtype_form.php',38],['lib/google/src/Google/Service','AdSenseHost.php',49],['lib/lessphp/Tree','Directive.php',20],['auth/ldap','auth.php',119],['auth/cas/CAS/CAS','CookieJar.php',46],['lib/phpexcel/PHPExcel/CachedObjectStorage','Wincache.php',245],['availability/condition/date/classes','condition.php',52],['lib/horde/framework/Horde/Mime','Mail.php',93],['lib','outputactions.php',60],['lib','outputactions.php',91],['lib','outputactions.php',148],['lib/horde/framework/Horde/Crypt/Blowfish','Mcrypt.php',47],['lib/classes','string_manager_standard.php',53],['repository/skydrive','microsoftliveapi.php',50],['user/filters','globalrole.php',35],['enrol/lti/ims-blti','OAuth.php',16],['enrol/lti/ims-blti','OAuth.php',32],['enrol/lti/ims-blti','OAuth.php',187],['enrol/lti/ims-blti','OAuth.php',451],['course/classes/output','course_module_name.php',46],['lib/google/src/Google/Service','Plus.php',52],['lib/horde/framework/Horde/Mime','Mdn.php',35],['lib/pear/HTML/QuickForm','html.php',36],['repository/s3','S3.php',193],['repository/s3','S3.php',2018],['repository/s3','S3.php',2374],['lib/spout/src/Spout/Reader/XLSX/Helper','SharedStringsHelper.php',39],['question/classes/bank/search','hidden_condition.php',42],['lib/htmlpurifier/HTMLPurifier/ChildDef','Empty.php',22],['lib/pear/HTML/QuickForm','element.php',73],['question/classes/statistics/responses','analysis_for_subpart.php',50],['admin/tool/log/classes','setting_managestores.php',30],['lib/google/src/Google/Service','Mirror.php',49],['lib/adodb/drivers','adodb-db2ora.inc.php',80],['lib/minify/lib/HTTP','Encoder.php',75],['mod/feedback/classes','completion.php',47],['admin/tool/uploadcourse/classes','processor.php',122],['lib/lessphp','Parser.php',78],['lib/adodb/drivers','adodb-sapdb.inc.php',36],['lib/adodb/drivers','adodb-sapdb.inc.php',179],['lib/ddl','sql_generator.php',175],['lib/google/src/Google/Service','AndroidEnterprise.php',51],['admin/tool/lp/classes/output','template_competencies_page.php',70],['lib/horde/framework/Horde/Support','ObjectStub.php',29],['mod/assignment/backup/moodle1','lib.php',223],['blocks','edit_form.php',47],['lib/simplepie/library/SimplePie/Cache','Memcache.php',81],['mod/quiz/report/statistics','statistics_question_table.php',49],['mod/workshop/form/numerrors','lib.php',102],['mod/quiz/classes','repaginate.php',49],['lib/classes/session','memcached.php',51],['lib/phpexcel/PHPExcel/Shared/OLE/PPS','Root.php',43],['lib/phpexcel/PHPExcel/Writer/PDF','Core.php',206],['mod/workshop','mod_form.php',43],['mod/assign/feedback/editpdf/fpdi','pdf_context.php',48],['availability/condition/profile/classes','condition.php',73],['lib/horde/framework/Horde/Imap/Client','DateTime.php',29],['auth/cas/CAS/CAS','Client.php',862],['lib/xhprof','xhprof_moodle.php',788],['lib/dtl','file_xml_database_exporter.php',36],['course','lib.php',3061],['lib/adodb/drivers','adodb-mssqlpo.inc.php',54],['lib/xmldb','xmldb_table.php',49],['lib/adodb/perf','perf-postgres.inc.php',92],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Filter.php',15],['question/type/ddmarker','shapes.php',40],['question/type/ddmarker','shapes.php',203],['question/type/ddmarker','shapes.php',267],['question/type/ddmarker','shapes.php',332],['question/type/ddmarker','shapes.php',470],['mod/lti/classes/local/ltiservice','response.php',58],['backup/util/helper','restore_users_parser_processor.class.php',43],['lib/pear/HTML','Common.php',79],['mod/glossary','locallib.php',481],['lib/adodb/perf','perf-mssqlnative.inc.php',70],['lib/adodb/perf','perf-mssql.inc.php',70],['backup/util/plan','base_plan.class.php',39],['backup/util/plan','base_plan.class.php',215],['backup/util/plan','restore_task.class.php',32],['backup/util/plan','restore_task.class.php',121],['lib/classes/event','base.php',124],['lib/form','checkbox.php',46],['admin/roles/classes','permissions_table.php',38],['lib/pear/HTML/QuickForm','submit.php',37],['auth/fc','auth.php',37],['enrol/ldap','settingslib.php',32],['enrol/ldap','settingslib.php',90],['enrol/ldap','settingslib.php',204],['lib/minify/lib/Minify/Cache','Memcache.php',22],['lib/lessphp/Tree','Condition.php',18],['admin/tool/lp/classes/output','plans_page.php',59],['lib/mustache/src/Mustache','Autoloader.php',19],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',52],['lib/phpexcel/PHPExcel','Comment.php',93],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','AlphaValue.php',6],['lib/lessphp/Tree','Url.php',17],['mod/lesson','override_form.php',58],['lib/form','button.php',45],['admin/tool/lp/classes/output','manage_templates_page.php',56],['lib/google/src/Google/Service','Playmoviespartner.php',44],['backup/util/ui','base_ui_stage.class.php',67],['backup/cc/cc_lib','cc_converters.php',75],['lib/dtl','database_mover.php',33],['enrol','locallib.php',125],['enrol','locallib.php',1256],['enrol','locallib.php',1379],['enrol','locallib.php',1430],['enrol','locallib.php',1463],['lib/htmlpurifier/HTMLPurifier','URI.php',58],['backup/moodle2','restore_course_task.class.php',41],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',40],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',221],['lib','xmlize.php',31],['lib','googleapi.php',52],['lib','googleapi.php',243],['grade/report/singleview/classes/local/ui','element.php',47],['lib/html2text','lib.php',43],['user/filters','lib.php',52],['user/filters','lib.php',272],['auth/cas/CAS/CAS/PGTStorage','Db.php',122],['lib/classes/lock','db_record_lock_factory.php',61],['lib/pear/HTML/QuickForm','link.php',47],['backup/cc/cc_lib','cc_asssesment.php',290],['backup/cc/cc_lib','cc_asssesment.php',345],['backup/cc/cc_lib','cc_asssesment.php',364],['backup/cc/cc_lib','cc_asssesment.php',415],['backup/cc/cc_lib','cc_asssesment.php',476],['backup/cc/cc_lib','cc_asssesment.php',486],['backup/cc/cc_lib','cc_asssesment.php',561],['backup/cc/cc_lib','cc_asssesment.php',585],['backup/cc/cc_lib','cc_asssesment.php',635],['backup/cc/cc_lib','cc_asssesment.php',668],['backup/cc/cc_lib','cc_asssesment.php',693],['backup/cc/cc_lib','cc_asssesment.php',788],['backup/cc/cc_lib','cc_asssesment.php',814],['backup/cc/cc_lib','cc_asssesment.php',838],['backup/cc/cc_lib','cc_asssesment.php',965],['backup/cc/cc_lib','cc_asssesment.php',971],['backup/cc/cc_lib','cc_asssesment.php',986],['backup/cc/cc_lib','cc_asssesment.php',1003],['backup/cc/cc_lib','cc_asssesment.php',1017],['backup/cc/cc_lib','cc_asssesment.php',1045],['backup/cc/cc_lib','cc_asssesment.php',1186],['backup/cc/cc_lib','cc_asssesment.php',1263],['backup/cc/cc_lib','cc_asssesment.php',1317],['backup/cc/cc_lib','cc_asssesment.php',1389],['backup/cc/cc_lib','cc_asssesment.php',1451],['backup/cc/cc_lib','cc_asssesment.php',1558],['backup/cc/cc_lib','cc_asssesment.php',1620],['backup/cc/cc_lib','cc_asssesment.php',1648],['backup/cc/cc_lib','cc_asssesment.php',1716],['backup/cc/cc_lib','cc_asssesment.php',2155],['backup/cc/cc_lib','cc_asssesment.php',2264],['backup/cc/cc_lib','cc_asssesment.php',2469],['lib/phpunit/classes','hint_resultprinter.php',37],['lib/horde/framework/Horde/Mail/Transport','Mail.php',53],['auth/pop3','auth.php',35],['lib/adodb/drivers','adodb-oci8.inc.php',106],['lib/adodb/drivers','adodb-oci8.inc.php',1539],['lib/adodb/drivers','adodb-oci8.inc.php',1805],['lib/classes/session','database.php',52],['backup/util/ui','restore_ui_components.php',81],['backup/util/ui','restore_ui_components.php',287],['backup/util/ui','restore_ui_components.php',382],['question/classes/bank/search','category_condition.php',60],['lib/google/src/Google/Auth','AssertionCredentials.php',53],['backup/util/plan','restore_plan.class.php',43],['backup/util/plan','restore_plan.class.php',203],['backup/util/xml/parser/processors','findpaths_parser_processor.class.php',35],['lib/phpexcel/PHPExcel/CalcEngine','Logger.php',63],['lib/jabber/XMPP','Log.php',67],['lib/horde/framework/Horde/Imap/Client/Exception','ServerResponse.php',44],['lib/lessphp/Tree','Assignment.php',15],['lib/dtl','string_xml_database_importer.php',34],['admin/tool/lp/classes/output','manage_competency_frameworks_page.php',62],['question/type/calculated','question.php',188],['question/type/calculated','question.php',303],['repository/recent','lib.php',39],['grade/report/singleview/classes/local/ui','text_attribute.php',42],['admin/webservice','lib.php',38],['lib','coursecatlib.php',194],['lib','coursecatlib.php',2782],['lib/google/src/Google/Service','Cloudtrace.php',43],['lib','filterlib.php',73],['lib','filterlib.php',377],['lib','filterlib.php',456],['lib/classes/lock','lock_factory.php',39],['lib/filebrowser','file_info_context_course.php',39],['lib/filebrowser','file_info_context_course.php',492],['lib/filebrowser','file_info_context_course.php',596],['lib/filebrowser','file_info_context_course.php',745],['enrol','renderer.php',426],['enrol','renderer.php',723],['question/classes/statistics/questions','calculated_for_subquestion.php',57],['backup/moodle2','backup_format_plugin.class.php',40],['admin/tool/lp/classes','course_competency_rule_form_element.php',45],['auth/cas/CAS/CAS','ProxyTicketException.php',46],['lib/phpunit/classes','basic_testcase.php',39],['lib/spout/src/Spout/Reader/ODS','RowIterator.php',49],['backup/util/dbops','backup_dbops.class.php',37],['admin/tool/customlang','locallib.php',44],['admin/tool/customlang','locallib.php',405],['admin/tool/customlang','locallib.php',471],['backup/util/structure','backup_optigroup_element.class.php',51],['mod/quiz/report/grading','gradingsettings_form.php',44],['backup/util/plan','restore_step.class.php',32],['backup/util/plan','restore_step.class.php',104],['lib/form','hidden.php',44],['repository/filesystem','lib.php',48],['backup/controller','backup_controller.class.php',68],['backup/controller','backup_controller.class.php',409],['backup/util/helper','restore_log_rule.class.php',62],['tag/classes','tag.php',77],['lib/htmlpurifier/HTMLPurifier/AttrTransform','SafeParam.php',27],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Db.php',38],['lib/spout/src/Spout/Writer/Style','StyleBuilder.php',19],['lib/dml','sqlsrv_native_moodle_database.php',53],['user/filters','date.php',40],['auth/nologin','auth.php',35],['lib/google/src/Google','Model.php',35],['lib/horde/framework/Horde/Imap/Client/Socket','ClientSort.php',37],['lib/horde/framework/Horde/Imap/Client/Exception','SearchCharset.php',34],['lib/horde/framework/Horde/Support','StringStream.php',30],['lib/adodb/drivers','adodb-mysqli.inc.php',66],['lib/adodb/drivers','adodb-mysqli.inc.php',887],['lib/adodb/drivers','adodb-mysqli.inc.php',1193],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ImportantDecorator.php',21],['lib/form','questioncategory.php',46],['lib/mustache/src/Mustache','Template.php',29],['backup/util/structure','base_nested_element.class.php',44],['backup/util/structure','base_nested_element.class.php',258],['lib/google/src/Google/Logger','Abstract.php',123],['backup/cc/cc_lib','cc_general.php',38],['lib/phpexcel/PHPExcel','ReferenceHelper.php',58],['lib/pear/HTML/QuickForm','password.php',37],['lib/dml','moodle_transaction.php',40],['lib/phpexcel/PHPExcel/Reader','Excel2003XML.php',53],['lib/htmlpurifier/HTMLPurifier/AttrDef','Switch.php',29],['repository/flickr','lib.php',51],['lib/form','grading.php',57],['lib/classes/update','api.php',71],['backup/cc/cc_lib','cc_converter_lti.php',29],['backup/moodle2','backup_subplugin.class.php',44],['lib/portfolio','caller.php',67],['lib/classes/progress','display_if_slow.php',60],['lib/adodb/perf','perf-informix.inc.php',66],['lib/classes','chart_base.php',52],['lib/lessphp/Tree','Media.php',18],['lib/spout/src/Spout/Common/Escaper','XLSX.php',19],['grade/export/ods','grade_export_ods.php',24],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Length.php',23],['lib/google/src/Google/Service','Calendar.php',50],['lib/form','group.php',44],['lib/phpexcel/PHPExcel/Writer','OpenDocument.php',44],['lib/pear/HTML/QuickForm/Renderer','Object.php',75],['admin/tool/lp/classes/output','user_evidence_page.php',48],['lib/horde/framework/Horde/Imap/Client/Fetch','Results.php',54],['grade/export/xls','grade_export_xls.php',24],['lib/classes/output','mustache_pix_helper.php',43],['lib/horde/framework/Horde/Imap/Client/Mailbox','List.php',46],['lib/google/src/Google/Auth','ComputeEngine.php',35],['cache/stores/session','lib.php',131],['lib/mustache/src/Mustache/Logger','StreamLogger.php',44],['admin/tool/log/store/database/backup/moodle2','backup_logstore_database_nested_element.php',43],['user','renderer.php',220],['lib/htmlpurifier/HTMLPurifier/ChildDef','Required.php',23],['availability/condition/grade/classes','condition.php',46],['lib/lessphp/Tree','RulesetCall.php',14],['blocks/rss_client/classes/output','feed.php',75],['lib/form','select.php',47],['lib/htmlpurifier/HTMLPurifier','ContentSets.php',33],['lib/lessphp/Visitor','toCSS.php',13],['lib','outputfragmentrequirementslib.php',40],['backup/util/ui','restore_moodleform.class.php',34],['lib/google/src/Google/Service','Cloudbilling.php',43],['lib/google/src/Google/Service','PlusDomains.php',72],['lib','externallib.php',37],['lib','externallib.php',531],['lib','externallib.php',562],['lib','externallib.php',593],['lib','externallib.php',622],['lib','externallib.php',648],['lib','externallib.php',778],['lib','externallib.php',813],['lib','externallib.php',984],['lib','externallib.php',1177],['blog','locallib.php',71],['blog','locallib.php',564],['blog','locallib.php',847],['blog','locallib.php',892],['blog','locallib.php',965],['blog','locallib.php',1016],['blog','locallib.php',1041],['blog','locallib.php',1051],['blog','locallib.php',1063],['blog','locallib.php',1084],['lib/phpexcel/PHPExcel/Worksheet','ColumnDimension.php',53],['auth/cas','auth.php',39],['lib','lexer.php',41],['lib','lexer.php',145],['lib','lexer.php',217],['lib/phpexcel/PHPExcel/Shared/JAMA','QRDecomposition.php',48],['lib/google/src/Google/Service','Exception.php',34],['lib/htmlpurifier/HTMLPurifier','Printer.php',21],['tag/classes/output','tagcloud.php',49],['lib/google/src/Google/Service','Storagetransfer.php',44],['user/filters','select.php',46],['cache/stores/mongodb','lib.php',116],['admin/tool/lp/classes/output','course_competencies_page.php',73],['lib/google/src/Google/Cache','Null.php',28],['lib','graphlib.php',1176],['lib/phpexcel/PHPExcel/Style','Protection.php',49],['lib/google/src/Google/Service','GamesConfiguration.php',42],['repository/dropbox','locallib.php',46],['lib/phpexcel/PHPExcel/Style','Alignment.php',100],['lib/htmlpurifier/HTMLPurifier','Language.php',63],['cache/stores/file','lib.php',117],['tag/classes/output','tagareashowstandard.php',41],['question/type/multianswer','edit_multianswer_form.php',63],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Bool.php',22],['mod/assign','renderable.php',41],['mod/assign','renderable.php',71],['mod/assign','renderable.php',103],['mod/assign','renderable.php',139],['mod/assign','renderable.php',191],['mod/assign','renderable.php',242],['mod/assign','renderable.php',291],['mod/assign','renderable.php',395],['mod/assign','renderable.php',531],['mod/assign','renderable.php',586],['mod/assign','renderable.php',670],['mod/assign','renderable.php',707],['mod/assign','renderable.php',747],['mod/assign','renderable.php',800],['mod/assign','renderable.php',854],['lib/form','selectwithlink.php',56],['backup/moodle2','backup_activity_task.class.php',45],['lib/phpmailer','class.phpmailer.php',633],['lib/horde/framework/Horde/Imap/Client/Data','AclRights.php',39],['auth/db','auth.php',36],['lib/lessphp/Tree','Value.php',14],['lib/form','course.php',62],['question/engine','questionattemptstep.php',97],['question/engine','questionattemptstep.php',608],['cohort','locallib.php',37],['cohort','locallib.php',101],['badges/criteria','award_criteria.php',127],['lib/adodb/perf','perf-mysql.inc.php',86],['cache/stores/memcached','lib.php',133],['grade/report/singleview/classes/local/ui','empty_element.php',38],['lib/google/src/Google/Service','AppState.php',40],['lib/adodb/drivers','adodb-odbc_oracle.inc.php',107],['lib/pear/HTML/QuickForm/Renderer','Default.php',139],['tag/classes/output','tag.php',46],['question','previewlib.php',122],['backup/util/loggers','database_logger.class.php',40],['mod/forum/classes','potential_subscriber_selector.php',47],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','InterchangeBuilder.php',15],['lib/phpexcel/PHPExcel/Reader','SYLK.php',67],['lib/form','submitlink.php',47],['backup/util/dbops','restore_dbops.class.php',1788],['lib/xmldb','xmldb_index.php',56],['question','category_class.php',58],['question','category_class.php',160],['lib/google/src/Google/Service','Webfonts.php',38],['webservice/xmlrpc','locallib.php',41],['admin/roles/classes','check_users_selector.php',38],['lib/htmlpurifier/HTMLPurifier/AttrTransform','ImgSpace.php',24],['user/profile/field/checkbox','field.class.php',33],['lib/form','cancel.php',47],['lib/google/src/Google/Service','Resourceviews.php',57],['lib/phpexcel/PHPExcel/Style','Font.php',100],['lib/portfolio','plugin.php',445],['calendar','lib.php',2003],['calendar','lib.php',2774],['mod/wiki','pagelib.php',93],['mod/wiki','pagelib.php',380],['mod/wiki','pagelib.php',981],['mod/wiki','pagelib.php',1190],['mod/wiki','pagelib.php',2194],['mod/wiki','pagelib.php',2422],['tag/classes/output','tagfeed.php',43],['tag/classes/output','tagareaenabled.php',38],['backup/util/xml/parser/processors','selective_like_parser_processor.class.php',35],['mod/workshop','locallib.php',183],['mod/workshop','locallib.php',2976],['mod/workshop','locallib.php',3411],['mod/workshop','locallib.php',3647],['mod/workshop','locallib.php',3889],['mod/workshop','locallib.php',3975],['mod/workshop','locallib.php',4060],['mod/workshop','locallib.php',4079],['lib/form','advcheckbox.php',48],['backup/cc/cc_lib','cc_assesment_sfib.php',27],['cohort/classes/output','cohortidnumber.php',37],['lib/adodb/drivers','adodb-ado.inc.php',42],['lib/adodb/drivers','adodb-ado.inc.php',346],['lib/form','filepicker.php',53],['mod/assign','adminlib.php',41],['mod/assign','adminlib.php',102],['lib/tests/fixtures','test_renderer_factory.php',41],['backup/cc/cc_lib','cc_converter_label.php',28],['lib/htmlpurifier/HTMLPurifier','Lexer.php',152],['grade/report/singleview','lib.php',69],['backup/cc/cc_lib','cc_converter_page.php',28],['lib/google/src/Google/Logger','Psr.php',39],['lib/simplepie/library/SimplePie/HTTP','Parser.php',131],['backup/util/plan','backup_step.class.php',32],['backup/util/plan','backup_step.class.php',55],['lib/lessphp/Tree','Import.php',30],['lib/jabber/XMPP','XMPP_Old.php',45],['lib/phpexcel/PHPExcel/Worksheet','Drawing.php',37],['lib/google/src/Google/Service','Classroom.php',60],['lib/phpexcel/PHPExcel/Chart/Renderer','jpgraph.php',875],['admin/tool/lp/classes/external','competency_path_exporter.php',38],['cohort/classes/output','cohortname.php',37],['grade/report/overview','lib.php',76],['lib/horde/framework/Horde/Mail/Rfc822','Address.php',66],['admin/roles/classes','admins_existing_selector.php',30],['lib/phpunit/classes','arraydataset.php',45],['question/engine','questionattempt.php',166],['question/engine','questionattempt.php',1532],['question/engine','questionattempt.php',1618],['question/engine','questionattempt.php',1703],['lib/horde/framework/Horde/Support','Uuid.php',23],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nil.php',27],['webservice/rest','lib.php',47],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooterDrawing.php',79],['backup/util/xml/output','memory_xml_output.class.php',37],['repository/flickr_public','image.php',34],['mod/lti/classes/local/ltiservice','resource_base.php',62],['admin/tool/lp/classes/output','template_plans_table.php',53],['mod/quiz','mod_form.php',48],['lib/simplepie/library/SimplePie','Caption.php',98],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Multiple.php',33],['lib/htmlpurifier/HTMLPurifier','PercentEncoder.php',20],['lib/phpexcel/PHPExcel/Calculation','ExceptionHandler.php',30],['lib/htmlpurifier/HTMLPurifier/Token','Tag.php',33],['backup/moodle2','backup_theme_plugin.class.php',61],['mod/chat','chatd.php',78],['mod/chat','chatd.php',103],['lib/phpexcel/PHPExcel','DocumentSecurity.php',65],['lib/htmlpurifier/HTMLPurifier','URIDefinition.php',21],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',45],['lib/phpexcel/PHPExcel/Shared','XMLWriter.php',49],['lib/lessphp/Tree','Operation.php',19],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',461],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',1699],['backup/cc/cc_lib','cc_converter_folder.php',28],['backup/util/helper','restore_roles_parser_processor.class.php',39],['lib/simplepie/library/SimplePie','Locator.php',68],['lib/google/src/Google/Service','SQLAdmin.php',50],['lib/lessphp/Tree','DetachedRuleset.php',15],['admin/tool/assignmentupgrade','upgradableassignmentstable.php',49],['backup/cc','validator.php',30],['backup/cc','validator.php',116],['backup/cc','validator.php',202],['backup/cc','validator.php',230],['backup/cc','validator.php',236],['backup/cc','validator.php',242],['backup/cc','validator.php',248],['backup/cc','validator.php',254],['backup/cc','validator.php',260],['lib/horde/framework/Horde/Imap/Client/Interaction','Client.php',34],['mod/quiz','override_form.php',58],['auth/cas/CAS/CAS/PGTStorage','AbstractStorage.php',57],['lib/htmlpurifier/HTMLPurifier','Length.php',41],['backup/util/helper','restore_decode_rule.class.php',47],['backup/util/helper','restore_decode_rule.class.php',192],['lib/horde/framework/Horde/Imap/Client/Data','Sync.php',133],['lib/phpexcel/PHPExcel/Shared/trend','logarithmicBestFitClass.php',97],['lib/adodb/perf','perf-db2.inc.php',61],['lib/phpexcel/PHPExcel/Style','Supervisor.php',44],['lib/htmlpurifier/HTMLPurifier/AttrTransform','TargetBlank.php',17],['lib/ddl','database_manager.php',48],['lib/mustache/src/Mustache/Exception','UnknownFilterException.php',22],['admin/roles/classes','define_role_table_advanced.php',46],['lib/dml','oci_native_moodle_temptables.php',40],['lib/horde/framework/Horde/Stream','Existing.php',28],['enrol/manual','locallib.php',37],['enrol/manual','locallib.php',102],['availability/classes','multiple_messages.php',56],['lib/phpexcel/PHPExcel/Reader','Gnumeric.php',55],['admin/roles/classes','override_permissions_table_advanced.php',31],['lib/pear/Net','GeoIP.php',323],['lib/mustache/src/Mustache/Loader','ArrayLoader.php',31],['lib/form','modgrade.php',78],['admin/tool/log/store/database/backup/moodle2','restore_logstore_database_subplugin.class.php',40],['cache/classes','config.php',80],['lib/pear/HTML/QuickForm','hidden.php',37],['question/type/calculated','datasetitems_form.php',72],['lib/tests','navigationlib_test.php',554],['lib/tests','navigationlib_test.php',612],['lib/tests','navigationlib_test.php',639],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Number.php',18],['lib/tests','completionlib_test.php',882],['admin/tool/generator/classes','site_backend.php',58],['lib/jabber/XMPP','XMLStream.php',171],['lib/simplepie/library/SimplePie','Sanitize.php',75],['cache/classes','factory.php',149],['lib/minify/lib/Minify/Cache','WinCache.php',20],['user/classes/output/myprofile','node.php',82],['lib/horde/framework/Horde/Stream','TempString.php',40],['lib/adodb/drivers','adodb-borland_ibase.inc.php',83],['mod/forum','locallib.php',55],['mod/forum','locallib.php',419],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',44],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter/Column','Rule.php',262],['lib/classes/update','code_manager.php',57],['search/engine/solr/classes','engine.php',103],['lib/horde/framework/Horde/Imap/Client/Interaction/Server','Tagged.php',36],['lib/google/src/Google/Service','Compute.php',89],['lib/phpexcel/PHPExcel/Style','Borders.php',113],['lib','completionlib.php',243],['lib/google/src/Google/Service','Pubsub.php',44],['lib/adodb/drivers','adodb-ads.inc.php',69],['lib/adodb/drivers','adodb-ads.inc.php',657],['lib/markdown','MarkdownExtra.php',56],['lib/minify/lib/Minify/Cache','XCache.php',22],['lib/google/src/Google/Service','YouTube.php',75],['lib/lessphp','Functions.php',15],['auth/cas/CAS/CAS','AuthenticationException.php',53],['mod/quiz','locallib.php',1923],['competency/classes/external','stored_file_exporter.php',45],['user/filters','checkbox.php',51],['backup/moodle2','restore_settingslib.php',86],['backup/moodle2','restore_settingslib.php',149],['lib/htmlpurifier/HTMLPurifier/Node','Element.php',39],['lib/pear/HTML/QuickForm','date.php',260],['lib/lessphp/SourceMap','Generator.php',82],['backup/util/plan','base_step.class.php',35],['backup/util/plan','base_step.class.php',127],['mod/lti/service/memberships/classes/local/service','memberships.php',50],['lib/google/src/Google/Cache','Apc.php',37],['backup/util/ui','restore_ui_stage.class.php',42],['backup/util/ui','restore_ui_stage.class.php',265],['backup/util/ui','restore_ui_stage.class.php',452],['backup/util/ui','restore_ui_stage.class.php',592],['backup/util/ui','restore_ui_stage.class.php',704],['backup/util/ui','restore_ui_stage.class.php',852],['backup/util/ui','restore_ui_stage.class.php',959],['backup/util/ui','restore_ui_stage.class.php',1100],['lib/pear/Auth','RADIUS.php',120],['lib/pear/Auth','RADIUS.php',579],['lib/pear/Auth','RADIUS.php',672],['lib/pear/Auth','RADIUS.php',879],['lib/adodb/drivers','adodb-ado_access.inc.php',46],['admin/tool/xmldb/actions','XMLDBAction.class.php',56],['backup/converter/moodle1','handlerlib.php',120],['backup/converter/moodle1','handlerlib.php',1710],['backup/converter/moodle1','handlerlib.php',1902],['backup/converter/moodle1','handlerlib.php',2155],['backup/controller','restore_controller.class.php',63],['backup/controller','restore_controller.class.php',519],['lib/google/src/Google/Http','Request.php',58],['lib/google/src/Google/Service','Dfareporting.php',99],['lib/google/src/Google/Service','Manager.php',60],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Hashtable.php',73],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','Validator.php',30],['lib/google/src/Google/Service','CloudMonitoring.php',45],['lib/editor/tinymce/plugins/spellchecker/classes','SpellChecker.php',11],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',44],['lib/horde/framework/Horde/Mail/Transport','Sendmail.php',65],['lib','webdavlib.php',84],['lib/dml','pgsql_native_moodle_recordset.php',43],['lib/horde/framework/Horde/Support','Guid.php',24],['lib/mustache/src/Mustache','LambdaHelper.php',25],['question/engine/upgrade/tests','helper.php',45],['admin/tool/uploadcourse/classes','tracker.php',72],['grade/report/user','lib.php',188],['lib/adodb/drivers','adodb-sqlanywhere.inc.php',156],['auth/cas/CAS/CAS','OutOfSequenceBeforeClientException.php',47],['backup/util/plan','base_task.class.php',40],['backup/util/plan','base_task.class.php',277],['lib/adodb/drivers','adodb-db2oci.inc.php',220]], 1102],
'encode_backup_temp_info': ['encode_backup_temp_info', 'Encode the info field for backup_ids_temp or backup_files_temp. ', [['backup/util/dbops','backup_controller_dbops.class.php',183]], 4],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'set_item_tags': ['set_item_tags', 'Sets the list of tag instances for one item (table record). ', [['tag/classes','tag.php',666]], 57],
'get_plan': ['get_plan', '', [['backup/controller','backup_controller.class.php',302],['backup/controller','restore_controller.class.php',309]], 50],
'get_backup_content_file_location': ['get_backup_content_file_location', 'Given one file content hash, returns the path (relative to filedir) to the file. ', [['backup/util/helper','backup_file_manager.class.php',49]], 2],
'load_inforef_to_tempids': ['load_inforef_to_tempids', 'Load one inforef.xml file to backup_ids table for future reference ', [['backup/util/dbops','restore_dbops.class.php',112]], 2],
'create_new_course': ['create_new_course', 'Creates a skeleton record within the database using the passed parameters and returns the new course id. ', [['backup/util/dbops','restore_dbops.class.php',1740]], 7],
'get_backup_information': ['get_backup_information', 'Load and format all the needed information from moodle_backup.xml ', [['backup/util/helper','backup_general_helper.class.php',108]], 9],
'get_record_sql': ['get_record_sql', 'Get a single database record as an object using a SQL statement. ', [['lib/dml','oci_native_moodle_database.php',1076],['lib/dml','moodle_database.php',1506]], 157],
'get_list_of_themes': ['get_list_of_themes', 'Returns a list of valid and compatible themes ', [['lib','moodlelib.php',6929]], 7],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'prechek_precheck_qbanks_by_level': ['prechek_precheck_qbanks_by_level', 'This function will process all the question banks present in restore at some contextlevel (from CONTEXT_SYSTEM to CONTEXT_MODULE), finding the target contexts where each bank will be restored and returning warnings/errors as needed. ', [['backup/util/dbops','restore_dbops.class.php',535]], 4],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'process_included_users': ['process_included_users', 'Process the needed users in order to decide which action to perform with them (create/map) ', [['backup/util/dbops','restore_dbops.class.php',1599]], 1],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'delete_course_content': ['delete_course_content', 'Deletes all of the content associated with the given course (courseid) ', [['backup/util/dbops','restore_dbops.class.php',1772]], 3],
'get_taskbasepath': ['get_taskbasepath', 'Block tasks have their own directory to write files ', [['backup/moodle2','backup_block_task.class.php',104],['backup/moodle2','restore_activity_task.class.php',64],['backup/moodle2','restore_block_task.class.php',58],['backup/moodle2','backup_section_task.class.php',60],['backup/util/plan/tests/fixtures','plan_fixtures.php',76],['backup/moodle2','restore_section_task.class.php',51],['backup/moodle2','backup_course_task.class.php',54],['backup/moodle2','restore_course_task.class.php',49],['backup/moodle2','backup_activity_task.class.php',110],['backup/util/plan','base_task.class.php',117]], 20],
'end_progress': ['end_progress', 'Marks the end of an operation that will display progress. ', [['lib/classes/progress','base.php',129]], 73],
'set_file': ['set_file', 'Set an instance of {@see SimplePie_File} to use as a feed ', [['lib/simplepie/library','SimplePie.php',734],['backup/util/xml/parser','progressive_parser.class.php',101],['lib','externallib.php',1067]], 19],
'sql_concat': ['sql_concat', '', [['lib/dml','pdo_moodle_database.php',537],['lib/dml','oci_native_moodle_database.php',1602],['lib/dml','sqlite3_pdo_moodle_database.php',361],['lib/dml','pgsql_native_moodle_database.php',1225],['lib/dml','mssql_native_moodle_database.php',1258],['lib/dml','mysqli_native_moodle_database.php',1556],['lib/dml','sqlsrv_native_moodle_database.php',1324],['lib/dml/tests','dml_test.php',5554]], 74],
'get_list_of_translations': ['get_list_of_translations', 'Returns localised list of installed translations ', [['lib/classes','string_manager_install.php',209],['lib/classes','string_manager_standard.php',504],['lib/classes','string_manager.php',102]], 23],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 556],
'create_included_users': ['create_included_users', 'Given one restoreid, create in DB all the users present in backup_ids having newitemid = 0, as far as precheck_included_users() have left them there ready to be created. Also, annotate their newids once created for later reference. ', [['backup/util/dbops','restore_dbops.class.php',1077]], 1],
'process_included_roles': ['process_included_roles', 'Process the loaded roles, looking for their best mapping or skipping Any error will cause exception. Note this is one wrapper over precheck_included_roles, that contains all the logic, but returns errors/warnings instead and is executed as part of the restore prechecks ', [['backup/util/dbops','restore_dbops.class.php',401]], 1],
'load_roles_to_tempids': ['load_roles_to_tempids', 'Load the needed role.xml file to backup_ids table for future reference ', [['backup/util/dbops','restore_dbops.class.php',144]], 2],
'progress': ['progress', 'Called during a file processing operation that reports progress. ', [['lib/filestorage','file_progress.php',35],['lib/filestorage/tests','tgz_packer_test.php',458],['lib/classes/progress','base.php',157],['backup/moodle2','backup_stepslib.php',1945],['lib/filestorage/tests','zip_packer_test.php',622],['backup/util/ui','restore_ui_stage.class.php',334]], 110],
'precheck_included_roles': ['precheck_included_roles', 'Precheck the loaded roles, return empty array if everything is ok, and array with \'errors\', \'warnings\' elements (suitable to be used by restore_prechecks) with any problem found. At the same time, store all the mapping into backup_ids_temp and also put the information into $rolemappings (controller->info), so it can be reworked later by post-precheck stages while at the same time accept modified info in the same object coming from UI ', [['backup/util/dbops','restore_dbops.class.php',160]], 2],
'get_backup_ids_cached': ['get_backup_ids_cached', 'Return cached backup id\'s ', [['backup/util/dbops','restore_dbops.class.php',203]], 1],
'instance_by_id': ['instance_by_id', 'Get a context instance as an object, from a given context id. ', [['lib','accesslib.php',5434]], 235],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'restore_get_question_banks': ['restore_get_question_banks', 'Return one array of contextid => contextlevel pairs of question banks to be checked for one given restore operation ordered from CONTEXT_SYSTEM downto CONTEXT_MODULE If contextlevel is specified, then only banks corresponding to that level are returned ', [['backup/util/dbops','restore_dbops.class.php',698]], 2],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'precheck_included_users': ['precheck_included_users', 'Check all the included users, deciding the action to perform for each one (mapping / creation) and returning one array of problems in case something is wrong (lack of permissions, conficts) ', [['backup/util/dbops','restore_dbops.class.php',1490]], 2],
'is_null': ['is_null', '', [], 2003],
'array_search': ['array_search', '', [], 170],
'asort': ['asort', '', [], 114],
'implode': ['implode', '', [], 1281],
'time': ['time', '', [], 1959],
'count': ['count', '', [], 4095],
'file_exists': ['file_exists', '', [], 867],
'is_string': ['is_string', '', [], 536],
'dirname': ['dirname', '', [], 335],
'substr': ['substr', '', [], 2823],
'in_array': ['in_array', '', [], 1234],
'is_object': ['is_object', '', [], 544],
'basename': ['basename', '', [], 153],
'file': ['file', '', [], 92],
'array_slice': ['array_slice', '', [], 165],
'array_merge': ['array_merge', '', [], 2944],
'preg_replace': ['preg_replace', '', [], 917],
'reset': ['reset', '', [], 1213],
'array_key_exists': ['array_key_exists', '', [], 1445],
'array_keys': ['array_keys', '', [], 1256]};
CLASS_DATA={
'restore_inforef_parser_processor': ['restore_inforef_parser_processor', 'helper implementation of grouped_parser_processor that will load all the contents of one inforef.xml file to the backup_ids table ', [['backup/util/helper','restore_inforef_parser_processor.class.php',27]], 1],
'core_tag_tag': ['core_tag_tag', 'Represents one tag and also contains lots of useful tag-related methods as static functions. ', [['tag/classes','tag.php',27]], 352],
'backup_helper_exception': ['backup_helper_exception', '', [['backup/util/helper','backup_helper.class.php',379]], 14],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323],
'restore_roles_parser_processor': ['restore_roles_parser_processor', 'helper implementation of grouped_parser_processor that will load all the contents of one roles.xml (roles description) file to the backup_ids table storing the whole structure there for later processing. Note: only "needed" roles are loaded (must have roleref record in backup_ids) ', [['backup/util/helper','restore_roles_parser_processor.class.php',27]], 1],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'context_user': ['context_user', 'User context class ', [['lib','accesslib.php',6398]], 414],
'backup_anonymizer_helper': ['backup_anonymizer_helper', 'Helper class for anonymization of data ', [['backup/util/helper','backup_anonymizer_helper.class.php',25]], 1],
'backup_file_manager': ['backup_file_manager', 'Collection of helper functions to handle files ', [['backup/util/helper','backup_file_manager.class.php',25]], 2],
'progressive_parser': ['progressive_parser', 'Class implementing one SAX progressive push parser. ', [['backup/util/xml/parser','progressive_parser.class.php',25]], 26],
'restore_questions_parser_processor': ['restore_questions_parser_processor', 'helper implementation of grouped_parser_processor that will load all the categories and questions (header info only) from then questions.xml file to the backup_ids table storing the whole structure there for later processing. Note: only "needed" categories are loaded (must have question_categoryref record in backup_ids) Note: parentitemid will contain the category->contextid for categories Note: parentitemid will contain the category->id for questions ', [['backup/util/helper','restore_questions_parser_processor.class.php',27]], 1],
'restore_users_parser_processor': ['restore_users_parser_processor', 'helper implementation of grouped_parser_processor that will load all the contents of one users.xml file to the backup_ids table storing the whole structure there for later processing. Note: only "needed" users are loaded (must have userref record in backup_ids) Note: parentitemid will contain the user->contextid Note: althought included in backup, we don\'t restore user context ras/caps in same site they will be already there and it doesn\'t seem a good idea to make them "transportable" arround sites. ', [['backup/util/helper','restore_users_parser_processor.class.php',27]], 1],
'restore_dbops_exception': ['restore_dbops_exception', '', [['backup/util/dbops','restore_dbops.class.php',1786]], 7]};
CONST_DATA={
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 466],
'ROLENAME_SHORT': ['ROLENAME_SHORT', '', [['lib','accesslib.php',182]], 21],
'IGNORE_MULTIPLE': ['IGNORE_MULTIPLE', '', [['lib','dmllib.php',50]], 43],
'AUTH_PASSWORD_NOT_CACHED': ['AUTH_PASSWORD_NOT_CACHED', '', [['lib','moodlelib.php',521]], 14],
'CONTEXT_SYSTEM': ['CONTEXT_SYSTEM', '', [['lib','accesslib.php',142]], 184],
'CONTEXT_COURSECAT': ['CONTEXT_COURSECAT', '', [['lib','accesslib.php',146]], 105],
'CONTEXT_COURSE': ['CONTEXT_COURSE', '', [['lib','accesslib.php',148]], 441],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
