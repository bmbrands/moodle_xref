<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /backup/util/helper/backup_cron_helper.class.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='backup/util/helper';
filename='backup_cron_helper.class.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/backup/util/helper/</a> -> <a href="backup_cron_helper.class.php.html">backup_cron_helper.class.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="backup_cron_helper.class.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="backup_cron_helper.class.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">//</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">//</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">//</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Utility helper for automated backups run through cron.</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package    core</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @subpackage backup</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @copyright  2010 Sam Hemelryk</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> */</span>
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment">/**</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * This class is an abstract class with methods that can be called to aid the</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * running of automated backups over cron.</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> */</span>
<a name="l33"><span class="linenum">  33</span></a>  abstract class backup_cron_automated_helper {
<a name="l34"><span class="linenum">  34</span></a>  
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment">    /** Automated backups are active and ready to run */</span>
<a name="l36"><span class="linenum">  36</span></a>      const STATE_OK = 0;
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment">    /** Automated backups are disabled and will not be run */</span>
<a name="l38"><span class="linenum">  38</span></a>      const STATE_DISABLED = 1;
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">    /** Automated backups are all ready running! */</span>
<a name="l40"><span class="linenum">  40</span></a>      const STATE_RUNNING = 2;
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment">    /** Course automated backup completed successfully */</span>
<a name="l43"><span class="linenum">  43</span></a>      const BACKUP_STATUS_OK = 1;
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment">    /** Course automated backup errored */</span>
<a name="l45"><span class="linenum">  45</span></a>      const BACKUP_STATUS_ERROR = 0;
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment">    /** Course automated backup never finished */</span>
<a name="l47"><span class="linenum">  47</span></a>      const BACKUP_STATUS_UNFINISHED = 2;
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">    /** Course automated backup was skipped */</span>
<a name="l49"><span class="linenum">  49</span></a>      const BACKUP_STATUS_SKIPPED = 3;
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">    /** Course automated backup had warnings */</span>
<a name="l51"><span class="linenum">  51</span></a>      const BACKUP_STATUS_WARNING = 4;
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment">    /** Course automated backup has yet to be run */</span>
<a name="l53"><span class="linenum">  53</span></a>      const BACKUP_STATUS_NOTYETRUN = 5;
<a name="l54"><span class="linenum">  54</span></a>  
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment">    /** Run if required by the schedule set in config. Default. **/</span>
<a name="l56"><span class="linenum">  56</span></a>      const RUN_ON_SCHEDULE = 0;
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">    /** Run immediately. **/</span>
<a name="l58"><span class="linenum">  58</span></a>      const RUN_IMMEDIATELY = 1;
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>      const AUTO_BACKUP_DISABLED = 0;
<a name="l61"><span class="linenum">  61</span></a>      const AUTO_BACKUP_ENABLED = 1;
<a name="l62"><span class="linenum">  62</span></a>      const AUTO_BACKUP_MANUAL = 2;
<a name="l63"><span class="linenum">  63</span></a>  
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">    /** Automated backup storage in course backup filearea */</span>
<a name="l65"><span class="linenum">  65</span></a>      const STORAGE_COURSE = 0;
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment">    /** Automated backup storage in specified directory */</span>
<a name="l67"><span class="linenum">  67</span></a>      const STORAGE_DIRECTORY = 1;
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">    /** Automated backup storage in course backup filearea and specified directory */</span>
<a name="l69"><span class="linenum">  69</span></a>      const STORAGE_COURSE_AND_DIRECTORY = 2;
<a name="l70"><span class="linenum">  70</span></a>  
<a name="l71"><span class="linenum">  71</span></a>      <span class="comment">/**</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment">     * Runs the automated backups if required</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment">     *</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">     * @global moodle_database $DB</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">     */</span>
<a name="l76"><span class="linenum">  76</span></a>      public static function <a class="function" onClick="logFunction('run_automated_backup')" href="../../../_functions/run_automated_backup.html" onMouseOver="funcPopup(event,'run_automated_backup')">run_automated_backup</a>(<a class="var it28754" onMouseOver="hilite(28754)" onMouseOut="lolite()" onClick="logVariable('rundirective')" href="../../../_variables/rundirective.html">$rundirective</a> = self::RUN_ON_SCHEDULE) {
<a name="l77"><span class="linenum">  77</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l78"><span class="linenum">  78</span></a>  
<a name="l79"><span class="linenum">  79</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> = true;
<a name="l80"><span class="linenum">  80</span></a>          <a class="var it28755" onMouseOver="hilite(28755)" onMouseOut="lolite()" onClick="logVariable('emailpending')" href="../../../_variables/emailpending.html">$emailpending</a> = false;
<a name="l81"><span class="linenum">  81</span></a>          <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l82"><span class="linenum">  82</span></a>          <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a> = <a class="function" onClick="logFunction('get_config')" href="../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup');
<a name="l83"><span class="linenum">  83</span></a>  
<a name="l84"><span class="linenum">  84</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;Checking automated backup status&quot;,'...');
<a name="l85"><span class="linenum">  85</span></a>          <a class="var it650" onMouseOver="hilite(650)" onMouseOut="lolite()" onClick="logVariable('state')" href="../../../_variables/state.html">$state</a> = backup_cron_automated_helper::<a class="function" onClick="logFunction('get_automated_backup_state')" href="../../../_functions/get_automated_backup_state.html" onMouseOver="funcPopup(event,'get_automated_backup_state')">get_automated_backup_state</a>(<a class="var it28754" onMouseOver="hilite(28754)" onMouseOut="lolite()" onClick="logVariable('rundirective')" href="../../../_variables/rundirective.html">$rundirective</a>);
<a name="l86"><span class="linenum">  86</span></a>          if (<a class="var it650" onMouseOver="hilite(650)" onMouseOut="lolite()" onClick="logVariable('state')" href="../../../_variables/state.html">$state</a> === backup_cron_automated_helper::STATE_DISABLED) {
<a name="l87"><span class="linenum">  87</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('INACTIVE');
<a name="l88"><span class="linenum">  88</span></a>              return <a class="var it650" onMouseOver="hilite(650)" onMouseOut="lolite()" onClick="logVariable('state')" href="../../../_variables/state.html">$state</a>;
<a name="l89"><span class="linenum">  89</span></a>          } else if (<a class="var it650" onMouseOver="hilite(650)" onMouseOut="lolite()" onClick="logVariable('state')" href="../../../_variables/state.html">$state</a> === backup_cron_automated_helper::STATE_RUNNING) {
<a name="l90"><span class="linenum">  90</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('RUNNING');
<a name="l91"><span class="linenum">  91</span></a>              if (<a class="var it28754" onMouseOver="hilite(28754)" onMouseOut="lolite()" onClick="logVariable('rundirective')" href="../../../_variables/rundirective.html">$rundirective</a> == self::RUN_IMMEDIATELY) {
<a name="l92"><span class="linenum">  92</span></a>                  <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Automated backups are already running. If this script is being run by cron this constitues an error. You will need to increase the time between executions within cron.');
<a name="l93"><span class="linenum">  93</span></a>              } else {
<a name="l94"><span class="linenum">  94</span></a>                  <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;automated backup are already running. Execution delayed&quot;);
<a name="l95"><span class="linenum">  95</span></a>              }
<a name="l96"><span class="linenum">  96</span></a>              return <a class="var it650" onMouseOver="hilite(650)" onMouseOut="lolite()" onClick="logVariable('state')" href="../../../_variables/state.html">$state</a>;
<a name="l97"><span class="linenum">  97</span></a>          } else {
<a name="l98"><span class="linenum">  98</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('OK');
<a name="l99"><span class="linenum">  99</span></a>          }
<a name="l100"><span class="linenum"> 100</span></a>          backup_cron_automated_helper::<a class="function" onClick="logFunction('set_state_running')" href="../../../_functions/set_state_running.html" onMouseOver="funcPopup(event,'set_state_running')">set_state_running</a>();
<a name="l101"><span class="linenum"> 101</span></a>  
<a name="l102"><span class="linenum"> 102</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;Getting admin info&quot;);
<a name="l103"><span class="linenum"> 103</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('admin')" href="../../../_variables/admin.html">$admin</a> = <a class="function" onClick="logFunction('get_admin')" href="../../../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l104"><span class="linenum"> 104</span></a>          if (!<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('admin')" href="../../../_variables/admin.html">$admin</a>) {
<a name="l105"><span class="linenum"> 105</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;Error: No admin account was found&quot;);
<a name="l106"><span class="linenum"> 106</span></a>              <a class="var it650" onMouseOver="hilite(650)" onMouseOut="lolite()" onClick="logVariable('state')" href="../../../_variables/state.html">$state</a> = false;
<a name="l107"><span class="linenum"> 107</span></a>          }
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>          if (<a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>) {
<a name="l110"><span class="linenum"> 110</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;Checking courses&quot;);
<a name="l111"><span class="linenum"> 111</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;Skipping deleted courses&quot;, '...');
<a name="l112"><span class="linenum"> 112</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(sprintf(&quot;%d courses&quot;, backup_cron_automated_helper::<a class="function" onClick="logFunction('remove_deleted_courses_from_schedule')" href="../../../_functions/remove_deleted_courses_from_schedule.html" onMouseOver="funcPopup(event,'remove_deleted_courses_from_schedule')">remove_deleted_courses_from_schedule</a>()));
<a name="l113"><span class="linenum"> 113</span></a>          }
<a name="l114"><span class="linenum"> 114</span></a>  
<a name="l115"><span class="linenum"> 115</span></a>          if (<a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>) {
<a name="l116"><span class="linenum"> 116</span></a>  
<a name="l117"><span class="linenum"> 117</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Running required automated backups...');
<a name="l118"><span class="linenum"> 118</span></a>              <a class="function" onClick="logFunction('cron_trace_time_and_memory')" href="../../../_functions/cron_trace_time_and_memory.html" onMouseOver="funcPopup(event,'cron_trace_time_and_memory')">cron_trace_time_and_memory</a>();
<a name="l119"><span class="linenum"> 119</span></a>  
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment">            // This could take a while!</span>
<a name="l121"><span class="linenum"> 121</span></a>              <a class="class" onClick="logClass('core_php_time_limit')" href="../../../_classes/core_php_time_limit.html" onMouseOver="classPopup(event,'core_php_time_limit')">core_php_time_limit</a>::<a class="function" onClick="logFunction('raise')" href="../../../_functions/raise.html" onMouseOver="funcPopup(event,'raise')">raise</a>();
<a name="l122"><span class="linenum"> 122</span></a>              <a class="function" onClick="logFunction('raise_memory_limit')" href="../../../_functions/raise_memory_limit.html" onMouseOver="funcPopup(event,'raise_memory_limit')">raise_memory_limit</a>(<a class="constant" onClick="logConstant('MEMORY_EXTRA')" href="../../../_constants/MEMORY_EXTRA.html" onMouseOver="constPopup(event,'MEMORY_EXTRA')">MEMORY_EXTRA</a>);
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>              <a class="var it28756" onMouseOver="hilite(28756)" onMouseOut="lolite()" onClick="logVariable('nextstarttime')" href="../../../_variables/nextstarttime.html">$nextstarttime</a> = backup_cron_automated_helper::<a class="function" onClick="logFunction('calculate_next_automated_backup')" href="../../../_functions/calculate_next_automated_backup.html" onMouseOver="funcPopup(event,'calculate_next_automated_backup')">calculate_next_automated_backup</a>(null, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>);
<a name="l125"><span class="linenum"> 125</span></a>              <a class="var it28757" onMouseOver="hilite(28757)" onMouseOut="lolite()" onClick="logVariable('showtime')" href="../../../_variables/showtime.html">$showtime</a> = &quot;undefined&quot;;
<a name="l126"><span class="linenum"> 126</span></a>              if (<a class="var it28756" onMouseOver="hilite(28756)" onMouseOut="lolite()" onClick="logVariable('nextstarttime')" href="../../../_variables/nextstarttime.html">$nextstarttime</a> &gt; 0) {
<a name="l127"><span class="linenum"> 127</span></a>                  <a class="var it28757" onMouseOver="hilite(28757)" onMouseOut="lolite()" onClick="logVariable('showtime')" href="../../../_variables/showtime.html">$showtime</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>('r', <a class="var it28756" onMouseOver="hilite(28756)" onMouseOut="lolite()" onClick="logVariable('nextstarttime')" href="../../../_variables/nextstarttime.html">$nextstarttime</a>);
<a name="l128"><span class="linenum"> 128</span></a>              }
<a name="l129"><span class="linenum"> 129</span></a>  
<a name="l130"><span class="linenum"> 130</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('course');
<a name="l131"><span class="linenum"> 131</span></a>              foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>) {
<a name="l132"><span class="linenum"> 132</span></a>                  <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('backup_courses', array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l133"><span class="linenum"> 133</span></a>                  if (!<a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>) {
<a name="l134"><span class="linenum"> 134</span></a>                      <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a> = new stdClass;
<a name="l135"><span class="linenum"> 135</span></a>                      <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('courseid')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/courseid.html">courseid</a> = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l136"><span class="linenum"> 136</span></a>                      <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststatus')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststatus.html">laststatus</a> = self::BACKUP_STATUS_NOTYETRUN;
<a name="l137"><span class="linenum"> 137</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('backup_courses', <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>);
<a name="l138"><span class="linenum"> 138</span></a>                      <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('backup_courses', array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l139"><span class="linenum"> 139</span></a>                  }
<a name="l140"><span class="linenum"> 140</span></a>  
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment">                // The last backup is considered as successful when OK or SKIPPED.</span>
<a name="l142"><span class="linenum"> 142</span></a>                  <a class="var it28758" onMouseOver="hilite(28758)" onMouseOut="lolite()" onClick="logVariable('lastbackupwassuccessful')" href="../../../_variables/lastbackupwassuccessful.html">$lastbackupwassuccessful</a> =  (<a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststatus')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststatus.html">laststatus</a> == self::BACKUP_STATUS_SKIPPED ||
<a name="l143"><span class="linenum"> 143</span></a>                                              <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststatus')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststatus.html">laststatus</a> == self::BACKUP_STATUS_OK) &amp;&amp; (
<a name="l144"><span class="linenum"> 144</span></a>                                              <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststarttime.html">laststarttime</a> &gt; 0 &amp;&amp; <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('lastendtime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/lastendtime.html">lastendtime</a> &gt; 0);
<a name="l145"><span class="linenum"> 145</span></a>  
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">                // Assume that we are not skipping anything.</span>
<a name="l147"><span class="linenum"> 147</span></a>                  <a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a> = false;
<a name="l148"><span class="linenum"> 148</span></a>                  <a class="var it28761" onMouseOver="hilite(28761)" onMouseOut="lolite()" onClick="logVariable('skippedmessage')" href="../../../_variables/skippedmessage.html">$skippedmessage</a> = '';
<a name="l149"><span class="linenum"> 149</span></a>  
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment">                // Check if we are going to be running the backup now.</span>
<a name="l151"><span class="linenum"> 151</span></a>                  <a class="var it28762" onMouseOver="hilite(28762)" onMouseOut="lolite()" onClick="logVariable('shouldrunnow')" href="../../../_variables/shouldrunnow.html">$shouldrunnow</a> = ((<a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('nextstarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/nextstarttime.html">nextstarttime</a> &gt; 0 &amp;&amp; <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('nextstarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/nextstarttime.html">nextstarttime</a> &lt; <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>)
<a name="l152"><span class="linenum"> 152</span></a>                      || <a class="var it28754" onMouseOver="hilite(28754)" onMouseOut="lolite()" onClick="logVariable('rundirective')" href="../../../_variables/rundirective.html">$rundirective</a> == self::RUN_IMMEDIATELY);
<a name="l153"><span class="linenum"> 153</span></a>  
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">                // If config backup_auto_skip_hidden is set to true, skip courses that are not visible.</span>
<a name="l155"><span class="linenum"> 155</span></a>                  if (<a class="var it28762" onMouseOver="hilite(28762)" onMouseOut="lolite()" onClick="logVariable('shouldrunnow')" href="../../../_variables/shouldrunnow.html">$shouldrunnow</a> &amp;&amp; <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_skip_hidden')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_skip_hidden.html">backup_auto_skip_hidden</a>) {
<a name="l156"><span class="linenum"> 156</span></a>                      <a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a> = (<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_skip_hidden')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_skip_hidden.html">backup_auto_skip_hidden</a> &amp;&amp; !<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('visible')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/visible.html">visible</a>);
<a name="l157"><span class="linenum"> 157</span></a>                      <a class="var it28761" onMouseOver="hilite(28761)" onMouseOut="lolite()" onClick="logVariable('skippedmessage')" href="../../../_variables/skippedmessage.html">$skippedmessage</a> = 'Not visible';
<a name="l158"><span class="linenum"> 158</span></a>                  }
<a name="l159"><span class="linenum"> 159</span></a>  
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment">                // If config backup_auto_skip_modif_days is set to true, skip courses</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment">                // that have not been modified since the number of days defined.</span>
<a name="l162"><span class="linenum"> 162</span></a>                  if (<a class="var it28762" onMouseOver="hilite(28762)" onMouseOut="lolite()" onClick="logVariable('shouldrunnow')" href="../../../_variables/shouldrunnow.html">$shouldrunnow</a> &amp;&amp; !<a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a> &amp;&amp; <a class="var it28758" onMouseOver="hilite(28758)" onMouseOut="lolite()" onClick="logVariable('lastbackupwassuccessful')" href="../../../_variables/lastbackupwassuccessful.html">$lastbackupwassuccessful</a> &amp;&amp; <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_skip_modif_days')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_skip_modif_days.html">backup_auto_skip_modif_days</a>) {
<a name="l163"><span class="linenum"> 163</span></a>                      <a class="var it28765" onMouseOver="hilite(28765)" onMouseOut="lolite()" onClick="logVariable('timenotmodifsincedays')" href="../../../_variables/timenotmodifsincedays.html">$timenotmodifsincedays</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a> - (<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_skip_modif_days')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_skip_modif_days.html">backup_auto_skip_modif_days</a> * <a class="constant" onClick="logConstant('DAYSECS')" href="../../../_constants/DAYSECS.html" onMouseOver="constPopup(event,'DAYSECS')">DAYSECS</a>);
<a name="l164"><span class="linenum"> 164</span></a>  <span class="comment">                    // Check log if there were any modifications to the course content.</span>
<a name="l165"><span class="linenum"> 165</span></a>                      <a class="var it28766" onMouseOver="hilite(28766)" onMouseOut="lolite()" onClick="logVariable('logexists')" href="../../../_variables/logexists.html">$logexists</a> = self::<a class="function" onClick="logFunction('is_course_modified')" href="../../../_functions/is_course_modified.html" onMouseOver="funcPopup(event,'is_course_modified')">is_course_modified</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it28765" onMouseOver="hilite(28765)" onMouseOut="lolite()" onClick="logVariable('timenotmodifsincedays')" href="../../../_variables/timenotmodifsincedays.html">$timenotmodifsincedays</a>);
<a name="l166"><span class="linenum"> 166</span></a>                      <a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a> = (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/timemodified.html">timemodified</a> &lt;= <a class="var it28765" onMouseOver="hilite(28765)" onMouseOut="lolite()" onClick="logVariable('timenotmodifsincedays')" href="../../../_variables/timenotmodifsincedays.html">$timenotmodifsincedays</a> &amp;&amp; !<a class="var it28766" onMouseOver="hilite(28766)" onMouseOut="lolite()" onClick="logVariable('logexists')" href="../../../_variables/logexists.html">$logexists</a>);
<a name="l167"><span class="linenum"> 167</span></a>                      <a class="var it28761" onMouseOver="hilite(28761)" onMouseOut="lolite()" onClick="logVariable('skippedmessage')" href="../../../_variables/skippedmessage.html">$skippedmessage</a> = 'Not modified in the past '.<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_skip_modif_days')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_skip_modif_days.html">backup_auto_skip_modif_days</a>.' days';
<a name="l168"><span class="linenum"> 168</span></a>                  }
<a name="l169"><span class="linenum"> 169</span></a>  
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment">                // If config backup_auto_skip_modif_prev is set to true, skip courses</span>
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">                // that have not been modified since previous backup.</span>
<a name="l172"><span class="linenum"> 172</span></a>                  if (<a class="var it28762" onMouseOver="hilite(28762)" onMouseOut="lolite()" onClick="logVariable('shouldrunnow')" href="../../../_variables/shouldrunnow.html">$shouldrunnow</a> &amp;&amp; !<a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a> &amp;&amp; <a class="var it28758" onMouseOver="hilite(28758)" onMouseOut="lolite()" onClick="logVariable('lastbackupwassuccessful')" href="../../../_variables/lastbackupwassuccessful.html">$lastbackupwassuccessful</a> &amp;&amp; <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_skip_modif_prev')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_skip_modif_prev.html">backup_auto_skip_modif_prev</a>) {
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">                    // Check log if there were any modifications to the course content.</span>
<a name="l174"><span class="linenum"> 174</span></a>                      <a class="var it28766" onMouseOver="hilite(28766)" onMouseOut="lolite()" onClick="logVariable('logexists')" href="../../../_variables/logexists.html">$logexists</a> = self::<a class="function" onClick="logFunction('is_course_modified')" href="../../../_functions/is_course_modified.html" onMouseOver="funcPopup(event,'is_course_modified')">is_course_modified</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststarttime.html">laststarttime</a>);
<a name="l175"><span class="linenum"> 175</span></a>                      <a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a> = (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/timemodified.html">timemodified</a> &lt;= <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststarttime.html">laststarttime</a> &amp;&amp; !<a class="var it28766" onMouseOver="hilite(28766)" onMouseOut="lolite()" onClick="logVariable('logexists')" href="../../../_variables/logexists.html">$logexists</a>);
<a name="l176"><span class="linenum"> 176</span></a>                      <a class="var it28761" onMouseOver="hilite(28761)" onMouseOut="lolite()" onClick="logVariable('skippedmessage')" href="../../../_variables/skippedmessage.html">$skippedmessage</a> = 'Not modified since previous backup';
<a name="l177"><span class="linenum"> 177</span></a>                  }
<a name="l178"><span class="linenum"> 178</span></a>  
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment">                // Check if the course is not scheduled to run right now.</span>
<a name="l180"><span class="linenum"> 180</span></a>                  if (!<a class="var it28762" onMouseOver="hilite(28762)" onMouseOut="lolite()" onClick="logVariable('shouldrunnow')" href="../../../_variables/shouldrunnow.html">$shouldrunnow</a>) {
<a name="l181"><span class="linenum"> 181</span></a>                      <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('nextstarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/nextstarttime.html">nextstarttime</a> = <a class="var it28756" onMouseOver="hilite(28756)" onMouseOut="lolite()" onClick="logVariable('nextstarttime')" href="../../../_variables/nextstarttime.html">$nextstarttime</a>;
<a name="l182"><span class="linenum"> 182</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('backup_courses', <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>);
<a name="l183"><span class="linenum"> 183</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Skipping ' . <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('fullname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/fullname.html">fullname</a> . ' (Not scheduled for backup until ' . <a class="var it28757" onMouseOver="hilite(28757)" onMouseOut="lolite()" onClick="logVariable('showtime')" href="../../../_variables/showtime.html">$showtime</a> . ')');
<a name="l184"><span class="linenum"> 184</span></a>                  } else {
<a name="l185"><span class="linenum"> 185</span></a>                      if (<a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a>) { // Must have been skipped for a reason.
<a name="l186"><span class="linenum"> 186</span></a>                          <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststatus')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststatus.html">laststatus</a> = self::BACKUP_STATUS_SKIPPED;
<a name="l187"><span class="linenum"> 187</span></a>                          <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('nextstarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/nextstarttime.html">nextstarttime</a> = <a class="var it28756" onMouseOver="hilite(28756)" onMouseOut="lolite()" onClick="logVariable('nextstarttime')" href="../../../_variables/nextstarttime.html">$nextstarttime</a>;
<a name="l188"><span class="linenum"> 188</span></a>                          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('backup_courses', <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>);
<a name="l189"><span class="linenum"> 189</span></a>                          <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Skipping ' . <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('fullname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/fullname.html">fullname</a> . ' (' . <a class="var it28761" onMouseOver="hilite(28761)" onMouseOut="lolite()" onClick="logVariable('skippedmessage')" href="../../../_variables/skippedmessage.html">$skippedmessage</a> . ')');
<a name="l190"><span class="linenum"> 190</span></a>                          <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Backup of \'' . <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('fullname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/fullname.html">fullname</a> . '\' is scheduled on ' . <a class="var it28757" onMouseOver="hilite(28757)" onMouseOut="lolite()" onClick="logVariable('showtime')" href="../../../_variables/showtime.html">$showtime</a>);
<a name="l191"><span class="linenum"> 191</span></a>                      } else {
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment">                        // Backup every non-skipped courses.</span>
<a name="l193"><span class="linenum"> 193</span></a>                          <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Backing up '.<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('fullname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/fullname.html">fullname</a>.'...');
<a name="l194"><span class="linenum"> 194</span></a>  
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">                        // We have to send an email because we have included at least one backup.</span>
<a name="l196"><span class="linenum"> 196</span></a>                          <a class="var it28755" onMouseOver="hilite(28755)" onMouseOut="lolite()" onClick="logVariable('emailpending')" href="../../../_variables/emailpending.html">$emailpending</a> = true;
<a name="l197"><span class="linenum"> 197</span></a>  
<a name="l198"><span class="linenum"> 198</span></a>  <span class="comment">                        // Only make the backup if laststatus isn't 2-UNFINISHED (uncontrolled error).</span>
<a name="l199"><span class="linenum"> 199</span></a>                          if (<a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststatus')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststatus.html">laststatus</a> != self::BACKUP_STATUS_UNFINISHED) {
<a name="l200"><span class="linenum"> 200</span></a>  <span class="comment">                            // Set laststarttime.</span>
<a name="l201"><span class="linenum"> 201</span></a>                              <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('starttime')" href="../../../_variables/starttime.html">$starttime</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l202"><span class="linenum"> 202</span></a>  
<a name="l203"><span class="linenum"> 203</span></a>                              <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststarttime.html">laststarttime</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l204"><span class="linenum"> 204</span></a>                              <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststatus')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststatus.html">laststatus</a> = self::BACKUP_STATUS_UNFINISHED;
<a name="l205"><span class="linenum"> 205</span></a>                              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('backup_courses', <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>);
<a name="l206"><span class="linenum"> 206</span></a>  
<a name="l207"><span class="linenum"> 207</span></a>                              <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststatus')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststatus.html">laststatus</a> = self::<a class="function" onClick="logFunction('launch_automated_backup')" href="../../../_functions/launch_automated_backup.html" onMouseOver="funcPopup(event,'launch_automated_backup')">launch_automated_backup</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>, <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('laststarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/laststarttime.html">laststarttime</a>,
<a name="l208"><span class="linenum"> 208</span></a>                                      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('admin')" href="../../../_variables/admin.html">$admin</a>-&gt;<a onClick="logVariable('id')" class="var it43601" onMouseOver="hilite(43601)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l209"><span class="linenum"> 209</span></a>                              <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('lastendtime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/lastendtime.html">lastendtime</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l210"><span class="linenum"> 210</span></a>                              <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>-&gt;<a onClick="logVariable('nextstarttime')" class="var it43600" onMouseOver="hilite(43600)" onMouseOut="lolite()" href="../../../_variables/nextstarttime.html">nextstarttime</a> = <a class="var it28756" onMouseOver="hilite(28756)" onMouseOut="lolite()" onClick="logVariable('nextstarttime')" href="../../../_variables/nextstarttime.html">$nextstarttime</a>;
<a name="l211"><span class="linenum"> 211</span></a>  
<a name="l212"><span class="linenum"> 212</span></a>                              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('backup_courses', <a class="var it14724" onMouseOver="hilite(14724)" onMouseOut="lolite()" onClick="logVariable('backupcourse')" href="../../../_variables/backupcourse.html">$backupcourse</a>);
<a name="l213"><span class="linenum"> 213</span></a>  
<a name="l214"><span class="linenum"> 214</span></a>                              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;complete - next execution: <a class="var it28757" onMouseOver="hilite(28757)" onMouseOut="lolite()" onClick="logVariable('showtime')" href="../../../_variables/showtime.html">$showtime</a>&quot;);
<a name="l215"><span class="linenum"> 215</span></a>                          }
<a name="l216"><span class="linenum"> 216</span></a>                      }
<a name="l217"><span class="linenum"> 217</span></a>  
<a name="l218"><span class="linenum"> 218</span></a>  <span class="comment">                    // Remove excess backups.</span>
<a name="l219"><span class="linenum"> 219</span></a>                      <a class="var it28768" onMouseOver="hilite(28768)" onMouseOut="lolite()" onClick="logVariable('removedcount')" href="../../../_variables/removedcount.html">$removedcount</a> = self::<a class="function" onClick="logFunction('remove_excess_backups')" href="../../../_functions/remove_excess_backups.html" onMouseOver="funcPopup(event,'remove_excess_backups')">remove_excess_backups</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>);
<a name="l220"><span class="linenum"> 220</span></a>                  }
<a name="l221"><span class="linenum"> 221</span></a>              }
<a name="l222"><span class="linenum"> 222</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l223"><span class="linenum"> 223</span></a>          }
<a name="l224"><span class="linenum"> 224</span></a>  
<a name="l225"><span class="linenum"> 225</span></a>  <span class="comment">        //Send email to admin if necessary</span>
<a name="l226"><span class="linenum"> 226</span></a>          if (<a class="var it28755" onMouseOver="hilite(28755)" onMouseOut="lolite()" onClick="logVariable('emailpending')" href="../../../_variables/emailpending.html">$emailpending</a>) {
<a name="l227"><span class="linenum"> 227</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;Sending email to admin&quot;);
<a name="l228"><span class="linenum"> 228</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> = &quot;&quot;;
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>              <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a> = backup_cron_automated_helper::<a class="function" onClick="logFunction('get_backup_status_array')" href="../../../_functions/get_backup_status_array.html" onMouseOver="funcPopup(event,'get_backup_status_array')">get_backup_status_array</a>();
<a name="l231"><span class="linenum"> 231</span></a>              <a class="var it6033" onMouseOver="hilite(6033)" onMouseOut="lolite()" onClick="logVariable('haserrors')" href="../../../_variables/haserrors.html">$haserrors</a> = (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>[self::BACKUP_STATUS_ERROR] != 0 || <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>[self::BACKUP_STATUS_UNFINISHED] != 0);
<a name="l232"><span class="linenum"> 232</span></a>  
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment">            // Build the message text.</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment">            // Summary.</span>
<a name="l235"><span class="linenum"> 235</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('summary') . &quot;\n&quot;;
<a name="l236"><span class="linenum"> 236</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= &quot;==================================================\n&quot;;
<a name="l237"><span class="linenum"> 237</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= '  ' . <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('courses') . '; ' . <a class="phpfunction" onClick="logFunction('array_sum')" href="../../../_functions/array_sum.html" onMouseOver="phpfuncPopup(event,'array_sum')">array_sum</a>(<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>) . &quot;\n&quot;;
<a name="l238"><span class="linenum"> 238</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= '  ' . <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('ok') . '; ' . <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>[self::BACKUP_STATUS_OK] . &quot;\n&quot;;
<a name="l239"><span class="linenum"> 239</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= '  ' . <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('skipped') . '; ' . <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>[self::BACKUP_STATUS_SKIPPED] . &quot;\n&quot;;
<a name="l240"><span class="linenum"> 240</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= '  ' . <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('error') . '; ' . <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>[self::BACKUP_STATUS_ERROR] . &quot;\n&quot;;
<a name="l241"><span class="linenum"> 241</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= '  ' . <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unfinished') . '; ' . <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>[self::BACKUP_STATUS_UNFINISHED] . &quot;\n&quot;;
<a name="l242"><span class="linenum"> 242</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= '  ' . <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('warning') . '; ' . <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>[self::BACKUP_STATUS_WARNING] . &quot;\n&quot;;
<a name="l243"><span class="linenum"> 243</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= '  ' . <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('backupnotyetrun') . '; ' . <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>[self::BACKUP_STATUS_NOTYETRUN].&quot;\n\n&quot;;
<a name="l244"><span class="linenum"> 244</span></a>  
<a name="l245"><span class="linenum"> 245</span></a>  <span class="comment">            //Reference</span>
<a name="l246"><span class="linenum"> 246</span></a>              if (<a class="var it6033" onMouseOver="hilite(6033)" onMouseOut="lolite()" onClick="logVariable('haserrors')" href="../../../_variables/haserrors.html">$haserrors</a>) {
<a name="l247"><span class="linenum"> 247</span></a>                  <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= &quot;  &quot;.<a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('backupfailed').&quot;\n\n&quot;;
<a name="l248"><span class="linenum"> 248</span></a>                  <a class="var it28769" onMouseOver="hilite(28769)" onMouseOut="lolite()" onClick="logVariable('dest_url')" href="../../../_variables/dest_url.html">$dest_url</a> = &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/wwwroot.html">wwwroot</a>/report/backups/index.php&quot;;
<a name="l249"><span class="linenum"> 249</span></a>                  <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= &quot;  &quot;.<a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('backuptakealook','',<a class="var it28769" onMouseOver="hilite(28769)" onMouseOut="lolite()" onClick="logVariable('dest_url')" href="../../../_variables/dest_url.html">$dest_url</a>).&quot;\n\n&quot;;
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">                //Set message priority</span>
<a name="l251"><span class="linenum"> 251</span></a>                  <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('admin')" href="../../../_variables/admin.html">$admin</a>-&gt;<a onClick="logVariable('priority')" class="var it43601" onMouseOver="hilite(43601)" onMouseOut="lolite()" href="../../../_variables/priority.html">priority</a> = 1;
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment">                //Reset unfinished to error</span>
<a name="l253"><span class="linenum"> 253</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('backup_courses','laststatus','0', array('laststatus'=&gt;'2'));
<a name="l254"><span class="linenum"> 254</span></a>              } else {
<a name="l255"><span class="linenum"> 255</span></a>                  <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> .= &quot;  &quot;.<a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('backupfinished').&quot;\n&quot;;
<a name="l256"><span class="linenum"> 256</span></a>              }
<a name="l257"><span class="linenum"> 257</span></a>  
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment">            //Build the message subject</span>
<a name="l259"><span class="linenum"> 259</span></a>              <a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../../../_variables/site.html">$site</a> = <a class="function" onClick="logFunction('get_site')" href="../../../_functions/get_site.html" onMouseOver="funcPopup(event,'get_site')">get_site</a>();
<a name="l260"><span class="linenum"> 260</span></a>              <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a> = <a class="function" onClick="logFunction('format_string')" href="../../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../../../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('shortname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../../../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="class" onClick="logClass('context_course')" href="../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="constant" onClick="logConstant('SITEID')" href="../../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>))).&quot;: &quot;;
<a name="l261"><span class="linenum"> 261</span></a>              if (<a class="var it6033" onMouseOver="hilite(6033)" onMouseOut="lolite()" onClick="logVariable('haserrors')" href="../../../_variables/haserrors.html">$haserrors</a>) {
<a name="l262"><span class="linenum"> 262</span></a>                  <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a> .= &quot;[&quot;.<a class="phpfunction" onClick="logFunction('strtoupper')" href="../../../_functions/strtoupper.html" onMouseOver="phpfuncPopup(event,'strtoupper')">strtoupper</a>(<a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('error')).&quot;] &quot;;
<a name="l263"><span class="linenum"> 263</span></a>              }
<a name="l264"><span class="linenum"> 264</span></a>              <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../../_variables/subject.html">$subject</a> = <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a>.<a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('automatedbackupstatus', 'backup');
<a name="l265"><span class="linenum"> 265</span></a>  
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment">            //Send the message</span>
<a name="l267"><span class="linenum"> 267</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a> = new stdClass();
<a name="l268"><span class="linenum"> 268</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('modulename')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/modulename.html">modulename</a>        = 'moodle';
<a name="l269"><span class="linenum"> 269</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/userfrom.html">userfrom</a>          = <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('admin')" href="../../../_variables/admin.html">$admin</a>;
<a name="l270"><span class="linenum"> 270</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/userto.html">userto</a>            = <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('admin')" href="../../../_variables/admin.html">$admin</a>;
<a name="l271"><span class="linenum"> 271</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('subject')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/subject.html">subject</a>           = <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../../_variables/subject.html">$subject</a>;
<a name="l272"><span class="linenum"> 272</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/fullmessage.html">fullmessage</a>       = <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>;
<a name="l273"><span class="linenum"> 273</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/fullmessageformat.html">fullmessageformat</a> = <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../../../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>;
<a name="l274"><span class="linenum"> 274</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/fullmessagehtml.html">fullmessagehtml</a>   = '';
<a name="l275"><span class="linenum"> 275</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/smallmessage.html">smallmessage</a>      = '';
<a name="l276"><span class="linenum"> 276</span></a>  
<a name="l277"><span class="linenum"> 277</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('component')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/component.html">component</a>         = 'moodle';
<a name="l278"><span class="linenum"> 278</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('name')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>         = 'backup';
<a name="l279"><span class="linenum"> 279</span></a>  
<a name="l280"><span class="linenum"> 280</span></a>              <a class="function" onClick="logFunction('message_send')" href="../../../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../../_variables/eventdata.html">$eventdata</a>);
<a name="l281"><span class="linenum"> 281</span></a>          }
<a name="l282"><span class="linenum"> 282</span></a>  
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment">        //Everything is finished stop backup_auto_running</span>
<a name="l284"><span class="linenum"> 284</span></a>          backup_cron_automated_helper::<a class="function" onClick="logFunction('set_state_running')" href="../../../_functions/set_state_running.html" onMouseOver="funcPopup(event,'set_state_running')">set_state_running</a>(false);
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Automated backups complete.');
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>          return <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>;
<a name="l289"><span class="linenum"> 289</span></a>      }
<a name="l290"><span class="linenum"> 290</span></a>  
<a name="l291"><span class="linenum"> 291</span></a>      <span class="comment">/**</span>
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment">     * Gets the results from the last automated backup that was run based upon</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment">     * the statuses of the courses that were looked at.</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment">     *</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment">     * @global moodle_database $DB</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment">     * @return array</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment">     */</span>
<a name="l298"><span class="linenum"> 298</span></a>      public static function <a class="function" onClick="logFunction('get_backup_status_array')" href="../../../_functions/get_backup_status_array.html" onMouseOver="funcPopup(event,'get_backup_status_array')">get_backup_status_array</a>() {
<a name="l299"><span class="linenum"> 299</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l300"><span class="linenum"> 300</span></a>  
<a name="l301"><span class="linenum"> 301</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = array(
<a name="l302"><span class="linenum"> 302</span></a>              self::BACKUP_STATUS_ERROR =&gt; 0,
<a name="l303"><span class="linenum"> 303</span></a>              self::BACKUP_STATUS_OK =&gt; 0,
<a name="l304"><span class="linenum"> 304</span></a>              self::BACKUP_STATUS_UNFINISHED =&gt; 0,
<a name="l305"><span class="linenum"> 305</span></a>              self::BACKUP_STATUS_SKIPPED =&gt; 0,
<a name="l306"><span class="linenum"> 306</span></a>              self::BACKUP_STATUS_WARNING =&gt; 0,
<a name="l307"><span class="linenum"> 307</span></a>              self::BACKUP_STATUS_NOTYETRUN =&gt; 0
<a name="l308"><span class="linenum"> 308</span></a>          );
<a name="l309"><span class="linenum"> 309</span></a>  
<a name="l310"><span class="linenum"> 310</span></a>          <a class="var it11943" onMouseOver="hilite(11943)" onMouseOut="lolite()" onClick="logVariable('statuses')" href="../../../_variables/statuses.html">$statuses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>('SELECT DISTINCT bc.laststatus, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(bc.courseid) AS statuscount FROM {backup_courses} bc GROUP BY bc.laststatus');
<a name="l311"><span class="linenum"> 311</span></a>  
<a name="l312"><span class="linenum"> 312</span></a>          foreach (<a class="var it11943" onMouseOver="hilite(11943)" onMouseOut="lolite()" onClick="logVariable('statuses')" href="../../../_variables/statuses.html">$statuses</a> as <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>) {
<a name="l313"><span class="linenum"> 313</span></a>              if (empty(<a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>-&gt;<a onClick="logVariable('statuscount')" class="var it43602" onMouseOver="hilite(43602)" onMouseOut="lolite()" href="../../../_variables/statuscount.html">statuscount</a>)) {
<a name="l314"><span class="linenum"> 314</span></a>                  <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>-&gt;<a onClick="logVariable('statuscount')" class="var it43602" onMouseOver="hilite(43602)" onMouseOut="lolite()" href="../../../_variables/statuscount.html">statuscount</a> = 0;
<a name="l315"><span class="linenum"> 315</span></a>              }
<a name="l316"><span class="linenum"> 316</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>[(int)<a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>-&gt;<a onClick="logVariable('laststatus')" class="var it43602" onMouseOver="hilite(43602)" onMouseOut="lolite()" href="../../../_variables/laststatus.html">laststatus</a>] += <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>-&gt;<a onClick="logVariable('statuscount')" class="var it43602" onMouseOver="hilite(43602)" onMouseOut="lolite()" href="../../../_variables/statuscount.html">statuscount</a>;
<a name="l317"><span class="linenum"> 317</span></a>          }
<a name="l318"><span class="linenum"> 318</span></a>  
<a name="l319"><span class="linenum"> 319</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l320"><span class="linenum"> 320</span></a>      }
<a name="l321"><span class="linenum"> 321</span></a>  
<a name="l322"><span class="linenum"> 322</span></a>      <span class="comment">/**</span>
<a name="l323"><span class="linenum"> 323</span></a>  <span class="comment">     * Works out the next time the automated backup should be run.</span>
<a name="l324"><span class="linenum"> 324</span></a>  <span class="comment">     *</span>
<a name="l325"><span class="linenum"> 325</span></a>  <span class="comment">     * @param mixed $ignoredtimezone all settings are in server timezone!</span>
<a name="l326"><span class="linenum"> 326</span></a>  <span class="comment">     * @param int $now timestamp, should not be in the past, most likely time()</span>
<a name="l327"><span class="linenum"> 327</span></a>  <span class="comment">     * @return int timestamp of the next execution at server time</span>
<a name="l328"><span class="linenum"> 328</span></a>  <span class="comment">     */</span>
<a name="l329"><span class="linenum"> 329</span></a>      public static function <a class="function" onClick="logFunction('calculate_next_automated_backup')" href="../../../_functions/calculate_next_automated_backup.html" onMouseOver="funcPopup(event,'calculate_next_automated_backup')">calculate_next_automated_backup</a>(<a class="var it28771" onMouseOver="hilite(28771)" onMouseOut="lolite()" onClick="logVariable('ignoredtimezone')" href="../../../_variables/ignoredtimezone.html">$ignoredtimezone</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>) {
<a name="l330"><span class="linenum"> 330</span></a>  
<a name="l331"><span class="linenum"> 331</span></a>          <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a> = <a class="function" onClick="logFunction('get_config')" href="../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup');
<a name="l332"><span class="linenum"> 332</span></a>  
<a name="l333"><span class="linenum"> 333</span></a>          <a class="var it28772" onMouseOver="hilite(28772)" onMouseOut="lolite()" onClick="logVariable('backuptime')" href="../../../_variables/backuptime.html">$backuptime</a> = new DateTime('@' . <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>);
<a name="l334"><span class="linenum"> 334</span></a>          <a class="var it28772" onMouseOver="hilite(28772)" onMouseOut="lolite()" onClick="logVariable('backuptime')" href="../../../_variables/backuptime.html">$backuptime</a>-&gt;<a class="function" onClick="logFunction('setTimezone')" href="../../../_functions/settimezone.html" onMouseOver="funcPopup(event,'settimezone')">setTimezone</a>(<a class="class" onClick="logClass('core_date')" href="../../../_classes/core_date.html" onMouseOver="classPopup(event,'core_date')">core_date</a>::<a class="function" onClick="logFunction('get_server_timezone_object')" href="../../../_functions/get_server_timezone_object.html" onMouseOver="funcPopup(event,'get_server_timezone_object')">get_server_timezone_object</a>());
<a name="l335"><span class="linenum"> 335</span></a>          <a class="var it28772" onMouseOver="hilite(28772)" onMouseOut="lolite()" onClick="logVariable('backuptime')" href="../../../_variables/backuptime.html">$backuptime</a>-&gt;<a class="function" onClick="logFunction('setTime')" href="../../../_functions/settime.html" onMouseOver="funcPopup(event,'settime')">setTime</a>(<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_hour')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_hour.html">backup_auto_hour</a>, <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_minute')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_minute.html">backup_auto_minute</a>);
<a name="l336"><span class="linenum"> 336</span></a>  
<a name="l337"><span class="linenum"> 337</span></a>          while (<a class="var it28772" onMouseOver="hilite(28772)" onMouseOut="lolite()" onClick="logVariable('backuptime')" href="../../../_variables/backuptime.html">$backuptime</a>-&gt;<a class="function" onClick="logFunction('getTimestamp')" href="../../../_functions/gettimestamp.html" onMouseOver="funcPopup(event,'gettimestamp')">getTimestamp</a>() &lt; <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>) {
<a name="l338"><span class="linenum"> 338</span></a>              <a class="var it28772" onMouseOver="hilite(28772)" onMouseOut="lolite()" onClick="logVariable('backuptime')" href="../../../_variables/backuptime.html">$backuptime</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(new DateInterval('P1D'));
<a name="l339"><span class="linenum"> 339</span></a>          }
<a name="l340"><span class="linenum"> 340</span></a>  
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment">        // Get number of days from backup date to execute backups.</span>
<a name="l342"><span class="linenum"> 342</span></a>          <a class="var it28775" onMouseOver="hilite(28775)" onMouseOut="lolite()" onClick="logVariable('automateddays')" href="../../../_variables/automateddays.html">$automateddays</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_weekdays')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_weekdays.html">backup_auto_weekdays</a>, <a class="var it28772" onMouseOver="hilite(28772)" onMouseOut="lolite()" onClick="logVariable('backuptime')" href="../../../_variables/backuptime.html">$backuptime</a>-&gt;<a class="function" onClick="logFunction('format')" href="../../../_functions/format.html" onMouseOver="funcPopup(event,'format')">format</a>('w')) . <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_weekdays')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_weekdays.html">backup_auto_weekdays</a>;
<a name="l343"><span class="linenum"> 343</span></a>          <a class="var it28777" onMouseOver="hilite(28777)" onMouseOut="lolite()" onClick="logVariable('daysfromnow')" href="../../../_variables/daysfromnow.html">$daysfromnow</a> = <a class="phpfunction" onClick="logFunction('strpos')" href="../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it28775" onMouseOver="hilite(28775)" onMouseOut="lolite()" onClick="logVariable('automateddays')" href="../../../_variables/automateddays.html">$automateddays</a>, &quot;1&quot;);
<a name="l344"><span class="linenum"> 344</span></a>  
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment">        // Error, there are no days to schedule the backup for.</span>
<a name="l346"><span class="linenum"> 346</span></a>          if (<a class="var it28777" onMouseOver="hilite(28777)" onMouseOut="lolite()" onClick="logVariable('daysfromnow')" href="../../../_variables/daysfromnow.html">$daysfromnow</a> === false) {
<a name="l347"><span class="linenum"> 347</span></a>              return 0;
<a name="l348"><span class="linenum"> 348</span></a>          }
<a name="l349"><span class="linenum"> 349</span></a>  
<a name="l350"><span class="linenum"> 350</span></a>          if (<a class="var it28777" onMouseOver="hilite(28777)" onMouseOut="lolite()" onClick="logVariable('daysfromnow')" href="../../../_variables/daysfromnow.html">$daysfromnow</a> &gt; 0) {
<a name="l351"><span class="linenum"> 351</span></a>              <a class="var it28772" onMouseOver="hilite(28772)" onMouseOut="lolite()" onClick="logVariable('backuptime')" href="../../../_variables/backuptime.html">$backuptime</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(new DateInterval('P' . <a class="var it28777" onMouseOver="hilite(28777)" onMouseOut="lolite()" onClick="logVariable('daysfromnow')" href="../../../_variables/daysfromnow.html">$daysfromnow</a> . 'D'));
<a name="l352"><span class="linenum"> 352</span></a>          }
<a name="l353"><span class="linenum"> 353</span></a>  
<a name="l354"><span class="linenum"> 354</span></a>          return <a class="var it28772" onMouseOver="hilite(28772)" onMouseOut="lolite()" onClick="logVariable('backuptime')" href="../../../_variables/backuptime.html">$backuptime</a>-&gt;<a class="function" onClick="logFunction('getTimestamp')" href="../../../_functions/gettimestamp.html" onMouseOver="funcPopup(event,'gettimestamp')">getTimestamp</a>();
<a name="l355"><span class="linenum"> 355</span></a>      }
<a name="l356"><span class="linenum"> 356</span></a>  
<a name="l357"><span class="linenum"> 357</span></a>      <span class="comment">/**</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment">     * Launches a automated backup routine for the given course</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment">     *</span>
<a name="l360"><span class="linenum"> 360</span></a>  <span class="comment">     * @param stdClass $course</span>
<a name="l361"><span class="linenum"> 361</span></a>  <span class="comment">     * @param int $starttime</span>
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment">     * @return bool</span>
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment">     */</span>
<a name="l365"><span class="linenum"> 365</span></a>      public static function <a class="function" onClick="logFunction('launch_automated_backup')" href="../../../_functions/launch_automated_backup.html" onMouseOver="funcPopup(event,'launch_automated_backup')">launch_automated_backup</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>, <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('starttime')" href="../../../_variables/starttime.html">$starttime</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>) {
<a name="l366"><span class="linenum"> 366</span></a>  
<a name="l367"><span class="linenum"> 367</span></a>          <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> = self::BACKUP_STATUS_OK;
<a name="l368"><span class="linenum"> 368</span></a>          <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a> = <a class="function" onClick="logFunction('get_config')" href="../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup');
<a name="l369"><span class="linenum"> 369</span></a>          <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a> = <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_destination')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_destination.html">backup_auto_destination</a>;
<a name="l370"><span class="linenum"> 370</span></a>          <a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> = (int)<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_storage')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_storage.html">backup_auto_storage</a>;
<a name="l371"><span class="linenum"> 371</span></a>  
<a name="l372"><span class="linenum"> 372</span></a>          <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_controller')" href="../../../_classes/backup_controller.html" onMouseOver="classPopup(event,'backup_controller')">backup_controller</a>(backup::TYPE_1COURSE, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, backup::<a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../../../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a>, backup::INTERACTIVE_NO,
<a name="l373"><span class="linenum"> 373</span></a>                  backup::MODE_AUTOMATED, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>);
<a name="l374"><span class="linenum"> 374</span></a>  
<a name="l375"><span class="linenum"> 375</span></a>          try {
<a name="l376"><span class="linenum"> 376</span></a>  
<a name="l377"><span class="linenum"> 377</span></a>  <span class="comment">            // Set the default filename.</span>
<a name="l378"><span class="linenum"> 378</span></a>              <a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('get_format')" href="../../../_functions/get_format.html" onMouseOver="funcPopup(event,'get_format')">get_format</a>();
<a name="l379"><span class="linenum"> 379</span></a>              <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> = <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('get_type')" href="../../../_functions/get_type.html" onMouseOver="funcPopup(event,'get_type')">get_type</a>();
<a name="l380"><span class="linenum"> 380</span></a>              <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a> = <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l381"><span class="linenum"> 381</span></a>              <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../../_variables/users.html">$users</a> = <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('get_plan')" href="../../../_functions/get_plan.html" onMouseOver="funcPopup(event,'get_plan')">get_plan</a>()-&gt;<a class="function" onClick="logFunction('get_setting')" href="../../../_functions/get_setting.html" onMouseOver="funcPopup(event,'get_setting')">get_setting</a>('users')-&gt;<a class="function" onClick="logFunction('get_value')" href="../../../_functions/get_value.html" onMouseOver="funcPopup(event,'get_value')">get_value</a>();
<a name="l382"><span class="linenum"> 382</span></a>              <a class="var it15342" onMouseOver="hilite(15342)" onMouseOut="lolite()" onClick="logVariable('anonymised')" href="../../../_variables/anonymised.html">$anonymised</a> = <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('get_plan')" href="../../../_functions/get_plan.html" onMouseOver="funcPopup(event,'get_plan')">get_plan</a>()-&gt;<a class="function" onClick="logFunction('get_setting')" href="../../../_functions/get_setting.html" onMouseOver="funcPopup(event,'get_setting')">get_setting</a>('anonymize')-&gt;<a class="function" onClick="logFunction('get_value')" href="../../../_functions/get_value.html" onMouseOver="funcPopup(event,'get_value')">get_value</a>();
<a name="l383"><span class="linenum"> 383</span></a>              <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('get_plan')" href="../../../_functions/get_plan.html" onMouseOver="funcPopup(event,'get_plan')">get_plan</a>()-&gt;<a class="function" onClick="logFunction('get_setting')" href="../../../_functions/get_setting.html" onMouseOver="funcPopup(event,'get_setting')">get_setting</a>('filename')-&gt;<a class="function" onClick="logFunction('set_value')" href="../../../_functions/set_value.html" onMouseOver="funcPopup(event,'set_value')">set_value</a>(backup_plan_dbops::<a class="function" onClick="logFunction('get_default_backup_filename')" href="../../../_functions/get_default_backup_filename.html" onMouseOver="funcPopup(event,'get_default_backup_filename')">get_default_backup_filename</a>(<a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>,
<a name="l384"><span class="linenum"> 384</span></a>                      <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a>, <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../../_variables/users.html">$users</a>, <a class="var it15342" onMouseOver="hilite(15342)" onMouseOut="lolite()" onClick="logVariable('anonymised')" href="../../../_variables/anonymised.html">$anonymised</a>));
<a name="l385"><span class="linenum"> 385</span></a>  
<a name="l386"><span class="linenum"> 386</span></a>              <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(backup::STATUS_AWAITING);
<a name="l387"><span class="linenum"> 387</span></a>  
<a name="l388"><span class="linenum"> 388</span></a>              <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('execute_plan')" href="../../../_functions/execute_plan.html" onMouseOver="funcPopup(event,'execute_plan')">execute_plan</a>();
<a name="l389"><span class="linenum"> 389</span></a>              <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a> = <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>();
<a name="l390"><span class="linenum"> 390</span></a>              <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> = self::<a class="function" onClick="logFunction('outcome_from_results')" href="../../../_functions/outcome_from_results.html" onMouseOver="funcPopup(event,'outcome_from_results')">outcome_from_results</a>(<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>);
<a name="l391"><span class="linenum"> 391</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a> = <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>['backup_destination']; <span class="comment">// May be empty if file already moved to target location.</span>
<a name="l392"><span class="linenum"> 392</span></a>  
<a name="l393"><span class="linenum"> 393</span></a>  <span class="comment">            // If we need to copy the backup file to an external dir and it is not writable, change status to error.</span>
<a name="l394"><span class="linenum"> 394</span></a>  <span class="comment">            // This is a feature to prevent moodledata to be filled up and break a site when the admin misconfigured</span>
<a name="l395"><span class="linenum"> 395</span></a>  <span class="comment">            // the automated backups storage type and destination directory.</span>
<a name="l396"><span class="linenum"> 396</span></a>              if (<a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> !== 0 &amp;&amp; (empty(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>) || !<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>) || !<a class="phpfunction" onClick="logFunction('is_dir')" href="../../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>) || !<a class="phpfunction" onClick="logFunction('is_writable')" href="../../../_functions/is_writable.html" onMouseOver="phpfuncPopup(event,'is_writable')">is_writable</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>))) {
<a name="l397"><span class="linenum"> 397</span></a>                  <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="phpfunction" onClick="logFunction('log')" href="../../../_functions/log.html" onMouseOver="phpfuncPopup(event,'log')">log</a>('Specified backup directory is not writable - ', backup::LOG_ERROR, <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>);
<a name="l398"><span class="linenum"> 398</span></a>                  <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a> = null;
<a name="l399"><span class="linenum"> 399</span></a>                  <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> = self::BACKUP_STATUS_ERROR;
<a name="l400"><span class="linenum"> 400</span></a>              }
<a name="l401"><span class="linenum"> 401</span></a>  
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">            // Copy file only if there was no error.</span>
<a name="l403"><span class="linenum"> 403</span></a>              if (<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a> &amp;&amp; !empty(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>) &amp;&amp; <a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> !== 0 &amp;&amp; <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> != self::BACKUP_STATUS_ERROR) {
<a name="l404"><span class="linenum"> 404</span></a>                  <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../_variables/filename.html">$filename</a> = backup_plan_dbops::<a class="function" onClick="logFunction('get_default_backup_filename')" href="../../../_functions/get_default_backup_filename.html" onMouseOver="funcPopup(event,'get_default_backup_filename')">get_default_backup_filename</a>(<a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../../_variables/users.html">$users</a>, <a class="var it15342" onMouseOver="hilite(15342)" onMouseOut="lolite()" onClick="logVariable('anonymised')" href="../../../_variables/anonymised.html">$anonymised</a>,
<a name="l405"><span class="linenum"> 405</span></a>                          !<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_shortname')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_shortname.html">backup_shortname</a>);
<a name="l406"><span class="linenum"> 406</span></a>                  if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('copy_content_to')" href="../../../_functions/copy_content_to.html" onMouseOver="funcPopup(event,'copy_content_to')">copy_content_to</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>.'/'.<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../_variables/filename.html">$filename</a>)) {
<a name="l407"><span class="linenum"> 407</span></a>                      <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="phpfunction" onClick="logFunction('log')" href="../../../_functions/log.html" onMouseOver="phpfuncPopup(event,'log')">log</a>('Attempt to copy backup file to the specified directory failed - ',
<a name="l408"><span class="linenum"> 408</span></a>                              backup::LOG_ERROR, <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>);
<a name="l409"><span class="linenum"> 409</span></a>                      <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> = self::BACKUP_STATUS_ERROR;
<a name="l410"><span class="linenum"> 410</span></a>                  }
<a name="l411"><span class="linenum"> 411</span></a>                  if (<a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> != self::BACKUP_STATUS_ERROR &amp;&amp; <a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> === 1) {
<a name="l412"><span class="linenum"> 412</span></a>                      if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>()) {
<a name="l413"><span class="linenum"> 413</span></a>                          <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> = self::BACKUP_STATUS_WARNING;
<a name="l414"><span class="linenum"> 414</span></a>                          <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="phpfunction" onClick="logFunction('log')" href="../../../_functions/log.html" onMouseOver="phpfuncPopup(event,'log')">log</a>('Attempt to delete the backup file from course automated backup area failed - ',
<a name="l415"><span class="linenum"> 415</span></a>                                  backup::LOG_WARNING, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>());
<a name="l416"><span class="linenum"> 416</span></a>                      }
<a name="l417"><span class="linenum"> 417</span></a>                  }
<a name="l418"><span class="linenum"> 418</span></a>              }
<a name="l419"><span class="linenum"> 419</span></a>  
<a name="l420"><span class="linenum"> 420</span></a>          } catch (moodle_exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../../_variables/e.html">$e</a>) {
<a name="l421"><span class="linenum"> 421</span></a>              <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="phpfunction" onClick="logFunction('log')" href="../../../_functions/log.html" onMouseOver="phpfuncPopup(event,'log')">log</a>('backup_auto_failed_on_course', backup::LOG_ERROR, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/shortname.html">shortname</a>); <span class="comment">// Log error header.</span>
<a name="l422"><span class="linenum"> 422</span></a>              <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="phpfunction" onClick="logFunction('log')" href="../../../_functions/log.html" onMouseOver="phpfuncPopup(event,'log')">log</a>('Exception: ' . <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('errorcode')" class="var it42938" onMouseOver="hilite(42938)" onMouseOut="lolite()" href="../../../_variables/errorcode.html">errorcode</a>, backup::LOG_ERROR, <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('a')" class="var it42938" onMouseOver="hilite(42938)" onMouseOut="lolite()" href="../../../_variables/a.html">a</a>, 1); <span class="comment">// Log original exception problem.</span>
<a name="l423"><span class="linenum"> 423</span></a>              <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="phpfunction" onClick="logFunction('log')" href="../../../_functions/log.html" onMouseOver="phpfuncPopup(event,'log')">log</a>('Debug: ' . <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('debuginfo')" class="var it42938" onMouseOver="hilite(42938)" onMouseOut="lolite()" href="../../../_variables/debuginfo.html">debuginfo</a>, backup::LOG_DEBUG, null, 1); <span class="comment">// Log original debug information.</span>
<a name="l424"><span class="linenum"> 424</span></a>              <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> = self::BACKUP_STATUS_ERROR;
<a name="l425"><span class="linenum"> 425</span></a>          }
<a name="l426"><span class="linenum"> 426</span></a>  
<a name="l427"><span class="linenum"> 427</span></a>  <span class="comment">        // Delete the backup file immediately if something went wrong.</span>
<a name="l428"><span class="linenum"> 428</span></a>          if (<a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> === self::BACKUP_STATUS_ERROR) {
<a name="l429"><span class="linenum"> 429</span></a>  
<a name="l430"><span class="linenum"> 430</span></a>  <span class="comment">            // Delete the file from file area if exists.</span>
<a name="l431"><span class="linenum"> 431</span></a>              if (!empty(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>)) {
<a name="l432"><span class="linenum"> 432</span></a>                  <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l433"><span class="linenum"> 433</span></a>              }
<a name="l434"><span class="linenum"> 434</span></a>  
<a name="l435"><span class="linenum"> 435</span></a>  <span class="comment">            // Delete file from external storage if exists.</span>
<a name="l436"><span class="linenum"> 436</span></a>              if (<a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> !== 0 &amp;&amp; !empty(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../_variables/filename.html">$filename</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>.'/'.<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../_variables/filename.html">$filename</a>)) {
<a name="l437"><span class="linenum"> 437</span></a>                  @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>.'/'.<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../_variables/filename.html">$filename</a>);
<a name="l438"><span class="linenum"> 438</span></a>              }
<a name="l439"><span class="linenum"> 439</span></a>          }
<a name="l440"><span class="linenum"> 440</span></a>  
<a name="l441"><span class="linenum"> 441</span></a>          <a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>-&gt;<a class="function" onClick="logFunction('destroy')" href="../../../_functions/destroy.html" onMouseOver="funcPopup(event,'destroy')">destroy</a>();
<a name="l442"><span class="linenum"> 442</span></a>          unset(<a class="var it2075" onMouseOver="hilite(2075)" onMouseOut="lolite()" onClick="logVariable('bc')" href="../../../_variables/bc.html">$bc</a>);
<a name="l443"><span class="linenum"> 443</span></a>  
<a name="l444"><span class="linenum"> 444</span></a>          return <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a>;
<a name="l445"><span class="linenum"> 445</span></a>      }
<a name="l446"><span class="linenum"> 446</span></a>  
<a name="l447"><span class="linenum"> 447</span></a>      <span class="comment">/**</span>
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment">     * Returns the backup outcome by analysing its results.</span>
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment">     *</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment">     * @param array $results returned by a backup</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">     * @return int {@link self::BACKUP_STATUS_OK} and other constants</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">     */</span>
<a name="l453"><span class="linenum"> 453</span></a>      public static function <a class="function" onClick="logFunction('outcome_from_results')" href="../../../_functions/outcome_from_results.html" onMouseOver="funcPopup(event,'outcome_from_results')">outcome_from_results</a>(<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>) {
<a name="l454"><span class="linenum"> 454</span></a>          <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> = self::BACKUP_STATUS_OK;
<a name="l455"><span class="linenum"> 455</span></a>          foreach (<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a> as <a class="var it1960" onMouseOver="hilite(1960)" onMouseOut="lolite()" onClick="logVariable('code')" href="../../../_variables/code.html">$code</a> =&gt; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../../_variables/value.html">$value</a>) {
<a name="l456"><span class="linenum"> 456</span></a>  <span class="comment">            // Each possible error and warning code has to be specified in this switch</span>
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">            // which basically analyses the results to return the correct backup status.</span>
<a name="l458"><span class="linenum"> 458</span></a>              switch (<a class="var it1960" onMouseOver="hilite(1960)" onMouseOut="lolite()" onClick="logVariable('code')" href="../../../_variables/code.html">$code</a>) {
<a name="l459"><span class="linenum"> 459</span></a>                  case 'missing_files_in_pool':
<a name="l460"><span class="linenum"> 460</span></a>                      <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> = self::BACKUP_STATUS_WARNING;
<a name="l461"><span class="linenum"> 461</span></a>                      break;
<a name="l462"><span class="linenum"> 462</span></a>              }
<a name="l463"><span class="linenum"> 463</span></a>  <span class="comment">            // If we found the highest error level, we exit the loop.</span>
<a name="l464"><span class="linenum"> 464</span></a>              if (<a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a> == self::BACKUP_STATUS_ERROR) {
<a name="l465"><span class="linenum"> 465</span></a>                  break;
<a name="l466"><span class="linenum"> 466</span></a>              }
<a name="l467"><span class="linenum"> 467</span></a>          }
<a name="l468"><span class="linenum"> 468</span></a>          return <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../../_variables/outcome.html">$outcome</a>;
<a name="l469"><span class="linenum"> 469</span></a>      }
<a name="l470"><span class="linenum"> 470</span></a>  
<a name="l471"><span class="linenum"> 471</span></a>      <span class="comment">/**</span>
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment">     * Removes deleted courses fromn the backup_courses table so that we don't</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">     * waste time backing them up.</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment">     *</span>
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">     * @global moodle_database $DB</span>
<a name="l476"><span class="linenum"> 476</span></a>  <span class="comment">     * @return int</span>
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">     */</span>
<a name="l478"><span class="linenum"> 478</span></a>      public static function <a class="function" onClick="logFunction('remove_deleted_courses_from_schedule')" href="../../../_functions/remove_deleted_courses_from_schedule.html" onMouseOver="funcPopup(event,'remove_deleted_courses_from_schedule')">remove_deleted_courses_from_schedule</a>() {
<a name="l479"><span class="linenum"> 479</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l480"><span class="linenum"> 480</span></a>          <a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a> = 0;
<a name="l481"><span class="linenum"> 481</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT bc.courseid FROM {backup_courses} bc WHERE bc.courseid NOT IN (SELECT c.id FROM {course} c)&quot;;
<a name="l482"><span class="linenum"> 482</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>);
<a name="l483"><span class="linenum"> 483</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a> as <a class="var it28778" onMouseOver="hilite(28778)" onMouseOut="lolite()" onClick="logVariable('deletedcourse')" href="../../../_variables/deletedcourse.html">$deletedcourse</a>) {
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment">            //Doesn't exist, so delete from backup tables</span>
<a name="l485"><span class="linenum"> 485</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('backup_courses', array('courseid'=&gt;<a class="var it28778" onMouseOver="hilite(28778)" onMouseOut="lolite()" onClick="logVariable('deletedcourse')" href="../../../_variables/deletedcourse.html">$deletedcourse</a>-&gt;<a onClick="logVariable('courseid')" class="var it43603" onMouseOver="hilite(43603)" onMouseOut="lolite()" href="../../../_variables/courseid.html">courseid</a>));
<a name="l486"><span class="linenum"> 486</span></a>              <a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a>++;
<a name="l487"><span class="linenum"> 487</span></a>          }
<a name="l488"><span class="linenum"> 488</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l489"><span class="linenum"> 489</span></a>          return <a class="var it25087" onMouseOver="hilite(25087)" onMouseOut="lolite()" onClick="logVariable('skipped')" href="../../../_variables/skipped.html">$skipped</a>;
<a name="l490"><span class="linenum"> 490</span></a>      }
<a name="l491"><span class="linenum"> 491</span></a>  
<a name="l492"><span class="linenum"> 492</span></a>      <span class="comment">/**</span>
<a name="l493"><span class="linenum"> 493</span></a>  <span class="comment">     * Gets the state of the automated backup system.</span>
<a name="l494"><span class="linenum"> 494</span></a>  <span class="comment">     *</span>
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment">     * @global moodle_database $DB</span>
<a name="l496"><span class="linenum"> 496</span></a>  <span class="comment">     * @return int One of self::STATE_*</span>
<a name="l497"><span class="linenum"> 497</span></a>  <span class="comment">     */</span>
<a name="l498"><span class="linenum"> 498</span></a>      public static function <a class="function" onClick="logFunction('get_automated_backup_state')" href="../../../_functions/get_automated_backup_state.html" onMouseOver="funcPopup(event,'get_automated_backup_state')">get_automated_backup_state</a>(<a class="var it28754" onMouseOver="hilite(28754)" onMouseOut="lolite()" onClick="logVariable('rundirective')" href="../../../_variables/rundirective.html">$rundirective</a> = self::RUN_ON_SCHEDULE) {
<a name="l499"><span class="linenum"> 499</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l500"><span class="linenum"> 500</span></a>  
<a name="l501"><span class="linenum"> 501</span></a>          <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a> = <a class="function" onClick="logFunction('get_config')" href="../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup');
<a name="l502"><span class="linenum"> 502</span></a>          <a class="var it1343" onMouseOver="hilite(1343)" onMouseOut="lolite()" onClick="logVariable('active')" href="../../../_variables/active.html">$active</a> = (int)<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_active')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_active.html">backup_auto_active</a>;
<a name="l503"><span class="linenum"> 503</span></a>          <a class="var it8636" onMouseOver="hilite(8636)" onMouseOut="lolite()" onClick="logVariable('weekdays')" href="../../../_variables/weekdays.html">$weekdays</a> = (string)<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_weekdays')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_weekdays.html">backup_auto_weekdays</a>;
<a name="l504"><span class="linenum"> 504</span></a>  
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment">        // In case of automated backup also check that it is scheduled for at least one weekday.</span>
<a name="l506"><span class="linenum"> 506</span></a>          if (<a class="var it1343" onMouseOver="hilite(1343)" onMouseOut="lolite()" onClick="logVariable('active')" href="../../../_variables/active.html">$active</a> === self::AUTO_BACKUP_DISABLED ||
<a name="l507"><span class="linenum"> 507</span></a>                  (<a class="var it28754" onMouseOver="hilite(28754)" onMouseOut="lolite()" onClick="logVariable('rundirective')" href="../../../_variables/rundirective.html">$rundirective</a> == self::RUN_ON_SCHEDULE &amp;&amp; <a class="var it1343" onMouseOver="hilite(1343)" onMouseOut="lolite()" onClick="logVariable('active')" href="../../../_variables/active.html">$active</a> === self::AUTO_BACKUP_MANUAL) ||
<a name="l508"><span class="linenum"> 508</span></a>                  (<a class="var it28754" onMouseOver="hilite(28754)" onMouseOut="lolite()" onClick="logVariable('rundirective')" href="../../../_variables/rundirective.html">$rundirective</a> == self::RUN_ON_SCHEDULE &amp;&amp; <a class="phpfunction" onClick="logFunction('strpos')" href="../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it8636" onMouseOver="hilite(8636)" onMouseOut="lolite()" onClick="logVariable('weekdays')" href="../../../_variables/weekdays.html">$weekdays</a>, '1') === false)) {
<a name="l509"><span class="linenum"> 509</span></a>              return self::STATE_DISABLED;
<a name="l510"><span class="linenum"> 510</span></a>          } else if (!empty(<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_running')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_running.html">backup_auto_running</a>)) {
<a name="l511"><span class="linenum"> 511</span></a>  <span class="comment">            // Detect if the backup_auto_running semaphore is a valid one</span>
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment">            // by looking for recent activity in the backup_controllers table</span>
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment">            // for backups of type backup::MODE_AUTOMATED</span>
<a name="l514"><span class="linenum"> 514</span></a>              <a class="var it28781" onMouseOver="hilite(28781)" onMouseOut="lolite()" onClick="logVariable('timetosee')" href="../../../_variables/timetosee.html">$timetosee</a> = 60 * 90; <span class="comment">// Time to consider in order to clean the semaphore</span>
<a name="l515"><span class="linenum"> 515</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array( 'purpose'   =&gt; backup::MODE_AUTOMATED, 'timetolook' =&gt; (<a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it28781" onMouseOver="hilite(28781)" onMouseOut="lolite()" onClick="logVariable('timetosee')" href="../../../_variables/timetosee.html">$timetosee</a>));
<a name="l516"><span class="linenum"> 516</span></a>              if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_select')" href="../../../_functions/record_exists_select.html" onMouseOver="funcPopup(event,'record_exists_select')">record_exists_select</a>('backup_controllers',
<a name="l517"><span class="linenum"> 517</span></a>                  &quot;operation = 'backup' AND type = 'course' AND purpose = :purpose AND timemodified &gt; :timetolook&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>)) {
<a name="l518"><span class="linenum"> 518</span></a>                  return self::STATE_RUNNING; <span class="comment">// Recent activity found, still running</span>
<a name="l519"><span class="linenum"> 519</span></a>              } else {
<a name="l520"><span class="linenum"> 520</span></a>  <span class="comment">                // No recent activity found, let's clean the semaphore</span>
<a name="l521"><span class="linenum"> 521</span></a>                  <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Automated backups activity not found in last ' . (int)<a class="var it28781" onMouseOver="hilite(28781)" onMouseOut="lolite()" onClick="logVariable('timetosee')" href="../../../_variables/timetosee.html">$timetosee</a>/60 . ' minutes. Cleaning running status');
<a name="l522"><span class="linenum"> 522</span></a>                  backup_cron_automated_helper::<a class="function" onClick="logFunction('set_state_running')" href="../../../_functions/set_state_running.html" onMouseOver="funcPopup(event,'set_state_running')">set_state_running</a>(false);
<a name="l523"><span class="linenum"> 523</span></a>              }
<a name="l524"><span class="linenum"> 524</span></a>          }
<a name="l525"><span class="linenum"> 525</span></a>          return self::STATE_OK;
<a name="l526"><span class="linenum"> 526</span></a>      }
<a name="l527"><span class="linenum"> 527</span></a>  
<a name="l528"><span class="linenum"> 528</span></a>      <span class="comment">/**</span>
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment">     * Sets the state of the automated backup system.</span>
<a name="l530"><span class="linenum"> 530</span></a>  <span class="comment">     *</span>
<a name="l531"><span class="linenum"> 531</span></a>  <span class="comment">     * @param bool $running</span>
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment">     * @return bool</span>
<a name="l533"><span class="linenum"> 533</span></a>  <span class="comment">     */</span>
<a name="l534"><span class="linenum"> 534</span></a>      public static function <a class="function" onClick="logFunction('set_state_running')" href="../../../_functions/set_state_running.html" onMouseOver="funcPopup(event,'set_state_running')">set_state_running</a>(<a class="var it9507" onMouseOver="hilite(9507)" onMouseOut="lolite()" onClick="logVariable('running')" href="../../../_variables/running.html">$running</a> = true) {
<a name="l535"><span class="linenum"> 535</span></a>          if (<a class="var it9507" onMouseOver="hilite(9507)" onMouseOut="lolite()" onClick="logVariable('running')" href="../../../_variables/running.html">$running</a> === true) {
<a name="l536"><span class="linenum"> 536</span></a>              if (self::<a class="function" onClick="logFunction('get_automated_backup_state')" href="../../../_functions/get_automated_backup_state.html" onMouseOver="funcPopup(event,'get_automated_backup_state')">get_automated_backup_state</a>() === self::STATE_RUNNING) {
<a name="l537"><span class="linenum"> 537</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_helper_exception')" href="../../../_classes/backup_helper_exception.html" onMouseOver="classPopup(event,'backup_helper_exception')">backup_helper_exception</a>('backup_automated_already_running');
<a name="l538"><span class="linenum"> 538</span></a>              }
<a name="l539"><span class="linenum"> 539</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('backup_auto_running', '1', 'backup');
<a name="l540"><span class="linenum"> 540</span></a>          } else {
<a name="l541"><span class="linenum"> 541</span></a>              <a class="function" onClick="logFunction('unset_config')" href="../../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('backup_auto_running', 'backup');
<a name="l542"><span class="linenum"> 542</span></a>          }
<a name="l543"><span class="linenum"> 543</span></a>          return true;
<a name="l544"><span class="linenum"> 544</span></a>      }
<a name="l545"><span class="linenum"> 545</span></a>  
<a name="l546"><span class="linenum"> 546</span></a>      <span class="comment">/**</span>
<a name="l547"><span class="linenum"> 547</span></a>  <span class="comment">     * Removes excess backups from a specified course.</span>
<a name="l548"><span class="linenum"> 548</span></a>  <span class="comment">     *</span>
<a name="l549"><span class="linenum"> 549</span></a>  <span class="comment">     * @param stdClass $course Course object</span>
<a name="l550"><span class="linenum"> 550</span></a>  <span class="comment">     * @param int $now Starting time of the process</span>
<a name="l551"><span class="linenum"> 551</span></a>  <span class="comment">     * @return bool Whether or not backups is being removed</span>
<a name="l552"><span class="linenum"> 552</span></a>  <span class="comment">     */</span>
<a name="l553"><span class="linenum"> 553</span></a>      public static function <a class="function" onClick="logFunction('remove_excess_backups')" href="../../../_functions/remove_excess_backups.html" onMouseOver="funcPopup(event,'remove_excess_backups')">remove_excess_backups</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a> = null) {
<a name="l554"><span class="linenum"> 554</span></a>          <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a> = <a class="function" onClick="logFunction('get_config')" href="../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup');
<a name="l555"><span class="linenum"> 555</span></a>          <a class="var it28782" onMouseOver="hilite(28782)" onMouseOut="lolite()" onClick="logVariable('maxkept')" href="../../../_variables/maxkept.html">$maxkept</a> = (int)<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_max_kept')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_max_kept.html">backup_auto_max_kept</a>;
<a name="l556"><span class="linenum"> 556</span></a>          <a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> = <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_storage')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_storage.html">backup_auto_storage</a>;
<a name="l557"><span class="linenum"> 557</span></a>          <a class="var it28784" onMouseOver="hilite(28784)" onMouseOut="lolite()" onClick="logVariable('deletedays')" href="../../../_variables/deletedays.html">$deletedays</a> = (int)<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_delete_days')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_delete_days.html">backup_auto_delete_days</a>;
<a name="l558"><span class="linenum"> 558</span></a>  
<a name="l559"><span class="linenum"> 559</span></a>          if (<a class="var it28782" onMouseOver="hilite(28782)" onMouseOut="lolite()" onClick="logVariable('maxkept')" href="../../../_variables/maxkept.html">$maxkept</a> == 0 &amp;&amp; <a class="var it28784" onMouseOver="hilite(28784)" onMouseOut="lolite()" onClick="logVariable('deletedays')" href="../../../_variables/deletedays.html">$deletedays</a> == 0) {
<a name="l560"><span class="linenum"> 560</span></a>  <span class="comment">            // Means keep all backup files and never delete backup after x days.</span>
<a name="l561"><span class="linenum"> 561</span></a>              return true;
<a name="l562"><span class="linenum"> 562</span></a>          }
<a name="l563"><span class="linenum"> 563</span></a>  
<a name="l564"><span class="linenum"> 564</span></a>          if (!isset(<a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>)) {
<a name="l565"><span class="linenum"> 565</span></a>              <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l566"><span class="linenum"> 566</span></a>          }
<a name="l567"><span class="linenum"> 567</span></a>  
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment">        // Clean up excess backups in the course backup filearea.</span>
<a name="l569"><span class="linenum"> 569</span></a>          <a class="var it28786" onMouseOver="hilite(28786)" onMouseOut="lolite()" onClick="logVariable('deletedcoursebackups')" href="../../../_variables/deletedcoursebackups.html">$deletedcoursebackups</a> = false;
<a name="l570"><span class="linenum"> 570</span></a>          if (<a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> == self::STORAGE_COURSE || <a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> == self::STORAGE_COURSE_AND_DIRECTORY) {
<a name="l571"><span class="linenum"> 571</span></a>              <a class="var it28786" onMouseOver="hilite(28786)" onMouseOut="lolite()" onClick="logVariable('deletedcoursebackups')" href="../../../_variables/deletedcoursebackups.html">$deletedcoursebackups</a> = self::<a class="function" onClick="logFunction('remove_excess_backups_from_course')" href="../../../_functions/remove_excess_backups_from_course.html" onMouseOver="funcPopup(event,'remove_excess_backups_from_course')">remove_excess_backups_from_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>);
<a name="l572"><span class="linenum"> 572</span></a>          }
<a name="l573"><span class="linenum"> 573</span></a>  
<a name="l574"><span class="linenum"> 574</span></a>  <span class="comment">        // Clean up excess backups in the specified external directory.</span>
<a name="l575"><span class="linenum"> 575</span></a>          <a class="var it28787" onMouseOver="hilite(28787)" onMouseOut="lolite()" onClick="logVariable('deleteddirectorybackups')" href="../../../_variables/deleteddirectorybackups.html">$deleteddirectorybackups</a> = false;
<a name="l576"><span class="linenum"> 576</span></a>          if (<a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> == self::STORAGE_DIRECTORY || <a class="var it15659" onMouseOver="hilite(15659)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../../_variables/storage.html">$storage</a> == self::STORAGE_COURSE_AND_DIRECTORY) {
<a name="l577"><span class="linenum"> 577</span></a>              <a class="var it28787" onMouseOver="hilite(28787)" onMouseOut="lolite()" onClick="logVariable('deleteddirectorybackups')" href="../../../_variables/deleteddirectorybackups.html">$deleteddirectorybackups</a> = self::<a class="function" onClick="logFunction('remove_excess_backups_from_directory')" href="../../../_functions/remove_excess_backups_from_directory.html" onMouseOver="funcPopup(event,'remove_excess_backups_from_directory')">remove_excess_backups_from_directory</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>);
<a name="l578"><span class="linenum"> 578</span></a>          }
<a name="l579"><span class="linenum"> 579</span></a>  
<a name="l580"><span class="linenum"> 580</span></a>          if (<a class="var it28786" onMouseOver="hilite(28786)" onMouseOut="lolite()" onClick="logVariable('deletedcoursebackups')" href="../../../_variables/deletedcoursebackups.html">$deletedcoursebackups</a> || <a class="var it28787" onMouseOver="hilite(28787)" onMouseOut="lolite()" onClick="logVariable('deleteddirectorybackups')" href="../../../_variables/deleteddirectorybackups.html">$deleteddirectorybackups</a>) {
<a name="l581"><span class="linenum"> 581</span></a>              return true;
<a name="l582"><span class="linenum"> 582</span></a>          } else {
<a name="l583"><span class="linenum"> 583</span></a>              return false;
<a name="l584"><span class="linenum"> 584</span></a>          }
<a name="l585"><span class="linenum"> 585</span></a>      }
<a name="l586"><span class="linenum"> 586</span></a>  
<a name="l587"><span class="linenum"> 587</span></a>      <span class="comment">/**</span>
<a name="l588"><span class="linenum"> 588</span></a>  <span class="comment">     * Removes excess backups in the course backup filearea from a specified course.</span>
<a name="l589"><span class="linenum"> 589</span></a>  <span class="comment">     *</span>
<a name="l590"><span class="linenum"> 590</span></a>  <span class="comment">     * @param stdClass $course Course object</span>
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment">     * @param int $now Starting time of the process</span>
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">     * @return bool Whether or not backups are being removed</span>
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment">     */</span>
<a name="l594"><span class="linenum"> 594</span></a>      protected static function <a class="function" onClick="logFunction('remove_excess_backups_from_course')" href="../../../_functions/remove_excess_backups_from_course.html" onMouseOver="funcPopup(event,'remove_excess_backups_from_course')">remove_excess_backups_from_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>) {
<a name="l595"><span class="linenum"> 595</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l596"><span class="linenum"> 596</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l597"><span class="linenum"> 597</span></a>          <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a> = 'backup';
<a name="l598"><span class="linenum"> 598</span></a>          <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a> = 'automated';
<a name="l599"><span class="linenum"> 599</span></a>          <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a> = 0;
<a name="l600"><span class="linenum"> 600</span></a>          <a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a> = array();
<a name="l601"><span class="linenum"> 601</span></a>          <a class="var it28788" onMouseOver="hilite(28788)" onMouseOut="lolite()" onClick="logVariable('backupfilesarea')" href="../../../_variables/backupfilesarea.html">$backupfilesarea</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../_variables/itemid.html">$itemid</a>, 'timemodified DESC', false);
<a name="l602"><span class="linenum"> 602</span></a>  <span class="comment">        // Store all the matching files into timemodified =&gt; stored_file array.</span>
<a name="l603"><span class="linenum"> 603</span></a>          foreach (<a class="var it28788" onMouseOver="hilite(28788)" onMouseOut="lolite()" onClick="logVariable('backupfilesarea')" href="../../../_variables/backupfilesarea.html">$backupfilesarea</a> as <a class="var it5246" onMouseOver="hilite(5246)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../../_variables/backupfile.html">$backupfile</a>) {
<a name="l604"><span class="linenum"> 604</span></a>              <a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a>[<a class="var it5246" onMouseOver="hilite(5246)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../../_variables/backupfile.html">$backupfile</a>-&gt;<a class="function" onClick="logFunction('get_timemodified')" href="../../../_functions/get_timemodified.html" onMouseOver="funcPopup(event,'get_timemodified')">get_timemodified</a>()] = <a class="var it5246" onMouseOver="hilite(5246)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../../_variables/backupfile.html">$backupfile</a>;
<a name="l605"><span class="linenum"> 605</span></a>          }
<a name="l606"><span class="linenum"> 606</span></a>  
<a name="l607"><span class="linenum"> 607</span></a>          <a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a> = self::<a class="function" onClick="logFunction('get_backups_to_delete')" href="../../../_functions/get_backups_to_delete.html" onMouseOver="funcPopup(event,'get_backups_to_delete')">get_backups_to_delete</a>(<a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>);
<a name="l608"><span class="linenum"> 608</span></a>          if (<a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a>) {
<a name="l609"><span class="linenum"> 609</span></a>              foreach (<a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a> as <a class="var it28790" onMouseOver="hilite(28790)" onMouseOut="lolite()" onClick="logVariable('backuptodelete')" href="../../../_variables/backuptodelete.html">$backuptodelete</a>) {
<a name="l610"><span class="linenum"> 610</span></a>                  <a class="var it28790" onMouseOver="hilite(28790)" onMouseOut="lolite()" onClick="logVariable('backuptodelete')" href="../../../_variables/backuptodelete.html">$backuptodelete</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l611"><span class="linenum"> 611</span></a>              }
<a name="l612"><span class="linenum"> 612</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Deleted ' . <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a>) . ' old backup <a class="phpfunction" onClick="logFunction('file')" href="../../../_functions/file.html" onMouseOver="phpfuncPopup(event,'file')">file</a>(s) from the automated filearea');
<a name="l613"><span class="linenum"> 613</span></a>              return true;
<a name="l614"><span class="linenum"> 614</span></a>          } else {
<a name="l615"><span class="linenum"> 615</span></a>              return false;
<a name="l616"><span class="linenum"> 616</span></a>          }
<a name="l617"><span class="linenum"> 617</span></a>      }
<a name="l618"><span class="linenum"> 618</span></a>  
<a name="l619"><span class="linenum"> 619</span></a>      <span class="comment">/**</span>
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment">     * Removes excess backups in the specified external directory from a specified course.</span>
<a name="l621"><span class="linenum"> 621</span></a>  <span class="comment">     *</span>
<a name="l622"><span class="linenum"> 622</span></a>  <span class="comment">     * @param stdClass $course Course object</span>
<a name="l623"><span class="linenum"> 623</span></a>  <span class="comment">     * @param int $now Starting time of the process</span>
<a name="l624"><span class="linenum"> 624</span></a>  <span class="comment">     * @return bool Whether or not backups are being removed</span>
<a name="l625"><span class="linenum"> 625</span></a>  <span class="comment">     */</span>
<a name="l626"><span class="linenum"> 626</span></a>      protected static function <a class="function" onClick="logFunction('remove_excess_backups_from_directory')" href="../../../_functions/remove_excess_backups_from_directory.html" onMouseOver="funcPopup(event,'remove_excess_backups_from_directory')">remove_excess_backups_from_directory</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>) {
<a name="l627"><span class="linenum"> 627</span></a>          <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a> = <a class="function" onClick="logFunction('get_config')" href="../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup');
<a name="l628"><span class="linenum"> 628</span></a>          <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a> = <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_destination')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_destination.html">backup_auto_destination</a>;
<a name="l629"><span class="linenum"> 629</span></a>  
<a name="l630"><span class="linenum"> 630</span></a>          <a class="var it28791" onMouseOver="hilite(28791)" onMouseOut="lolite()" onClick="logVariable('isnotvaliddir')" href="../../../_variables/isnotvaliddir.html">$isnotvaliddir</a> = !<a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>) || !<a class="phpfunction" onClick="logFunction('is_dir')" href="../../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>) || !<a class="phpfunction" onClick="logFunction('is_writable')" href="../../../_functions/is_writable.html" onMouseOver="phpfuncPopup(event,'is_writable')">is_writable</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>);
<a name="l631"><span class="linenum"> 631</span></a>          if (<a class="var it28791" onMouseOver="hilite(28791)" onMouseOut="lolite()" onClick="logVariable('isnotvaliddir')" href="../../../_variables/isnotvaliddir.html">$isnotvaliddir</a>) {
<a name="l632"><span class="linenum"> 632</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Error: ' . <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a> . ' does not appear to be a valid directory');
<a name="l633"><span class="linenum"> 633</span></a>              return false;
<a name="l634"><span class="linenum"> 634</span></a>          }
<a name="l635"><span class="linenum"> 635</span></a>  
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">        // Calculate backup filename regex, ignoring the date/time/info parts that can be</span>
<a name="l637"><span class="linenum"> 637</span></a>  <span class="comment">        // variable, depending of languages, formats and automated backup settings.</span>
<a name="l638"><span class="linenum"> 638</span></a>          <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../_variables/filename.html">$filename</a> = backup::<a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../../../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a> . '-' . backup::TYPE_1COURSE . '-' . <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> . '-';
<a name="l639"><span class="linenum"> 639</span></a>          <a class="var it160" onMouseOver="hilite(160)" onMouseOut="lolite()" onClick="logVariable('regex')" href="../../../_variables/regex.html">$regex</a> = '#' . <a class="phpfunction" onClick="logFunction('preg_quote')" href="../../../_functions/preg_quote.html" onMouseOver="phpfuncPopup(event,'preg_quote')">preg_quote</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../_variables/filename.html">$filename</a>, '#') . '.*\.mbz$#';
<a name="l640"><span class="linenum"> 640</span></a>  
<a name="l641"><span class="linenum"> 641</span></a>  <span class="comment">        // Store all the matching files into filename =&gt; timemodified array.</span>
<a name="l642"><span class="linenum"> 642</span></a>          <a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a> = array();
<a name="l643"><span class="linenum"> 643</span></a>          foreach (<a class="phpfunction" onClick="logFunction('scandir')" href="../../../_functions/scandir.html" onMouseOver="phpfuncPopup(event,'scandir')">scandir</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a>) as <a class="var it5246" onMouseOver="hilite(5246)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../../_variables/backupfile.html">$backupfile</a>) {
<a name="l644"><span class="linenum"> 644</span></a>  <span class="comment">            // Skip files not matching the naming convention.</span>
<a name="l645"><span class="linenum"> 645</span></a>              if (!<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(<a class="var it160" onMouseOver="hilite(160)" onMouseOut="lolite()" onClick="logVariable('regex')" href="../../../_variables/regex.html">$regex</a>, <a class="var it5246" onMouseOver="hilite(5246)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../../_variables/backupfile.html">$backupfile</a>)) {
<a name="l646"><span class="linenum"> 646</span></a>                  continue;
<a name="l647"><span class="linenum"> 647</span></a>              }
<a name="l648"><span class="linenum"> 648</span></a>  
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment">            // Read the information contained in the backup itself.</span>
<a name="l650"><span class="linenum"> 650</span></a>              try {
<a name="l651"><span class="linenum"> 651</span></a>                  <a class="var it26288" onMouseOver="hilite(26288)" onMouseOut="lolite()" onClick="logVariable('bcinfo')" href="../../../_variables/bcinfo.html">$bcinfo</a> = backup_general_helper::<a class="function" onClick="logFunction('get_backup_information_from_mbz')" href="../../../_functions/get_backup_information_from_mbz.html" onMouseOver="funcPopup(event,'get_backup_information_from_mbz')">get_backup_information_from_mbz</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a> . '/' . <a class="var it5246" onMouseOver="hilite(5246)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../../_variables/backupfile.html">$backupfile</a>);
<a name="l652"><span class="linenum"> 652</span></a>              } catch (backup_helper_exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../../_variables/e.html">$e</a>) {
<a name="l653"><span class="linenum"> 653</span></a>                  <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Error: ' . <a class="var it5246" onMouseOver="hilite(5246)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../../_variables/backupfile.html">$backupfile</a> . ' does not appear to be a valid backup (' . <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('errorcode')" class="var it42938" onMouseOver="hilite(42938)" onMouseOut="lolite()" href="../../../_variables/errorcode.html">errorcode</a> . ')');
<a name="l654"><span class="linenum"> 654</span></a>                  continue;
<a name="l655"><span class="linenum"> 655</span></a>              }
<a name="l656"><span class="linenum"> 656</span></a>  
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment">            // Make sure this backup concerns the course and site we are looking for.</span>
<a name="l658"><span class="linenum"> 658</span></a>              if (<a class="var it26288" onMouseOver="hilite(26288)" onMouseOut="lolite()" onClick="logVariable('bcinfo')" href="../../../_variables/bcinfo.html">$bcinfo</a>-&gt;<a onClick="logVariable('format')" class="var it43604" onMouseOver="hilite(43604)" onMouseOut="lolite()" href="../../../_variables/format.html">format</a> === backup::<a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../../../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a> &amp;&amp;
<a name="l659"><span class="linenum"> 659</span></a>                      <a class="var it26288" onMouseOver="hilite(26288)" onMouseOut="lolite()" onClick="logVariable('bcinfo')" href="../../../_variables/bcinfo.html">$bcinfo</a>-&gt;<a onClick="logVariable('type')" class="var it43604" onMouseOver="hilite(43604)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a> === backup::TYPE_1COURSE &amp;&amp;
<a name="l660"><span class="linenum"> 660</span></a>                      <a class="var it26288" onMouseOver="hilite(26288)" onMouseOut="lolite()" onClick="logVariable('bcinfo')" href="../../../_variables/bcinfo.html">$bcinfo</a>-&gt;<a onClick="logVariable('original_course_id')" class="var it43604" onMouseOver="hilite(43604)" onMouseOut="lolite()" href="../../../_variables/original_course_id.html">original_course_id</a> == <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> &amp;&amp;
<a name="l661"><span class="linenum"> 661</span></a>                      backup_general_helper::<a class="function" onClick="logFunction('backup_is_samesite')" href="../../../_functions/backup_is_samesite.html" onMouseOver="funcPopup(event,'backup_is_samesite')">backup_is_samesite</a>(<a class="var it26288" onMouseOver="hilite(26288)" onMouseOut="lolite()" onClick="logVariable('bcinfo')" href="../../../_variables/bcinfo.html">$bcinfo</a>)) {
<a name="l662"><span class="linenum"> 662</span></a>                  <a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a>[<a class="var it26288" onMouseOver="hilite(26288)" onMouseOut="lolite()" onClick="logVariable('bcinfo')" href="../../../_variables/bcinfo.html">$bcinfo</a>-&gt;<a onClick="logVariable('backup_date')" class="var it43604" onMouseOver="hilite(43604)" onMouseOut="lolite()" href="../../../_variables/backup_date.html">backup_date</a>] = <a class="var it5246" onMouseOver="hilite(5246)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../../_variables/backupfile.html">$backupfile</a>;
<a name="l663"><span class="linenum"> 663</span></a>              }
<a name="l664"><span class="linenum"> 664</span></a>          }
<a name="l665"><span class="linenum"> 665</span></a>  
<a name="l666"><span class="linenum"> 666</span></a>          <a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a> = self::<a class="function" onClick="logFunction('get_backups_to_delete')" href="../../../_functions/get_backups_to_delete.html" onMouseOver="funcPopup(event,'get_backups_to_delete')">get_backups_to_delete</a>(<a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>);
<a name="l667"><span class="linenum"> 667</span></a>          if (<a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a>) {
<a name="l668"><span class="linenum"> 668</span></a>              foreach (<a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a> as <a class="var it28790" onMouseOver="hilite(28790)" onMouseOut="lolite()" onClick="logVariable('backuptodelete')" href="../../../_variables/backuptodelete.html">$backuptodelete</a>) {
<a name="l669"><span class="linenum"> 669</span></a>                  <a class="phpfunction" onClick="logFunction('unlink')" href="../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../_variables/dir.html">$dir</a> . '/' . <a class="var it28790" onMouseOver="hilite(28790)" onMouseOut="lolite()" onClick="logVariable('backuptodelete')" href="../../../_variables/backuptodelete.html">$backuptodelete</a>);
<a name="l670"><span class="linenum"> 670</span></a>              }
<a name="l671"><span class="linenum"> 671</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Deleted ' . <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a>) . ' old backup <a class="phpfunction" onClick="logFunction('file')" href="../../../_functions/file.html" onMouseOver="phpfuncPopup(event,'file')">file</a>(s) from external directory');
<a name="l672"><span class="linenum"> 672</span></a>              return true;
<a name="l673"><span class="linenum"> 673</span></a>          } else {
<a name="l674"><span class="linenum"> 674</span></a>              return false;
<a name="l675"><span class="linenum"> 675</span></a>          }
<a name="l676"><span class="linenum"> 676</span></a>      }
<a name="l677"><span class="linenum"> 677</span></a>  
<a name="l678"><span class="linenum"> 678</span></a>      <span class="comment">/**</span>
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment">     * Get the list of backup files to delete depending on the automated backup settings.</span>
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment">     *</span>
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment">     * @param array $backupfiles Existing backup files</span>
<a name="l682"><span class="linenum"> 682</span></a>  <span class="comment">     * @param int $now Starting time of the process</span>
<a name="l683"><span class="linenum"> 683</span></a>  <span class="comment">     * @return array Backup files to delete</span>
<a name="l684"><span class="linenum"> 684</span></a>  <span class="comment">     */</span>
<a name="l685"><span class="linenum"> 685</span></a>      protected static function <a class="function" onClick="logFunction('get_backups_to_delete')" href="../../../_functions/get_backups_to_delete.html" onMouseOver="funcPopup(event,'get_backups_to_delete')">get_backups_to_delete</a>(<a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a>) {
<a name="l686"><span class="linenum"> 686</span></a>          <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a> = <a class="function" onClick="logFunction('get_config')" href="../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup');
<a name="l687"><span class="linenum"> 687</span></a>          <a class="var it28782" onMouseOver="hilite(28782)" onMouseOut="lolite()" onClick="logVariable('maxkept')" href="../../../_variables/maxkept.html">$maxkept</a> = (int)<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_max_kept')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_max_kept.html">backup_auto_max_kept</a>;
<a name="l688"><span class="linenum"> 688</span></a>          <a class="var it28784" onMouseOver="hilite(28784)" onMouseOut="lolite()" onClick="logVariable('deletedays')" href="../../../_variables/deletedays.html">$deletedays</a> = (int)<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_delete_days')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_delete_days.html">backup_auto_delete_days</a>;
<a name="l689"><span class="linenum"> 689</span></a>          <a class="var it28792" onMouseOver="hilite(28792)" onMouseOut="lolite()" onClick="logVariable('minkept')" href="../../../_variables/minkept.html">$minkept</a> = (int)<a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('backup_auto_min_kept')" class="var it42981" onMouseOver="hilite(42981)" onMouseOut="lolite()" href="../../../_variables/backup_auto_min_kept.html">backup_auto_min_kept</a>;
<a name="l690"><span class="linenum"> 690</span></a>  
<a name="l691"><span class="linenum"> 691</span></a>  <span class="comment">        // Sort by keys descending (newer to older filemodified).</span>
<a name="l692"><span class="linenum"> 692</span></a>          <a class="phpfunction" onClick="logFunction('krsort')" href="../../../_functions/krsort.html" onMouseOver="phpfuncPopup(event,'krsort')">krsort</a>(<a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a>);
<a name="l693"><span class="linenum"> 693</span></a>          <a class="var it8300" onMouseOver="hilite(8300)" onMouseOut="lolite()" onClick="logVariable('tokeep')" href="../../../_variables/tokeep.html">$tokeep</a> = <a class="var it28782" onMouseOver="hilite(28782)" onMouseOut="lolite()" onClick="logVariable('maxkept')" href="../../../_variables/maxkept.html">$maxkept</a>;
<a name="l694"><span class="linenum"> 694</span></a>          if (<a class="var it28784" onMouseOver="hilite(28784)" onMouseOut="lolite()" onClick="logVariable('deletedays')" href="../../../_variables/deletedays.html">$deletedays</a> &gt; 0) {
<a name="l695"><span class="linenum"> 695</span></a>              <a class="var it28794" onMouseOver="hilite(28794)" onMouseOut="lolite()" onClick="logVariable('deletedayssecs')" href="../../../_variables/deletedayssecs.html">$deletedayssecs</a> = <a class="var it28784" onMouseOver="hilite(28784)" onMouseOut="lolite()" onClick="logVariable('deletedays')" href="../../../_variables/deletedays.html">$deletedays</a> * <a class="constant" onClick="logConstant('DAYSECS')" href="../../../_constants/DAYSECS.html" onMouseOver="constPopup(event,'DAYSECS')">DAYSECS</a>;
<a name="l696"><span class="linenum"> 696</span></a>              <a class="var it8300" onMouseOver="hilite(8300)" onMouseOut="lolite()" onClick="logVariable('tokeep')" href="../../../_variables/tokeep.html">$tokeep</a> = 0;
<a name="l697"><span class="linenum"> 697</span></a>              <a class="var it28795" onMouseOver="hilite(28795)" onMouseOut="lolite()" onClick="logVariable('backupfileskeys')" href="../../../_variables/backupfileskeys.html">$backupfileskeys</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a>);
<a name="l698"><span class="linenum"> 698</span></a>              foreach (<a class="var it28795" onMouseOver="hilite(28795)" onMouseOut="lolite()" onClick="logVariable('backupfileskeys')" href="../../../_variables/backupfileskeys.html">$backupfileskeys</a> as <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('timemodified')" href="../../../_variables/timemodified.html">$timemodified</a>) {
<a name="l699"><span class="linenum"> 699</span></a>                  <a class="var it28796" onMouseOver="hilite(28796)" onMouseOut="lolite()" onClick="logVariable('mustdeletebackup')" href="../../../_variables/mustdeletebackup.html">$mustdeletebackup</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('timemodified')" href="../../../_variables/timemodified.html">$timemodified</a> &lt; (<a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../_variables/now.html">$now</a> - <a class="var it28794" onMouseOver="hilite(28794)" onMouseOut="lolite()" onClick="logVariable('deletedayssecs')" href="../../../_variables/deletedayssecs.html">$deletedayssecs</a>);
<a name="l700"><span class="linenum"> 700</span></a>                  if (<a class="var it28796" onMouseOver="hilite(28796)" onMouseOut="lolite()" onClick="logVariable('mustdeletebackup')" href="../../../_variables/mustdeletebackup.html">$mustdeletebackup</a> || <a class="var it8300" onMouseOver="hilite(8300)" onMouseOut="lolite()" onClick="logVariable('tokeep')" href="../../../_variables/tokeep.html">$tokeep</a> &gt;= <a class="var it28782" onMouseOver="hilite(28782)" onMouseOut="lolite()" onClick="logVariable('maxkept')" href="../../../_variables/maxkept.html">$maxkept</a>) {
<a name="l701"><span class="linenum"> 701</span></a>                      break;
<a name="l702"><span class="linenum"> 702</span></a>                  }
<a name="l703"><span class="linenum"> 703</span></a>                  <a class="var it8300" onMouseOver="hilite(8300)" onMouseOut="lolite()" onClick="logVariable('tokeep')" href="../../../_variables/tokeep.html">$tokeep</a>++;
<a name="l704"><span class="linenum"> 704</span></a>              }
<a name="l705"><span class="linenum"> 705</span></a>  
<a name="l706"><span class="linenum"> 706</span></a>              if (<a class="var it8300" onMouseOver="hilite(8300)" onMouseOut="lolite()" onClick="logVariable('tokeep')" href="../../../_variables/tokeep.html">$tokeep</a> &lt; <a class="var it28792" onMouseOver="hilite(28792)" onMouseOut="lolite()" onClick="logVariable('minkept')" href="../../../_variables/minkept.html">$minkept</a>) {
<a name="l707"><span class="linenum"> 707</span></a>                  <a class="var it8300" onMouseOver="hilite(8300)" onMouseOut="lolite()" onClick="logVariable('tokeep')" href="../../../_variables/tokeep.html">$tokeep</a> = <a class="var it28792" onMouseOver="hilite(28792)" onMouseOut="lolite()" onClick="logVariable('minkept')" href="../../../_variables/minkept.html">$minkept</a>;
<a name="l708"><span class="linenum"> 708</span></a>              }
<a name="l709"><span class="linenum"> 709</span></a>          }
<a name="l710"><span class="linenum"> 710</span></a>  
<a name="l711"><span class="linenum"> 711</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a>) &lt;= <a class="var it8300" onMouseOver="hilite(8300)" onMouseOut="lolite()" onClick="logVariable('tokeep')" href="../../../_variables/tokeep.html">$tokeep</a>) {
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment">            // There are less or equal matching files than the desired number to keep, there is nothing to clean up.</span>
<a name="l713"><span class="linenum"> 713</span></a>              return false;
<a name="l714"><span class="linenum"> 714</span></a>          } else {
<a name="l715"><span class="linenum"> 715</span></a>              <a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a> = <a class="phpfunction" onClick="logFunction('array_splice')" href="../../../_functions/array_splice.html" onMouseOver="phpfuncPopup(event,'array_splice')">array_splice</a>(<a class="var it3029" onMouseOver="hilite(3029)" onMouseOut="lolite()" onClick="logVariable('backupfiles')" href="../../../_variables/backupfiles.html">$backupfiles</a>, <a class="var it8300" onMouseOver="hilite(8300)" onMouseOut="lolite()" onClick="logVariable('tokeep')" href="../../../_variables/tokeep.html">$tokeep</a>);
<a name="l716"><span class="linenum"> 716</span></a>              return <a class="var it28789" onMouseOver="hilite(28789)" onMouseOut="lolite()" onClick="logVariable('backupstodelete')" href="../../../_variables/backupstodelete.html">$backupstodelete</a>;
<a name="l717"><span class="linenum"> 717</span></a>          }
<a name="l718"><span class="linenum"> 718</span></a>      }
<a name="l719"><span class="linenum"> 719</span></a>  
<a name="l720"><span class="linenum"> 720</span></a>      <span class="comment">/**</span>
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment">     * Check logs to find out if a course was modified since the given time.</span>
<a name="l722"><span class="linenum"> 722</span></a>  <span class="comment">     *</span>
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment">     * @param int $courseid course id to check</span>
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment">     * @param int $since timestamp, from which to check</span>
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment">     *</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment">     * @return bool true if the course was modified, false otherwise. This also returns false if no readers are enabled. This is</span>
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment">     * intentional, since we cannot reliably determine if any modification was made or not.</span>
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment">     */</span>
<a name="l729"><span class="linenum"> 729</span></a>      protected static function <a class="function" onClick="logFunction('is_course_modified')" href="../../../_functions/is_course_modified.html" onMouseOver="funcPopup(event,'is_course_modified')">is_course_modified</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it9468" onMouseOver="hilite(9468)" onMouseOut="lolite()" onClick="logVariable('since')" href="../../../_variables/since.html">$since</a>) {
<a name="l730"><span class="linenum"> 730</span></a>          <a class="var it24681" onMouseOver="hilite(24681)" onMouseOut="lolite()" onClick="logVariable('logmang')" href="../../../_variables/logmang.html">$logmang</a> = <a class="function" onClick="logFunction('get_log_manager')" href="../../../_functions/get_log_manager.html" onMouseOver="funcPopup(event,'get_log_manager')">get_log_manager</a>();
<a name="l731"><span class="linenum"> 731</span></a>          <a class="var it3556" onMouseOver="hilite(3556)" onMouseOut="lolite()" onClick="logVariable('readers')" href="../../../_variables/readers.html">$readers</a> = <a class="var it24681" onMouseOver="hilite(24681)" onMouseOut="lolite()" onClick="logVariable('logmang')" href="../../../_variables/logmang.html">$logmang</a>-&gt;<a class="function" onClick="logFunction('get_readers')" href="../../../_functions/get_readers.html" onMouseOver="funcPopup(event,'get_readers')">get_readers</a>('core\log\sql_reader');
<a name="l732"><span class="linenum"> 732</span></a>          <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../../_variables/where.html">$where</a> = &quot;courseid = :courseid and timecreated &gt; :since and crud &lt;&gt; 'r'&quot;;
<a name="l733"><span class="linenum"> 733</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, 'since' =&gt; <a class="var it9468" onMouseOver="hilite(9468)" onMouseOut="lolite()" onClick="logVariable('since')" href="../../../_variables/since.html">$since</a>);
<a name="l734"><span class="linenum"> 734</span></a>          foreach (<a class="var it3556" onMouseOver="hilite(3556)" onMouseOut="lolite()" onClick="logVariable('readers')" href="../../../_variables/readers.html">$readers</a> as <a class="var it3557" onMouseOver="hilite(3557)" onMouseOut="lolite()" onClick="logVariable('reader')" href="../../../_variables/reader.html">$reader</a>) {
<a name="l735"><span class="linenum"> 735</span></a>              if (<a class="var it3557" onMouseOver="hilite(3557)" onMouseOut="lolite()" onClick="logVariable('reader')" href="../../../_variables/reader.html">$reader</a>-&gt;<a class="function" onClick="logFunction('get_events_select_count')" href="../../../_functions/get_events_select_count.html" onMouseOver="funcPopup(event,'get_events_select_count')">get_events_select_count</a>(<a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../../_variables/where.html">$where</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>)) {
<a name="l736"><span class="linenum"> 736</span></a>                  return true;
<a name="l737"><span class="linenum"> 737</span></a>              }
<a name="l738"><span class="linenum"> 738</span></a>          }
<a name="l739"><span class="linenum"> 739</span></a>          return false;
<a name="l740"><span class="linenum"> 740</span></a>      }
<a name="l741"><span class="linenum"> 741</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_setting': ['get_setting', '', [['mod/quiz/classes','admin_review_setting.php',135],['backup/moodle2','restore_activity_task.class.php',206],['lib/editor/tinymce','adminlib.php',41],['lib/editor/atto','adminlib.php',117],['backup/util/ui','base_ui.class.php',316],['lib','adminlib.php',2051],['lib','adminlib.php',2126],['lib','adminlib.php',2636],['lib','adminlib.php',2758],['lib','adminlib.php',2875],['lib','adminlib.php',2990],['lib','adminlib.php',3103],['lib','adminlib.php',3246],['lib','adminlib.php',3401],['lib','adminlib.php',3639],['lib','adminlib.php',3713],['lib','adminlib.php',3746],['lib','adminlib.php',3870],['lib','adminlib.php',3950],['lib','adminlib.php',3994],['lib','adminlib.php',4075],['lib','adminlib.php',4145],['lib','adminlib.php',4578],['lib','adminlib.php',5219],['lib','adminlib.php',5560],['lib','adminlib.php',6107],['lib','adminlib.php',6336],['lib','adminlib.php',6516],['lib','adminlib.php',6696],['lib','adminlib.php',6790],['lib','adminlib.php',6939],['lib','adminlib.php',7721],['lib','adminlib.php',8031],['lib','adminlib.php',8155],['lib','adminlib.php',8339],['lib','adminlib.php',8625],['lib','adminlib.php',8772],['lib','adminlib.php',8931],['lib','adminlib.php',9108],['lib','adminlib.php',9248],['lib','adminlib.php',9491],['lib','adminlib.php',9634],['backup/moodle2','backup_section_task.class.php',112],['backup/util/settings','setting_dependency.class.php',131],['backup/moodle2','restore_section_task.class.php',102],['admin/tool/log/classes','setting_managestores.php',38],['backup/util/plan','base_plan.class.php',111],['enrol/ldap','settingslib.php',102],['backup/cc/cc_lib','cc_asssesment.php',208],['backup/moodle2','backup_activity_task.class.php',227],['backup/util/plan','base_step.class.php',84],['backup/util/plan','base_task.class.php',81]], 76],
'destroy': ['destroy', 'Destroys a variable in the context. ', [['lib/htmlpurifier/HTMLPurifier','Context.php',57],['backup/util/settings','base_setting.class.php',125],['backup/converter','convertlib.php',255],['lib/adodb','adodb-xmlschema.inc.php',156],['lib/adodb','adodb-xmlschema.inc.php',2190],['backup/util/ui','backup_ui_setting.class.php',78],['backup/util/ui','base_ui.class.php',97],['backup/util/structure','base_final_element.class.php',53],['backup/util/plan','backup_plan.class.php',51],['backup/util/settings','setting_dependency.class.php',81],['backup/util/loggers','base_logger.class.php',74],['lib/adodb','adodb-xmlschema03.inc.php',174],['lib/adodb','adodb-xmlschema03.inc.php',2372],['backup/util/plan','base_plan.class.php',192],['backup/util/plan','restore_plan.class.php',62],['backup/controller','backup_controller.class.php',146],['backup/util/structure','base_nested_element.class.php',62],['repository/flickr_public','image.php',65],['backup/util/plan','base_step.class.php',60],['backup/util/ui','restore_ui_stage.class.php',208],['backup/controller','restore_controller.class.php',158],['backup/util/plan','base_task.class.php',199]], 504],
'format': ['format', 'Format the args for use in exception messages ', [['lib/lessphp/Tree/Mixin','Call.php',153],['question/format/xml','format.php',1535],['mod/wiki/diff','diff_nwiki.php',713]], 161],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',6144]], 546],
'get_events_select_count': ['get_events_select_count', '', [['admin/tool/log/store/standard/classes/log','store.php',139],['admin/tool/log/store/legacy/classes/log','store.php',157],['admin/tool/log/store/database/classes/log','store.php',241],['lib/classes/log','sql_reader.php',54]], 6],
'get_backup_status_array': ['get_backup_status_array', 'Gets the results from the last automated backup that was run based upon the statuses of the courses that were looked at. ', [['backup/util/helper','backup_cron_helper.class.php',291]], 1],
'remove_deleted_courses_from_schedule': ['remove_deleted_courses_from_schedule', 'Removes deleted courses fromn the backup_courses table so that we don\'t waste time backing them up. ', [['backup/util/helper','backup_cron_helper.class.php',471]], 1],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'is_course_modified': ['is_course_modified', 'Check logs to find out if a course was modified since the given time. ', [['backup/util/helper','backup_cron_helper.class.php',720]], 2],
'run_automated_backup': ['run_automated_backup', 'Runs the automated backups if required ', [['backup/util/helper','backup_cron_helper.class.php',71]], 2],
'settimezone': ['settimezone', '', [['lib/google/src/Google/Service','AdSense.php',2182],['lib/google/src/Google/Service','Analytics.php',8096],['lib/google/src/Google/Service','ShoppingContent.php',3941],['lib/google/src/Google/Service','IdentityToolkit.php',1704],['lib/phpunit/classes','advanced_testcase.php',557],['lib/google/src/Google/Service','Calendar.php',2140],['lib/google/src/Google/Service','Calendar.php',2368],['lib/google/src/Google/Service','Calendar.php',3204],['lib/google/src/Google/Service','Calendar.php',3548],['lib/google/src/Google/Service','Calendar.php',3677],['lib/phpexcel/PHPExcel/Shared','TimeZone.php',61]], 94],
'raise_memory_limit': ['raise_memory_limit', 'Function to raise the memory limit to a new value. Will respect the memory limit if it is higher, thus allowing settings in php.ini, apache conf or command line switches to override it. ', [['lib','setuplib.php',1206]], 59],
'backup_is_samesite': ['backup_is_samesite', 'Given the information fetched from moodle_backup.xml file decide if we are restoring in the same site the backup was generated or no. Behavior of various parts of restore are dependent of this. ', [['backup/util/helper','backup_general_helper.class.php',281]], 3],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'get_server_timezone_object': ['get_server_timezone_object', 'Returns server timezone. ', [['lib/classes','date.php',180]], 5],
'get_id': ['get_id', 'Getter for $id. ', [['lib/classes/task','adhoc_task.php',51],['backup/converter','convertlib.php',100],['lib/filebrowser','virtual_root_file.php',290],['lib','adminlib.php',1719],['admin/tool/uploadcourse/classes','course.php',335],['lib/simplepie/library/SimplePie','Item.php',199],['lib/filestorage','stored_file.php',786],['cache/classes','definition.php',613],['grade/grading/form','lib.php',854],['question/engine','questionusage.php',120],['mod/lti/classes/local/ltiservice','service_base.php',76],['blocks/rss_client/classes/output','item.php',152],['backup/controller','backup_controller.class.php',263],['question/engine','questionattemptstep.php',136],['mod/lti/classes/local/ltiservice','resource_base.php',81]], 2250],
'get_backup_information_from_mbz': ['get_backup_information_from_mbz', 'Load and format all the needed information from a backup file. ', [['backup/util/helper','backup_general_helper.class.php',244]], 2],
'mtrace': ['mtrace', 'Outputs the given message via {@link mtrace()}. ', [['lib/classes','plugin_manager.php',1376],['lib','moodlelib.php',8509]], 406],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1379]], 880],
'get_format': ['get_format', 'Returns the format name used by this course ', [['course/format','lib.php',213],['backup/util/ui','base_ui.class.php',287],['question/format/xml','format.php',1028],['backup/controller','backup_controller.class.php',271],['mod/workshop','locallib.php',4044],['backup/controller','restore_controller.class.php',273]], 47],
'get_log_manager': ['get_log_manager', 'Get instance of log manager. ', [['lib','datalib.php',1520]], 51],
'get_filename': ['get_filename', 'Returns file name ', [['lib/filebrowser','virtual_root_file.php',227],['lib/filestorage','stored_file.php',699],['lib','medialib.php',169]], 248],
'calculate_next_automated_backup': ['calculate_next_automated_backup', 'Works out the next time the automated backup should be run. ', [['backup/util/helper','backup_cron_helper.class.php',322]], 40],
'add': ['add', 'Add HashTable item ', [['lib/phpexcel/PHPExcel','HashTable.php',78],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',95],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',109],['lib/google/src/Google/Http','Batch.php',52],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',37],['lib','csslib.php',1508],['lib/horde/framework/Horde/Mail/Rfc822','List.php',116],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',33],['lib/horde/framework/Horde/Support','ConsistentHash.php',148],['lib/horde/framework/Horde','Variables.php',297],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',29],['lib','outputcomponents.php',2705],['lib','outputcomponents.php',3380],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',436],['lib','adminlib.php',735],['lib','adminlib.php',894],['lib','adminlib.php',1446],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',27],['lib/xhprof/xhprof_html/jquery','jquery-1.2.6.js',3450],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',80],['lib/google/src/Google/Service','Webmasters.php',436],['lib','navigationlib.php',304],['lib','navigationlib.php',761],['lib','navigationlib.php',3305],['lib','navigationlib.php',3583],['lib/horde/framework/Horde/Imap/Client','Ids.php',155],['backup/cc/cc_lib/gral_lib','cssparser.php',121],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',428],['lib/horde/framework/Horde','Stream.php',116],['comment','lib.php',679],['lib/mustache/src/Mustache','HelperCollection.php',56],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',207],['backup/cc/cc_lib','cc_utils.php',395],['backup/cc/cc_lib','cc_utils.php',454],['lib/lessphp/Output','Mapped.php',50],['lib','licenselib.php',32],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',50],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',74],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',14],['lib/horde/framework/Horde/Mail/Rfc822','GroupList.php',25],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',31],['tag/classes','tag.php',152],['blog','locallib.php',242],['lib/classes','notification.php',50],['lib/lessphp','Output.php',18],['tag/classes/output','tagfeed.php',61],['backup/cc','validator.php',51],['lib/horde/framework/Horde/Stream','TempString.php',118],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',11]], 6188],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'execute_plan': ['execute_plan', 'Executes the backup ', [['backup/controller','backup_controller.class.php',306],['backup/controller','restore_controller.class.php',321]], 38],
'remove_excess_backups_from_directory': ['remove_excess_backups_from_directory', 'Removes excess backups in the specified external directory from a specified course. ', [['backup/util/helper','backup_cron_helper.class.php',619]], 1],
'gettimestamp': ['gettimestamp', '', [['lib/google/src/Google/Service','AdExchangeBuyer.php',5523],['lib/google/src/Google/Service','Coordinate.php',1087],['lib/google/src/Google/Service','ShoppingContent.php',8264],['lib/google/src/Google/Service','Webmasters.php',887],['lib/tcpdf/include','tcpdf_static.php',373],['lib/google/src/Google/Service','Spectrum.php',873],['lib/google/src/Google/Service','Spectrum.php',1080],['lib/google/src/Google/Service','Mirror.php',1218]], 44],
'get_area_files': ['get_area_files', 'Returns all area files (optionally limited by itemid) ', [['lib/filestorage','file_storage.php',782],['lib','externallib.php',1134]], 216],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'get_type': ['get_type', 'Get the type of the feed ', [['lib/simplepie/library','SimplePie.php',1624],['lib/simplepie/library/SimplePie','Restriction.php',122],['backup/util/ui','backup_ui_setting.class.php',102],['backup/util/ui','base_ui.class.php',294],['mod/lesson','locallib.php',2394],['lib/simplepie/library/SimplePie','Enclosure.php',877],['lib/classes','chart_series.php',127],['grade/report/singleview/classes/local/ui','bulk_insert.php',62],['lib/simplepie/library/SimplePie/Content/Type','Sniffer.php',79],['backup/util/plan','backup_plan.class.php',70],['availability/classes','condition.php',102],['mod/assign','assignmentplugin.php',153],['backup/controller','backup_controller.class.php',244],['lib/classes','chart_base.php',150],['mod/workshop','locallib.php',3936],['mod/lti/classes/local/ltiservice','resource_base.php',114],['lib/simplepie/library/SimplePie','Caption.php',193],['backup/controller','restore_controller.class.php',261]], 90],
'get_value': ['get_value', 'Read value ', [['lib/simplepie/library/SimplePie/XML/Declaration','Parser.php',172],['lib/simplepie/library/SimplePie','Rating.php',113],['grade/report/singleview/classes/local/ui','unique_value.php',37],['lib','csslib.php',2292],['backup/util/settings','base_setting.class.php',149],['lib/bennu','iCalendar_properties.php',105],['lib/simplepie/library/SimplePie','Restriction.php',139],['backup/util/ui','backup_ui_setting.class.php',118],['lib/behat/form_field','behat_form_checkbox.php',78],['lib/behat/form_field','behat_form_radio.php',52],['grade/report/singleview/classes/local/ui','finalgrade.php',42],['backup/util/structure','base_atom.class.php',75],['lib/behat/form_field','behat_form_filemanager.php',57],['lib/behat/form_field','behat_form_field.php',85],['lib/behat/form_field','behat_form_select.php',98],['backup/util/structure','base_nested_element.class.php',193],['grade/report/singleview/classes/local/ui','feedback.php',41],['lib/behat/form_field','behat_form_text.php',50]], 168],
'get_automated_backup_state': ['get_automated_backup_state', 'Gets the state of the automated backup system. ', [['backup/util/helper','backup_cron_helper.class.php',492]], 2],
'get_results': ['get_results', 'Returns the results ', [['backup/util/structure','backup_nested_element.class.php',182],['backup/util/plan','base_plan.class.php',98],['backup/util/ui','restore_ui_components.php',130],['backup/controller','backup_controller.class.php',325],['backup/controller','restore_controller.class.php',388],['backup/util/plan','base_task.class.php',241]], 21],
'unset_config': ['unset_config', 'Removes a key from global configuration. ', [['lib','moodlelib.php',1504]], 77],
'launch_automated_backup': ['launch_automated_backup', 'Launches a automated backup routine for the given course ', [['backup/util/helper','backup_cron_helper.class.php',357]], 1],
'remove_excess_backups_from_course': ['remove_excess_backups_from_course', 'Removes excess backups in the course backup filearea from a specified course. ', [['backup/util/helper','backup_cron_helper.class.php',587]], 1],
'get_timemodified': ['get_timemodified', 'Returns time modified unix timestamp if known ', [['lib/filebrowser','file_info.php',295],['lib/filebrowser','virtual_root_file.php',272],['lib/filebrowser','file_info_stored.php',258],['lib/filestorage','stored_file.php',756]], 63],
'get_backups_to_delete': ['get_backups_to_delete', 'Get the list of backup files to delete depending on the automated backup settings. ', [['backup/util/helper','backup_cron_helper.class.php',678]], 3],
'cron_trace_time_and_memory': ['cron_trace_time_and_memory', 'Output some standard information during cron runs. Specifically current time and memory usage. This method also does gc_collect_cycles() (before displaying memory usage) to try to help PHP manage memory better. ', [['lib','cronlib.php',161]], 16],
'message_send': ['message_send', 'Called when a message provider wants to send a message. This functions checks the message recipient\'s message processor configuration then sends the message to the configured processors ', [['lib','messagelib.php',29]], 94],
'set_state_running': ['set_state_running', 'Sets the state of the automated backup system. ', [['backup/util/helper','backup_cron_helper.class.php',528]], 3],
'set_value': ['set_value', 'Sets the value for the style ', [['lib','csslib.php',2253],['backup/util/settings','base_setting.class.php',161],['backup/moodle2','backup_custom_fields.php',41],['backup/moodle2','backup_custom_fields.php',66],['backup/moodle2','backup_custom_fields.php',90],['lib/bennu','iCalendar_properties.php',87],['lib/bennu','iCalendar_properties.php',429],['lib/bennu','iCalendar_properties.php',1369],['backup/util/ui','backup_ui_setting.class.php',549],['lib/behat/form_field','behat_form_checkbox.php',40],['lib/behat/form_field','behat_form_radio.php',65],['lib/behat/form_field','behat_form_availability.php',40],['lib/behat/form_field','behat_form_editor.php',43],['backup/util/structure','base_atom.class.php',79],['lib/behat/form_field','behat_form_filemanager.php',92],['backup/cc/cc_lib','cc_metadata_file.php',35],['lib/behat/form_field','behat_form_field.php',71],['lib/behat/form_field','behat_form_select.php',40],['backup/cc/cc_lib','cc_metadata_resource.php',37],['backup/util/structure','base_nested_element.class.php',197],['lib/behat/form_field','behat_form_autocomplete.php',40],['lib/behat/form_field','behat_form_text.php',40],['backup/util/structure/tests/fixtures','structure_fixtures.php',84],['backup/util/structure/tests/fixtures','structure_fixtures.php',93],['backup/util/structure/tests/fixtures','structure_fixtures.php',102]], 93],
'record_exists_select': ['record_exists_select', 'Check if a records exists. ', [['competency/classes','persistent.php',853],['lib/dml','moodle_database.php',1830]], 85],
'delete': ['delete', 'Deletes an item from the cache store. ', [['cache/stores/static','lib.php',374],['cache','disabledlib.php',102],['lib/google/src/Google/Service','AdSense.php',1258],['lib/google/src/Google/Service','AdSense.php',1730],['lib/grade','grade_item.php',396],['lib/google/src/Google/Service','Replicapool.php',378],['lib/google/src/Google/Service','Tasks.php',310],['lib/google/src/Google/Service','Tasks.php',428],['lib/google/src/Google/Service','AndroidPublisher.php',1230],['lib/google/src/Google/Service','AndroidPublisher.php',1310],['lib/google/src/Google/Service','AndroidPublisher.php',1668],['lib/google/src/Google/Service','AndroidPublisher.php',1763],['lib/google/src/Google/Service','AndroidPublisher.php',2083],['lib/google/src/Google/Service','YouTubeReporting.php',255],['lib/google/src/Google/Service','Reseller.php',441],['lib/google/src/Google/Cache','Memcache.php',144],['lib','filelib.php',3481],['lib/google/src/Google/Service','Computeaccounts.php',418],['lib/google/src/Google/Service','Computeaccounts.php',497],['lib/google/src/Google/Service','Computeaccounts.php',668],['lib/grade','grade_category.php',281],['lib/grade','grade_scale.php',136],['lib/adodb','adodb-active-record.inc.php',901],['lib/grade','grade_object.php',270],['lib/google/src/Google/Service','YouTubeAnalytics.php',352],['lib/google/src/Google/Service','YouTubeAnalytics.php',447],['lib/google/src/Google/Service','MapsEngine.php',1693],['lib/google/src/Google/Service','MapsEngine.php',1991],['lib/google/src/Google/Service','MapsEngine.php',2344],['lib/google/src/Google/Service','MapsEngine.php',2651],['lib/google/src/Google/Service','MapsEngine.php',2912],['completion','data_object.php',273],['lib/google/src/Google/Cache','File.php',115],['cache/classes','dummystore.php',198],['lib/google/src/Google/Service','Dns.php',378],['cache/classes','loaders.php',792],['cache/classes','loaders.php',1471],['cache/classes','loaders.php',1841],['lib/google/src/Google/Service','Appengine.php',352],['lib/google/src/Google/Service','Appengine.php',455],['tag/classes','collection.php',260],['lib/filebrowser','file_info.php',418],['lib/google/src/Google/Service','AdExchangeBuyer.php',938],['lib/google/src/Google/Service','AdExchangeBuyer.php',1137],['lib/google/src/Google/Service','AdExchangeBuyer.php',1561],['lib/filebrowser','virtual_root_file.php',69],['lib/google/src/Google/Service','Books.php',1946],['lib/grade','grade_grade.php',1024],['lib/grade','grade_outcome.php',97],['lib/google/src/Google/Service','Analytics.php',2165],['lib/google/src/Google/Service','Analytics.php',2534],['lib/google/src/Google/Service','Analytics.php',2655],['lib/google/src/Google/Service','Analytics.php',2872],['lib/google/src/Google/Service','Analytics.php',3001],['lib/google/src/Google/Service','Analytics.php',3092],['lib/google/src/Google/Service','Analytics.php',3406],['lib/google/src/Google/Service','Analytics.php',3631],['lib/google/src/Google/Service','DeploymentManager.php',452],['lib/google/src/Google/Service','Blogger.php',1065],['lib/google/src/Google/Service','Blogger.php',1227],['lib/google/src/Google/Service','Blogger.php',1451],['lib/filebrowser','file_info_stored.php',631],['competency/classes','persistent.php',510],['lib/google/src/Google/Service','CloudUserAccounts.php',528],['lib/google/src/Google/Service','CloudUserAccounts.php',628],['lib/google/src/Google/Service','CloudUserAccounts.php',893],['lib/google/src/Google/Service','Cloudresourcemanager.php',390],['lib/htmlpurifier/HTMLPurifier','Zipper.php',89],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',960],['lib/google/src/Google/Service','TagManager.php',1022],['lib/google/src/Google/Service','TagManager.php',1113],['lib/google/src/Google/Service','TagManager.php',1265],['lib/google/src/Google/Service','TagManager.php',1358],['lib/google/src/Google/Service','TagManager.php',1452],['lib/google/src/Google/Service','TagManager.php',1546],['lib/google/src/Google/Service','TagManager.php',1696],['mod/lesson','locallib.php',1037],['mod/lesson','locallib.php',2271],['repository','lib.php',427],['repository','lib.php',1962],['admin/tool/uploadcourse/classes','course.php',226],['lib','badgeslib.php',640],['lib/google/src/Google/Service','Bigquery.php',531],['lib/google/src/Google/Service','Bigquery.php',863],['lib/google/src/Google/Service','ShoppingContent.php',1050],['lib/google/src/Google/Service','ShoppingContent.php',1448],['lib/google/src/Google/Service','ShoppingContent.php',1970],['lib/google/src/Google/Service','Webmasters.php',355],['lib/google/src/Google/Service','Webmasters.php',449],['lib/google/src/Google/Service','Clouddebugger.php',384],['lib/filestorage','stored_file.php',323],['lib/google/src/Google/Service','Container.php',309],['lib/google/src/Google/Service','Storage.php',1042],['lib/google/src/Google/Service','Storage.php',1157],['lib/google/src/Google/Service','Storage.php',1332],['lib/google/src/Google/Service','Storage.php',1454],['lib/google/src/Google/Service','Storage.php',1681],['cache/stores/memcache','lib.php',401],['lib/google/src/Google/Service','Genomics.php',646],['lib/google/src/Google/Service','Genomics.php',735],['lib/google/src/Google/Service','Genomics.php',903],['lib/google/src/Google/Service','Genomics.php',971],['lib/google/src/Google/Service','Genomics.php',1326],['lib/google/src/Google/Service','Genomics.php',1443],['lib/google/src/Google/Service','Licensing.php',224],['lib/google/src/Google/Service','Fitness.php',400],['lib/google/src/Google/Service','Fitness.php',512],['lib/google/src/Google/Service','Fitness.php',647],['comment','lib.php',790],['lib/google/src/Google/Service','Gmail.php',763],['lib/google/src/Google/Service','Gmail.php',921],['lib/google/src/Google/Service','Gmail.php',1014],['lib/google/src/Google/Service','Gmail.php',1234],['lib/google/src/Google/Service','Taskqueue.php',293],['lib/adodb','adodb-active-recordx.inc.php',1016],['lib','accesslib.php',5580],['cache/classes','interfaces.php',161],['lib/google/src/Google/Service','Autoscaler.php',315],['lib/google/src/Google/Service','Autoscaler.php',429],['lib/google/src/Google/Service','Prediction.php',262],['lib/google/src/Google/Service','SiteVerification.php',139],['lib/google/src/Google/Service','Drive.php',1522],['lib/google/src/Google/Service','Drive.php',1603],['lib/google/src/Google/Service','Drive.php',1748],['lib/google/src/Google/Service','Drive.php',2040],['lib/google/src/Google/Service','Drive.php',2110],['lib/google/src/Google/Service','Drive.php',2240],['lib/google/src/Google/Service','Drive.php',2403],['lib/google/src/Google/Service','Drive.php',2523],['lib/google/src/Google/Service','Proximitybeacon.php',522],['lib/google/src/Google/Service','Directory.php',1683],['lib/google/src/Google/Service','Directory.php',1916],['lib/google/src/Google/Service','Directory.php',1989],['lib/google/src/Google/Service','Directory.php',2059],['lib/google/src/Google/Service','Directory.php',2169],['lib/google/src/Google/Service','Directory.php',2224],['lib/google/src/Google/Service','Directory.php',2351],['lib/google/src/Google/Service','Directory.php',2420],['lib/google/src/Google/Service','Directory.php',2517],['lib/google/src/Google/Service','Directory.php',2652],['lib/google/src/Google/Service','Directory.php',2731],['lib/google/src/Google/Service','Directory.php',2836],['lib/google/src/Google/Service','Directory.php',2938],['lib/google/src/Google/Service','Directory.php',2999],['lib/google/src/Google/Service','Directory.php',3199],['lib/google/src/Google/Service','Directory.php',3274],['lib/google/src/Google/Service','Fusiontables.php',645],['lib/google/src/Google/Service','Fusiontables.php',812],['lib/google/src/Google/Service','Fusiontables.php',937],['lib/google/src/Google/Service','Fusiontables.php',1126],['lib/google/src/Google/Service','Fusiontables.php',1188],['lib/google/src/Google/Service','AdSenseHost.php',734],['lib/google/src/Google/Service','AdSenseHost.php',1010],['lib/google/src/Google/Service','AdSenseHost.php',1168],['lib/google/src/Google/Service','Mirror.php',425],['lib/google/src/Google/Service','Mirror.php',593],['lib/google/src/Google/Service','Mirror.php',661],['lib/google/src/Google/Service','Mirror.php',772],['tag/classes','area.php',187],['lib/google/src/Google/Service','AndroidEnterprise.php',988],['lib/google/src/Google/Service','AndroidEnterprise.php',1092],['lib/google/src/Google/Service','AndroidEnterprise.php',1280],['lib/google/src/Google/Service','AndroidEnterprise.php',1415],['lib/google/src/Google/Service','AndroidEnterprise.php',1597],['course','lib.php',3263],['mnet','peer.php',118],['search/tests/fixtures','mock_search_engine.php',48],['lib/google/src/Google/Service','Calendar.php',903],['lib/google/src/Google/Service','Calendar.php',1071],['lib/google/src/Google/Service','Calendar.php',1269],['lib/google/src/Google/Service','Calendar.php',1412],['cache/stores/session','lib.php',417],['blog','locallib.php',322],['lib/google/src/Google/Service','Storagetransfer.php',381],['cache/stores/mongodb','lib.php',361],['lib/google/src/Google/Cache','Null.php',53],['lib/google/src/Google/Service','GamesConfiguration.php',251],['lib/google/src/Google/Service','GamesConfiguration.php',390],['cache/stores/file','lib.php',393],['badges/criteria','award_criteria.php',330],['cache/stores/memcached','lib.php',402],['lib/google/src/Google/Service','AppState.php',154],['lib/google/src/Google/Service','Resourceviews.php',423],['lib/portfolio','plugin.php',692],['calendar','lib.php',2423],['lib/google/src/Google/Service','Classroom.php',466],['lib/google/src/Google/Service','Classroom.php',615],['lib/google/src/Google/Service','Classroom.php',701],['lib/google/src/Google/Service','Classroom.php',806],['lib/google/src/Google/Service','Classroom.php',934],['lib/google/src/Google/Service','SQLAdmin.php',786],['lib/google/src/Google/Service','SQLAdmin.php',856],['lib/google/src/Google/Service','SQLAdmin.php',1023],['lib/google/src/Google/Service','SQLAdmin.php',1368],['lib/google/src/Google/Service','SQLAdmin.php',1483],['badges/criteria','award_criteria_manual.php',220],['search/engine/solr/classes','engine.php',1045],['lib/google/src/Google/Service','Compute.php',4021],['lib/google/src/Google/Service','Compute.php',4149],['lib/google/src/Google/Service','Compute.php',4284],['lib/google/src/Google/Service','Compute.php',4571],['lib/google/src/Google/Service','Compute.php',4671],['lib/google/src/Google/Service','Compute.php',4829],['lib/google/src/Google/Service','Compute.php',4942],['lib/google/src/Google/Service','Compute.php',5033],['lib/google/src/Google/Service','Compute.php',5174],['lib/google/src/Google/Service','Compute.php',5248],['lib/google/src/Google/Service','Compute.php',5378],['lib/google/src/Google/Service','Compute.php',5508],['lib/google/src/Google/Service','Compute.php',5683],['lib/google/src/Google/Service','Compute.php',5984],['lib/google/src/Google/Service','Compute.php',6156],['lib/google/src/Google/Service','Compute.php',6316],['lib/google/src/Google/Service','Compute.php',6717],['lib/google/src/Google/Service','Compute.php',6898],['lib/google/src/Google/Service','Compute.php',7037],['lib/google/src/Google/Service','Compute.php',7128],['lib/google/src/Google/Service','Compute.php',7208],['lib/google/src/Google/Service','Compute.php',7299],['lib/google/src/Google/Service','Compute.php',7409],['lib/google/src/Google/Service','Compute.php',7570],['lib/google/src/Google/Service','Compute.php',7734],['lib/google/src/Google/Service','Compute.php',7938],['lib/google/src/Google/Service','Compute.php',8035],['lib/google/src/Google/Service','Compute.php',8210],['lib/google/src/Google/Service','Compute.php',8305],['lib/google/src/Google/Service','Pubsub.php',240],['lib/google/src/Google/Service','Pubsub.php',379],['lib/google/src/Google/Service','YouTube.php',1810],['lib/google/src/Google/Service','YouTube.php',2061],['lib/google/src/Google/Service','YouTube.php',2459],['lib/google/src/Google/Service','YouTube.php',2889],['lib/google/src/Google/Service','YouTube.php',3187],['lib/google/src/Google/Service','YouTube.php',3419],['lib/google/src/Google/Service','YouTube.php',3559],['lib/google/src/Google/Service','YouTube.php',3928],['lib/google/src/Google/Service','YouTube.php',4158],['lib/google/src/Google/Cache','Apc.php',105],['lib/google/src/Google/Service','Dfareporting.php',5000],['lib/google/src/Google/Service','Dfareporting.php',5566],['lib/google/src/Google/Service','Dfareporting.php',5753],['lib/google/src/Google/Service','Dfareporting.php',5877],['lib/google/src/Google/Service','Dfareporting.php',6397],['lib/google/src/Google/Service','Dfareporting.php',6578],['lib/google/src/Google/Service','Dfareporting.php',6731],['lib/google/src/Google/Service','Dfareporting.php',6996],['lib/google/src/Google/Service','Dfareporting.php',7503],['lib/google/src/Google/Service','Dfareporting.php',8102],['lib/google/src/Google/Service','Dfareporting.php',8768],['lib/google/src/Google/Service','Manager.php',244],['lib/google/src/Google/Service','Manager.php',324],['lib/google/src/Google/Service','CloudMonitoring.php',274],['lib','webdavlib.php',691]], 317],
'outcome_from_results': ['outcome_from_results', 'Returns the backup outcome by analysing its results. ', [['backup/util/helper','backup_cron_helper.class.php',447]], 1],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'get_plan': ['get_plan', '', [['backup/controller','backup_controller.class.php',302],['backup/controller','restore_controller.class.php',309]], 50],
'settime': ['settime', '', [['lib/google/src/Google/Service','Cloudlatencytest.php',244],['lib/google/src/Google/Service','Dataflow.php',1166],['lib/google/src/Google/Service','Audit.php',400],['lib/google/src/Google/Service','Reports.php',732],['lib/google/src/Google/Service','Logging.php',94],['lib/google/src/Google/Service','PlusDomains.php',3041],['lib/google/src/Google/Service','Dfareporting.php',15904]], 19],
'raise': ['raise', 'Sets the PHP time limit to a number of seconds from now. ', [['lib/classes','php_time_limit.php',41]], 90],
'copy_content_to': ['copy_content_to', 'Copy content of file to given pathname ', [['lib/filebrowser','virtual_root_file.php',115],['lib/filestorage','stored_file.php',466]], 13],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'set_config': ['set_config', 'Set a key in global configuration ', [['lib','moodlelib.php',1336],['lib','enrollib.php',1153],['lib/editor/tinymce/classes','plugin.php',84],['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515]], 1119],
'set_status': ['set_status', '', [['backup/util/settings','base_setting.class.php',201],['lib','badgeslib.php',315],['mod/workshop/allocation','lib.php',113],['backup/controller','backup_controller.class.php',178],['backup/controller','restore_controller.class.php',190]], 137],
'get_readers': ['get_readers', '', [['lib/classes/log','dummy_manager.php',31],['report/loglive/classes','renderable.php',126],['report/log/classes','renderable.php',166],['admin/tool/log/classes/log','manager.php',93],['lib/classes/log','manager.php',38]], 33],
'get_site': ['get_site', 'Returns $course object of the top-level site. ', [['lib','datalib.php',547]], 77],
'get_default_backup_filename': ['get_default_backup_filename', 'Returns the default backup filename, based in passed params. ', [['backup/util/dbops','backup_plan_dbops.class.php',185]], 7],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as an moodle_recordset.  $sql must be a complete SQL query. Since this method is a little less readable, use of it should be restricted to code where it\'s possible there might be large datasets being returned.  For known small datasets use get_records_sql - it leads to simpler code. ', [['lib/dml','pdo_moodle_database.php',252],['lib/dml','oci_native_moodle_database.php',1106],['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','mssql_native_moodle_database.php',736],['lib/dml','mysqli_native_moodle_database.php',993],['lib/dml','sqlsrv_native_moodle_database.php',811],['lib/dml/tests','dml_test.php',5544]], 283],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'remove_excess_backups': ['remove_excess_backups', 'Removes excess backups from a specified course. ', [['backup/util/helper','backup_cron_helper.class.php',546]], 1],
'get_recordset': ['get_recordset', 'Get the recordset. ', [['mod/glossary/classes','entry_query_builder.php',305],['lib/dml','moodle_database.php',1162]], 92],
'get_admin': ['get_admin', 'Returns $user object of the main admin user ', [['lib','datalib.php',53]], 61],
'log': ['log', '', [], 2031],
'is_writable': ['is_writable', '', [], 68],
'date': ['date', '', [], 693],
'array_splice': ['array_splice', '', [], 52],
'array_sum': ['array_sum', '', [], 30],
'unlink': ['unlink', '', [], 256],
'is_dir': ['is_dir', '', [], 211],
'scandir': ['scandir', '', [], 13],
'preg_quote': ['preg_quote', '', [], 205],
'krsort': ['krsort', '', [], 14],
'time': ['time', '', [], 1959],
'preg_match': ['preg_match', '', [], 1286],
'count': ['count', '', [], 4095],
'file_exists': ['file_exists', '', [], 867],
'strtoupper': ['strtoupper', '', [], 565],
'file': ['file', '', [], 92],
'defined': ['defined', '', [], 4731],
'strpos': ['strpos', '', [], 1604],
'array_keys': ['array_keys', '', [], 1256],
'substr': ['substr', '', [], 2823]};
CLASS_DATA={
'backup_controller': ['backup_controller', 'Class implementing the controller of any backup process ', [['backup/controller','backup_controller.class.php',25]], 31],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323],
'backup_helper_exception': ['backup_helper_exception', '', [['backup/util/helper','backup_helper.class.php',379]], 14],
'core_php_time_limit': ['core_php_time_limit', 'Utility class to manage PHP time limit. ', [['lib/classes','php_time_limit.php',27]], 92],
'core_date': ['core_date', 'Core date and time related code. ', [['lib/classes','date.php',26]], 192]};
CONST_DATA={
'FORMAT_MOODLE': ['FORMAT_MOODLE', '', [['lib','weblib.php',42]], 506],
'SITEID': ['SITEID', '', [['admin/cli','install.php',219],['lib/db','install.php',87],['','install.php',242],['lib','setup.php',755]], 608],
'DAYSECS': ['DAYSECS', '', [['lib','moodlelib.php',49]], 122],
'FORMAT_PLAIN': ['FORMAT_PLAIN', '', [['lib','weblib.php',52]], 152],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'MEMORY_EXTRA': ['MEMORY_EXTRA', '', [['lib','setuplib.php',50]], 40]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
