<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /backup/moodle2/backup_stepslib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='backup/moodle2';
filename='backup_stepslib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/backup/moodle2/</a> -> <a href="backup_stepslib.php.html">backup_stepslib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="backup_stepslib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="backup_stepslib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">//</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">//</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">//</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Defines various backup steps that will be used by common tasks in backup</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package     core_backup</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @subpackage  moodle2</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @category    backup</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @copyright   2010 onwards Eloy Lafuente (stronk7) {@link http://stronk7.com}</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> */</span>
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">/**</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * Create the temp dir where backup/restore will happen and create temp ids table.</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> */</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('create_and_clean_temp_stuff')" href="../../_classes/create_and_clean_temp_stuff.html" onMouseOver="classPopup(event,'create_and_clean_temp_stuff')">create_and_clean_temp_stuff</a> extends backup_execution_step {
<a name="l34"><span class="linenum">  34</span></a>  
<a name="l35"><span class="linenum">  35</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l36"><span class="linenum">  36</span></a>          <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>();
<a name="l37"><span class="linenum">  37</span></a>          <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>('Deleting backup directories');
<a name="l38"><span class="linenum">  38</span></a>          backup_helper::<a class="function" onClick="logFunction('check_and_create_backup_dir')" href="../../_functions/check_and_create_backup_dir.html" onMouseOver="funcPopup(event,'check_and_create_backup_dir')">check_and_create_backup_dir</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>());<span class="comment">// Create backup temp dir</span>
<a name="l39"><span class="linenum">  39</span></a>          backup_helper::<a class="function" onClick="logFunction('clear_backup_dir')" href="../../_functions/clear_backup_dir.html" onMouseOver="funcPopup(event,'clear_backup_dir')">clear_backup_dir</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>);           <span class="comment">// Empty temp dir, just in case</span>
<a name="l40"><span class="linenum">  40</span></a>          backup_controller_dbops::<a class="function" onClick="logFunction('drop_backup_ids_temp_table')" href="../../_functions/drop_backup_ids_temp_table.html" onMouseOver="funcPopup(event,'drop_backup_ids_temp_table')">drop_backup_ids_temp_table</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>()); <span class="comment">// Drop ids temp table</span>
<a name="l41"><span class="linenum">  41</span></a>          backup_controller_dbops::<a class="function" onClick="logFunction('create_backup_ids_temp_table')" href="../../_functions/create_backup_ids_temp_table.html" onMouseOver="funcPopup(event,'create_backup_ids_temp_table')">create_backup_ids_temp_table</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>()); <span class="comment">// Create ids temp table</span>
<a name="l42"><span class="linenum">  42</span></a>          <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l43"><span class="linenum">  43</span></a>      }
<a name="l44"><span class="linenum">  44</span></a>  }
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment">/**</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment"> * Delete the temp dir used by backup/restore (conditionally),</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment"> * delete old directories and drop temp ids table. Note we delete</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment"> * the directory but not the corresponding log file that will be</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment"> * there for, at least, 1 week - only delete_old_backup_dirs() or cron</span>
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment"> * deletes log files (for easier access to them).</span>
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment"> */</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('drop_and_clean_temp_stuff')" href="../../_classes/drop_and_clean_temp_stuff.html" onMouseOver="classPopup(event,'drop_and_clean_temp_stuff')">drop_and_clean_temp_stuff</a> extends backup_execution_step {
<a name="l54"><span class="linenum">  54</span></a>  
<a name="l55"><span class="linenum">  55</span></a>      protected <a class="var it6007" onMouseOver="hilite(6007)" onMouseOut="lolite()" onClick="logVariable('skipcleaningtempdir')" href="../../_variables/skipcleaningtempdir.html">$skipcleaningtempdir</a> = false;
<a name="l56"><span class="linenum">  56</span></a>  
<a name="l57"><span class="linenum">  57</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l58"><span class="linenum">  58</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>          backup_controller_dbops::<a class="function" onClick="logFunction('drop_backup_ids_temp_table')" href="../../_functions/drop_backup_ids_temp_table.html" onMouseOver="funcPopup(event,'drop_backup_ids_temp_table')">drop_backup_ids_temp_table</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>()); <span class="comment">// Drop ids temp table</span>
<a name="l61"><span class="linenum">  61</span></a>          backup_helper::<a class="function" onClick="logFunction('delete_old_backup_dirs')" href="../../_functions/delete_old_backup_dirs.html" onMouseOver="funcPopup(event,'delete_old_backup_dirs')">delete_old_backup_dirs</a>(<a class="phpfunction" onClick="logFunction('strtotime')" href="../../_functions/strtotime.html" onMouseOver="phpfuncPopup(event,'strtotime')">strtotime</a>('-1 week'));                <span class="comment">// Delete &gt; 1 week old temp dirs.</span>
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">        // Delete temp dir conditionally:</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">        // 1) If $CFG-&gt;keeptempdirectoriesonbackup is not enabled</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">        // 2) If backup temp dir deletion has been marked to be avoided</span>
<a name="l65"><span class="linenum">  65</span></a>          if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('keeptempdirectoriesonbackup')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/keeptempdirectoriesonbackup.html">keeptempdirectoriesonbackup</a>) &amp;&amp; !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('skipcleaningtempdir')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/skipcleaningtempdir.html">skipcleaningtempdir</a>) {
<a name="l66"><span class="linenum">  66</span></a>              <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>();
<a name="l67"><span class="linenum">  67</span></a>              <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>('Deleting backup dir');
<a name="l68"><span class="linenum">  68</span></a>              backup_helper::<a class="function" onClick="logFunction('delete_backup_dir')" href="../../_functions/delete_backup_dir.html" onMouseOver="funcPopup(event,'delete_backup_dir')">delete_backup_dir</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>); <span class="comment">// Empty backup dir</span>
<a name="l69"><span class="linenum">  69</span></a>              <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l70"><span class="linenum">  70</span></a>          }
<a name="l71"><span class="linenum">  71</span></a>      }
<a name="l72"><span class="linenum">  72</span></a>  
<a name="l73"><span class="linenum">  73</span></a>      public function <a class="function" onClick="logFunction('skip_cleaning_temp_dir')" href="../../_functions/skip_cleaning_temp_dir.html" onMouseOver="funcPopup(event,'skip_cleaning_temp_dir')">skip_cleaning_temp_dir</a>(<a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>) {
<a name="l74"><span class="linenum">  74</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('skipcleaningtempdir')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/skipcleaningtempdir.html">skipcleaningtempdir</a> = <a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>;
<a name="l75"><span class="linenum">  75</span></a>      }
<a name="l76"><span class="linenum">  76</span></a>  }
<a name="l77"><span class="linenum">  77</span></a>  
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">/**</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment"> * Create the directory where all the task (activity/block...) information will be stored</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> */</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('create_taskbasepath_directory')" href="../../_classes/create_taskbasepath_directory.html" onMouseOver="classPopup(event,'create_taskbasepath_directory')">create_taskbasepath_directory</a> extends backup_execution_step {
<a name="l82"><span class="linenum">  82</span></a>  
<a name="l83"><span class="linenum">  83</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l84"><span class="linenum">  84</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l85"><span class="linenum">  85</span></a>          <a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_taskbasepath')" href="../../_functions/get_taskbasepath.html" onMouseOver="funcPopup(event,'get_taskbasepath')">get_taskbasepath</a>();
<a name="l86"><span class="linenum">  86</span></a>          if (!<a class="function" onClick="logFunction('check_dir_exists')" href="../../_functions/check_dir_exists.html" onMouseOver="funcPopup(event,'check_dir_exists')">check_dir_exists</a>(<a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a>, true, true)) {
<a name="l87"><span class="linenum">  87</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_step_exception')" href="../../_classes/backup_step_exception.html" onMouseOver="classPopup(event,'backup_step_exception')">backup_step_exception</a>('cannot_create_taskbasepath_directory', <a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a>);
<a name="l88"><span class="linenum">  88</span></a>          }
<a name="l89"><span class="linenum">  89</span></a>      }
<a name="l90"><span class="linenum">  90</span></a>  }
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">/**</span>
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment"> * Abstract structure step, parent of all the activity structure steps. Used to wrap the</span>
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment"> * activity structure definition within the main &lt;activity ...&gt; tag. Also provides</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment"> * subplugin support for activities (that must be properly declared)</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment"> */</span>
<a name="l97"><span class="linenum">  97</span></a>  abstract class backup_activity_structure_step extends backup_structure_step {
<a name="l98"><span class="linenum">  98</span></a>  
<a name="l99"><span class="linenum">  99</span></a>      <span class="comment">/**</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment">     * Add subplugin structure to any element in the activity backup tree</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">     *</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">     * @param string $subplugintype type of subplugin as defined in activity db/subplugins.php</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">     * @param backup_nested_element $element element in the activity backup tree that</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment">     *                                       we are going to add subplugin information to</span>
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment">     * @param bool $multiple to define if multiple subplugins can produce information</span>
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment">     *                       for each instance of $element (true) or no (false)</span>
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment">     * @return void</span>
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment">     */</span>
<a name="l109"><span class="linenum"> 109</span></a>      protected function <a class="function" onClick="logFunction('add_subplugin_structure')" href="../../_functions/add_subplugin_structure.html" onMouseOver="funcPopup(event,'add_subplugin_structure')">add_subplugin_structure</a>(<a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../../_variables/subplugintype.html">$subplugintype</a>, <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>, <a class="var it4446" onMouseOver="hilite(4446)" onMouseOut="lolite()" onClick="logVariable('multiple')" href="../../_variables/multiple.html">$multiple</a>) {
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l112"><span class="linenum"> 112</span></a>  
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment">        // Check the requested subplugintype is a valid one</span>
<a name="l114"><span class="linenum"> 114</span></a>          <a class="var it6010" onMouseOver="hilite(6010)" onMouseOut="lolite()" onClick="logVariable('subpluginsfile')" href="../../_variables/subpluginsfile.html">$subpluginsfile</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '/mod/' . <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_modulename')" href="../../_functions/get_modulename.html" onMouseOver="funcPopup(event,'get_modulename')">get_modulename</a>() . '/db/subplugins.php';
<a name="l115"><span class="linenum"> 115</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it6010" onMouseOver="hilite(6010)" onMouseOut="lolite()" onClick="logVariable('subpluginsfile')" href="../../_variables/subpluginsfile.html">$subpluginsfile</a>)) {
<a name="l116"><span class="linenum"> 116</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_step_exception')" href="../../_classes/backup_step_exception.html" onMouseOver="classPopup(event,'backup_step_exception')">backup_step_exception</a>('activity_missing_subplugins_php_file', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_modulename')" href="../../_functions/get_modulename.html" onMouseOver="funcPopup(event,'get_modulename')">get_modulename</a>());
<a name="l117"><span class="linenum"> 117</span></a>          }
<a name="l118"><span class="linenum"> 118</span></a>          include(<a class="var it6010" onMouseOver="hilite(6010)" onMouseOut="lolite()" onClick="logVariable('subpluginsfile')" href="../../_variables/subpluginsfile.html">$subpluginsfile</a>);
<a name="l119"><span class="linenum"> 119</span></a>          if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../../_variables/subplugintype.html">$subplugintype</a>, <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('subplugins')" href="../../_variables/subplugins.html">$subplugins</a>)) {
<a name="l120"><span class="linenum"> 120</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_step_exception')" href="../../_classes/backup_step_exception.html" onMouseOver="classPopup(event,'backup_step_exception')">backup_step_exception</a>('incorrect_subplugin_type', <a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../../_variables/subplugintype.html">$subplugintype</a>);
<a name="l121"><span class="linenum"> 121</span></a>          }
<a name="l122"><span class="linenum"> 122</span></a>  
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment">        // Arrived here, subplugin is correct, let's create the optigroup</span>
<a name="l124"><span class="linenum"> 124</span></a>          <a class="var it6011" onMouseOver="hilite(6011)" onMouseOut="lolite()" onClick="logVariable('optigroupname')" href="../../_variables/optigroupname.html">$optigroupname</a> = <a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../../_variables/subplugintype.html">$subplugintype</a> . '_' . <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>() . '_subplugin';
<a name="l125"><span class="linenum"> 125</span></a>          <a class="var it6012" onMouseOver="hilite(6012)" onMouseOut="lolite()" onClick="logVariable('optigroup')" href="../../_variables/optigroup.html">$optigroup</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_optigroup')" href="../../_classes/backup_optigroup.html" onMouseOver="classPopup(event,'backup_optigroup')">backup_optigroup</a>(<a class="var it6011" onMouseOver="hilite(6011)" onMouseOut="lolite()" onClick="logVariable('optigroupname')" href="../../_variables/optigroupname.html">$optigroupname</a>, null, <a class="var it4446" onMouseOver="hilite(4446)" onMouseOut="lolite()" onClick="logVariable('multiple')" href="../../_variables/multiple.html">$multiple</a>);
<a name="l126"><span class="linenum"> 126</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6012" onMouseOver="hilite(6012)" onMouseOut="lolite()" onClick="logVariable('optigroup')" href="../../_variables/optigroup.html">$optigroup</a>); <span class="comment">// Add optigroup to stay connected since beginning</span>
<a name="l127"><span class="linenum"> 127</span></a>  
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">        // Get all the optigroup_elements, looking across all the subplugin dirs</span>
<a name="l129"><span class="linenum"> 129</span></a>          <a class="var it6013" onMouseOver="hilite(6013)" onMouseOut="lolite()" onClick="logVariable('subpluginsdirs')" href="../../_variables/subpluginsdirs.html">$subpluginsdirs</a> = <a class="class" onClick="logClass('core_component')" href="../../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_list')" href="../../_functions/get_plugin_list.html" onMouseOver="funcPopup(event,'get_plugin_list')">get_plugin_list</a>(<a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../../_variables/subplugintype.html">$subplugintype</a>);
<a name="l130"><span class="linenum"> 130</span></a>          foreach (<a class="var it6013" onMouseOver="hilite(6013)" onMouseOut="lolite()" onClick="logVariable('subpluginsdirs')" href="../../_variables/subpluginsdirs.html">$subpluginsdirs</a> as <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a> =&gt; <a class="var it6014" onMouseOver="hilite(6014)" onMouseOut="lolite()" onClick="logVariable('subpluginsdir')" href="../../_variables/subpluginsdir.html">$subpluginsdir</a>) {
<a name="l131"><span class="linenum"> 131</span></a>              <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../../_variables/classname.html">$classname</a> = 'backup_' . <a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../../_variables/subplugintype.html">$subplugintype</a> . '_' . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a> . '_subplugin';
<a name="l132"><span class="linenum"> 132</span></a>              <a class="var it5420" onMouseOver="hilite(5420)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../_variables/backupfile.html">$backupfile</a> = <a class="var it6014" onMouseOver="hilite(6014)" onMouseOut="lolite()" onClick="logVariable('subpluginsdir')" href="../../_variables/subpluginsdir.html">$subpluginsdir</a> . '/backup/moodle2/' . <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../../_variables/classname.html">$classname</a> . '.class.php';
<a name="l133"><span class="linenum"> 133</span></a>              if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it5420" onMouseOver="hilite(5420)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../_variables/backupfile.html">$backupfile</a>)) {
<a name="l134"><span class="linenum"> 134</span></a>                  require_once(<a class="var it5420" onMouseOver="hilite(5420)" onMouseOut="lolite()" onClick="logVariable('backupfile')" href="../../_variables/backupfile.html">$backupfile</a>);
<a name="l135"><span class="linenum"> 135</span></a>                  <a class="var it6015" onMouseOver="hilite(6015)" onMouseOut="lolite()" onClick="logVariable('backupsubplugin')" href="../../_variables/backupsubplugin.html">$backupsubplugin</a> = new <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../../_variables/classname.html">$classname</a>(<a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../../_variables/subplugintype.html">$subplugintype</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>, <a class="var it6012" onMouseOver="hilite(6012)" onMouseOut="lolite()" onClick="logVariable('optigroup')" href="../../_variables/optigroup.html">$optigroup</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>);
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">                // Add subplugin returned structure to optigroup</span>
<a name="l137"><span class="linenum"> 137</span></a>                  <a class="var it6015" onMouseOver="hilite(6015)" onMouseOut="lolite()" onClick="logVariable('backupsubplugin')" href="../../_variables/backupsubplugin.html">$backupsubplugin</a>-&gt;<a class="function" onClick="logFunction('define_subplugin_structure')" href="../../_functions/define_subplugin_structure.html" onMouseOver="funcPopup(event,'define_subplugin_structure')">define_subplugin_structure</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>());
<a name="l138"><span class="linenum"> 138</span></a>              }
<a name="l139"><span class="linenum"> 139</span></a>          }
<a name="l140"><span class="linenum"> 140</span></a>      }
<a name="l141"><span class="linenum"> 141</span></a>  
<a name="l142"><span class="linenum"> 142</span></a>      <span class="comment">/**</span>
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">     * As far as activity backup steps are implementing backup_subplugin stuff, they need to</span>
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">     * have the parent task available for wrapping purposes (get course/context....)</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">     *</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">     * @return backup_activity_task</span>
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment">     */</span>
<a name="l148"><span class="linenum"> 148</span></a>      public function <a class="function" onClick="logFunction('get_task')" href="../../_functions/get_task.html" onMouseOver="funcPopup(event,'get_task')">get_task</a>() {
<a name="l149"><span class="linenum"> 149</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>;
<a name="l150"><span class="linenum"> 150</span></a>      }
<a name="l151"><span class="linenum"> 151</span></a>  
<a name="l152"><span class="linenum"> 152</span></a>      <span class="comment">/**</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment">     * Wraps any activity backup structure within the common 'activity' element</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">     * that will include common to all activities information like id, context...</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">     *</span>
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">     * @param backup_nested_element $activitystructure the element to wrap</span>
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment">     * @return backup_nested_element the $activitystructure wrapped by the common 'activity' element</span>
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">     */</span>
<a name="l159"><span class="linenum"> 159</span></a>      protected function <a class="function" onClick="logFunction('prepare_activity_structure')" href="../../_functions/prepare_activity_structure.html" onMouseOver="funcPopup(event,'prepare_activity_structure')">prepare_activity_structure</a>(<a class="var it6016" onMouseOver="hilite(6016)" onMouseOut="lolite()" onClick="logVariable('activitystructure')" href="../../_variables/activitystructure.html">$activitystructure</a>) {
<a name="l160"><span class="linenum"> 160</span></a>  
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment">        // Create the wrap element</span>
<a name="l162"><span class="linenum"> 162</span></a>          <a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('activity', array('id', 'moduleid', 'modulename', 'contextid'), null);
<a name="l163"><span class="linenum"> 163</span></a>  
<a name="l164"><span class="linenum"> 164</span></a>  <span class="comment">        // Build the tree</span>
<a name="l165"><span class="linenum"> 165</span></a>          <a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6016" onMouseOver="hilite(6016)" onMouseOut="lolite()" onClick="logVariable('activitystructure')" href="../../_variables/activitystructure.html">$activitystructure</a>);
<a name="l166"><span class="linenum"> 166</span></a>  
<a name="l167"><span class="linenum"> 167</span></a>  <span class="comment">        // Set the source</span>
<a name="l168"><span class="linenum"> 168</span></a>          <a class="var it6017" onMouseOver="hilite(6017)" onMouseOut="lolite()" onClick="logVariable('activityarr')" href="../../_variables/activityarr.html">$activityarr</a> = array((object)array(
<a name="l169"><span class="linenum"> 169</span></a>              'id'         =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_activityid')" href="../../_functions/get_activityid.html" onMouseOver="funcPopup(event,'get_activityid')">get_activityid</a>(),
<a name="l170"><span class="linenum"> 170</span></a>              'moduleid'   =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_moduleid')" href="../../_functions/get_moduleid.html" onMouseOver="funcPopup(event,'get_moduleid')">get_moduleid</a>(),
<a name="l171"><span class="linenum"> 171</span></a>              'modulename' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_modulename')" href="../../_functions/get_modulename.html" onMouseOver="funcPopup(event,'get_modulename')">get_modulename</a>(),
<a name="l172"><span class="linenum"> 172</span></a>              'contextid'  =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>()));
<a name="l173"><span class="linenum"> 173</span></a>  
<a name="l174"><span class="linenum"> 174</span></a>          <a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(<a class="var it6017" onMouseOver="hilite(6017)" onMouseOut="lolite()" onClick="logVariable('activityarr')" href="../../_variables/activityarr.html">$activityarr</a>);
<a name="l175"><span class="linenum"> 175</span></a>  
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">        // Return the root element (activity)</span>
<a name="l177"><span class="linenum"> 177</span></a>          return <a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>;
<a name="l178"><span class="linenum"> 178</span></a>      }
<a name="l179"><span class="linenum"> 179</span></a>  }
<a name="l180"><span class="linenum"> 180</span></a>  
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">/**</span>
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment"> * Abstract structure step, to be used by all the activities using core questions stuff</span>
<a name="l183"><span class="linenum"> 183</span></a>  <span class="comment"> * (namely quiz module), supporting question plugins, states and sessions</span>
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment"> */</span>
<a name="l185"><span class="linenum"> 185</span></a>  abstract class backup_questions_activity_structure_step extends backup_activity_structure_step {
<a name="l186"><span class="linenum"> 186</span></a>  
<a name="l187"><span class="linenum"> 187</span></a>      <span class="comment">/**</span>
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment">     * Attach to $element (usually attempts) the needed backup structures</span>
<a name="l189"><span class="linenum"> 189</span></a>  <span class="comment">     * for question_usages and all the associated data.</span>
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment">     *</span>
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment">     * @param backup_nested_element $element the element that will contain all the question_usages data.</span>
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment">     * @param string $usageidname the name of the element that holds the usageid.</span>
<a name="l193"><span class="linenum"> 193</span></a>  <span class="comment">     *      This must be child of $element, and must be a final element.</span>
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment">     * @param string $nameprefix this prefix is added to all the element names we create.</span>
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">     *      Element names in the XML must be unique, so if you are using usages in</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">     *      two different ways, you must give a prefix to at least one of them. If</span>
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment">     *      you only use one sort of usage, then you can just use the default empty prefix.</span>
<a name="l198"><span class="linenum"> 198</span></a>  <span class="comment">     *      This should include a trailing underscore. For example &quot;myprefix_&quot;</span>
<a name="l199"><span class="linenum"> 199</span></a>  <span class="comment">     */</span>
<a name="l200"><span class="linenum"> 200</span></a>      protected function <a class="function" onClick="logFunction('add_question_usages')" href="../../_functions/add_question_usages.html" onMouseOver="funcPopup(event,'add_question_usages')">add_question_usages</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>, <a class="var it6018" onMouseOver="hilite(6018)" onMouseOut="lolite()" onClick="logVariable('usageidname')" href="../../_variables/usageidname.html">$usageidname</a>, <a class="var it6019" onMouseOver="hilite(6019)" onMouseOut="lolite()" onClick="logVariable('nameprefix')" href="../../_variables/nameprefix.html">$nameprefix</a> = '') {
<a name="l201"><span class="linenum"> 201</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l202"><span class="linenum"> 202</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../question/engine/lib.php.html">/question/engine/lib.php</a>');
<a name="l203"><span class="linenum"> 203</span></a>  
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment">        // Check $element is one nested_backup_element</span>
<a name="l205"><span class="linenum"> 205</span></a>          if (! <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a> instanceof backup_nested_element) {
<a name="l206"><span class="linenum"> 206</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_step_exception')" href="../../_classes/backup_step_exception.html" onMouseOver="classPopup(event,'backup_step_exception')">backup_step_exception</a>('question_states_bad_parent_element', <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>);
<a name="l207"><span class="linenum"> 207</span></a>          }
<a name="l208"><span class="linenum"> 208</span></a>          if (! <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>-&gt;<a class="function" onClick="logFunction('get_final_element')" href="../../_functions/get_final_element.html" onMouseOver="funcPopup(event,'get_final_element')">get_final_element</a>(<a class="var it6018" onMouseOver="hilite(6018)" onMouseOut="lolite()" onClick="logVariable('usageidname')" href="../../_variables/usageidname.html">$usageidname</a>)) {
<a name="l209"><span class="linenum"> 209</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_step_exception')" href="../../_classes/backup_step_exception.html" onMouseOver="classPopup(event,'backup_step_exception')">backup_step_exception</a>('question_states_bad_question_attempt_element', <a class="var it6018" onMouseOver="hilite(6018)" onMouseOut="lolite()" onClick="logVariable('usageidname')" href="../../_variables/usageidname.html">$usageidname</a>);
<a name="l210"><span class="linenum"> 210</span></a>          }
<a name="l211"><span class="linenum"> 211</span></a>  
<a name="l212"><span class="linenum"> 212</span></a>          <a class="var it729" onMouseOver="hilite(729)" onMouseOut="lolite()" onClick="logVariable('quba')" href="../../_variables/quba.html">$quba</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>(<a class="var it6019" onMouseOver="hilite(6019)" onMouseOut="lolite()" onClick="logVariable('nameprefix')" href="../../_variables/nameprefix.html">$nameprefix</a> . 'question_usage', array('id'),
<a name="l213"><span class="linenum"> 213</span></a>                  array('component', 'preferredbehaviour'));
<a name="l214"><span class="linenum"> 214</span></a>  
<a name="l215"><span class="linenum"> 215</span></a>          <a class="var it6020" onMouseOver="hilite(6020)" onMouseOut="lolite()" onClick="logVariable('qas')" href="../../_variables/qas.html">$qas</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>(<a class="var it6019" onMouseOver="hilite(6019)" onMouseOut="lolite()" onClick="logVariable('nameprefix')" href="../../_variables/nameprefix.html">$nameprefix</a> . 'question_attempts');
<a name="l216"><span class="linenum"> 216</span></a>          <a class="var it712" onMouseOver="hilite(712)" onMouseOut="lolite()" onClick="logVariable('qa')" href="../../_variables/qa.html">$qa</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>(<a class="var it6019" onMouseOver="hilite(6019)" onMouseOut="lolite()" onClick="logVariable('nameprefix')" href="../../_variables/nameprefix.html">$nameprefix</a> . 'question_attempt', array('id'), array(
<a name="l217"><span class="linenum"> 217</span></a>                  'slot', 'behaviour', 'questionid', 'variant', 'maxmark', 'minfraction', 'maxfraction',
<a name="l218"><span class="linenum"> 218</span></a>                  'flagged', 'questionsummary', 'rightanswer', 'responsesummary',
<a name="l219"><span class="linenum"> 219</span></a>                  'timemodified'));
<a name="l220"><span class="linenum"> 220</span></a>  
<a name="l221"><span class="linenum"> 221</span></a>          <a class="var it6021" onMouseOver="hilite(6021)" onMouseOut="lolite()" onClick="logVariable('steps')" href="../../_variables/steps.html">$steps</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>(<a class="var it6019" onMouseOver="hilite(6019)" onMouseOut="lolite()" onClick="logVariable('nameprefix')" href="../../_variables/nameprefix.html">$nameprefix</a> . 'steps');
<a name="l222"><span class="linenum"> 222</span></a>          <a class="var it675" onMouseOver="hilite(675)" onMouseOut="lolite()" onClick="logVariable('step')" href="../../_variables/step.html">$step</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>(<a class="var it6019" onMouseOver="hilite(6019)" onMouseOut="lolite()" onClick="logVariable('nameprefix')" href="../../_variables/nameprefix.html">$nameprefix</a> . 'step', array('id'), array(
<a name="l223"><span class="linenum"> 223</span></a>                  'sequencenumber', 'state', 'fraction', 'timecreated', 'userid'));
<a name="l224"><span class="linenum"> 224</span></a>  
<a name="l225"><span class="linenum"> 225</span></a>          <a class="var it47" onMouseOver="hilite(47)" onMouseOut="lolite()" onClick="logVariable('response')" href="../../_variables/response.html">$response</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>(<a class="var it6019" onMouseOver="hilite(6019)" onMouseOut="lolite()" onClick="logVariable('nameprefix')" href="../../_variables/nameprefix.html">$nameprefix</a> . 'response');
<a name="l226"><span class="linenum"> 226</span></a>          <a class="var it1162" onMouseOver="hilite(1162)" onMouseOut="lolite()" onClick="logVariable('variable')" href="../../_variables/variable.html">$variable</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>(<a class="var it6019" onMouseOver="hilite(6019)" onMouseOut="lolite()" onClick="logVariable('nameprefix')" href="../../_variables/nameprefix.html">$nameprefix</a> . 'variable', null,  array('name', 'value'));
<a name="l227"><span class="linenum"> 227</span></a>  
<a name="l228"><span class="linenum"> 228</span></a>  <span class="comment">        // Build the tree</span>
<a name="l229"><span class="linenum"> 229</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it729" onMouseOver="hilite(729)" onMouseOut="lolite()" onClick="logVariable('quba')" href="../../_variables/quba.html">$quba</a>);
<a name="l230"><span class="linenum"> 230</span></a>          <a class="var it729" onMouseOver="hilite(729)" onMouseOut="lolite()" onClick="logVariable('quba')" href="../../_variables/quba.html">$quba</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6020" onMouseOver="hilite(6020)" onMouseOut="lolite()" onClick="logVariable('qas')" href="../../_variables/qas.html">$qas</a>);
<a name="l231"><span class="linenum"> 231</span></a>          <a class="var it6020" onMouseOver="hilite(6020)" onMouseOut="lolite()" onClick="logVariable('qas')" href="../../_variables/qas.html">$qas</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it712" onMouseOver="hilite(712)" onMouseOut="lolite()" onClick="logVariable('qa')" href="../../_variables/qa.html">$qa</a>);
<a name="l232"><span class="linenum"> 232</span></a>          <a class="var it712" onMouseOver="hilite(712)" onMouseOut="lolite()" onClick="logVariable('qa')" href="../../_variables/qa.html">$qa</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6021" onMouseOver="hilite(6021)" onMouseOut="lolite()" onClick="logVariable('steps')" href="../../_variables/steps.html">$steps</a>);
<a name="l233"><span class="linenum"> 233</span></a>          <a class="var it6021" onMouseOver="hilite(6021)" onMouseOut="lolite()" onClick="logVariable('steps')" href="../../_variables/steps.html">$steps</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it675" onMouseOver="hilite(675)" onMouseOut="lolite()" onClick="logVariable('step')" href="../../_variables/step.html">$step</a>);
<a name="l234"><span class="linenum"> 234</span></a>          <a class="var it675" onMouseOver="hilite(675)" onMouseOut="lolite()" onClick="logVariable('step')" href="../../_variables/step.html">$step</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it47" onMouseOver="hilite(47)" onMouseOut="lolite()" onClick="logVariable('response')" href="../../_variables/response.html">$response</a>);
<a name="l235"><span class="linenum"> 235</span></a>          <a class="var it47" onMouseOver="hilite(47)" onMouseOut="lolite()" onClick="logVariable('response')" href="../../_variables/response.html">$response</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1162" onMouseOver="hilite(1162)" onMouseOut="lolite()" onClick="logVariable('variable')" href="../../_variables/variable.html">$variable</a>);
<a name="l236"><span class="linenum"> 236</span></a>  
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment">        // Set the sources</span>
<a name="l238"><span class="linenum"> 238</span></a>          <a class="var it729" onMouseOver="hilite(729)" onMouseOut="lolite()" onClick="logVariable('quba')" href="../../_variables/quba.html">$quba</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('question_usages',
<a name="l239"><span class="linenum"> 239</span></a>                  array('id'                =&gt; '../' . <a class="var it6018" onMouseOver="hilite(6018)" onMouseOut="lolite()" onClick="logVariable('usageidname')" href="../../_variables/usageidname.html">$usageidname</a>));
<a name="l240"><span class="linenum"> 240</span></a>          <a class="var it712" onMouseOver="hilite(712)" onMouseOut="lolite()" onClick="logVariable('qa')" href="../../_variables/qa.html">$qa</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('question_attempts', array('questionusageid' =&gt; backup::VAR_PARENTID), 'slot ASC');
<a name="l241"><span class="linenum"> 241</span></a>          <a class="var it675" onMouseOver="hilite(675)" onMouseOut="lolite()" onClick="logVariable('step')" href="../../_variables/step.html">$step</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('question_attempt_steps', array('questionattemptid' =&gt; backup::VAR_PARENTID), 'sequencenumber ASC');
<a name="l242"><span class="linenum"> 242</span></a>          <a class="var it1162" onMouseOver="hilite(1162)" onMouseOut="lolite()" onClick="logVariable('variable')" href="../../_variables/variable.html">$variable</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('question_attempt_step_data', array('attemptstepid' =&gt; backup::VAR_PARENTID));
<a name="l243"><span class="linenum"> 243</span></a>  
<a name="l244"><span class="linenum"> 244</span></a>  <span class="comment">        // Annotate ids</span>
<a name="l245"><span class="linenum"> 245</span></a>          <a class="var it712" onMouseOver="hilite(712)" onMouseOut="lolite()" onClick="logVariable('qa')" href="../../_variables/qa.html">$qa</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('question', 'questionid');
<a name="l246"><span class="linenum"> 246</span></a>          <a class="var it675" onMouseOver="hilite(675)" onMouseOut="lolite()" onClick="logVariable('step')" href="../../_variables/step.html">$step</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l247"><span class="linenum"> 247</span></a>  
<a name="l248"><span class="linenum"> 248</span></a>  <span class="comment">        // Annotate files</span>
<a name="l249"><span class="linenum"> 249</span></a>          <a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('fileareas')" href="../../_variables/fileareas.html">$fileareas</a> = question_engine::<a class="function" onClick="logFunction('get_all_response_file_areas')" href="../../_functions/get_all_response_file_areas.html" onMouseOver="funcPopup(event,'get_all_response_file_areas')">get_all_response_file_areas</a>();
<a name="l250"><span class="linenum"> 250</span></a>          foreach (<a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('fileareas')" href="../../_variables/fileareas.html">$fileareas</a> as <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>) {
<a name="l251"><span class="linenum"> 251</span></a>              <a class="var it675" onMouseOver="hilite(675)" onMouseOut="lolite()" onClick="logVariable('step')" href="../../_variables/step.html">$step</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('question', <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, 'id');
<a name="l252"><span class="linenum"> 252</span></a>          }
<a name="l253"><span class="linenum"> 253</span></a>      }
<a name="l254"><span class="linenum"> 254</span></a>  }
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>  
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">/**</span>
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment"> * backup structure step in charge of calculating the categories to be</span>
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment"> * included in backup, based in the context being backuped (module/course)</span>
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment"> * and the already annotated questions present in backup_ids_temp</span>
<a name="l261"><span class="linenum"> 261</span></a>  <span class="comment"> */</span>
<a name="l262"><span class="linenum"> 262</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_calculate_question_categories')" href="../../_classes/backup_calculate_question_categories.html" onMouseOver="classPopup(event,'backup_calculate_question_categories')">backup_calculate_question_categories</a> extends backup_execution_step {
<a name="l263"><span class="linenum"> 263</span></a>  
<a name="l264"><span class="linenum"> 264</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l265"><span class="linenum"> 265</span></a>          backup_question_dbops::<a class="function" onClick="logFunction('calculate_question_categories')" href="../../_functions/calculate_question_categories.html" onMouseOver="funcPopup(event,'calculate_question_categories')">calculate_question_categories</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>());
<a name="l266"><span class="linenum"> 266</span></a>      }
<a name="l267"><span class="linenum"> 267</span></a>  }
<a name="l268"><span class="linenum"> 268</span></a>  
<a name="l269"><span class="linenum"> 269</span></a>  <span class="comment">/**</span>
<a name="l270"><span class="linenum"> 270</span></a>  <span class="comment"> * backup structure step in charge of deleting all the questions annotated</span>
<a name="l271"><span class="linenum"> 271</span></a>  <span class="comment"> * in the backup_ids_temp table</span>
<a name="l272"><span class="linenum"> 272</span></a>  <span class="comment"> */</span>
<a name="l273"><span class="linenum"> 273</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_delete_temp_questions')" href="../../_classes/backup_delete_temp_questions.html" onMouseOver="classPopup(event,'backup_delete_temp_questions')">backup_delete_temp_questions</a> extends backup_execution_step {
<a name="l274"><span class="linenum"> 274</span></a>  
<a name="l275"><span class="linenum"> 275</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l276"><span class="linenum"> 276</span></a>          backup_question_dbops::<a class="function" onClick="logFunction('delete_temp_questions')" href="../../_functions/delete_temp_questions.html" onMouseOver="funcPopup(event,'delete_temp_questions')">delete_temp_questions</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>());
<a name="l277"><span class="linenum"> 277</span></a>      }
<a name="l278"><span class="linenum"> 278</span></a>  }
<a name="l279"><span class="linenum"> 279</span></a>  
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment">/**</span>
<a name="l281"><span class="linenum"> 281</span></a>  <span class="comment"> * Abstract structure step, parent of all the block structure steps. Used to wrap the</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment"> * block structure definition within the main &lt;block ...&gt; tag</span>
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment"> */</span>
<a name="l284"><span class="linenum"> 284</span></a>  abstract class backup_block_structure_step extends backup_structure_step {
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>      protected function <a class="function" onClick="logFunction('prepare_block_structure')" href="../../_functions/prepare_block_structure.html" onMouseOver="funcPopup(event,'prepare_block_structure')">prepare_block_structure</a>(<a class="var it6023" onMouseOver="hilite(6023)" onMouseOut="lolite()" onClick="logVariable('blockstructure')" href="../../_variables/blockstructure.html">$blockstructure</a>) {
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment">        // Create the wrap element</span>
<a name="l289"><span class="linenum"> 289</span></a>          <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('block', array('id', 'blockname', 'contextid'), null);
<a name="l290"><span class="linenum"> 290</span></a>  
<a name="l291"><span class="linenum"> 291</span></a>  <span class="comment">        // Build the tree</span>
<a name="l292"><span class="linenum"> 292</span></a>          <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6023" onMouseOver="hilite(6023)" onMouseOut="lolite()" onClick="logVariable('blockstructure')" href="../../_variables/blockstructure.html">$blockstructure</a>);
<a name="l293"><span class="linenum"> 293</span></a>  
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment">        // Set the source</span>
<a name="l295"><span class="linenum"> 295</span></a>          <a class="var it6024" onMouseOver="hilite(6024)" onMouseOut="lolite()" onClick="logVariable('blockarr')" href="../../_variables/blockarr.html">$blockarr</a> = array((object)array(
<a name="l296"><span class="linenum"> 296</span></a>              'id'         =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_blockid')" href="../../_functions/get_blockid.html" onMouseOver="funcPopup(event,'get_blockid')">get_blockid</a>(),
<a name="l297"><span class="linenum"> 297</span></a>              'blockname'  =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_blockname')" href="../../_functions/get_blockname.html" onMouseOver="funcPopup(event,'get_blockname')">get_blockname</a>(),
<a name="l298"><span class="linenum"> 298</span></a>              'contextid'  =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>()));
<a name="l299"><span class="linenum"> 299</span></a>  
<a name="l300"><span class="linenum"> 300</span></a>          <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(<a class="var it6024" onMouseOver="hilite(6024)" onMouseOut="lolite()" onClick="logVariable('blockarr')" href="../../_variables/blockarr.html">$blockarr</a>);
<a name="l301"><span class="linenum"> 301</span></a>  
<a name="l302"><span class="linenum"> 302</span></a>  <span class="comment">        // Return the root element (block)</span>
<a name="l303"><span class="linenum"> 303</span></a>          return <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>;
<a name="l304"><span class="linenum"> 304</span></a>      }
<a name="l305"><span class="linenum"> 305</span></a>  }
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">/**</span>
<a name="l308"><span class="linenum"> 308</span></a>  <span class="comment"> * structure step that will generate the module.xml file for the activity,</span>
<a name="l309"><span class="linenum"> 309</span></a>  <span class="comment"> * accumulating various information about the activity, annotating groupings</span>
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment"> * and completion/avail conf</span>
<a name="l311"><span class="linenum"> 311</span></a>  <span class="comment"> */</span>
<a name="l312"><span class="linenum"> 312</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_module_structure_step')" href="../../_classes/backup_module_structure_step.html" onMouseOver="classPopup(event,'backup_module_structure_step')">backup_module_structure_step</a> extends backup_structure_step {
<a name="l313"><span class="linenum"> 313</span></a>  
<a name="l314"><span class="linenum"> 314</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l315"><span class="linenum"> 315</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l316"><span class="linenum"> 316</span></a>  
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l318"><span class="linenum"> 318</span></a>  
<a name="l319"><span class="linenum"> 319</span></a>          <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('module', array('id', 'version'), array(
<a name="l320"><span class="linenum"> 320</span></a>              'modulename', 'sectionid', 'sectionnumber', 'idnumber',
<a name="l321"><span class="linenum"> 321</span></a>              'added', 'score', 'indent', 'visible',
<a name="l322"><span class="linenum"> 322</span></a>              'visibleold', 'groupmode', 'groupingid',
<a name="l323"><span class="linenum"> 323</span></a>              'completion', 'completiongradeitemnumber', 'completionview', 'completionexpected',
<a name="l324"><span class="linenum"> 324</span></a>              'availability', 'showdescription'));
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>  <span class="comment">        // attach format plugin structure to $module element, only one allowed</span>
<a name="l327"><span class="linenum"> 327</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('format', <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>, false);
<a name="l328"><span class="linenum"> 328</span></a>  
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment">        // attach plagiarism plugin structure to $module element, there can be potentially</span>
<a name="l330"><span class="linenum"> 330</span></a>  <span class="comment">        // many plagiarism plugins storing information about this course</span>
<a name="l331"><span class="linenum"> 331</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('plagiarism', <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>, true);
<a name="l332"><span class="linenum"> 332</span></a>  
<a name="l333"><span class="linenum"> 333</span></a>  <span class="comment">        // attach local plugin structure to $module, multiple allowed</span>
<a name="l334"><span class="linenum"> 334</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('local', <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>, true);
<a name="l335"><span class="linenum"> 335</span></a>  
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">        // Set the sources</span>
<a name="l337"><span class="linenum"> 337</span></a>          <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('concat')" href="../../_variables/concat.html">$concat</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>(&quot;'mod_'&quot;, 'm.name');
<a name="l338"><span class="linenum"> 338</span></a>          <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;
<a name="l339"><span class="linenum"> 339</span></a>              SELECT cm.*, cp.value AS version, m.name AS modulename, s.id AS sectionid, s.section AS sectionnumber
<a name="l340"><span class="linenum"> 340</span></a>                FROM {course_modules} cm
<a name="l341"><span class="linenum"> 341</span></a>                JOIN {modules} m ON m.id = cm.module
<a name="l342"><span class="linenum"> 342</span></a>                JOIN {config_plugins} cp ON cp.plugin = <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('concat')" href="../../_variables/concat.html">$concat</a> AND cp.name = 'version'
<a name="l343"><span class="linenum"> 343</span></a>                JOIN {course_sections} s ON s.id = cm.section
<a name="l344"><span class="linenum"> 344</span></a>               WHERE cm.id = ?&quot;, array(backup::VAR_MODID));
<a name="l345"><span class="linenum"> 345</span></a>  
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment">        // Define annotations</span>
<a name="l347"><span class="linenum"> 347</span></a>          <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('grouping', 'groupingid');
<a name="l348"><span class="linenum"> 348</span></a>  
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment">        // Return the root element ($module)</span>
<a name="l350"><span class="linenum"> 350</span></a>          return <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>;
<a name="l351"><span class="linenum"> 351</span></a>      }
<a name="l352"><span class="linenum"> 352</span></a>  }
<a name="l353"><span class="linenum"> 353</span></a>  
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment">/**</span>
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment"> * structure step that will generate the section.xml file for the section</span>
<a name="l356"><span class="linenum"> 356</span></a>  <span class="comment"> * annotating files</span>
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment"> */</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_section_structure_step')" href="../../_classes/backup_section_structure_step.html" onMouseOver="classPopup(event,'backup_section_structure_step')">backup_section_structure_step</a> extends backup_structure_step {
<a name="l359"><span class="linenum"> 359</span></a>  
<a name="l360"><span class="linenum"> 360</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l363"><span class="linenum"> 363</span></a>  
<a name="l364"><span class="linenum"> 364</span></a>          <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('section', array('id'), array(
<a name="l365"><span class="linenum"> 365</span></a>                  'number', 'name', 'summary', 'summaryformat', 'sequence', 'visible',
<a name="l366"><span class="linenum"> 366</span></a>                  'availabilityjson'));
<a name="l367"><span class="linenum"> 367</span></a>  
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment">        // attach format plugin structure to $section element, only one allowed</span>
<a name="l369"><span class="linenum"> 369</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('format', <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>, false);
<a name="l370"><span class="linenum"> 370</span></a>  
<a name="l371"><span class="linenum"> 371</span></a>  <span class="comment">        // attach local plugin structure to $section element, multiple allowed</span>
<a name="l372"><span class="linenum"> 372</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('local', <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>, true);
<a name="l373"><span class="linenum"> 373</span></a>  
<a name="l374"><span class="linenum"> 374</span></a>  <span class="comment">        // Add nested elements for course_format_options table</span>
<a name="l375"><span class="linenum"> 375</span></a>          <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('course_format_options', array('id'), array(
<a name="l376"><span class="linenum"> 376</span></a>              'format', 'name', 'value'));
<a name="l377"><span class="linenum"> 377</span></a>          <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>);
<a name="l378"><span class="linenum"> 378</span></a>  
<a name="l379"><span class="linenum"> 379</span></a>  <span class="comment">        // Define sources.</span>
<a name="l380"><span class="linenum"> 380</span></a>          <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('course_sections', array('id' =&gt; backup::VAR_SECTIONID));
<a name="l381"><span class="linenum"> 381</span></a>          <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>('SELECT cfo.id, cfo.format, cfo.name, cfo.value
<a name="l382"><span class="linenum"> 382</span></a>                FROM {course} c
<a name="l383"><span class="linenum"> 383</span></a>                JOIN {course_format_options} cfo
<a name="l384"><span class="linenum"> 384</span></a>                ON cfo.courseid = c.id AND cfo.format = c.format
<a name="l385"><span class="linenum"> 385</span></a>                WHERE c.id = ? AND cfo.sectionid = ?',
<a name="l386"><span class="linenum"> 386</span></a>                  array(backup::VAR_COURSEID, backup::VAR_SECTIONID));
<a name="l387"><span class="linenum"> 387</span></a>  
<a name="l388"><span class="linenum"> 388</span></a>  <span class="comment">        // Aliases</span>
<a name="l389"><span class="linenum"> 389</span></a>          <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>-&gt;<a class="function" onClick="logFunction('set_source_alias')" href="../../_functions/set_source_alias.html" onMouseOver="funcPopup(event,'set_source_alias')">set_source_alias</a>('section', 'number');
<a name="l390"><span class="linenum"> 390</span></a>  <span class="comment">        // The 'availability' field needs to be renamed because it clashes with</span>
<a name="l391"><span class="linenum"> 391</span></a>  <span class="comment">        // the old nested element structure for availability data.</span>
<a name="l392"><span class="linenum"> 392</span></a>          <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>-&gt;<a class="function" onClick="logFunction('set_source_alias')" href="../../_functions/set_source_alias.html" onMouseOver="funcPopup(event,'set_source_alias')">set_source_alias</a>('availability', 'availabilityjson');
<a name="l393"><span class="linenum"> 393</span></a>  
<a name="l394"><span class="linenum"> 394</span></a>  <span class="comment">        // Set annotations</span>
<a name="l395"><span class="linenum"> 395</span></a>          <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('course', 'section', 'id');
<a name="l396"><span class="linenum"> 396</span></a>  
<a name="l397"><span class="linenum"> 397</span></a>          return <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>;
<a name="l398"><span class="linenum"> 398</span></a>      }
<a name="l399"><span class="linenum"> 399</span></a>  }
<a name="l400"><span class="linenum"> 400</span></a>  
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment">/**</span>
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment"> * structure step that will generate the course.xml file for the course, including</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment"> * course category reference, tags, modules restriction information</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment"> * and some annotations (files &amp; groupings)</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment"> */</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_course_structure_step')" href="../../_classes/backup_course_structure_step.html" onMouseOver="classPopup(event,'backup_course_structure_step')">backup_course_structure_step</a> extends backup_structure_step {
<a name="l407"><span class="linenum"> 407</span></a>  
<a name="l408"><span class="linenum"> 408</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l409"><span class="linenum"> 409</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l410"><span class="linenum"> 410</span></a>  
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l412"><span class="linenum"> 412</span></a>  
<a name="l413"><span class="linenum"> 413</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('course', array('id', 'contextid'), array(
<a name="l414"><span class="linenum"> 414</span></a>              'shortname', 'fullname', 'idnumber',
<a name="l415"><span class="linenum"> 415</span></a>              'summary', 'summaryformat', 'format', 'showgrades',
<a name="l416"><span class="linenum"> 416</span></a>              'newsitems', 'startdate',
<a name="l417"><span class="linenum"> 417</span></a>              'marker', 'maxbytes', 'legacyfiles', 'showreports',
<a name="l418"><span class="linenum"> 418</span></a>              'visible', 'groupmode', 'groupmodeforce',
<a name="l419"><span class="linenum"> 419</span></a>              'defaultgroupingid', 'lang', 'theme',
<a name="l420"><span class="linenum"> 420</span></a>              'timecreated', 'timemodified',
<a name="l421"><span class="linenum"> 421</span></a>              'requested',
<a name="l422"><span class="linenum"> 422</span></a>              'enablecompletion', 'completionstartonenrol', 'completionnotify'));
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>          <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('category', array('id'), array(
<a name="l425"><span class="linenum"> 425</span></a>              'name', 'description'));
<a name="l426"><span class="linenum"> 426</span></a>  
<a name="l427"><span class="linenum"> 427</span></a>          <a class="var it2944" onMouseOver="hilite(2944)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../_variables/tags.html">$tags</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('tags');
<a name="l428"><span class="linenum"> 428</span></a>  
<a name="l429"><span class="linenum"> 429</span></a>          <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('tag', array('id'), array(
<a name="l430"><span class="linenum"> 430</span></a>              'name', 'rawname'));
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>  <span class="comment">        // attach format plugin structure to $course element, only one allowed</span>
<a name="l433"><span class="linenum"> 433</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('format', <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, false);
<a name="l434"><span class="linenum"> 434</span></a>  
<a name="l435"><span class="linenum"> 435</span></a>  <span class="comment">        // attach theme plugin structure to $course element; multiple themes can</span>
<a name="l436"><span class="linenum"> 436</span></a>  <span class="comment">        // save course data (in case of user theme, legacy theme, etc)</span>
<a name="l437"><span class="linenum"> 437</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('theme', <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, true);
<a name="l438"><span class="linenum"> 438</span></a>  
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">        // attach general report plugin structure to $course element; multiple</span>
<a name="l440"><span class="linenum"> 440</span></a>  <span class="comment">        // reports can save course data if required</span>
<a name="l441"><span class="linenum"> 441</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('report', <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, true);
<a name="l442"><span class="linenum"> 442</span></a>  
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">        // attach course report plugin structure to $course element; multiple</span>
<a name="l444"><span class="linenum"> 444</span></a>  <span class="comment">        // course reports can save course data if required</span>
<a name="l445"><span class="linenum"> 445</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('coursereport', <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, true);
<a name="l446"><span class="linenum"> 446</span></a>  
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">        // attach plagiarism plugin structure to $course element, there can be potentially</span>
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment">        // many plagiarism plugins storing information about this course</span>
<a name="l449"><span class="linenum"> 449</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('plagiarism', <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, true);
<a name="l450"><span class="linenum"> 450</span></a>  
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">        // attach local plugin structure to $course element; multiple local plugins</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">        // can save course data if required</span>
<a name="l453"><span class="linenum"> 453</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('local', <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, true);
<a name="l454"><span class="linenum"> 454</span></a>  
<a name="l455"><span class="linenum"> 455</span></a>  <span class="comment">        // Build the tree</span>
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a>);
<a name="l458"><span class="linenum"> 458</span></a>  
<a name="l459"><span class="linenum"> 459</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it2944" onMouseOver="hilite(2944)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../_variables/tags.html">$tags</a>);
<a name="l460"><span class="linenum"> 460</span></a>          <a class="var it2944" onMouseOver="hilite(2944)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../_variables/tags.html">$tags</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>);
<a name="l461"><span class="linenum"> 461</span></a>  
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment">        // Set the sources</span>
<a name="l463"><span class="linenum"> 463</span></a>  
<a name="l464"><span class="linenum"> 464</span></a>          <a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('courserec')" href="../../_variables/courserec.html">$courserec</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>()));
<a name="l465"><span class="linenum"> 465</span></a>          <a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('courserec')" href="../../_variables/courserec.html">$courserec</a>-&gt;<a onClick="logVariable('contextid')" class="var it41347" onMouseOver="hilite(41347)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>();
<a name="l466"><span class="linenum"> 466</span></a>  
<a name="l467"><span class="linenum"> 467</span></a>          <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a> = <a class="function" onClick="logFunction('course_get_format')" href="../../_functions/course_get_format.html" onMouseOver="funcPopup(event,'course_get_format')">course_get_format</a>(<a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('courserec')" href="../../_variables/courserec.html">$courserec</a>)-&gt;<a class="function" onClick="logFunction('get_format_options')" href="../../_functions/get_format_options.html" onMouseOver="funcPopup(event,'get_format_options')">get_format_options</a>();
<a name="l468"><span class="linenum"> 468</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a class="function" onClick="logFunction('add_final_elements')" href="../../_functions/add_final_elements.html" onMouseOver="funcPopup(event,'add_final_elements')">add_final_elements</a>(<a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>));
<a name="l469"><span class="linenum"> 469</span></a>          foreach (<a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l470"><span class="linenum"> 470</span></a>              <a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('courserec')" href="../../_variables/courserec.html">$courserec</a>-&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l471"><span class="linenum"> 471</span></a>          }
<a name="l472"><span class="linenum"> 472</span></a>  
<a name="l473"><span class="linenum"> 473</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(array(<a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('courserec')" href="../../_variables/courserec.html">$courserec</a>));
<a name="l474"><span class="linenum"> 474</span></a>  
<a name="l475"><span class="linenum"> 475</span></a>          <a class="var it6028" onMouseOver="hilite(6028)" onMouseOut="lolite()" onClick="logVariable('categoryrec')" href="../../_variables/categoryrec.html">$categoryrec</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course_categories', array('id' =&gt; <a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('courserec')" href="../../_variables/courserec.html">$courserec</a>-&gt;<a onClick="logVariable('category')" class="var it41347" onMouseOver="hilite(41347)" onMouseOut="lolite()" href="../../_variables/category.html">category</a>));
<a name="l476"><span class="linenum"> 476</span></a>  
<a name="l477"><span class="linenum"> 477</span></a>          <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(array(<a class="var it6028" onMouseOver="hilite(6028)" onMouseOut="lolite()" onClick="logVariable('categoryrec')" href="../../_variables/categoryrec.html">$categoryrec</a>));
<a name="l478"><span class="linenum"> 478</span></a>  
<a name="l479"><span class="linenum"> 479</span></a>          <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>('SELECT t.id, t.name, t.rawname
<a name="l480"><span class="linenum"> 480</span></a>                                  FROM {tag} t
<a name="l481"><span class="linenum"> 481</span></a>                                  JOIN {tag_instance} ti ON ti.tagid = t.id
<a name="l482"><span class="linenum"> 482</span></a>                                 WHERE ti.itemtype = ?
<a name="l483"><span class="linenum"> 483</span></a>                                   AND ti.itemid = ?', array(
<a name="l484"><span class="linenum"> 484</span></a>                                       backup_helper::<a class="function" onClick="logFunction('is_sqlparam')" href="../../_functions/is_sqlparam.html" onMouseOver="funcPopup(event,'is_sqlparam')">is_sqlparam</a>('course'),
<a name="l485"><span class="linenum"> 485</span></a>                                       backup::VAR_PARENTID));
<a name="l486"><span class="linenum"> 486</span></a>  
<a name="l487"><span class="linenum"> 487</span></a>  <span class="comment">        // Some annotations</span>
<a name="l488"><span class="linenum"> 488</span></a>  
<a name="l489"><span class="linenum"> 489</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('grouping', 'defaultgroupingid');
<a name="l490"><span class="linenum"> 490</span></a>  
<a name="l491"><span class="linenum"> 491</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('course', 'summary', null);
<a name="l492"><span class="linenum"> 492</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('course', 'overviewfiles', null);
<a name="l493"><span class="linenum"> 493</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('course', 'legacy', null);
<a name="l494"><span class="linenum"> 494</span></a>  
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment">        // Return root element ($course)</span>
<a name="l496"><span class="linenum"> 496</span></a>  
<a name="l497"><span class="linenum"> 497</span></a>          return <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>;
<a name="l498"><span class="linenum"> 498</span></a>      }
<a name="l499"><span class="linenum"> 499</span></a>  }
<a name="l500"><span class="linenum"> 500</span></a>  
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment">/**</span>
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment"> * structure step that will generate the enrolments.xml file for the given course</span>
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment"> */</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_enrolments_structure_step')" href="../../_classes/backup_enrolments_structure_step.html" onMouseOver="classPopup(event,'backup_enrolments_structure_step')">backup_enrolments_structure_step</a> extends backup_structure_step {
<a name="l505"><span class="linenum"> 505</span></a>  
<a name="l506"><span class="linenum"> 506</span></a>      <span class="comment">/**</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment">     * Skip enrolments on the front page.</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment">     * @return bool</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment">     */</span>
<a name="l510"><span class="linenum"> 510</span></a>      protected function <a class="function" onClick="logFunction('execute_condition')" href="../../_functions/execute_condition.html" onMouseOver="funcPopup(event,'execute_condition')">execute_condition</a>() {
<a name="l511"><span class="linenum"> 511</span></a>          return (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>() != <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l512"><span class="linenum"> 512</span></a>      }
<a name="l513"><span class="linenum"> 513</span></a>  
<a name="l514"><span class="linenum"> 514</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l515"><span class="linenum"> 515</span></a>  
<a name="l516"><span class="linenum"> 516</span></a>  <span class="comment">        // To know if we are including users</span>
<a name="l517"><span class="linenum"> 517</span></a>          <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('users');
<a name="l518"><span class="linenum"> 518</span></a>  
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l520"><span class="linenum"> 520</span></a>  
<a name="l521"><span class="linenum"> 521</span></a>          <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('enrolments')" href="../../_variables/enrolments.html">$enrolments</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('enrolments');
<a name="l522"><span class="linenum"> 522</span></a>  
<a name="l523"><span class="linenum"> 523</span></a>          <a class="var it3147" onMouseOver="hilite(3147)" onMouseOut="lolite()" onClick="logVariable('enrols')" href="../../_variables/enrols.html">$enrols</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('enrols');
<a name="l524"><span class="linenum"> 524</span></a>  
<a name="l525"><span class="linenum"> 525</span></a>          <a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('enrol', array('id'), array(
<a name="l526"><span class="linenum"> 526</span></a>              'enrol', 'status', 'name', 'enrolperiod', 'enrolstartdate',
<a name="l527"><span class="linenum"> 527</span></a>              'enrolenddate', 'expirynotify', 'expirythreshold', 'notifyall',
<a name="l528"><span class="linenum"> 528</span></a>              'password', 'cost', 'currency', 'roleid',
<a name="l529"><span class="linenum"> 529</span></a>              'customint1', 'customint2', 'customint3', 'customint4', 'customint5', 'customint6', 'customint7', 'customint8',
<a name="l530"><span class="linenum"> 530</span></a>              'customchar1', 'customchar2', 'customchar3',
<a name="l531"><span class="linenum"> 531</span></a>              'customdec1', 'customdec2',
<a name="l532"><span class="linenum"> 532</span></a>              'customtext1', 'customtext2', 'customtext3', 'customtext4',
<a name="l533"><span class="linenum"> 533</span></a>              'timecreated', 'timemodified'));
<a name="l534"><span class="linenum"> 534</span></a>  
<a name="l535"><span class="linenum"> 535</span></a>          <a class="var it6029" onMouseOver="hilite(6029)" onMouseOut="lolite()" onClick="logVariable('userenrolments')" href="../../_variables/userenrolments.html">$userenrolments</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('user_enrolments');
<a name="l536"><span class="linenum"> 536</span></a>  
<a name="l537"><span class="linenum"> 537</span></a>          <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('enrolment')" href="../../_variables/enrolment.html">$enrolment</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('enrolment', array('id'), array(
<a name="l538"><span class="linenum"> 538</span></a>              'status', 'userid', 'timestart', 'timeend', 'modifierid',
<a name="l539"><span class="linenum"> 539</span></a>              'timemodified'));
<a name="l540"><span class="linenum"> 540</span></a>  
<a name="l541"><span class="linenum"> 541</span></a>  <span class="comment">        // Build the tree</span>
<a name="l542"><span class="linenum"> 542</span></a>          <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('enrolments')" href="../../_variables/enrolments.html">$enrolments</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it3147" onMouseOver="hilite(3147)" onMouseOut="lolite()" onClick="logVariable('enrols')" href="../../_variables/enrols.html">$enrols</a>);
<a name="l543"><span class="linenum"> 543</span></a>          <a class="var it3147" onMouseOver="hilite(3147)" onMouseOut="lolite()" onClick="logVariable('enrols')" href="../../_variables/enrols.html">$enrols</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a>);
<a name="l544"><span class="linenum"> 544</span></a>          <a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6029" onMouseOver="hilite(6029)" onMouseOut="lolite()" onClick="logVariable('userenrolments')" href="../../_variables/userenrolments.html">$userenrolments</a>);
<a name="l545"><span class="linenum"> 545</span></a>          <a class="var it6029" onMouseOver="hilite(6029)" onMouseOut="lolite()" onClick="logVariable('userenrolments')" href="../../_variables/userenrolments.html">$userenrolments</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('enrolment')" href="../../_variables/enrolment.html">$enrolment</a>);
<a name="l546"><span class="linenum"> 546</span></a>  
<a name="l547"><span class="linenum"> 547</span></a>  <span class="comment">        // Define sources - the instances are restored using the same sortorder, we do not need to store it in xml and deal with it afterwards.</span>
<a name="l548"><span class="linenum"> 548</span></a>          <a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('enrol', array('courseid' =&gt; backup::VAR_COURSEID), 'sortorder ASC');
<a name="l549"><span class="linenum"> 549</span></a>  
<a name="l550"><span class="linenum"> 550</span></a>  <span class="comment">        // User enrolments only added only if users included</span>
<a name="l551"><span class="linenum"> 551</span></a>          if (<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>) {
<a name="l552"><span class="linenum"> 552</span></a>              <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('enrolment')" href="../../_variables/enrolment.html">$enrolment</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('user_enrolments', array('enrolid' =&gt; backup::VAR_PARENTID));
<a name="l553"><span class="linenum"> 553</span></a>              <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('enrolment')" href="../../_variables/enrolment.html">$enrolment</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l554"><span class="linenum"> 554</span></a>          }
<a name="l555"><span class="linenum"> 555</span></a>  
<a name="l556"><span class="linenum"> 556</span></a>          <a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('role', 'roleid');
<a name="l557"><span class="linenum"> 557</span></a>  
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment">        // Add enrol plugin structure.</span>
<a name="l559"><span class="linenum"> 559</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('enrol', <a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a>, false);
<a name="l560"><span class="linenum"> 560</span></a>  
<a name="l561"><span class="linenum"> 561</span></a>          return <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('enrolments')" href="../../_variables/enrolments.html">$enrolments</a>;
<a name="l562"><span class="linenum"> 562</span></a>      }
<a name="l563"><span class="linenum"> 563</span></a>  }
<a name="l564"><span class="linenum"> 564</span></a>  
<a name="l565"><span class="linenum"> 565</span></a>  <span class="comment">/**</span>
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment"> * structure step that will generate the roles.xml file for the given context, observing</span>
<a name="l567"><span class="linenum"> 567</span></a>  <span class="comment"> * the role_assignments setting to know if that part needs to be included</span>
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment"> */</span>
<a name="l569"><span class="linenum"> 569</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_roles_structure_step')" href="../../_classes/backup_roles_structure_step.html" onMouseOver="classPopup(event,'backup_roles_structure_step')">backup_roles_structure_step</a> extends backup_structure_step {
<a name="l570"><span class="linenum"> 570</span></a>  
<a name="l571"><span class="linenum"> 571</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l572"><span class="linenum"> 572</span></a>  
<a name="l573"><span class="linenum"> 573</span></a>  <span class="comment">        // To know if we are including role assignments</span>
<a name="l574"><span class="linenum"> 574</span></a>          <a class="var it5776" onMouseOver="hilite(5776)" onMouseOut="lolite()" onClick="logVariable('roleassignments')" href="../../_variables/roleassignments.html">$roleassignments</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('role_assignments');
<a name="l575"><span class="linenum"> 575</span></a>  
<a name="l576"><span class="linenum"> 576</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l577"><span class="linenum"> 577</span></a>  
<a name="l578"><span class="linenum"> 578</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('roles');
<a name="l579"><span class="linenum"> 579</span></a>  
<a name="l580"><span class="linenum"> 580</span></a>          <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('role_overrides');
<a name="l581"><span class="linenum"> 581</span></a>  
<a name="l582"><span class="linenum"> 582</span></a>          <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('override', array('id'), array(
<a name="l583"><span class="linenum"> 583</span></a>              'roleid', 'capability', 'permission', 'timemodified',
<a name="l584"><span class="linenum"> 584</span></a>              'modifierid'));
<a name="l585"><span class="linenum"> 585</span></a>  
<a name="l586"><span class="linenum"> 586</span></a>          <a class="var it6030" onMouseOver="hilite(6030)" onMouseOut="lolite()" onClick="logVariable('assignments')" href="../../_variables/assignments.html">$assignments</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('role_assignments');
<a name="l587"><span class="linenum"> 587</span></a>  
<a name="l588"><span class="linenum"> 588</span></a>          <a class="var it1613" onMouseOver="hilite(1613)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('assignment', array('id'), array(
<a name="l589"><span class="linenum"> 589</span></a>              'roleid', 'userid', 'timemodified', 'modifierid', 'component', 'itemid',
<a name="l590"><span class="linenum"> 590</span></a>              'sortorder'));
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">        // Build the tree</span>
<a name="l593"><span class="linenum"> 593</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a>);
<a name="l594"><span class="linenum"> 594</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6030" onMouseOver="hilite(6030)" onMouseOut="lolite()" onClick="logVariable('assignments')" href="../../_variables/assignments.html">$assignments</a>);
<a name="l595"><span class="linenum"> 595</span></a>  
<a name="l596"><span class="linenum"> 596</span></a>          <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>);
<a name="l597"><span class="linenum"> 597</span></a>          <a class="var it6030" onMouseOver="hilite(6030)" onMouseOut="lolite()" onClick="logVariable('assignments')" href="../../_variables/assignments.html">$assignments</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1613" onMouseOver="hilite(1613)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>);
<a name="l598"><span class="linenum"> 598</span></a>  
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment">        // Define sources</span>
<a name="l600"><span class="linenum"> 600</span></a>  
<a name="l601"><span class="linenum"> 601</span></a>          <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('role_capabilities', array('contextid' =&gt; backup::VAR_CONTEXTID));
<a name="l602"><span class="linenum"> 602</span></a>  
<a name="l603"><span class="linenum"> 603</span></a>  <span class="comment">        // Assignments only added if specified</span>
<a name="l604"><span class="linenum"> 604</span></a>          if (<a class="var it5776" onMouseOver="hilite(5776)" onMouseOut="lolite()" onClick="logVariable('roleassignments')" href="../../_variables/roleassignments.html">$roleassignments</a>) {
<a name="l605"><span class="linenum"> 605</span></a>              <a class="var it1613" onMouseOver="hilite(1613)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('role_assignments', array('contextid' =&gt; backup::VAR_CONTEXTID));
<a name="l606"><span class="linenum"> 606</span></a>          }
<a name="l607"><span class="linenum"> 607</span></a>  
<a name="l608"><span class="linenum"> 608</span></a>  <span class="comment">        // Define id annotations</span>
<a name="l609"><span class="linenum"> 609</span></a>          <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('role', 'roleid');
<a name="l610"><span class="linenum"> 610</span></a>  
<a name="l611"><span class="linenum"> 611</span></a>          <a class="var it1613" onMouseOver="hilite(1613)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('role', 'roleid');
<a name="l612"><span class="linenum"> 612</span></a>  
<a name="l613"><span class="linenum"> 613</span></a>          <a class="var it1613" onMouseOver="hilite(1613)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l614"><span class="linenum"> 614</span></a>  
<a name="l615"><span class="linenum"> 615</span></a>  <span class="comment">        //TODO: how do we annotate the itemid? the meaning depends on the content of component table (skodak)</span>
<a name="l616"><span class="linenum"> 616</span></a>  
<a name="l617"><span class="linenum"> 617</span></a>          return <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a>;
<a name="l618"><span class="linenum"> 618</span></a>      }
<a name="l619"><span class="linenum"> 619</span></a>  }
<a name="l620"><span class="linenum"> 620</span></a>  
<a name="l621"><span class="linenum"> 621</span></a>  <span class="comment">/**</span>
<a name="l622"><span class="linenum"> 622</span></a>  <span class="comment"> * structure step that will generate the roles.xml containing the</span>
<a name="l623"><span class="linenum"> 623</span></a>  <span class="comment"> * list of roles used along the whole backup process. Just raw</span>
<a name="l624"><span class="linenum"> 624</span></a>  <span class="comment"> * list of used roles from role table</span>
<a name="l625"><span class="linenum"> 625</span></a>  <span class="comment"> */</span>
<a name="l626"><span class="linenum"> 626</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_final_roles_structure_step')" href="../../_classes/backup_final_roles_structure_step.html" onMouseOver="classPopup(event,'backup_final_roles_structure_step')">backup_final_roles_structure_step</a> extends backup_structure_step {
<a name="l627"><span class="linenum"> 627</span></a>  
<a name="l628"><span class="linenum"> 628</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l629"><span class="linenum"> 629</span></a>  
<a name="l630"><span class="linenum"> 630</span></a>  <span class="comment">        // Define elements</span>
<a name="l631"><span class="linenum"> 631</span></a>  
<a name="l632"><span class="linenum"> 632</span></a>          <a class="var it6031" onMouseOver="hilite(6031)" onMouseOut="lolite()" onClick="logVariable('rolesdef')" href="../../_variables/rolesdef.html">$rolesdef</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('roles_definition');
<a name="l633"><span class="linenum"> 633</span></a>  
<a name="l634"><span class="linenum"> 634</span></a>          <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../_variables/role.html">$role</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('role', array('id'), array(
<a name="l635"><span class="linenum"> 635</span></a>              'name', 'shortname', 'nameincourse', 'description',
<a name="l636"><span class="linenum"> 636</span></a>              'sortorder', 'archetype'));
<a name="l637"><span class="linenum"> 637</span></a>  
<a name="l638"><span class="linenum"> 638</span></a>  <span class="comment">        // Build the tree</span>
<a name="l639"><span class="linenum"> 639</span></a>  
<a name="l640"><span class="linenum"> 640</span></a>          <a class="var it6031" onMouseOver="hilite(6031)" onMouseOut="lolite()" onClick="logVariable('rolesdef')" href="../../_variables/rolesdef.html">$rolesdef</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../_variables/role.html">$role</a>);
<a name="l641"><span class="linenum"> 641</span></a>  
<a name="l642"><span class="linenum"> 642</span></a>  <span class="comment">        // Define sources</span>
<a name="l643"><span class="linenum"> 643</span></a>  
<a name="l644"><span class="linenum"> 644</span></a>          <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../_variables/role.html">$role</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;SELECT r.*, rn.name AS nameincourse
<a name="l645"><span class="linenum"> 645</span></a>                                   FROM {role} r
<a name="l646"><span class="linenum"> 646</span></a>                                   JOIN {backup_ids_temp} bi ON r.id = bi.itemid
<a name="l647"><span class="linenum"> 647</span></a>                              LEFT JOIN {role_names} rn ON r.id = rn.roleid AND rn.contextid = ?
<a name="l648"><span class="linenum"> 648</span></a>                                  WHERE bi.backupid = ?
<a name="l649"><span class="linenum"> 649</span></a>                                    AND bi.itemname = 'rolefinal'&quot;, array(backup::VAR_CONTEXTID, backup::VAR_BACKUPID));
<a name="l650"><span class="linenum"> 650</span></a>  
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">        // Return main element (rolesdef)</span>
<a name="l652"><span class="linenum"> 652</span></a>          return <a class="var it6031" onMouseOver="hilite(6031)" onMouseOut="lolite()" onClick="logVariable('rolesdef')" href="../../_variables/rolesdef.html">$rolesdef</a>;
<a name="l653"><span class="linenum"> 653</span></a>      }
<a name="l654"><span class="linenum"> 654</span></a>  }
<a name="l655"><span class="linenum"> 655</span></a>  
<a name="l656"><span class="linenum"> 656</span></a>  <span class="comment">/**</span>
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment"> * structure step that will generate the scales.xml containing the</span>
<a name="l658"><span class="linenum"> 658</span></a>  <span class="comment"> * list of scales used along the whole backup process.</span>
<a name="l659"><span class="linenum"> 659</span></a>  <span class="comment"> */</span>
<a name="l660"><span class="linenum"> 660</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_final_scales_structure_step')" href="../../_classes/backup_final_scales_structure_step.html" onMouseOver="classPopup(event,'backup_final_scales_structure_step')">backup_final_scales_structure_step</a> extends backup_structure_step {
<a name="l661"><span class="linenum"> 661</span></a>  
<a name="l662"><span class="linenum"> 662</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l663"><span class="linenum"> 663</span></a>  
<a name="l664"><span class="linenum"> 664</span></a>  <span class="comment">        // Define elements</span>
<a name="l665"><span class="linenum"> 665</span></a>  
<a name="l666"><span class="linenum"> 666</span></a>          <a class="var it6032" onMouseOver="hilite(6032)" onMouseOut="lolite()" onClick="logVariable('scalesdef')" href="../../_variables/scalesdef.html">$scalesdef</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('scales_definition');
<a name="l667"><span class="linenum"> 667</span></a>  
<a name="l668"><span class="linenum"> 668</span></a>          <a class="var it1939" onMouseOver="hilite(1939)" onMouseOut="lolite()" onClick="logVariable('scale')" href="../../_variables/scale.html">$scale</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('scale', array('id'), array(
<a name="l669"><span class="linenum"> 669</span></a>              'courseid', 'userid', 'name', 'scale',
<a name="l670"><span class="linenum"> 670</span></a>              'description', 'descriptionformat', 'timemodified'));
<a name="l671"><span class="linenum"> 671</span></a>  
<a name="l672"><span class="linenum"> 672</span></a>  <span class="comment">        // Build the tree</span>
<a name="l673"><span class="linenum"> 673</span></a>  
<a name="l674"><span class="linenum"> 674</span></a>          <a class="var it6032" onMouseOver="hilite(6032)" onMouseOut="lolite()" onClick="logVariable('scalesdef')" href="../../_variables/scalesdef.html">$scalesdef</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1939" onMouseOver="hilite(1939)" onMouseOut="lolite()" onClick="logVariable('scale')" href="../../_variables/scale.html">$scale</a>);
<a name="l675"><span class="linenum"> 675</span></a>  
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment">        // Define sources</span>
<a name="l677"><span class="linenum"> 677</span></a>  
<a name="l678"><span class="linenum"> 678</span></a>          <a class="var it1939" onMouseOver="hilite(1939)" onMouseOut="lolite()" onClick="logVariable('scale')" href="../../_variables/scale.html">$scale</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;SELECT s.*
<a name="l679"><span class="linenum"> 679</span></a>                                    FROM {scale} s
<a name="l680"><span class="linenum"> 680</span></a>                                    JOIN {backup_ids_temp} bi ON s.id = bi.itemid
<a name="l681"><span class="linenum"> 681</span></a>                                   WHERE bi.backupid = ?
<a name="l682"><span class="linenum"> 682</span></a>                                     AND bi.itemname = 'scalefinal'&quot;, array(backup::VAR_BACKUPID));
<a name="l683"><span class="linenum"> 683</span></a>  
<a name="l684"><span class="linenum"> 684</span></a>  <span class="comment">        // Annotate scale files (they store files in system context, so pass it instead of default one)</span>
<a name="l685"><span class="linenum"> 685</span></a>          <a class="var it1939" onMouseOver="hilite(1939)" onMouseOut="lolite()" onClick="logVariable('scale')" href="../../_variables/scale.html">$scale</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('grade', 'scale', 'id', <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;id);
<a name="l686"><span class="linenum"> 686</span></a>  
<a name="l687"><span class="linenum"> 687</span></a>  <span class="comment">        // Return main element (scalesdef)</span>
<a name="l688"><span class="linenum"> 688</span></a>          return <a class="var it6032" onMouseOver="hilite(6032)" onMouseOut="lolite()" onClick="logVariable('scalesdef')" href="../../_variables/scalesdef.html">$scalesdef</a>;
<a name="l689"><span class="linenum"> 689</span></a>      }
<a name="l690"><span class="linenum"> 690</span></a>  }
<a name="l691"><span class="linenum"> 691</span></a>  
<a name="l692"><span class="linenum"> 692</span></a>  <span class="comment">/**</span>
<a name="l693"><span class="linenum"> 693</span></a>  <span class="comment"> * structure step that will generate the outcomes.xml containing the</span>
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment"> * list of outcomes used along the whole backup process.</span>
<a name="l695"><span class="linenum"> 695</span></a>  <span class="comment"> */</span>
<a name="l696"><span class="linenum"> 696</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_final_outcomes_structure_step')" href="../../_classes/backup_final_outcomes_structure_step.html" onMouseOver="classPopup(event,'backup_final_outcomes_structure_step')">backup_final_outcomes_structure_step</a> extends backup_structure_step {
<a name="l697"><span class="linenum"> 697</span></a>  
<a name="l698"><span class="linenum"> 698</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l699"><span class="linenum"> 699</span></a>  
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment">        // Define elements</span>
<a name="l701"><span class="linenum"> 701</span></a>  
<a name="l702"><span class="linenum"> 702</span></a>          <a class="var it6033" onMouseOver="hilite(6033)" onMouseOut="lolite()" onClick="logVariable('outcomesdef')" href="../../_variables/outcomesdef.html">$outcomesdef</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('outcomes_definition');
<a name="l703"><span class="linenum"> 703</span></a>  
<a name="l704"><span class="linenum"> 704</span></a>          <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('outcome', array('id'), array(
<a name="l705"><span class="linenum"> 705</span></a>              'courseid', 'userid', 'shortname', 'fullname',
<a name="l706"><span class="linenum"> 706</span></a>              'scaleid', 'description', 'descriptionformat', 'timecreated',
<a name="l707"><span class="linenum"> 707</span></a>              'timemodified','usermodified'));
<a name="l708"><span class="linenum"> 708</span></a>  
<a name="l709"><span class="linenum"> 709</span></a>  <span class="comment">        // Build the tree</span>
<a name="l710"><span class="linenum"> 710</span></a>  
<a name="l711"><span class="linenum"> 711</span></a>          <a class="var it6033" onMouseOver="hilite(6033)" onMouseOut="lolite()" onClick="logVariable('outcomesdef')" href="../../_variables/outcomesdef.html">$outcomesdef</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a>);
<a name="l712"><span class="linenum"> 712</span></a>  
<a name="l713"><span class="linenum"> 713</span></a>  <span class="comment">        // Define sources</span>
<a name="l714"><span class="linenum"> 714</span></a>  
<a name="l715"><span class="linenum"> 715</span></a>          <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;SELECT o.*
<a name="l716"><span class="linenum"> 716</span></a>                                      FROM {grade_outcomes} o
<a name="l717"><span class="linenum"> 717</span></a>                                      JOIN {backup_ids_temp} bi ON o.id = bi.itemid
<a name="l718"><span class="linenum"> 718</span></a>                                     WHERE bi.backupid = ?
<a name="l719"><span class="linenum"> 719</span></a>                                       AND bi.itemname = 'outcomefinal'&quot;, array(backup::VAR_BACKUPID));
<a name="l720"><span class="linenum"> 720</span></a>  
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment">        // Annotate outcome files (they store files in system context, so pass it instead of default one)</span>
<a name="l722"><span class="linenum"> 722</span></a>          <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('grade', 'outcome', 'id', <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;id);
<a name="l723"><span class="linenum"> 723</span></a>  
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment">        // Return main element (outcomesdef)</span>
<a name="l725"><span class="linenum"> 725</span></a>          return <a class="var it6033" onMouseOver="hilite(6033)" onMouseOut="lolite()" onClick="logVariable('outcomesdef')" href="../../_variables/outcomesdef.html">$outcomesdef</a>;
<a name="l726"><span class="linenum"> 726</span></a>      }
<a name="l727"><span class="linenum"> 727</span></a>  }
<a name="l728"><span class="linenum"> 728</span></a>  
<a name="l729"><span class="linenum"> 729</span></a>  <span class="comment">/**</span>
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment"> * structure step in charge of constructing the filters.xml file for all the filters found</span>
<a name="l731"><span class="linenum"> 731</span></a>  <span class="comment"> * in activity</span>
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment"> */</span>
<a name="l733"><span class="linenum"> 733</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_filters_structure_step')" href="../../_classes/backup_filters_structure_step.html" onMouseOver="classPopup(event,'backup_filters_structure_step')">backup_filters_structure_step</a> extends backup_structure_step {
<a name="l734"><span class="linenum"> 734</span></a>  
<a name="l735"><span class="linenum"> 735</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l736"><span class="linenum"> 736</span></a>  
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l738"><span class="linenum"> 738</span></a>  
<a name="l739"><span class="linenum"> 739</span></a>          <a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('filters');
<a name="l740"><span class="linenum"> 740</span></a>  
<a name="l741"><span class="linenum"> 741</span></a>          <a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('actives')" href="../../_variables/actives.html">$actives</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('filter_actives');
<a name="l742"><span class="linenum"> 742</span></a>  
<a name="l743"><span class="linenum"> 743</span></a>          <a class="var it4666" onMouseOver="hilite(4666)" onMouseOut="lolite()" onClick="logVariable('active')" href="../../_variables/active.html">$active</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('filter_active', null, array('filter', 'active'));
<a name="l744"><span class="linenum"> 744</span></a>  
<a name="l745"><span class="linenum"> 745</span></a>          <a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('configs')" href="../../_variables/configs.html">$configs</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('filter_configs');
<a name="l746"><span class="linenum"> 746</span></a>  
<a name="l747"><span class="linenum"> 747</span></a>          <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('filter_config', null, array('filter', 'name', 'value'));
<a name="l748"><span class="linenum"> 748</span></a>  
<a name="l749"><span class="linenum"> 749</span></a>  <span class="comment">        // Build the tree</span>
<a name="l750"><span class="linenum"> 750</span></a>  
<a name="l751"><span class="linenum"> 751</span></a>          <a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('actives')" href="../../_variables/actives.html">$actives</a>);
<a name="l752"><span class="linenum"> 752</span></a>          <a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('configs')" href="../../_variables/configs.html">$configs</a>);
<a name="l753"><span class="linenum"> 753</span></a>  
<a name="l754"><span class="linenum"> 754</span></a>          <a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('actives')" href="../../_variables/actives.html">$actives</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it4666" onMouseOver="hilite(4666)" onMouseOut="lolite()" onClick="logVariable('active')" href="../../_variables/active.html">$active</a>);
<a name="l755"><span class="linenum"> 755</span></a>          <a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('configs')" href="../../_variables/configs.html">$configs</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>);
<a name="l756"><span class="linenum"> 756</span></a>  
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment">        // Define sources</span>
<a name="l758"><span class="linenum"> 758</span></a>  
<a name="l759"><span class="linenum"> 759</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it6036" onMouseOver="hilite(6036)" onMouseOut="lolite()" onClick="logVariable('activearr')" href="../../_variables/activearr.html">$activearr</a>, <a class="var it6037" onMouseOver="hilite(6037)" onMouseOut="lolite()" onClick="logVariable('configarr')" href="../../_variables/configarr.html">$configarr</a>) = <a class="function" onClick="logFunction('filter_get_all_local_settings')" href="../../_functions/filter_get_all_local_settings.html" onMouseOver="funcPopup(event,'filter_get_all_local_settings')">filter_get_all_local_settings</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>());
<a name="l760"><span class="linenum"> 760</span></a>  
<a name="l761"><span class="linenum"> 761</span></a>          <a class="var it4666" onMouseOver="hilite(4666)" onMouseOut="lolite()" onClick="logVariable('active')" href="../../_variables/active.html">$active</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(<a class="var it6036" onMouseOver="hilite(6036)" onMouseOut="lolite()" onClick="logVariable('activearr')" href="../../_variables/activearr.html">$activearr</a>);
<a name="l762"><span class="linenum"> 762</span></a>          <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(<a class="var it6037" onMouseOver="hilite(6037)" onMouseOut="lolite()" onClick="logVariable('configarr')" href="../../_variables/configarr.html">$configarr</a>);
<a name="l763"><span class="linenum"> 763</span></a>  
<a name="l764"><span class="linenum"> 764</span></a>  <span class="comment">        // Return the root element (filters)</span>
<a name="l765"><span class="linenum"> 765</span></a>          return <a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>;
<a name="l766"><span class="linenum"> 766</span></a>      }
<a name="l767"><span class="linenum"> 767</span></a>  }
<a name="l768"><span class="linenum"> 768</span></a>  
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment">/**</span>
<a name="l770"><span class="linenum"> 770</span></a>  <span class="comment"> * structure step in charge of constructing the comments.xml file for all the comments found</span>
<a name="l771"><span class="linenum"> 771</span></a>  <span class="comment"> * in a given context</span>
<a name="l772"><span class="linenum"> 772</span></a>  <span class="comment"> */</span>
<a name="l773"><span class="linenum"> 773</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_comments_structure_step')" href="../../_classes/backup_comments_structure_step.html" onMouseOver="classPopup(event,'backup_comments_structure_step')">backup_comments_structure_step</a> extends backup_structure_step {
<a name="l774"><span class="linenum"> 774</span></a>  
<a name="l775"><span class="linenum"> 775</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l776"><span class="linenum"> 776</span></a>  
<a name="l777"><span class="linenum"> 777</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l778"><span class="linenum"> 778</span></a>  
<a name="l779"><span class="linenum"> 779</span></a>          <a class="var it3670" onMouseOver="hilite(3670)" onMouseOut="lolite()" onClick="logVariable('comments')" href="../../_variables/comments.html">$comments</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('comments');
<a name="l780"><span class="linenum"> 780</span></a>  
<a name="l781"><span class="linenum"> 781</span></a>          <a class="var it1145" onMouseOver="hilite(1145)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../_variables/comment.html">$comment</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('comment', array('id'), array(
<a name="l782"><span class="linenum"> 782</span></a>              'commentarea', 'itemid', 'content', 'format',
<a name="l783"><span class="linenum"> 783</span></a>              'userid', 'timecreated'));
<a name="l784"><span class="linenum"> 784</span></a>  
<a name="l785"><span class="linenum"> 785</span></a>  <span class="comment">        // Build the tree</span>
<a name="l786"><span class="linenum"> 786</span></a>  
<a name="l787"><span class="linenum"> 787</span></a>          <a class="var it3670" onMouseOver="hilite(3670)" onMouseOut="lolite()" onClick="logVariable('comments')" href="../../_variables/comments.html">$comments</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1145" onMouseOver="hilite(1145)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../_variables/comment.html">$comment</a>);
<a name="l788"><span class="linenum"> 788</span></a>  
<a name="l789"><span class="linenum"> 789</span></a>  <span class="comment">        // Define sources</span>
<a name="l790"><span class="linenum"> 790</span></a>  
<a name="l791"><span class="linenum"> 791</span></a>          <a class="var it1145" onMouseOver="hilite(1145)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../_variables/comment.html">$comment</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('comments', array('contextid' =&gt; backup::VAR_CONTEXTID));
<a name="l792"><span class="linenum"> 792</span></a>  
<a name="l793"><span class="linenum"> 793</span></a>  <span class="comment">        // Define id annotations</span>
<a name="l794"><span class="linenum"> 794</span></a>  
<a name="l795"><span class="linenum"> 795</span></a>          <a class="var it1145" onMouseOver="hilite(1145)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../_variables/comment.html">$comment</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l796"><span class="linenum"> 796</span></a>  
<a name="l797"><span class="linenum"> 797</span></a>  <span class="comment">        // Return the root element (comments)</span>
<a name="l798"><span class="linenum"> 798</span></a>          return <a class="var it3670" onMouseOver="hilite(3670)" onMouseOut="lolite()" onClick="logVariable('comments')" href="../../_variables/comments.html">$comments</a>;
<a name="l799"><span class="linenum"> 799</span></a>      }
<a name="l800"><span class="linenum"> 800</span></a>  }
<a name="l801"><span class="linenum"> 801</span></a>  
<a name="l802"><span class="linenum"> 802</span></a>  <span class="comment">/**</span>
<a name="l803"><span class="linenum"> 803</span></a>  <span class="comment"> * structure step in charge of constructing the badges.xml file for all the badges found</span>
<a name="l804"><span class="linenum"> 804</span></a>  <span class="comment"> * in a given context</span>
<a name="l805"><span class="linenum"> 805</span></a>  <span class="comment"> */</span>
<a name="l806"><span class="linenum"> 806</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_badges_structure_step')" href="../../_classes/backup_badges_structure_step.html" onMouseOver="classPopup(event,'backup_badges_structure_step')">backup_badges_structure_step</a> extends backup_structure_step {
<a name="l807"><span class="linenum"> 807</span></a>  
<a name="l808"><span class="linenum"> 808</span></a>      protected function <a class="function" onClick="logFunction('execute_condition')" href="../../_functions/execute_condition.html" onMouseOver="funcPopup(event,'execute_condition')">execute_condition</a>() {
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment">        // Check that all activities have been included.</span>
<a name="l810"><span class="linenum"> 810</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('is_excluding_activities')" href="../../_functions/is_excluding_activities.html" onMouseOver="funcPopup(event,'is_excluding_activities')">is_excluding_activities</a>()) {
<a name="l811"><span class="linenum"> 811</span></a>              return false;
<a name="l812"><span class="linenum"> 812</span></a>          }
<a name="l813"><span class="linenum"> 813</span></a>          return true;
<a name="l814"><span class="linenum"> 814</span></a>      }
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l817"><span class="linenum"> 817</span></a>  
<a name="l818"><span class="linenum"> 818</span></a>  <span class="comment">        // Define each element separated.</span>
<a name="l819"><span class="linenum"> 819</span></a>  
<a name="l820"><span class="linenum"> 820</span></a>          <a class="var it5240" onMouseOver="hilite(5240)" onMouseOut="lolite()" onClick="logVariable('badges')" href="../../_variables/badges.html">$badges</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('badges');
<a name="l821"><span class="linenum"> 821</span></a>          <a class="var it1718" onMouseOver="hilite(1718)" onMouseOut="lolite()" onClick="logVariable('badge')" href="../../_variables/badge.html">$badge</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('badge', array('id'), array('name', 'description',
<a name="l822"><span class="linenum"> 822</span></a>                  'timecreated', 'timemodified', 'usercreated', 'usermodified', 'issuername',
<a name="l823"><span class="linenum"> 823</span></a>                  'issuerurl', 'issuercontact', 'expiredate', 'expireperiod', 'type', 'courseid',
<a name="l824"><span class="linenum"> 824</span></a>                  'message', 'messagesubject', 'attachment', 'notification', 'status', 'nextcron'));
<a name="l825"><span class="linenum"> 825</span></a>  
<a name="l826"><span class="linenum"> 826</span></a>          <a class="var it1624" onMouseOver="hilite(1624)" onMouseOut="lolite()" onClick="logVariable('criteria')" href="../../_variables/criteria.html">$criteria</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('criteria');
<a name="l827"><span class="linenum"> 827</span></a>          <a class="var it1609" onMouseOver="hilite(1609)" onMouseOut="lolite()" onClick="logVariable('criterion')" href="../../_variables/criterion.html">$criterion</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('criterion', array('id'), array('badgeid',
<a name="l828"><span class="linenum"> 828</span></a>                  'criteriatype', 'method', 'description', 'descriptionformat'));
<a name="l829"><span class="linenum"> 829</span></a>  
<a name="l830"><span class="linenum"> 830</span></a>          <a class="var it343" onMouseOver="hilite(343)" onMouseOut="lolite()" onClick="logVariable('parameters')" href="../../_variables/parameters.html">$parameters</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('parameters');
<a name="l831"><span class="linenum"> 831</span></a>          <a class="var it775" onMouseOver="hilite(775)" onMouseOut="lolite()" onClick="logVariable('parameter')" href="../../_variables/parameter.html">$parameter</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('parameter', array('id'), array('critid',
<a name="l832"><span class="linenum"> 832</span></a>                  'name', 'value', 'criteriatype'));
<a name="l833"><span class="linenum"> 833</span></a>  
<a name="l834"><span class="linenum"> 834</span></a>          <a class="var it6038" onMouseOver="hilite(6038)" onMouseOut="lolite()" onClick="logVariable('manual_awards')" href="../../_variables/manual_awards.html">$manual_awards</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('manual_awards');
<a name="l835"><span class="linenum"> 835</span></a>          <a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('manual_award')" href="../../_variables/manual_award.html">$manual_award</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('manual_award', array('id'), array('badgeid',
<a name="l836"><span class="linenum"> 836</span></a>                  'recipientid', 'issuerid', 'issuerrole', 'datemet'));
<a name="l837"><span class="linenum"> 837</span></a>  
<a name="l838"><span class="linenum"> 838</span></a>  <span class="comment">        // Build the tree.</span>
<a name="l839"><span class="linenum"> 839</span></a>  
<a name="l840"><span class="linenum"> 840</span></a>          <a class="var it5240" onMouseOver="hilite(5240)" onMouseOut="lolite()" onClick="logVariable('badges')" href="../../_variables/badges.html">$badges</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1718" onMouseOver="hilite(1718)" onMouseOut="lolite()" onClick="logVariable('badge')" href="../../_variables/badge.html">$badge</a>);
<a name="l841"><span class="linenum"> 841</span></a>          <a class="var it1718" onMouseOver="hilite(1718)" onMouseOut="lolite()" onClick="logVariable('badge')" href="../../_variables/badge.html">$badge</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1624" onMouseOver="hilite(1624)" onMouseOut="lolite()" onClick="logVariable('criteria')" href="../../_variables/criteria.html">$criteria</a>);
<a name="l842"><span class="linenum"> 842</span></a>          <a class="var it1624" onMouseOver="hilite(1624)" onMouseOut="lolite()" onClick="logVariable('criteria')" href="../../_variables/criteria.html">$criteria</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1609" onMouseOver="hilite(1609)" onMouseOut="lolite()" onClick="logVariable('criterion')" href="../../_variables/criterion.html">$criterion</a>);
<a name="l843"><span class="linenum"> 843</span></a>          <a class="var it1609" onMouseOver="hilite(1609)" onMouseOut="lolite()" onClick="logVariable('criterion')" href="../../_variables/criterion.html">$criterion</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it343" onMouseOver="hilite(343)" onMouseOut="lolite()" onClick="logVariable('parameters')" href="../../_variables/parameters.html">$parameters</a>);
<a name="l844"><span class="linenum"> 844</span></a>          <a class="var it343" onMouseOver="hilite(343)" onMouseOut="lolite()" onClick="logVariable('parameters')" href="../../_variables/parameters.html">$parameters</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it775" onMouseOver="hilite(775)" onMouseOut="lolite()" onClick="logVariable('parameter')" href="../../_variables/parameter.html">$parameter</a>);
<a name="l845"><span class="linenum"> 845</span></a>          <a class="var it1718" onMouseOver="hilite(1718)" onMouseOut="lolite()" onClick="logVariable('badge')" href="../../_variables/badge.html">$badge</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6038" onMouseOver="hilite(6038)" onMouseOut="lolite()" onClick="logVariable('manual_awards')" href="../../_variables/manual_awards.html">$manual_awards</a>);
<a name="l846"><span class="linenum"> 846</span></a>          <a class="var it6038" onMouseOver="hilite(6038)" onMouseOut="lolite()" onClick="logVariable('manual_awards')" href="../../_variables/manual_awards.html">$manual_awards</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('manual_award')" href="../../_variables/manual_award.html">$manual_award</a>);
<a name="l847"><span class="linenum"> 847</span></a>  
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment">        // Define sources.</span>
<a name="l849"><span class="linenum"> 849</span></a>  
<a name="l850"><span class="linenum"> 850</span></a>          <a class="var it1718" onMouseOver="hilite(1718)" onMouseOut="lolite()" onClick="logVariable('badge')" href="../../_variables/badge.html">$badge</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('badge', array('courseid' =&gt; backup::VAR_COURSEID));
<a name="l851"><span class="linenum"> 851</span></a>          <a class="var it1609" onMouseOver="hilite(1609)" onMouseOut="lolite()" onClick="logVariable('criterion')" href="../../_variables/criterion.html">$criterion</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('badge_criteria', array('badgeid' =&gt; backup::VAR_PARENTID));
<a name="l852"><span class="linenum"> 852</span></a>  
<a name="l853"><span class="linenum"> 853</span></a>          <a class="var it6040" onMouseOver="hilite(6040)" onMouseOut="lolite()" onClick="logVariable('parametersql')" href="../../_variables/parametersql.html">$parametersql</a> = 'SELECT cp.*, c.criteriatype
<a name="l854"><span class="linenum"> 854</span></a>                               FROM {badge_criteria_param} cp JOIN {badge_criteria} c
<a name="l855"><span class="linenum"> 855</span></a>                                   ON cp.critid = c.id
<a name="l856"><span class="linenum"> 856</span></a>                               WHERE critid = :critid';
<a name="l857"><span class="linenum"> 857</span></a>          <a class="var it6041" onMouseOver="hilite(6041)" onMouseOut="lolite()" onClick="logVariable('parameterparams')" href="../../_variables/parameterparams.html">$parameterparams</a> = array('critid' =&gt; backup::VAR_PARENTID);
<a name="l858"><span class="linenum"> 858</span></a>          <a class="var it775" onMouseOver="hilite(775)" onMouseOut="lolite()" onClick="logVariable('parameter')" href="../../_variables/parameter.html">$parameter</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(<a class="var it6040" onMouseOver="hilite(6040)" onMouseOut="lolite()" onClick="logVariable('parametersql')" href="../../_variables/parametersql.html">$parametersql</a>, <a class="var it6041" onMouseOver="hilite(6041)" onMouseOut="lolite()" onClick="logVariable('parameterparams')" href="../../_variables/parameterparams.html">$parameterparams</a>);
<a name="l859"><span class="linenum"> 859</span></a>  
<a name="l860"><span class="linenum"> 860</span></a>          <a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('manual_award')" href="../../_variables/manual_award.html">$manual_award</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('badge_manual_award', array('badgeid' =&gt; backup::VAR_PARENTID));
<a name="l861"><span class="linenum"> 861</span></a>  
<a name="l862"><span class="linenum"> 862</span></a>  <span class="comment">        // Define id annotations.</span>
<a name="l863"><span class="linenum"> 863</span></a>  
<a name="l864"><span class="linenum"> 864</span></a>          <a class="var it1718" onMouseOver="hilite(1718)" onMouseOut="lolite()" onClick="logVariable('badge')" href="../../_variables/badge.html">$badge</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'usercreated');
<a name="l865"><span class="linenum"> 865</span></a>          <a class="var it1718" onMouseOver="hilite(1718)" onMouseOut="lolite()" onClick="logVariable('badge')" href="../../_variables/badge.html">$badge</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'usermodified');
<a name="l866"><span class="linenum"> 866</span></a>          <a class="var it1609" onMouseOver="hilite(1609)" onMouseOut="lolite()" onClick="logVariable('criterion')" href="../../_variables/criterion.html">$criterion</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('badge', 'badgeid');
<a name="l867"><span class="linenum"> 867</span></a>          <a class="var it775" onMouseOver="hilite(775)" onMouseOut="lolite()" onClick="logVariable('parameter')" href="../../_variables/parameter.html">$parameter</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('criterion', 'critid');
<a name="l868"><span class="linenum"> 868</span></a>          <a class="var it1718" onMouseOver="hilite(1718)" onMouseOut="lolite()" onClick="logVariable('badge')" href="../../_variables/badge.html">$badge</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('badges', 'badgeimage', 'id');
<a name="l869"><span class="linenum"> 869</span></a>          <a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('manual_award')" href="../../_variables/manual_award.html">$manual_award</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('badge', 'badgeid');
<a name="l870"><span class="linenum"> 870</span></a>          <a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('manual_award')" href="../../_variables/manual_award.html">$manual_award</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'recipientid');
<a name="l871"><span class="linenum"> 871</span></a>          <a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('manual_award')" href="../../_variables/manual_award.html">$manual_award</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'issuerid');
<a name="l872"><span class="linenum"> 872</span></a>          <a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('manual_award')" href="../../_variables/manual_award.html">$manual_award</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('role', 'issuerrole');
<a name="l873"><span class="linenum"> 873</span></a>  
<a name="l874"><span class="linenum"> 874</span></a>  <span class="comment">        // Return the root element ($badges).</span>
<a name="l875"><span class="linenum"> 875</span></a>          return <a class="var it5240" onMouseOver="hilite(5240)" onMouseOut="lolite()" onClick="logVariable('badges')" href="../../_variables/badges.html">$badges</a>;
<a name="l876"><span class="linenum"> 876</span></a>      }
<a name="l877"><span class="linenum"> 877</span></a>  }
<a name="l878"><span class="linenum"> 878</span></a>  
<a name="l879"><span class="linenum"> 879</span></a>  <span class="comment">/**</span>
<a name="l880"><span class="linenum"> 880</span></a>  <span class="comment"> * structure step in charge of constructing the calender.xml file for all the events found</span>
<a name="l881"><span class="linenum"> 881</span></a>  <span class="comment"> * in a given context</span>
<a name="l882"><span class="linenum"> 882</span></a>  <span class="comment"> */</span>
<a name="l883"><span class="linenum"> 883</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_calendarevents_structure_step')" href="../../_classes/backup_calendarevents_structure_step.html" onMouseOver="classPopup(event,'backup_calendarevents_structure_step')">backup_calendarevents_structure_step</a> extends backup_structure_step {
<a name="l884"><span class="linenum"> 884</span></a>  
<a name="l885"><span class="linenum"> 885</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l886"><span class="linenum"> 886</span></a>  
<a name="l887"><span class="linenum"> 887</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l888"><span class="linenum"> 888</span></a>  
<a name="l889"><span class="linenum"> 889</span></a>          <a class="var it178" onMouseOver="hilite(178)" onMouseOut="lolite()" onClick="logVariable('events')" href="../../_variables/events.html">$events</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('events');
<a name="l890"><span class="linenum"> 890</span></a>  
<a name="l891"><span class="linenum"> 891</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('event', array('id'), array(
<a name="l892"><span class="linenum"> 892</span></a>                  'name', 'description', 'format', 'courseid', 'groupid', 'userid',
<a name="l893"><span class="linenum"> 893</span></a>                  'repeatid', 'modulename', 'instance', 'eventtype', 'timestart',
<a name="l894"><span class="linenum"> 894</span></a>                  'timeduration', 'visible', 'uuid', 'sequence', 'timemodified'));
<a name="l895"><span class="linenum"> 895</span></a>  
<a name="l896"><span class="linenum"> 896</span></a>  <span class="comment">        // Build the tree</span>
<a name="l897"><span class="linenum"> 897</span></a>          <a class="var it178" onMouseOver="hilite(178)" onMouseOut="lolite()" onClick="logVariable('events')" href="../../_variables/events.html">$events</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l898"><span class="linenum"> 898</span></a>  
<a name="l899"><span class="linenum"> 899</span></a>  <span class="comment">        // Define sources</span>
<a name="l900"><span class="linenum"> 900</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('name')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> == 'course_calendar') {
<a name="l901"><span class="linenum"> 901</span></a>              <a class="var it6042" onMouseOver="hilite(6042)" onMouseOut="lolite()" onClick="logVariable('calendar_items_sql')" href="../../_variables/calendar_items_sql.html">$calendar_items_sql</a> =&quot;SELECT * FROM {event}
<a name="l902"><span class="linenum"> 902</span></a>                          WHERE courseid = :courseid
<a name="l903"><span class="linenum"> 903</span></a>                          AND (eventtype = 'course' OR eventtype = 'group')&quot;;
<a name="l904"><span class="linenum"> 904</span></a>              <a class="var it6043" onMouseOver="hilite(6043)" onMouseOut="lolite()" onClick="logVariable('calendar_items_params')" href="../../_variables/calendar_items_params.html">$calendar_items_params</a> = array('courseid'=&gt;backup::VAR_COURSEID);
<a name="l905"><span class="linenum"> 905</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(<a class="var it6042" onMouseOver="hilite(6042)" onMouseOut="lolite()" onClick="logVariable('calendar_items_sql')" href="../../_variables/calendar_items_sql.html">$calendar_items_sql</a>, <a class="var it6043" onMouseOver="hilite(6043)" onMouseOut="lolite()" onClick="logVariable('calendar_items_params')" href="../../_variables/calendar_items_params.html">$calendar_items_params</a>);
<a name="l906"><span class="linenum"> 906</span></a>          } else {
<a name="l907"><span class="linenum"> 907</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('event', array('courseid' =&gt; backup::VAR_COURSEID, 'instance' =&gt; backup::VAR_ACTIVITYID, 'modulename' =&gt; backup::VAR_MODNAME));
<a name="l908"><span class="linenum"> 908</span></a>          }
<a name="l909"><span class="linenum"> 909</span></a>  
<a name="l910"><span class="linenum"> 910</span></a>  <span class="comment">        // Define id annotations</span>
<a name="l911"><span class="linenum"> 911</span></a>  
<a name="l912"><span class="linenum"> 912</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l913"><span class="linenum"> 913</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('group', 'groupid');
<a name="l914"><span class="linenum"> 914</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('calendar', 'event_description', 'id');
<a name="l915"><span class="linenum"> 915</span></a>  
<a name="l916"><span class="linenum"> 916</span></a>  <span class="comment">        // Return the root element (events)</span>
<a name="l917"><span class="linenum"> 917</span></a>          return <a class="var it178" onMouseOver="hilite(178)" onMouseOut="lolite()" onClick="logVariable('events')" href="../../_variables/events.html">$events</a>;
<a name="l918"><span class="linenum"> 918</span></a>      }
<a name="l919"><span class="linenum"> 919</span></a>  }
<a name="l920"><span class="linenum"> 920</span></a>  
<a name="l921"><span class="linenum"> 921</span></a>  <span class="comment">/**</span>
<a name="l922"><span class="linenum"> 922</span></a>  <span class="comment"> * structure step in charge of constructing the gradebook.xml file for all the gradebook config in the course</span>
<a name="l923"><span class="linenum"> 923</span></a>  <span class="comment"> * NOTE: the backup of the grade items themselves is handled by backup_activity_grades_structure_step</span>
<a name="l924"><span class="linenum"> 924</span></a>  <span class="comment"> */</span>
<a name="l925"><span class="linenum"> 925</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_gradebook_structure_step')" href="../../_classes/backup_gradebook_structure_step.html" onMouseOver="classPopup(event,'backup_gradebook_structure_step')">backup_gradebook_structure_step</a> extends backup_structure_step {
<a name="l926"><span class="linenum"> 926</span></a>  
<a name="l927"><span class="linenum"> 927</span></a>      <span class="comment">/**</span>
<a name="l928"><span class="linenum"> 928</span></a>  <span class="comment">     * We need to decide conditionally, based on dynamic information</span>
<a name="l929"><span class="linenum"> 929</span></a>  <span class="comment">     * about the execution of this step. Only will be executed if all</span>
<a name="l930"><span class="linenum"> 930</span></a>  <span class="comment">     * the module gradeitems have been already included in backup</span>
<a name="l931"><span class="linenum"> 931</span></a>  <span class="comment">     */</span>
<a name="l932"><span class="linenum"> 932</span></a>      protected function <a class="function" onClick="logFunction('execute_condition')" href="../../_functions/execute_condition.html" onMouseOver="funcPopup(event,'execute_condition')">execute_condition</a>() {
<a name="l933"><span class="linenum"> 933</span></a>          <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>();
<a name="l934"><span class="linenum"> 934</span></a>          if (<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l935"><span class="linenum"> 935</span></a>              return false;
<a name="l936"><span class="linenum"> 936</span></a>          }
<a name="l937"><span class="linenum"> 937</span></a>  
<a name="l938"><span class="linenum"> 938</span></a>          return backup_plan_dbops::<a class="function" onClick="logFunction('require_gradebook_backup')" href="../../_functions/require_gradebook_backup.html" onMouseOver="funcPopup(event,'require_gradebook_backup')">require_gradebook_backup</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>());
<a name="l939"><span class="linenum"> 939</span></a>      }
<a name="l940"><span class="linenum"> 940</span></a>  
<a name="l941"><span class="linenum"> 941</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l942"><span class="linenum"> 942</span></a>  
<a name="l943"><span class="linenum"> 943</span></a>  <span class="comment">        // are we including user info?</span>
<a name="l944"><span class="linenum"> 944</span></a>          <a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('users');
<a name="l945"><span class="linenum"> 945</span></a>  
<a name="l946"><span class="linenum"> 946</span></a>          <a class="var it6044" onMouseOver="hilite(6044)" onMouseOut="lolite()" onClick="logVariable('gradebook')" href="../../_variables/gradebook.html">$gradebook</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('gradebook');
<a name="l947"><span class="linenum"> 947</span></a>  
<a name="l948"><span class="linenum"> 948</span></a>  <span class="comment">        //grade_letters are done in backup_activity_grades_structure_step()</span>
<a name="l949"><span class="linenum"> 949</span></a>  
<a name="l950"><span class="linenum"> 950</span></a>  <span class="comment">        //calculated grade items</span>
<a name="l951"><span class="linenum"> 951</span></a>          <a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_items');
<a name="l952"><span class="linenum"> 952</span></a>          <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_item', array('id'), array(
<a name="l953"><span class="linenum"> 953</span></a>              'categoryid', 'itemname', 'itemtype', 'itemmodule',
<a name="l954"><span class="linenum"> 954</span></a>              'iteminstance', 'itemnumber', 'iteminfo', 'idnumber',
<a name="l955"><span class="linenum"> 955</span></a>              'calculation', 'gradetype', 'grademax', 'grademin',
<a name="l956"><span class="linenum"> 956</span></a>              'scaleid', 'outcomeid', 'gradepass', 'multfactor',
<a name="l957"><span class="linenum"> 957</span></a>              'plusfactor', 'aggregationcoef', 'aggregationcoef2', 'weightoverride',
<a name="l958"><span class="linenum"> 958</span></a>              'sortorder', 'display', 'decimals', 'hidden', 'locked', 'locktime',
<a name="l959"><span class="linenum"> 959</span></a>              'needsupdate', 'timecreated', 'timemodified'));
<a name="l960"><span class="linenum"> 960</span></a>  
<a name="l961"><span class="linenum"> 961</span></a>          <a class="var it6047" onMouseOver="hilite(6047)" onMouseOut="lolite()" onClick="logVariable('grade_grades')" href="../../_variables/grade_grades.html">$grade_grades</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_grades');
<a name="l962"><span class="linenum"> 962</span></a>          <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('grade_grade')" href="../../_variables/grade_grade.html">$grade_grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_grade', array('id'), array(
<a name="l963"><span class="linenum"> 963</span></a>              'userid', 'rawgrade', 'rawgrademax', 'rawgrademin',
<a name="l964"><span class="linenum"> 964</span></a>              'rawscaleid', 'usermodified', 'finalgrade', 'hidden',
<a name="l965"><span class="linenum"> 965</span></a>              'locked', 'locktime', 'exported', 'overridden',
<a name="l966"><span class="linenum"> 966</span></a>              'excluded', 'feedback', 'feedbackformat', 'information',
<a name="l967"><span class="linenum"> 967</span></a>              'informationformat', 'timecreated', 'timemodified',
<a name="l968"><span class="linenum"> 968</span></a>              'aggregationstatus', 'aggregationweight'));
<a name="l969"><span class="linenum"> 969</span></a>  
<a name="l970"><span class="linenum"> 970</span></a>  <span class="comment">        //grade_categories</span>
<a name="l971"><span class="linenum"> 971</span></a>          <a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('grade_categories')" href="../../_variables/grade_categories.html">$grade_categories</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_categories');
<a name="l972"><span class="linenum"> 972</span></a>          <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../../_variables/grade_category.html">$grade_category</a>   = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_category', array('id'), array(
<a name="l973"><span class="linenum"> 973</span></a>  <span class="comment">                //'courseid',</span>
<a name="l974"><span class="linenum"> 974</span></a>                  'parent', 'depth', 'path', 'fullname', 'aggregation', 'keephigh',
<a name="l975"><span class="linenum"> 975</span></a>                  'droplow', 'aggregateonlygraded', 'aggregateoutcomes',
<a name="l976"><span class="linenum"> 976</span></a>                  'timecreated', 'timemodified', 'hidden'));
<a name="l977"><span class="linenum"> 977</span></a>  
<a name="l978"><span class="linenum"> 978</span></a>          <a class="var it3696" onMouseOver="hilite(3696)" onMouseOut="lolite()" onClick="logVariable('letters')" href="../../_variables/letters.html">$letters</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_letters');
<a name="l979"><span class="linenum"> 979</span></a>          <a class="var it4483" onMouseOver="hilite(4483)" onMouseOut="lolite()" onClick="logVariable('letter')" href="../../_variables/letter.html">$letter</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_letter', 'id', array(
<a name="l980"><span class="linenum"> 980</span></a>              'lowerboundary', 'letter'));
<a name="l981"><span class="linenum"> 981</span></a>  
<a name="l982"><span class="linenum"> 982</span></a>          <a class="var it6051" onMouseOver="hilite(6051)" onMouseOut="lolite()" onClick="logVariable('grade_settings')" href="../../_variables/grade_settings.html">$grade_settings</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_settings');
<a name="l983"><span class="linenum"> 983</span></a>          <a class="var it6052" onMouseOver="hilite(6052)" onMouseOut="lolite()" onClick="logVariable('grade_setting')" href="../../_variables/grade_setting.html">$grade_setting</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_setting', 'id', array(
<a name="l984"><span class="linenum"> 984</span></a>              'name', 'value'));
<a name="l985"><span class="linenum"> 985</span></a>  
<a name="l986"><span class="linenum"> 986</span></a>  
<a name="l987"><span class="linenum"> 987</span></a>  <span class="comment">        // Build the tree</span>
<a name="l988"><span class="linenum"> 988</span></a>          <a class="var it6044" onMouseOver="hilite(6044)" onMouseOut="lolite()" onClick="logVariable('gradebook')" href="../../_variables/gradebook.html">$gradebook</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('grade_categories')" href="../../_variables/grade_categories.html">$grade_categories</a>);
<a name="l989"><span class="linenum"> 989</span></a>          <a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('grade_categories')" href="../../_variables/grade_categories.html">$grade_categories</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../../_variables/grade_category.html">$grade_category</a>);
<a name="l990"><span class="linenum"> 990</span></a>  
<a name="l991"><span class="linenum"> 991</span></a>          <a class="var it6044" onMouseOver="hilite(6044)" onMouseOut="lolite()" onClick="logVariable('gradebook')" href="../../_variables/gradebook.html">$gradebook</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a>);
<a name="l992"><span class="linenum"> 992</span></a>          <a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>);
<a name="l993"><span class="linenum"> 993</span></a>          <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6047" onMouseOver="hilite(6047)" onMouseOut="lolite()" onClick="logVariable('grade_grades')" href="../../_variables/grade_grades.html">$grade_grades</a>);
<a name="l994"><span class="linenum"> 994</span></a>          <a class="var it6047" onMouseOver="hilite(6047)" onMouseOut="lolite()" onClick="logVariable('grade_grades')" href="../../_variables/grade_grades.html">$grade_grades</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('grade_grade')" href="../../_variables/grade_grade.html">$grade_grade</a>);
<a name="l995"><span class="linenum"> 995</span></a>  
<a name="l996"><span class="linenum"> 996</span></a>          <a class="var it6044" onMouseOver="hilite(6044)" onMouseOut="lolite()" onClick="logVariable('gradebook')" href="../../_variables/gradebook.html">$gradebook</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it3696" onMouseOver="hilite(3696)" onMouseOut="lolite()" onClick="logVariable('letters')" href="../../_variables/letters.html">$letters</a>);
<a name="l997"><span class="linenum"> 997</span></a>          <a class="var it3696" onMouseOver="hilite(3696)" onMouseOut="lolite()" onClick="logVariable('letters')" href="../../_variables/letters.html">$letters</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it4483" onMouseOver="hilite(4483)" onMouseOut="lolite()" onClick="logVariable('letter')" href="../../_variables/letter.html">$letter</a>);
<a name="l998"><span class="linenum"> 998</span></a>  
<a name="l999"><span class="linenum"> 999</span></a>          <a class="var it6044" onMouseOver="hilite(6044)" onMouseOut="lolite()" onClick="logVariable('gradebook')" href="../../_variables/gradebook.html">$gradebook</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6051" onMouseOver="hilite(6051)" onMouseOut="lolite()" onClick="logVariable('grade_settings')" href="../../_variables/grade_settings.html">$grade_settings</a>);
<a name="l1000"><span class="linenum">1000</span></a>          <a class="var it6051" onMouseOver="hilite(6051)" onMouseOut="lolite()" onClick="logVariable('grade_settings')" href="../../_variables/grade_settings.html">$grade_settings</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6052" onMouseOver="hilite(6052)" onMouseOut="lolite()" onClick="logVariable('grade_setting')" href="../../_variables/grade_setting.html">$grade_setting</a>);
<a name="l1001"><span class="linenum">1001</span></a>  
<a name="l1002"><span class="linenum">1002</span></a>  <span class="comment">        // Define sources</span>
<a name="l1003"><span class="linenum">1003</span></a>  
<a name="l1004"><span class="linenum">1004</span></a>  <span class="comment">        //Include manual, category and the course grade item</span>
<a name="l1005"><span class="linenum">1005</span></a>          <a class="var it6053" onMouseOver="hilite(6053)" onMouseOut="lolite()" onClick="logVariable('grade_items_sql')" href="../../_variables/grade_items_sql.html">$grade_items_sql</a> =&quot;SELECT * FROM {grade_items}
<a name="l1006"><span class="linenum">1006</span></a>                             WHERE courseid = :courseid
<a name="l1007"><span class="linenum">1007</span></a>                             AND (itemtype='manual' OR itemtype='course' OR itemtype='category')&quot;;
<a name="l1008"><span class="linenum">1008</span></a>          <a class="var it6054" onMouseOver="hilite(6054)" onMouseOut="lolite()" onClick="logVariable('grade_items_params')" href="../../_variables/grade_items_params.html">$grade_items_params</a> = array('courseid'=&gt;backup::VAR_COURSEID);
<a name="l1009"><span class="linenum">1009</span></a>          <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(<a class="var it6053" onMouseOver="hilite(6053)" onMouseOut="lolite()" onClick="logVariable('grade_items_sql')" href="../../_variables/grade_items_sql.html">$grade_items_sql</a>, <a class="var it6054" onMouseOver="hilite(6054)" onMouseOut="lolite()" onClick="logVariable('grade_items_params')" href="../../_variables/grade_items_params.html">$grade_items_params</a>);
<a name="l1010"><span class="linenum">1010</span></a>  
<a name="l1011"><span class="linenum">1011</span></a>          if (<a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a>) {
<a name="l1012"><span class="linenum">1012</span></a>              <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('grade_grade')" href="../../_variables/grade_grade.html">$grade_grade</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('grade_grades', array('itemid' =&gt; backup::VAR_PARENTID));
<a name="l1013"><span class="linenum">1013</span></a>          }
<a name="l1014"><span class="linenum">1014</span></a>  
<a name="l1015"><span class="linenum">1015</span></a>          <a class="var it6055" onMouseOver="hilite(6055)" onMouseOut="lolite()" onClick="logVariable('grade_category_sql')" href="../../_variables/grade_category_sql.html">$grade_category_sql</a> = &quot;SELECT gc.*, gi.sortorder
<a name="l1016"><span class="linenum">1016</span></a>                                 FROM {grade_categories} gc
<a name="l1017"><span class="linenum">1017</span></a>                                 JOIN {grade_items} gi <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (gi.iteminstance = gc.id)
<a name="l1018"><span class="linenum">1018</span></a>                                 WHERE gc.courseid = :courseid
<a name="l1019"><span class="linenum">1019</span></a>                                 AND (gi.itemtype='course' OR gi.itemtype='category')
<a name="l1020"><span class="linenum">1020</span></a>                                 ORDER BY gc.parent ASC&quot;;<span class="comment">//need parent categories before their children</span>
<a name="l1021"><span class="linenum">1021</span></a>          <a class="var it6056" onMouseOver="hilite(6056)" onMouseOut="lolite()" onClick="logVariable('grade_category_params')" href="../../_variables/grade_category_params.html">$grade_category_params</a> = array('courseid'=&gt;backup::VAR_COURSEID);
<a name="l1022"><span class="linenum">1022</span></a>          <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../../_variables/grade_category.html">$grade_category</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(<a class="var it6055" onMouseOver="hilite(6055)" onMouseOut="lolite()" onClick="logVariable('grade_category_sql')" href="../../_variables/grade_category_sql.html">$grade_category_sql</a>, <a class="var it6056" onMouseOver="hilite(6056)" onMouseOut="lolite()" onClick="logVariable('grade_category_params')" href="../../_variables/grade_category_params.html">$grade_category_params</a>);
<a name="l1023"><span class="linenum">1023</span></a>  
<a name="l1024"><span class="linenum">1024</span></a>          <a class="var it4483" onMouseOver="hilite(4483)" onMouseOut="lolite()" onClick="logVariable('letter')" href="../../_variables/letter.html">$letter</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('grade_letters', array('contextid' =&gt; backup::VAR_CONTEXTID));
<a name="l1025"><span class="linenum">1025</span></a>  
<a name="l1026"><span class="linenum">1026</span></a>          <a class="var it6052" onMouseOver="hilite(6052)" onMouseOut="lolite()" onClick="logVariable('grade_setting')" href="../../_variables/grade_setting.html">$grade_setting</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('grade_settings', array('courseid' =&gt; backup::VAR_COURSEID));
<a name="l1027"><span class="linenum">1027</span></a>  
<a name="l1028"><span class="linenum">1028</span></a>  <span class="comment">        // Annotations (both as final as far as they are going to be exported in next steps)</span>
<a name="l1029"><span class="linenum">1029</span></a>          <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('scalefinal', 'scaleid'); <span class="comment">// Straight as scalefinal because it's &gt; 0</span>
<a name="l1030"><span class="linenum">1030</span></a>          <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('outcomefinal', 'outcomeid');
<a name="l1031"><span class="linenum">1031</span></a>  
<a name="l1032"><span class="linenum">1032</span></a>  <span class="comment">        //just in case there are any users not already annotated by the activities</span>
<a name="l1033"><span class="linenum">1033</span></a>          <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('grade_grade')" href="../../_variables/grade_grade.html">$grade_grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('userfinal', 'userid');
<a name="l1034"><span class="linenum">1034</span></a>  
<a name="l1035"><span class="linenum">1035</span></a>  <span class="comment">        // Return the root element</span>
<a name="l1036"><span class="linenum">1036</span></a>          return <a class="var it6044" onMouseOver="hilite(6044)" onMouseOut="lolite()" onClick="logVariable('gradebook')" href="../../_variables/gradebook.html">$gradebook</a>;
<a name="l1037"><span class="linenum">1037</span></a>      }
<a name="l1038"><span class="linenum">1038</span></a>  }
<a name="l1039"><span class="linenum">1039</span></a>  
<a name="l1040"><span class="linenum">1040</span></a>  <span class="comment">/**</span>
<a name="l1041"><span class="linenum">1041</span></a>  <span class="comment"> * Step in charge of constructing the grade_history.xml file containing the grade histories.</span>
<a name="l1042"><span class="linenum">1042</span></a>  <span class="comment"> */</span>
<a name="l1043"><span class="linenum">1043</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_grade_history_structure_step')" href="../../_classes/backup_grade_history_structure_step.html" onMouseOver="classPopup(event,'backup_grade_history_structure_step')">backup_grade_history_structure_step</a> extends backup_structure_step {
<a name="l1044"><span class="linenum">1044</span></a>  
<a name="l1045"><span class="linenum">1045</span></a>      <span class="comment">/**</span>
<a name="l1046"><span class="linenum">1046</span></a>  <span class="comment">     * Limit the execution.</span>
<a name="l1047"><span class="linenum">1047</span></a>  <span class="comment">     *</span>
<a name="l1048"><span class="linenum">1048</span></a>  <span class="comment">     * This applies the same logic than the one applied to {@link backup_gradebook_structure_step},</span>
<a name="l1049"><span class="linenum">1049</span></a>  <span class="comment">     * because we do not want to save the history of items which are not backed up. At least for now.</span>
<a name="l1050"><span class="linenum">1050</span></a>  <span class="comment">     */</span>
<a name="l1051"><span class="linenum">1051</span></a>      protected function <a class="function" onClick="logFunction('execute_condition')" href="../../_functions/execute_condition.html" onMouseOver="funcPopup(event,'execute_condition')">execute_condition</a>() {
<a name="l1052"><span class="linenum">1052</span></a>          <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>();
<a name="l1053"><span class="linenum">1053</span></a>          if (<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l1054"><span class="linenum">1054</span></a>              return false;
<a name="l1055"><span class="linenum">1055</span></a>          }
<a name="l1056"><span class="linenum">1056</span></a>  
<a name="l1057"><span class="linenum">1057</span></a>          return backup_plan_dbops::<a class="function" onClick="logFunction('require_gradebook_backup')" href="../../_functions/require_gradebook_backup.html" onMouseOver="funcPopup(event,'require_gradebook_backup')">require_gradebook_backup</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>());
<a name="l1058"><span class="linenum">1058</span></a>      }
<a name="l1059"><span class="linenum">1059</span></a>  
<a name="l1060"><span class="linenum">1060</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>  <span class="comment">        // Settings to use.</span>
<a name="l1063"><span class="linenum">1063</span></a>          <a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('users');
<a name="l1064"><span class="linenum">1064</span></a>          <a class="var it1501" onMouseOver="hilite(1501)" onMouseOut="lolite()" onClick="logVariable('history')" href="../../_variables/history.html">$history</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('grade_histories');
<a name="l1065"><span class="linenum">1065</span></a>  
<a name="l1066"><span class="linenum">1066</span></a>  <span class="comment">        // Create the nested elements.</span>
<a name="l1067"><span class="linenum">1067</span></a>          <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('bookhistory')" href="../../_variables/bookhistory.html">$bookhistory</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_history');
<a name="l1068"><span class="linenum">1068</span></a>          <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_grades');
<a name="l1069"><span class="linenum">1069</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_grade', array('id'), array(
<a name="l1070"><span class="linenum">1070</span></a>              'action', 'oldid', 'source', 'loggeduser', 'itemid', 'userid',
<a name="l1071"><span class="linenum">1071</span></a>              'rawgrade', 'rawgrademax', 'rawgrademin', 'rawscaleid',
<a name="l1072"><span class="linenum">1072</span></a>              'usermodified', 'finalgrade', 'hidden', 'locked', 'locktime', 'exported', 'overridden',
<a name="l1073"><span class="linenum">1073</span></a>              'excluded', 'feedback', 'feedbackformat', 'information',
<a name="l1074"><span class="linenum">1074</span></a>              'informationformat', 'timemodified'));
<a name="l1075"><span class="linenum">1075</span></a>  
<a name="l1076"><span class="linenum">1076</span></a>  <span class="comment">        // Build the tree.</span>
<a name="l1077"><span class="linenum">1077</span></a>          <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('bookhistory')" href="../../_variables/bookhistory.html">$bookhistory</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l1078"><span class="linenum">1078</span></a>          <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>);
<a name="l1079"><span class="linenum">1079</span></a>  
<a name="l1080"><span class="linenum">1080</span></a>  <span class="comment">        // This only happens if we are including user info and history.</span>
<a name="l1081"><span class="linenum">1081</span></a>          if (<a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a> &amp;&amp; <a class="var it1501" onMouseOver="hilite(1501)" onMouseOut="lolite()" onClick="logVariable('history')" href="../../_variables/history.html">$history</a>) {
<a name="l1082"><span class="linenum">1082</span></a>  <span class="comment">            // Only keep the history of grades related to items which have been backed up, The query is</span>
<a name="l1083"><span class="linenum">1083</span></a>  <span class="comment">            // similar (but not identical) to the one used in backup_gradebook_structure_step::define_structure().</span>
<a name="l1084"><span class="linenum">1084</span></a>              <a class="var it6058" onMouseOver="hilite(6058)" onMouseOut="lolite()" onClick="logVariable('gradesql')" href="../../_variables/gradesql.html">$gradesql</a> = &quot;SELECT ggh.*
<a name="l1085"><span class="linenum">1085</span></a>                             FROM {grade_grades_history} ggh
<a name="l1086"><span class="linenum">1086</span></a>                             JOIN {grade_items} gi ON ggh.itemid = gi.id
<a name="l1087"><span class="linenum">1087</span></a>                            WHERE gi.courseid = :courseid
<a name="l1088"><span class="linenum">1088</span></a>                              AND (gi.itemtype = 'manual' OR gi.itemtype = 'course' OR gi.itemtype = 'category')&quot;;
<a name="l1089"><span class="linenum">1089</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(<a class="var it6058" onMouseOver="hilite(6058)" onMouseOut="lolite()" onClick="logVariable('gradesql')" href="../../_variables/gradesql.html">$gradesql</a>, array('courseid' =&gt; backup::VAR_COURSEID));
<a name="l1090"><span class="linenum">1090</span></a>          }
<a name="l1091"><span class="linenum">1091</span></a>  
<a name="l1092"><span class="linenum">1092</span></a>  <span class="comment">        // Annotations. (Final annotations as this step is part of the final task).</span>
<a name="l1093"><span class="linenum">1093</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('scalefinal', 'rawscaleid');
<a name="l1094"><span class="linenum">1094</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('userfinal', 'loggeduser');
<a name="l1095"><span class="linenum">1095</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('userfinal', 'userid');
<a name="l1096"><span class="linenum">1096</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('userfinal', 'usermodified');
<a name="l1097"><span class="linenum">1097</span></a>  
<a name="l1098"><span class="linenum">1098</span></a>  <span class="comment">        // Return the root element.</span>
<a name="l1099"><span class="linenum">1099</span></a>          return <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('bookhistory')" href="../../_variables/bookhistory.html">$bookhistory</a>;
<a name="l1100"><span class="linenum">1100</span></a>      }
<a name="l1101"><span class="linenum">1101</span></a>  
<a name="l1102"><span class="linenum">1102</span></a>  }
<a name="l1103"><span class="linenum">1103</span></a>  
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment">/**</span>
<a name="l1105"><span class="linenum">1105</span></a>  <span class="comment"> * structure step in charge if constructing the completion.xml file for all the users completion</span>
<a name="l1106"><span class="linenum">1106</span></a>  <span class="comment"> * information in a given activity</span>
<a name="l1107"><span class="linenum">1107</span></a>  <span class="comment"> */</span>
<a name="l1108"><span class="linenum">1108</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_userscompletion_structure_step')" href="../../_classes/backup_userscompletion_structure_step.html" onMouseOver="classPopup(event,'backup_userscompletion_structure_step')">backup_userscompletion_structure_step</a> extends backup_structure_step {
<a name="l1109"><span class="linenum">1109</span></a>  
<a name="l1110"><span class="linenum">1110</span></a>      <span class="comment">/**</span>
<a name="l1111"><span class="linenum">1111</span></a>  <span class="comment">     * Skip completion on the front page.</span>
<a name="l1112"><span class="linenum">1112</span></a>  <span class="comment">     * @return bool</span>
<a name="l1113"><span class="linenum">1113</span></a>  <span class="comment">     */</span>
<a name="l1114"><span class="linenum">1114</span></a>      protected function <a class="function" onClick="logFunction('execute_condition')" href="../../_functions/execute_condition.html" onMouseOver="funcPopup(event,'execute_condition')">execute_condition</a>() {
<a name="l1115"><span class="linenum">1115</span></a>          return (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>() != <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l1116"><span class="linenum">1116</span></a>      }
<a name="l1117"><span class="linenum">1117</span></a>  
<a name="l1118"><span class="linenum">1118</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1119"><span class="linenum">1119</span></a>  
<a name="l1120"><span class="linenum">1120</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l1121"><span class="linenum">1121</span></a>  
<a name="l1122"><span class="linenum">1122</span></a>          <a class="var it5900" onMouseOver="hilite(5900)" onMouseOut="lolite()" onClick="logVariable('completions')" href="../../_variables/completions.html">$completions</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('completions');
<a name="l1123"><span class="linenum">1123</span></a>  
<a name="l1124"><span class="linenum">1124</span></a>          <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('completion', array('id'), array(
<a name="l1125"><span class="linenum">1125</span></a>              'userid', 'completionstate', 'viewed', 'timemodified'));
<a name="l1126"><span class="linenum">1126</span></a>  
<a name="l1127"><span class="linenum">1127</span></a>  <span class="comment">        // Build the tree</span>
<a name="l1128"><span class="linenum">1128</span></a>  
<a name="l1129"><span class="linenum">1129</span></a>          <a class="var it5900" onMouseOver="hilite(5900)" onMouseOut="lolite()" onClick="logVariable('completions')" href="../../_variables/completions.html">$completions</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>);
<a name="l1130"><span class="linenum">1130</span></a>  
<a name="l1131"><span class="linenum">1131</span></a>  <span class="comment">        // Define sources</span>
<a name="l1132"><span class="linenum">1132</span></a>  
<a name="l1133"><span class="linenum">1133</span></a>          <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('course_modules_completion', array('coursemoduleid' =&gt; backup::VAR_MODID));
<a name="l1134"><span class="linenum">1134</span></a>  
<a name="l1135"><span class="linenum">1135</span></a>  <span class="comment">        // Define id annotations</span>
<a name="l1136"><span class="linenum">1136</span></a>  
<a name="l1137"><span class="linenum">1137</span></a>          <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l1138"><span class="linenum">1138</span></a>  
<a name="l1139"><span class="linenum">1139</span></a>  <span class="comment">        // Return the root element (completions)</span>
<a name="l1140"><span class="linenum">1140</span></a>          return <a class="var it5900" onMouseOver="hilite(5900)" onMouseOut="lolite()" onClick="logVariable('completions')" href="../../_variables/completions.html">$completions</a>;
<a name="l1141"><span class="linenum">1141</span></a>      }
<a name="l1142"><span class="linenum">1142</span></a>  }
<a name="l1143"><span class="linenum">1143</span></a>  
<a name="l1144"><span class="linenum">1144</span></a>  <span class="comment">/**</span>
<a name="l1145"><span class="linenum">1145</span></a>  <span class="comment"> * structure step in charge of constructing the main groups.xml file for all the groups and</span>
<a name="l1146"><span class="linenum">1146</span></a>  <span class="comment"> * groupings information already annotated</span>
<a name="l1147"><span class="linenum">1147</span></a>  <span class="comment"> */</span>
<a name="l1148"><span class="linenum">1148</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_groups_structure_step')" href="../../_classes/backup_groups_structure_step.html" onMouseOver="classPopup(event,'backup_groups_structure_step')">backup_groups_structure_step</a> extends backup_structure_step {
<a name="l1149"><span class="linenum">1149</span></a>  
<a name="l1150"><span class="linenum">1150</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1151"><span class="linenum">1151</span></a>  
<a name="l1152"><span class="linenum">1152</span></a>  <span class="comment">        // To know if we are including users.</span>
<a name="l1153"><span class="linenum">1153</span></a>          <a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('users');
<a name="l1154"><span class="linenum">1154</span></a>  <span class="comment">        // To know if we are including groups and groupings.</span>
<a name="l1155"><span class="linenum">1155</span></a>          <a class="var it6059" onMouseOver="hilite(6059)" onMouseOut="lolite()" onClick="logVariable('groupinfo')" href="../../_variables/groupinfo.html">$groupinfo</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('groups');
<a name="l1156"><span class="linenum">1156</span></a>  
<a name="l1157"><span class="linenum">1157</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l1158"><span class="linenum">1158</span></a>  
<a name="l1159"><span class="linenum">1159</span></a>          <a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('groups');
<a name="l1160"><span class="linenum">1160</span></a>  
<a name="l1161"><span class="linenum">1161</span></a>          <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('group', array('id'), array(
<a name="l1162"><span class="linenum">1162</span></a>              'name', 'idnumber', 'description', 'descriptionformat', 'enrolmentkey',
<a name="l1163"><span class="linenum">1163</span></a>              'picture', 'hidepicture', 'timecreated', 'timemodified'));
<a name="l1164"><span class="linenum">1164</span></a>  
<a name="l1165"><span class="linenum">1165</span></a>          <a class="var it6060" onMouseOver="hilite(6060)" onMouseOut="lolite()" onClick="logVariable('members')" href="../../_variables/members.html">$members</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('group_members');
<a name="l1166"><span class="linenum">1166</span></a>  
<a name="l1167"><span class="linenum">1167</span></a>          <a class="var it2505" onMouseOver="hilite(2505)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('group_member', array('id'), array(
<a name="l1168"><span class="linenum">1168</span></a>              'userid', 'timeadded', 'component', 'itemid'));
<a name="l1169"><span class="linenum">1169</span></a>  
<a name="l1170"><span class="linenum">1170</span></a>          <a class="var it2827" onMouseOver="hilite(2827)" onMouseOut="lolite()" onClick="logVariable('groupings')" href="../../_variables/groupings.html">$groupings</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('groupings');
<a name="l1171"><span class="linenum">1171</span></a>  
<a name="l1172"><span class="linenum">1172</span></a>          <a class="var it2828" onMouseOver="hilite(2828)" onMouseOut="lolite()" onClick="logVariable('grouping')" href="../../_variables/grouping.html">$grouping</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grouping', 'id', array(
<a name="l1173"><span class="linenum">1173</span></a>              'name', 'idnumber', 'description', 'descriptionformat', 'configdata',
<a name="l1174"><span class="linenum">1174</span></a>              'timecreated', 'timemodified'));
<a name="l1175"><span class="linenum">1175</span></a>  
<a name="l1176"><span class="linenum">1176</span></a>          <a class="var it6061" onMouseOver="hilite(6061)" onMouseOut="lolite()" onClick="logVariable('groupinggroups')" href="../../_variables/groupinggroups.html">$groupinggroups</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grouping_groups');
<a name="l1177"><span class="linenum">1177</span></a>  
<a name="l1178"><span class="linenum">1178</span></a>          <a class="var it6062" onMouseOver="hilite(6062)" onMouseOut="lolite()" onClick="logVariable('groupinggroup')" href="../../_variables/groupinggroup.html">$groupinggroup</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grouping_group', array('id'), array(
<a name="l1179"><span class="linenum">1179</span></a>              'groupid', 'timeadded'));
<a name="l1180"><span class="linenum">1180</span></a>  
<a name="l1181"><span class="linenum">1181</span></a>  <span class="comment">        // Build the tree</span>
<a name="l1182"><span class="linenum">1182</span></a>  
<a name="l1183"><span class="linenum">1183</span></a>          <a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>);
<a name="l1184"><span class="linenum">1184</span></a>          <a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it2827" onMouseOver="hilite(2827)" onMouseOut="lolite()" onClick="logVariable('groupings')" href="../../_variables/groupings.html">$groupings</a>);
<a name="l1185"><span class="linenum">1185</span></a>  
<a name="l1186"><span class="linenum">1186</span></a>          <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6060" onMouseOver="hilite(6060)" onMouseOut="lolite()" onClick="logVariable('members')" href="../../_variables/members.html">$members</a>);
<a name="l1187"><span class="linenum">1187</span></a>          <a class="var it6060" onMouseOver="hilite(6060)" onMouseOut="lolite()" onClick="logVariable('members')" href="../../_variables/members.html">$members</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it2505" onMouseOver="hilite(2505)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>);
<a name="l1188"><span class="linenum">1188</span></a>  
<a name="l1189"><span class="linenum">1189</span></a>          <a class="var it2827" onMouseOver="hilite(2827)" onMouseOut="lolite()" onClick="logVariable('groupings')" href="../../_variables/groupings.html">$groupings</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it2828" onMouseOver="hilite(2828)" onMouseOut="lolite()" onClick="logVariable('grouping')" href="../../_variables/grouping.html">$grouping</a>);
<a name="l1190"><span class="linenum">1190</span></a>          <a class="var it2828" onMouseOver="hilite(2828)" onMouseOut="lolite()" onClick="logVariable('grouping')" href="../../_variables/grouping.html">$grouping</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6061" onMouseOver="hilite(6061)" onMouseOut="lolite()" onClick="logVariable('groupinggroups')" href="../../_variables/groupinggroups.html">$groupinggroups</a>);
<a name="l1191"><span class="linenum">1191</span></a>          <a class="var it6061" onMouseOver="hilite(6061)" onMouseOut="lolite()" onClick="logVariable('groupinggroups')" href="../../_variables/groupinggroups.html">$groupinggroups</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6062" onMouseOver="hilite(6062)" onMouseOut="lolite()" onClick="logVariable('groupinggroup')" href="../../_variables/groupinggroup.html">$groupinggroup</a>);
<a name="l1192"><span class="linenum">1192</span></a>  
<a name="l1193"><span class="linenum">1193</span></a>  <span class="comment">        // Define sources</span>
<a name="l1194"><span class="linenum">1194</span></a>  
<a name="l1195"><span class="linenum">1195</span></a>  <span class="comment">        // This only happens if we are including groups/groupings.</span>
<a name="l1196"><span class="linenum">1196</span></a>          if (<a class="var it6059" onMouseOver="hilite(6059)" onMouseOut="lolite()" onClick="logVariable('groupinfo')" href="../../_variables/groupinfo.html">$groupinfo</a>) {
<a name="l1197"><span class="linenum">1197</span></a>              <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;
<a name="l1198"><span class="linenum">1198</span></a>                  SELECT g.*
<a name="l1199"><span class="linenum">1199</span></a>                    FROM {groups} g
<a name="l1200"><span class="linenum">1200</span></a>                    JOIN {backup_ids_temp} bi ON g.id = bi.itemid
<a name="l1201"><span class="linenum">1201</span></a>                   WHERE bi.backupid = ?
<a name="l1202"><span class="linenum">1202</span></a>                     AND bi.itemname = 'groupfinal'&quot;, array(backup::VAR_BACKUPID));
<a name="l1203"><span class="linenum">1203</span></a>  
<a name="l1204"><span class="linenum">1204</span></a>              <a class="var it2828" onMouseOver="hilite(2828)" onMouseOut="lolite()" onClick="logVariable('grouping')" href="../../_variables/grouping.html">$grouping</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;
<a name="l1205"><span class="linenum">1205</span></a>                  SELECT g.*
<a name="l1206"><span class="linenum">1206</span></a>                    FROM {groupings} g
<a name="l1207"><span class="linenum">1207</span></a>                    JOIN {backup_ids_temp} bi ON g.id = bi.itemid
<a name="l1208"><span class="linenum">1208</span></a>                   WHERE bi.backupid = ?
<a name="l1209"><span class="linenum">1209</span></a>                     AND bi.itemname = 'groupingfinal'&quot;, array(backup::VAR_BACKUPID));
<a name="l1210"><span class="linenum">1210</span></a>              <a class="var it6062" onMouseOver="hilite(6062)" onMouseOut="lolite()" onClick="logVariable('groupinggroup')" href="../../_variables/groupinggroup.html">$groupinggroup</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('groupings_groups', array('groupingid' =&gt; backup::VAR_PARENTID));
<a name="l1211"><span class="linenum">1211</span></a>  
<a name="l1212"><span class="linenum">1212</span></a>  <span class="comment">            // This only happens if we are including users.</span>
<a name="l1213"><span class="linenum">1213</span></a>              if (<a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a>) {
<a name="l1214"><span class="linenum">1214</span></a>                  <a class="var it2505" onMouseOver="hilite(2505)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('groups_members', array('groupid' =&gt; backup::VAR_PARENTID));
<a name="l1215"><span class="linenum">1215</span></a>              }
<a name="l1216"><span class="linenum">1216</span></a>          }
<a name="l1217"><span class="linenum">1217</span></a>  
<a name="l1218"><span class="linenum">1218</span></a>  <span class="comment">        // Define id annotations (as final)</span>
<a name="l1219"><span class="linenum">1219</span></a>  
<a name="l1220"><span class="linenum">1220</span></a>          <a class="var it2505" onMouseOver="hilite(2505)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('userfinal', 'userid');
<a name="l1221"><span class="linenum">1221</span></a>  
<a name="l1222"><span class="linenum">1222</span></a>  <span class="comment">        // Define file annotations</span>
<a name="l1223"><span class="linenum">1223</span></a>  
<a name="l1224"><span class="linenum">1224</span></a>          <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('group', 'description', 'id');
<a name="l1225"><span class="linenum">1225</span></a>          <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('group', 'icon', 'id');
<a name="l1226"><span class="linenum">1226</span></a>          <a class="var it2828" onMouseOver="hilite(2828)" onMouseOut="lolite()" onClick="logVariable('grouping')" href="../../_variables/grouping.html">$grouping</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('grouping', 'description', 'id');
<a name="l1227"><span class="linenum">1227</span></a>  
<a name="l1228"><span class="linenum">1228</span></a>  <span class="comment">        // Return the root element (groups)</span>
<a name="l1229"><span class="linenum">1229</span></a>          return <a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>;
<a name="l1230"><span class="linenum">1230</span></a>      }
<a name="l1231"><span class="linenum">1231</span></a>  }
<a name="l1232"><span class="linenum">1232</span></a>  
<a name="l1233"><span class="linenum">1233</span></a>  <span class="comment">/**</span>
<a name="l1234"><span class="linenum">1234</span></a>  <span class="comment"> * structure step in charge of constructing the main users.xml file for all the users already</span>
<a name="l1235"><span class="linenum">1235</span></a>  <span class="comment"> * annotated (final). Includes custom profile fields, preferences, tags, role assignments and</span>
<a name="l1236"><span class="linenum">1236</span></a>  <span class="comment"> * overrides.</span>
<a name="l1237"><span class="linenum">1237</span></a>  <span class="comment"> */</span>
<a name="l1238"><span class="linenum">1238</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_users_structure_step')" href="../../_classes/backup_users_structure_step.html" onMouseOver="classPopup(event,'backup_users_structure_step')">backup_users_structure_step</a> extends backup_structure_step {
<a name="l1239"><span class="linenum">1239</span></a>  
<a name="l1240"><span class="linenum">1240</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1241"><span class="linenum">1241</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1242"><span class="linenum">1242</span></a>  
<a name="l1243"><span class="linenum">1243</span></a>  <span class="comment">        // To know if we are anonymizing users</span>
<a name="l1244"><span class="linenum">1244</span></a>          <a class="var it6063" onMouseOver="hilite(6063)" onMouseOut="lolite()" onClick="logVariable('anonymize')" href="../../_variables/anonymize.html">$anonymize</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('anonymize');
<a name="l1245"><span class="linenum">1245</span></a>  <span class="comment">        // To know if we are including role assignments</span>
<a name="l1246"><span class="linenum">1246</span></a>          <a class="var it5776" onMouseOver="hilite(5776)" onMouseOut="lolite()" onClick="logVariable('roleassignments')" href="../../_variables/roleassignments.html">$roleassignments</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('role_assignments');
<a name="l1247"><span class="linenum">1247</span></a>  
<a name="l1248"><span class="linenum">1248</span></a>  <span class="comment">        // Define each element separate.</span>
<a name="l1249"><span class="linenum">1249</span></a>  
<a name="l1250"><span class="linenum">1250</span></a>          <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('users');
<a name="l1251"><span class="linenum">1251</span></a>  
<a name="l1252"><span class="linenum">1252</span></a>  <span class="comment">        // Create the array of user fields by hand, as far as we have various bits to control</span>
<a name="l1253"><span class="linenum">1253</span></a>  <span class="comment">        // anonymize option, password backup, mnethostid...</span>
<a name="l1254"><span class="linenum">1254</span></a>  
<a name="l1255"><span class="linenum">1255</span></a>  <span class="comment">        // First, the fields not needing anonymization nor special handling</span>
<a name="l1256"><span class="linenum">1256</span></a>          <a class="var it6064" onMouseOver="hilite(6064)" onMouseOut="lolite()" onClick="logVariable('normalfields')" href="../../_variables/normalfields.html">$normalfields</a> = array(
<a name="l1257"><span class="linenum">1257</span></a>              'confirmed', 'policyagreed', 'deleted',
<a name="l1258"><span class="linenum">1258</span></a>              'lang', 'theme', 'timezone', 'firstaccess',
<a name="l1259"><span class="linenum">1259</span></a>              'lastaccess', 'lastlogin', 'currentlogin',
<a name="l1260"><span class="linenum">1260</span></a>              'mailformat', 'maildigest', 'maildisplay',
<a name="l1261"><span class="linenum">1261</span></a>              'autosubscribe', 'trackforums', 'timecreated',
<a name="l1262"><span class="linenum">1262</span></a>              'timemodified', 'trustbitmask');
<a name="l1263"><span class="linenum">1263</span></a>  
<a name="l1264"><span class="linenum">1264</span></a>  <span class="comment">        // Then, the fields potentially needing anonymization</span>
<a name="l1265"><span class="linenum">1265</span></a>          <a class="var it6065" onMouseOver="hilite(6065)" onMouseOut="lolite()" onClick="logVariable('anonfields')" href="../../_variables/anonfields.html">$anonfields</a> = array(
<a name="l1266"><span class="linenum">1266</span></a>              'username', 'idnumber', 'email', 'icq', 'skype',
<a name="l1267"><span class="linenum">1267</span></a>              'yahoo', 'aim', 'msn', 'phone1',
<a name="l1268"><span class="linenum">1268</span></a>              'phone2', 'institution', 'department', 'address',
<a name="l1269"><span class="linenum">1269</span></a>              'city', 'country', 'lastip', 'picture',
<a name="l1270"><span class="linenum">1270</span></a>              'url', 'description', 'descriptionformat', 'imagealt', 'auth');
<a name="l1271"><span class="linenum">1271</span></a>          <a class="var it6065" onMouseOver="hilite(6065)" onMouseOut="lolite()" onClick="logVariable('anonfields')" href="../../_variables/anonfields.html">$anonfields</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it6065" onMouseOver="hilite(6065)" onMouseOut="lolite()" onClick="logVariable('anonfields')" href="../../_variables/anonfields.html">$anonfields</a>, <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>());
<a name="l1272"><span class="linenum">1272</span></a>  
<a name="l1273"><span class="linenum">1273</span></a>  <span class="comment">        // Add anonymized fields to $userfields with custom final element</span>
<a name="l1274"><span class="linenum">1274</span></a>          foreach (<a class="var it6065" onMouseOver="hilite(6065)" onMouseOut="lolite()" onClick="logVariable('anonfields')" href="../../_variables/anonfields.html">$anonfields</a> as <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>) {
<a name="l1275"><span class="linenum">1275</span></a>              if (<a class="var it6063" onMouseOver="hilite(6063)" onMouseOut="lolite()" onClick="logVariable('anonymize')" href="../../_variables/anonymize.html">$anonymize</a>) {
<a name="l1276"><span class="linenum">1276</span></a>                  <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>[] = <span class="keyword">new </span><a class="class" onClick="logClass('anonymizer_final_element')" href="../../_classes/anonymizer_final_element.html" onMouseOver="classPopup(event,'anonymizer_final_element')">anonymizer_final_element</a>(<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1277"><span class="linenum">1277</span></a>              } else {
<a name="l1278"><span class="linenum">1278</span></a>                  <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>[] = <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>; <span class="comment">// No anonymization, normally added</span>
<a name="l1279"><span class="linenum">1279</span></a>              }
<a name="l1280"><span class="linenum">1280</span></a>          }
<a name="l1281"><span class="linenum">1281</span></a>  
<a name="l1282"><span class="linenum">1282</span></a>  <span class="comment">        // mnethosturl requires special handling (custom final element)</span>
<a name="l1283"><span class="linenum">1283</span></a>          <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>[] = <span class="keyword">new </span><a class="class" onClick="logClass('mnethosturl_final_element')" href="../../_classes/mnethosturl_final_element.html" onMouseOver="classPopup(event,'mnethosturl_final_element')">mnethosturl_final_element</a>('mnethosturl');
<a name="l1284"><span class="linenum">1284</span></a>  
<a name="l1285"><span class="linenum">1285</span></a>  <span class="comment">        // password added conditionally</span>
<a name="l1286"><span class="linenum">1286</span></a>          if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('includeuserpasswordsinbackup')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/includeuserpasswordsinbackup.html">includeuserpasswordsinbackup</a>)) {
<a name="l1287"><span class="linenum">1287</span></a>              <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>[] = 'password';
<a name="l1288"><span class="linenum">1288</span></a>          }
<a name="l1289"><span class="linenum">1289</span></a>  
<a name="l1290"><span class="linenum">1290</span></a>  <span class="comment">        // Merge all the fields</span>
<a name="l1291"><span class="linenum">1291</span></a>          <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>, <a class="var it6064" onMouseOver="hilite(6064)" onMouseOut="lolite()" onClick="logVariable('normalfields')" href="../../_variables/normalfields.html">$normalfields</a>);
<a name="l1292"><span class="linenum">1292</span></a>  
<a name="l1293"><span class="linenum">1293</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('user', array('id', 'contextid'), <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>);
<a name="l1294"><span class="linenum">1294</span></a>  
<a name="l1295"><span class="linenum">1295</span></a>          <a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('customfields')" href="../../_variables/customfields.html">$customfields</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('custom_fields');
<a name="l1296"><span class="linenum">1296</span></a>  
<a name="l1297"><span class="linenum">1297</span></a>          <a class="var it2956" onMouseOver="hilite(2956)" onMouseOut="lolite()" onClick="logVariable('customfield')" href="../../_variables/customfield.html">$customfield</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('custom_field', array('id'), array(
<a name="l1298"><span class="linenum">1298</span></a>              'field_name', 'field_type', 'field_data'));
<a name="l1299"><span class="linenum">1299</span></a>  
<a name="l1300"><span class="linenum">1300</span></a>          <a class="var it2944" onMouseOver="hilite(2944)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../_variables/tags.html">$tags</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('tags');
<a name="l1301"><span class="linenum">1301</span></a>  
<a name="l1302"><span class="linenum">1302</span></a>          <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('tag', array('id'), array(
<a name="l1303"><span class="linenum">1303</span></a>              'name', 'rawname'));
<a name="l1304"><span class="linenum">1304</span></a>  
<a name="l1305"><span class="linenum">1305</span></a>          <a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('preferences')" href="../../_variables/preferences.html">$preferences</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('preferences');
<a name="l1306"><span class="linenum">1306</span></a>  
<a name="l1307"><span class="linenum">1307</span></a>          <a class="var it1027" onMouseOver="hilite(1027)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../_variables/preference.html">$preference</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('preference', array('id'), array(
<a name="l1308"><span class="linenum">1308</span></a>              'name', 'value'));
<a name="l1309"><span class="linenum">1309</span></a>  
<a name="l1310"><span class="linenum">1310</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('roles');
<a name="l1311"><span class="linenum">1311</span></a>  
<a name="l1312"><span class="linenum">1312</span></a>          <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('role_overrides');
<a name="l1313"><span class="linenum">1313</span></a>  
<a name="l1314"><span class="linenum">1314</span></a>          <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('override', array('id'), array(
<a name="l1315"><span class="linenum">1315</span></a>              'roleid', 'capability', 'permission', 'timemodified',
<a name="l1316"><span class="linenum">1316</span></a>              'modifierid'));
<a name="l1317"><span class="linenum">1317</span></a>  
<a name="l1318"><span class="linenum">1318</span></a>          <a class="var it6030" onMouseOver="hilite(6030)" onMouseOut="lolite()" onClick="logVariable('assignments')" href="../../_variables/assignments.html">$assignments</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('role_assignments');
<a name="l1319"><span class="linenum">1319</span></a>  
<a name="l1320"><span class="linenum">1320</span></a>          <a class="var it1613" onMouseOver="hilite(1613)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('assignment', array('id'), array(
<a name="l1321"><span class="linenum">1321</span></a>              'roleid', 'userid', 'timemodified', 'modifierid', 'component', //TODO: MDL-22793 add itemid here
<a name="l1322"><span class="linenum">1322</span></a>              'sortorder'));
<a name="l1323"><span class="linenum">1323</span></a>  
<a name="l1324"><span class="linenum">1324</span></a>  <span class="comment">        // Build the tree</span>
<a name="l1325"><span class="linenum">1325</span></a>  
<a name="l1326"><span class="linenum">1326</span></a>          <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l1327"><span class="linenum">1327</span></a>  
<a name="l1328"><span class="linenum">1328</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('customfields')" href="../../_variables/customfields.html">$customfields</a>);
<a name="l1329"><span class="linenum">1329</span></a>          <a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('customfields')" href="../../_variables/customfields.html">$customfields</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it2956" onMouseOver="hilite(2956)" onMouseOut="lolite()" onClick="logVariable('customfield')" href="../../_variables/customfield.html">$customfield</a>);
<a name="l1330"><span class="linenum">1330</span></a>  
<a name="l1331"><span class="linenum">1331</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it2944" onMouseOver="hilite(2944)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../_variables/tags.html">$tags</a>);
<a name="l1332"><span class="linenum">1332</span></a>          <a class="var it2944" onMouseOver="hilite(2944)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../_variables/tags.html">$tags</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>);
<a name="l1333"><span class="linenum">1333</span></a>  
<a name="l1334"><span class="linenum">1334</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('preferences')" href="../../_variables/preferences.html">$preferences</a>);
<a name="l1335"><span class="linenum">1335</span></a>          <a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('preferences')" href="../../_variables/preferences.html">$preferences</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1027" onMouseOver="hilite(1027)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../_variables/preference.html">$preference</a>);
<a name="l1336"><span class="linenum">1336</span></a>  
<a name="l1337"><span class="linenum">1337</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a>);
<a name="l1338"><span class="linenum">1338</span></a>  
<a name="l1339"><span class="linenum">1339</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a>);
<a name="l1340"><span class="linenum">1340</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6030" onMouseOver="hilite(6030)" onMouseOut="lolite()" onClick="logVariable('assignments')" href="../../_variables/assignments.html">$assignments</a>);
<a name="l1341"><span class="linenum">1341</span></a>  
<a name="l1342"><span class="linenum">1342</span></a>          <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>);
<a name="l1343"><span class="linenum">1343</span></a>          <a class="var it6030" onMouseOver="hilite(6030)" onMouseOut="lolite()" onClick="logVariable('assignments')" href="../../_variables/assignments.html">$assignments</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1613" onMouseOver="hilite(1613)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>);
<a name="l1344"><span class="linenum">1344</span></a>  
<a name="l1345"><span class="linenum">1345</span></a>  <span class="comment">        // Define sources</span>
<a name="l1346"><span class="linenum">1346</span></a>  
<a name="l1347"><span class="linenum">1347</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>('SELECT u.*, c.id AS contextid, m.wwwroot AS mnethosturl
<a name="l1348"><span class="linenum">1348</span></a>                                   FROM {user} u
<a name="l1349"><span class="linenum">1349</span></a>                                   JOIN {backup_ids_temp} bi ON bi.itemid = u.id
<a name="l1350"><span class="linenum">1350</span></a>                              LEFT JOIN {context} c ON c.instanceid = u.id AND c.contextlevel = ' . <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a> . '
<a name="l1351"><span class="linenum">1351</span></a>                              LEFT JOIN {mnet_host} m ON m.id = u.mnethostid
<a name="l1352"><span class="linenum">1352</span></a>                                  WHERE bi.backupid = ?
<a name="l1353"><span class="linenum">1353</span></a>                                    AND bi.itemname = ?', array(
<a name="l1354"><span class="linenum">1354</span></a>                                        backup_helper::<a class="function" onClick="logFunction('is_sqlparam')" href="../../_functions/is_sqlparam.html" onMouseOver="funcPopup(event,'is_sqlparam')">is_sqlparam</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>()),
<a name="l1355"><span class="linenum">1355</span></a>                                        backup_helper::<a class="function" onClick="logFunction('is_sqlparam')" href="../../_functions/is_sqlparam.html" onMouseOver="funcPopup(event,'is_sqlparam')">is_sqlparam</a>('userfinal')));
<a name="l1356"><span class="linenum">1356</span></a>  
<a name="l1357"><span class="linenum">1357</span></a>  <span class="comment">        // All the rest on information is only added if we arent</span>
<a name="l1358"><span class="linenum">1358</span></a>  <span class="comment">        // in an anonymized backup</span>
<a name="l1359"><span class="linenum">1359</span></a>          if (!<a class="var it6063" onMouseOver="hilite(6063)" onMouseOut="lolite()" onClick="logVariable('anonymize')" href="../../_variables/anonymize.html">$anonymize</a>) {
<a name="l1360"><span class="linenum">1360</span></a>              <a class="var it2956" onMouseOver="hilite(2956)" onMouseOut="lolite()" onClick="logVariable('customfield')" href="../../_variables/customfield.html">$customfield</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>('SELECT f.id, f.shortname, f.datatype, d.data
<a name="l1361"><span class="linenum">1361</span></a>                                              FROM {user_info_field} f
<a name="l1362"><span class="linenum">1362</span></a>                                              JOIN {user_info_data} d ON d.fieldid = f.id
<a name="l1363"><span class="linenum">1363</span></a>                                             WHERE d.userid = ?', array(backup::VAR_PARENTID));
<a name="l1364"><span class="linenum">1364</span></a>  
<a name="l1365"><span class="linenum">1365</span></a>              <a class="var it2956" onMouseOver="hilite(2956)" onMouseOut="lolite()" onClick="logVariable('customfield')" href="../../_variables/customfield.html">$customfield</a>-&gt;<a class="function" onClick="logFunction('set_source_alias')" href="../../_functions/set_source_alias.html" onMouseOver="funcPopup(event,'set_source_alias')">set_source_alias</a>('shortname', 'field_name');
<a name="l1366"><span class="linenum">1366</span></a>              <a class="var it2956" onMouseOver="hilite(2956)" onMouseOut="lolite()" onClick="logVariable('customfield')" href="../../_variables/customfield.html">$customfield</a>-&gt;<a class="function" onClick="logFunction('set_source_alias')" href="../../_functions/set_source_alias.html" onMouseOver="funcPopup(event,'set_source_alias')">set_source_alias</a>('datatype',  'field_type');
<a name="l1367"><span class="linenum">1367</span></a>              <a class="var it2956" onMouseOver="hilite(2956)" onMouseOut="lolite()" onClick="logVariable('customfield')" href="../../_variables/customfield.html">$customfield</a>-&gt;<a class="function" onClick="logFunction('set_source_alias')" href="../../_functions/set_source_alias.html" onMouseOver="funcPopup(event,'set_source_alias')">set_source_alias</a>('data',      'field_data');
<a name="l1368"><span class="linenum">1368</span></a>  
<a name="l1369"><span class="linenum">1369</span></a>              <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>('SELECT t.id, t.name, t.rawname
<a name="l1370"><span class="linenum">1370</span></a>                                      FROM {tag} t
<a name="l1371"><span class="linenum">1371</span></a>                                      JOIN {tag_instance} ti ON ti.tagid = t.id
<a name="l1372"><span class="linenum">1372</span></a>                                     WHERE ti.itemtype = ?
<a name="l1373"><span class="linenum">1373</span></a>                                       AND ti.itemid = ?', array(
<a name="l1374"><span class="linenum">1374</span></a>                                           backup_helper::<a class="function" onClick="logFunction('is_sqlparam')" href="../../_functions/is_sqlparam.html" onMouseOver="funcPopup(event,'is_sqlparam')">is_sqlparam</a>('user'),
<a name="l1375"><span class="linenum">1375</span></a>                                           backup::VAR_PARENTID));
<a name="l1376"><span class="linenum">1376</span></a>  
<a name="l1377"><span class="linenum">1377</span></a>              <a class="var it1027" onMouseOver="hilite(1027)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../_variables/preference.html">$preference</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('user_preferences', array('userid' =&gt; backup::VAR_PARENTID));
<a name="l1378"><span class="linenum">1378</span></a>  
<a name="l1379"><span class="linenum">1379</span></a>              <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('role_capabilities', array('contextid' =&gt; '/users/user/contextid'));
<a name="l1380"><span class="linenum">1380</span></a>  
<a name="l1381"><span class="linenum">1381</span></a>  <span class="comment">            // Assignments only added if specified</span>
<a name="l1382"><span class="linenum">1382</span></a>              if (<a class="var it5776" onMouseOver="hilite(5776)" onMouseOut="lolite()" onClick="logVariable('roleassignments')" href="../../_variables/roleassignments.html">$roleassignments</a>) {
<a name="l1383"><span class="linenum">1383</span></a>                  <a class="var it1613" onMouseOver="hilite(1613)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('role_assignments', array('contextid' =&gt; '/users/user/contextid'));
<a name="l1384"><span class="linenum">1384</span></a>              }
<a name="l1385"><span class="linenum">1385</span></a>  
<a name="l1386"><span class="linenum">1386</span></a>  <span class="comment">            // Define id annotations (as final)</span>
<a name="l1387"><span class="linenum">1387</span></a>              <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('rolefinal', 'roleid');
<a name="l1388"><span class="linenum">1388</span></a>          }
<a name="l1389"><span class="linenum">1389</span></a>  
<a name="l1390"><span class="linenum">1390</span></a>  <span class="comment">        // Return root element (users)</span>
<a name="l1391"><span class="linenum">1391</span></a>          return <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>;
<a name="l1392"><span class="linenum">1392</span></a>      }
<a name="l1393"><span class="linenum">1393</span></a>  }
<a name="l1394"><span class="linenum">1394</span></a>  
<a name="l1395"><span class="linenum">1395</span></a>  <span class="comment">/**</span>
<a name="l1396"><span class="linenum">1396</span></a>  <span class="comment"> * structure step in charge of constructing the block.xml file for one</span>
<a name="l1397"><span class="linenum">1397</span></a>  <span class="comment"> * given block (instance and positions). If the block has custom DB structure</span>
<a name="l1398"><span class="linenum">1398</span></a>  <span class="comment"> * that will go to a separate file (different step defined in block class)</span>
<a name="l1399"><span class="linenum">1399</span></a>  <span class="comment"> */</span>
<a name="l1400"><span class="linenum">1400</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_block_instance_structure_step')" href="../../_classes/backup_block_instance_structure_step.html" onMouseOver="classPopup(event,'backup_block_instance_structure_step')">backup_block_instance_structure_step</a> extends backup_structure_step {
<a name="l1401"><span class="linenum">1401</span></a>  
<a name="l1402"><span class="linenum">1402</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1403"><span class="linenum">1403</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1404"><span class="linenum">1404</span></a>  
<a name="l1405"><span class="linenum">1405</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l1406"><span class="linenum">1406</span></a>  
<a name="l1407"><span class="linenum">1407</span></a>          <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('block', array('id', 'contextid', 'version'), array(
<a name="l1408"><span class="linenum">1408</span></a>              'blockname', 'parentcontextid', 'showinsubcontexts', 'pagetypepattern',
<a name="l1409"><span class="linenum">1409</span></a>              'subpagepattern', 'defaultregion', 'defaultweight', 'configdata'));
<a name="l1410"><span class="linenum">1410</span></a>  
<a name="l1411"><span class="linenum">1411</span></a>          <a class="var it6069" onMouseOver="hilite(6069)" onMouseOut="lolite()" onClick="logVariable('positions')" href="../../_variables/positions.html">$positions</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('block_positions');
<a name="l1412"><span class="linenum">1412</span></a>  
<a name="l1413"><span class="linenum">1413</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('position')" href="../../_variables/position.html">$position</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('block_position', array('id'), array(
<a name="l1414"><span class="linenum">1414</span></a>              'contextid', 'pagetype', 'subpage', 'visible',
<a name="l1415"><span class="linenum">1415</span></a>              'region', 'weight'));
<a name="l1416"><span class="linenum">1416</span></a>  
<a name="l1417"><span class="linenum">1417</span></a>  <span class="comment">        // Build the tree</span>
<a name="l1418"><span class="linenum">1418</span></a>  
<a name="l1419"><span class="linenum">1419</span></a>          <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6069" onMouseOver="hilite(6069)" onMouseOut="lolite()" onClick="logVariable('positions')" href="../../_variables/positions.html">$positions</a>);
<a name="l1420"><span class="linenum">1420</span></a>          <a class="var it6069" onMouseOver="hilite(6069)" onMouseOut="lolite()" onClick="logVariable('positions')" href="../../_variables/positions.html">$positions</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('position')" href="../../_variables/position.html">$position</a>);
<a name="l1421"><span class="linenum">1421</span></a>  
<a name="l1422"><span class="linenum">1422</span></a>  <span class="comment">        // Transform configdata information if needed (process links and friends)</span>
<a name="l1423"><span class="linenum">1423</span></a>          <a class="var it6070" onMouseOver="hilite(6070)" onMouseOut="lolite()" onClick="logVariable('blockrec')" href="../../_variables/blockrec.html">$blockrec</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('block_instances', array('id' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_blockid')" href="../../_functions/get_blockid.html" onMouseOver="funcPopup(event,'get_blockid')">get_blockid</a>()));
<a name="l1424"><span class="linenum">1424</span></a>          if (<a class="var it6071" onMouseOver="hilite(6071)" onMouseOut="lolite()" onClick="logVariable('attrstotransform')" href="../../_variables/attrstotransform.html">$attrstotransform</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_configdata_encoded_attributes')" href="../../_functions/get_configdata_encoded_attributes.html" onMouseOver="funcPopup(event,'get_configdata_encoded_attributes')">get_configdata_encoded_attributes</a>()) {
<a name="l1425"><span class="linenum">1425</span></a>              <a class="var it3664" onMouseOver="hilite(3664)" onMouseOut="lolite()" onClick="logVariable('configdata')" href="../../_variables/configdata.html">$configdata</a> = (array)<a class="phpfunction" onClick="logFunction('unserialize')" href="../../_functions/unserialize.html" onMouseOver="phpfuncPopup(event,'unserialize')">unserialize</a>(<a class="phpfunction" onClick="logFunction('base64_decode')" href="../../_functions/base64_decode.html" onMouseOver="phpfuncPopup(event,'base64_decode')">base64_decode</a>(<a class="var it6070" onMouseOver="hilite(6070)" onMouseOut="lolite()" onClick="logVariable('blockrec')" href="../../_variables/blockrec.html">$blockrec</a>-&gt;<a onClick="logVariable('configdata')" class="var it41348" onMouseOver="hilite(41348)" onMouseOut="lolite()" href="../../_variables/configdata.html">configdata</a>));
<a name="l1426"><span class="linenum">1426</span></a>              foreach (<a class="var it3664" onMouseOver="hilite(3664)" onMouseOut="lolite()" onClick="logVariable('configdata')" href="../../_variables/configdata.html">$configdata</a> as <a class="var it2515" onMouseOver="hilite(2515)" onMouseOut="lolite()" onClick="logVariable('attribute')" href="../../_variables/attribute.html">$attribute</a> =&gt; <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l1427"><span class="linenum">1427</span></a>                  if (<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it2515" onMouseOver="hilite(2515)" onMouseOut="lolite()" onClick="logVariable('attribute')" href="../../_variables/attribute.html">$attribute</a>, <a class="var it6071" onMouseOver="hilite(6071)" onMouseOut="lolite()" onClick="logVariable('attrstotransform')" href="../../_variables/attrstotransform.html">$attrstotransform</a>)) {
<a name="l1428"><span class="linenum">1428</span></a>                      <a class="var it3664" onMouseOver="hilite(3664)" onMouseOut="lolite()" onClick="logVariable('configdata')" href="../../_variables/configdata.html">$configdata</a>[<a class="var it2515" onMouseOver="hilite(2515)" onMouseOut="lolite()" onClick="logVariable('attribute')" href="../../_variables/attribute.html">$attribute</a>] = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('contenttransformer')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/contenttransformer.html">contenttransformer</a>-&gt;<a class="function" onClick="logFunction('process')" href="../../_functions/process.html" onMouseOver="funcPopup(event,'process')">process</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>);
<a name="l1429"><span class="linenum">1429</span></a>                  }
<a name="l1430"><span class="linenum">1430</span></a>              }
<a name="l1431"><span class="linenum">1431</span></a>              <a class="var it6070" onMouseOver="hilite(6070)" onMouseOut="lolite()" onClick="logVariable('blockrec')" href="../../_variables/blockrec.html">$blockrec</a>-&gt;<a onClick="logVariable('configdata')" class="var it41348" onMouseOver="hilite(41348)" onMouseOut="lolite()" href="../../_variables/configdata.html">configdata</a> = <a class="phpfunction" onClick="logFunction('base64_encode')" href="../../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="phpfunction" onClick="logFunction('serialize')" href="../../_functions/serialize.html" onMouseOver="phpfuncPopup(event,'serialize')">serialize</a>((object)<a class="var it3664" onMouseOver="hilite(3664)" onMouseOut="lolite()" onClick="logVariable('configdata')" href="../../_variables/configdata.html">$configdata</a>));
<a name="l1432"><span class="linenum">1432</span></a>          }
<a name="l1433"><span class="linenum">1433</span></a>          <a class="var it6070" onMouseOver="hilite(6070)" onMouseOut="lolite()" onClick="logVariable('blockrec')" href="../../_variables/blockrec.html">$blockrec</a>-&gt;<a onClick="logVariable('contextid')" class="var it41348" onMouseOver="hilite(41348)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>();
<a name="l1434"><span class="linenum">1434</span></a>  <span class="comment">        // Get the version of the block</span>
<a name="l1435"><span class="linenum">1435</span></a>          <a class="var it6070" onMouseOver="hilite(6070)" onMouseOut="lolite()" onClick="logVariable('blockrec')" href="../../_variables/blockrec.html">$blockrec</a>-&gt;<a onClick="logVariable('version')" class="var it41348" onMouseOver="hilite(41348)" onMouseOut="lolite()" href="../../_variables/version.html">version</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('block_'.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_blockname')" href="../../_functions/get_blockname.html" onMouseOver="funcPopup(event,'get_blockname')">get_blockname</a>(), 'version');
<a name="l1436"><span class="linenum">1436</span></a>  
<a name="l1437"><span class="linenum">1437</span></a>  <span class="comment">        // Define sources</span>
<a name="l1438"><span class="linenum">1438</span></a>  
<a name="l1439"><span class="linenum">1439</span></a>          <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(array(<a class="var it6070" onMouseOver="hilite(6070)" onMouseOut="lolite()" onClick="logVariable('blockrec')" href="../../_variables/blockrec.html">$blockrec</a>));
<a name="l1440"><span class="linenum">1440</span></a>  
<a name="l1441"><span class="linenum">1441</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('position')" href="../../_variables/position.html">$position</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('block_positions', array('blockinstanceid' =&gt; backup::VAR_PARENTID));
<a name="l1442"><span class="linenum">1442</span></a>  
<a name="l1443"><span class="linenum">1443</span></a>  <span class="comment">        // File anotations (for fileareas specified on each block)</span>
<a name="l1444"><span class="linenum">1444</span></a>          foreach (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_fileareas')" href="../../_functions/get_fileareas.html" onMouseOver="funcPopup(event,'get_fileareas')">get_fileareas</a>() as <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>) {
<a name="l1445"><span class="linenum">1445</span></a>              <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('block_' . <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_blockname')" href="../../_functions/get_blockname.html" onMouseOver="funcPopup(event,'get_blockname')">get_blockname</a>(), <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, null);
<a name="l1446"><span class="linenum">1446</span></a>          }
<a name="l1447"><span class="linenum">1447</span></a>  
<a name="l1448"><span class="linenum">1448</span></a>  <span class="comment">        // Return the root element (block)</span>
<a name="l1449"><span class="linenum">1449</span></a>          return <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>;
<a name="l1450"><span class="linenum">1450</span></a>      }
<a name="l1451"><span class="linenum">1451</span></a>  }
<a name="l1452"><span class="linenum">1452</span></a>  
<a name="l1453"><span class="linenum">1453</span></a>  <span class="comment">/**</span>
<a name="l1454"><span class="linenum">1454</span></a>  <span class="comment"> * structure step in charge of constructing the logs.xml file for all the log records found</span>
<a name="l1455"><span class="linenum">1455</span></a>  <span class="comment"> * in course. Note that we are sending to backup ALL the log records having cmid = 0. That</span>
<a name="l1456"><span class="linenum">1456</span></a>  <span class="comment"> * includes some records that won't be restoreable (like 'upload', 'calendar'...) but we do</span>
<a name="l1457"><span class="linenum">1457</span></a>  <span class="comment"> * that just in case they become restored some day in the future</span>
<a name="l1458"><span class="linenum">1458</span></a>  <span class="comment"> */</span>
<a name="l1459"><span class="linenum">1459</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_course_logs_structure_step')" href="../../_classes/backup_course_logs_structure_step.html" onMouseOver="classPopup(event,'backup_course_logs_structure_step')">backup_course_logs_structure_step</a> extends backup_structure_step {
<a name="l1460"><span class="linenum">1460</span></a>  
<a name="l1461"><span class="linenum">1461</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1462"><span class="linenum">1462</span></a>  
<a name="l1463"><span class="linenum">1463</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l1464"><span class="linenum">1464</span></a>  
<a name="l1465"><span class="linenum">1465</span></a>          <a class="var it1692" onMouseOver="hilite(1692)" onMouseOut="lolite()" onClick="logVariable('logs')" href="../../_variables/logs.html">$logs</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('logs');
<a name="l1466"><span class="linenum">1466</span></a>  
<a name="l1467"><span class="linenum">1467</span></a>          <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('log', array('id'), array(
<a name="l1468"><span class="linenum">1468</span></a>              'time', 'userid', 'ip', 'module',
<a name="l1469"><span class="linenum">1469</span></a>              'action', 'url', 'info'));
<a name="l1470"><span class="linenum">1470</span></a>  
<a name="l1471"><span class="linenum">1471</span></a>  <span class="comment">        // Build the tree</span>
<a name="l1472"><span class="linenum">1472</span></a>  
<a name="l1473"><span class="linenum">1473</span></a>          <a class="var it1692" onMouseOver="hilite(1692)" onMouseOut="lolite()" onClick="logVariable('logs')" href="../../_variables/logs.html">$logs</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>);
<a name="l1474"><span class="linenum">1474</span></a>  
<a name="l1475"><span class="linenum">1475</span></a>  <span class="comment">        // Define sources (all the records belonging to the course, having cmid = 0)</span>
<a name="l1476"><span class="linenum">1476</span></a>  
<a name="l1477"><span class="linenum">1477</span></a>          <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('log', array('course' =&gt; backup::VAR_COURSEID, 'cmid' =&gt; backup_helper::<a class="function" onClick="logFunction('is_sqlparam')" href="../../_functions/is_sqlparam.html" onMouseOver="funcPopup(event,'is_sqlparam')">is_sqlparam</a>(0)));
<a name="l1478"><span class="linenum">1478</span></a>  
<a name="l1479"><span class="linenum">1479</span></a>  <span class="comment">        // Annotations</span>
<a name="l1480"><span class="linenum">1480</span></a>  <span class="comment">        // NOTE: We don't annotate users from logs as far as they MUST be</span>
<a name="l1481"><span class="linenum">1481</span></a>  <span class="comment">        //       always annotated by the course (enrol, ras... whatever)</span>
<a name="l1482"><span class="linenum">1482</span></a>  
<a name="l1483"><span class="linenum">1483</span></a>  <span class="comment">        // Return the root element (logs)</span>
<a name="l1484"><span class="linenum">1484</span></a>  
<a name="l1485"><span class="linenum">1485</span></a>          return <a class="var it1692" onMouseOver="hilite(1692)" onMouseOut="lolite()" onClick="logVariable('logs')" href="../../_variables/logs.html">$logs</a>;
<a name="l1486"><span class="linenum">1486</span></a>      }
<a name="l1487"><span class="linenum">1487</span></a>  }
<a name="l1488"><span class="linenum">1488</span></a>  
<a name="l1489"><span class="linenum">1489</span></a>  <span class="comment">/**</span>
<a name="l1490"><span class="linenum">1490</span></a>  <span class="comment"> * structure step in charge of constructing the logs.xml file for all the log records found</span>
<a name="l1491"><span class="linenum">1491</span></a>  <span class="comment"> * in activity</span>
<a name="l1492"><span class="linenum">1492</span></a>  <span class="comment"> */</span>
<a name="l1493"><span class="linenum">1493</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_activity_logs_structure_step')" href="../../_classes/backup_activity_logs_structure_step.html" onMouseOver="classPopup(event,'backup_activity_logs_structure_step')">backup_activity_logs_structure_step</a> extends backup_structure_step {
<a name="l1494"><span class="linenum">1494</span></a>  
<a name="l1495"><span class="linenum">1495</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1496"><span class="linenum">1496</span></a>  
<a name="l1497"><span class="linenum">1497</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l1498"><span class="linenum">1498</span></a>  
<a name="l1499"><span class="linenum">1499</span></a>          <a class="var it1692" onMouseOver="hilite(1692)" onMouseOut="lolite()" onClick="logVariable('logs')" href="../../_variables/logs.html">$logs</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('logs');
<a name="l1500"><span class="linenum">1500</span></a>  
<a name="l1501"><span class="linenum">1501</span></a>          <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('log', array('id'), array(
<a name="l1502"><span class="linenum">1502</span></a>              'time', 'userid', 'ip', 'module',
<a name="l1503"><span class="linenum">1503</span></a>              'action', 'url', 'info'));
<a name="l1504"><span class="linenum">1504</span></a>  
<a name="l1505"><span class="linenum">1505</span></a>  <span class="comment">        // Build the tree</span>
<a name="l1506"><span class="linenum">1506</span></a>  
<a name="l1507"><span class="linenum">1507</span></a>          <a class="var it1692" onMouseOver="hilite(1692)" onMouseOut="lolite()" onClick="logVariable('logs')" href="../../_variables/logs.html">$logs</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>);
<a name="l1508"><span class="linenum">1508</span></a>  
<a name="l1509"><span class="linenum">1509</span></a>  <span class="comment">        // Define sources</span>
<a name="l1510"><span class="linenum">1510</span></a>  
<a name="l1511"><span class="linenum">1511</span></a>          <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('log', array('cmid' =&gt; backup::VAR_MODID));
<a name="l1512"><span class="linenum">1512</span></a>  
<a name="l1513"><span class="linenum">1513</span></a>  <span class="comment">        // Annotations</span>
<a name="l1514"><span class="linenum">1514</span></a>  <span class="comment">        // NOTE: We don't annotate users from logs as far as they MUST be</span>
<a name="l1515"><span class="linenum">1515</span></a>  <span class="comment">        //       always annotated by the activity (true participants).</span>
<a name="l1516"><span class="linenum">1516</span></a>  
<a name="l1517"><span class="linenum">1517</span></a>  <span class="comment">        // Return the root element (logs)</span>
<a name="l1518"><span class="linenum">1518</span></a>  
<a name="l1519"><span class="linenum">1519</span></a>          return <a class="var it1692" onMouseOver="hilite(1692)" onMouseOut="lolite()" onClick="logVariable('logs')" href="../../_variables/logs.html">$logs</a>;
<a name="l1520"><span class="linenum">1520</span></a>      }
<a name="l1521"><span class="linenum">1521</span></a>  }
<a name="l1522"><span class="linenum">1522</span></a>  
<a name="l1523"><span class="linenum">1523</span></a>  <span class="comment">/**</span>
<a name="l1524"><span class="linenum">1524</span></a>  <span class="comment"> * structure in charge of constructing the inforef.xml file for all the items we want</span>
<a name="l1525"><span class="linenum">1525</span></a>  <span class="comment"> * to have referenced there (users, roles, files...)</span>
<a name="l1526"><span class="linenum">1526</span></a>  <span class="comment"> */</span>
<a name="l1527"><span class="linenum">1527</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_inforef_structure_step')" href="../../_classes/backup_inforef_structure_step.html" onMouseOver="classPopup(event,'backup_inforef_structure_step')">backup_inforef_structure_step</a> extends backup_structure_step {
<a name="l1528"><span class="linenum">1528</span></a>  
<a name="l1529"><span class="linenum">1529</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1530"><span class="linenum">1530</span></a>  
<a name="l1531"><span class="linenum">1531</span></a>  <span class="comment">        // Items we want to include in the inforef file.</span>
<a name="l1532"><span class="linenum">1532</span></a>          <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a> = backup_helper::<a class="function" onClick="logFunction('get_inforef_itemnames')" href="../../_functions/get_inforef_itemnames.html" onMouseOver="funcPopup(event,'get_inforef_itemnames')">get_inforef_itemnames</a>();
<a name="l1533"><span class="linenum">1533</span></a>  
<a name="l1534"><span class="linenum">1534</span></a>  <span class="comment">        // Build the tree</span>
<a name="l1535"><span class="linenum">1535</span></a>  
<a name="l1536"><span class="linenum">1536</span></a>          <a class="var it1413" onMouseOver="hilite(1413)" onMouseOut="lolite()" onClick="logVariable('inforef')" href="../../_variables/inforef.html">$inforef</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('inforef');
<a name="l1537"><span class="linenum">1537</span></a>  
<a name="l1538"><span class="linenum">1538</span></a>  <span class="comment">        // For each item, conditionally, if there are already records, build element</span>
<a name="l1539"><span class="linenum">1539</span></a>          foreach (<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a> as <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>) {
<a name="l1540"><span class="linenum">1540</span></a>              if (backup_structure_dbops::<a class="function" onClick="logFunction('annotations_exist')" href="../../_functions/annotations_exist.html" onMouseOver="funcPopup(event,'annotations_exist')">annotations_exist</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>)) {
<a name="l1541"><span class="linenum">1541</span></a>                  <a class="var it6073" onMouseOver="hilite(6073)" onMouseOut="lolite()" onClick="logVariable('elementroot')" href="../../_variables/elementroot.html">$elementroot</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>(<a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a> . 'ref');
<a name="l1542"><span class="linenum">1542</span></a>                  <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>(<a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>, array(), array('id'));
<a name="l1543"><span class="linenum">1543</span></a>                  <a class="var it1413" onMouseOver="hilite(1413)" onMouseOut="lolite()" onClick="logVariable('inforef')" href="../../_variables/inforef.html">$inforef</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6073" onMouseOver="hilite(6073)" onMouseOut="lolite()" onClick="logVariable('elementroot')" href="../../_variables/elementroot.html">$elementroot</a>);
<a name="l1544"><span class="linenum">1544</span></a>                  <a class="var it6073" onMouseOver="hilite(6073)" onMouseOut="lolite()" onClick="logVariable('elementroot')" href="../../_variables/elementroot.html">$elementroot</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>);
<a name="l1545"><span class="linenum">1545</span></a>                  <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('element')" href="../../_variables/element.html">$element</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;
<a name="l1546"><span class="linenum">1546</span></a>                      SELECT itemid AS id
<a name="l1547"><span class="linenum">1547</span></a>                       FROM {backup_ids_temp}
<a name="l1548"><span class="linenum">1548</span></a>                      WHERE backupid = ?
<a name="l1549"><span class="linenum">1549</span></a>                        AND itemname = ?&quot;,
<a name="l1550"><span class="linenum">1550</span></a>                     array(backup::VAR_BACKUPID, backup_helper::<a class="function" onClick="logFunction('is_sqlparam')" href="../../_functions/is_sqlparam.html" onMouseOver="funcPopup(event,'is_sqlparam')">is_sqlparam</a>(<a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>)));
<a name="l1551"><span class="linenum">1551</span></a>              }
<a name="l1552"><span class="linenum">1552</span></a>          }
<a name="l1553"><span class="linenum">1553</span></a>  
<a name="l1554"><span class="linenum">1554</span></a>  <span class="comment">        // We don't annotate anything there, but rely in the next step</span>
<a name="l1555"><span class="linenum">1555</span></a>  <span class="comment">        // (move_inforef_annotations_to_final) that will change all the</span>
<a name="l1556"><span class="linenum">1556</span></a>  <span class="comment">        // already saved 'inforref' entries to their 'final' annotations.</span>
<a name="l1557"><span class="linenum">1557</span></a>          return <a class="var it1413" onMouseOver="hilite(1413)" onMouseOut="lolite()" onClick="logVariable('inforef')" href="../../_variables/inforef.html">$inforef</a>;
<a name="l1558"><span class="linenum">1558</span></a>      }
<a name="l1559"><span class="linenum">1559</span></a>  }
<a name="l1560"><span class="linenum">1560</span></a>  
<a name="l1561"><span class="linenum">1561</span></a>  <span class="comment">/**</span>
<a name="l1562"><span class="linenum">1562</span></a>  <span class="comment"> * This step will get all the annotations already processed to inforef.xml file and</span>
<a name="l1563"><span class="linenum">1563</span></a>  <span class="comment"> * transform them into 'final' annotations.</span>
<a name="l1564"><span class="linenum">1564</span></a>  <span class="comment"> */</span>
<a name="l1565"><span class="linenum">1565</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('move_inforef_annotations_to_final')" href="../../_classes/move_inforef_annotations_to_final.html" onMouseOver="classPopup(event,'move_inforef_annotations_to_final')">move_inforef_annotations_to_final</a> extends backup_execution_step {
<a name="l1566"><span class="linenum">1566</span></a>  
<a name="l1567"><span class="linenum">1567</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l1568"><span class="linenum">1568</span></a>  
<a name="l1569"><span class="linenum">1569</span></a>  <span class="comment">        // Items we want to include in the inforef file</span>
<a name="l1570"><span class="linenum">1570</span></a>          <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a> = backup_helper::<a class="function" onClick="logFunction('get_inforef_itemnames')" href="../../_functions/get_inforef_itemnames.html" onMouseOver="funcPopup(event,'get_inforef_itemnames')">get_inforef_itemnames</a>();
<a name="l1571"><span class="linenum">1571</span></a>          <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>();
<a name="l1572"><span class="linenum">1572</span></a>          <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>(), <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a>));
<a name="l1573"><span class="linenum">1573</span></a>          <a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a> = 1;
<a name="l1574"><span class="linenum">1574</span></a>          foreach (<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a> as <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>) {
<a name="l1575"><span class="linenum">1575</span></a>  <span class="comment">            // Delegate to dbops</span>
<a name="l1576"><span class="linenum">1576</span></a>              backup_structure_dbops::<a class="function" onClick="logFunction('move_annotations_to_final')" href="../../_functions/move_annotations_to_final.html" onMouseOver="funcPopup(event,'move_annotations_to_final')">move_annotations_to_final</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(),
<a name="l1577"><span class="linenum">1577</span></a>                      <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>, <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>);
<a name="l1578"><span class="linenum">1578</span></a>              <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('progress')" href="../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>(<a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a>++);
<a name="l1579"><span class="linenum">1579</span></a>          }
<a name="l1580"><span class="linenum">1580</span></a>          <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l1581"><span class="linenum">1581</span></a>      }
<a name="l1582"><span class="linenum">1582</span></a>  }
<a name="l1583"><span class="linenum">1583</span></a>  
<a name="l1584"><span class="linenum">1584</span></a>  <span class="comment">/**</span>
<a name="l1585"><span class="linenum">1585</span></a>  <span class="comment"> * structure in charge of constructing the files.xml file with all the</span>
<a name="l1586"><span class="linenum">1586</span></a>  <span class="comment"> * annotated (final) files along the process. At, the same time, and</span>
<a name="l1587"><span class="linenum">1587</span></a>  <span class="comment"> * using one specialised nested_element, will copy them form moodle storage</span>
<a name="l1588"><span class="linenum">1588</span></a>  <span class="comment"> * to backup storage</span>
<a name="l1589"><span class="linenum">1589</span></a>  <span class="comment"> */</span>
<a name="l1590"><span class="linenum">1590</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_final_files_structure_step')" href="../../_classes/backup_final_files_structure_step.html" onMouseOver="classPopup(event,'backup_final_files_structure_step')">backup_final_files_structure_step</a> extends backup_structure_step {
<a name="l1591"><span class="linenum">1591</span></a>  
<a name="l1592"><span class="linenum">1592</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1593"><span class="linenum">1593</span></a>  
<a name="l1594"><span class="linenum">1594</span></a>  <span class="comment">        // Define elements</span>
<a name="l1595"><span class="linenum">1595</span></a>  
<a name="l1596"><span class="linenum">1596</span></a>          <a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('files');
<a name="l1597"><span class="linenum">1597</span></a>  
<a name="l1598"><span class="linenum">1598</span></a>          <a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <span class="keyword">new </span><a class="class" onClick="logClass('file_nested_element')" href="../../_classes/file_nested_element.html" onMouseOver="classPopup(event,'file_nested_element')">file_nested_element</a>('file', array('id'), array(
<a name="l1599"><span class="linenum">1599</span></a>              'contenthash', 'contextid', 'component', 'filearea', 'itemid',
<a name="l1600"><span class="linenum">1600</span></a>              'filepath', 'filename', 'userid', 'filesize',
<a name="l1601"><span class="linenum">1601</span></a>              'mimetype', 'status', 'timecreated', 'timemodified',
<a name="l1602"><span class="linenum">1602</span></a>              'source', 'author', 'license', 'sortorder',
<a name="l1603"><span class="linenum">1603</span></a>              'repositorytype', 'repositoryid', 'reference'));
<a name="l1604"><span class="linenum">1604</span></a>  
<a name="l1605"><span class="linenum">1605</span></a>  <span class="comment">        // Build the tree</span>
<a name="l1606"><span class="linenum">1606</span></a>  
<a name="l1607"><span class="linenum">1607</span></a>          <a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>);
<a name="l1608"><span class="linenum">1608</span></a>  
<a name="l1609"><span class="linenum">1609</span></a>  <span class="comment">        // Define sources</span>
<a name="l1610"><span class="linenum">1610</span></a>  
<a name="l1611"><span class="linenum">1611</span></a>          <a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;SELECT f.*, r.type AS repositorytype, fr.repositoryid, fr.reference
<a name="l1612"><span class="linenum">1612</span></a>                                   FROM {files} f
<a name="l1613"><span class="linenum">1613</span></a>                                        LEFT JOIN {files_reference} fr ON fr.id = f.referencefileid
<a name="l1614"><span class="linenum">1614</span></a>                                        LEFT JOIN {repository_instances} ri ON ri.id = fr.repositoryid
<a name="l1615"><span class="linenum">1615</span></a>                                        LEFT JOIN {repository} r ON r.id = ri.typeid
<a name="l1616"><span class="linenum">1616</span></a>                                        JOIN {backup_ids_temp} bi ON f.id = bi.itemid
<a name="l1617"><span class="linenum">1617</span></a>                                  WHERE bi.backupid = ?
<a name="l1618"><span class="linenum">1618</span></a>                                    AND bi.itemname = 'filefinal'&quot;, array(backup::VAR_BACKUPID));
<a name="l1619"><span class="linenum">1619</span></a>  
<a name="l1620"><span class="linenum">1620</span></a>          return <a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>;
<a name="l1621"><span class="linenum">1621</span></a>      }
<a name="l1622"><span class="linenum">1622</span></a>  }
<a name="l1623"><span class="linenum">1623</span></a>  
<a name="l1624"><span class="linenum">1624</span></a>  <span class="comment">/**</span>
<a name="l1625"><span class="linenum">1625</span></a>  <span class="comment"> * Structure step in charge of creating the main moodle_backup.xml file</span>
<a name="l1626"><span class="linenum">1626</span></a>  <span class="comment"> * where all the information related to the backup, settings, license and</span>
<a name="l1627"><span class="linenum">1627</span></a>  <span class="comment"> * other information needed on restore is added*/</span>
<a name="l1628"><span class="linenum">1628</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_main_structure_step')" href="../../_classes/backup_main_structure_step.html" onMouseOver="classPopup(event,'backup_main_structure_step')">backup_main_structure_step</a> extends backup_structure_step {
<a name="l1629"><span class="linenum">1629</span></a>  
<a name="l1630"><span class="linenum">1630</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l1631"><span class="linenum">1631</span></a>  
<a name="l1632"><span class="linenum">1632</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1633"><span class="linenum">1633</span></a>  
<a name="l1634"><span class="linenum">1634</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = array();
<a name="l1635"><span class="linenum">1635</span></a>  
<a name="l1636"><span class="linenum">1636</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['name'] = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('filename');
<a name="l1637"><span class="linenum">1637</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['moodle_version'] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('version')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/version.html">version</a>;
<a name="l1638"><span class="linenum">1638</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['moodle_release'] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('release')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/release.html">release</a>;
<a name="l1639"><span class="linenum">1639</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['backup_version'] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('backup_version')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/backup_version.html">backup_version</a>;
<a name="l1640"><span class="linenum">1640</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['backup_release'] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('backup_release')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/backup_release.html">backup_release</a>;
<a name="l1641"><span class="linenum">1641</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['backup_date']    = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1642"><span class="linenum">1642</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['backup_uniqueid']= <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>();
<a name="l1643"><span class="linenum">1643</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['mnet_remoteusers']=backup_controller_dbops::<a class="function" onClick="logFunction('backup_includes_mnet_remote_users')" href="../../_functions/backup_includes_mnet_remote_users.html" onMouseOver="funcPopup(event,'backup_includes_mnet_remote_users')">backup_includes_mnet_remote_users</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>());
<a name="l1644"><span class="linenum">1644</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['include_files'] = backup_controller_dbops::<a class="function" onClick="logFunction('backup_includes_files')" href="../../_functions/backup_includes_files.html" onMouseOver="funcPopup(event,'backup_includes_files')">backup_includes_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>());
<a name="l1645"><span class="linenum">1645</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['include_file_references_to_external_content'] =
<a name="l1646"><span class="linenum">1646</span></a>                  backup_controller_dbops::<a class="function" onClick="logFunction('backup_includes_file_references')" href="../../_functions/backup_includes_file_references.html" onMouseOver="funcPopup(event,'backup_includes_file_references')">backup_includes_file_references</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>());
<a name="l1647"><span class="linenum">1647</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['original_wwwroot']=<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>;
<a name="l1648"><span class="linenum">1648</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['original_site_identifier_hash'] = md5(<a class="function" onClick="logFunction('get_site_identifier')" href="../../_functions/get_site_identifier.html" onMouseOver="funcPopup(event,'get_site_identifier')">get_site_identifier</a>());
<a name="l1649"><span class="linenum">1649</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['original_course_id'] = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>();
<a name="l1650"><span class="linenum">1650</span></a>          <a class="var it6077" onMouseOver="hilite(6077)" onMouseOut="lolite()" onClick="logVariable('originalcourseinfo')" href="../../_variables/originalcourseinfo.html">$originalcourseinfo</a> = backup_controller_dbops::<a class="function" onClick="logFunction('backup_get_original_course_info')" href="../../_functions/backup_get_original_course_info.html" onMouseOver="funcPopup(event,'backup_get_original_course_info')">backup_get_original_course_info</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>());
<a name="l1651"><span class="linenum">1651</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['original_course_format'] = <a class="var it6077" onMouseOver="hilite(6077)" onMouseOut="lolite()" onClick="logVariable('originalcourseinfo')" href="../../_variables/originalcourseinfo.html">$originalcourseinfo</a>-&gt;<a onClick="logVariable('format')" class="var it41349" onMouseOver="hilite(41349)" onMouseOut="lolite()" href="../../_variables/format.html">format</a>;
<a name="l1652"><span class="linenum">1652</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['original_course_fullname']  = <a class="var it6077" onMouseOver="hilite(6077)" onMouseOut="lolite()" onClick="logVariable('originalcourseinfo')" href="../../_variables/originalcourseinfo.html">$originalcourseinfo</a>-&gt;<a onClick="logVariable('fullname')" class="var it41349" onMouseOver="hilite(41349)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>;
<a name="l1653"><span class="linenum">1653</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['original_course_shortname'] = <a class="var it6077" onMouseOver="hilite(6077)" onMouseOut="lolite()" onClick="logVariable('originalcourseinfo')" href="../../_variables/originalcourseinfo.html">$originalcourseinfo</a>-&gt;<a onClick="logVariable('shortname')" class="var it41349" onMouseOver="hilite(41349)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>;
<a name="l1654"><span class="linenum">1654</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['original_course_startdate'] = <a class="var it6077" onMouseOver="hilite(6077)" onMouseOut="lolite()" onClick="logVariable('originalcourseinfo')" href="../../_variables/originalcourseinfo.html">$originalcourseinfo</a>-&gt;<a onClick="logVariable('startdate')" class="var it41349" onMouseOver="hilite(41349)" onMouseOut="lolite()" href="../../_variables/startdate.html">startdate</a>;
<a name="l1655"><span class="linenum">1655</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['original_course_contextid'] = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>())-&gt;id;
<a name="l1656"><span class="linenum">1656</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['original_system_contextid'] = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;id;
<a name="l1657"><span class="linenum">1657</span></a>  
<a name="l1658"><span class="linenum">1658</span></a>  <span class="comment">        // Get more information from controller</span>
<a name="l1659"><span class="linenum">1659</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it6079" onMouseOver="hilite(6079)" onMouseOut="lolite()" onClick="logVariable('dinfo')" href="../../_variables/dinfo.html">$dinfo</a>, <a class="var it6080" onMouseOver="hilite(6080)" onMouseOut="lolite()" onClick="logVariable('cinfo')" href="../../_variables/cinfo.html">$cinfo</a>, <a class="var it6081" onMouseOver="hilite(6081)" onMouseOut="lolite()" onClick="logVariable('sinfo')" href="../../_variables/sinfo.html">$sinfo</a>) = backup_controller_dbops::<a class="function" onClick="logFunction('get_moodle_backup_information')" href="../../_functions/get_moodle_backup_information.html" onMouseOver="funcPopup(event,'get_moodle_backup_information')">get_moodle_backup_information</a>(
<a name="l1660"><span class="linenum">1660</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_task')" href="../../_functions/get_task.html" onMouseOver="funcPopup(event,'get_task')">get_task</a>()-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>());
<a name="l1661"><span class="linenum">1661</span></a>  
<a name="l1662"><span class="linenum">1662</span></a>  <span class="comment">        // Define elements</span>
<a name="l1663"><span class="linenum">1663</span></a>  
<a name="l1664"><span class="linenum">1664</span></a>          <a class="var it6082" onMouseOver="hilite(6082)" onMouseOut="lolite()" onClick="logVariable('moodle_backup')" href="../../_variables/moodle_backup.html">$moodle_backup</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('moodle_backup');
<a name="l1665"><span class="linenum">1665</span></a>  
<a name="l1666"><span class="linenum">1666</span></a>          <a class="var it4931" onMouseOver="hilite(4931)" onMouseOut="lolite()" onClick="logVariable('information')" href="../../_variables/information.html">$information</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('information', null, array(
<a name="l1667"><span class="linenum">1667</span></a>              'name', 'moodle_version', 'moodle_release', 'backup_version',
<a name="l1668"><span class="linenum">1668</span></a>              'backup_release', 'backup_date', 'mnet_remoteusers', 'include_files', 'include_file_references_to_external_content', 'original_wwwroot',
<a name="l1669"><span class="linenum">1669</span></a>              'original_site_identifier_hash', 'original_course_id', 'original_course_format',
<a name="l1670"><span class="linenum">1670</span></a>              'original_course_fullname', 'original_course_shortname', 'original_course_startdate',
<a name="l1671"><span class="linenum">1671</span></a>              'original_course_contextid', 'original_system_contextid'));
<a name="l1672"><span class="linenum">1672</span></a>  
<a name="l1673"><span class="linenum">1673</span></a>          <a class="var it1213" onMouseOver="hilite(1213)" onMouseOut="lolite()" onClick="logVariable('details')" href="../../_variables/details.html">$details</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('details');
<a name="l1674"><span class="linenum">1674</span></a>  
<a name="l1675"><span class="linenum">1675</span></a>          <a class="var it6083" onMouseOver="hilite(6083)" onMouseOut="lolite()" onClick="logVariable('detail')" href="../../_variables/detail.html">$detail</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('detail', array('backup_id'), array(
<a name="l1676"><span class="linenum">1676</span></a>              'type', 'format', 'interactive', 'mode',
<a name="l1677"><span class="linenum">1677</span></a>              'execution', 'executiontime'));
<a name="l1678"><span class="linenum">1678</span></a>  
<a name="l1679"><span class="linenum">1679</span></a>          <a class="var it1144" onMouseOver="hilite(1144)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('contents');
<a name="l1680"><span class="linenum">1680</span></a>  
<a name="l1681"><span class="linenum">1681</span></a>          <a class="var it568" onMouseOver="hilite(568)" onMouseOut="lolite()" onClick="logVariable('activities')" href="../../_variables/activities.html">$activities</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('activities');
<a name="l1682"><span class="linenum">1682</span></a>  
<a name="l1683"><span class="linenum">1683</span></a>          <a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('activity', null, array(
<a name="l1684"><span class="linenum">1684</span></a>              'moduleid', 'sectionid', 'modulename', 'title',
<a name="l1685"><span class="linenum">1685</span></a>              'directory'));
<a name="l1686"><span class="linenum">1686</span></a>  
<a name="l1687"><span class="linenum">1687</span></a>          <a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('sections');
<a name="l1688"><span class="linenum">1688</span></a>  
<a name="l1689"><span class="linenum">1689</span></a>          <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('section', null, array(
<a name="l1690"><span class="linenum">1690</span></a>              'sectionid', 'title', 'directory'));
<a name="l1691"><span class="linenum">1691</span></a>  
<a name="l1692"><span class="linenum">1692</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('course', null, array(
<a name="l1693"><span class="linenum">1693</span></a>              'courseid', 'title', 'directory'));
<a name="l1694"><span class="linenum">1694</span></a>  
<a name="l1695"><span class="linenum">1695</span></a>          <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('settings');
<a name="l1696"><span class="linenum">1696</span></a>  
<a name="l1697"><span class="linenum">1697</span></a>          <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('setting')" href="../../_variables/setting.html">$setting</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('setting', null, array(
<a name="l1698"><span class="linenum">1698</span></a>              'level', 'section', 'activity', 'name', 'value'));
<a name="l1699"><span class="linenum">1699</span></a>  
<a name="l1700"><span class="linenum">1700</span></a>  <span class="comment">        // Build the tree</span>
<a name="l1701"><span class="linenum">1701</span></a>  
<a name="l1702"><span class="linenum">1702</span></a>          <a class="var it6082" onMouseOver="hilite(6082)" onMouseOut="lolite()" onClick="logVariable('moodle_backup')" href="../../_variables/moodle_backup.html">$moodle_backup</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it4931" onMouseOver="hilite(4931)" onMouseOut="lolite()" onClick="logVariable('information')" href="../../_variables/information.html">$information</a>);
<a name="l1703"><span class="linenum">1703</span></a>  
<a name="l1704"><span class="linenum">1704</span></a>          <a class="var it4931" onMouseOver="hilite(4931)" onMouseOut="lolite()" onClick="logVariable('information')" href="../../_variables/information.html">$information</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1213" onMouseOver="hilite(1213)" onMouseOut="lolite()" onClick="logVariable('details')" href="../../_variables/details.html">$details</a>);
<a name="l1705"><span class="linenum">1705</span></a>          <a class="var it1213" onMouseOver="hilite(1213)" onMouseOut="lolite()" onClick="logVariable('details')" href="../../_variables/details.html">$details</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6083" onMouseOver="hilite(6083)" onMouseOut="lolite()" onClick="logVariable('detail')" href="../../_variables/detail.html">$detail</a>);
<a name="l1706"><span class="linenum">1706</span></a>  
<a name="l1707"><span class="linenum">1707</span></a>          <a class="var it4931" onMouseOver="hilite(4931)" onMouseOut="lolite()" onClick="logVariable('information')" href="../../_variables/information.html">$information</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1144" onMouseOver="hilite(1144)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a>);
<a name="l1708"><span class="linenum">1708</span></a>          if (!empty(<a class="var it6080" onMouseOver="hilite(6080)" onMouseOut="lolite()" onClick="logVariable('cinfo')" href="../../_variables/cinfo.html">$cinfo</a>['activities'])) {
<a name="l1709"><span class="linenum">1709</span></a>              <a class="var it1144" onMouseOver="hilite(1144)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it568" onMouseOver="hilite(568)" onMouseOut="lolite()" onClick="logVariable('activities')" href="../../_variables/activities.html">$activities</a>);
<a name="l1710"><span class="linenum">1710</span></a>              <a class="var it568" onMouseOver="hilite(568)" onMouseOut="lolite()" onClick="logVariable('activities')" href="../../_variables/activities.html">$activities</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>);
<a name="l1711"><span class="linenum">1711</span></a>          }
<a name="l1712"><span class="linenum">1712</span></a>          if (!empty(<a class="var it6080" onMouseOver="hilite(6080)" onMouseOut="lolite()" onClick="logVariable('cinfo')" href="../../_variables/cinfo.html">$cinfo</a>['sections'])) {
<a name="l1713"><span class="linenum">1713</span></a>              <a class="var it1144" onMouseOver="hilite(1144)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>);
<a name="l1714"><span class="linenum">1714</span></a>              <a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>);
<a name="l1715"><span class="linenum">1715</span></a>          }
<a name="l1716"><span class="linenum">1716</span></a>          if (!empty(<a class="var it6080" onMouseOver="hilite(6080)" onMouseOut="lolite()" onClick="logVariable('cinfo')" href="../../_variables/cinfo.html">$cinfo</a>['course'])) {
<a name="l1717"><span class="linenum">1717</span></a>              <a class="var it1144" onMouseOver="hilite(1144)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l1718"><span class="linenum">1718</span></a>          }
<a name="l1719"><span class="linenum">1719</span></a>  
<a name="l1720"><span class="linenum">1720</span></a>          <a class="var it4931" onMouseOver="hilite(4931)" onMouseOut="lolite()" onClick="logVariable('information')" href="../../_variables/information.html">$information</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>);
<a name="l1721"><span class="linenum">1721</span></a>          <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('setting')" href="../../_variables/setting.html">$setting</a>);
<a name="l1722"><span class="linenum">1722</span></a>  
<a name="l1723"><span class="linenum">1723</span></a>  
<a name="l1724"><span class="linenum">1724</span></a>  <span class="comment">        // Set the sources</span>
<a name="l1725"><span class="linenum">1725</span></a>  
<a name="l1726"><span class="linenum">1726</span></a>          <a class="var it4931" onMouseOver="hilite(4931)" onMouseOut="lolite()" onClick="logVariable('information')" href="../../_variables/information.html">$information</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(array((object)<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>));
<a name="l1727"><span class="linenum">1727</span></a>  
<a name="l1728"><span class="linenum">1728</span></a>          <a class="var it6083" onMouseOver="hilite(6083)" onMouseOut="lolite()" onClick="logVariable('detail')" href="../../_variables/detail.html">$detail</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(<a class="var it6079" onMouseOver="hilite(6079)" onMouseOut="lolite()" onClick="logVariable('dinfo')" href="../../_variables/dinfo.html">$dinfo</a>);
<a name="l1729"><span class="linenum">1729</span></a>  
<a name="l1730"><span class="linenum">1730</span></a>          <a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(<a class="var it6080" onMouseOver="hilite(6080)" onMouseOut="lolite()" onClick="logVariable('cinfo')" href="../../_variables/cinfo.html">$cinfo</a>['activities']);
<a name="l1731"><span class="linenum">1731</span></a>  
<a name="l1732"><span class="linenum">1732</span></a>          <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(<a class="var it6080" onMouseOver="hilite(6080)" onMouseOut="lolite()" onClick="logVariable('cinfo')" href="../../_variables/cinfo.html">$cinfo</a>['sections']);
<a name="l1733"><span class="linenum">1733</span></a>  
<a name="l1734"><span class="linenum">1734</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(<a class="var it6080" onMouseOver="hilite(6080)" onMouseOut="lolite()" onClick="logVariable('cinfo')" href="../../_variables/cinfo.html">$cinfo</a>['course']);
<a name="l1735"><span class="linenum">1735</span></a>  
<a name="l1736"><span class="linenum">1736</span></a>          <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('setting')" href="../../_variables/setting.html">$setting</a>-&gt;<a class="function" onClick="logFunction('set_source_array')" href="../../_functions/set_source_array.html" onMouseOver="funcPopup(event,'set_source_array')">set_source_array</a>(<a class="var it6081" onMouseOver="hilite(6081)" onMouseOut="lolite()" onClick="logVariable('sinfo')" href="../../_variables/sinfo.html">$sinfo</a>);
<a name="l1737"><span class="linenum">1737</span></a>  
<a name="l1738"><span class="linenum">1738</span></a>  <span class="comment">        // Prepare some information to be sent to main moodle_backup.xml file</span>
<a name="l1739"><span class="linenum">1739</span></a>          return <a class="var it6082" onMouseOver="hilite(6082)" onMouseOut="lolite()" onClick="logVariable('moodle_backup')" href="../../_variables/moodle_backup.html">$moodle_backup</a>;
<a name="l1740"><span class="linenum">1740</span></a>      }
<a name="l1741"><span class="linenum">1741</span></a>  
<a name="l1742"><span class="linenum">1742</span></a>  }
<a name="l1743"><span class="linenum">1743</span></a>  
<a name="l1744"><span class="linenum">1744</span></a>  <span class="comment">/**</span>
<a name="l1745"><span class="linenum">1745</span></a>  <span class="comment"> * Execution step that will generate the final zip (.mbz) file with all the contents</span>
<a name="l1746"><span class="linenum">1746</span></a>  <span class="comment"> */</span>
<a name="l1747"><span class="linenum">1747</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_zip_contents')" href="../../_classes/backup_zip_contents.html" onMouseOver="classPopup(event,'backup_zip_contents')">backup_zip_contents</a> extends backup_execution_step <span class="keyword">implements</span> <a class="class" onClick="logClass('file_progress')" href="../../_classes/file_progress.html" onMouseOver="classPopup(event,'file_progress')">file_progress</a> {
<a name="l1748"><span class="linenum">1748</span></a>      <span class="comment">/**</span>
<a name="l1749"><span class="linenum">1749</span></a>  <span class="comment">     * @var bool True if we have started tracking progress</span>
<a name="l1750"><span class="linenum">1750</span></a>  <span class="comment">     */</span>
<a name="l1751"><span class="linenum">1751</span></a>      protected <a class="var it6084" onMouseOver="hilite(6084)" onMouseOut="lolite()" onClick="logVariable('startedprogress')" href="../../_variables/startedprogress.html">$startedprogress</a>;
<a name="l1752"><span class="linenum">1752</span></a>  
<a name="l1753"><span class="linenum">1753</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l1754"><span class="linenum">1754</span></a>  
<a name="l1755"><span class="linenum">1755</span></a>  <span class="comment">        // Get basepath</span>
<a name="l1756"><span class="linenum">1756</span></a>          <a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_basepath')" href="../../_functions/get_basepath.html" onMouseOver="funcPopup(event,'get_basepath')">get_basepath</a>();
<a name="l1757"><span class="linenum">1757</span></a>  
<a name="l1758"><span class="linenum">1758</span></a>  <span class="comment">        // Get the list of files in directory</span>
<a name="l1759"><span class="linenum">1759</span></a>          <a class="var it6085" onMouseOver="hilite(6085)" onMouseOut="lolite()" onClick="logVariable('filestemp')" href="../../_variables/filestemp.html">$filestemp</a> = <a class="function" onClick="logFunction('get_directory_list')" href="../../_functions/get_directory_list.html" onMouseOver="funcPopup(event,'get_directory_list')">get_directory_list</a>(<a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a>, '', false, true, true);
<a name="l1760"><span class="linenum">1760</span></a>          <a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = array();
<a name="l1761"><span class="linenum">1761</span></a>          foreach (<a class="var it6085" onMouseOver="hilite(6085)" onMouseOut="lolite()" onClick="logVariable('filestemp')" href="../../_variables/filestemp.html">$filestemp</a> as <a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>) { // Add zip paths and fs paths to all them
<a name="l1762"><span class="linenum">1762</span></a>              <a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>[<a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>] = <a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a> . '/' . <a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>;
<a name="l1763"><span class="linenum">1763</span></a>          }
<a name="l1764"><span class="linenum">1764</span></a>  
<a name="l1765"><span class="linenum">1765</span></a>  <span class="comment">        // Add the log file if exists</span>
<a name="l1766"><span class="linenum">1766</span></a>          <a class="var it6086" onMouseOver="hilite(6086)" onMouseOut="lolite()" onClick="logVariable('logfilepath')" href="../../_variables/logfilepath.html">$logfilepath</a> = <a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a> . '.log';
<a name="l1767"><span class="linenum">1767</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it6086" onMouseOver="hilite(6086)" onMouseOut="lolite()" onClick="logVariable('logfilepath')" href="../../_variables/logfilepath.html">$logfilepath</a>)) {
<a name="l1768"><span class="linenum">1768</span></a>               <a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>['moodle_backup.log'] = <a class="var it6086" onMouseOver="hilite(6086)" onMouseOut="lolite()" onClick="logVariable('logfilepath')" href="../../_variables/logfilepath.html">$logfilepath</a>;
<a name="l1769"><span class="linenum">1769</span></a>          }
<a name="l1770"><span class="linenum">1770</span></a>  
<a name="l1771"><span class="linenum">1771</span></a>  <span class="comment">        // Calculate the zip fullpath (in OS temp area it's always backup.mbz)</span>
<a name="l1772"><span class="linenum">1772</span></a>          <a class="var it6087" onMouseOver="hilite(6087)" onMouseOut="lolite()" onClick="logVariable('zipfile')" href="../../_variables/zipfile.html">$zipfile</a> = <a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a> . '/backup.mbz';
<a name="l1773"><span class="linenum">1773</span></a>  
<a name="l1774"><span class="linenum">1774</span></a>  <span class="comment">        // Get the zip packer</span>
<a name="l1775"><span class="linenum">1775</span></a>          <a class="var it6088" onMouseOver="hilite(6088)" onMouseOut="lolite()" onClick="logVariable('zippacker')" href="../../_variables/zippacker.html">$zippacker</a> = <a class="function" onClick="logFunction('get_file_packer')" href="../../_functions/get_file_packer.html" onMouseOver="funcPopup(event,'get_file_packer')">get_file_packer</a>('application/vnd.moodle.backup');
<a name="l1776"><span class="linenum">1776</span></a>  
<a name="l1777"><span class="linenum">1777</span></a>  <span class="comment">        // Track overall progress for the 2 long-running steps (archive to</span>
<a name="l1778"><span class="linenum">1778</span></a>  <span class="comment">        // pathname, get backup information).</span>
<a name="l1779"><span class="linenum">1779</span></a>          <a class="var it6089" onMouseOver="hilite(6089)" onMouseOut="lolite()" onClick="logVariable('reporter')" href="../../_variables/reporter.html">$reporter</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>();
<a name="l1780"><span class="linenum">1780</span></a>          <a class="var it6089" onMouseOver="hilite(6089)" onMouseOut="lolite()" onClick="logVariable('reporter')" href="../../_variables/reporter.html">$reporter</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>('backup_zip_contents', 2);
<a name="l1781"><span class="linenum">1781</span></a>  
<a name="l1782"><span class="linenum">1782</span></a>  <span class="comment">        // Zip files</span>
<a name="l1783"><span class="linenum">1783</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it6088" onMouseOver="hilite(6088)" onMouseOut="lolite()" onClick="logVariable('zippacker')" href="../../_variables/zippacker.html">$zippacker</a>-&gt;<a class="function" onClick="logFunction('archive_to_pathname')" href="../../_functions/archive_to_pathname.html" onMouseOver="funcPopup(event,'archive_to_pathname')">archive_to_pathname</a>(<a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>, <a class="var it6087" onMouseOver="hilite(6087)" onMouseOut="lolite()" onClick="logVariable('zipfile')" href="../../_variables/zipfile.html">$zipfile</a>, true, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>);
<a name="l1784"><span class="linenum">1784</span></a>  
<a name="l1785"><span class="linenum">1785</span></a>  <span class="comment">        // If any sub-progress happened, end it.</span>
<a name="l1786"><span class="linenum">1786</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('startedprogress')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/startedprogress.html">startedprogress</a>) {
<a name="l1787"><span class="linenum">1787</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>()-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l1788"><span class="linenum">1788</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('startedprogress')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/startedprogress.html">startedprogress</a> = false;
<a name="l1789"><span class="linenum">1789</span></a>          } else {
<a name="l1790"><span class="linenum">1790</span></a>  <span class="comment">            // No progress was reported, manually move it on to the next overall task.</span>
<a name="l1791"><span class="linenum">1791</span></a>              <a class="var it6089" onMouseOver="hilite(6089)" onMouseOut="lolite()" onClick="logVariable('reporter')" href="../../_variables/reporter.html">$reporter</a>-&gt;<a class="function" onClick="logFunction('progress')" href="../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>(1);
<a name="l1792"><span class="linenum">1792</span></a>          }
<a name="l1793"><span class="linenum">1793</span></a>  
<a name="l1794"><span class="linenum">1794</span></a>  <span class="comment">        // Something went wrong.</span>
<a name="l1795"><span class="linenum">1795</span></a>          if (<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> === false) {
<a name="l1796"><span class="linenum">1796</span></a>              @<a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it6087" onMouseOver="hilite(6087)" onMouseOut="lolite()" onClick="logVariable('zipfile')" href="../../_variables/zipfile.html">$zipfile</a>);
<a name="l1797"><span class="linenum">1797</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_step_exception')" href="../../_classes/backup_step_exception.html" onMouseOver="classPopup(event,'backup_step_exception')">backup_step_exception</a>('error_zip_packing', '', 'An error was encountered while trying to generate backup zip');
<a name="l1798"><span class="linenum">1798</span></a>          }
<a name="l1799"><span class="linenum">1799</span></a>  <span class="comment">        // Read to make sure it is a valid backup. Refer MDL-37877 . Delete it, if found not to be valid.</span>
<a name="l1800"><span class="linenum">1800</span></a>          try {
<a name="l1801"><span class="linenum">1801</span></a>              backup_general_helper::<a class="function" onClick="logFunction('get_backup_information_from_mbz')" href="../../_functions/get_backup_information_from_mbz.html" onMouseOver="funcPopup(event,'get_backup_information_from_mbz')">get_backup_information_from_mbz</a>(<a class="var it6087" onMouseOver="hilite(6087)" onMouseOut="lolite()" onClick="logVariable('zipfile')" href="../../_variables/zipfile.html">$zipfile</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>);
<a name="l1802"><span class="linenum">1802</span></a>          } catch (backup_helper_exception <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l1803"><span class="linenum">1803</span></a>              @<a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it6087" onMouseOver="hilite(6087)" onMouseOut="lolite()" onClick="logVariable('zipfile')" href="../../_variables/zipfile.html">$zipfile</a>);
<a name="l1804"><span class="linenum">1804</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('backup_step_exception')" href="../../_classes/backup_step_exception.html" onMouseOver="classPopup(event,'backup_step_exception')">backup_step_exception</a>('error_zip_packing', '', <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('debuginfo')" class="var it39497" onMouseOver="hilite(39497)" onMouseOut="lolite()" href="../../_variables/debuginfo.html">debuginfo</a>);
<a name="l1805"><span class="linenum">1805</span></a>          }
<a name="l1806"><span class="linenum">1806</span></a>  
<a name="l1807"><span class="linenum">1807</span></a>  <span class="comment">        // If any sub-progress happened, end it.</span>
<a name="l1808"><span class="linenum">1808</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('startedprogress')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/startedprogress.html">startedprogress</a>) {
<a name="l1809"><span class="linenum">1809</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>()-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l1810"><span class="linenum">1810</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('startedprogress')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/startedprogress.html">startedprogress</a> = false;
<a name="l1811"><span class="linenum">1811</span></a>          } else {
<a name="l1812"><span class="linenum">1812</span></a>              <a class="var it6089" onMouseOver="hilite(6089)" onMouseOut="lolite()" onClick="logVariable('reporter')" href="../../_variables/reporter.html">$reporter</a>-&gt;<a class="function" onClick="logFunction('progress')" href="../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>(2);
<a name="l1813"><span class="linenum">1813</span></a>          }
<a name="l1814"><span class="linenum">1814</span></a>          <a class="var it6089" onMouseOver="hilite(6089)" onMouseOut="lolite()" onClick="logVariable('reporter')" href="../../_variables/reporter.html">$reporter</a>-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l1815"><span class="linenum">1815</span></a>      }
<a name="l1816"><span class="linenum">1816</span></a>  
<a name="l1817"><span class="linenum">1817</span></a>      <span class="comment">/**</span>
<a name="l1818"><span class="linenum">1818</span></a>  <span class="comment">     * Implementation for file_progress interface to display unzip progress.</span>
<a name="l1819"><span class="linenum">1819</span></a>  <span class="comment">     *</span>
<a name="l1820"><span class="linenum">1820</span></a>  <span class="comment">     * @param int $progress Current progress</span>
<a name="l1821"><span class="linenum">1821</span></a>  <span class="comment">     * @param int $max Max value</span>
<a name="l1822"><span class="linenum">1822</span></a>  <span class="comment">     */</span>
<a name="l1823"><span class="linenum">1823</span></a>      public function <a class="function" onClick="logFunction('progress')" href="../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>(<a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a> = <a class="class" onClick="logClass('file_progress')" href="../../_classes/file_progress.html" onMouseOver="classPopup(event,'file_progress')">file_progress</a>::INDETERMINATE, <a class="var it588" onMouseOver="hilite(588)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../_variables/max.html">$max</a> = <a class="class" onClick="logClass('file_progress')" href="../../_classes/file_progress.html" onMouseOver="classPopup(event,'file_progress')">file_progress</a>::INDETERMINATE) {
<a name="l1824"><span class="linenum">1824</span></a>          <a class="var it6089" onMouseOver="hilite(6089)" onMouseOut="lolite()" onClick="logVariable('reporter')" href="../../_variables/reporter.html">$reporter</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>();
<a name="l1825"><span class="linenum">1825</span></a>  
<a name="l1826"><span class="linenum">1826</span></a>  <span class="comment">        // Start tracking progress if necessary.</span>
<a name="l1827"><span class="linenum">1827</span></a>          if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('startedprogress')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/startedprogress.html">startedprogress</a>) {
<a name="l1828"><span class="linenum">1828</span></a>              <a class="var it6089" onMouseOver="hilite(6089)" onMouseOut="lolite()" onClick="logVariable('reporter')" href="../../_variables/reporter.html">$reporter</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>('extract_file_to_dir', (<a class="var it588" onMouseOver="hilite(588)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../_variables/max.html">$max</a> == <a class="class" onClick="logClass('file_progress')" href="../../_classes/file_progress.html" onMouseOver="classPopup(event,'file_progress')">file_progress</a>::INDETERMINATE)
<a name="l1829"><span class="linenum">1829</span></a>                      ? \core\progress\base::INDETERMINATE : <a class="var it588" onMouseOver="hilite(588)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../_variables/max.html">$max</a>);
<a name="l1830"><span class="linenum">1830</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('startedprogress')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/startedprogress.html">startedprogress</a> = true;
<a name="l1831"><span class="linenum">1831</span></a>          }
<a name="l1832"><span class="linenum">1832</span></a>  
<a name="l1833"><span class="linenum">1833</span></a>  <span class="comment">        // Pass progress through to whatever handles it.</span>
<a name="l1834"><span class="linenum">1834</span></a>          <a class="var it6089" onMouseOver="hilite(6089)" onMouseOut="lolite()" onClick="logVariable('reporter')" href="../../_variables/reporter.html">$reporter</a>-&gt;<a class="function" onClick="logFunction('progress')" href="../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>((<a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a> == <a class="class" onClick="logClass('file_progress')" href="../../_classes/file_progress.html" onMouseOver="classPopup(event,'file_progress')">file_progress</a>::INDETERMINATE)
<a name="l1835"><span class="linenum">1835</span></a>                  ? \core\progress\base::INDETERMINATE : <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>);
<a name="l1836"><span class="linenum">1836</span></a>       }
<a name="l1837"><span class="linenum">1837</span></a>  }
<a name="l1838"><span class="linenum">1838</span></a>  
<a name="l1839"><span class="linenum">1839</span></a>  <span class="comment">/**</span>
<a name="l1840"><span class="linenum">1840</span></a>  <span class="comment"> * This step will send the generated backup file to its final destination</span>
<a name="l1841"><span class="linenum">1841</span></a>  <span class="comment"> */</span>
<a name="l1842"><span class="linenum">1842</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_store_backup_file')" href="../../_classes/backup_store_backup_file.html" onMouseOver="classPopup(event,'backup_store_backup_file')">backup_store_backup_file</a> extends backup_execution_step {
<a name="l1843"><span class="linenum">1843</span></a>  
<a name="l1844"><span class="linenum">1844</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l1845"><span class="linenum">1845</span></a>  
<a name="l1846"><span class="linenum">1846</span></a>  <span class="comment">        // Get basepath</span>
<a name="l1847"><span class="linenum">1847</span></a>          <a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_basepath')" href="../../_functions/get_basepath.html" onMouseOver="funcPopup(event,'get_basepath')">get_basepath</a>();
<a name="l1848"><span class="linenum">1848</span></a>  
<a name="l1849"><span class="linenum">1849</span></a>  <span class="comment">        // Calculate the zip fullpath (in OS temp area it's always backup.mbz)</span>
<a name="l1850"><span class="linenum">1850</span></a>          <a class="var it6087" onMouseOver="hilite(6087)" onMouseOut="lolite()" onClick="logVariable('zipfile')" href="../../_variables/zipfile.html">$zipfile</a> = <a class="var it1232" onMouseOver="hilite(1232)" onMouseOut="lolite()" onClick="logVariable('basepath')" href="../../_variables/basepath.html">$basepath</a> . '/backup.mbz';
<a name="l1851"><span class="linenum">1851</span></a>  
<a name="l1852"><span class="linenum">1852</span></a>          <a class="var it6090" onMouseOver="hilite(6090)" onMouseOut="lolite()" onClick="logVariable('has_file_references')" href="../../_variables/has_file_references.html">$has_file_references</a> = backup_controller_dbops::<a class="function" onClick="logFunction('backup_includes_file_references')" href="../../_functions/backup_includes_file_references.html" onMouseOver="funcPopup(event,'backup_includes_file_references')">backup_includes_file_references</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>());
<a name="l1853"><span class="linenum">1853</span></a>  <span class="comment">        // Perform storage and return it (TODO: shouldn't be array but proper result object)</span>
<a name="l1854"><span class="linenum">1854</span></a>          return array(
<a name="l1855"><span class="linenum">1855</span></a>              'backup_destination' =&gt; backup_helper::<a class="function" onClick="logFunction('store_backup_file')" href="../../_functions/store_backup_file.html" onMouseOver="funcPopup(event,'store_backup_file')">store_backup_file</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it6087" onMouseOver="hilite(6087)" onMouseOut="lolite()" onClick="logVariable('zipfile')" href="../../_variables/zipfile.html">$zipfile</a>,
<a name="l1856"><span class="linenum">1856</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>()),
<a name="l1857"><span class="linenum">1857</span></a>              'include_file_references_to_external_content' =&gt; <a class="var it6090" onMouseOver="hilite(6090)" onMouseOut="lolite()" onClick="logVariable('has_file_references')" href="../../_variables/has_file_references.html">$has_file_references</a>
<a name="l1858"><span class="linenum">1858</span></a>          );
<a name="l1859"><span class="linenum">1859</span></a>      }
<a name="l1860"><span class="linenum">1860</span></a>  }
<a name="l1861"><span class="linenum">1861</span></a>  
<a name="l1862"><span class="linenum">1862</span></a>  
<a name="l1863"><span class="linenum">1863</span></a>  <span class="comment">/**</span>
<a name="l1864"><span class="linenum">1864</span></a>  <span class="comment"> * This step will search for all the activity (not calculations, categories nor aggregations) grade items</span>
<a name="l1865"><span class="linenum">1865</span></a>  <span class="comment"> * and put them to the backup_ids tables, to be used later as base to backup them</span>
<a name="l1866"><span class="linenum">1866</span></a>  <span class="comment"> */</span>
<a name="l1867"><span class="linenum">1867</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_activity_grade_items_to_ids')" href="../../_classes/backup_activity_grade_items_to_ids.html" onMouseOver="classPopup(event,'backup_activity_grade_items_to_ids')">backup_activity_grade_items_to_ids</a> extends backup_execution_step {
<a name="l1868"><span class="linenum">1868</span></a>  
<a name="l1869"><span class="linenum">1869</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l1870"><span class="linenum">1870</span></a>  
<a name="l1871"><span class="linenum">1871</span></a>  <span class="comment">        // Fetch all activity grade items</span>
<a name="l1872"><span class="linenum">1872</span></a>          if (<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a> = <a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('fetch_all')" href="../../_functions/fetch_all.html" onMouseOver="funcPopup(event,'fetch_all')">fetch_all</a>(array(
<a name="l1873"><span class="linenum">1873</span></a>                           'itemtype' =&gt; 'mod', 'itemmodule' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_modulename')" href="../../_functions/get_modulename.html" onMouseOver="funcPopup(event,'get_modulename')">get_modulename</a>(),
<a name="l1874"><span class="linenum">1874</span></a>                           'iteminstance' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_activityid')" href="../../_functions/get_activityid.html" onMouseOver="funcPopup(event,'get_activityid')">get_activityid</a>(), 'courseid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>()))) {
<a name="l1875"><span class="linenum">1875</span></a>  <span class="comment">            // Annotate them in backup_ids</span>
<a name="l1876"><span class="linenum">1876</span></a>              foreach (<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a> as <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>) {
<a name="l1877"><span class="linenum">1877</span></a>                  backup_structure_dbops::<a class="function" onClick="logFunction('insert_backup_ids_record')" href="../../_functions/insert_backup_ids_record.html" onMouseOver="funcPopup(event,'insert_backup_ids_record')">insert_backup_ids_record</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), 'grade_item', <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>-&gt;<a onClick="logVariable('id')" class="var it39599" onMouseOver="hilite(39599)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1878"><span class="linenum">1878</span></a>              }
<a name="l1879"><span class="linenum">1879</span></a>          }
<a name="l1880"><span class="linenum">1880</span></a>      }
<a name="l1881"><span class="linenum">1881</span></a>  }
<a name="l1882"><span class="linenum">1882</span></a>  
<a name="l1883"><span class="linenum">1883</span></a>  
<a name="l1884"><span class="linenum">1884</span></a>  <span class="comment">/**</span>
<a name="l1885"><span class="linenum">1885</span></a>  <span class="comment"> * This step allows enrol plugins to annotate custom fields.</span>
<a name="l1886"><span class="linenum">1886</span></a>  <span class="comment"> *</span>
<a name="l1887"><span class="linenum">1887</span></a>  <span class="comment"> * @package   core_backup</span>
<a name="l1888"><span class="linenum">1888</span></a>  <span class="comment"> * @copyright 2014 University of Wisconsin</span>
<a name="l1889"><span class="linenum">1889</span></a>  <span class="comment"> * @author    Matt Petro</span>
<a name="l1890"><span class="linenum">1890</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l1891"><span class="linenum">1891</span></a>  <span class="comment"> */</span>
<a name="l1892"><span class="linenum">1892</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_enrolments_execution_step')" href="../../_classes/backup_enrolments_execution_step.html" onMouseOver="classPopup(event,'backup_enrolments_execution_step')">backup_enrolments_execution_step</a> extends backup_execution_step {
<a name="l1893"><span class="linenum">1893</span></a>  
<a name="l1894"><span class="linenum">1894</span></a>      <span class="comment">/**</span>
<a name="l1895"><span class="linenum">1895</span></a>  <span class="comment">     * Function that will contain all the code to be executed.</span>
<a name="l1896"><span class="linenum">1896</span></a>  <span class="comment">     */</span>
<a name="l1897"><span class="linenum">1897</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l1898"><span class="linenum">1898</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1899"><span class="linenum">1899</span></a>  
<a name="l1900"><span class="linenum">1900</span></a>          <a class="var it1127" onMouseOver="hilite(1127)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../../_variables/plugins.html">$plugins</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l1901"><span class="linenum">1901</span></a>          <a class="var it3147" onMouseOver="hilite(3147)" onMouseOut="lolite()" onClick="logVariable('enrols')" href="../../_variables/enrols.html">$enrols</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('enrol', array(
<a name="l1902"><span class="linenum">1902</span></a>                  'courseid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>()));
<a name="l1903"><span class="linenum">1903</span></a>  
<a name="l1904"><span class="linenum">1904</span></a>  <span class="comment">        // Allow each enrol plugin to add annotations.</span>
<a name="l1905"><span class="linenum">1905</span></a>          foreach (<a class="var it3147" onMouseOver="hilite(3147)" onMouseOut="lolite()" onClick="logVariable('enrols')" href="../../_variables/enrols.html">$enrols</a> as <a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a>) {
<a name="l1906"><span class="linenum">1906</span></a>              if (isset(<a class="var it1127" onMouseOver="hilite(1127)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../../_variables/plugins.html">$plugins</a>[<a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a>-&gt;<a onClick="logVariable('enrol')" class="var it40327" onMouseOver="hilite(40327)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>])) {
<a name="l1907"><span class="linenum">1907</span></a>                  <a class="var it1127" onMouseOver="hilite(1127)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../../_variables/plugins.html">$plugins</a>[<a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a>-&gt;<a onClick="logVariable('enrol')" class="var it40327" onMouseOver="hilite(40327)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>]-&gt;<a class="function" onClick="logFunction('backup_annotate_custom_fields')" href="../../_functions/backup_annotate_custom_fields.html" onMouseOver="funcPopup(event,'backup_annotate_custom_fields')">backup_annotate_custom_fields</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>, <a class="var it529" onMouseOver="hilite(529)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../../_variables/enrol.html">$enrol</a>);
<a name="l1908"><span class="linenum">1908</span></a>              }
<a name="l1909"><span class="linenum">1909</span></a>          }
<a name="l1910"><span class="linenum">1910</span></a>      }
<a name="l1911"><span class="linenum">1911</span></a>  
<a name="l1912"><span class="linenum">1912</span></a>      <span class="comment">/**</span>
<a name="l1913"><span class="linenum">1913</span></a>  <span class="comment">     * Annotate a single name/id pair.</span>
<a name="l1914"><span class="linenum">1914</span></a>  <span class="comment">     * This can be called from {@link enrol_plugin::backup_annotate_custom_fields()}.</span>
<a name="l1915"><span class="linenum">1915</span></a>  <span class="comment">     *</span>
<a name="l1916"><span class="linenum">1916</span></a>  <span class="comment">     * @param string $itemname</span>
<a name="l1917"><span class="linenum">1917</span></a>  <span class="comment">     * @param int $itemid</span>
<a name="l1918"><span class="linenum">1918</span></a>  <span class="comment">     */</span>
<a name="l1919"><span class="linenum">1919</span></a>      public function <a class="function" onClick="logFunction('annotate_id')" href="../../_functions/annotate_id.html" onMouseOver="funcPopup(event,'annotate_id')">annotate_id</a>(<a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>) {
<a name="l1920"><span class="linenum">1920</span></a>          backup_structure_dbops::<a class="function" onClick="logFunction('insert_backup_ids_record')" href="../../_functions/insert_backup_ids_record.html" onMouseOver="funcPopup(event,'insert_backup_ids_record')">insert_backup_ids_record</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>);
<a name="l1921"><span class="linenum">1921</span></a>      }
<a name="l1922"><span class="linenum">1922</span></a>  }
<a name="l1923"><span class="linenum">1923</span></a>  
<a name="l1924"><span class="linenum">1924</span></a>  <span class="comment">/**</span>
<a name="l1925"><span class="linenum">1925</span></a>  <span class="comment"> * This step will annotate all the groups and groupings belonging to the course</span>
<a name="l1926"><span class="linenum">1926</span></a>  <span class="comment"> */</span>
<a name="l1927"><span class="linenum">1927</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_annotate_course_groups_and_groupings')" href="../../_classes/backup_annotate_course_groups_and_groupings.html" onMouseOver="classPopup(event,'backup_annotate_course_groups_and_groupings')">backup_annotate_course_groups_and_groupings</a> extends backup_execution_step {
<a name="l1928"><span class="linenum">1928</span></a>  
<a name="l1929"><span class="linenum">1929</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l1930"><span class="linenum">1930</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1931"><span class="linenum">1931</span></a>  
<a name="l1932"><span class="linenum">1932</span></a>  <span class="comment">        // Get all the course groups</span>
<a name="l1933"><span class="linenum">1933</span></a>          if (<a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('groups', array(
<a name="l1934"><span class="linenum">1934</span></a>                  'courseid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>()))) {
<a name="l1935"><span class="linenum">1935</span></a>              foreach (<a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a> as <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>) {
<a name="l1936"><span class="linenum">1936</span></a>                  backup_structure_dbops::<a class="function" onClick="logFunction('insert_backup_ids_record')" href="../../_functions/insert_backup_ids_record.html" onMouseOver="funcPopup(event,'insert_backup_ids_record')">insert_backup_ids_record</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), 'group', <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('id')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1937"><span class="linenum">1937</span></a>              }
<a name="l1938"><span class="linenum">1938</span></a>          }
<a name="l1939"><span class="linenum">1939</span></a>  
<a name="l1940"><span class="linenum">1940</span></a>  <span class="comment">        // Get all the course groupings</span>
<a name="l1941"><span class="linenum">1941</span></a>          if (<a class="var it2827" onMouseOver="hilite(2827)" onMouseOut="lolite()" onClick="logVariable('groupings')" href="../../_variables/groupings.html">$groupings</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('groupings', array(
<a name="l1942"><span class="linenum">1942</span></a>                  'courseid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>()))) {
<a name="l1943"><span class="linenum">1943</span></a>              foreach (<a class="var it2827" onMouseOver="hilite(2827)" onMouseOut="lolite()" onClick="logVariable('groupings')" href="../../_variables/groupings.html">$groupings</a> as <a class="var it2828" onMouseOver="hilite(2828)" onMouseOut="lolite()" onClick="logVariable('grouping')" href="../../_variables/grouping.html">$grouping</a>) {
<a name="l1944"><span class="linenum">1944</span></a>                  backup_structure_dbops::<a class="function" onClick="logFunction('insert_backup_ids_record')" href="../../_functions/insert_backup_ids_record.html" onMouseOver="funcPopup(event,'insert_backup_ids_record')">insert_backup_ids_record</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), 'grouping', <a class="var it2828" onMouseOver="hilite(2828)" onMouseOut="lolite()" onClick="logVariable('grouping')" href="../../_variables/grouping.html">$grouping</a>-&gt;<a onClick="logVariable('id')" class="var it40032" onMouseOver="hilite(40032)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1945"><span class="linenum">1945</span></a>              }
<a name="l1946"><span class="linenum">1946</span></a>          }
<a name="l1947"><span class="linenum">1947</span></a>      }
<a name="l1948"><span class="linenum">1948</span></a>  }
<a name="l1949"><span class="linenum">1949</span></a>  
<a name="l1950"><span class="linenum">1950</span></a>  <span class="comment">/**</span>
<a name="l1951"><span class="linenum">1951</span></a>  <span class="comment"> * This step will annotate all the groups belonging to already annotated groupings</span>
<a name="l1952"><span class="linenum">1952</span></a>  <span class="comment"> */</span>
<a name="l1953"><span class="linenum">1953</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_annotate_groups_from_groupings')" href="../../_classes/backup_annotate_groups_from_groupings.html" onMouseOver="classPopup(event,'backup_annotate_groups_from_groupings')">backup_annotate_groups_from_groupings</a> extends backup_execution_step {
<a name="l1954"><span class="linenum">1954</span></a>  
<a name="l1955"><span class="linenum">1955</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l1956"><span class="linenum">1956</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1957"><span class="linenum">1957</span></a>  
<a name="l1958"><span class="linenum">1958</span></a>  <span class="comment">        // Fetch all the annotated groupings</span>
<a name="l1959"><span class="linenum">1959</span></a>          if (<a class="var it2827" onMouseOver="hilite(2827)" onMouseOut="lolite()" onClick="logVariable('groupings')" href="../../_variables/groupings.html">$groupings</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('backup_ids_temp', array(
<a name="l1960"><span class="linenum">1960</span></a>                  'backupid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), 'itemname' =&gt; 'grouping'))) {
<a name="l1961"><span class="linenum">1961</span></a>              foreach (<a class="var it2827" onMouseOver="hilite(2827)" onMouseOut="lolite()" onClick="logVariable('groupings')" href="../../_variables/groupings.html">$groupings</a> as <a class="var it2828" onMouseOver="hilite(2828)" onMouseOut="lolite()" onClick="logVariable('grouping')" href="../../_variables/grouping.html">$grouping</a>) {
<a name="l1962"><span class="linenum">1962</span></a>                  if (<a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('groupings_groups', array(
<a name="l1963"><span class="linenum">1963</span></a>                          'groupingid' =&gt; <a class="var it2828" onMouseOver="hilite(2828)" onMouseOut="lolite()" onClick="logVariable('grouping')" href="../../_variables/grouping.html">$grouping</a>-&gt;<a onClick="logVariable('itemid')" class="var it40032" onMouseOver="hilite(40032)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>))) {
<a name="l1964"><span class="linenum">1964</span></a>                      foreach (<a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a> as <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>) {
<a name="l1965"><span class="linenum">1965</span></a>                          backup_structure_dbops::<a class="function" onClick="logFunction('insert_backup_ids_record')" href="../../_functions/insert_backup_ids_record.html" onMouseOver="funcPopup(event,'insert_backup_ids_record')">insert_backup_ids_record</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), 'group', <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('groupid')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>);
<a name="l1966"><span class="linenum">1966</span></a>                      }
<a name="l1967"><span class="linenum">1967</span></a>                  }
<a name="l1968"><span class="linenum">1968</span></a>              }
<a name="l1969"><span class="linenum">1969</span></a>          }
<a name="l1970"><span class="linenum">1970</span></a>      }
<a name="l1971"><span class="linenum">1971</span></a>  }
<a name="l1972"><span class="linenum">1972</span></a>  
<a name="l1973"><span class="linenum">1973</span></a>  <span class="comment">/**</span>
<a name="l1974"><span class="linenum">1974</span></a>  <span class="comment"> * This step will annotate all the scales belonging to already annotated outcomes</span>
<a name="l1975"><span class="linenum">1975</span></a>  <span class="comment"> */</span>
<a name="l1976"><span class="linenum">1976</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_annotate_scales_from_outcomes')" href="../../_classes/backup_annotate_scales_from_outcomes.html" onMouseOver="classPopup(event,'backup_annotate_scales_from_outcomes')">backup_annotate_scales_from_outcomes</a> extends backup_execution_step {
<a name="l1977"><span class="linenum">1977</span></a>  
<a name="l1978"><span class="linenum">1978</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l1979"><span class="linenum">1979</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1980"><span class="linenum">1980</span></a>  
<a name="l1981"><span class="linenum">1981</span></a>  <span class="comment">        // Fetch all the annotated outcomes</span>
<a name="l1982"><span class="linenum">1982</span></a>          if (<a class="var it3695" onMouseOver="hilite(3695)" onMouseOut="lolite()" onClick="logVariable('outcomes')" href="../../_variables/outcomes.html">$outcomes</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('backup_ids_temp', array(
<a name="l1983"><span class="linenum">1983</span></a>                  'backupid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), 'itemname' =&gt; 'outcome'))) {
<a name="l1984"><span class="linenum">1984</span></a>              foreach (<a class="var it3695" onMouseOver="hilite(3695)" onMouseOut="lolite()" onClick="logVariable('outcomes')" href="../../_variables/outcomes.html">$outcomes</a> as <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a>) {
<a name="l1985"><span class="linenum">1985</span></a>                  if (<a class="var it1939" onMouseOver="hilite(1939)" onMouseOut="lolite()" onClick="logVariable('scale')" href="../../_variables/scale.html">$scale</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('grade_outcomes', array(
<a name="l1986"><span class="linenum">1986</span></a>                          'id' =&gt; <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a>-&gt;<a onClick="logVariable('itemid')" class="var it39893" onMouseOver="hilite(39893)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>))) {
<a name="l1987"><span class="linenum">1987</span></a>  <span class="comment">                    // Annotate as scalefinal because it's &gt; 0</span>
<a name="l1988"><span class="linenum">1988</span></a>                      backup_structure_dbops::<a class="function" onClick="logFunction('insert_backup_ids_record')" href="../../_functions/insert_backup_ids_record.html" onMouseOver="funcPopup(event,'insert_backup_ids_record')">insert_backup_ids_record</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), 'scalefinal', <a class="var it1939" onMouseOver="hilite(1939)" onMouseOut="lolite()" onClick="logVariable('scale')" href="../../_variables/scale.html">$scale</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39533" onMouseOver="hilite(39533)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a>);
<a name="l1989"><span class="linenum">1989</span></a>                  }
<a name="l1990"><span class="linenum">1990</span></a>              }
<a name="l1991"><span class="linenum">1991</span></a>          }
<a name="l1992"><span class="linenum">1992</span></a>      }
<a name="l1993"><span class="linenum">1993</span></a>  }
<a name="l1994"><span class="linenum">1994</span></a>  
<a name="l1995"><span class="linenum">1995</span></a>  <span class="comment">/**</span>
<a name="l1996"><span class="linenum">1996</span></a>  <span class="comment"> * This step will generate all the file annotations for the already</span>
<a name="l1997"><span class="linenum">1997</span></a>  <span class="comment"> * annotated (final) question_categories. It calculates the different</span>
<a name="l1998"><span class="linenum">1998</span></a>  <span class="comment"> * contexts that are being backup and, annotates all the files</span>
<a name="l1999"><span class="linenum">1999</span></a>  <span class="comment"> * on every context belonging to the &quot;question&quot; component. As far as</span>
<a name="l2000"><span class="linenum">2000</span></a>  <span class="comment"> * we are always including *complete* question banks it is safe and</span>
<a name="l2001"><span class="linenum">2001</span></a>  <span class="comment"> * optimal to do that in this (one pass) way</span>
<a name="l2002"><span class="linenum">2002</span></a>  <span class="comment"> */</span>
<a name="l2003"><span class="linenum">2003</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_annotate_all_question_files')" href="../../_classes/backup_annotate_all_question_files.html" onMouseOver="classPopup(event,'backup_annotate_all_question_files')">backup_annotate_all_question_files</a> extends backup_execution_step {
<a name="l2004"><span class="linenum">2004</span></a>  
<a name="l2005"><span class="linenum">2005</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l2006"><span class="linenum">2006</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2007"><span class="linenum">2007</span></a>  
<a name="l2008"><span class="linenum">2008</span></a>  <span class="comment">        // Get all the different contexts for the final question_categories</span>
<a name="l2009"><span class="linenum">2009</span></a>  <span class="comment">        // annotated along the whole backup</span>
<a name="l2010"><span class="linenum">2010</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(&quot;SELECT DISTINCT qc.contextid
<a name="l2011"><span class="linenum">2011</span></a>                                          FROM {question_categories} qc
<a name="l2012"><span class="linenum">2012</span></a>                                          JOIN {backup_ids_temp} bi ON bi.itemid = qc.id
<a name="l2013"><span class="linenum">2013</span></a>                                         WHERE bi.backupid = ?
<a name="l2014"><span class="linenum">2014</span></a>                                           AND bi.itemname = 'question_categoryfinal'&quot;, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>()));
<a name="l2015"><span class="linenum">2015</span></a>  <span class="comment">        // To know about qtype specific components/fileareas</span>
<a name="l2016"><span class="linenum">2016</span></a>          <a class="var it3408" onMouseOver="hilite(3408)" onMouseOut="lolite()" onClick="logVariable('components')" href="../../_variables/components.html">$components</a> = backup_qtype_plugin::<a class="function" onClick="logFunction('get_components_and_fileareas')" href="../../_functions/get_components_and_fileareas.html" onMouseOver="funcPopup(event,'get_components_and_fileareas')">get_components_and_fileareas</a>();
<a name="l2017"><span class="linenum">2017</span></a>  <span class="comment">        // Let's loop</span>
<a name="l2018"><span class="linenum">2018</span></a>          foreach(<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l2019"><span class="linenum">2019</span></a>  <span class="comment">            // Backup all the file areas the are managed by the core question component.</span>
<a name="l2020"><span class="linenum">2020</span></a>  <span class="comment">            // That is, by the question_type base class. In particular, we don't want</span>
<a name="l2021"><span class="linenum">2021</span></a>  <span class="comment">            // to include files belonging to responses here.</span>
<a name="l2022"><span class="linenum">2022</span></a>              backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, 'question', 'questiontext', null);
<a name="l2023"><span class="linenum">2023</span></a>              backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, 'question', 'generalfeedback', null);
<a name="l2024"><span class="linenum">2024</span></a>              backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, 'question', 'answer', null);
<a name="l2025"><span class="linenum">2025</span></a>              backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, 'question', 'answerfeedback', null);
<a name="l2026"><span class="linenum">2026</span></a>              backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, 'question', 'hint', null);
<a name="l2027"><span class="linenum">2027</span></a>              backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, 'question', 'correctfeedback', null);
<a name="l2028"><span class="linenum">2028</span></a>              backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, 'question', 'partiallycorrectfeedback', null);
<a name="l2029"><span class="linenum">2029</span></a>              backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, 'question', 'incorrectfeedback', null);
<a name="l2030"><span class="linenum">2030</span></a>  
<a name="l2031"><span class="linenum">2031</span></a>  <span class="comment">            // For files belonging to question types, we make the leap of faith that</span>
<a name="l2032"><span class="linenum">2032</span></a>  <span class="comment">            // all the files belonging to the question type are part of the question definition,</span>
<a name="l2033"><span class="linenum">2033</span></a>  <span class="comment">            // so we can just backup all the files in bulk, without specifying each</span>
<a name="l2034"><span class="linenum">2034</span></a>  <span class="comment">            // file area name separately.</span>
<a name="l2035"><span class="linenum">2035</span></a>              foreach (<a class="var it3408" onMouseOver="hilite(3408)" onMouseOut="lolite()" onClick="logVariable('components')" href="../../_variables/components.html">$components</a> as <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a> =&gt; <a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('fileareas')" href="../../_variables/fileareas.html">$fileareas</a>) {
<a name="l2036"><span class="linenum">2036</span></a>                  backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, null, null);
<a name="l2037"><span class="linenum">2037</span></a>              }
<a name="l2038"><span class="linenum">2038</span></a>          }
<a name="l2039"><span class="linenum">2039</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2040"><span class="linenum">2040</span></a>      }
<a name="l2041"><span class="linenum">2041</span></a>  }
<a name="l2042"><span class="linenum">2042</span></a>  
<a name="l2043"><span class="linenum">2043</span></a>  <span class="comment">/**</span>
<a name="l2044"><span class="linenum">2044</span></a>  <span class="comment"> * structure step in charge of constructing the questions.xml file for all the</span>
<a name="l2045"><span class="linenum">2045</span></a>  <span class="comment"> * question categories and questions required by the backup</span>
<a name="l2046"><span class="linenum">2046</span></a>  <span class="comment"> * and letters related to one activity</span>
<a name="l2047"><span class="linenum">2047</span></a>  <span class="comment"> */</span>
<a name="l2048"><span class="linenum">2048</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_questions_structure_step')" href="../../_classes/backup_questions_structure_step.html" onMouseOver="classPopup(event,'backup_questions_structure_step')">backup_questions_structure_step</a> extends backup_structure_step {
<a name="l2049"><span class="linenum">2049</span></a>  
<a name="l2050"><span class="linenum">2050</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l2051"><span class="linenum">2051</span></a>  
<a name="l2052"><span class="linenum">2052</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l2053"><span class="linenum">2053</span></a>  
<a name="l2054"><span class="linenum">2054</span></a>          <a class="var it6091" onMouseOver="hilite(6091)" onMouseOut="lolite()" onClick="logVariable('qcategories')" href="../../_variables/qcategories.html">$qcategories</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('question_categories');
<a name="l2055"><span class="linenum">2055</span></a>  
<a name="l2056"><span class="linenum">2056</span></a>          <a class="var it6092" onMouseOver="hilite(6092)" onMouseOut="lolite()" onClick="logVariable('qcategory')" href="../../_variables/qcategory.html">$qcategory</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('question_category', array('id'), array(
<a name="l2057"><span class="linenum">2057</span></a>              'name', 'contextid', 'contextlevel', 'contextinstanceid',
<a name="l2058"><span class="linenum">2058</span></a>              'info', 'infoformat', 'stamp', 'parent',
<a name="l2059"><span class="linenum">2059</span></a>              'sortorder'));
<a name="l2060"><span class="linenum">2060</span></a>  
<a name="l2061"><span class="linenum">2061</span></a>          <a class="var it2900" onMouseOver="hilite(2900)" onMouseOut="lolite()" onClick="logVariable('questions')" href="../../_variables/questions.html">$questions</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('questions');
<a name="l2062"><span class="linenum">2062</span></a>  
<a name="l2063"><span class="linenum">2063</span></a>          <a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../_variables/question.html">$question</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('question', array('id'), array(
<a name="l2064"><span class="linenum">2064</span></a>              'parent', 'name', 'questiontext', 'questiontextformat',
<a name="l2065"><span class="linenum">2065</span></a>              'generalfeedback', 'generalfeedbackformat', 'defaultmark', 'penalty',
<a name="l2066"><span class="linenum">2066</span></a>              'qtype', 'length', 'stamp', 'version',
<a name="l2067"><span class="linenum">2067</span></a>              'hidden', 'timecreated', 'timemodified', 'createdby', 'modifiedby'));
<a name="l2068"><span class="linenum">2068</span></a>  
<a name="l2069"><span class="linenum">2069</span></a>  <span class="comment">        // attach qtype plugin structure to $question element, only one allowed</span>
<a name="l2070"><span class="linenum">2070</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('qtype', <a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../_variables/question.html">$question</a>, false);
<a name="l2071"><span class="linenum">2071</span></a>  
<a name="l2072"><span class="linenum">2072</span></a>  <span class="comment">        // attach local plugin stucture to $question element, multiple allowed</span>
<a name="l2073"><span class="linenum">2073</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('local', <a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../_variables/question.html">$question</a>, true);
<a name="l2074"><span class="linenum">2074</span></a>  
<a name="l2075"><span class="linenum">2075</span></a>          <a class="var it6093" onMouseOver="hilite(6093)" onMouseOut="lolite()" onClick="logVariable('qhints')" href="../../_variables/qhints.html">$qhints</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('question_hints');
<a name="l2076"><span class="linenum">2076</span></a>  
<a name="l2077"><span class="linenum">2077</span></a>          <a class="var it6094" onMouseOver="hilite(6094)" onMouseOut="lolite()" onClick="logVariable('qhint')" href="../../_variables/qhint.html">$qhint</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('question_hint', array('id'), array(
<a name="l2078"><span class="linenum">2078</span></a>              'hint', 'hintformat', 'shownumcorrect', 'clearwrong', 'options'));
<a name="l2079"><span class="linenum">2079</span></a>  
<a name="l2080"><span class="linenum">2080</span></a>          <a class="var it2944" onMouseOver="hilite(2944)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../_variables/tags.html">$tags</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('tags');
<a name="l2081"><span class="linenum">2081</span></a>  
<a name="l2082"><span class="linenum">2082</span></a>          <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('tag', array('id'), array('name', 'rawname'));
<a name="l2083"><span class="linenum">2083</span></a>  
<a name="l2084"><span class="linenum">2084</span></a>  <span class="comment">        // Build the tree</span>
<a name="l2085"><span class="linenum">2085</span></a>  
<a name="l2086"><span class="linenum">2086</span></a>          <a class="var it6091" onMouseOver="hilite(6091)" onMouseOut="lolite()" onClick="logVariable('qcategories')" href="../../_variables/qcategories.html">$qcategories</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6092" onMouseOver="hilite(6092)" onMouseOut="lolite()" onClick="logVariable('qcategory')" href="../../_variables/qcategory.html">$qcategory</a>);
<a name="l2087"><span class="linenum">2087</span></a>          <a class="var it6092" onMouseOver="hilite(6092)" onMouseOut="lolite()" onClick="logVariable('qcategory')" href="../../_variables/qcategory.html">$qcategory</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it2900" onMouseOver="hilite(2900)" onMouseOut="lolite()" onClick="logVariable('questions')" href="../../_variables/questions.html">$questions</a>);
<a name="l2088"><span class="linenum">2088</span></a>          <a class="var it2900" onMouseOver="hilite(2900)" onMouseOut="lolite()" onClick="logVariable('questions')" href="../../_variables/questions.html">$questions</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../_variables/question.html">$question</a>);
<a name="l2089"><span class="linenum">2089</span></a>          <a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../_variables/question.html">$question</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6093" onMouseOver="hilite(6093)" onMouseOut="lolite()" onClick="logVariable('qhints')" href="../../_variables/qhints.html">$qhints</a>);
<a name="l2090"><span class="linenum">2090</span></a>          <a class="var it6093" onMouseOver="hilite(6093)" onMouseOut="lolite()" onClick="logVariable('qhints')" href="../../_variables/qhints.html">$qhints</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6094" onMouseOver="hilite(6094)" onMouseOut="lolite()" onClick="logVariable('qhint')" href="../../_variables/qhint.html">$qhint</a>);
<a name="l2091"><span class="linenum">2091</span></a>  
<a name="l2092"><span class="linenum">2092</span></a>          <a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../_variables/question.html">$question</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it2944" onMouseOver="hilite(2944)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../_variables/tags.html">$tags</a>);
<a name="l2093"><span class="linenum">2093</span></a>          <a class="var it2944" onMouseOver="hilite(2944)" onMouseOut="lolite()" onClick="logVariable('tags')" href="../../_variables/tags.html">$tags</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>);
<a name="l2094"><span class="linenum">2094</span></a>  
<a name="l2095"><span class="linenum">2095</span></a>  <span class="comment">        // Define the sources</span>
<a name="l2096"><span class="linenum">2096</span></a>  
<a name="l2097"><span class="linenum">2097</span></a>          <a class="var it6092" onMouseOver="hilite(6092)" onMouseOut="lolite()" onClick="logVariable('qcategory')" href="../../_variables/qcategory.html">$qcategory</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;
<a name="l2098"><span class="linenum">2098</span></a>              SELECT gc.*, contextlevel, instanceid AS contextinstanceid
<a name="l2099"><span class="linenum">2099</span></a>                FROM {question_categories} gc
<a name="l2100"><span class="linenum">2100</span></a>                JOIN {backup_ids_temp} bi ON bi.itemid = gc.id
<a name="l2101"><span class="linenum">2101</span></a>                JOIN {context} co ON co.id = gc.contextid
<a name="l2102"><span class="linenum">2102</span></a>               WHERE bi.backupid = ?
<a name="l2103"><span class="linenum">2103</span></a>                 AND bi.itemname = 'question_categoryfinal'&quot;, array(backup::VAR_BACKUPID));
<a name="l2104"><span class="linenum">2104</span></a>  
<a name="l2105"><span class="linenum">2105</span></a>          <a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../_variables/question.html">$question</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('question', array('category' =&gt; backup::VAR_PARENTID));
<a name="l2106"><span class="linenum">2106</span></a>  
<a name="l2107"><span class="linenum">2107</span></a>          <a class="var it6094" onMouseOver="hilite(6094)" onMouseOut="lolite()" onClick="logVariable('qhint')" href="../../_variables/qhint.html">$qhint</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>('
<a name="l2108"><span class="linenum">2108</span></a>                  SELECT *
<a name="l2109"><span class="linenum">2109</span></a>                  FROM {question_hints}
<a name="l2110"><span class="linenum">2110</span></a>                  WHERE questionid = :questionid
<a name="l2111"><span class="linenum">2111</span></a>                  ORDER BY id',
<a name="l2112"><span class="linenum">2112</span></a>                  array('questionid' =&gt; backup::VAR_PARENTID));
<a name="l2113"><span class="linenum">2113</span></a>  
<a name="l2114"><span class="linenum">2114</span></a>          <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;SELECT t.id, t.name, t.rawname
<a name="l2115"><span class="linenum">2115</span></a>                                FROM {tag} t
<a name="l2116"><span class="linenum">2116</span></a>                                JOIN {tag_instance} ti ON ti.tagid = t.id
<a name="l2117"><span class="linenum">2117</span></a>                                WHERE ti.itemid = ?
<a name="l2118"><span class="linenum">2118</span></a>                                AND ti.itemtype = 'question'&quot;, array(backup::VAR_PARENTID));
<a name="l2119"><span class="linenum">2119</span></a>  
<a name="l2120"><span class="linenum">2120</span></a>  <span class="comment">        // don't need to annotate ids nor files</span>
<a name="l2121"><span class="linenum">2121</span></a>  <span class="comment">        // (already done by {@link backup_annotate_all_question_files}</span>
<a name="l2122"><span class="linenum">2122</span></a>  
<a name="l2123"><span class="linenum">2123</span></a>          return <a class="var it6091" onMouseOver="hilite(6091)" onMouseOut="lolite()" onClick="logVariable('qcategories')" href="../../_variables/qcategories.html">$qcategories</a>;
<a name="l2124"><span class="linenum">2124</span></a>      }
<a name="l2125"><span class="linenum">2125</span></a>  }
<a name="l2126"><span class="linenum">2126</span></a>  
<a name="l2127"><span class="linenum">2127</span></a>  
<a name="l2128"><span class="linenum">2128</span></a>  
<a name="l2129"><span class="linenum">2129</span></a>  <span class="comment">/**</span>
<a name="l2130"><span class="linenum">2130</span></a>  <span class="comment"> * This step will generate all the file  annotations for the already</span>
<a name="l2131"><span class="linenum">2131</span></a>  <span class="comment"> * annotated (final) users. Need to do this here because each user</span>
<a name="l2132"><span class="linenum">2132</span></a>  <span class="comment"> * has its own context and structure tasks only are able to handle</span>
<a name="l2133"><span class="linenum">2133</span></a>  <span class="comment"> * one context. Also, this step will guarantee that every user has</span>
<a name="l2134"><span class="linenum">2134</span></a>  <span class="comment"> * its context created (req for other steps)</span>
<a name="l2135"><span class="linenum">2135</span></a>  <span class="comment"> */</span>
<a name="l2136"><span class="linenum">2136</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_annotate_all_user_files')" href="../../_classes/backup_annotate_all_user_files.html" onMouseOver="classPopup(event,'backup_annotate_all_user_files')">backup_annotate_all_user_files</a> extends backup_execution_step {
<a name="l2137"><span class="linenum">2137</span></a>  
<a name="l2138"><span class="linenum">2138</span></a>      protected function <a class="function" onClick="logFunction('define_execution')" href="../../_functions/define_execution.html" onMouseOver="funcPopup(event,'define_execution')">define_execution</a>() {
<a name="l2139"><span class="linenum">2139</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2140"><span class="linenum">2140</span></a>  
<a name="l2141"><span class="linenum">2141</span></a>  <span class="comment">        // List of fileareas we are going to annotate</span>
<a name="l2142"><span class="linenum">2142</span></a>          <a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('fileareas')" href="../../_variables/fileareas.html">$fileareas</a> = array('profile', 'icon');
<a name="l2143"><span class="linenum">2143</span></a>  
<a name="l2144"><span class="linenum">2144</span></a>  <span class="comment">        // Fetch all annotated (final) users</span>
<a name="l2145"><span class="linenum">2145</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('backup_ids_temp', array(
<a name="l2146"><span class="linenum">2146</span></a>              'backupid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), 'itemname' =&gt; 'userfinal'));
<a name="l2147"><span class="linenum">2147</span></a>          <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('get_progress')" href="../../_functions/get_progress.html" onMouseOver="funcPopup(event,'get_progress')">get_progress</a>();
<a name="l2148"><span class="linenum">2148</span></a>          <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('start_progress')" href="../../_functions/start_progress.html" onMouseOver="funcPopup(event,'start_progress')">start_progress</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>());
<a name="l2149"><span class="linenum">2149</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l2150"><span class="linenum">2150</span></a>              <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('itemid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>;
<a name="l2151"><span class="linenum">2151</span></a>              <a class="var it6095" onMouseOver="hilite(6095)" onMouseOut="lolite()" onClick="logVariable('userctx')" href="../../_variables/userctx.html">$userctx</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>);
<a name="l2152"><span class="linenum">2152</span></a>              if (!<a class="var it6095" onMouseOver="hilite(6095)" onMouseOut="lolite()" onClick="logVariable('userctx')" href="../../_variables/userctx.html">$userctx</a>) {
<a name="l2153"><span class="linenum">2153</span></a>                  continue; <span class="comment">// User has not context, sure it's a deleted user, so cannot have files</span>
<a name="l2154"><span class="linenum">2154</span></a>              }
<a name="l2155"><span class="linenum">2155</span></a>  <span class="comment">            // Proceed with every user filearea</span>
<a name="l2156"><span class="linenum">2156</span></a>              foreach (<a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('fileareas')" href="../../_variables/fileareas.html">$fileareas</a> as <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>) {
<a name="l2157"><span class="linenum">2157</span></a>  <span class="comment">                // We don't need to specify itemid ($userid - 5th param) as far as by</span>
<a name="l2158"><span class="linenum">2158</span></a>  <span class="comment">                // context we can get all the associated files. See MDL-22092</span>
<a name="l2159"><span class="linenum">2159</span></a>                  backup_structure_dbops::<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_backupid')" href="../../_functions/get_backupid.html" onMouseOver="funcPopup(event,'get_backupid')">get_backupid</a>(), <a class="var it6095" onMouseOver="hilite(6095)" onMouseOut="lolite()" onClick="logVariable('userctx')" href="../../_variables/userctx.html">$userctx</a>-&gt;<a onClick="logVariable('id')" class="var it41350" onMouseOver="hilite(41350)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'user', <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, null);
<a name="l2160"><span class="linenum">2160</span></a>                  <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('progress')" href="../../_functions/progress.html" onMouseOver="funcPopup(event,'progress')">progress</a>();
<a name="l2161"><span class="linenum">2161</span></a>              }
<a name="l2162"><span class="linenum">2162</span></a>          }
<a name="l2163"><span class="linenum">2163</span></a>          <a class="var it3196" onMouseOver="hilite(3196)" onMouseOut="lolite()" onClick="logVariable('progress')" href="../../_variables/progress.html">$progress</a>-&gt;<a class="function" onClick="logFunction('end_progress')" href="../../_functions/end_progress.html" onMouseOver="funcPopup(event,'end_progress')">end_progress</a>();
<a name="l2164"><span class="linenum">2164</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2165"><span class="linenum">2165</span></a>      }
<a name="l2166"><span class="linenum">2166</span></a>  }
<a name="l2167"><span class="linenum">2167</span></a>  
<a name="l2168"><span class="linenum">2168</span></a>  
<a name="l2169"><span class="linenum">2169</span></a>  <span class="comment">/**</span>
<a name="l2170"><span class="linenum">2170</span></a>  <span class="comment"> * Defines the backup step for advanced grading methods attached to the activity module</span>
<a name="l2171"><span class="linenum">2171</span></a>  <span class="comment"> */</span>
<a name="l2172"><span class="linenum">2172</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_activity_grading_structure_step')" href="../../_classes/backup_activity_grading_structure_step.html" onMouseOver="classPopup(event,'backup_activity_grading_structure_step')">backup_activity_grading_structure_step</a> extends backup_structure_step {
<a name="l2173"><span class="linenum">2173</span></a>  
<a name="l2174"><span class="linenum">2174</span></a>      <span class="comment">/**</span>
<a name="l2175"><span class="linenum">2175</span></a>  <span class="comment">     * Include the grading.xml only if the module supports advanced grading</span>
<a name="l2176"><span class="linenum">2176</span></a>  <span class="comment">     */</span>
<a name="l2177"><span class="linenum">2177</span></a>      protected function <a class="function" onClick="logFunction('execute_condition')" href="../../_functions/execute_condition.html" onMouseOver="funcPopup(event,'execute_condition')">execute_condition</a>() {
<a name="l2178"><span class="linenum">2178</span></a>  
<a name="l2179"><span class="linenum">2179</span></a>  <span class="comment">        // No grades on the front page.</span>
<a name="l2180"><span class="linenum">2180</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>() == <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l2181"><span class="linenum">2181</span></a>              return false;
<a name="l2182"><span class="linenum">2182</span></a>          }
<a name="l2183"><span class="linenum">2183</span></a>  
<a name="l2184"><span class="linenum">2184</span></a>          return <a class="function" onClick="logFunction('plugin_supports')" href="../../_functions/plugin_supports.html" onMouseOver="funcPopup(event,'plugin_supports')">plugin_supports</a>('mod', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_task')" href="../../_functions/get_task.html" onMouseOver="funcPopup(event,'get_task')">get_task</a>()-&gt;<a class="function" onClick="logFunction('get_modulename')" href="../../_functions/get_modulename.html" onMouseOver="funcPopup(event,'get_modulename')">get_modulename</a>(), <a class="constant" onClick="logConstant('FEATURE_ADVANCED_GRADING')" href="../../_constants/FEATURE_ADVANCED_GRADING.html" onMouseOver="constPopup(event,'FEATURE_ADVANCED_GRADING')">FEATURE_ADVANCED_GRADING</a>, false);
<a name="l2185"><span class="linenum">2185</span></a>      }
<a name="l2186"><span class="linenum">2186</span></a>  
<a name="l2187"><span class="linenum">2187</span></a>      <span class="comment">/**</span>
<a name="l2188"><span class="linenum">2188</span></a>  <span class="comment">     * Declares the gradable areas structures and data sources</span>
<a name="l2189"><span class="linenum">2189</span></a>  <span class="comment">     */</span>
<a name="l2190"><span class="linenum">2190</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l2191"><span class="linenum">2191</span></a>  
<a name="l2192"><span class="linenum">2192</span></a>  <span class="comment">        // To know if we are including userinfo</span>
<a name="l2193"><span class="linenum">2193</span></a>          <a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('userinfo');
<a name="l2194"><span class="linenum">2194</span></a>  
<a name="l2195"><span class="linenum">2195</span></a>  <span class="comment">        // Define the elements</span>
<a name="l2196"><span class="linenum">2196</span></a>  
<a name="l2197"><span class="linenum">2197</span></a>          <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('areas');
<a name="l2198"><span class="linenum">2198</span></a>  
<a name="l2199"><span class="linenum">2199</span></a>          <a class="var it1628" onMouseOver="hilite(1628)" onMouseOut="lolite()" onClick="logVariable('area')" href="../../_variables/area.html">$area</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('area', array('id'), array(
<a name="l2200"><span class="linenum">2200</span></a>              'areaname', 'activemethod'));
<a name="l2201"><span class="linenum">2201</span></a>  
<a name="l2202"><span class="linenum">2202</span></a>          <a class="var it6096" onMouseOver="hilite(6096)" onMouseOut="lolite()" onClick="logVariable('definitions')" href="../../_variables/definitions.html">$definitions</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('definitions');
<a name="l2203"><span class="linenum">2203</span></a>  
<a name="l2204"><span class="linenum">2204</span></a>          <a class="var it1605" onMouseOver="hilite(1605)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../_variables/definition.html">$definition</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('definition', array('id'), array(
<a name="l2205"><span class="linenum">2205</span></a>              'method', 'name', 'description', 'descriptionformat', 'status',
<a name="l2206"><span class="linenum">2206</span></a>              'timecreated', 'timemodified', 'options'));
<a name="l2207"><span class="linenum">2207</span></a>  
<a name="l2208"><span class="linenum">2208</span></a>          <a class="var it1238" onMouseOver="hilite(1238)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../../_variables/instances.html">$instances</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('instances');
<a name="l2209"><span class="linenum">2209</span></a>  
<a name="l2210"><span class="linenum">2210</span></a>          <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('instance', array('id'), array(
<a name="l2211"><span class="linenum">2211</span></a>              'raterid', 'itemid', 'rawgrade', 'status', 'feedback',
<a name="l2212"><span class="linenum">2212</span></a>              'feedbackformat', 'timemodified'));
<a name="l2213"><span class="linenum">2213</span></a>  
<a name="l2214"><span class="linenum">2214</span></a>  <span class="comment">        // Build the tree including the method specific structures</span>
<a name="l2215"><span class="linenum">2215</span></a>  <span class="comment">        // (beware - the order of how gradingform plugins structures are attached is important)</span>
<a name="l2216"><span class="linenum">2216</span></a>          <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1628" onMouseOver="hilite(1628)" onMouseOut="lolite()" onClick="logVariable('area')" href="../../_variables/area.html">$area</a>);
<a name="l2217"><span class="linenum">2217</span></a>  <span class="comment">        // attach local plugin stucture to $area element, multiple allowed</span>
<a name="l2218"><span class="linenum">2218</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('local', <a class="var it1628" onMouseOver="hilite(1628)" onMouseOut="lolite()" onClick="logVariable('area')" href="../../_variables/area.html">$area</a>, true);
<a name="l2219"><span class="linenum">2219</span></a>          <a class="var it1628" onMouseOver="hilite(1628)" onMouseOut="lolite()" onClick="logVariable('area')" href="../../_variables/area.html">$area</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6096" onMouseOver="hilite(6096)" onMouseOut="lolite()" onClick="logVariable('definitions')" href="../../_variables/definitions.html">$definitions</a>);
<a name="l2220"><span class="linenum">2220</span></a>          <a class="var it6096" onMouseOver="hilite(6096)" onMouseOut="lolite()" onClick="logVariable('definitions')" href="../../_variables/definitions.html">$definitions</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1605" onMouseOver="hilite(1605)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../_variables/definition.html">$definition</a>);
<a name="l2221"><span class="linenum">2221</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('gradingform', <a class="var it1605" onMouseOver="hilite(1605)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../_variables/definition.html">$definition</a>, true);
<a name="l2222"><span class="linenum">2222</span></a>  <span class="comment">        // attach local plugin stucture to $definition element, multiple allowed</span>
<a name="l2223"><span class="linenum">2223</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('local', <a class="var it1605" onMouseOver="hilite(1605)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../_variables/definition.html">$definition</a>, true);
<a name="l2224"><span class="linenum">2224</span></a>          <a class="var it1605" onMouseOver="hilite(1605)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../_variables/definition.html">$definition</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1238" onMouseOver="hilite(1238)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../../_variables/instances.html">$instances</a>);
<a name="l2225"><span class="linenum">2225</span></a>          <a class="var it1238" onMouseOver="hilite(1238)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../../_variables/instances.html">$instances</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>);
<a name="l2226"><span class="linenum">2226</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('gradingform', <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, false);
<a name="l2227"><span class="linenum">2227</span></a>  <span class="comment">        // attach local plugin stucture to $instance element, multiple allowed</span>
<a name="l2228"><span class="linenum">2228</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_plugin_structure')" href="../../_functions/add_plugin_structure.html" onMouseOver="funcPopup(event,'add_plugin_structure')">add_plugin_structure</a>('local', <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, true);
<a name="l2229"><span class="linenum">2229</span></a>  
<a name="l2230"><span class="linenum">2230</span></a>  <span class="comment">        // Define data sources</span>
<a name="l2231"><span class="linenum">2231</span></a>  
<a name="l2232"><span class="linenum">2232</span></a>          <a class="var it1628" onMouseOver="hilite(1628)" onMouseOut="lolite()" onClick="logVariable('area')" href="../../_variables/area.html">$area</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('grading_areas', array('contextid' =&gt; backup::VAR_CONTEXTID,
<a name="l2233"><span class="linenum">2233</span></a>              'component' =&gt; array('sqlparam' =&gt; 'mod_'.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_task')" href="../../_functions/get_task.html" onMouseOver="funcPopup(event,'get_task')">get_task</a>()-&gt;<a class="function" onClick="logFunction('get_modulename')" href="../../_functions/get_modulename.html" onMouseOver="funcPopup(event,'get_modulename')">get_modulename</a>())));
<a name="l2234"><span class="linenum">2234</span></a>  
<a name="l2235"><span class="linenum">2235</span></a>          <a class="var it1605" onMouseOver="hilite(1605)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../_variables/definition.html">$definition</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('grading_definitions', array('areaid' =&gt; backup::VAR_PARENTID));
<a name="l2236"><span class="linenum">2236</span></a>  
<a name="l2237"><span class="linenum">2237</span></a>          if (<a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a>) {
<a name="l2238"><span class="linenum">2238</span></a>              <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('grading_instances', array('definitionid' =&gt; backup::VAR_PARENTID));
<a name="l2239"><span class="linenum">2239</span></a>          }
<a name="l2240"><span class="linenum">2240</span></a>  
<a name="l2241"><span class="linenum">2241</span></a>  <span class="comment">        // Annotate references</span>
<a name="l2242"><span class="linenum">2242</span></a>          <a class="var it1605" onMouseOver="hilite(1605)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../_variables/definition.html">$definition</a>-&gt;<a class="function" onClick="logFunction('annotate_files')" href="../../_functions/annotate_files.html" onMouseOver="funcPopup(event,'annotate_files')">annotate_files</a>('grading', 'description', 'id');
<a name="l2243"><span class="linenum">2243</span></a>          <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'raterid');
<a name="l2244"><span class="linenum">2244</span></a>  
<a name="l2245"><span class="linenum">2245</span></a>  <span class="comment">        // Return the root element</span>
<a name="l2246"><span class="linenum">2246</span></a>          return <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>;
<a name="l2247"><span class="linenum">2247</span></a>      }
<a name="l2248"><span class="linenum">2248</span></a>  }
<a name="l2249"><span class="linenum">2249</span></a>  
<a name="l2250"><span class="linenum">2250</span></a>  
<a name="l2251"><span class="linenum">2251</span></a>  <span class="comment">/**</span>
<a name="l2252"><span class="linenum">2252</span></a>  <span class="comment"> * structure step in charge of constructing the grades.xml file for all the grade items</span>
<a name="l2253"><span class="linenum">2253</span></a>  <span class="comment"> * and letters related to one activity</span>
<a name="l2254"><span class="linenum">2254</span></a>  <span class="comment"> */</span>
<a name="l2255"><span class="linenum">2255</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_activity_grades_structure_step')" href="../../_classes/backup_activity_grades_structure_step.html" onMouseOver="classPopup(event,'backup_activity_grades_structure_step')">backup_activity_grades_structure_step</a> extends backup_structure_step {
<a name="l2256"><span class="linenum">2256</span></a>  
<a name="l2257"><span class="linenum">2257</span></a>      <span class="comment">/**</span>
<a name="l2258"><span class="linenum">2258</span></a>  <span class="comment">     * No grades on the front page.</span>
<a name="l2259"><span class="linenum">2259</span></a>  <span class="comment">     * @return bool</span>
<a name="l2260"><span class="linenum">2260</span></a>  <span class="comment">     */</span>
<a name="l2261"><span class="linenum">2261</span></a>      protected function <a class="function" onClick="logFunction('execute_condition')" href="../../_functions/execute_condition.html" onMouseOver="funcPopup(event,'execute_condition')">execute_condition</a>() {
<a name="l2262"><span class="linenum">2262</span></a>          return (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>() != <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l2263"><span class="linenum">2263</span></a>      }
<a name="l2264"><span class="linenum">2264</span></a>  
<a name="l2265"><span class="linenum">2265</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l2266"><span class="linenum">2266</span></a>  
<a name="l2267"><span class="linenum">2267</span></a>  <span class="comment">        // To know if we are including userinfo</span>
<a name="l2268"><span class="linenum">2268</span></a>          <a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('userinfo');
<a name="l2269"><span class="linenum">2269</span></a>  
<a name="l2270"><span class="linenum">2270</span></a>  <span class="comment">        // Define each element separated</span>
<a name="l2271"><span class="linenum">2271</span></a>  
<a name="l2272"><span class="linenum">2272</span></a>          <a class="var it4702" onMouseOver="hilite(4702)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('activity_gradebook');
<a name="l2273"><span class="linenum">2273</span></a>  
<a name="l2274"><span class="linenum">2274</span></a>          <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_items');
<a name="l2275"><span class="linenum">2275</span></a>  
<a name="l2276"><span class="linenum">2276</span></a>          <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_item', array('id'), array(
<a name="l2277"><span class="linenum">2277</span></a>              'categoryid', 'itemname', 'itemtype', 'itemmodule',
<a name="l2278"><span class="linenum">2278</span></a>              'iteminstance', 'itemnumber', 'iteminfo', 'idnumber',
<a name="l2279"><span class="linenum">2279</span></a>              'calculation', 'gradetype', 'grademax', 'grademin',
<a name="l2280"><span class="linenum">2280</span></a>              'scaleid', 'outcomeid', 'gradepass', 'multfactor',
<a name="l2281"><span class="linenum">2281</span></a>              'plusfactor', 'aggregationcoef', 'aggregationcoef2', 'weightoverride',
<a name="l2282"><span class="linenum">2282</span></a>              'sortorder', 'display', 'decimals', 'hidden', 'locked', 'locktime',
<a name="l2283"><span class="linenum">2283</span></a>              'needsupdate', 'timecreated', 'timemodified'));
<a name="l2284"><span class="linenum">2284</span></a>  
<a name="l2285"><span class="linenum">2285</span></a>          <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_grades');
<a name="l2286"><span class="linenum">2286</span></a>  
<a name="l2287"><span class="linenum">2287</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_grade', array('id'), array(
<a name="l2288"><span class="linenum">2288</span></a>              'userid', 'rawgrade', 'rawgrademax', 'rawgrademin',
<a name="l2289"><span class="linenum">2289</span></a>              'rawscaleid', 'usermodified', 'finalgrade', 'hidden',
<a name="l2290"><span class="linenum">2290</span></a>              'locked', 'locktime', 'exported', 'overridden',
<a name="l2291"><span class="linenum">2291</span></a>              'excluded', 'feedback', 'feedbackformat', 'information',
<a name="l2292"><span class="linenum">2292</span></a>              'informationformat', 'timecreated', 'timemodified',
<a name="l2293"><span class="linenum">2293</span></a>              'aggregationstatus', 'aggregationweight'));
<a name="l2294"><span class="linenum">2294</span></a>  
<a name="l2295"><span class="linenum">2295</span></a>          <a class="var it3696" onMouseOver="hilite(3696)" onMouseOut="lolite()" onClick="logVariable('letters')" href="../../_variables/letters.html">$letters</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_letters');
<a name="l2296"><span class="linenum">2296</span></a>  
<a name="l2297"><span class="linenum">2297</span></a>          <a class="var it4483" onMouseOver="hilite(4483)" onMouseOut="lolite()" onClick="logVariable('letter')" href="../../_variables/letter.html">$letter</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_letter', 'id', array(
<a name="l2298"><span class="linenum">2298</span></a>              'lowerboundary', 'letter'));
<a name="l2299"><span class="linenum">2299</span></a>  
<a name="l2300"><span class="linenum">2300</span></a>  <span class="comment">        // Build the tree</span>
<a name="l2301"><span class="linenum">2301</span></a>  
<a name="l2302"><span class="linenum">2302</span></a>          <a class="var it4702" onMouseOver="hilite(4702)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a>);
<a name="l2303"><span class="linenum">2303</span></a>          <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>);
<a name="l2304"><span class="linenum">2304</span></a>  
<a name="l2305"><span class="linenum">2305</span></a>          <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l2306"><span class="linenum">2306</span></a>          <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>);
<a name="l2307"><span class="linenum">2307</span></a>  
<a name="l2308"><span class="linenum">2308</span></a>          <a class="var it4702" onMouseOver="hilite(4702)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it3696" onMouseOver="hilite(3696)" onMouseOut="lolite()" onClick="logVariable('letters')" href="../../_variables/letters.html">$letters</a>);
<a name="l2309"><span class="linenum">2309</span></a>          <a class="var it3696" onMouseOver="hilite(3696)" onMouseOut="lolite()" onClick="logVariable('letters')" href="../../_variables/letters.html">$letters</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it4483" onMouseOver="hilite(4483)" onMouseOut="lolite()" onClick="logVariable('letter')" href="../../_variables/letter.html">$letter</a>);
<a name="l2310"><span class="linenum">2310</span></a>  
<a name="l2311"><span class="linenum">2311</span></a>  <span class="comment">        // Define sources</span>
<a name="l2312"><span class="linenum">2312</span></a>  
<a name="l2313"><span class="linenum">2313</span></a>          <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;SELECT gi.*
<a name="l2314"><span class="linenum">2314</span></a>                                 FROM {grade_items} gi
<a name="l2315"><span class="linenum">2315</span></a>                                 JOIN {backup_ids_temp} bi ON gi.id = bi.itemid
<a name="l2316"><span class="linenum">2316</span></a>                                 WHERE bi.backupid = ?
<a name="l2317"><span class="linenum">2317</span></a>                                 AND bi.itemname = 'grade_item'&quot;, array(backup::VAR_BACKUPID));
<a name="l2318"><span class="linenum">2318</span></a>  
<a name="l2319"><span class="linenum">2319</span></a>  <span class="comment">        // This only happens if we are including user info</span>
<a name="l2320"><span class="linenum">2320</span></a>          if (<a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a>) {
<a name="l2321"><span class="linenum">2321</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('grade_grades', array('itemid' =&gt; backup::VAR_PARENTID));
<a name="l2322"><span class="linenum">2322</span></a>          }
<a name="l2323"><span class="linenum">2323</span></a>  
<a name="l2324"><span class="linenum">2324</span></a>          <a class="var it4483" onMouseOver="hilite(4483)" onMouseOut="lolite()" onClick="logVariable('letter')" href="../../_variables/letter.html">$letter</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('grade_letters', array('contextid' =&gt; backup::VAR_CONTEXTID));
<a name="l2325"><span class="linenum">2325</span></a>  
<a name="l2326"><span class="linenum">2326</span></a>  <span class="comment">        // Annotations</span>
<a name="l2327"><span class="linenum">2327</span></a>  
<a name="l2328"><span class="linenum">2328</span></a>          <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('scalefinal', 'scaleid'); <span class="comment">// Straight as scalefinal because it's &gt; 0</span>
<a name="l2329"><span class="linenum">2329</span></a>          <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('outcome', 'outcomeid');
<a name="l2330"><span class="linenum">2330</span></a>  
<a name="l2331"><span class="linenum">2331</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l2332"><span class="linenum">2332</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'usermodified');
<a name="l2333"><span class="linenum">2333</span></a>  
<a name="l2334"><span class="linenum">2334</span></a>  <span class="comment">        // Return the root element (book)</span>
<a name="l2335"><span class="linenum">2335</span></a>  
<a name="l2336"><span class="linenum">2336</span></a>          return <a class="var it4702" onMouseOver="hilite(4702)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>;
<a name="l2337"><span class="linenum">2337</span></a>      }
<a name="l2338"><span class="linenum">2338</span></a>  }
<a name="l2339"><span class="linenum">2339</span></a>  
<a name="l2340"><span class="linenum">2340</span></a>  <span class="comment">/**</span>
<a name="l2341"><span class="linenum">2341</span></a>  <span class="comment"> * Structure step in charge of constructing the grade history of an activity.</span>
<a name="l2342"><span class="linenum">2342</span></a>  <span class="comment"> *</span>
<a name="l2343"><span class="linenum">2343</span></a>  <span class="comment"> * This step is added to the task regardless of the setting 'grade_histories'.</span>
<a name="l2344"><span class="linenum">2344</span></a>  <span class="comment"> * The reason is to allow for a more flexible step in case the logic needs to be</span>
<a name="l2345"><span class="linenum">2345</span></a>  <span class="comment"> * split accross different settings to control the history of items and/or grades.</span>
<a name="l2346"><span class="linenum">2346</span></a>  <span class="comment"> */</span>
<a name="l2347"><span class="linenum">2347</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_activity_grade_history_structure_step')" href="../../_classes/backup_activity_grade_history_structure_step.html" onMouseOver="classPopup(event,'backup_activity_grade_history_structure_step')">backup_activity_grade_history_structure_step</a> extends backup_structure_step {
<a name="l2348"><span class="linenum">2348</span></a>  
<a name="l2349"><span class="linenum">2349</span></a>      <span class="comment">/**</span>
<a name="l2350"><span class="linenum">2350</span></a>  <span class="comment">     * No grades on the front page.</span>
<a name="l2351"><span class="linenum">2351</span></a>  <span class="comment">     * @return bool</span>
<a name="l2352"><span class="linenum">2352</span></a>  <span class="comment">     */</span>
<a name="l2353"><span class="linenum">2353</span></a>      protected function <a class="function" onClick="logFunction('execute_condition')" href="../../_functions/execute_condition.html" onMouseOver="funcPopup(event,'execute_condition')">execute_condition</a>() {
<a name="l2354"><span class="linenum">2354</span></a>          return (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>() != <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l2355"><span class="linenum">2355</span></a>      }
<a name="l2356"><span class="linenum">2356</span></a>  
<a name="l2357"><span class="linenum">2357</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l2358"><span class="linenum">2358</span></a>  
<a name="l2359"><span class="linenum">2359</span></a>  <span class="comment">        // Settings to use.</span>
<a name="l2360"><span class="linenum">2360</span></a>          <a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('userinfo');
<a name="l2361"><span class="linenum">2361</span></a>          <a class="var it1501" onMouseOver="hilite(1501)" onMouseOut="lolite()" onClick="logVariable('history')" href="../../_variables/history.html">$history</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('grade_histories');
<a name="l2362"><span class="linenum">2362</span></a>  
<a name="l2363"><span class="linenum">2363</span></a>  <span class="comment">        // Create the nested elements.</span>
<a name="l2364"><span class="linenum">2364</span></a>          <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('bookhistory')" href="../../_variables/bookhistory.html">$bookhistory</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_history');
<a name="l2365"><span class="linenum">2365</span></a>          <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_grades');
<a name="l2366"><span class="linenum">2366</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('grade_grade', array('id'), array(
<a name="l2367"><span class="linenum">2367</span></a>              'action', 'oldid', 'source', 'loggeduser', 'itemid', 'userid',
<a name="l2368"><span class="linenum">2368</span></a>              'rawgrade', 'rawgrademax', 'rawgrademin', 'rawscaleid',
<a name="l2369"><span class="linenum">2369</span></a>              'usermodified', 'finalgrade', 'hidden', 'locked', 'locktime', 'exported', 'overridden',
<a name="l2370"><span class="linenum">2370</span></a>              'excluded', 'feedback', 'feedbackformat', 'information',
<a name="l2371"><span class="linenum">2371</span></a>              'informationformat', 'timemodified'));
<a name="l2372"><span class="linenum">2372</span></a>  
<a name="l2373"><span class="linenum">2373</span></a>  <span class="comment">        // Build the tree.</span>
<a name="l2374"><span class="linenum">2374</span></a>          <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('bookhistory')" href="../../_variables/bookhistory.html">$bookhistory</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l2375"><span class="linenum">2375</span></a>          <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>);
<a name="l2376"><span class="linenum">2376</span></a>  
<a name="l2377"><span class="linenum">2377</span></a>  <span class="comment">        // This only happens if we are including user info and history.</span>
<a name="l2378"><span class="linenum">2378</span></a>          if (<a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a> &amp;&amp; <a class="var it1501" onMouseOver="hilite(1501)" onMouseOut="lolite()" onClick="logVariable('history')" href="../../_variables/history.html">$history</a>) {
<a name="l2379"><span class="linenum">2379</span></a>  <span class="comment">            // Define sources. Only select the history related to existing activity items.</span>
<a name="l2380"><span class="linenum">2380</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(&quot;SELECT ggh.*
<a name="l2381"><span class="linenum">2381</span></a>                                       FROM {grade_grades_history} ggh
<a name="l2382"><span class="linenum">2382</span></a>                                       JOIN {backup_ids_temp} bi ON ggh.itemid = bi.itemid
<a name="l2383"><span class="linenum">2383</span></a>                                      WHERE bi.backupid = ?
<a name="l2384"><span class="linenum">2384</span></a>                                        AND bi.itemname = 'grade_item'&quot;, array(backup::VAR_BACKUPID));
<a name="l2385"><span class="linenum">2385</span></a>          }
<a name="l2386"><span class="linenum">2386</span></a>  
<a name="l2387"><span class="linenum">2387</span></a>  <span class="comment">        // Annotations.</span>
<a name="l2388"><span class="linenum">2388</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('scalefinal', 'rawscaleid'); <span class="comment">// Straight as scalefinal because it's &gt; 0.</span>
<a name="l2389"><span class="linenum">2389</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'loggeduser');
<a name="l2390"><span class="linenum">2390</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l2391"><span class="linenum">2391</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'usermodified');
<a name="l2392"><span class="linenum">2392</span></a>  
<a name="l2393"><span class="linenum">2393</span></a>  <span class="comment">        // Return the root element.</span>
<a name="l2394"><span class="linenum">2394</span></a>          return <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('bookhistory')" href="../../_variables/bookhistory.html">$bookhistory</a>;
<a name="l2395"><span class="linenum">2395</span></a>      }
<a name="l2396"><span class="linenum">2396</span></a>  }
<a name="l2397"><span class="linenum">2397</span></a>  
<a name="l2398"><span class="linenum">2398</span></a>  <span class="comment">/**</span>
<a name="l2399"><span class="linenum">2399</span></a>  <span class="comment"> * Backups up the course completion information for the course.</span>
<a name="l2400"><span class="linenum">2400</span></a>  <span class="comment"> */</span>
<a name="l2401"><span class="linenum">2401</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_course_completion_structure_step')" href="../../_classes/backup_course_completion_structure_step.html" onMouseOver="classPopup(event,'backup_course_completion_structure_step')">backup_course_completion_structure_step</a> extends backup_structure_step {
<a name="l2402"><span class="linenum">2402</span></a>  
<a name="l2403"><span class="linenum">2403</span></a>      protected function <a class="function" onClick="logFunction('execute_condition')" href="../../_functions/execute_condition.html" onMouseOver="funcPopup(event,'execute_condition')">execute_condition</a>() {
<a name="l2404"><span class="linenum">2404</span></a>  
<a name="l2405"><span class="linenum">2405</span></a>  <span class="comment">        // No completion on front page.</span>
<a name="l2406"><span class="linenum">2406</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>() == <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l2407"><span class="linenum">2407</span></a>              return false;
<a name="l2408"><span class="linenum">2408</span></a>          }
<a name="l2409"><span class="linenum">2409</span></a>  
<a name="l2410"><span class="linenum">2410</span></a>  <span class="comment">        // Check that all activities have been included</span>
<a name="l2411"><span class="linenum">2411</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('task')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/task.html">task</a>-&gt;<a class="function" onClick="logFunction('is_excluding_activities')" href="../../_functions/is_excluding_activities.html" onMouseOver="funcPopup(event,'is_excluding_activities')">is_excluding_activities</a>()) {
<a name="l2412"><span class="linenum">2412</span></a>              return false;
<a name="l2413"><span class="linenum">2413</span></a>          }
<a name="l2414"><span class="linenum">2414</span></a>          return true;
<a name="l2415"><span class="linenum">2415</span></a>      }
<a name="l2416"><span class="linenum">2416</span></a>  
<a name="l2417"><span class="linenum">2417</span></a>      <span class="comment">/**</span>
<a name="l2418"><span class="linenum">2418</span></a>  <span class="comment">     * The structure of the course completion backup</span>
<a name="l2419"><span class="linenum">2419</span></a>  <span class="comment">     *</span>
<a name="l2420"><span class="linenum">2420</span></a>  <span class="comment">     * @return backup_nested_element</span>
<a name="l2421"><span class="linenum">2421</span></a>  <span class="comment">     */</span>
<a name="l2422"><span class="linenum">2422</span></a>      protected function <a class="function" onClick="logFunction('define_structure')" href="../../_functions/define_structure.html" onMouseOver="funcPopup(event,'define_structure')">define_structure</a>() {
<a name="l2423"><span class="linenum">2423</span></a>  
<a name="l2424"><span class="linenum">2424</span></a>  <span class="comment">        // To know if we are including user completion info</span>
<a name="l2425"><span class="linenum">2425</span></a>          <a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('userscompletion');
<a name="l2426"><span class="linenum">2426</span></a>  
<a name="l2427"><span class="linenum">2427</span></a>          <a class="var it6097" onMouseOver="hilite(6097)" onMouseOut="lolite()" onClick="logVariable('cc')" href="../../_variables/cc.html">$cc</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('course_completion');
<a name="l2428"><span class="linenum">2428</span></a>  
<a name="l2429"><span class="linenum">2429</span></a>          <a class="var it1624" onMouseOver="hilite(1624)" onMouseOut="lolite()" onClick="logVariable('criteria')" href="../../_variables/criteria.html">$criteria</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('course_completion_criteria', array('id'), array(
<a name="l2430"><span class="linenum">2430</span></a>              'course', 'criteriatype', 'module', 'moduleinstance', 'courseinstanceshortname', 'enrolperiod',
<a name="l2431"><span class="linenum">2431</span></a>              'timeend', 'gradepass', 'role', 'roleshortname'
<a name="l2432"><span class="linenum">2432</span></a>          ));
<a name="l2433"><span class="linenum">2433</span></a>  
<a name="l2434"><span class="linenum">2434</span></a>          <a class="var it6098" onMouseOver="hilite(6098)" onMouseOut="lolite()" onClick="logVariable('criteriacompletions')" href="../../_variables/criteriacompletions.html">$criteriacompletions</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('course_completion_crit_completions');
<a name="l2435"><span class="linenum">2435</span></a>  
<a name="l2436"><span class="linenum">2436</span></a>          <a class="var it6099" onMouseOver="hilite(6099)" onMouseOut="lolite()" onClick="logVariable('criteriacomplete')" href="../../_variables/criteriacomplete.html">$criteriacomplete</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('course_completion_crit_compl', array('id'), array(
<a name="l2437"><span class="linenum">2437</span></a>              'criteriaid', 'userid', 'gradefinal', 'unenrolled', 'timecompleted'
<a name="l2438"><span class="linenum">2438</span></a>          ));
<a name="l2439"><span class="linenum">2439</span></a>  
<a name="l2440"><span class="linenum">2440</span></a>          <a class="var it6100" onMouseOver="hilite(6100)" onMouseOut="lolite()" onClick="logVariable('coursecompletions')" href="../../_variables/coursecompletions.html">$coursecompletions</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('course_completions', array('id'), array(
<a name="l2441"><span class="linenum">2441</span></a>              'userid', 'course', 'timeenrolled', 'timestarted', 'timecompleted', 'reaggregate'
<a name="l2442"><span class="linenum">2442</span></a>          ));
<a name="l2443"><span class="linenum">2443</span></a>  
<a name="l2444"><span class="linenum">2444</span></a>          <a class="var it6101" onMouseOver="hilite(6101)" onMouseOut="lolite()" onClick="logVariable('aggregatemethod')" href="../../_variables/aggregatemethod.html">$aggregatemethod</a> = <span class="keyword">new </span><a class="class" onClick="logClass('backup_nested_element')" href="../../_classes/backup_nested_element.html" onMouseOver="classPopup(event,'backup_nested_element')">backup_nested_element</a>('course_completion_aggr_methd', array('id'), array(
<a name="l2445"><span class="linenum">2445</span></a>              'course','criteriatype','method','value'
<a name="l2446"><span class="linenum">2446</span></a>          ));
<a name="l2447"><span class="linenum">2447</span></a>  
<a name="l2448"><span class="linenum">2448</span></a>          <a class="var it6097" onMouseOver="hilite(6097)" onMouseOut="lolite()" onClick="logVariable('cc')" href="../../_variables/cc.html">$cc</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it1624" onMouseOver="hilite(1624)" onMouseOut="lolite()" onClick="logVariable('criteria')" href="../../_variables/criteria.html">$criteria</a>);
<a name="l2449"><span class="linenum">2449</span></a>              <a class="var it1624" onMouseOver="hilite(1624)" onMouseOut="lolite()" onClick="logVariable('criteria')" href="../../_variables/criteria.html">$criteria</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6098" onMouseOver="hilite(6098)" onMouseOut="lolite()" onClick="logVariable('criteriacompletions')" href="../../_variables/criteriacompletions.html">$criteriacompletions</a>);
<a name="l2450"><span class="linenum">2450</span></a>                  <a class="var it6098" onMouseOver="hilite(6098)" onMouseOut="lolite()" onClick="logVariable('criteriacompletions')" href="../../_variables/criteriacompletions.html">$criteriacompletions</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6099" onMouseOver="hilite(6099)" onMouseOut="lolite()" onClick="logVariable('criteriacomplete')" href="../../_variables/criteriacomplete.html">$criteriacomplete</a>);
<a name="l2451"><span class="linenum">2451</span></a>          <a class="var it6097" onMouseOver="hilite(6097)" onMouseOut="lolite()" onClick="logVariable('cc')" href="../../_variables/cc.html">$cc</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6100" onMouseOver="hilite(6100)" onMouseOut="lolite()" onClick="logVariable('coursecompletions')" href="../../_variables/coursecompletions.html">$coursecompletions</a>);
<a name="l2452"><span class="linenum">2452</span></a>          <a class="var it6097" onMouseOver="hilite(6097)" onMouseOut="lolite()" onClick="logVariable('cc')" href="../../_variables/cc.html">$cc</a>-&gt;<a class="function" onClick="logFunction('add_child')" href="../../_functions/add_child.html" onMouseOver="funcPopup(event,'add_child')">add_child</a>(<a class="var it6101" onMouseOver="hilite(6101)" onMouseOut="lolite()" onClick="logVariable('aggregatemethod')" href="../../_variables/aggregatemethod.html">$aggregatemethod</a>);
<a name="l2453"><span class="linenum">2453</span></a>  
<a name="l2454"><span class="linenum">2454</span></a>  <span class="comment">        // We need some extra data for the restore.</span>
<a name="l2455"><span class="linenum">2455</span></a>  <span class="comment">        // - courseinstances shortname rather than an ID.</span>
<a name="l2456"><span class="linenum">2456</span></a>  <span class="comment">        // - roleshortname in case restoring on a different site.</span>
<a name="l2457"><span class="linenum">2457</span></a>          <a class="var it6102" onMouseOver="hilite(6102)" onMouseOut="lolite()" onClick="logVariable('sourcesql')" href="../../_variables/sourcesql.html">$sourcesql</a> = &quot;SELECT ccc.*, c.shortname AS courseinstanceshortname, r.shortname AS roleshortname
<a name="l2458"><span class="linenum">2458</span></a>                          FROM {course_completion_criteria} ccc
<a name="l2459"><span class="linenum">2459</span></a>                     LEFT JOIN {course} c ON c.id = ccc.courseinstance
<a name="l2460"><span class="linenum">2460</span></a>                     LEFT JOIN {role} r ON r.id = ccc.role
<a name="l2461"><span class="linenum">2461</span></a>                         WHERE ccc.course = ?&quot;;
<a name="l2462"><span class="linenum">2462</span></a>          <a class="var it1624" onMouseOver="hilite(1624)" onMouseOut="lolite()" onClick="logVariable('criteria')" href="../../_variables/criteria.html">$criteria</a>-&gt;<a class="function" onClick="logFunction('set_source_sql')" href="../../_functions/set_source_sql.html" onMouseOver="funcPopup(event,'set_source_sql')">set_source_sql</a>(<a class="var it6102" onMouseOver="hilite(6102)" onMouseOut="lolite()" onClick="logVariable('sourcesql')" href="../../_variables/sourcesql.html">$sourcesql</a>, array(backup::VAR_COURSEID));
<a name="l2463"><span class="linenum">2463</span></a>  
<a name="l2464"><span class="linenum">2464</span></a>          <a class="var it6101" onMouseOver="hilite(6101)" onMouseOut="lolite()" onClick="logVariable('aggregatemethod')" href="../../_variables/aggregatemethod.html">$aggregatemethod</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('course_completion_aggr_methd', array('course' =&gt; backup::VAR_COURSEID));
<a name="l2465"><span class="linenum">2465</span></a>  
<a name="l2466"><span class="linenum">2466</span></a>          if (<a class="var it1744" onMouseOver="hilite(1744)" onMouseOut="lolite()" onClick="logVariable('userinfo')" href="../../_variables/userinfo.html">$userinfo</a>) {
<a name="l2467"><span class="linenum">2467</span></a>              <a class="var it6099" onMouseOver="hilite(6099)" onMouseOut="lolite()" onClick="logVariable('criteriacomplete')" href="../../_variables/criteriacomplete.html">$criteriacomplete</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('course_completion_crit_compl', array('criteriaid' =&gt; backup::VAR_PARENTID));
<a name="l2468"><span class="linenum">2468</span></a>              <a class="var it6100" onMouseOver="hilite(6100)" onMouseOut="lolite()" onClick="logVariable('coursecompletions')" href="../../_variables/coursecompletions.html">$coursecompletions</a>-&gt;<a class="function" onClick="logFunction('set_source_table')" href="../../_functions/set_source_table.html" onMouseOver="funcPopup(event,'set_source_table')">set_source_table</a>('course_completions', array('course' =&gt; backup::VAR_COURSEID));
<a name="l2469"><span class="linenum">2469</span></a>          }
<a name="l2470"><span class="linenum">2470</span></a>  
<a name="l2471"><span class="linenum">2471</span></a>          <a class="var it1624" onMouseOver="hilite(1624)" onMouseOut="lolite()" onClick="logVariable('criteria')" href="../../_variables/criteria.html">$criteria</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('role', 'role');
<a name="l2472"><span class="linenum">2472</span></a>          <a class="var it6099" onMouseOver="hilite(6099)" onMouseOut="lolite()" onClick="logVariable('criteriacomplete')" href="../../_variables/criteriacomplete.html">$criteriacomplete</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l2473"><span class="linenum">2473</span></a>          <a class="var it6100" onMouseOver="hilite(6100)" onMouseOut="lolite()" onClick="logVariable('coursecompletions')" href="../../_variables/coursecompletions.html">$coursecompletions</a>-&gt;<a class="function" onClick="logFunction('annotate_ids')" href="../../_functions/annotate_ids.html" onMouseOver="funcPopup(event,'annotate_ids')">annotate_ids</a>('user', 'userid');
<a name="l2474"><span class="linenum">2474</span></a>  
<a name="l2475"><span class="linenum">2475</span></a>          return <a class="var it6097" onMouseOver="hilite(6097)" onMouseOut="lolite()" onClick="logVariable('cc')" href="../../_variables/cc.html">$cc</a>;
<a name="l2476"><span class="linenum">2476</span></a>  
<a name="l2477"><span class="linenum">2477</span></a>      }
<a name="l2478"><span class="linenum">2478</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'delete_temp_questions': ['delete_temp_questions', 'Delete all the annotated questions present in backup_ids_temp ', [['backup/util/dbops','backup_question_dbops.class.php',73]], 1],
'get_moodle_backup_information': ['get_moodle_backup_information', 'Get details information for main moodle_backup.xml file, extracting it from the specified controller. ', [['backup/util/dbops','backup_controller_dbops.class.php',345]], 3],
'get_config': ['get_config', 'Get a configuration value for this plugin ', [['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546],['question/engine','bank.php',109],['lib','moodlelib.php',1404],['lib','enrollib.php',1141],['lib/editor/tinymce/classes','plugin.php',73],['admin/tool/log/classes/helper','store.php',63]], 847],
'check_dir_exists': ['check_dir_exists', 'Function to check if a directory exists and by default create it if not exists. ', [['lib','setuplib.php',1366]], 46],
'start_progress': ['start_progress', 'Marks the start of an operation that will display progress. ', [['lib/classes/progress','base.php',77]], 81],
'create_backup_ids_temp_table': ['create_backup_ids_temp_table', '', [['backup/util/dbops','backup_controller_dbops.class.php',115]], 5],
'archive_to_pathname': ['archive_to_pathname', 'Zip files and store the result in os file. ', [['lib/filestorage','zip_packer.php',89],['lib/filestorage','tgz_packer.php',159],['lib/filestorage','mbz_packer.php',75]], 27],
'set_source_array': ['set_source_array', '', [['backup/util/structure','backup_nested_element.class.php',191]], 23],
'get_courseid': ['get_courseid', '', [['question/classes/bank','view.php',217],['backup/util/plan','base_task.class.php',109],['backup/util/plan','backup_plan.class.php',78],['backup/util/plan','base_step.class.php',105],['course/format','lib.php',222],['backup/util/plan','restore_plan.class.php',81],['mod/quiz','attemptlib.php',175],['mod/quiz','attemptlib.php',676],['comment','lib.php',998],['backup/controller','restore_controller.class.php',267],['backup/controller','backup_controller.class.php',265],['mod/quiz/classes','structure.php',223]], 190],
'on': ['on', '', [['lib/requirejs','require.js',506]], 3494],
'backup_includes_files': ['backup_includes_files', 'Given the backupid, determine whether this backup should include files from the moodle file storage system. ', [['backup/util/dbops','backup_controller_dbops.class.php',475]], 5],
'check_and_create_backup_dir': ['check_and_create_backup_dir', 'Given one backupid, create all the needed dirs to have one backup temp dir available ', [['backup/util/helper','backup_helper.class.php',32]], 1],
'get_format_options': ['get_format_options', 'Returns the format options stored for this course or course section ', [['course/format','lib.php',555]], 18],
'backup_includes_mnet_remote_users': ['backup_includes_mnet_remote_users', 'Given the backupid, detect if the backup includes "mnet" remote users or no ', [['backup/util/dbops','backup_controller_dbops.class.php',459]], 1],
'get_all_response_file_areas': ['get_all_response_file_areas', '', [['question/engine','lib.php',430]], 3],
'backup_get_original_course_info': ['backup_get_original_course_info', 'Given the courseid, return some course related information we want to transport ', [['backup/util/dbops','backup_controller_dbops.class.php',520]], 1],
'define_structure': ['define_structure', '', [['mod/lesson/backup/moodle2','backup_lesson_stepslib.php',65],['mod/choice/backup/moodle2','backup_choice_stepslib.php',34],['mod/lesson/backup/moodle2','restore_lesson_stepslib.php',37],['backup/moodle2','backup_stepslib.php',314],['backup/moodle2','backup_stepslib.php',360],['backup/moodle2','backup_stepslib.php',408],['backup/moodle2','backup_stepslib.php',514],['backup/moodle2','backup_stepslib.php',571],['backup/moodle2','backup_stepslib.php',628],['backup/moodle2','backup_stepslib.php',662],['backup/moodle2','backup_stepslib.php',698],['backup/moodle2','backup_stepslib.php',735],['backup/moodle2','backup_stepslib.php',775],['backup/moodle2','backup_stepslib.php',816],['backup/moodle2','backup_stepslib.php',885],['backup/moodle2','backup_stepslib.php',941],['backup/moodle2','backup_stepslib.php',1060],['backup/moodle2','backup_stepslib.php',1118],['backup/moodle2','backup_stepslib.php',1150],['backup/moodle2','backup_stepslib.php',1240],['backup/moodle2','backup_stepslib.php',1402],['backup/moodle2','backup_stepslib.php',1461],['backup/moodle2','backup_stepslib.php',1495],['backup/moodle2','backup_stepslib.php',1529],['backup/moodle2','backup_stepslib.php',1592],['backup/moodle2','backup_stepslib.php',1630],['backup/moodle2','backup_stepslib.php',2050],['backup/moodle2','backup_stepslib.php',2187],['backup/moodle2','backup_stepslib.php',2265],['backup/moodle2','backup_stepslib.php',2357],['backup/moodle2','backup_stepslib.php',2417],['mod/feedback/backup/moodle2','backup_feedback_stepslib.php',33],['mod/assignment/backup/moodle2','restore_assignment_stepslib.php',34],['mod/glossary/backup/moodle2','backup_glossary_stepslib.php',34],['mod/data/backup/moodle2','backup_data_stepslib.php',34],['mod/label/backup/moodle2','restore_label_stepslib.php',34],['mod/page/backup/moodle2','restore_page_stepslib.php',34],['mod/chat/backup/moodle2','backup_chat_stepslib.php',28],['mod/feedback/backup/moodle2','restore_feedback_stepslib.php',33],['mod/assignment/backup/moodle2','backup_assignment_stepslib.php',34],['mod/book/backup/moodle2','backup_book_stepslib.php',32],['blocks/rss_client/backup/moodle2','restore_rss_client_stepslib.php',33],['blocks/rss_client/backup/moodle2','backup_rss_client_stepslib.php',33],['mod/assign/backup/moodle2','backup_assign_stepslib.php',36],['mod/folder/backup/moodle2','backup_folder_stepslib.php',33],['mod/glossary/backup/moodle2','restore_glossary_stepslib.php',34],['mod/survey/backup/moodle2','backup_survey_stepslib.php',34],['mod/quiz/backup/moodle2','restore_quiz_stepslib.php',49],['mod/choice/backup/moodle2','restore_choice_stepslib.php',34],['mod/assign/backup/moodle2','restore_assign_stepslib.php',42],['mod/data/backup/moodle2','restore_data_stepslib.php',34],['mod/scorm/backup/moodle2','backup_scorm_stepslib.php',33],['mod/workshop/backup/moodle2','backup_workshop_stepslib.php',36],['mod/scorm/backup/moodle2','restore_scorm_stepslib.php',33],['mod/url/backup/moodle2','backup_url_stepslib.php',33],['mod/lti/backup/moodle2','backup_lti_stepslib.php',56],['backup/util/plan/tests/fixtures','plan_fixtures.php',83],['mod/quiz/backup/moodle2','backup_quiz_stepslib.php',36],['mod/imscp/backup/moodle2','restore_imscp_stepslib.php',34],['mod/book/backup/moodle2','restore_book_stepslib.php',32],['mod/forum/backup/moodle2','backup_forum_stepslib.php',34],['mod/wiki/backup/moodle2','restore_wiki_stepslib.php',34],['mod/page/backup/moodle2','backup_page_stepslib.php',36],['mod/workshop/backup/moodle2','restore_workshop_stepslib.php',33],['mod/url/backup/moodle2','restore_url_stepslib.php',34],['mod/folder/backup/moodle2','restore_folder_stepslib.php',34],['mod/forum/backup/moodle2','restore_forum_stepslib.php',34],['mod/lti/backup/moodle2','restore_lti_stepslib.php',56],['mod/resource/backup/moodle2','backup_resource_stepslib.php',33],['backup/moodle2','restore_stepslib.php',128],['backup/moodle2','restore_stepslib.php',504],['backup/moodle2','restore_stepslib.php',813],['backup/moodle2','restore_stepslib.php',936],['backup/moodle2','restore_stepslib.php',1071],['backup/moodle2','restore_stepslib.php',1148],['backup/moodle2','restore_stepslib.php',1210],['backup/moodle2','restore_stepslib.php',1315],['backup/moodle2','restore_stepslib.php',1542],['backup/moodle2','restore_stepslib.php',1751],['backup/moodle2','restore_stepslib.php',1906],['backup/moodle2','restore_stepslib.php',2090],['backup/moodle2','restore_stepslib.php',2145],['backup/moodle2','restore_stepslib.php',2228],['backup/moodle2','restore_stepslib.php',2371],['backup/moodle2','restore_stepslib.php',2520],['backup/moodle2','restore_stepslib.php',2775],['backup/moodle2','restore_stepslib.php',2900],['backup/moodle2','restore_stepslib.php',3032],['backup/moodle2','restore_stepslib.php',3186],['backup/moodle2','restore_stepslib.php',3232],['backup/moodle2','restore_stepslib.php',3395],['backup/moodle2','restore_stepslib.php',3621],['backup/moodle2','restore_stepslib.php',3751],['mod/resource/backup/moodle2','restore_resource_stepslib.php',34],['mod/survey/backup/moodle2','restore_survey_stepslib.php',34],['mod/imscp/backup/moodle2','backup_imscp_stepslib.php',35],['mod/wiki/backup/moodle2','backup_wiki_stepslib.php',34],['mod/label/backup/moodle2','backup_label_stepslib.php',33],['mod/chat/backup/moodle2','restore_chat_stepslib.php',33]], 4],
'get_moduleid': ['get_moduleid', '', [['backup/moodle2','backup_activity_task.class.php',75],['backup/moodle2','restore_activity_task.class.php',99],['backup/moodle2','backup_block_task.class.php',88]], 13],
'require_gradebook_backup': ['require_gradebook_backup', 'Returns a flag indicating the need to backup gradebook elements like calculated grade items and category visibility If all activity related grade items are being backed up we can also backup calculated grade items and categories ', [['backup/util/dbops','backup_plan_dbops.class.php',257]], 2],
'annotate_id': ['annotate_id', 'Annotate a single name/id pair. This can be called from {@link enrol_plugin::backup_annotate_custom_fields()}. ', [['backup/moodle2','backup_stepslib.php',1912]], 0],
'get_recordset': ['get_recordset', 'Get a number of records as a moodle_recordset where all the given conditions met. ', [['lib/dml','moodle_database.php',1113]], 95],
'define_subplugin_structure': ['define_subplugin_structure', '', [['backup/moodle2','restore_subplugin.class.php',53],['backup/moodle2','backup_subplugin.class.php',53]], 2],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as a moodle_recordset using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','oci_native_moodle_database.php',1065],['lib/dml','sqlsrv_native_moodle_database.php',761],['lib/dml','mssql_native_moodle_database.php',687],['lib/dml','mysqli_native_moodle_database.php',985],['lib/dml/tests','dml_test.php',5423],['lib/dml','pdo_moodle_database.php',251]], 279],
'skip_cleaning_temp_dir': ['skip_cleaning_temp_dir', '', [['backup/moodle2','backup_stepslib.php',73]], 1],
'is_sqlparam': ['is_sqlparam', 'This function simply marks one param to be considered as straight sql param, so it won\'t be searched in the structure tree nor converted at all. Useful for better integration of definition of sources in structure and DB stuff ', [['backup/util/helper','backup_helper.class.php',356]], 16],
'annotate_ids': ['annotate_ids', '', [['backup/util/structure','backup_nested_element.class.php',246]], 106],
'get_records': ['get_records', 'Get a number of records as an array of objects where all the given conditions met. ', [['lib/dml','moodle_database.php',1236],['lib','coursecatlib.php',654],['question','category_class.php',63]], 860],
'insert_backup_ids_record': ['insert_backup_ids_record', '', [['backup/util/dbops','backup_structure_dbops.class.php',89]], 9],
'get_task': ['get_task', 'As far as activity backup steps are implementing backup_subplugin stuff, they need to have the parent task available for wrapping purposes (get course/context....) ', [['backup/moodle2','backup_stepslib.php',142],['backup/util/plan','backup_structure_step.class.php',118],['backup/util/plan','restore_structure_step.class.php',248],['backup/moodle2','restore_stepslib.php',3693]], 21],
'store_backup_file': ['store_backup_file', 'Given one backupid and the (FS) final generated file, perform its final storage into Moodle file storage. For stored files it returns the complete file_info object ', [['backup/util/helper','backup_helper.class.php',205]], 3],
'prepare_block_structure': ['prepare_block_structure', 'Abstract structure step, parent of all the block structure steps. Used to wrap the block structure definition within the main <block ...> tag ', [['backup/moodle2','backup_stepslib.php',280]], 1],
'sql_concat': ['sql_concat', '', [['lib/dml','pgsql_native_moodle_database.php',1315],['lib/dml','oci_native_moodle_database.php',1550],['lib/dml','sqlsrv_native_moodle_database.php',1257],['lib/dml','sqlite3_pdo_moodle_database.php',353],['lib/dml','mssql_native_moodle_database.php',1194],['lib/dml','mysqli_native_moodle_database.php',1531],['lib/dml/tests','dml_test.php',5433],['lib/dml','pdo_moodle_database.php',536]], 73],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'delete_old_backup_dirs': ['delete_old_backup_dirs', 'Delete all the temp dirs older than the time specified. ', [['backup/util/helper','backup_helper.class.php',150]], 2],
'get_setting_value': ['get_setting_value', 'Gets the value for the requested setting ', [['backup/util/ui','base_ui.class.php',330],['backup/util/plan','base_task.class.php',105],['backup/moodle2','restore_subplugin.class.php',162],['backup/moodle2','backup_subplugin.class.php',68],['backup/util/plan','base_step.class.php',98],['backup/moodle2','restore_plugin.class.php',230],['backup/moodle2','backup_plugin.class.php',68]], 134],
'set_source_table': ['set_source_table', '', [['backup/util/structure','backup_nested_element.class.php',196]], 158],
'process': ['process', '', [['backup/util/xml/tests','writer_test.php',320],['lib/minify/lib/Minify/CSS','Compressor.php',23],['lib/minify/lib/Minify','ImportProcessor.php',25],['backup/util/ui','base_ui.class.php',119],['backup/moodle2','backup_xml_transformer.class.php',60],['lib/google/src/Google/Http','MediaFileUpload.php',191],['lib/yuilib/3.17.2/datatable-base','datatable-base.js',370],['backup/util/xml/parser','progressive_parser.class.php',145],['grade/report/singleview/classes/local/screen','grade.php',301],['backup/util/ui','restore_ui.class.php',124],['lib/yuilib/3.17.2/datatable-table','datatable-table-debug.js',412],['backup/util/structure','backup_optigroup_element.class.php',110],['backup/util/structure','backup_attribute.class.php',34],['lib/minify/lib/Minify','HTML.php',87],['backup/util/structure','backup_optigroup.class.php',59],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',16782],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',16881],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',17049],['lib/yuilib/3.17.2/datatable-core','datatable-core-debug.js',663],['lib/yuilib/3.17.2/datatable-core','datatable-core-debug.js',758],['backup/util/loggers','base_logger.class.php',91],['lib/yuilib/3.17.2/datatable-core','datatable-core.js',663],['lib/yuilib/3.17.2/datatable-core','datatable-core.js',756],['lib/yuilib/3.17.2/datatable-base','datatable-base-debug.js',370],['backup/util/ui','restore_ui_stage.class.php',285],['backup/util/ui','restore_ui_stage.class.php',469],['backup/util/ui','restore_ui_stage.class.php',602],['backup/util/ui','restore_ui_stage.class.php',714],['backup/util/ui','restore_ui_stage.class.php',862],['backup/util/ui','restore_ui_stage.class.php',968],['backup/converter/moodle1','lib.php',781],['lib/jabber/XMPP','XMLStream.php',431],['backup/util/structure','backup_nested_element.class.php',66],['backup/moodle2','backup_custom_fields.php',94],['backup/util/helper','restore_log_rule.class.php',100],['lib/google/src/Google/Service','MapsEngine.php',1826],['lib/google/src/Google/Service','MapsEngine.php',2435],['lib/google/src/Google/Service','MapsEngine.php',2740],['lib/google/src/Google/Service','MapsEngine.php',3003],['course','dnduploadlib.php',449],['grade/report/singleview/classes/local/screen','user.php',333],['backup/util/ui','backup_ui_stage.class.php',89],['backup/util/ui','backup_ui_stage.class.php',244],['backup/util/ui','backup_ui_stage.class.php',397],['backup/util/ui','backup_ui_stage.class.php',526],['enrol/manual','locallib.php',184],['enrol/manual','locallib.php',342],['grade/report/singleview/classes/local/screen','screen.php',260],['admin/tool/log/classes/log','manager.php',76],['lib/pear/HTML','QuickForm.php',1595],['backup/converter/moodle1','handlerlib.php',562],['lib/yuilib/3.17.2/datatable-table','datatable-table.js',412],['lib/minify/lib/Minify','CommentPreserver.php',29],['lib','csslib.php',589],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/paste','editor_plugin_src.js',79],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/paste','editor_plugin_src.js',348],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/paste','editor_plugin_src.js',768],['backup/util/plan','restore_structure_step.class.php',117],['backup/util/helper','restore_decode_content.class.php',63],['lib/classes/message/inbound','address_manager.php',285],['backup/util/structure','backup_final_element.class.php',34],['message/tests','inbound_test.php',641],['backup/util/interfaces','processable.class.php',35]], 348],
'annotations_exist': ['annotations_exist', 'Returns true/false if there are annotations for a given item ', [['backup/util/dbops','backup_structure_dbops.class.php',178]], 1],
'execute_condition': ['execute_condition', 'Skip enrolments on the front page. ', [['backup/moodle2','backup_stepslib.php',506],['backup/moodle2','backup_stepslib.php',808],['backup/moodle2','backup_stepslib.php',927],['backup/moodle2','backup_stepslib.php',1045],['backup/moodle2','backup_stepslib.php',1110],['backup/moodle2','backup_stepslib.php',2174],['backup/moodle2','backup_stepslib.php',2257],['backup/moodle2','backup_stepslib.php',2349],['backup/moodle2','backup_stepslib.php',2403],['backup/util/plan','backup_structure_step.class.php',165],['backup/util/plan','restore_structure_step.class.php',454],['backup/moodle2','restore_stepslib.php',83],['backup/moodle2','restore_stepslib.php',468],['backup/moodle2','restore_stepslib.php',1880],['backup/moodle2','restore_stepslib.php',2186],['backup/moodle2','restore_stepslib.php',2464],['backup/moodle2','restore_stepslib.php',2753],['backup/moodle2','restore_stepslib.php',2881],['backup/moodle2','restore_stepslib.php',3024],['backup/moodle2','restore_stepslib.php',3169],['backup/moodle2','restore_stepslib.php',3591]], 2],
'end_progress': ['end_progress', 'Marks the end of an operation that will display progress. ', [['lib/classes/progress','base.php',129]], 69],
'course_get_format': ['course_get_format', 'Returns an instance of format class (extending format_base) for given course ', [['course/format','lib.php',27]], 88],
'get_blockname': ['get_blockname', '', [['backup/moodle2','restore_block_task.class.php',109],['lib/testing/generator','block_generator.php',51],['backup/moodle2','backup_block_task.class.php',84]], 6],
'get_progress': ['get_progress', 'Gets the progress reporter, which can be used to report progress within the backup or restore process. ', [['backup/util/plan','base_task.class.php',125],['backup/util/plan','backup_plan.class.php',90],['backup/controller','base_controller.class.php',36],['backup/util/plan','restore_plan.class.php',97],['backup/util/plan/tests/fixtures','plan_fixtures.php',38]], 35],
'get_final_element': ['get_final_element', '', [['backup/util/structure','base_nested_element.class.php',119]], 7],
'add_child': ['add_child', '', [['backup/util/structure','backup_optigroup.class.php',47],['backup/util/structure','base_nested_element.class.php',166]], 396],
'add_subplugin_structure': ['add_subplugin_structure', 'Add subplugin structure to any element in the activity backup tree ', [['backup/moodle2','backup_stepslib.php',99],['backup/moodle2','restore_stepslib.php',3659]], 26],
'add_plugin_structure': ['add_plugin_structure', 'Add plugin structure to any element in the structure backup tree ', [['backup/util/plan','backup_structure_step.class.php',128],['backup/util/plan','restore_structure_step.class.php',259]], 38],
'get_file_packer': ['get_file_packer', 'Returns file packer ', [['lib','moodlelib.php',6004]], 58],
'get_backup_information_from_mbz': ['get_backup_information_from_mbz', 'Load and format all the needed information from a backup file. ', [['backup/util/helper','backup_general_helper.class.php',243]], 3],
'delete_backup_dir': ['delete_backup_dir', 'Given one backupid, delete completely its temp dir ', [['backup/util/helper','backup_helper.class.php',59]], 3],
'is_excluding_activities': ['is_excluding_activities', '', [['backup/util/plan','restore_task.class.php',70],['backup/util/plan','backup_plan.class.php',100],['backup/util/plan','restore_plan.class.php',131],['backup/util/plan','backup_task.class.php',46]], 8],
'fetch_all': ['fetch_all', 'Finds and returns all grade_object instances based on $params. ', [['lib/grade','grade_object.php',138],['lib/grade','grade_item.php',343],['completion/criteria','completion_criteria.php',153],['completion','data_object.php',165],['completion','completion_criteria_completion.php',84],['lib/grade','grade_grade.php',586],['lib/grade','grade_category.php',194],['lib/grade','grade_scale.php',100],['completion','completion_aggregation.php',79],['lib/grade','grade_outcome.php',193]], 65],
'get_basepath': ['get_basepath', '', [['backup/util/plan','base_task.class.php',113],['backup/util/plan','backup_plan.class.php',82],['backup/util/plan','base_step.class.php',112],['backup/util/plan','restore_plan.class.php',89]], 36],
'get_site_identifier': ['get_site_identifier', 'Returns the site identifier ', [['lib','moodlelib.php',9062],['cache/tests/fixtures','lib.php',282],['cache/classes','config.php',309],['cache/classes','helper.php',616]], 9],
'get_contextid': ['get_contextid', '', [['backup/moodle2','backup_activity_task.class.php',103],['backup/moodle2','restore_activity_task.class.php',115],['backup/moodle2','restore_course_task.class.php',57],['backup/converter/moodle1','lib.php',524],['backup/moodle2','restore_block_task.class.php',133],['lib/filestorage','stored_file.php',652],['lib/filebrowser','virtual_root_file.php',182],['backup/moodle2','backup_course_task.class.php',50],['backup/moodle2','restore_section_task.class.php',63],['backup/moodle2','backup_block_task.class.php',96]], 109],
'get_name': ['get_name', 'Return localised event name. ', [['report/log/classes/event','user_report_viewed.php',54],['mod/wiki/classes/event','page_deleted.php',54],['mod/forum/classes/message/inbound','reply_handler.php',50],['mod/chat/classes/event','sessions_viewed.php',65],['mod/glossary/classes/event','category_deleted.php',46],['mod/workshop/classes/event','assessment_evaluations_reset.php',75],['lib/classes/event','tag_updated.php',58],['lib/classes/event','course_resources_list_viewed.php',60],['mod/lesson/classes/event','content_page_viewed.php',48],['lib/classes/event','blog_association_created.php',56],['lib/classes/event','user_profile_viewed.php',56],['mod/feedback/classes/event','response_submitted.php',60],['backup/util/plan','base_plan.class.php',50],['lib/classes/event','badge_awarded.php',54],['report/outline/classes/event','report_viewed.php',54],['question/classes/bank','checkbox_column.php',32],['mod/assign/classes/event','extension_granted.php',77],['admin/tool/capability/classes/event','report_viewed.php',47],['portfolio/picasa','lib.php',33],['lib/classes/event','message_viewed.php',54],['lib/classes/event','course_category_created.php',48],['mod/quiz/classes/event','group_override_updated.php',54],['lib/classes/task','context_cleanup_task.php',32],['mod/survey/classes/event','response_submitted.php',53],['mod/book/tool/exportimscp/classes/event','book_exported.php',76],['cache/classes','definition.php',604],['report/loglive/classes/event','report_viewed.php',48],['mod/forum/classes/event','post_deleted.php',67],['mod/assign/classes/event','submission_duplicated.php',77],['mod/chat/classes/event','message_sent.php',59],['mod/workshop/classes/event','submission_created.php',63],['lib/classes/event','note_updated.php',56],['mod/lesson/classes/event','group_override_deleted.php',54],['mod/feedback/classes/event','response_deleted.php',57],['lib/classes/event','course_module_instance_list_viewed.php',75],['mod/assign/classes/event','submission_locked.php',78],['enrol/imsenterprise/classes/task','cron_task.php',34],['mod/lesson/classes/event','page_updated.php',72],['admin/tool/messageinbound/classes/task','cleanup_task.php',38],['mod/forum/classes/event','discussion_subscription_deleted.php',66],['mod/quiz/classes/event','attempt_preview_started.php',54],['mod/assign/classes/event','batch_set_workflow_state_viewed.php',79],['mod/lesson/classes/event','user_override_updated.php',54],['lib/classes/task','calendar_cron_task.php',31],['mod/quiz/classes/event','report_viewed.php',56],['mod/lesson/classes/event','question_answered.php',54],['lib/portfolio','plugin.php',120],['mod/forum/classes/event','discussion_viewed.php',60],['mod/workshop/classes/event','submission_viewed.php',63],['lib/classes/task','registration_cron_task.php',31],['mod/assign/submission/file','locallib.php',44],['mod/assign/classes/event','submission_updated.php',57],['mod/workshop/classes/event','submission_reassessed.php',77],['mod/glossary/classes/event','entry_deleted.php',54],['lib/classes/task','portfolio_cron_task.php',31],['lib/classes/event','user_created.php',48],['question/classes/bank','preview_action_column.php',26],['mod/data/classes/event','field_updated.php',57],['mod/assign/submission/onlinetext','locallib.php',40],['mod/data/classes/event','template_updated.php',56],['lib/classes/event','comment_created.php',58],['lib/classes/event','cohort_deleted.php',49],['lib/grade','grade_item.php',1274],['mod/scorm/classes/event','tracks_viewed.php',64],['lib/classes/task','file_temp_cleanup_task.php',31],['lib/classes/event','course_viewed.php',75],['grade/report/overview/classes/event','grade_report_viewed.php',48],['lib/classes/task','stats_cron_task.php',31],['grade/report/user/classes/event','grade_report_viewed.php',48],['lib/classes/event','course_content_deleted.php',54],['lib/classes/task','backup_cleanup_task.php',31],['grade/report/singleview/classes/event','grade_report_viewed.php',39],['mod/quiz/classes/event','attempt_abandoned.php',63],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',31],['mod/workshop/classes/event','phase_switched.php',75],['lib/classes/event','base.php',282],['grade/report/history/classes/event','grade_report_viewed.php',39],['lib/classes/event','content_viewed.php',80],['backup/util/ui','backup_ui.class.php',194],['lib/classes/event','course_completion_updated.php',47],['report/completion/classes/event','report_viewed.php',49],['lib/dml','pgsql_native_moodle_database.php',88],['backup/util/settings','base_setting.class.php',145],['lib/classes/task','messaging_cleanup_task.php',31],['question/classes/bank','modifier_name_column.php',27],['mod/forum/classes/event','discussion_updated.php',65],['lib/classes/event','course_reset_ended.php',53],['mod/choice/classes/event','answer_submitted.php',72],['mod/forum/classes/event','assessable_uploaded.php',86],['mod/wiki/classes/event','page_diff_viewed.php',55],['lib/classes/event','course_category_updated.php',51],['admin/tool/langimport/classes/event','langpack_updated.php',80],['lib/classes/task','session_cleanup_task.php',31],['lib/classes/task','completion_cron_task.php',31],['lib/classes/event','webservice_service_created.php',65],['lib/classes/event','course_created.php',55],['lib/dml','oci_native_moodle_database.php',94],['mod/lesson/classes/event','lesson_started.php',48],['mod/assign/classes/event','grading_table_viewed.php',79],['lib/classes/event','calendar_event_deleted.php',58],['backup/util/plan','base_task.class.php',58],['lib/classes/event','group_created.php',65],['mod/quiz/classes/event','user_override_created.php',53],['mod/glossary/classes/event','category_updated.php',46],['repository/coursefiles','lib.php',183],['mod/assign/classes/event','submission_viewed.php',76],['mod/glossary/classes/event','entry_disapproved.php',46],['lib/classes/event','user_password_updated.php',70],['mod/assign/classes/event','all_submissions_downloaded.php',75],['lib/dml','mariadb_native_moodle_database.php',41],['lib/classes/event','role_deleted.php',55],['admin/tool/log/store/legacy/tests/fixtures','event.php',31],['backup/util/ui','restore_ui.class.php',349],['lib/classes/event','user_loggedinas.php',57],['mod/assign/classes/event','submission_confirmation_form_viewed.php',79],['mod/assign/tests/fixtures','event_mod_assign_fixtures.php',62],['lib','modinfolib.php',1285],['mod/lesson/classes/event','essay_attempt_viewed.php',48],['mod/forum/classes/event','discussion_moved.php',66],['mod/assign/submission/onlinetext/classes/event','assessable_uploaded.php',83],['mod/assign/classes/event','reveal_identities_confirmation_page_viewed.php',79],['mod/survey/classes/event','report_downloaded.php',55],['mod/wiki/classes/event','page_updated.php',54],['admin/tool/log/store/standard/tests/fixtures','event.php',31],['mod/assign/classes/event','submission_unlocked.php',78],['lib/classes/event','user_list_viewed.php',56],['mod/forum/classes/event','readtracking_disabled.php',64],['lib/classes/event','comments_viewed.php',51],['lib/classes/event','cohort_member_added.php',49],['lib/classes/event','grouping_created.php',65],['lib/classes/event','recent_activity_viewed.php',49],['lib/classes/event','role_allow_switch_updated.php',47],['lib/dml','sqlsrv_native_moodle_database.php',102],['admin/tool/messageinbound/classes/message/inbound','invalid_recipient_handler.php',60],['mod/lti','OAuth.php',122],['mod/lti','OAuth.php',149],['mod/lti','OAuth.php',173],['question/classes/bank','question_name_column.php',28],['lib/classes/event','user_login_failed.php',56],['lib/classes/event','message_contact_added.php',48],['lib','enrollib.php',1075],['question/classes/bank','question_text_row.php',35],['lib/classes/event','role_allow_assign_updated.php',47],['mod/quiz/classes/event','user_override_deleted.php',53],['user/selector','lib.php',309],['mod/quiz/classes/event','edit_page_viewed.php',53],['lib/classes/event','email_failed.php',48],['portfolio/flickr','lib.php',41],['admin/tool/langimport/classes/task','update_langpacks_task.php',35],['lib/classes/event','tag_removed.php',58],['mod/lesson/classes/event','highscores_viewed.php',48],['report/stats/classes/event','user_report_viewed.php',48],['mod/quiz/classes/event','group_override_deleted.php',54],['mod/book/classes/event','chapter_updated.php',79],['lib/classes/log','reader.php',30],['mod/lesson/classes/event','question_viewed.php',54],['mod/scorm/classes/event','interactions_viewed.php',63],['lib/classes/event','course_module_updated.php',57],['mod/forum/classes/event','discussion_subscription_created.php',66],['lib/classes/task','plagiarism_cron_task.php',31],['mod/quiz/classes/event','question_manually_graded.php',55],['lib/classes/event','mnet_access_control_created.php',57],['lib/classes/event','role_assigned.php',56],['admin/tool/messageinbound/classes/task','pickup_task.php',38],['mod/lti/classes/local/ltiservice','service_base.php',87],['lib/classes/event','unknown_logged.php',43],['lib/simplepie/library/SimplePie','Author.php',106],['mod/scorm/classes/event','user_report_viewed.php',62],['admin/tool/monitor/classes/event','subscription_criteria_met.php',55],['mod/forum/classes/task','cron_task.php',30],['report/participation/classes/event','report_viewed.php',58],['lib/classes/event','user_updated.php',48],['backup/util/plan','base_step.class.php',49],['lib/classes/event','course_section_updated.php',56],['lib/classes/event','comment_deleted.php',58],['mod/assign/classes/event','marker_updated.php',89],['lib/classes/event','webservice_login_failed.php',71],['mod/assign/submission/file/classes/event','assessable_uploaded.php',85],['admin/tool/log/store/database/tests/fixtures','event.php',31],['mod/lti/classes/event','unknown_service_api_called.php',82],['lib/classes/event','cohort_updated.php',49],['mod/assign/submission/comments','locallib.php',39],['lib/editor/tinymce/classes','plugin.php',101],['mod/forum/classes/event','post_updated.php',67],['mod/book/classes/event','chapter_viewed.php',79],['portfolio/download','lib.php',9],['lib/classes/event','note_deleted.php',56],['lib/classes/event','user_loggedout.php',54],['lib/classes/event','grade_report_viewed.php',54],['lib/classes/task','file_trash_cleanup_task.php',31],['mod/assign/classes/event','workflow_state_updated.php',88],['mod/book/classes/event','chapter_deleted.php',79],['lib/classes/event','course_deleted.php',56],['lib/classes/event','blog_entry_deleted.php',53],['admin/tool/log/store/legacy/classes/event','legacy_logged.php',35],['question/classes/bank','copy_action_column.php',35],['mod/assign/feedback/editpdf','locallib.php',43],['lib/classes/event','webservice_token_created.php',65],['lib/tests/fixtures','task_fixtures.php',35],['lib/tests/fixtures','task_fixtures.php',44],['lib/tests/fixtures','task_fixtures.php',53],['mod/forum/classes/event','course_searched.php',66],['lib/classes/event','group_updated.php',65],['mod/quiz/classes/event','attempt_started.php',56],['mod/lesson/classes/event','group_override_updated.php',54],['lib/classes/event','course_module_viewed.php',62],['lib/classes/event','mnet_access_control_updated.php',57],['mod/quiz/classes/question/bank','add_action_column.php',45],['question/classes/bank','edit_action_column.php',35],['lib/classes/message/inbound','private_files_handler.php',56],['lib/tests/fixtures','event_fixtures.php',34],['lib/classes/task','password_reset_cleanup_task.php',31],['mod/quiz/classes/event','attempt_submitted.php',63],['mod/data/classes/event','field_created.php',58],['lib/classes/task','automated_backup_task.php',31],['lib/classes/event','question_category_created.php',48],['admin/tool/monitor/classes/event','rule_deleted.php',50],['backup/util/ui','restore_ui_stage.class.php',75],['backup/converter/moodle1','lib.php',1033],['mod/lesson/classes/event','group_override_created.php',55],['mod/workshop/classes/event','assessments_reset.php',74],['mod/lesson/classes/event','lesson_resumed.php',48],['mod/assign/classes/event','feedback_viewed.php',76],['grade/report/outcomes/classes/event','grade_report_viewed.php',39],['lib/classes/event','blog_entry_updated.php',74],['report/questioninstances/classes/event','report_viewed.php',55],['mod/assign/classes/event','submission_form_viewed.php',82],['mod/folder/classes/event','folder_updated.php',48],['mod/assign/classes/event','submission_created.php',57],['mod/assign/classes/event','statement_accepted.php',77],['lib/classes/event','grade_deleted.php',94],['lib/classes/event','role_capabilities_updated.php',51],['lib/classes/event','blog_entries_viewed.php',62],['lib/tests','messageinbound_test.php',170],['mod/wiki/classes/event','page_viewed.php',48],['lib/classes/event','group_deleted.php',65],['question/classes/bank','delete_action_column.php',36],['lib/classes/event','webservice_token_sent.php',56],['mod/quiz/classes/event','attempt_becameoverdue.php',66],['lib/classes/task','create_contexts_task.php',31],['mod/quiz/classes/event','attempt_viewed.php',54],['mod/assign/classes/event','submission_status_updated.php',79],['mod/assign/classes/event','grading_form_viewed.php',82],['calendar/tests','calendartype_test_example.php',32],['lib/classes/event','course_module_completion_updated.php',48],['mod/assign/feedback/file','locallib.php',45],['mod/workshop/classes/event','assessment_evaluated.php',66],['report/log/classes/event','report_viewed.php',58],['lib/classes/event','course_module_deleted.php',56],['lib/dml','mssql_native_moodle_database.php',83],['repository','lib.php',1884],['mod/book/classes/event','chapter_created.php',79],['mod/quiz/classes/question/bank','question_name_text_column.php',37],['mod/workshop/classes/event','submission_assessed.php',76],['lib/classes/event','cohort_created.php',49],['lib/classes/event','webservice_function_called.php',67],['mod/scorm/classes/event','sco_launched.php',64],['lib/classes/event','blog_entry_created.php',76],['lib/classes/event','user_enrolment_created.php',53],['mod/data/classes/event','record_created.php',56],['mod/quiz/classes/event','attempt_summary_viewed.php',56],['lib/classes/event','user_enrolment_updated.php',53],['admin/tool/log/store/standard/classes/task','cleanup_task.php',31],['mod/quiz/classes/event','attempt_reviewed.php',53],['lib/classes/task','cache_cleanup_task.php',31],['mod/lesson/classes/event','page_moved.php',56],['mod/glossary/classes/event','category_created.php',46],['mod/lesson/classes/event','page_created.php',54],['lib/classes/event','cohort_member_removed.php',50],['grade/report/singleview/classes/local/ui','unique_name.php',38],['mod/wiki/classes/event','page_version_viewed.php',54],['lib/classes/task','badges_cron_task.php',31],['lib/classes/event','role_allow_override_updated.php',47],['lib/classes/task','cache_cron_task.php',31],['mod/workshop/classes/event','assessable_uploaded.php',93],['lib/classes/event','grouping_updated.php',65],['admin/tool/monitor/classes/event','rule_updated.php',50],['lib/classes/event','course_module_created.php',86],['lib/classes/event','tag_added.php',58],['admin/tool/langimport/classes/event','langpack_removed.php',89],['mod/assign/classes/event','assessable_submitted.php',109],['mod/workshop/classes/event','submission_updated.php',63],['mod/lesson/classes/event','page_deleted.php',54],['lib/classes/event','grouping_deleted.php',72],['backup/util/ui','backup_ui_setting.class.php',86],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',56],['backup/converter','convertlib.php',109],['lib/classes/event','tag_flagged.php',55],['mod/wiki/classes/event','page_history_viewed.php',48],['lib/classes/task','question_cron_task.php',31],['mod/survey/classes/event','report_viewed.php',55],['lib/classes/event','tag_created.php',55],['report/stats/classes/event','report_viewed.php',56],['lib/classes/event','note_created.php',56],['lib/simplepie/library/SimplePie','Credit.php',139],['lib/bennu','iCalendar_components.php',37],['lib/dml','mysqli_native_moodle_database.php',352],['lib/classes/event','course_reset_started.php',53],['admin/tool/monitor/classes/event','subscription_created.php',50],['mod/book/tool/print/classes/event','book_printed.php',76],['lib/classes/event','webservice_service_user_removed.php',59],['mod/data/classes/event','record_deleted.php',56],['mod/choice/classes/event','answer_updated.php',72],['message/tests/fixtures','inbound_fixtures.php',41],['lib/classes/event','group_member_removed.php',69],['mod/glossary/classes/event','entry_viewed.php',48],['mod/forum/classes/event','user_report_viewed.php',65],['lib/classes/event','course_category_deleted.php',59],['lib/classes/task','events_cron_task.php',31],['mod/forum/classes/event','subscription_created.php',65],['lib/classes/event','calendar_event_created.php',58],['lib/classes/event','message_contact_blocked.php',48],['lib/classes/event','webservice_service_updated.php',59],['backup/util/ui','base_ui_stage.class.php',110],['mod/wiki/classes/event','page_version_restored.php',54],['lib/classes/task','delete_unconfirmed_users_task.php',31],['mod/data/classes/event','template_viewed.php',55],['lib/classes/event','course_user_report_viewed.php',66],['mod/data/classes/event','record_updated.php',56],['mod/wiki/classes/event','page_map_viewed.php',54],['mod/wiki/classes/event','page_locks_deleted.php',54],['lib/classes/event','webservice_service_deleted.php',59],['lib/grade','grade_category.php',2128],['mod/forum/classes/event','readtracking_enabled.php',64],['mod/assign/feedback/comments','locallib.php',36],['question/behaviour','behaviourbase.php',83],['calendar/type/gregorian/classes','structure.php',29],['lib/classes/event','role_unassigned.php',53],['lib/classes/task','tag_cron_task.php',31],['lib/classes/task','blog_cron_task.php',31],['lib/classes/event','course_restored.php',58],['backup/util/structure','base_atom.class.php',71],['portfolio/boxnet','lib.php',14],['mod/choice/classes/event','report_viewed.php',47],['lib/classes/event','user_deleted.php',57],['lib/classes/event','user_enrolment_deleted.php',54],['lib/classes/task','send_failed_login_notifications_task.php',34],['mod/book/tool/print/classes/event','chapter_printed.php',79],['mod/assign/classes/event','identities_revealed.php',75],['lib/classes/event','user_graded.php',96],['lib/classes/event','course_updated.php',58],['admin/tool/log/classes/helper','reader.php',41],['mod/forum/classes/event','post_created.php',67],['mod/data/classes/event','field_deleted.php',57],['lib/classes/event','tag_deleted.php',55],['mod/glossary/classes/event','entry_created.php',52],['mod/forum/classes/event','discussion_created.php',65],['mod/forum/classes/event','discussion_deleted.php',66],['mod/scorm/classes/event','attempt_deleted.php',62],['mod/lesson/classes/event','lesson_ended.php',49],['lib/grade','grade_scale.php',156],['admin/tool/monitor/classes','subscription.php',123],['mod/forum/classes/event','subscribers_viewed.php',65],['backup/util/structure','restore_path_element.class.php',98],['mod/scorm/classes/event','report_viewed.php',63],['lib/classes/task','grade_cron_task.php',31],['grade/report/grader/classes/event','grade_report_viewed.php',39],['lib/dml/tests','dml_test.php',5409],['mod/lesson/classes/event','user_override_deleted.php',53],['report/completion/classes/event','user_report_viewed.php',49],['admin/tool/langimport/classes/event','langpack_imported.php',80],['mod/forum/classes/event','subscription_deleted.php',65],['mod/assign/feedback/offline','locallib.php',42],['mod/lesson/classes/event','highscore_added.php',56],['mod/lesson/classes/event','essay_assessed.php',78],['lib/classes/event','message_sent.php',82],['lib/classes/event','message_contact_removed.php',48],['lib/classes/event','tag_unflagged.php',55],['mod/assign/classes/event','submission_graded.php',78],['lib','csslib.php',2155],['lib','csslib.php',2283],['mod/assign/classes/event','batch_set_marker_allocation_viewed.php',79],['report/outline/classes/event','activity_report_viewed.php',48],['lib/classes/event','calendar_event_updated.php',58],['mod/lesson/classes/event','user_override_created.php',53],['lib/classes/task','legacy_plugin_cron_task.php',33],['portfolio/googledocs','lib.php',54],['mod/workshop/classes/event','assessment_reevaluated.php',76],['lib/dml','pdo_moodle_database.php',113],['lib','medialib.php',345],['mod/quiz/classes/event','user_override_updated.php',54],['lib/classes/event','webservice_service_user_added.php',59],['admin/tool/monitor/classes/event','subscription_deleted.php',50],['lib/classes/event','notes_viewed.php',49],['mod/glossary/classes/event','entry_updated.php',52],['admin/tool/monitor/classes/event','rule_created.php',50],['lib/classes/task','check_for_updates_task.php',31],['mod/wiki/classes/event','page_version_deleted.php',54],['lib/classes/event','course_completed.php',73],['mod/assign/classes/event','submission_status_viewed.php',81],['portfolio/mahara','lib.php',61],['mod/glossary/classes/event','entry_approved.php',46],['mod/wiki/classes/event','page_created.php',48],['mod/quiz/classes/event','group_override_created.php',55],['lib/classes/task','delete_incomplete_users_task.php',31],['question/classes/bank','creator_name_column.php',28],['lib/classes/event','group_member_added.php',78],['lib/classes/event','message_contact_unblocked.php',48],['mod/quiz/classes/event','attempt_deleted.php',47],['lib/classes/task','send_new_user_passwords_task.php',31],['lib/classes/event','user_loggedin.php',64],['admin/tool/monitor/classes/task','clean_events.php',32],['question/classes/bank','question_type_column.php',26],['admin/tool/monitor/classes','rule.php',239],['mod/lesson/classes/event','lesson_restarted.php',48],['lib/grade','grade_outcome.php',272]], 409],
'move_annotations_to_final': ['move_annotations_to_final', 'Moves all the existing \'item\' annotations to their final \'itemfinal\' ones for a given backup. ', [['backup/util/dbops','backup_structure_dbops.class.php',150]], 1],
'get_taskbasepath': ['get_taskbasepath', '', [['backup/moodle2','backup_activity_task.class.php',110],['backup/util/plan','base_task.class.php',117],['backup/moodle2','restore_activity_task.class.php',64],['backup/moodle2','restore_course_task.class.php',49],['backup/moodle2','restore_block_task.class.php',58],['backup/util/plan/tests/fixtures','plan_fixtures.php',72],['backup/moodle2','backup_course_task.class.php',54],['backup/moodle2','restore_section_task.class.php',51],['backup/moodle2','backup_block_task.class.php',104],['backup/moodle2','backup_section_task.class.php',60]], 17],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 1891],
'backup_includes_file_references': ['backup_includes_file_references', 'Given the backupid, detect if the backup contains references to external contents ', [['backup/util/dbops','backup_controller_dbops.class.php',499]], 2],
'get_inforef_itemnames': ['get_inforef_itemnames', 'This function returns one array of itemnames that are being handled by inforef.xml files. Used both by backup and restore ', [['backup/util/helper','backup_helper.class.php',366]], 3],
'set_source_alias': ['set_source_alias', '', [['backup/util/structure','backup_nested_element.class.php',217]], 19],
'get_components_and_fileareas': ['get_components_and_fileareas', 'Returns all the components and fileareas used by all the installed qtypes ', [['backup/moodle2','backup_qtype_plugin.class.php',163]], 2],
'define_execution': ['define_execution', '', [['backup/moodle2','backup_stepslib.php',35],['backup/moodle2','backup_stepslib.php',57],['backup/moodle2','backup_stepslib.php',83],['backup/moodle2','backup_stepslib.php',264],['backup/moodle2','backup_stepslib.php',275],['backup/moodle2','backup_stepslib.php',1567],['backup/moodle2','backup_stepslib.php',1753],['backup/moodle2','backup_stepslib.php',1844],['backup/moodle2','backup_stepslib.php',1869],['backup/moodle2','backup_stepslib.php',1894],['backup/moodle2','backup_stepslib.php',1929],['backup/moodle2','backup_stepslib.php',1955],['backup/moodle2','backup_stepslib.php',1978],['backup/moodle2','backup_stepslib.php',2005],['backup/moodle2','backup_stepslib.php',2138],['backup/converter/imscc11','backuplib.php',59],['backup/converter/imscc11','backuplib.php',109],['backup/converter/imscc11','backuplib.php',135],['backup/moodle2','restore_stepslib.php',35],['backup/moodle2','restore_stepslib.php',65],['backup/moodle2','restore_stepslib.php',549],['backup/moodle2','restore_stepslib.php',564],['backup/moodle2','restore_stepslib.php',596],['backup/moodle2','restore_stepslib.php',612],['backup/moodle2','restore_stepslib.php',649],['backup/moodle2','restore_stepslib.php',729],['backup/moodle2','restore_stepslib.php',784],['backup/moodle2','restore_stepslib.php',856],['backup/moodle2','restore_stepslib.php',880],['backup/moodle2','restore_stepslib.php',903],['backup/moodle2','restore_stepslib.php',922],['backup/moodle2','restore_stepslib.php',1281],['backup/moodle2','restore_stepslib.php',1300],['backup/moodle2','restore_stepslib.php',1720],['backup/moodle2','restore_stepslib.php',1847],['backup/moodle2','restore_stepslib.php',2038],['backup/moodle2','restore_stepslib.php',4006],['backup/moodle2','restore_stepslib.php',4041],['backup/moodle2','restore_stepslib.php',4161]], 4],
'get_configdata_encoded_attributes': ['get_configdata_encoded_attributes', '', [['blocks/html/backup/moodle2','backup_html_block_task.class.php',42],['blocks/html/backup/moodle2','restore_html_block_task.class.php',42],['backup/moodle2','backup_default_block_task.class.php',50],['blocks/activity_results/backup/moodle2','restore_activity_results_block_task.class.php',55],['blocks/rss_client/backup/moodle2','restore_rss_client_block_task.class.php',46],['backup/moodle2','restore_default_block_task.class.php',49],['blocks/quiz_results/backup/moodle2','restore_quiz_results_block_task.class.php',46],['blocks/glossary_random/backup/moodle2','restore_glossary_random_block_task.class.php',42],['blocks/rss_client/backup/moodle2','backup_rss_client_block_task.class.php',46]], 4],
'plugin_supports': ['plugin_supports', 'Checks whether a plugin supports a specified feature. ', [['lib','moodlelib.php',7193]], 59],
'get_directory_list': ['get_directory_list', 'Returns an array with all the filenames in all subdirectories, relative to the given rootdir. ', [['lib','moodlelib.php',6225]], 6],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'set_source_sql': ['set_source_sql', '', [['backup/util/structure','backup_nested_element.class.php',208]], 46],
'drop_backup_ids_temp_table': ['drop_backup_ids_temp_table', '', [['backup/util/dbops','backup_controller_dbops.class.php',158]], 5],
'progress': ['progress', 'Implementation for file_progress interface to display unzip progress. ', [['backup/moodle2','backup_stepslib.php',1817],['backup/util/ui','restore_ui_stage.class.php',334],['lib/filestorage/tests','zip_packer_test.php',520],['lib/filestorage','file_progress.php',35],['lib/classes/progress','base.php',157],['lib/filestorage/tests','tgz_packer_test.php',422]], 111],
'add_final_elements': ['add_final_elements', 'Adding final elements is forbidden ', [['backup/util/structure','base_optigroup.class.php',89],['backup/util/structure','base_nested_element.class.php',143]], 4],
'get_fileareas': ['get_fileareas', '', [['blocks/html/backup/moodle2','backup_html_block_task.class.php',38],['blocks/html/backup/moodle2','restore_html_block_task.class.php',38],['backup/moodle2','backup_default_block_task.class.php',46],['blocks/activity_results/backup/moodle2','restore_activity_results_block_task.class.php',48],['blocks/rss_client/backup/moodle2','restore_rss_client_block_task.class.php',42],['backup/moodle2','restore_default_block_task.class.php',45],['blocks/quiz_results/backup/moodle2','restore_quiz_results_block_task.class.php',42],['blocks/glossary_random/backup/moodle2','restore_glossary_random_block_task.class.php',38],['blocks/rss_client/backup/moodle2','backup_rss_client_block_task.class.php',42]], 4],
'get_backupid': ['get_backupid', 'Gets the backup id from the controller ', [['backup/util/ui','backup_ui.class.php',114],['backup/util/plan','backup_plan.class.php',66],['backup/util/plan','backup_step.class.php',42],['backup/util/ui','backup_ui_stage.class.php',53],['backup/util/plan','backup_task.class.php',42],['backup/controller','backup_controller.class.php',238]], 68],
'backup_annotate_custom_fields': ['backup_annotate_custom_fields', 'Backup execution step hook to annotate custom fields. ', [['lib','enrollib.php',2281]], 1],
'get_blockid': ['get_blockid', '', [['backup/moodle2','restore_block_task.class.php',117],['backup/moodle2','backup_block_task.class.php',80]], 10],
'get_plugin_list': ['get_plugin_list', 'Get list of plugins of given type. ', [['lib/classes','component.php',781],['lib','deprecatedlib.php',467],['admin/tool/monitor/classes','eventlist.php',176]], 184],
'close': ['close', 'Close the connection to the server ', [['lib/zend/Zend/Http/Client/Adapter','Socket.php',486],['lib/tests','completionlib_test.php',888],['lib/adodb','adodb.inc.php',2164],['lib/adodb','adodb.inc.php',2844],['lib/adodb','adodb.inc.php',3536],['lib','webdavlib.php',176],['admin/tool/uploaduser','locallib.php',149],['lib/dml','oci_native_moodle_recordset.php',80],['lib/tcpdf','tcpdf.php',2943],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['lib','excellib.class.php',93],['lib/zend/Zend/Http/Client/Adapter','Test.php',187],['lib/classes/dml','recordset_walk.php',153],['mod/assign/feedback/offline','importgradeslib.php',178],['lib/pear/Net','GeoIP.php',556],['backup/util/helper','backup_array_iterator.class.php',63],['lib/zend/Zend/Gdata/App','LoggingHttpClientAdapterSocket.php',109],['lib/zend/Zend/Http/Client/Adapter','Proxy.php',266],['lib/dml','mssql_native_moodle_recordset.php',87],['lib/pear/Auth','RADIUS.php',542],['lib/pear/Auth','RADIUS.php',703],['lib/pear/Auth','RADIUS.php',824],['lib/phpmailer','class.smtp.php',507],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',80],['lib/phpunit/classes','event_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Interface.php',73],['lib/dml','pgsql_native_moodle_recordset.php',104],['auth/fc','fcFPP.php',72],['lib/filestorage','zip_archive.php',183],['lib','odslib.class.php',71],['lib/horde/framework/Horde/Socket','Client.php',135],['question/engine/tests','helpers.php',1225],['grade','lib.php',323],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib','csvlib.class.php',256],['lib/google/src/Google/Logger','File.php',130],['lib/horde/framework/Horde','Stream.php',585],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpunit/classes','message_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Curl.php',460],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',109],['backup/util/helper','backup_null_iterator.class.php',53],['grade/export','lib.php',662],['lib/dml','pdo_moodle_recordset.php',79]], 1036],
'annotate_files': ['annotate_files', 'Adds backup id database record for all files in the given file area. ', [['backup/util/dbops','backup_structure_dbops.class.php',106],['backup/util/structure','backup_nested_element.class.php',227]], 101],
'clear_backup_dir': ['clear_backup_dir', 'Given one backupid, ensure its temp dir is completely empty ', [['backup/util/helper','backup_helper.class.php',42]], 2],
'get_all_user_name_fields': ['get_all_user_name_fields', 'A centralised location for the all name fields. Returns an array / sql string snippet. ', [['lib','moodlelib.php',3345]], 94],
'prepare_activity_structure': ['prepare_activity_structure', 'Wraps any activity backup structure within the common \'activity\' element that will include common to all activities information like id, context... ', [['backup/moodle2','backup_stepslib.php',152],['backup/moodle2','restore_stepslib.php',3702]], 45],
'enrol_get_plugins': ['enrol_get_plugins', 'Returns instances of enrol plugins ', [['lib','enrollib.php',70]], 45],
'get_modulename': ['get_modulename', '', [['backup/moodle2','backup_activity_task.class.php',89],['backup/moodle2','restore_activity_task.class.php',95],['lib/testing/generator','module_generator.php',54],['backup/moodle2','backup_block_task.class.php',92]], 28],
'get_activityid': ['get_activityid', '', [['backup/moodle2','backup_activity_task.class.php',96],['backup/moodle2','restore_activity_task.class.php',107]], 12],
'calculate_question_categories': ['calculate_question_categories', 'Calculates all the question_categories to be included in backup, based in a given context (course/module) and the already annotated questions present in backup_ids_temp ', [['backup/util/dbops','backup_question_dbops.class.php',35]], 1],
'add_question_usages': ['add_question_usages', 'Attach to $element (usually attempts) the needed backup structures for question_usages and all the associated data. ', [['backup/moodle2','backup_stepslib.php',187],['backup/moodle2','restore_stepslib.php',4473]], 2],
'filter_get_all_local_settings': ['filter_get_all_local_settings', 'This function is for use by backup. Gets all the filter information specific to one context. ', [['lib','filterlib.php',847]], 1],
'count': ['count', '', [], 3984],
'in_array': ['in_array', '', [], 1173],
'time': ['time', '', [], 1768],
'base64_decode': ['base64_decode', '', [], 101],
'array_key_exists': ['array_key_exists', '', [], 1539],
'unlink': ['unlink', '', [], 252],
'file_exists': ['file_exists', '', [], 873],
'array_keys': ['array_keys', '', [], 1152],
'base64_encode': ['base64_encode', '', [], 146],
'unserialize': ['unserialize', '', [], 180],
'array_merge': ['array_merge', '', [], 2320],
'strtotime': ['strtotime', '', [], 255],
'defined': ['defined', '', [], 4098],
'serialize': ['serialize', '', [], 266]};
CLASS_DATA={
'backup_calculate_question_categories': ['backup_calculate_question_categories', 'backup structure step in charge of calculating the categories to be included in backup, based in the context being backuped (module/course) and the already annotated questions present in backup_ids_temp ', [['backup/moodle2','backup_stepslib.php',257]], 2],
'backup_delete_temp_questions': ['backup_delete_temp_questions', 'backup structure step in charge of deleting all the questions annotated in the backup_ids_temp table ', [['backup/moodle2','backup_stepslib.php',269]], 1],
'backup_comments_structure_step': ['backup_comments_structure_step', 'structure step in charge of constructing the comments.xml file for all the comments found in a given context ', [['backup/moodle2','backup_stepslib.php',769]], 3],
'backup_enrolments_structure_step': ['backup_enrolments_structure_step', 'structure step that will generate the enrolments.xml file for the given course ', [['backup/moodle2','backup_stepslib.php',501]], 1],
'backup_annotate_groups_from_groupings': ['backup_annotate_groups_from_groupings', 'This step will annotate all the groups belonging to already annotated groupings ', [['backup/moodle2','backup_stepslib.php',1950]], 2],
'backup_annotate_course_groups_and_groupings': ['backup_annotate_course_groups_and_groupings', 'This step will annotate all the groups and groupings belonging to the course ', [['backup/moodle2','backup_stepslib.php',1924]], 1],
'backup_course_completion_structure_step': ['backup_course_completion_structure_step', 'Backups up the course completion information for the course. ', [['backup/moodle2','backup_stepslib.php',2398]], 1],
'backup_module_structure_step': ['backup_module_structure_step', 'structure step that will generate the module.xml file for the activity, accumulating various information about the activity, annotating groupings and completion/avail conf ', [['backup/moodle2','backup_stepslib.php',307]], 1],
'backup_activity_logs_structure_step': ['backup_activity_logs_structure_step', 'structure step in charge of constructing the logs.xml file for all the log records found in activity ', [['backup/moodle2','backup_stepslib.php',1489]], 1],
'backup_activity_grading_structure_step': ['backup_activity_grading_structure_step', 'Defines the backup step for advanced grading methods attached to the activity module ', [['backup/moodle2','backup_stepslib.php',2169]], 1],
'backup_gradebook_structure_step': ['backup_gradebook_structure_step', 'structure step in charge of constructing the gradebook.xml file for all the gradebook config in the course NOTE: the backup of the grade items themselves is handled by backup_activity_grades_structure_step ', [['backup/moodle2','backup_stepslib.php',921]], 1],
'backup_annotate_all_question_files': ['backup_annotate_all_question_files', 'This step will generate all the file annotations for the already annotated (final) question_categories. It calculates the different contexts that are being backup and, annotates all the files on every context belonging to the "question" component. As far as we are always including *complete* question banks it is safe and optimal to do that in this (one pass) way ', [['backup/moodle2','backup_stepslib.php',1995]], 1],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6106]], 929],
'backup_final_files_structure_step': ['backup_final_files_structure_step', 'structure in charge of constructing the files.xml file with all the annotated (final) files along the process. At, the same time, and using one specialised nested_element, will copy them form moodle storage to backup storage ', [['backup/moodle2','backup_stepslib.php',1584]], 1],
'backup_course_logs_structure_step': ['backup_course_logs_structure_step', 'structure step in charge of constructing the logs.xml file for all the log records found in course. Note that we are sending to backup ALL the log records having cmid = 0. That includes some records that won\'t be restoreable (like \'upload\', \'calendar\'...) but we do that just in case they become restored some day in the future ', [['backup/moodle2','backup_stepslib.php',1453]], 1],
'grade_item': ['grade_item', 'Class representing a grade item. ', [['lib/grade','grade_item.php',29]], 206],
'create_and_clean_temp_stuff': ['create_and_clean_temp_stuff', 'Create the temp dir where backup/restore will happen and create temp ids table. ', [['backup/moodle2','backup_stepslib.php',30]], 1],
'anonymizer_final_element': ['anonymizer_final_element', 'Implementation of backup_final_element that provides one interceptor for anonymization of data ', [['backup/moodle2','backup_custom_fields.php',30]], 1],
'move_inforef_annotations_to_final': ['move_inforef_annotations_to_final', 'This step will get all the annotations already processed to inforef.xml file and transform them into \'final\' annotations. ', [['backup/moodle2','backup_stepslib.php',1561]], 5],
'backup_filters_structure_step': ['backup_filters_structure_step', 'structure step in charge of constructing the filters.xml file for all the filters found in activity ', [['backup/moodle2','backup_stepslib.php',729]], 2],
'backup_section_structure_step': ['backup_section_structure_step', 'structure step that will generate the section.xml file for the section annotating files ', [['backup/moodle2','backup_stepslib.php',354]], 1],
'backup_activity_grade_history_structure_step': ['backup_activity_grade_history_structure_step', 'Structure step in charge of constructing the grade history of an activity. ', [['backup/moodle2','backup_stepslib.php',2340]], 1],
'backup_zip_contents': ['backup_zip_contents', 'Execution step that will generate the final zip (.mbz) file with all the contents ', [['backup/moodle2','backup_stepslib.php',1744]], 1],
'backup_grade_history_structure_step': ['backup_grade_history_structure_step', 'Step in charge of constructing the grade_history.xml file containing the grade histories. ', [['backup/moodle2','backup_stepslib.php',1040]], 1],
'backup_groups_structure_step': ['backup_groups_structure_step', 'structure step in charge of constructing the main groups.xml file for all the groups and groupings information already annotated ', [['backup/moodle2','backup_stepslib.php',1144]], 1],
'backup_activity_grade_items_to_ids': ['backup_activity_grade_items_to_ids', 'This step will search for all the activity (not calculations, categories nor aggregations) grade items and put them to the backup_ids tables, to be used later as base to backup them ', [['backup/moodle2','backup_stepslib.php',1863]], 1],
'backup_roles_structure_step': ['backup_roles_structure_step', 'structure step that will generate the roles.xml file for the given context, observing the role_assignments setting to know if that part needs to be included ', [['backup/moodle2','backup_stepslib.php',565]], 3],
'create_taskbasepath_directory': ['create_taskbasepath_directory', 'Create the directory where all the task (activity/block...) information will be stored ', [['backup/moodle2','backup_stepslib.php',78]], 4],
'backup_store_backup_file': ['backup_store_backup_file', 'This step will send the generated backup file to its final destination ', [['backup/moodle2','backup_stepslib.php',1839]], 1],
'backup_course_structure_step': ['backup_course_structure_step', 'structure step that will generate the course.xml file for the course, including course category reference, tags, modules restriction information and some annotations (files & groupings) ', [['backup/moodle2','backup_stepslib.php',401]], 1],
'file_nested_element': ['file_nested_element', 'Implementation of backup_nested_element that provides special handling of files ', [['backup/moodle2','backup_custom_fields.php',81]], 1],
'file_progress': ['file_progress', 'Simple interface for receiving progress during long-running file operations. ', [['lib/filestorage','file_progress.php',17]], 10],
'drop_and_clean_temp_stuff': ['drop_and_clean_temp_stuff', 'Delete the temp dir used by backup/restore (conditionally), delete old directories and drop temp ids table. Note we delete the directory but not the corresponding log file that will be there for, at least, 1 week - only delete_old_backup_dirs() or cron deletes log files (for easier access to them). ', [['backup/moodle2','backup_stepslib.php',46]], 1],
'backup_activity_grades_structure_step': ['backup_activity_grades_structure_step', 'structure step in charge of constructing the grades.xml file for all the grade items and letters related to one activity ', [['backup/moodle2','backup_stepslib.php',2251]], 1],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6766]], 1197],
'backup_users_structure_step': ['backup_users_structure_step', 'structure step in charge of constructing the main users.xml file for all the users already annotated (final). Includes custom profile fields, preferences, tags, role assignments and overrides. ', [['backup/moodle2','backup_stepslib.php',1233]], 1],
'mnethosturl_final_element': ['mnethosturl_final_element', 'Implementation of backup_final_element that provides special handling of mnethosturl ', [['backup/moodle2','backup_custom_fields.php',56]], 1],
'backup_enrolments_execution_step': ['backup_enrolments_execution_step', 'This step allows enrol plugins to annotate custom fields. ', [['backup/moodle2','backup_stepslib.php',1884]], 1],
'context_user': ['context_user', 'User context class ', [['lib','accesslib.php',6347]], 288],
'backup_userscompletion_structure_step': ['backup_userscompletion_structure_step', 'structure step in charge if constructing the completion.xml file for all the users completion information in a given activity ', [['backup/moodle2','backup_stepslib.php',1104]], 1],
'backup_final_roles_structure_step': ['backup_final_roles_structure_step', 'structure step that will generate the roles.xml containing the list of roles used along the whole backup process. Just raw list of used roles from role table ', [['backup/moodle2','backup_stepslib.php',621]], 1],
'backup_main_structure_step': ['backup_main_structure_step', 'Structure step in charge of creating the main moodle_backup.xml file where all the information related to the backup, settings, license and ', [['backup/moodle2','backup_stepslib.php',1624]], 1],
'backup_calendarevents_structure_step': ['backup_calendarevents_structure_step', 'structure step in charge of constructing the calender.xml file for all the events found in a given context ', [['backup/moodle2','backup_stepslib.php',879]], 2],
'backup_inforef_structure_step': ['backup_inforef_structure_step', 'structure in charge of constructing the inforef.xml file for all the items we want to have referenced there (users, roles, files...) ', [['backup/moodle2','backup_stepslib.php',1523]], 4],
'backup_block_instance_structure_step': ['backup_block_instance_structure_step', 'structure step in charge of constructing the block.xml file for one given block (instance and positions). If the block has custom DB structure that will go to a separate file (different step defined in block class) ', [['backup/moodle2','backup_stepslib.php',1395]], 1],
'backup_optigroup': ['backup_optigroup', 'Instantiable class representing one optigroup element for conditional branching ', [['backup/util/structure','backup_optigroup.class.php',27]], 9],
'core_component': ['core_component', 'Collection of components related methods. ', [['lib/classes','component.php',41]], 485],
'backup_nested_element': ['backup_nested_element', 'Instantiable class representing one nestable element (non final) piece of information on backup ', [['backup/util/structure','backup_nested_element.class.php',27]], 415],
'backup_questions_structure_step': ['backup_questions_structure_step', 'structure step in charge of constructing the questions.xml file for all the question categories and questions required by the backup and letters related to one activity ', [['backup/moodle2','backup_stepslib.php',2043]], 1],
'backup_annotate_scales_from_outcomes': ['backup_annotate_scales_from_outcomes', 'This step will annotate all the scales belonging to already annotated outcomes ', [['backup/moodle2','backup_stepslib.php',1973]], 1],
'backup_final_scales_structure_step': ['backup_final_scales_structure_step', 'structure step that will generate the scales.xml containing the list of scales used along the whole backup process. ', [['backup/moodle2','backup_stepslib.php',656]], 1],
'backup_badges_structure_step': ['backup_badges_structure_step', 'structure step in charge of constructing the badges.xml file for all the badges found in a given context ', [['backup/moodle2','backup_stepslib.php',802]], 1],
'backup_step_exception': ['backup_step_exception', '', [['backup/util/plan','backup_step.class.php',53]], 21],
'backup_annotate_all_user_files': ['backup_annotate_all_user_files', 'This step will generate all the file  annotations for the already annotated (final) users. Need to do this here because each user has its own context and structure tasks only are able to handle one context. Also, this step will guarantee that every user has its context created (req for other steps) ', [['backup/moodle2','backup_stepslib.php',2129]], 1],
'backup_final_outcomes_structure_step': ['backup_final_outcomes_structure_step', 'structure step that will generate the outcomes.xml containing the list of outcomes used along the whole backup process. ', [['backup/moodle2','backup_stepslib.php',692]], 1]};
CONST_DATA={
'IGNORE_MISSING': ['IGNORE_MISSING', '', [['lib','dmllib.php',48]], 204],
'SITEID': ['SITEID', '', [['admin/cli','install.php',217],['','install.php',244],['lib/db','install.php',87],['lib','setup.php',748]], 612],
'FEATURE_ADVANCED_GRADING': ['FEATURE_ADVANCED_GRADING', '', [['lib','moodlelib.php',398]], 9],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',138],['','install.php',93],['lib','setup.php',386]], 3532],
'CONTEXT_USER': ['CONTEXT_USER', '', [['lib','accesslib.php',144]], 95]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
