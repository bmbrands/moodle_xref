<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /backup/moodle2/backup_final_task.class.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='backup/moodle2';
filename='backup_final_task.class.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/backup/moodle2/</a> -> <a href="backup_final_task.class.php.html">backup_final_task.class.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="backup_final_task.class.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="backup_final_task.class.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">//</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">//</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">//</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Defines backup_final_task class</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package     core_backup</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @subpackage  moodle2</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @category    backup</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @copyright   2010 onwards Eloy Lafuente (stronk7) {@link http://stronk7.com}</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> */</span>
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">/**</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * Final task that provides all the final steps necessary in order to finish one</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * backup (mainly gathering references and creating the main xml) apart from</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * some final cleaning</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> *</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * TODO: Finish phpdocs</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> */</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('backup_final_task')" href="../../_classes/backup_final_task.html" onMouseOver="classPopup(event,'backup_final_task')">backup_final_task</a> extends backup_task {
<a name="l38"><span class="linenum">  38</span></a>  
<a name="l39"><span class="linenum">  39</span></a>      <span class="comment">/**</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">     * Create all the steps that will be part of this task</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">     */</span>
<a name="l42"><span class="linenum">  42</span></a>      public function <a class="function" onClick="logFunction('build')" href="../../_functions/build.html" onMouseOver="funcPopup(event,'build')">build</a>() {
<a name="l43"><span class="linenum">  43</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">        // Set the backup::VAR_CONTEXTID setting to course context as far as next steps require that</span>
<a name="l46"><span class="linenum">  46</span></a>          <a class="var it22786" onMouseOver="hilite(22786)" onMouseOut="lolite()" onClick="logVariable('coursectxid')" href="../../_variables/coursectxid.html">$coursectxid</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>())-&gt;id;
<a name="l47"><span class="linenum">  47</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_setting')" href="../../_functions/add_setting.html" onMouseOver="funcPopup(event,'add_setting')">add_setting</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_activity_generic_setting')" href="../../_classes/backup_activity_generic_setting.html" onMouseOver="classPopup(event,'backup_activity_generic_setting')">backup_activity_generic_setting</a>(backup::VAR_CONTEXTID, base_setting::IS_INTEGER, <a class="var it22786" onMouseOver="hilite(22786)" onMouseOut="lolite()" onClick="logVariable('coursectxid')" href="../../_variables/coursectxid.html">$coursectxid</a>));
<a name="l48"><span class="linenum">  48</span></a>  
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">        // Set the backup::VAR_COURSEID setting to course, we'll need that in some steps</span>
<a name="l50"><span class="linenum">  50</span></a>          <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>();
<a name="l51"><span class="linenum">  51</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_setting')" href="../../_functions/add_setting.html" onMouseOver="funcPopup(event,'add_setting')">add_setting</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_activity_generic_setting')" href="../../_classes/backup_activity_generic_setting.html" onMouseOver="classPopup(event,'backup_activity_generic_setting')">backup_activity_generic_setting</a>(backup::VAR_COURSEID, base_setting::IS_INTEGER, <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>));
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">        // Generate the groups file with the final annotated groups and groupings</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">        // including membership based on setting</span>
<a name="l55"><span class="linenum">  55</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_groups_structure_step')" href="../../_classes/backup_groups_structure_step.html" onMouseOver="classPopup(event,'backup_groups_structure_step')">backup_groups_structure_step</a>('groups', 'groups.xml'));
<a name="l56"><span class="linenum">  56</span></a>  
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">        // Generate the questions file with the final annotated question_categories</span>
<a name="l58"><span class="linenum">  58</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_questions_structure_step')" href="../../_classes/backup_questions_structure_step.html" onMouseOver="classPopup(event,'backup_questions_structure_step')">backup_questions_structure_step</a>('questions', 'questions.xml'));
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">        // Annotate all the question files for the already annotated question</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">        // categories (this is performed here and not in the structure step because</span>
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">        // it involves multiple contexts and as far as we are always backup-ing</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">        // complete question banks we don't need to restrict at all and can be</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">        // done in a single pass</span>
<a name="l65"><span class="linenum">  65</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_annotate_all_question_files')" href="../../_classes/backup_annotate_all_question_files.html" onMouseOver="classPopup(event,'backup_annotate_all_question_files')">backup_annotate_all_question_files</a>('question_files'));
<a name="l66"><span class="linenum">  66</span></a>  
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment">        // Annotate all the user files (conditionally) (profile and icon files)</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">        // Because each user has its own context, we need a separate/specialised step here</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment">        // This step also ensures that the contexts for all the users exist, so next</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">        // step can be safely executed (join between users and contexts)</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment">        // Not executed if backup is without users of anonymized</span>
<a name="l72"><span class="linenum">  72</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('users') &amp;&amp; !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('anonymize')) {
<a name="l73"><span class="linenum">  73</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_annotate_all_user_files')" href="../../_classes/backup_annotate_all_user_files.html" onMouseOver="classPopup(event,'backup_annotate_all_user_files')">backup_annotate_all_user_files</a>('user_files'));
<a name="l74"><span class="linenum">  74</span></a>          }
<a name="l75"><span class="linenum">  75</span></a>  
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">        // Generate the users file (conditionally) with the final annotated users</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">        // including custom profile fields, preferences, tags, role assignments and</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">        // overrides</span>
<a name="l79"><span class="linenum">  79</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('users')) {
<a name="l80"><span class="linenum">  80</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_users_structure_step')" href="../../_classes/backup_users_structure_step.html" onMouseOver="classPopup(event,'backup_users_structure_step')">backup_users_structure_step</a>('users', 'users.xml'));
<a name="l81"><span class="linenum">  81</span></a>          }
<a name="l82"><span class="linenum">  82</span></a>  
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">        // Generate the top roles file with all the final annotated roles</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment">        // that have been detected along the whole process. It's just</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment">        // the list of role definitions (no assignments nor permissions)</span>
<a name="l86"><span class="linenum">  86</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_final_roles_structure_step')" href="../../_classes/backup_final_roles_structure_step.html" onMouseOver="classPopup(event,'backup_final_roles_structure_step')">backup_final_roles_structure_step</a>('roleslist', 'roles.xml'));
<a name="l87"><span class="linenum">  87</span></a>  
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">        // Generate the gradebook file with categories and course grade items. Do it conditionally, using</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">        // execute_condition() so only will be excuted if ALL module grade_items in course have been exported</span>
<a name="l90"><span class="linenum">  90</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_gradebook_structure_step')" href="../../_classes/backup_gradebook_structure_step.html" onMouseOver="classPopup(event,'backup_gradebook_structure_step')">backup_gradebook_structure_step</a>('course_gradebook','gradebook.xml'));
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">        // Generate the grade history file, conditionally.</span>
<a name="l93"><span class="linenum">  93</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_grade_history_structure_step')" href="../../_classes/backup_grade_history_structure_step.html" onMouseOver="classPopup(event,'backup_grade_history_structure_step')">backup_grade_history_structure_step</a>('course_grade_history','grade_history.xml'));
<a name="l94"><span class="linenum">  94</span></a>  
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">        // Generate the course completion</span>
<a name="l96"><span class="linenum">  96</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_course_completion_structure_step')" href="../../_classes/backup_course_completion_structure_step.html" onMouseOver="classPopup(event,'backup_course_completion_structure_step')">backup_course_completion_structure_step</a>('course_completion', 'completion.xml'));
<a name="l97"><span class="linenum">  97</span></a>  
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">        // Conditionally generate the badges file.</span>
<a name="l99"><span class="linenum">  99</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>('badges')) {
<a name="l100"><span class="linenum"> 100</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_badges_structure_step')" href="../../_classes/backup_badges_structure_step.html" onMouseOver="classPopup(event,'backup_badges_structure_step')">backup_badges_structure_step</a>('course_badges', 'badges.xml'));
<a name="l101"><span class="linenum"> 101</span></a>          }
<a name="l102"><span class="linenum"> 102</span></a>  
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">        // Generate the scales file with all the (final) annotated scales</span>
<a name="l104"><span class="linenum"> 104</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_final_scales_structure_step')" href="../../_classes/backup_final_scales_structure_step.html" onMouseOver="classPopup(event,'backup_final_scales_structure_step')">backup_final_scales_structure_step</a>('scaleslist', 'scales.xml'));
<a name="l105"><span class="linenum"> 105</span></a>  
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment">        // Generate the outcomes file with all the (final) annotated outcomes</span>
<a name="l107"><span class="linenum"> 107</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_final_outcomes_structure_step')" href="../../_classes/backup_final_outcomes_structure_step.html" onMouseOver="classPopup(event,'backup_final_outcomes_structure_step')">backup_final_outcomes_structure_step</a>('outcomeslist', 'outcomes.xml'));
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">        // Migrate the pending annotations to final (prev steps may have added some files)</span>
<a name="l110"><span class="linenum"> 110</span></a>  <span class="comment">        // This must be executed before backup files</span>
<a name="l111"><span class="linenum"> 111</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('move_inforef_annotations_to_final')" href="../../_classes/move_inforef_annotations_to_final.html" onMouseOver="classPopup(event,'move_inforef_annotations_to_final')">move_inforef_annotations_to_final</a>('migrate_inforef'));
<a name="l112"><span class="linenum"> 112</span></a>  
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment">        // Generate the files.xml file with all the (final) annotated files. At the same</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment">        // time copy all the files from moodle storage to backup storage (uses custom</span>
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment">        // backup_nested_element for that)</span>
<a name="l116"><span class="linenum"> 116</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_final_files_structure_step')" href="../../_classes/backup_final_files_structure_step.html" onMouseOver="classPopup(event,'backup_final_files_structure_step')">backup_final_files_structure_step</a>('fileslist', 'files.xml'));
<a name="l117"><span class="linenum"> 117</span></a>  
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment">        // Write the main moodle_backup.xml file, with all the information related</span>
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment">        // to the backup, settings, license, versions and other useful information</span>
<a name="l120"><span class="linenum"> 120</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_main_structure_step')" href="../../_classes/backup_main_structure_step.html" onMouseOver="classPopup(event,'backup_main_structure_step')">backup_main_structure_step</a>('mainfile', 'moodle_backup.xml'));
<a name="l121"><span class="linenum"> 121</span></a>  
<a name="l122"><span class="linenum"> 122</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../backup/util/helper/convert_helper.class.php.html">/backup/util/helper/convert_helper.class.php</a>');
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">        // Look for converter steps only in type course and mode general backup operations.</span>
<a name="l125"><span class="linenum"> 125</span></a>          <a class="var it8412" onMouseOver="hilite(8412)" onMouseOut="lolite()" onClick="logVariable('conversion')" href="../../_variables/conversion.html">$conversion</a> = false;
<a name="l126"><span class="linenum"> 126</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('plan')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/plan.html">plan</a>-&gt;<a class="function" onClick="logFunction('get_type')" href="../../_functions/get_type.html" onMouseOver="funcPopup(event,'get_type')">get_type</a>() == backup::TYPE_1COURSE and <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('plan')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/plan.html">plan</a>-&gt;<a class="function" onClick="logFunction('get_mode')" href="../../_functions/get_mode.html" onMouseOver="funcPopup(event,'get_mode')">get_mode</a>() == backup::MODE_GENERAL) {
<a name="l127"><span class="linenum"> 127</span></a>              <a class="var it22787" onMouseOver="hilite(22787)" onMouseOut="lolite()" onClick="logVariable('converters')" href="../../_variables/converters.html">$converters</a> = convert_helper::<a class="function" onClick="logFunction('available_converters')" href="../../_functions/available_converters.html" onMouseOver="funcPopup(event,'available_converters')">available_converters</a>(false);
<a name="l128"><span class="linenum"> 128</span></a>              foreach (<a class="var it22787" onMouseOver="hilite(22787)" onMouseOut="lolite()" onClick="logVariable('converters')" href="../../_variables/converters.html">$converters</a> as <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l129"><span class="linenum"> 129</span></a>                  if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_setting_value')" href="../../_functions/get_setting_value.html" onMouseOver="funcPopup(event,'get_setting_value')">get_setting_value</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>)) {
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">                    // Zip class.</span>
<a name="l131"><span class="linenum"> 131</span></a>                      <a class="var it22788" onMouseOver="hilite(22788)" onMouseOut="lolite()" onClick="logVariable('zip_contents')" href="../../_variables/zip_contents.html">$zip_contents</a>      = &quot;{<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>}_zip_contents&quot;;
<a name="l132"><span class="linenum"> 132</span></a>                      <a class="var it22789" onMouseOver="hilite(22789)" onMouseOut="lolite()" onClick="logVariable('store_backup_file')" href="../../_variables/store_backup_file.html">$store_backup_file</a> = &quot;{<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>}_store_backup_file&quot;;
<a name="l133"><span class="linenum"> 133</span></a>                      <a class="var it9217" onMouseOver="hilite(9217)" onMouseOut="lolite()" onClick="logVariable('convert')" href="../../_variables/convert.html">$convert</a>           = &quot;{<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>}_backup_convert&quot;;
<a name="l134"><span class="linenum"> 134</span></a>  
<a name="l135"><span class="linenum"> 135</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(new <a class="var it9217" onMouseOver="hilite(9217)" onMouseOut="lolite()" onClick="logVariable('convert')" href="../../_variables/convert.html">$convert</a>(&quot;package_convert_{<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>}&quot;));
<a name="l136"><span class="linenum"> 136</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(new <a class="var it22788" onMouseOver="hilite(22788)" onMouseOut="lolite()" onClick="logVariable('zip_contents')" href="../../_variables/zip_contents.html">$zip_contents</a>(&quot;zip_contents_{<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>}&quot;));
<a name="l137"><span class="linenum"> 137</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(new <a class="var it22789" onMouseOver="hilite(22789)" onMouseOut="lolite()" onClick="logVariable('store_backup_file')" href="../../_variables/store_backup_file.html">$store_backup_file</a>(&quot;save_backupfile_{<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>}&quot;));
<a name="l138"><span class="linenum"> 138</span></a>                      if (!<a class="var it8412" onMouseOver="hilite(8412)" onMouseOut="lolite()" onClick="logVariable('conversion')" href="../../_variables/conversion.html">$conversion</a>) {
<a name="l139"><span class="linenum"> 139</span></a>                          <a class="var it8412" onMouseOver="hilite(8412)" onMouseOut="lolite()" onClick="logVariable('conversion')" href="../../_variables/conversion.html">$conversion</a> = true;
<a name="l140"><span class="linenum"> 140</span></a>                      }
<a name="l141"><span class="linenum"> 141</span></a>                  }
<a name="l142"><span class="linenum"> 142</span></a>              }
<a name="l143"><span class="linenum"> 143</span></a>          }
<a name="l144"><span class="linenum"> 144</span></a>  
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">        // On backup::MODE_IMPORT, we don't have to zip nor store the the file, skip these steps</span>
<a name="l146"><span class="linenum"> 146</span></a>          if ((<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('plan')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/plan.html">plan</a>-&gt;<a class="function" onClick="logFunction('get_mode')" href="../../_functions/get_mode.html" onMouseOver="funcPopup(event,'get_mode')">get_mode</a>() != backup::MODE_IMPORT) &amp;&amp; !<a class="var it8412" onMouseOver="hilite(8412)" onMouseOut="lolite()" onClick="logVariable('conversion')" href="../../_variables/conversion.html">$conversion</a>) {
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment">            // Generate the zip file (mbz extension)</span>
<a name="l148"><span class="linenum"> 148</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_zip_contents')" href="../../_classes/backup_zip_contents.html" onMouseOver="classPopup(event,'backup_zip_contents')">backup_zip_contents</a>('zip_contents'));
<a name="l149"><span class="linenum"> 149</span></a>  
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment">            // Copy the generated zip (.mbz) file to final destination</span>
<a name="l151"><span class="linenum"> 151</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<span class="keyword">new </span><a class="class" onClick="logClass('backup_store_backup_file')" href="../../_classes/backup_store_backup_file.html" onMouseOver="classPopup(event,'backup_store_backup_file')">backup_store_backup_file</a>('save_backupfile'));
<a name="l152"><span class="linenum"> 152</span></a>          }
<a name="l153"><span class="linenum"> 153</span></a>  
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">        // Clean the temp dir (conditionally) and drop temp tables</span>
<a name="l155"><span class="linenum"> 155</span></a>          <a class="var it22790" onMouseOver="hilite(22790)" onMouseOut="lolite()" onClick="logVariable('cleanstep')" href="../../_variables/cleanstep.html">$cleanstep</a> = <span class="keyword">new </span><a class="class" onClick="logClass('drop_and_clean_temp_stuff')" href="../../_classes/drop_and_clean_temp_stuff.html" onMouseOver="classPopup(event,'drop_and_clean_temp_stuff')">drop_and_clean_temp_stuff</a>('drop_and_clean_temp_stuff');
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">        // Decide about to delete the temp dir (based on backup::MODE_IMPORT)</span>
<a name="l157"><span class="linenum"> 157</span></a>          <a class="var it22790" onMouseOver="hilite(22790)" onMouseOut="lolite()" onClick="logVariable('cleanstep')" href="../../_variables/cleanstep.html">$cleanstep</a>-&gt;<a class="function" onClick="logFunction('skip_cleaning_temp_dir')" href="../../_functions/skip_cleaning_temp_dir.html" onMouseOver="funcPopup(event,'skip_cleaning_temp_dir')">skip_cleaning_temp_dir</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('plan')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/plan.html">plan</a>-&gt;<a class="function" onClick="logFunction('get_mode')" href="../../_functions/get_mode.html" onMouseOver="funcPopup(event,'get_mode')">get_mode</a>() == backup::MODE_IMPORT);
<a name="l158"><span class="linenum"> 158</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_step')" href="../../_functions/add_step.html" onMouseOver="funcPopup(event,'add_step')">add_step</a>(<a class="var it22790" onMouseOver="hilite(22790)" onMouseOut="lolite()" onClick="logVariable('cleanstep')" href="../../_variables/cleanstep.html">$cleanstep</a>);
<a name="l159"><span class="linenum"> 159</span></a>  
<a name="l160"><span class="linenum"> 160</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('built')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/built.html">built</a> = true;
<a name="l161"><span class="linenum"> 161</span></a>      }
<a name="l162"><span class="linenum"> 162</span></a>  
<a name="l163"><span class="linenum"> 163</span></a>      public function <a class="function" onClick="logFunction('get_weight')" href="../../_functions/get_weight.html" onMouseOver="funcPopup(event,'get_weight')">get_weight</a>() {
<a name="l164"><span class="linenum"> 164</span></a>  <span class="comment">        // The final task takes ages, so give it 20 times the weight of a normal task.</span>
<a name="l165"><span class="linenum"> 165</span></a>          return 20;
<a name="l166"><span class="linenum"> 166</span></a>      }
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>  <span class="comment">// Protected API starts here</span>
<a name="l169"><span class="linenum"> 169</span></a>  
<a name="l170"><span class="linenum"> 170</span></a>      <span class="comment">/**</span>
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">     * Define the common setting that any backup type will have</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment">     */</span>
<a name="l173"><span class="linenum"> 173</span></a>      protected function <a class="function" onClick="logFunction('define_settings')" href="../../_functions/define_settings.html" onMouseOver="funcPopup(event,'define_settings')">define_settings</a>() {
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment">        // This task has not settings (could have them, like destination or so in the future, let's see)</span>
<a name="l175"><span class="linenum"> 175</span></a>      }
<a name="l176"><span class="linenum"> 176</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'add_setting': ['add_setting', 'This function is invoked on activity creation in order to add all the settings that are associated with one task. The function will, directly, inject the settings in the task. ', [['backup/util/plan','base_task.class.php',257],['backup/util/ui','base_moodleform.class.php',168]], 64],
'get_courseid': ['get_courseid', '', [['question/classes/bank','view.php',217],['backup/util/plan','base_task.class.php',109],['backup/util/plan','backup_plan.class.php',78],['backup/util/plan','base_step.class.php',105],['course/format','lib.php',222],['backup/util/plan','restore_plan.class.php',81],['mod/quiz','attemptlib.php',175],['mod/quiz','attemptlib.php',676],['comment','lib.php',998],['backup/controller','restore_controller.class.php',267],['backup/controller','backup_controller.class.php',265],['mod/quiz/classes','structure.php',223]], 190],
'add_step': ['add_step', '', [['question/engine/upgrade','behaviourconverters.php',168],['backup/util/plan','base_task.class.php',139],['question/engine/tests','helpers.php',41],['question/engine','questionattempt.php',876],['question/engine','questionattempt.php',1556]], 181],
'define_settings': ['define_settings', 'Defines the common setting that any backup activity will have ', [['backup/moodle2','backup_activity_task.class.php',250],['backup/moodle2','restore_final_task.class.php',181],['backup/moodle2','restore_root_task.class.php',95],['backup/moodle2','restore_activity_task.class.php',268],['backup/moodle2','restore_course_task.class.php',154],['backup/moodle2','backup_final_task.class.php',170],['backup/moodle2','backup_root_task.class.php',62],['backup/moodle2','restore_block_task.class.php',174],['backup/util/plan/tests/fixtures','plan_fixtures.php',68],['backup/util/plan/tests/fixtures','plan_fixtures.php',121],['backup/util/plan/tests/fixtures','plan_fixtures.php',132],['backup/moodle2','backup_course_task.class.php',174],['backup/moodle2','restore_section_task.class.php',149],['backup/moodle2','backup_block_task.class.php',180],['backup/moodle2','backup_section_task.class.php',139]], 2],
'get_type': ['get_type', 'Get the type ', [['lib/simplepie/library/SimplePie','Restriction.php',122],['mod/assign','assignmentplugin.php',153],['backup/util/ui','base_ui.class.php',294],['grade/report/singleview/classes/local/ui','bulk_insert.php',62],['backup/util/plan','backup_plan.class.php',70],['lib/simplepie/library/SimplePie','Caption.php',193],['lib/simplepie/library/SimplePie','Enclosure.php',877],['lib/simplepie/library','SimplePie.php',1624],['mod/lesson','locallib.php',2397],['mod/workshop','locallib.php',3761],['mod/lti/classes/local/ltiservice','resource_base.php',114],['backup/util/ui','backup_ui_setting.class.php',102],['availability/classes','condition.php',102],['backup/controller','restore_controller.class.php',259],['backup/controller','backup_controller.class.php',242],['lib/simplepie/library/SimplePie/Content/Type','Sniffer.php',79]], 85],
'skip_cleaning_temp_dir': ['skip_cleaning_temp_dir', '', [['backup/moodle2','backup_stepslib.php',73]], 1],
'build': ['build', 'Create all the steps that will be part of this task ', [['backup/moodle2','backup_activity_task.class.php',114],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',18],['backup/moodle2','restore_final_task.class.php',38],['backup/moodle2','restore_root_task.class.php',36],['lib/htmlpurifier/HTMLPurifier/ConfigSchema/Builder','ConfigSchema.php',14],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','InterchangeBuilder.php',76],['backup/util/plan','backup_plan.class.php',61],['lib/htmlpurifier/HTMLPurifier/ConfigSchema/Builder','Xml.php',50],['backup/moodle2','restore_activity_task.class.php',123],['backup/moodle2','restore_course_task.class.php',61],['lib/horde/framework/Horde/Imap/Client/Search','Query.php',103],['backup/moodle2','backup_final_task.class.php',39],['backup/moodle2','backup_root_task.class.php',37],['backup/moodle2','restore_block_task.class.php',65],['backup/util/plan','restore_plan.class.php',72],['badges/criteria','award_criteria.php',143],['backup/util/plan/tests/fixtures','plan_fixtures.php',35],['backup/util/plan/tests/fixtures','plan_fixtures.php',64],['backup/util/plan/tests/fixtures','plan_fixtures.php',118],['backup/util/plan/tests/fixtures','plan_fixtures.php',129],['backup/moodle2','backup_course_task.class.php',62],['backup/moodle2','restore_section_task.class.php',71],['backup/moodle2','backup_block_task.class.php',122],['backup/moodle2','backup_section_task.class.php',68]], 42],
'available_converters': ['available_converters', 'Returns the list of all available converters and loads their classes ', [['backup/util/helper','convert_helper.class.php',44]], 5],
'get_setting_value': ['get_setting_value', 'Gets the value for the requested setting ', [['backup/util/ui','base_ui.class.php',330],['backup/util/plan','base_task.class.php',105],['backup/moodle2','restore_subplugin.class.php',162],['backup/moodle2','backup_subplugin.class.php',68],['backup/util/plan','base_step.class.php',98],['backup/moodle2','restore_plugin.class.php',230],['backup/moodle2','backup_plugin.class.php',68]], 134],
'get_weight': ['get_weight', 'Returns the weight of this task, an approximation of the amount of time it will take. By default this value is 1. It can be increased for longer tasks. ', [['backup/util/plan','base_task.class.php',70],['backup/moodle2','backup_final_task.class.php',163]], 2],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'get_mode': ['get_mode', 'Returns the mode of this definition ', [['cache/classes','definition.php',617],['backup/util/plan','backup_plan.class.php',74],['backup/util/plan','restore_plan.class.php',85],['mod/assignment/backup/moodle2','restore_assignment_activity_task.class.php',113],['backup/controller','restore_controller.class.php',279],['backup/controller','backup_controller.class.php',277]], 33],
'defined': ['defined', '', [], 4098]};
CLASS_DATA={
'backup_course_completion_structure_step': ['backup_course_completion_structure_step', 'Backups up the course completion information for the course. ', [['backup/moodle2','backup_stepslib.php',2398]], 1],
'backup_gradebook_structure_step': ['backup_gradebook_structure_step', 'structure step in charge of constructing the gradebook.xml file for all the gradebook config in the course NOTE: the backup of the grade items themselves is handled by backup_activity_grades_structure_step ', [['backup/moodle2','backup_stepslib.php',921]], 1],
'backup_annotate_all_question_files': ['backup_annotate_all_question_files', 'This step will generate all the file annotations for the already annotated (final) question_categories. It calculates the different contexts that are being backup and, annotates all the files on every context belonging to the "question" component. As far as we are always including *complete* question banks it is safe and optimal to do that in this (one pass) way ', [['backup/moodle2','backup_stepslib.php',1995]], 1],
'backup_final_files_structure_step': ['backup_final_files_structure_step', 'structure in charge of constructing the files.xml file with all the annotated (final) files along the process. At, the same time, and using one specialised nested_element, will copy them form moodle storage to backup storage ', [['backup/moodle2','backup_stepslib.php',1584]], 1],
'move_inforef_annotations_to_final': ['move_inforef_annotations_to_final', 'This step will get all the annotations already processed to inforef.xml file and transform them into \'final\' annotations. ', [['backup/moodle2','backup_stepslib.php',1561]], 5],
'backup_activity_generic_setting': ['backup_activity_generic_setting', 'generic activity setting to pass various settings between tasks and steps ', [['backup/moodle2','backup_settingslib.php',155]], 20],
'backup_zip_contents': ['backup_zip_contents', 'Execution step that will generate the final zip (.mbz) file with all the contents ', [['backup/moodle2','backup_stepslib.php',1744]], 1],
'backup_grade_history_structure_step': ['backup_grade_history_structure_step', 'Step in charge of constructing the grade_history.xml file containing the grade histories. ', [['backup/moodle2','backup_stepslib.php',1040]], 1],
'backup_groups_structure_step': ['backup_groups_structure_step', 'structure step in charge of constructing the main groups.xml file for all the groups and groupings information already annotated ', [['backup/moodle2','backup_stepslib.php',1144]], 1],
'backup_store_backup_file': ['backup_store_backup_file', 'This step will send the generated backup file to its final destination ', [['backup/moodle2','backup_stepslib.php',1839]], 1],
'drop_and_clean_temp_stuff': ['drop_and_clean_temp_stuff', 'Delete the temp dir used by backup/restore (conditionally), delete old directories and drop temp ids table. Note we delete the directory but not the corresponding log file that will be there for, at least, 1 week - only delete_old_backup_dirs() or cron deletes log files (for easier access to them). ', [['backup/moodle2','backup_stepslib.php',46]], 1],
'backup_final_task': ['backup_final_task', 'Final task that provides all the final steps necessary in order to finish one backup (mainly gathering references and creating the main xml) apart from some final cleaning ', [['backup/moodle2','backup_final_task.class.php',30]], 1],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6766]], 1197],
'backup_users_structure_step': ['backup_users_structure_step', 'structure step in charge of constructing the main users.xml file for all the users already annotated (final). Includes custom profile fields, preferences, tags, role assignments and overrides. ', [['backup/moodle2','backup_stepslib.php',1233]], 1],
'backup_final_roles_structure_step': ['backup_final_roles_structure_step', 'structure step that will generate the roles.xml containing the list of roles used along the whole backup process. Just raw list of used roles from role table ', [['backup/moodle2','backup_stepslib.php',621]], 1],
'backup_main_structure_step': ['backup_main_structure_step', 'Structure step in charge of creating the main moodle_backup.xml file where all the information related to the backup, settings, license and ', [['backup/moodle2','backup_stepslib.php',1624]], 1],
'backup_questions_structure_step': ['backup_questions_structure_step', 'structure step in charge of constructing the questions.xml file for all the question categories and questions required by the backup and letters related to one activity ', [['backup/moodle2','backup_stepslib.php',2043]], 1],
'backup_final_scales_structure_step': ['backup_final_scales_structure_step', 'structure step that will generate the scales.xml containing the list of scales used along the whole backup process. ', [['backup/moodle2','backup_stepslib.php',656]], 1],
'backup_badges_structure_step': ['backup_badges_structure_step', 'structure step in charge of constructing the badges.xml file for all the badges found in a given context ', [['backup/moodle2','backup_stepslib.php',802]], 1],
'backup_annotate_all_user_files': ['backup_annotate_all_user_files', 'This step will generate all the file  annotations for the already annotated (final) users. Need to do this here because each user has its own context and structure tasks only are able to handle one context. Also, this step will guarantee that every user has its context created (req for other steps) ', [['backup/moodle2','backup_stepslib.php',2129]], 1],
'backup_final_outcomes_structure_step': ['backup_final_outcomes_structure_step', 'structure step that will generate the outcomes.xml containing the list of outcomes used along the whole backup process. ', [['backup/moodle2','backup_stepslib.php',692]], 1]};
CONST_DATA={
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',138],['','install.php',93],['lib','setup.php',386]], 3532]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
