<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /my/lib.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='my';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/my/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * My Moodle -- a user's personal dashboard</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * This file contains common functions for the dashboard and profile pages.</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> *</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @package    moodlecore</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @subpackage my</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @copyright  2010 Remote-Learner.net</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @author     Hubert Chathi &lt;hubert@remote-learner.net&gt;</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * @author     Olav Jordan &lt;olav.jordan@remote-learner.net&gt;</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> */</span>
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MY_PAGE_PUBLIC')" href="../_constants/MY_PAGE_PUBLIC.html" onMouseOver="constPopup(event,'MY_PAGE_PUBLIC')">MY_PAGE_PUBLIC</a>', 0);
<a name="l31"><span class="linenum">  31</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MY_PAGE_PRIVATE')" href="../_constants/MY_PAGE_PRIVATE.html" onMouseOver="constPopup(event,'MY_PAGE_PRIVATE')">MY_PAGE_PRIVATE</a>', 1);
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>/blocklib.php&quot;);
<a name="l34"><span class="linenum">  34</span></a>  
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment">/*</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * For a given user, this returns the $page information for their My Moodle page</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> *</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> */</span>
<a name="l39"><span class="linenum">  39</span></a>  function <a class="function" onClick="logFunction('my_get_page')" href="../_functions/my_get_page.html" onMouseOver="funcPopup(event,'my_get_page')">my_get_page</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>=<a class="constant" onClick="logConstant('MY_PAGE_PRIVATE')" href="../_constants/MY_PAGE_PRIVATE.html" onMouseOver="constPopup(event,'MY_PAGE_PRIVATE')">MY_PAGE_PRIVATE</a>) {
<a name="l40"><span class="linenum">  40</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>      if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forcedefaultmymoodle')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/forcedefaultmymoodle.html">forcedefaultmymoodle</a>) &amp;&amp; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {  // Ignore custom My Moodle pages if admin has forced them
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">        // Does the user have their own page defined?  If so, return it.</span>
<a name="l44"><span class="linenum">  44</span></a>          if (<a class="var it11605" onMouseOver="hilite(11605)" onMouseOut="lolite()" onClick="logVariable('customised')" href="../_variables/customised.html">$customised</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('my_pages', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'private' =&gt; <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>))) {
<a name="l45"><span class="linenum">  45</span></a>              return <a class="var it11605" onMouseOver="hilite(11605)" onMouseOut="lolite()" onClick="logVariable('customised')" href="../_variables/customised.html">$customised</a>;
<a name="l46"><span class="linenum">  46</span></a>          }
<a name="l47"><span class="linenum">  47</span></a>      }
<a name="l48"><span class="linenum">  48</span></a>  
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">    // Otherwise return the system default page</span>
<a name="l50"><span class="linenum">  50</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('my_pages', array('userid' =&gt; null, 'name' =&gt; '__default', 'private' =&gt; <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>));
<a name="l51"><span class="linenum">  51</span></a>  }
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">/*</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment"> * This copies a system default page to the current user</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment"> *</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment"> */</span>
<a name="l58"><span class="linenum">  58</span></a>  function <a class="function" onClick="logFunction('my_copy_page')" href="../_functions/my_copy_page.html" onMouseOver="funcPopup(event,'my_copy_page')">my_copy_page</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>=<a class="constant" onClick="logConstant('MY_PAGE_PRIVATE')" href="../_constants/MY_PAGE_PRIVATE.html" onMouseOver="constPopup(event,'MY_PAGE_PRIVATE')">MY_PAGE_PRIVATE</a>, <a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../_variables/pagetype.html">$pagetype</a>='my-index') {
<a name="l59"><span class="linenum">  59</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l60"><span class="linenum">  60</span></a>  
<a name="l61"><span class="linenum">  61</span></a>      if (<a class="var it11605" onMouseOver="hilite(11605)" onMouseOut="lolite()" onClick="logVariable('customised')" href="../_variables/customised.html">$customised</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('my_pages', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'private' =&gt; <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>))) {
<a name="l62"><span class="linenum">  62</span></a>          return <a class="var it11605" onMouseOver="hilite(11605)" onMouseOut="lolite()" onClick="logVariable('customised')" href="../_variables/customised.html">$customised</a>;  <span class="comment">// We're done!</span>
<a name="l63"><span class="linenum">  63</span></a>      }
<a name="l64"><span class="linenum">  64</span></a>  
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment">    // Get the system default page</span>
<a name="l66"><span class="linenum">  66</span></a>      if (!<a class="var it10014" onMouseOver="hilite(10014)" onMouseOut="lolite()" onClick="logVariable('systempage')" href="../_variables/systempage.html">$systempage</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('my_pages', array('userid' =&gt; null, 'private' =&gt; <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>))) {
<a name="l67"><span class="linenum">  67</span></a>          return false;  <span class="comment">// error</span>
<a name="l68"><span class="linenum">  68</span></a>      }
<a name="l69"><span class="linenum">  69</span></a>  
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">    // Clone the basic system page record</span>
<a name="l71"><span class="linenum">  71</span></a>      <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a> = <a class="function" onClick="logFunction('clone')" href="../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it10014" onMouseOver="hilite(10014)" onMouseOut="lolite()" onClick="logVariable('systempage')" href="../_variables/systempage.html">$systempage</a>);
<a name="l72"><span class="linenum">  72</span></a>      unset(<a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('id')" class="var it42985" onMouseOver="hilite(42985)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l73"><span class="linenum">  73</span></a>      <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('userid')" class="var it42985" onMouseOver="hilite(42985)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l74"><span class="linenum">  74</span></a>      <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('id')" class="var it42985" onMouseOver="hilite(42985)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('my_pages', <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>);
<a name="l75"><span class="linenum">  75</span></a>  
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">    // Clone ALL the associated blocks as well</span>
<a name="l77"><span class="linenum">  77</span></a>      <a class="var it221" onMouseOver="hilite(221)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l78"><span class="linenum">  78</span></a>      <a class="var it639" onMouseOver="hilite(639)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a> = <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>      <a class="var it11606" onMouseOver="hilite(11606)" onMouseOut="lolite()" onClick="logVariable('blockinstances')" href="../_variables/blockinstances.html">$blockinstances</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('block_instances', array('parentcontextid' =&gt; <a class="var it221" onMouseOver="hilite(221)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>-&gt;<a onClick="logVariable('id')" class="var it42913" onMouseOver="hilite(42913)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l81"><span class="linenum">  81</span></a>                                                                  'pagetypepattern' =&gt; <a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../_variables/pagetype.html">$pagetype</a>,
<a name="l82"><span class="linenum">  82</span></a>                                                                  'subpagepattern' =&gt; <a class="var it10014" onMouseOver="hilite(10014)" onMouseOut="lolite()" onClick="logVariable('systempage')" href="../_variables/systempage.html">$systempage</a>-&gt;<a onClick="logVariable('id')" class="var it42986" onMouseOver="hilite(42986)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l83"><span class="linenum">  83</span></a>      foreach (<a class="var it11606" onMouseOver="hilite(11606)" onMouseOut="lolite()" onClick="logVariable('blockinstances')" href="../_variables/blockinstances.html">$blockinstances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l84"><span class="linenum">  84</span></a>          <a class="var it11607" onMouseOver="hilite(11607)" onMouseOut="lolite()" onClick="logVariable('originalid')" href="../_variables/originalid.html">$originalid</a> = <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l85"><span class="linenum">  85</span></a>          unset(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l86"><span class="linenum">  86</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('parentcontextid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/parentcontextid.html">parentcontextid</a> = <a class="var it639" onMouseOver="hilite(639)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a>-&gt;<a onClick="logVariable('id')" class="var it43024" onMouseOver="hilite(43024)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l87"><span class="linenum">  87</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('subpagepattern')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/subpagepattern.html">subpagepattern</a> = <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('id')" class="var it42985" onMouseOver="hilite(42985)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l88"><span class="linenum">  88</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('block_instances', <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l89"><span class="linenum">  89</span></a>          <a class="var it11609" onMouseOver="hilite(11609)" onMouseOut="lolite()" onClick="logVariable('blockcontext')" href="../_variables/blockcontext.html">$blockcontext</a> = <a class="class" onClick="logClass('context_block')" href="../_classes/context_block.html" onMouseOver="classPopup(event,'context_block')">context_block</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);  <span class="comment">// Just creates the context record</span>
<a name="l90"><span class="linenum">  90</span></a>          <a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../_variables/block.html">$block</a> = <a class="function" onClick="logFunction('block_instance')" href="../_functions/block_instance.html" onMouseOver="funcPopup(event,'block_instance')">block_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('blockname')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/blockname.html">blockname</a>, <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l91"><span class="linenum">  91</span></a>          if (!<a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../_variables/block.html">$block</a>-&gt;<a class="function" onClick="logFunction('instance_copy')" href="../_functions/instance_copy.html" onMouseOver="funcPopup(event,'instance_copy')">instance_copy</a>(<a class="var it11607" onMouseOver="hilite(11607)" onMouseOut="lolite()" onClick="logVariable('originalid')" href="../_variables/originalid.html">$originalid</a>)) {
<a name="l92"><span class="linenum">  92</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Unable to copy block-specific data for original block instance: <a class="var it11607" onMouseOver="hilite(11607)" onMouseOut="lolite()" onClick="logVariable('originalid')" href="../_variables/originalid.html">$originalid</a>
<a name="l93"><span class="linenum">  93</span></a>                  to <span class="keyword">new </span><a class="class" onClick="logClass('block')" href="../_classes/block.html" onMouseOver="classPopup(event,'block')">block</a> instance: <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>&quot;, <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l94"><span class="linenum">  94</span></a>          }
<a name="l95"><span class="linenum">  95</span></a>      }
<a name="l96"><span class="linenum">  96</span></a>  
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">    // FIXME: block position overrides should be merged in with block instance</span>
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">    //$blockpositions = $DB-&gt;get_records('block_positions', array('subpage' =&gt; $page-&gt;name));</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment">    //foreach($blockpositions as $positions) {</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment">    //    $positions-&gt;subpage = $page-&gt;name;</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">    //    $DB-&gt;insert_record('block_positions', $tc);</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">    //}</span>
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>      return <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>;
<a name="l105"><span class="linenum"> 105</span></a>  }
<a name="l106"><span class="linenum"> 106</span></a>  
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment">/*</span>
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment"> * For a given user, this deletes their My Moodle page and returns them to the system default.</span>
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment"> *</span>
<a name="l110"><span class="linenum"> 110</span></a>  <span class="comment"> * @param int $userid the id of the user whose page should be reset</span>
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment"> * @param int $private either MY_PAGE_PRIVATE or MY_PAGE_PUBLIC</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment"> * @param string $pagetype either my-index or user-profile</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment"> * @return mixed system page, or false on error</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment"> */</span>
<a name="l115"><span class="linenum"> 115</span></a>  function <a class="function" onClick="logFunction('my_reset_page')" href="../_functions/my_reset_page.html" onMouseOver="funcPopup(event,'my_reset_page')">my_reset_page</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>=<a class="constant" onClick="logConstant('MY_PAGE_PRIVATE')" href="../_constants/MY_PAGE_PRIVATE.html" onMouseOver="constPopup(event,'MY_PAGE_PRIVATE')">MY_PAGE_PRIVATE</a>, <a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../_variables/pagetype.html">$pagetype</a>='my-index') {
<a name="l116"><span class="linenum"> 116</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l117"><span class="linenum"> 117</span></a>  
<a name="l118"><span class="linenum"> 118</span></a>      <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a> = <a class="function" onClick="logFunction('my_get_page')" href="../_functions/my_get_page.html" onMouseOver="funcPopup(event,'my_get_page')">my_get_page</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>);
<a name="l119"><span class="linenum"> 119</span></a>      if (<a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('userid')" class="var it42985" onMouseOver="hilite(42985)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> == <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l120"><span class="linenum"> 120</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l121"><span class="linenum"> 121</span></a>          if (<a class="var it3742" onMouseOver="hilite(3742)" onMouseOut="lolite()" onClick="logVariable('blocks')" href="../_variables/blocks.html">$blocks</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('block_instances', array('parentcontextid' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l122"><span class="linenum"> 122</span></a>                  'pagetypepattern' =&gt; <a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../_variables/pagetype.html">$pagetype</a>))) {
<a name="l123"><span class="linenum"> 123</span></a>              foreach (<a class="var it3742" onMouseOver="hilite(3742)" onMouseOut="lolite()" onClick="logVariable('blocks')" href="../_variables/blocks.html">$blocks</a> as <a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../_variables/block.html">$block</a>) {
<a name="l124"><span class="linenum"> 124</span></a>                  if (<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../_variables/block.html">$block</a>-&gt;<a onClick="logVariable('subpagepattern')" class="var it42983" onMouseOver="hilite(42983)" onMouseOut="lolite()" href="../_variables/subpagepattern.html">subpagepattern</a>) || <a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../_variables/block.html">$block</a>-&gt;<a onClick="logVariable('subpagepattern')" class="var it42983" onMouseOver="hilite(42983)" onMouseOut="lolite()" href="../_variables/subpagepattern.html">subpagepattern</a> == <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('id')" class="var it42985" onMouseOver="hilite(42985)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l125"><span class="linenum"> 125</span></a>                      <a class="function" onClick="logFunction('blocks_delete_instance')" href="../_functions/blocks_delete_instance.html" onMouseOver="funcPopup(event,'blocks_delete_instance')">blocks_delete_instance</a>(<a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../_variables/block.html">$block</a>);
<a name="l126"><span class="linenum"> 126</span></a>                  }
<a name="l127"><span class="linenum"> 127</span></a>              }
<a name="l128"><span class="linenum"> 128</span></a>          }
<a name="l129"><span class="linenum"> 129</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('my_pages', array('id' =&gt; <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('id')" class="var it42985" onMouseOver="hilite(42985)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l130"><span class="linenum"> 130</span></a>      }
<a name="l131"><span class="linenum"> 131</span></a>  
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">    // Get the system default page</span>
<a name="l133"><span class="linenum"> 133</span></a>      if (!<a class="var it10014" onMouseOver="hilite(10014)" onMouseOut="lolite()" onClick="logVariable('systempage')" href="../_variables/systempage.html">$systempage</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('my_pages', array('userid' =&gt; null, 'private' =&gt; <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>))) {
<a name="l134"><span class="linenum"> 134</span></a>          return false; <span class="comment">// error</span>
<a name="l135"><span class="linenum"> 135</span></a>      }
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment">    // Trigger dashboard has been reset event.</span>
<a name="l138"><span class="linenum"> 138</span></a>      <a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('eventparams')" href="../_variables/eventparams.html">$eventparams</a> = array('context' =&gt; <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>));
<a name="l139"><span class="linenum"> 139</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('dashboard_reset')" href="../_classes/dashboard_reset.html" onMouseOver="classPopup(event,'dashboard_reset')">dashboard_reset</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('eventparams')" href="../_variables/eventparams.html">$eventparams</a>);
<a name="l140"><span class="linenum"> 140</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l141"><span class="linenum"> 141</span></a>      return <a class="var it10014" onMouseOver="hilite(10014)" onMouseOut="lolite()" onClick="logVariable('systempage')" href="../_variables/systempage.html">$systempage</a>;
<a name="l142"><span class="linenum"> 142</span></a>  }
<a name="l143"><span class="linenum"> 143</span></a>  
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">/**</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment"> * Resets the page customisations for all users.</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment"> *</span>
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment"> * @param int $private Either MY_PAGE_PRIVATE or MY_PAGE_PUBLIC.</span>
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment"> * @param string $pagetype Either my-index or user-profile.</span>
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment"> * @return void</span>
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment"> */</span>
<a name="l151"><span class="linenum"> 151</span></a>  function <a class="function" onClick="logFunction('my_reset_page_for_all_users')" href="../_functions/my_reset_page_for_all_users.html" onMouseOver="funcPopup(event,'my_reset_page_for_all_users')">my_reset_page_for_all_users</a>(<a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a> = <a class="constant" onClick="logConstant('MY_PAGE_PRIVATE')" href="../_constants/MY_PAGE_PRIVATE.html" onMouseOver="constPopup(event,'MY_PAGE_PRIVATE')">MY_PAGE_PRIVATE</a>, <a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../_variables/pagetype.html">$pagetype</a> = 'my-index') {
<a name="l152"><span class="linenum"> 152</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l153"><span class="linenum"> 153</span></a>  
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">    // This may take a while. Raise the execution time limit.</span>
<a name="l155"><span class="linenum"> 155</span></a>      <a class="class" onClick="logClass('core_php_time_limit')" href="../_classes/core_php_time_limit.html" onMouseOver="classPopup(event,'core_php_time_limit')">core_php_time_limit</a>::<a class="function" onClick="logFunction('raise')" href="../_functions/raise.html" onMouseOver="funcPopup(event,'raise')">raise</a>();
<a name="l156"><span class="linenum"> 156</span></a>  
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment">    // Find all the user pages and all block instances in them.</span>
<a name="l158"><span class="linenum"> 158</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT bi.id
<a name="l159"><span class="linenum"> 159</span></a>          FROM {my_pages} p
<a name="l160"><span class="linenum"> 160</span></a>          JOIN {context} ctx ON ctx.instanceid = p.userid AND ctx.contextlevel = :usercontextlevel
<a name="l161"><span class="linenum"> 161</span></a>          JOIN {block_instances} bi ON bi.parentcontextid = ctx.id AND
<a name="l162"><span class="linenum"> 162</span></a>              bi.pagetypepattern = :pagetypepattern AND
<a name="l163"><span class="linenum"> 163</span></a>              (bi.subpagepattern IS NULL OR bi.subpagepattern = &quot; . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>(&quot;''&quot;, 'p.id') . &quot;)
<a name="l164"><span class="linenum"> 164</span></a>          WHERE p.private = :private&quot;;
<a name="l165"><span class="linenum"> 165</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('private' =&gt; <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>,
<a name="l166"><span class="linenum"> 166</span></a>          'usercontextlevel' =&gt; <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>,
<a name="l167"><span class="linenum"> 167</span></a>          'pagetypepattern' =&gt; <a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../_variables/pagetype.html">$pagetype</a>);
<a name="l168"><span class="linenum"> 168</span></a>      <a class="var it8298" onMouseOver="hilite(8298)" onMouseOut="lolite()" onClick="logVariable('blockids')" href="../_variables/blockids.html">$blockids</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_fieldset_sql')" href="../_functions/get_fieldset_sql.html" onMouseOver="funcPopup(event,'get_fieldset_sql')">get_fieldset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l169"><span class="linenum"> 169</span></a>  
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment">    // Wrap the SQL queries in a transaction.</span>
<a name="l171"><span class="linenum"> 171</span></a>      <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l172"><span class="linenum"> 172</span></a>  
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">    // Delete the block instances.</span>
<a name="l174"><span class="linenum"> 174</span></a>      if (!empty(<a class="var it8298" onMouseOver="hilite(8298)" onMouseOut="lolite()" onClick="logVariable('blockids')" href="../_variables/blockids.html">$blockids</a>)) {
<a name="l175"><span class="linenum"> 175</span></a>          <a class="function" onClick="logFunction('blocks_delete_instances')" href="../_functions/blocks_delete_instances.html" onMouseOver="funcPopup(event,'blocks_delete_instances')">blocks_delete_instances</a>(<a class="var it8298" onMouseOver="hilite(8298)" onMouseOut="lolite()" onClick="logVariable('blockids')" href="../_variables/blockids.html">$blockids</a>);
<a name="l176"><span class="linenum"> 176</span></a>      }
<a name="l177"><span class="linenum"> 177</span></a>  
<a name="l178"><span class="linenum"> 178</span></a>  <span class="comment">    // Finally delete the pages.</span>
<a name="l179"><span class="linenum"> 179</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('my_pages', 'userid IS NOT NULL AND private = :private', ['private' =&gt; <a class="var it11603" onMouseOver="hilite(11603)" onMouseOut="lolite()" onClick="logVariable('private')" href="../_variables/private.html">$private</a>]);
<a name="l180"><span class="linenum"> 180</span></a>  
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">    // We should be good to go now.</span>
<a name="l182"><span class="linenum"> 182</span></a>      <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">    // Trigger dashboard has been reset event.</span>
<a name="l185"><span class="linenum"> 185</span></a>      <a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('eventparams')" href="../_variables/eventparams.html">$eventparams</a> = array('context' =&gt; <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>());
<a name="l186"><span class="linenum"> 186</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('dashboards_reset')" href="../_classes/dashboards_reset.html" onMouseOver="classPopup(event,'dashboards_reset')">dashboards_reset</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('eventparams')" href="../_variables/eventparams.html">$eventparams</a>);
<a name="l187"><span class="linenum"> 187</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l188"><span class="linenum"> 188</span></a>  }
<a name="l189"><span class="linenum"> 189</span></a>  
<a name="l190"><span class="linenum"> 190</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('my_syspage_block_manager')" href="../_classes/my_syspage_block_manager.html" onMouseOver="classPopup(event,'my_syspage_block_manager')">my_syspage_block_manager</a> <span class="keyword">extends</span> <a class="class" onClick="logClass('block_manager')" href="../_classes/block_manager.html" onMouseOver="classPopup(event,'block_manager')">block_manager</a> {
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment">    // HACK WARNING!</span>
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment">    // TODO: figure out a better way to do this</span>
<a name="l193"><span class="linenum"> 193</span></a>      <span class="comment">/**</span>
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment">     * Load blocks using the system context, rather than the user's context.</span>
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">     *</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">     * This is needed because the My Moodle pages set the page context to the</span>
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment">     * user's context for access control, etc.  But the blocks for the system</span>
<a name="l198"><span class="linenum"> 198</span></a>  <span class="comment">     * pages are stored in the system context.</span>
<a name="l199"><span class="linenum"> 199</span></a>  <span class="comment">     */</span>
<a name="l200"><span class="linenum"> 200</span></a>      public function <a class="function" onClick="logFunction('load_blocks')" href="../_functions/load_blocks.html" onMouseOver="funcPopup(event,'load_blocks')">load_blocks</a>(<a class="var it11610" onMouseOver="hilite(11610)" onMouseOut="lolite()" onClick="logVariable('includeinvisible')" href="../_variables/includeinvisible.html">$includeinvisible</a> = null) {
<a name="l201"><span class="linenum"> 201</span></a>          <a class="var it11611" onMouseOver="hilite(11611)" onMouseOut="lolite()" onClick="logVariable('origcontext')" href="../_variables/origcontext.html">$origcontext</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('page')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/page.html">page</a>-&gt;context;
<a name="l202"><span class="linenum"> 202</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('page')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/page.html">page</a>-&gt;context = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l203"><span class="linenum"> 203</span></a>          parent::<a class="function" onClick="logFunction('load_blocks')" href="../_functions/load_blocks.html" onMouseOver="funcPopup(event,'load_blocks')">load_blocks</a>(<a class="var it11610" onMouseOver="hilite(11610)" onMouseOut="lolite()" onClick="logVariable('includeinvisible')" href="../_variables/includeinvisible.html">$includeinvisible</a>);
<a name="l204"><span class="linenum"> 204</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('page')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/page.html">page</a>-&gt;context = <a class="var it11611" onMouseOver="hilite(11611)" onMouseOut="lolite()" onClick="logVariable('origcontext')" href="../_variables/origcontext.html">$origcontext</a>;
<a name="l205"><span class="linenum"> 205</span></a>      }
<a name="l206"><span class="linenum"> 206</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'my_reset_page_for_all_users': ['my_reset_page_for_all_users', 'Resets the page customisations for all users. ', [['my','lib.php',144]], 3],
'delete_records_select': ['delete_records_select', '', [['lib/dml','pdo_moodle_database.php',208],['lib/dml','oci_native_moodle_database.php',1495],['lib/dml','pgsql_native_moodle_database.php',1162],['lib/dml','mssql_native_moodle_database.php',1146],['lib/dml','mysqli_native_moodle_database.php',1477],['lib/dml','sqlsrv_native_moodle_database.php',1220],['lib/dml/tests','dml_test.php',5553]], 163],
'clone': ['clone', '', [['lib/editor/tinymce/tiny_mce/3.5.11/plugins/media/js','media.js',11]], 370],
'my_get_page': ['my_get_page', '', [['my','lib.php',39]], 5],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',3012]], 1007],
'instance_copy': ['instance_copy', 'Copy any block-specific data when copying to a new block instance. ', [['blocks/html','block_html.php',107],['blocks','moodleblock.class.php',497]], 2],
'blocks_delete_instance': ['blocks_delete_instance', 'Delete a block, and associated data. ', [['lib','blocklib.php',2037]], 6],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'sql_concat': ['sql_concat', '', [['lib/dml','pdo_moodle_database.php',537],['lib/dml','oci_native_moodle_database.php',1602],['lib/dml','sqlite3_pdo_moodle_database.php',361],['lib/dml','pgsql_native_moodle_database.php',1225],['lib/dml','mssql_native_moodle_database.php',1258],['lib/dml','mysqli_native_moodle_database.php',1556],['lib/dml','sqlsrv_native_moodle_database.php',1324],['lib/dml/tests','dml_test.php',5554]], 74],
'allow_commit': ['allow_commit', 'Commit delegated transaction. The real database commit SQL is executed only after committing all delegated transactions. ', [['lib/dml','moodle_transaction.php',78]], 135],
'get_fieldset_sql': ['get_fieldset_sql', 'Selects rows and return values of first column as array. ', [['lib/dml','pdo_moodle_database.php',288],['lib/dml','oci_native_moodle_database.php',1196],['lib/dml','pgsql_native_moodle_database.php',799],['lib/dml','mssql_native_moodle_database.php',839],['lib/dml','mysqli_native_moodle_database.php',1106],['lib/dml','sqlsrv_native_moodle_database.php',925],['lib/dml/tests','dml_test.php',5546]], 58],
'start_delegated_transaction': ['start_delegated_transaction', 'On DBs that support it, switch to transaction mode and begin a transaction you\'ll need to ensure you call allow_commit() on the returned object or your changes *will* be lost. ', [['lib/dml','moodle_database.php',2393]], 145],
'blocks_delete_instances': ['blocks_delete_instances', 'Delete multiple blocks at once. ', [['lib','blocklib.php',2068]], 2],
'block_instance': ['block_instance', 'Creates a new instance of the specified block class. ', [['lib','blocklib.php',1672]], 13],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'load_blocks': ['load_blocks', 'Load blocks using the system context, rather than the user\'s context. ', [['my','lib.php',193],['lib','blocklib.php',536]], 15],
'raise': ['raise', 'Sets the PHP time limit to a number of seconds from now. ', [['lib/classes','php_time_limit.php',41]], 90],
'my_reset_page': ['my_reset_page', '', [['my','lib.php',115]], 3],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'my_copy_page': ['my_copy_page', '', [['my','lib.php',58]], 2],
'is_null': ['is_null', '', [], 2003],
'define': ['define', '', [], 2373]};
CLASS_DATA={
'context_block': ['context_block', 'Block context class ', [['lib','accesslib.php',7281]], 30],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'context_user': ['context_user', 'User context class ', [['lib','accesslib.php',6398]], 414],
'my_syspage_block_manager': ['my_syspage_block_manager', '', [['my','lib.php',190]], 0],
'dashboard_reset': ['dashboard_reset', 'Dashboard reset event class. ', [['lib/classes/event','dashboard_reset.php',28]], 1],
'dashboards_reset': ['dashboards_reset', 'Dashboards reset event class. ', [['lib/classes/event','dashboards_reset.php',28]], 1],
'core_php_time_limit': ['core_php_time_limit', 'Utility class to manage PHP time limit. ', [['lib/classes','php_time_limit.php',27]], 92],
'block': ['block', 'Class for page side blocks ', [['lib/classes/plugininfo','block.php',30],['blocks/rss_client/classes/output','block.php',30]], 5],
'block_manager': ['block_manager', 'This class keeps track of the block that should appear on a moodle_page. ', [['lib','blocklib.php',67]], 6]};
CONST_DATA={
'DEBUG_DEVELOPER': ['DEBUG_DEVELOPER', '', [['lib','setuplib.php',40]], 736],
'MY_PAGE_PRIVATE': ['MY_PAGE_PRIVATE', '', [['my','lib.php',31]], 10],
'CONTEXT_USER': ['CONTEXT_USER', '', [['lib','accesslib.php',144]], 123],
'MY_PAGE_PUBLIC': ['MY_PAGE_PUBLIC', '', [['my','lib.php',30]], 6]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
