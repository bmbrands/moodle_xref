<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /blocks/rss_client/tests/cron_test.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='blocks/rss_client/tests';
filename='cron_test.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/blocks/rss_client/tests/</a> -> <a href="cron_test.php.html">cron_test.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="cron_test.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="cron_test.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * PHPunit tests for rss client cron.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    block_rss_client</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright  2015 University of Nottingham</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @author     Neill Magill &lt;neill.magill@nottingham.ac.uk&gt;</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l26"><span class="linenum">  26</span></a>  <span class="keyword">require_once</span> <a class="filename" href="../../../blocks/moodleblock.class.php.html" onMouseOver="reqPopup(event, 'moodleblock.class.php', '../../../blocks/moodleblock.class.php')">(__DIR__ . '/../../moodleblock.class.php')</a>;
<a name="l27"><span class="linenum">  27</span></a>  <span class="keyword">require_once</span> <a class="filename" href="../../../blocks/rss_client/block_rss_client.php.html" onMouseOver="reqPopup(event, 'block_rss_client.php', '../../../blocks/rss_client/block_rss_client.php')">(__DIR__ . '/../block_rss_client.php')</a>;
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment">/**</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * Class for the PHPunit tests for rss client cron.</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> *</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * @package    block_rss_client</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * @copyright  2015 Universit of Nottingham</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * @author     Neill Magill &lt;neill.magill@nottingham.ac.uk&gt;</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> */</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('block_rss_client_cron_testcase')" href="../../../_classes/block_rss_client_cron_testcase.html" onMouseOver="classPopup(event,'block_rss_client_cron_testcase')">block_rss_client_cron_testcase</a> extends advanced_testcase {
<a name="l38"><span class="linenum">  38</span></a>      <span class="comment">/**</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">     * Test that when a record has a skipuntil time that is greater</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">     * than the current time the attempt is skipped.</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">     */</span>
<a name="l42"><span class="linenum">  42</span></a>      public function <a class="function" onClick="logFunction('test_skip')" href="../../../_functions/test_skip.html" onMouseOver="funcPopup(event,'test_skip')">test_skip</a>() {
<a name="l43"><span class="linenum">  43</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>;
<a name="l44"><span class="linenum">  44</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('resetAfterTest')" href="../../../_functions/resetaftertest.html" onMouseOver="funcPopup(event,'resetaftertest')">resetAfterTest</a>();
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">        // Create a RSS feed record with a skip until time set to the future.</span>
<a name="l46"><span class="linenum">  46</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a> = (object) array(
<a name="l47"><span class="linenum">  47</span></a>              'userid' =&gt; 1,
<a name="l48"><span class="linenum">  48</span></a>              'title' =&gt; 'Skip test feed',
<a name="l49"><span class="linenum">  49</span></a>              'preferredtitle' =&gt; '',
<a name="l50"><span class="linenum">  50</span></a>              'description' =&gt; 'A feed to test the skip time.',
<a name="l51"><span class="linenum">  51</span></a>              'shared' =&gt; 0,
<a name="l52"><span class="linenum">  52</span></a>              'url' =&gt; 'http://example.com/rss',
<a name="l53"><span class="linenum">  53</span></a>              'skiptime' =&gt; 330,
<a name="l54"><span class="linenum">  54</span></a>              'skipuntil' =&gt; <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() + 300,
<a name="l55"><span class="linenum">  55</span></a>          );
<a name="l56"><span class="linenum">  56</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('block_rss_client', <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>);
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>          <a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../../_variables/block.html">$block</a> = <span class="keyword">new </span><a class="class" onClick="logClass('block_rss_client')" href="../../../_classes/block_rss_client.html" onMouseOver="classPopup(event,'block_rss_client')">block_rss_client</a>();
<a name="l59"><span class="linenum">  59</span></a>          <a class="phpfunction" onClick="logFunction('ob_start')" href="../../../_functions/ob_start.html" onMouseOver="phpfuncPopup(event,'ob_start')">ob_start</a>();
<a name="l60"><span class="linenum">  60</span></a>  
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">        // Silence SimplePie php notices.</span>
<a name="l62"><span class="linenum">  62</span></a>          <a class="var it11316" onMouseOver="hilite(11316)" onMouseOut="lolite()" onClick="logVariable('errorlevel')" href="../../../_variables/errorlevel.html">$errorlevel</a> = <a class="phpfunction" onClick="logFunction('error_reporting')" href="../../../_functions/error_reporting.html" onMouseOver="phpfuncPopup(event,'error_reporting')">error_reporting</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('debug')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/debug.html">debug</a> &amp; ~E_USER_NOTICE);
<a name="l63"><span class="linenum">  63</span></a>          <a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../../_variables/block.html">$block</a>-&gt;<a class="function" onClick="logFunction('cron')" href="../../../_functions/cron.html" onMouseOver="funcPopup(event,'cron')">cron</a>();
<a name="l64"><span class="linenum">  64</span></a>          <a class="phpfunction" onClick="logFunction('error_reporting')" href="../../../_functions/error_reporting.html" onMouseOver="phpfuncPopup(event,'error_reporting')">error_reporting</a>(<a class="var it11316" onMouseOver="hilite(11316)" onMouseOut="lolite()" onClick="logVariable('errorlevel')" href="../../../_variables/errorlevel.html">$errorlevel</a>);
<a name="l65"><span class="linenum">  65</span></a>  
<a name="l66"><span class="linenum">  66</span></a>          <a class="var it29492" onMouseOver="hilite(29492)" onMouseOut="lolite()" onClick="logVariable('cronoutput')" href="../../../_variables/cronoutput.html">$cronoutput</a> = <a class="phpfunction" onClick="logFunction('ob_get_clean')" href="../../../_functions/ob_get_clean.html" onMouseOver="phpfuncPopup(event,'ob_get_clean')">ob_get_clean</a>();
<a name="l67"><span class="linenum">  67</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertContains('skipping until ' . <a class="function" onClick="logFunction('userdate')" href="../../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('skipuntil')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../_variables/skipuntil.html">skipuntil</a>), <a class="var it29492" onMouseOver="hilite(29492)" onMouseOut="lolite()" onClick="logVariable('cronoutput')" href="../../../_variables/cronoutput.html">$cronoutput</a>);
<a name="l68"><span class="linenum">  68</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertContains('0 feeds refreshed (took ', <a class="var it29492" onMouseOver="hilite(29492)" onMouseOut="lolite()" onClick="logVariable('cronoutput')" href="../../../_variables/cronoutput.html">$cronoutput</a>);
<a name="l69"><span class="linenum">  69</span></a>      }
<a name="l70"><span class="linenum">  70</span></a>  
<a name="l71"><span class="linenum">  71</span></a>      <span class="comment">/**</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment">     * Test that when a feed has an error the skip time is increaed correctly.</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment">     */</span>
<a name="l74"><span class="linenum">  74</span></a>      public function <a class="function" onClick="logFunction('test_error')" href="../../../_functions/test_error.html" onMouseOver="funcPopup(event,'test_error')">test_error</a>() {
<a name="l75"><span class="linenum">  75</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>;
<a name="l76"><span class="linenum">  76</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('resetAfterTest')" href="../../../_functions/resetaftertest.html" onMouseOver="funcPopup(event,'resetaftertest')">resetAfterTest</a>();
<a name="l77"><span class="linenum">  77</span></a>          <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../../_variables/time.html">$time</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">        // A record that has failed before.</span>
<a name="l79"><span class="linenum">  79</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a> = (object) array(
<a name="l80"><span class="linenum">  80</span></a>              'userid' =&gt; 1,
<a name="l81"><span class="linenum">  81</span></a>              'title' =&gt; 'Skip test feed',
<a name="l82"><span class="linenum">  82</span></a>              'preferredtitle' =&gt; '',
<a name="l83"><span class="linenum">  83</span></a>              'description' =&gt; 'A feed to test the skip time.',
<a name="l84"><span class="linenum">  84</span></a>              'shared' =&gt; 0,
<a name="l85"><span class="linenum">  85</span></a>              'url' =&gt; 'http://example.com/rss',
<a name="l86"><span class="linenum">  86</span></a>              'skiptime' =&gt; 330,
<a name="l87"><span class="linenum">  87</span></a>              'skipuntil' =&gt; <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../../_variables/time.html">$time</a> - 300,
<a name="l88"><span class="linenum">  88</span></a>          );
<a name="l89"><span class="linenum">  89</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('block_rss_client', <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>);
<a name="l90"><span class="linenum">  90</span></a>  
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment">        // A record that has not failed before.</span>
<a name="l92"><span class="linenum">  92</span></a>          <a class="var it4920" onMouseOver="hilite(4920)" onMouseOut="lolite()" onClick="logVariable('record2')" href="../../../_variables/record2.html">$record2</a> = (object) array(
<a name="l93"><span class="linenum">  93</span></a>              'userid' =&gt; 1,
<a name="l94"><span class="linenum">  94</span></a>              'title' =&gt; 'Skip test feed',
<a name="l95"><span class="linenum">  95</span></a>              'preferredtitle' =&gt; '',
<a name="l96"><span class="linenum">  96</span></a>              'description' =&gt; 'A feed to test the skip time.',
<a name="l97"><span class="linenum">  97</span></a>              'shared' =&gt; 0,
<a name="l98"><span class="linenum">  98</span></a>              'url' =&gt; 'http://example.com/rss2',
<a name="l99"><span class="linenum">  99</span></a>              'skiptime' =&gt; 0,
<a name="l100"><span class="linenum"> 100</span></a>              'skipuntil' =&gt; 0,
<a name="l101"><span class="linenum"> 101</span></a>          );
<a name="l102"><span class="linenum"> 102</span></a>          <a class="var it4920" onMouseOver="hilite(4920)" onMouseOut="lolite()" onClick="logVariable('record2')" href="../../../_variables/record2.html">$record2</a>-&gt;<a onClick="logVariable('id')" class="var it43191" onMouseOver="hilite(43191)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('block_rss_client', <a class="var it4920" onMouseOver="hilite(4920)" onMouseOut="lolite()" onClick="logVariable('record2')" href="../../../_variables/record2.html">$record2</a>);
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment">        // A record that is near the maximum wait time.</span>
<a name="l105"><span class="linenum"> 105</span></a>          <a class="var it29494" onMouseOver="hilite(29494)" onMouseOut="lolite()" onClick="logVariable('record3')" href="../../../_variables/record3.html">$record3</a> = (object) array(
<a name="l106"><span class="linenum"> 106</span></a>              'userid' =&gt; 1,
<a name="l107"><span class="linenum"> 107</span></a>              'title' =&gt; 'Skip test feed',
<a name="l108"><span class="linenum"> 108</span></a>              'preferredtitle' =&gt; '',
<a name="l109"><span class="linenum"> 109</span></a>              'description' =&gt; 'A feed to test the skip time.',
<a name="l110"><span class="linenum"> 110</span></a>              'shared' =&gt; 0,
<a name="l111"><span class="linenum"> 111</span></a>              'url' =&gt; 'http://example.com/rss3',
<a name="l112"><span class="linenum"> 112</span></a>              'skiptime' =&gt; <a class="class" onClick="logClass('block_rss_client')" href="../../../_classes/block_rss_client.html" onMouseOver="classPopup(event,'block_rss_client')">block_rss_client</a>::CLIENT_MAX_SKIPTIME - 5,
<a name="l113"><span class="linenum"> 113</span></a>              'skipuntil' =&gt; <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../../_variables/time.html">$time</a> - 1,
<a name="l114"><span class="linenum"> 114</span></a>          );
<a name="l115"><span class="linenum"> 115</span></a>          <a class="var it29494" onMouseOver="hilite(29494)" onMouseOut="lolite()" onClick="logVariable('record3')" href="../../../_variables/record3.html">$record3</a>-&gt;<a onClick="logVariable('id')" class="var it43482" onMouseOver="hilite(43482)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('block_rss_client', <a class="var it29494" onMouseOver="hilite(29494)" onMouseOut="lolite()" onClick="logVariable('record3')" href="../../../_variables/record3.html">$record3</a>);
<a name="l116"><span class="linenum"> 116</span></a>  
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">        // Run the cron.</span>
<a name="l118"><span class="linenum"> 118</span></a>          <a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../../_variables/block.html">$block</a> = <span class="keyword">new </span><a class="class" onClick="logClass('block_rss_client')" href="../../../_classes/block_rss_client.html" onMouseOver="classPopup(event,'block_rss_client')">block_rss_client</a>();
<a name="l119"><span class="linenum"> 119</span></a>          <a class="phpfunction" onClick="logFunction('ob_start')" href="../../../_functions/ob_start.html" onMouseOver="phpfuncPopup(event,'ob_start')">ob_start</a>();
<a name="l120"><span class="linenum"> 120</span></a>  
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">        // Silence SimplePie php notices.</span>
<a name="l122"><span class="linenum"> 122</span></a>          <a class="var it11316" onMouseOver="hilite(11316)" onMouseOut="lolite()" onClick="logVariable('errorlevel')" href="../../../_variables/errorlevel.html">$errorlevel</a> = <a class="phpfunction" onClick="logFunction('error_reporting')" href="../../../_functions/error_reporting.html" onMouseOver="phpfuncPopup(event,'error_reporting')">error_reporting</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('debug')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/debug.html">debug</a> &amp; ~E_USER_NOTICE);
<a name="l123"><span class="linenum"> 123</span></a>          <a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../../_variables/block.html">$block</a>-&gt;<a class="function" onClick="logFunction('cron')" href="../../../_functions/cron.html" onMouseOver="funcPopup(event,'cron')">cron</a>();
<a name="l124"><span class="linenum"> 124</span></a>          <a class="phpfunction" onClick="logFunction('error_reporting')" href="../../../_functions/error_reporting.html" onMouseOver="phpfuncPopup(event,'error_reporting')">error_reporting</a>(<a class="var it11316" onMouseOver="hilite(11316)" onMouseOut="lolite()" onClick="logVariable('errorlevel')" href="../../../_variables/errorlevel.html">$errorlevel</a>);
<a name="l125"><span class="linenum"> 125</span></a>  
<a name="l126"><span class="linenum"> 126</span></a>          <a class="var it29492" onMouseOver="hilite(29492)" onMouseOut="lolite()" onClick="logVariable('cronoutput')" href="../../../_variables/cronoutput.html">$cronoutput</a> = <a class="phpfunction" onClick="logFunction('ob_get_clean')" href="../../../_functions/ob_get_clean.html" onMouseOver="phpfuncPopup(event,'ob_get_clean')">ob_get_clean</a>();
<a name="l127"><span class="linenum"> 127</span></a>          <a class="var it29495" onMouseOver="hilite(29495)" onMouseOut="lolite()" onClick="logVariable('skiptime1')" href="../../../_variables/skiptime1.html">$skiptime1</a> = <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('skiptime')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../_variables/skiptime.html">skiptime</a> * 2;
<a name="l128"><span class="linenum"> 128</span></a>          <a class="var it7842" onMouseOver="hilite(7842)" onMouseOut="lolite()" onClick="logVariable('message1')" href="../../../_variables/message1.html">$message1</a> = 'http://example.com/rss Error: could not load/find the RSS feed - skipping for ' . <a class="var it29495" onMouseOver="hilite(29495)" onMouseOut="lolite()" onClick="logVariable('skiptime1')" href="../../../_variables/skiptime1.html">$skiptime1</a> . ' seconds.';
<a name="l129"><span class="linenum"> 129</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertContains(<a class="var it7842" onMouseOver="hilite(7842)" onMouseOut="lolite()" onClick="logVariable('message1')" href="../../../_variables/message1.html">$message1</a>, <a class="var it29492" onMouseOver="hilite(29492)" onMouseOut="lolite()" onClick="logVariable('cronoutput')" href="../../../_variables/cronoutput.html">$cronoutput</a>);
<a name="l130"><span class="linenum"> 130</span></a>          <a class="var it29497" onMouseOver="hilite(29497)" onMouseOut="lolite()" onClick="logVariable('skiptime2')" href="../../../_variables/skiptime2.html">$skiptime2</a> = 330; <span class="comment">// Assumes that the cron time in the version file is 300.</span>
<a name="l131"><span class="linenum"> 131</span></a>          <a class="var it7843" onMouseOver="hilite(7843)" onMouseOut="lolite()" onClick="logVariable('message2')" href="../../../_variables/message2.html">$message2</a> = 'http://example.com/rss2 Error: could not load/find the RSS feed - skipping for ' . <a class="var it29497" onMouseOver="hilite(29497)" onMouseOut="lolite()" onClick="logVariable('skiptime2')" href="../../../_variables/skiptime2.html">$skiptime2</a> . ' seconds.';
<a name="l132"><span class="linenum"> 132</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertContains(<a class="var it7843" onMouseOver="hilite(7843)" onMouseOut="lolite()" onClick="logVariable('message2')" href="../../../_variables/message2.html">$message2</a>, <a class="var it29492" onMouseOver="hilite(29492)" onMouseOut="lolite()" onClick="logVariable('cronoutput')" href="../../../_variables/cronoutput.html">$cronoutput</a>);
<a name="l133"><span class="linenum"> 133</span></a>          <a class="var it29498" onMouseOver="hilite(29498)" onMouseOut="lolite()" onClick="logVariable('skiptime3')" href="../../../_variables/skiptime3.html">$skiptime3</a> = <a class="class" onClick="logClass('block_rss_client')" href="../../../_classes/block_rss_client.html" onMouseOver="classPopup(event,'block_rss_client')">block_rss_client</a>::CLIENT_MAX_SKIPTIME;
<a name="l134"><span class="linenum"> 134</span></a>          <a class="var it7847" onMouseOver="hilite(7847)" onMouseOut="lolite()" onClick="logVariable('message3')" href="../../../_variables/message3.html">$message3</a> = 'http://example.com/rss3 Error: could not load/find the RSS feed - skipping for ' . <a class="var it29498" onMouseOver="hilite(29498)" onMouseOut="lolite()" onClick="logVariable('skiptime3')" href="../../../_variables/skiptime3.html">$skiptime3</a> . ' seconds.';
<a name="l135"><span class="linenum"> 135</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertContains(<a class="var it7847" onMouseOver="hilite(7847)" onMouseOut="lolite()" onClick="logVariable('message3')" href="../../../_variables/message3.html">$message3</a>, <a class="var it29492" onMouseOver="hilite(29492)" onMouseOut="lolite()" onClick="logVariable('cronoutput')" href="../../../_variables/cronoutput.html">$cronoutput</a>);
<a name="l136"><span class="linenum"> 136</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertContains('0 feeds refreshed (took ', <a class="var it29492" onMouseOver="hilite(29492)" onMouseOut="lolite()" onClick="logVariable('cronoutput')" href="../../../_variables/cronoutput.html">$cronoutput</a>);
<a name="l137"><span class="linenum"> 137</span></a>  
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment">        // Test that the records have been correctly updated.</span>
<a name="l139"><span class="linenum"> 139</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../../_variables/newrecord.html">$newrecord</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('block_rss_client', array('id' =&gt; <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l140"><span class="linenum"> 140</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertAttributeEquals(<a class="var it29495" onMouseOver="hilite(29495)" onMouseOut="lolite()" onClick="logVariable('skiptime1')" href="../../../_variables/skiptime1.html">$skiptime1</a>, 'skiptime', <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../../_variables/newrecord.html">$newrecord</a>);
<a name="l141"><span class="linenum"> 141</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertAttributeGreaterThanOrEqual(<a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../../_variables/time.html">$time</a> + <a class="var it29495" onMouseOver="hilite(29495)" onMouseOut="lolite()" onClick="logVariable('skiptime1')" href="../../../_variables/skiptime1.html">$skiptime1</a>, 'skipuntil', <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../../_variables/newrecord.html">$newrecord</a>);
<a name="l142"><span class="linenum"> 142</span></a>          <a class="var it29499" onMouseOver="hilite(29499)" onMouseOut="lolite()" onClick="logVariable('newrecord2')" href="../../../_variables/newrecord2.html">$newrecord2</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('block_rss_client', array('id' =&gt; <a class="var it4920" onMouseOver="hilite(4920)" onMouseOut="lolite()" onClick="logVariable('record2')" href="../../../_variables/record2.html">$record2</a>-&gt;<a onClick="logVariable('id')" class="var it43191" onMouseOver="hilite(43191)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l143"><span class="linenum"> 143</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertAttributeEquals(<a class="var it29497" onMouseOver="hilite(29497)" onMouseOut="lolite()" onClick="logVariable('skiptime2')" href="../../../_variables/skiptime2.html">$skiptime2</a>, 'skiptime', <a class="var it29499" onMouseOver="hilite(29499)" onMouseOut="lolite()" onClick="logVariable('newrecord2')" href="../../../_variables/newrecord2.html">$newrecord2</a>);
<a name="l144"><span class="linenum"> 144</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertAttributeGreaterThanOrEqual(<a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../../_variables/time.html">$time</a> + <a class="var it29497" onMouseOver="hilite(29497)" onMouseOut="lolite()" onClick="logVariable('skiptime2')" href="../../../_variables/skiptime2.html">$skiptime2</a>, 'skipuntil', <a class="var it29499" onMouseOver="hilite(29499)" onMouseOut="lolite()" onClick="logVariable('newrecord2')" href="../../../_variables/newrecord2.html">$newrecord2</a>);
<a name="l145"><span class="linenum"> 145</span></a>          <a class="var it29500" onMouseOver="hilite(29500)" onMouseOut="lolite()" onClick="logVariable('newrecord3')" href="../../../_variables/newrecord3.html">$newrecord3</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('block_rss_client', array('id' =&gt; <a class="var it29494" onMouseOver="hilite(29494)" onMouseOut="lolite()" onClick="logVariable('record3')" href="../../../_variables/record3.html">$record3</a>-&gt;<a onClick="logVariable('id')" class="var it43482" onMouseOver="hilite(43482)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l146"><span class="linenum"> 146</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertAttributeEquals(<a class="var it29498" onMouseOver="hilite(29498)" onMouseOut="lolite()" onClick="logVariable('skiptime3')" href="../../../_variables/skiptime3.html">$skiptime3</a>, 'skiptime', <a class="var it29500" onMouseOver="hilite(29500)" onMouseOut="lolite()" onClick="logVariable('newrecord3')" href="../../../_variables/newrecord3.html">$newrecord3</a>);
<a name="l147"><span class="linenum"> 147</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;assertAttributeGreaterThanOrEqual(<a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../../_variables/time.html">$time</a> + <a class="var it29498" onMouseOver="hilite(29498)" onMouseOut="lolite()" onClick="logVariable('skiptime3')" href="../../../_variables/skiptime3.html">$skiptime3</a>, 'skipuntil', <a class="var it29500" onMouseOver="hilite(29500)" onMouseOut="lolite()" onClick="logVariable('newrecord3')" href="../../../_variables/newrecord3.html">$newrecord3</a>);
<a name="l148"><span class="linenum"> 148</span></a>      }
<a name="l149"><span class="linenum"> 149</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'cron': ['cron', 'Find user\'s who have completed this criteria ', [['completion/criteria','completion_criteria_course.php',152],['enrol/manual','lib.php',284],['admin/registration','lib.php',50],['question/engine','bank.php',415],['completion/criteria','completion_criteria_date.php',144],['repository/dropbox','lib.php',704],['lib/classes/update','checker.php',193],['enrol/imsenterprise','lib.php',87],['lib','enrollib.php',1980],['repository','lib.php',2357],['auth/mnet','auth.php',832],['enrol/self','lib.php',423],['cache/classes','helper.php',659],['enrol/cohort','lib.php',164],['lib/filestorage','file_storage.php',2494],['enrol/category','lib.php',77],['mod/assign','assignmentplugin.php',534],['mod/assign','locallib.php',1880],['completion/criteria','completion_criteria_grade.php',185],['blocks/recent_activity','block_recent_activity.php',231],['completion/criteria','completion_criteria_activity.php',198],['enrol/paypal','lib.php',303],['completion/criteria','completion_criteria_duration.php',197],['blocks/rss_client','block_rss_client.php',262],['enrol/meta','lib.php',206]], 71],
'resetaftertest': ['resetaftertest', 'Reset everything after current test. ', [['lib/phpunit/classes','advanced_testcase.php',246]], 1528],
'test_skip': ['test_skip', 'Test that when a record has a skipuntil time that is greater than the current time the attempt is skipped. ', [['blocks/rss_client/tests','cron_test.php',38]], 0],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'test_error': ['test_error', 'Test that when a feed has an error the skip time is increaed correctly. ', [['blocks/rss_client/tests','cron_test.php',71]], 0],
'userdate': ['userdate', 'Returns a formatted string that represents a date in user time. ', [['lib','moodlelib.php',2155],['lib/adodb','adodb.inc.php',2842],['lib/adodb','adodb.inc.php',3569]], 525],
'error_reporting': ['error_reporting', '', [], 91],
'ob_get_clean': ['ob_get_clean', '', [], 29],
'ob_start': ['ob_start', '', [], 101],
'defined': ['defined', '', [], 4731],
'time': ['time', '', [], 1959]};
CLASS_DATA={
'block_rss_client': ['block_rss_client', 'A block which displays Remote feeds ', [['blocks/rss_client','block_rss_client.php',24]], 5],
'block_rss_client_cron_testcase': ['block_rss_client_cron_testcase', 'Class for the PHPunit tests for rss client cron. ', [['blocks/rss_client/tests','cron_test.php',29]], 0]};
CONST_DATA={
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
