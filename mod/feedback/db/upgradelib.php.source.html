<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mod/feedback/db/upgradelib.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='mod/feedback/db';
filename='upgradelib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mod/feedback/db/</a> -> <a href="upgradelib.php.html">upgradelib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="upgradelib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="upgradelib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Upgrade helper functions</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package   mod_feedback</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright 2016 Marina Glancy</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment">/**</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * Fill new field courseid in tables feedback_completed or feedback_completedtmp</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> *</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @param bool $tmp use for temporary table</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> */</span>
<a name="l32"><span class="linenum">  32</span></a>  function <a class="function" onClick="logFunction('mod_feedback_upgrade_courseid')" href="../../../_functions/mod_feedback_upgrade_courseid.html" onMouseOver="funcPopup(event,'mod_feedback_upgrade_courseid')">mod_feedback_upgrade_courseid</a>(<a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../../../_variables/tmp.html">$tmp</a> = false) {
<a name="l33"><span class="linenum">  33</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l34"><span class="linenum">  34</span></a>      <a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a> = <a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../../../_variables/tmp.html">$tmp</a> ? 'tmp' : '';
<a name="l35"><span class="linenum">  35</span></a>  
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment">    // Part 1. Ensure that each completed record has associated values with only one courseid.</span>
<a name="l37"><span class="linenum">  37</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT c.id
<a name="l38"><span class="linenum">  38</span></a>          FROM {feedback_completed<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>} c, {feedback_value<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>} v
<a name="l39"><span class="linenum">  39</span></a>          WHERE c.id = v.completed
<a name="l40"><span class="linenum">  40</span></a>          GROUP by c.id
<a name="l41"><span class="linenum">  41</span></a>          having <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(DISTINCT v.course_id) &gt; 1&quot;;
<a name="l42"><span class="linenum">  42</span></a>      <a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_fieldset_sql')" href="../../../_functions/get_fieldset_sql.html" onMouseOver="funcPopup(event,'get_fieldset_sql')">get_fieldset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>);
<a name="l43"><span class="linenum">  43</span></a>      foreach (<a class="var it3177" onMouseOver="hilite(3177)" onMouseOut="lolite()" onClick="logVariable('problems')" href="../../../_variables/problems.html">$problems</a> as <a class="var it10727" onMouseOver="hilite(10727)" onMouseOut="lolite()" onClick="logVariable('problem')" href="../../../_variables/problem.html">$problem</a>) {
<a name="l44"><span class="linenum">  44</span></a>          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../../_variables/courses.html">$courses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_fieldset_sql')" href="../../../_functions/get_fieldset_sql.html" onMouseOver="funcPopup(event,'get_fieldset_sql')">get_fieldset_sql</a>(&quot;SELECT DISTINCT course_id &quot;
<a name="l45"><span class="linenum">  45</span></a>                  . &quot;FROM {feedback_value<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>} WHERE completed = ?&quot;, array(<a class="var it10727" onMouseOver="hilite(10727)" onMouseOut="lolite()" onClick="logVariable('problem')" href="../../../_variables/problem.html">$problem</a>));
<a name="l46"><span class="linenum">  46</span></a>          <a class="var it21146" onMouseOver="hilite(21146)" onMouseOut="lolite()" onClick="logVariable('firstcourse')" href="../../../_variables/firstcourse.html">$firstcourse</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../../_variables/courses.html">$courses</a>);
<a name="l47"><span class="linenum">  47</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('feedback_completed'.<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>, array('id' =&gt; <a class="var it10727" onMouseOver="hilite(10727)" onMouseOut="lolite()" onClick="logVariable('problem')" href="../../../_variables/problem.html">$problem</a>));
<a name="l48"><span class="linenum">  48</span></a>          unset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l49"><span class="linenum">  49</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('feedback_completed'.<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>, ['id' =&gt; <a class="var it10727" onMouseOver="hilite(10727)" onMouseOut="lolite()" onClick="logVariable('problem')" href="../../../_variables/problem.html">$problem</a>, 'courseid' =&gt; <a class="var it21146" onMouseOver="hilite(21146)" onMouseOut="lolite()" onClick="logVariable('firstcourse')" href="../../../_variables/firstcourse.html">$firstcourse</a>]);
<a name="l50"><span class="linenum">  50</span></a>          foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../../_variables/courses.html">$courses</a> as <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>) {
<a name="l51"><span class="linenum">  51</span></a>              <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('courseid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../_variables/courseid.html">courseid</a> = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>;
<a name="l52"><span class="linenum">  52</span></a>              <a class="var it1431" onMouseOver="hilite(1431)" onMouseOut="lolite()" onClick="logVariable('completedid')" href="../../../_variables/completedid.html">$completedid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('feedback_completed'.<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>);
<a name="l53"><span class="linenum">  53</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;UPDATE {feedback_value<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>} SET completed = ? WHERE completed = ? AND course_id = ?&quot;,
<a name="l54"><span class="linenum">  54</span></a>                      array(<a class="var it1431" onMouseOver="hilite(1431)" onMouseOut="lolite()" onClick="logVariable('completedid')" href="../../../_variables/completedid.html">$completedid</a>, <a class="var it10727" onMouseOver="hilite(10727)" onMouseOut="lolite()" onClick="logVariable('problem')" href="../../../_variables/problem.html">$problem</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>));
<a name="l55"><span class="linenum">  55</span></a>          }
<a name="l56"><span class="linenum">  56</span></a>      }
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment">    // Part 2. Update courseid in the completed table.</span>
<a name="l59"><span class="linenum">  59</span></a>      if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_dbfamily')" href="../../../_functions/get_dbfamily.html" onMouseOver="funcPopup(event,'get_dbfamily')">get_dbfamily</a>() !== 'mysql') {
<a name="l60"><span class="linenum">  60</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;UPDATE {feedback_completed<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>} &quot;
<a name="l61"><span class="linenum">  61</span></a>              . &quot;SET courseid = (SELECT COALESCE(<a class="phpfunction" onClick="logFunction('MIN')" href="../../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">MIN</a>(v.course_id), 0) &quot;
<a name="l62"><span class="linenum">  62</span></a>              . &quot;FROM {feedback_value<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>} v &quot;
<a name="l63"><span class="linenum">  63</span></a>              . &quot;WHERE v.completed = {feedback_completed<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>}.id)&quot;;
<a name="l64"><span class="linenum">  64</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>);
<a name="l65"><span class="linenum">  65</span></a>      } else {
<a name="l66"><span class="linenum">  66</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;UPDATE {feedback_completed<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>} c, {feedback_value<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>} v &quot;
<a name="l67"><span class="linenum">  67</span></a>              . &quot;SET c.courseid = v.course_id &quot;
<a name="l68"><span class="linenum">  68</span></a>              . &quot;WHERE v.completed = c.id AND v.course_id &lt;&gt; 0&quot;;
<a name="l69"><span class="linenum">  69</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>);
<a name="l70"><span class="linenum">  70</span></a>      }
<a name="l71"><span class="linenum">  71</span></a>  }
<a name="l72"><span class="linenum">  72</span></a>  
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment">/**</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment"> * Ensure tables feedback_value and feedback_valuetmp have unique entries for each pair (completed,item).</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment"> *</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment"> * @param bool $tmp use for temporary table</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment"> */</span>
<a name="l78"><span class="linenum">  78</span></a>  function <a class="function" onClick="logFunction('mod_feedback_upgrade_delete_duplicate_values')" href="../../../_functions/mod_feedback_upgrade_delete_duplicate_values.html" onMouseOver="funcPopup(event,'mod_feedback_upgrade_delete_duplicate_values')">mod_feedback_upgrade_delete_duplicate_values</a>(<a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../../../_variables/tmp.html">$tmp</a> = false) {
<a name="l79"><span class="linenum">  79</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l80"><span class="linenum">  80</span></a>      <a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a> = <a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../../../_variables/tmp.html">$tmp</a> ? 'tmp' : '';
<a name="l81"><span class="linenum">  81</span></a>  
<a name="l82"><span class="linenum">  82</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('MIN')" href="../../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">MIN</a>(id) AS id, completed, item, course_id &quot; .
<a name="l83"><span class="linenum">  83</span></a>              &quot;FROM {feedback_value<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>} GROUP BY completed, item, course_id HAVING <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(id)&gt;1&quot;;
<a name="l84"><span class="linenum">  84</span></a>      <a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>);
<a name="l85"><span class="linenum">  85</span></a>      foreach (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> as <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>) {
<a name="l86"><span class="linenum">  86</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>(&quot;feedback_value<a class="var it4927" onMouseOver="hilite(4927)" onMouseOut="lolite()" onClick="logVariable('suffix')" href="../../../_variables/suffix.html">$suffix</a>&quot;,
<a name="l87"><span class="linenum">  87</span></a>              &quot;completed = :completed AND item = :item AND course_id = :course_id AND id &gt; :id&quot;, (array)<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../_variables/record.html">$record</a>);
<a name="l88"><span class="linenum">  88</span></a>      }
<a name="l89"><span class="linenum">  89</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'mod_feedback_upgrade_delete_duplicate_values': ['mod_feedback_upgrade_delete_duplicate_values', 'Ensure tables feedback_value and feedback_valuetmp have unique entries for each pair (completed,item). ', [['mod/feedback/db','upgradelib.php',73]], 8],
'get_fieldset_sql': ['get_fieldset_sql', 'Selects rows and return values of first column as array. ', [['lib/dml','pdo_moodle_database.php',288],['lib/dml','oci_native_moodle_database.php',1196],['lib/dml','pgsql_native_moodle_database.php',799],['lib/dml','mssql_native_moodle_database.php',839],['lib/dml','mysqli_native_moodle_database.php',1106],['lib/dml','sqlsrv_native_moodle_database.php',925],['lib/dml/tests','dml_test.php',5546]], 58],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'delete_records_select': ['delete_records_select', '', [['lib/dml','pdo_moodle_database.php',208],['lib/dml','oci_native_moodle_database.php',1495],['lib/dml','pgsql_native_moodle_database.php',1162],['lib/dml','mssql_native_moodle_database.php',1146],['lib/dml','mysqli_native_moodle_database.php',1477],['lib/dml','sqlsrv_native_moodle_database.php',1220],['lib/dml/tests','dml_test.php',5553]], 163],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'get_dbfamily': ['get_dbfamily', 'Returns database family type - describes SQL dialect Note: can be used before connect() ', [['lib/dml','oci_native_moodle_database.php',67],['lib/dml','sqlite3_pdo_moodle_database.php',50],['lib/dml','pgsql_native_moodle_database.php',60],['lib/dml','mssql_native_moodle_database.php',61],['lib/dml','mysqli_native_moodle_database.php',117],['lib/dml','sqlsrv_native_moodle_database.php',81],['lib/dml/tests','dml_test.php',5527]], 54],
'mod_feedback_upgrade_courseid': ['mod_feedback_upgrade_courseid', 'Fill new field courseid in tables feedback_completed or feedback_completedtmp ', [['mod/feedback/db','upgradelib.php',27]], 11],
'execute': ['execute', 'Run langpack update ', [['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['backup/converter/imscc1','lib.php',84],['lib/classes/task','blog_cron_task.php',40],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/dml','pdo_moodle_database.php',227],['lib/classes/task','tag_cron_task.php',42],['enrol/imsenterprise/classes/task','cron_task.php',43],['lib/classes/task','completion_daily_task.php',42],['lib/google/src/Google/Http','Batch.php',61],['lib/dml','oci_native_moodle_database.php',1048],['lib/classes/task','context_cleanup_task.php',41],['backup/util/plan','backup_structure_step.class.php',50],['backup/util/ui','restore_ui.class.php',206],['webservice','lib.php',1319],['lib/classes/task','stats_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['lib/classes/task','legacy_plugin_cron_task.php',42],['backup/moodle2','restore_activity_task.class.php',189],['lib/classes/task','portfolio_cron_task.php',40],['lib/google/src/Google/Http','REST.php',27],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['backup/converter/imscc11','backuplib.php',42],['lib/classes/task','question_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',62],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/adodb/drivers','adodb-pdo.inc.php',559],['lib/editor/atto/classes/task','autosave_cleanup_task.php',42],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',43],['lib/classes/task','completion_regular_task.php',42],['lib/adodb/drivers','adodb-oci8po.inc.php',54],['lib/classes/task','events_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',47],['auth/cas/classes/task','sync_task.php',43],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',43],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['backup/util/helper','restore_decode_processor.class.php',73],['lib/behat','behat_base.php',840],['enrol/flatfile/classes/task','flatfile_sync_task.php',46],['lib/classes/task','registration_cron_task.php',40],['backup/moodle2','backup_section_task.class.php',97],['lib/classes/task','check_for_updates_task.php',40],['backup/util/plan/tests/fixtures','plan_fixtures.php',48],['backup/util/plan/tests/fixtures','plan_fixtures.php',56],['mod/forum/classes/task','cron_task.php',39],['lib/classes/task','send_failed_login_notifications_task.php',43],['enrol/lti/classes/task','sync_grades.php',45],['lib/dml','pgsql_native_moodle_database.php',665],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/classes/update','validator.php',117],['lib/google/src/Google','Client.php',574],['lib/dml','mssql_native_moodle_database.php',711],['mod/lti/service/profile/classes/local/resource','profile.php',76],['backup/util/plan','backup_plan.class.php',112],['lib/dml','mysqli_native_moodle_database.php',963],['backup/util/ui','backup_ui.class.php',122],['admin/tool/monitor/classes/task','clean_events.php',41],['backup/converter/moodle1','backuplib.php',10],['backup/converter/imscc11','lib.php',85],['lib/classes/task','grade_cron_task.php',40],['lib/classes/task','file_temp_cleanup_task.php',40],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['filter/tex','latex.php',70],['lib/adodb','adodb.inc.php',1088],['lib/classes/task','plagiarism_cron_task.php',40],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['backup/converter/moodle1','lib.php',142],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','search_index_task.php',44],['enrol/lti/classes/task','sync_members.php',55],['lib/classes/task','session_cleanup_task.php',40],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['lib/classes/task','backup_cleanup_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','badges_cron_task.php',40],['admin/tool/uploadcourse/classes','processor.php',174],['lib/classes/task','calendar_cron_task.php',40],['backup/util/plan','base_plan.class.php',158],['auth/ldap/classes/task','sync_task.php',43],['lib/adodb/drivers','adodb-oci8.inc.php',920],['backup/util/plan','restore_plan.class.php',159],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['lib/dml','sqlsrv_native_moodle_database.php',795],['lib/classes/task','create_contexts_task.php',40],['lib/classes/task','file_trash_cleanup_task.php',40],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',46],['lib/classes/task','complete_plans_task.php',52],['lib/classes/task','messaging_cleanup_task.php',40],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','cache_cleanup_task.php',40],['backup/moodle2','backup_activity_task.class.php',211],['filter/tex','texdebug.php',287],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','search_optimize_task.php',47],['mod/assign','adminlib.php',342],['lib/classes/task','delete_incomplete_users_task.php',40],['lib/classes/task','automated_backup_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','restore_execution_step.class.php',25],['lib/classes/task','sync_plans_from_template_cohorts_task.php',50],['admin/tool/monitor/classes','notification_task.php',39],['lib/dml/tests','dml_test.php',5543],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',60],['admin/tool/monitor/classes/task','check_subscriptions.php',60],['backup/util/interfaces','executable.class.php',32],['backup/util/plan','base_task.class.php',162]], 1058],
'count': ['count', '', [], 4095],
'min': ['min', '', [], 898],
'array_shift': ['array_shift', '', [], 700],
'defined': ['defined', '', [], 4731]};
CLASS_DATA={
};
CONST_DATA={
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
