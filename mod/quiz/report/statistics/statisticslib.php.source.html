<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mod/quiz/report/statistics/statisticslib.php source</title>
    <link rel="stylesheet" href="../../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../../';
subdir='mod/quiz/report/statistics';
filename='statisticslib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mod/quiz/report/statistics/</a> -> <a href="statisticslib.php.html">statisticslib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="statisticslib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="statisticslib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Common functions for the quiz statistics report.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    quiz_statistics</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright  2013 The Open University</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @author     James Pratt me@jamiep.org</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment">/**</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * SQL to fetch relevant 'quiz_attempts' records.</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> *</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * @param int    $quizid        quiz id to get attempts for</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @param array  $groupstudents empty array if not using groups or array of students in current group.</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * @param string $whichattempts which attempts to use, represented internally as one of the constants as used in</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> *                                   $quiz-&gt;grademethod ie.</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> *                                   QUIZ_GRADEAVERAGE, QUIZ_GRADEHIGHEST, QUIZ_ATTEMPTLAST or QUIZ_ATTEMPTFIRST</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> *                                   we calculate stats based on which attempts would affect the grade for each student.</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * @param bool   $includeungraded whether to fetch ungraded attempts too</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * @return array FROM and WHERE sql fragments and sql params</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> */</span>
<a name="l38"><span class="linenum">  38</span></a>  function <a class="function" onClick="logFunction('quiz_statistics_attempts_sql')" href="../../../../_functions/quiz_statistics_attempts_sql.html" onMouseOver="funcPopup(event,'quiz_statistics_attempts_sql')">quiz_statistics_attempts_sql</a>(<a class="var it932" onMouseOver="hilite(932)" onMouseOut="lolite()" onClick="logVariable('quizid')" href="../../../../_variables/quizid.html">$quizid</a>, <a class="var it3801" onMouseOver="hilite(3801)" onMouseOut="lolite()" onClick="logVariable('groupstudents')" href="../../../../_variables/groupstudents.html">$groupstudents</a>, <a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('whichattempts')" href="../../../../_variables/whichattempts.html">$whichattempts</a> = <a class="constant" onClick="logConstant('QUIZ_GRADEAVERAGE')" href="../../../../_constants/QUIZ_GRADEAVERAGE.html" onMouseOver="constPopup(event,'QUIZ_GRADEAVERAGE')">QUIZ_GRADEAVERAGE</a>, <a class="var it35588" onMouseOver="hilite(35588)" onMouseOut="lolite()" onClick="logVariable('includeungraded')" href="../../../../_variables/includeungraded.html">$includeungraded</a> = false) {
<a name="l39"><span class="linenum">  39</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l40"><span class="linenum">  40</span></a>  
<a name="l41"><span class="linenum">  41</span></a>      <a class="var it10440" onMouseOver="hilite(10440)" onMouseOut="lolite()" onClick="logVariable('fromqa')" href="../../../../_variables/fromqa.html">$fromqa</a> = '{quiz_attempts} quiza ';
<a name="l42"><span class="linenum">  42</span></a>  
<a name="l43"><span class="linenum">  43</span></a>      <a class="var it10441" onMouseOver="hilite(10441)" onMouseOut="lolite()" onClick="logVariable('whereqa')" href="../../../../_variables/whereqa.html">$whereqa</a> = 'quiza.quiz = :quizid AND quiza.preview = 0 AND quiza.state = :quizstatefinished';
<a name="l44"><span class="linenum">  44</span></a>      <a class="var it10442" onMouseOver="hilite(10442)" onMouseOut="lolite()" onClick="logVariable('qaparams')" href="../../../../_variables/qaparams.html">$qaparams</a> = array('quizid' =&gt; (int)<a class="var it932" onMouseOver="hilite(932)" onMouseOut="lolite()" onClick="logVariable('quizid')" href="../../../../_variables/quizid.html">$quizid</a>, 'quizstatefinished' =&gt; <a class="class" onClick="logClass('quiz_attempt')" href="../../../../_classes/quiz_attempt.html" onMouseOver="classPopup(event,'quiz_attempt')">quiz_attempt</a>::FINISHED);
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>      if (<a class="var it3801" onMouseOver="hilite(3801)" onMouseOut="lolite()" onClick="logVariable('groupstudents')" href="../../../../_variables/groupstudents.html">$groupstudents</a>) {
<a name="l47"><span class="linenum">  47</span></a>          <a class="phpfunction" onClick="logFunction('ksort')" href="../../../../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it3801" onMouseOver="hilite(3801)" onMouseOut="lolite()" onClick="logVariable('groupstudents')" href="../../../../_variables/groupstudents.html">$groupstudents</a>);
<a name="l48"><span class="linenum">  48</span></a>          <a class="function" onClick="logFunction('list')" href="../../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it35589" onMouseOver="hilite(35589)" onMouseOut="lolite()" onClick="logVariable('grpsql')" href="../../../../_variables/grpsql.html">$grpsql</a>, <a class="var it29146" onMouseOver="hilite(29146)" onMouseOut="lolite()" onClick="logVariable('grpparams')" href="../../../../_variables/grpparams.html">$grpparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="phpfunction" onClick="logFunction('array_keys')" href="../../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it3801" onMouseOver="hilite(3801)" onMouseOut="lolite()" onClick="logVariable('groupstudents')" href="../../../../_variables/groupstudents.html">$groupstudents</a>),
<a name="l49"><span class="linenum">  49</span></a>                  <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'statsuser');
<a name="l50"><span class="linenum">  50</span></a>          <a class="function" onClick="logFunction('list')" href="../../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it35589" onMouseOver="hilite(35589)" onMouseOut="lolite()" onClick="logVariable('grpsql')" href="../../../../_variables/grpsql.html">$grpsql</a>, <a class="var it29146" onMouseOver="hilite(29146)" onMouseOut="lolite()" onClick="logVariable('grpparams')" href="../../../../_variables/grpparams.html">$grpparams</a>) = <a class="function" onClick="logFunction('quiz_statistics_renumber_placeholders')" href="../../../../_functions/quiz_statistics_renumber_placeholders.html" onMouseOver="funcPopup(event,'quiz_statistics_renumber_placeholders')">quiz_statistics_renumber_placeholders</a>(
<a name="l51"><span class="linenum">  51</span></a>                  <a class="var it35589" onMouseOver="hilite(35589)" onMouseOut="lolite()" onClick="logVariable('grpsql')" href="../../../../_variables/grpsql.html">$grpsql</a>, <a class="var it29146" onMouseOver="hilite(29146)" onMouseOut="lolite()" onClick="logVariable('grpparams')" href="../../../../_variables/grpparams.html">$grpparams</a>, 'statsuser');
<a name="l52"><span class="linenum">  52</span></a>          <a class="var it10441" onMouseOver="hilite(10441)" onMouseOut="lolite()" onClick="logVariable('whereqa')" href="../../../../_variables/whereqa.html">$whereqa</a> .= &quot; AND quiza.userid <a class="var it35589" onMouseOver="hilite(35589)" onMouseOut="lolite()" onClick="logVariable('grpsql')" href="../../../../_variables/grpsql.html">$grpsql</a>&quot;;
<a name="l53"><span class="linenum">  53</span></a>          <a class="var it10442" onMouseOver="hilite(10442)" onMouseOut="lolite()" onClick="logVariable('qaparams')" href="../../../../_variables/qaparams.html">$qaparams</a> += <a class="var it29146" onMouseOver="hilite(29146)" onMouseOut="lolite()" onClick="logVariable('grpparams')" href="../../../../_variables/grpparams.html">$grpparams</a>;
<a name="l54"><span class="linenum">  54</span></a>      }
<a name="l55"><span class="linenum">  55</span></a>  
<a name="l56"><span class="linenum">  56</span></a>      <a class="var it35590" onMouseOver="hilite(35590)" onMouseOut="lolite()" onClick="logVariable('whichattemptsql')" href="../../../../_variables/whichattemptsql.html">$whichattemptsql</a> = <a class="function" onClick="logFunction('quiz_report_grade_method_sql')" href="../../../../_functions/quiz_report_grade_method_sql.html" onMouseOver="funcPopup(event,'quiz_report_grade_method_sql')">quiz_report_grade_method_sql</a>(<a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('whichattempts')" href="../../../../_variables/whichattempts.html">$whichattempts</a>);
<a name="l57"><span class="linenum">  57</span></a>      if (<a class="var it35590" onMouseOver="hilite(35590)" onMouseOut="lolite()" onClick="logVariable('whichattemptsql')" href="../../../../_variables/whichattemptsql.html">$whichattemptsql</a>) {
<a name="l58"><span class="linenum">  58</span></a>          <a class="var it10441" onMouseOver="hilite(10441)" onMouseOut="lolite()" onClick="logVariable('whereqa')" href="../../../../_variables/whereqa.html">$whereqa</a> .= ' AND '.<a class="var it35590" onMouseOver="hilite(35590)" onMouseOut="lolite()" onClick="logVariable('whichattemptsql')" href="../../../../_variables/whichattemptsql.html">$whichattemptsql</a>;
<a name="l59"><span class="linenum">  59</span></a>      }
<a name="l60"><span class="linenum">  60</span></a>  
<a name="l61"><span class="linenum">  61</span></a>      if (!<a class="var it35588" onMouseOver="hilite(35588)" onMouseOut="lolite()" onClick="logVariable('includeungraded')" href="../../../../_variables/includeungraded.html">$includeungraded</a>) {
<a name="l62"><span class="linenum">  62</span></a>          <a class="var it10441" onMouseOver="hilite(10441)" onMouseOut="lolite()" onClick="logVariable('whereqa')" href="../../../../_variables/whereqa.html">$whereqa</a> .= ' AND quiza.sumgrades IS NOT NULL';
<a name="l63"><span class="linenum">  63</span></a>      }
<a name="l64"><span class="linenum">  64</span></a>  
<a name="l65"><span class="linenum">  65</span></a>      return array(<a class="var it10440" onMouseOver="hilite(10440)" onMouseOut="lolite()" onClick="logVariable('fromqa')" href="../../../../_variables/fromqa.html">$fromqa</a>, <a class="var it10441" onMouseOver="hilite(10441)" onMouseOut="lolite()" onClick="logVariable('whereqa')" href="../../../../_variables/whereqa.html">$whereqa</a>, <a class="var it10442" onMouseOver="hilite(10442)" onMouseOut="lolite()" onClick="logVariable('qaparams')" href="../../../../_variables/qaparams.html">$qaparams</a>);
<a name="l66"><span class="linenum">  66</span></a>  }
<a name="l67"><span class="linenum">  67</span></a>  
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">/**</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment"> * Re-number all the params beginning with $paramprefix in a fragment of SQL.</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment"> *</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment"> * @param string $sql the SQL.</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment"> * @param array $params the params.</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment"> * @param string $paramprefix the parameter prefix.</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment"> * @return array with two elements, the modified SQL, and the modified params.</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment"> */</span>
<a name="l76"><span class="linenum">  76</span></a>  function <a class="function" onClick="logFunction('quiz_statistics_renumber_placeholders')" href="../../../../_functions/quiz_statistics_renumber_placeholders.html" onMouseOver="funcPopup(event,'quiz_statistics_renumber_placeholders')">quiz_statistics_renumber_placeholders</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a>, <a class="var it35591" onMouseOver="hilite(35591)" onMouseOut="lolite()" onClick="logVariable('paramprefix')" href="../../../../_variables/paramprefix.html">$paramprefix</a>) {
<a name="l77"><span class="linenum">  77</span></a>      <a class="var it35592" onMouseOver="hilite(35592)" onMouseOut="lolite()" onClick="logVariable('basenumber')" href="../../../../_variables/basenumber.html">$basenumber</a> = null;
<a name="l78"><span class="linenum">  78</span></a>      <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('newparams')" href="../../../../_variables/newparams.html">$newparams</a> = array();
<a name="l79"><span class="linenum">  79</span></a>      <a class="var it4661" onMouseOver="hilite(4661)" onMouseOut="lolite()" onClick="logVariable('newsql')" href="../../../../_variables/newsql.html">$newsql</a> = <a class="phpfunction" onClick="logFunction('preg_replace_callback')" href="../../../../_functions/preg_replace_callback.html" onMouseOver="phpfuncPopup(event,'preg_replace_callback')">preg_replace_callback</a>('~:' . <a class="phpfunction" onClick="logFunction('preg_quote')" href="../../../../_functions/preg_quote.html" onMouseOver="phpfuncPopup(event,'preg_quote')">preg_quote</a>(<a class="var it35591" onMouseOver="hilite(35591)" onMouseOut="lolite()" onClick="logVariable('paramprefix')" href="../../../../_variables/paramprefix.html">$paramprefix</a>, '~') . '(\d+)\b~',
<a name="l80"><span class="linenum">  80</span></a>              function(<a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../../_variables/match.html">$match</a>) use (<a class="var it35591" onMouseOver="hilite(35591)" onMouseOut="lolite()" onClick="logVariable('paramprefix')" href="../../../../_variables/paramprefix.html">$paramprefix</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a>, &amp;<a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('newparams')" href="../../../../_variables/newparams.html">$newparams</a>, &amp;<a class="var it35592" onMouseOver="hilite(35592)" onMouseOut="lolite()" onClick="logVariable('basenumber')" href="../../../../_variables/basenumber.html">$basenumber</a>) {
<a name="l81"><span class="linenum">  81</span></a>                  if (<a class="var it35592" onMouseOver="hilite(35592)" onMouseOut="lolite()" onClick="logVariable('basenumber')" href="../../../../_variables/basenumber.html">$basenumber</a> === null) {
<a name="l82"><span class="linenum">  82</span></a>                      <a class="var it35592" onMouseOver="hilite(35592)" onMouseOut="lolite()" onClick="logVariable('basenumber')" href="../../../../_variables/basenumber.html">$basenumber</a> = <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../../_variables/match.html">$match</a>[1] - 1;
<a name="l83"><span class="linenum">  83</span></a>                  }
<a name="l84"><span class="linenum">  84</span></a>                  <a class="var it10729" onMouseOver="hilite(10729)" onMouseOut="lolite()" onClick="logVariable('oldname')" href="../../../../_variables/oldname.html">$oldname</a> = <a class="var it35591" onMouseOver="hilite(35591)" onMouseOut="lolite()" onClick="logVariable('paramprefix')" href="../../../../_variables/paramprefix.html">$paramprefix</a> . <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../../_variables/match.html">$match</a>[1];
<a name="l85"><span class="linenum">  85</span></a>                  <a class="var it225" onMouseOver="hilite(225)" onMouseOut="lolite()" onClick="logVariable('newname')" href="../../../../_variables/newname.html">$newname</a> = <a class="var it35591" onMouseOver="hilite(35591)" onMouseOut="lolite()" onClick="logVariable('paramprefix')" href="../../../../_variables/paramprefix.html">$paramprefix</a> . (<a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../../_variables/match.html">$match</a>[1] - <a class="var it35592" onMouseOver="hilite(35592)" onMouseOut="lolite()" onClick="logVariable('basenumber')" href="../../../../_variables/basenumber.html">$basenumber</a>);
<a name="l86"><span class="linenum">  86</span></a>                  <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('newparams')" href="../../../../_variables/newparams.html">$newparams</a>[<a class="var it225" onMouseOver="hilite(225)" onMouseOut="lolite()" onClick="logVariable('newname')" href="../../../../_variables/newname.html">$newname</a>] = <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a>[<a class="var it10729" onMouseOver="hilite(10729)" onMouseOut="lolite()" onClick="logVariable('oldname')" href="../../../../_variables/oldname.html">$oldname</a>];
<a name="l87"><span class="linenum">  87</span></a>                  return ':' . <a class="var it225" onMouseOver="hilite(225)" onMouseOut="lolite()" onClick="logVariable('newname')" href="../../../../_variables/newname.html">$newname</a>;
<a name="l88"><span class="linenum">  88</span></a>              }, <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../../_variables/sql.html">$sql</a>);
<a name="l89"><span class="linenum">  89</span></a>  
<a name="l90"><span class="linenum">  90</span></a>      return array(<a class="var it4661" onMouseOver="hilite(4661)" onMouseOut="lolite()" onClick="logVariable('newsql')" href="../../../../_variables/newsql.html">$newsql</a>, <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('newparams')" href="../../../../_variables/newparams.html">$newparams</a>);
<a name="l91"><span class="linenum">  91</span></a>  }
<a name="l92"><span class="linenum">  92</span></a>  
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">/**</span>
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment"> * Return a {@link qubaid_condition} from the values returned by {@link quiz_statistics_attempts_sql}.</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment"> *</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment"> * @param int     $quizid</span>
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment"> * @param array   $groupstudents</span>
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment"> * @param string $whichattempts which attempts to use, represented internally as one of the constants as used in</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment"> *                                   $quiz-&gt;grademethod ie.</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment"> *                                   QUIZ_GRADEAVERAGE, QUIZ_GRADEHIGHEST, QUIZ_ATTEMPTLAST or QUIZ_ATTEMPTFIRST</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment"> *                                   we calculate stats based on which attempts would affect the grade for each student.</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment"> * @param bool    $includeungraded</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment"> * @return        \qubaid_join</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment"> */</span>
<a name="l105"><span class="linenum"> 105</span></a>  function <a class="function" onClick="logFunction('quiz_statistics_qubaids_condition')" href="../../../../_functions/quiz_statistics_qubaids_condition.html" onMouseOver="funcPopup(event,'quiz_statistics_qubaids_condition')">quiz_statistics_qubaids_condition</a>(<a class="var it932" onMouseOver="hilite(932)" onMouseOut="lolite()" onClick="logVariable('quizid')" href="../../../../_variables/quizid.html">$quizid</a>, <a class="var it3801" onMouseOver="hilite(3801)" onMouseOut="lolite()" onClick="logVariable('groupstudents')" href="../../../../_variables/groupstudents.html">$groupstudents</a>, <a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('whichattempts')" href="../../../../_variables/whichattempts.html">$whichattempts</a> = <a class="constant" onClick="logConstant('QUIZ_GRADEAVERAGE')" href="../../../../_constants/QUIZ_GRADEAVERAGE.html" onMouseOver="constPopup(event,'QUIZ_GRADEAVERAGE')">QUIZ_GRADEAVERAGE</a>, <a class="var it35588" onMouseOver="hilite(35588)" onMouseOut="lolite()" onClick="logVariable('includeungraded')" href="../../../../_variables/includeungraded.html">$includeungraded</a> = false) {
<a name="l106"><span class="linenum"> 106</span></a>      <a class="function" onClick="logFunction('list')" href="../../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it10440" onMouseOver="hilite(10440)" onMouseOut="lolite()" onClick="logVariable('fromqa')" href="../../../../_variables/fromqa.html">$fromqa</a>, <a class="var it10441" onMouseOver="hilite(10441)" onMouseOut="lolite()" onClick="logVariable('whereqa')" href="../../../../_variables/whereqa.html">$whereqa</a>, <a class="var it10442" onMouseOver="hilite(10442)" onMouseOut="lolite()" onClick="logVariable('qaparams')" href="../../../../_variables/qaparams.html">$qaparams</a>) = <a class="function" onClick="logFunction('quiz_statistics_attempts_sql')" href="../../../../_functions/quiz_statistics_attempts_sql.html" onMouseOver="funcPopup(event,'quiz_statistics_attempts_sql')">quiz_statistics_attempts_sql</a>(<a class="var it932" onMouseOver="hilite(932)" onMouseOut="lolite()" onClick="logVariable('quizid')" href="../../../../_variables/quizid.html">$quizid</a>, <a class="var it3801" onMouseOver="hilite(3801)" onMouseOut="lolite()" onClick="logVariable('groupstudents')" href="../../../../_variables/groupstudents.html">$groupstudents</a>, <a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('whichattempts')" href="../../../../_variables/whichattempts.html">$whichattempts</a>, <a class="var it35588" onMouseOver="hilite(35588)" onMouseOut="lolite()" onClick="logVariable('includeungraded')" href="../../../../_variables/includeungraded.html">$includeungraded</a>);
<a name="l107"><span class="linenum"> 107</span></a>      return <span class="keyword">new </span><a class="class" onClick="logClass('qubaid_join')" href="../../../../_classes/qubaid_join.html" onMouseOver="classPopup(event,'qubaid_join')">qubaid_join</a>(<a class="var it10440" onMouseOver="hilite(10440)" onMouseOut="lolite()" onClick="logVariable('fromqa')" href="../../../../_variables/fromqa.html">$fromqa</a>, 'quiza.uniqueid', <a class="var it10441" onMouseOver="hilite(10441)" onMouseOut="lolite()" onClick="logVariable('whereqa')" href="../../../../_variables/whereqa.html">$whereqa</a>, <a class="var it10442" onMouseOver="hilite(10442)" onMouseOut="lolite()" onClick="logVariable('qaparams')" href="../../../../_variables/qaparams.html">$qaparams</a>);
<a name="l108"><span class="linenum"> 108</span></a>  }
<a name="l109"><span class="linenum"> 109</span></a>  
<a name="l110"><span class="linenum"> 110</span></a>  <span class="comment">/**</span>
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment"> * This helper function returns a sequence of colours each time it is called.</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment"> * Used for choosing colours for graph data series.</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment"> * @return string colour name.</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment"> * @deprecated since Moodle 3.2</span>
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment"> */</span>
<a name="l116"><span class="linenum"> 116</span></a>  function <a class="function" onClick="logFunction('quiz_statistics_graph_get_new_colour')" href="../../../../_functions/quiz_statistics_graph_get_new_colour.html" onMouseOver="funcPopup(event,'quiz_statistics_graph_get_new_colour')">quiz_statistics_graph_get_new_colour</a>() {
<a name="l117"><span class="linenum"> 117</span></a>      <a class="function" onClick="logFunction('debugging')" href="../../../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('The function <a class="function" onClick="logFunction('quiz_statistics_graph_get_new_colour')" href="../../../../_functions/quiz_statistics_graph_get_new_colour.html" onMouseOver="funcPopup(event,'quiz_statistics_graph_get_new_colour')">quiz_statistics_graph_get_new_colour</a>() is deprecated, please do not use it any more. '
<a name="l118"><span class="linenum"> 118</span></a>          . 'Colours will be handled by the charting library directly.', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l119"><span class="linenum"> 119</span></a>  
<a name="l120"><span class="linenum"> 120</span></a>      static <a class="var it35593" onMouseOver="hilite(35593)" onMouseOut="lolite()" onClick="logVariable('colourindex')" href="../../../../_variables/colourindex.html">$colourindex</a> = -1;
<a name="l121"><span class="linenum"> 121</span></a>      <a class="var it35594" onMouseOver="hilite(35594)" onMouseOut="lolite()" onClick="logVariable('colours')" href="../../../../_variables/colours.html">$colours</a> = array('red', 'green', 'yellow', 'orange', 'purple', 'black',
<a name="l122"><span class="linenum"> 122</span></a>          'maroon', 'blue', 'ltgreen', 'navy', 'ltred', 'ltltgreen', 'ltltorange',
<a name="l123"><span class="linenum"> 123</span></a>          'olive', 'gray', 'ltltred', 'ltorange', 'lime', 'ltblue', 'ltltblue');
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>      <a class="var it35593" onMouseOver="hilite(35593)" onMouseOut="lolite()" onClick="logVariable('colourindex')" href="../../../../_variables/colourindex.html">$colourindex</a> = (<a class="var it35593" onMouseOver="hilite(35593)" onMouseOut="lolite()" onClick="logVariable('colourindex')" href="../../../../_variables/colourindex.html">$colourindex</a> + 1) % <a class="phpfunction" onClick="logFunction('count')" href="../../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it35594" onMouseOver="hilite(35594)" onMouseOut="lolite()" onClick="logVariable('colours')" href="../../../../_variables/colours.html">$colours</a>);
<a name="l126"><span class="linenum"> 126</span></a>  
<a name="l127"><span class="linenum"> 127</span></a>      return <a class="var it35594" onMouseOver="hilite(35594)" onMouseOut="lolite()" onClick="logVariable('colours')" href="../../../../_variables/colours.html">$colours</a>[<a class="var it35593" onMouseOver="hilite(35593)" onMouseOut="lolite()" onClick="logVariable('colourindex')" href="../../../../_variables/colourindex.html">$colourindex</a>];
<a name="l128"><span class="linenum"> 128</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'quiz_statistics_attempts_sql': ['quiz_statistics_attempts_sql', 'SQL to fetch relevant \'quiz_attempts\' records. ', [['mod/quiz/report/statistics','statisticslib.php',26]], 4],
'quiz_statistics_qubaids_condition': ['quiz_statistics_qubaids_condition', '', [['mod/quiz/report/statistics','statisticslib.php',105]], 5],
'quiz_statistics_graph_get_new_colour': ['quiz_statistics_graph_get_new_colour', 'This helper function returns a sequence of colours each time it is called. Used for choosing colours for graph data series. ', [['mod/quiz/report/statistics','statisticslib.php',110]], 2],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'quiz_report_grade_method_sql': ['quiz_report_grade_method_sql', 'Given a quiz grading method return sql to test if this is an attempt that will be contribute towards the grade of the user. Or return an empty string if the grading method is QUIZ_GRADEAVERAGE and thus all attempts contribute to final grade. ', [['mod/quiz/report','reportlib.php',146]], 2],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',3012]], 1007],
'quiz_statistics_renumber_placeholders': ['quiz_statistics_renumber_placeholders', 'Re-number all the params beginning with $paramprefix in a fragment of SQL. ', [['mod/quiz/report/statistics','statisticslib.php',68]], 3],
'ksort': ['ksort', '', [], 153],
'preg_quote': ['preg_quote', '', [], 205],
'count': ['count', '', [], 4095],
'array_keys': ['array_keys', '', [], 1256],
'preg_replace_callback': ['preg_replace_callback', '', [], 136]};
CLASS_DATA={
'quiz_attempt': ['quiz_attempt', 'This class extends the quiz class to hold data about the state of a particular attempt, in addition to the data about the quiz. ', [['mod/quiz','attemptlib.php',490]], 167],
'qubaid_join': ['qubaid_join', 'This class represents a restriction on the set of question_usage ids to include in a larger database query based on JOINing to some other tables. ', [['question/engine','datalib.php',1919]], 15]};
CONST_DATA={
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 315],
'QUIZ_GRADEAVERAGE': ['QUIZ_GRADEAVERAGE', '', [['mod/quiz','lib.php',49]], 16],
'DEBUG_DEVELOPER': ['DEBUG_DEVELOPER', '', [['lib','setuplib.php',40]], 736]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
