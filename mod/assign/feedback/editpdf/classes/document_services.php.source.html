<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mod/assign/feedback/editpdf/classes/document_services.php source</title>
    <link rel="stylesheet" href="../../../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../../../';
subdir='mod/assign/feedback/editpdf/classes';
filename='document_services.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mod/assign/feedback/editpdf/classes/</a> -> <a href="document_services.php.html">document_services.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="document_services.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="document_services.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * This file contains the ingest manager for the assignfeedback_editpdf plugin</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package   assignfeedback_editpdf</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright 2012 Davo Smith</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  namespace assignfeedback_editpdf;
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  use DOMDocument;
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment">/**</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * Functions for generating the annotated pdf.</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> *</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * This class controls the ingest of student submission files to a normalised</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * PDF 1.4 document with all submission files concatinated together. It also</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * provides the functions to generate a downloadable pdf with all comments and</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * annotations embedded.</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * @copyright 2012 Davo Smith</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> */</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('document_services')" href="../../../../../_classes/document_services.html" onMouseOver="classPopup(event,'document_services')">document_services</a> {
<a name="l40"><span class="linenum">  40</span></a>  
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">    /** File area for generated pdf */</span>
<a name="l42"><span class="linenum">  42</span></a>      const FINAL_PDF_FILEAREA = 'download';
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">    /** File area for combined pdf */</span>
<a name="l44"><span class="linenum">  44</span></a>      const COMBINED_PDF_FILEAREA = 'combined';
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">    /** File area for importing html */</span>
<a name="l46"><span class="linenum">  46</span></a>      const IMPORT_HTML_FILEAREA = 'importhtml';
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment">    /** File area for page images */</span>
<a name="l48"><span class="linenum">  48</span></a>      const PAGE_IMAGE_FILEAREA = 'pages';
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">    /** File area for readonly page images */</span>
<a name="l50"><span class="linenum">  50</span></a>      const PAGE_IMAGE_READONLY_FILEAREA = 'readonlypages';
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment">    /** File area for the stamps */</span>
<a name="l52"><span class="linenum">  52</span></a>      const STAMPS_FILEAREA = 'stamps';
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">    /** Filename for combined pdf */</span>
<a name="l54"><span class="linenum">  54</span></a>      const COMBINED_PDF_FILENAME = 'combined.pdf';
<a name="l55"><span class="linenum">  55</span></a>  
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">    /** Base64 encoded blank pdf. This is the most reliable/fastest way to generate a blank pdf. */</span>
<a name="l57"><span class="linenum">  57</span></a>      const BLANK_PDF_BASE64 = &lt;&lt;&lt;EOD
<a name="l58"><span class="linenum">  58</span></a>  JVBERi0xLjQKJcOkw7zDtsOfCjIgMCBvYmoKPDwvTGVuZ3RoIDMgMCBSL0ZpbHRlci9GbGF0ZURl
<a name="l59"><span class="linenum">  59</span></a>  Y29kZT4+CnN0cmVhbQp4nDPQM1Qo5ypUMFAwALJMLU31jBQsTAz1LBSKUrnCtRTyuAIVAIcdB3IK
<a name="l60"><span class="linenum">  60</span></a>  ZW5kc3RyZWFtCmVuZG9iagoKMyAwIG9iago0MgplbmRvYmoKCjUgMCBvYmoKPDwKPj4KZW5kb2Jq
<a name="l61"><span class="linenum">  61</span></a>  Cgo2IDAgb2JqCjw8L0ZvbnQgNSAwIFIKL1Byb2NTZXRbL1BERi9UZXh0XQo+PgplbmRvYmoKCjEg
<a name="l62"><span class="linenum">  62</span></a>  MCBvYmoKPDwvVHlwZS9QYWdlL1BhcmVudCA0IDAgUi9SZXNvdXJjZXMgNiAwIFIvTWVkaWFCb3hb
<a name="l63"><span class="linenum">  63</span></a>  MCAwIDU5NSA4NDJdL0dyb3VwPDwvUy9UcmFuc3BhcmVuY3kvQ1MvRGV2aWNlUkdCL0kgdHJ1ZT4+
<a name="l64"><span class="linenum">  64</span></a>  L0NvbnRlbnRzIDIgMCBSPj4KZW5kb2JqCgo0IDAgb2JqCjw8L1R5cGUvUGFnZXMKL1Jlc291cmNl
<a name="l65"><span class="linenum">  65</span></a>  cyA2IDAgUgovTWVkaWFCb3hbIDAgMCA1OTUgODQyIF0KL0tpZHNbIDEgMCBSIF0KL0NvdW50IDE+
<a name="l66"><span class="linenum">  66</span></a>  PgplbmRvYmoKCjcgMCBvYmoKPDwvVHlwZS9DYXRhbG9nL1BhZ2VzIDQgMCBSCi9PcGVuQWN0aW9u
<a name="l67"><span class="linenum">  67</span></a>  WzEgMCBSIC9YWVogbnVsbCBudWxsIDBdCi9MYW5nKGVuLUFVKQo+PgplbmRvYmoKCjggMCBvYmoK
<a name="l68"><span class="linenum">  68</span></a>  PDwvQ3JlYXRvcjxGRUZGMDA1NzAwNzIwMDY5MDA3NDAwNjUwMDcyPgovUHJvZHVjZXI8RkVGRjAw
<a name="l69"><span class="linenum">  69</span></a>  NEMwMDY5MDA2MjAwNzIwMDY1MDA0RjAwNjYwMDY2MDA2OTAwNjMwMDY1MDAyMDAwMzQwMDJFMDAz
<a name="l70"><span class="linenum">  70</span></a>  ND4KL0NyZWF0aW9uRGF0ZShEOjIwMTYwMjI2MTMyMzE0KzA4JzAwJyk+PgplbmRvYmoKCnhyZWYK
<a name="l71"><span class="linenum">  71</span></a>  MCA5CjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDIyNiAwMDAwMCBuIAowMDAwMDAwMDE5IDAw
<a name="l72"><span class="linenum">  72</span></a>  MDAwIG4gCjAwMDAwMDAxMzIgMDAwMDAgbiAKMDAwMDAwMDM2OCAwMDAwMCBuIAowMDAwMDAwMTUx
<a name="l73"><span class="linenum">  73</span></a>  IDAwMDAwIG4gCjAwMDAwMDAxNzMgMDAwMDAgbiAKMDAwMDAwMDQ2NiAwMDAwMCBuIAowMDAwMDAw
<a name="l74"><span class="linenum">  74</span></a>  NTYyIDAwMDAwIG4gCnRyYWlsZXIKPDwvU2l6ZSA5L1Jvb3QgNyAwIFIKL0luZm8gOCAwIFIKL0lE
<a name="l75"><span class="linenum">  75</span></a>  IFsgPEJDN0REQUQwRDQyOTQ1OTQ2OUU4NzJCMjI1ODUyNkU4Pgo8QkM3RERBRDBENDI5NDU5NDY5
<a name="l76"><span class="linenum">  76</span></a>  RTg3MkIyMjU4NTI2RTg+IF0KL0RvY0NoZWNrc3VtIC9BNTYwMEZCMDAzRURCRTg0MTNBNTk3RTZF
<a name="l77"><span class="linenum">  77</span></a>  MURDQzJBRgo+PgpzdGFydHhyZWYKNzM2CiUlRU9GCg==
<a name="l78"><span class="linenum">  78</span></a>  EOD;
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>      <span class="comment">/**</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">     * This function will take an int or an assignment instance and</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment">     * return an assignment instance. It is just for convenience.</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment">     * @return assign</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment">     */</span>
<a name="l86"><span class="linenum">  86</span></a>      private static function <a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>) {
<a name="l87"><span class="linenum">  87</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../../../_variables/CFG.html">$CFG</a>;
<a name="l88"><span class="linenum">  88</span></a>  
<a name="l89"><span class="linenum">  89</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../../../../mod/assign/locallib.php.html">/mod/assign/locallib.php</a>');
<a name="l90"><span class="linenum">  90</span></a>  
<a name="l91"><span class="linenum">  91</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../../../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>)) {
<a name="l92"><span class="linenum">  92</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../../../../_variables/cm.html">$cm</a> = \<a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../../../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('assign', <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, 0, false, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../../../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l93"><span class="linenum">  93</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../../_variables/context.html">$context</a> = \<a class="class" onClick="logClass('context_module')" href="../../../../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../../../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>);
<a name="l94"><span class="linenum">  94</span></a>  
<a name="l95"><span class="linenum">  95</span></a>              <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = new \<a class="function" onClick="logFunction('assign')" href="../../../../../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../../_variables/context.html">$context</a>, null, null);
<a name="l96"><span class="linenum">  96</span></a>          }
<a name="l97"><span class="linenum">  97</span></a>          return <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>;
<a name="l98"><span class="linenum">  98</span></a>      }
<a name="l99"><span class="linenum">  99</span></a>  
<a name="l100"><span class="linenum"> 100</span></a>      <span class="comment">/**</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">     * Get a hash that will be unique and can be used in a path name.</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment">     */</span>
<a name="l106"><span class="linenum"> 106</span></a>      private static function <a class="function" onClick="logFunction('hash')" href="../../../../../_functions/hash.html" onMouseOver="funcPopup(event,'hash')">hash</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>) {
<a name="l107"><span class="linenum"> 107</span></a>          if (<a class="phpfunction" onClick="logFunction('is_object')" href="../../../../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>)) {
<a name="l108"><span class="linenum"> 108</span></a>              <a class="var it281" onMouseOver="hilite(281)" onMouseOut="lolite()" onClick="logVariable('assignmentid')" href="../../../../../_variables/assignmentid.html">$assignmentid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_instance')" href="../../../../../_functions/get_instance.html" onMouseOver="funcPopup(event,'get_instance')">get_instance</a>()-&gt;id;
<a name="l109"><span class="linenum"> 109</span></a>          } else {
<a name="l110"><span class="linenum"> 110</span></a>              <a class="var it281" onMouseOver="hilite(281)" onMouseOut="lolite()" onClick="logVariable('assignmentid')" href="../../../../../_variables/assignmentid.html">$assignmentid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>;
<a name="l111"><span class="linenum"> 111</span></a>          }
<a name="l112"><span class="linenum"> 112</span></a>          return <a class="phpfunction" onClick="logFunction('sha1')" href="../../../../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it281" onMouseOver="hilite(281)" onMouseOut="lolite()" onClick="logVariable('assignmentid')" href="../../../../../_variables/assignmentid.html">$assignmentid</a> . '_' . <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a> . '_' . <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l113"><span class="linenum"> 113</span></a>      }
<a name="l114"><span class="linenum"> 114</span></a>  
<a name="l115"><span class="linenum"> 115</span></a>      <span class="comment">/**</span>
<a name="l116"><span class="linenum"> 116</span></a>  <span class="comment">     * Use a DOM parser to accurately replace images with their alt text.</span>
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">     * @param string $html</span>
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment">     * @return string New html with no image tags.</span>
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment">     */</span>
<a name="l120"><span class="linenum"> 120</span></a>      protected static function <a class="function" onClick="logFunction('strip_images')" href="../../../../../_functions/strip_images.html" onMouseOver="funcPopup(event,'strip_images')">strip_images</a>(<a class="var it475" onMouseOver="hilite(475)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../../../_variables/html.html">$html</a>) {
<a name="l121"><span class="linenum"> 121</span></a>          <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('dom')" href="../../../../../_variables/dom.html">$dom</a> = new DOMDocument();
<a name="l122"><span class="linenum"> 122</span></a>          <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('dom')" href="../../../../../_variables/dom.html">$dom</a>-&gt;<a class="function" onClick="logFunction('loadHTML')" href="../../../../../_functions/loadhtml.html" onMouseOver="funcPopup(event,'loadhtml')">loadHTML</a>(&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; ?&gt;&quot; . <a class="var it475" onMouseOver="hilite(475)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../../../_variables/html.html">$html</a>);
<a name="l123"><span class="linenum"> 123</span></a>          <a class="var it1682" onMouseOver="hilite(1682)" onMouseOut="lolite()" onClick="logVariable('images')" href="../../../../../_variables/images.html">$images</a> = <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('dom')" href="../../../../../_variables/dom.html">$dom</a>-&gt;getElementsByTagName('img');
<a name="l124"><span class="linenum"> 124</span></a>          <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a> = 0;
<a name="l125"><span class="linenum"> 125</span></a>  
<a name="l126"><span class="linenum"> 126</span></a>          for (<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a> = (<a class="var it1682" onMouseOver="hilite(1682)" onMouseOut="lolite()" onClick="logVariable('images')" href="../../../../../_variables/images.html">$images</a>-&gt;<a onClick="logVariable('length')" class="var it45883" onMouseOver="hilite(45883)" onMouseOut="lolite()" href="../../../../../_variables/length.html">length</a> - 1); <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a> &gt;= 0; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a>--) {
<a name="l127"><span class="linenum"> 127</span></a>              <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../../../../_variables/node.html">$node</a> = <a class="var it1682" onMouseOver="hilite(1682)" onMouseOut="lolite()" onClick="logVariable('images')" href="../../../../../_variables/images.html">$images</a>-&gt;<a class="function" onClick="logFunction('item')" href="../../../../../_functions/item.html" onMouseOver="funcPopup(event,'item')">item</a>(<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a>);
<a name="l128"><span class="linenum"> 128</span></a>  
<a name="l129"><span class="linenum"> 129</span></a>              if (<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../../../../_variables/node.html">$node</a>-&gt;<a class="function" onClick="logFunction('hasAttribute')" href="../../../../../_functions/hasattribute.html" onMouseOver="funcPopup(event,'hasattribute')">hasAttribute</a>('alt')) {
<a name="l130"><span class="linenum"> 130</span></a>                  <a class="var it21" onMouseOver="hilite(21)" onMouseOut="lolite()" onClick="logVariable('replacement')" href="../../../../../_variables/replacement.html">$replacement</a> = ' [ ' . <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../../../../_variables/node.html">$node</a>-&gt;<a class="function" onClick="logFunction('getAttribute')" href="../../../../../_functions/getattribute.html" onMouseOver="funcPopup(event,'getattribute')">getAttribute</a>('alt') . ' ] ';
<a name="l131"><span class="linenum"> 131</span></a>              } else {
<a name="l132"><span class="linenum"> 132</span></a>                  <a class="var it21" onMouseOver="hilite(21)" onMouseOut="lolite()" onClick="logVariable('replacement')" href="../../../../../_variables/replacement.html">$replacement</a> = ' ';
<a name="l133"><span class="linenum"> 133</span></a>              }
<a name="l134"><span class="linenum"> 134</span></a>  
<a name="l135"><span class="linenum"> 135</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../../../_variables/text.html">$text</a> = <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('dom')" href="../../../../../_variables/dom.html">$dom</a>-&gt;createTextNode(<a class="var it21" onMouseOver="hilite(21)" onMouseOut="lolite()" onClick="logVariable('replacement')" href="../../../../../_variables/replacement.html">$replacement</a>);
<a name="l136"><span class="linenum"> 136</span></a>              <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../../../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('parentNode')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../../../../_variables/parentNode.html">parentNode</a>-&gt;replaceChild(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../../../_variables/text.html">$text</a>, <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../../../../_variables/node.html">$node</a>);
<a name="l137"><span class="linenum"> 137</span></a>          }
<a name="l138"><span class="linenum"> 138</span></a>          <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../../../_variables/count.html">$count</a> = 1;
<a name="l139"><span class="linenum"> 139</span></a>          return <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; ?&gt;&quot;, &quot;&quot;, <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('dom')" href="../../../../../_variables/dom.html">$dom</a>-&gt;saveHTML(), <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../../../_variables/count.html">$count</a>);
<a name="l140"><span class="linenum"> 140</span></a>      }
<a name="l141"><span class="linenum"> 141</span></a>  
<a name="l142"><span class="linenum"> 142</span></a>      <span class="comment">/**</span>
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">     * This function will search for all files that can be converted</span>
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">     * and concatinated into a PDF (1.4) - for any submission plugin</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">     * for this students attempt.</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment">     * @return array(stored_file)</span>
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment">     */</span>
<a name="l151"><span class="linenum"> 151</span></a>      public static function <a class="function" onClick="logFunction('list_compatible_submission_files_for_attempt')" href="../../../../../_functions/list_compatible_submission_files_for_attempt.html" onMouseOver="funcPopup(event,'list_compatible_submission_files_for_attempt')">list_compatible_submission_files_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>) {
<a name="l152"><span class="linenum"> 152</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../../../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../../_variables/DB.html">$DB</a>;
<a name="l153"><span class="linenum"> 153</span></a>  
<a name="l154"><span class="linenum"> 154</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l155"><span class="linenum"> 155</span></a>  
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">        // Capability checks.</span>
<a name="l157"><span class="linenum"> 157</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_view_submission')" href="../../../../../_functions/can_view_submission.html" onMouseOver="funcPopup(event,'can_view_submission')">can_view_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>)) {
<a name="l158"><span class="linenum"> 158</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l159"><span class="linenum"> 159</span></a>          }
<a name="l160"><span class="linenum"> 160</span></a>  
<a name="l161"><span class="linenum"> 161</span></a>          <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = array();
<a name="l162"><span class="linenum"> 162</span></a>  
<a name="l163"><span class="linenum"> 163</span></a>          if (<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_instance')" href="../../../../../_functions/get_instance.html" onMouseOver="funcPopup(event,'get_instance')">get_instance</a>()-&gt;teamsubmission) {
<a name="l164"><span class="linenum"> 164</span></a>              <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_group_submission')" href="../../../../../_functions/get_group_submission.html" onMouseOver="funcPopup(event,'get_group_submission')">get_group_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, 0, false);
<a name="l165"><span class="linenum"> 165</span></a>          } else {
<a name="l166"><span class="linenum"> 166</span></a>              <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_submission')" href="../../../../../_functions/get_user_submission.html" onMouseOver="funcPopup(event,'get_user_submission')">get_user_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, false);
<a name="l167"><span class="linenum"> 167</span></a>          }
<a name="l168"><span class="linenum"> 168</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../../../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>));
<a name="l169"><span class="linenum"> 169</span></a>  
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment">        // User has not submitted anything yet.</span>
<a name="l171"><span class="linenum"> 171</span></a>          if (!<a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a>) {
<a name="l172"><span class="linenum"> 172</span></a>              return <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>;
<a name="l173"><span class="linenum"> 173</span></a>          }
<a name="l174"><span class="linenum"> 174</span></a>  
<a name="l175"><span class="linenum"> 175</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">        // Ask each plugin for it's list of files.</span>
<a name="l177"><span class="linenum"> 177</span></a>          foreach (<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_submission_plugins')" href="../../../../../_functions/get_submission_plugins.html" onMouseOver="funcPopup(event,'get_submission_plugins')">get_submission_plugins</a>() as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../../../../_variables/plugin.html">$plugin</a>) {
<a name="l178"><span class="linenum"> 178</span></a>              if (<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../../../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('is_enabled')" href="../../../../../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>() &amp;&amp; <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../../../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('is_visible')" href="../../../../../_functions/is_visible.html" onMouseOver="funcPopup(event,'is_visible')">is_visible</a>()) {
<a name="l179"><span class="linenum"> 179</span></a>                  <a class="var it23124" onMouseOver="hilite(23124)" onMouseOut="lolite()" onClick="logVariable('pluginfiles')" href="../../../../../_variables/pluginfiles.html">$pluginfiles</a> = <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../../../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('get_files')" href="../../../../../_functions/get_files.html" onMouseOver="funcPopup(event,'get_files')">get_files</a>(<a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../../../_variables/user.html">$user</a>);
<a name="l180"><span class="linenum"> 180</span></a>                  foreach (<a class="var it23124" onMouseOver="hilite(23124)" onMouseOut="lolite()" onClick="logVariable('pluginfiles')" href="../../../../../_variables/pluginfiles.html">$pluginfiles</a> as <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a> =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>) {
<a name="l181"><span class="linenum"> 181</span></a>                      if (<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a> instanceof \stored_file) {
<a name="l182"><span class="linenum"> 182</span></a>                          if (<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_mimetype')" href="../../../../../_functions/get_mimetype.html" onMouseOver="funcPopup(event,'get_mimetype')">get_mimetype</a>() === 'application/pdf') {
<a name="l183"><span class="linenum"> 183</span></a>                              <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>[<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a>] = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>;
<a name="l184"><span class="linenum"> 184</span></a>                          } else if (<a class="var it23125" onMouseOver="hilite(23125)" onMouseOut="lolite()" onClick="logVariable('convertedfile')" href="../../../../../_variables/convertedfile.html">$convertedfile</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_converted_document')" href="../../../../../_functions/get_converted_document.html" onMouseOver="funcPopup(event,'get_converted_document')">get_converted_document</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>, 'pdf')) {
<a name="l185"><span class="linenum"> 185</span></a>                              <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>[<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a>] = <a class="var it23125" onMouseOver="hilite(23125)" onMouseOut="lolite()" onClick="logVariable('convertedfile')" href="../../../../../_variables/convertedfile.html">$convertedfile</a>;
<a name="l186"><span class="linenum"> 186</span></a>                          }
<a name="l187"><span class="linenum"> 187</span></a>                      } else {
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment">                        // Create a tmp stored_file from this html string.</span>
<a name="l189"><span class="linenum"> 189</span></a>                          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../../../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>);
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment">                        // Strip image tags, because they will not be resolvable.</span>
<a name="l191"><span class="linenum"> 191</span></a>                          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a> = self::<a class="function" onClick="logFunction('strip_images')" href="../../../../../_functions/strip_images.html" onMouseOver="funcPopup(event,'strip_images')">strip_images</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>);
<a name="l192"><span class="linenum"> 192</span></a>                          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a> = new \stdClass();
<a name="l193"><span class="linenum"> 193</span></a>                          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/contextid.html">contextid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l194"><span class="linenum"> 194</span></a>                          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('component')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/component.html">component</a> = 'assignfeedback_editpdf';
<a name="l195"><span class="linenum"> 195</span></a>                          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filearea')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filearea.html">filearea</a> = self::IMPORT_HTML_FILEAREA;
<a name="l196"><span class="linenum"> 196</span></a>                          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('itemid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/itemid.html">itemid</a> = <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a>-&gt;<a onClick="logVariable('id')" class="var it42978" onMouseOver="hilite(42978)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>;
<a name="l197"><span class="linenum"> 197</span></a>                          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filepath')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filepath.html">filepath</a> = '/';
<a name="l198"><span class="linenum"> 198</span></a>                          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filename')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filename.html">filename</a> = <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../../../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('get_type')" href="../../../../../_functions/get_type.html" onMouseOver="funcPopup(event,'get_type')">get_type</a>() . '-' . <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a>;
<a name="l199"><span class="linenum"> 199</span></a>  
<a name="l200"><span class="linenum"> 200</span></a>                          <a class="var it20215" onMouseOver="hilite(20215)" onMouseOut="lolite()" onClick="logVariable('htmlfile')" href="../../../../../_variables/htmlfile.html">$htmlfile</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_file_from_string')" href="../../../../../_functions/create_file_from_string.html" onMouseOver="funcPopup(event,'create_file_from_string')">create_file_from_string</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>);
<a name="l201"><span class="linenum"> 201</span></a>                          <a class="var it23125" onMouseOver="hilite(23125)" onMouseOut="lolite()" onClick="logVariable('convertedfile')" href="../../../../../_variables/convertedfile.html">$convertedfile</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_converted_document')" href="../../../../../_functions/get_converted_document.html" onMouseOver="funcPopup(event,'get_converted_document')">get_converted_document</a>(<a class="var it20215" onMouseOver="hilite(20215)" onMouseOut="lolite()" onClick="logVariable('htmlfile')" href="../../../../../_variables/htmlfile.html">$htmlfile</a>, 'pdf');
<a name="l202"><span class="linenum"> 202</span></a>                          <a class="var it20215" onMouseOver="hilite(20215)" onMouseOut="lolite()" onClick="logVariable('htmlfile')" href="../../../../../_variables/htmlfile.html">$htmlfile</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l203"><span class="linenum"> 203</span></a>                          if (<a class="var it23125" onMouseOver="hilite(23125)" onMouseOut="lolite()" onClick="logVariable('convertedfile')" href="../../../../../_variables/convertedfile.html">$convertedfile</a>) {
<a name="l204"><span class="linenum"> 204</span></a>                              <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>[<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a>] = <a class="var it23125" onMouseOver="hilite(23125)" onMouseOut="lolite()" onClick="logVariable('convertedfile')" href="../../../../../_variables/convertedfile.html">$convertedfile</a>;
<a name="l205"><span class="linenum"> 205</span></a>                          }
<a name="l206"><span class="linenum"> 206</span></a>                      }
<a name="l207"><span class="linenum"> 207</span></a>                  }
<a name="l208"><span class="linenum"> 208</span></a>              }
<a name="l209"><span class="linenum"> 209</span></a>          }
<a name="l210"><span class="linenum"> 210</span></a>          return <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>;
<a name="l211"><span class="linenum"> 211</span></a>      }
<a name="l212"><span class="linenum"> 212</span></a>  
<a name="l213"><span class="linenum"> 213</span></a>      <span class="comment">/**</span>
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment">     * This function return the combined pdf for all valid submission files.</span>
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l218"><span class="linenum"> 218</span></a>  <span class="comment">     * @return stored_file</span>
<a name="l219"><span class="linenum"> 219</span></a>  <span class="comment">     */</span>
<a name="l220"><span class="linenum"> 220</span></a>      public static function <a class="function" onClick="logFunction('get_combined_pdf_for_attempt')" href="../../../../../_functions/get_combined_pdf_for_attempt.html" onMouseOver="funcPopup(event,'get_combined_pdf_for_attempt')">get_combined_pdf_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>) {
<a name="l221"><span class="linenum"> 221</span></a>  
<a name="l222"><span class="linenum"> 222</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../../../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../../_variables/DB.html">$DB</a>;
<a name="l223"><span class="linenum"> 223</span></a>  
<a name="l224"><span class="linenum"> 224</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l225"><span class="linenum"> 225</span></a>  
<a name="l226"><span class="linenum"> 226</span></a>  <span class="comment">        // Capability checks.</span>
<a name="l227"><span class="linenum"> 227</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_view_submission')" href="../../../../../_functions/can_view_submission.html" onMouseOver="funcPopup(event,'can_view_submission')">can_view_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>)) {
<a name="l228"><span class="linenum"> 228</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l229"><span class="linenum"> 229</span></a>          }
<a name="l230"><span class="linenum"> 230</span></a>  
<a name="l231"><span class="linenum"> 231</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l232"><span class="linenum"> 232</span></a>          if (<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_instance')" href="../../../../../_functions/get_instance.html" onMouseOver="funcPopup(event,'get_instance')">get_instance</a>()-&gt;teamsubmission) {
<a name="l233"><span class="linenum"> 233</span></a>              <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_group_submission')" href="../../../../../_functions/get_group_submission.html" onMouseOver="funcPopup(event,'get_group_submission')">get_group_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, 0, false);
<a name="l234"><span class="linenum"> 234</span></a>          } else {
<a name="l235"><span class="linenum"> 235</span></a>              <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_submission')" href="../../../../../_functions/get_user_submission.html" onMouseOver="funcPopup(event,'get_user_submission')">get_user_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, false);
<a name="l236"><span class="linenum"> 236</span></a>          }
<a name="l237"><span class="linenum"> 237</span></a>  
<a name="l238"><span class="linenum"> 238</span></a>          <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l239"><span class="linenum"> 239</span></a>          <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a> = 'assignfeedback_editpdf';
<a name="l240"><span class="linenum"> 240</span></a>          <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a> = self::COMBINED_PDF_FILEAREA;
<a name="l241"><span class="linenum"> 241</span></a>          <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>;
<a name="l242"><span class="linenum"> 242</span></a>          <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../../../../_variables/filepath.html">$filepath</a> = '/';
<a name="l243"><span class="linenum"> 243</span></a>          <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a> = self::COMBINED_PDF_FILENAME;
<a name="l244"><span class="linenum"> 244</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = \<a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l245"><span class="linenum"> 245</span></a>  
<a name="l246"><span class="linenum"> 246</span></a>          <a class="var it23126" onMouseOver="hilite(23126)" onMouseOut="lolite()" onClick="logVariable('combinedpdf')" href="../../../../../_variables/combinedpdf.html">$combinedpdf</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file')" href="../../../../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../../../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a>);
<a name="l247"><span class="linenum"> 247</span></a>          if (!<a class="var it23126" onMouseOver="hilite(23126)" onMouseOut="lolite()" onClick="logVariable('combinedpdf')" href="../../../../../_variables/combinedpdf.html">$combinedpdf</a> ||
<a name="l248"><span class="linenum"> 248</span></a>                  (<a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a> &amp;&amp; (<a class="var it23126" onMouseOver="hilite(23126)" onMouseOut="lolite()" onClick="logVariable('combinedpdf')" href="../../../../../_variables/combinedpdf.html">$combinedpdf</a>-&gt;<a class="function" onClick="logFunction('get_timemodified')" href="../../../../../_functions/get_timemodified.html" onMouseOver="funcPopup(event,'get_timemodified')">get_timemodified</a>() &lt; <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42978" onMouseOver="hilite(42978)" onMouseOut="lolite()" href="../../../../../_variables/timemodified.html">timemodified</a>))) {
<a name="l249"><span class="linenum"> 249</span></a>              return self::<a class="function" onClick="logFunction('generate_combined_pdf_for_attempt')" href="../../../../../_functions/generate_combined_pdf_for_attempt.html" onMouseOver="funcPopup(event,'generate_combined_pdf_for_attempt')">generate_combined_pdf_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l250"><span class="linenum"> 250</span></a>          }
<a name="l251"><span class="linenum"> 251</span></a>          return <a class="var it23126" onMouseOver="hilite(23126)" onMouseOut="lolite()" onClick="logVariable('combinedpdf')" href="../../../../../_variables/combinedpdf.html">$combinedpdf</a>;
<a name="l252"><span class="linenum"> 252</span></a>      }
<a name="l253"><span class="linenum"> 253</span></a>  
<a name="l254"><span class="linenum"> 254</span></a>      <span class="comment">/**</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">     * This function will take all of the compatible files for a submission</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment">     * and combine them into one PDF.</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment">     * @return stored_file</span>
<a name="l261"><span class="linenum"> 261</span></a>  <span class="comment">     */</span>
<a name="l262"><span class="linenum"> 262</span></a>      public static function <a class="function" onClick="logFunction('generate_combined_pdf_for_attempt')" href="../../../../../_functions/generate_combined_pdf_for_attempt.html" onMouseOver="funcPopup(event,'generate_combined_pdf_for_attempt')">generate_combined_pdf_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>) {
<a name="l263"><span class="linenum"> 263</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../../../_variables/CFG.html">$CFG</a>;
<a name="l264"><span class="linenum"> 264</span></a>  
<a name="l265"><span class="linenum"> 265</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../../../_variables/libdir.html">libdir</a> . '/pdflib.php');
<a name="l266"><span class="linenum"> 266</span></a>  
<a name="l267"><span class="linenum"> 267</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l268"><span class="linenum"> 268</span></a>  
<a name="l269"><span class="linenum"> 269</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_view_submission')" href="../../../../../_functions/can_view_submission.html" onMouseOver="funcPopup(event,'can_view_submission')">can_view_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>)) {
<a name="l270"><span class="linenum"> 270</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l271"><span class="linenum"> 271</span></a>          }
<a name="l272"><span class="linenum"> 272</span></a>  
<a name="l273"><span class="linenum"> 273</span></a>          <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = self::<a class="function" onClick="logFunction('list_compatible_submission_files_for_attempt')" href="../../../../../_functions/list_compatible_submission_files_for_attempt.html" onMouseOver="funcPopup(event,'list_compatible_submission_files_for_attempt')">list_compatible_submission_files_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l274"><span class="linenum"> 274</span></a>  
<a name="l275"><span class="linenum"> 275</span></a>          <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a> = <span class="keyword">new </span><a class="class" onClick="logClass('pdf')" href="../../../../../_classes/pdf.html" onMouseOver="classPopup(event,'pdf')">pdf</a>();
<a name="l276"><span class="linenum"> 276</span></a>          if (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>) {
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment">            // Create a mega joined PDF.</span>
<a name="l278"><span class="linenum"> 278</span></a>              <a class="var it23127" onMouseOver="hilite(23127)" onMouseOut="lolite()" onClick="logVariable('compatiblepdfs')" href="../../../../../_variables/compatiblepdfs.html">$compatiblepdfs</a> = array();
<a name="l279"><span class="linenum"> 279</span></a>              foreach (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> as <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>) {
<a name="l280"><span class="linenum"> 280</span></a>                  <a class="var it23128" onMouseOver="hilite(23128)" onMouseOut="lolite()" onClick="logVariable('compatiblepdf')" href="../../../../../_variables/compatiblepdf.html">$compatiblepdf</a> = <a class="class" onClick="logClass('pdf')" href="../../../../../_classes/pdf.html" onMouseOver="classPopup(event,'pdf')">pdf</a>::<a class="function" onClick="logFunction('ensure_pdf_compatible')" href="../../../../../_functions/ensure_pdf_compatible.html" onMouseOver="funcPopup(event,'ensure_pdf_compatible')">ensure_pdf_compatible</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>);
<a name="l281"><span class="linenum"> 281</span></a>                  if (<a class="var it23128" onMouseOver="hilite(23128)" onMouseOut="lolite()" onClick="logVariable('compatiblepdf')" href="../../../../../_variables/compatiblepdf.html">$compatiblepdf</a>) {
<a name="l282"><span class="linenum"> 282</span></a>                      <a class="phpfunction" onClick="logFunction('array_push')" href="../../../../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it23127" onMouseOver="hilite(23127)" onMouseOut="lolite()" onClick="logVariable('compatiblepdfs')" href="../../../../../_variables/compatiblepdfs.html">$compatiblepdfs</a>, <a class="var it23128" onMouseOver="hilite(23128)" onMouseOut="lolite()" onClick="logVariable('compatiblepdf')" href="../../../../../_variables/compatiblepdf.html">$compatiblepdf</a>);
<a name="l283"><span class="linenum"> 283</span></a>                  }
<a name="l284"><span class="linenum"> 284</span></a>              }
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>              <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> = \<a class="function" onClick="logFunction('make_temp_directory')" href="../../../../../_functions/make_temp_directory.html" onMouseOver="funcPopup(event,'make_temp_directory')">make_temp_directory</a>('assignfeedback_editpdf/combined/' . self::<a class="function" onClick="logFunction('hash')" href="../../../../../_functions/hash.html" onMouseOver="funcPopup(event,'hash')">hash</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>));
<a name="l287"><span class="linenum"> 287</span></a>              <a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../../../../_variables/tmpfile.html">$tmpfile</a> = <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> . '/' . self::COMBINED_PDF_FILENAME;
<a name="l288"><span class="linenum"> 288</span></a>  
<a name="l289"><span class="linenum"> 289</span></a>              @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../../../../_variables/tmpfile.html">$tmpfile</a>);
<a name="l290"><span class="linenum"> 290</span></a>              try {
<a name="l291"><span class="linenum"> 291</span></a>                  <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> = <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('combine_pdfs')" href="../../../../../_functions/combine_pdfs.html" onMouseOver="funcPopup(event,'combine_pdfs')">combine_pdfs</a>(<a class="var it23127" onMouseOver="hilite(23127)" onMouseOut="lolite()" onClick="logVariable('compatiblepdfs')" href="../../../../../_variables/compatiblepdfs.html">$compatiblepdfs</a>, <a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../../../../_variables/tmpfile.html">$tmpfile</a>);
<a name="l292"><span class="linenum"> 292</span></a>              } catch (\Exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../../../../_variables/e.html">$e</a>) {
<a name="l293"><span class="linenum"> 293</span></a>                  <a class="function" onClick="logFunction('debugging')" href="../../../../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('TCPDF could not process the pdf files:' . <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../../../../_variables/e.html">$e</a>-&gt;<a class="function" onClick="logFunction('getMessage')" href="../../../../../_functions/getmessage.html" onMouseOver="funcPopup(event,'getmessage')">getMessage</a>(), <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../../../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment">                // TCPDF does not recover from errors so we need to re-initialise the class.</span>
<a name="l295"><span class="linenum"> 295</span></a>                  <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> = 0;
<a name="l296"><span class="linenum"> 296</span></a>              }
<a name="l297"><span class="linenum"> 297</span></a>              if (<a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> == 0) {
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment">                // We at least want a single blank page.</span>
<a name="l299"><span class="linenum"> 299</span></a>                  <a class="function" onClick="logFunction('debugging')" href="../../../../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('TCPDF did not produce a valid pdf:' . <a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../../../../_variables/tmpfile.html">$tmpfile</a> . '. Replacing with a blank pdf.', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../../../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l300"><span class="linenum"> 300</span></a>                  @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../../../../_variables/tmpfile.html">$tmpfile</a>);
<a name="l301"><span class="linenum"> 301</span></a>                  <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = false;
<a name="l302"><span class="linenum"> 302</span></a>              }
<a name="l303"><span class="linenum"> 303</span></a>          }
<a name="l304"><span class="linenum"> 304</span></a>          <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('Close')" href="../../../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">Close</a>(); <span class="comment">// No real need to close this pdf, because it has been saved by combine_pdfs(), but for clarity.</span>
<a name="l305"><span class="linenum"> 305</span></a>  
<a name="l306"><span class="linenum"> 306</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l307"><span class="linenum"> 307</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a> = new \stdClass();
<a name="l308"><span class="linenum"> 308</span></a>  
<a name="l309"><span class="linenum"> 309</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/contextid.html">contextid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l310"><span class="linenum"> 310</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('component')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/component.html">component</a> = 'assignfeedback_editpdf';
<a name="l311"><span class="linenum"> 311</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filearea')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filearea.html">filearea</a> = self::COMBINED_PDF_FILEAREA;
<a name="l312"><span class="linenum"> 312</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('itemid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/itemid.html">itemid</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>;
<a name="l313"><span class="linenum"> 313</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filepath')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filepath.html">filepath</a> = '/';
<a name="l314"><span class="linenum"> 314</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filename')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filename.html">filename</a> = self::COMBINED_PDF_FILENAME;
<a name="l315"><span class="linenum"> 315</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = \<a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l316"><span class="linenum"> 316</span></a>  
<a name="l317"><span class="linenum"> 317</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../../../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/contextid.html">contextid</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('component')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/component.html">component</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filearea')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filearea.html">filearea</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('itemid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/itemid.html">itemid</a>);
<a name="l318"><span class="linenum"> 318</span></a>  
<a name="l319"><span class="linenum"> 319</span></a>  <span class="comment">        // Detect corrupt generated pdfs and replace with a blank one.</span>
<a name="l320"><span class="linenum"> 320</span></a>          if (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>) {
<a name="l321"><span class="linenum"> 321</span></a>              <a class="var it23129" onMouseOver="hilite(23129)" onMouseOut="lolite()" onClick="logVariable('verifypdf')" href="../../../../../_variables/verifypdf.html">$verifypdf</a> = <span class="keyword">new </span><a class="class" onClick="logClass('pdf')" href="../../../../../_classes/pdf.html" onMouseOver="classPopup(event,'pdf')">pdf</a>();
<a name="l322"><span class="linenum"> 322</span></a>              <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> = <a class="var it23129" onMouseOver="hilite(23129)" onMouseOut="lolite()" onClick="logVariable('verifypdf')" href="../../../../../_variables/verifypdf.html">$verifypdf</a>-&gt;<a class="function" onClick="logFunction('load_pdf')" href="../../../../../_functions/load_pdf.html" onMouseOver="funcPopup(event,'load_pdf')">load_pdf</a>(<a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../../../../_variables/tmpfile.html">$tmpfile</a>);
<a name="l323"><span class="linenum"> 323</span></a>              if (<a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> &lt;= 0) {
<a name="l324"><span class="linenum"> 324</span></a>                  <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = false;
<a name="l325"><span class="linenum"> 325</span></a>              }
<a name="l326"><span class="linenum"> 326</span></a>              <a class="var it23129" onMouseOver="hilite(23129)" onMouseOut="lolite()" onClick="logVariable('verifypdf')" href="../../../../../_variables/verifypdf.html">$verifypdf</a>-&gt;<a class="function" onClick="logFunction('Close')" href="../../../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">Close</a>(); <span class="comment">// PDF loaded and never saved/outputted needs to be closed.</span>
<a name="l327"><span class="linenum"> 327</span></a>          }
<a name="l328"><span class="linenum"> 328</span></a>  
<a name="l329"><span class="linenum"> 329</span></a>          if (!<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>) {
<a name="l330"><span class="linenum"> 330</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_file_from_string')" href="../../../../../_functions/create_file_from_string.html" onMouseOver="funcPopup(event,'create_file_from_string')">create_file_from_string</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>, <a class="phpfunction" onClick="logFunction('base64_decode')" href="../../../../../_functions/base64_decode.html" onMouseOver="phpfuncPopup(event,'base64_decode')">base64_decode</a>(self::BLANK_PDF_BASE64));
<a name="l331"><span class="linenum"> 331</span></a>          } else {
<a name="l332"><span class="linenum"> 332</span></a>  <span class="comment">            // This was a combined pdf.</span>
<a name="l333"><span class="linenum"> 333</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_file_from_pathname')" href="../../../../../_functions/create_file_from_pathname.html" onMouseOver="funcPopup(event,'create_file_from_pathname')">create_file_from_pathname</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>, <a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../../../../_variables/tmpfile.html">$tmpfile</a>);
<a name="l334"><span class="linenum"> 334</span></a>              @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../../../../_variables/tmpfile.html">$tmpfile</a>);
<a name="l335"><span class="linenum"> 335</span></a>  
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">            // Test the generated file for correctness.</span>
<a name="l337"><span class="linenum"> 337</span></a>              <a class="var it23128" onMouseOver="hilite(23128)" onMouseOut="lolite()" onClick="logVariable('compatiblepdf')" href="../../../../../_variables/compatiblepdf.html">$compatiblepdf</a> = <a class="class" onClick="logClass('pdf')" href="../../../../../_classes/pdf.html" onMouseOver="classPopup(event,'pdf')">pdf</a>::<a class="function" onClick="logFunction('ensure_pdf_compatible')" href="../../../../../_functions/ensure_pdf_compatible.html" onMouseOver="funcPopup(event,'ensure_pdf_compatible')">ensure_pdf_compatible</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>);
<a name="l338"><span class="linenum"> 338</span></a>          }
<a name="l339"><span class="linenum"> 339</span></a>  
<a name="l340"><span class="linenum"> 340</span></a>          return <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>;
<a name="l341"><span class="linenum"> 341</span></a>      }
<a name="l342"><span class="linenum"> 342</span></a>  
<a name="l343"><span class="linenum"> 343</span></a>      <span class="comment">/**</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment">     * This function will return the number of pages of a pdf.</span>
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment">     * @param bool $readonly When true we get the number of pages for the readonly version.</span>
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment">     * @return int number of pages</span>
<a name="l350"><span class="linenum"> 350</span></a>  <span class="comment">     */</span>
<a name="l351"><span class="linenum"> 351</span></a>      public static function <a class="function" onClick="logFunction('page_number_for_attempt')" href="../../../../../_functions/page_number_for_attempt.html" onMouseOver="funcPopup(event,'page_number_for_attempt')">page_number_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>, <a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('readonly')" href="../../../../../_variables/readonly.html">$readonly</a> = false) {
<a name="l352"><span class="linenum"> 352</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../../../_variables/CFG.html">$CFG</a>;
<a name="l353"><span class="linenum"> 353</span></a>  
<a name="l354"><span class="linenum"> 354</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../../../_variables/libdir.html">libdir</a> . '/pdflib.php');
<a name="l355"><span class="linenum"> 355</span></a>  
<a name="l356"><span class="linenum"> 356</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l357"><span class="linenum"> 357</span></a>  
<a name="l358"><span class="linenum"> 358</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_view_submission')" href="../../../../../_functions/can_view_submission.html" onMouseOver="funcPopup(event,'can_view_submission')">can_view_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>)) {
<a name="l359"><span class="linenum"> 359</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l360"><span class="linenum"> 360</span></a>          }
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment">        // When in readonly we can return the number of images in the DB because they should already exist,</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment">        // if for some reason they do not, then we proceed as for the normal version.</span>
<a name="l364"><span class="linenum"> 364</span></a>          if (<a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('readonly')" href="../../../../../_variables/readonly.html">$readonly</a>) {
<a name="l365"><span class="linenum"> 365</span></a>              <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l366"><span class="linenum"> 366</span></a>              <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l367"><span class="linenum"> 367</span></a>              <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_directory_files')" href="../../../../../_functions/get_directory_files.html" onMouseOver="funcPopup(event,'get_directory_files')">get_directory_files</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id, 'assignfeedback_editpdf',
<a name="l368"><span class="linenum"> 368</span></a>                  self::PAGE_IMAGE_READONLY_FILEAREA, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>, '/');
<a name="l369"><span class="linenum"> 369</span></a>              <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>);
<a name="l370"><span class="linenum"> 370</span></a>              if (<a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> &gt; 0) {
<a name="l371"><span class="linenum"> 371</span></a>                  return <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a>;
<a name="l372"><span class="linenum"> 372</span></a>              }
<a name="l373"><span class="linenum"> 373</span></a>          }
<a name="l374"><span class="linenum"> 374</span></a>  
<a name="l375"><span class="linenum"> 375</span></a>  <span class="comment">        // Get a combined pdf file from all submitted pdf files.</span>
<a name="l376"><span class="linenum"> 376</span></a>          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a> = self::<a class="function" onClick="logFunction('get_combined_pdf_for_attempt')" href="../../../../../_functions/get_combined_pdf_for_attempt.html" onMouseOver="funcPopup(event,'get_combined_pdf_for_attempt')">get_combined_pdf_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l377"><span class="linenum"> 377</span></a>          if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>) {
<a name="l378"><span class="linenum"> 378</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('Could not generate combined pdf.');
<a name="l379"><span class="linenum"> 379</span></a>          }
<a name="l380"><span class="linenum"> 380</span></a>  
<a name="l381"><span class="linenum"> 381</span></a>  <span class="comment">        // Store the combined pdf file somewhere to be opened by tcpdf.</span>
<a name="l382"><span class="linenum"> 382</span></a>          <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> = \<a class="function" onClick="logFunction('make_temp_directory')" href="../../../../../_functions/make_temp_directory.html" onMouseOver="funcPopup(event,'make_temp_directory')">make_temp_directory</a>('assignfeedback_editpdf/pagetotal/'
<a name="l383"><span class="linenum"> 383</span></a>              . self::<a class="function" onClick="logFunction('hash')" href="../../../../../_functions/hash.html" onMouseOver="funcPopup(event,'hash')">hash</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>));
<a name="l384"><span class="linenum"> 384</span></a>          <a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a> = <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> . '/' . self::COMBINED_PDF_FILENAME;
<a name="l385"><span class="linenum"> 385</span></a>          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('copy_content_to')" href="../../../../../_functions/copy_content_to.html" onMouseOver="funcPopup(event,'copy_content_to')">copy_content_to</a>(<a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a>); <span class="comment">// Copy the file.</span>
<a name="l386"><span class="linenum"> 386</span></a>  
<a name="l387"><span class="linenum"> 387</span></a>  <span class="comment">        // Get the total number of pages.</span>
<a name="l388"><span class="linenum"> 388</span></a>          <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a> = <span class="keyword">new </span><a class="class" onClick="logClass('pdf')" href="../../../../../_classes/pdf.html" onMouseOver="classPopup(event,'pdf')">pdf</a>();
<a name="l389"><span class="linenum"> 389</span></a>          <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> = <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('set_pdf')" href="../../../../../_functions/set_pdf.html" onMouseOver="funcPopup(event,'set_pdf')">set_pdf</a>(<a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a>);
<a name="l390"><span class="linenum"> 390</span></a>          <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('Close')" href="../../../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">Close</a>(); <span class="comment">// PDF loaded and never saved/outputted needs to be closed.</span>
<a name="l391"><span class="linenum"> 391</span></a>  
<a name="l392"><span class="linenum"> 392</span></a>  <span class="comment">        // Delete temporary folders and files.</span>
<a name="l393"><span class="linenum"> 393</span></a>          @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a>);
<a name="l394"><span class="linenum"> 394</span></a>          @<a class="phpfunction" onClick="logFunction('rmdir')" href="../../../../../_functions/rmdir.html" onMouseOver="phpfuncPopup(event,'rmdir')">rmdir</a>(<a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a>);
<a name="l395"><span class="linenum"> 395</span></a>  
<a name="l396"><span class="linenum"> 396</span></a>          return <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a>;
<a name="l397"><span class="linenum"> 397</span></a>      }
<a name="l398"><span class="linenum"> 398</span></a>  
<a name="l399"><span class="linenum"> 399</span></a>      <span class="comment">/**</span>
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment">     * This function will generate and return a list of the page images from a pdf.</span>
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment">     * @return array(stored_file)</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment">     */</span>
<a name="l406"><span class="linenum"> 406</span></a>      public static function <a class="function" onClick="logFunction('generate_page_images_for_attempt')" href="../../../../../_functions/generate_page_images_for_attempt.html" onMouseOver="funcPopup(event,'generate_page_images_for_attempt')">generate_page_images_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>) {
<a name="l407"><span class="linenum"> 407</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../../../_variables/CFG.html">$CFG</a>;
<a name="l408"><span class="linenum"> 408</span></a>  
<a name="l409"><span class="linenum"> 409</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../../../_variables/libdir.html">libdir</a> . '/pdflib.php');
<a name="l410"><span class="linenum"> 410</span></a>  
<a name="l411"><span class="linenum"> 411</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l412"><span class="linenum"> 412</span></a>  
<a name="l413"><span class="linenum"> 413</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_view_submission')" href="../../../../../_functions/can_view_submission.html" onMouseOver="funcPopup(event,'can_view_submission')">can_view_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>)) {
<a name="l414"><span class="linenum"> 414</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l415"><span class="linenum"> 415</span></a>          }
<a name="l416"><span class="linenum"> 416</span></a>  
<a name="l417"><span class="linenum"> 417</span></a>  <span class="comment">        // Need to generate the page images - first get a combined pdf.</span>
<a name="l418"><span class="linenum"> 418</span></a>          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a> = self::<a class="function" onClick="logFunction('get_combined_pdf_for_attempt')" href="../../../../../_functions/get_combined_pdf_for_attempt.html" onMouseOver="funcPopup(event,'get_combined_pdf_for_attempt')">get_combined_pdf_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l419"><span class="linenum"> 419</span></a>          if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>) {
<a name="l420"><span class="linenum"> 420</span></a>              throw new \moodle_exception('Could not generate combined pdf.');
<a name="l421"><span class="linenum"> 421</span></a>          }
<a name="l422"><span class="linenum"> 422</span></a>  
<a name="l423"><span class="linenum"> 423</span></a>          <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> = \<a class="function" onClick="logFunction('make_temp_directory')" href="../../../../../_functions/make_temp_directory.html" onMouseOver="funcPopup(event,'make_temp_directory')">make_temp_directory</a>('assignfeedback_editpdf/pageimages/' . self::<a class="function" onClick="logFunction('hash')" href="../../../../../_functions/hash.html" onMouseOver="funcPopup(event,'hash')">hash</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>));
<a name="l424"><span class="linenum"> 424</span></a>          <a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a> = <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> . '/' . self::COMBINED_PDF_FILENAME;
<a name="l425"><span class="linenum"> 425</span></a>          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('copy_content_to')" href="../../../../../_functions/copy_content_to.html" onMouseOver="funcPopup(event,'copy_content_to')">copy_content_to</a>(<a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a>); <span class="comment">// Copy the file.</span>
<a name="l426"><span class="linenum"> 426</span></a>  
<a name="l427"><span class="linenum"> 427</span></a>          <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a> = <span class="keyword">new </span><a class="class" onClick="logClass('pdf')" href="../../../../../_classes/pdf.html" onMouseOver="classPopup(event,'pdf')">pdf</a>();
<a name="l428"><span class="linenum"> 428</span></a>  
<a name="l429"><span class="linenum"> 429</span></a>          <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('set_image_folder')" href="../../../../../_functions/set_image_folder.html" onMouseOver="funcPopup(event,'set_image_folder')">set_image_folder</a>(<a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a>);
<a name="l430"><span class="linenum"> 430</span></a>          <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> = <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('set_pdf')" href="../../../../../_functions/set_pdf.html" onMouseOver="funcPopup(event,'set_pdf')">set_pdf</a>(<a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a>);
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l433"><span class="linenum"> 433</span></a>  
<a name="l434"><span class="linenum"> 434</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a> = new \stdClass();
<a name="l435"><span class="linenum"> 435</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/contextid.html">contextid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l436"><span class="linenum"> 436</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('component')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/component.html">component</a> = 'assignfeedback_editpdf';
<a name="l437"><span class="linenum"> 437</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filearea')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filearea.html">filearea</a> = self::PAGE_IMAGE_FILEAREA;
<a name="l438"><span class="linenum"> 438</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('itemid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/itemid.html">itemid</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>;
<a name="l439"><span class="linenum"> 439</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filepath')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filepath.html">filepath</a> = '/';
<a name="l440"><span class="linenum"> 440</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = \<a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l441"><span class="linenum"> 441</span></a>  
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">        // Remove the existing content of the filearea.</span>
<a name="l443"><span class="linenum"> 443</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../../../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/contextid.html">contextid</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('component')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/component.html">component</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filearea')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filearea.html">filearea</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('itemid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/itemid.html">itemid</a>);
<a name="l444"><span class="linenum"> 444</span></a>  
<a name="l445"><span class="linenum"> 445</span></a>          <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = array();
<a name="l446"><span class="linenum"> 446</span></a>          for (<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a> = 0; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a> &lt; <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a>; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a>++) {
<a name="l447"><span class="linenum"> 447</span></a>              <a class="var it872" onMouseOver="hilite(872)" onMouseOut="lolite()" onClick="logVariable('image')" href="../../../../../_variables/image.html">$image</a> = <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('get_image')" href="../../../../../_functions/get_image.html" onMouseOver="funcPopup(event,'get_image')">get_image</a>(<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a>);
<a name="l448"><span class="linenum"> 448</span></a>              <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filename')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filename.html">filename</a> = <a class="phpfunction" onClick="logFunction('basename')" href="../../../../../_functions/basename.html" onMouseOver="phpfuncPopup(event,'basename')">basename</a>(<a class="var it872" onMouseOver="hilite(872)" onMouseOut="lolite()" onClick="logVariable('image')" href="../../../../../_variables/image.html">$image</a>);
<a name="l449"><span class="linenum"> 449</span></a>              <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>[<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a>] = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_file_from_pathname')" href="../../../../../_functions/create_file_from_pathname.html" onMouseOver="funcPopup(event,'create_file_from_pathname')">create_file_from_pathname</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>, <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> . '/' . <a class="var it872" onMouseOver="hilite(872)" onMouseOut="lolite()" onClick="logVariable('image')" href="../../../../../_variables/image.html">$image</a>);
<a name="l450"><span class="linenum"> 450</span></a>              @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> . '/' . <a class="var it872" onMouseOver="hilite(872)" onMouseOut="lolite()" onClick="logVariable('image')" href="../../../../../_variables/image.html">$image</a>);
<a name="l451"><span class="linenum"> 451</span></a>          }
<a name="l452"><span class="linenum"> 452</span></a>          <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('Close')" href="../../../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">Close</a>(); <span class="comment">// PDF loaded and never saved/outputted needs to be closed.</span>
<a name="l453"><span class="linenum"> 453</span></a>  
<a name="l454"><span class="linenum"> 454</span></a>          @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a>);
<a name="l455"><span class="linenum"> 455</span></a>          @<a class="phpfunction" onClick="logFunction('rmdir')" href="../../../../../_functions/rmdir.html" onMouseOver="phpfuncPopup(event,'rmdir')">rmdir</a>(<a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a>);
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>          return <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>;
<a name="l458"><span class="linenum"> 458</span></a>      }
<a name="l459"><span class="linenum"> 459</span></a>  
<a name="l460"><span class="linenum"> 460</span></a>      <span class="comment">/**</span>
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">     * This function returns a list of the page images from a pdf.</span>
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment">     *</span>
<a name="l463"><span class="linenum"> 463</span></a>  <span class="comment">     * The readonly version is different than the normal one. The readonly version contains a copy</span>
<a name="l464"><span class="linenum"> 464</span></a>  <span class="comment">     * of the pages in the state they were when the PDF was annotated, by doing so we prevent the</span>
<a name="l465"><span class="linenum"> 465</span></a>  <span class="comment">     * the pages that are displayed to change as soon as the submission changes.</span>
<a name="l466"><span class="linenum"> 466</span></a>  <span class="comment">     *</span>
<a name="l467"><span class="linenum"> 467</span></a>  <span class="comment">     * Though there is an edge case, if the PDF was annotated before MDL-45580, then it is possible</span>
<a name="l468"><span class="linenum"> 468</span></a>  <span class="comment">     * that we do not find any readonly version of the pages. In that case, we will get the normal</span>
<a name="l469"><span class="linenum"> 469</span></a>  <span class="comment">     * pages and copy them to the readonly area. This ensures that the pages will remain in that</span>
<a name="l470"><span class="linenum"> 470</span></a>  <span class="comment">     * state until the submission is updated. When the normal files do not exist, we throw an exception</span>
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment">     * because the readonly pages should only ever be displayed after a teacher has annotated the PDF,</span>
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment">     * they would not exist until they do.</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">     *</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l476"><span class="linenum"> 476</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">     * @param bool $readonly If true, then we are requesting the readonly version.</span>
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">     * @return array(stored_file)</span>
<a name="l479"><span class="linenum"> 479</span></a>  <span class="comment">     */</span>
<a name="l480"><span class="linenum"> 480</span></a>      public static function <a class="function" onClick="logFunction('get_page_images_for_attempt')" href="../../../../../_functions/get_page_images_for_attempt.html" onMouseOver="funcPopup(event,'get_page_images_for_attempt')">get_page_images_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>, <a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('readonly')" href="../../../../../_variables/readonly.html">$readonly</a> = false) {
<a name="l481"><span class="linenum"> 481</span></a>  
<a name="l482"><span class="linenum"> 482</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l483"><span class="linenum"> 483</span></a>  
<a name="l484"><span class="linenum"> 484</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_view_submission')" href="../../../../../_functions/can_view_submission.html" onMouseOver="funcPopup(event,'can_view_submission')">can_view_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>)) {
<a name="l485"><span class="linenum"> 485</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l486"><span class="linenum"> 486</span></a>          }
<a name="l487"><span class="linenum"> 487</span></a>  
<a name="l488"><span class="linenum"> 488</span></a>          if (<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_instance')" href="../../../../../_functions/get_instance.html" onMouseOver="funcPopup(event,'get_instance')">get_instance</a>()-&gt;teamsubmission) {
<a name="l489"><span class="linenum"> 489</span></a>              <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_group_submission')" href="../../../../../_functions/get_group_submission.html" onMouseOver="funcPopup(event,'get_group_submission')">get_group_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, 0, false);
<a name="l490"><span class="linenum"> 490</span></a>          } else {
<a name="l491"><span class="linenum"> 491</span></a>              <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_submission')" href="../../../../../_functions/get_user_submission.html" onMouseOver="funcPopup(event,'get_user_submission')">get_user_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, false);
<a name="l492"><span class="linenum"> 492</span></a>          }
<a name="l493"><span class="linenum"> 493</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l494"><span class="linenum"> 494</span></a>  
<a name="l495"><span class="linenum"> 495</span></a>          <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l496"><span class="linenum"> 496</span></a>          <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a> = 'assignfeedback_editpdf';
<a name="l497"><span class="linenum"> 497</span></a>          <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>;
<a name="l498"><span class="linenum"> 498</span></a>          <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../../../../_variables/filepath.html">$filepath</a> = '/';
<a name="l499"><span class="linenum"> 499</span></a>          <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a> = self::PAGE_IMAGE_FILEAREA;
<a name="l500"><span class="linenum"> 500</span></a>  
<a name="l501"><span class="linenum"> 501</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = \<a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l502"><span class="linenum"> 502</span></a>  
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment">        // If we are after the readonly pages...</span>
<a name="l504"><span class="linenum"> 504</span></a>          if (<a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('readonly')" href="../../../../../_variables/readonly.html">$readonly</a>) {
<a name="l505"><span class="linenum"> 505</span></a>              <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a> = self::PAGE_IMAGE_READONLY_FILEAREA;
<a name="l506"><span class="linenum"> 506</span></a>              if (<a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('is_area_empty')" href="../../../../../_functions/is_area_empty.html" onMouseOver="funcPopup(event,'is_area_empty')">is_area_empty</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a>)) {
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment">                // We have a problem here, we were supposed to find the files.</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment">                // Attempt to re-generate the pages from the combined images.</span>
<a name="l509"><span class="linenum"> 509</span></a>                  self::<a class="function" onClick="logFunction('generate_page_images_for_attempt')" href="../../../../../_functions/generate_page_images_for_attempt.html" onMouseOver="funcPopup(event,'generate_page_images_for_attempt')">generate_page_images_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l510"><span class="linenum"> 510</span></a>                  self::<a class="function" onClick="logFunction('copy_pages_to_readonly_area')" href="../../../../../_functions/copy_pages_to_readonly_area.html" onMouseOver="funcPopup(event,'copy_pages_to_readonly_area')">copy_pages_to_readonly_area</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>);
<a name="l511"><span class="linenum"> 511</span></a>              }
<a name="l512"><span class="linenum"> 512</span></a>          }
<a name="l513"><span class="linenum"> 513</span></a>  
<a name="l514"><span class="linenum"> 514</span></a>          <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_directory_files')" href="../../../../../_functions/get_directory_files.html" onMouseOver="funcPopup(event,'get_directory_files')">get_directory_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../../../../_variables/filepath.html">$filepath</a>);
<a name="l515"><span class="linenum"> 515</span></a>  
<a name="l516"><span class="linenum"> 516</span></a>          <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('pages')" href="../../../../../_variables/pages.html">$pages</a> = array();
<a name="l517"><span class="linenum"> 517</span></a>          if (!empty(<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>)) {
<a name="l518"><span class="linenum"> 518</span></a>              <a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('first')" href="../../../../../_variables/first.html">$first</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../../../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>);
<a name="l519"><span class="linenum"> 519</span></a>              if (!<a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('readonly')" href="../../../../../_variables/readonly.html">$readonly</a> &amp;&amp; <a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('first')" href="../../../../../_variables/first.html">$first</a>-&gt;<a class="function" onClick="logFunction('get_timemodified')" href="../../../../../_functions/get_timemodified.html" onMouseOver="funcPopup(event,'get_timemodified')">get_timemodified</a>() &lt; <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('submission')" href="../../../../../_variables/submission.html">$submission</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42978" onMouseOver="hilite(42978)" onMouseOut="lolite()" href="../../../../../_variables/timemodified.html">timemodified</a>) {
<a name="l520"><span class="linenum"> 520</span></a>  <span class="comment">                // Image files are stale, we need to regenerate them, except in readonly mode.</span>
<a name="l521"><span class="linenum"> 521</span></a>  <span class="comment">                // We also need to remove the draft annotations and comments associated with this attempt.</span>
<a name="l522"><span class="linenum"> 522</span></a>                  <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../../../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a>);
<a name="l523"><span class="linenum"> 523</span></a>                  <a class="class" onClick="logClass('page_editor')" href="../../../../../_classes/page_editor.html" onMouseOver="classPopup(event,'page_editor')">page_editor</a>::<a class="function" onClick="logFunction('delete_draft_content')" href="../../../../../_functions/delete_draft_content.html" onMouseOver="funcPopup(event,'delete_draft_content')">delete_draft_content</a>(<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a>);
<a name="l524"><span class="linenum"> 524</span></a>                  <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = array();
<a name="l525"><span class="linenum"> 525</span></a>              } else {
<a name="l526"><span class="linenum"> 526</span></a>  
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment">                // Need to reorder the files following their name.</span>
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment">                // because get_directory_files() return a different order than generate_page_images_for_attempt().</span>
<a name="l529"><span class="linenum"> 529</span></a>                  foreach(<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> as <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>) {
<a name="l530"><span class="linenum"> 530</span></a>  <span class="comment">                    // Extract the page number from the file name image_pageXXXX.png.</span>
<a name="l531"><span class="linenum"> 531</span></a>                      <a class="phpfunction" onClick="logFunction('preg_match')" href="../../../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/page([\d]+)\./', <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../../../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>(), <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../../../../_variables/matches.html">$matches</a>);
<a name="l532"><span class="linenum"> 532</span></a>                      if (empty(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../../../../_variables/matches.html">$matches</a>) or !<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../../../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../../../../_variables/matches.html">$matches</a>[1])) {
<a name="l533"><span class="linenum"> 533</span></a>                          throw new \coding_exception(&quot;'&quot; . <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../../../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>()
<a name="l534"><span class="linenum"> 534</span></a>                              . &quot;' file hasn't the expected format filename: image_pageXXXX.png.&quot;);
<a name="l535"><span class="linenum"> 535</span></a>                      }
<a name="l536"><span class="linenum"> 536</span></a>                      <a class="var it20856" onMouseOver="hilite(20856)" onMouseOut="lolite()" onClick="logVariable('pagenumber')" href="../../../../../_variables/pagenumber.html">$pagenumber</a> = (int)<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../../../../_variables/matches.html">$matches</a>[1];
<a name="l537"><span class="linenum"> 537</span></a>  
<a name="l538"><span class="linenum"> 538</span></a>  <span class="comment">                    // Save the page in the ordered array.</span>
<a name="l539"><span class="linenum"> 539</span></a>                      <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('pages')" href="../../../../../_variables/pages.html">$pages</a>[<a class="var it20856" onMouseOver="hilite(20856)" onMouseOut="lolite()" onClick="logVariable('pagenumber')" href="../../../../../_variables/pagenumber.html">$pagenumber</a>] = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>;
<a name="l540"><span class="linenum"> 540</span></a>                  }
<a name="l541"><span class="linenum"> 541</span></a>                  <a class="phpfunction" onClick="logFunction('ksort')" href="../../../../../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('pages')" href="../../../../../_variables/pages.html">$pages</a>);
<a name="l542"><span class="linenum"> 542</span></a>              }
<a name="l543"><span class="linenum"> 543</span></a>          }
<a name="l544"><span class="linenum"> 544</span></a>  
<a name="l545"><span class="linenum"> 545</span></a>          if (empty(<a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('pages')" href="../../../../../_variables/pages.html">$pages</a>)) {
<a name="l546"><span class="linenum"> 546</span></a>              if (<a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('readonly')" href="../../../../../_variables/readonly.html">$readonly</a>) {
<a name="l547"><span class="linenum"> 547</span></a>  <span class="comment">                // This should never happen, there should be a version of the pages available</span>
<a name="l548"><span class="linenum"> 548</span></a>  <span class="comment">                // whenever we are requesting the readonly version.</span>
<a name="l549"><span class="linenum"> 549</span></a>                  throw new \moodle_exception('Could not find readonly pages for grade ' . <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>);
<a name="l550"><span class="linenum"> 550</span></a>              }
<a name="l551"><span class="linenum"> 551</span></a>              <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('pages')" href="../../../../../_variables/pages.html">$pages</a> = self::<a class="function" onClick="logFunction('generate_page_images_for_attempt')" href="../../../../../_functions/generate_page_images_for_attempt.html" onMouseOver="funcPopup(event,'generate_page_images_for_attempt')">generate_page_images_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l552"><span class="linenum"> 552</span></a>          }
<a name="l553"><span class="linenum"> 553</span></a>  
<a name="l554"><span class="linenum"> 554</span></a>          return <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('pages')" href="../../../../../_variables/pages.html">$pages</a>;
<a name="l555"><span class="linenum"> 555</span></a>      }
<a name="l556"><span class="linenum"> 556</span></a>  
<a name="l557"><span class="linenum"> 557</span></a>      <span class="comment">/**</span>
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment">     * This function returns sensible filename for a feedback file.</span>
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l560"><span class="linenum"> 560</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l561"><span class="linenum"> 561</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment">     * @return string</span>
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment">     */</span>
<a name="l564"><span class="linenum"> 564</span></a>      protected static function <a class="function" onClick="logFunction('get_downloadable_feedback_filename')" href="../../../../../_functions/get_downloadable_feedback_filename.html" onMouseOver="funcPopup(event,'get_downloadable_feedback_filename')">get_downloadable_feedback_filename</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>) {
<a name="l565"><span class="linenum"> 565</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../../_variables/DB.html">$DB</a>;
<a name="l566"><span class="linenum"> 566</span></a>  
<a name="l567"><span class="linenum"> 567</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l568"><span class="linenum"> 568</span></a>  
<a name="l569"><span class="linenum"> 569</span></a>          <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../../../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../../../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_course_module')" href="../../../../../_functions/get_course_module.html" onMouseOver="funcPopup(event,'get_course_module')">get_course_module</a>());
<a name="l570"><span class="linenum"> 570</span></a>          <a class="var it1985" onMouseOver="hilite(1985)" onMouseOut="lolite()" onClick="logVariable('groupname')" href="../../../../../_variables/groupname.html">$groupname</a> = '';
<a name="l571"><span class="linenum"> 571</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../../../../_variables/groupmode.html">$groupmode</a>) {
<a name="l572"><span class="linenum"> 572</span></a>              <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../../../../_variables/groupid.html">$groupid</a> = <a class="function" onClick="logFunction('groups_get_activity_group')" href="../../../../../_functions/groups_get_activity_group.html" onMouseOver="funcPopup(event,'groups_get_activity_group')">groups_get_activity_group</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_course_module')" href="../../../../../_functions/get_course_module.html" onMouseOver="funcPopup(event,'get_course_module')">get_course_module</a>(), true);
<a name="l573"><span class="linenum"> 573</span></a>              <a class="var it1985" onMouseOver="hilite(1985)" onMouseOut="lolite()" onClick="logVariable('groupname')" href="../../../../../_variables/groupname.html">$groupname</a> = <a class="function" onClick="logFunction('groups_get_group_name')" href="../../../../../_functions/groups_get_group_name.html" onMouseOver="funcPopup(event,'groups_get_group_name')">groups_get_group_name</a>(<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../../../../_variables/groupid.html">$groupid</a>).'-';
<a name="l574"><span class="linenum"> 574</span></a>          }
<a name="l575"><span class="linenum"> 575</span></a>          if (<a class="var it1985" onMouseOver="hilite(1985)" onMouseOut="lolite()" onClick="logVariable('groupname')" href="../../../../../_variables/groupname.html">$groupname</a> == '-') {
<a name="l576"><span class="linenum"> 576</span></a>              <a class="var it1985" onMouseOver="hilite(1985)" onMouseOut="lolite()" onClick="logVariable('groupname')" href="../../../../../_variables/groupname.html">$groupname</a> = '';
<a name="l577"><span class="linenum"> 577</span></a>          }
<a name="l578"><span class="linenum"> 578</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l579"><span class="linenum"> 579</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../../../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../../../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l580"><span class="linenum"> 580</span></a>  
<a name="l581"><span class="linenum"> 581</span></a>          if (<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('is_blind_marking')" href="../../../../../_functions/is_blind_marking.html" onMouseOver="funcPopup(event,'is_blind_marking')">is_blind_marking</a>()) {
<a name="l582"><span class="linenum"> 582</span></a>              <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> = <a class="var it1985" onMouseOver="hilite(1985)" onMouseOut="lolite()" onClick="logVariable('groupname')" href="../../../../../_variables/groupname.html">$groupname</a> . <a class="function" onClick="logFunction('get_string')" href="../../../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('participant', 'assign');
<a name="l583"><span class="linenum"> 583</span></a>              <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('_', ' ', <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a>);
<a name="l584"><span class="linenum"> 584</span></a>              <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> = <a class="function" onClick="logFunction('clean_filename')" href="../../../../../_functions/clean_filename.html" onMouseOver="funcPopup(event,'clean_filename')">clean_filename</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> . '_' . <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_uniqueid_for_user')" href="../../../../../_functions/get_uniqueid_for_user.html" onMouseOver="funcPopup(event,'get_uniqueid_for_user')">get_uniqueid_for_user</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>) . '_');
<a name="l585"><span class="linenum"> 585</span></a>          } else {
<a name="l586"><span class="linenum"> 586</span></a>              <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> = <a class="var it1985" onMouseOver="hilite(1985)" onMouseOut="lolite()" onClick="logVariable('groupname')" href="../../../../../_variables/groupname.html">$groupname</a> . <a class="function" onClick="logFunction('fullname')" href="../../../../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../../../../_variables/user.html">$user</a>);
<a name="l587"><span class="linenum"> 587</span></a>              <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('_', ' ', <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a>);
<a name="l588"><span class="linenum"> 588</span></a>              <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> = <a class="function" onClick="logFunction('clean_filename')" href="../../../../../_functions/clean_filename.html" onMouseOver="funcPopup(event,'clean_filename')">clean_filename</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> . '_' . <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_uniqueid_for_user')" href="../../../../../_functions/get_uniqueid_for_user.html" onMouseOver="funcPopup(event,'get_uniqueid_for_user')">get_uniqueid_for_user</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>) . '_');
<a name="l589"><span class="linenum"> 589</span></a>          }
<a name="l590"><span class="linenum"> 590</span></a>          <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> .= <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('attemptnumber')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/attemptnumber.html">attemptnumber</a>;
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>          return <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../../../_variables/prefix.html">$prefix</a> . '.pdf';
<a name="l593"><span class="linenum"> 593</span></a>      }
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>      <span class="comment">/**</span>
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment">     * This function takes the combined pdf and embeds all the comments and annotations.</span>
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment">     *</span>
<a name="l598"><span class="linenum"> 598</span></a>  <span class="comment">     * This also moves the annotations and comments from drafts to not drafts. And it will</span>
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment">     * copy all the images stored to the readonly area, so that they can be viewed online, and</span>
<a name="l600"><span class="linenum"> 600</span></a>  <span class="comment">     * not be overwritten when a new submission is sent.</span>
<a name="l601"><span class="linenum"> 601</span></a>  <span class="comment">     *</span>
<a name="l602"><span class="linenum"> 602</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l603"><span class="linenum"> 603</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l604"><span class="linenum"> 604</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l605"><span class="linenum"> 605</span></a>  <span class="comment">     * @return stored_file</span>
<a name="l606"><span class="linenum"> 606</span></a>  <span class="comment">     */</span>
<a name="l607"><span class="linenum"> 607</span></a>      public static function <a class="function" onClick="logFunction('generate_feedback_document')" href="../../../../../_functions/generate_feedback_document.html" onMouseOver="funcPopup(event,'generate_feedback_document')">generate_feedback_document</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>) {
<a name="l608"><span class="linenum"> 608</span></a>  
<a name="l609"><span class="linenum"> 609</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l610"><span class="linenum"> 610</span></a>  
<a name="l611"><span class="linenum"> 611</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_view_submission')" href="../../../../../_functions/can_view_submission.html" onMouseOver="funcPopup(event,'can_view_submission')">can_view_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>)) {
<a name="l612"><span class="linenum"> 612</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l613"><span class="linenum"> 613</span></a>          }
<a name="l614"><span class="linenum"> 614</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_grade')" href="../../../../../_functions/can_grade.html" onMouseOver="funcPopup(event,'can_grade')">can_grade</a>()) {
<a name="l615"><span class="linenum"> 615</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l616"><span class="linenum"> 616</span></a>          }
<a name="l617"><span class="linenum"> 617</span></a>  
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment">        // Need to generate the page images - first get a combined pdf.</span>
<a name="l619"><span class="linenum"> 619</span></a>          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a> = self::<a class="function" onClick="logFunction('get_combined_pdf_for_attempt')" href="../../../../../_functions/get_combined_pdf_for_attempt.html" onMouseOver="funcPopup(event,'get_combined_pdf_for_attempt')">get_combined_pdf_for_attempt</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l620"><span class="linenum"> 620</span></a>          if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>) {
<a name="l621"><span class="linenum"> 621</span></a>              throw new \moodle_exception('Could not generate combined pdf.');
<a name="l622"><span class="linenum"> 622</span></a>          }
<a name="l623"><span class="linenum"> 623</span></a>  
<a name="l624"><span class="linenum"> 624</span></a>          <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> = \<a class="function" onClick="logFunction('make_temp_directory')" href="../../../../../_functions/make_temp_directory.html" onMouseOver="funcPopup(event,'make_temp_directory')">make_temp_directory</a>('assignfeedback_editpdf/final/' . self::<a class="function" onClick="logFunction('hash')" href="../../../../../_functions/hash.html" onMouseOver="funcPopup(event,'hash')">hash</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>));
<a name="l625"><span class="linenum"> 625</span></a>          <a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a> = <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> . '/' . self::COMBINED_PDF_FILENAME;
<a name="l626"><span class="linenum"> 626</span></a>          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('copy_content_to')" href="../../../../../_functions/copy_content_to.html" onMouseOver="funcPopup(event,'copy_content_to')">copy_content_to</a>(<a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a>); <span class="comment">// Copy the file.</span>
<a name="l627"><span class="linenum"> 627</span></a>  
<a name="l628"><span class="linenum"> 628</span></a>          <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a> = <span class="keyword">new </span><a class="class" onClick="logClass('pdf')" href="../../../../../_classes/pdf.html" onMouseOver="classPopup(event,'pdf')">pdf</a>();
<a name="l629"><span class="linenum"> 629</span></a>  
<a name="l630"><span class="linenum"> 630</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = \<a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l631"><span class="linenum"> 631</span></a>          <a class="var it23131" onMouseOver="hilite(23131)" onMouseOut="lolite()" onClick="logVariable('stamptmpdir')" href="../../../../../_variables/stamptmpdir.html">$stamptmpdir</a> = \<a class="function" onClick="logFunction('make_temp_directory')" href="../../../../../_functions/make_temp_directory.html" onMouseOver="funcPopup(event,'make_temp_directory')">make_temp_directory</a>('assignfeedback_editpdf/stamps/' . self::<a class="function" onClick="logFunction('hash')" href="../../../../../_functions/hash.html" onMouseOver="funcPopup(event,'hash')">hash</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>));
<a name="l632"><span class="linenum"> 632</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment">        // Copy any new stamps to this instance.</span>
<a name="l634"><span class="linenum"> 634</span></a>          if (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../../../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id,
<a name="l635"><span class="linenum"> 635</span></a>                                           'assignfeedback_editpdf',
<a name="l636"><span class="linenum"> 636</span></a>                                           'stamps',
<a name="l637"><span class="linenum"> 637</span></a>                                           <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>,
<a name="l638"><span class="linenum"> 638</span></a>                                           &quot;filename&quot;,
<a name="l639"><span class="linenum"> 639</span></a>                                           false)) {
<a name="l640"><span class="linenum"> 640</span></a>              foreach (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> as <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>) {
<a name="l641"><span class="linenum"> 641</span></a>                  <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a> = <a class="var it23131" onMouseOver="hilite(23131)" onMouseOut="lolite()" onClick="logVariable('stamptmpdir')" href="../../../../../_variables/stamptmpdir.html">$stamptmpdir</a> . '/' . <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../../../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>();
<a name="l642"><span class="linenum"> 642</span></a>                  <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('copy_content_to')" href="../../../../../_functions/copy_content_to.html" onMouseOver="funcPopup(event,'copy_content_to')">copy_content_to</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a>); <span class="comment">// Copy the file.</span>
<a name="l643"><span class="linenum"> 643</span></a>              }
<a name="l644"><span class="linenum"> 644</span></a>          }
<a name="l645"><span class="linenum"> 645</span></a>  
<a name="l646"><span class="linenum"> 646</span></a>          <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a> = <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('set_pdf')" href="../../../../../_functions/set_pdf.html" onMouseOver="funcPopup(event,'set_pdf')">set_pdf</a>(<a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a>);
<a name="l647"><span class="linenum"> 647</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l648"><span class="linenum"> 648</span></a>          <a class="class" onClick="logClass('page_editor')" href="../../../../../_classes/page_editor.html" onMouseOver="classPopup(event,'page_editor')">page_editor</a>::<a class="function" onClick="logFunction('release_drafts')" href="../../../../../_functions/release_drafts.html" onMouseOver="funcPopup(event,'release_drafts')">release_drafts</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>);
<a name="l649"><span class="linenum"> 649</span></a>  
<a name="l650"><span class="linenum"> 650</span></a>          for (<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a> = 0; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a> &lt; <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('pagecount')" href="../../../../../_variables/pagecount.html">$pagecount</a>; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a>++) {
<a name="l651"><span class="linenum"> 651</span></a>              <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('copy_page')" href="../../../../../_functions/copy_page.html" onMouseOver="funcPopup(event,'copy_page')">copy_page</a>();
<a name="l652"><span class="linenum"> 652</span></a>              <a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('comments')" href="../../../../../_variables/comments.html">$comments</a> = <a class="class" onClick="logClass('page_editor')" href="../../../../../_classes/page_editor.html" onMouseOver="classPopup(event,'page_editor')">page_editor</a>::<a class="function" onClick="logFunction('get_comments')" href="../../../../../_functions/get_comments.html" onMouseOver="funcPopup(event,'get_comments')">get_comments</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>, <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a>, false);
<a name="l653"><span class="linenum"> 653</span></a>              <a class="var it294" onMouseOver="hilite(294)" onMouseOut="lolite()" onClick="logVariable('annotations')" href="../../../../../_variables/annotations.html">$annotations</a> = <a class="class" onClick="logClass('page_editor')" href="../../../../../_classes/page_editor.html" onMouseOver="classPopup(event,'page_editor')">page_editor</a>::<a class="function" onClick="logFunction('get_annotations')" href="../../../../../_functions/get_annotations.html" onMouseOver="funcPopup(event,'get_annotations')">get_annotations</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>, <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../../_variables/i.html">$i</a>, false);
<a name="l654"><span class="linenum"> 654</span></a>  
<a name="l655"><span class="linenum"> 655</span></a>              foreach (<a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('comments')" href="../../../../../_variables/comments.html">$comments</a> as <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../../../_variables/comment.html">$comment</a>) {
<a name="l656"><span class="linenum"> 656</span></a>                  <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('add_comment')" href="../../../../../_functions/add_comment.html" onMouseOver="funcPopup(event,'add_comment')">add_comment</a>(<a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('rawtext')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../../../_variables/rawtext.html">rawtext</a>,
<a name="l657"><span class="linenum"> 657</span></a>                                    <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('x')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../../../_variables/x.html">x</a>,
<a name="l658"><span class="linenum"> 658</span></a>                                    <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('y')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../../../_variables/y.html">y</a>,
<a name="l659"><span class="linenum"> 659</span></a>                                    <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('width')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../../../_variables/width.html">width</a>,
<a name="l660"><span class="linenum"> 660</span></a>                                    <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('colour')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../../../_variables/colour.html">colour</a>);
<a name="l661"><span class="linenum"> 661</span></a>              }
<a name="l662"><span class="linenum"> 662</span></a>  
<a name="l663"><span class="linenum"> 663</span></a>              foreach (<a class="var it294" onMouseOver="hilite(294)" onMouseOut="lolite()" onClick="logVariable('annotations')" href="../../../../../_variables/annotations.html">$annotations</a> as <a class="var it4537" onMouseOver="hilite(4537)" onMouseOut="lolite()" onClick="logVariable('annotation')" href="../../../../../_variables/annotation.html">$annotation</a>) {
<a name="l664"><span class="linenum"> 664</span></a>                  <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('add_annotation')" href="../../../../../_functions/add_annotation.html" onMouseOver="funcPopup(event,'add_annotation')">add_annotation</a>(<a class="var it4537" onMouseOver="hilite(4537)" onMouseOut="lolite()" onClick="logVariable('annotation')" href="../../../../../_variables/annotation.html">$annotation</a>-&gt;<a onClick="logVariable('x')" class="var it45005" onMouseOver="hilite(45005)" onMouseOut="lolite()" href="../../../../../_variables/x.html">x</a>,
<a name="l665"><span class="linenum"> 665</span></a>                                       <a class="var it4537" onMouseOver="hilite(4537)" onMouseOut="lolite()" onClick="logVariable('annotation')" href="../../../../../_variables/annotation.html">$annotation</a>-&gt;<a onClick="logVariable('y')" class="var it45005" onMouseOver="hilite(45005)" onMouseOut="lolite()" href="../../../../../_variables/y.html">y</a>,
<a name="l666"><span class="linenum"> 666</span></a>                                       <a class="var it4537" onMouseOver="hilite(4537)" onMouseOut="lolite()" onClick="logVariable('annotation')" href="../../../../../_variables/annotation.html">$annotation</a>-&gt;<a onClick="logVariable('endx')" class="var it45005" onMouseOver="hilite(45005)" onMouseOut="lolite()" href="../../../../../_variables/endx.html">endx</a>,
<a name="l667"><span class="linenum"> 667</span></a>                                       <a class="var it4537" onMouseOver="hilite(4537)" onMouseOut="lolite()" onClick="logVariable('annotation')" href="../../../../../_variables/annotation.html">$annotation</a>-&gt;<a onClick="logVariable('endy')" class="var it45005" onMouseOver="hilite(45005)" onMouseOut="lolite()" href="../../../../../_variables/endy.html">endy</a>,
<a name="l668"><span class="linenum"> 668</span></a>                                       <a class="var it4537" onMouseOver="hilite(4537)" onMouseOut="lolite()" onClick="logVariable('annotation')" href="../../../../../_variables/annotation.html">$annotation</a>-&gt;<a onClick="logVariable('colour')" class="var it45005" onMouseOver="hilite(45005)" onMouseOut="lolite()" href="../../../../../_variables/colour.html">colour</a>,
<a name="l669"><span class="linenum"> 669</span></a>                                       <a class="var it4537" onMouseOver="hilite(4537)" onMouseOut="lolite()" onClick="logVariable('annotation')" href="../../../../../_variables/annotation.html">$annotation</a>-&gt;<a onClick="logVariable('type')" class="var it45005" onMouseOver="hilite(45005)" onMouseOut="lolite()" href="../../../../../_variables/type.html">type</a>,
<a name="l670"><span class="linenum"> 670</span></a>                                       <a class="var it4537" onMouseOver="hilite(4537)" onMouseOut="lolite()" onClick="logVariable('annotation')" href="../../../../../_variables/annotation.html">$annotation</a>-&gt;<a onClick="logVariable('path')" class="var it45005" onMouseOver="hilite(45005)" onMouseOut="lolite()" href="../../../../../_variables/path.html">path</a>,
<a name="l671"><span class="linenum"> 671</span></a>                                       <a class="var it23131" onMouseOver="hilite(23131)" onMouseOut="lolite()" onClick="logVariable('stamptmpdir')" href="../../../../../_variables/stamptmpdir.html">$stamptmpdir</a>);
<a name="l672"><span class="linenum"> 672</span></a>              }
<a name="l673"><span class="linenum"> 673</span></a>          }
<a name="l674"><span class="linenum"> 674</span></a>  
<a name="l675"><span class="linenum"> 675</span></a>          <a class="function" onClick="logFunction('fulldelete')" href="../../../../../_functions/fulldelete.html" onMouseOver="funcPopup(event,'fulldelete')">fulldelete</a>(<a class="var it23131" onMouseOver="hilite(23131)" onMouseOut="lolite()" onClick="logVariable('stamptmpdir')" href="../../../../../_variables/stamptmpdir.html">$stamptmpdir</a>);
<a name="l676"><span class="linenum"> 676</span></a>  
<a name="l677"><span class="linenum"> 677</span></a>          <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a> = self::<a class="function" onClick="logFunction('get_downloadable_feedback_filename')" href="../../../../../_functions/get_downloadable_feedback_filename.html" onMouseOver="funcPopup(event,'get_downloadable_feedback_filename')">get_downloadable_feedback_filename</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l678"><span class="linenum"> 678</span></a>          <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a> = <a class="function" onClick="logFunction('clean_param')" href="../../../../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../../../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l679"><span class="linenum"> 679</span></a>  
<a name="l680"><span class="linenum"> 680</span></a>          <a class="var it23132" onMouseOver="hilite(23132)" onMouseOut="lolite()" onClick="logVariable('generatedpdf')" href="../../../../../_variables/generatedpdf.html">$generatedpdf</a> = <a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a> . '/' . <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a>;
<a name="l681"><span class="linenum"> 681</span></a>          <a class="var it8998" onMouseOver="hilite(8998)" onMouseOut="lolite()" onClick="logVariable('pdf')" href="../../../../../_variables/pdf.html">$pdf</a>-&gt;<a class="function" onClick="logFunction('save_pdf')" href="../../../../../_functions/save_pdf.html" onMouseOver="funcPopup(event,'save_pdf')">save_pdf</a>(<a class="var it23132" onMouseOver="hilite(23132)" onMouseOut="lolite()" onClick="logVariable('generatedpdf')" href="../../../../../_variables/generatedpdf.html">$generatedpdf</a>);
<a name="l682"><span class="linenum"> 682</span></a>  
<a name="l683"><span class="linenum"> 683</span></a>  
<a name="l684"><span class="linenum"> 684</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a> = new \stdClass();
<a name="l685"><span class="linenum"> 685</span></a>  
<a name="l686"><span class="linenum"> 686</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/contextid.html">contextid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l687"><span class="linenum"> 687</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('component')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/component.html">component</a> = 'assignfeedback_editpdf';
<a name="l688"><span class="linenum"> 688</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filearea')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filearea.html">filearea</a> = self::FINAL_PDF_FILEAREA;
<a name="l689"><span class="linenum"> 689</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('itemid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/itemid.html">itemid</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>;
<a name="l690"><span class="linenum"> 690</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filepath')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filepath.html">filepath</a> = '/';
<a name="l691"><span class="linenum"> 691</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filename')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filename.html">filename</a> = <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../../../../_variables/filename.html">$filename</a>;
<a name="l692"><span class="linenum"> 692</span></a>  
<a name="l693"><span class="linenum"> 693</span></a>  
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment">        // Only keep one current version of the generated pdf.</span>
<a name="l695"><span class="linenum"> 695</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../../../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/contextid.html">contextid</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('component')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/component.html">component</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('filearea')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/filearea.html">filearea</a>, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('itemid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../../../../_variables/itemid.html">itemid</a>);
<a name="l696"><span class="linenum"> 696</span></a>  
<a name="l697"><span class="linenum"> 697</span></a>          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_file_from_pathname')" href="../../../../../_functions/create_file_from_pathname.html" onMouseOver="funcPopup(event,'create_file_from_pathname')">create_file_from_pathname</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../../../../_variables/record.html">$record</a>, <a class="var it23132" onMouseOver="hilite(23132)" onMouseOut="lolite()" onClick="logVariable('generatedpdf')" href="../../../../../_variables/generatedpdf.html">$generatedpdf</a>);
<a name="l698"><span class="linenum"> 698</span></a>  
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment">        // Cleanup.</span>
<a name="l700"><span class="linenum"> 700</span></a>          @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it23132" onMouseOver="hilite(23132)" onMouseOut="lolite()" onClick="logVariable('generatedpdf')" href="../../../../../_variables/generatedpdf.html">$generatedpdf</a>);
<a name="l701"><span class="linenum"> 701</span></a>          @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it23130" onMouseOver="hilite(23130)" onMouseOut="lolite()" onClick="logVariable('combined')" href="../../../../../_variables/combined.html">$combined</a>);
<a name="l702"><span class="linenum"> 702</span></a>          @<a class="phpfunction" onClick="logFunction('rmdir')" href="../../../../../_functions/rmdir.html" onMouseOver="phpfuncPopup(event,'rmdir')">rmdir</a>(<a class="var it10172" onMouseOver="hilite(10172)" onMouseOut="lolite()" onClick="logVariable('tmpdir')" href="../../../../../_variables/tmpdir.html">$tmpdir</a>);
<a name="l703"><span class="linenum"> 703</span></a>  
<a name="l704"><span class="linenum"> 704</span></a>          self::<a class="function" onClick="logFunction('copy_pages_to_readonly_area')" href="../../../../../_functions/copy_pages_to_readonly_area.html" onMouseOver="funcPopup(event,'copy_pages_to_readonly_area')">copy_pages_to_readonly_area</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>);
<a name="l705"><span class="linenum"> 705</span></a>  
<a name="l706"><span class="linenum"> 706</span></a>          return <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../../_variables/file.html">$file</a>;
<a name="l707"><span class="linenum"> 707</span></a>      }
<a name="l708"><span class="linenum"> 708</span></a>  
<a name="l709"><span class="linenum"> 709</span></a>      <span class="comment">/**</span>
<a name="l710"><span class="linenum"> 710</span></a>  <span class="comment">     * Copy the pages image to the readonly area.</span>
<a name="l711"><span class="linenum"> 711</span></a>  <span class="comment">     *</span>
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment">     * @param int|\assign $assignment The assignment.</span>
<a name="l713"><span class="linenum"> 713</span></a>  <span class="comment">     * @param \stdClass $grade The grade record.</span>
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment">     * @return void</span>
<a name="l715"><span class="linenum"> 715</span></a>  <span class="comment">     */</span>
<a name="l716"><span class="linenum"> 716</span></a>      public static function <a class="function" onClick="logFunction('copy_pages_to_readonly_area')" href="../../../../../_functions/copy_pages_to_readonly_area.html" onMouseOver="funcPopup(event,'copy_pages_to_readonly_area')">copy_pages_to_readonly_area</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>) {
<a name="l717"><span class="linenum"> 717</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l718"><span class="linenum"> 718</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l719"><span class="linenum"> 719</span></a>          <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l720"><span class="linenum"> 720</span></a>          <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a> = 'assignfeedback_editpdf';
<a name="l721"><span class="linenum"> 721</span></a>          <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>;
<a name="l722"><span class="linenum"> 722</span></a>  
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment">        // Get all the pages.</span>
<a name="l724"><span class="linenum"> 724</span></a>          <a class="var it2556" onMouseOver="hilite(2556)" onMouseOut="lolite()" onClick="logVariable('originalfiles')" href="../../../../../_variables/originalfiles.html">$originalfiles</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../../../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a>, self::PAGE_IMAGE_FILEAREA, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a>);
<a name="l725"><span class="linenum"> 725</span></a>          if (empty(<a class="var it2556" onMouseOver="hilite(2556)" onMouseOut="lolite()" onClick="logVariable('originalfiles')" href="../../../../../_variables/originalfiles.html">$originalfiles</a>)) {
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment">            // Nothing to do here...</span>
<a name="l727"><span class="linenum"> 727</span></a>              return;
<a name="l728"><span class="linenum"> 728</span></a>          }
<a name="l729"><span class="linenum"> 729</span></a>  
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment">        // Delete the old readonly files.</span>
<a name="l731"><span class="linenum"> 731</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../../../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a>, self::PAGE_IMAGE_READONLY_FILEAREA, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a>);
<a name="l732"><span class="linenum"> 732</span></a>  
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment">        // Do the copying.</span>
<a name="l734"><span class="linenum"> 734</span></a>          foreach (<a class="var it2556" onMouseOver="hilite(2556)" onMouseOut="lolite()" onClick="logVariable('originalfiles')" href="../../../../../_variables/originalfiles.html">$originalfiles</a> as <a class="var it869" onMouseOver="hilite(869)" onMouseOut="lolite()" onClick="logVariable('originalfile')" href="../../../../../_variables/originalfile.html">$originalfile</a>) {
<a name="l735"><span class="linenum"> 735</span></a>              <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_file_from_storedfile')" href="../../../../../_functions/create_file_from_storedfile.html" onMouseOver="funcPopup(event,'create_file_from_storedfile')">create_file_from_storedfile</a>(array('filearea' =&gt; self::PAGE_IMAGE_READONLY_FILEAREA), <a class="var it869" onMouseOver="hilite(869)" onMouseOut="lolite()" onClick="logVariable('originalfile')" href="../../../../../_variables/originalfile.html">$originalfile</a>);
<a name="l736"><span class="linenum"> 736</span></a>          }
<a name="l737"><span class="linenum"> 737</span></a>      }
<a name="l738"><span class="linenum"> 738</span></a>  
<a name="l739"><span class="linenum"> 739</span></a>      <span class="comment">/**</span>
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment">     * This function returns the generated pdf (if it exists).</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l744"><span class="linenum"> 744</span></a>  <span class="comment">     * @return stored_file</span>
<a name="l745"><span class="linenum"> 745</span></a>  <span class="comment">     */</span>
<a name="l746"><span class="linenum"> 746</span></a>      public static function <a class="function" onClick="logFunction('get_feedback_document')" href="../../../../../_functions/get_feedback_document.html" onMouseOver="funcPopup(event,'get_feedback_document')">get_feedback_document</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>) {
<a name="l747"><span class="linenum"> 747</span></a>  
<a name="l748"><span class="linenum"> 748</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l749"><span class="linenum"> 749</span></a>  
<a name="l750"><span class="linenum"> 750</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_view_submission')" href="../../../../../_functions/can_view_submission.html" onMouseOver="funcPopup(event,'can_view_submission')">can_view_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>)) {
<a name="l751"><span class="linenum"> 751</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l752"><span class="linenum"> 752</span></a>          }
<a name="l753"><span class="linenum"> 753</span></a>  
<a name="l754"><span class="linenum"> 754</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l755"><span class="linenum"> 755</span></a>  
<a name="l756"><span class="linenum"> 756</span></a>          <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l757"><span class="linenum"> 757</span></a>          <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a> = 'assignfeedback_editpdf';
<a name="l758"><span class="linenum"> 758</span></a>          <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a> = self::FINAL_PDF_FILEAREA;
<a name="l759"><span class="linenum"> 759</span></a>          <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>;
<a name="l760"><span class="linenum"> 760</span></a>          <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../../../../_variables/filepath.html">$filepath</a> = '/';
<a name="l761"><span class="linenum"> 761</span></a>  
<a name="l762"><span class="linenum"> 762</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = \<a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l763"><span class="linenum"> 763</span></a>          <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../../../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a>,
<a name="l764"><span class="linenum"> 764</span></a>                                       <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a>,
<a name="l765"><span class="linenum"> 765</span></a>                                       <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a>,
<a name="l766"><span class="linenum"> 766</span></a>                                       <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a>,
<a name="l767"><span class="linenum"> 767</span></a>                                       &quot;itemid, filepath, filename&quot;,
<a name="l768"><span class="linenum"> 768</span></a>                                       false);
<a name="l769"><span class="linenum"> 769</span></a>          if (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>) {
<a name="l770"><span class="linenum"> 770</span></a>              return <a class="phpfunction" onClick="logFunction('reset')" href="../../../../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../../../../_variables/files.html">$files</a>);
<a name="l771"><span class="linenum"> 771</span></a>          }
<a name="l772"><span class="linenum"> 772</span></a>          return false;
<a name="l773"><span class="linenum"> 773</span></a>      }
<a name="l774"><span class="linenum"> 774</span></a>  
<a name="l775"><span class="linenum"> 775</span></a>      <span class="comment">/**</span>
<a name="l776"><span class="linenum"> 776</span></a>  <span class="comment">     * This function deletes the generated pdf for a student.</span>
<a name="l777"><span class="linenum"> 777</span></a>  <span class="comment">     * @param int|\assign $assignment</span>
<a name="l778"><span class="linenum"> 778</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l779"><span class="linenum"> 779</span></a>  <span class="comment">     * @param int $attemptnumber (-1 means latest attempt)</span>
<a name="l780"><span class="linenum"> 780</span></a>  <span class="comment">     * @return bool</span>
<a name="l781"><span class="linenum"> 781</span></a>  <span class="comment">     */</span>
<a name="l782"><span class="linenum"> 782</span></a>      public static function <a class="function" onClick="logFunction('delete_feedback_document')" href="../../../../../_functions/delete_feedback_document.html" onMouseOver="funcPopup(event,'delete_feedback_document')">delete_feedback_document</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>) {
<a name="l783"><span class="linenum"> 783</span></a>  
<a name="l784"><span class="linenum"> 784</span></a>          <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a> = self::<a class="function" onClick="logFunction('get_assignment_from_param')" href="../../../../../_functions/get_assignment_from_param.html" onMouseOver="funcPopup(event,'get_assignment_from_param')">get_assignment_from_param</a>(<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>);
<a name="l785"><span class="linenum"> 785</span></a>  
<a name="l786"><span class="linenum"> 786</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_view_submission')" href="../../../../../_functions/can_view_submission.html" onMouseOver="funcPopup(event,'can_view_submission')">can_view_submission</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>)) {
<a name="l787"><span class="linenum"> 787</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l788"><span class="linenum"> 788</span></a>          }
<a name="l789"><span class="linenum"> 789</span></a>          if (!<a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('can_grade')" href="../../../../../_functions/can_grade.html" onMouseOver="funcPopup(event,'can_grade')">can_grade</a>()) {
<a name="l790"><span class="linenum"> 790</span></a>              \<a class="function" onClick="logFunction('print_error')" href="../../../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('nopermission');
<a name="l791"><span class="linenum"> 791</span></a>          }
<a name="l792"><span class="linenum"> 792</span></a>  
<a name="l793"><span class="linenum"> 793</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_user_grade')" href="../../../../../_functions/get_user_grade.html" onMouseOver="funcPopup(event,'get_user_grade')">get_user_grade</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../../../_variables/userid.html">$userid</a>, true, <a class="var it282" onMouseOver="hilite(282)" onMouseOut="lolite()" onClick="logVariable('attemptnumber')" href="../../../../../_variables/attemptnumber.html">$attemptnumber</a>);
<a name="l794"><span class="linenum"> 794</span></a>  
<a name="l795"><span class="linenum"> 795</span></a>          <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a> = <a class="var it284" onMouseOver="hilite(284)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../../../../_variables/assignment.html">$assignment</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../../../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l796"><span class="linenum"> 796</span></a>          <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a> = 'assignfeedback_editpdf';
<a name="l797"><span class="linenum"> 797</span></a>          <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a> = self::FINAL_PDF_FILEAREA;
<a name="l798"><span class="linenum"> 798</span></a>          <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../../../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../../../../_variables/id.html">id</a>;
<a name="l799"><span class="linenum"> 799</span></a>  
<a name="l800"><span class="linenum"> 800</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a> = \<a class="function" onClick="logFunction('get_file_storage')" href="../../../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l801"><span class="linenum"> 801</span></a>          return <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../../../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../../../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../../../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../../../../_variables/itemid.html">$itemid</a>);
<a name="l802"><span class="linenum"> 802</span></a>      }
<a name="l803"><span class="linenum"> 803</span></a>  
<a name="l804"><span class="linenum"> 804</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_converted_document': ['get_converted_document', 'Get converted document. ', [['lib/filestorage','file_storage.php',180]], 7],
'page_number_for_attempt': ['page_number_for_attempt', 'This function will return the number of pages of a pdf. ', [['mod/assign/feedback/editpdf/classes','document_services.php',343]], 2],
'copy_pages_to_readonly_area': ['copy_pages_to_readonly_area', 'Copy the pages image to the readonly area. ', [['mod/assign/feedback/editpdf/classes','document_services.php',709]], 2],
'getattribute': ['getattribute', '', [['lib/google/src/Google/Service','AdExchangeBuyer.php',2535],['auth/cas/CAS','CAS.php',1226],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter','Column.php',279],['lib/spout/src/Spout/Reader/Wrapper','SimpleXMLElement.php',47],['lib/phpexcel/PHPExcel/Reader/Excel2007','Chart.php',37],['auth/cas/CAS/CAS','Client.php',1196],['lib/pear/HTML','Common.php',271]], 1140],
'hash': ['hash', 'Expose the hash function for testing, probing, and extension. ', [['lib/horde/framework/Horde/Support','ConsistentHash.php',218],['mod/assign/feedback/editpdf/classes','document_services.php',100],['filter/censor','filter.php',47],['lib','filterlib.php',393],['lib/horde/framework/Horde/Imap/Client/Fetch','Query.php',288]], 195],
'delete_area_files': ['delete_area_files', 'Delete all area files (optionally limited by itemid). ', [['lib/filestorage','file_storage.php',992]], 123],
'get_context': ['get_context', 'Return the course context for new modules, or the module context for existing modules. ', [['course','moodleform_mod.php',148],['availability/classes','info_module.php',72],['availability/classes','info_section.php',55],['competency/classes','user_competency_plan.php',83],['availability/tests/fixtures','mock_info.php',59],['mod/feedback/classes','responses_table.php',146],['competency/classes','competency.php',730],['competency/classes','plan.php',258],['mod/quiz','attemptlib.php',220],['competency/classes','user_competency.php',216],['grade/grading','lib.php',107],['lib','modinfolib.php',1486],['lib','badgeslib.php',157],['competency/classes/external','exporter.php',172],['comment','lib.php',994],['grade/grading/form','lib.php',102],['mod/assign','locallib.php',1307],['competency/classes','user_evidence.php',90],['competency/classes','user_competency_course.php',80],['lib/classes/event','base.php',627],['enrol','locallib.php',921],['lib','coursecatlib.php',2369],['lib','coursecatlib.php',3065],['competency/classes','course_competency_settings.php',133],['lib/tests/behat','behat_data_generators.php',769],['competency/classes','competency_framework.php',70],['competency/classes','template.php',139]], 1033],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',481]], 1488],
'create_file_from_pathname': ['create_file_from_pathname', 'Create new file from pathname - make sure params are valid. ', [['lib/filebrowser','file_info.php',392],['lib/filebrowser','file_info_stored.php',537],['lib/filestorage','file_storage.php',1367]], 54],
'loadhtml': ['loadhtml', '', [['backup/cc/cc_lib','xmlbase.php',112]], 20],
'fullname': ['fullname', 'Returns a persons full name ', [['lib','moodlelib.php',3249],['mod/assign','locallib.php',3915]], 546],
'create_file_from_storedfile': ['create_file_from_storedfile', 'Create new file from stored file - make sure params are valid. ', [['lib/filebrowser','file_info.php',405],['lib/filebrowser','file_info_stored.php',584],['lib/filestorage','file_storage.php',1186]], 47],
'assign': ['assign', 'Assign a new permission. ', [['course/tests/fixtures','course_capability_assignment.php',79]], 83],
'strip_images': ['strip_images', 'Use a DOM parser to accurately replace images with their alt text. ', [['mod/assign/feedback/editpdf/classes','document_services.php',115]], 1],
'is_area_empty': ['is_area_empty', 'Are there any files (or directories) ', [['lib/filestorage','file_storage.php',723]], 13],
'create_file_from_string': ['create_file_from_string', 'Create new file from string - make sure params are valid. ', [['lib/filebrowser','file_info.php',379],['lib/filebrowser','file_info_stored.php',490],['lib/filestorage','file_storage.php',1482]], 132],
'generate_feedback_document': ['generate_feedback_document', 'This function takes the combined pdf and embeds all the comments and annotations. ', [['mod/assign/feedback/editpdf/classes','document_services.php',595]], 3],
'copy_page': ['copy_page', 'Copy the next page from the source file and set it as the current page ', [['mod/assign/feedback/editpdf/classes','pdf.php',166]], 2],
'get_file': ['get_file', 'Downloads a repository file and saves to a path. ', [['repository/boxnet','lib.php',179],['repository/flickr_public','lib.php',453],['repository/dropbox','lib.php',410],['repository/skydrive','lib.php',130],['repository','lib.php',1647],['repository/s3','lib.php',227],['repository/equella','lib.php',166],['mod/data/field/picture','field.class.php',126],['mod/data/field/file','field.class.php',123],['repository/googledocs','lib.php',408],['lib/filestorage','file_storage.php',700],['repository/webdav','lib.php',73],['repository/filesystem','lib.php',398],['repository/flickr','lib.php',277],['lib','externallib.php',1076],['repository/dropbox','locallib.php',114],['lib','webdavlib.php',391]], 169],
'ensure_pdf_compatible': ['ensure_pdf_compatible', 'Check to see if PDF is version 1.4 (or below); if not: use ghostscript to convert it ', [['mod/assign/feedback/editpdf/classes','pdf.php',466]], 2],
'is_blind_marking': ['is_blind_marking', 'Is blind marking enabled and reveal identities not set yet? ', [['mod/assign','locallib.php',310]], 36],
'add_comment': ['add_comment', 'Add a comment to the current page ', [['mod/assign/feedback/editpdf/classes','pdf.php',213],['mod/assign/feedback/editpdf/classes','page_editor.php',108],['mod/wiki','pagelib.php',2302],['mod/assign/feedback/editpdf/classes','comments_quick_list.php',50]], 8],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',6144]], 546],
'list_compatible_submission_files_for_attempt': ['list_compatible_submission_files_for_attempt', 'This function will search for all files that can be converted and concatinated into a PDF (1.4) - for any submission plugin for this students attempt. ', [['mod/assign/feedback/editpdf/classes','document_services.php',142]], 1],
'make_temp_directory': ['make_temp_directory', 'Create a directory under tempdir and make sure it is writable. ', [['lib','setuplib.php',1642]], 50],
'set_image_folder': ['set_image_folder', 'Set the path to the folder in which to generate page image files ', [['mod/assign/feedback/editpdf/classes','pdf.php',401]], 2],
'is_enabled': ['is_enabled', 'Tools cannot be disabled. ', [['lib/classes/plugininfo','tool.php',39],['admin/tool/recyclebin/classes','category_bin.php',54],['admin/tool/log/classes/plugininfo','logstore.php',35],['admin/tool/recyclebin/classes','course_bin.php',54],['mod/assign/feedback/offline','locallib.php',380],['admin/tool/recyclebin/classes','base_bin.php',38],['lib','adminlib.php',1955],['search/classes','base.php',190],['lib','medialib.php',318],['lib','medialib.php',635],['lib','medialib.php',1268],['admin/tool/health','index.php',393],['lib/classes/plugininfo','mnetservice.php',33],['lib/classes/message/inbound','manager.php',37],['mod/assignment/classes/plugininfo','assignment.php',32],['competency/classes','api.php',49],['mod/assign','assignmentplugin.php',223],['lib/classes/plugininfo','orphaned.php',37],['search/tests/fixtures','mock_search_area.php',38],['tag/classes','area.php',106],['lib/classes/plugininfo','base.php',383],['mod/assign/feedback/editpdf','locallib.php',340],['tag/classes','tag.php',1269],['mod/assign/submission/comments','locallib.php',172],['lib','completionlib.php',269]], 276],
'generate_page_images_for_attempt': ['generate_page_images_for_attempt', 'This function will generate and return a list of the page images from a pdf. ', [['mod/assign/feedback/editpdf/classes','document_services.php',399]], 2],
'get_assignment_from_param': ['get_assignment_from_param', 'This function will take an int or an assignment instance and return an assignment instance. It is just for convenience. ', [['mod/assign/feedback/editpdf/classes','document_services.php',80]], 11],
'get_directory_files': ['get_directory_files', 'Returns all files and optionally directories ', [['lib/filestorage','file_storage.php',899]], 25],
'load_pdf': ['load_pdf', 'Load the specified PDF and set the initial output configuration Used when processing comments and outputting a new PDF ', [['mod/assign/feedback/editpdf/classes','pdf.php',122]], 4],
'get_filename': ['get_filename', 'Returns file name ', [['lib/filebrowser','virtual_root_file.php',227],['lib/filestorage','stored_file.php',699],['lib','medialib.php',169]], 248],
'get_files': ['get_files', 'Returns the array of attached files. ', [['search/classes','document.php',221],['question/engine','datalib.php',1599],['question/engine','datalib.php',1700],['question/engine','datalib.php',1759],['files','externallib.php',64],['mod/assign/submission/file','locallib.php',288],['mod/assign','assignmentplugin.php',443],['competency/classes','user_evidence.php',122],['mod/assign/submission/onlinetext','locallib.php',378]], 14],
'save_pdf': ['save_pdf', 'Save the completed PDF to the given file ', [['mod/assign/feedback/editpdf/classes','pdf.php',391]], 2],
'get_type': ['get_type', 'Get the type of the feed ', [['lib/simplepie/library','SimplePie.php',1624],['lib/simplepie/library/SimplePie','Restriction.php',122],['backup/util/ui','backup_ui_setting.class.php',102],['backup/util/ui','base_ui.class.php',294],['mod/lesson','locallib.php',2394],['lib/simplepie/library/SimplePie','Enclosure.php',877],['lib/classes','chart_series.php',127],['grade/report/singleview/classes/local/ui','bulk_insert.php',62],['lib/simplepie/library/SimplePie/Content/Type','Sniffer.php',79],['backup/util/plan','backup_plan.class.php',70],['availability/classes','condition.php',102],['mod/assign','assignmentplugin.php',153],['backup/controller','backup_controller.class.php',244],['lib/classes','chart_base.php',150],['mod/workshop','locallib.php',3936],['mod/lti/classes/local/ltiservice','resource_base.php',114],['lib/simplepie/library/SimplePie','Caption.php',193],['backup/controller','restore_controller.class.php',261]], 90],
'can_grade': ['can_grade', 'Does this user have grade permission for this assignment? ', [['mod/assign','locallib.php',2811]], 10],
'copy_content_to': ['copy_content_to', 'Copy content of file to given pathname ', [['lib/filebrowser','virtual_root_file.php',115],['lib/filestorage','stored_file.php',466]], 13],
'get_user_grade': ['get_user_grade', 'This will retrieve a grade object from the db, optionally creating it if required. ', [['mod/assign','locallib.php',3130]], 61],
'clean_filename': ['clean_filename', 'Cleans a given filename by removing suspicious or troublesome characters ', [['lib','moodlelib.php',6575]], 58],
'get_annotations': ['get_annotations', 'Get all annotations for a page. ', [['mod/assign/feedback/editpdf/classes','page_editor.php',129]], 10],
'groups_get_group_name': ['groups_get_group_name', 'Gets the name of a group with a specified id ', [['lib','grouplib.php',55]], 14],
'clean_param': ['clean_param', 'Used by {@link optional_param()} and {@link required_param()} to clean the variables and/or cast to specific types, based on an options field. <code> $course->format = clean_param($course->format, PARAM_ALPHA); $selectedgradeitem = clean_param($selectedgradeitem, PARAM_INT); </code> ', [['lib','moodlelib.php',769]], 635],
'groups_get_activity_group': ['groups_get_activity_group', 'Returns group active in activity, changes the group by default if \'group\' page param present ', [['lib','grouplib.php',814]], 97],
'release_drafts': ['release_drafts', 'Release the draft comments and annotations to students. ', [['mod/assign/feedback/editpdf/classes','page_editor.php',211]], 3],
'get_downloadable_feedback_filename': ['get_downloadable_feedback_filename', 'This function returns sensible filename for a feedback file. ', [['mod/assign/feedback/editpdf/classes','document_services.php',557]], 1],
'delete_draft_content': ['delete_draft_content', 'Delete the draft annotations and comments. ', [['mod/assign/feedback/editpdf/classes','page_editor.php',382]], 1],
'get_uniqueid_for_user': ['get_uniqueid_for_user', 'Call the static version of this function ', [['mod/assign','locallib.php',7805]], 26],
'get_coursemodule_from_instance': ['get_coursemodule_from_instance', 'Given an instance number of a module, finds the coursemodule description ', [['lib','datalib.php',1300]], 441],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',3012]], 1007],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'fulldelete': ['fulldelete', 'Recursively delete the file or folder with path $location. That is, if it is a file delete it. If it is a folder, delete all its content then delete it. If $location does not exist to start, that is not considered an error. ', [['lib','filelib.php',2370]], 39],
'get_submission_plugins': ['get_submission_plugins', 'Get list of submission plugins installed. ', [['mod/assign','locallib.php',301]], 27],
'get_timemodified': ['get_timemodified', 'Returns time modified unix timestamp if known ', [['lib/filebrowser','file_info.php',295],['lib/filebrowser','virtual_root_file.php',272],['lib/filebrowser','file_info_stored.php',258],['lib/filestorage','stored_file.php',756]], 63],
'get_user_submission': ['get_user_submission', 'Load the submission object for a particular user, optionally creating it if required. ', [['mod/assign','locallib.php',3001]], 87],
'delete': ['delete', 'Deletes an item from the cache store. ', [['cache/stores/static','lib.php',374],['cache','disabledlib.php',102],['lib/google/src/Google/Service','AdSense.php',1258],['lib/google/src/Google/Service','AdSense.php',1730],['lib/grade','grade_item.php',396],['lib/google/src/Google/Service','Replicapool.php',378],['lib/google/src/Google/Service','Tasks.php',310],['lib/google/src/Google/Service','Tasks.php',428],['lib/google/src/Google/Service','AndroidPublisher.php',1230],['lib/google/src/Google/Service','AndroidPublisher.php',1310],['lib/google/src/Google/Service','AndroidPublisher.php',1668],['lib/google/src/Google/Service','AndroidPublisher.php',1763],['lib/google/src/Google/Service','AndroidPublisher.php',2083],['lib/google/src/Google/Service','YouTubeReporting.php',255],['lib/google/src/Google/Service','Reseller.php',441],['lib/google/src/Google/Cache','Memcache.php',144],['lib','filelib.php',3481],['lib/google/src/Google/Service','Computeaccounts.php',418],['lib/google/src/Google/Service','Computeaccounts.php',497],['lib/google/src/Google/Service','Computeaccounts.php',668],['lib/grade','grade_category.php',281],['lib/grade','grade_scale.php',136],['lib/adodb','adodb-active-record.inc.php',901],['lib/grade','grade_object.php',270],['lib/google/src/Google/Service','YouTubeAnalytics.php',352],['lib/google/src/Google/Service','YouTubeAnalytics.php',447],['lib/google/src/Google/Service','MapsEngine.php',1693],['lib/google/src/Google/Service','MapsEngine.php',1991],['lib/google/src/Google/Service','MapsEngine.php',2344],['lib/google/src/Google/Service','MapsEngine.php',2651],['lib/google/src/Google/Service','MapsEngine.php',2912],['completion','data_object.php',273],['lib/google/src/Google/Cache','File.php',115],['cache/classes','dummystore.php',198],['lib/google/src/Google/Service','Dns.php',378],['cache/classes','loaders.php',792],['cache/classes','loaders.php',1471],['cache/classes','loaders.php',1841],['lib/google/src/Google/Service','Appengine.php',352],['lib/google/src/Google/Service','Appengine.php',455],['tag/classes','collection.php',260],['lib/filebrowser','file_info.php',418],['lib/google/src/Google/Service','AdExchangeBuyer.php',938],['lib/google/src/Google/Service','AdExchangeBuyer.php',1137],['lib/google/src/Google/Service','AdExchangeBuyer.php',1561],['lib/filebrowser','virtual_root_file.php',69],['lib/google/src/Google/Service','Books.php',1946],['lib/grade','grade_grade.php',1024],['lib/grade','grade_outcome.php',97],['lib/google/src/Google/Service','Analytics.php',2165],['lib/google/src/Google/Service','Analytics.php',2534],['lib/google/src/Google/Service','Analytics.php',2655],['lib/google/src/Google/Service','Analytics.php',2872],['lib/google/src/Google/Service','Analytics.php',3001],['lib/google/src/Google/Service','Analytics.php',3092],['lib/google/src/Google/Service','Analytics.php',3406],['lib/google/src/Google/Service','Analytics.php',3631],['lib/google/src/Google/Service','DeploymentManager.php',452],['lib/google/src/Google/Service','Blogger.php',1065],['lib/google/src/Google/Service','Blogger.php',1227],['lib/google/src/Google/Service','Blogger.php',1451],['lib/filebrowser','file_info_stored.php',631],['competency/classes','persistent.php',510],['lib/google/src/Google/Service','CloudUserAccounts.php',528],['lib/google/src/Google/Service','CloudUserAccounts.php',628],['lib/google/src/Google/Service','CloudUserAccounts.php',893],['lib/google/src/Google/Service','Cloudresourcemanager.php',390],['lib/htmlpurifier/HTMLPurifier','Zipper.php',89],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',960],['lib/google/src/Google/Service','TagManager.php',1022],['lib/google/src/Google/Service','TagManager.php',1113],['lib/google/src/Google/Service','TagManager.php',1265],['lib/google/src/Google/Service','TagManager.php',1358],['lib/google/src/Google/Service','TagManager.php',1452],['lib/google/src/Google/Service','TagManager.php',1546],['lib/google/src/Google/Service','TagManager.php',1696],['mod/lesson','locallib.php',1037],['mod/lesson','locallib.php',2271],['repository','lib.php',427],['repository','lib.php',1962],['admin/tool/uploadcourse/classes','course.php',226],['lib','badgeslib.php',640],['lib/google/src/Google/Service','Bigquery.php',531],['lib/google/src/Google/Service','Bigquery.php',863],['lib/google/src/Google/Service','ShoppingContent.php',1050],['lib/google/src/Google/Service','ShoppingContent.php',1448],['lib/google/src/Google/Service','ShoppingContent.php',1970],['lib/google/src/Google/Service','Webmasters.php',355],['lib/google/src/Google/Service','Webmasters.php',449],['lib/google/src/Google/Service','Clouddebugger.php',384],['lib/filestorage','stored_file.php',323],['lib/google/src/Google/Service','Container.php',309],['lib/google/src/Google/Service','Storage.php',1042],['lib/google/src/Google/Service','Storage.php',1157],['lib/google/src/Google/Service','Storage.php',1332],['lib/google/src/Google/Service','Storage.php',1454],['lib/google/src/Google/Service','Storage.php',1681],['cache/stores/memcache','lib.php',401],['lib/google/src/Google/Service','Genomics.php',646],['lib/google/src/Google/Service','Genomics.php',735],['lib/google/src/Google/Service','Genomics.php',903],['lib/google/src/Google/Service','Genomics.php',971],['lib/google/src/Google/Service','Genomics.php',1326],['lib/google/src/Google/Service','Genomics.php',1443],['lib/google/src/Google/Service','Licensing.php',224],['lib/google/src/Google/Service','Fitness.php',400],['lib/google/src/Google/Service','Fitness.php',512],['lib/google/src/Google/Service','Fitness.php',647],['comment','lib.php',790],['lib/google/src/Google/Service','Gmail.php',763],['lib/google/src/Google/Service','Gmail.php',921],['lib/google/src/Google/Service','Gmail.php',1014],['lib/google/src/Google/Service','Gmail.php',1234],['lib/google/src/Google/Service','Taskqueue.php',293],['lib/adodb','adodb-active-recordx.inc.php',1016],['lib','accesslib.php',5580],['cache/classes','interfaces.php',161],['lib/google/src/Google/Service','Autoscaler.php',315],['lib/google/src/Google/Service','Autoscaler.php',429],['lib/google/src/Google/Service','Prediction.php',262],['lib/google/src/Google/Service','SiteVerification.php',139],['lib/google/src/Google/Service','Drive.php',1522],['lib/google/src/Google/Service','Drive.php',1603],['lib/google/src/Google/Service','Drive.php',1748],['lib/google/src/Google/Service','Drive.php',2040],['lib/google/src/Google/Service','Drive.php',2110],['lib/google/src/Google/Service','Drive.php',2240],['lib/google/src/Google/Service','Drive.php',2403],['lib/google/src/Google/Service','Drive.php',2523],['lib/google/src/Google/Service','Proximitybeacon.php',522],['lib/google/src/Google/Service','Directory.php',1683],['lib/google/src/Google/Service','Directory.php',1916],['lib/google/src/Google/Service','Directory.php',1989],['lib/google/src/Google/Service','Directory.php',2059],['lib/google/src/Google/Service','Directory.php',2169],['lib/google/src/Google/Service','Directory.php',2224],['lib/google/src/Google/Service','Directory.php',2351],['lib/google/src/Google/Service','Directory.php',2420],['lib/google/src/Google/Service','Directory.php',2517],['lib/google/src/Google/Service','Directory.php',2652],['lib/google/src/Google/Service','Directory.php',2731],['lib/google/src/Google/Service','Directory.php',2836],['lib/google/src/Google/Service','Directory.php',2938],['lib/google/src/Google/Service','Directory.php',2999],['lib/google/src/Google/Service','Directory.php',3199],['lib/google/src/Google/Service','Directory.php',3274],['lib/google/src/Google/Service','Fusiontables.php',645],['lib/google/src/Google/Service','Fusiontables.php',812],['lib/google/src/Google/Service','Fusiontables.php',937],['lib/google/src/Google/Service','Fusiontables.php',1126],['lib/google/src/Google/Service','Fusiontables.php',1188],['lib/google/src/Google/Service','AdSenseHost.php',734],['lib/google/src/Google/Service','AdSenseHost.php',1010],['lib/google/src/Google/Service','AdSenseHost.php',1168],['lib/google/src/Google/Service','Mirror.php',425],['lib/google/src/Google/Service','Mirror.php',593],['lib/google/src/Google/Service','Mirror.php',661],['lib/google/src/Google/Service','Mirror.php',772],['tag/classes','area.php',187],['lib/google/src/Google/Service','AndroidEnterprise.php',988],['lib/google/src/Google/Service','AndroidEnterprise.php',1092],['lib/google/src/Google/Service','AndroidEnterprise.php',1280],['lib/google/src/Google/Service','AndroidEnterprise.php',1415],['lib/google/src/Google/Service','AndroidEnterprise.php',1597],['course','lib.php',3263],['mnet','peer.php',118],['search/tests/fixtures','mock_search_engine.php',48],['lib/google/src/Google/Service','Calendar.php',903],['lib/google/src/Google/Service','Calendar.php',1071],['lib/google/src/Google/Service','Calendar.php',1269],['lib/google/src/Google/Service','Calendar.php',1412],['cache/stores/session','lib.php',417],['blog','locallib.php',322],['lib/google/src/Google/Service','Storagetransfer.php',381],['cache/stores/mongodb','lib.php',361],['lib/google/src/Google/Cache','Null.php',53],['lib/google/src/Google/Service','GamesConfiguration.php',251],['lib/google/src/Google/Service','GamesConfiguration.php',390],['cache/stores/file','lib.php',393],['badges/criteria','award_criteria.php',330],['cache/stores/memcached','lib.php',402],['lib/google/src/Google/Service','AppState.php',154],['lib/google/src/Google/Service','Resourceviews.php',423],['lib/portfolio','plugin.php',692],['calendar','lib.php',2423],['lib/google/src/Google/Service','Classroom.php',466],['lib/google/src/Google/Service','Classroom.php',615],['lib/google/src/Google/Service','Classroom.php',701],['lib/google/src/Google/Service','Classroom.php',806],['lib/google/src/Google/Service','Classroom.php',934],['lib/google/src/Google/Service','SQLAdmin.php',786],['lib/google/src/Google/Service','SQLAdmin.php',856],['lib/google/src/Google/Service','SQLAdmin.php',1023],['lib/google/src/Google/Service','SQLAdmin.php',1368],['lib/google/src/Google/Service','SQLAdmin.php',1483],['badges/criteria','award_criteria_manual.php',220],['search/engine/solr/classes','engine.php',1045],['lib/google/src/Google/Service','Compute.php',4021],['lib/google/src/Google/Service','Compute.php',4149],['lib/google/src/Google/Service','Compute.php',4284],['lib/google/src/Google/Service','Compute.php',4571],['lib/google/src/Google/Service','Compute.php',4671],['lib/google/src/Google/Service','Compute.php',4829],['lib/google/src/Google/Service','Compute.php',4942],['lib/google/src/Google/Service','Compute.php',5033],['lib/google/src/Google/Service','Compute.php',5174],['lib/google/src/Google/Service','Compute.php',5248],['lib/google/src/Google/Service','Compute.php',5378],['lib/google/src/Google/Service','Compute.php',5508],['lib/google/src/Google/Service','Compute.php',5683],['lib/google/src/Google/Service','Compute.php',5984],['lib/google/src/Google/Service','Compute.php',6156],['lib/google/src/Google/Service','Compute.php',6316],['lib/google/src/Google/Service','Compute.php',6717],['lib/google/src/Google/Service','Compute.php',6898],['lib/google/src/Google/Service','Compute.php',7037],['lib/google/src/Google/Service','Compute.php',7128],['lib/google/src/Google/Service','Compute.php',7208],['lib/google/src/Google/Service','Compute.php',7299],['lib/google/src/Google/Service','Compute.php',7409],['lib/google/src/Google/Service','Compute.php',7570],['lib/google/src/Google/Service','Compute.php',7734],['lib/google/src/Google/Service','Compute.php',7938],['lib/google/src/Google/Service','Compute.php',8035],['lib/google/src/Google/Service','Compute.php',8210],['lib/google/src/Google/Service','Compute.php',8305],['lib/google/src/Google/Service','Pubsub.php',240],['lib/google/src/Google/Service','Pubsub.php',379],['lib/google/src/Google/Service','YouTube.php',1810],['lib/google/src/Google/Service','YouTube.php',2061],['lib/google/src/Google/Service','YouTube.php',2459],['lib/google/src/Google/Service','YouTube.php',2889],['lib/google/src/Google/Service','YouTube.php',3187],['lib/google/src/Google/Service','YouTube.php',3419],['lib/google/src/Google/Service','YouTube.php',3559],['lib/google/src/Google/Service','YouTube.php',3928],['lib/google/src/Google/Service','YouTube.php',4158],['lib/google/src/Google/Cache','Apc.php',105],['lib/google/src/Google/Service','Dfareporting.php',5000],['lib/google/src/Google/Service','Dfareporting.php',5566],['lib/google/src/Google/Service','Dfareporting.php',5753],['lib/google/src/Google/Service','Dfareporting.php',5877],['lib/google/src/Google/Service','Dfareporting.php',6397],['lib/google/src/Google/Service','Dfareporting.php',6578],['lib/google/src/Google/Service','Dfareporting.php',6731],['lib/google/src/Google/Service','Dfareporting.php',6996],['lib/google/src/Google/Service','Dfareporting.php',7503],['lib/google/src/Google/Service','Dfareporting.php',8102],['lib/google/src/Google/Service','Dfareporting.php',8768],['lib/google/src/Google/Service','Manager.php',244],['lib/google/src/Google/Service','Manager.php',324],['lib/google/src/Google/Service','CloudMonitoring.php',274],['lib','webdavlib.php',691]], 317],
'is_visible': ['is_visible', 'Check if the field data is visible to the current user ', [['user/profile','lib.php',322],['repository/coursefiles','lib.php',167],['repository','lib.php',1779],['mod/assign','assignmentplugin.php',287],['backup/cc/cc_lib','cc_converters.php',113]], 63],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'groups_get_activity_groupmode': ['groups_get_activity_groupmode', 'Returns effective groupmode used in activity, course setting overrides activity setting if groupmodeforce enabled. ', [['lib','grouplib.php',468]], 136],
'getmessage': ['getmessage', '', [['lib/google/src/Google/Service','Freebase.php',441],['lib/google/src/Google/Service','AdSense.php',2970],['lib/google/src/Google/Service','Replicapool.php',1165],['lib/google/src/Google/Service','Replicapool.php',1257],['lib/google/src/Google/Service','Computeaccounts.php',1368],['lib/google/src/Google/Service','Computeaccounts.php',1460],['lib/google/src/Google/Service','Appengine.php',1604],['lib/google/src/Google/Service','Books.php',3579],['lib/google/src/Google/Service','Books.php',4429],['lib/google/src/Google/Service','Script.php',360],['lib/google/src/Google/Service','DeploymentManager.php',1116],['lib/google/src/Google/Service','DeploymentManager.php',1604],['lib/google/src/Google/Service','DeploymentManager.php',1641],['lib/google/src/Google/Service','DeploymentManager.php',1823],['lib/google/src/Google/Service','DeploymentManager.php',1860],['lib/google/src/Google/Service','Dataflow.php',2656],['lib/google/src/Google/Service','CloudUserAccounts.php',1807],['lib/google/src/Google/Service','CloudUserAccounts.php',1899],['lib/google/src/Google/Service','Replicapoolupdater.php',617],['lib/google/src/Google/Service','Replicapoolupdater.php',926],['lib/google/src/Google/Service','Replicapoolupdater.php',1018],['lib/google/src/Google/Service','Replicapoolupdater.php',1252],['lib/google/src/Google/Service','Bigquery.php',1367],['lib/google/src/Google/Service','ShoppingContent.php',4125],['lib/google/src/Google/Service','ShoppingContent.php',4527],['lib/google/src/Google/Service','ShoppingContent.php',4572],['lib/google/src/Google/Service','Genomics.php',3622],['lib/google/src/Google/Service','Reports.php',1106],['lib/google/src/Google/Service','Gmail.php',1371],['lib/google/src/Google/Service','Gmail.php',1467],['lib/google/src/Google/Service','Gmail.php',1495],['lib/google/src/Google/Service','Gmail.php',1513],['lib/google/src/Google/Service','Gmail.php',1531],['lib/google/src/Google/Service','Autoscaler.php',1079],['lib/google/src/Google/Service','Autoscaler.php',1171],['lib/google/src/Google/Service','AdExchangeSeller.php',1043],['lib/google/src/Google/Service','IdentityToolkit.php',1266],['lib/pear','PEAR.php',941],['lib/google/src/Google/Service','Storagetransfer.php',948],['lib/htmlpurifier/HTMLPurifier','Language.php',86],['lib/google/src/Google/Service','Resourceviews.php',894],['lib/google/src/Google/Service','Resourceviews.php',986],['lib/google/src/Google/Service','SQLAdmin.php',3029],['lib/google/src/Google/Service','Compute.php',8752],['lib/google/src/Google/Service','Compute.php',9200],['lib/google/src/Google/Service','Compute.php',10292],['lib/google/src/Google/Service','Compute.php',10384],['lib/google/src/Google/Service','Compute.php',10890],['lib/google/src/Google/Service','Compute.php',12525],['lib/google/src/Google/Service','Compute.php',12771],['lib/google/src/Google/Service','Compute.php',13249],['lib/google/src/Google/Service','Compute.php',13652],['lib/google/src/Google/Service','Compute.php',13804],['lib/google/src/Google/Service','Compute.php',14396],['lib/google/src/Google/Service','Compute.php',14488],['lib/google/src/Google/Service','Compute.php',14580],['lib/google/src/Google/Service','Compute.php',15235],['lib/google/src/Google/Service','Compute.php',16249],['lib/google/src/Google/Service','Compute.php',16675],['lib/google/src/Google/Service','Compute.php',17005],['lib/google/src/Google/Service','Compute.php',17723],['lib/google/src/Google/Service','Pubsub.php',711],['lib/google/src/Google/Service','Pubsub.php',748],['lib/google/src/Google/Service','Dfareporting.php',19533]], 489],
'get_mimetype': ['get_mimetype', 'Returns mimetype ', [['lib/filebrowser','file_info.php',277],['lib/filebrowser','virtual_root_file.php',254],['lib/filebrowser','file_info_stored.php',240],['lib/filestorage','stored_file.php',738],['lib','medialib.php',192],['lib/portfolio','caller.php',453]], 59],
'set_pdf': ['set_pdf', 'Sets the name of the PDF to process, but only loads the file if the pagecount is zero (in order to count the number of pages) Used when generating page images (but not a new PDF) ', [['mod/assign/feedback/editpdf/classes','pdf.php',148]], 4],
'get_instance': ['get_instance', 'Get the DB record for the current instance. ', [['course','moodleform_mod.php',116],['question/engine','bank.php',464],['backup/util/output','output_controller.class.php',53],['repository','lib.php',1137],['backup/util/helper','restore_logs_processor.class.php',69],['grade/grading/form','lib.php',474],['mnet/service/enrol','locallib.php',57],['mod/assign','locallib.php',1224],['lib','externallib.php',1000],['blog','locallib.php',857]], 420],
'combine_pdfs': ['combine_pdfs', 'Combine the given PDF files into a single PDF. Optionally add a coversheet and coversheet fields. ', [['mod/assign/feedback/editpdf/classes','pdf.php',72]], 1],
'get_comments': ['get_comments', 'Return comments by pages ', [['comment','locallib.php',47],['comment','lib.php',529],['comment/classes','external.php',60],['mod/assign/feedback/editpdf/classes','page_editor.php',38],['mod/assign/feedback/editpdf/classes','comments_quick_list.php',37]], 20],
'can_view_submission': ['can_view_submission', 'Perform an access check to see if the current $USER can view this users submission. ', [['mod/assign','locallib.php',4040]], 37],
'get_combined_pdf_for_attempt': ['get_combined_pdf_for_attempt', 'This function return the combined pdf for all valid submission files. ', [['mod/assign/feedback/editpdf/classes','document_services.php',213]], 3],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'get_course_module': ['get_course_module', 'Gets the course-module object. Intended for use by conditions. ', [['availability/classes','info_module.php',63],['course','externallib.php',2379],['mod/assign','locallib.php',1286]], 238],
'get_page_images_for_attempt': ['get_page_images_for_attempt', 'This function returns a list of the page images from a pdf. ', [['mod/assign/feedback/editpdf/classes','document_services.php',460]], 3],
'hasattribute': ['hasattribute', 'Answer true if an attribute exists for the authenticated user. ', [['auth/cas/CAS','CAS.php',1206],['auth/cas/CAS/CAS','Client.php',1168]], 94],
'get_image': ['get_image', 'Generate an image of the specified page in the PDF ', [['mod/assign/feedback/editpdf/classes','pdf.php',409],['blocks/rss_client/classes/output','feed.php',174]], 2],
'item': ['item', 'A managed course. ', [['course/yui/src/management/js','item.js',1],['course/yui/build/moodle-course-management','moodle-course-management.js',854],['course/yui/build/moodle-course-management','moodle-course-management-debug.js',864]], 874],
'get_feedback_document': ['get_feedback_document', 'This function returns the generated pdf (if it exists). ', [['mod/assign/feedback/editpdf/classes','document_services.php',739]], 3],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'get_area_files': ['get_area_files', 'Returns all area files (optionally limited by itemid) ', [['lib/filestorage','file_storage.php',782],['lib','externallib.php',1134]], 216],
'generate_combined_pdf_for_attempt': ['generate_combined_pdf_for_attempt', 'This function will take all of the compatible files for a submission and combine them into one PDF. ', [['mod/assign/feedback/editpdf/classes','document_services.php',254]], 1],
'get_group_submission': ['get_group_submission', 'Load the group submission object for a particular user, optionally creating it if required. ', [['mod/assign','locallib.php',2326]], 36],
'delete_feedback_document': ['delete_feedback_document', 'This function deletes the generated pdf for a student. ', [['mod/assign/feedback/editpdf/classes','document_services.php',775]], 2],
'add_annotation': ['add_annotation', 'Add an annotation to the current page ', [['mod/assign/feedback/editpdf/classes','pdf.php',263],['mod/assign/feedback/editpdf/classes','page_editor.php',289]], 4],
'base64_decode': ['base64_decode', '', [], 92],
'str_replace': ['str_replace', '', [], 1648],
'preg_match': ['preg_match', '', [], 1286],
'reset': ['reset', '', [], 1213],
'sha1': ['sha1', '', [], 186],
'rmdir': ['rmdir', '', [], 17],
'basename': ['basename', '', [], 153],
'is_object': ['is_object', '', [], 544],
'array_push': ['array_push', '', [], 240],
'unlink': ['unlink', '', [], 256],
'ksort': ['ksort', '', [], 153],
'count': ['count', '', [], 4095],
'is_numeric': ['is_numeric', '', [], 672]};
CLASS_DATA={
'pdf': ['pdf', 'Wrapper class that extends TCPDF (lib/tcpdf/tcpdf.php). Moodle customisations are done here. ', [['lib','pdflib.php',151],['mod/assign/feedback/editpdf/classes','pdf.php',33]], 21],
'document_services': ['document_services', 'Functions for generating the annotated pdf. ', [['mod/assign/feedback/editpdf/classes','document_services.php',29]], 26],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',7039]], 1106],
'page_editor': ['page_editor', 'This class performs crud operations on comments and annotations from a page of a response. ', [['mod/assign/feedback/editpdf/classes','page_editor.php',27]], 54]};
CONST_DATA={
'DEBUG_DEVELOPER': ['DEBUG_DEVELOPER', '', [['lib','setuplib.php',40]], 736],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'PARAM_FILE': ['PARAM_FILE', '', [['lib','moodlelib.php',133]], 121]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
