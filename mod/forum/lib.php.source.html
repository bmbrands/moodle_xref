<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mod/forum/lib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='mod/forum';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mod/forum/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * @package   mod_forum</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * @copyright 1999 onwards Martin Dougiamas  {@link http://moodle.com}</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> */</span>
<a name="l22"><span class="linenum">  22</span></a>  
<a name="l23"><span class="linenum">  23</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment">/** Include required files */</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="keyword">require_once</span> <a class="filename" href="../../mod/forum/deprecatedlib.php.html" onMouseOver="reqPopup(event, 'deprecatedlib.php', '../../mod/forum/deprecatedlib.php')">(__DIR__ . '/deprecatedlib.php')</a>;
<a name="l27"><span class="linenum">  27</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/filelib.php');
<a name="l28"><span class="linenum">  28</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/eventslib.php');
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">/// CONSTANTS ///////////////////////////////////////////////////////////</span>
<a name="l31"><span class="linenum">  31</span></a>  
<a name="l32"><span class="linenum">  32</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_MODE_FLATOLDEST')" href="../../_constants/FORUM_MODE_FLATOLDEST.html" onMouseOver="constPopup(event,'FORUM_MODE_FLATOLDEST')">FORUM_MODE_FLATOLDEST</a>', 1);
<a name="l33"><span class="linenum">  33</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_MODE_FLATNEWEST')" href="../../_constants/FORUM_MODE_FLATNEWEST.html" onMouseOver="constPopup(event,'FORUM_MODE_FLATNEWEST')">FORUM_MODE_FLATNEWEST</a>', -1);
<a name="l34"><span class="linenum">  34</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_MODE_THREADED')" href="../../_constants/FORUM_MODE_THREADED.html" onMouseOver="constPopup(event,'FORUM_MODE_THREADED')">FORUM_MODE_THREADED</a>', 2);
<a name="l35"><span class="linenum">  35</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_MODE_NESTED')" href="../../_constants/FORUM_MODE_NESTED.html" onMouseOver="constPopup(event,'FORUM_MODE_NESTED')">FORUM_MODE_NESTED</a>', 3);
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_CHOOSESUBSCRIBE')" href="../../_constants/FORUM_CHOOSESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_CHOOSESUBSCRIBE')">FORUM_CHOOSESUBSCRIBE</a>', 0);
<a name="l38"><span class="linenum">  38</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_FORCESUBSCRIBE')" href="../../_constants/FORUM_FORCESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_FORCESUBSCRIBE')">FORUM_FORCESUBSCRIBE</a>', 1);
<a name="l39"><span class="linenum">  39</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_INITIALSUBSCRIBE')" href="../../_constants/FORUM_INITIALSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_INITIALSUBSCRIBE')">FORUM_INITIALSUBSCRIBE</a>', 2);
<a name="l40"><span class="linenum">  40</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_DISALLOWSUBSCRIBE')" href="../../_constants/FORUM_DISALLOWSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_DISALLOWSUBSCRIBE')">FORUM_DISALLOWSUBSCRIBE</a>',3);
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment">/**</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> * FORUM_TRACKING_OFF - Tracking is not available for this forum.</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> */</span>
<a name="l45"><span class="linenum">  45</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_TRACKING_OFF')" href="../../_constants/FORUM_TRACKING_OFF.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OFF')">FORUM_TRACKING_OFF</a>', 0);
<a name="l46"><span class="linenum">  46</span></a>  
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment">/**</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment"> * FORUM_TRACKING_OPTIONAL - Tracking is based on user preference.</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment"> */</span>
<a name="l50"><span class="linenum">  50</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>', 1);
<a name="l51"><span class="linenum">  51</span></a>  
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment">/**</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment"> * FORUM_TRACKING_FORCED - Tracking is on, regardless of user setting.</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment"> * Treated as FORUM_TRACKING_OPTIONAL if $CFG-&gt;forum_allowforcedreadtracking is off.</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment"> */</span>
<a name="l56"><span class="linenum">  56</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_TRACKING_FORCED')" href="../../_constants/FORUM_TRACKING_FORCED.html" onMouseOver="constPopup(event,'FORUM_TRACKING_FORCED')">FORUM_TRACKING_FORCED</a>', 2);
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_MAILED_PENDING')" href="../../_constants/FORUM_MAILED_PENDING.html" onMouseOver="constPopup(event,'FORUM_MAILED_PENDING')">FORUM_MAILED_PENDING</a>', 0);
<a name="l59"><span class="linenum">  59</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_MAILED_SUCCESS')" href="../../_constants/FORUM_MAILED_SUCCESS.html" onMouseOver="constPopup(event,'FORUM_MAILED_SUCCESS')">FORUM_MAILED_SUCCESS</a>', 1);
<a name="l60"><span class="linenum">  60</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_MAILED_ERROR')" href="../../_constants/FORUM_MAILED_ERROR.html" onMouseOver="constPopup(event,'FORUM_MAILED_ERROR')">FORUM_MAILED_ERROR</a>', 2);
<a name="l61"><span class="linenum">  61</span></a>  
<a name="l62"><span class="linenum">  62</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('FORUM_CRON_USER_CACHE')" href="../../_constants/FORUM_CRON_USER_CACHE.html" onMouseOver="constPopup(event,'FORUM_CRON_USER_CACHE')">FORUM_CRON_USER_CACHE</a>')) {
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">    /** Defines how many full user records are cached in forum cron. */</span>
<a name="l64"><span class="linenum">  64</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_CRON_USER_CACHE')" href="../../_constants/FORUM_CRON_USER_CACHE.html" onMouseOver="constPopup(event,'FORUM_CRON_USER_CACHE')">FORUM_CRON_USER_CACHE</a>', 5000);
<a name="l65"><span class="linenum">  65</span></a>  }
<a name="l66"><span class="linenum">  66</span></a>  
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment">/**</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment"> * FORUM_POSTS_ALL_USER_GROUPS - All the posts in groups where the user is enrolled.</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment"> */</span>
<a name="l70"><span class="linenum">  70</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_POSTS_ALL_USER_GROUPS')" href="../../_constants/FORUM_POSTS_ALL_USER_GROUPS.html" onMouseOver="constPopup(event,'FORUM_POSTS_ALL_USER_GROUPS')">FORUM_POSTS_ALL_USER_GROUPS</a>', -2);
<a name="l71"><span class="linenum">  71</span></a>  
<a name="l72"><span class="linenum">  72</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_DISCUSSION_PINNED')" href="../../_constants/FORUM_DISCUSSION_PINNED.html" onMouseOver="constPopup(event,'FORUM_DISCUSSION_PINNED')">FORUM_DISCUSSION_PINNED</a>', 1);
<a name="l73"><span class="linenum">  73</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('FORUM_DISCUSSION_UNPINNED')" href="../../_constants/FORUM_DISCUSSION_UNPINNED.html" onMouseOver="constPopup(event,'FORUM_DISCUSSION_UNPINNED')">FORUM_DISCUSSION_UNPINNED</a>', 0);
<a name="l74"><span class="linenum">  74</span></a>  
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">/// STANDARD FUNCTIONS ///////////////////////////////////////////////////////////</span>
<a name="l76"><span class="linenum">  76</span></a>  
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">/**</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment"> * Given an object containing all the necessary data,</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment"> * (defined by the form in mod_form.php) this function</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> * will create a new instance and return the id number</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment"> * of the new instance.</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment"> *</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment"> * @param stdClass $forum add forum instance</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment"> * @param mod_forum_mod_form $mform</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment"> * @return int intance id</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="comment"> */</span>
<a name="l87"><span class="linenum">  87</span></a>  function <a class="function" onClick="logFunction('forum_add_instance')" href="../../_functions/forum_add_instance.html" onMouseOver="funcPopup(event,'forum_add_instance')">forum_add_instance</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a> = null) {
<a name="l88"><span class="linenum">  88</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l89"><span class="linenum">  89</span></a>  
<a name="l90"><span class="linenum">  90</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>      if (empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>)) {
<a name="l93"><span class="linenum">  93</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a> = 0;
<a name="l94"><span class="linenum">  94</span></a>      }
<a name="l95"><span class="linenum">  95</span></a>  
<a name="l96"><span class="linenum">  96</span></a>      if (empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('ratingtime')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/ratingtime.html">ratingtime</a>) or empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>)) {
<a name="l97"><span class="linenum">  97</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimestart')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimestart.html">assesstimestart</a>  = 0;
<a name="l98"><span class="linenum">  98</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimefinish')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimefinish.html">assesstimefinish</a> = 0;
<a name="l99"><span class="linenum">  99</span></a>      }
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l102"><span class="linenum"> 102</span></a>      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>);
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'single') {  // Create related discussion.
<a name="l105"><span class="linenum"> 105</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = new stdClass();
<a name="l106"><span class="linenum"> 106</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('course')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>        = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>;
<a name="l107"><span class="linenum"> 107</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>         = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l108"><span class="linenum"> 108</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>          = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l109"><span class="linenum"> 109</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('assessed')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>      = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>;
<a name="l110"><span class="linenum"> 110</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('message')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>       = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('intro')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/intro.html">intro</a>;
<a name="l111"><span class="linenum"> 111</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('messageformat')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/messageformat.html">messageformat</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('introformat')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/introformat.html">introformat</a>;
<a name="l112"><span class="linenum"> 112</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('messagetrust')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/messagetrust.html">messagetrust</a>  = <a class="function" onClick="logFunction('trusttext_trusted')" href="../../_functions/trusttext_trusted.html" onMouseOver="funcPopup(event,'trusttext_trusted')">trusttext_trusted</a>(<a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>));
<a name="l113"><span class="linenum"> 113</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('mailnow')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/mailnow.html">mailnow</a>       = false;
<a name="l114"><span class="linenum"> 114</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>       = -1;
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a> = '';
<a name="l117"><span class="linenum"> 117</span></a>  
<a name="l118"><span class="linenum"> 118</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="function" onClick="logFunction('forum_add_discussion')" href="../../_functions/forum_add_discussion.html" onMouseOver="funcPopup(event,'forum_add_discussion')">forum_add_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, null, <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>);
<a name="l119"><span class="linenum"> 119</span></a>  
<a name="l120"><span class="linenum"> 120</span></a>          if (<a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a> and <a class="var it2102" onMouseOver="hilite(2102)" onMouseOut="lolite()" onClick="logVariable('draftid')" href="../../_variables/draftid.html">$draftid</a> = <a class="function" onClick="logFunction('file_get_submitted_draft_itemid')" href="../../_functions/file_get_submitted_draft_itemid.html" onMouseOver="funcPopup(event,'file_get_submitted_draft_itemid')">file_get_submitted_draft_itemid</a>('introeditor')) {
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">            // Ugly hack - we need to copy the files somehow.</span>
<a name="l122"><span class="linenum"> 122</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('id'=&gt;<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l123"><span class="linenum"> 123</span></a>              <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_posts', array('id'=&gt;<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('firstpost')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/firstpost.html">firstpost</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = array('subdirs'=&gt;true); <span class="comment">// Use the same options as intro field!</span>
<a name="l126"><span class="linenum"> 126</span></a>              <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a> = <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it2102" onMouseOver="hilite(2102)" onMouseOut="lolite()" onClick="logVariable('draftid')" href="../../_variables/draftid.html">$draftid</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>-&gt;<a onClick="logVariable('id')" class="var it43689" onMouseOver="hilite(43689)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'post', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>);
<a name="l127"><span class="linenum"> 127</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('forum_posts', 'message', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>, array('id'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l128"><span class="linenum"> 128</span></a>          }
<a name="l129"><span class="linenum"> 129</span></a>      }
<a name="l130"><span class="linenum"> 130</span></a>  
<a name="l131"><span class="linenum"> 131</span></a>      <a class="function" onClick="logFunction('forum_grade_item_update')" href="../../_functions/forum_grade_item_update.html" onMouseOver="funcPopup(event,'forum_grade_item_update')">forum_grade_item_update</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>      return <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l134"><span class="linenum"> 134</span></a>  }
<a name="l135"><span class="linenum"> 135</span></a>  
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">/**</span>
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment"> * Handle changes following the creation of a forum instance.</span>
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment"> * This function is typically called by the course_module_created observer.</span>
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment"> *</span>
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment"> * @param object $context the forum context</span>
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment"> * @param stdClass $forum The forum object</span>
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment"> * @return void</span>
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment"> */</span>
<a name="l144"><span class="linenum"> 144</span></a>  function <a class="function" onClick="logFunction('forum_instance_created')" href="../../_functions/forum_instance_created.html" onMouseOver="funcPopup(event,'forum_instance_created')">forum_instance_created</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l145"><span class="linenum"> 145</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/forcesubscribe.html">forcesubscribe</a> == <a class="constant" onClick="logConstant('FORUM_INITIALSUBSCRIBE')" href="../../_constants/FORUM_INITIALSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_INITIALSUBSCRIBE')">FORUM_INITIALSUBSCRIBE</a>) {
<a name="l146"><span class="linenum"> 146</span></a>          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('get_potential_subscribers')" href="../../_functions/get_potential_subscribers.html" onMouseOver="funcPopup(event,'get_potential_subscribers')">get_potential_subscribers</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 0, 'u.id, u.email');
<a name="l147"><span class="linenum"> 147</span></a>          foreach (<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> as <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l148"><span class="linenum"> 148</span></a>              \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('subscribe_user')" href="../../_functions/subscribe_user.html" onMouseOver="funcPopup(event,'subscribe_user')">subscribe_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l149"><span class="linenum"> 149</span></a>          }
<a name="l150"><span class="linenum"> 150</span></a>      }
<a name="l151"><span class="linenum"> 151</span></a>  }
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment">/**</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment"> * Given an object containing all the necessary data,</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment"> * (defined by the form in mod_form.php) this function</span>
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment"> * will update an existing instance with new data.</span>
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment"> *</span>
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment"> * @global object</span>
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment"> * @param object $forum forum instance (with magic quotes)</span>
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment"> * @return bool success</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment"> */</span>
<a name="l162"><span class="linenum"> 162</span></a>  function <a class="function" onClick="logFunction('forum_update_instance')" href="../../_functions/forum_update_instance.html" onMouseOver="funcPopup(event,'forum_update_instance')">forum_update_instance</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l163"><span class="linenum"> 163</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l164"><span class="linenum"> 164</span></a>  
<a name="l165"><span class="linenum"> 165</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l166"><span class="linenum"> 166</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>           = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('instance')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>;
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>      if (empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>)) {
<a name="l169"><span class="linenum"> 169</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a> = 0;
<a name="l170"><span class="linenum"> 170</span></a>      }
<a name="l171"><span class="linenum"> 171</span></a>  
<a name="l172"><span class="linenum"> 172</span></a>      if (empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('ratingtime')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/ratingtime.html">ratingtime</a>) or empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>)) {
<a name="l173"><span class="linenum"> 173</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimestart')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimestart.html">assesstimestart</a>  = 0;
<a name="l174"><span class="linenum"> 174</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimefinish')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimefinish.html">assesstimefinish</a> = 0;
<a name="l175"><span class="linenum"> 175</span></a>      }
<a name="l176"><span class="linenum"> 176</span></a>  
<a name="l177"><span class="linenum"> 177</span></a>      <a class="var it41477" onMouseOver="hilite(41477)" onMouseOut="lolite()" onClick="logVariable('oldforum')" href="../../_variables/oldforum.html">$oldforum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l178"><span class="linenum"> 178</span></a>  
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment">    // MDL-3942 - if the aggregation type or scale (i.e. max grade) changes then recalculate the grades for the entire forum</span>
<a name="l180"><span class="linenum"> 180</span></a>  <span class="comment">    // if  scale changes - do we need to recheck the ratings, if ratings higher than scale how do we want to respond?</span>
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">    // for count and sum aggregation types the grade we check to make sure they do not exceed the scale (i.e. max score) when calculating the grade</span>
<a name="l182"><span class="linenum"> 182</span></a>      if ((<a class="var it41477" onMouseOver="hilite(41477)" onMouseOut="lolite()" onClick="logVariable('oldforum')" href="../../_variables/oldforum.html">$oldforum</a>-&gt;<a onClick="logVariable('assessed')" class="var it44612" onMouseOver="hilite(44612)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>&lt;&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>) <a class="function" onClick="logFunction('or')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it41477" onMouseOver="hilite(41477)" onMouseOut="lolite()" onClick="logVariable('oldforum')" href="../../_variables/oldforum.html">$oldforum</a>-&gt;<a onClick="logVariable('scale')" class="var it44612" onMouseOver="hilite(44612)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>&lt;&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>)) {
<a name="l183"><span class="linenum"> 183</span></a>          <a class="function" onClick="logFunction('forum_update_grades')" href="../../_functions/forum_update_grades.html" onMouseOver="funcPopup(event,'forum_update_grades')">forum_update_grades</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>); <span class="comment">// recalculate grades for the forum</span>
<a name="l184"><span class="linenum"> 184</span></a>      }
<a name="l185"><span class="linenum"> 185</span></a>  
<a name="l186"><span class="linenum"> 186</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'single') {  // Update related discussion and post.
<a name="l187"><span class="linenum"> 187</span></a>          <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('forum_discussions', array('forum'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), 'timemodified ASC');
<a name="l188"><span class="linenum"> 188</span></a>          if (!empty(<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>)) {
<a name="l189"><span class="linenum"> 189</span></a>              if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>) &gt; 1) {
<a name="l190"><span class="linenum"> 190</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('warnformorepost', 'forum'));
<a name="l191"><span class="linenum"> 191</span></a>              }
<a name="l192"><span class="linenum"> 192</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>);
<a name="l193"><span class="linenum"> 193</span></a>          } else {
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment">            // try to recover by creating initial discussion - MDL-16262</span>
<a name="l195"><span class="linenum"> 195</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = new stdClass();
<a name="l196"><span class="linenum"> 196</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('course')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>          = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>;
<a name="l197"><span class="linenum"> 197</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>           = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l198"><span class="linenum"> 198</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>            = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l199"><span class="linenum"> 199</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('assessed')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>        = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>;
<a name="l200"><span class="linenum"> 200</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('message')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>         = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('intro')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/intro.html">intro</a>;
<a name="l201"><span class="linenum"> 201</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('messageformat')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/messageformat.html">messageformat</a>   = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('introformat')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/introformat.html">introformat</a>;
<a name="l202"><span class="linenum"> 202</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('messagetrust')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/messagetrust.html">messagetrust</a>    = true;
<a name="l203"><span class="linenum"> 203</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('mailnow')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/mailnow.html">mailnow</a>         = false;
<a name="l204"><span class="linenum"> 204</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>         = -1;
<a name="l205"><span class="linenum"> 205</span></a>  
<a name="l206"><span class="linenum"> 206</span></a>              <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a> = '';
<a name="l207"><span class="linenum"> 207</span></a>  
<a name="l208"><span class="linenum"> 208</span></a>              <a class="function" onClick="logFunction('forum_add_discussion')" href="../../_functions/forum_add_discussion.html" onMouseOver="funcPopup(event,'forum_add_discussion')">forum_add_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, null, <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>);
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>              if (! <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('forum'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l211"><span class="linenum"> 211</span></a>                  <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('cannotadd', 'forum');
<a name="l212"><span class="linenum"> 212</span></a>              }
<a name="l213"><span class="linenum"> 213</span></a>          }
<a name="l214"><span class="linenum"> 214</span></a>          if (! <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_posts', array('id'=&gt;<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('firstpost')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/firstpost.html">firstpost</a>))) {
<a name="l215"><span class="linenum"> 215</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('cannotfindfirstpost', 'forum');
<a name="l216"><span class="linenum"> 216</span></a>          }
<a name="l217"><span class="linenum"> 217</span></a>  
<a name="l218"><span class="linenum"> 218</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>         = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l219"><span class="linenum"> 219</span></a>          <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l220"><span class="linenum"> 220</span></a>  
<a name="l221"><span class="linenum"> 221</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_posts', array('id'=&gt;<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('firstpost')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/firstpost.html">firstpost</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l222"><span class="linenum"> 222</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>       = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l223"><span class="linenum"> 223</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>       = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('intro')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/intro.html">intro</a>;
<a name="l224"><span class="linenum"> 224</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('messageformat')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/messageformat.html">messageformat</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('introformat')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/introformat.html">introformat</a>;
<a name="l225"><span class="linenum"> 225</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('messagetrust')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/messagetrust.html">messagetrust</a>  = <a class="function" onClick="logFunction('trusttext_trusted')" href="../../_functions/trusttext_trusted.html" onMouseOver="funcPopup(event,'trusttext_trusted')">trusttext_trusted</a>(<a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l226"><span class="linenum"> 226</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>      = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>;
<a name="l227"><span class="linenum"> 227</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>        = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;    <span class="comment">// MDL-18599, so that current teacher can take ownership of activities.</span>
<a name="l228"><span class="linenum"> 228</span></a>  
<a name="l229"><span class="linenum"> 229</span></a>          if (<a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a> and <a class="var it2102" onMouseOver="hilite(2102)" onMouseOut="lolite()" onClick="logVariable('draftid')" href="../../_variables/draftid.html">$draftid</a> = <a class="function" onClick="logFunction('file_get_submitted_draft_itemid')" href="../../_functions/file_get_submitted_draft_itemid.html" onMouseOver="funcPopup(event,'file_get_submitted_draft_itemid')">file_get_submitted_draft_itemid</a>('introeditor')) {
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment">            // Ugly hack - we need to copy the files somehow.</span>
<a name="l231"><span class="linenum"> 231</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = array('subdirs'=&gt;true); <span class="comment">// Use the same options as intro field!</span>
<a name="l232"><span class="linenum"> 232</span></a>              <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a> = <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it2102" onMouseOver="hilite(2102)" onMouseOut="lolite()" onClick="logVariable('draftid')" href="../../_variables/draftid.html">$draftid</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>-&gt;<a onClick="logVariable('id')" class="var it43689" onMouseOver="hilite(43689)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'post', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>);
<a name="l233"><span class="linenum"> 233</span></a>          }
<a name="l234"><span class="linenum"> 234</span></a>  
<a name="l235"><span class="linenum"> 235</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_posts', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>);
<a name="l236"><span class="linenum"> 236</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l237"><span class="linenum"> 237</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_discussions', <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>);
<a name="l238"><span class="linenum"> 238</span></a>      }
<a name="l239"><span class="linenum"> 239</span></a>  
<a name="l240"><span class="linenum"> 240</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l241"><span class="linenum"> 241</span></a>  
<a name="l242"><span class="linenum"> 242</span></a>      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>);
<a name="l243"><span class="linenum"> 243</span></a>      if ((<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/forcesubscribe.html">forcesubscribe</a> == <a class="constant" onClick="logConstant('FORUM_INITIALSUBSCRIBE')" href="../../_constants/FORUM_INITIALSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_INITIALSUBSCRIBE')">FORUM_INITIALSUBSCRIBE</a>) &amp;&amp; (<a class="var it41477" onMouseOver="hilite(41477)" onMouseOut="lolite()" onClick="logVariable('oldforum')" href="../../_variables/oldforum.html">$oldforum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it44612" onMouseOver="hilite(44612)" onMouseOut="lolite()" href="../../_variables/forcesubscribe.html">forcesubscribe</a> &lt;&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/forcesubscribe.html">forcesubscribe</a>)) {
<a name="l244"><span class="linenum"> 244</span></a>          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('get_potential_subscribers')" href="../../_functions/get_potential_subscribers.html" onMouseOver="funcPopup(event,'get_potential_subscribers')">get_potential_subscribers</a>(<a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, 0, 'u.id, u.email', '');
<a name="l245"><span class="linenum"> 245</span></a>          foreach (<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> as <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l246"><span class="linenum"> 246</span></a>              \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('subscribe_user')" href="../../_functions/subscribe_user.html" onMouseOver="funcPopup(event,'subscribe_user')">subscribe_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l247"><span class="linenum"> 247</span></a>          }
<a name="l248"><span class="linenum"> 248</span></a>      }
<a name="l249"><span class="linenum"> 249</span></a>  
<a name="l250"><span class="linenum"> 250</span></a>      <a class="function" onClick="logFunction('forum_grade_item_update')" href="../../_functions/forum_grade_item_update.html" onMouseOver="funcPopup(event,'forum_grade_item_update')">forum_grade_item_update</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l251"><span class="linenum"> 251</span></a>  
<a name="l252"><span class="linenum"> 252</span></a>      return true;
<a name="l253"><span class="linenum"> 253</span></a>  }
<a name="l254"><span class="linenum"> 254</span></a>  
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment">/**</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment"> * Given an ID of an instance of this module,</span>
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment"> * this function will permanently delete the instance</span>
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment"> * and any data that depends on it.</span>
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment"> *</span>
<a name="l261"><span class="linenum"> 261</span></a>  <span class="comment"> * @global object</span>
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment"> * @param int $id forum instance id</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment"> * @return bool success</span>
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment"> */</span>
<a name="l265"><span class="linenum"> 265</span></a>  function <a class="function" onClick="logFunction('forum_delete_instance')" href="../../_functions/forum_delete_instance.html" onMouseOver="funcPopup(event,'forum_delete_instance')">forum_delete_instance</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l266"><span class="linenum"> 266</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>      if (!<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id'=&gt;<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>))) {
<a name="l269"><span class="linenum"> 269</span></a>          return false;
<a name="l270"><span class="linenum"> 270</span></a>      }
<a name="l271"><span class="linenum"> 271</span></a>      if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l272"><span class="linenum"> 272</span></a>          return false;
<a name="l273"><span class="linenum"> 273</span></a>      }
<a name="l274"><span class="linenum"> 274</span></a>      if (!<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>))) {
<a name="l275"><span class="linenum"> 275</span></a>          return false;
<a name="l276"><span class="linenum"> 276</span></a>      }
<a name="l277"><span class="linenum"> 277</span></a>  
<a name="l278"><span class="linenum"> 278</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l279"><span class="linenum"> 279</span></a>  
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment">    // now get rid of all files</span>
<a name="l281"><span class="linenum"> 281</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l282"><span class="linenum"> 282</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l283"><span class="linenum"> 283</span></a>  
<a name="l284"><span class="linenum"> 284</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = true;
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>  <span class="comment">    // Delete digest and subscription preferences.</span>
<a name="l287"><span class="linenum"> 287</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_digests', array('forum' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l288"><span class="linenum"> 288</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_subscriptions', array('forum'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l289"><span class="linenum"> 289</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_discussion_subs', array('forum' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l290"><span class="linenum"> 290</span></a>  
<a name="l291"><span class="linenum"> 291</span></a>      if (<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('forum_discussions', array('forum'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l292"><span class="linenum"> 292</span></a>          foreach (<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a> as <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>) {
<a name="l293"><span class="linenum"> 293</span></a>              if (!<a class="function" onClick="logFunction('forum_delete_discussion')" href="../../_functions/forum_delete_discussion.html" onMouseOver="funcPopup(event,'forum_delete_discussion')">forum_delete_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, true, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l294"><span class="linenum"> 294</span></a>                  <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l295"><span class="linenum"> 295</span></a>              }
<a name="l296"><span class="linenum"> 296</span></a>          }
<a name="l297"><span class="linenum"> 297</span></a>      }
<a name="l298"><span class="linenum"> 298</span></a>  
<a name="l299"><span class="linenum"> 299</span></a>      <a class="function" onClick="logFunction('forum_tp_delete_read_records')" href="../../_functions/forum_tp_delete_read_records.html" onMouseOver="funcPopup(event,'forum_tp_delete_read_records')">forum_tp_delete_read_records</a>(-1, -1, -1, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l300"><span class="linenum"> 300</span></a>  
<a name="l301"><span class="linenum"> 301</span></a>      if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum', array('id'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l302"><span class="linenum"> 302</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l303"><span class="linenum"> 303</span></a>      }
<a name="l304"><span class="linenum"> 304</span></a>  
<a name="l305"><span class="linenum"> 305</span></a>      <a class="function" onClick="logFunction('forum_grade_item_delete')" href="../../_functions/forum_grade_item_delete.html" onMouseOver="funcPopup(event,'forum_grade_item_delete')">forum_grade_item_delete</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>      return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l308"><span class="linenum"> 308</span></a>  }
<a name="l309"><span class="linenum"> 309</span></a>  
<a name="l310"><span class="linenum"> 310</span></a>  
<a name="l311"><span class="linenum"> 311</span></a>  <span class="comment">/**</span>
<a name="l312"><span class="linenum"> 312</span></a>  <span class="comment"> * Indicates API features that the forum supports.</span>
<a name="l313"><span class="linenum"> 313</span></a>  <span class="comment"> *</span>
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment"> * @uses FEATURE_GROUPS</span>
<a name="l315"><span class="linenum"> 315</span></a>  <span class="comment"> * @uses FEATURE_GROUPINGS</span>
<a name="l316"><span class="linenum"> 316</span></a>  <span class="comment"> * @uses FEATURE_MOD_INTRO</span>
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment"> * @uses FEATURE_COMPLETION_TRACKS_VIEWS</span>
<a name="l318"><span class="linenum"> 318</span></a>  <span class="comment"> * @uses FEATURE_COMPLETION_HAS_RULES</span>
<a name="l319"><span class="linenum"> 319</span></a>  <span class="comment"> * @uses FEATURE_GRADE_HAS_GRADE</span>
<a name="l320"><span class="linenum"> 320</span></a>  <span class="comment"> * @uses FEATURE_GRADE_OUTCOMES</span>
<a name="l321"><span class="linenum"> 321</span></a>  <span class="comment"> * @param string $feature</span>
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment"> * @return mixed True if yes (some features may use other values)</span>
<a name="l323"><span class="linenum"> 323</span></a>  <span class="comment"> */</span>
<a name="l324"><span class="linenum"> 324</span></a>  function <a class="function" onClick="logFunction('forum_supports')" href="../../_functions/forum_supports.html" onMouseOver="funcPopup(event,'forum_supports')">forum_supports</a>(<a class="var it2267" onMouseOver="hilite(2267)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l325"><span class="linenum"> 325</span></a>      switch(<a class="var it2267" onMouseOver="hilite(2267)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l326"><span class="linenum"> 326</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPS')" href="../../_constants/FEATURE_GROUPS.html" onMouseOver="constPopup(event,'FEATURE_GROUPS')">FEATURE_GROUPS</a>:                  return true;
<a name="l327"><span class="linenum"> 327</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPINGS')" href="../../_constants/FEATURE_GROUPINGS.html" onMouseOver="constPopup(event,'FEATURE_GROUPINGS')">FEATURE_GROUPINGS</a>:               return true;
<a name="l328"><span class="linenum"> 328</span></a>          case <a class="constant" onClick="logConstant('FEATURE_MOD_INTRO')" href="../../_constants/FEATURE_MOD_INTRO.html" onMouseOver="constPopup(event,'FEATURE_MOD_INTRO')">FEATURE_MOD_INTRO</a>:               return true;
<a name="l329"><span class="linenum"> 329</span></a>          case <a class="constant" onClick="logConstant('FEATURE_COMPLETION_TRACKS_VIEWS')" href="../../_constants/FEATURE_COMPLETION_TRACKS_VIEWS.html" onMouseOver="constPopup(event,'FEATURE_COMPLETION_TRACKS_VIEWS')">FEATURE_COMPLETION_TRACKS_VIEWS</a>: return true;
<a name="l330"><span class="linenum"> 330</span></a>          case <a class="constant" onClick="logConstant('FEATURE_COMPLETION_HAS_RULES')" href="../../_constants/FEATURE_COMPLETION_HAS_RULES.html" onMouseOver="constPopup(event,'FEATURE_COMPLETION_HAS_RULES')">FEATURE_COMPLETION_HAS_RULES</a>:    return true;
<a name="l331"><span class="linenum"> 331</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_HAS_GRADE')" href="../../_constants/FEATURE_GRADE_HAS_GRADE.html" onMouseOver="constPopup(event,'FEATURE_GRADE_HAS_GRADE')">FEATURE_GRADE_HAS_GRADE</a>:         return true;
<a name="l332"><span class="linenum"> 332</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_OUTCOMES')" href="../../_constants/FEATURE_GRADE_OUTCOMES.html" onMouseOver="constPopup(event,'FEATURE_GRADE_OUTCOMES')">FEATURE_GRADE_OUTCOMES</a>:          return true;
<a name="l333"><span class="linenum"> 333</span></a>          case <a class="constant" onClick="logConstant('FEATURE_RATE')" href="../../_constants/FEATURE_RATE.html" onMouseOver="constPopup(event,'FEATURE_RATE')">FEATURE_RATE</a>:                    return true;
<a name="l334"><span class="linenum"> 334</span></a>          case <a class="constant" onClick="logConstant('FEATURE_BACKUP_MOODLE2')" href="../../_constants/FEATURE_BACKUP_MOODLE2.html" onMouseOver="constPopup(event,'FEATURE_BACKUP_MOODLE2')">FEATURE_BACKUP_MOODLE2</a>:          return true;
<a name="l335"><span class="linenum"> 335</span></a>          case <a class="constant" onClick="logConstant('FEATURE_SHOW_DESCRIPTION')" href="../../_constants/FEATURE_SHOW_DESCRIPTION.html" onMouseOver="constPopup(event,'FEATURE_SHOW_DESCRIPTION')">FEATURE_SHOW_DESCRIPTION</a>:        return true;
<a name="l336"><span class="linenum"> 336</span></a>          case <a class="constant" onClick="logConstant('FEATURE_PLAGIARISM')" href="../../_constants/FEATURE_PLAGIARISM.html" onMouseOver="constPopup(event,'FEATURE_PLAGIARISM')">FEATURE_PLAGIARISM</a>:              return true;
<a name="l337"><span class="linenum"> 337</span></a>  
<a name="l338"><span class="linenum"> 338</span></a>          default: return null;
<a name="l339"><span class="linenum"> 339</span></a>      }
<a name="l340"><span class="linenum"> 340</span></a>  }
<a name="l341"><span class="linenum"> 341</span></a>  
<a name="l342"><span class="linenum"> 342</span></a>  
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment">/**</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment"> * Obtains the automatic completion state for this forum based on any conditions</span>
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment"> * in forum settings.</span>
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment"> *</span>
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment"> * @global object</span>
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment"> * @global object</span>
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment"> * @param object $course Course</span>
<a name="l350"><span class="linenum"> 350</span></a>  <span class="comment"> * @param object $cm Course-module</span>
<a name="l351"><span class="linenum"> 351</span></a>  <span class="comment"> * @param int $userid User ID</span>
<a name="l352"><span class="linenum"> 352</span></a>  <span class="comment"> * @param bool $type Type of comparison (or/and; can be used as return value if no conditions)</span>
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment"> * @return bool True if completed, false if not. (If no conditions, then return</span>
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment"> *   value depends on comparison type)</span>
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment"> */</span>
<a name="l356"><span class="linenum"> 356</span></a>  function <a class="function" onClick="logFunction('forum_get_completion_state')" href="../../_functions/forum_get_completion_state.html" onMouseOver="funcPopup(event,'forum_get_completion_state')">forum_get_completion_state</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>,<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>,<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>,<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l357"><span class="linenum"> 357</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>,<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l358"><span class="linenum"> 358</span></a>  
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment">    // Get forum details</span>
<a name="l360"><span class="linenum"> 360</span></a>      if (!(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>=<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum',array('id'=&gt;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>)))) {
<a name="l361"><span class="linenum"> 361</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('Exception')" href="../../_classes/exception.html" onMouseOver="classPopup(event,'exception')">Exception</a>(&quot;Can't find forum {<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>}&quot;);
<a name="l362"><span class="linenum"> 362</span></a>      }
<a name="l363"><span class="linenum"> 363</span></a>  
<a name="l364"><span class="linenum"> 364</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>=<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>; <span class="comment">// Default return value</span>
<a name="l365"><span class="linenum"> 365</span></a>  
<a name="l366"><span class="linenum"> 366</span></a>      <a class="var it41478" onMouseOver="hilite(41478)" onMouseOut="lolite()" onClick="logVariable('postcountparams')" href="../../_variables/postcountparams.html">$postcountparams</a>=array('userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>,'forumid'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l367"><span class="linenum"> 367</span></a>      <a class="var it41479" onMouseOver="hilite(41479)" onMouseOut="lolite()" onClick="logVariable('postcountsql')" href="../../_variables/postcountsql.html">$postcountsql</a>=&quot;
<a name="l368"><span class="linenum"> 368</span></a>  SELECT
<a name="l369"><span class="linenum"> 369</span></a>      <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(1)
<a name="l370"><span class="linenum"> 370</span></a>  FROM
<a name="l371"><span class="linenum"> 371</span></a>      {forum_posts} fp
<a name="l372"><span class="linenum"> 372</span></a>      INNER JOIN {forum_discussions} fd ON fp.discussion=fd.id
<a name="l373"><span class="linenum"> 373</span></a>  WHERE
<a name="l374"><span class="linenum"> 374</span></a>      fp.userid=:userid AND fd.forum=:forumid&quot;;
<a name="l375"><span class="linenum"> 375</span></a>  
<a name="l376"><span class="linenum"> 376</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completiondiscussions')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completiondiscussions.html">completiondiscussions</a>) {
<a name="l377"><span class="linenum"> 377</span></a>          <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completiondiscussions')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completiondiscussions.html">completiondiscussions</a> &lt;=
<a name="l378"><span class="linenum"> 378</span></a>                   <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('forum_discussions',array('forum'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,'userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>));
<a name="l379"><span class="linenum"> 379</span></a>          if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> == <a class="constant" onClick="logConstant('COMPLETION_AND')" href="../../_constants/COMPLETION_AND.html" onMouseOver="constPopup(event,'COMPLETION_AND')">COMPLETION_AND</a>) {
<a name="l380"><span class="linenum"> 380</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l381"><span class="linenum"> 381</span></a>          } else {
<a name="l382"><span class="linenum"> 382</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> || <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l383"><span class="linenum"> 383</span></a>          }
<a name="l384"><span class="linenum"> 384</span></a>      }
<a name="l385"><span class="linenum"> 385</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completionreplies')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completionreplies.html">completionreplies</a>) {
<a name="l386"><span class="linenum"> 386</span></a>          <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completionreplies')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completionreplies.html">completionreplies</a> &lt;=
<a name="l387"><span class="linenum"> 387</span></a>                   <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>( <a class="var it41479" onMouseOver="hilite(41479)" onMouseOut="lolite()" onClick="logVariable('postcountsql')" href="../../_variables/postcountsql.html">$postcountsql</a>.' AND fp.parent&lt;&gt;0',<a class="var it41478" onMouseOver="hilite(41478)" onMouseOut="lolite()" onClick="logVariable('postcountparams')" href="../../_variables/postcountparams.html">$postcountparams</a>);
<a name="l388"><span class="linenum"> 388</span></a>          if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>==<a class="constant" onClick="logConstant('COMPLETION_AND')" href="../../_constants/COMPLETION_AND.html" onMouseOver="constPopup(event,'COMPLETION_AND')">COMPLETION_AND</a>) {
<a name="l389"><span class="linenum"> 389</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l390"><span class="linenum"> 390</span></a>          } else {
<a name="l391"><span class="linenum"> 391</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> || <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l392"><span class="linenum"> 392</span></a>          }
<a name="l393"><span class="linenum"> 393</span></a>      }
<a name="l394"><span class="linenum"> 394</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completionposts')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completionposts.html">completionposts</a>) {
<a name="l395"><span class="linenum"> 395</span></a>          <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completionposts')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completionposts.html">completionposts</a> &lt;= <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(<a class="var it41479" onMouseOver="hilite(41479)" onMouseOut="lolite()" onClick="logVariable('postcountsql')" href="../../_variables/postcountsql.html">$postcountsql</a>,<a class="var it41478" onMouseOver="hilite(41478)" onMouseOut="lolite()" onClick="logVariable('postcountparams')" href="../../_variables/postcountparams.html">$postcountparams</a>);
<a name="l396"><span class="linenum"> 396</span></a>          if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> == <a class="constant" onClick="logConstant('COMPLETION_AND')" href="../../_constants/COMPLETION_AND.html" onMouseOver="constPopup(event,'COMPLETION_AND')">COMPLETION_AND</a>) {
<a name="l397"><span class="linenum"> 397</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l398"><span class="linenum"> 398</span></a>          } else {
<a name="l399"><span class="linenum"> 399</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> || <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l400"><span class="linenum"> 400</span></a>          }
<a name="l401"><span class="linenum"> 401</span></a>      }
<a name="l402"><span class="linenum"> 402</span></a>  
<a name="l403"><span class="linenum"> 403</span></a>      return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l404"><span class="linenum"> 404</span></a>  }
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">/**</span>
<a name="l407"><span class="linenum"> 407</span></a>  <span class="comment"> * Create a message-id string to use in the custom headers of forum notification emails</span>
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment"> *</span>
<a name="l409"><span class="linenum"> 409</span></a>  <span class="comment"> * message-id is used by email clients to identify emails and to nest conversations</span>
<a name="l410"><span class="linenum"> 410</span></a>  <span class="comment"> *</span>
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment"> * @param int $postid The ID of the forum post we are notifying the user about</span>
<a name="l412"><span class="linenum"> 412</span></a>  <span class="comment"> * @param int $usertoid The ID of the user being notified</span>
<a name="l413"><span class="linenum"> 413</span></a>  <span class="comment"> * @return string A unique message-id</span>
<a name="l414"><span class="linenum"> 414</span></a>  <span class="comment"> */</span>
<a name="l415"><span class="linenum"> 415</span></a>  function <a class="function" onClick="logFunction('forum_get_email_message_id')" href="../../_functions/forum_get_email_message_id.html" onMouseOver="funcPopup(event,'forum_get_email_message_id')">forum_get_email_message_id</a>(<a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>, <a class="var it33953" onMouseOver="hilite(33953)" onMouseOut="lolite()" onClick="logVariable('usertoid')" href="../../_variables/usertoid.html">$usertoid</a>) {
<a name="l416"><span class="linenum"> 416</span></a>      return <a class="function" onClick="logFunction('generate_email_messageid')" href="../../_functions/generate_email_messageid.html" onMouseOver="funcPopup(event,'generate_email_messageid')">generate_email_messageid</a>(<a class="function" onClick="logFunction('hash')" href="../../_functions/hash.html" onMouseOver="funcPopup(event,'hash')">hash</a>('sha256', <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a> . 'to' . <a class="var it33953" onMouseOver="hilite(33953)" onMouseOut="lolite()" onClick="logVariable('usertoid')" href="../../_variables/usertoid.html">$usertoid</a>));
<a name="l417"><span class="linenum"> 417</span></a>  }
<a name="l418"><span class="linenum"> 418</span></a>  
<a name="l419"><span class="linenum"> 419</span></a>  <span class="comment">/**</span>
<a name="l420"><span class="linenum"> 420</span></a>  <span class="comment"> * Removes properties from user record that are not necessary</span>
<a name="l421"><span class="linenum"> 421</span></a>  <span class="comment"> * for sending post notifications.</span>
<a name="l422"><span class="linenum"> 422</span></a>  <span class="comment"> * @param stdClass $user</span>
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment"> * @return void, $user parameter is modified</span>
<a name="l424"><span class="linenum"> 424</span></a>  <span class="comment"> */</span>
<a name="l425"><span class="linenum"> 425</span></a>  function <a class="function" onClick="logFunction('forum_cron_minimise_user_record')" href="../../_functions/forum_cron_minimise_user_record.html" onMouseOver="funcPopup(event,'forum_cron_minimise_user_record')">forum_cron_minimise_user_record</a>(stdClass <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l426"><span class="linenum"> 426</span></a>  
<a name="l427"><span class="linenum"> 427</span></a>  <span class="comment">    // We store large amount of users in one huge array,</span>
<a name="l428"><span class="linenum"> 428</span></a>  <span class="comment">    // make sure we do not store info there we do not actually need</span>
<a name="l429"><span class="linenum"> 429</span></a>  <span class="comment">    // in mail generation code or messaging.</span>
<a name="l430"><span class="linenum"> 430</span></a>  
<a name="l431"><span class="linenum"> 431</span></a>      unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('institution')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/institution.html">institution</a>);
<a name="l432"><span class="linenum"> 432</span></a>      unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('department')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/department.html">department</a>);
<a name="l433"><span class="linenum"> 433</span></a>      unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('address')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/address.html">address</a>);
<a name="l434"><span class="linenum"> 434</span></a>      unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('city')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/city.html">city</a>);
<a name="l435"><span class="linenum"> 435</span></a>      unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('url')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/url.html">url</a>);
<a name="l436"><span class="linenum"> 436</span></a>      unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('currentlogin')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/currentlogin.html">currentlogin</a>);
<a name="l437"><span class="linenum"> 437</span></a>      unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('description')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/description.html">description</a>);
<a name="l438"><span class="linenum"> 438</span></a>      unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('descriptionformat')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/descriptionformat.html">descriptionformat</a>);
<a name="l439"><span class="linenum"> 439</span></a>  }
<a name="l440"><span class="linenum"> 440</span></a>  
<a name="l441"><span class="linenum"> 441</span></a>  <span class="comment">/**</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment"> * Function to be run periodically according to the scheduled task.</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment"> *</span>
<a name="l444"><span class="linenum"> 444</span></a>  <span class="comment"> * Finds all posts that have yet to be mailed out, and mails them</span>
<a name="l445"><span class="linenum"> 445</span></a>  <span class="comment"> * out to all subscribers as well as other maintance tasks.</span>
<a name="l446"><span class="linenum"> 446</span></a>  <span class="comment"> *</span>
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment"> * NOTE: Since 2.7.2 this function is run by scheduled task rather</span>
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment"> * than standard cron.</span>
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment"> *</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment"> * @todo MDL-44734 The function will be split up into seperate tasks.</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment"> */</span>
<a name="l452"><span class="linenum"> 452</span></a>  function <a class="function" onClick="logFunction('forum_cron')" href="../../_functions/forum_cron.html" onMouseOver="funcPopup(event,'forum_cron')">forum_cron</a>() {
<a name="l453"><span class="linenum"> 453</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>;
<a name="l454"><span class="linenum"> 454</span></a>  
<a name="l455"><span class="linenum"> 455</span></a>      <a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../../_variables/site.html">$site</a> = <a class="function" onClick="logFunction('get_site')" href="../../_functions/get_site.html" onMouseOver="funcPopup(event,'get_site')">get_site</a>();
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">    // The main renderers.</span>
<a name="l458"><span class="linenum"> 458</span></a>      <a class="var it41480" onMouseOver="hilite(41480)" onMouseOut="lolite()" onClick="logVariable('htmlout')" href="../../_variables/htmlout.html">$htmlout</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('mod_forum', 'email', 'htmlemail');
<a name="l459"><span class="linenum"> 459</span></a>      <a class="var it41481" onMouseOver="hilite(41481)" onMouseOut="lolite()" onClick="logVariable('textout')" href="../../_variables/textout.html">$textout</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('mod_forum', 'email', 'textemail');
<a name="l460"><span class="linenum"> 460</span></a>      <a class="var it41482" onMouseOver="hilite(41482)" onMouseOut="lolite()" onClick="logVariable('htmldigestfullout')" href="../../_variables/htmldigestfullout.html">$htmldigestfullout</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('mod_forum', 'emaildigestfull', 'htmlemail');
<a name="l461"><span class="linenum"> 461</span></a>      <a class="var it41483" onMouseOver="hilite(41483)" onMouseOut="lolite()" onClick="logVariable('textdigestfullout')" href="../../_variables/textdigestfullout.html">$textdigestfullout</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('mod_forum', 'emaildigestfull', 'textemail');
<a name="l462"><span class="linenum"> 462</span></a>      <a class="var it41484" onMouseOver="hilite(41484)" onMouseOut="lolite()" onClick="logVariable('htmldigestbasicout')" href="../../_variables/htmldigestbasicout.html">$htmldigestbasicout</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('mod_forum', 'emaildigestbasic', 'htmlemail');
<a name="l463"><span class="linenum"> 463</span></a>      <a class="var it41485" onMouseOver="hilite(41485)" onMouseOut="lolite()" onClick="logVariable('textdigestbasicout')" href="../../_variables/textdigestbasicout.html">$textdigestbasicout</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('mod_forum', 'emaildigestbasic', 'textemail');
<a name="l464"><span class="linenum"> 464</span></a>  
<a name="l465"><span class="linenum"> 465</span></a>  <span class="comment">    // All users that are subscribed to any post that needs sending,</span>
<a name="l466"><span class="linenum"> 466</span></a>  <span class="comment">    // please increase $CFG-&gt;extramemorylimit on large sites that</span>
<a name="l467"><span class="linenum"> 467</span></a>  <span class="comment">    // send notifications to a large number of users.</span>
<a name="l468"><span class="linenum"> 468</span></a>      <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = array();
<a name="l469"><span class="linenum"> 469</span></a>      <a class="var it41486" onMouseOver="hilite(41486)" onMouseOut="lolite()" onClick="logVariable('userscount')" href="../../_variables/userscount.html">$userscount</a> = 0; <span class="comment">// Cached user counter - count($users) in PHP is horribly slow!!!</span>
<a name="l470"><span class="linenum"> 470</span></a>  
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment">    // Status arrays.</span>
<a name="l472"><span class="linenum"> 472</span></a>      <a class="var it41487" onMouseOver="hilite(41487)" onMouseOut="lolite()" onClick="logVariable('mailcount')" href="../../_variables/mailcount.html">$mailcount</a>  = array();
<a name="l473"><span class="linenum"> 473</span></a>      <a class="var it30351" onMouseOver="hilite(30351)" onMouseOut="lolite()" onClick="logVariable('errorcount')" href="../../_variables/errorcount.html">$errorcount</a> = array();
<a name="l474"><span class="linenum"> 474</span></a>  
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">    // caches</span>
<a name="l476"><span class="linenum"> 476</span></a>      <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>        = array();
<a name="l477"><span class="linenum"> 477</span></a>      <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>             = array();
<a name="l478"><span class="linenum"> 478</span></a>      <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>            = array();
<a name="l479"><span class="linenum"> 479</span></a>      <a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>      = array();
<a name="l480"><span class="linenum"> 480</span></a>      <a class="var it41488" onMouseOver="hilite(41488)" onMouseOut="lolite()" onClick="logVariable('subscribedusers')" href="../../_variables/subscribedusers.html">$subscribedusers</a>    = array();
<a name="l481"><span class="linenum"> 481</span></a>      <a class="var it41489" onMouseOver="hilite(41489)" onMouseOut="lolite()" onClick="logVariable('messageinboundhandlers')" href="../../_variables/messageinboundhandlers.html">$messageinboundhandlers</a> = array();
<a name="l482"><span class="linenum"> 482</span></a>  
<a name="l483"><span class="linenum"> 483</span></a>  <span class="comment">    // Posts older than 2 days will not be mailed.  This is to avoid the problem where</span>
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment">    // cron has not been running for a long time, and then suddenly people are flooded</span>
<a name="l485"><span class="linenum"> 485</span></a>  <span class="comment">    // with mail from the past few weeks or months</span>
<a name="l486"><span class="linenum"> 486</span></a>      <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>   = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l487"><span class="linenum"> 487</span></a>      <a class="var it6252" onMouseOver="hilite(6252)" onMouseOut="lolite()" onClick="logVariable('endtime')" href="../../_variables/endtime.html">$endtime</a>   = <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a> - <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('maxeditingtime')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/maxeditingtime.html">maxeditingtime</a>;
<a name="l488"><span class="linenum"> 488</span></a>      <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('starttime')" href="../../_variables/starttime.html">$starttime</a> = <a class="var it6252" onMouseOver="hilite(6252)" onMouseOut="lolite()" onClick="logVariable('endtime')" href="../../_variables/endtime.html">$endtime</a> - 48 * 3600;   <span class="comment">// Two days earlier</span>
<a name="l489"><span class="linenum"> 489</span></a>  
<a name="l490"><span class="linenum"> 490</span></a>  <span class="comment">    // Get the list of forum subscriptions for per-user per-forum maildigest settings.</span>
<a name="l491"><span class="linenum"> 491</span></a>      <a class="var it41490" onMouseOver="hilite(41490)" onMouseOut="lolite()" onClick="logVariable('digestsset')" href="../../_variables/digestsset.html">$digestsset</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('forum_digests', null, '', 'id, userid, forum, maildigest');
<a name="l492"><span class="linenum"> 492</span></a>      <a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a> = array();
<a name="l493"><span class="linenum"> 493</span></a>      foreach (<a class="var it41490" onMouseOver="hilite(41490)" onMouseOut="lolite()" onClick="logVariable('digestsset')" href="../../_variables/digestsset.html">$digestsset</a> as <a class="var it12986" onMouseOver="hilite(12986)" onMouseOut="lolite()" onClick="logVariable('thisrow')" href="../../_variables/thisrow.html">$thisrow</a>) {
<a name="l494"><span class="linenum"> 494</span></a>          if (!isset(<a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a>[<a class="var it12986" onMouseOver="hilite(12986)" onMouseOut="lolite()" onClick="logVariable('thisrow')" href="../../_variables/thisrow.html">$thisrow</a>-&gt;<a onClick="logVariable('forum')" class="var it44613" onMouseOver="hilite(44613)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>])) {
<a name="l495"><span class="linenum"> 495</span></a>              <a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a>[<a class="var it12986" onMouseOver="hilite(12986)" onMouseOut="lolite()" onClick="logVariable('thisrow')" href="../../_variables/thisrow.html">$thisrow</a>-&gt;<a onClick="logVariable('forum')" class="var it44613" onMouseOver="hilite(44613)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>] = array();
<a name="l496"><span class="linenum"> 496</span></a>          }
<a name="l497"><span class="linenum"> 497</span></a>          <a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a>[<a class="var it12986" onMouseOver="hilite(12986)" onMouseOut="lolite()" onClick="logVariable('thisrow')" href="../../_variables/thisrow.html">$thisrow</a>-&gt;<a onClick="logVariable('forum')" class="var it44613" onMouseOver="hilite(44613)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>][<a class="var it12986" onMouseOver="hilite(12986)" onMouseOut="lolite()" onClick="logVariable('thisrow')" href="../../_variables/thisrow.html">$thisrow</a>-&gt;<a onClick="logVariable('userid')" class="var it44613" onMouseOver="hilite(44613)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>] = <a class="var it12986" onMouseOver="hilite(12986)" onMouseOut="lolite()" onClick="logVariable('thisrow')" href="../../_variables/thisrow.html">$thisrow</a>-&gt;<a onClick="logVariable('maildigest')" class="var it44613" onMouseOver="hilite(44613)" onMouseOut="lolite()" href="../../_variables/maildigest.html">maildigest</a>;
<a name="l498"><span class="linenum"> 498</span></a>      }
<a name="l499"><span class="linenum"> 499</span></a>      <a class="var it41490" onMouseOver="hilite(41490)" onMouseOut="lolite()" onClick="logVariable('digestsset')" href="../../_variables/digestsset.html">$digestsset</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l500"><span class="linenum"> 500</span></a>  
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment">    // Create the generic messageinboundgenerator.</span>
<a name="l502"><span class="linenum"> 502</span></a>      <a class="var it41491" onMouseOver="hilite(41491)" onMouseOut="lolite()" onClick="logVariable('messageinboundgenerator')" href="../../_variables/messageinboundgenerator.html">$messageinboundgenerator</a> = new \core\message\inbound\address_manager();
<a name="l503"><span class="linenum"> 503</span></a>      <a class="var it41491" onMouseOver="hilite(41491)" onMouseOut="lolite()" onClick="logVariable('messageinboundgenerator')" href="../../_variables/messageinboundgenerator.html">$messageinboundgenerator</a>-&gt;<a class="function" onClick="logFunction('set_handler')" href="../../_functions/set_handler.html" onMouseOver="funcPopup(event,'set_handler')">set_handler</a>('\mod_forum\message\inbound\reply_handler');
<a name="l504"><span class="linenum"> 504</span></a>  
<a name="l505"><span class="linenum"> 505</span></a>      if (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="function" onClick="logFunction('forum_get_unmailed_posts')" href="../../_functions/forum_get_unmailed_posts.html" onMouseOver="funcPopup(event,'forum_get_unmailed_posts')">forum_get_unmailed_posts</a>(<a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('starttime')" href="../../_variables/starttime.html">$starttime</a>, <a class="var it6252" onMouseOver="hilite(6252)" onMouseOut="lolite()" onClick="logVariable('endtime')" href="../../_variables/endtime.html">$endtime</a>, <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>)) {
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment">        // Mark them all now as being mailed.  It's unlikely but possible there</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment">        // might be an error later so that a post is NOT actually mailed out,</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment">        // but since mail isn't crucial, we can accept this risk.  Doing it now</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment">        // prevents the risk of duplicated mails, which is a worse problem.</span>
<a name="l510"><span class="linenum"> 510</span></a>  
<a name="l511"><span class="linenum"> 511</span></a>          if (!<a class="function" onClick="logFunction('forum_mark_old_posts_as_mailed')" href="../../_functions/forum_mark_old_posts_as_mailed.html" onMouseOver="funcPopup(event,'forum_mark_old_posts_as_mailed')">forum_mark_old_posts_as_mailed</a>(<a class="var it6252" onMouseOver="hilite(6252)" onMouseOut="lolite()" onClick="logVariable('endtime')" href="../../_variables/endtime.html">$endtime</a>)) {
<a name="l512"><span class="linenum"> 512</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Errors occurred while trying to mark some posts as being mailed.');
<a name="l513"><span class="linenum"> 513</span></a>              return false;  <span class="comment">// Don't continue trying to mail them, in case we are in a cron loop</span>
<a name="l514"><span class="linenum"> 514</span></a>          }
<a name="l515"><span class="linenum"> 515</span></a>  
<a name="l516"><span class="linenum"> 516</span></a>  <span class="comment">        // checking post validity, and adding users to loop through later</span>
<a name="l517"><span class="linenum"> 517</span></a>          foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a> =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l518"><span class="linenum"> 518</span></a>  
<a name="l519"><span class="linenum"> 519</span></a>              <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>;
<a name="l520"><span class="linenum"> 520</span></a>              if (!isset(<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>])) {
<a name="l521"><span class="linenum"> 521</span></a>                  if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('id'=&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>))) {
<a name="l522"><span class="linenum"> 522</span></a>                      <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>;
<a name="l523"><span class="linenum"> 523</span></a>                      \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('fill_subscription_cache')" href="../../_functions/fill_subscription_cache.html" onMouseOver="funcPopup(event,'fill_subscription_cache')">fill_subscription_cache</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>);
<a name="l524"><span class="linenum"> 524</span></a>                      \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('fill_discussion_subscription_cache')" href="../../_functions/fill_discussion_subscription_cache.html" onMouseOver="funcPopup(event,'fill_discussion_subscription_cache')">fill_discussion_subscription_cache</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>);
<a name="l525"><span class="linenum"> 525</span></a>  
<a name="l526"><span class="linenum"> 526</span></a>                  } else {
<a name="l527"><span class="linenum"> 527</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Could not find discussion ' . <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>);
<a name="l528"><span class="linenum"> 528</span></a>                      unset(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>]);
<a name="l529"><span class="linenum"> 529</span></a>                      continue;
<a name="l530"><span class="linenum"> 530</span></a>                  }
<a name="l531"><span class="linenum"> 531</span></a>              }
<a name="l532"><span class="linenum"> 532</span></a>              <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a> = <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>]-&gt;forum;
<a name="l533"><span class="linenum"> 533</span></a>              if (!isset(<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>])) {
<a name="l534"><span class="linenum"> 534</span></a>                  if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>))) {
<a name="l535"><span class="linenum"> 535</span></a>                      <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>;
<a name="l536"><span class="linenum"> 536</span></a>                  } else {
<a name="l537"><span class="linenum"> 537</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Could not find forum '.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>);
<a name="l538"><span class="linenum"> 538</span></a>                      unset(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>]);
<a name="l539"><span class="linenum"> 539</span></a>                      continue;
<a name="l540"><span class="linenum"> 540</span></a>                  }
<a name="l541"><span class="linenum"> 541</span></a>              }
<a name="l542"><span class="linenum"> 542</span></a>              <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>]-&gt;course;
<a name="l543"><span class="linenum"> 543</span></a>              if (!isset(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>[<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>])) {
<a name="l544"><span class="linenum"> 544</span></a>                  if (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>))) {
<a name="l545"><span class="linenum"> 545</span></a>                      <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>[<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>] = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>;
<a name="l546"><span class="linenum"> 546</span></a>                  } else {
<a name="l547"><span class="linenum"> 547</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Could not find course '.<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l548"><span class="linenum"> 548</span></a>                      unset(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>]);
<a name="l549"><span class="linenum"> 549</span></a>                      continue;
<a name="l550"><span class="linenum"> 550</span></a>                  }
<a name="l551"><span class="linenum"> 551</span></a>              }
<a name="l552"><span class="linenum"> 552</span></a>              if (!isset(<a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>])) {
<a name="l553"><span class="linenum"> 553</span></a>                  if (<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l554"><span class="linenum"> 554</span></a>                      <a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>] = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>;
<a name="l555"><span class="linenum"> 555</span></a>                  } else {
<a name="l556"><span class="linenum"> 556</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Could not find course module for forum '.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>);
<a name="l557"><span class="linenum"> 557</span></a>                      unset(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>]);
<a name="l558"><span class="linenum"> 558</span></a>                      continue;
<a name="l559"><span class="linenum"> 559</span></a>                  }
<a name="l560"><span class="linenum"> 560</span></a>              }
<a name="l561"><span class="linenum"> 561</span></a>  
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment">            // Save the Inbound Message datakey here to reduce DB queries later.</span>
<a name="l563"><span class="linenum"> 563</span></a>              <a class="var it41491" onMouseOver="hilite(41491)" onMouseOut="lolite()" onClick="logVariable('messageinboundgenerator')" href="../../_variables/messageinboundgenerator.html">$messageinboundgenerator</a>-&gt;<a class="function" onClick="logFunction('set_data')" href="../../_functions/set_data.html" onMouseOver="funcPopup(event,'set_data')">set_data</a>(<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>);
<a name="l564"><span class="linenum"> 564</span></a>              <a class="var it41489" onMouseOver="hilite(41489)" onMouseOut="lolite()" onClick="logVariable('messageinboundhandlers')" href="../../_variables/messageinboundhandlers.html">$messageinboundhandlers</a>[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>] = <a class="var it41491" onMouseOver="hilite(41491)" onMouseOut="lolite()" onClick="logVariable('messageinboundgenerator')" href="../../_variables/messageinboundgenerator.html">$messageinboundgenerator</a>-&gt;<a class="function" onClick="logFunction('fetch_data_key')" href="../../_functions/fetch_data_key.html" onMouseOver="funcPopup(event,'fetch_data_key')">fetch_data_key</a>();
<a name="l565"><span class="linenum"> 565</span></a>  
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment">            // Caching subscribed users of each forum.</span>
<a name="l567"><span class="linenum"> 567</span></a>              if (!isset(<a class="var it41488" onMouseOver="hilite(41488)" onMouseOut="lolite()" onClick="logVariable('subscribedusers')" href="../../_variables/subscribedusers.html">$subscribedusers</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>])) {
<a name="l568"><span class="linenum"> 568</span></a>                  <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>]-&gt;id);
<a name="l569"><span class="linenum"> 569</span></a>                  if (<a class="var it41492" onMouseOver="hilite(41492)" onMouseOut="lolite()" onClick="logVariable('subusers')" href="../../_variables/subusers.html">$subusers</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('fetch_subscribed_users')" href="../../_functions/fetch_subscribed_users.html" onMouseOver="funcPopup(event,'fetch_subscribed_users')">fetch_subscribed_users</a>(<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>], 0, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, 'u.*', true)) {
<a name="l570"><span class="linenum"> 570</span></a>  
<a name="l571"><span class="linenum"> 571</span></a>                      foreach (<a class="var it41492" onMouseOver="hilite(41492)" onMouseOut="lolite()" onClick="logVariable('subusers')" href="../../_variables/subusers.html">$subusers</a> as <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>) {
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment">                        // this user is subscribed to this forum</span>
<a name="l573"><span class="linenum"> 573</span></a>                          <a class="var it41488" onMouseOver="hilite(41488)" onMouseOut="lolite()" onClick="logVariable('subscribedusers')" href="../../_variables/subscribedusers.html">$subscribedusers</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>][<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('id')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('id')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l574"><span class="linenum"> 574</span></a>                          <a class="var it41486" onMouseOver="hilite(41486)" onMouseOut="lolite()" onClick="logVariable('userscount')" href="../../_variables/userscount.html">$userscount</a>++;
<a name="l575"><span class="linenum"> 575</span></a>                          if (<a class="var it41486" onMouseOver="hilite(41486)" onMouseOut="lolite()" onClick="logVariable('userscount')" href="../../_variables/userscount.html">$userscount</a> &gt; <a class="constant" onClick="logConstant('FORUM_CRON_USER_CACHE')" href="../../_constants/FORUM_CRON_USER_CACHE.html" onMouseOver="constPopup(event,'FORUM_CRON_USER_CACHE')">FORUM_CRON_USER_CACHE</a>) {
<a name="l576"><span class="linenum"> 576</span></a>  <span class="comment">                            // Store minimal user info.</span>
<a name="l577"><span class="linenum"> 577</span></a>                              <a class="var it41494" onMouseOver="hilite(41494)" onMouseOut="lolite()" onClick="logVariable('minuser')" href="../../_variables/minuser.html">$minuser</a> = new stdClass();
<a name="l578"><span class="linenum"> 578</span></a>                              <a class="var it41494" onMouseOver="hilite(41494)" onMouseOut="lolite()" onClick="logVariable('minuser')" href="../../_variables/minuser.html">$minuser</a>-&gt;<a onClick="logVariable('id')" class="var it44615" onMouseOver="hilite(44615)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('id')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l579"><span class="linenum"> 579</span></a>                              <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('id')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it41494" onMouseOver="hilite(41494)" onMouseOut="lolite()" onClick="logVariable('minuser')" href="../../_variables/minuser.html">$minuser</a>;
<a name="l580"><span class="linenum"> 580</span></a>                          } else {
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment">                            // Cache full user record.</span>
<a name="l582"><span class="linenum"> 582</span></a>                              <a class="function" onClick="logFunction('forum_cron_minimise_user_record')" href="../../_functions/forum_cron_minimise_user_record.html" onMouseOver="funcPopup(event,'forum_cron_minimise_user_record')">forum_cron_minimise_user_record</a>(<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>);
<a name="l583"><span class="linenum"> 583</span></a>                              <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('id')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>;
<a name="l584"><span class="linenum"> 584</span></a>                          }
<a name="l585"><span class="linenum"> 585</span></a>                      }
<a name="l586"><span class="linenum"> 586</span></a>  <span class="comment">                    // Release memory.</span>
<a name="l587"><span class="linenum"> 587</span></a>                      unset(<a class="var it41492" onMouseOver="hilite(41492)" onMouseOut="lolite()" onClick="logVariable('subusers')" href="../../_variables/subusers.html">$subusers</a>);
<a name="l588"><span class="linenum"> 588</span></a>                      unset(<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>);
<a name="l589"><span class="linenum"> 589</span></a>                  }
<a name="l590"><span class="linenum"> 590</span></a>              }
<a name="l591"><span class="linenum"> 591</span></a>              <a class="var it41487" onMouseOver="hilite(41487)" onMouseOut="lolite()" onClick="logVariable('mailcount')" href="../../_variables/mailcount.html">$mailcount</a>[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>] = 0;
<a name="l592"><span class="linenum"> 592</span></a>              <a class="var it30351" onMouseOver="hilite(30351)" onMouseOut="lolite()" onClick="logVariable('errorcount')" href="../../_variables/errorcount.html">$errorcount</a>[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>] = 0;
<a name="l593"><span class="linenum"> 593</span></a>          }
<a name="l594"><span class="linenum"> 594</span></a>      }
<a name="l595"><span class="linenum"> 595</span></a>  
<a name="l596"><span class="linenum"> 596</span></a>      if (<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> &amp;&amp; <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>) {
<a name="l597"><span class="linenum"> 597</span></a>  
<a name="l598"><span class="linenum"> 598</span></a>          foreach (<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> as <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>) {
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment">            // Terminate if processing of any account takes longer than 2 minutes.</span>
<a name="l600"><span class="linenum"> 600</span></a>              <a class="class" onClick="logClass('core_php_time_limit')" href="../../_classes/core_php_time_limit.html" onMouseOver="classPopup(event,'core_php_time_limit')">core_php_time_limit</a>::<a class="function" onClick="logFunction('raise')" href="../../_functions/raise.html" onMouseOver="funcPopup(event,'raise')">raise</a>(120);
<a name="l601"><span class="linenum"> 601</span></a>  
<a name="l602"><span class="linenum"> 602</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Processing user ' . <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l603"><span class="linenum"> 603</span></a>  
<a name="l604"><span class="linenum"> 604</span></a>  <span class="comment">            // Init user caches - we keep the cache for one cycle only, otherwise it could consume too much memory.</span>
<a name="l605"><span class="linenum"> 605</span></a>              if (isset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('username')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>)) {
<a name="l606"><span class="linenum"> 606</span></a>                  <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>);
<a name="l607"><span class="linenum"> 607</span></a>              } else {
<a name="l608"><span class="linenum"> 608</span></a>                  <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l609"><span class="linenum"> 609</span></a>                  <a class="function" onClick="logFunction('forum_cron_minimise_user_record')" href="../../_functions/forum_cron_minimise_user_record.html" onMouseOver="funcPopup(event,'forum_cron_minimise_user_record')">forum_cron_minimise_user_record</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>);
<a name="l610"><span class="linenum"> 610</span></a>              }
<a name="l611"><span class="linenum"> 611</span></a>              <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a> = array();
<a name="l612"><span class="linenum"> 612</span></a>              <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>       = array();
<a name="l613"><span class="linenum"> 613</span></a>              <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('markposts')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/markposts.html">markposts</a>     = array();
<a name="l614"><span class="linenum"> 614</span></a>  
<a name="l615"><span class="linenum"> 615</span></a>  <span class="comment">            // Setup this user so that the capabilities are cached, and environment matches receiving user.</span>
<a name="l616"><span class="linenum"> 616</span></a>              <a class="function" onClick="logFunction('cron_setup_user')" href="../../_functions/cron_setup_user.html" onMouseOver="funcPopup(event,'cron_setup_user')">cron_setup_user</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>);
<a name="l617"><span class="linenum"> 617</span></a>  
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment">            // Reset the caches.</span>
<a name="l619"><span class="linenum"> 619</span></a>              foreach (<a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a> as <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a> =&gt; <a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>) {
<a name="l620"><span class="linenum"> 620</span></a>                  <a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>]-&gt;cache       = new stdClass();
<a name="l621"><span class="linenum"> 621</span></a>                  <a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>]-&gt;cache-&gt;caps = array();
<a name="l622"><span class="linenum"> 622</span></a>                  unset(<a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>]-&gt;uservisible);
<a name="l623"><span class="linenum"> 623</span></a>              }
<a name="l624"><span class="linenum"> 624</span></a>  
<a name="l625"><span class="linenum"> 625</span></a>              foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a> =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l626"><span class="linenum"> 626</span></a>                  <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>];
<a name="l627"><span class="linenum"> 627</span></a>                  <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>      = <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>];
<a name="l628"><span class="linenum"> 628</span></a>                  <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>     = <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>];
<a name="l629"><span class="linenum"> 629</span></a>                  <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>         =&amp; <a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l630"><span class="linenum"> 630</span></a>  
<a name="l631"><span class="linenum"> 631</span></a>  <span class="comment">                // Do some checks to see if we can bail out now.</span>
<a name="l632"><span class="linenum"> 632</span></a>  
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment">                // Only active enrolled users are in the list of subscribers.</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment">                // This does not necessarily mean that the user is subscribed to the forum or to the discussion though.</span>
<a name="l635"><span class="linenum"> 635</span></a>                  if (!isset(<a class="var it41488" onMouseOver="hilite(41488)" onMouseOut="lolite()" onClick="logVariable('subscribedusers')" href="../../_variables/subscribedusers.html">$subscribedusers</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>][<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">                    // The user does not subscribe to this forum.</span>
<a name="l637"><span class="linenum"> 637</span></a>                      continue;
<a name="l638"><span class="linenum"> 638</span></a>                  }
<a name="l639"><span class="linenum"> 639</span></a>  
<a name="l640"><span class="linenum"> 640</span></a>                  if (!\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_subscribed')" href="../../_functions/is_subscribed.html" onMouseOver="funcPopup(event,'is_subscribed')">is_subscribed</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>, <a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l641"><span class="linenum"> 641</span></a>  <span class="comment">                    // The user does not subscribe to this forum, or to this specific discussion.</span>
<a name="l642"><span class="linenum"> 642</span></a>                      continue;
<a name="l643"><span class="linenum"> 643</span></a>                  }
<a name="l644"><span class="linenum"> 644</span></a>  
<a name="l645"><span class="linenum"> 645</span></a>                  if (<a class="var it24368" onMouseOver="hilite(24368)" onMouseOut="lolite()" onClick="logVariable('subscriptiontime')" href="../../_variables/subscriptiontime.html">$subscriptiontime</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('fetch_discussion_subscription')" href="../../_functions/fetch_discussion_subscription.html" onMouseOver="funcPopup(event,'fetch_discussion_subscription')">fetch_discussion_subscription</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l646"><span class="linenum"> 646</span></a>  <span class="comment">                    // Skip posts if the user subscribed to the discussion after it was created.</span>
<a name="l647"><span class="linenum"> 647</span></a>                      if (isset(<a class="var it24368" onMouseOver="hilite(24368)" onMouseOut="lolite()" onClick="logVariable('subscriptiontime')" href="../../_variables/subscriptiontime.html">$subscriptiontime</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>]) &amp;&amp; (<a class="var it24368" onMouseOver="hilite(24368)" onMouseOut="lolite()" onClick="logVariable('subscriptiontime')" href="../../_variables/subscriptiontime.html">$subscriptiontime</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>] &gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('created')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/created.html">created</a>)) {
<a name="l648"><span class="linenum"> 648</span></a>                          continue;
<a name="l649"><span class="linenum"> 649</span></a>                      }
<a name="l650"><span class="linenum"> 650</span></a>                  }
<a name="l651"><span class="linenum"> 651</span></a>  
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">                // Don't send email if the forum is Q&amp;A and the user has not posted.</span>
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment">                // Initial topics are still mailed.</span>
<a name="l654"><span class="linenum"> 654</span></a>                  if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'qanda' &amp;&amp; !<a class="function" onClick="logFunction('forum_get_user_posted_time')" href="../../_functions/forum_get_user_posted_time.html" onMouseOver="funcPopup(event,'forum_get_user_posted_time')">forum_get_user_posted_time</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) &amp;&amp; <a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a> != <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('firstpost')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/firstpost.html">firstpost</a>) {
<a name="l655"><span class="linenum"> 655</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Did not email ' . <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.' because user has not posted in discussion');
<a name="l656"><span class="linenum"> 656</span></a>                      continue;
<a name="l657"><span class="linenum"> 657</span></a>                  }
<a name="l658"><span class="linenum"> 658</span></a>  
<a name="l659"><span class="linenum"> 659</span></a>  <span class="comment">                // Get info about the sending user.</span>
<a name="l660"><span class="linenum"> 660</span></a>                  if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>)) {
<a name="l661"><span class="linenum"> 661</span></a>  <span class="comment">                    // We might know the user already.</span>
<a name="l662"><span class="linenum"> 662</span></a>                      <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a> = <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>];
<a name="l663"><span class="linenum"> 663</span></a>                      if (!isset(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('idnumber')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>)) {
<a name="l664"><span class="linenum"> 664</span></a>  <span class="comment">                        // Minimalised user info, fetch full record.</span>
<a name="l665"><span class="linenum"> 665</span></a>                          <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l666"><span class="linenum"> 666</span></a>                          <a class="function" onClick="logFunction('forum_cron_minimise_user_record')" href="../../_functions/forum_cron_minimise_user_record.html" onMouseOver="funcPopup(event,'forum_cron_minimise_user_record')">forum_cron_minimise_user_record</a>(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>);
<a name="l667"><span class="linenum"> 667</span></a>                      }
<a name="l668"><span class="linenum"> 668</span></a>  
<a name="l669"><span class="linenum"> 669</span></a>                  } else if (<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>))) {
<a name="l670"><span class="linenum"> 670</span></a>                      <a class="function" onClick="logFunction('forum_cron_minimise_user_record')" href="../../_functions/forum_cron_minimise_user_record.html" onMouseOver="funcPopup(event,'forum_cron_minimise_user_record')">forum_cron_minimise_user_record</a>(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>);
<a name="l671"><span class="linenum"> 671</span></a>  <span class="comment">                    // Fetch only once if possible, we can add it to user list, it will be skipped anyway.</span>
<a name="l672"><span class="linenum"> 672</span></a>                      if (<a class="var it41486" onMouseOver="hilite(41486)" onMouseOut="lolite()" onClick="logVariable('userscount')" href="../../_variables/userscount.html">$userscount</a> &lt;= <a class="constant" onClick="logConstant('FORUM_CRON_USER_CACHE')" href="../../_constants/FORUM_CRON_USER_CACHE.html" onMouseOver="constPopup(event,'FORUM_CRON_USER_CACHE')">FORUM_CRON_USER_CACHE</a>) {
<a name="l673"><span class="linenum"> 673</span></a>                          <a class="var it41486" onMouseOver="hilite(41486)" onMouseOut="lolite()" onClick="logVariable('userscount')" href="../../_variables/userscount.html">$userscount</a>++;
<a name="l674"><span class="linenum"> 674</span></a>                          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>;
<a name="l675"><span class="linenum"> 675</span></a>                      }
<a name="l676"><span class="linenum"> 676</span></a>                  } else {
<a name="l677"><span class="linenum"> 677</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Could not find user ' . <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> . ', author of post ' . <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> . '. Unable to send message.');
<a name="l678"><span class="linenum"> 678</span></a>                      continue;
<a name="l679"><span class="linenum"> 679</span></a>                  }
<a name="l680"><span class="linenum"> 680</span></a>  
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment">                // Note: If we want to check that userto and userfrom are not the same person this is probably the spot to do it.</span>
<a name="l682"><span class="linenum"> 682</span></a>  
<a name="l683"><span class="linenum"> 683</span></a>  <span class="comment">                // Setup global $COURSE properly - needed for roles and languages.</span>
<a name="l684"><span class="linenum"> 684</span></a>                  <a class="function" onClick="logFunction('cron_setup_user')" href="../../_functions/cron_setup_user.html" onMouseOver="funcPopup(event,'cron_setup_user')">cron_setup_user</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l685"><span class="linenum"> 685</span></a>  
<a name="l686"><span class="linenum"> 686</span></a>  <span class="comment">                // Fill caches.</span>
<a name="l687"><span class="linenum"> 687</span></a>                  if (!isset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l688"><span class="linenum"> 688</span></a>                      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l689"><span class="linenum"> 689</span></a>                      <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l690"><span class="linenum"> 690</span></a>                  }
<a name="l691"><span class="linenum"> 691</span></a>                  if (!isset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l692"><span class="linenum"> 692</span></a>                      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l693"><span class="linenum"> 693</span></a>                      <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="function" onClick="logFunction('forum_user_can_post')" href="../../_functions/forum_user_can_post.html" onMouseOver="funcPopup(event,'forum_user_can_post')">forum_user_can_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l694"><span class="linenum"> 694</span></a>                  }
<a name="l695"><span class="linenum"> 695</span></a>                  if (!isset(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l696"><span class="linenum"> 696</span></a>                      if (!isset(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a>)) {
<a name="l697"><span class="linenum"> 697</span></a>                          <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a> = array();
<a name="l698"><span class="linenum"> 698</span></a>                          if (isset(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l699"><span class="linenum"> 699</span></a>                              <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;groups = array();
<a name="l700"><span class="linenum"> 700</span></a>                          }
<a name="l701"><span class="linenum"> 701</span></a>                      }
<a name="l702"><span class="linenum"> 702</span></a>                      <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="function" onClick="logFunction('groups_get_all_groups')" href="../../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>);
<a name="l703"><span class="linenum"> 703</span></a>                      if (isset(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l704"><span class="linenum"> 704</span></a>                          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;groups[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l705"><span class="linenum"> 705</span></a>                      }
<a name="l706"><span class="linenum"> 706</span></a>                  }
<a name="l707"><span class="linenum"> 707</span></a>  
<a name="l708"><span class="linenum"> 708</span></a>  <span class="comment">                // Make sure groups allow this user to see this email.</span>
<a name="l709"><span class="linenum"> 709</span></a>                  if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> &gt; 0 and <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>)) {
<a name="l710"><span class="linenum"> 710</span></a>  <span class="comment">                    // Groups are being used.</span>
<a name="l711"><span class="linenum"> 711</span></a>                      if (!<a class="function" onClick="logFunction('groups_group_exists')" href="../../_functions/groups_group_exists.html" onMouseOver="funcPopup(event,'groups_group_exists')">groups_group_exists</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>)) {
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment">                        // Can't find group - be safe and don't this message.</span>
<a name="l713"><span class="linenum"> 713</span></a>                          continue;
<a name="l714"><span class="linenum"> 714</span></a>                      }
<a name="l715"><span class="linenum"> 715</span></a>  
<a name="l716"><span class="linenum"> 716</span></a>                      if (!<a class="function" onClick="logFunction('groups_is_member')" href="../../_functions/groups_is_member.html" onMouseOver="funcPopup(event,'groups_is_member')">groups_is_member</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>) and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment">                        // Do not send posts from other groups when in SEPARATEGROUPS or VISIBLEGROUPS.</span>
<a name="l718"><span class="linenum"> 718</span></a>                          continue;
<a name="l719"><span class="linenum"> 719</span></a>                      }
<a name="l720"><span class="linenum"> 720</span></a>                  }
<a name="l721"><span class="linenum"> 721</span></a>  
<a name="l722"><span class="linenum"> 722</span></a>  <span class="comment">                // Make sure we're allowed to see the post.</span>
<a name="l723"><span class="linenum"> 723</span></a>                  if (!<a class="function" onClick="logFunction('forum_user_can_see_post')" href="../../_functions/forum_user_can_see_post.html" onMouseOver="funcPopup(event,'forum_user_can_see_post')">forum_user_can_see_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, null, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l724"><span class="linenum"> 724</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('User ' . <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> .' can not see ' . <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> . '. Not sending message.');
<a name="l725"><span class="linenum"> 725</span></a>                      continue;
<a name="l726"><span class="linenum"> 726</span></a>                  }
<a name="l727"><span class="linenum"> 727</span></a>  
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment">                // OK so we need to send the email.</span>
<a name="l729"><span class="linenum"> 729</span></a>  
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment">                // Does the user want this post in a digest?  If so postpone it for now.</span>
<a name="l731"><span class="linenum"> 731</span></a>                  <a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> = <a class="function" onClick="logFunction('forum_get_user_maildigest_bulk')" href="../../_functions/forum_get_user_maildigest_bulk.html" onMouseOver="funcPopup(event,'forum_get_user_maildigest_bulk')">forum_get_user_maildigest_bulk</a>(<a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l732"><span class="linenum"> 732</span></a>  
<a name="l733"><span class="linenum"> 733</span></a>                  if (<a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> &gt; 0) {
<a name="l734"><span class="linenum"> 734</span></a>  <span class="comment">                    // This user wants the mails to be in digest form.</span>
<a name="l735"><span class="linenum"> 735</span></a>                      <a class="var it3993" onMouseOver="hilite(3993)" onMouseOut="lolite()" onClick="logVariable('queue')" href="../../_variables/queue.html">$queue</a> = new stdClass();
<a name="l736"><span class="linenum"> 736</span></a>                      <a class="var it3993" onMouseOver="hilite(3993)" onMouseOut="lolite()" onClick="logVariable('queue')" href="../../_variables/queue.html">$queue</a>-&gt;<a onClick="logVariable('userid')" class="var it44616" onMouseOver="hilite(44616)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>       = <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l737"><span class="linenum"> 737</span></a>                      <a class="var it3993" onMouseOver="hilite(3993)" onMouseOut="lolite()" onClick="logVariable('queue')" href="../../_variables/queue.html">$queue</a>-&gt;<a onClick="logVariable('discussionid')" class="var it44616" onMouseOver="hilite(44616)" onMouseOut="lolite()" href="../../_variables/discussionid.html">discussionid</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l738"><span class="linenum"> 738</span></a>                      <a class="var it3993" onMouseOver="hilite(3993)" onMouseOut="lolite()" onClick="logVariable('queue')" href="../../_variables/queue.html">$queue</a>-&gt;<a onClick="logVariable('postid')" class="var it44616" onMouseOver="hilite(44616)" onMouseOut="lolite()" href="../../_variables/postid.html">postid</a>       = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l739"><span class="linenum"> 739</span></a>                      <a class="var it3993" onMouseOver="hilite(3993)" onMouseOut="lolite()" onClick="logVariable('queue')" href="../../_variables/queue.html">$queue</a>-&gt;<a onClick="logVariable('timemodified')" class="var it44616" onMouseOver="hilite(44616)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('created')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/created.html">created</a>;
<a name="l740"><span class="linenum"> 740</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('forum_queue', <a class="var it3993" onMouseOver="hilite(3993)" onMouseOut="lolite()" onClick="logVariable('queue')" href="../../_variables/queue.html">$queue</a>);
<a name="l741"><span class="linenum"> 741</span></a>                      continue;
<a name="l742"><span class="linenum"> 742</span></a>                  }
<a name="l743"><span class="linenum"> 743</span></a>  
<a name="l744"><span class="linenum"> 744</span></a>  <span class="comment">                // Prepare to actually send the post now, and build up the content.</span>
<a name="l745"><span class="linenum"> 745</span></a>  
<a name="l746"><span class="linenum"> 746</span></a>                  <a class="var it41496" onMouseOver="hilite(41496)" onMouseOut="lolite()" onClick="logVariable('cleanforumname')" href="../../_variables/cleanforumname.html">$cleanforumname</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('&quot;', &quot;'&quot;, <a class="phpfunction" onClick="logFunction('strip_tags')" href="../../_functions/strip_tags.html" onMouseOver="phpfuncPopup(event,'strip_tags')">strip_tags</a>(<a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>)));
<a name="l747"><span class="linenum"> 747</span></a>  
<a name="l748"><span class="linenum"> 748</span></a>                  <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('customheaders')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/customheaders.html">customheaders</a> = array (
<a name="l749"><span class="linenum"> 749</span></a>  <span class="comment">                    // Headers to make emails easier to track.</span>
<a name="l750"><span class="linenum"> 750</span></a>                      'List-Id: &quot;'        . <a class="var it41496" onMouseOver="hilite(41496)" onMouseOut="lolite()" onClick="logVariable('cleanforumname')" href="../../_variables/cleanforumname.html">$cleanforumname</a> . '&quot; ' . <a class="function" onClick="logFunction('generate_email_messageid')" href="../../_functions/generate_email_messageid.html" onMouseOver="funcPopup(event,'generate_email_messageid')">generate_email_messageid</a>('moodleforum' . <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>),
<a name="l751"><span class="linenum"> 751</span></a>                      'List-Help: '       . <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a> . '/mod/forum/view.php?f=' . <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l752"><span class="linenum"> 752</span></a>                      'Message-ID: '      . <a class="function" onClick="logFunction('forum_get_email_message_id')" href="../../_functions/forum_get_email_message_id.html" onMouseOver="funcPopup(event,'forum_get_email_message_id')">forum_get_email_message_id</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>),
<a name="l753"><span class="linenum"> 753</span></a>                      'X-Course-Id: '     . <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l754"><span class="linenum"> 754</span></a>                      'X-Course-Name: '   . <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('fullname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>, true),
<a name="l755"><span class="linenum"> 755</span></a>  
<a name="l756"><span class="linenum"> 756</span></a>  <span class="comment">                    // Headers to help prevent auto-responders.</span>
<a name="l757"><span class="linenum"> 757</span></a>                      'Precedence: Bulk',
<a name="l758"><span class="linenum"> 758</span></a>                      'X-Auto-Response-Suppress: All',
<a name="l759"><span class="linenum"> 759</span></a>                      'Auto-Submitted: auto-generated',
<a name="l760"><span class="linenum"> 760</span></a>                  );
<a name="l761"><span class="linenum"> 761</span></a>  
<a name="l762"><span class="linenum"> 762</span></a>                  <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../_variables/shortname.html">$shortname</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)));
<a name="l763"><span class="linenum"> 763</span></a>  
<a name="l764"><span class="linenum"> 764</span></a>  <span class="comment">                // Generate a reply-to address from using the Inbound Message handler.</span>
<a name="l765"><span class="linenum"> 765</span></a>                  <a class="var it29768" onMouseOver="hilite(29768)" onMouseOut="lolite()" onClick="logVariable('replyaddress')" href="../../_variables/replyaddress.html">$replyaddress</a> = null;
<a name="l766"><span class="linenum"> 766</span></a>                  if (<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] &amp;&amp; <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it41489" onMouseOver="hilite(41489)" onMouseOut="lolite()" onClick="logVariable('messageinboundhandlers')" href="../../_variables/messageinboundhandlers.html">$messageinboundhandlers</a>)) {
<a name="l767"><span class="linenum"> 767</span></a>                      <a class="var it41491" onMouseOver="hilite(41491)" onMouseOut="lolite()" onClick="logVariable('messageinboundgenerator')" href="../../_variables/messageinboundgenerator.html">$messageinboundgenerator</a>-&gt;<a class="function" onClick="logFunction('set_data')" href="../../_functions/set_data.html" onMouseOver="funcPopup(event,'set_data')">set_data</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it41489" onMouseOver="hilite(41489)" onMouseOut="lolite()" onClick="logVariable('messageinboundhandlers')" href="../../_variables/messageinboundhandlers.html">$messageinboundhandlers</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]);
<a name="l768"><span class="linenum"> 768</span></a>                      <a class="var it29768" onMouseOver="hilite(29768)" onMouseOut="lolite()" onClick="logVariable('replyaddress')" href="../../_variables/replyaddress.html">$replyaddress</a> = <a class="var it41491" onMouseOver="hilite(41491)" onMouseOut="lolite()" onClick="logVariable('messageinboundgenerator')" href="../../_variables/messageinboundgenerator.html">$messageinboundgenerator</a>-&gt;<a class="function" onClick="logFunction('generate')" href="../../_functions/generate.html" onMouseOver="funcPopup(event,'generate')">generate</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l769"><span class="linenum"> 769</span></a>                  }
<a name="l770"><span class="linenum"> 770</span></a>  
<a name="l771"><span class="linenum"> 771</span></a>                  if (!isset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l772"><span class="linenum"> 772</span></a>                      <a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a> = <a class="function" onClick="logFunction('forum_user_can_post')" href="../../_functions/forum_user_can_post.html" onMouseOver="funcPopup(event,'forum_user_can_post')">forum_user_can_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l773"><span class="linenum"> 773</span></a>                  } else {
<a name="l774"><span class="linenum"> 774</span></a>                      <a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a> = <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l775"><span class="linenum"> 775</span></a>                  }
<a name="l776"><span class="linenum"> 776</span></a>  
<a name="l777"><span class="linenum"> 777</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = new \mod_forum\output\forum_post_email(
<a name="l778"><span class="linenum"> 778</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>,
<a name="l779"><span class="linenum"> 779</span></a>                          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>,
<a name="l780"><span class="linenum"> 780</span></a>                          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>,
<a name="l781"><span class="linenum"> 781</span></a>                          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>,
<a name="l782"><span class="linenum"> 782</span></a>                          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>,
<a name="l783"><span class="linenum"> 783</span></a>                          <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>,
<a name="l784"><span class="linenum"> 784</span></a>                          <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>,
<a name="l785"><span class="linenum"> 785</span></a>                          <a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a>
<a name="l786"><span class="linenum"> 786</span></a>                      );
<a name="l787"><span class="linenum"> 787</span></a>  
<a name="l788"><span class="linenum"> 788</span></a>                  <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('customheaders')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/customheaders.html">customheaders</a>[] = sprintf('List-Unsubscribe: &lt;%s&gt;',
<a name="l789"><span class="linenum"> 789</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a class="function" onClick="logFunction('get_unsubscribediscussionlink')" href="../../_functions/get_unsubscribediscussionlink.html" onMouseOver="funcPopup(event,'get_unsubscribediscussionlink')">get_unsubscribediscussionlink</a>());
<a name="l790"><span class="linenum"> 790</span></a>  
<a name="l791"><span class="linenum"> 791</span></a>                  if (!isset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l792"><span class="linenum"> 792</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a> = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l793"><span class="linenum"> 793</span></a>                  } else {
<a name="l794"><span class="linenum"> 794</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a> = <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l795"><span class="linenum"> 795</span></a>                  }
<a name="l796"><span class="linenum"> 796</span></a>  
<a name="l797"><span class="linenum"> 797</span></a>  <span class="comment">                // Not all of these variables are used in the default language</span>
<a name="l798"><span class="linenum"> 798</span></a>  <span class="comment">                // string but are made available to support custom subjects.</span>
<a name="l799"><span class="linenum"> 799</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a> = new stdClass();
<a name="l800"><span class="linenum"> 800</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('subject')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a class="function" onClick="logFunction('get_subject')" href="../../_functions/get_subject.html" onMouseOver="funcPopup(event,'get_subject')">get_subject</a>();
<a name="l801"><span class="linenum"> 801</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('forumname')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/forumname.html">forumname</a> = <a class="var it41496" onMouseOver="hilite(41496)" onMouseOut="lolite()" onClick="logVariable('cleanforumname')" href="../../_variables/cleanforumname.html">$cleanforumname</a>;
<a name="l802"><span class="linenum"> 802</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('sitefullname')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/sitefullname.html">sitefullname</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('fullname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>);
<a name="l803"><span class="linenum"> 803</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('siteshortname')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/siteshortname.html">siteshortname</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('shortname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>);
<a name="l804"><span class="linenum"> 804</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('courseidnumber')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/courseidnumber.html">courseidnumber</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a class="function" onClick="logFunction('get_courseidnumber')" href="../../_functions/get_courseidnumber.html" onMouseOver="funcPopup(event,'get_courseidnumber')">get_courseidnumber</a>();
<a name="l805"><span class="linenum"> 805</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('coursefullname')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/coursefullname.html">coursefullname</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a class="function" onClick="logFunction('get_coursefullname')" href="../../_functions/get_coursefullname.html" onMouseOver="funcPopup(event,'get_coursefullname')">get_coursefullname</a>();
<a name="l806"><span class="linenum"> 806</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('courseshortname')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/courseshortname.html">courseshortname</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a class="function" onClick="logFunction('get_coursename')" href="../../_functions/get_coursename.html" onMouseOver="funcPopup(event,'get_coursename')">get_coursename</a>();
<a name="l807"><span class="linenum"> 807</span></a>                  <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('postsubject')" href="../../_variables/postsubject.html">$postsubject</a> = <a class="function" onClick="logFunction('html_to_text')" href="../../_functions/html_to_text.html" onMouseOver="funcPopup(event,'html_to_text')">html_to_text</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('postmailsubject', 'forum', <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>), 0);
<a name="l808"><span class="linenum"> 808</span></a>  
<a name="l809"><span class="linenum"> 809</span></a>                  <a class="var it41497" onMouseOver="hilite(41497)" onMouseOut="lolite()" onClick="logVariable('rootid')" href="../../_variables/rootid.html">$rootid</a> = <a class="function" onClick="logFunction('forum_get_email_message_id')" href="../../_functions/forum_get_email_message_id.html" onMouseOver="funcPopup(event,'forum_get_email_message_id')">forum_get_email_message_id</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('firstpost')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/firstpost.html">firstpost</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l810"><span class="linenum"> 810</span></a>  
<a name="l811"><span class="linenum"> 811</span></a>                  if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>) {
<a name="l812"><span class="linenum"> 812</span></a>  <span class="comment">                    // This post is a reply, so add reply header (RFC 2822).</span>
<a name="l813"><span class="linenum"> 813</span></a>                      <a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a> = <a class="function" onClick="logFunction('forum_get_email_message_id')" href="../../_functions/forum_get_email_message_id.html" onMouseOver="funcPopup(event,'forum_get_email_message_id')">forum_get_email_message_id</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l814"><span class="linenum"> 814</span></a>                      <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('customheaders')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/customheaders.html">customheaders</a>[] = &quot;In-Reply-To: <a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>&quot;;
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>  <span class="comment">                    // If the post is deeply nested we also reference the parent message id and</span>
<a name="l817"><span class="linenum"> 817</span></a>  <span class="comment">                    // the root message id (if different) to aid threading when parts of the email</span>
<a name="l818"><span class="linenum"> 818</span></a>  <span class="comment">                    // conversation have been deleted (RFC1036).</span>
<a name="l819"><span class="linenum"> 819</span></a>                      if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a> != <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('firstpost')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/firstpost.html">firstpost</a>) {
<a name="l820"><span class="linenum"> 820</span></a>                          <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('customheaders')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/customheaders.html">customheaders</a>[] = &quot;References: <a class="var it41497" onMouseOver="hilite(41497)" onMouseOut="lolite()" onClick="logVariable('rootid')" href="../../_variables/rootid.html">$rootid</a> <a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>&quot;;
<a name="l821"><span class="linenum"> 821</span></a>                      } else {
<a name="l822"><span class="linenum"> 822</span></a>                          <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('customheaders')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/customheaders.html">customheaders</a>[] = &quot;References: <a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>&quot;;
<a name="l823"><span class="linenum"> 823</span></a>                      }
<a name="l824"><span class="linenum"> 824</span></a>                  }
<a name="l825"><span class="linenum"> 825</span></a>  
<a name="l826"><span class="linenum"> 826</span></a>  <span class="comment">                // MS Outlook / Office uses poorly documented and non standard headers, including</span>
<a name="l827"><span class="linenum"> 827</span></a>  <span class="comment">                // Thread-Topic which overrides the Subject and shouldn't contain Re: or Fwd: etc.</span>
<a name="l828"><span class="linenum"> 828</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('subject')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l829"><span class="linenum"> 829</span></a>                  <a class="var it41498" onMouseOver="hilite(41498)" onMouseOut="lolite()" onClick="logVariable('threadtopic')" href="../../_variables/threadtopic.html">$threadtopic</a> = <a class="function" onClick="logFunction('html_to_text')" href="../../_functions/html_to_text.html" onMouseOver="funcPopup(event,'html_to_text')">html_to_text</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('postmailsubject', 'forum', <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>), 0);
<a name="l830"><span class="linenum"> 830</span></a>                  <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('customheaders')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/customheaders.html">customheaders</a>[] = &quot;Thread-Topic: <a class="var it41498" onMouseOver="hilite(41498)" onMouseOut="lolite()" onClick="logVariable('threadtopic')" href="../../_variables/threadtopic.html">$threadtopic</a>&quot;;
<a name="l831"><span class="linenum"> 831</span></a>                  <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('customheaders')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/customheaders.html">customheaders</a>[] = &quot;Thread-Index: &quot; . <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it41497" onMouseOver="hilite(41497)" onMouseOut="lolite()" onClick="logVariable('rootid')" href="../../_variables/rootid.html">$rootid</a>, 1, 28);
<a name="l832"><span class="linenum"> 832</span></a>  
<a name="l833"><span class="linenum"> 833</span></a>  <span class="comment">                // Send the post now!</span>
<a name="l834"><span class="linenum"> 834</span></a>                  <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Sending ', '');
<a name="l835"><span class="linenum"> 835</span></a>  
<a name="l836"><span class="linenum"> 836</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a> = new \core\message\<a class="function" onClick="logFunction('message')" href="../../_functions/message.html" onMouseOver="funcPopup(event,'message')">message</a>();
<a name="l837"><span class="linenum"> 837</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('component')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>           = 'mod_forum';
<a name="l838"><span class="linenum"> 838</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('name')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>                = 'posts';
<a name="l839"><span class="linenum"> 839</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userfrom.html">userfrom</a>            = <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>;
<a name="l840"><span class="linenum"> 840</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userto.html">userto</a>              = <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>;
<a name="l841"><span class="linenum"> 841</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('subject')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>             = <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('postsubject')" href="../../_variables/postsubject.html">$postsubject</a>;
<a name="l842"><span class="linenum"> 842</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessage.html">fullmessage</a>         = <a class="var it41481" onMouseOver="hilite(41481)" onMouseOut="lolite()" onClick="logVariable('textout')" href="../../_variables/textout.html">$textout</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l843"><span class="linenum"> 843</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessageformat.html">fullmessageformat</a>   = <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>;
<a name="l844"><span class="linenum"> 844</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessagehtml.html">fullmessagehtml</a>     = <a class="var it41480" onMouseOver="hilite(41480)" onMouseOut="lolite()" onClick="logVariable('htmlout')" href="../../_variables/htmlout.html">$htmlout</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l845"><span class="linenum"> 845</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('notification')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/notification.html">notification</a>        = 1;
<a name="l846"><span class="linenum"> 846</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('replyto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/replyto.html">replyto</a>             = <a class="var it29768" onMouseOver="hilite(29768)" onMouseOut="lolite()" onClick="logVariable('replyaddress')" href="../../_variables/replyaddress.html">$replyaddress</a>;
<a name="l847"><span class="linenum"> 847</span></a>                  if (!empty(<a class="var it29768" onMouseOver="hilite(29768)" onMouseOut="lolite()" onClick="logVariable('replyaddress')" href="../../_variables/replyaddress.html">$replyaddress</a>)) {
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment">                    // Add extra text to email messages if they can reply back.</span>
<a name="l849"><span class="linenum"> 849</span></a>                      <a class="var it41499" onMouseOver="hilite(41499)" onMouseOut="lolite()" onClick="logVariable('textfooter')" href="../../_variables/textfooter.html">$textfooter</a> = &quot;\n\n&quot; . <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('replytopostbyemail', 'mod_forum');
<a name="l850"><span class="linenum"> 850</span></a>                      <a class="var it41500" onMouseOver="hilite(41500)" onMouseOut="lolite()" onClick="logVariable('htmlfooter')" href="../../_variables/htmlfooter.html">$htmlfooter</a> = <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('p', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('replytopostbyemail', 'mod_forum'));
<a name="l851"><span class="linenum"> 851</span></a>                      <a class="var it24123" onMouseOver="hilite(24123)" onMouseOut="lolite()" onClick="logVariable('additionalcontent')" href="../../_variables/additionalcontent.html">$additionalcontent</a> = array('fullmessage' =&gt; array('footer' =&gt; <a class="var it41499" onMouseOver="hilite(41499)" onMouseOut="lolite()" onClick="logVariable('textfooter')" href="../../_variables/textfooter.html">$textfooter</a>),
<a name="l852"><span class="linenum"> 852</span></a>                                       'fullmessagehtml' =&gt; array('footer' =&gt; <a class="var it41500" onMouseOver="hilite(41500)" onMouseOut="lolite()" onClick="logVariable('htmlfooter')" href="../../_variables/htmlfooter.html">$htmlfooter</a>));
<a name="l853"><span class="linenum"> 853</span></a>                      <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a class="function" onClick="logFunction('set_additional_content')" href="../../_functions/set_additional_content.html" onMouseOver="funcPopup(event,'set_additional_content')">set_additional_content</a>('email', <a class="var it24123" onMouseOver="hilite(24123)" onMouseOut="lolite()" onClick="logVariable('additionalcontent')" href="../../_variables/additionalcontent.html">$additionalcontent</a>);
<a name="l854"><span class="linenum"> 854</span></a>                  }
<a name="l855"><span class="linenum"> 855</span></a>  
<a name="l856"><span class="linenum"> 856</span></a>  <span class="comment">                // If forum_replytouser is not set then send mail using the noreplyaddress.</span>
<a name="l857"><span class="linenum"> 857</span></a>                  if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_replytouser')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_replytouser.html">forum_replytouser</a>)) {
<a name="l858"><span class="linenum"> 858</span></a>                      <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userfrom.html">userfrom</a> = <a class="class" onClick="logClass('core_user')" href="../../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('get_noreply_user')" href="../../_functions/get_noreply_user.html" onMouseOver="funcPopup(event,'get_noreply_user')">get_noreply_user</a>();
<a name="l859"><span class="linenum"> 859</span></a>                  }
<a name="l860"><span class="linenum"> 860</span></a>  
<a name="l861"><span class="linenum"> 861</span></a>                  <a class="var it41502" onMouseOver="hilite(41502)" onMouseOut="lolite()" onClick="logVariable('smallmessagestrings')" href="../../_variables/smallmessagestrings.html">$smallmessagestrings</a> = new stdClass();
<a name="l862"><span class="linenum"> 862</span></a>                  <a class="var it41502" onMouseOver="hilite(41502)" onMouseOut="lolite()" onClick="logVariable('smallmessagestrings')" href="../../_variables/smallmessagestrings.html">$smallmessagestrings</a>-&gt;<a onClick="logVariable('user')" class="var it44617" onMouseOver="hilite(44617)" onMouseOut="lolite()" href="../../_variables/user.html">user</a>          = <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>);
<a name="l863"><span class="linenum"> 863</span></a>                  <a class="var it41502" onMouseOver="hilite(41502)" onMouseOut="lolite()" onClick="logVariable('smallmessagestrings')" href="../../_variables/smallmessagestrings.html">$smallmessagestrings</a>-&gt;<a onClick="logVariable('forumname')" class="var it44617" onMouseOver="hilite(44617)" onMouseOut="lolite()" href="../../_variables/forumname.html">forumname</a>     = &quot;<a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../_variables/shortname.html">$shortname</a>: &quot; . <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>, true) . &quot;: &quot; . <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l864"><span class="linenum"> 864</span></a>                  <a class="var it41502" onMouseOver="hilite(41502)" onMouseOut="lolite()" onClick="logVariable('smallmessagestrings')" href="../../_variables/smallmessagestrings.html">$smallmessagestrings</a>-&gt;<a onClick="logVariable('message')" class="var it44617" onMouseOver="hilite(44617)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>       = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>;
<a name="l865"><span class="linenum"> 865</span></a>  
<a name="l866"><span class="linenum"> 866</span></a>  <span class="comment">                // Make sure strings are in message recipients language.</span>
<a name="l867"><span class="linenum"> 867</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/smallmessage.html">smallmessage</a> = <a class="function" onClick="logFunction('get_string_manager')" href="../../_functions/get_string_manager.html" onMouseOver="funcPopup(event,'get_string_manager')">get_string_manager</a>()-&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('smallmessage', 'forum', <a class="var it41502" onMouseOver="hilite(41502)" onMouseOut="lolite()" onClick="logVariable('smallmessagestrings')" href="../../_variables/smallmessagestrings.html">$smallmessagestrings</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('lang')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a>);
<a name="l868"><span class="linenum"> 868</span></a>  
<a name="l869"><span class="linenum"> 869</span></a>                  <a class="var it2218" onMouseOver="hilite(2218)" onMouseOut="lolite()" onClick="logVariable('contexturl')" href="../../_variables/contexturl.html">$contexturl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/discuss.php.html">/mod/forum/discuss.php</a>', array('d' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), 'p' . <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l870"><span class="linenum"> 870</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('contexturl')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/contexturl.html">contexturl</a> = <a class="var it2218" onMouseOver="hilite(2218)" onMouseOut="lolite()" onClick="logVariable('contexturl')" href="../../_variables/contexturl.html">$contexturl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>();
<a name="l871"><span class="linenum"> 871</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('contexturlname')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/contexturlname.html">contexturlname</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l872"><span class="linenum"> 872</span></a>  
<a name="l873"><span class="linenum"> 873</span></a>                  <a class="var it41503" onMouseOver="hilite(41503)" onMouseOut="lolite()" onClick="logVariable('mailresult')" href="../../_variables/mailresult.html">$mailresult</a> = <a class="function" onClick="logFunction('message_send')" href="../../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>);
<a name="l874"><span class="linenum"> 874</span></a>                  if (!<a class="var it41503" onMouseOver="hilite(41503)" onMouseOut="lolite()" onClick="logVariable('mailresult')" href="../../_variables/mailresult.html">$mailresult</a>) {
<a name="l875"><span class="linenum"> 875</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;Error: mod/forum/lib.php <a class="function" onClick="logFunction('forum_cron')" href="../../_functions/forum_cron.html" onMouseOver="funcPopup(event,'forum_cron')">forum_cron</a>(): Could not send out mail for id <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> to user <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&quot;.
<a name="l876"><span class="linenum"> 876</span></a>                              &quot; (<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('email')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/email.html">email</a>) .. not trying again.&quot;);
<a name="l877"><span class="linenum"> 877</span></a>                      <a class="var it30351" onMouseOver="hilite(30351)" onMouseOut="lolite()" onClick="logVariable('errorcount')" href="../../_variables/errorcount.html">$errorcount</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]++;
<a name="l878"><span class="linenum"> 878</span></a>                  } else {
<a name="l879"><span class="linenum"> 879</span></a>                      <a class="var it41487" onMouseOver="hilite(41487)" onMouseOut="lolite()" onClick="logVariable('mailcount')" href="../../_variables/mailcount.html">$mailcount</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]++;
<a name="l880"><span class="linenum"> 880</span></a>  
<a name="l881"><span class="linenum"> 881</span></a>  <span class="comment">                    // Mark post as read if forum_usermarksread is set off.</span>
<a name="l882"><span class="linenum"> 882</span></a>                      if (!<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_usermarksread')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_usermarksread.html">forum_usermarksread</a>) {
<a name="l883"><span class="linenum"> 883</span></a>                          <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('markposts')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/markposts.html">markposts</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l884"><span class="linenum"> 884</span></a>                      }
<a name="l885"><span class="linenum"> 885</span></a>                  }
<a name="l886"><span class="linenum"> 886</span></a>  
<a name="l887"><span class="linenum"> 887</span></a>                  <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('post ' . <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> . ': ' . <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>);
<a name="l888"><span class="linenum"> 888</span></a>              }
<a name="l889"><span class="linenum"> 889</span></a>  
<a name="l890"><span class="linenum"> 890</span></a>  <span class="comment">            // Mark processed posts as read.</span>
<a name="l891"><span class="linenum"> 891</span></a>              <a class="function" onClick="logFunction('forum_tp_mark_posts_read')" href="../../_functions/forum_tp_mark_posts_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_posts_read')">forum_tp_mark_posts_read</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('markposts')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/markposts.html">markposts</a>);
<a name="l892"><span class="linenum"> 892</span></a>              unset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>);
<a name="l893"><span class="linenum"> 893</span></a>          }
<a name="l894"><span class="linenum"> 894</span></a>      }
<a name="l895"><span class="linenum"> 895</span></a>  
<a name="l896"><span class="linenum"> 896</span></a>      if (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>) {
<a name="l897"><span class="linenum"> 897</span></a>          foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l898"><span class="linenum"> 898</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(<a class="var it41487" onMouseOver="hilite(41487)" onMouseOut="lolite()" onClick="logVariable('mailcount')" href="../../_variables/mailcount.html">$mailcount</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>].&quot; users were sent post <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, '<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>'&quot;);
<a name="l899"><span class="linenum"> 899</span></a>              if (<a class="var it30351" onMouseOver="hilite(30351)" onMouseOut="lolite()" onClick="logVariable('errorcount')" href="../../_variables/errorcount.html">$errorcount</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]) {
<a name="l900"><span class="linenum"> 900</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('forum_posts', 'mailed', <a class="constant" onClick="logConstant('FORUM_MAILED_ERROR')" href="../../_constants/FORUM_MAILED_ERROR.html" onMouseOver="constPopup(event,'FORUM_MAILED_ERROR')">FORUM_MAILED_ERROR</a>, array('id' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l901"><span class="linenum"> 901</span></a>              }
<a name="l902"><span class="linenum"> 902</span></a>          }
<a name="l903"><span class="linenum"> 903</span></a>      }
<a name="l904"><span class="linenum"> 904</span></a>  
<a name="l905"><span class="linenum"> 905</span></a>  <span class="comment">    // release some memory</span>
<a name="l906"><span class="linenum"> 906</span></a>      unset(<a class="var it41488" onMouseOver="hilite(41488)" onMouseOut="lolite()" onClick="logVariable('subscribedusers')" href="../../_variables/subscribedusers.html">$subscribedusers</a>);
<a name="l907"><span class="linenum"> 907</span></a>      unset(<a class="var it41487" onMouseOver="hilite(41487)" onMouseOut="lolite()" onClick="logVariable('mailcount')" href="../../_variables/mailcount.html">$mailcount</a>);
<a name="l908"><span class="linenum"> 908</span></a>      unset(<a class="var it30351" onMouseOver="hilite(30351)" onMouseOut="lolite()" onClick="logVariable('errorcount')" href="../../_variables/errorcount.html">$errorcount</a>);
<a name="l909"><span class="linenum"> 909</span></a>  
<a name="l910"><span class="linenum"> 910</span></a>      <a class="function" onClick="logFunction('cron_setup_user')" href="../../_functions/cron_setup_user.html" onMouseOver="funcPopup(event,'cron_setup_user')">cron_setup_user</a>();
<a name="l911"><span class="linenum"> 911</span></a>  
<a name="l912"><span class="linenum"> 912</span></a>      <a class="var it11918" onMouseOver="hilite(11918)" onMouseOut="lolite()" onClick="logVariable('sitetimezone')" href="../../_variables/sitetimezone.html">$sitetimezone</a> = <a class="class" onClick="logClass('core_date')" href="../../_classes/core_date.html" onMouseOver="classPopup(event,'core_date')">core_date</a>::<a class="function" onClick="logFunction('get_server_timezone')" href="../../_functions/get_server_timezone.html" onMouseOver="funcPopup(event,'get_server_timezone')">get_server_timezone</a>();
<a name="l913"><span class="linenum"> 913</span></a>  
<a name="l914"><span class="linenum"> 914</span></a>  <span class="comment">    // Now see if there are any digest mails waiting to be sent, and if we should send them</span>
<a name="l915"><span class="linenum"> 915</span></a>  
<a name="l916"><span class="linenum"> 916</span></a>      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Starting digest processing...');
<a name="l917"><span class="linenum"> 917</span></a>  
<a name="l918"><span class="linenum"> 918</span></a>      <a class="class" onClick="logClass('core_php_time_limit')" href="../../_classes/core_php_time_limit.html" onMouseOver="classPopup(event,'core_php_time_limit')">core_php_time_limit</a>::<a class="function" onClick="logFunction('raise')" href="../../_functions/raise.html" onMouseOver="funcPopup(event,'raise')">raise</a>(300); <span class="comment">// terminate if not able to fetch all digests in 5 minutes</span>
<a name="l919"><span class="linenum"> 919</span></a>  
<a name="l920"><span class="linenum"> 920</span></a>      if (!isset(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('digestmailtimelast')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/digestmailtimelast.html">digestmailtimelast</a>)) {    // To catch the first time
<a name="l921"><span class="linenum"> 921</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('digestmailtimelast', 0);
<a name="l922"><span class="linenum"> 922</span></a>      }
<a name="l923"><span class="linenum"> 923</span></a>  
<a name="l924"><span class="linenum"> 924</span></a>      <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l925"><span class="linenum"> 925</span></a>      <a class="var it36709" onMouseOver="hilite(36709)" onMouseOut="lolite()" onClick="logVariable('digesttime')" href="../../_variables/digesttime.html">$digesttime</a> = <a class="function" onClick="logFunction('usergetmidnight')" href="../../_functions/usergetmidnight.html" onMouseOver="funcPopup(event,'usergetmidnight')">usergetmidnight</a>(<a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>, <a class="var it11918" onMouseOver="hilite(11918)" onMouseOut="lolite()" onClick="logVariable('sitetimezone')" href="../../_variables/sitetimezone.html">$sitetimezone</a>) + (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('digestmailtime')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/digestmailtime.html">digestmailtime</a> * 3600);
<a name="l926"><span class="linenum"> 926</span></a>  
<a name="l927"><span class="linenum"> 927</span></a>  <span class="comment">    // Delete any really old ones (normally there shouldn't be any)</span>
<a name="l928"><span class="linenum"> 928</span></a>      <a class="var it41504" onMouseOver="hilite(41504)" onMouseOut="lolite()" onClick="logVariable('weekago')" href="../../_variables/weekago.html">$weekago</a> = <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a> - (7 * 24 * 3600);
<a name="l929"><span class="linenum"> 929</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_queue', &quot;timemodified &lt; ?&quot;, array(<a class="var it41504" onMouseOver="hilite(41504)" onMouseOut="lolite()" onClick="logVariable('weekago')" href="../../_variables/weekago.html">$weekago</a>));
<a name="l930"><span class="linenum"> 930</span></a>      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a> ('Cleaned old digest records');
<a name="l931"><span class="linenum"> 931</span></a>  
<a name="l932"><span class="linenum"> 932</span></a>      if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('digestmailtimelast')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/digestmailtimelast.html">digestmailtimelast</a> &lt; <a class="var it36709" onMouseOver="hilite(36709)" onMouseOut="lolite()" onClick="logVariable('digesttime')" href="../../_variables/digesttime.html">$digesttime</a> and <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a> &gt; <a class="var it36709" onMouseOver="hilite(36709)" onMouseOut="lolite()" onClick="logVariable('digesttime')" href="../../_variables/digesttime.html">$digesttime</a>) {
<a name="l933"><span class="linenum"> 933</span></a>  
<a name="l934"><span class="linenum"> 934</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Sending forum digests: '.<a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>, '', <a class="var it11918" onMouseOver="hilite(11918)" onMouseOut="lolite()" onClick="logVariable('sitetimezone')" href="../../_variables/sitetimezone.html">$sitetimezone</a>));
<a name="l935"><span class="linenum"> 935</span></a>  
<a name="l936"><span class="linenum"> 936</span></a>          <a class="var it41505" onMouseOver="hilite(41505)" onMouseOut="lolite()" onClick="logVariable('digestposts_rs')" href="../../_variables/digestposts_rs.html">$digestposts_rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_select')" href="../../_functions/get_recordset_select.html" onMouseOver="funcPopup(event,'get_recordset_select')">get_recordset_select</a>('forum_queue', &quot;timemodified &lt; ?&quot;, array(<a class="var it36709" onMouseOver="hilite(36709)" onMouseOut="lolite()" onClick="logVariable('digesttime')" href="../../_variables/digesttime.html">$digesttime</a>));
<a name="l937"><span class="linenum"> 937</span></a>  
<a name="l938"><span class="linenum"> 938</span></a>          if (<a class="var it41505" onMouseOver="hilite(41505)" onMouseOut="lolite()" onClick="logVariable('digestposts_rs')" href="../../_variables/digestposts_rs.html">$digestposts_rs</a>-&gt;<a class="function" onClick="logFunction('valid')" href="../../_functions/valid.html" onMouseOver="funcPopup(event,'valid')">valid</a>()) {
<a name="l939"><span class="linenum"> 939</span></a>  
<a name="l940"><span class="linenum"> 940</span></a>  <span class="comment">            // We have work to do</span>
<a name="l941"><span class="linenum"> 941</span></a>              <a class="var it41506" onMouseOver="hilite(41506)" onMouseOut="lolite()" onClick="logVariable('usermailcount')" href="../../_variables/usermailcount.html">$usermailcount</a> = 0;
<a name="l942"><span class="linenum"> 942</span></a>  
<a name="l943"><span class="linenum"> 943</span></a>  <span class="comment">            //caches - reuse the those filled before too</span>
<a name="l944"><span class="linenum"> 944</span></a>              <a class="var it41507" onMouseOver="hilite(41507)" onMouseOut="lolite()" onClick="logVariable('discussionposts')" href="../../_variables/discussionposts.html">$discussionposts</a> = array();
<a name="l945"><span class="linenum"> 945</span></a>              <a class="var it41508" onMouseOver="hilite(41508)" onMouseOut="lolite()" onClick="logVariable('userdiscussions')" href="../../_variables/userdiscussions.html">$userdiscussions</a> = array();
<a name="l946"><span class="linenum"> 946</span></a>  
<a name="l947"><span class="linenum"> 947</span></a>              foreach (<a class="var it41505" onMouseOver="hilite(41505)" onMouseOut="lolite()" onClick="logVariable('digestposts_rs')" href="../../_variables/digestposts_rs.html">$digestposts_rs</a> as <a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>) {
<a name="l948"><span class="linenum"> 948</span></a>                  if (!isset(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('postid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/postid.html">postid</a>])) {
<a name="l949"><span class="linenum"> 949</span></a>                      if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_posts', array('id' =&gt; <a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('postid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/postid.html">postid</a>))) {
<a name="l950"><span class="linenum"> 950</span></a>                          <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('postid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/postid.html">postid</a>] = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>;
<a name="l951"><span class="linenum"> 951</span></a>                      } else {
<a name="l952"><span class="linenum"> 952</span></a>                          continue;
<a name="l953"><span class="linenum"> 953</span></a>                      }
<a name="l954"><span class="linenum"> 954</span></a>                  }
<a name="l955"><span class="linenum"> 955</span></a>                  <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a> = <a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('discussionid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/discussionid.html">discussionid</a>;
<a name="l956"><span class="linenum"> 956</span></a>                  if (!isset(<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>])) {
<a name="l957"><span class="linenum"> 957</span></a>                      if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('id' =&gt; <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>))) {
<a name="l958"><span class="linenum"> 958</span></a>                          <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>;
<a name="l959"><span class="linenum"> 959</span></a>                      } else {
<a name="l960"><span class="linenum"> 960</span></a>                          continue;
<a name="l961"><span class="linenum"> 961</span></a>                      }
<a name="l962"><span class="linenum"> 962</span></a>                  }
<a name="l963"><span class="linenum"> 963</span></a>                  <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a> = <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>]-&gt;forum;
<a name="l964"><span class="linenum"> 964</span></a>                  if (!isset(<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>])) {
<a name="l965"><span class="linenum"> 965</span></a>                      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>))) {
<a name="l966"><span class="linenum"> 966</span></a>                          <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>;
<a name="l967"><span class="linenum"> 967</span></a>                      } else {
<a name="l968"><span class="linenum"> 968</span></a>                          continue;
<a name="l969"><span class="linenum"> 969</span></a>                      }
<a name="l970"><span class="linenum"> 970</span></a>                  }
<a name="l971"><span class="linenum"> 971</span></a>  
<a name="l972"><span class="linenum"> 972</span></a>                  <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>]-&gt;course;
<a name="l973"><span class="linenum"> 973</span></a>                  if (!isset(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>[<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>])) {
<a name="l974"><span class="linenum"> 974</span></a>                      if (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>))) {
<a name="l975"><span class="linenum"> 975</span></a>                          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>[<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>] = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>;
<a name="l976"><span class="linenum"> 976</span></a>                      } else {
<a name="l977"><span class="linenum"> 977</span></a>                          continue;
<a name="l978"><span class="linenum"> 978</span></a>                      }
<a name="l979"><span class="linenum"> 979</span></a>                  }
<a name="l980"><span class="linenum"> 980</span></a>  
<a name="l981"><span class="linenum"> 981</span></a>                  if (!isset(<a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>])) {
<a name="l982"><span class="linenum"> 982</span></a>                      if (<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l983"><span class="linenum"> 983</span></a>                          <a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>] = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>;
<a name="l984"><span class="linenum"> 984</span></a>                      } else {
<a name="l985"><span class="linenum"> 985</span></a>                          continue;
<a name="l986"><span class="linenum"> 986</span></a>                      }
<a name="l987"><span class="linenum"> 987</span></a>                  }
<a name="l988"><span class="linenum"> 988</span></a>                  <a class="var it41508" onMouseOver="hilite(41508)" onMouseOut="lolite()" onClick="logVariable('userdiscussions')" href="../../_variables/userdiscussions.html">$userdiscussions</a>[<a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('userid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>][<a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('discussionid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/discussionid.html">discussionid</a>] = <a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('discussionid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/discussionid.html">discussionid</a>;
<a name="l989"><span class="linenum"> 989</span></a>                  <a class="var it41507" onMouseOver="hilite(41507)" onMouseOut="lolite()" onClick="logVariable('discussionposts')" href="../../_variables/discussionposts.html">$discussionposts</a>[<a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('discussionid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/discussionid.html">discussionid</a>][<a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('postid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/postid.html">postid</a>] = <a class="var it41509" onMouseOver="hilite(41509)" onMouseOut="lolite()" onClick="logVariable('digestpost')" href="../../_variables/digestpost.html">$digestpost</a>-&gt;<a onClick="logVariable('postid')" class="var it44618" onMouseOver="hilite(44618)" onMouseOut="lolite()" href="../../_variables/postid.html">postid</a>;
<a name="l990"><span class="linenum"> 990</span></a>              }
<a name="l991"><span class="linenum"> 991</span></a>              <a class="var it41505" onMouseOver="hilite(41505)" onMouseOut="lolite()" onClick="logVariable('digestposts_rs')" href="../../_variables/digestposts_rs.html">$digestposts_rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>(); <span class="comment">/// Finished iteration, let's close the resultset</span>
<a name="l992"><span class="linenum"> 992</span></a>  
<a name="l993"><span class="linenum"> 993</span></a>  <span class="comment">            // Data collected, start sending out emails to each user</span>
<a name="l994"><span class="linenum"> 994</span></a>              foreach (<a class="var it41508" onMouseOver="hilite(41508)" onMouseOut="lolite()" onClick="logVariable('userdiscussions')" href="../../_variables/userdiscussions.html">$userdiscussions</a> as <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> =&gt; <a class="var it41510" onMouseOver="hilite(41510)" onMouseOut="lolite()" onClick="logVariable('thesediscussions')" href="../../_variables/thesediscussions.html">$thesediscussions</a>) {
<a name="l995"><span class="linenum"> 995</span></a>  
<a name="l996"><span class="linenum"> 996</span></a>                  <a class="class" onClick="logClass('core_php_time_limit')" href="../../_classes/core_php_time_limit.html" onMouseOver="classPopup(event,'core_php_time_limit')">core_php_time_limit</a>::<a class="function" onClick="logFunction('raise')" href="../../_functions/raise.html" onMouseOver="funcPopup(event,'raise')">raise</a>(120); <span class="comment">// terminate if processing of any account takes longer than 2 minutes</span>
<a name="l997"><span class="linenum"> 997</span></a>  
<a name="l998"><span class="linenum"> 998</span></a>                  <a class="function" onClick="logFunction('cron_setup_user')" href="../../_functions/cron_setup_user.html" onMouseOver="funcPopup(event,'cron_setup_user')">cron_setup_user</a>();
<a name="l999"><span class="linenum"> 999</span></a>  
<a name="l1000"><span class="linenum">1000</span></a>                  <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('processingdigest', 'forum', <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>), '... ');
<a name="l1001"><span class="linenum">1001</span></a>  
<a name="l1002"><span class="linenum">1002</span></a>  <span class="comment">                // First of all delete all the queue entries for this user</span>
<a name="l1003"><span class="linenum">1003</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_queue', &quot;userid = ? AND timemodified &lt; ?&quot;, array(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it36709" onMouseOver="hilite(36709)" onMouseOut="lolite()" onClick="logVariable('digesttime')" href="../../_variables/digesttime.html">$digesttime</a>));
<a name="l1004"><span class="linenum">1004</span></a>  
<a name="l1005"><span class="linenum">1005</span></a>  <span class="comment">                // Init user caches - we keep the cache for one cycle only,</span>
<a name="l1006"><span class="linenum">1006</span></a>  <span class="comment">                // otherwise it would unnecessarily consume memory.</span>
<a name="l1007"><span class="linenum">1007</span></a>                  if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>) and isset(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>]-&gt;username)) {
<a name="l1008"><span class="linenum">1008</span></a>                      <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>]);
<a name="l1009"><span class="linenum">1009</span></a>                  } else {
<a name="l1010"><span class="linenum">1010</span></a>                      <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>));
<a name="l1011"><span class="linenum">1011</span></a>                      <a class="function" onClick="logFunction('forum_cron_minimise_user_record')" href="../../_functions/forum_cron_minimise_user_record.html" onMouseOver="funcPopup(event,'forum_cron_minimise_user_record')">forum_cron_minimise_user_record</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>);
<a name="l1012"><span class="linenum">1012</span></a>                  }
<a name="l1013"><span class="linenum">1013</span></a>                  <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a> = array();
<a name="l1014"><span class="linenum">1014</span></a>                  <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>       = array();
<a name="l1015"><span class="linenum">1015</span></a>                  <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('markposts')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/markposts.html">markposts</a>     = array();
<a name="l1016"><span class="linenum">1016</span></a>  
<a name="l1017"><span class="linenum">1017</span></a>  <span class="comment">                // Override the language and timezone of the &quot;current&quot; user, so that</span>
<a name="l1018"><span class="linenum">1018</span></a>  <span class="comment">                // mail is customised for the receiver.</span>
<a name="l1019"><span class="linenum">1019</span></a>                  <a class="function" onClick="logFunction('cron_setup_user')" href="../../_functions/cron_setup_user.html" onMouseOver="funcPopup(event,'cron_setup_user')">cron_setup_user</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>);
<a name="l1020"><span class="linenum">1020</span></a>  
<a name="l1021"><span class="linenum">1021</span></a>                  <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('postsubject')" href="../../_variables/postsubject.html">$postsubject</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('digestmailsubject', 'forum', <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('shortname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>, true));
<a name="l1022"><span class="linenum">1022</span></a>  
<a name="l1023"><span class="linenum">1023</span></a>                  <a class="var it16918" onMouseOver="hilite(16918)" onMouseOut="lolite()" onClick="logVariable('headerdata')" href="../../_variables/headerdata.html">$headerdata</a> = new stdClass();
<a name="l1024"><span class="linenum">1024</span></a>                  <a class="var it16918" onMouseOver="hilite(16918)" onMouseOut="lolite()" onClick="logVariable('headerdata')" href="../../_variables/headerdata.html">$headerdata</a>-&gt;<a onClick="logVariable('sitename')" class="var it44619" onMouseOver="hilite(44619)" onMouseOut="lolite()" href="../../_variables/sitename.html">sitename</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('fullname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>, true);
<a name="l1025"><span class="linenum">1025</span></a>                  <a class="var it16918" onMouseOver="hilite(16918)" onMouseOut="lolite()" onClick="logVariable('headerdata')" href="../../_variables/headerdata.html">$headerdata</a>-&gt;<a onClick="logVariable('userprefs')" class="var it44619" onMouseOver="hilite(44619)" onMouseOut="lolite()" href="../../_variables/userprefs.html">userprefs</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/user/forum.php?id='.<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>.'&amp;amp;course='.<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('id')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1026"><span class="linenum">1026</span></a>  
<a name="l1027"><span class="linenum">1027</span></a>                  <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('digestmailheader', 'forum', <a class="var it16918" onMouseOver="hilite(16918)" onMouseOut="lolite()" onClick="logVariable('headerdata')" href="../../_variables/headerdata.html">$headerdata</a>).&quot;\n\n&quot;;
<a name="l1028"><span class="linenum">1028</span></a>                  <a class="var it16918" onMouseOver="hilite(16918)" onMouseOut="lolite()" onClick="logVariable('headerdata')" href="../../_variables/headerdata.html">$headerdata</a>-&gt;<a onClick="logVariable('userprefs')" class="var it44619" onMouseOver="hilite(44619)" onMouseOut="lolite()" href="../../_variables/userprefs.html">userprefs</a> = '&lt;a target=&quot;_blank&quot; href=&quot;'.<a class="var it16918" onMouseOver="hilite(16918)" onMouseOut="lolite()" onClick="logVariable('headerdata')" href="../../_variables/headerdata.html">$headerdata</a>-&gt;<a onClick="logVariable('userprefs')" class="var it44619" onMouseOver="hilite(44619)" onMouseOut="lolite()" href="../../_variables/userprefs.html">userprefs</a>.'&quot;&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('digestmailprefs', 'forum').'&lt;/a&gt;';
<a name="l1029"><span class="linenum">1029</span></a>  
<a name="l1030"><span class="linenum">1030</span></a>                  <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> = '&lt;p&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('digestmailheader', 'forum', <a class="var it16918" onMouseOver="hilite(16918)" onMouseOut="lolite()" onClick="logVariable('headerdata')" href="../../_variables/headerdata.html">$headerdata</a>).'&lt;/p&gt;'
<a name="l1031"><span class="linenum">1031</span></a>                      . '&lt;br /&gt;&lt;hr size=&quot;1&quot; noshade=&quot;noshade&quot; /&gt;';
<a name="l1032"><span class="linenum">1032</span></a>  
<a name="l1033"><span class="linenum">1033</span></a>                  foreach (<a class="var it41510" onMouseOver="hilite(41510)" onMouseOut="lolite()" onClick="logVariable('thesediscussions')" href="../../_variables/thesediscussions.html">$thesediscussions</a> as <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>) {
<a name="l1034"><span class="linenum">1034</span></a>  
<a name="l1035"><span class="linenum">1035</span></a>                      <a class="class" onClick="logClass('core_php_time_limit')" href="../../_classes/core_php_time_limit.html" onMouseOver="classPopup(event,'core_php_time_limit')">core_php_time_limit</a>::<a class="function" onClick="logFunction('raise')" href="../../_functions/raise.html" onMouseOver="funcPopup(event,'raise')">raise</a>(120);   <span class="comment">// to be reset for each post</span>
<a name="l1036"><span class="linenum">1036</span></a>  
<a name="l1037"><span class="linenum">1037</span></a>                      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>];
<a name="l1038"><span class="linenum">1038</span></a>                      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>      = <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>];
<a name="l1039"><span class="linenum">1039</span></a>                      <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>     = <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>];
<a name="l1040"><span class="linenum">1040</span></a>                      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>         = <a class="var it26554" onMouseOver="hilite(26554)" onMouseOut="lolite()" onClick="logVariable('coursemodules')" href="../../_variables/coursemodules.html">$coursemodules</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l1041"><span class="linenum">1041</span></a>  
<a name="l1042"><span class="linenum">1042</span></a>  <span class="comment">                    //override language</span>
<a name="l1043"><span class="linenum">1043</span></a>                      <a class="function" onClick="logFunction('cron_setup_user')" href="../../_functions/cron_setup_user.html" onMouseOver="funcPopup(event,'cron_setup_user')">cron_setup_user</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l1044"><span class="linenum">1044</span></a>  
<a name="l1045"><span class="linenum">1045</span></a>  <span class="comment">                    // Fill caches</span>
<a name="l1046"><span class="linenum">1046</span></a>                      if (!isset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l1047"><span class="linenum">1047</span></a>                          <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1048"><span class="linenum">1048</span></a>                          <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l1049"><span class="linenum">1049</span></a>                      }
<a name="l1050"><span class="linenum">1050</span></a>                      if (!isset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l1051"><span class="linenum">1051</span></a>                          <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1052"><span class="linenum">1052</span></a>                          <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="function" onClick="logFunction('forum_user_can_post')" href="../../_functions/forum_user_can_post.html" onMouseOver="funcPopup(event,'forum_user_can_post')">forum_user_can_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l1053"><span class="linenum">1053</span></a>                      }
<a name="l1054"><span class="linenum">1054</span></a>  
<a name="l1055"><span class="linenum">1055</span></a>                      <a class="var it7882" onMouseOver="hilite(7882)" onMouseOut="lolite()" onClick="logVariable('strforums')" href="../../_variables/strforums.html">$strforums</a>      = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('forums', 'forum');
<a name="l1056"><span class="linenum">1056</span></a>                      <a class="var it41511" onMouseOver="hilite(41511)" onMouseOut="lolite()" onClick="logVariable('canunsubscribe')" href="../../_variables/canunsubscribe.html">$canunsubscribe</a> = ! \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_forcesubscribed')" href="../../_functions/is_forcesubscribed.html" onMouseOver="funcPopup(event,'is_forcesubscribed')">is_forcesubscribed</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l1057"><span class="linenum">1057</span></a>                      <a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a>       = <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l1058"><span class="linenum">1058</span></a>                      <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../_variables/shortname.html">$shortname</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)));
<a name="l1059"><span class="linenum">1059</span></a>  
<a name="l1060"><span class="linenum">1060</span></a>                      <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> .= &quot;\n \n&quot;;
<a name="l1061"><span class="linenum">1061</span></a>                      <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> .= '=====================================================================';
<a name="l1062"><span class="linenum">1062</span></a>                      <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> .= &quot;\n \n&quot;;
<a name="l1063"><span class="linenum">1063</span></a>                      <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> .= &quot;<a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../_variables/shortname.html">$shortname</a> -&gt; <a class="var it7882" onMouseOver="hilite(7882)" onMouseOut="lolite()" onClick="logVariable('strforums')" href="../../_variables/strforums.html">$strforums</a> -&gt; &quot;.<a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>,true);
<a name="l1064"><span class="linenum">1064</span></a>                      if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> != <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>) {
<a name="l1065"><span class="linenum">1065</span></a>                          <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a>  .= &quot; -&gt; &quot;.<a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>,true);
<a name="l1066"><span class="linenum">1066</span></a>                      }
<a name="l1067"><span class="linenum">1067</span></a>                      <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> .= &quot;\n&quot;;
<a name="l1068"><span class="linenum">1068</span></a>                      <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> .= <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/discuss.php?d='.<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1069"><span class="linenum">1069</span></a>                      <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> .= &quot;\n&quot;;
<a name="l1070"><span class="linenum">1070</span></a>  
<a name="l1071"><span class="linenum">1071</span></a>                      <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> .= &quot;&lt;p&gt;&lt;font face=\&quot;sans-serif\&quot;&gt;&quot;.
<a name="l1072"><span class="linenum">1072</span></a>                      &quot;&lt;a target=\&quot;_blank\&quot; href=\&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/course/view.php?id=<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>\&quot;&gt;<a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../_variables/shortname.html">$shortname</a>&lt;/a&gt; -&gt; &quot;.
<a name="l1073"><span class="linenum">1073</span></a>                      &quot;&lt;a target=\&quot;_blank\&quot; href=\&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/mod/forum/index.php?id=<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>\&quot;&gt;<a class="var it7882" onMouseOver="hilite(7882)" onMouseOut="lolite()" onClick="logVariable('strforums')" href="../../_variables/strforums.html">$strforums</a>&lt;/a&gt; -&gt; &quot;.
<a name="l1074"><span class="linenum">1074</span></a>                      &quot;&lt;a target=\&quot;_blank\&quot; href=\&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/mod/forum/view.php?f=<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>\&quot;&gt;&quot;.<a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>,true).&quot;&lt;/a&gt;&quot;;
<a name="l1075"><span class="linenum">1075</span></a>                      if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> == <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>) {
<a name="l1076"><span class="linenum">1076</span></a>                          <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> .= &quot;&lt;/font&gt;&lt;/p&gt;&quot;;
<a name="l1077"><span class="linenum">1077</span></a>                      } else {
<a name="l1078"><span class="linenum">1078</span></a>                          <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> .= &quot; -&gt; &lt;a target=\&quot;_blank\&quot; href=\&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/mod/forum/discuss.php?d=<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>\&quot;&gt;&quot;.<a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>,true).&quot;&lt;/a&gt;&lt;/font&gt;&lt;/p&gt;&quot;;
<a name="l1079"><span class="linenum">1079</span></a>                      }
<a name="l1080"><span class="linenum">1080</span></a>                      <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> .= '&lt;p&gt;';
<a name="l1081"><span class="linenum">1081</span></a>  
<a name="l1082"><span class="linenum">1082</span></a>                      <a class="var it41512" onMouseOver="hilite(41512)" onMouseOut="lolite()" onClick="logVariable('postsarray')" href="../../_variables/postsarray.html">$postsarray</a> = <a class="var it41507" onMouseOver="hilite(41507)" onMouseOut="lolite()" onClick="logVariable('discussionposts')" href="../../_variables/discussionposts.html">$discussionposts</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>];
<a name="l1083"><span class="linenum">1083</span></a>                      <a class="phpfunction" onClick="logFunction('sort')" href="../../_functions/sort.html" onMouseOver="phpfuncPopup(event,'sort')">sort</a>(<a class="var it41512" onMouseOver="hilite(41512)" onMouseOut="lolite()" onClick="logVariable('postsarray')" href="../../_variables/postsarray.html">$postsarray</a>);
<a name="l1084"><span class="linenum">1084</span></a>                      <a class="var it41513" onMouseOver="hilite(41513)" onMouseOut="lolite()" onClick="logVariable('sentcount')" href="../../_variables/sentcount.html">$sentcount</a> = 0;
<a name="l1085"><span class="linenum">1085</span></a>  
<a name="l1086"><span class="linenum">1086</span></a>                      foreach (<a class="var it41512" onMouseOver="hilite(41512)" onMouseOut="lolite()" onClick="logVariable('postsarray')" href="../../_variables/postsarray.html">$postsarray</a> as <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>) {
<a name="l1087"><span class="linenum">1087</span></a>                          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>];
<a name="l1088"><span class="linenum">1088</span></a>  
<a name="l1089"><span class="linenum">1089</span></a>                          if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>)) { // we might know him/her already
<a name="l1090"><span class="linenum">1090</span></a>                              <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a> = <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>];
<a name="l1091"><span class="linenum">1091</span></a>                              if (!isset(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('idnumber')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>)) {
<a name="l1092"><span class="linenum">1092</span></a>                                  <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1093"><span class="linenum">1093</span></a>                                  <a class="function" onClick="logFunction('forum_cron_minimise_user_record')" href="../../_functions/forum_cron_minimise_user_record.html" onMouseOver="funcPopup(event,'forum_cron_minimise_user_record')">forum_cron_minimise_user_record</a>(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>);
<a name="l1094"><span class="linenum">1094</span></a>                              }
<a name="l1095"><span class="linenum">1095</span></a>  
<a name="l1096"><span class="linenum">1096</span></a>                          } else if (<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>))) {
<a name="l1097"><span class="linenum">1097</span></a>                              <a class="function" onClick="logFunction('forum_cron_minimise_user_record')" href="../../_functions/forum_cron_minimise_user_record.html" onMouseOver="funcPopup(event,'forum_cron_minimise_user_record')">forum_cron_minimise_user_record</a>(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>);
<a name="l1098"><span class="linenum">1098</span></a>                              if (<a class="var it41486" onMouseOver="hilite(41486)" onMouseOut="lolite()" onClick="logVariable('userscount')" href="../../_variables/userscount.html">$userscount</a> &lt;= <a class="constant" onClick="logConstant('FORUM_CRON_USER_CACHE')" href="../../_constants/FORUM_CRON_USER_CACHE.html" onMouseOver="constPopup(event,'FORUM_CRON_USER_CACHE')">FORUM_CRON_USER_CACHE</a>) {
<a name="l1099"><span class="linenum">1099</span></a>                                  <a class="var it41486" onMouseOver="hilite(41486)" onMouseOut="lolite()" onClick="logVariable('userscount')" href="../../_variables/userscount.html">$userscount</a>++;
<a name="l1100"><span class="linenum">1100</span></a>                                  <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>;
<a name="l1101"><span class="linenum">1101</span></a>                              }
<a name="l1102"><span class="linenum">1102</span></a>  
<a name="l1103"><span class="linenum">1103</span></a>                          } else {
<a name="l1104"><span class="linenum">1104</span></a>                              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Could not find user '.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l1105"><span class="linenum">1105</span></a>                              continue;
<a name="l1106"><span class="linenum">1106</span></a>                          }
<a name="l1107"><span class="linenum">1107</span></a>  
<a name="l1108"><span class="linenum">1108</span></a>                          if (!isset(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l1109"><span class="linenum">1109</span></a>                              if (!isset(<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a>)) {
<a name="l1110"><span class="linenum">1110</span></a>                                  <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a> = array();
<a name="l1111"><span class="linenum">1111</span></a>                                  if (isset(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l1112"><span class="linenum">1112</span></a>                                      <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;groups = array();
<a name="l1113"><span class="linenum">1113</span></a>                                  }
<a name="l1114"><span class="linenum">1114</span></a>                              }
<a name="l1115"><span class="linenum">1115</span></a>                              <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="function" onClick="logFunction('groups_get_all_groups')" href="../../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>);
<a name="l1116"><span class="linenum">1116</span></a>                              if (isset(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l1117"><span class="linenum">1117</span></a>                                  <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;groups[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('groups')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l1118"><span class="linenum">1118</span></a>                              }
<a name="l1119"><span class="linenum">1119</span></a>                          }
<a name="l1120"><span class="linenum">1120</span></a>  
<a name="l1121"><span class="linenum">1121</span></a>  <span class="comment">                        // Headers to help prevent auto-responders.</span>
<a name="l1122"><span class="linenum">1122</span></a>                          <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('customheaders')" class="var it43355" onMouseOver="hilite(43355)" onMouseOut="lolite()" href="../../_variables/customheaders.html">customheaders</a> = array(
<a name="l1123"><span class="linenum">1123</span></a>                                  &quot;Precedence: Bulk&quot;,
<a name="l1124"><span class="linenum">1124</span></a>                                  'X-Auto-Response-Suppress: All',
<a name="l1125"><span class="linenum">1125</span></a>                                  'Auto-Submitted: auto-generated',
<a name="l1126"><span class="linenum">1126</span></a>                              );
<a name="l1127"><span class="linenum">1127</span></a>  
<a name="l1128"><span class="linenum">1128</span></a>                          <a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> = <a class="function" onClick="logFunction('forum_get_user_maildigest_bulk')" href="../../_functions/forum_get_user_maildigest_bulk.html" onMouseOver="funcPopup(event,'forum_get_user_maildigest_bulk')">forum_get_user_maildigest_bulk</a>(<a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1129"><span class="linenum">1129</span></a>                          if (!isset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l1130"><span class="linenum">1130</span></a>                              <a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a> = <a class="function" onClick="logFunction('forum_user_can_post')" href="../../_functions/forum_user_can_post.html" onMouseOver="funcPopup(event,'forum_user_can_post')">forum_user_can_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l1131"><span class="linenum">1131</span></a>                          } else {
<a name="l1132"><span class="linenum">1132</span></a>                              <a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a> = <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('canpost')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l1133"><span class="linenum">1133</span></a>                          }
<a name="l1134"><span class="linenum">1134</span></a>  
<a name="l1135"><span class="linenum">1135</span></a>                          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = new \mod_forum\output\forum_post_email(
<a name="l1136"><span class="linenum">1136</span></a>                                  <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>,
<a name="l1137"><span class="linenum">1137</span></a>                                  <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>,
<a name="l1138"><span class="linenum">1138</span></a>                                  <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>,
<a name="l1139"><span class="linenum">1139</span></a>                                  <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>,
<a name="l1140"><span class="linenum">1140</span></a>                                  <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>,
<a name="l1141"><span class="linenum">1141</span></a>                                  <a class="var it6660" onMouseOver="hilite(6660)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../../_variables/userfrom.html">$userfrom</a>,
<a name="l1142"><span class="linenum">1142</span></a>                                  <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>,
<a name="l1143"><span class="linenum">1143</span></a>                                  <a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a>
<a name="l1144"><span class="linenum">1144</span></a>                              );
<a name="l1145"><span class="linenum">1145</span></a>  
<a name="l1146"><span class="linenum">1146</span></a>                          if (!isset(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l1147"><span class="linenum">1147</span></a>                              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a> = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1148"><span class="linenum">1148</span></a>                          } else {
<a name="l1149"><span class="linenum">1149</span></a>                              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a> = <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('viewfullnames')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/viewfullnames.html">viewfullnames</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l1150"><span class="linenum">1150</span></a>                          }
<a name="l1151"><span class="linenum">1151</span></a>  
<a name="l1152"><span class="linenum">1152</span></a>                          if (<a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> == 2) {
<a name="l1153"><span class="linenum">1153</span></a>  <span class="comment">                            // Subjects and link only.</span>
<a name="l1154"><span class="linenum">1154</span></a>                              <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> .= <a class="var it41485" onMouseOver="hilite(41485)" onMouseOut="lolite()" onClick="logVariable('textdigestbasicout')" href="../../_variables/textdigestbasicout.html">$textdigestbasicout</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l1155"><span class="linenum">1155</span></a>                              <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> .= <a class="var it41484" onMouseOver="hilite(41484)" onMouseOut="lolite()" onClick="logVariable('htmldigestbasicout')" href="../../_variables/htmldigestbasicout.html">$htmldigestbasicout</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l1156"><span class="linenum">1156</span></a>                          } else {
<a name="l1157"><span class="linenum">1157</span></a>  <span class="comment">                            // The full treatment.</span>
<a name="l1158"><span class="linenum">1158</span></a>                              <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a> .= <a class="var it41483" onMouseOver="hilite(41483)" onMouseOut="lolite()" onClick="logVariable('textdigestfullout')" href="../../_variables/textdigestfullout.html">$textdigestfullout</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l1159"><span class="linenum">1159</span></a>                              <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> .= <a class="var it41482" onMouseOver="hilite(41482)" onMouseOut="lolite()" onClick="logVariable('htmldigestfullout')" href="../../_variables/htmldigestfullout.html">$htmldigestfullout</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l1160"><span class="linenum">1160</span></a>  
<a name="l1161"><span class="linenum">1161</span></a>  <span class="comment">                            // Create an array of postid's for this user to mark as read.</span>
<a name="l1162"><span class="linenum">1162</span></a>                              if (!<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_usermarksread')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_usermarksread.html">forum_usermarksread</a>) {
<a name="l1163"><span class="linenum">1163</span></a>                                  <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('markposts')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/markposts.html">markposts</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1164"><span class="linenum">1164</span></a>                              }
<a name="l1165"><span class="linenum">1165</span></a>                          }
<a name="l1166"><span class="linenum">1166</span></a>                          <a class="var it41513" onMouseOver="hilite(41513)" onMouseOut="lolite()" onClick="logVariable('sentcount')" href="../../_variables/sentcount.html">$sentcount</a>++;
<a name="l1167"><span class="linenum">1167</span></a>                      }
<a name="l1168"><span class="linenum">1168</span></a>                      <a class="var it41514" onMouseOver="hilite(41514)" onMouseOut="lolite()" onClick="logVariable('footerlinks')" href="../../_variables/footerlinks.html">$footerlinks</a> = array();
<a name="l1169"><span class="linenum">1169</span></a>                      if (<a class="var it41511" onMouseOver="hilite(41511)" onMouseOut="lolite()" onClick="logVariable('canunsubscribe')" href="../../_variables/canunsubscribe.html">$canunsubscribe</a>) {
<a name="l1170"><span class="linenum">1170</span></a>                          <a class="var it41514" onMouseOver="hilite(41514)" onMouseOut="lolite()" onClick="logVariable('footerlinks')" href="../../_variables/footerlinks.html">$footerlinks</a>[] = &quot;&lt;a href=\&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/mod/forum/subscribe.php?id=<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>\&quot;&gt;&quot; . <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;unsubscribe&quot;, &quot;forum&quot;) . &quot;&lt;/a&gt;&quot;;
<a name="l1171"><span class="linenum">1171</span></a>                      } else {
<a name="l1172"><span class="linenum">1172</span></a>                          <a class="var it41514" onMouseOver="hilite(41514)" onMouseOut="lolite()" onClick="logVariable('footerlinks')" href="../../_variables/footerlinks.html">$footerlinks</a>[] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;everyoneissubscribed&quot;, &quot;forum&quot;);
<a name="l1173"><span class="linenum">1173</span></a>                      }
<a name="l1174"><span class="linenum">1174</span></a>                      <a class="var it41514" onMouseOver="hilite(41514)" onMouseOut="lolite()" onClick="logVariable('footerlinks')" href="../../_variables/footerlinks.html">$footerlinks</a>[] = &quot;&lt;a href='{<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>}/mod/forum/index.php?id={<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>}'&gt;&quot; . <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;digestmailpost&quot;, &quot;forum&quot;) . '&lt;/a&gt;';
<a name="l1175"><span class="linenum">1175</span></a>                      <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> .= &quot;\n&lt;div class='mdl-right'&gt;&lt;font size=\&quot;1\&quot;&gt;&quot; . <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('&amp;nbsp;', <a class="var it41514" onMouseOver="hilite(41514)" onMouseOut="lolite()" onClick="logVariable('footerlinks')" href="../../_variables/footerlinks.html">$footerlinks</a>) . '&lt;/font&gt;&lt;/div&gt;';
<a name="l1176"><span class="linenum">1176</span></a>                      <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> .= '&lt;hr size=&quot;1&quot; noshade=&quot;noshade&quot; /&gt;&lt;/p&gt;';
<a name="l1177"><span class="linenum">1177</span></a>                  }
<a name="l1178"><span class="linenum">1178</span></a>  
<a name="l1179"><span class="linenum">1179</span></a>                  if (empty(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('mailformat')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/mailformat.html">mailformat</a>) || <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('mailformat')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/mailformat.html">mailformat</a> != 1) {
<a name="l1180"><span class="linenum">1180</span></a>  <span class="comment">                    // This user DOESN'T want to receive HTML</span>
<a name="l1181"><span class="linenum">1181</span></a>                      <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a> = '';
<a name="l1182"><span class="linenum">1182</span></a>                  }
<a name="l1183"><span class="linenum">1183</span></a>  
<a name="l1184"><span class="linenum">1184</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a> = new \core\message\<a class="function" onClick="logFunction('message')" href="../../_functions/message.html" onMouseOver="funcPopup(event,'message')">message</a>();
<a name="l1185"><span class="linenum">1185</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('component')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>           = 'mod_forum';
<a name="l1186"><span class="linenum">1186</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('name')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>                = 'digests';
<a name="l1187"><span class="linenum">1187</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userfrom.html">userfrom</a>            = <a class="class" onClick="logClass('core_user')" href="../../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('get_noreply_user')" href="../../_functions/get_noreply_user.html" onMouseOver="funcPopup(event,'get_noreply_user')">get_noreply_user</a>();
<a name="l1188"><span class="linenum">1188</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userto.html">userto</a>              = <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>;
<a name="l1189"><span class="linenum">1189</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('subject')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>             = <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('postsubject')" href="../../_variables/postsubject.html">$postsubject</a>;
<a name="l1190"><span class="linenum">1190</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessage.html">fullmessage</a>         = <a class="var it25780" onMouseOver="hilite(25780)" onMouseOut="lolite()" onClick="logVariable('posttext')" href="../../_variables/posttext.html">$posttext</a>;
<a name="l1191"><span class="linenum">1191</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessageformat.html">fullmessageformat</a>   = <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>;
<a name="l1192"><span class="linenum">1192</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessagehtml.html">fullmessagehtml</a>     = <a class="var it25781" onMouseOver="hilite(25781)" onMouseOut="lolite()" onClick="logVariable('posthtml')" href="../../_variables/posthtml.html">$posthtml</a>;
<a name="l1193"><span class="linenum">1193</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('notification')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/notification.html">notification</a>        = 1;
<a name="l1194"><span class="linenum">1194</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/smallmessage.html">smallmessage</a>        = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('smallmessagedigest', 'forum', <a class="var it41513" onMouseOver="hilite(41513)" onMouseOut="lolite()" onClick="logVariable('sentcount')" href="../../_variables/sentcount.html">$sentcount</a>);
<a name="l1195"><span class="linenum">1195</span></a>                  <a class="var it41503" onMouseOver="hilite(41503)" onMouseOut="lolite()" onClick="logVariable('mailresult')" href="../../_variables/mailresult.html">$mailresult</a> = <a class="function" onClick="logFunction('message_send')" href="../../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>);
<a name="l1196"><span class="linenum">1196</span></a>  
<a name="l1197"><span class="linenum">1197</span></a>                  if (!<a class="var it41503" onMouseOver="hilite(41503)" onMouseOut="lolite()" onClick="logVariable('mailresult')" href="../../_variables/mailresult.html">$mailresult</a>) {
<a name="l1198"><span class="linenum">1198</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;ERROR: mod/forum/cron.php: Could not send out digest mail to user <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> &quot;.
<a name="l1199"><span class="linenum">1199</span></a>                          &quot;(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('email')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/email.html">email</a>)... not trying again.&quot;);
<a name="l1200"><span class="linenum">1200</span></a>                  } else {
<a name="l1201"><span class="linenum">1201</span></a>                      <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(&quot;success.&quot;);
<a name="l1202"><span class="linenum">1202</span></a>                      <a class="var it41506" onMouseOver="hilite(41506)" onMouseOut="lolite()" onClick="logVariable('usermailcount')" href="../../_variables/usermailcount.html">$usermailcount</a>++;
<a name="l1203"><span class="linenum">1203</span></a>  
<a name="l1204"><span class="linenum">1204</span></a>  <span class="comment">                    // Mark post as read if forum_usermarksread is set off</span>
<a name="l1205"><span class="linenum">1205</span></a>                      <a class="function" onClick="logFunction('forum_tp_mark_posts_read')" href="../../_functions/forum_tp_mark_posts_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_posts_read')">forum_tp_mark_posts_read</a>(<a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>, <a class="var it6922" onMouseOver="hilite(6922)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('markposts')" class="var it44088" onMouseOver="hilite(44088)" onMouseOut="lolite()" href="../../_variables/markposts.html">markposts</a>);
<a name="l1206"><span class="linenum">1206</span></a>                  }
<a name="l1207"><span class="linenum">1207</span></a>              }
<a name="l1208"><span class="linenum">1208</span></a>          }
<a name="l1209"><span class="linenum">1209</span></a>  <span class="comment">    /// We have finishied all digest emails, update $CFG-&gt;digestmailtimelast</span>
<a name="l1210"><span class="linenum">1210</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('digestmailtimelast', <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>);
<a name="l1211"><span class="linenum">1211</span></a>      }
<a name="l1212"><span class="linenum">1212</span></a>  
<a name="l1213"><span class="linenum">1213</span></a>      <a class="function" onClick="logFunction('cron_setup_user')" href="../../_functions/cron_setup_user.html" onMouseOver="funcPopup(event,'cron_setup_user')">cron_setup_user</a>();
<a name="l1214"><span class="linenum">1214</span></a>  
<a name="l1215"><span class="linenum">1215</span></a>      if (!empty(<a class="var it41506" onMouseOver="hilite(41506)" onMouseOut="lolite()" onClick="logVariable('usermailcount')" href="../../_variables/usermailcount.html">$usermailcount</a>)) {
<a name="l1216"><span class="linenum">1216</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('digestsentusers', 'forum', <a class="var it41506" onMouseOver="hilite(41506)" onMouseOut="lolite()" onClick="logVariable('usermailcount')" href="../../_variables/usermailcount.html">$usermailcount</a>));
<a name="l1217"><span class="linenum">1217</span></a>      }
<a name="l1218"><span class="linenum">1218</span></a>  
<a name="l1219"><span class="linenum">1219</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_lastreadclean')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_lastreadclean.html">forum_lastreadclean</a>)) {
<a name="l1220"><span class="linenum">1220</span></a>          <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1221"><span class="linenum">1221</span></a>          if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_lastreadclean')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_lastreadclean.html">forum_lastreadclean</a> + (24*3600) &lt; <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>) {
<a name="l1222"><span class="linenum">1222</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('forum_lastreadclean', <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>);
<a name="l1223"><span class="linenum">1223</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Removing old forum read tracking info...');
<a name="l1224"><span class="linenum">1224</span></a>              <a class="function" onClick="logFunction('forum_tp_clean_read_records')" href="../../_functions/forum_tp_clean_read_records.html" onMouseOver="funcPopup(event,'forum_tp_clean_read_records')">forum_tp_clean_read_records</a>();
<a name="l1225"><span class="linenum">1225</span></a>          }
<a name="l1226"><span class="linenum">1226</span></a>      } else {
<a name="l1227"><span class="linenum">1227</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('forum_lastreadclean', <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>());
<a name="l1228"><span class="linenum">1228</span></a>      }
<a name="l1229"><span class="linenum">1229</span></a>  
<a name="l1230"><span class="linenum">1230</span></a>      return true;
<a name="l1231"><span class="linenum">1231</span></a>  }
<a name="l1232"><span class="linenum">1232</span></a>  
<a name="l1233"><span class="linenum">1233</span></a>  <span class="comment">/**</span>
<a name="l1234"><span class="linenum">1234</span></a>  <span class="comment"> *</span>
<a name="l1235"><span class="linenum">1235</span></a>  <span class="comment"> * @param object $course</span>
<a name="l1236"><span class="linenum">1236</span></a>  <span class="comment"> * @param object $user</span>
<a name="l1237"><span class="linenum">1237</span></a>  <span class="comment"> * @param object $mod TODO this is not used in this function, refactor</span>
<a name="l1238"><span class="linenum">1238</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l1239"><span class="linenum">1239</span></a>  <span class="comment"> * @return object A standard object with 2 variables: info (number of posts for this user) and time (last modified)</span>
<a name="l1240"><span class="linenum">1240</span></a>  <span class="comment"> */</span>
<a name="l1241"><span class="linenum">1241</span></a>  function <a class="function" onClick="logFunction('forum_user_outline')" href="../../_functions/forum_user_outline.html" onMouseOver="funcPopup(event,'forum_user_outline')">forum_user_outline</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l1242"><span class="linenum">1242</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1243"><span class="linenum">1243</span></a>      require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>/gradelib.php&quot;);
<a name="l1244"><span class="linenum">1244</span></a>      <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="function" onClick="logFunction('grade_get_grades')" href="../../_functions/grade_get_grades.html" onMouseOver="funcPopup(event,'grade_get_grades')">grade_get_grades</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod', 'forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1245"><span class="linenum">1245</span></a>      if (empty(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it43825" onMouseOver="hilite(43825)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades)) {
<a name="l1246"><span class="linenum">1246</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = false;
<a name="l1247"><span class="linenum">1247</span></a>      } else {
<a name="l1248"><span class="linenum">1248</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it43825" onMouseOver="hilite(43825)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades);
<a name="l1249"><span class="linenum">1249</span></a>      }
<a name="l1250"><span class="linenum">1250</span></a>  
<a name="l1251"><span class="linenum">1251</span></a>      <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = <a class="function" onClick="logFunction('forum_count_user_posts')" href="../../_functions/forum_count_user_posts.html" onMouseOver="funcPopup(event,'forum_count_user_posts')">forum_count_user_posts</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1252"><span class="linenum">1252</span></a>  
<a name="l1253"><span class="linenum">1253</span></a>      if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> &amp;&amp; <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>-&gt;<a onClick="logVariable('postcount')" class="var it43239" onMouseOver="hilite(43239)" onMouseOut="lolite()" href="../../_variables/postcount.html">postcount</a> &gt; 0) {
<a name="l1254"><span class="linenum">1254</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = new stdClass();
<a name="l1255"><span class="linenum">1255</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('info')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;numposts&quot;, &quot;forum&quot;, <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>-&gt;<a onClick="logVariable('postcount')" class="var it43239" onMouseOver="hilite(43239)" onMouseOut="lolite()" href="../../_variables/postcount.html">postcount</a>);
<a name="l1256"><span class="linenum">1256</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('time')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/time.html">time</a> = <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>-&gt;<a onClick="logVariable('lastpost')" class="var it43239" onMouseOver="hilite(43239)" onMouseOut="lolite()" href="../../_variables/lastpost.html">lastpost</a>;
<a name="l1257"><span class="linenum">1257</span></a>          if (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>) {
<a name="l1258"><span class="linenum">1258</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('info')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> .= ', ' . <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('grade') . ': ' . <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_long_grade')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/str_long_grade.html">str_long_grade</a>;
<a name="l1259"><span class="linenum">1259</span></a>          }
<a name="l1260"><span class="linenum">1260</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1261"><span class="linenum">1261</span></a>      } else if (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>) {
<a name="l1262"><span class="linenum">1262</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = new stdClass();
<a name="l1263"><span class="linenum">1263</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('info')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('grade') . ': ' . <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_long_grade')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/str_long_grade.html">str_long_grade</a>;
<a name="l1264"><span class="linenum">1264</span></a>  
<a name="l1265"><span class="linenum">1265</span></a>  <span class="comment">        //datesubmitted == time created. dategraded == time modified or time overridden</span>
<a name="l1266"><span class="linenum">1266</span></a>  <span class="comment">        //if grade was last modified by the user themselves use date graded. Otherwise use date submitted</span>
<a name="l1267"><span class="linenum">1267</span></a>  <span class="comment">        //TODO: move this copied &amp; pasted code somewhere in the grades API. See MDL-26704</span>
<a name="l1268"><span class="linenum">1268</span></a>          if (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('usermodified')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> == <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> || empty(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('datesubmitted')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/datesubmitted.html">datesubmitted</a>)) {
<a name="l1269"><span class="linenum">1269</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('time')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/time.html">time</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('dategraded')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/dategraded.html">dategraded</a>;
<a name="l1270"><span class="linenum">1270</span></a>          } else {
<a name="l1271"><span class="linenum">1271</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('time')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/time.html">time</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('datesubmitted')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/datesubmitted.html">datesubmitted</a>;
<a name="l1272"><span class="linenum">1272</span></a>          }
<a name="l1273"><span class="linenum">1273</span></a>  
<a name="l1274"><span class="linenum">1274</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1275"><span class="linenum">1275</span></a>      }
<a name="l1276"><span class="linenum">1276</span></a>      return NULL;
<a name="l1277"><span class="linenum">1277</span></a>  }
<a name="l1278"><span class="linenum">1278</span></a>  
<a name="l1279"><span class="linenum">1279</span></a>  
<a name="l1280"><span class="linenum">1280</span></a>  <span class="comment">/**</span>
<a name="l1281"><span class="linenum">1281</span></a>  <span class="comment"> * @global object</span>
<a name="l1282"><span class="linenum">1282</span></a>  <span class="comment"> * @global object</span>
<a name="l1283"><span class="linenum">1283</span></a>  <span class="comment"> * @param object $coure</span>
<a name="l1284"><span class="linenum">1284</span></a>  <span class="comment"> * @param object $user</span>
<a name="l1285"><span class="linenum">1285</span></a>  <span class="comment"> * @param object $mod</span>
<a name="l1286"><span class="linenum">1286</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l1287"><span class="linenum">1287</span></a>  <span class="comment"> */</span>
<a name="l1288"><span class="linenum">1288</span></a>  function <a class="function" onClick="logFunction('forum_user_complete')" href="../../_functions/forum_user_complete.html" onMouseOver="funcPopup(event,'forum_user_complete')">forum_user_complete</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l1289"><span class="linenum">1289</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>,<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l1290"><span class="linenum">1290</span></a>      require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>/gradelib.php&quot;);
<a name="l1291"><span class="linenum">1291</span></a>  
<a name="l1292"><span class="linenum">1292</span></a>      <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="function" onClick="logFunction('grade_get_grades')" href="../../_functions/grade_get_grades.html" onMouseOver="funcPopup(event,'grade_get_grades')">grade_get_grades</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod', 'forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1293"><span class="linenum">1293</span></a>      if (!empty(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it43825" onMouseOver="hilite(43825)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades)) {
<a name="l1294"><span class="linenum">1294</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it43825" onMouseOver="hilite(43825)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades);
<a name="l1295"><span class="linenum">1295</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('container')" href="../../_functions/container.html" onMouseOver="funcPopup(event,'container')">container</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('grade').': '.<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_long_grade')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/str_long_grade.html">str_long_grade</a>);
<a name="l1296"><span class="linenum">1296</span></a>          if (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_feedback')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/str_feedback.html">str_feedback</a>) {
<a name="l1297"><span class="linenum">1297</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('container')" href="../../_functions/container.html" onMouseOver="funcPopup(event,'container')">container</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('feedback').': '.<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_feedback')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/str_feedback.html">str_feedback</a>);
<a name="l1298"><span class="linenum">1298</span></a>          }
<a name="l1299"><span class="linenum">1299</span></a>      }
<a name="l1300"><span class="linenum">1300</span></a>  
<a name="l1301"><span class="linenum">1301</span></a>      if (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="function" onClick="logFunction('forum_get_user_posts')" href="../../_functions/forum_get_user_posts.html" onMouseOver="funcPopup(event,'forum_get_user_posts')">forum_get_user_posts</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l1302"><span class="linenum">1302</span></a>  
<a name="l1303"><span class="linenum">1303</span></a>          if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l1304"><span class="linenum">1304</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidcoursemodule');
<a name="l1305"><span class="linenum">1305</span></a>          }
<a name="l1306"><span class="linenum">1306</span></a>          <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a> = <a class="function" onClick="logFunction('forum_get_user_involved_discussions')" href="../../_functions/forum_get_user_involved_discussions.html" onMouseOver="funcPopup(event,'forum_get_user_involved_discussions')">forum_get_user_involved_discussions</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1307"><span class="linenum">1307</span></a>  
<a name="l1308"><span class="linenum">1308</span></a>          foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l1309"><span class="linenum">1309</span></a>              if (!isset(<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>])) {
<a name="l1310"><span class="linenum">1310</span></a>                  continue;
<a name="l1311"><span class="linenum">1311</span></a>              }
<a name="l1312"><span class="linenum">1312</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>];
<a name="l1313"><span class="linenum">1313</span></a>  
<a name="l1314"><span class="linenum">1314</span></a>              <a class="function" onClick="logFunction('forum_print_post')" href="../../_functions/forum_print_post.html" onMouseOver="funcPopup(event,'forum_print_post')">forum_print_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, false, false, false);
<a name="l1315"><span class="linenum">1315</span></a>          }
<a name="l1316"><span class="linenum">1316</span></a>      } else {
<a name="l1317"><span class="linenum">1317</span></a>          echo &quot;&lt;p&gt;&quot;.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;noposts&quot;, &quot;forum&quot;).&quot;&lt;/p&gt;&quot;;
<a name="l1318"><span class="linenum">1318</span></a>      }
<a name="l1319"><span class="linenum">1319</span></a>  }
<a name="l1320"><span class="linenum">1320</span></a>  
<a name="l1321"><span class="linenum">1321</span></a>  <span class="comment">/**</span>
<a name="l1322"><span class="linenum">1322</span></a>  <span class="comment"> * Filters the forum discussions according to groups membership and config.</span>
<a name="l1323"><span class="linenum">1323</span></a>  <span class="comment"> *</span>
<a name="l1324"><span class="linenum">1324</span></a>  <span class="comment"> * @since  Moodle 2.8, 2.7.1, 2.6.4</span>
<a name="l1325"><span class="linenum">1325</span></a>  <span class="comment"> * @param  array $discussions Discussions with new posts array</span>
<a name="l1326"><span class="linenum">1326</span></a>  <span class="comment"> * @return array Forums with the number of new posts</span>
<a name="l1327"><span class="linenum">1327</span></a>  <span class="comment"> */</span>
<a name="l1328"><span class="linenum">1328</span></a>  function <a class="function" onClick="logFunction('forum_filter_user_groups_discussions')" href="../../_functions/forum_filter_user_groups_discussions.html" onMouseOver="funcPopup(event,'forum_filter_user_groups_discussions')">forum_filter_user_groups_discussions</a>(<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>) {
<a name="l1329"><span class="linenum">1329</span></a>  
<a name="l1330"><span class="linenum">1330</span></a>  <span class="comment">    // Group the remaining discussions posts by their forumid.</span>
<a name="l1331"><span class="linenum">1331</span></a>      <a class="var it41516" onMouseOver="hilite(41516)" onMouseOut="lolite()" onClick="logVariable('filteredforums')" href="../../_variables/filteredforums.html">$filteredforums</a> = array();
<a name="l1332"><span class="linenum">1332</span></a>  
<a name="l1333"><span class="linenum">1333</span></a>  <span class="comment">    // Discard not visible groups.</span>
<a name="l1334"><span class="linenum">1334</span></a>      foreach (<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a> as <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>) {
<a name="l1335"><span class="linenum">1335</span></a>  
<a name="l1336"><span class="linenum">1336</span></a>  <span class="comment">        // Course data is already cached.</span>
<a name="l1337"><span class="linenum">1337</span></a>          <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../../_variables/instances.html">$instances</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('course')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)-&gt;<a class="function" onClick="logFunction('get_instances')" href="../../_functions/get_instances.html" onMouseOver="funcPopup(event,'get_instances')">get_instances</a>();
<a name="l1338"><span class="linenum">1338</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../../_variables/instances.html">$instances</a>['forum'][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>];
<a name="l1339"><span class="linenum">1339</span></a>  
<a name="l1340"><span class="linenum">1340</span></a>  <span class="comment">        // Continue if the user should not see this discussion.</span>
<a name="l1341"><span class="linenum">1341</span></a>          if (!<a class="function" onClick="logFunction('forum_is_user_group_discussion')" href="../../_functions/forum_is_user_group_discussion.html" onMouseOver="funcPopup(event,'forum_is_user_group_discussion')">forum_is_user_group_discussion</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>)) {
<a name="l1342"><span class="linenum">1342</span></a>              continue;
<a name="l1343"><span class="linenum">1343</span></a>          }
<a name="l1344"><span class="linenum">1344</span></a>  
<a name="l1345"><span class="linenum">1345</span></a>  <span class="comment">        // Grouping results by forum.</span>
<a name="l1346"><span class="linenum">1346</span></a>          if (empty(<a class="var it41516" onMouseOver="hilite(41516)" onMouseOut="lolite()" onClick="logVariable('filteredforums')" href="../../_variables/filteredforums.html">$filteredforums</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('instance')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>])) {
<a name="l1347"><span class="linenum">1347</span></a>              <a class="var it41516" onMouseOver="hilite(41516)" onMouseOut="lolite()" onClick="logVariable('filteredforums')" href="../../_variables/filteredforums.html">$filteredforums</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('instance')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>] = new stdClass();
<a name="l1348"><span class="linenum">1348</span></a>              <a class="var it41516" onMouseOver="hilite(41516)" onMouseOut="lolite()" onClick="logVariable('filteredforums')" href="../../_variables/filteredforums.html">$filteredforums</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('instance')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>]-&gt;id = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1349"><span class="linenum">1349</span></a>              <a class="var it41516" onMouseOver="hilite(41516)" onMouseOut="lolite()" onClick="logVariable('filteredforums')" href="../../_variables/filteredforums.html">$filteredforums</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('instance')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>]-&gt;count = 0;
<a name="l1350"><span class="linenum">1350</span></a>          }
<a name="l1351"><span class="linenum">1351</span></a>          <a class="var it41516" onMouseOver="hilite(41516)" onMouseOut="lolite()" onClick="logVariable('filteredforums')" href="../../_variables/filteredforums.html">$filteredforums</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('instance')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>]-&gt;count += <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('count')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/count.html">count</a>;
<a name="l1352"><span class="linenum">1352</span></a>  
<a name="l1353"><span class="linenum">1353</span></a>      }
<a name="l1354"><span class="linenum">1354</span></a>  
<a name="l1355"><span class="linenum">1355</span></a>      return <a class="var it41516" onMouseOver="hilite(41516)" onMouseOut="lolite()" onClick="logVariable('filteredforums')" href="../../_variables/filteredforums.html">$filteredforums</a>;
<a name="l1356"><span class="linenum">1356</span></a>  }
<a name="l1357"><span class="linenum">1357</span></a>  
<a name="l1358"><span class="linenum">1358</span></a>  <span class="comment">/**</span>
<a name="l1359"><span class="linenum">1359</span></a>  <span class="comment"> * Returns whether the discussion group is visible by the current user or not.</span>
<a name="l1360"><span class="linenum">1360</span></a>  <span class="comment"> *</span>
<a name="l1361"><span class="linenum">1361</span></a>  <span class="comment"> * @since Moodle 2.8, 2.7.1, 2.6.4</span>
<a name="l1362"><span class="linenum">1362</span></a>  <span class="comment"> * @param cm_info $cm The discussion course module</span>
<a name="l1363"><span class="linenum">1363</span></a>  <span class="comment"> * @param int $discussiongroupid The discussion groupid</span>
<a name="l1364"><span class="linenum">1364</span></a>  <span class="comment"> * @return bool</span>
<a name="l1365"><span class="linenum">1365</span></a>  <span class="comment"> */</span>
<a name="l1366"><span class="linenum">1366</span></a>  function <a class="function" onClick="logFunction('forum_is_user_group_discussion')" href="../../_functions/forum_is_user_group_discussion.html" onMouseOver="funcPopup(event,'forum_is_user_group_discussion')">forum_is_user_group_discussion</a>(cm_info <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it41517" onMouseOver="hilite(41517)" onMouseOut="lolite()" onClick="logVariable('discussiongroupid')" href="../../_variables/discussiongroupid.html">$discussiongroupid</a>) {
<a name="l1367"><span class="linenum">1367</span></a>  
<a name="l1368"><span class="linenum">1368</span></a>      if (<a class="var it41517" onMouseOver="hilite(41517)" onMouseOut="lolite()" onClick="logVariable('discussiongroupid')" href="../../_variables/discussiongroupid.html">$discussiongroupid</a> == -1 || <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('effectivegroupmode')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/effectivegroupmode.html">effectivegroupmode</a> != <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>) {
<a name="l1369"><span class="linenum">1369</span></a>          return true;
<a name="l1370"><span class="linenum">1370</span></a>      }
<a name="l1371"><span class="linenum">1371</span></a>  
<a name="l1372"><span class="linenum">1372</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>()) {
<a name="l1373"><span class="linenum">1373</span></a>          return false;
<a name="l1374"><span class="linenum">1374</span></a>      }
<a name="l1375"><span class="linenum">1375</span></a>  
<a name="l1376"><span class="linenum">1376</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) ||
<a name="l1377"><span class="linenum">1377</span></a>              <a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it41517" onMouseOver="hilite(41517)" onMouseOut="lolite()" onClick="logVariable('discussiongroupid')" href="../../_variables/discussiongroupid.html">$discussiongroupid</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a class="function" onClick="logFunction('get_modinfo')" href="../../_functions/get_modinfo.html" onMouseOver="funcPopup(event,'get_modinfo')">get_modinfo</a>()-&gt;<a class="function" onClick="logFunction('get_groups')" href="../../_functions/get_groups.html" onMouseOver="funcPopup(event,'get_groups')">get_groups</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>))) {
<a name="l1378"><span class="linenum">1378</span></a>          return true;
<a name="l1379"><span class="linenum">1379</span></a>      }
<a name="l1380"><span class="linenum">1380</span></a>  
<a name="l1381"><span class="linenum">1381</span></a>      return false;
<a name="l1382"><span class="linenum">1382</span></a>  }
<a name="l1383"><span class="linenum">1383</span></a>  
<a name="l1384"><span class="linenum">1384</span></a>  <span class="comment">/**</span>
<a name="l1385"><span class="linenum">1385</span></a>  <span class="comment"> * @global object</span>
<a name="l1386"><span class="linenum">1386</span></a>  <span class="comment"> * @global object</span>
<a name="l1387"><span class="linenum">1387</span></a>  <span class="comment"> * @global object</span>
<a name="l1388"><span class="linenum">1388</span></a>  <span class="comment"> * @param array $courses</span>
<a name="l1389"><span class="linenum">1389</span></a>  <span class="comment"> * @param array $htmlarray</span>
<a name="l1390"><span class="linenum">1390</span></a>  <span class="comment"> */</span>
<a name="l1391"><span class="linenum">1391</span></a>  function <a class="function" onClick="logFunction('forum_print_overview')" href="../../_functions/forum_print_overview.html" onMouseOver="funcPopup(event,'forum_print_overview')">forum_print_overview</a>(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>,&amp;<a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>) {
<a name="l1392"><span class="linenum">1392</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>;
<a name="l1393"><span class="linenum">1393</span></a>  
<a name="l1394"><span class="linenum">1394</span></a>      if (empty(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>) || !<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>) || <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>) == 0) {
<a name="l1395"><span class="linenum">1395</span></a>          return array();
<a name="l1396"><span class="linenum">1396</span></a>      }
<a name="l1397"><span class="linenum">1397</span></a>  
<a name="l1398"><span class="linenum">1398</span></a>      if (!<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> = <a class="function" onClick="logFunction('get_all_instances_in_courses')" href="../../_functions/get_all_instances_in_courses.html" onMouseOver="funcPopup(event,'get_all_instances_in_courses')">get_all_instances_in_courses</a>('forum',<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>)) {
<a name="l1399"><span class="linenum">1399</span></a>          return;
<a name="l1400"><span class="linenum">1400</span></a>      }
<a name="l1401"><span class="linenum">1401</span></a>  
<a name="l1402"><span class="linenum">1402</span></a>  <span class="comment">    // Courses to search for new posts</span>
<a name="l1403"><span class="linenum">1403</span></a>      <a class="var it41518" onMouseOver="hilite(41518)" onMouseOut="lolite()" onClick="logVariable('coursessqls')" href="../../_variables/coursessqls.html">$coursessqls</a> = array();
<a name="l1404"><span class="linenum">1404</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l1405"><span class="linenum">1405</span></a>      foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l1406"><span class="linenum">1406</span></a>  
<a name="l1407"><span class="linenum">1407</span></a>  <span class="comment">        // If the user has never entered into the course all posts are pending</span>
<a name="l1408"><span class="linenum">1408</span></a>          if (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('lastaccess')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/lastaccess.html">lastaccess</a> == 0) {
<a name="l1409"><span class="linenum">1409</span></a>              <a class="var it41518" onMouseOver="hilite(41518)" onMouseOut="lolite()" onClick="logVariable('coursessqls')" href="../../_variables/coursessqls.html">$coursessqls</a>[] = '(d.course = ?)';
<a name="l1410"><span class="linenum">1410</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1411"><span class="linenum">1411</span></a>  
<a name="l1412"><span class="linenum">1412</span></a>  <span class="comment">        // Only posts created after the course last access</span>
<a name="l1413"><span class="linenum">1413</span></a>          } else {
<a name="l1414"><span class="linenum">1414</span></a>              <a class="var it41518" onMouseOver="hilite(41518)" onMouseOut="lolite()" onClick="logVariable('coursessqls')" href="../../_variables/coursessqls.html">$coursessqls</a>[] = '(d.course = ? AND p.created &gt; ?)';
<a name="l1415"><span class="linenum">1415</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1416"><span class="linenum">1416</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('lastaccess')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/lastaccess.html">lastaccess</a>;
<a name="l1417"><span class="linenum">1417</span></a>          }
<a name="l1418"><span class="linenum">1418</span></a>      }
<a name="l1419"><span class="linenum">1419</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1420"><span class="linenum">1420</span></a>      <a class="var it30709" onMouseOver="hilite(30709)" onMouseOut="lolite()" onClick="logVariable('coursessql')" href="../../_variables/coursessql.html">$coursessql</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(' OR ', <a class="var it41518" onMouseOver="hilite(41518)" onMouseOut="lolite()" onClick="logVariable('coursessqls')" href="../../_variables/coursessqls.html">$coursessqls</a>);
<a name="l1421"><span class="linenum">1421</span></a>  
<a name="l1422"><span class="linenum">1422</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT d.id, d.forum, d.course, d.groupid, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) as count &quot;
<a name="l1423"><span class="linenum">1423</span></a>                  .'FROM {forum_discussions} d '
<a name="l1424"><span class="linenum">1424</span></a>                  .'JOIN {forum_posts} p ON p.discussion = d.id '
<a name="l1425"><span class="linenum">1425</span></a>                  .&quot;<a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (<a class="var it30709" onMouseOver="hilite(30709)" onMouseOut="lolite()" onClick="logVariable('coursessql')" href="../../_variables/coursessql.html">$coursessql</a>) &quot;
<a name="l1426"><span class="linenum">1426</span></a>                  .'AND p.userid != ? '
<a name="l1427"><span class="linenum">1427</span></a>                  .'AND (d.timestart &lt;= ? AND (d.timeend = 0 OR d.timeend &gt; ?)) '
<a name="l1428"><span class="linenum">1428</span></a>                  .'GROUP BY d.id, d.forum, d.course, d.groupid '
<a name="l1429"><span class="linenum">1429</span></a>                  .'ORDER BY d.course, d.forum';
<a name="l1430"><span class="linenum">1430</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1431"><span class="linenum">1431</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1432"><span class="linenum">1432</span></a>  
<a name="l1433"><span class="linenum">1433</span></a>  <span class="comment">    // Avoid warnings.</span>
<a name="l1434"><span class="linenum">1434</span></a>      if (!<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l1435"><span class="linenum">1435</span></a>          <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a> = array();
<a name="l1436"><span class="linenum">1436</span></a>      }
<a name="l1437"><span class="linenum">1437</span></a>  
<a name="l1438"><span class="linenum">1438</span></a>      <a class="var it41519" onMouseOver="hilite(41519)" onMouseOut="lolite()" onClick="logVariable('forumsnewposts')" href="../../_variables/forumsnewposts.html">$forumsnewposts</a> = <a class="function" onClick="logFunction('forum_filter_user_groups_discussions')" href="../../_functions/forum_filter_user_groups_discussions.html" onMouseOver="funcPopup(event,'forum_filter_user_groups_discussions')">forum_filter_user_groups_discussions</a>(<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>);
<a name="l1439"><span class="linenum">1439</span></a>  
<a name="l1440"><span class="linenum">1440</span></a>  <span class="comment">    // also get all forum tracking stuff ONCE.</span>
<a name="l1441"><span class="linenum">1441</span></a>      <a class="var it41520" onMouseOver="hilite(41520)" onMouseOut="lolite()" onClick="logVariable('trackingforums')" href="../../_variables/trackingforums.html">$trackingforums</a> = array();
<a name="l1442"><span class="linenum">1442</span></a>      foreach (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> as <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l1443"><span class="linenum">1443</span></a>          if (<a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l1444"><span class="linenum">1444</span></a>              <a class="var it41520" onMouseOver="hilite(41520)" onMouseOut="lolite()" onClick="logVariable('trackingforums')" href="../../_variables/trackingforums.html">$trackingforums</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>;
<a name="l1445"><span class="linenum">1445</span></a>          }
<a name="l1446"><span class="linenum">1446</span></a>      }
<a name="l1447"><span class="linenum">1447</span></a>  
<a name="l1448"><span class="linenum">1448</span></a>      if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it41520" onMouseOver="hilite(41520)" onMouseOut="lolite()" onClick="logVariable('trackingforums')" href="../../_variables/trackingforums.html">$trackingforums</a>) &gt; 0) {
<a name="l1449"><span class="linenum">1449</span></a>          <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a> = isset(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a>) ? (<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a>*24*60*60)) : 0;
<a name="l1450"><span class="linenum">1450</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT d.forum,d.course,<a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(p.id) AS count '.
<a name="l1451"><span class="linenum">1451</span></a>              ' FROM {forum_posts} p '.
<a name="l1452"><span class="linenum">1452</span></a>              ' JOIN {forum_discussions} d ON p.discussion = d.id '.
<a name="l1453"><span class="linenum">1453</span></a>              ' LEFT JOIN {forum_read} r ON r.postid = p.id AND r.userid = ? <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (';
<a name="l1454"><span class="linenum">1454</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1455"><span class="linenum">1455</span></a>  
<a name="l1456"><span class="linenum">1456</span></a>          foreach (<a class="var it41520" onMouseOver="hilite(41520)" onMouseOut="lolite()" onClick="logVariable('trackingforums')" href="../../_variables/trackingforums.html">$trackingforums</a> as <a class="var it6706" onMouseOver="hilite(6706)" onMouseOut="lolite()" onClick="logVariable('track')" href="../../_variables/track.html">$track</a>) {
<a name="l1457"><span class="linenum">1457</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> .= '(d.forum = ? AND (d.groupid = -1 OR d.groupid = 0 OR d.groupid = ?)) OR ';
<a name="l1458"><span class="linenum">1458</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it6706" onMouseOver="hilite(6706)" onMouseOut="lolite()" onClick="logVariable('track')" href="../../_variables/track.html">$track</a>-&gt;<a onClick="logVariable('id')" class="var it44620" onMouseOver="hilite(44620)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1459"><span class="linenum">1459</span></a>              if (isset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('currentgroup')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/currentgroup.html">currentgroup</a>[<a class="var it6706" onMouseOver="hilite(6706)" onMouseOut="lolite()" onClick="logVariable('track')" href="../../_variables/track.html">$track</a>-&gt;<a onClick="logVariable('course')" class="var it44620" onMouseOver="hilite(44620)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>])) {
<a name="l1460"><span class="linenum">1460</span></a>                  <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> =  <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('currentgroup')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/currentgroup.html">currentgroup</a>[<a class="var it6706" onMouseOver="hilite(6706)" onMouseOut="lolite()" onClick="logVariable('track')" href="../../_variables/track.html">$track</a>-&gt;<a onClick="logVariable('course')" class="var it44620" onMouseOver="hilite(44620)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>];
<a name="l1461"><span class="linenum">1461</span></a>              } else {
<a name="l1462"><span class="linenum">1462</span></a>  <span class="comment">                // get first groupid</span>
<a name="l1463"><span class="linenum">1463</span></a>                  <a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a> = <a class="function" onClick="logFunction('groups_get_all_groups')" href="../../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it6706" onMouseOver="hilite(6706)" onMouseOut="lolite()" onClick="logVariable('track')" href="../../_variables/track.html">$track</a>-&gt;<a onClick="logVariable('course')" class="var it44620" onMouseOver="hilite(44620)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1464"><span class="linenum">1464</span></a>                  if (<a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a>) {
<a name="l1465"><span class="linenum">1465</span></a>                      <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a>);
<a name="l1466"><span class="linenum">1466</span></a>                      <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> = <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a>(<a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a>);
<a name="l1467"><span class="linenum">1467</span></a>                      <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('currentgroup')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/currentgroup.html">currentgroup</a>[<a class="var it6706" onMouseOver="hilite(6706)" onMouseOut="lolite()" onClick="logVariable('track')" href="../../_variables/track.html">$track</a>-&gt;<a onClick="logVariable('course')" class="var it44620" onMouseOver="hilite(44620)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>] = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l1468"><span class="linenum">1468</span></a>                  } else {
<a name="l1469"><span class="linenum">1469</span></a>                      <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> = 0;
<a name="l1470"><span class="linenum">1470</span></a>                  }
<a name="l1471"><span class="linenum">1471</span></a>                  unset(<a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a>);
<a name="l1472"><span class="linenum">1472</span></a>              }
<a name="l1473"><span class="linenum">1473</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l1474"><span class="linenum">1474</span></a>          }
<a name="l1475"><span class="linenum">1475</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>,0,-3); <span class="comment">// take off the last OR</span>
<a name="l1476"><span class="linenum">1476</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> .= ') AND p.modified &gt;= ? AND r.id is NULL ';
<a name="l1477"><span class="linenum">1477</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> .= 'AND (d.timestart &lt; ? AND (d.timeend = 0 OR d.timeend &gt; ?)) ';
<a name="l1478"><span class="linenum">1478</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> .= 'GROUP BY d.forum,d.course';
<a name="l1479"><span class="linenum">1479</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a>;
<a name="l1480"><span class="linenum">1480</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1481"><span class="linenum">1481</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1482"><span class="linenum">1482</span></a>  
<a name="l1483"><span class="linenum">1483</span></a>          if (!<a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l1484"><span class="linenum">1484</span></a>              <a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a> = array();
<a name="l1485"><span class="linenum">1485</span></a>          }
<a name="l1486"><span class="linenum">1486</span></a>      } else {
<a name="l1487"><span class="linenum">1487</span></a>          <a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a> = array();
<a name="l1488"><span class="linenum">1488</span></a>      }
<a name="l1489"><span class="linenum">1489</span></a>  
<a name="l1490"><span class="linenum">1490</span></a>      if (empty(<a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a>) and empty(<a class="var it41519" onMouseOver="hilite(41519)" onMouseOut="lolite()" onClick="logVariable('forumsnewposts')" href="../../_variables/forumsnewposts.html">$forumsnewposts</a>)) {
<a name="l1491"><span class="linenum">1491</span></a>          return;
<a name="l1492"><span class="linenum">1492</span></a>      }
<a name="l1493"><span class="linenum">1493</span></a>  
<a name="l1494"><span class="linenum">1494</span></a>      <a class="var it27222" onMouseOver="hilite(27222)" onMouseOut="lolite()" onClick="logVariable('strforum')" href="../../_variables/strforum.html">$strforum</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulename','forum');
<a name="l1495"><span class="linenum">1495</span></a>  
<a name="l1496"><span class="linenum">1496</span></a>      foreach (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> as <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l1497"><span class="linenum">1497</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = '';
<a name="l1498"><span class="linenum">1498</span></a>          <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = 0;
<a name="l1499"><span class="linenum">1499</span></a>          <a class="var it41522" onMouseOver="hilite(41522)" onMouseOut="lolite()" onClick="logVariable('thisunread')" href="../../_variables/thisunread.html">$thisunread</a> = 0;
<a name="l1500"><span class="linenum">1500</span></a>          <a class="var it41523" onMouseOver="hilite(41523)" onMouseOut="lolite()" onClick="logVariable('showunread')" href="../../_variables/showunread.html">$showunread</a> = false;
<a name="l1501"><span class="linenum">1501</span></a>  <span class="comment">        // either we have something from logs, or trackposts, or nothing.</span>
<a name="l1502"><span class="linenum">1502</span></a>          if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it41519" onMouseOver="hilite(41519)" onMouseOut="lolite()" onClick="logVariable('forumsnewposts')" href="../../_variables/forumsnewposts.html">$forumsnewposts</a>) &amp;&amp; !empty(<a class="var it41519" onMouseOver="hilite(41519)" onMouseOut="lolite()" onClick="logVariable('forumsnewposts')" href="../../_variables/forumsnewposts.html">$forumsnewposts</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l1503"><span class="linenum">1503</span></a>              <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = <a class="var it41519" onMouseOver="hilite(41519)" onMouseOut="lolite()" onClick="logVariable('forumsnewposts')" href="../../_variables/forumsnewposts.html">$forumsnewposts</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;count;
<a name="l1504"><span class="linenum">1504</span></a>          }
<a name="l1505"><span class="linenum">1505</span></a>          if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,<a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a>)) {
<a name="l1506"><span class="linenum">1506</span></a>              <a class="var it41522" onMouseOver="hilite(41522)" onMouseOut="lolite()" onClick="logVariable('thisunread')" href="../../_variables/thisunread.html">$thisunread</a> = <a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;count;
<a name="l1507"><span class="linenum">1507</span></a>              <a class="var it41523" onMouseOver="hilite(41523)" onMouseOut="lolite()" onClick="logVariable('showunread')" href="../../_variables/showunread.html">$showunread</a> = true;
<a name="l1508"><span class="linenum">1508</span></a>          }
<a name="l1509"><span class="linenum">1509</span></a>          if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> &gt; 0 || <a class="var it41522" onMouseOver="hilite(41522)" onMouseOut="lolite()" onClick="logVariable('thisunread')" href="../../_variables/thisunread.html">$thisunread</a> &gt; 0) {
<a name="l1510"><span class="linenum">1510</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= '&lt;div class=&quot;overview forum&quot;&gt;&lt;div class=&quot;name&quot;&gt;'.<a class="var it27222" onMouseOver="hilite(27222)" onMouseOut="lolite()" onClick="logVariable('strforum')" href="../../_variables/strforum.html">$strforum</a>.': &lt;a title=&quot;'.<a class="var it27222" onMouseOver="hilite(27222)" onMouseOut="lolite()" onClick="logVariable('strforum')" href="../../_variables/strforum.html">$strforum</a>.'&quot; href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/view.php?f='.<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'&quot;&gt;'.
<a name="l1511"><span class="linenum">1511</span></a>                  <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>.'&lt;/a&gt;&lt;/div&gt;';
<a name="l1512"><span class="linenum">1512</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= '&lt;div class=&quot;info&quot;&gt;&lt;span class=&quot;postsincelogin&quot;&gt;';
<a name="l1513"><span class="linenum">1513</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('overviewnumpostssince', 'forum', <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>).&quot;&lt;/span&gt;&quot;;
<a name="l1514"><span class="linenum">1514</span></a>              if (!empty(<a class="var it41523" onMouseOver="hilite(41523)" onMouseOut="lolite()" onClick="logVariable('showunread')" href="../../_variables/showunread.html">$showunread</a>)) {
<a name="l1515"><span class="linenum">1515</span></a>                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= '&lt;div class=&quot;unreadposts&quot;&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('overviewnumunread', 'forum', <a class="var it41522" onMouseOver="hilite(41522)" onMouseOut="lolite()" onClick="logVariable('thisunread')" href="../../_variables/thisunread.html">$thisunread</a>).'&lt;/div&gt;';
<a name="l1516"><span class="linenum">1516</span></a>              }
<a name="l1517"><span class="linenum">1517</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= '&lt;/div&gt;&lt;/div&gt;';
<a name="l1518"><span class="linenum">1518</span></a>          }
<a name="l1519"><span class="linenum">1519</span></a>          if (!empty(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>)) {
<a name="l1520"><span class="linenum">1520</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>,<a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>)) {
<a name="l1521"><span class="linenum">1521</span></a>                  <a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>] = array();
<a name="l1522"><span class="linenum">1522</span></a>              }
<a name="l1523"><span class="linenum">1523</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('forum',<a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>])) {
<a name="l1524"><span class="linenum">1524</span></a>                  <a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['forum'] = ''; <span class="comment">// initialize, avoid warnings</span>
<a name="l1525"><span class="linenum">1525</span></a>              }
<a name="l1526"><span class="linenum">1526</span></a>              <a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['forum'] .= <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>;
<a name="l1527"><span class="linenum">1527</span></a>          }
<a name="l1528"><span class="linenum">1528</span></a>      }
<a name="l1529"><span class="linenum">1529</span></a>  }
<a name="l1530"><span class="linenum">1530</span></a>  
<a name="l1531"><span class="linenum">1531</span></a>  <span class="comment">/**</span>
<a name="l1532"><span class="linenum">1532</span></a>  <span class="comment"> * Given a course and a date, prints a summary of all the new</span>
<a name="l1533"><span class="linenum">1533</span></a>  <span class="comment"> * messages posted in the course since that date</span>
<a name="l1534"><span class="linenum">1534</span></a>  <span class="comment"> *</span>
<a name="l1535"><span class="linenum">1535</span></a>  <span class="comment"> * @global object</span>
<a name="l1536"><span class="linenum">1536</span></a>  <span class="comment"> * @global object</span>
<a name="l1537"><span class="linenum">1537</span></a>  <span class="comment"> * @global object</span>
<a name="l1538"><span class="linenum">1538</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l1539"><span class="linenum">1539</span></a>  <span class="comment"> * @uses VISIBLEGROUPS</span>
<a name="l1540"><span class="linenum">1540</span></a>  <span class="comment"> * @param object $course</span>
<a name="l1541"><span class="linenum">1541</span></a>  <span class="comment"> * @param bool $viewfullnames capability</span>
<a name="l1542"><span class="linenum">1542</span></a>  <span class="comment"> * @param int $timestart</span>
<a name="l1543"><span class="linenum">1543</span></a>  <span class="comment"> * @return bool success</span>
<a name="l1544"><span class="linenum">1544</span></a>  <span class="comment"> */</span>
<a name="l1545"><span class="linenum">1545</span></a>  function <a class="function" onClick="logFunction('forum_print_recent_activity')" href="../../_functions/forum_print_recent_activity.html" onMouseOver="funcPopup(event,'forum_print_recent_activity')">forum_print_recent_activity</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it5397" onMouseOver="hilite(5397)" onMouseOut="lolite()" onClick="logVariable('viewfullnames')" href="../../_variables/viewfullnames.html">$viewfullnames</a>, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>) {
<a name="l1546"><span class="linenum">1546</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l1547"><span class="linenum">1547</span></a>  
<a name="l1548"><span class="linenum">1548</span></a>  <span class="comment">    // do not use log table if possible, it may be huge and is expensive to join with other tables</span>
<a name="l1549"><span class="linenum">1549</span></a>  
<a name="l1550"><span class="linenum">1550</span></a>      <a class="var it8426" onMouseOver="hilite(8426)" onMouseOut="lolite()" onClick="logVariable('allnamefields')" href="../../_variables/allnamefields.html">$allnamefields</a> = <a class="class" onClick="logClass('user_picture')" href="../../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('u', null, 'duserid');
<a name="l1551"><span class="linenum">1551</span></a>      if (!<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT p.*, f.type AS forumtype, d.forum, d.groupid,
<a name="l1552"><span class="linenum">1552</span></a>                                                d.timestart, d.timeend, <a class="var it8426" onMouseOver="hilite(8426)" onMouseOut="lolite()" onClick="logVariable('allnamefields')" href="../../_variables/allnamefields.html">$allnamefields</a>
<a name="l1553"><span class="linenum">1553</span></a>                                           FROM {forum_posts} p
<a name="l1554"><span class="linenum">1554</span></a>                                                JOIN {forum_discussions} d ON d.id = p.discussion
<a name="l1555"><span class="linenum">1555</span></a>                                                JOIN {forum} f             ON f.id = d.forum
<a name="l1556"><span class="linenum">1556</span></a>                                                JOIN {user} u              ON u.id = p.userid
<a name="l1557"><span class="linenum">1557</span></a>                                          WHERE p.created &gt; ? AND f.course = ?
<a name="l1558"><span class="linenum">1558</span></a>                                       ORDER BY p.id ASC&quot;, array(<a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) { // order by initial posting date
<a name="l1559"><span class="linenum">1559</span></a>           return false;
<a name="l1560"><span class="linenum">1560</span></a>      }
<a name="l1561"><span class="linenum">1561</span></a>  
<a name="l1562"><span class="linenum">1562</span></a>      <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l1563"><span class="linenum">1563</span></a>  
<a name="l1564"><span class="linenum">1564</span></a>      <a class="var it41524" onMouseOver="hilite(41524)" onMouseOut="lolite()" onClick="logVariable('groupmodes')" href="../../_variables/groupmodes.html">$groupmodes</a> = array();
<a name="l1565"><span class="linenum">1565</span></a>      <a class="var it698" onMouseOver="hilite(698)" onMouseOut="lolite()" onClick="logVariable('cms')" href="../../_variables/cms.html">$cms</a>    = array();
<a name="l1566"><span class="linenum">1566</span></a>  
<a name="l1567"><span class="linenum">1567</span></a>      <a class="var it12571" onMouseOver="hilite(12571)" onMouseOut="lolite()" onClick="logVariable('strftimerecent')" href="../../_variables/strftimerecent.html">$strftimerecent</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimerecent');
<a name="l1568"><span class="linenum">1568</span></a>  
<a name="l1569"><span class="linenum">1569</span></a>      <a class="var it41525" onMouseOver="hilite(41525)" onMouseOut="lolite()" onClick="logVariable('printposts')" href="../../_variables/printposts.html">$printposts</a> = array();
<a name="l1570"><span class="linenum">1570</span></a>      foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l1571"><span class="linenum">1571</span></a>          if (!isset(<a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('instances')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/instances.html">instances</a>['forum'][<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>])) {
<a name="l1572"><span class="linenum">1572</span></a>  <span class="comment">            // not visible</span>
<a name="l1573"><span class="linenum">1573</span></a>              continue;
<a name="l1574"><span class="linenum">1574</span></a>          }
<a name="l1575"><span class="linenum">1575</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('instances')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/instances.html">instances</a>['forum'][<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>];
<a name="l1576"><span class="linenum">1576</span></a>          if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('uservisible')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/uservisible.html">uservisible</a>) {
<a name="l1577"><span class="linenum">1577</span></a>              continue;
<a name="l1578"><span class="linenum">1578</span></a>          }
<a name="l1579"><span class="linenum">1579</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1580"><span class="linenum">1580</span></a>  
<a name="l1581"><span class="linenum">1581</span></a>          if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1582"><span class="linenum">1582</span></a>              continue;
<a name="l1583"><span class="linenum">1583</span></a>          }
<a name="l1584"><span class="linenum">1584</span></a>  
<a name="l1585"><span class="linenum">1585</span></a>          if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>) and <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> != <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;duserid
<a name="l1586"><span class="linenum">1586</span></a>            and ((<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timestart')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> &gt; 0 and <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timestart')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> &gt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) <a class="function" onClick="logFunction('or')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timeend')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a> &gt; 0 and <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timeend')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()))) {
<a name="l1587"><span class="linenum">1587</span></a>              if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1588"><span class="linenum">1588</span></a>                  continue;
<a name="l1589"><span class="linenum">1589</span></a>              }
<a name="l1590"><span class="linenum">1590</span></a>          }
<a name="l1591"><span class="linenum">1591</span></a>  
<a name="l1592"><span class="linenum">1592</span></a>  <span class="comment">        // Check that the user can see the discussion.</span>
<a name="l1593"><span class="linenum">1593</span></a>          if (<a class="function" onClick="logFunction('forum_is_user_group_discussion')" href="../../_functions/forum_is_user_group_discussion.html" onMouseOver="funcPopup(event,'forum_is_user_group_discussion')">forum_is_user_group_discussion</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('groupid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>)) {
<a name="l1594"><span class="linenum">1594</span></a>              <a class="var it41525" onMouseOver="hilite(41525)" onMouseOut="lolite()" onClick="logVariable('printposts')" href="../../_variables/printposts.html">$printposts</a>[] = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>;
<a name="l1595"><span class="linenum">1595</span></a>          }
<a name="l1596"><span class="linenum">1596</span></a>  
<a name="l1597"><span class="linenum">1597</span></a>      }
<a name="l1598"><span class="linenum">1598</span></a>      unset(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>);
<a name="l1599"><span class="linenum">1599</span></a>  
<a name="l1600"><span class="linenum">1600</span></a>      if (!<a class="var it41525" onMouseOver="hilite(41525)" onMouseOut="lolite()" onClick="logVariable('printposts')" href="../../_variables/printposts.html">$printposts</a>) {
<a name="l1601"><span class="linenum">1601</span></a>          return false;
<a name="l1602"><span class="linenum">1602</span></a>      }
<a name="l1603"><span class="linenum">1603</span></a>  
<a name="l1604"><span class="linenum">1604</span></a>      echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('heading')" href="../../_functions/heading.html" onMouseOver="funcPopup(event,'heading')">heading</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('newforumposts', 'forum').':', 3);
<a name="l1605"><span class="linenum">1605</span></a>      <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> = <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('ul', ['class' =&gt; 'unlist']);
<a name="l1606"><span class="linenum">1606</span></a>  
<a name="l1607"><span class="linenum">1607</span></a>      foreach (<a class="var it41525" onMouseOver="hilite(41525)" onMouseOut="lolite()" onClick="logVariable('printposts')" href="../../_variables/printposts.html">$printposts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l1608"><span class="linenum">1608</span></a>          <a class="var it41526" onMouseOver="hilite(41526)" onMouseOut="lolite()" onClick="logVariable('subjectclass')" href="../../_variables/subjectclass.html">$subjectclass</a> = empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>) ? ' bold' : '';
<a name="l1609"><span class="linenum">1609</span></a>          <a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a> = <a class="function" onClick="logFunction('forum_is_author_hidden')" href="../../_functions/forum_is_author_hidden.html" onMouseOver="funcPopup(event,'forum_is_author_hidden')">forum_is_author_hidden</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, (object) ['type' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forumtype')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forumtype.html">forumtype</a>]);
<a name="l1610"><span class="linenum">1610</span></a>  
<a name="l1611"><span class="linenum">1611</span></a>          <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('li');
<a name="l1612"><span class="linenum">1612</span></a>          <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_div')" href="../../_functions/start_div.html" onMouseOver="funcPopup(event,'start_div')">start_div</a>('head');
<a name="l1613"><span class="linenum">1613</span></a>          <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('div')" href="../../_functions/div.html" onMouseOver="funcPopup(event,'div')">div</a>(<a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>, <a class="var it12571" onMouseOver="hilite(12571)" onMouseOut="lolite()" onClick="logVariable('strftimerecent')" href="../../_variables/strftimerecent.html">$strftimerecent</a>), 'date');
<a name="l1614"><span class="linenum">1614</span></a>          if (!<a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a>) {
<a name="l1615"><span class="linenum">1615</span></a>              <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('div')" href="../../_functions/div.html" onMouseOver="funcPopup(event,'div')">div</a>(<a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it5397" onMouseOver="hilite(5397)" onMouseOut="lolite()" onClick="logVariable('viewfullnames')" href="../../_variables/viewfullnames.html">$viewfullnames</a>), 'name');
<a name="l1616"><span class="linenum">1616</span></a>          }
<a name="l1617"><span class="linenum">1617</span></a>          <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_div')" href="../../_functions/end_div.html" onMouseOver="funcPopup(event,'end_div')">end_div</a>(); <span class="comment">// Head.</span>
<a name="l1618"><span class="linenum">1618</span></a>  
<a name="l1619"><span class="linenum">1619</span></a>          <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_div')" href="../../_functions/start_div.html" onMouseOver="funcPopup(event,'start_div')">start_div</a>('info' . <a class="var it41526" onMouseOver="hilite(41526)" onMouseOut="lolite()" onClick="logVariable('subjectclass')" href="../../_variables/subjectclass.html">$subjectclass</a>);
<a name="l1620"><span class="linenum">1620</span></a>          <a class="var it7455" onMouseOver="hilite(7455)" onMouseOut="lolite()" onClick="logVariable('discussionurl')" href="../../_variables/discussionurl.html">$discussionurl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/discuss.php.html">/mod/forum/discuss.php</a>', ['d' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>]);
<a name="l1621"><span class="linenum">1621</span></a>          if (!empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>)) {
<a name="l1622"><span class="linenum">1622</span></a>              <a class="var it7455" onMouseOver="hilite(7455)" onMouseOut="lolite()" onClick="logVariable('discussionurl')" href="../../_variables/discussionurl.html">$discussionurl</a>-&gt;<a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>('parent', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>);
<a name="l1623"><span class="linenum">1623</span></a>              <a class="var it7455" onMouseOver="hilite(7455)" onMouseOut="lolite()" onClick="logVariable('discussionurl')" href="../../_variables/discussionurl.html">$discussionurl</a>-&gt;<a class="function" onClick="logFunction('set_anchor')" href="../../_functions/set_anchor.html" onMouseOver="funcPopup(event,'set_anchor')">set_anchor</a>('p'. <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1624"><span class="linenum">1624</span></a>          }
<a name="l1625"><span class="linenum">1625</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a> = <a class="function" onClick="logFunction('break_up_long_words')" href="../../_functions/break_up_long_words.html" onMouseOver="funcPopup(event,'break_up_long_words')">break_up_long_words</a>(<a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>, true));
<a name="l1626"><span class="linenum">1626</span></a>          <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it7455" onMouseOver="hilite(7455)" onMouseOut="lolite()" onClick="logVariable('discussionurl')" href="../../_variables/discussionurl.html">$discussionurl</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>);
<a name="l1627"><span class="linenum">1627</span></a>          <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_div')" href="../../_functions/end_div.html" onMouseOver="funcPopup(event,'end_div')">end_div</a>(); <span class="comment">// Info.</span>
<a name="l1628"><span class="linenum">1628</span></a>          <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('li');
<a name="l1629"><span class="linenum">1629</span></a>      }
<a name="l1630"><span class="linenum">1630</span></a>  
<a name="l1631"><span class="linenum">1631</span></a>      <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('ul');
<a name="l1632"><span class="linenum">1632</span></a>      echo <a class="var it567" onMouseOver="hilite(567)" onMouseOut="lolite()" onClick="logVariable('list')" href="../../_variables/list.html">$list</a>;
<a name="l1633"><span class="linenum">1633</span></a>  
<a name="l1634"><span class="linenum">1634</span></a>      return true;
<a name="l1635"><span class="linenum">1635</span></a>  }
<a name="l1636"><span class="linenum">1636</span></a>  
<a name="l1637"><span class="linenum">1637</span></a>  <span class="comment">/**</span>
<a name="l1638"><span class="linenum">1638</span></a>  <span class="comment"> * Return grade for given user or all users.</span>
<a name="l1639"><span class="linenum">1639</span></a>  <span class="comment"> *</span>
<a name="l1640"><span class="linenum">1640</span></a>  <span class="comment"> * @global object</span>
<a name="l1641"><span class="linenum">1641</span></a>  <span class="comment"> * @global object</span>
<a name="l1642"><span class="linenum">1642</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l1643"><span class="linenum">1643</span></a>  <span class="comment"> * @param int $userid optional user id, 0 means all users</span>
<a name="l1644"><span class="linenum">1644</span></a>  <span class="comment"> * @return array array of grades, false if none</span>
<a name="l1645"><span class="linenum">1645</span></a>  <span class="comment"> */</span>
<a name="l1646"><span class="linenum">1646</span></a>  function <a class="function" onClick="logFunction('forum_get_user_grades')" href="../../_functions/forum_get_user_grades.html" onMouseOver="funcPopup(event,'forum_get_user_grades')">forum_get_user_grades</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = 0) {
<a name="l1647"><span class="linenum">1647</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1648"><span class="linenum">1648</span></a>  
<a name="l1649"><span class="linenum">1649</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../rating/lib.php.html">/rating/lib.php</a>');
<a name="l1650"><span class="linenum">1650</span></a>  
<a name="l1651"><span class="linenum">1651</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a> = new stdClass;
<a name="l1652"><span class="linenum">1652</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('component')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = 'mod_forum';
<a name="l1653"><span class="linenum">1653</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('ratingarea')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/ratingarea.html">ratingarea</a> = 'post';
<a name="l1654"><span class="linenum">1654</span></a>  
<a name="l1655"><span class="linenum">1655</span></a>  <span class="comment">    //need these to work backwards to get a context id. Is there a better way to get contextid from a module instance?</span>
<a name="l1656"><span class="linenum">1656</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('modulename')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a> = 'forum';
<a name="l1657"><span class="linenum">1657</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('moduleid')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/moduleid.html">moduleid</a>   = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1658"><span class="linenum">1658</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('userid')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l1659"><span class="linenum">1659</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('aggregationmethod')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/aggregationmethod.html">aggregationmethod</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>;
<a name="l1660"><span class="linenum">1660</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('scaleid')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>;
<a name="l1661"><span class="linenum">1661</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('itemtable')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/itemtable.html">itemtable</a> = 'forum_posts';
<a name="l1662"><span class="linenum">1662</span></a>      <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('itemtableusercolumn')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/itemtableusercolumn.html">itemtableusercolumn</a> = 'userid';
<a name="l1663"><span class="linenum">1663</span></a>  
<a name="l1664"><span class="linenum">1664</span></a>      <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a> = <span class="keyword">new </span><a class="class" onClick="logClass('rating_manager')" href="../../_classes/rating_manager.html" onMouseOver="classPopup(event,'rating_manager')">rating_manager</a>();
<a name="l1665"><span class="linenum">1665</span></a>      return <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a>-&gt;<a class="function" onClick="logFunction('get_user_grades')" href="../../_functions/get_user_grades.html" onMouseOver="funcPopup(event,'get_user_grades')">get_user_grades</a>(<a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>);
<a name="l1666"><span class="linenum">1666</span></a>  }
<a name="l1667"><span class="linenum">1667</span></a>  
<a name="l1668"><span class="linenum">1668</span></a>  <span class="comment">/**</span>
<a name="l1669"><span class="linenum">1669</span></a>  <span class="comment"> * Update activity grades</span>
<a name="l1670"><span class="linenum">1670</span></a>  <span class="comment"> *</span>
<a name="l1671"><span class="linenum">1671</span></a>  <span class="comment"> * @category grade</span>
<a name="l1672"><span class="linenum">1672</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l1673"><span class="linenum">1673</span></a>  <span class="comment"> * @param int $userid specific user only, 0 means all</span>
<a name="l1674"><span class="linenum">1674</span></a>  <span class="comment"> * @param boolean $nullifnone return null if grade does not exist</span>
<a name="l1675"><span class="linenum">1675</span></a>  <span class="comment"> * @return void</span>
<a name="l1676"><span class="linenum">1676</span></a>  <span class="comment"> */</span>
<a name="l1677"><span class="linenum">1677</span></a>  function <a class="function" onClick="logFunction('forum_update_grades')" href="../../_functions/forum_update_grades.html" onMouseOver="funcPopup(event,'forum_update_grades')">forum_update_grades</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=0, <a class="var it9796" onMouseOver="hilite(9796)" onMouseOut="lolite()" onClick="logVariable('nullifnone')" href="../../_variables/nullifnone.html">$nullifnone</a>=true) {
<a name="l1678"><span class="linenum">1678</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1679"><span class="linenum">1679</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/gradelib.php');
<a name="l1680"><span class="linenum">1680</span></a>  
<a name="l1681"><span class="linenum">1681</span></a>      if (!<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>) {
<a name="l1682"><span class="linenum">1682</span></a>          <a class="function" onClick="logFunction('forum_grade_item_update')" href="../../_functions/forum_grade_item_update.html" onMouseOver="funcPopup(event,'forum_grade_item_update')">forum_grade_item_update</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l1683"><span class="linenum">1683</span></a>  
<a name="l1684"><span class="linenum">1684</span></a>      } else if (<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="function" onClick="logFunction('forum_get_user_grades')" href="../../_functions/forum_get_user_grades.html" onMouseOver="funcPopup(event,'forum_get_user_grades')">forum_get_user_grades</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l1685"><span class="linenum">1685</span></a>          <a class="function" onClick="logFunction('forum_grade_item_update')" href="../../_functions/forum_grade_item_update.html" onMouseOver="funcPopup(event,'forum_grade_item_update')">forum_grade_item_update</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l1686"><span class="linenum">1686</span></a>  
<a name="l1687"><span class="linenum">1687</span></a>      } else if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> and <a class="var it9796" onMouseOver="hilite(9796)" onMouseOut="lolite()" onClick="logVariable('nullifnone')" href="../../_variables/nullifnone.html">$nullifnone</a>) {
<a name="l1688"><span class="linenum">1688</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = new stdClass();
<a name="l1689"><span class="linenum">1689</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('userid')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>   = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l1690"><span class="linenum">1690</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a> = NULL;
<a name="l1691"><span class="linenum">1691</span></a>          <a class="function" onClick="logFunction('forum_grade_item_update')" href="../../_functions/forum_grade_item_update.html" onMouseOver="funcPopup(event,'forum_grade_item_update')">forum_grade_item_update</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>);
<a name="l1692"><span class="linenum">1692</span></a>  
<a name="l1693"><span class="linenum">1693</span></a>      } else {
<a name="l1694"><span class="linenum">1694</span></a>          <a class="function" onClick="logFunction('forum_grade_item_update')" href="../../_functions/forum_grade_item_update.html" onMouseOver="funcPopup(event,'forum_grade_item_update')">forum_grade_item_update</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l1695"><span class="linenum">1695</span></a>      }
<a name="l1696"><span class="linenum">1696</span></a>  }
<a name="l1697"><span class="linenum">1697</span></a>  
<a name="l1698"><span class="linenum">1698</span></a>  <span class="comment">/**</span>
<a name="l1699"><span class="linenum">1699</span></a>  <span class="comment"> * Create/update grade item for given forum</span>
<a name="l1700"><span class="linenum">1700</span></a>  <span class="comment"> *</span>
<a name="l1701"><span class="linenum">1701</span></a>  <span class="comment"> * @category grade</span>
<a name="l1702"><span class="linenum">1702</span></a>  <span class="comment"> * @uses GRADE_TYPE_NONE</span>
<a name="l1703"><span class="linenum">1703</span></a>  <span class="comment"> * @uses GRADE_TYPE_VALUE</span>
<a name="l1704"><span class="linenum">1704</span></a>  <span class="comment"> * @uses GRADE_TYPE_SCALE</span>
<a name="l1705"><span class="linenum">1705</span></a>  <span class="comment"> * @param stdClass $forum Forum object with extra cmidnumber</span>
<a name="l1706"><span class="linenum">1706</span></a>  <span class="comment"> * @param mixed $grades Optional array/object of grade(s); 'reset' means reset grades in gradebook</span>
<a name="l1707"><span class="linenum">1707</span></a>  <span class="comment"> * @return int 0 if ok</span>
<a name="l1708"><span class="linenum">1708</span></a>  <span class="comment"> */</span>
<a name="l1709"><span class="linenum">1709</span></a>  function <a class="function" onClick="logFunction('forum_grade_item_update')" href="../../_functions/forum_grade_item_update.html" onMouseOver="funcPopup(event,'forum_grade_item_update')">forum_grade_item_update</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>=NULL) {
<a name="l1710"><span class="linenum">1710</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1711"><span class="linenum">1711</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('grade_update')) { //workaround for buggy PHP versions
<a name="l1712"><span class="linenum">1712</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/gradelib.php');
<a name="l1713"><span class="linenum">1713</span></a>      }
<a name="l1714"><span class="linenum">1714</span></a>  
<a name="l1715"><span class="linenum">1715</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('itemname'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>, 'idnumber'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/cmidnumber.html">cmidnumber</a>);
<a name="l1716"><span class="linenum">1716</span></a>  
<a name="l1717"><span class="linenum">1717</span></a>      if (!<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a> or <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> == 0) {
<a name="l1718"><span class="linenum">1718</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gradetype'] = <a class="constant" onClick="logConstant('GRADE_TYPE_NONE')" href="../../_constants/GRADE_TYPE_NONE.html" onMouseOver="constPopup(event,'GRADE_TYPE_NONE')">GRADE_TYPE_NONE</a>;
<a name="l1719"><span class="linenum">1719</span></a>  
<a name="l1720"><span class="linenum">1720</span></a>      } else if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> &gt; 0) {
<a name="l1721"><span class="linenum">1721</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gradetype'] = <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a>;
<a name="l1722"><span class="linenum">1722</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademax']  = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>;
<a name="l1723"><span class="linenum">1723</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademin']  = 0;
<a name="l1724"><span class="linenum">1724</span></a>  
<a name="l1725"><span class="linenum">1725</span></a>      } else if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> &lt; 0) {
<a name="l1726"><span class="linenum">1726</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gradetype'] = <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>;
<a name="l1727"><span class="linenum">1727</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['scaleid']   = -<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>;
<a name="l1728"><span class="linenum">1728</span></a>      }
<a name="l1729"><span class="linenum">1729</span></a>  
<a name="l1730"><span class="linenum">1730</span></a>      if (<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>  === 'reset') {
<a name="l1731"><span class="linenum">1731</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['reset'] = true;
<a name="l1732"><span class="linenum">1732</span></a>          <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = NULL;
<a name="l1733"><span class="linenum">1733</span></a>      }
<a name="l1734"><span class="linenum">1734</span></a>  
<a name="l1735"><span class="linenum">1735</span></a>      return <a class="function" onClick="logFunction('grade_update')" href="../../_functions/grade_update.html" onMouseOver="funcPopup(event,'grade_update')">grade_update</a>('mod/forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, 'mod', 'forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 0, <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1736"><span class="linenum">1736</span></a>  }
<a name="l1737"><span class="linenum">1737</span></a>  
<a name="l1738"><span class="linenum">1738</span></a>  <span class="comment">/**</span>
<a name="l1739"><span class="linenum">1739</span></a>  <span class="comment"> * Delete grade item for given forum</span>
<a name="l1740"><span class="linenum">1740</span></a>  <span class="comment"> *</span>
<a name="l1741"><span class="linenum">1741</span></a>  <span class="comment"> * @category grade</span>
<a name="l1742"><span class="linenum">1742</span></a>  <span class="comment"> * @param stdClass $forum Forum object</span>
<a name="l1743"><span class="linenum">1743</span></a>  <span class="comment"> * @return grade_item</span>
<a name="l1744"><span class="linenum">1744</span></a>  <span class="comment"> */</span>
<a name="l1745"><span class="linenum">1745</span></a>  function <a class="function" onClick="logFunction('forum_grade_item_delete')" href="../../_functions/forum_grade_item_delete.html" onMouseOver="funcPopup(event,'forum_grade_item_delete')">forum_grade_item_delete</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l1746"><span class="linenum">1746</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1747"><span class="linenum">1747</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/gradelib.php');
<a name="l1748"><span class="linenum">1748</span></a>  
<a name="l1749"><span class="linenum">1749</span></a>      return <a class="function" onClick="logFunction('grade_update')" href="../../_functions/grade_update.html" onMouseOver="funcPopup(event,'grade_update')">grade_update</a>('mod/forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, 'mod', 'forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 0, NULL, array('deleted'=&gt;1));
<a name="l1750"><span class="linenum">1750</span></a>  }
<a name="l1751"><span class="linenum">1751</span></a>  
<a name="l1752"><span class="linenum">1752</span></a>  
<a name="l1753"><span class="linenum">1753</span></a>  <span class="comment">/**</span>
<a name="l1754"><span class="linenum">1754</span></a>  <span class="comment"> * This function returns if a scale is being used by one forum</span>
<a name="l1755"><span class="linenum">1755</span></a>  <span class="comment"> *</span>
<a name="l1756"><span class="linenum">1756</span></a>  <span class="comment"> * @global object</span>
<a name="l1757"><span class="linenum">1757</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l1758"><span class="linenum">1758</span></a>  <span class="comment"> * @param int $scaleid negative number</span>
<a name="l1759"><span class="linenum">1759</span></a>  <span class="comment"> * @return bool</span>
<a name="l1760"><span class="linenum">1760</span></a>  <span class="comment"> */</span>
<a name="l1761"><span class="linenum">1761</span></a>  function <a class="function" onClick="logFunction('forum_scale_used')" href="../../_functions/forum_scale_used.html" onMouseOver="funcPopup(event,'forum_scale_used')">forum_scale_used</a> (<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>,<a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>) {
<a name="l1762"><span class="linenum">1762</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1763"><span class="linenum">1763</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = false;
<a name="l1764"><span class="linenum">1764</span></a>  
<a name="l1765"><span class="linenum">1765</span></a>      <a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(&quot;forum&quot;,array(&quot;id&quot; =&gt; &quot;<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>&quot;,&quot;scale&quot; =&gt; &quot;-<a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>&quot;));
<a name="l1766"><span class="linenum">1766</span></a>  
<a name="l1767"><span class="linenum">1767</span></a>      if (!empty(<a class="var it1069" onMouseOver="hilite(1069)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>) &amp;&amp; !empty(<a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>)) {
<a name="l1768"><span class="linenum">1768</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = true;
<a name="l1769"><span class="linenum">1769</span></a>      }
<a name="l1770"><span class="linenum">1770</span></a>  
<a name="l1771"><span class="linenum">1771</span></a>      return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l1772"><span class="linenum">1772</span></a>  }
<a name="l1773"><span class="linenum">1773</span></a>  
<a name="l1774"><span class="linenum">1774</span></a>  <span class="comment">/**</span>
<a name="l1775"><span class="linenum">1775</span></a>  <span class="comment"> * Checks if scale is being used by any instance of forum</span>
<a name="l1776"><span class="linenum">1776</span></a>  <span class="comment"> *</span>
<a name="l1777"><span class="linenum">1777</span></a>  <span class="comment"> * This is used to find out if scale used anywhere</span>
<a name="l1778"><span class="linenum">1778</span></a>  <span class="comment"> *</span>
<a name="l1779"><span class="linenum">1779</span></a>  <span class="comment"> * @global object</span>
<a name="l1780"><span class="linenum">1780</span></a>  <span class="comment"> * @param $scaleid int</span>
<a name="l1781"><span class="linenum">1781</span></a>  <span class="comment"> * @return boolean True if the scale is used by any forum</span>
<a name="l1782"><span class="linenum">1782</span></a>  <span class="comment"> */</span>
<a name="l1783"><span class="linenum">1783</span></a>  function <a class="function" onClick="logFunction('forum_scale_used_anywhere')" href="../../_functions/forum_scale_used_anywhere.html" onMouseOver="funcPopup(event,'forum_scale_used_anywhere')">forum_scale_used_anywhere</a>(<a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>) {
<a name="l1784"><span class="linenum">1784</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1785"><span class="linenum">1785</span></a>      if (<a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a> and <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('forum', array('scale' =&gt; -<a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>))) {
<a name="l1786"><span class="linenum">1786</span></a>          return true;
<a name="l1787"><span class="linenum">1787</span></a>      } else {
<a name="l1788"><span class="linenum">1788</span></a>          return false;
<a name="l1789"><span class="linenum">1789</span></a>      }
<a name="l1790"><span class="linenum">1790</span></a>  }
<a name="l1791"><span class="linenum">1791</span></a>  
<a name="l1792"><span class="linenum">1792</span></a>  <span class="comment">// SQL FUNCTIONS ///////////////////////////////////////////////////////////</span>
<a name="l1793"><span class="linenum">1793</span></a>  
<a name="l1794"><span class="linenum">1794</span></a>  <span class="comment">/**</span>
<a name="l1795"><span class="linenum">1795</span></a>  <span class="comment"> * Gets a post with all info ready for forum_print_post</span>
<a name="l1796"><span class="linenum">1796</span></a>  <span class="comment"> * Most of these joins are just to get the forum id</span>
<a name="l1797"><span class="linenum">1797</span></a>  <span class="comment"> *</span>
<a name="l1798"><span class="linenum">1798</span></a>  <span class="comment"> * @global object</span>
<a name="l1799"><span class="linenum">1799</span></a>  <span class="comment"> * @global object</span>
<a name="l1800"><span class="linenum">1800</span></a>  <span class="comment"> * @param int $postid</span>
<a name="l1801"><span class="linenum">1801</span></a>  <span class="comment"> * @return mixed array of posts or false</span>
<a name="l1802"><span class="linenum">1802</span></a>  <span class="comment"> */</span>
<a name="l1803"><span class="linenum">1803</span></a>  function <a class="function" onClick="logFunction('forum_get_post_full')" href="../../_functions/forum_get_post_full.html" onMouseOver="funcPopup(event,'forum_get_post_full')">forum_get_post_full</a>(<a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>) {
<a name="l1804"><span class="linenum">1804</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1805"><span class="linenum">1805</span></a>  
<a name="l1806"><span class="linenum">1806</span></a>      <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u');
<a name="l1807"><span class="linenum">1807</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT p.*, d.forum, <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a>, u.email, u.picture, u.imagealt
<a name="l1808"><span class="linenum">1808</span></a>                               FROM {forum_posts} p
<a name="l1809"><span class="linenum">1809</span></a>                                    JOIN {forum_discussions} d ON p.discussion = d.id
<a name="l1810"><span class="linenum">1810</span></a>                                    LEFT JOIN {user} u ON p.userid = u.id
<a name="l1811"><span class="linenum">1811</span></a>                              WHERE p.id = ?&quot;, array(<a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>));
<a name="l1812"><span class="linenum">1812</span></a>  }
<a name="l1813"><span class="linenum">1813</span></a>  
<a name="l1814"><span class="linenum">1814</span></a>  <span class="comment">/**</span>
<a name="l1815"><span class="linenum">1815</span></a>  <span class="comment"> * Gets all posts in discussion including top parent.</span>
<a name="l1816"><span class="linenum">1816</span></a>  <span class="comment"> *</span>
<a name="l1817"><span class="linenum">1817</span></a>  <span class="comment"> * @global object</span>
<a name="l1818"><span class="linenum">1818</span></a>  <span class="comment"> * @global object</span>
<a name="l1819"><span class="linenum">1819</span></a>  <span class="comment"> * @global object</span>
<a name="l1820"><span class="linenum">1820</span></a>  <span class="comment"> * @param int $discussionid</span>
<a name="l1821"><span class="linenum">1821</span></a>  <span class="comment"> * @param string $sort</span>
<a name="l1822"><span class="linenum">1822</span></a>  <span class="comment"> * @param bool $tracking does user track the forum?</span>
<a name="l1823"><span class="linenum">1823</span></a>  <span class="comment"> * @return array of posts</span>
<a name="l1824"><span class="linenum">1824</span></a>  <span class="comment"> */</span>
<a name="l1825"><span class="linenum">1825</span></a>  function <a class="function" onClick="logFunction('forum_get_all_discussion_posts')" href="../../_functions/forum_get_all_discussion_posts.html" onMouseOver="funcPopup(event,'forum_get_all_discussion_posts')">forum_get_all_discussion_posts</a>(<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>, <a class="var it41529" onMouseOver="hilite(41529)" onMouseOut="lolite()" onClick="logVariable('tracking')" href="../../_variables/tracking.html">$tracking</a>=false) {
<a name="l1826"><span class="linenum">1826</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l1827"><span class="linenum">1827</span></a>  
<a name="l1828"><span class="linenum">1828</span></a>      <a class="var it41530" onMouseOver="hilite(41530)" onMouseOut="lolite()" onClick="logVariable('tr_sel')" href="../../_variables/tr_sel.html">$tr_sel</a>  = &quot;&quot;;
<a name="l1829"><span class="linenum">1829</span></a>      <a class="var it41531" onMouseOver="hilite(41531)" onMouseOut="lolite()" onClick="logVariable('tr_join')" href="../../_variables/tr_join.html">$tr_join</a> = &quot;&quot;;
<a name="l1830"><span class="linenum">1830</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l1831"><span class="linenum">1831</span></a>  
<a name="l1832"><span class="linenum">1832</span></a>      if (<a class="var it41529" onMouseOver="hilite(41529)" onMouseOut="lolite()" onClick="logVariable('tracking')" href="../../_variables/tracking.html">$tracking</a>) {
<a name="l1833"><span class="linenum">1833</span></a>          <a class="var it41530" onMouseOver="hilite(41530)" onMouseOut="lolite()" onClick="logVariable('tr_sel')" href="../../_variables/tr_sel.html">$tr_sel</a>  = &quot;, fr.id AS postread&quot;;
<a name="l1834"><span class="linenum">1834</span></a>          <a class="var it41531" onMouseOver="hilite(41531)" onMouseOut="lolite()" onClick="logVariable('tr_join')" href="../../_variables/tr_join.html">$tr_join</a> = &quot;LEFT JOIN {forum_read} fr <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (fr.postid = p.id AND fr.userid = ?)&quot;;
<a name="l1835"><span class="linenum">1835</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1836"><span class="linenum">1836</span></a>      }
<a name="l1837"><span class="linenum">1837</span></a>  
<a name="l1838"><span class="linenum">1838</span></a>      <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u');
<a name="l1839"><span class="linenum">1839</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>;
<a name="l1840"><span class="linenum">1840</span></a>      if (!<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT p.*, <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a>, u.email, u.picture, u.imagealt <a class="var it41530" onMouseOver="hilite(41530)" onMouseOut="lolite()" onClick="logVariable('tr_sel')" href="../../_variables/tr_sel.html">$tr_sel</a>
<a name="l1841"><span class="linenum">1841</span></a>                                       FROM {forum_posts} p
<a name="l1842"><span class="linenum">1842</span></a>                                            LEFT JOIN {user} u ON p.userid = u.id
<a name="l1843"><span class="linenum">1843</span></a>                                            <a class="var it41531" onMouseOver="hilite(41531)" onMouseOut="lolite()" onClick="logVariable('tr_join')" href="../../_variables/tr_join.html">$tr_join</a>
<a name="l1844"><span class="linenum">1844</span></a>                                      WHERE p.discussion = ?
<a name="l1845"><span class="linenum">1845</span></a>                                   ORDER BY <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l1846"><span class="linenum">1846</span></a>          return array();
<a name="l1847"><span class="linenum">1847</span></a>      }
<a name="l1848"><span class="linenum">1848</span></a>  
<a name="l1849"><span class="linenum">1849</span></a>      foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>=&gt;<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>) {
<a name="l1850"><span class="linenum">1850</span></a>          if (<a class="var it41529" onMouseOver="hilite(41529)" onMouseOut="lolite()" onClick="logVariable('tracking')" href="../../_variables/tracking.html">$tracking</a>) {
<a name="l1851"><span class="linenum">1851</span></a>              if (<a class="function" onClick="logFunction('forum_tp_is_post_old')" href="../../_functions/forum_tp_is_post_old.html" onMouseOver="funcPopup(event,'forum_tp_is_post_old')">forum_tp_is_post_old</a>(<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>)) {
<a name="l1852"><span class="linenum">1852</span></a>                   <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>]-&gt;postread = true;
<a name="l1853"><span class="linenum">1853</span></a>              }
<a name="l1854"><span class="linenum">1854</span></a>          }
<a name="l1855"><span class="linenum">1855</span></a>          if (!<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>-&gt;<a onClick="logVariable('parent')" class="var it43186" onMouseOver="hilite(43186)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>) {
<a name="l1856"><span class="linenum">1856</span></a>              continue;
<a name="l1857"><span class="linenum">1857</span></a>          }
<a name="l1858"><span class="linenum">1858</span></a>          if (!isset(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>-&gt;<a onClick="logVariable('parent')" class="var it43186" onMouseOver="hilite(43186)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>])) {
<a name="l1859"><span class="linenum">1859</span></a>              continue; <span class="comment">// parent does not exist??</span>
<a name="l1860"><span class="linenum">1860</span></a>          }
<a name="l1861"><span class="linenum">1861</span></a>          if (!isset(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>-&gt;<a onClick="logVariable('parent')" class="var it43186" onMouseOver="hilite(43186)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>]-&gt;children)) {
<a name="l1862"><span class="linenum">1862</span></a>              <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>-&gt;<a onClick="logVariable('parent')" class="var it43186" onMouseOver="hilite(43186)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>]-&gt;children = array();
<a name="l1863"><span class="linenum">1863</span></a>          }
<a name="l1864"><span class="linenum">1864</span></a>          <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>-&gt;<a onClick="logVariable('parent')" class="var it43186" onMouseOver="hilite(43186)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>]-&gt;children[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>] =&amp; <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>];
<a name="l1865"><span class="linenum">1865</span></a>      }
<a name="l1866"><span class="linenum">1866</span></a>  
<a name="l1867"><span class="linenum">1867</span></a>  <span class="comment">    // Start with the last child of the first post.</span>
<a name="l1868"><span class="linenum">1868</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = &amp;<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>)-&gt;id];
<a name="l1869"><span class="linenum">1869</span></a>  
<a name="l1870"><span class="linenum">1870</span></a>      <a class="var it23996" onMouseOver="hilite(23996)" onMouseOut="lolite()" onClick="logVariable('lastpost')" href="../../_variables/lastpost.html">$lastpost</a> = false;
<a name="l1871"><span class="linenum">1871</span></a>      while (!<a class="var it23996" onMouseOver="hilite(23996)" onMouseOut="lolite()" onClick="logVariable('lastpost')" href="../../_variables/lastpost.html">$lastpost</a>) {
<a name="l1872"><span class="linenum">1872</span></a>          if (!isset(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('children')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/children.html">children</a>)) {
<a name="l1873"><span class="linenum">1873</span></a>              <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('lastpost')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/lastpost.html">lastpost</a> = true;
<a name="l1874"><span class="linenum">1874</span></a>              <a class="var it23996" onMouseOver="hilite(23996)" onMouseOut="lolite()" onClick="logVariable('lastpost')" href="../../_variables/lastpost.html">$lastpost</a> = true;
<a name="l1875"><span class="linenum">1875</span></a>          } else {
<a name="l1876"><span class="linenum">1876</span></a>  <span class="comment">             // Go to the last child of this post.</span>
<a name="l1877"><span class="linenum">1877</span></a>              <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = &amp;<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="phpfunction" onClick="logFunction('end')" href="../../_functions/end.html" onMouseOver="phpfuncPopup(event,'end')">end</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('children')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/children.html">children</a>)-&gt;id];
<a name="l1878"><span class="linenum">1878</span></a>          }
<a name="l1879"><span class="linenum">1879</span></a>      }
<a name="l1880"><span class="linenum">1880</span></a>  
<a name="l1881"><span class="linenum">1881</span></a>      return <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>;
<a name="l1882"><span class="linenum">1882</span></a>  }
<a name="l1883"><span class="linenum">1883</span></a>  
<a name="l1884"><span class="linenum">1884</span></a>  <span class="comment">/**</span>
<a name="l1885"><span class="linenum">1885</span></a>  <span class="comment"> * An array of forum objects that the user is allowed to read/search through.</span>
<a name="l1886"><span class="linenum">1886</span></a>  <span class="comment"> *</span>
<a name="l1887"><span class="linenum">1887</span></a>  <span class="comment"> * @global object</span>
<a name="l1888"><span class="linenum">1888</span></a>  <span class="comment"> * @global object</span>
<a name="l1889"><span class="linenum">1889</span></a>  <span class="comment"> * @global object</span>
<a name="l1890"><span class="linenum">1890</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l1891"><span class="linenum">1891</span></a>  <span class="comment"> * @param int $courseid if 0, we look for forums throughout the whole site.</span>
<a name="l1892"><span class="linenum">1892</span></a>  <span class="comment"> * @return array of forum objects, or false if no matches</span>
<a name="l1893"><span class="linenum">1893</span></a>  <span class="comment"> *         Forum objects have the following attributes:</span>
<a name="l1894"><span class="linenum">1894</span></a>  <span class="comment"> *         id, type, course, cmid, cmvisible, cmgroupmode, accessallgroups,</span>
<a name="l1895"><span class="linenum">1895</span></a>  <span class="comment"> *         viewhiddentimedposts</span>
<a name="l1896"><span class="linenum">1896</span></a>  <span class="comment"> */</span>
<a name="l1897"><span class="linenum">1897</span></a>  function <a class="function" onClick="logFunction('forum_get_readable_forums')" href="../../_functions/forum_get_readable_forums.html" onMouseOver="funcPopup(event,'forum_get_readable_forums')">forum_get_readable_forums</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>=0) {
<a name="l1898"><span class="linenum">1898</span></a>  
<a name="l1899"><span class="linenum">1899</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l1900"><span class="linenum">1900</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../course/lib.php.html">/course/lib.php</a>');
<a name="l1901"><span class="linenum">1901</span></a>  
<a name="l1902"><span class="linenum">1902</span></a>      if (!<a class="var it41532" onMouseOver="hilite(41532)" onMouseOut="lolite()" onClick="logVariable('forummod')" href="../../_variables/forummod.html">$forummod</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('modules', array('name' =&gt; 'forum'))) {
<a name="l1903"><span class="linenum">1903</span></a>          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('notinstalled', 'forum');
<a name="l1904"><span class="linenum">1904</span></a>      }
<a name="l1905"><span class="linenum">1905</span></a>  
<a name="l1906"><span class="linenum">1906</span></a>      if (<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l1907"><span class="linenum">1907</span></a>          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('course', array('id' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>));
<a name="l1908"><span class="linenum">1908</span></a>      } else {
<a name="l1909"><span class="linenum">1909</span></a>  <span class="comment">        // If no course is specified, then the user can see SITE + his courses.</span>
<a name="l1910"><span class="linenum">1910</span></a>          <a class="var it41533" onMouseOver="hilite(41533)" onMouseOut="lolite()" onClick="logVariable('courses1')" href="../../_variables/courses1.html">$courses1</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('course', array('id' =&gt; <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>));
<a name="l1911"><span class="linenum">1911</span></a>          <a class="var it41534" onMouseOver="hilite(41534)" onMouseOut="lolite()" onClick="logVariable('courses2')" href="../../_variables/courses2.html">$courses2</a> = <a class="function" onClick="logFunction('enrol_get_users_courses')" href="../../_functions/enrol_get_users_courses.html" onMouseOver="funcPopup(event,'enrol_get_users_courses')">enrol_get_users_courses</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, true, array('modinfo'));
<a name="l1912"><span class="linenum">1912</span></a>          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it41533" onMouseOver="hilite(41533)" onMouseOut="lolite()" onClick="logVariable('courses1')" href="../../_variables/courses1.html">$courses1</a>, <a class="var it41534" onMouseOver="hilite(41534)" onMouseOut="lolite()" onClick="logVariable('courses2')" href="../../_variables/courses2.html">$courses2</a>);
<a name="l1913"><span class="linenum">1913</span></a>      }
<a name="l1914"><span class="linenum">1914</span></a>      if (!<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>) {
<a name="l1915"><span class="linenum">1915</span></a>          return array();
<a name="l1916"><span class="linenum">1916</span></a>      }
<a name="l1917"><span class="linenum">1917</span></a>  
<a name="l1918"><span class="linenum">1918</span></a>      <a class="var it41535" onMouseOver="hilite(41535)" onMouseOut="lolite()" onClick="logVariable('readableforums')" href="../../_variables/readableforums.html">$readableforums</a> = array();
<a name="l1919"><span class="linenum">1919</span></a>  
<a name="l1920"><span class="linenum">1920</span></a>      foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l1921"><span class="linenum">1921</span></a>  
<a name="l1922"><span class="linenum">1922</span></a>          <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l1923"><span class="linenum">1923</span></a>  
<a name="l1924"><span class="linenum">1924</span></a>          if (empty(<a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('instances')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/instances.html">instances</a>['forum'])) {
<a name="l1925"><span class="linenum">1925</span></a>  <span class="comment">            // hmm, no forums?</span>
<a name="l1926"><span class="linenum">1926</span></a>              continue;
<a name="l1927"><span class="linenum">1927</span></a>          }
<a name="l1928"><span class="linenum">1928</span></a>  
<a name="l1929"><span class="linenum">1929</span></a>          <a class="var it41536" onMouseOver="hilite(41536)" onMouseOut="lolite()" onClick="logVariable('courseforums')" href="../../_variables/courseforums.html">$courseforums</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('forum', array('course' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1930"><span class="linenum">1930</span></a>  
<a name="l1931"><span class="linenum">1931</span></a>          foreach (<a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('instances')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/instances.html">instances</a>['forum'] as <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a> =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l1932"><span class="linenum">1932</span></a>              if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('uservisible')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/uservisible.html">uservisible</a> or !isset(<a class="var it41536" onMouseOver="hilite(41536)" onMouseOut="lolite()" onClick="logVariable('courseforums')" href="../../_variables/courseforums.html">$courseforums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>])) {
<a name="l1933"><span class="linenum">1933</span></a>                  continue;
<a name="l1934"><span class="linenum">1934</span></a>              }
<a name="l1935"><span class="linenum">1935</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1936"><span class="linenum">1936</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it41536" onMouseOver="hilite(41536)" onMouseOut="lolite()" onClick="logVariable('courseforums')" href="../../_variables/courseforums.html">$courseforums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>];
<a name="l1937"><span class="linenum">1937</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('context')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/context.html">context</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>;
<a name="l1938"><span class="linenum">1938</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('cm')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a> = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>;
<a name="l1939"><span class="linenum">1939</span></a>  
<a name="l1940"><span class="linenum">1940</span></a>              if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1941"><span class="linenum">1941</span></a>                  continue;
<a name="l1942"><span class="linenum">1942</span></a>              }
<a name="l1943"><span class="linenum">1943</span></a>  
<a name="l1944"><span class="linenum">1944</span></a>  <span class="comment">         /// group access</span>
<a name="l1945"><span class="linenum">1945</span></a>              if (<a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) == <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a> and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1946"><span class="linenum">1946</span></a>  
<a name="l1947"><span class="linenum">1947</span></a>                  <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('onlygroups')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/onlygroups.html">onlygroups</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_groups')" href="../../_functions/get_groups.html" onMouseOver="funcPopup(event,'get_groups')">get_groups</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>);
<a name="l1948"><span class="linenum">1948</span></a>                  <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('onlygroups')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/onlygroups.html">onlygroups</a>[] = -1;
<a name="l1949"><span class="linenum">1949</span></a>              }
<a name="l1950"><span class="linenum">1950</span></a>  
<a name="l1951"><span class="linenum">1951</span></a>  <span class="comment">        /// hidden timed discussions</span>
<a name="l1952"><span class="linenum">1952</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('viewhiddentimedposts')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/viewhiddentimedposts.html">viewhiddentimedposts</a> = true;
<a name="l1953"><span class="linenum">1953</span></a>              if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l1954"><span class="linenum">1954</span></a>                  if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1955"><span class="linenum">1955</span></a>                      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('viewhiddentimedposts')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/viewhiddentimedposts.html">viewhiddentimedposts</a> = false;
<a name="l1956"><span class="linenum">1956</span></a>                  }
<a name="l1957"><span class="linenum">1957</span></a>              }
<a name="l1958"><span class="linenum">1958</span></a>  
<a name="l1959"><span class="linenum">1959</span></a>  <span class="comment">        /// qanda access</span>
<a name="l1960"><span class="linenum">1960</span></a>              if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'qanda'
<a name="l1961"><span class="linenum">1961</span></a>                      &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewqandawithoutposting', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1962"><span class="linenum">1962</span></a>  
<a name="l1963"><span class="linenum">1963</span></a>  <span class="comment">                // We need to check whether the user has posted in the qanda forum.</span>
<a name="l1964"><span class="linenum">1964</span></a>                  <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('onlydiscussions')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/onlydiscussions.html">onlydiscussions</a> = array();  <span class="comment">// Holds discussion ids for the discussions</span>
<a name="l1965"><span class="linenum">1965</span></a>  <span class="comment">                                                    // the user is allowed to see in this forum.</span>
<a name="l1966"><span class="linenum">1966</span></a>                  if (<a class="var it41540" onMouseOver="hilite(41540)" onMouseOut="lolite()" onClick="logVariable('discussionspostedin')" href="../../_variables/discussionspostedin.html">$discussionspostedin</a> = <a class="function" onClick="logFunction('forum_discussions_user_has_posted_in')" href="../../_functions/forum_discussions_user_has_posted_in.html" onMouseOver="funcPopup(event,'forum_discussions_user_has_posted_in')">forum_discussions_user_has_posted_in</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l1967"><span class="linenum">1967</span></a>                      foreach (<a class="var it41540" onMouseOver="hilite(41540)" onMouseOut="lolite()" onClick="logVariable('discussionspostedin')" href="../../_variables/discussionspostedin.html">$discussionspostedin</a> as <a class="var it775" onMouseOver="hilite(775)" onMouseOut="lolite()" onClick="logVariable('d')" href="../../_variables/d.html">$d</a>) {
<a name="l1968"><span class="linenum">1968</span></a>                          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('onlydiscussions')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/onlydiscussions.html">onlydiscussions</a>[] = <a class="var it775" onMouseOver="hilite(775)" onMouseOut="lolite()" onClick="logVariable('d')" href="../../_variables/d.html">$d</a>-&gt;<a onClick="logVariable('id')" class="var it43413" onMouseOver="hilite(43413)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1969"><span class="linenum">1969</span></a>                      }
<a name="l1970"><span class="linenum">1970</span></a>                  }
<a name="l1971"><span class="linenum">1971</span></a>              }
<a name="l1972"><span class="linenum">1972</span></a>  
<a name="l1973"><span class="linenum">1973</span></a>              <a class="var it41535" onMouseOver="hilite(41535)" onMouseOut="lolite()" onClick="logVariable('readableforums')" href="../../_variables/readableforums.html">$readableforums</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>;
<a name="l1974"><span class="linenum">1974</span></a>          }
<a name="l1975"><span class="linenum">1975</span></a>  
<a name="l1976"><span class="linenum">1976</span></a>          unset(<a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>);
<a name="l1977"><span class="linenum">1977</span></a>  
<a name="l1978"><span class="linenum">1978</span></a>      } <span class="comment">// End foreach $courses</span>
<a name="l1979"><span class="linenum">1979</span></a>  
<a name="l1980"><span class="linenum">1980</span></a>      return <a class="var it41535" onMouseOver="hilite(41535)" onMouseOut="lolite()" onClick="logVariable('readableforums')" href="../../_variables/readableforums.html">$readableforums</a>;
<a name="l1981"><span class="linenum">1981</span></a>  }
<a name="l1982"><span class="linenum">1982</span></a>  
<a name="l1983"><span class="linenum">1983</span></a>  <span class="comment">/**</span>
<a name="l1984"><span class="linenum">1984</span></a>  <span class="comment"> * Returns a list of posts found using an array of search terms.</span>
<a name="l1985"><span class="linenum">1985</span></a>  <span class="comment"> *</span>
<a name="l1986"><span class="linenum">1986</span></a>  <span class="comment"> * @global object</span>
<a name="l1987"><span class="linenum">1987</span></a>  <span class="comment"> * @global object</span>
<a name="l1988"><span class="linenum">1988</span></a>  <span class="comment"> * @global object</span>
<a name="l1989"><span class="linenum">1989</span></a>  <span class="comment"> * @param array $searchterms array of search terms, e.g. word +word -word</span>
<a name="l1990"><span class="linenum">1990</span></a>  <span class="comment"> * @param int $courseid if 0, we search through the whole site</span>
<a name="l1991"><span class="linenum">1991</span></a>  <span class="comment"> * @param int $limitfrom</span>
<a name="l1992"><span class="linenum">1992</span></a>  <span class="comment"> * @param int $limitnum</span>
<a name="l1993"><span class="linenum">1993</span></a>  <span class="comment"> * @param int &amp;$totalcount</span>
<a name="l1994"><span class="linenum">1994</span></a>  <span class="comment"> * @param string $extrasql</span>
<a name="l1995"><span class="linenum">1995</span></a>  <span class="comment"> * @return array|bool Array of posts found or false</span>
<a name="l1996"><span class="linenum">1996</span></a>  <span class="comment"> */</span>
<a name="l1997"><span class="linenum">1997</span></a>  function <a class="function" onClick="logFunction('forum_search_posts')" href="../../_functions/forum_search_posts.html" onMouseOver="funcPopup(event,'forum_search_posts')">forum_search_posts</a>(<a class="var it7884" onMouseOver="hilite(7884)" onMouseOut="lolite()" onClick="logVariable('searchterms')" href="../../_variables/searchterms.html">$searchterms</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>=0, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a>=0, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>=50,
<a name="l1998"><span class="linenum">1998</span></a>                              &amp;<a class="var it3822" onMouseOver="hilite(3822)" onMouseOut="lolite()" onClick="logVariable('totalcount')" href="../../_variables/totalcount.html">$totalcount</a>, <a class="var it8682" onMouseOver="hilite(8682)" onMouseOut="lolite()" onClick="logVariable('extrasql')" href="../../_variables/extrasql.html">$extrasql</a>='') {
<a name="l1999"><span class="linenum">1999</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2000"><span class="linenum">2000</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/searchlib.php');
<a name="l2001"><span class="linenum">2001</span></a>  
<a name="l2002"><span class="linenum">2002</span></a>      <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> = <a class="function" onClick="logFunction('forum_get_readable_forums')" href="../../_functions/forum_get_readable_forums.html" onMouseOver="funcPopup(event,'forum_get_readable_forums')">forum_get_readable_forums</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l2003"><span class="linenum">2003</span></a>  
<a name="l2004"><span class="linenum">2004</span></a>      if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>) == 0) {
<a name="l2005"><span class="linenum">2005</span></a>          <a class="var it3822" onMouseOver="hilite(3822)" onMouseOut="lolite()" onClick="logVariable('totalcount')" href="../../_variables/totalcount.html">$totalcount</a> = 0;
<a name="l2006"><span class="linenum">2006</span></a>          return false;
<a name="l2007"><span class="linenum">2007</span></a>      }
<a name="l2008"><span class="linenum">2008</span></a>  
<a name="l2009"><span class="linenum">2009</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2); <span class="comment">// db friendly</span>
<a name="l2010"><span class="linenum">2010</span></a>  
<a name="l2011"><span class="linenum">2011</span></a>      <a class="var it41541" onMouseOver="hilite(41541)" onMouseOut="lolite()" onClick="logVariable('fullaccess')" href="../../_variables/fullaccess.html">$fullaccess</a> = array();
<a name="l2012"><span class="linenum">2012</span></a>      <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a> = array();
<a name="l2013"><span class="linenum">2013</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l2014"><span class="linenum">2014</span></a>  
<a name="l2015"><span class="linenum">2015</span></a>      foreach (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> as <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a> =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l2016"><span class="linenum">2016</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = array();
<a name="l2017"><span class="linenum">2017</span></a>  
<a name="l2018"><span class="linenum">2018</span></a>          if (!<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('viewhiddentimedposts')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/viewhiddentimedposts.html">viewhiddentimedposts</a>) {
<a name="l2019"><span class="linenum">2019</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>[] = &quot;(d.userid = :userid{<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>} <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (d.timestart &lt; :timestart{<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>} AND (d.timeend = 0 OR d.timeend &gt; :timeend{<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>})))&quot;;
<a name="l2020"><span class="linenum">2020</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, array('userid'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>=&gt;<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'timestart'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>=&gt;<a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>, 'timeend'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>=&gt;<a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>));
<a name="l2021"><span class="linenum">2021</span></a>          }
<a name="l2022"><span class="linenum">2022</span></a>  
<a name="l2023"><span class="linenum">2023</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('cm')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>;
<a name="l2024"><span class="linenum">2024</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('context')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>;
<a name="l2025"><span class="linenum">2025</span></a>  
<a name="l2026"><span class="linenum">2026</span></a>          if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'qanda'
<a name="l2027"><span class="linenum">2027</span></a>              &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewqandawithoutposting', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l2028"><span class="linenum">2028</span></a>              if (!empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('onlydiscussions')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/onlydiscussions.html">onlydiscussions</a>)) {
<a name="l2029"><span class="linenum">2029</span></a>                  <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it41542" onMouseOver="hilite(41542)" onMouseOut="lolite()" onClick="logVariable('discussionid_sql')" href="../../_variables/discussionid_sql.html">$discussionid_sql</a>, <a class="var it41543" onMouseOver="hilite(41543)" onMouseOut="lolite()" onClick="logVariable('discussionid_params')" href="../../_variables/discussionid_params.html">$discussionid_params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('onlydiscussions')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/onlydiscussions.html">onlydiscussions</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'qanda'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>.'_');
<a name="l2030"><span class="linenum">2030</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it41543" onMouseOver="hilite(41543)" onMouseOut="lolite()" onClick="logVariable('discussionid_params')" href="../../_variables/discussionid_params.html">$discussionid_params</a>);
<a name="l2031"><span class="linenum">2031</span></a>                  <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>[] = &quot;(d.id <a class="var it41542" onMouseOver="hilite(41542)" onMouseOut="lolite()" onClick="logVariable('discussionid_sql')" href="../../_variables/discussionid_sql.html">$discussionid_sql</a> OR p.parent = 0)&quot;;
<a name="l2032"><span class="linenum">2032</span></a>              } else {
<a name="l2033"><span class="linenum">2033</span></a>                  <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>[] = &quot;p.parent = 0&quot;;
<a name="l2034"><span class="linenum">2034</span></a>              }
<a name="l2035"><span class="linenum">2035</span></a>          }
<a name="l2036"><span class="linenum">2036</span></a>  
<a name="l2037"><span class="linenum">2037</span></a>          if (!empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('onlygroups')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/onlygroups.html">onlygroups</a>)) {
<a name="l2038"><span class="linenum">2038</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it41544" onMouseOver="hilite(41544)" onMouseOut="lolite()" onClick="logVariable('groupid_sql')" href="../../_variables/groupid_sql.html">$groupid_sql</a>, <a class="var it41545" onMouseOver="hilite(41545)" onMouseOut="lolite()" onClick="logVariable('groupid_params')" href="../../_variables/groupid_params.html">$groupid_params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('onlygroups')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/onlygroups.html">onlygroups</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'grps'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>.'_');
<a name="l2039"><span class="linenum">2039</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it41545" onMouseOver="hilite(41545)" onMouseOut="lolite()" onClick="logVariable('groupid_params')" href="../../_variables/groupid_params.html">$groupid_params</a>);
<a name="l2040"><span class="linenum">2040</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>[] = &quot;d.groupid <a class="var it41544" onMouseOver="hilite(41544)" onMouseOut="lolite()" onClick="logVariable('groupid_sql')" href="../../_variables/groupid_sql.html">$groupid_sql</a>&quot;;
<a name="l2041"><span class="linenum">2041</span></a>          }
<a name="l2042"><span class="linenum">2042</span></a>  
<a name="l2043"><span class="linenum">2043</span></a>          if (<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>) {
<a name="l2044"><span class="linenum">2044</span></a>              <a class="var it7654" onMouseOver="hilite(7654)" onMouseOut="lolite()" onClick="logVariable('selects')" href="../../_variables/selects.html">$selects</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot; AND &quot;, <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>);
<a name="l2045"><span class="linenum">2045</span></a>              <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a>[] = &quot;(d.forum = :forum{<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>} AND <a class="var it7654" onMouseOver="hilite(7654)" onMouseOut="lolite()" onClick="logVariable('selects')" href="../../_variables/selects.html">$selects</a>)&quot;;
<a name="l2046"><span class="linenum">2046</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['forum'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>] = <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>;
<a name="l2047"><span class="linenum">2047</span></a>          } else {
<a name="l2048"><span class="linenum">2048</span></a>              <a class="var it41541" onMouseOver="hilite(41541)" onMouseOut="lolite()" onClick="logVariable('fullaccess')" href="../../_variables/fullaccess.html">$fullaccess</a>[] = <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>;
<a name="l2049"><span class="linenum">2049</span></a>          }
<a name="l2050"><span class="linenum">2050</span></a>      }
<a name="l2051"><span class="linenum">2051</span></a>  
<a name="l2052"><span class="linenum">2052</span></a>      if (<a class="var it41541" onMouseOver="hilite(41541)" onMouseOut="lolite()" onClick="logVariable('fullaccess')" href="../../_variables/fullaccess.html">$fullaccess</a>) {
<a name="l2053"><span class="linenum">2053</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it41546" onMouseOver="hilite(41546)" onMouseOut="lolite()" onClick="logVariable('fullid_sql')" href="../../_variables/fullid_sql.html">$fullid_sql</a>, <a class="var it41547" onMouseOver="hilite(41547)" onMouseOut="lolite()" onClick="logVariable('fullid_params')" href="../../_variables/fullid_params.html">$fullid_params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it41541" onMouseOver="hilite(41541)" onMouseOut="lolite()" onClick="logVariable('fullaccess')" href="../../_variables/fullaccess.html">$fullaccess</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'fula');
<a name="l2054"><span class="linenum">2054</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it41547" onMouseOver="hilite(41547)" onMouseOut="lolite()" onClick="logVariable('fullid_params')" href="../../_variables/fullid_params.html">$fullid_params</a>);
<a name="l2055"><span class="linenum">2055</span></a>          <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a>[] = &quot;(d.forum <a class="var it41546" onMouseOver="hilite(41546)" onMouseOut="lolite()" onClick="logVariable('fullid_sql')" href="../../_variables/fullid_sql.html">$fullid_sql</a>)&quot;;
<a name="l2056"><span class="linenum">2056</span></a>      }
<a name="l2057"><span class="linenum">2057</span></a>  
<a name="l2058"><span class="linenum">2058</span></a>      <a class="var it41548" onMouseOver="hilite(41548)" onMouseOut="lolite()" onClick="logVariable('selectdiscussion')" href="../../_variables/selectdiscussion.html">$selectdiscussion</a> = &quot;(&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot; OR &quot;, <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a>).&quot;)&quot;;
<a name="l2059"><span class="linenum">2059</span></a>  
<a name="l2060"><span class="linenum">2060</span></a>      <a class="var it29698" onMouseOver="hilite(29698)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../../_variables/messagesearch.html">$messagesearch</a> = '';
<a name="l2061"><span class="linenum">2061</span></a>      <a class="var it41549" onMouseOver="hilite(41549)" onMouseOut="lolite()" onClick="logVariable('searchstring')" href="../../_variables/searchstring.html">$searchstring</a> = '';
<a name="l2062"><span class="linenum">2062</span></a>  
<a name="l2063"><span class="linenum">2063</span></a>  <span class="comment">    // Need to concat these back together for parser to work.</span>
<a name="l2064"><span class="linenum">2064</span></a>      foreach(<a class="var it7884" onMouseOver="hilite(7884)" onMouseOut="lolite()" onClick="logVariable('searchterms')" href="../../_variables/searchterms.html">$searchterms</a> as <a class="var it7887" onMouseOver="hilite(7887)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../../_variables/searchterm.html">$searchterm</a>){
<a name="l2065"><span class="linenum">2065</span></a>          if (<a class="var it41549" onMouseOver="hilite(41549)" onMouseOut="lolite()" onClick="logVariable('searchstring')" href="../../_variables/searchstring.html">$searchstring</a> != '') {
<a name="l2066"><span class="linenum">2066</span></a>              <a class="var it41549" onMouseOver="hilite(41549)" onMouseOut="lolite()" onClick="logVariable('searchstring')" href="../../_variables/searchstring.html">$searchstring</a> .= ' ';
<a name="l2067"><span class="linenum">2067</span></a>          }
<a name="l2068"><span class="linenum">2068</span></a>          <a class="var it41549" onMouseOver="hilite(41549)" onMouseOut="lolite()" onClick="logVariable('searchstring')" href="../../_variables/searchstring.html">$searchstring</a> .= <a class="var it7887" onMouseOver="hilite(7887)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../../_variables/searchterm.html">$searchterm</a>;
<a name="l2069"><span class="linenum">2069</span></a>      }
<a name="l2070"><span class="linenum">2070</span></a>  
<a name="l2071"><span class="linenum">2071</span></a>  <span class="comment">    // We need to allow quoted strings for the search. The quotes *should* be stripped</span>
<a name="l2072"><span class="linenum">2072</span></a>  <span class="comment">    // by the parser, but this should be examined carefully for security implications.</span>
<a name="l2073"><span class="linenum">2073</span></a>      <a class="var it41549" onMouseOver="hilite(41549)" onMouseOut="lolite()" onClick="logVariable('searchstring')" href="../../_variables/searchstring.html">$searchstring</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(&quot;\\\&quot;&quot;,&quot;\&quot;&quot;,<a class="var it41549" onMouseOver="hilite(41549)" onMouseOut="lolite()" onClick="logVariable('searchstring')" href="../../_variables/searchstring.html">$searchstring</a>);
<a name="l2074"><span class="linenum">2074</span></a>      <a class="var it270" onMouseOver="hilite(270)" onMouseOut="lolite()" onClick="logVariable('parser')" href="../../_variables/parser.html">$parser</a> = <span class="keyword">new </span><a class="class" onClick="logClass('search_parser')" href="../../_classes/search_parser.html" onMouseOver="classPopup(event,'search_parser')">search_parser</a>();
<a name="l2075"><span class="linenum">2075</span></a>      <a class="var it10467" onMouseOver="hilite(10467)" onMouseOut="lolite()" onClick="logVariable('lexer')" href="../../_variables/lexer.html">$lexer</a> = <span class="keyword">new </span><a class="class" onClick="logClass('search_lexer')" href="../../_classes/search_lexer.html" onMouseOver="classPopup(event,'search_lexer')">search_lexer</a>(<a class="var it270" onMouseOver="hilite(270)" onMouseOut="lolite()" onClick="logVariable('parser')" href="../../_variables/parser.html">$parser</a>);
<a name="l2076"><span class="linenum">2076</span></a>  
<a name="l2077"><span class="linenum">2077</span></a>      if (<a class="var it10467" onMouseOver="hilite(10467)" onMouseOut="lolite()" onClick="logVariable('lexer')" href="../../_variables/lexer.html">$lexer</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>(<a class="var it41549" onMouseOver="hilite(41549)" onMouseOut="lolite()" onClick="logVariable('searchstring')" href="../../_variables/searchstring.html">$searchstring</a>)) {
<a name="l2078"><span class="linenum">2078</span></a>          <a class="var it41550" onMouseOver="hilite(41550)" onMouseOut="lolite()" onClick="logVariable('parsearray')" href="../../_variables/parsearray.html">$parsearray</a> = <a class="var it270" onMouseOver="hilite(270)" onMouseOut="lolite()" onClick="logVariable('parser')" href="../../_variables/parser.html">$parser</a>-&gt;<a class="function" onClick="logFunction('get_parsed_array')" href="../../_functions/get_parsed_array.html" onMouseOver="funcPopup(event,'get_parsed_array')">get_parsed_array</a>();
<a name="l2079"><span class="linenum">2079</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it29698" onMouseOver="hilite(29698)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../../_variables/messagesearch.html">$messagesearch</a>, <a class="var it41551" onMouseOver="hilite(41551)" onMouseOut="lolite()" onClick="logVariable('msparams')" href="../../_variables/msparams.html">$msparams</a>) = <a class="function" onClick="logFunction('search_generate_SQL')" href="../../_functions/search_generate_sql.html" onMouseOver="funcPopup(event,'search_generate_sql')">search_generate_SQL</a>(<a class="var it41550" onMouseOver="hilite(41550)" onMouseOut="lolite()" onClick="logVariable('parsearray')" href="../../_variables/parsearray.html">$parsearray</a>, 'p.message', 'p.subject',
<a name="l2080"><span class="linenum">2080</span></a>                                                                'p.userid', 'u.id', 'u.firstname',
<a name="l2081"><span class="linenum">2081</span></a>                                                                'u.lastname', 'p.modified', 'd.forum');
<a name="l2082"><span class="linenum">2082</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it41551" onMouseOver="hilite(41551)" onMouseOut="lolite()" onClick="logVariable('msparams')" href="../../_variables/msparams.html">$msparams</a>);
<a name="l2083"><span class="linenum">2083</span></a>      }
<a name="l2084"><span class="linenum">2084</span></a>  
<a name="l2085"><span class="linenum">2085</span></a>      <a class="var it7767" onMouseOver="hilite(7767)" onMouseOut="lolite()" onClick="logVariable('fromsql')" href="../../_variables/fromsql.html">$fromsql</a> = &quot;{forum_posts} p,
<a name="l2086"><span class="linenum">2086</span></a>                    {forum_discussions} d,
<a name="l2087"><span class="linenum">2087</span></a>                    {user} u&quot;;
<a name="l2088"><span class="linenum">2088</span></a>  
<a name="l2089"><span class="linenum">2089</span></a>      <a class="var it12567" onMouseOver="hilite(12567)" onMouseOut="lolite()" onClick="logVariable('selectsql')" href="../../_variables/selectsql.html">$selectsql</a> = &quot; <a class="var it29698" onMouseOver="hilite(29698)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../../_variables/messagesearch.html">$messagesearch</a>
<a name="l2090"><span class="linenum">2090</span></a>                 AND p.discussion = d.id
<a name="l2091"><span class="linenum">2091</span></a>                 AND p.userid = u.id
<a name="l2092"><span class="linenum">2092</span></a>                 AND <a class="var it41548" onMouseOver="hilite(41548)" onMouseOut="lolite()" onClick="logVariable('selectdiscussion')" href="../../_variables/selectdiscussion.html">$selectdiscussion</a>
<a name="l2093"><span class="linenum">2093</span></a>                     <a class="var it8682" onMouseOver="hilite(8682)" onMouseOut="lolite()" onClick="logVariable('extrasql')" href="../../_variables/extrasql.html">$extrasql</a>&quot;;
<a name="l2094"><span class="linenum">2094</span></a>  
<a name="l2095"><span class="linenum">2095</span></a>      <a class="var it5529" onMouseOver="hilite(5529)" onMouseOut="lolite()" onClick="logVariable('countsql')" href="../../_variables/countsql.html">$countsql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*)
<a name="l2096"><span class="linenum">2096</span></a>                     FROM <a class="var it7767" onMouseOver="hilite(7767)" onMouseOut="lolite()" onClick="logVariable('fromsql')" href="../../_variables/fromsql.html">$fromsql</a>
<a name="l2097"><span class="linenum">2097</span></a>                    WHERE <a class="var it12567" onMouseOver="hilite(12567)" onMouseOut="lolite()" onClick="logVariable('selectsql')" href="../../_variables/selectsql.html">$selectsql</a>&quot;;
<a name="l2098"><span class="linenum">2098</span></a>  
<a name="l2099"><span class="linenum">2099</span></a>      <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u');
<a name="l2100"><span class="linenum">2100</span></a>      <a class="var it7772" onMouseOver="hilite(7772)" onMouseOut="lolite()" onClick="logVariable('searchsql')" href="../../_variables/searchsql.html">$searchsql</a> = &quot;SELECT p.*,
<a name="l2101"><span class="linenum">2101</span></a>                           d.forum,
<a name="l2102"><span class="linenum">2102</span></a>                           <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a>,
<a name="l2103"><span class="linenum">2103</span></a>                           u.email,
<a name="l2104"><span class="linenum">2104</span></a>                           u.picture,
<a name="l2105"><span class="linenum">2105</span></a>                           u.imagealt
<a name="l2106"><span class="linenum">2106</span></a>                      FROM <a class="var it7767" onMouseOver="hilite(7767)" onMouseOut="lolite()" onClick="logVariable('fromsql')" href="../../_variables/fromsql.html">$fromsql</a>
<a name="l2107"><span class="linenum">2107</span></a>                     WHERE <a class="var it12567" onMouseOver="hilite(12567)" onMouseOut="lolite()" onClick="logVariable('selectsql')" href="../../_variables/selectsql.html">$selectsql</a>
<a name="l2108"><span class="linenum">2108</span></a>                  ORDER BY p.modified DESC&quot;;
<a name="l2109"><span class="linenum">2109</span></a>  
<a name="l2110"><span class="linenum">2110</span></a>      <a class="var it3822" onMouseOver="hilite(3822)" onMouseOut="lolite()" onClick="logVariable('totalcount')" href="../../_variables/totalcount.html">$totalcount</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it5529" onMouseOver="hilite(5529)" onMouseOut="lolite()" onClick="logVariable('countsql')" href="../../_variables/countsql.html">$countsql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2111"><span class="linenum">2111</span></a>  
<a name="l2112"><span class="linenum">2112</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it7772" onMouseOver="hilite(7772)" onMouseOut="lolite()" onClick="logVariable('searchsql')" href="../../_variables/searchsql.html">$searchsql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a>, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>);
<a name="l2113"><span class="linenum">2113</span></a>  }
<a name="l2114"><span class="linenum">2114</span></a>  
<a name="l2115"><span class="linenum">2115</span></a>  <span class="comment">/**</span>
<a name="l2116"><span class="linenum">2116</span></a>  <span class="comment"> * Returns a list of all new posts that have not been mailed yet</span>
<a name="l2117"><span class="linenum">2117</span></a>  <span class="comment"> *</span>
<a name="l2118"><span class="linenum">2118</span></a>  <span class="comment"> * @param int $starttime posts created after this time</span>
<a name="l2119"><span class="linenum">2119</span></a>  <span class="comment"> * @param int $endtime posts created before this</span>
<a name="l2120"><span class="linenum">2120</span></a>  <span class="comment"> * @param int $now used for timed discussions only</span>
<a name="l2121"><span class="linenum">2121</span></a>  <span class="comment"> * @return array</span>
<a name="l2122"><span class="linenum">2122</span></a>  <span class="comment"> */</span>
<a name="l2123"><span class="linenum">2123</span></a>  function <a class="function" onClick="logFunction('forum_get_unmailed_posts')" href="../../_functions/forum_get_unmailed_posts.html" onMouseOver="funcPopup(event,'forum_get_unmailed_posts')">forum_get_unmailed_posts</a>(<a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('starttime')" href="../../_variables/starttime.html">$starttime</a>, <a class="var it6252" onMouseOver="hilite(6252)" onMouseOut="lolite()" onClick="logVariable('endtime')" href="../../_variables/endtime.html">$endtime</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>=null) {
<a name="l2124"><span class="linenum">2124</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2125"><span class="linenum">2125</span></a>  
<a name="l2126"><span class="linenum">2126</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l2127"><span class="linenum">2127</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['mailed'] = <a class="constant" onClick="logConstant('FORUM_MAILED_PENDING')" href="../../_constants/FORUM_MAILED_PENDING.html" onMouseOver="constPopup(event,'FORUM_MAILED_PENDING')">FORUM_MAILED_PENDING</a>;
<a name="l2128"><span class="linenum">2128</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['ptimestart'] = <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('starttime')" href="../../_variables/starttime.html">$starttime</a>;
<a name="l2129"><span class="linenum">2129</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['ptimeend'] = <a class="var it6252" onMouseOver="hilite(6252)" onMouseOut="lolite()" onClick="logVariable('endtime')" href="../../_variables/endtime.html">$endtime</a>;
<a name="l2130"><span class="linenum">2130</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['mailnow'] = 1;
<a name="l2131"><span class="linenum">2131</span></a>  
<a name="l2132"><span class="linenum">2132</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2133"><span class="linenum">2133</span></a>          if (empty(<a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>)) {
<a name="l2134"><span class="linenum">2134</span></a>              <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l2135"><span class="linenum">2135</span></a>          }
<a name="l2136"><span class="linenum">2136</span></a>          <a class="var it12567" onMouseOver="hilite(12567)" onMouseOut="lolite()" onClick="logVariable('selectsql')" href="../../_variables/selectsql.html">$selectsql</a> = &quot;AND (p.created &gt;= :ptimestart OR d.timestart &gt;= :pptimestart)&quot;;
<a name="l2137"><span class="linenum">2137</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['pptimestart'] = <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('starttime')" href="../../_variables/starttime.html">$starttime</a>;
<a name="l2138"><span class="linenum">2138</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;AND (d.timestart &lt; :dtimestart AND (d.timeend = 0 OR d.timeend &gt; :dtimeend))&quot;;
<a name="l2139"><span class="linenum">2139</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['dtimestart'] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2140"><span class="linenum">2140</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['dtimeend'] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2141"><span class="linenum">2141</span></a>      } else {
<a name="l2142"><span class="linenum">2142</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;&quot;;
<a name="l2143"><span class="linenum">2143</span></a>          <a class="var it12567" onMouseOver="hilite(12567)" onMouseOut="lolite()" onClick="logVariable('selectsql')" href="../../_variables/selectsql.html">$selectsql</a> = &quot;AND p.created &gt;= :ptimestart&quot;;
<a name="l2144"><span class="linenum">2144</span></a>      }
<a name="l2145"><span class="linenum">2145</span></a>  
<a name="l2146"><span class="linenum">2146</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT p.*, d.course, d.forum
<a name="l2147"><span class="linenum">2147</span></a>                                   FROM {forum_posts} p
<a name="l2148"><span class="linenum">2148</span></a>                                   JOIN {forum_discussions} d ON d.id = p.discussion
<a name="l2149"><span class="linenum">2149</span></a>                                   WHERE p.mailed = :mailed
<a name="l2150"><span class="linenum">2150</span></a>                                   <a class="var it12567" onMouseOver="hilite(12567)" onMouseOut="lolite()" onClick="logVariable('selectsql')" href="../../_variables/selectsql.html">$selectsql</a>
<a name="l2151"><span class="linenum">2151</span></a>                                   AND (p.created &lt; :ptimeend OR p.mailnow = :mailnow)
<a name="l2152"><span class="linenum">2152</span></a>                                   <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a>
<a name="l2153"><span class="linenum">2153</span></a>                                   ORDER BY p.modified ASC&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2154"><span class="linenum">2154</span></a>  }
<a name="l2155"><span class="linenum">2155</span></a>  
<a name="l2156"><span class="linenum">2156</span></a>  <span class="comment">/**</span>
<a name="l2157"><span class="linenum">2157</span></a>  <span class="comment"> * Marks posts before a certain time as being mailed already</span>
<a name="l2158"><span class="linenum">2158</span></a>  <span class="comment"> *</span>
<a name="l2159"><span class="linenum">2159</span></a>  <span class="comment"> * @global object</span>
<a name="l2160"><span class="linenum">2160</span></a>  <span class="comment"> * @global object</span>
<a name="l2161"><span class="linenum">2161</span></a>  <span class="comment"> * @param int $endtime</span>
<a name="l2162"><span class="linenum">2162</span></a>  <span class="comment"> * @param int $now Defaults to time()</span>
<a name="l2163"><span class="linenum">2163</span></a>  <span class="comment"> * @return bool</span>
<a name="l2164"><span class="linenum">2164</span></a>  <span class="comment"> */</span>
<a name="l2165"><span class="linenum">2165</span></a>  function <a class="function" onClick="logFunction('forum_mark_old_posts_as_mailed')" href="../../_functions/forum_mark_old_posts_as_mailed.html" onMouseOver="funcPopup(event,'forum_mark_old_posts_as_mailed')">forum_mark_old_posts_as_mailed</a>(<a class="var it6252" onMouseOver="hilite(6252)" onMouseOut="lolite()" onClick="logVariable('endtime')" href="../../_variables/endtime.html">$endtime</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>=null) {
<a name="l2166"><span class="linenum">2166</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2167"><span class="linenum">2167</span></a>  
<a name="l2168"><span class="linenum">2168</span></a>      if (empty(<a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>)) {
<a name="l2169"><span class="linenum">2169</span></a>          <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l2170"><span class="linenum">2170</span></a>      }
<a name="l2171"><span class="linenum">2171</span></a>  
<a name="l2172"><span class="linenum">2172</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l2173"><span class="linenum">2173</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['mailedsuccess'] = <a class="constant" onClick="logConstant('FORUM_MAILED_SUCCESS')" href="../../_constants/FORUM_MAILED_SUCCESS.html" onMouseOver="constPopup(event,'FORUM_MAILED_SUCCESS')">FORUM_MAILED_SUCCESS</a>;
<a name="l2174"><span class="linenum">2174</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['now'] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2175"><span class="linenum">2175</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['endtime'] = <a class="var it6252" onMouseOver="hilite(6252)" onMouseOut="lolite()" onClick="logVariable('endtime')" href="../../_variables/endtime.html">$endtime</a>;
<a name="l2176"><span class="linenum">2176</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['mailnow'] = 1;
<a name="l2177"><span class="linenum">2177</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['mailedpending'] = <a class="constant" onClick="logConstant('FORUM_MAILED_PENDING')" href="../../_constants/FORUM_MAILED_PENDING.html" onMouseOver="constPopup(event,'FORUM_MAILED_PENDING')">FORUM_MAILED_PENDING</a>;
<a name="l2178"><span class="linenum">2178</span></a>  
<a name="l2179"><span class="linenum">2179</span></a>      if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2180"><span class="linenum">2180</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;UPDATE {forum_posts}
<a name="l2181"><span class="linenum">2181</span></a>                               SET mailed = :mailedsuccess
<a name="l2182"><span class="linenum">2182</span></a>                               <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (created &lt; :endtime OR mailnow = :mailnow)
<a name="l2183"><span class="linenum">2183</span></a>                               AND mailed = :mailedpending&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2184"><span class="linenum">2184</span></a>      } else {
<a name="l2185"><span class="linenum">2185</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;UPDATE {forum_posts}
<a name="l2186"><span class="linenum">2186</span></a>                               SET mailed = :mailedsuccess
<a name="l2187"><span class="linenum">2187</span></a>                               WHERE discussion NOT IN (SELECT d.id
<a name="l2188"><span class="linenum">2188</span></a>                                                        FROM {forum_discussions} d
<a name="l2189"><span class="linenum">2189</span></a>                                                        WHERE d.timestart &gt; :now)
<a name="l2190"><span class="linenum">2190</span></a>                               AND (created &lt; :endtime OR mailnow = :mailnow)
<a name="l2191"><span class="linenum">2191</span></a>                               AND mailed = :mailedpending&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2192"><span class="linenum">2192</span></a>      }
<a name="l2193"><span class="linenum">2193</span></a>  }
<a name="l2194"><span class="linenum">2194</span></a>  
<a name="l2195"><span class="linenum">2195</span></a>  <span class="comment">/**</span>
<a name="l2196"><span class="linenum">2196</span></a>  <span class="comment"> * Get all the posts for a user in a forum suitable for forum_print_post</span>
<a name="l2197"><span class="linenum">2197</span></a>  <span class="comment"> *</span>
<a name="l2198"><span class="linenum">2198</span></a>  <span class="comment"> * @global object</span>
<a name="l2199"><span class="linenum">2199</span></a>  <span class="comment"> * @global object</span>
<a name="l2200"><span class="linenum">2200</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l2201"><span class="linenum">2201</span></a>  <span class="comment"> * @return array</span>
<a name="l2202"><span class="linenum">2202</span></a>  <span class="comment"> */</span>
<a name="l2203"><span class="linenum">2203</span></a>  function <a class="function" onClick="logFunction('forum_get_user_posts')" href="../../_functions/forum_get_user_posts.html" onMouseOver="funcPopup(event,'forum_get_user_posts')">forum_get_user_posts</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l2204"><span class="linenum">2204</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2205"><span class="linenum">2205</span></a>  
<a name="l2206"><span class="linenum">2206</span></a>      <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;&quot;;
<a name="l2207"><span class="linenum">2207</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l2208"><span class="linenum">2208</span></a>  
<a name="l2209"><span class="linenum">2209</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2210"><span class="linenum">2210</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>);
<a name="l2211"><span class="linenum">2211</span></a>          if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts' , <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l2212"><span class="linenum">2212</span></a>              <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l2213"><span class="linenum">2213</span></a>              <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;AND (d.timestart &lt; ? AND (d.timeend = 0 OR d.timeend &gt; ?))&quot;;
<a name="l2214"><span class="linenum">2214</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2215"><span class="linenum">2215</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2216"><span class="linenum">2216</span></a>          }
<a name="l2217"><span class="linenum">2217</span></a>      }
<a name="l2218"><span class="linenum">2218</span></a>  
<a name="l2219"><span class="linenum">2219</span></a>      <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u');
<a name="l2220"><span class="linenum">2220</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT p.*, d.forum, <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a>, u.email, u.picture, u.imagealt
<a name="l2221"><span class="linenum">2221</span></a>                                FROM {forum} f
<a name="l2222"><span class="linenum">2222</span></a>                                     JOIN {forum_discussions} d ON d.forum = f.id
<a name="l2223"><span class="linenum">2223</span></a>                                     JOIN {forum_posts} p       ON p.discussion = d.id
<a name="l2224"><span class="linenum">2224</span></a>                                     JOIN {user} u              ON u.id = p.userid
<a name="l2225"><span class="linenum">2225</span></a>                               WHERE f.id = ?
<a name="l2226"><span class="linenum">2226</span></a>                                     AND p.userid = ?
<a name="l2227"><span class="linenum">2227</span></a>                                     <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a>
<a name="l2228"><span class="linenum">2228</span></a>                            ORDER BY p.modified ASC&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2229"><span class="linenum">2229</span></a>  }
<a name="l2230"><span class="linenum">2230</span></a>  
<a name="l2231"><span class="linenum">2231</span></a>  <span class="comment">/**</span>
<a name="l2232"><span class="linenum">2232</span></a>  <span class="comment"> * Get all the discussions user participated in</span>
<a name="l2233"><span class="linenum">2233</span></a>  <span class="comment"> *</span>
<a name="l2234"><span class="linenum">2234</span></a>  <span class="comment"> * @global object</span>
<a name="l2235"><span class="linenum">2235</span></a>  <span class="comment"> * @global object</span>
<a name="l2236"><span class="linenum">2236</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l2237"><span class="linenum">2237</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l2238"><span class="linenum">2238</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l2239"><span class="linenum">2239</span></a>  <span class="comment"> * @return array Array or false</span>
<a name="l2240"><span class="linenum">2240</span></a>  <span class="comment"> */</span>
<a name="l2241"><span class="linenum">2241</span></a>  function <a class="function" onClick="logFunction('forum_get_user_involved_discussions')" href="../../_functions/forum_get_user_involved_discussions.html" onMouseOver="funcPopup(event,'forum_get_user_involved_discussions')">forum_get_user_involved_discussions</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l2242"><span class="linenum">2242</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2243"><span class="linenum">2243</span></a>  
<a name="l2244"><span class="linenum">2244</span></a>      <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;&quot;;
<a name="l2245"><span class="linenum">2245</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l2246"><span class="linenum">2246</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2247"><span class="linenum">2247</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>);
<a name="l2248"><span class="linenum">2248</span></a>          if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts' , <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l2249"><span class="linenum">2249</span></a>              <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l2250"><span class="linenum">2250</span></a>              <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;AND (d.timestart &lt; ? AND (d.timeend = 0 OR d.timeend &gt; ?))&quot;;
<a name="l2251"><span class="linenum">2251</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2252"><span class="linenum">2252</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2253"><span class="linenum">2253</span></a>          }
<a name="l2254"><span class="linenum">2254</span></a>      }
<a name="l2255"><span class="linenum">2255</span></a>  
<a name="l2256"><span class="linenum">2256</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT DISTINCT d.*
<a name="l2257"><span class="linenum">2257</span></a>                                FROM {forum} f
<a name="l2258"><span class="linenum">2258</span></a>                                     JOIN {forum_discussions} d ON d.forum = f.id
<a name="l2259"><span class="linenum">2259</span></a>                                     JOIN {forum_posts} p       ON p.discussion = d.id
<a name="l2260"><span class="linenum">2260</span></a>                               WHERE f.id = ?
<a name="l2261"><span class="linenum">2261</span></a>                                     AND p.userid = ?
<a name="l2262"><span class="linenum">2262</span></a>                                     <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a>&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2263"><span class="linenum">2263</span></a>  }
<a name="l2264"><span class="linenum">2264</span></a>  
<a name="l2265"><span class="linenum">2265</span></a>  <span class="comment">/**</span>
<a name="l2266"><span class="linenum">2266</span></a>  <span class="comment"> * Get all the posts for a user in a forum suitable for forum_print_post</span>
<a name="l2267"><span class="linenum">2267</span></a>  <span class="comment"> *</span>
<a name="l2268"><span class="linenum">2268</span></a>  <span class="comment"> * @global object</span>
<a name="l2269"><span class="linenum">2269</span></a>  <span class="comment"> * @global object</span>
<a name="l2270"><span class="linenum">2270</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l2271"><span class="linenum">2271</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l2272"><span class="linenum">2272</span></a>  <span class="comment"> * @return array of counts or false</span>
<a name="l2273"><span class="linenum">2273</span></a>  <span class="comment"> */</span>
<a name="l2274"><span class="linenum">2274</span></a>  function <a class="function" onClick="logFunction('forum_count_user_posts')" href="../../_functions/forum_count_user_posts.html" onMouseOver="funcPopup(event,'forum_count_user_posts')">forum_count_user_posts</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l2275"><span class="linenum">2275</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2276"><span class="linenum">2276</span></a>  
<a name="l2277"><span class="linenum">2277</span></a>      <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;&quot;;
<a name="l2278"><span class="linenum">2278</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l2279"><span class="linenum">2279</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2280"><span class="linenum">2280</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>);
<a name="l2281"><span class="linenum">2281</span></a>          if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts' , <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l2282"><span class="linenum">2282</span></a>              <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l2283"><span class="linenum">2283</span></a>              <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;AND (d.timestart &lt; ? AND (d.timeend = 0 OR d.timeend &gt; ?))&quot;;
<a name="l2284"><span class="linenum">2284</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2285"><span class="linenum">2285</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2286"><span class="linenum">2286</span></a>          }
<a name="l2287"><span class="linenum">2287</span></a>      }
<a name="l2288"><span class="linenum">2288</span></a>  
<a name="l2289"><span class="linenum">2289</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(p.id) AS postcount, <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(p.modified) AS lastpost
<a name="l2290"><span class="linenum">2290</span></a>                               FROM {forum} f
<a name="l2291"><span class="linenum">2291</span></a>                                    JOIN {forum_discussions} d ON d.forum = f.id
<a name="l2292"><span class="linenum">2292</span></a>                                    JOIN {forum_posts} p       ON p.discussion = d.id
<a name="l2293"><span class="linenum">2293</span></a>                                    JOIN {user} u              ON u.id = p.userid
<a name="l2294"><span class="linenum">2294</span></a>                              WHERE f.id = ?
<a name="l2295"><span class="linenum">2295</span></a>                                    AND p.userid = ?
<a name="l2296"><span class="linenum">2296</span></a>                                    <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a>&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2297"><span class="linenum">2297</span></a>  }
<a name="l2298"><span class="linenum">2298</span></a>  
<a name="l2299"><span class="linenum">2299</span></a>  <span class="comment">/**</span>
<a name="l2300"><span class="linenum">2300</span></a>  <span class="comment"> * Given a log entry, return the forum post details for it.</span>
<a name="l2301"><span class="linenum">2301</span></a>  <span class="comment"> *</span>
<a name="l2302"><span class="linenum">2302</span></a>  <span class="comment"> * @global object</span>
<a name="l2303"><span class="linenum">2303</span></a>  <span class="comment"> * @global object</span>
<a name="l2304"><span class="linenum">2304</span></a>  <span class="comment"> * @param object $log</span>
<a name="l2305"><span class="linenum">2305</span></a>  <span class="comment"> * @return array|null</span>
<a name="l2306"><span class="linenum">2306</span></a>  <span class="comment"> */</span>
<a name="l2307"><span class="linenum">2307</span></a>  function <a class="function" onClick="logFunction('forum_get_post_from_log')" href="../../_functions/forum_get_post_from_log.html" onMouseOver="funcPopup(event,'forum_get_post_from_log')">forum_get_post_from_log</a>(<a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>) {
<a name="l2308"><span class="linenum">2308</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2309"><span class="linenum">2309</span></a>  
<a name="l2310"><span class="linenum">2310</span></a>      <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u');
<a name="l2311"><span class="linenum">2311</span></a>      if (<a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>-&gt;<a onClick="logVariable('action')" class="var it43193" onMouseOver="hilite(43193)" onMouseOut="lolite()" href="../../_variables/action.html">action</a> == &quot;add post&quot;) {
<a name="l2312"><span class="linenum">2312</span></a>  
<a name="l2313"><span class="linenum">2313</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT p.*, f.type AS forumtype, d.forum, d.groupid, <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a>, u.email, u.picture
<a name="l2314"><span class="linenum">2314</span></a>                                   FROM {forum_discussions} d,
<a name="l2315"><span class="linenum">2315</span></a>                                        {forum_posts} p,
<a name="l2316"><span class="linenum">2316</span></a>                                        {forum} f,
<a name="l2317"><span class="linenum">2317</span></a>                                        {user} u
<a name="l2318"><span class="linenum">2318</span></a>                                  WHERE p.id = ?
<a name="l2319"><span class="linenum">2319</span></a>                                    AND d.id = p.discussion
<a name="l2320"><span class="linenum">2320</span></a>                                    AND p.userid = u.id
<a name="l2321"><span class="linenum">2321</span></a>                                    AND u.deleted &lt;&gt; '1'
<a name="l2322"><span class="linenum">2322</span></a>                                    AND f.id = d.forum&quot;, array(<a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>-&gt;<a onClick="logVariable('info')" class="var it43193" onMouseOver="hilite(43193)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>));
<a name="l2323"><span class="linenum">2323</span></a>  
<a name="l2324"><span class="linenum">2324</span></a>  
<a name="l2325"><span class="linenum">2325</span></a>      } else if (<a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>-&gt;<a onClick="logVariable('action')" class="var it43193" onMouseOver="hilite(43193)" onMouseOut="lolite()" href="../../_variables/action.html">action</a> == &quot;add discussion&quot;) {
<a name="l2326"><span class="linenum">2326</span></a>  
<a name="l2327"><span class="linenum">2327</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT p.*, f.type AS forumtype, d.forum, d.groupid, <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a>, u.email, u.picture
<a name="l2328"><span class="linenum">2328</span></a>                                   FROM {forum_discussions} d,
<a name="l2329"><span class="linenum">2329</span></a>                                        {forum_posts} p,
<a name="l2330"><span class="linenum">2330</span></a>                                        {forum} f,
<a name="l2331"><span class="linenum">2331</span></a>                                        {user} u
<a name="l2332"><span class="linenum">2332</span></a>                                  WHERE d.id = ?
<a name="l2333"><span class="linenum">2333</span></a>                                    AND d.firstpost = p.id
<a name="l2334"><span class="linenum">2334</span></a>                                    AND p.userid = u.id
<a name="l2335"><span class="linenum">2335</span></a>                                    AND u.deleted &lt;&gt; '1'
<a name="l2336"><span class="linenum">2336</span></a>                                    AND f.id = d.forum&quot;, array(<a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>-&gt;<a onClick="logVariable('info')" class="var it43193" onMouseOver="hilite(43193)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>));
<a name="l2337"><span class="linenum">2337</span></a>      }
<a name="l2338"><span class="linenum">2338</span></a>      return NULL;
<a name="l2339"><span class="linenum">2339</span></a>  }
<a name="l2340"><span class="linenum">2340</span></a>  
<a name="l2341"><span class="linenum">2341</span></a>  <span class="comment">/**</span>
<a name="l2342"><span class="linenum">2342</span></a>  <span class="comment"> * Given a discussion id, return the first post from the discussion</span>
<a name="l2343"><span class="linenum">2343</span></a>  <span class="comment"> *</span>
<a name="l2344"><span class="linenum">2344</span></a>  <span class="comment"> * @global object</span>
<a name="l2345"><span class="linenum">2345</span></a>  <span class="comment"> * @global object</span>
<a name="l2346"><span class="linenum">2346</span></a>  <span class="comment"> * @param int $dicsussionid</span>
<a name="l2347"><span class="linenum">2347</span></a>  <span class="comment"> * @return array</span>
<a name="l2348"><span class="linenum">2348</span></a>  <span class="comment"> */</span>
<a name="l2349"><span class="linenum">2349</span></a>  function <a class="function" onClick="logFunction('forum_get_firstpost_from_discussion')" href="../../_functions/forum_get_firstpost_from_discussion.html" onMouseOver="funcPopup(event,'forum_get_firstpost_from_discussion')">forum_get_firstpost_from_discussion</a>(<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>) {
<a name="l2350"><span class="linenum">2350</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2351"><span class="linenum">2351</span></a>  
<a name="l2352"><span class="linenum">2352</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT p.*
<a name="l2353"><span class="linenum">2353</span></a>                               FROM {forum_discussions} d,
<a name="l2354"><span class="linenum">2354</span></a>                                    {forum_posts} p
<a name="l2355"><span class="linenum">2355</span></a>                              WHERE d.id = ?
<a name="l2356"><span class="linenum">2356</span></a>                                AND d.firstpost = p.id &quot;, array(<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>));
<a name="l2357"><span class="linenum">2357</span></a>  }
<a name="l2358"><span class="linenum">2358</span></a>  
<a name="l2359"><span class="linenum">2359</span></a>  <span class="comment">/**</span>
<a name="l2360"><span class="linenum">2360</span></a>  <span class="comment"> * Returns an array of counts of replies to each discussion</span>
<a name="l2361"><span class="linenum">2361</span></a>  <span class="comment"> *</span>
<a name="l2362"><span class="linenum">2362</span></a>  <span class="comment"> * @global object</span>
<a name="l2363"><span class="linenum">2363</span></a>  <span class="comment"> * @global object</span>
<a name="l2364"><span class="linenum">2364</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l2365"><span class="linenum">2365</span></a>  <span class="comment"> * @param string $forumsort</span>
<a name="l2366"><span class="linenum">2366</span></a>  <span class="comment"> * @param int $limit</span>
<a name="l2367"><span class="linenum">2367</span></a>  <span class="comment"> * @param int $page</span>
<a name="l2368"><span class="linenum">2368</span></a>  <span class="comment"> * @param int $perpage</span>
<a name="l2369"><span class="linenum">2369</span></a>  <span class="comment"> * @return array</span>
<a name="l2370"><span class="linenum">2370</span></a>  <span class="comment"> */</span>
<a name="l2371"><span class="linenum">2371</span></a>  function <a class="function" onClick="logFunction('forum_count_discussion_replies')" href="../../_functions/forum_count_discussion_replies.html" onMouseOver="funcPopup(event,'forum_count_discussion_replies')">forum_count_discussion_replies</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it28933" onMouseOver="hilite(28933)" onMouseOut="lolite()" onClick="logVariable('forumsort')" href="../../_variables/forumsort.html">$forumsort</a>=&quot;&quot;, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>=-1, <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>=-1, <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>=0) {
<a name="l2372"><span class="linenum">2372</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2373"><span class="linenum">2373</span></a>  
<a name="l2374"><span class="linenum">2374</span></a>      if (<a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> &gt; 0) {
<a name="l2375"><span class="linenum">2375</span></a>          <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> = 0;
<a name="l2376"><span class="linenum">2376</span></a>          <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>  = <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>;
<a name="l2377"><span class="linenum">2377</span></a>      } else if (<a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a> != -1) {
<a name="l2378"><span class="linenum">2378</span></a>          <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> = <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>*<a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>;
<a name="l2379"><span class="linenum">2379</span></a>          <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>  = <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>;
<a name="l2380"><span class="linenum">2380</span></a>      } else {
<a name="l2381"><span class="linenum">2381</span></a>          <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> = 0;
<a name="l2382"><span class="linenum">2382</span></a>          <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>  = 0;
<a name="l2383"><span class="linenum">2383</span></a>      }
<a name="l2384"><span class="linenum">2384</span></a>  
<a name="l2385"><span class="linenum">2385</span></a>      if (<a class="var it28933" onMouseOver="hilite(28933)" onMouseOut="lolite()" onClick="logVariable('forumsort')" href="../../_variables/forumsort.html">$forumsort</a> == &quot;&quot;) {
<a name="l2386"><span class="linenum">2386</span></a>          <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a> = &quot;&quot;;
<a name="l2387"><span class="linenum">2387</span></a>          <a class="var it18622" onMouseOver="hilite(18622)" onMouseOut="lolite()" onClick="logVariable('groupby')" href="../../_variables/groupby.html">$groupby</a> = &quot;&quot;;
<a name="l2388"><span class="linenum">2388</span></a>  
<a name="l2389"><span class="linenum">2389</span></a>      } else {
<a name="l2390"><span class="linenum">2390</span></a>          <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a> = &quot;ORDER BY <a class="var it28933" onMouseOver="hilite(28933)" onMouseOut="lolite()" onClick="logVariable('forumsort')" href="../../_variables/forumsort.html">$forumsort</a>&quot;;
<a name="l2391"><span class="linenum">2391</span></a>          <a class="var it18622" onMouseOver="hilite(18622)" onMouseOut="lolite()" onClick="logVariable('groupby')" href="../../_variables/groupby.html">$groupby</a> = &quot;, &quot;.<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it28933" onMouseOver="hilite(28933)" onMouseOut="lolite()" onClick="logVariable('forumsort')" href="../../_variables/forumsort.html">$forumsort</a>);
<a name="l2392"><span class="linenum">2392</span></a>          <a class="var it18622" onMouseOver="hilite(18622)" onMouseOut="lolite()" onClick="logVariable('groupby')" href="../../_variables/groupby.html">$groupby</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('desc', '', <a class="var it18622" onMouseOver="hilite(18622)" onMouseOut="lolite()" onClick="logVariable('groupby')" href="../../_variables/groupby.html">$groupby</a>);
<a name="l2393"><span class="linenum">2393</span></a>          <a class="var it18622" onMouseOver="hilite(18622)" onMouseOut="lolite()" onClick="logVariable('groupby')" href="../../_variables/groupby.html">$groupby</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('asc', '', <a class="var it18622" onMouseOver="hilite(18622)" onMouseOut="lolite()" onClick="logVariable('groupby')" href="../../_variables/groupby.html">$groupby</a>);
<a name="l2394"><span class="linenum">2394</span></a>      }
<a name="l2395"><span class="linenum">2395</span></a>  
<a name="l2396"><span class="linenum">2396</span></a>      if ((<a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> == 0 and <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a> == 0) or <a class="var it28933" onMouseOver="hilite(28933)" onMouseOut="lolite()" onClick="logVariable('forumsort')" href="../../_variables/forumsort.html">$forumsort</a> == &quot;&quot;) {
<a name="l2397"><span class="linenum">2397</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT p.discussion, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(p.id) AS replies, <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(p.id) AS lastpostid
<a name="l2398"><span class="linenum">2398</span></a>                    FROM {forum_posts} p
<a name="l2399"><span class="linenum">2399</span></a>                         JOIN {forum_discussions} d ON p.discussion = d.id
<a name="l2400"><span class="linenum">2400</span></a>                   WHERE p.parent &gt; 0 AND d.forum = ?
<a name="l2401"><span class="linenum">2401</span></a>                GROUP BY p.discussion&quot;;
<a name="l2402"><span class="linenum">2402</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>));
<a name="l2403"><span class="linenum">2403</span></a>  
<a name="l2404"><span class="linenum">2404</span></a>      } else {
<a name="l2405"><span class="linenum">2405</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT p.discussion, (<a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(p.id) - 1) AS replies, <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(p.id) AS lastpostid
<a name="l2406"><span class="linenum">2406</span></a>                    FROM {forum_posts} p
<a name="l2407"><span class="linenum">2407</span></a>                         JOIN {forum_discussions} d ON p.discussion = d.id
<a name="l2408"><span class="linenum">2408</span></a>                   WHERE d.forum = ?
<a name="l2409"><span class="linenum">2409</span></a>                GROUP BY p.discussion <a class="var it18622" onMouseOver="hilite(18622)" onMouseOut="lolite()" onClick="logVariable('groupby')" href="../../_variables/groupby.html">$groupby</a> <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a>&quot;;
<a name="l2410"><span class="linenum">2410</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>), <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a>, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>);
<a name="l2411"><span class="linenum">2411</span></a>      }
<a name="l2412"><span class="linenum">2412</span></a>  }
<a name="l2413"><span class="linenum">2413</span></a>  
<a name="l2414"><span class="linenum">2414</span></a>  <span class="comment">/**</span>
<a name="l2415"><span class="linenum">2415</span></a>  <span class="comment"> * @global object</span>
<a name="l2416"><span class="linenum">2416</span></a>  <span class="comment"> * @global object</span>
<a name="l2417"><span class="linenum">2417</span></a>  <span class="comment"> * @global object</span>
<a name="l2418"><span class="linenum">2418</span></a>  <span class="comment"> * @staticvar array $cache</span>
<a name="l2419"><span class="linenum">2419</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l2420"><span class="linenum">2420</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l2421"><span class="linenum">2421</span></a>  <span class="comment"> * @param object $course</span>
<a name="l2422"><span class="linenum">2422</span></a>  <span class="comment"> * @return mixed</span>
<a name="l2423"><span class="linenum">2423</span></a>  <span class="comment"> */</span>
<a name="l2424"><span class="linenum">2424</span></a>  function <a class="function" onClick="logFunction('forum_count_discussions')" href="../../_functions/forum_count_discussions.html" onMouseOver="funcPopup(event,'forum_count_discussions')">forum_count_discussions</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l2425"><span class="linenum">2425</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2426"><span class="linenum">2426</span></a>  
<a name="l2427"><span class="linenum">2427</span></a>      static <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../../_variables/cache.html">$cache</a> = array();
<a name="l2428"><span class="linenum">2428</span></a>  
<a name="l2429"><span class="linenum">2429</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2); <span class="comment">// db cache friendliness</span>
<a name="l2430"><span class="linenum">2430</span></a>  
<a name="l2431"><span class="linenum">2431</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2432"><span class="linenum">2432</span></a>  
<a name="l2433"><span class="linenum">2433</span></a>      if (!isset(<a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../../_variables/cache.html">$cache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l2434"><span class="linenum">2434</span></a>          if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2435"><span class="linenum">2435</span></a>              <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;AND d.timestart &lt; ? AND (d.timeend = 0 OR d.timeend &gt; ?)&quot;;
<a name="l2436"><span class="linenum">2436</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2437"><span class="linenum">2437</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2438"><span class="linenum">2438</span></a>          } else {
<a name="l2439"><span class="linenum">2439</span></a>              <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;&quot;;
<a name="l2440"><span class="linenum">2440</span></a>          }
<a name="l2441"><span class="linenum">2441</span></a>  
<a name="l2442"><span class="linenum">2442</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT f.id, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(d.id) as dcount
<a name="l2443"><span class="linenum">2443</span></a>                    FROM {forum} f
<a name="l2444"><span class="linenum">2444</span></a>                         JOIN {forum_discussions} d ON d.forum = f.id
<a name="l2445"><span class="linenum">2445</span></a>                   WHERE f.course = ?
<a name="l2446"><span class="linenum">2446</span></a>                         <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a>
<a name="l2447"><span class="linenum">2447</span></a>                GROUP BY f.id&quot;;
<a name="l2448"><span class="linenum">2448</span></a>  
<a name="l2449"><span class="linenum">2449</span></a>          if (<a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('counts')" href="../../_variables/counts.html">$counts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l2450"><span class="linenum">2450</span></a>              foreach (<a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('counts')" href="../../_variables/counts.html">$counts</a> as <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>) {
<a name="l2451"><span class="linenum">2451</span></a>                  <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('counts')" href="../../_variables/counts.html">$counts</a>[<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>-&gt;<a onClick="logVariable('id')" class="var it43239" onMouseOver="hilite(43239)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>-&gt;<a onClick="logVariable('dcount')" class="var it43239" onMouseOver="hilite(43239)" onMouseOut="lolite()" href="../../_variables/dcount.html">dcount</a>;
<a name="l2452"><span class="linenum">2452</span></a>              }
<a name="l2453"><span class="linenum">2453</span></a>              <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../../_variables/cache.html">$cache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('counts')" href="../../_variables/counts.html">$counts</a>;
<a name="l2454"><span class="linenum">2454</span></a>          } else {
<a name="l2455"><span class="linenum">2455</span></a>              <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../../_variables/cache.html">$cache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = array();
<a name="l2456"><span class="linenum">2456</span></a>          }
<a name="l2457"><span class="linenum">2457</span></a>      }
<a name="l2458"><span class="linenum">2458</span></a>  
<a name="l2459"><span class="linenum">2459</span></a>      if (empty(<a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../../_variables/cache.html">$cache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l2460"><span class="linenum">2460</span></a>          return 0;
<a name="l2461"><span class="linenum">2461</span></a>      }
<a name="l2462"><span class="linenum">2462</span></a>  
<a name="l2463"><span class="linenum">2463</span></a>      <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l2464"><span class="linenum">2464</span></a>  
<a name="l2465"><span class="linenum">2465</span></a>      if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> != <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>) {
<a name="l2466"><span class="linenum">2466</span></a>          return <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../../_variables/cache.html">$cache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l2467"><span class="linenum">2467</span></a>      }
<a name="l2468"><span class="linenum">2468</span></a>  
<a name="l2469"><span class="linenum">2469</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l2470"><span class="linenum">2470</span></a>          return <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../../_variables/cache.html">$cache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l2471"><span class="linenum">2471</span></a>      }
<a name="l2472"><span class="linenum">2472</span></a>  
<a name="l2473"><span class="linenum">2473</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../course/lib.php.html">/course/lib.php</a>');
<a name="l2474"><span class="linenum">2474</span></a>  
<a name="l2475"><span class="linenum">2475</span></a>      <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l2476"><span class="linenum">2476</span></a>  
<a name="l2477"><span class="linenum">2477</span></a>      <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_groups')" href="../../_functions/get_groups.html" onMouseOver="funcPopup(event,'get_groups')">get_groups</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>);
<a name="l2478"><span class="linenum">2478</span></a>  
<a name="l2479"><span class="linenum">2479</span></a>  <span class="comment">    // add all groups posts</span>
<a name="l2480"><span class="linenum">2480</span></a>      <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a>[-1] = -1;
<a name="l2481"><span class="linenum">2481</span></a>  
<a name="l2482"><span class="linenum">2482</span></a>      <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it41554" onMouseOver="hilite(41554)" onMouseOut="lolite()" onClick="logVariable('mygroups_sql')" href="../../_variables/mygroups_sql.html">$mygroups_sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a>);
<a name="l2483"><span class="linenum">2483</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2484"><span class="linenum">2484</span></a>  
<a name="l2485"><span class="linenum">2485</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2486"><span class="linenum">2486</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;AND d.timestart &lt; <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> AND (d.timeend = 0 OR d.timeend &gt; <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>)&quot;;
<a name="l2487"><span class="linenum">2487</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2488"><span class="linenum">2488</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2489"><span class="linenum">2489</span></a>      } else {
<a name="l2490"><span class="linenum">2490</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;&quot;;
<a name="l2491"><span class="linenum">2491</span></a>      }
<a name="l2492"><span class="linenum">2492</span></a>  
<a name="l2493"><span class="linenum">2493</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(d.id)
<a name="l2494"><span class="linenum">2494</span></a>                FROM {forum_discussions} d
<a name="l2495"><span class="linenum">2495</span></a>               WHERE d.groupid <a class="var it41554" onMouseOver="hilite(41554)" onMouseOut="lolite()" onClick="logVariable('mygroups_sql')" href="../../_variables/mygroups_sql.html">$mygroups_sql</a> AND d.forum = ?
<a name="l2496"><span class="linenum">2496</span></a>                     <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a>&quot;;
<a name="l2497"><span class="linenum">2497</span></a>  
<a name="l2498"><span class="linenum">2498</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2499"><span class="linenum">2499</span></a>  }
<a name="l2500"><span class="linenum">2500</span></a>  
<a name="l2501"><span class="linenum">2501</span></a>  <span class="comment">/**</span>
<a name="l2502"><span class="linenum">2502</span></a>  <span class="comment"> * Get all discussions in a forum</span>
<a name="l2503"><span class="linenum">2503</span></a>  <span class="comment"> *</span>
<a name="l2504"><span class="linenum">2504</span></a>  <span class="comment"> * @global object</span>
<a name="l2505"><span class="linenum">2505</span></a>  <span class="comment"> * @global object</span>
<a name="l2506"><span class="linenum">2506</span></a>  <span class="comment"> * @global object</span>
<a name="l2507"><span class="linenum">2507</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l2508"><span class="linenum">2508</span></a>  <span class="comment"> * @uses VISIBLEGROUPS</span>
<a name="l2509"><span class="linenum">2509</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l2510"><span class="linenum">2510</span></a>  <span class="comment"> * @param string $forumsort</span>
<a name="l2511"><span class="linenum">2511</span></a>  <span class="comment"> * @param bool $fullpost</span>
<a name="l2512"><span class="linenum">2512</span></a>  <span class="comment"> * @param int $unused</span>
<a name="l2513"><span class="linenum">2513</span></a>  <span class="comment"> * @param int $limit</span>
<a name="l2514"><span class="linenum">2514</span></a>  <span class="comment"> * @param bool $userlastmodified</span>
<a name="l2515"><span class="linenum">2515</span></a>  <span class="comment"> * @param int $page</span>
<a name="l2516"><span class="linenum">2516</span></a>  <span class="comment"> * @param int $perpage</span>
<a name="l2517"><span class="linenum">2517</span></a>  <span class="comment"> * @param int $groupid if groups enabled, get discussions for this group overriding the current group.</span>
<a name="l2518"><span class="linenum">2518</span></a>  <span class="comment"> *                     Use FORUM_POSTS_ALL_USER_GROUPS for all the user groups</span>
<a name="l2519"><span class="linenum">2519</span></a>  <span class="comment"> * @return array</span>
<a name="l2520"><span class="linenum">2520</span></a>  <span class="comment"> */</span>
<a name="l2521"><span class="linenum">2521</span></a>  function <a class="function" onClick="logFunction('forum_get_discussions')" href="../../_functions/forum_get_discussions.html" onMouseOver="funcPopup(event,'forum_get_discussions')">forum_get_discussions</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it28933" onMouseOver="hilite(28933)" onMouseOut="lolite()" onClick="logVariable('forumsort')" href="../../_variables/forumsort.html">$forumsort</a>=&quot;&quot;, <a class="var it41555" onMouseOver="hilite(41555)" onMouseOut="lolite()" onClick="logVariable('fullpost')" href="../../_variables/fullpost.html">$fullpost</a>=true, <a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>=-1, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>=-1,
<a name="l2522"><span class="linenum">2522</span></a>                                  <a class="var it41556" onMouseOver="hilite(41556)" onMouseOut="lolite()" onClick="logVariable('userlastmodified')" href="../../_variables/userlastmodified.html">$userlastmodified</a>=false, <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>=-1, <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>=0, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> = -1) {
<a name="l2523"><span class="linenum">2523</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2524"><span class="linenum">2524</span></a>  
<a name="l2525"><span class="linenum">2525</span></a>      <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> = '';
<a name="l2526"><span class="linenum">2526</span></a>  
<a name="l2527"><span class="linenum">2527</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2);
<a name="l2528"><span class="linenum">2528</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>);
<a name="l2529"><span class="linenum">2529</span></a>  
<a name="l2530"><span class="linenum">2530</span></a>      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2531"><span class="linenum">2531</span></a>  
<a name="l2532"><span class="linenum">2532</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) { /// User must have perms to view discussions
<a name="l2533"><span class="linenum">2533</span></a>          return array();
<a name="l2534"><span class="linenum">2534</span></a>      }
<a name="l2535"><span class="linenum">2535</span></a>  
<a name="l2536"><span class="linenum">2536</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) { /// Users must fulfill timed posts
<a name="l2537"><span class="linenum">2537</span></a>  
<a name="l2538"><span class="linenum">2538</span></a>          if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l2539"><span class="linenum">2539</span></a>              <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> = &quot; AND ((d.timestart &lt;= ? AND (d.timeend = 0 OR d.timeend &gt; ?))&quot;;
<a name="l2540"><span class="linenum">2540</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2541"><span class="linenum">2541</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2542"><span class="linenum">2542</span></a>              if (<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l2543"><span class="linenum">2543</span></a>                  <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> .= &quot; OR d.userid = ?&quot;;
<a name="l2544"><span class="linenum">2544</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2545"><span class="linenum">2545</span></a>              }
<a name="l2546"><span class="linenum">2546</span></a>              <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> .= &quot;)&quot;;
<a name="l2547"><span class="linenum">2547</span></a>          }
<a name="l2548"><span class="linenum">2548</span></a>      }
<a name="l2549"><span class="linenum">2549</span></a>  
<a name="l2550"><span class="linenum">2550</span></a>      if (<a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> &gt; 0) {
<a name="l2551"><span class="linenum">2551</span></a>          <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> = 0;
<a name="l2552"><span class="linenum">2552</span></a>          <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>  = <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>;
<a name="l2553"><span class="linenum">2553</span></a>      } else if (<a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a> != -1) {
<a name="l2554"><span class="linenum">2554</span></a>          <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> = <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>*<a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>;
<a name="l2555"><span class="linenum">2555</span></a>          <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>  = <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>;
<a name="l2556"><span class="linenum">2556</span></a>      } else {
<a name="l2557"><span class="linenum">2557</span></a>          <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> = 0;
<a name="l2558"><span class="linenum">2558</span></a>          <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>  = 0;
<a name="l2559"><span class="linenum">2559</span></a>      }
<a name="l2560"><span class="linenum">2560</span></a>  
<a name="l2561"><span class="linenum">2561</span></a>      <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>    = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l2562"><span class="linenum">2562</span></a>  
<a name="l2563"><span class="linenum">2563</span></a>      if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>) {
<a name="l2564"><span class="linenum">2564</span></a>  
<a name="l2565"><span class="linenum">2565</span></a>          if (empty(<a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l2566"><span class="linenum">2566</span></a>              <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2567"><span class="linenum">2567</span></a>          }
<a name="l2568"><span class="linenum">2568</span></a>  
<a name="l2569"><span class="linenum">2569</span></a>  <span class="comment">        // Special case, we received a groupid to override currentgroup.</span>
<a name="l2570"><span class="linenum">2570</span></a>          if (<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> &gt; 0) {
<a name="l2571"><span class="linenum">2571</span></a>              <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="function" onClick="logFunction('get_course')" href="../../_functions/get_course.html" onMouseOver="funcPopup(event,'get_course')">get_course</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>);
<a name="l2572"><span class="linenum">2572</span></a>              if (!<a class="function" onClick="logFunction('groups_group_visible')" href="../../_functions/groups_group_visible.html" onMouseOver="funcPopup(event,'groups_group_visible')">groups_group_visible</a>(<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l2573"><span class="linenum">2573</span></a>  <span class="comment">                // User doesn't belong to this group, return nothing.</span>
<a name="l2574"><span class="linenum">2574</span></a>                  return array();
<a name="l2575"><span class="linenum">2575</span></a>              }
<a name="l2576"><span class="linenum">2576</span></a>              <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l2577"><span class="linenum">2577</span></a>          } else if (<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> === -1) {
<a name="l2578"><span class="linenum">2578</span></a>              <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = <a class="function" onClick="logFunction('groups_get_activity_group')" href="../../_functions/groups_get_activity_group.html" onMouseOver="funcPopup(event,'groups_get_activity_group')">groups_get_activity_group</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l2579"><span class="linenum">2579</span></a>          } else {
<a name="l2580"><span class="linenum">2580</span></a>  <span class="comment">            // Get discussions for all groups current user can see.</span>
<a name="l2581"><span class="linenum">2581</span></a>              <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = null;
<a name="l2582"><span class="linenum">2582</span></a>          }
<a name="l2583"><span class="linenum">2583</span></a>  
<a name="l2584"><span class="linenum">2584</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == <a class="constant" onClick="logConstant('VISIBLEGROUPS')" href="../../_constants/VISIBLEGROUPS.html" onMouseOver="constPopup(event,'VISIBLEGROUPS')">VISIBLEGROUPS</a> or <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l2585"><span class="linenum">2585</span></a>              if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l2586"><span class="linenum">2586</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND (d.groupid = ? OR d.groupid = -1)&quot;;
<a name="l2587"><span class="linenum">2587</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>;
<a name="l2588"><span class="linenum">2588</span></a>              } else {
<a name="l2589"><span class="linenum">2589</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l2590"><span class="linenum">2590</span></a>              }
<a name="l2591"><span class="linenum">2591</span></a>  
<a name="l2592"><span class="linenum">2592</span></a>          } else {
<a name="l2593"><span class="linenum">2593</span></a>  <span class="comment">            // Separate groups.</span>
<a name="l2594"><span class="linenum">2594</span></a>  
<a name="l2595"><span class="linenum">2595</span></a>  <span class="comment">            // Get discussions for all groups current user can see.</span>
<a name="l2596"><span class="linenum">2596</span></a>              if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> === null) {
<a name="l2597"><span class="linenum">2597</span></a>                  <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="function" onClick="logFunction('groups_get_all_groups')" href="../../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>, 'g.id'));
<a name="l2598"><span class="linenum">2598</span></a>                  if (empty(<a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a>)) {
<a name="l2599"><span class="linenum">2599</span></a>                       <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND d.groupid = -1&quot;;
<a name="l2600"><span class="linenum">2600</span></a>                  } else {
<a name="l2601"><span class="linenum">2601</span></a>                      <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it39007" onMouseOver="hilite(39007)" onMouseOut="lolite()" onClick="logVariable('insqlgroups')" href="../../_variables/insqlgroups.html">$insqlgroups</a>, <a class="var it39008" onMouseOver="hilite(39008)" onMouseOut="lolite()" onClick="logVariable('inparamsgroups')" href="../../_variables/inparamsgroups.html">$inparamsgroups</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a>);
<a name="l2602"><span class="linenum">2602</span></a>                      <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND (d.groupid = -1 OR d.groupid <a class="var it39007" onMouseOver="hilite(39007)" onMouseOut="lolite()" onClick="logVariable('insqlgroups')" href="../../_variables/insqlgroups.html">$insqlgroups</a>)&quot;;
<a name="l2603"><span class="linenum">2603</span></a>                      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it39008" onMouseOver="hilite(39008)" onMouseOut="lolite()" onClick="logVariable('inparamsgroups')" href="../../_variables/inparamsgroups.html">$inparamsgroups</a>);
<a name="l2604"><span class="linenum">2604</span></a>                  }
<a name="l2605"><span class="linenum">2605</span></a>              } else if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l2606"><span class="linenum">2606</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND (d.groupid = ? OR d.groupid = -1)&quot;;
<a name="l2607"><span class="linenum">2607</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>;
<a name="l2608"><span class="linenum">2608</span></a>              } else {
<a name="l2609"><span class="linenum">2609</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND d.groupid = -1&quot;;
<a name="l2610"><span class="linenum">2610</span></a>              }
<a name="l2611"><span class="linenum">2611</span></a>          }
<a name="l2612"><span class="linenum">2612</span></a>      } else {
<a name="l2613"><span class="linenum">2613</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l2614"><span class="linenum">2614</span></a>      }
<a name="l2615"><span class="linenum">2615</span></a>      if (empty(<a class="var it28933" onMouseOver="hilite(28933)" onMouseOut="lolite()" onClick="logVariable('forumsort')" href="../../_variables/forumsort.html">$forumsort</a>)) {
<a name="l2616"><span class="linenum">2616</span></a>          <a class="var it28933" onMouseOver="hilite(28933)" onMouseOut="lolite()" onClick="logVariable('forumsort')" href="../../_variables/forumsort.html">$forumsort</a> = <a class="function" onClick="logFunction('forum_get_default_sort_order')" href="../../_functions/forum_get_default_sort_order.html" onMouseOver="funcPopup(event,'forum_get_default_sort_order')">forum_get_default_sort_order</a>();
<a name="l2617"><span class="linenum">2617</span></a>      }
<a name="l2618"><span class="linenum">2618</span></a>      if (empty(<a class="var it41555" onMouseOver="hilite(41555)" onMouseOut="lolite()" onClick="logVariable('fullpost')" href="../../_variables/fullpost.html">$fullpost</a>)) {
<a name="l2619"><span class="linenum">2619</span></a>          <a class="var it8925" onMouseOver="hilite(8925)" onMouseOut="lolite()" onClick="logVariable('postdata')" href="../../_variables/postdata.html">$postdata</a> = &quot;p.id,p.subject,p.modified,p.discussion,p.userid&quot;;
<a name="l2620"><span class="linenum">2620</span></a>      } else {
<a name="l2621"><span class="linenum">2621</span></a>          <a class="var it8925" onMouseOver="hilite(8925)" onMouseOut="lolite()" onClick="logVariable('postdata')" href="../../_variables/postdata.html">$postdata</a> = &quot;p.*&quot;;
<a name="l2622"><span class="linenum">2622</span></a>      }
<a name="l2623"><span class="linenum">2623</span></a>  
<a name="l2624"><span class="linenum">2624</span></a>      if (empty(<a class="var it41556" onMouseOver="hilite(41556)" onMouseOut="lolite()" onClick="logVariable('userlastmodified')" href="../../_variables/userlastmodified.html">$userlastmodified</a>)) {  // We don't need to know this
<a name="l2625"><span class="linenum">2625</span></a>          <a class="var it41557" onMouseOver="hilite(41557)" onMouseOut="lolite()" onClick="logVariable('umfields')" href="../../_variables/umfields.html">$umfields</a> = &quot;&quot;;
<a name="l2626"><span class="linenum">2626</span></a>          <a class="var it41558" onMouseOver="hilite(41558)" onMouseOut="lolite()" onClick="logVariable('umtable')" href="../../_variables/umtable.html">$umtable</a>  = &quot;&quot;;
<a name="l2627"><span class="linenum">2627</span></a>      } else {
<a name="l2628"><span class="linenum">2628</span></a>          <a class="var it41557" onMouseOver="hilite(41557)" onMouseOut="lolite()" onClick="logVariable('umfields')" href="../../_variables/umfields.html">$umfields</a> = ', ' . <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'um', null, 'um') . ', um.email AS umemail, um.picture AS umpicture,
<a name="l2629"><span class="linenum">2629</span></a>                          um.imagealt AS umimagealt';
<a name="l2630"><span class="linenum">2630</span></a>          <a class="var it41558" onMouseOver="hilite(41558)" onMouseOut="lolite()" onClick="logVariable('umtable')" href="../../_variables/umtable.html">$umtable</a>  = &quot; LEFT JOIN {user} um <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (d.usermodified = um.id)&quot;;
<a name="l2631"><span class="linenum">2631</span></a>      }
<a name="l2632"><span class="linenum">2632</span></a>  
<a name="l2633"><span class="linenum">2633</span></a>      <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u');
<a name="l2634"><span class="linenum">2634</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it8925" onMouseOver="hilite(8925)" onMouseOut="lolite()" onClick="logVariable('postdata')" href="../../_variables/postdata.html">$postdata</a>, d.name, d.timemodified, d.usermodified, d.groupid, d.timestart, d.timeend, d.pinned, <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a>,
<a name="l2635"><span class="linenum">2635</span></a>                     u.email, u.picture, u.imagealt <a class="var it41557" onMouseOver="hilite(41557)" onMouseOut="lolite()" onClick="logVariable('umfields')" href="../../_variables/umfields.html">$umfields</a>
<a name="l2636"><span class="linenum">2636</span></a>                FROM {forum_discussions} d
<a name="l2637"><span class="linenum">2637</span></a>                     JOIN {forum_posts} p ON p.discussion = d.id
<a name="l2638"><span class="linenum">2638</span></a>                     JOIN {user} u ON p.userid = u.id
<a name="l2639"><span class="linenum">2639</span></a>                     <a class="var it41558" onMouseOver="hilite(41558)" onMouseOut="lolite()" onClick="logVariable('umtable')" href="../../_variables/umtable.html">$umtable</a>
<a name="l2640"><span class="linenum">2640</span></a>               WHERE d.forum = ? AND p.parent = 0
<a name="l2641"><span class="linenum">2641</span></a>                     <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a>
<a name="l2642"><span class="linenum">2642</span></a>            ORDER BY <a class="var it28933" onMouseOver="hilite(28933)" onMouseOut="lolite()" onClick="logVariable('forumsort')" href="../../_variables/forumsort.html">$forumsort</a>, d.id DESC&quot;;
<a name="l2643"><span class="linenum">2643</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a>, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>);
<a name="l2644"><span class="linenum">2644</span></a>  }
<a name="l2645"><span class="linenum">2645</span></a>  
<a name="l2646"><span class="linenum">2646</span></a>  <span class="comment">/**</span>
<a name="l2647"><span class="linenum">2647</span></a>  <span class="comment"> * Gets the neighbours (previous and next) of a discussion.</span>
<a name="l2648"><span class="linenum">2648</span></a>  <span class="comment"> *</span>
<a name="l2649"><span class="linenum">2649</span></a>  <span class="comment"> * The calculation is based on the timemodified when time modified or time created is identical</span>
<a name="l2650"><span class="linenum">2650</span></a>  <span class="comment"> * It will revert to using the ID to sort consistently. This is better tha skipping a discussion.</span>
<a name="l2651"><span class="linenum">2651</span></a>  <span class="comment"> *</span>
<a name="l2652"><span class="linenum">2652</span></a>  <span class="comment"> * For blog-style forums, the calculation is based on the original creation time of the</span>
<a name="l2653"><span class="linenum">2653</span></a>  <span class="comment"> * blog post.</span>
<a name="l2654"><span class="linenum">2654</span></a>  <span class="comment"> *</span>
<a name="l2655"><span class="linenum">2655</span></a>  <span class="comment"> * Please note that this does not check whether or not the discussion passed is accessible</span>
<a name="l2656"><span class="linenum">2656</span></a>  <span class="comment"> * by the user, it simply uses it as a reference to find the neighbours. On the other hand,</span>
<a name="l2657"><span class="linenum">2657</span></a>  <span class="comment"> * the returned neighbours are checked and are accessible to the current user.</span>
<a name="l2658"><span class="linenum">2658</span></a>  <span class="comment"> *</span>
<a name="l2659"><span class="linenum">2659</span></a>  <span class="comment"> * @param object $cm The CM record.</span>
<a name="l2660"><span class="linenum">2660</span></a>  <span class="comment"> * @param object $discussion The discussion record.</span>
<a name="l2661"><span class="linenum">2661</span></a>  <span class="comment"> * @param object $forum The forum instance record.</span>
<a name="l2662"><span class="linenum">2662</span></a>  <span class="comment"> * @return array That always contains the keys 'prev' and 'next'. When there is a result</span>
<a name="l2663"><span class="linenum">2663</span></a>  <span class="comment"> *               they contain the record with minimal information such as 'id' and 'name'.</span>
<a name="l2664"><span class="linenum">2664</span></a>  <span class="comment"> *               When the neighbour is not found the value is false.</span>
<a name="l2665"><span class="linenum">2665</span></a>  <span class="comment"> */</span>
<a name="l2666"><span class="linenum">2666</span></a>  function <a class="function" onClick="logFunction('forum_get_discussion_neighbours')" href="../../_functions/forum_get_discussion_neighbours.html" onMouseOver="funcPopup(event,'forum_get_discussion_neighbours')">forum_get_discussion_neighbours</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l2667"><span class="linenum">2667</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2668"><span class="linenum">2668</span></a>  
<a name="l2669"><span class="linenum">2669</span></a>      if (<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a> != <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a> or <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a> != <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> or <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> != <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>) {
<a name="l2670"><span class="linenum">2670</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Discussion is not part of the same forum.');
<a name="l2671"><span class="linenum">2671</span></a>      }
<a name="l2672"><span class="linenum">2672</span></a>  
<a name="l2673"><span class="linenum">2673</span></a>      <a class="var it24380" onMouseOver="hilite(24380)" onMouseOut="lolite()" onClick="logVariable('neighbours')" href="../../_variables/neighbours.html">$neighbours</a> = array('prev' =&gt; false, 'next' =&gt; false);
<a name="l2674"><span class="linenum">2674</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2);
<a name="l2675"><span class="linenum">2675</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l2676"><span class="linenum">2676</span></a>  
<a name="l2677"><span class="linenum">2677</span></a>      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2678"><span class="linenum">2678</span></a>      <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>    = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l2679"><span class="linenum">2679</span></a>      <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = <a class="function" onClick="logFunction('groups_get_activity_group')" href="../../_functions/groups_get_activity_group.html" onMouseOver="funcPopup(event,'groups_get_activity_group')">groups_get_activity_group</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l2680"><span class="linenum">2680</span></a>  
<a name="l2681"><span class="linenum">2681</span></a>  <span class="comment">    // Users must fulfill timed posts.</span>
<a name="l2682"><span class="linenum">2682</span></a>      <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> = '';
<a name="l2683"><span class="linenum">2683</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2684"><span class="linenum">2684</span></a>          if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l2685"><span class="linenum">2685</span></a>              <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> = ' AND ((d.timestart &lt;= :tltimestart AND (d.timeend = 0 OR d.timeend &gt; :tltimeend))';
<a name="l2686"><span class="linenum">2686</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['tltimestart'] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2687"><span class="linenum">2687</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['tltimeend'] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2688"><span class="linenum">2688</span></a>              if (<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l2689"><span class="linenum">2689</span></a>                  <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> .= ' OR d.userid = :tluserid';
<a name="l2690"><span class="linenum">2690</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['tluserid'] = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2691"><span class="linenum">2691</span></a>              }
<a name="l2692"><span class="linenum">2692</span></a>              <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> .= ')';
<a name="l2693"><span class="linenum">2693</span></a>          }
<a name="l2694"><span class="linenum">2694</span></a>      }
<a name="l2695"><span class="linenum">2695</span></a>  
<a name="l2696"><span class="linenum">2696</span></a>  <span class="comment">    // Limiting to posts accessible according to groups.</span>
<a name="l2697"><span class="linenum">2697</span></a>      <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = '';
<a name="l2698"><span class="linenum">2698</span></a>      if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>) {
<a name="l2699"><span class="linenum">2699</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == <a class="constant" onClick="logConstant('VISIBLEGROUPS')" href="../../_constants/VISIBLEGROUPS.html" onMouseOver="constPopup(event,'VISIBLEGROUPS')">VISIBLEGROUPS</a> || <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l2700"><span class="linenum">2700</span></a>              if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l2701"><span class="linenum">2701</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = 'AND (d.groupid = :groupid OR d.groupid = -1)';
<a name="l2702"><span class="linenum">2702</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['groupid'] = <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>;
<a name="l2703"><span class="linenum">2703</span></a>              }
<a name="l2704"><span class="linenum">2704</span></a>          } else {
<a name="l2705"><span class="linenum">2705</span></a>              if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l2706"><span class="linenum">2706</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = 'AND (d.groupid = :groupid OR d.groupid = -1)';
<a name="l2707"><span class="linenum">2707</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['groupid'] = <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>;
<a name="l2708"><span class="linenum">2708</span></a>              } else {
<a name="l2709"><span class="linenum">2709</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = 'AND d.groupid = -1';
<a name="l2710"><span class="linenum">2710</span></a>              }
<a name="l2711"><span class="linenum">2711</span></a>          }
<a name="l2712"><span class="linenum">2712</span></a>      }
<a name="l2713"><span class="linenum">2713</span></a>  
<a name="l2714"><span class="linenum">2714</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['forumid'] = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>;
<a name="l2715"><span class="linenum">2715</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['discid1'] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2716"><span class="linenum">2716</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['discid2'] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2717"><span class="linenum">2717</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['discid3'] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2718"><span class="linenum">2718</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['discid4'] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2719"><span class="linenum">2719</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['disctimecompare1'] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>;
<a name="l2720"><span class="linenum">2720</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['disctimecompare2'] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>;
<a name="l2721"><span class="linenum">2721</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['pinnedstate1'] = (int) <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('pinned')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/pinned.html">pinned</a>;
<a name="l2722"><span class="linenum">2722</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['pinnedstate2'] = (int) <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('pinned')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/pinned.html">pinned</a>;
<a name="l2723"><span class="linenum">2723</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['pinnedstate3'] = (int) <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('pinned')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/pinned.html">pinned</a>;
<a name="l2724"><span class="linenum">2724</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['pinnedstate4'] = (int) <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('pinned')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/pinned.html">pinned</a>;
<a name="l2725"><span class="linenum">2725</span></a>  
<a name="l2726"><span class="linenum">2726</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT d.id, d.name, d.timemodified, d.groupid, d.timestart, d.timeend
<a name="l2727"><span class="linenum">2727</span></a>                FROM {forum_discussions} d
<a name="l2728"><span class="linenum">2728</span></a>                JOIN {forum_posts} p ON d.firstpost = p.id
<a name="l2729"><span class="linenum">2729</span></a>               WHERE d.forum = :forumid
<a name="l2730"><span class="linenum">2730</span></a>                 AND d.id &lt;&gt; :discid1
<a name="l2731"><span class="linenum">2731</span></a>                     <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a>
<a name="l2732"><span class="linenum">2732</span></a>                     <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a>&quot;;
<a name="l2733"><span class="linenum">2733</span></a>      <a class="var it41559" onMouseOver="hilite(41559)" onMouseOut="lolite()" onClick="logVariable('comparefield')" href="../../_variables/comparefield.html">$comparefield</a> = &quot;d.timemodified&quot;;
<a name="l2734"><span class="linenum">2734</span></a>      <a class="var it41560" onMouseOver="hilite(41560)" onMouseOut="lolite()" onClick="logVariable('comparevalue')" href="../../_variables/comparevalue.html">$comparevalue</a> = &quot;:disctimecompare1&quot;;
<a name="l2735"><span class="linenum">2735</span></a>      <a class="var it41561" onMouseOver="hilite(41561)" onMouseOut="lolite()" onClick="logVariable('comparevalue2')" href="../../_variables/comparevalue2.html">$comparevalue2</a>  = &quot;:disctimecompare2&quot;;
<a name="l2736"><span class="linenum">2736</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2737"><span class="linenum">2737</span></a>  <span class="comment">        // Here we need to take into account the release time (timestart)</span>
<a name="l2738"><span class="linenum">2738</span></a>  <span class="comment">        // if one is set, of the neighbouring posts and compare it to the</span>
<a name="l2739"><span class="linenum">2739</span></a>  <span class="comment">        // timestart or timemodified of *this* post depending on if the</span>
<a name="l2740"><span class="linenum">2740</span></a>  <span class="comment">        // release date of this post is in the future or not.</span>
<a name="l2741"><span class="linenum">2741</span></a>  <span class="comment">        // This stops discussions that appear later because of the</span>
<a name="l2742"><span class="linenum">2742</span></a>  <span class="comment">        // timestart value from being buried under discussions that were</span>
<a name="l2743"><span class="linenum">2743</span></a>  <span class="comment">        // made afterwards.</span>
<a name="l2744"><span class="linenum">2744</span></a>          <a class="var it41559" onMouseOver="hilite(41559)" onMouseOut="lolite()" onClick="logVariable('comparefield')" href="../../_variables/comparefield.html">$comparefield</a> = &quot;CASE WHEN d.timemodified &lt; d.timestart
<a name="l2745"><span class="linenum">2745</span></a>                                  THEN d.timestart ELSE d.timemodified END&quot;;
<a name="l2746"><span class="linenum">2746</span></a>          if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> &lt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timestart')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>) {
<a name="l2747"><span class="linenum">2747</span></a>  <span class="comment">            // Normally we would just use the timemodified for sorting</span>
<a name="l2748"><span class="linenum">2748</span></a>  <span class="comment">            // discussion posts. However, when timed discussions are enabled,</span>
<a name="l2749"><span class="linenum">2749</span></a>  <span class="comment">            // then posts need to be sorted base on the later of timemodified</span>
<a name="l2750"><span class="linenum">2750</span></a>  <span class="comment">            // or the release date of the post (timestart).</span>
<a name="l2751"><span class="linenum">2751</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['disctimecompare1'] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timestart')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>;
<a name="l2752"><span class="linenum">2752</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['disctimecompare2'] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timestart')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>;
<a name="l2753"><span class="linenum">2753</span></a>          }
<a name="l2754"><span class="linenum">2754</span></a>      }
<a name="l2755"><span class="linenum">2755</span></a>      <a class="var it41562" onMouseOver="hilite(41562)" onMouseOut="lolite()" onClick="logVariable('orderbydesc')" href="../../_variables/orderbydesc.html">$orderbydesc</a> = <a class="function" onClick="logFunction('forum_get_default_sort_order')" href="../../_functions/forum_get_default_sort_order.html" onMouseOver="funcPopup(event,'forum_get_default_sort_order')">forum_get_default_sort_order</a>(true, <a class="var it41559" onMouseOver="hilite(41559)" onMouseOut="lolite()" onClick="logVariable('comparefield')" href="../../_variables/comparefield.html">$comparefield</a>, 'd', false);
<a name="l2756"><span class="linenum">2756</span></a>      <a class="var it41563" onMouseOver="hilite(41563)" onMouseOut="lolite()" onClick="logVariable('orderbyasc')" href="../../_variables/orderbyasc.html">$orderbyasc</a> = <a class="function" onClick="logFunction('forum_get_default_sort_order')" href="../../_functions/forum_get_default_sort_order.html" onMouseOver="funcPopup(event,'forum_get_default_sort_order')">forum_get_default_sort_order</a>(false, <a class="var it41559" onMouseOver="hilite(41559)" onMouseOut="lolite()" onClick="logVariable('comparefield')" href="../../_variables/comparefield.html">$comparefield</a>, 'd', false);
<a name="l2757"><span class="linenum">2757</span></a>  
<a name="l2758"><span class="linenum">2758</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> === 'blog') {
<a name="l2759"><span class="linenum">2759</span></a>           <a class="var it12905" onMouseOver="hilite(12905)" onMouseOut="lolite()" onClick="logVariable('subselect')" href="../../_variables/subselect.html">$subselect</a> = &quot;SELECT pp.created
<a name="l2760"><span class="linenum">2760</span></a>                     FROM {forum_discussions} dd
<a name="l2761"><span class="linenum">2761</span></a>                     JOIN {forum_posts} pp ON dd.firstpost = pp.id &quot;;
<a name="l2762"><span class="linenum">2762</span></a>  
<a name="l2763"><span class="linenum">2763</span></a>           <a class="var it41564" onMouseOver="hilite(41564)" onMouseOut="lolite()" onClick="logVariable('subselectwhere1')" href="../../_variables/subselectwhere1.html">$subselectwhere1</a> = &quot; WHERE dd.id = :discid3&quot;;
<a name="l2764"><span class="linenum">2764</span></a>           <a class="var it41565" onMouseOver="hilite(41565)" onMouseOut="lolite()" onClick="logVariable('subselectwhere2')" href="../../_variables/subselectwhere2.html">$subselectwhere2</a> = &quot; WHERE dd.id = :discid4&quot;;
<a name="l2765"><span class="linenum">2765</span></a>  
<a name="l2766"><span class="linenum">2766</span></a>           <a class="var it41559" onMouseOver="hilite(41559)" onMouseOut="lolite()" onClick="logVariable('comparefield')" href="../../_variables/comparefield.html">$comparefield</a> = &quot;p.created&quot;;
<a name="l2767"><span class="linenum">2767</span></a>  
<a name="l2768"><span class="linenum">2768</span></a>           <a class="var it15770" onMouseOver="hilite(15770)" onMouseOut="lolite()" onClick="logVariable('sub1')" href="../../_variables/sub1.html">$sub1</a> = <a class="var it12905" onMouseOver="hilite(12905)" onMouseOut="lolite()" onClick="logVariable('subselect')" href="../../_variables/subselect.html">$subselect</a>.<a class="var it41564" onMouseOver="hilite(41564)" onMouseOut="lolite()" onClick="logVariable('subselectwhere1')" href="../../_variables/subselectwhere1.html">$subselectwhere1</a>;
<a name="l2769"><span class="linenum">2769</span></a>           <a class="var it41560" onMouseOver="hilite(41560)" onMouseOut="lolite()" onClick="logVariable('comparevalue')" href="../../_variables/comparevalue.html">$comparevalue</a> = &quot;(<a class="var it15770" onMouseOver="hilite(15770)" onMouseOut="lolite()" onClick="logVariable('sub1')" href="../../_variables/sub1.html">$sub1</a>)&quot;;
<a name="l2770"><span class="linenum">2770</span></a>  
<a name="l2771"><span class="linenum">2771</span></a>           <a class="var it15771" onMouseOver="hilite(15771)" onMouseOut="lolite()" onClick="logVariable('sub2')" href="../../_variables/sub2.html">$sub2</a> = <a class="var it12905" onMouseOver="hilite(12905)" onMouseOut="lolite()" onClick="logVariable('subselect')" href="../../_variables/subselect.html">$subselect</a>.<a class="var it41565" onMouseOver="hilite(41565)" onMouseOut="lolite()" onClick="logVariable('subselectwhere2')" href="../../_variables/subselectwhere2.html">$subselectwhere2</a>;
<a name="l2772"><span class="linenum">2772</span></a>           <a class="var it41561" onMouseOver="hilite(41561)" onMouseOut="lolite()" onClick="logVariable('comparevalue2')" href="../../_variables/comparevalue2.html">$comparevalue2</a> = &quot;(<a class="var it15771" onMouseOver="hilite(15771)" onMouseOut="lolite()" onClick="logVariable('sub2')" href="../../_variables/sub2.html">$sub2</a>)&quot;;
<a name="l2773"><span class="linenum">2773</span></a>  
<a name="l2774"><span class="linenum">2774</span></a>           <a class="var it41562" onMouseOver="hilite(41562)" onMouseOut="lolite()" onClick="logVariable('orderbydesc')" href="../../_variables/orderbydesc.html">$orderbydesc</a> = &quot;d.pinned, p.created DESC&quot;;
<a name="l2775"><span class="linenum">2775</span></a>           <a class="var it41563" onMouseOver="hilite(41563)" onMouseOut="lolite()" onClick="logVariable('orderbyasc')" href="../../_variables/orderbyasc.html">$orderbyasc</a> = &quot;d.pinned, p.created ASC&quot;;
<a name="l2776"><span class="linenum">2776</span></a>      }
<a name="l2777"><span class="linenum">2777</span></a>  
<a name="l2778"><span class="linenum">2778</span></a>      <a class="var it41566" onMouseOver="hilite(41566)" onMouseOut="lolite()" onClick="logVariable('prevsql')" href="../../_variables/prevsql.html">$prevsql</a> = <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> . &quot; AND ( ((<a class="var it41559" onMouseOver="hilite(41559)" onMouseOut="lolite()" onClick="logVariable('comparefield')" href="../../_variables/comparefield.html">$comparefield</a> &lt; <a class="var it41560" onMouseOver="hilite(41560)" onMouseOut="lolite()" onClick="logVariable('comparevalue')" href="../../_variables/comparevalue.html">$comparevalue</a>) AND :pinnedstate1 = d.pinned)
<a name="l2779"><span class="linenum">2779</span></a>                           <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (<a class="var it41559" onMouseOver="hilite(41559)" onMouseOut="lolite()" onClick="logVariable('comparefield')" href="../../_variables/comparefield.html">$comparefield</a> = <a class="var it41561" onMouseOver="hilite(41561)" onMouseOut="lolite()" onClick="logVariable('comparevalue2')" href="../../_variables/comparevalue2.html">$comparevalue2</a> AND (d.pinned = 0 OR d.pinned = :pinnedstate4) AND d.id &lt; :discid2)
<a name="l2780"><span class="linenum">2780</span></a>                           <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (d.pinned = 0 AND d.pinned &lt;&gt; :pinnedstate2))
<a name="l2781"><span class="linenum">2781</span></a>                     ORDER BY CASE WHEN d.pinned = :pinnedstate3 THEN 1 ELSE 0 END DESC, <a class="var it41562" onMouseOver="hilite(41562)" onMouseOut="lolite()" onClick="logVariable('orderbydesc')" href="../../_variables/orderbydesc.html">$orderbydesc</a>, d.id DESC&quot;;
<a name="l2782"><span class="linenum">2782</span></a>  
<a name="l2783"><span class="linenum">2783</span></a>      <a class="var it41567" onMouseOver="hilite(41567)" onMouseOut="lolite()" onClick="logVariable('nextsql')" href="../../_variables/nextsql.html">$nextsql</a> = <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> . &quot; AND ( ((<a class="var it41559" onMouseOver="hilite(41559)" onMouseOut="lolite()" onClick="logVariable('comparefield')" href="../../_variables/comparefield.html">$comparefield</a> &gt; <a class="var it41560" onMouseOver="hilite(41560)" onMouseOut="lolite()" onClick="logVariable('comparevalue')" href="../../_variables/comparevalue.html">$comparevalue</a>) AND :pinnedstate1 = d.pinned)
<a name="l2784"><span class="linenum">2784</span></a>                           <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (<a class="var it41559" onMouseOver="hilite(41559)" onMouseOut="lolite()" onClick="logVariable('comparefield')" href="../../_variables/comparefield.html">$comparefield</a> = <a class="var it41561" onMouseOver="hilite(41561)" onMouseOut="lolite()" onClick="logVariable('comparevalue2')" href="../../_variables/comparevalue2.html">$comparevalue2</a> AND (d.pinned = 1 OR d.pinned = :pinnedstate4) AND d.id &gt; :discid2)
<a name="l2785"><span class="linenum">2785</span></a>                           <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (d.pinned = 1 AND d.pinned &lt;&gt; :pinnedstate2))
<a name="l2786"><span class="linenum">2786</span></a>                     ORDER BY CASE WHEN d.pinned = :pinnedstate3 THEN 1 ELSE 0 END DESC, <a class="var it41563" onMouseOver="hilite(41563)" onMouseOut="lolite()" onClick="logVariable('orderbyasc')" href="../../_variables/orderbyasc.html">$orderbyasc</a>, d.id ASC&quot;;
<a name="l2787"><span class="linenum">2787</span></a>  
<a name="l2788"><span class="linenum">2788</span></a>      <a class="var it24380" onMouseOver="hilite(24380)" onMouseOut="lolite()" onClick="logVariable('neighbours')" href="../../_variables/neighbours.html">$neighbours</a>['prev'] = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it41566" onMouseOver="hilite(41566)" onMouseOut="lolite()" onClick="logVariable('prevsql')" href="../../_variables/prevsql.html">$prevsql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="constant" onClick="logConstant('IGNORE_MULTIPLE')" href="../../_constants/IGNORE_MULTIPLE.html" onMouseOver="constPopup(event,'IGNORE_MULTIPLE')">IGNORE_MULTIPLE</a>);
<a name="l2789"><span class="linenum">2789</span></a>      <a class="var it24380" onMouseOver="hilite(24380)" onMouseOut="lolite()" onClick="logVariable('neighbours')" href="../../_variables/neighbours.html">$neighbours</a>['next'] = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it41567" onMouseOver="hilite(41567)" onMouseOut="lolite()" onClick="logVariable('nextsql')" href="../../_variables/nextsql.html">$nextsql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="constant" onClick="logConstant('IGNORE_MULTIPLE')" href="../../_constants/IGNORE_MULTIPLE.html" onMouseOver="constPopup(event,'IGNORE_MULTIPLE')">IGNORE_MULTIPLE</a>);
<a name="l2790"><span class="linenum">2790</span></a>      return <a class="var it24380" onMouseOver="hilite(24380)" onMouseOut="lolite()" onClick="logVariable('neighbours')" href="../../_variables/neighbours.html">$neighbours</a>;
<a name="l2791"><span class="linenum">2791</span></a>  }
<a name="l2792"><span class="linenum">2792</span></a>  
<a name="l2793"><span class="linenum">2793</span></a>  <span class="comment">/**</span>
<a name="l2794"><span class="linenum">2794</span></a>  <span class="comment"> * Get the sql to use in the ORDER BY clause for forum discussions.</span>
<a name="l2795"><span class="linenum">2795</span></a>  <span class="comment"> *</span>
<a name="l2796"><span class="linenum">2796</span></a>  <span class="comment"> * This has the ordering take timed discussion windows into account.</span>
<a name="l2797"><span class="linenum">2797</span></a>  <span class="comment"> *</span>
<a name="l2798"><span class="linenum">2798</span></a>  <span class="comment"> * @param bool $desc True for DESC, False for ASC.</span>
<a name="l2799"><span class="linenum">2799</span></a>  <span class="comment"> * @param string $compare The field in the SQL to compare to normally sort by.</span>
<a name="l2800"><span class="linenum">2800</span></a>  <span class="comment"> * @param string $prefix The prefix being used for the discussion table.</span>
<a name="l2801"><span class="linenum">2801</span></a>  <span class="comment"> * @param bool $pinned sort pinned posts to the top</span>
<a name="l2802"><span class="linenum">2802</span></a>  <span class="comment"> * @return string</span>
<a name="l2803"><span class="linenum">2803</span></a>  <span class="comment"> */</span>
<a name="l2804"><span class="linenum">2804</span></a>  function <a class="function" onClick="logFunction('forum_get_default_sort_order')" href="../../_functions/forum_get_default_sort_order.html" onMouseOver="funcPopup(event,'forum_get_default_sort_order')">forum_get_default_sort_order</a>(<a class="var it740" onMouseOver="hilite(740)" onMouseOut="lolite()" onClick="logVariable('desc')" href="../../_variables/desc.html">$desc</a> = true, <a class="var it13618" onMouseOver="hilite(13618)" onMouseOut="lolite()" onClick="logVariable('compare')" href="../../_variables/compare.html">$compare</a> = 'd.timemodified', <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a> = 'd', <a class="var it24387" onMouseOver="hilite(24387)" onMouseOut="lolite()" onClick="logVariable('pinned')" href="../../_variables/pinned.html">$pinned</a> = true) {
<a name="l2805"><span class="linenum">2805</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l2806"><span class="linenum">2806</span></a>  
<a name="l2807"><span class="linenum">2807</span></a>      if (!empty(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>)) {
<a name="l2808"><span class="linenum">2808</span></a>          <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a> .= '.';
<a name="l2809"><span class="linenum">2809</span></a>      }
<a name="l2810"><span class="linenum">2810</span></a>  
<a name="l2811"><span class="linenum">2811</span></a>      <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a> = <a class="var it740" onMouseOver="hilite(740)" onMouseOut="lolite()" onClick="logVariable('desc')" href="../../_variables/desc.html">$desc</a> ? 'DESC' : 'ASC';
<a name="l2812"><span class="linenum">2812</span></a>  
<a name="l2813"><span class="linenum">2813</span></a>      if (<a class="var it24387" onMouseOver="hilite(24387)" onMouseOut="lolite()" onClick="logVariable('pinned')" href="../../_variables/pinned.html">$pinned</a> == true) {
<a name="l2814"><span class="linenum">2814</span></a>          <a class="var it24387" onMouseOver="hilite(24387)" onMouseOut="lolite()" onClick="logVariable('pinned')" href="../../_variables/pinned.html">$pinned</a> = &quot;{<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>}pinned DESC,&quot;;
<a name="l2815"><span class="linenum">2815</span></a>      } else {
<a name="l2816"><span class="linenum">2816</span></a>          <a class="var it24387" onMouseOver="hilite(24387)" onMouseOut="lolite()" onClick="logVariable('pinned')" href="../../_variables/pinned.html">$pinned</a> = '';
<a name="l2817"><span class="linenum">2817</span></a>      }
<a name="l2818"><span class="linenum">2818</span></a>  
<a name="l2819"><span class="linenum">2819</span></a>      <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = &quot;{<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>}timemodified&quot;;
<a name="l2820"><span class="linenum">2820</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2821"><span class="linenum">2821</span></a>          <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = &quot;CASE WHEN {<a class="var it13618" onMouseOver="hilite(13618)" onMouseOut="lolite()" onClick="logVariable('compare')" href="../../_variables/compare.html">$compare</a>} &lt; {<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>}timestart
<a name="l2822"><span class="linenum">2822</span></a>                   THEN {<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>}timestart
<a name="l2823"><span class="linenum">2823</span></a>                   ELSE {<a class="var it13618" onMouseOver="hilite(13618)" onMouseOut="lolite()" onClick="logVariable('compare')" href="../../_variables/compare.html">$compare</a>}
<a name="l2824"><span class="linenum">2824</span></a>                   END&quot;;
<a name="l2825"><span class="linenum">2825</span></a>      }
<a name="l2826"><span class="linenum">2826</span></a>      return &quot;<a class="var it24387" onMouseOver="hilite(24387)" onMouseOut="lolite()" onClick="logVariable('pinned')" href="../../_variables/pinned.html">$pinned</a> <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>&quot;;
<a name="l2827"><span class="linenum">2827</span></a>  }
<a name="l2828"><span class="linenum">2828</span></a>  
<a name="l2829"><span class="linenum">2829</span></a>  <span class="comment">/**</span>
<a name="l2830"><span class="linenum">2830</span></a>  <span class="comment"> *</span>
<a name="l2831"><span class="linenum">2831</span></a>  <span class="comment"> * @global object</span>
<a name="l2832"><span class="linenum">2832</span></a>  <span class="comment"> * @global object</span>
<a name="l2833"><span class="linenum">2833</span></a>  <span class="comment"> * @global object</span>
<a name="l2834"><span class="linenum">2834</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l2835"><span class="linenum">2835</span></a>  <span class="comment"> * @uses VISIBLEGROUPS</span>
<a name="l2836"><span class="linenum">2836</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l2837"><span class="linenum">2837</span></a>  <span class="comment"> * @return array</span>
<a name="l2838"><span class="linenum">2838</span></a>  <span class="comment"> */</span>
<a name="l2839"><span class="linenum">2839</span></a>  function <a class="function" onClick="logFunction('forum_get_discussions_unread')" href="../../_functions/forum_get_discussions_unread.html" onMouseOver="funcPopup(event,'forum_get_discussions_unread')">forum_get_discussions_unread</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l2840"><span class="linenum">2840</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2841"><span class="linenum">2841</span></a>  
<a name="l2842"><span class="linenum">2842</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2);
<a name="l2843"><span class="linenum">2843</span></a>      <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a>*24*60*60);
<a name="l2844"><span class="linenum">2844</span></a>  
<a name="l2845"><span class="linenum">2845</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l2846"><span class="linenum">2846</span></a>      <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>    = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l2847"><span class="linenum">2847</span></a>      <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = <a class="function" onClick="logFunction('groups_get_activity_group')" href="../../_functions/groups_get_activity_group.html" onMouseOver="funcPopup(event,'groups_get_activity_group')">groups_get_activity_group</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l2848"><span class="linenum">2848</span></a>  
<a name="l2849"><span class="linenum">2849</span></a>      if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>) {
<a name="l2850"><span class="linenum">2850</span></a>          <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2851"><span class="linenum">2851</span></a>  
<a name="l2852"><span class="linenum">2852</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == <a class="constant" onClick="logConstant('VISIBLEGROUPS')" href="../../_constants/VISIBLEGROUPS.html" onMouseOver="constPopup(event,'VISIBLEGROUPS')">VISIBLEGROUPS</a> or <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l2853"><span class="linenum">2853</span></a>              if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l2854"><span class="linenum">2854</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND (d.groupid = :currentgroup OR d.groupid = -1)&quot;;
<a name="l2855"><span class="linenum">2855</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['currentgroup'] = <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>;
<a name="l2856"><span class="linenum">2856</span></a>              } else {
<a name="l2857"><span class="linenum">2857</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l2858"><span class="linenum">2858</span></a>              }
<a name="l2859"><span class="linenum">2859</span></a>  
<a name="l2860"><span class="linenum">2860</span></a>          } else {
<a name="l2861"><span class="linenum">2861</span></a>  <span class="comment">            //separate groups without access all</span>
<a name="l2862"><span class="linenum">2862</span></a>              if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l2863"><span class="linenum">2863</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND (d.groupid = :currentgroup OR d.groupid = -1)&quot;;
<a name="l2864"><span class="linenum">2864</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['currentgroup'] = <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>;
<a name="l2865"><span class="linenum">2865</span></a>              } else {
<a name="l2866"><span class="linenum">2866</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND d.groupid = -1&quot;;
<a name="l2867"><span class="linenum">2867</span></a>              }
<a name="l2868"><span class="linenum">2868</span></a>          }
<a name="l2869"><span class="linenum">2869</span></a>      } else {
<a name="l2870"><span class="linenum">2870</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l2871"><span class="linenum">2871</span></a>      }
<a name="l2872"><span class="linenum">2872</span></a>  
<a name="l2873"><span class="linenum">2873</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2874"><span class="linenum">2874</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;AND d.timestart &lt; :now1 AND (d.timeend = 0 OR d.timeend &gt; :now2)&quot;;
<a name="l2875"><span class="linenum">2875</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['now1'] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2876"><span class="linenum">2876</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['now2'] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2877"><span class="linenum">2877</span></a>      } else {
<a name="l2878"><span class="linenum">2878</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;&quot;;
<a name="l2879"><span class="linenum">2879</span></a>      }
<a name="l2880"><span class="linenum">2880</span></a>  
<a name="l2881"><span class="linenum">2881</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT d.id, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(p.id) AS unread
<a name="l2882"><span class="linenum">2882</span></a>                FROM {forum_discussions} d
<a name="l2883"><span class="linenum">2883</span></a>                     JOIN {forum_posts} p     ON p.discussion = d.id
<a name="l2884"><span class="linenum">2884</span></a>                     LEFT JOIN {forum_read} r <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (r.postid = p.id AND r.userid = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)
<a name="l2885"><span class="linenum">2885</span></a>               WHERE d.forum = {<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>}
<a name="l2886"><span class="linenum">2886</span></a>                     AND p.modified &gt;= :cutoffdate AND r.id is NULL
<a name="l2887"><span class="linenum">2887</span></a>                     <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a>
<a name="l2888"><span class="linenum">2888</span></a>                     <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a>
<a name="l2889"><span class="linenum">2889</span></a>            GROUP BY d.id&quot;;
<a name="l2890"><span class="linenum">2890</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['cutoffdate'] = <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a>;
<a name="l2891"><span class="linenum">2891</span></a>  
<a name="l2892"><span class="linenum">2892</span></a>      if (<a class="var it30669" onMouseOver="hilite(30669)" onMouseOut="lolite()" onClick="logVariable('unreads')" href="../../_variables/unreads.html">$unreads</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l2893"><span class="linenum">2893</span></a>          foreach (<a class="var it30669" onMouseOver="hilite(30669)" onMouseOut="lolite()" onClick="logVariable('unreads')" href="../../_variables/unreads.html">$unreads</a> as <a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a>) {
<a name="l2894"><span class="linenum">2894</span></a>              <a class="var it30669" onMouseOver="hilite(30669)" onMouseOut="lolite()" onClick="logVariable('unreads')" href="../../_variables/unreads.html">$unreads</a>[<a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a>-&gt;<a onClick="logVariable('id')" class="var it44621" onMouseOver="hilite(44621)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a>-&gt;<a onClick="logVariable('unread')" class="var it44621" onMouseOver="hilite(44621)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a>;
<a name="l2895"><span class="linenum">2895</span></a>          }
<a name="l2896"><span class="linenum">2896</span></a>          return <a class="var it30669" onMouseOver="hilite(30669)" onMouseOut="lolite()" onClick="logVariable('unreads')" href="../../_variables/unreads.html">$unreads</a>;
<a name="l2897"><span class="linenum">2897</span></a>      } else {
<a name="l2898"><span class="linenum">2898</span></a>          return array();
<a name="l2899"><span class="linenum">2899</span></a>      }
<a name="l2900"><span class="linenum">2900</span></a>  }
<a name="l2901"><span class="linenum">2901</span></a>  
<a name="l2902"><span class="linenum">2902</span></a>  <span class="comment">/**</span>
<a name="l2903"><span class="linenum">2903</span></a>  <span class="comment"> * @global object</span>
<a name="l2904"><span class="linenum">2904</span></a>  <span class="comment"> * @global object</span>
<a name="l2905"><span class="linenum">2905</span></a>  <span class="comment"> * @global object</span>
<a name="l2906"><span class="linenum">2906</span></a>  <span class="comment"> * @uses CONEXT_MODULE</span>
<a name="l2907"><span class="linenum">2907</span></a>  <span class="comment"> * @uses VISIBLEGROUPS</span>
<a name="l2908"><span class="linenum">2908</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l2909"><span class="linenum">2909</span></a>  <span class="comment"> * @return array</span>
<a name="l2910"><span class="linenum">2910</span></a>  <span class="comment"> */</span>
<a name="l2911"><span class="linenum">2911</span></a>  function <a class="function" onClick="logFunction('forum_get_discussions_count')" href="../../_functions/forum_get_discussions_count.html" onMouseOver="funcPopup(event,'forum_get_discussions_count')">forum_get_discussions_count</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l2912"><span class="linenum">2912</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2913"><span class="linenum">2913</span></a>  
<a name="l2914"><span class="linenum">2914</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2);
<a name="l2915"><span class="linenum">2915</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>);
<a name="l2916"><span class="linenum">2916</span></a>      <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>    = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l2917"><span class="linenum">2917</span></a>      <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = <a class="function" onClick="logFunction('groups_get_activity_group')" href="../../_functions/groups_get_activity_group.html" onMouseOver="funcPopup(event,'groups_get_activity_group')">groups_get_activity_group</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l2918"><span class="linenum">2918</span></a>  
<a name="l2919"><span class="linenum">2919</span></a>      if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>) {
<a name="l2920"><span class="linenum">2920</span></a>          <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2921"><span class="linenum">2921</span></a>  
<a name="l2922"><span class="linenum">2922</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == <a class="constant" onClick="logConstant('VISIBLEGROUPS')" href="../../_constants/VISIBLEGROUPS.html" onMouseOver="constPopup(event,'VISIBLEGROUPS')">VISIBLEGROUPS</a> or <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l2923"><span class="linenum">2923</span></a>              if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l2924"><span class="linenum">2924</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND (d.groupid = ? OR d.groupid = -1)&quot;;
<a name="l2925"><span class="linenum">2925</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>;
<a name="l2926"><span class="linenum">2926</span></a>              } else {
<a name="l2927"><span class="linenum">2927</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l2928"><span class="linenum">2928</span></a>              }
<a name="l2929"><span class="linenum">2929</span></a>  
<a name="l2930"><span class="linenum">2930</span></a>          } else {
<a name="l2931"><span class="linenum">2931</span></a>  <span class="comment">            //seprate groups without access all</span>
<a name="l2932"><span class="linenum">2932</span></a>              if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l2933"><span class="linenum">2933</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND (d.groupid = ? OR d.groupid = -1)&quot;;
<a name="l2934"><span class="linenum">2934</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>;
<a name="l2935"><span class="linenum">2935</span></a>              } else {
<a name="l2936"><span class="linenum">2936</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND d.groupid = -1&quot;;
<a name="l2937"><span class="linenum">2937</span></a>              }
<a name="l2938"><span class="linenum">2938</span></a>          }
<a name="l2939"><span class="linenum">2939</span></a>      } else {
<a name="l2940"><span class="linenum">2940</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l2941"><span class="linenum">2941</span></a>      }
<a name="l2942"><span class="linenum">2942</span></a>  
<a name="l2943"><span class="linenum">2943</span></a>      <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> = &quot;&quot;;
<a name="l2944"><span class="linenum">2944</span></a>  
<a name="l2945"><span class="linenum">2945</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l2946"><span class="linenum">2946</span></a>  
<a name="l2947"><span class="linenum">2947</span></a>          <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2948"><span class="linenum">2948</span></a>  
<a name="l2949"><span class="linenum">2949</span></a>          if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l2950"><span class="linenum">2950</span></a>              <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> = &quot; AND ((d.timestart &lt;= ? AND (d.timeend = 0 OR d.timeend &gt; ?))&quot;;
<a name="l2951"><span class="linenum">2951</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2952"><span class="linenum">2952</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l2953"><span class="linenum">2953</span></a>              if (<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l2954"><span class="linenum">2954</span></a>                  <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> .= &quot; OR d.userid = ?&quot;;
<a name="l2955"><span class="linenum">2955</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2956"><span class="linenum">2956</span></a>              }
<a name="l2957"><span class="linenum">2957</span></a>              <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a> .= &quot;)&quot;;
<a name="l2958"><span class="linenum">2958</span></a>          }
<a name="l2959"><span class="linenum">2959</span></a>      }
<a name="l2960"><span class="linenum">2960</span></a>  
<a name="l2961"><span class="linenum">2961</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(d.id)
<a name="l2962"><span class="linenum">2962</span></a>                FROM {forum_discussions} d
<a name="l2963"><span class="linenum">2963</span></a>                     JOIN {forum_posts} p ON p.discussion = d.id
<a name="l2964"><span class="linenum">2964</span></a>               WHERE d.forum = ? AND p.parent = 0
<a name="l2965"><span class="linenum">2965</span></a>                     <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> <a class="var it1243" onMouseOver="hilite(1243)" onMouseOut="lolite()" onClick="logVariable('timelimit')" href="../../_variables/timelimit.html">$timelimit</a>&quot;;
<a name="l2966"><span class="linenum">2966</span></a>  
<a name="l2967"><span class="linenum">2967</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2968"><span class="linenum">2968</span></a>  }
<a name="l2969"><span class="linenum">2969</span></a>  
<a name="l2970"><span class="linenum">2970</span></a>  
<a name="l2971"><span class="linenum">2971</span></a>  <span class="comment">// OTHER FUNCTIONS ///////////////////////////////////////////////////////////</span>
<a name="l2972"><span class="linenum">2972</span></a>  
<a name="l2973"><span class="linenum">2973</span></a>  
<a name="l2974"><span class="linenum">2974</span></a>  <span class="comment">/**</span>
<a name="l2975"><span class="linenum">2975</span></a>  <span class="comment"> * @global object</span>
<a name="l2976"><span class="linenum">2976</span></a>  <span class="comment"> * @global object</span>
<a name="l2977"><span class="linenum">2977</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l2978"><span class="linenum">2978</span></a>  <span class="comment"> * @param string $type</span>
<a name="l2979"><span class="linenum">2979</span></a>  <span class="comment"> */</span>
<a name="l2980"><span class="linenum">2980</span></a>  function <a class="function" onClick="logFunction('forum_get_course_forum')" href="../../_functions/forum_get_course_forum.html" onMouseOver="funcPopup(event,'forum_get_course_forum')">forum_get_course_forum</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l2981"><span class="linenum">2981</span></a>  <span class="comment">// How to set up special 1-per-course forums</span>
<a name="l2982"><span class="linenum">2982</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2983"><span class="linenum">2983</span></a>  
<a name="l2984"><span class="linenum">2984</span></a>      if (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(&quot;forum&quot;, &quot;course = ? AND type = ?&quot;, array(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>), &quot;id ASC&quot;)) {
<a name="l2985"><span class="linenum">2985</span></a>  <span class="comment">        // There should always only be ONE, but with the right combination of</span>
<a name="l2986"><span class="linenum">2986</span></a>  <span class="comment">        // errors there might be more.  In this case, just return the oldest one (lowest ID).</span>
<a name="l2987"><span class="linenum">2987</span></a>          foreach (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> as <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l2988"><span class="linenum">2988</span></a>              return <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>;   <span class="comment">// ie the first one</span>
<a name="l2989"><span class="linenum">2989</span></a>          }
<a name="l2990"><span class="linenum">2990</span></a>      }
<a name="l2991"><span class="linenum">2991</span></a>  
<a name="l2992"><span class="linenum">2992</span></a>  <span class="comment">    // Doesn't exist, so create one now.</span>
<a name="l2993"><span class="linenum">2993</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = new stdClass();
<a name="l2994"><span class="linenum">2994</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l2995"><span class="linenum">2995</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> = &quot;<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>&quot;;
<a name="l2996"><span class="linenum">2996</span></a>      if (!empty(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('htmleditor')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/htmleditor.html">htmleditor</a>)) {
<a name="l2997"><span class="linenum">2997</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('introformat')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/introformat.html">introformat</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('htmleditor')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/htmleditor.html">htmleditor</a>;
<a name="l2998"><span class="linenum">2998</span></a>      }
<a name="l2999"><span class="linenum">2999</span></a>      switch (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>) {
<a name="l3000"><span class="linenum">3000</span></a>          case &quot;news&quot;:
<a name="l3001"><span class="linenum">3001</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>  = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;namenews&quot;, &quot;forum&quot;);
<a name="l3002"><span class="linenum">3002</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('intro')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/intro.html">intro</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;intronews&quot;, &quot;forum&quot;);
<a name="l3003"><span class="linenum">3003</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/forcesubscribe.html">forcesubscribe</a> = <a class="constant" onClick="logConstant('FORUM_FORCESUBSCRIBE')" href="../../_constants/FORUM_FORCESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_FORCESUBSCRIBE')">FORUM_FORCESUBSCRIBE</a>;
<a name="l3004"><span class="linenum">3004</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a> = 0;
<a name="l3005"><span class="linenum">3005</span></a>              if (<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l3006"><span class="linenum">3006</span></a>                  <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>  = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;sitenews&quot;);
<a name="l3007"><span class="linenum">3007</span></a>                  <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/forcesubscribe.html">forcesubscribe</a> = 0;
<a name="l3008"><span class="linenum">3008</span></a>              }
<a name="l3009"><span class="linenum">3009</span></a>              break;
<a name="l3010"><span class="linenum">3010</span></a>          case &quot;social&quot;:
<a name="l3011"><span class="linenum">3011</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>  = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;namesocial&quot;, &quot;forum&quot;);
<a name="l3012"><span class="linenum">3012</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('intro')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/intro.html">intro</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;introsocial&quot;, &quot;forum&quot;);
<a name="l3013"><span class="linenum">3013</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a> = 0;
<a name="l3014"><span class="linenum">3014</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/forcesubscribe.html">forcesubscribe</a> = 0;
<a name="l3015"><span class="linenum">3015</span></a>              break;
<a name="l3016"><span class="linenum">3016</span></a>          case &quot;blog&quot;:
<a name="l3017"><span class="linenum">3017</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('blogforum', 'forum');
<a name="l3018"><span class="linenum">3018</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('intro')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/intro.html">intro</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('introblog', 'forum');
<a name="l3019"><span class="linenum">3019</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a> = 0;
<a name="l3020"><span class="linenum">3020</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/forcesubscribe.html">forcesubscribe</a> = 0;
<a name="l3021"><span class="linenum">3021</span></a>              break;
<a name="l3022"><span class="linenum">3022</span></a>          default:
<a name="l3023"><span class="linenum">3023</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(&quot;That forum type doesn't exist!&quot;);
<a name="l3024"><span class="linenum">3024</span></a>              return false;
<a name="l3025"><span class="linenum">3025</span></a>              break;
<a name="l3026"><span class="linenum">3026</span></a>      }
<a name="l3027"><span class="linenum">3027</span></a>  
<a name="l3028"><span class="linenum">3028</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l3029"><span class="linenum">3029</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(&quot;forum&quot;, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l3030"><span class="linenum">3030</span></a>  
<a name="l3031"><span class="linenum">3031</span></a>      if (! <a class="var it994" onMouseOver="hilite(994)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(&quot;modules&quot;, array(&quot;name&quot; =&gt; &quot;forum&quot;))) {
<a name="l3032"><span class="linenum">3032</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(&quot;Could not find forum module!!&quot;);
<a name="l3033"><span class="linenum">3033</span></a>          return false;
<a name="l3034"><span class="linenum">3034</span></a>      }
<a name="l3035"><span class="linenum">3035</span></a>      <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a> = new stdClass();
<a name="l3036"><span class="linenum">3036</span></a>      <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>-&gt;<a onClick="logVariable('course')" class="var it43599" onMouseOver="hilite(43599)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l3037"><span class="linenum">3037</span></a>      <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>-&gt;<a onClick="logVariable('module')" class="var it43599" onMouseOver="hilite(43599)" onMouseOut="lolite()" href="../../_variables/module.html">module</a> = <a class="var it994" onMouseOver="hilite(994)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>-&gt;<a onClick="logVariable('id')" class="var it42973" onMouseOver="hilite(42973)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l3038"><span class="linenum">3038</span></a>      <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>-&gt;<a onClick="logVariable('instance')" class="var it43599" onMouseOver="hilite(43599)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l3039"><span class="linenum">3039</span></a>      <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>-&gt;<a onClick="logVariable('section')" class="var it43599" onMouseOver="hilite(43599)" onMouseOut="lolite()" href="../../_variables/section.html">section</a> = 0;
<a name="l3040"><span class="linenum">3040</span></a>      include_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>/course/lib.php&quot;);
<a name="l3041"><span class="linenum">3041</span></a>      if (! <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it43599" onMouseOver="hilite(43599)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a> = <a class="function" onClick="logFunction('add_course_module')" href="../../_functions/add_course_module.html" onMouseOver="funcPopup(event,'add_course_module')">add_course_module</a>(<a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>) ) {
<a name="l3042"><span class="linenum">3042</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(&quot;Could not add a new course module to the course '&quot; . <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> . &quot;'&quot;);
<a name="l3043"><span class="linenum">3043</span></a>          return false;
<a name="l3044"><span class="linenum">3044</span></a>      }
<a name="l3045"><span class="linenum">3045</span></a>      <a class="var it5386" onMouseOver="hilite(5386)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a> = <a class="function" onClick="logFunction('course_add_cm_to_section')" href="../../_functions/course_add_cm_to_section.html" onMouseOver="funcPopup(event,'course_add_cm_to_section')">course_add_cm_to_section</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it43599" onMouseOver="hilite(43599)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>, 0);
<a name="l3046"><span class="linenum">3046</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(&quot;forum&quot;, array(&quot;id&quot; =&gt; &quot;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&quot;));
<a name="l3047"><span class="linenum">3047</span></a>  }
<a name="l3048"><span class="linenum">3048</span></a>  
<a name="l3049"><span class="linenum">3049</span></a>  <span class="comment">/**</span>
<a name="l3050"><span class="linenum">3050</span></a>  <span class="comment"> * Print a forum post</span>
<a name="l3051"><span class="linenum">3051</span></a>  <span class="comment"> *</span>
<a name="l3052"><span class="linenum">3052</span></a>  <span class="comment"> * @global object</span>
<a name="l3053"><span class="linenum">3053</span></a>  <span class="comment"> * @global object</span>
<a name="l3054"><span class="linenum">3054</span></a>  <span class="comment"> * @uses FORUM_MODE_THREADED</span>
<a name="l3055"><span class="linenum">3055</span></a>  <span class="comment"> * @uses PORTFOLIO_FORMAT_PLAINHTML</span>
<a name="l3056"><span class="linenum">3056</span></a>  <span class="comment"> * @uses PORTFOLIO_FORMAT_FILE</span>
<a name="l3057"><span class="linenum">3057</span></a>  <span class="comment"> * @uses PORTFOLIO_FORMAT_RICHHTML</span>
<a name="l3058"><span class="linenum">3058</span></a>  <span class="comment"> * @uses PORTFOLIO_ADD_TEXT_LINK</span>
<a name="l3059"><span class="linenum">3059</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l3060"><span class="linenum">3060</span></a>  <span class="comment"> * @param object $post The post to print.</span>
<a name="l3061"><span class="linenum">3061</span></a>  <span class="comment"> * @param object $discussion</span>
<a name="l3062"><span class="linenum">3062</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l3063"><span class="linenum">3063</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l3064"><span class="linenum">3064</span></a>  <span class="comment"> * @param object $course</span>
<a name="l3065"><span class="linenum">3065</span></a>  <span class="comment"> * @param boolean $ownpost Whether this post belongs to the current user.</span>
<a name="l3066"><span class="linenum">3066</span></a>  <span class="comment"> * @param boolean $reply Whether to print a 'reply' link at the bottom of the message.</span>
<a name="l3067"><span class="linenum">3067</span></a>  <span class="comment"> * @param boolean $link Just print a shortened version of the post as a link to the full post.</span>
<a name="l3068"><span class="linenum">3068</span></a>  <span class="comment"> * @param string $footer Extra stuff to print after the message.</span>
<a name="l3069"><span class="linenum">3069</span></a>  <span class="comment"> * @param string $highlight Space-separated list of terms to highlight.</span>
<a name="l3070"><span class="linenum">3070</span></a>  <span class="comment"> * @param int $post_read true, false or -99. If we already know whether this user</span>
<a name="l3071"><span class="linenum">3071</span></a>  <span class="comment"> *          has read this post, pass that in, otherwise, pass in -99, and this</span>
<a name="l3072"><span class="linenum">3072</span></a>  <span class="comment"> *          function will work it out.</span>
<a name="l3073"><span class="linenum">3073</span></a>  <span class="comment"> * @param boolean $dummyifcantsee When forum_user_can_see_post says that</span>
<a name="l3074"><span class="linenum">3074</span></a>  <span class="comment"> *          the current user can't see this post, if this argument is true</span>
<a name="l3075"><span class="linenum">3075</span></a>  <span class="comment"> *          (the default) then print a dummy 'you can't see this post' post.</span>
<a name="l3076"><span class="linenum">3076</span></a>  <span class="comment"> *          If false, don't output anything at all.</span>
<a name="l3077"><span class="linenum">3077</span></a>  <span class="comment"> * @param bool|null $istracked</span>
<a name="l3078"><span class="linenum">3078</span></a>  <span class="comment"> * @return void</span>
<a name="l3079"><span class="linenum">3079</span></a>  <span class="comment"> */</span>
<a name="l3080"><span class="linenum">3080</span></a>  function <a class="function" onClick="logFunction('forum_print_post')" href="../../_functions/forum_print_post.html" onMouseOver="funcPopup(event,'forum_print_post')">forum_print_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, &amp;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a>=false, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>=false, <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>=false,
<a name="l3081"><span class="linenum">3081</span></a>                            <a class="var it2148" onMouseOver="hilite(2148)" onMouseOut="lolite()" onClick="logVariable('footer')" href="../../_variables/footer.html">$footer</a>=&quot;&quot;, <a class="var it8824" onMouseOver="hilite(8824)" onMouseOut="lolite()" onClick="logVariable('highlight')" href="../../_variables/highlight.html">$highlight</a>=&quot;&quot;, <a class="var it41568" onMouseOver="hilite(41568)" onMouseOut="lolite()" onClick="logVariable('postisread')" href="../../_variables/postisread.html">$postisread</a>=null, <a class="var it41569" onMouseOver="hilite(41569)" onMouseOut="lolite()" onClick="logVariable('dummyifcantsee')" href="../../_variables/dummyifcantsee.html">$dummyifcantsee</a>=true, <a class="var it41570" onMouseOver="hilite(41570)" onMouseOut="lolite()" onClick="logVariable('istracked')" href="../../_variables/istracked.html">$istracked</a>=null, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>=false) {
<a name="l3082"><span class="linenum">3082</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l3083"><span class="linenum">3083</span></a>  
<a name="l3084"><span class="linenum">3084</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a> . '/filelib.php');
<a name="l3085"><span class="linenum">3085</span></a>  
<a name="l3086"><span class="linenum">3086</span></a>  <span class="comment">    // String cache</span>
<a name="l3087"><span class="linenum">3087</span></a>      static <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>;
<a name="l3088"><span class="linenum">3088</span></a>  <span class="comment">    // This is an extremely hacky way to ensure we only print the 'unread' anchor</span>
<a name="l3089"><span class="linenum">3089</span></a>  <span class="comment">    // the first time we encounter an unread post on a page. Ideally this would</span>
<a name="l3090"><span class="linenum">3090</span></a>  <span class="comment">    // be moved into the caller somehow, and be better testable. But at the time</span>
<a name="l3091"><span class="linenum">3091</span></a>  <span class="comment">    // of dealing with this bug, this static workaround was the most surgical and</span>
<a name="l3092"><span class="linenum">3092</span></a>  <span class="comment">    // it fits together with only printing th unread anchor id once on a given page.</span>
<a name="l3093"><span class="linenum">3093</span></a>      static <a class="var it41571" onMouseOver="hilite(41571)" onMouseOut="lolite()" onClick="logVariable('firstunreadanchorprinted')" href="../../_variables/firstunreadanchorprinted.html">$firstunreadanchorprinted</a> = false;
<a name="l3094"><span class="linenum">3094</span></a>  
<a name="l3095"><span class="linenum">3095</span></a>      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3096"><span class="linenum">3096</span></a>  
<a name="l3097"><span class="linenum">3097</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('course')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l3098"><span class="linenum">3098</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>  = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l3099"><span class="linenum">3099</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a> = <a class="function" onClick="logFunction('file_rewrite_pluginfile_urls')" href="../../_functions/file_rewrite_pluginfile_urls.html" onMouseOver="funcPopup(event,'file_rewrite_pluginfile_urls')">file_rewrite_pluginfile_urls</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>, '<a class="filename" href="../../pluginfile.php.html">pluginfile.php</a>', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>-&gt;<a onClick="logVariable('id')" class="var it43689" onMouseOver="hilite(43689)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'post', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3100"><span class="linenum">3100</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableplagiarism')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/enableplagiarism.html">enableplagiarism</a>)) {
<a name="l3101"><span class="linenum">3101</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/plagiarismlib.php');
<a name="l3102"><span class="linenum">3102</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a> .= <a class="function" onClick="logFunction('plagiarism_get_links')" href="../../_functions/plagiarism_get_links.html" onMouseOver="funcPopup(event,'plagiarism_get_links')">plagiarism_get_links</a>(array('userid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>,
<a name="l3103"><span class="linenum">3103</span></a>              'content' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>,
<a name="l3104"><span class="linenum">3104</span></a>              'cmid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l3105"><span class="linenum">3105</span></a>              'course' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('course')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>,
<a name="l3106"><span class="linenum">3106</span></a>              'forum' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>));
<a name="l3107"><span class="linenum">3107</span></a>      }
<a name="l3108"><span class="linenum">3108</span></a>  
<a name="l3109"><span class="linenum">3109</span></a>  <span class="comment">    // caching</span>
<a name="l3110"><span class="linenum">3110</span></a>      if (!isset(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>)) {
<a name="l3111"><span class="linenum">3111</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a> = new stdClass;
<a name="l3112"><span class="linenum">3112</span></a>      }
<a name="l3113"><span class="linenum">3113</span></a>  
<a name="l3114"><span class="linenum">3114</span></a>      if (!isset(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps)) {
<a name="l3115"><span class="linenum">3115</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps = array();
<a name="l3116"><span class="linenum">3116</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:viewdiscussion']   = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l3117"><span class="linenum">3117</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['moodle/site:viewfullnames']  = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l3118"><span class="linenum">3118</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:editanypost']      = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:editanypost', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l3119"><span class="linenum">3119</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:splitdiscussions'] = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:splitdiscussions', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l3120"><span class="linenum">3120</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:deleteownpost']    = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:deleteownpost', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l3121"><span class="linenum">3121</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:deleteanypost']    = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:deleteanypost', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l3122"><span class="linenum">3122</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:viewanyrating']    = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewanyrating', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l3123"><span class="linenum">3123</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:exportpost']       = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:exportpost', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l3124"><span class="linenum">3124</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:exportownpost']    = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:exportownpost', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l3125"><span class="linenum">3125</span></a>      }
<a name="l3126"><span class="linenum">3126</span></a>  
<a name="l3127"><span class="linenum">3127</span></a>      if (!isset(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('uservisible')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/uservisible.html">uservisible</a>)) {
<a name="l3128"><span class="linenum">3128</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('uservisible')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/uservisible.html">uservisible</a> = \core_availability\<a class="class" onClick="logClass('info_module')" href="../../_classes/info_module.html" onMouseOver="classPopup(event,'info_module')">info_module</a>::<a class="function" onClick="logFunction('is_user_visible')" href="../../_functions/is_user_visible.html" onMouseOver="funcPopup(event,'is_user_visible')">is_user_visible</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, 0, false);
<a name="l3129"><span class="linenum">3129</span></a>      }
<a name="l3130"><span class="linenum">3130</span></a>  
<a name="l3131"><span class="linenum">3131</span></a>      if (<a class="var it41570" onMouseOver="hilite(41570)" onMouseOut="lolite()" onClick="logVariable('istracked')" href="../../_variables/istracked.html">$istracked</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it41568" onMouseOver="hilite(41568)" onMouseOut="lolite()" onClick="logVariable('postisread')" href="../../_variables/postisread.html">$postisread</a>)) {
<a name="l3132"><span class="linenum">3132</span></a>          <a class="var it41568" onMouseOver="hilite(41568)" onMouseOut="lolite()" onClick="logVariable('postisread')" href="../../_variables/postisread.html">$postisread</a> = <a class="function" onClick="logFunction('forum_tp_is_post_read')" href="../../_functions/forum_tp_is_post_read.html" onMouseOver="funcPopup(event,'forum_tp_is_post_read')">forum_tp_is_post_read</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>);
<a name="l3133"><span class="linenum">3133</span></a>      }
<a name="l3134"><span class="linenum">3134</span></a>  
<a name="l3135"><span class="linenum">3135</span></a>      if (!<a class="function" onClick="logFunction('forum_user_can_see_post')" href="../../_functions/forum_user_can_see_post.html" onMouseOver="funcPopup(event,'forum_user_can_see_post')">forum_user_can_see_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, NULL, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l3136"><span class="linenum">3136</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = '';
<a name="l3137"><span class="linenum">3137</span></a>          if (!<a class="var it41569" onMouseOver="hilite(41569)" onMouseOut="lolite()" onClick="logVariable('dummyifcantsee')" href="../../_variables/dummyifcantsee.html">$dummyifcantsee</a>) {
<a name="l3138"><span class="linenum">3138</span></a>              if (<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>) {
<a name="l3139"><span class="linenum">3139</span></a>                  return <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l3140"><span class="linenum">3140</span></a>              }
<a name="l3141"><span class="linenum">3141</span></a>              echo <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l3142"><span class="linenum">3142</span></a>              return;
<a name="l3143"><span class="linenum">3143</span></a>          }
<a name="l3144"><span class="linenum">3144</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('a', '', array('id'=&gt;'p'.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3145"><span class="linenum">3145</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'forumpost clearfix',
<a name="l3146"><span class="linenum">3146</span></a>                                                         'role' =&gt; 'region',
<a name="l3147"><span class="linenum">3147</span></a>                                                         'aria-label' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('hiddenforumpost', 'forum')));
<a name="l3148"><span class="linenum">3148</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'row header'));
<a name="l3149"><span class="linenum">3149</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', '', array('class'=&gt;'left picture')); <span class="comment">// Picture</span>
<a name="l3150"><span class="linenum">3150</span></a>          if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>) {
<a name="l3151"><span class="linenum">3151</span></a>              <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'topic'));
<a name="l3152"><span class="linenum">3152</span></a>          } else {
<a name="l3153"><span class="linenum">3153</span></a>              <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'topic starter'));
<a name="l3154"><span class="linenum">3154</span></a>          }
<a name="l3155"><span class="linenum">3155</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('forumsubjecthidden','forum'), array('class' =&gt; 'subject',
<a name="l3156"><span class="linenum">3156</span></a>                                                                                             'role' =&gt; 'header')); <span class="comment">// Subject.</span>
<a name="l3157"><span class="linenum">3157</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('forumauthorhidden', 'forum'), array('class' =&gt; 'author',
<a name="l3158"><span class="linenum">3158</span></a>                                                                                             'role' =&gt; 'header')); <span class="comment">// Author.</span>
<a name="l3159"><span class="linenum">3159</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l3160"><span class="linenum">3160</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// row</span>
<a name="l3161"><span class="linenum">3161</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'row'));
<a name="l3162"><span class="linenum">3162</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', '&amp;nbsp;', array('class'=&gt;'left side')); <span class="comment">// Groups</span>
<a name="l3163"><span class="linenum">3163</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('forumbodyhidden','forum'), array('class'=&gt;'content')); <span class="comment">// Content</span>
<a name="l3164"><span class="linenum">3164</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// row</span>
<a name="l3165"><span class="linenum">3165</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// forumpost</span>
<a name="l3166"><span class="linenum">3166</span></a>  
<a name="l3167"><span class="linenum">3167</span></a>          if (<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>) {
<a name="l3168"><span class="linenum">3168</span></a>              return <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l3169"><span class="linenum">3169</span></a>          }
<a name="l3170"><span class="linenum">3170</span></a>          echo <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l3171"><span class="linenum">3171</span></a>          return;
<a name="l3172"><span class="linenum">3172</span></a>      }
<a name="l3173"><span class="linenum">3173</span></a>  
<a name="l3174"><span class="linenum">3174</span></a>      if (empty(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>)) {
<a name="l3175"><span class="linenum">3175</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = new stdClass;
<a name="l3176"><span class="linenum">3176</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('edit')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/edit.html">edit</a>         = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('edit', 'forum');
<a name="l3177"><span class="linenum">3177</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('delete')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/delete.html">delete</a>       = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('delete', 'forum');
<a name="l3178"><span class="linenum">3178</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('reply')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/reply.html">reply</a>        = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('reply', 'forum');
<a name="l3179"><span class="linenum">3179</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('parent')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>       = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('parent', 'forum');
<a name="l3180"><span class="linenum">3180</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('pruneheading')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/pruneheading.html">pruneheading</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pruneheading', 'forum');
<a name="l3181"><span class="linenum">3181</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('prune')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/prune.html">prune</a>        = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('prune', 'forum');
<a name="l3182"><span class="linenum">3182</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('displaymode')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/displaymode.html">displaymode</a>     = <a class="function" onClick="logFunction('get_user_preferences')" href="../../_functions/get_user_preferences.html" onMouseOver="funcPopup(event,'get_user_preferences')">get_user_preferences</a>('forum_displaymode', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_displaymode')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_displaymode.html">forum_displaymode</a>);
<a name="l3183"><span class="linenum">3183</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('markread')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/markread.html">markread</a>     = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('markread', 'forum');
<a name="l3184"><span class="linenum">3184</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('markunread')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/markunread.html">markunread</a>   = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('markunread', 'forum');
<a name="l3185"><span class="linenum">3185</span></a>      }
<a name="l3186"><span class="linenum">3186</span></a>  
<a name="l3187"><span class="linenum">3187</span></a>      <a class="var it38150" onMouseOver="hilite(38150)" onMouseOut="lolite()" onClick="logVariable('discussionlink')" href="../../_variables/discussionlink.html">$discussionlink</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/discuss.php.html">/mod/forum/discuss.php</a>', array('d'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>));
<a name="l3188"><span class="linenum">3188</span></a>  
<a name="l3189"><span class="linenum">3189</span></a>  <span class="comment">    // Build an object that represents the posting user</span>
<a name="l3190"><span class="linenum">3190</span></a>      <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a> = new stdClass;
<a name="l3191"><span class="linenum">3191</span></a>      <a class="var it41575" onMouseOver="hilite(41575)" onMouseOut="lolite()" onClick="logVariable('postuserfields')" href="../../_variables/postuserfields.html">$postuserfields</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="class" onClick="logClass('user_picture')" href="../../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>());
<a name="l3192"><span class="linenum">3192</span></a>      <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a> = <a class="function" onClick="logFunction('username_load_fields_from_object')" href="../../_functions/username_load_fields_from_object.html" onMouseOver="funcPopup(event,'username_load_fields_from_object')">username_load_fields_from_object</a>(<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, null, <a class="var it41575" onMouseOver="hilite(41575)" onMouseOut="lolite()" onClick="logVariable('postuserfields')" href="../../_variables/postuserfields.html">$postuserfields</a>);
<a name="l3193"><span class="linenum">3193</span></a>      <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('id')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l3194"><span class="linenum">3194</span></a>      <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('fullname')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>    = <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['moodle/site:viewfullnames']);
<a name="l3195"><span class="linenum">3195</span></a>      <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('profilelink')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/profilelink.html">profilelink</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../user/view.php.html">/user/view.php</a>', array('id'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, 'course'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3196"><span class="linenum">3196</span></a>  
<a name="l3197"><span class="linenum">3197</span></a>  <span class="comment">    // Prepare the groups the posting user belongs to</span>
<a name="l3198"><span class="linenum">3198</span></a>      if (isset(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;usersgroups)) {
<a name="l3199"><span class="linenum">3199</span></a>          <a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a> = array();
<a name="l3200"><span class="linenum">3200</span></a>          if (isset(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;usersgroups[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>])) {
<a name="l3201"><span class="linenum">3201</span></a>              foreach (<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;usersgroups[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>] as <a class="var it2844" onMouseOver="hilite(2844)" onMouseOut="lolite()" onClick="logVariable('gid')" href="../../_variables/gid.html">$gid</a>) {
<a name="l3202"><span class="linenum">3202</span></a>                  <a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>[<a class="var it2844" onMouseOver="hilite(2844)" onMouseOut="lolite()" onClick="logVariable('gid')" href="../../_variables/gid.html">$gid</a>] = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;groups[<a class="var it2844" onMouseOver="hilite(2844)" onMouseOut="lolite()" onClick="logVariable('gid')" href="../../_variables/gid.html">$gid</a>];
<a name="l3203"><span class="linenum">3203</span></a>              }
<a name="l3204"><span class="linenum">3204</span></a>          }
<a name="l3205"><span class="linenum">3205</span></a>      } else {
<a name="l3206"><span class="linenum">3206</span></a>          <a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a> = <a class="function" onClick="logFunction('groups_get_all_groups')" href="../../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>);
<a name="l3207"><span class="linenum">3207</span></a>      }
<a name="l3208"><span class="linenum">3208</span></a>  
<a name="l3209"><span class="linenum">3209</span></a>  <span class="comment">    // Prepare the attachements for the post, files then images</span>
<a name="l3210"><span class="linenum">3210</span></a>      <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1326" onMouseOver="hilite(1326)" onMouseOut="lolite()" onClick="logVariable('attachments')" href="../../_variables/attachments.html">$attachments</a>, <a class="var it41576" onMouseOver="hilite(41576)" onMouseOut="lolite()" onClick="logVariable('attachedimages')" href="../../_variables/attachedimages.html">$attachedimages</a>) = <a class="function" onClick="logFunction('forum_print_attachments')" href="../../_functions/forum_print_attachments.html" onMouseOver="funcPopup(event,'forum_print_attachments')">forum_print_attachments</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, 'separateimages');
<a name="l3211"><span class="linenum">3211</span></a>  
<a name="l3212"><span class="linenum">3212</span></a>  <span class="comment">    // Determine if we need to shorten this post</span>
<a name="l3213"><span class="linenum">3213</span></a>      <a class="var it41577" onMouseOver="hilite(41577)" onMouseOut="lolite()" onClick="logVariable('shortenpost')" href="../../_variables/shortenpost.html">$shortenpost</a> = (<a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> &amp;&amp; (<a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="phpfunction" onClick="logFunction('strip_tags')" href="../../_functions/strip_tags.html" onMouseOver="phpfuncPopup(event,'strip_tags')">strip_tags</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>)) &gt; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_longpost')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_longpost.html">forum_longpost</a>));
<a name="l3214"><span class="linenum">3214</span></a>  
<a name="l3215"><span class="linenum">3215</span></a>  
<a name="l3216"><span class="linenum">3216</span></a>  <span class="comment">    // Prepare an array of commands</span>
<a name="l3217"><span class="linenum">3217</span></a>      <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a> = array();
<a name="l3218"><span class="linenum">3218</span></a>  
<a name="l3219"><span class="linenum">3219</span></a>  <span class="comment">    // Add a permalink.</span>
<a name="l3220"><span class="linenum">3220</span></a>      <a class="var it32372" onMouseOver="hilite(32372)" onMouseOut="lolite()" onClick="logVariable('permalink')" href="../../_variables/permalink.html">$permalink</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it38150" onMouseOver="hilite(38150)" onMouseOut="lolite()" onClick="logVariable('discussionlink')" href="../../_variables/discussionlink.html">$discussionlink</a>);
<a name="l3221"><span class="linenum">3221</span></a>      <a class="var it32372" onMouseOver="hilite(32372)" onMouseOut="lolite()" onClick="logVariable('permalink')" href="../../_variables/permalink.html">$permalink</a>-&gt;<a class="function" onClick="logFunction('set_anchor')" href="../../_functions/set_anchor.html" onMouseOver="funcPopup(event,'set_anchor')">set_anchor</a>('p' . <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3222"><span class="linenum">3222</span></a>      <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a>[] = array('url' =&gt; <a class="var it32372" onMouseOver="hilite(32372)" onMouseOut="lolite()" onClick="logVariable('permalink')" href="../../_variables/permalink.html">$permalink</a>, 'text' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('permalink', 'forum'));
<a name="l3223"><span class="linenum">3223</span></a>  
<a name="l3224"><span class="linenum">3224</span></a>  <span class="comment">    // SPECIAL CASE: The front page can display a news item post to non-logged in users.</span>
<a name="l3225"><span class="linenum">3225</span></a>  <span class="comment">    // Don't display the mark read / unread controls in this case.</span>
<a name="l3226"><span class="linenum">3226</span></a>      if (<a class="var it41570" onMouseOver="hilite(41570)" onMouseOut="lolite()" onClick="logVariable('istracked')" href="../../_variables/istracked.html">$istracked</a> &amp;&amp; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_usermarksread')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_usermarksread.html">forum_usermarksread</a> &amp;&amp; <a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l3227"><span class="linenum">3227</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it38150" onMouseOver="hilite(38150)" onMouseOut="lolite()" onClick="logVariable('discussionlink')" href="../../_variables/discussionlink.html">$discussionlink</a>, array('postid'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mark'=&gt;'unread'));
<a name="l3228"><span class="linenum">3228</span></a>          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> = <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('markunread')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/markunread.html">markunread</a>;
<a name="l3229"><span class="linenum">3229</span></a>          if (!<a class="var it41568" onMouseOver="hilite(41568)" onMouseOut="lolite()" onClick="logVariable('postisread')" href="../../_variables/postisread.html">$postisread</a>) {
<a name="l3230"><span class="linenum">3230</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>-&gt;<a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>('mark', 'read');
<a name="l3231"><span class="linenum">3231</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> = <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('markread')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/markread.html">markread</a>;
<a name="l3232"><span class="linenum">3232</span></a>          }
<a name="l3233"><span class="linenum">3233</span></a>          if (<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('displaymode')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/displaymode.html">displaymode</a> == <a class="constant" onClick="logConstant('FORUM_MODE_THREADED')" href="../../_constants/FORUM_MODE_THREADED.html" onMouseOver="constPopup(event,'FORUM_MODE_THREADED')">FORUM_MODE_THREADED</a>) {
<a name="l3234"><span class="linenum">3234</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>-&gt;<a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>('parent', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>);
<a name="l3235"><span class="linenum">3235</span></a>          } else {
<a name="l3236"><span class="linenum">3236</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>-&gt;<a class="function" onClick="logFunction('set_anchor')" href="../../_functions/set_anchor.html" onMouseOver="funcPopup(event,'set_anchor')">set_anchor</a>('p'.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3237"><span class="linenum">3237</span></a>          }
<a name="l3238"><span class="linenum">3238</span></a>          <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a>[] = array('url'=&gt;<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, 'text'=&gt;<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>);
<a name="l3239"><span class="linenum">3239</span></a>      }
<a name="l3240"><span class="linenum">3240</span></a>  
<a name="l3241"><span class="linenum">3241</span></a>  <span class="comment">    // Zoom in to the parent specifically</span>
<a name="l3242"><span class="linenum">3242</span></a>      if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>) {
<a name="l3243"><span class="linenum">3243</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it38150" onMouseOver="hilite(38150)" onMouseOut="lolite()" onClick="logVariable('discussionlink')" href="../../_variables/discussionlink.html">$discussionlink</a>);
<a name="l3244"><span class="linenum">3244</span></a>          if (<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('displaymode')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/displaymode.html">displaymode</a> == <a class="constant" onClick="logConstant('FORUM_MODE_THREADED')" href="../../_constants/FORUM_MODE_THREADED.html" onMouseOver="constPopup(event,'FORUM_MODE_THREADED')">FORUM_MODE_THREADED</a>) {
<a name="l3245"><span class="linenum">3245</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>-&gt;<a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>('parent', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>);
<a name="l3246"><span class="linenum">3246</span></a>          } else {
<a name="l3247"><span class="linenum">3247</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>-&gt;<a class="function" onClick="logFunction('set_anchor')" href="../../_functions/set_anchor.html" onMouseOver="funcPopup(event,'set_anchor')">set_anchor</a>('p'.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>);
<a name="l3248"><span class="linenum">3248</span></a>          }
<a name="l3249"><span class="linenum">3249</span></a>          <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a>[] = array('url'=&gt;<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, 'text'=&gt;<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('parent')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>);
<a name="l3250"><span class="linenum">3250</span></a>      }
<a name="l3251"><span class="linenum">3251</span></a>  
<a name="l3252"><span class="linenum">3252</span></a>  <span class="comment">    // Hack for allow to edit news posts those are not displayed yet until they are displayed</span>
<a name="l3253"><span class="linenum">3253</span></a>      <a class="var it26385" onMouseOver="hilite(26385)" onMouseOut="lolite()" onClick="logVariable('age')" href="../../_variables/age.html">$age</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('created')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/created.html">created</a>;
<a name="l3254"><span class="linenum">3254</span></a>      if (!<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a> &amp;&amp; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'news' &amp;&amp; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timestart')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> &gt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l3255"><span class="linenum">3255</span></a>          <a class="var it26385" onMouseOver="hilite(26385)" onMouseOut="lolite()" onClick="logVariable('age')" href="../../_variables/age.html">$age</a> = 0;
<a name="l3256"><span class="linenum">3256</span></a>      }
<a name="l3257"><span class="linenum">3257</span></a>  
<a name="l3258"><span class="linenum">3258</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'single' and <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('firstpost')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/firstpost.html">firstpost</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l3259"><span class="linenum">3259</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:manageactivities', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l3260"><span class="linenum">3260</span></a>  <span class="comment">            // The first post in single simple is the forum description.</span>
<a name="l3261"><span class="linenum">3261</span></a>              <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a>[] = array('url'=&gt;<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../course/modedit.php.html">/course/modedit.php</a>', array('update'=&gt;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'sesskey'=&gt;<a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>(), 'return'=&gt;1)), 'text'=&gt;<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('edit')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/edit.html">edit</a>);
<a name="l3262"><span class="linenum">3262</span></a>          }
<a name="l3263"><span class="linenum">3263</span></a>      } else if ((<a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a> &amp;&amp; <a class="var it26385" onMouseOver="hilite(26385)" onMouseOut="lolite()" onClick="logVariable('age')" href="../../_variables/age.html">$age</a> &lt; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('maxeditingtime')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/maxeditingtime.html">maxeditingtime</a>) || <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:editanypost']) {
<a name="l3264"><span class="linenum">3264</span></a>          <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a>[] = array('url'=&gt;<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/post.php.html">/mod/forum/post.php</a>', array('edit'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)), 'text'=&gt;<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('edit')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/edit.html">edit</a>);
<a name="l3265"><span class="linenum">3265</span></a>      }
<a name="l3266"><span class="linenum">3266</span></a>  
<a name="l3267"><span class="linenum">3267</span></a>      if (<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:splitdiscussions'] &amp;&amp; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a> &amp;&amp; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> != 'single') {
<a name="l3268"><span class="linenum">3268</span></a>          <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a>[] = array('url'=&gt;<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/post.php.html">/mod/forum/post.php</a>', array('prune'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)), 'text'=&gt;<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('prune')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/prune.html">prune</a>, 'title'=&gt;<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('pruneheading')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/pruneheading.html">pruneheading</a>);
<a name="l3269"><span class="linenum">3269</span></a>      }
<a name="l3270"><span class="linenum">3270</span></a>  
<a name="l3271"><span class="linenum">3271</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'single' and <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('firstpost')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/firstpost.html">firstpost</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l3272"><span class="linenum">3272</span></a>  <span class="comment">        // Do not allow deleting of first post in single simple type.</span>
<a name="l3273"><span class="linenum">3273</span></a>      } else if ((<a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a> &amp;&amp; <a class="var it26385" onMouseOver="hilite(26385)" onMouseOut="lolite()" onClick="logVariable('age')" href="../../_variables/age.html">$age</a> &lt; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('maxeditingtime')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/maxeditingtime.html">maxeditingtime</a> &amp;&amp; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:deleteownpost']) || <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:deleteanypost']) {
<a name="l3274"><span class="linenum">3274</span></a>          <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a>[] = array('url'=&gt;<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/post.php.html">/mod/forum/post.php</a>', array('delete'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)), 'text'=&gt;<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('delete')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/delete.html">delete</a>);
<a name="l3275"><span class="linenum">3275</span></a>      }
<a name="l3276"><span class="linenum">3276</span></a>  
<a name="l3277"><span class="linenum">3277</span></a>      if (<a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>) {
<a name="l3278"><span class="linenum">3278</span></a>          <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a>[] = array('url'=&gt;<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/mod/forum/post.php#mformforum', array('reply'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)), 'text'=&gt;<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('reply')" class="var it43856" onMouseOver="hilite(43856)" onMouseOut="lolite()" href="../../_variables/reply.html">reply</a>);
<a name="l3279"><span class="linenum">3279</span></a>      }
<a name="l3280"><span class="linenum">3280</span></a>  
<a name="l3281"><span class="linenum">3281</span></a>      if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableportfolios')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/enableportfolios.html">enableportfolios</a> &amp;&amp; (<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:exportpost'] || (<a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a> &amp;&amp; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:exportownpost']))) {
<a name="l3282"><span class="linenum">3282</span></a>          <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a> = array('postid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3283"><span class="linenum">3283</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/portfoliolib.php');
<a name="l3284"><span class="linenum">3284</span></a>          <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a> = <span class="keyword">new </span><a class="class" onClick="logClass('portfolio_add_button')" href="../../_classes/portfolio_add_button.html" onMouseOver="classPopup(event,'portfolio_add_button')">portfolio_add_button</a>();
<a name="l3285"><span class="linenum">3285</span></a>          <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('set_callback_options')" href="../../_functions/set_callback_options.html" onMouseOver="funcPopup(event,'set_callback_options')">set_callback_options</a>('forum_portfolio_caller', array('postid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), 'mod_forum');
<a name="l3286"><span class="linenum">3286</span></a>          if (empty(<a class="var it1326" onMouseOver="hilite(1326)" onMouseOut="lolite()" onClick="logVariable('attachments')" href="../../_variables/attachments.html">$attachments</a>)) {
<a name="l3287"><span class="linenum">3287</span></a>              <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('set_formats')" href="../../_functions/set_formats.html" onMouseOver="funcPopup(event,'set_formats')">set_formats</a>(<a class="constant" onClick="logConstant('PORTFOLIO_FORMAT_PLAINHTML')" href="../../_constants/PORTFOLIO_FORMAT_PLAINHTML.html" onMouseOver="constPopup(event,'PORTFOLIO_FORMAT_PLAINHTML')">PORTFOLIO_FORMAT_PLAINHTML</a>);
<a name="l3288"><span class="linenum">3288</span></a>          } else {
<a name="l3289"><span class="linenum">3289</span></a>              <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('set_formats')" href="../../_functions/set_formats.html" onMouseOver="funcPopup(event,'set_formats')">set_formats</a>(<a class="constant" onClick="logConstant('PORTFOLIO_FORMAT_RICHHTML')" href="../../_constants/PORTFOLIO_FORMAT_RICHHTML.html" onMouseOver="constPopup(event,'PORTFOLIO_FORMAT_RICHHTML')">PORTFOLIO_FORMAT_RICHHTML</a>);
<a name="l3290"><span class="linenum">3290</span></a>          }
<a name="l3291"><span class="linenum">3291</span></a>  
<a name="l3292"><span class="linenum">3292</span></a>          <a class="var it41579" onMouseOver="hilite(41579)" onMouseOut="lolite()" onClick="logVariable('porfoliohtml')" href="../../_variables/porfoliohtml.html">$porfoliohtml</a> = <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('to_html')" href="../../_functions/to_html.html" onMouseOver="funcPopup(event,'to_html')">to_html</a>(<a class="constant" onClick="logConstant('PORTFOLIO_ADD_TEXT_LINK')" href="../../_constants/PORTFOLIO_ADD_TEXT_LINK.html" onMouseOver="constPopup(event,'PORTFOLIO_ADD_TEXT_LINK')">PORTFOLIO_ADD_TEXT_LINK</a>);
<a name="l3293"><span class="linenum">3293</span></a>          if (!empty(<a class="var it41579" onMouseOver="hilite(41579)" onMouseOut="lolite()" onClick="logVariable('porfoliohtml')" href="../../_variables/porfoliohtml.html">$porfoliohtml</a>)) {
<a name="l3294"><span class="linenum">3294</span></a>              <a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a>[] = <a class="var it41579" onMouseOver="hilite(41579)" onMouseOut="lolite()" onClick="logVariable('porfoliohtml')" href="../../_variables/porfoliohtml.html">$porfoliohtml</a>;
<a name="l3295"><span class="linenum">3295</span></a>          }
<a name="l3296"><span class="linenum">3296</span></a>      }
<a name="l3297"><span class="linenum">3297</span></a>  <span class="comment">    // Finished building commands</span>
<a name="l3298"><span class="linenum">3298</span></a>  
<a name="l3299"><span class="linenum">3299</span></a>  
<a name="l3300"><span class="linenum">3300</span></a>  <span class="comment">    // Begin output</span>
<a name="l3301"><span class="linenum">3301</span></a>  
<a name="l3302"><span class="linenum">3302</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>  = '';
<a name="l3303"><span class="linenum">3303</span></a>  
<a name="l3304"><span class="linenum">3304</span></a>      if (<a class="var it41570" onMouseOver="hilite(41570)" onMouseOut="lolite()" onClick="logVariable('istracked')" href="../../_variables/istracked.html">$istracked</a>) {
<a name="l3305"><span class="linenum">3305</span></a>          if (<a class="var it41568" onMouseOver="hilite(41568)" onMouseOut="lolite()" onClick="logVariable('postisread')" href="../../_variables/postisread.html">$postisread</a>) {
<a name="l3306"><span class="linenum">3306</span></a>              <a class="var it41580" onMouseOver="hilite(41580)" onMouseOut="lolite()" onClick="logVariable('forumpostclass')" href="../../_variables/forumpostclass.html">$forumpostclass</a> = ' read';
<a name="l3307"><span class="linenum">3307</span></a>          } else {
<a name="l3308"><span class="linenum">3308</span></a>              <a class="var it41580" onMouseOver="hilite(41580)" onMouseOut="lolite()" onClick="logVariable('forumpostclass')" href="../../_variables/forumpostclass.html">$forumpostclass</a> = ' unread';
<a name="l3309"><span class="linenum">3309</span></a>  <span class="comment">            // If this is the first unread post printed then give it an anchor and id of unread.</span>
<a name="l3310"><span class="linenum">3310</span></a>              if (!<a class="var it41571" onMouseOver="hilite(41571)" onMouseOut="lolite()" onClick="logVariable('firstunreadanchorprinted')" href="../../_variables/firstunreadanchorprinted.html">$firstunreadanchorprinted</a>) {
<a name="l3311"><span class="linenum">3311</span></a>                  <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('a', '', array('id' =&gt; 'unread'));
<a name="l3312"><span class="linenum">3312</span></a>                  <a class="var it41571" onMouseOver="hilite(41571)" onMouseOut="lolite()" onClick="logVariable('firstunreadanchorprinted')" href="../../_variables/firstunreadanchorprinted.html">$firstunreadanchorprinted</a> = true;
<a name="l3313"><span class="linenum">3313</span></a>              }
<a name="l3314"><span class="linenum">3314</span></a>          }
<a name="l3315"><span class="linenum">3315</span></a>      } else {
<a name="l3316"><span class="linenum">3316</span></a>  <span class="comment">        // ignore trackign status if not tracked or tracked param missing</span>
<a name="l3317"><span class="linenum">3317</span></a>          <a class="var it41580" onMouseOver="hilite(41580)" onMouseOut="lolite()" onClick="logVariable('forumpostclass')" href="../../_variables/forumpostclass.html">$forumpostclass</a> = '';
<a name="l3318"><span class="linenum">3318</span></a>      }
<a name="l3319"><span class="linenum">3319</span></a>  
<a name="l3320"><span class="linenum">3320</span></a>      <a class="var it41581" onMouseOver="hilite(41581)" onMouseOut="lolite()" onClick="logVariable('topicclass')" href="../../_variables/topicclass.html">$topicclass</a> = '';
<a name="l3321"><span class="linenum">3321</span></a>      if (empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>)) {
<a name="l3322"><span class="linenum">3322</span></a>          <a class="var it41581" onMouseOver="hilite(41581)" onMouseOut="lolite()" onClick="logVariable('topicclass')" href="../../_variables/topicclass.html">$topicclass</a> = ' firstpost starter';
<a name="l3323"><span class="linenum">3323</span></a>      }
<a name="l3324"><span class="linenum">3324</span></a>  
<a name="l3325"><span class="linenum">3325</span></a>      if (!empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('lastpost')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/lastpost.html">lastpost</a>)) {
<a name="l3326"><span class="linenum">3326</span></a>          <a class="var it41580" onMouseOver="hilite(41580)" onMouseOut="lolite()" onClick="logVariable('forumpostclass')" href="../../_variables/forumpostclass.html">$forumpostclass</a> .= ' lastpost';
<a name="l3327"><span class="linenum">3327</span></a>      }
<a name="l3328"><span class="linenum">3328</span></a>  
<a name="l3329"><span class="linenum">3329</span></a>  <span class="comment">    // Flag to indicate whether we should hide the author or not.</span>
<a name="l3330"><span class="linenum">3330</span></a>      <a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a> = <a class="function" onClick="logFunction('forum_is_author_hidden')" href="../../_functions/forum_is_author_hidden.html" onMouseOver="funcPopup(event,'forum_is_author_hidden')">forum_is_author_hidden</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l3331"><span class="linenum">3331</span></a>      <a class="var it41582" onMouseOver="hilite(41582)" onMouseOut="lolite()" onClick="logVariable('postbyuser')" href="../../_variables/postbyuser.html">$postbyuser</a> = new stdClass;
<a name="l3332"><span class="linenum">3332</span></a>      <a class="var it41582" onMouseOver="hilite(41582)" onMouseOut="lolite()" onClick="logVariable('postbyuser')" href="../../_variables/postbyuser.html">$postbyuser</a>-&gt;<a onClick="logVariable('post')" class="var it44622" onMouseOver="hilite(44622)" onMouseOut="lolite()" href="../../_variables/post.html">post</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>;
<a name="l3333"><span class="linenum">3333</span></a>      <a class="var it41582" onMouseOver="hilite(41582)" onMouseOut="lolite()" onClick="logVariable('postbyuser')" href="../../_variables/postbyuser.html">$postbyuser</a>-&gt;<a onClick="logVariable('user')" class="var it44622" onMouseOver="hilite(44622)" onMouseOut="lolite()" href="../../_variables/user.html">user</a> = <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('fullname')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>;
<a name="l3334"><span class="linenum">3334</span></a>      <a class="var it41583" onMouseOver="hilite(41583)" onMouseOut="lolite()" onClick="logVariable('discussionbyuser')" href="../../_variables/discussionbyuser.html">$discussionbyuser</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('postbyuser', 'forum', <a class="var it41582" onMouseOver="hilite(41582)" onMouseOut="lolite()" onClick="logVariable('postbyuser')" href="../../_variables/postbyuser.html">$postbyuser</a>);
<a name="l3335"><span class="linenum">3335</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('a', '', array('id'=&gt;'p'.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3336"><span class="linenum">3336</span></a>  <span class="comment">    // Begin forum post.</span>
<a name="l3337"><span class="linenum">3337</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_div')" href="../../_functions/start_div.html" onMouseOver="funcPopup(event,'start_div')">start_div</a>('forumpost clearfix' . <a class="var it41580" onMouseOver="hilite(41580)" onMouseOut="lolite()" onClick="logVariable('forumpostclass')" href="../../_variables/forumpostclass.html">$forumpostclass</a> . <a class="var it41581" onMouseOver="hilite(41581)" onMouseOut="lolite()" onClick="logVariable('topicclass')" href="../../_variables/topicclass.html">$topicclass</a>,
<a name="l3338"><span class="linenum">3338</span></a>          ['role' =&gt; 'region', 'aria-label' =&gt; <a class="var it41583" onMouseOver="hilite(41583)" onMouseOut="lolite()" onClick="logVariable('discussionbyuser')" href="../../_variables/discussionbyuser.html">$discussionbyuser</a>]);
<a name="l3339"><span class="linenum">3339</span></a>  <span class="comment">    // Begin header row.</span>
<a name="l3340"><span class="linenum">3340</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_div')" href="../../_functions/start_div.html" onMouseOver="funcPopup(event,'start_div')">start_div</a>('row header clearfix');
<a name="l3341"><span class="linenum">3341</span></a>  
<a name="l3342"><span class="linenum">3342</span></a>  <span class="comment">    // User picture.</span>
<a name="l3343"><span class="linenum">3343</span></a>      if (!<a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a>) {
<a name="l3344"><span class="linenum">3344</span></a>          <a class="var it3382" onMouseOver="hilite(3382)" onMouseOut="lolite()" onClick="logVariable('picture')" href="../../_variables/picture.html">$picture</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>, ['courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]);
<a name="l3345"><span class="linenum">3345</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('div')" href="../../_functions/div.html" onMouseOver="funcPopup(event,'div')">div</a>(<a class="var it3382" onMouseOver="hilite(3382)" onMouseOut="lolite()" onClick="logVariable('picture')" href="../../_variables/picture.html">$picture</a>, 'left picture');
<a name="l3346"><span class="linenum">3346</span></a>          <a class="var it41581" onMouseOver="hilite(41581)" onMouseOut="lolite()" onClick="logVariable('topicclass')" href="../../_variables/topicclass.html">$topicclass</a> = 'topic' . <a class="var it41581" onMouseOver="hilite(41581)" onMouseOut="lolite()" onClick="logVariable('topicclass')" href="../../_variables/topicclass.html">$topicclass</a>;
<a name="l3347"><span class="linenum">3347</span></a>      }
<a name="l3348"><span class="linenum">3348</span></a>  
<a name="l3349"><span class="linenum">3349</span></a>  <span class="comment">    // Begin topic column.</span>
<a name="l3350"><span class="linenum">3350</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_div')" href="../../_functions/start_div.html" onMouseOver="funcPopup(event,'start_div')">start_div</a>(<a class="var it41581" onMouseOver="hilite(41581)" onMouseOut="lolite()" onClick="logVariable('topicclass')" href="../../_variables/topicclass.html">$topicclass</a>);
<a name="l3351"><span class="linenum">3351</span></a>      <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('postsubject')" href="../../_variables/postsubject.html">$postsubject</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>;
<a name="l3352"><span class="linenum">3352</span></a>      if (empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subjectnoformat')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subjectnoformat.html">subjectnoformat</a>)) {
<a name="l3353"><span class="linenum">3353</span></a>          <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('postsubject')" href="../../_variables/postsubject.html">$postsubject</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('postsubject')" href="../../_variables/postsubject.html">$postsubject</a>);
<a name="l3354"><span class="linenum">3354</span></a>      }
<a name="l3355"><span class="linenum">3355</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('div')" href="../../_functions/div.html" onMouseOver="funcPopup(event,'div')">div</a>(<a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('postsubject')" href="../../_variables/postsubject.html">$postsubject</a>, 'subject', ['role' =&gt; 'heading', 'aria-level' =&gt; '2']);
<a name="l3356"><span class="linenum">3356</span></a>  
<a name="l3357"><span class="linenum">3357</span></a>      if (<a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a>) {
<a name="l3358"><span class="linenum">3358</span></a>          <a class="var it41584" onMouseOver="hilite(41584)" onMouseOut="lolite()" onClick="logVariable('bytext')" href="../../_variables/bytext.html">$bytext</a> = <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>);
<a name="l3359"><span class="linenum">3359</span></a>      } else {
<a name="l3360"><span class="linenum">3360</span></a>          <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a> = new stdClass();
<a name="l3361"><span class="linenum">3361</span></a>          <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a>-&gt;<a onClick="logVariable('date')" class="var it44595" onMouseOver="hilite(44595)" onMouseOut="lolite()" href="../../_variables/date.html">date</a> = <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>);
<a name="l3362"><span class="linenum">3362</span></a>          <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a>-&gt;<a onClick="logVariable('name')" class="var it44595" onMouseOver="hilite(44595)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('profilelink')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/profilelink.html">profilelink</a>, <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('fullname')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>);
<a name="l3363"><span class="linenum">3363</span></a>          <a class="var it41584" onMouseOver="hilite(41584)" onMouseOut="lolite()" onClick="logVariable('bytext')" href="../../_variables/bytext.html">$bytext</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('bynameondate', 'forum', <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a>);
<a name="l3364"><span class="linenum">3364</span></a>      }
<a name="l3365"><span class="linenum">3365</span></a>      <a class="var it41585" onMouseOver="hilite(41585)" onMouseOut="lolite()" onClick="logVariable('bytextoptions')" href="../../_variables/bytextoptions.html">$bytextoptions</a> = [
<a name="l3366"><span class="linenum">3366</span></a>          'role' =&gt; 'heading',
<a name="l3367"><span class="linenum">3367</span></a>          'aria-level' =&gt; '2',
<a name="l3368"><span class="linenum">3368</span></a>      ];
<a name="l3369"><span class="linenum">3369</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('div')" href="../../_functions/div.html" onMouseOver="funcPopup(event,'div')">div</a>(<a class="var it41584" onMouseOver="hilite(41584)" onMouseOut="lolite()" onClick="logVariable('bytext')" href="../../_variables/bytext.html">$bytext</a>, 'author', <a class="var it41585" onMouseOver="hilite(41585)" onMouseOut="lolite()" onClick="logVariable('bytextoptions')" href="../../_variables/bytextoptions.html">$bytextoptions</a>);
<a name="l3370"><span class="linenum">3370</span></a>  <span class="comment">    // End topic column.</span>
<a name="l3371"><span class="linenum">3371</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_div')" href="../../_functions/end_div.html" onMouseOver="funcPopup(event,'end_div')">end_div</a>();
<a name="l3372"><span class="linenum">3372</span></a>  
<a name="l3373"><span class="linenum">3373</span></a>  <span class="comment">    // End header row.</span>
<a name="l3374"><span class="linenum">3374</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_div')" href="../../_functions/end_div.html" onMouseOver="funcPopup(event,'end_div')">end_div</a>();
<a name="l3375"><span class="linenum">3375</span></a>  
<a name="l3376"><span class="linenum">3376</span></a>  <span class="comment">    // Row with the forum post content.</span>
<a name="l3377"><span class="linenum">3377</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_div')" href="../../_functions/start_div.html" onMouseOver="funcPopup(event,'start_div')">start_div</a>('row maincontent clearfix');
<a name="l3378"><span class="linenum">3378</span></a>  <span class="comment">    // Show if author is not hidden or we have groups.</span>
<a name="l3379"><span class="linenum">3379</span></a>      if (!<a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a> || <a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>) {
<a name="l3380"><span class="linenum">3380</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_div')" href="../../_functions/start_div.html" onMouseOver="funcPopup(event,'start_div')">start_div</a>('left');
<a name="l3381"><span class="linenum">3381</span></a>          <a class="var it36598" onMouseOver="hilite(36598)" onMouseOut="lolite()" onClick="logVariable('groupoutput')" href="../../_variables/groupoutput.html">$groupoutput</a> = '';
<a name="l3382"><span class="linenum">3382</span></a>          if (<a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>) {
<a name="l3383"><span class="linenum">3383</span></a>              <a class="var it36598" onMouseOver="hilite(36598)" onMouseOut="lolite()" onClick="logVariable('groupoutput')" href="../../_variables/groupoutput.html">$groupoutput</a> = <a class="function" onClick="logFunction('print_group_picture')" href="../../_functions/print_group_picture.html" onMouseOver="funcPopup(event,'print_group_picture')">print_group_picture</a>(<a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, false, true, true);
<a name="l3384"><span class="linenum">3384</span></a>          }
<a name="l3385"><span class="linenum">3385</span></a>          if (empty(<a class="var it36598" onMouseOver="hilite(36598)" onMouseOut="lolite()" onClick="logVariable('groupoutput')" href="../../_variables/groupoutput.html">$groupoutput</a>)) {
<a name="l3386"><span class="linenum">3386</span></a>              <a class="var it36598" onMouseOver="hilite(36598)" onMouseOut="lolite()" onClick="logVariable('groupoutput')" href="../../_variables/groupoutput.html">$groupoutput</a> = '&amp;nbsp;';
<a name="l3387"><span class="linenum">3387</span></a>          }
<a name="l3388"><span class="linenum">3388</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('div')" href="../../_functions/div.html" onMouseOver="funcPopup(event,'div')">div</a>(<a class="var it36598" onMouseOver="hilite(36598)" onMouseOut="lolite()" onClick="logVariable('groupoutput')" href="../../_variables/groupoutput.html">$groupoutput</a>, 'grouppictures');
<a name="l3389"><span class="linenum">3389</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_div')" href="../../_functions/end_div.html" onMouseOver="funcPopup(event,'end_div')">end_div</a>(); <span class="comment">// Left side.</span>
<a name="l3390"><span class="linenum">3390</span></a>      }
<a name="l3391"><span class="linenum">3391</span></a>  
<a name="l3392"><span class="linenum">3392</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'no-overflow'));
<a name="l3393"><span class="linenum">3393</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'content'));
<a name="l3394"><span class="linenum">3394</span></a>  
<a name="l3395"><span class="linenum">3395</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = new stdClass;
<a name="l3396"><span class="linenum">3396</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('para')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../_variables/para.html">para</a>    = false;
<a name="l3397"><span class="linenum">3397</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('trusted')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../_variables/trusted.html">trusted</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('messagetrust')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/messagetrust.html">messagetrust</a>;
<a name="l3398"><span class="linenum">3398</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('context')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../_variables/context.html">context</a> = <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>;
<a name="l3399"><span class="linenum">3399</span></a>      if (<a class="var it41577" onMouseOver="hilite(41577)" onMouseOut="lolite()" onClick="logVariable('shortenpost')" href="../../_variables/shortenpost.html">$shortenpost</a>) {
<a name="l3400"><span class="linenum">3400</span></a>  <span class="comment">        // Prepare shortened version by filtering the text then shortening it.</span>
<a name="l3401"><span class="linenum">3401</span></a>          <a class="var it41586" onMouseOver="hilite(41586)" onMouseOut="lolite()" onClick="logVariable('postclass')" href="../../_variables/postclass.html">$postclass</a>    = 'shortenedpost';
<a name="l3402"><span class="linenum">3402</span></a>          <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a>  = <a class="function" onClick="logFunction('format_text')" href="../../_functions/format_text.html" onMouseOver="funcPopup(event,'format_text')">format_text</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('messageformat')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/messageformat.html">messageformat</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>);
<a name="l3403"><span class="linenum">3403</span></a>          <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a>  = <a class="function" onClick="logFunction('shorten_text')" href="../../_functions/shorten_text.html" onMouseOver="funcPopup(event,'shorten_text')">shorten_text</a>(<a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_shortpost')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_shortpost.html">forum_shortpost</a>);
<a name="l3404"><span class="linenum">3404</span></a>          <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it38150" onMouseOver="hilite(38150)" onMouseOut="lolite()" onClick="logVariable('discussionlink')" href="../../_variables/discussionlink.html">$discussionlink</a>, <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('readtherest', 'forum'));
<a name="l3405"><span class="linenum">3405</span></a>          <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', '('.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('numwords', 'moodle', <a class="function" onClick="logFunction('count_words')" href="../../_functions/count_words.html" onMouseOver="funcPopup(event,'count_words')">count_words</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>)).')',
<a name="l3406"><span class="linenum">3406</span></a>              array('class'=&gt;'post-word-count'));
<a name="l3407"><span class="linenum">3407</span></a>      } else {
<a name="l3408"><span class="linenum">3408</span></a>  <span class="comment">        // Prepare whole post</span>
<a name="l3409"><span class="linenum">3409</span></a>          <a class="var it41586" onMouseOver="hilite(41586)" onMouseOut="lolite()" onClick="logVariable('postclass')" href="../../_variables/postclass.html">$postclass</a>    = 'fullpost';
<a name="l3410"><span class="linenum">3410</span></a>          <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a>  = <a class="function" onClick="logFunction('format_text')" href="../../_functions/format_text.html" onMouseOver="funcPopup(event,'format_text')">format_text</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('messageformat')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/messageformat.html">messageformat</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3411"><span class="linenum">3411</span></a>          if (!empty(<a class="var it8824" onMouseOver="hilite(8824)" onMouseOut="lolite()" onClick="logVariable('highlight')" href="../../_variables/highlight.html">$highlight</a>)) {
<a name="l3412"><span class="linenum">3412</span></a>              <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a> = <a class="function" onClick="logFunction('highlight')" href="../../_functions/highlight.html" onMouseOver="funcPopup(event,'highlight')">highlight</a>(<a class="var it8824" onMouseOver="hilite(8824)" onMouseOut="lolite()" onClick="logVariable('highlight')" href="../../_variables/highlight.html">$highlight</a>, <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a>);
<a name="l3413"><span class="linenum">3413</span></a>          }
<a name="l3414"><span class="linenum">3414</span></a>          if (!empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('displaywordcount')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/displaywordcount.html">displaywordcount</a>)) {
<a name="l3415"><span class="linenum">3415</span></a>              <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('numwords', 'moodle', <a class="function" onClick="logFunction('count_words')" href="../../_functions/count_words.html" onMouseOver="funcPopup(event,'count_words')">count_words</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>)),
<a name="l3416"><span class="linenum">3416</span></a>                  array('class'=&gt;'post-word-count'));
<a name="l3417"><span class="linenum">3417</span></a>          }
<a name="l3418"><span class="linenum">3418</span></a>          <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it41576" onMouseOver="hilite(41576)" onMouseOut="lolite()" onClick="logVariable('attachedimages')" href="../../_variables/attachedimages.html">$attachedimages</a>, array('class'=&gt;'attachedimages'));
<a name="l3419"><span class="linenum">3419</span></a>      }
<a name="l3420"><span class="linenum">3420</span></a>  
<a name="l3421"><span class="linenum">3421</span></a>  <span class="comment">    // Output the post content</span>
<a name="l3422"><span class="linenum">3422</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it41587" onMouseOver="hilite(41587)" onMouseOut="lolite()" onClick="logVariable('postcontent')" href="../../_variables/postcontent.html">$postcontent</a>, array('class'=&gt;'posting '.<a class="var it41586" onMouseOver="hilite(41586)" onMouseOut="lolite()" onClick="logVariable('postclass')" href="../../_variables/postclass.html">$postclass</a>));
<a name="l3423"><span class="linenum">3423</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// Content</span>
<a name="l3424"><span class="linenum">3424</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// Content mask</span>
<a name="l3425"><span class="linenum">3425</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// Row</span>
<a name="l3426"><span class="linenum">3426</span></a>  
<a name="l3427"><span class="linenum">3427</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'row side'));
<a name="l3428"><span class="linenum">3428</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div','&amp;nbsp;', array('class'=&gt;'left'));
<a name="l3429"><span class="linenum">3429</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'options clearfix'));
<a name="l3430"><span class="linenum">3430</span></a>  
<a name="l3431"><span class="linenum">3431</span></a>      if (!empty(<a class="var it1326" onMouseOver="hilite(1326)" onMouseOut="lolite()" onClick="logVariable('attachments')" href="../../_variables/attachments.html">$attachments</a>)) {
<a name="l3432"><span class="linenum">3432</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it1326" onMouseOver="hilite(1326)" onMouseOut="lolite()" onClick="logVariable('attachments')" href="../../_variables/attachments.html">$attachments</a>, array('class' =&gt; 'attachments'));
<a name="l3433"><span class="linenum">3433</span></a>      }
<a name="l3434"><span class="linenum">3434</span></a>  
<a name="l3435"><span class="linenum">3435</span></a>  <span class="comment">    // Output ratings</span>
<a name="l3436"><span class="linenum">3436</span></a>      if (!empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('rating')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/rating.html">rating</a>)) {
<a name="l3437"><span class="linenum">3437</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('rating')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/rating.html">rating</a>), array('class'=&gt;'forum-post-rating'));
<a name="l3438"><span class="linenum">3438</span></a>      }
<a name="l3439"><span class="linenum">3439</span></a>  
<a name="l3440"><span class="linenum">3440</span></a>  <span class="comment">    // Output the commands</span>
<a name="l3441"><span class="linenum">3441</span></a>      <a class="var it41588" onMouseOver="hilite(41588)" onMouseOut="lolite()" onClick="logVariable('commandhtml')" href="../../_variables/commandhtml.html">$commandhtml</a> = array();
<a name="l3442"><span class="linenum">3442</span></a>      foreach (<a class="var it2978" onMouseOver="hilite(2978)" onMouseOut="lolite()" onClick="logVariable('commands')" href="../../_variables/commands.html">$commands</a> as <a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a>) {
<a name="l3443"><span class="linenum">3443</span></a>          if (<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a>)) {
<a name="l3444"><span class="linenum">3444</span></a>              <a class="var it41588" onMouseOver="hilite(41588)" onMouseOut="lolite()" onClick="logVariable('commandhtml')" href="../../_variables/commandhtml.html">$commandhtml</a>[] = <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a>['url'], <a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a>['text']);
<a name="l3445"><span class="linenum">3445</span></a>          } else {
<a name="l3446"><span class="linenum">3446</span></a>              <a class="var it41588" onMouseOver="hilite(41588)" onMouseOut="lolite()" onClick="logVariable('commandhtml')" href="../../_variables/commandhtml.html">$commandhtml</a>[] = <a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a>;
<a name="l3447"><span class="linenum">3447</span></a>          }
<a name="l3448"><span class="linenum">3448</span></a>      }
<a name="l3449"><span class="linenum">3449</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(' | ', <a class="var it41588" onMouseOver="hilite(41588)" onMouseOut="lolite()" onClick="logVariable('commandhtml')" href="../../_variables/commandhtml.html">$commandhtml</a>), array('class'=&gt;'commands'));
<a name="l3450"><span class="linenum">3450</span></a>  
<a name="l3451"><span class="linenum">3451</span></a>  <span class="comment">    // Output link to post if required</span>
<a name="l3452"><span class="linenum">3452</span></a>      if (<a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> &amp;&amp; <a class="function" onClick="logFunction('forum_user_can_post')" href="../../_functions/forum_user_can_post.html" onMouseOver="funcPopup(event,'forum_user_can_post')">forum_user_can_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l3453"><span class="linenum">3453</span></a>          if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('replies')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/replies.html">replies</a> == 1) {
<a name="l3454"><span class="linenum">3454</span></a>              <a class="var it41589" onMouseOver="hilite(41589)" onMouseOut="lolite()" onClick="logVariable('replystring')" href="../../_variables/replystring.html">$replystring</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('repliesone', 'forum', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('replies')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/replies.html">replies</a>);
<a name="l3455"><span class="linenum">3455</span></a>          } else {
<a name="l3456"><span class="linenum">3456</span></a>              <a class="var it41589" onMouseOver="hilite(41589)" onMouseOut="lolite()" onClick="logVariable('replystring')" href="../../_variables/replystring.html">$replystring</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('repliesmany', 'forum', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('replies')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/replies.html">replies</a>);
<a name="l3457"><span class="linenum">3457</span></a>          }
<a name="l3458"><span class="linenum">3458</span></a>          if (!empty(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('unread')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a>) &amp;&amp; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('unread')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a> !== '-') {
<a name="l3459"><span class="linenum">3459</span></a>              <a class="var it41589" onMouseOver="hilite(41589)" onMouseOut="lolite()" onClick="logVariable('replystring')" href="../../_variables/replystring.html">$replystring</a> .= ' &lt;span class=&quot;sep&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;unread&quot;&gt;';
<a name="l3460"><span class="linenum">3460</span></a>              if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('unread')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a> == 1) {
<a name="l3461"><span class="linenum">3461</span></a>                  <a class="var it41589" onMouseOver="hilite(41589)" onMouseOut="lolite()" onClick="logVariable('replystring')" href="../../_variables/replystring.html">$replystring</a> .= <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unreadpostsone', 'forum');
<a name="l3462"><span class="linenum">3462</span></a>              } else {
<a name="l3463"><span class="linenum">3463</span></a>                  <a class="var it41589" onMouseOver="hilite(41589)" onMouseOut="lolite()" onClick="logVariable('replystring')" href="../../_variables/replystring.html">$replystring</a> .= <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unreadpostsnumber', 'forum', <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('unread')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a>);
<a name="l3464"><span class="linenum">3464</span></a>              }
<a name="l3465"><span class="linenum">3465</span></a>              <a class="var it41589" onMouseOver="hilite(41589)" onMouseOut="lolite()" onClick="logVariable('replystring')" href="../../_variables/replystring.html">$replystring</a> .= '&lt;/span&gt;';
<a name="l3466"><span class="linenum">3466</span></a>          }
<a name="l3467"><span class="linenum">3467</span></a>  
<a name="l3468"><span class="linenum">3468</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class'=&gt;'link'));
<a name="l3469"><span class="linenum">3469</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it38150" onMouseOver="hilite(38150)" onMouseOut="lolite()" onClick="logVariable('discussionlink')" href="../../_variables/discussionlink.html">$discussionlink</a>, <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('discussthistopic', 'forum'));
<a name="l3470"><span class="linenum">3470</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&amp;nbsp;('.<a class="var it41589" onMouseOver="hilite(41589)" onMouseOut="lolite()" onClick="logVariable('replystring')" href="../../_variables/replystring.html">$replystring</a>.')';
<a name="l3471"><span class="linenum">3471</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// link</span>
<a name="l3472"><span class="linenum">3472</span></a>      }
<a name="l3473"><span class="linenum">3473</span></a>  
<a name="l3474"><span class="linenum">3474</span></a>  <span class="comment">    // Output footer if required</span>
<a name="l3475"><span class="linenum">3475</span></a>      if (<a class="var it2148" onMouseOver="hilite(2148)" onMouseOut="lolite()" onClick="logVariable('footer')" href="../../_variables/footer.html">$footer</a>) {
<a name="l3476"><span class="linenum">3476</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it2148" onMouseOver="hilite(2148)" onMouseOut="lolite()" onClick="logVariable('footer')" href="../../_variables/footer.html">$footer</a>, array('class'=&gt;'footer'));
<a name="l3477"><span class="linenum">3477</span></a>      }
<a name="l3478"><span class="linenum">3478</span></a>  
<a name="l3479"><span class="linenum">3479</span></a>  <span class="comment">    // Close remaining open divs</span>
<a name="l3480"><span class="linenum">3480</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// content</span>
<a name="l3481"><span class="linenum">3481</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// row</span>
<a name="l3482"><span class="linenum">3482</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div'); <span class="comment">// forumpost</span>
<a name="l3483"><span class="linenum">3483</span></a>  
<a name="l3484"><span class="linenum">3484</span></a>  <span class="comment">    // Mark the forum post as read if required</span>
<a name="l3485"><span class="linenum">3485</span></a>      if (<a class="var it41570" onMouseOver="hilite(41570)" onMouseOut="lolite()" onClick="logVariable('istracked')" href="../../_variables/istracked.html">$istracked</a> &amp;&amp; !<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_usermarksread')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_usermarksread.html">forum_usermarksread</a> &amp;&amp; !<a class="var it41568" onMouseOver="hilite(41568)" onMouseOut="lolite()" onClick="logVariable('postisread')" href="../../_variables/postisread.html">$postisread</a>) {
<a name="l3486"><span class="linenum">3486</span></a>          <a class="function" onClick="logFunction('forum_tp_mark_post_read')" href="../../_functions/forum_tp_mark_post_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_post_read')">forum_tp_mark_post_read</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3487"><span class="linenum">3487</span></a>      }
<a name="l3488"><span class="linenum">3488</span></a>  
<a name="l3489"><span class="linenum">3489</span></a>      if (<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>) {
<a name="l3490"><span class="linenum">3490</span></a>          return <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l3491"><span class="linenum">3491</span></a>      }
<a name="l3492"><span class="linenum">3492</span></a>      echo <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l3493"><span class="linenum">3493</span></a>      return;
<a name="l3494"><span class="linenum">3494</span></a>  }
<a name="l3495"><span class="linenum">3495</span></a>  
<a name="l3496"><span class="linenum">3496</span></a>  <span class="comment">/**</span>
<a name="l3497"><span class="linenum">3497</span></a>  <span class="comment"> * Return rating related permissions</span>
<a name="l3498"><span class="linenum">3498</span></a>  <span class="comment"> *</span>
<a name="l3499"><span class="linenum">3499</span></a>  <span class="comment"> * @param string $options the context id</span>
<a name="l3500"><span class="linenum">3500</span></a>  <span class="comment"> * @return array an associative array of the user's rating permissions</span>
<a name="l3501"><span class="linenum">3501</span></a>  <span class="comment"> */</span>
<a name="l3502"><span class="linenum">3502</span></a>  function <a class="function" onClick="logFunction('forum_rating_permissions')" href="../../_functions/forum_rating_permissions.html" onMouseOver="funcPopup(event,'forum_rating_permissions')">forum_rating_permissions</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it5414" onMouseOver="hilite(5414)" onMouseOut="lolite()" onClick="logVariable('ratingarea')" href="../../_variables/ratingarea.html">$ratingarea</a>) {
<a name="l3503"><span class="linenum">3503</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3504"><span class="linenum">3504</span></a>      if (<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a> != 'mod_forum' || <a class="var it5414" onMouseOver="hilite(5414)" onMouseOut="lolite()" onClick="logVariable('ratingarea')" href="../../_variables/ratingarea.html">$ratingarea</a> != 'post') {
<a name="l3505"><span class="linenum">3505</span></a>  <span class="comment">        // We don't know about this component/ratingarea so just return null to get the</span>
<a name="l3506"><span class="linenum">3506</span></a>  <span class="comment">        // default restrictive permissions.</span>
<a name="l3507"><span class="linenum">3507</span></a>          return null;
<a name="l3508"><span class="linenum">3508</span></a>      }
<a name="l3509"><span class="linenum">3509</span></a>      return array(
<a name="l3510"><span class="linenum">3510</span></a>          'view'    =&gt; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewrating', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>),
<a name="l3511"><span class="linenum">3511</span></a>          'viewany' =&gt; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewanyrating', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>),
<a name="l3512"><span class="linenum">3512</span></a>          'viewall' =&gt; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewallratings', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>),
<a name="l3513"><span class="linenum">3513</span></a>          'rate'    =&gt; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:rate', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)
<a name="l3514"><span class="linenum">3514</span></a>      );
<a name="l3515"><span class="linenum">3515</span></a>  }
<a name="l3516"><span class="linenum">3516</span></a>  
<a name="l3517"><span class="linenum">3517</span></a>  <span class="comment">/**</span>
<a name="l3518"><span class="linenum">3518</span></a>  <span class="comment"> * Validates a submitted rating</span>
<a name="l3519"><span class="linenum">3519</span></a>  <span class="comment"> * @param array $params submitted data</span>
<a name="l3520"><span class="linenum">3520</span></a>  <span class="comment"> *            context =&gt; object the context in which the rated items exists [required]</span>
<a name="l3521"><span class="linenum">3521</span></a>  <span class="comment"> *            component =&gt; The component for this module - should always be mod_forum [required]</span>
<a name="l3522"><span class="linenum">3522</span></a>  <span class="comment"> *            ratingarea =&gt; object the context in which the rated items exists [required]</span>
<a name="l3523"><span class="linenum">3523</span></a>  <span class="comment"> *            itemid =&gt; int the ID of the object being rated [required]</span>
<a name="l3524"><span class="linenum">3524</span></a>  <span class="comment"> *            scaleid =&gt; int the scale from which the user can select a rating. Used for bounds checking. [required]</span>
<a name="l3525"><span class="linenum">3525</span></a>  <span class="comment"> *            rating =&gt; int the submitted rating [required]</span>
<a name="l3526"><span class="linenum">3526</span></a>  <span class="comment"> *            rateduserid =&gt; int the id of the user whose items have been rated. NOT the user who submitted the ratings. 0 to update all. [required]</span>
<a name="l3527"><span class="linenum">3527</span></a>  <span class="comment"> *            aggregation =&gt; int the aggregation method to apply when calculating grades ie RATING_AGGREGATE_AVERAGE [required]</span>
<a name="l3528"><span class="linenum">3528</span></a>  <span class="comment"> * @return boolean true if the rating is valid. Will throw rating_exception if not</span>
<a name="l3529"><span class="linenum">3529</span></a>  <span class="comment"> */</span>
<a name="l3530"><span class="linenum">3530</span></a>  function <a class="function" onClick="logFunction('forum_rating_validate')" href="../../_functions/forum_rating_validate.html" onMouseOver="funcPopup(event,'forum_rating_validate')">forum_rating_validate</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) {
<a name="l3531"><span class="linenum">3531</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l3532"><span class="linenum">3532</span></a>  
<a name="l3533"><span class="linenum">3533</span></a>  <span class="comment">    // Check the component is mod_forum</span>
<a name="l3534"><span class="linenum">3534</span></a>      if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component'] != 'mod_forum') {
<a name="l3535"><span class="linenum">3535</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidcomponent');
<a name="l3536"><span class="linenum">3536</span></a>      }
<a name="l3537"><span class="linenum">3537</span></a>  
<a name="l3538"><span class="linenum">3538</span></a>  <span class="comment">    // Check the ratingarea is post (the only rating area in forum)</span>
<a name="l3539"><span class="linenum">3539</span></a>      if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['ratingarea'] != 'post') {
<a name="l3540"><span class="linenum">3540</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidratingarea');
<a name="l3541"><span class="linenum">3541</span></a>      }
<a name="l3542"><span class="linenum">3542</span></a>  
<a name="l3543"><span class="linenum">3543</span></a>  <span class="comment">    // Check the rateduserid is not the current user .. you can't rate your own posts</span>
<a name="l3544"><span class="linenum">3544</span></a>      if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['rateduserid'] == <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l3545"><span class="linenum">3545</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('nopermissiontorate');
<a name="l3546"><span class="linenum">3546</span></a>      }
<a name="l3547"><span class="linenum">3547</span></a>  
<a name="l3548"><span class="linenum">3548</span></a>  <span class="comment">    // Fetch all the related records ... we need to do this anyway to call forum_user_can_see_post</span>
<a name="l3549"><span class="linenum">3549</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_posts', array('id' =&gt; <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid'], 'userid' =&gt; <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['rateduserid']), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3550"><span class="linenum">3550</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('id' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3551"><span class="linenum">3551</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3552"><span class="linenum">3552</span></a>      <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3553"><span class="linenum">3553</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> , false, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3554"><span class="linenum">3554</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3555"><span class="linenum">3555</span></a>  
<a name="l3556"><span class="linenum">3556</span></a>  <span class="comment">    // Make sure the context provided is the context of the forum</span>
<a name="l3557"><span class="linenum">3557</span></a>      if (<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> != <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['context']-&gt;id) {
<a name="l3558"><span class="linenum">3558</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidcontext');
<a name="l3559"><span class="linenum">3559</span></a>      }
<a name="l3560"><span class="linenum">3560</span></a>  
<a name="l3561"><span class="linenum">3561</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> != <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['scaleid']) {
<a name="l3562"><span class="linenum">3562</span></a>  <span class="comment">        //the scale being submitted doesnt match the one in the database</span>
<a name="l3563"><span class="linenum">3563</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidscaleid');
<a name="l3564"><span class="linenum">3564</span></a>      }
<a name="l3565"><span class="linenum">3565</span></a>  
<a name="l3566"><span class="linenum">3566</span></a>  <span class="comment">    // check the item we're rating was created in the assessable time window</span>
<a name="l3567"><span class="linenum">3567</span></a>      if (!empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimestart')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimestart.html">assesstimestart</a>) &amp;&amp; !empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimefinish')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimefinish.html">assesstimefinish</a>)) {
<a name="l3568"><span class="linenum">3568</span></a>          if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('created')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/created.html">created</a> &lt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimestart')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimestart.html">assesstimestart</a> || <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('created')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/created.html">created</a> &gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimefinish')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimefinish.html">assesstimefinish</a>) {
<a name="l3569"><span class="linenum">3569</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('notavailable');
<a name="l3570"><span class="linenum">3570</span></a>          }
<a name="l3571"><span class="linenum">3571</span></a>      }
<a name="l3572"><span class="linenum">3572</span></a>  
<a name="l3573"><span class="linenum">3573</span></a>  <span class="comment">    //check that the submitted rating is valid for the scale</span>
<a name="l3574"><span class="linenum">3574</span></a>  
<a name="l3575"><span class="linenum">3575</span></a>  <span class="comment">    // lower limit</span>
<a name="l3576"><span class="linenum">3576</span></a>      if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['rating'] &lt; 0  &amp;&amp; <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['rating'] != <a class="constant" onClick="logConstant('RATING_UNSET_RATING')" href="../../_constants/RATING_UNSET_RATING.html" onMouseOver="constPopup(event,'RATING_UNSET_RATING')">RATING_UNSET_RATING</a>) {
<a name="l3577"><span class="linenum">3577</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidnum');
<a name="l3578"><span class="linenum">3578</span></a>      }
<a name="l3579"><span class="linenum">3579</span></a>  
<a name="l3580"><span class="linenum">3580</span></a>  <span class="comment">    // upper limit</span>
<a name="l3581"><span class="linenum">3581</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> &lt; 0) {
<a name="l3582"><span class="linenum">3582</span></a>  <span class="comment">        //its a custom scale</span>
<a name="l3583"><span class="linenum">3583</span></a>          <a class="var it12578" onMouseOver="hilite(12578)" onMouseOut="lolite()" onClick="logVariable('scalerecord')" href="../../_variables/scalerecord.html">$scalerecord</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('scale', array('id' =&gt; -<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>));
<a name="l3584"><span class="linenum">3584</span></a>          if (<a class="var it12578" onMouseOver="hilite(12578)" onMouseOut="lolite()" onClick="logVariable('scalerecord')" href="../../_variables/scalerecord.html">$scalerecord</a>) {
<a name="l3585"><span class="linenum">3585</span></a>              <a class="var it12579" onMouseOver="hilite(12579)" onMouseOut="lolite()" onClick="logVariable('scalearray')" href="../../_variables/scalearray.html">$scalearray</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it12578" onMouseOver="hilite(12578)" onMouseOut="lolite()" onClick="logVariable('scalerecord')" href="../../_variables/scalerecord.html">$scalerecord</a>-&gt;<a onClick="logVariable('scale')" class="var it44549" onMouseOver="hilite(44549)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>);
<a name="l3586"><span class="linenum">3586</span></a>              if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['rating'] &gt; <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it12579" onMouseOver="hilite(12579)" onMouseOut="lolite()" onClick="logVariable('scalearray')" href="../../_variables/scalearray.html">$scalearray</a>)) {
<a name="l3587"><span class="linenum">3587</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidnum');
<a name="l3588"><span class="linenum">3588</span></a>              }
<a name="l3589"><span class="linenum">3589</span></a>          } else {
<a name="l3590"><span class="linenum">3590</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidscaleid');
<a name="l3591"><span class="linenum">3591</span></a>          }
<a name="l3592"><span class="linenum">3592</span></a>      } else if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['rating'] &gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>) {
<a name="l3593"><span class="linenum">3593</span></a>  <span class="comment">        //if its numeric and submitted rating is above maximum</span>
<a name="l3594"><span class="linenum">3594</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidnum');
<a name="l3595"><span class="linenum">3595</span></a>      }
<a name="l3596"><span class="linenum">3596</span></a>  
<a name="l3597"><span class="linenum">3597</span></a>  <span class="comment">    // Make sure groups allow this user to see the item they're rating</span>
<a name="l3598"><span class="linenum">3598</span></a>      if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> &gt; 0 and <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>)) {   // Groups are being used
<a name="l3599"><span class="linenum">3599</span></a>          if (!<a class="function" onClick="logFunction('groups_group_exists')" href="../../_functions/groups_group_exists.html" onMouseOver="funcPopup(event,'groups_group_exists')">groups_group_exists</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>)) { // Can't find group
<a name="l3600"><span class="linenum">3600</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('cannotfindgroup');<span class="comment">//something is wrong</span>
<a name="l3601"><span class="linenum">3601</span></a>          }
<a name="l3602"><span class="linenum">3602</span></a>  
<a name="l3603"><span class="linenum">3603</span></a>          if (!<a class="function" onClick="logFunction('groups_is_member')" href="../../_functions/groups_is_member.html" onMouseOver="funcPopup(event,'groups_is_member')">groups_is_member</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>) and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l3604"><span class="linenum">3604</span></a>  <span class="comment">            // do not allow rating of posts from other groups when in SEPARATEGROUPS or VISIBLEGROUPS</span>
<a name="l3605"><span class="linenum">3605</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('notmemberofgroup');
<a name="l3606"><span class="linenum">3606</span></a>          }
<a name="l3607"><span class="linenum">3607</span></a>      }
<a name="l3608"><span class="linenum">3608</span></a>  
<a name="l3609"><span class="linenum">3609</span></a>  <span class="comment">    // perform some final capability checks</span>
<a name="l3610"><span class="linenum">3610</span></a>      if (!<a class="function" onClick="logFunction('forum_user_can_see_post')" href="../../_functions/forum_user_can_see_post.html" onMouseOver="funcPopup(event,'forum_user_can_see_post')">forum_user_can_see_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l3611"><span class="linenum">3611</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('nopermissiontorate');
<a name="l3612"><span class="linenum">3612</span></a>      }
<a name="l3613"><span class="linenum">3613</span></a>  
<a name="l3614"><span class="linenum">3614</span></a>      return true;
<a name="l3615"><span class="linenum">3615</span></a>  }
<a name="l3616"><span class="linenum">3616</span></a>  
<a name="l3617"><span class="linenum">3617</span></a>  <span class="comment">/**</span>
<a name="l3618"><span class="linenum">3618</span></a>  <span class="comment"> * Can the current user see ratings for a given itemid?</span>
<a name="l3619"><span class="linenum">3619</span></a>  <span class="comment"> *</span>
<a name="l3620"><span class="linenum">3620</span></a>  <span class="comment"> * @param array $params submitted data</span>
<a name="l3621"><span class="linenum">3621</span></a>  <span class="comment"> *            contextid =&gt; int contextid [required]</span>
<a name="l3622"><span class="linenum">3622</span></a>  <span class="comment"> *            component =&gt; The component for this module - should always be mod_forum [required]</span>
<a name="l3623"><span class="linenum">3623</span></a>  <span class="comment"> *            ratingarea =&gt; object the context in which the rated items exists [required]</span>
<a name="l3624"><span class="linenum">3624</span></a>  <span class="comment"> *            itemid =&gt; int the ID of the object being rated [required]</span>
<a name="l3625"><span class="linenum">3625</span></a>  <span class="comment"> *            scaleid =&gt; int scale id [optional]</span>
<a name="l3626"><span class="linenum">3626</span></a>  <span class="comment"> * @return bool</span>
<a name="l3627"><span class="linenum">3627</span></a>  <span class="comment"> * @throws coding_exception</span>
<a name="l3628"><span class="linenum">3628</span></a>  <span class="comment"> * @throws rating_exception</span>
<a name="l3629"><span class="linenum">3629</span></a>  <span class="comment"> */</span>
<a name="l3630"><span class="linenum">3630</span></a>  function <a class="function" onClick="logFunction('mod_forum_rating_can_see_item_ratings')" href="../../_functions/mod_forum_rating_can_see_item_ratings.html" onMouseOver="funcPopup(event,'mod_forum_rating_can_see_item_ratings')">mod_forum_rating_can_see_item_ratings</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) {
<a name="l3631"><span class="linenum">3631</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l3632"><span class="linenum">3632</span></a>  
<a name="l3633"><span class="linenum">3633</span></a>  <span class="comment">    // Check the component is mod_forum.</span>
<a name="l3634"><span class="linenum">3634</span></a>      if (!isset(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component']) || <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component'] != 'mod_forum') {
<a name="l3635"><span class="linenum">3635</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidcomponent');
<a name="l3636"><span class="linenum">3636</span></a>      }
<a name="l3637"><span class="linenum">3637</span></a>  
<a name="l3638"><span class="linenum">3638</span></a>  <span class="comment">    // Check the ratingarea is post (the only rating area in forum).</span>
<a name="l3639"><span class="linenum">3639</span></a>      if (!isset(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['ratingarea']) || <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['ratingarea'] != 'post') {
<a name="l3640"><span class="linenum">3640</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invalidratingarea');
<a name="l3641"><span class="linenum">3641</span></a>      }
<a name="l3642"><span class="linenum">3642</span></a>  
<a name="l3643"><span class="linenum">3643</span></a>      if (!isset(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid'])) {
<a name="l3644"><span class="linenum">3644</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('rating_exception')" href="../../_classes/rating_exception.html" onMouseOver="classPopup(event,'rating_exception')">rating_exception</a>('invaliditemid');
<a name="l3645"><span class="linenum">3645</span></a>      }
<a name="l3646"><span class="linenum">3646</span></a>  
<a name="l3647"><span class="linenum">3647</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_posts', array('id' =&gt; <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid']), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3648"><span class="linenum">3648</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('id' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3649"><span class="linenum">3649</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3650"><span class="linenum">3650</span></a>      <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3651"><span class="linenum">3651</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> , false, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l3652"><span class="linenum">3652</span></a>  
<a name="l3653"><span class="linenum">3653</span></a>  <span class="comment">    // Perform some final capability checks.</span>
<a name="l3654"><span class="linenum">3654</span></a>      if (!<a class="function" onClick="logFunction('forum_user_can_see_post')" href="../../_functions/forum_user_can_see_post.html" onMouseOver="funcPopup(event,'forum_user_can_see_post')">forum_user_can_see_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l3655"><span class="linenum">3655</span></a>          return false;
<a name="l3656"><span class="linenum">3656</span></a>      }
<a name="l3657"><span class="linenum">3657</span></a>      return true;
<a name="l3658"><span class="linenum">3658</span></a>  }
<a name="l3659"><span class="linenum">3659</span></a>  
<a name="l3660"><span class="linenum">3660</span></a>  <span class="comment">/**</span>
<a name="l3661"><span class="linenum">3661</span></a>  <span class="comment"> * This function prints the overview of a discussion in the forum listing.</span>
<a name="l3662"><span class="linenum">3662</span></a>  <span class="comment"> * It needs some discussion information and some post information, these</span>
<a name="l3663"><span class="linenum">3663</span></a>  <span class="comment"> * happen to be combined for efficiency in the $post parameter by the function</span>
<a name="l3664"><span class="linenum">3664</span></a>  <span class="comment"> * that calls this one: forum_print_latest_discussions()</span>
<a name="l3665"><span class="linenum">3665</span></a>  <span class="comment"> *</span>
<a name="l3666"><span class="linenum">3666</span></a>  <span class="comment"> * @global object</span>
<a name="l3667"><span class="linenum">3667</span></a>  <span class="comment"> * @global object</span>
<a name="l3668"><span class="linenum">3668</span></a>  <span class="comment"> * @param object $post The post object (passed by reference for speed).</span>
<a name="l3669"><span class="linenum">3669</span></a>  <span class="comment"> * @param object $forum The forum object.</span>
<a name="l3670"><span class="linenum">3670</span></a>  <span class="comment"> * @param int $group Current group.</span>
<a name="l3671"><span class="linenum">3671</span></a>  <span class="comment"> * @param string $datestring Format to use for the dates.</span>
<a name="l3672"><span class="linenum">3672</span></a>  <span class="comment"> * @param boolean $cantrack Is tracking enabled for this forum.</span>
<a name="l3673"><span class="linenum">3673</span></a>  <span class="comment"> * @param boolean $forumtracked Is the user tracking this forum.</span>
<a name="l3674"><span class="linenum">3674</span></a>  <span class="comment"> * @param boolean $canviewparticipants True if user has the viewparticipants permission for this course</span>
<a name="l3675"><span class="linenum">3675</span></a>  <span class="comment"> * @param boolean $canviewhiddentimedposts True if user has the viewhiddentimedposts permission for this forum</span>
<a name="l3676"><span class="linenum">3676</span></a>  <span class="comment"> */</span>
<a name="l3677"><span class="linenum">3677</span></a>  function <a class="function" onClick="logFunction('forum_print_discussion_header')" href="../../_functions/forum_print_discussion_header.html" onMouseOver="funcPopup(event,'forum_print_discussion_header')">forum_print_discussion_header</a>(&amp;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a> = -1, <a class="var it8658" onMouseOver="hilite(8658)" onMouseOut="lolite()" onClick="logVariable('datestring')" href="../../_variables/datestring.html">$datestring</a> = &quot;&quot;,
<a name="l3678"><span class="linenum">3678</span></a>                                          <a class="var it30670" onMouseOver="hilite(30670)" onMouseOut="lolite()" onClick="logVariable('cantrack')" href="../../_variables/cantrack.html">$cantrack</a> = true, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a> = true, <a class="var it41590" onMouseOver="hilite(41590)" onMouseOut="lolite()" onClick="logVariable('canviewparticipants')" href="../../_variables/canviewparticipants.html">$canviewparticipants</a> = true, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = null,
<a name="l3679"><span class="linenum">3679</span></a>                                          <a class="var it41591" onMouseOver="hilite(41591)" onMouseOut="lolite()" onClick="logVariable('canviewhiddentimedposts')" href="../../_variables/canviewhiddentimedposts.html">$canviewhiddentimedposts</a> = false) {
<a name="l3680"><span class="linenum">3680</span></a>  
<a name="l3681"><span class="linenum">3681</span></a>      global <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>;
<a name="l3682"><span class="linenum">3682</span></a>  
<a name="l3683"><span class="linenum">3683</span></a>      static <a class="var it3981" onMouseOver="hilite(3981)" onMouseOut="lolite()" onClick="logVariable('rowcount')" href="../../_variables/rowcount.html">$rowcount</a>;
<a name="l3684"><span class="linenum">3684</span></a>      static <a class="var it41592" onMouseOver="hilite(41592)" onMouseOut="lolite()" onClick="logVariable('strmarkalldread')" href="../../_variables/strmarkalldread.html">$strmarkalldread</a>;
<a name="l3685"><span class="linenum">3685</span></a>  
<a name="l3686"><span class="linenum">3686</span></a>      if (empty(<a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l3687"><span class="linenum">3687</span></a>          if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)) {
<a name="l3688"><span class="linenum">3688</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidcoursemodule');
<a name="l3689"><span class="linenum">3689</span></a>          }
<a name="l3690"><span class="linenum">3690</span></a>          <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3691"><span class="linenum">3691</span></a>      }
<a name="l3692"><span class="linenum">3692</span></a>  
<a name="l3693"><span class="linenum">3693</span></a>      if (!isset(<a class="var it3981" onMouseOver="hilite(3981)" onMouseOut="lolite()" onClick="logVariable('rowcount')" href="../../_variables/rowcount.html">$rowcount</a>)) {
<a name="l3694"><span class="linenum">3694</span></a>          <a class="var it3981" onMouseOver="hilite(3981)" onMouseOut="lolite()" onClick="logVariable('rowcount')" href="../../_variables/rowcount.html">$rowcount</a> = 0;
<a name="l3695"><span class="linenum">3695</span></a>          <a class="var it41592" onMouseOver="hilite(41592)" onMouseOut="lolite()" onClick="logVariable('strmarkalldread')" href="../../_variables/strmarkalldread.html">$strmarkalldread</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('markalldread', 'forum');
<a name="l3696"><span class="linenum">3696</span></a>      } else {
<a name="l3697"><span class="linenum">3697</span></a>          <a class="var it3981" onMouseOver="hilite(3981)" onMouseOut="lolite()" onClick="logVariable('rowcount')" href="../../_variables/rowcount.html">$rowcount</a> = (<a class="var it3981" onMouseOver="hilite(3981)" onMouseOut="lolite()" onClick="logVariable('rowcount')" href="../../_variables/rowcount.html">$rowcount</a> + 1) % 2;
<a name="l3698"><span class="linenum">3698</span></a>      }
<a name="l3699"><span class="linenum">3699</span></a>  
<a name="l3700"><span class="linenum">3700</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>,true);
<a name="l3701"><span class="linenum">3701</span></a>  
<a name="l3702"><span class="linenum">3702</span></a>      <a class="var it41593" onMouseOver="hilite(41593)" onMouseOut="lolite()" onClick="logVariable('timeddiscussion')" href="../../_variables/timeddiscussion.html">$timeddiscussion</a> = !empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>) &amp;&amp; (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timestart')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> || <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timeend')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a>);
<a name="l3703"><span class="linenum">3703</span></a>      <a class="var it41594" onMouseOver="hilite(41594)" onMouseOut="lolite()" onClick="logVariable('timedoutsidewindow')" href="../../_variables/timedoutsidewindow.html">$timedoutsidewindow</a> = '';
<a name="l3704"><span class="linenum">3704</span></a>      if (<a class="var it41593" onMouseOver="hilite(41593)" onMouseOut="lolite()" onClick="logVariable('timeddiscussion')" href="../../_variables/timeddiscussion.html">$timeddiscussion</a> &amp;&amp; (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timestart')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> &gt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() || (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timeend')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a> != 0 &amp;&amp; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timeend')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()))) {
<a name="l3705"><span class="linenum">3705</span></a>          <a class="var it41594" onMouseOver="hilite(41594)" onMouseOut="lolite()" onClick="logVariable('timedoutsidewindow')" href="../../_variables/timedoutsidewindow.html">$timedoutsidewindow</a> = ' dimmed_text';
<a name="l3706"><span class="linenum">3706</span></a>      }
<a name="l3707"><span class="linenum">3707</span></a>  
<a name="l3708"><span class="linenum">3708</span></a>      echo &quot;\n\n&quot;;
<a name="l3709"><span class="linenum">3709</span></a>      echo '&lt;tr class=&quot;discussion r'.<a class="var it3981" onMouseOver="hilite(3981)" onMouseOut="lolite()" onClick="logVariable('rowcount')" href="../../_variables/rowcount.html">$rowcount</a>.<a class="var it41594" onMouseOver="hilite(41594)" onMouseOut="lolite()" onClick="logVariable('timedoutsidewindow')" href="../../_variables/timedoutsidewindow.html">$timedoutsidewindow</a>.'&quot;&gt;';
<a name="l3710"><span class="linenum">3710</span></a>  
<a name="l3711"><span class="linenum">3711</span></a>      <a class="var it41581" onMouseOver="hilite(41581)" onMouseOut="lolite()" onClick="logVariable('topicclass')" href="../../_variables/topicclass.html">$topicclass</a> = 'topic starter';
<a name="l3712"><span class="linenum">3712</span></a>      if (<a class="constant" onClick="logConstant('FORUM_DISCUSSION_PINNED')" href="../../_constants/FORUM_DISCUSSION_PINNED.html" onMouseOver="constPopup(event,'FORUM_DISCUSSION_PINNED')">FORUM_DISCUSSION_PINNED</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('pinned')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/pinned.html">pinned</a>) {
<a name="l3713"><span class="linenum">3713</span></a>          <a class="var it41581" onMouseOver="hilite(41581)" onMouseOut="lolite()" onClick="logVariable('topicclass')" href="../../_variables/topicclass.html">$topicclass</a> .= ' pinned';
<a name="l3714"><span class="linenum">3714</span></a>      }
<a name="l3715"><span class="linenum">3715</span></a>      echo '&lt;td class=&quot;'.<a class="var it41581" onMouseOver="hilite(41581)" onMouseOut="lolite()" onClick="logVariable('topicclass')" href="../../_variables/topicclass.html">$topicclass</a>.'&quot;&gt;';
<a name="l3716"><span class="linenum">3716</span></a>      if (<a class="constant" onClick="logConstant('FORUM_DISCUSSION_PINNED')" href="../../_constants/FORUM_DISCUSSION_PINNED.html" onMouseOver="constPopup(event,'FORUM_DISCUSSION_PINNED')">FORUM_DISCUSSION_PINNED</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('pinned')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/pinned.html">pinned</a>) {
<a name="l3717"><span class="linenum">3717</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_icon')" href="../../_functions/pix_icon.html" onMouseOver="funcPopup(event,'pix_icon')">pix_icon</a>('i/pinned', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('discussionpinned', 'forum'), 'mod_forum');
<a name="l3718"><span class="linenum">3718</span></a>      }
<a name="l3719"><span class="linenum">3719</span></a>      <a class="var it41595" onMouseOver="hilite(41595)" onMouseOut="lolite()" onClick="logVariable('canalwaysseetimedpost')" href="../../_variables/canalwaysseetimedpost.html">$canalwaysseetimedpost</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> || <a class="var it41591" onMouseOver="hilite(41591)" onMouseOut="lolite()" onClick="logVariable('canviewhiddentimedposts')" href="../../_variables/canviewhiddentimedposts.html">$canviewhiddentimedposts</a>;
<a name="l3720"><span class="linenum">3720</span></a>      if (<a class="var it41593" onMouseOver="hilite(41593)" onMouseOut="lolite()" onClick="logVariable('timeddiscussion')" href="../../_variables/timeddiscussion.html">$timeddiscussion</a> &amp;&amp; <a class="var it41595" onMouseOver="hilite(41595)" onMouseOut="lolite()" onClick="logVariable('canalwaysseetimedpost')" href="../../_variables/canalwaysseetimedpost.html">$canalwaysseetimedpost</a>) {
<a name="l3721"><span class="linenum">3721</span></a>          echo <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('mod_forum')-&gt;<a class="function" onClick="logFunction('timed_discussion_tooltip')" href="../../_functions/timed_discussion_tooltip.html" onMouseOver="funcPopup(event,'timed_discussion_tooltip')">timed_discussion_tooltip</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, empty(<a class="var it41594" onMouseOver="hilite(41594)" onMouseOut="lolite()" onClick="logVariable('timedoutsidewindow')" href="../../_variables/timedoutsidewindow.html">$timedoutsidewindow</a>));
<a name="l3722"><span class="linenum">3722</span></a>      }
<a name="l3723"><span class="linenum">3723</span></a>  
<a name="l3724"><span class="linenum">3724</span></a>      echo '&lt;a href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/discuss.php?d='.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>.'&quot;&gt;'.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>.'&lt;/a&gt;';
<a name="l3725"><span class="linenum">3725</span></a>      echo &quot;&lt;/td&gt;\n&quot;;
<a name="l3726"><span class="linenum">3726</span></a>  
<a name="l3727"><span class="linenum">3727</span></a>  <span class="comment">    // Picture</span>
<a name="l3728"><span class="linenum">3728</span></a>      <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a> = new stdClass();
<a name="l3729"><span class="linenum">3729</span></a>      <a class="var it41575" onMouseOver="hilite(41575)" onMouseOut="lolite()" onClick="logVariable('postuserfields')" href="../../_variables/postuserfields.html">$postuserfields</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="class" onClick="logClass('user_picture')" href="../../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>());
<a name="l3730"><span class="linenum">3730</span></a>      <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a> = <a class="function" onClick="logFunction('username_load_fields_from_object')" href="../../_functions/username_load_fields_from_object.html" onMouseOver="funcPopup(event,'username_load_fields_from_object')">username_load_fields_from_object</a>(<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, null, <a class="var it41575" onMouseOver="hilite(41575)" onMouseOut="lolite()" onClick="logVariable('postuserfields')" href="../../_variables/postuserfields.html">$postuserfields</a>);
<a name="l3731"><span class="linenum">3731</span></a>      <a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>-&gt;<a onClick="logVariable('id')" class="var it44614" onMouseOver="hilite(44614)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l3732"><span class="linenum">3732</span></a>      echo '&lt;td class=&quot;picture&quot;&gt;';
<a name="l3733"><span class="linenum">3733</span></a>      echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>, array('courseid'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>));
<a name="l3734"><span class="linenum">3734</span></a>      echo &quot;&lt;/td&gt;\n&quot;;
<a name="l3735"><span class="linenum">3735</span></a>  
<a name="l3736"><span class="linenum">3736</span></a>  <span class="comment">    // User name</span>
<a name="l3737"><span class="linenum">3737</span></a>      <a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a> = <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it41493" onMouseOver="hilite(41493)" onMouseOut="lolite()" onClick="logVariable('postuser')" href="../../_variables/postuser.html">$postuser</a>, <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>));
<a name="l3738"><span class="linenum">3738</span></a>      echo '&lt;td class=&quot;author&quot;&gt;';
<a name="l3739"><span class="linenum">3739</span></a>      echo '&lt;a href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/user/view.php?id='.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>.'&amp;amp;course='.<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>.'&quot;&gt;'.<a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>.'&lt;/a&gt;';
<a name="l3740"><span class="linenum">3740</span></a>      echo &quot;&lt;/td&gt;\n&quot;;
<a name="l3741"><span class="linenum">3741</span></a>  
<a name="l3742"><span class="linenum">3742</span></a>  <span class="comment">    // Group picture</span>
<a name="l3743"><span class="linenum">3743</span></a>      if (<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a> !== -1) {  // Groups are active - group is a group data object or NULL
<a name="l3744"><span class="linenum">3744</span></a>          echo '&lt;td class=&quot;picture group&quot;&gt;';
<a name="l3745"><span class="linenum">3745</span></a>          if (!empty(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('picture')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a>) and empty(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('hidepicture')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/hidepicture.html">hidepicture</a>)) {
<a name="l3746"><span class="linenum">3746</span></a>              if (<a class="var it41590" onMouseOver="hilite(41590)" onMouseOut="lolite()" onClick="logVariable('canviewparticipants')" href="../../_variables/canviewparticipants.html">$canviewparticipants</a> &amp;&amp; <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('groupmode')" class="var it43316" onMouseOver="hilite(43316)" onMouseOut="lolite()" href="../../_variables/groupmode.html">groupmode</a>) {
<a name="l3747"><span class="linenum">3747</span></a>                  <a class="var it39108" onMouseOver="hilite(39108)" onMouseOut="lolite()" onClick="logVariable('picturelink')" href="../../_variables/picturelink.html">$picturelink</a> = true;
<a name="l3748"><span class="linenum">3748</span></a>              } else {
<a name="l3749"><span class="linenum">3749</span></a>                  <a class="var it39108" onMouseOver="hilite(39108)" onMouseOut="lolite()" onClick="logVariable('picturelink')" href="../../_variables/picturelink.html">$picturelink</a> = false;
<a name="l3750"><span class="linenum">3750</span></a>              }
<a name="l3751"><span class="linenum">3751</span></a>              <a class="function" onClick="logFunction('print_group_picture')" href="../../_functions/print_group_picture.html" onMouseOver="funcPopup(event,'print_group_picture')">print_group_picture</a>(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, false, false, <a class="var it39108" onMouseOver="hilite(39108)" onMouseOut="lolite()" onClick="logVariable('picturelink')" href="../../_variables/picturelink.html">$picturelink</a>);
<a name="l3752"><span class="linenum">3752</span></a>          } else if (isset(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('id')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l3753"><span class="linenum">3753</span></a>              if (<a class="var it41590" onMouseOver="hilite(41590)" onMouseOut="lolite()" onClick="logVariable('canviewparticipants')" href="../../_variables/canviewparticipants.html">$canviewparticipants</a> &amp;&amp; <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('groupmode')" class="var it43316" onMouseOver="hilite(43316)" onMouseOut="lolite()" href="../../_variables/groupmode.html">groupmode</a>) {
<a name="l3754"><span class="linenum">3754</span></a>                  echo '&lt;a href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/user/index.php?id='.<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>.'&amp;amp;group='.<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('id')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'&quot;&gt;'.<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('name')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>.'&lt;/a&gt;';
<a name="l3755"><span class="linenum">3755</span></a>              } else {
<a name="l3756"><span class="linenum">3756</span></a>                  echo <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('name')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l3757"><span class="linenum">3757</span></a>              }
<a name="l3758"><span class="linenum">3758</span></a>          }
<a name="l3759"><span class="linenum">3759</span></a>          echo &quot;&lt;/td&gt;\n&quot;;
<a name="l3760"><span class="linenum">3760</span></a>      }
<a name="l3761"><span class="linenum">3761</span></a>  
<a name="l3762"><span class="linenum">3762</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {   // Show the column with replies
<a name="l3763"><span class="linenum">3763</span></a>          echo '&lt;td class=&quot;replies&quot;&gt;';
<a name="l3764"><span class="linenum">3764</span></a>          echo '&lt;a href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/discuss.php?d='.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>.'&quot;&gt;';
<a name="l3765"><span class="linenum">3765</span></a>          echo <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('replies')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/replies.html">replies</a>.'&lt;/a&gt;';
<a name="l3766"><span class="linenum">3766</span></a>          echo &quot;&lt;/td&gt;\n&quot;;
<a name="l3767"><span class="linenum">3767</span></a>  
<a name="l3768"><span class="linenum">3768</span></a>          if (<a class="var it30670" onMouseOver="hilite(30670)" onMouseOut="lolite()" onClick="logVariable('cantrack')" href="../../_variables/cantrack.html">$cantrack</a>) {
<a name="l3769"><span class="linenum">3769</span></a>              echo '&lt;td class=&quot;replies&quot;&gt;';
<a name="l3770"><span class="linenum">3770</span></a>              if (<a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>) {
<a name="l3771"><span class="linenum">3771</span></a>                  if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('unread')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a> &gt; 0) {
<a name="l3772"><span class="linenum">3772</span></a>                      echo '&lt;span class=&quot;unread&quot;&gt;';
<a name="l3773"><span class="linenum">3773</span></a>                      echo '&lt;a href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/discuss.php?d='.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>.'#unread&quot;&gt;';
<a name="l3774"><span class="linenum">3774</span></a>                      echo <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('unread')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a>;
<a name="l3775"><span class="linenum">3775</span></a>                      echo '&lt;/a&gt;';
<a name="l3776"><span class="linenum">3776</span></a>                      echo '&lt;a title=&quot;'.<a class="var it41592" onMouseOver="hilite(41592)" onMouseOut="lolite()" onClick="logVariable('strmarkalldread')" href="../../_variables/strmarkalldread.html">$strmarkalldread</a>.'&quot; href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/markposts.php?f='.
<a name="l3777"><span class="linenum">3777</span></a>                           <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'&amp;amp;d='.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>.'&amp;amp;mark=read&amp;amp;returnpage=view.php&amp;amp;sesskey=' . <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>() . '&quot;&gt;' .
<a name="l3778"><span class="linenum">3778</span></a>                           '&lt;img src=&quot;'.<a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_url')" href="../../_functions/pix_url.html" onMouseOver="funcPopup(event,'pix_url')">pix_url</a>('t/markasread') . '&quot; class=&quot;iconsmall&quot; alt=&quot;'.<a class="var it41592" onMouseOver="hilite(41592)" onMouseOut="lolite()" onClick="logVariable('strmarkalldread')" href="../../_variables/strmarkalldread.html">$strmarkalldread</a>.'&quot; /&gt;&lt;/a&gt;';
<a name="l3779"><span class="linenum">3779</span></a>                      echo '&lt;/span&gt;';
<a name="l3780"><span class="linenum">3780</span></a>                  } else {
<a name="l3781"><span class="linenum">3781</span></a>                      echo '&lt;span class=&quot;read&quot;&gt;';
<a name="l3782"><span class="linenum">3782</span></a>                      echo <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('unread')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a>;
<a name="l3783"><span class="linenum">3783</span></a>                      echo '&lt;/span&gt;';
<a name="l3784"><span class="linenum">3784</span></a>                  }
<a name="l3785"><span class="linenum">3785</span></a>              } else {
<a name="l3786"><span class="linenum">3786</span></a>                  echo '&lt;span class=&quot;read&quot;&gt;';
<a name="l3787"><span class="linenum">3787</span></a>                  echo '-';
<a name="l3788"><span class="linenum">3788</span></a>                  echo '&lt;/span&gt;';
<a name="l3789"><span class="linenum">3789</span></a>              }
<a name="l3790"><span class="linenum">3790</span></a>              echo &quot;&lt;/td&gt;\n&quot;;
<a name="l3791"><span class="linenum">3791</span></a>          }
<a name="l3792"><span class="linenum">3792</span></a>      }
<a name="l3793"><span class="linenum">3793</span></a>  
<a name="l3794"><span class="linenum">3794</span></a>      echo '&lt;td class=&quot;lastpost&quot;&gt;';
<a name="l3795"><span class="linenum">3795</span></a>      <a class="var it3549" onMouseOver="hilite(3549)" onMouseOut="lolite()" onClick="logVariable('usedate')" href="../../_variables/usedate.html">$usedate</a> = (empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>)) ? <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a> : <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>;  <span class="comment">// Just in case</span>
<a name="l3796"><span class="linenum">3796</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('parenturl')" href="../../_variables/parenturl.html">$parenturl</a> = '';
<a name="l3797"><span class="linenum">3797</span></a>      <a class="var it5323" onMouseOver="hilite(5323)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a> = new stdClass();
<a name="l3798"><span class="linenum">3798</span></a>      <a class="var it5323" onMouseOver="hilite(5323)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a>-&gt;<a onClick="logVariable('id')" class="var it44608" onMouseOver="hilite(44608)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('usermodified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a>;
<a name="l3799"><span class="linenum">3799</span></a>      <a class="var it5323" onMouseOver="hilite(5323)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a> = <a class="function" onClick="logFunction('username_load_fields_from_object')" href="../../_functions/username_load_fields_from_object.html" onMouseOver="funcPopup(event,'username_load_fields_from_object')">username_load_fields_from_object</a>(<a class="var it5323" onMouseOver="hilite(5323)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, 'um');
<a name="l3800"><span class="linenum">3800</span></a>  
<a name="l3801"><span class="linenum">3801</span></a>  <span class="comment">    // In QA forums we check that the user can view participants.</span>
<a name="l3802"><span class="linenum">3802</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> !== 'qanda' || <a class="var it41590" onMouseOver="hilite(41590)" onMouseOut="lolite()" onClick="logVariable('canviewparticipants')" href="../../_variables/canviewparticipants.html">$canviewparticipants</a>) {
<a name="l3803"><span class="linenum">3803</span></a>          echo '&lt;a href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/user/view.php?id='.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('usermodified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a>.'&amp;amp;course='.<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>.'&quot;&gt;'.
<a name="l3804"><span class="linenum">3804</span></a>               <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it5323" onMouseOver="hilite(5323)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a>).'&lt;/a&gt;&lt;br /&gt;';
<a name="l3805"><span class="linenum">3805</span></a>          <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('parenturl')" href="../../_variables/parenturl.html">$parenturl</a> = (empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('lastpostid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/lastpostid.html">lastpostid</a>)) ? '' : '&amp;amp;parent='.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('lastpostid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/lastpostid.html">lastpostid</a>;
<a name="l3806"><span class="linenum">3806</span></a>      }
<a name="l3807"><span class="linenum">3807</span></a>  
<a name="l3808"><span class="linenum">3808</span></a>      echo '&lt;a href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/discuss.php?d='.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>.<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('parenturl')" href="../../_variables/parenturl.html">$parenturl</a>.'&quot;&gt;'.
<a name="l3809"><span class="linenum">3809</span></a>            <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it3549" onMouseOver="hilite(3549)" onMouseOut="lolite()" onClick="logVariable('usedate')" href="../../_variables/usedate.html">$usedate</a>, <a class="var it8658" onMouseOver="hilite(8658)" onMouseOut="lolite()" onClick="logVariable('datestring')" href="../../_variables/datestring.html">$datestring</a>).'&lt;/a&gt;';
<a name="l3810"><span class="linenum">3810</span></a>      echo &quot;&lt;/td&gt;\n&quot;;
<a name="l3811"><span class="linenum">3811</span></a>  
<a name="l3812"><span class="linenum">3812</span></a>  <span class="comment">    // is_guest should be used here as this also checks whether the user is a guest in the current course.</span>
<a name="l3813"><span class="linenum">3813</span></a>  <span class="comment">    // Guests and visitors cannot subscribe - only enrolled users.</span>
<a name="l3814"><span class="linenum">3814</span></a>      if ((!<a class="function" onClick="logFunction('is_guest')" href="../../_functions/is_guest.html" onMouseOver="funcPopup(event,'is_guest')">is_guest</a>(<a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>) &amp;&amp; <a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l3815"><span class="linenum">3815</span></a>  <span class="comment">        // Discussion subscription.</span>
<a name="l3816"><span class="linenum">3816</span></a>          if (\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_subscribable')" href="../../_functions/is_subscribable.html" onMouseOver="funcPopup(event,'is_subscribable')">is_subscribable</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l3817"><span class="linenum">3817</span></a>              echo '&lt;td class=&quot;discussionsubscription&quot;&gt;';
<a name="l3818"><span class="linenum">3818</span></a>              echo <a class="function" onClick="logFunction('forum_get_discussion_subscription_icon')" href="../../_functions/forum_get_discussion_subscription_icon.html" onMouseOver="funcPopup(event,'forum_get_discussion_subscription_icon')">forum_get_discussion_subscription_icon</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>);
<a name="l3819"><span class="linenum">3819</span></a>              echo '&lt;/td&gt;';
<a name="l3820"><span class="linenum">3820</span></a>          }
<a name="l3821"><span class="linenum">3821</span></a>      }
<a name="l3822"><span class="linenum">3822</span></a>  
<a name="l3823"><span class="linenum">3823</span></a>      echo &quot;&lt;/tr&gt;\n\n&quot;;
<a name="l3824"><span class="linenum">3824</span></a>  
<a name="l3825"><span class="linenum">3825</span></a>  }
<a name="l3826"><span class="linenum">3826</span></a>  
<a name="l3827"><span class="linenum">3827</span></a>  <span class="comment">/**</span>
<a name="l3828"><span class="linenum">3828</span></a>  <span class="comment"> * Return the markup for the discussion subscription toggling icon.</span>
<a name="l3829"><span class="linenum">3829</span></a>  <span class="comment"> *</span>
<a name="l3830"><span class="linenum">3830</span></a>  <span class="comment"> * @param stdClass $forum The forum object.</span>
<a name="l3831"><span class="linenum">3831</span></a>  <span class="comment"> * @param int $discussionid The discussion to create an icon for.</span>
<a name="l3832"><span class="linenum">3832</span></a>  <span class="comment"> * @return string The generated markup.</span>
<a name="l3833"><span class="linenum">3833</span></a>  <span class="comment"> */</span>
<a name="l3834"><span class="linenum">3834</span></a>  function <a class="function" onClick="logFunction('forum_get_discussion_subscription_icon')" href="../../_functions/forum_get_discussion_subscription_icon.html" onMouseOver="funcPopup(event,'forum_get_discussion_subscription_icon')">forum_get_discussion_subscription_icon</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>, <a class="var it1440" onMouseOver="hilite(1440)" onMouseOut="lolite()" onClick="logVariable('returnurl')" href="../../_variables/returnurl.html">$returnurl</a> = null, <a class="var it16126" onMouseOver="hilite(16126)" onMouseOut="lolite()" onClick="logVariable('includetext')" href="../../_variables/includetext.html">$includetext</a> = false) {
<a name="l3835"><span class="linenum">3835</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>;
<a name="l3836"><span class="linenum">3836</span></a>  
<a name="l3837"><span class="linenum">3837</span></a>      if (<a class="var it1440" onMouseOver="hilite(1440)" onMouseOut="lolite()" onClick="logVariable('returnurl')" href="../../_variables/returnurl.html">$returnurl</a> === null &amp;&amp; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/url.html">url</a>) {
<a name="l3838"><span class="linenum">3838</span></a>          <a class="var it1440" onMouseOver="hilite(1440)" onMouseOut="lolite()" onClick="logVariable('returnurl')" href="../../_variables/returnurl.html">$returnurl</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/url.html">url</a>-&gt;<a class="function" onClick="logFunction('out')" href="../../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>();
<a name="l3839"><span class="linenum">3839</span></a>      }
<a name="l3840"><span class="linenum">3840</span></a>  
<a name="l3841"><span class="linenum">3841</span></a>      <a class="var it1491" onMouseOver="hilite(1491)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../_variables/o.html">$o</a> = '';
<a name="l3842"><span class="linenum">3842</span></a>      <a class="var it41597" onMouseOver="hilite(41597)" onMouseOut="lolite()" onClick="logVariable('subscriptionstatus')" href="../../_variables/subscriptionstatus.html">$subscriptionstatus</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_subscribed')" href="../../_functions/is_subscribed.html" onMouseOver="funcPopup(event,'is_subscribed')">is_subscribed</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>);
<a name="l3843"><span class="linenum">3843</span></a>      <a class="var it41598" onMouseOver="hilite(41598)" onMouseOut="lolite()" onClick="logVariable('subscriptionlink')" href="../../_variables/subscriptionlink.html">$subscriptionlink</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/subscribe.php.html">/mod/forum/subscribe.php</a>', array(
<a name="l3844"><span class="linenum">3844</span></a>          'sesskey' =&gt; <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>(),
<a name="l3845"><span class="linenum">3845</span></a>          'id' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l3846"><span class="linenum">3846</span></a>          'd' =&gt; <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>,
<a name="l3847"><span class="linenum">3847</span></a>          'returnurl' =&gt; <a class="var it1440" onMouseOver="hilite(1440)" onMouseOut="lolite()" onClick="logVariable('returnurl')" href="../../_variables/returnurl.html">$returnurl</a>,
<a name="l3848"><span class="linenum">3848</span></a>      ));
<a name="l3849"><span class="linenum">3849</span></a>  
<a name="l3850"><span class="linenum">3850</span></a>      if (<a class="var it16126" onMouseOver="hilite(16126)" onMouseOut="lolite()" onClick="logVariable('includetext')" href="../../_variables/includetext.html">$includetext</a>) {
<a name="l3851"><span class="linenum">3851</span></a>          <a class="var it1491" onMouseOver="hilite(1491)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../_variables/o.html">$o</a> .= <a class="var it41597" onMouseOver="hilite(41597)" onMouseOut="lolite()" onClick="logVariable('subscriptionstatus')" href="../../_variables/subscriptionstatus.html">$subscriptionstatus</a> ? <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscribed', 'mod_forum') : <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('notsubscribed', 'mod_forum');
<a name="l3852"><span class="linenum">3852</span></a>      }
<a name="l3853"><span class="linenum">3853</span></a>  
<a name="l3854"><span class="linenum">3854</span></a>      if (<a class="var it41597" onMouseOver="hilite(41597)" onMouseOut="lolite()" onClick="logVariable('subscriptionstatus')" href="../../_variables/subscriptionstatus.html">$subscriptionstatus</a>) {
<a name="l3855"><span class="linenum">3855</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_icon')" href="../../_functions/pix_icon.html" onMouseOver="funcPopup(event,'pix_icon')">pix_icon</a>('t/subscribed', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('clicktounsubscribe', 'forum'), 'mod_forum');
<a name="l3856"><span class="linenum">3856</span></a>          if (<a class="var it16126" onMouseOver="hilite(16126)" onMouseOut="lolite()" onClick="logVariable('includetext')" href="../../_variables/includetext.html">$includetext</a>) {
<a name="l3857"><span class="linenum">3857</span></a>              <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscribed', 'mod_forum');
<a name="l3858"><span class="linenum">3858</span></a>          }
<a name="l3859"><span class="linenum">3859</span></a>  
<a name="l3860"><span class="linenum">3860</span></a>          return <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it41598" onMouseOver="hilite(41598)" onMouseOut="lolite()" onClick="logVariable('subscriptionlink')" href="../../_variables/subscriptionlink.html">$subscriptionlink</a>, <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>, array(
<a name="l3861"><span class="linenum">3861</span></a>                  'title' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('clicktounsubscribe', 'forum'),
<a name="l3862"><span class="linenum">3862</span></a>                  'class' =&gt; 'discussiontoggle iconsmall',
<a name="l3863"><span class="linenum">3863</span></a>                  'data-forumid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l3864"><span class="linenum">3864</span></a>                  'data-discussionid' =&gt; <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>,
<a name="l3865"><span class="linenum">3865</span></a>                  'data-includetext' =&gt; <a class="var it16126" onMouseOver="hilite(16126)" onMouseOut="lolite()" onClick="logVariable('includetext')" href="../../_variables/includetext.html">$includetext</a>,
<a name="l3866"><span class="linenum">3866</span></a>              ));
<a name="l3867"><span class="linenum">3867</span></a>  
<a name="l3868"><span class="linenum">3868</span></a>      } else {
<a name="l3869"><span class="linenum">3869</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_icon')" href="../../_functions/pix_icon.html" onMouseOver="funcPopup(event,'pix_icon')">pix_icon</a>('t/unsubscribed', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('clicktosubscribe', 'forum'), 'mod_forum');
<a name="l3870"><span class="linenum">3870</span></a>          if (<a class="var it16126" onMouseOver="hilite(16126)" onMouseOut="lolite()" onClick="logVariable('includetext')" href="../../_variables/includetext.html">$includetext</a>) {
<a name="l3871"><span class="linenum">3871</span></a>              <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('notsubscribed', 'mod_forum');
<a name="l3872"><span class="linenum">3872</span></a>          }
<a name="l3873"><span class="linenum">3873</span></a>  
<a name="l3874"><span class="linenum">3874</span></a>          return <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it41598" onMouseOver="hilite(41598)" onMouseOut="lolite()" onClick="logVariable('subscriptionlink')" href="../../_variables/subscriptionlink.html">$subscriptionlink</a>, <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>, array(
<a name="l3875"><span class="linenum">3875</span></a>                  'title' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('clicktosubscribe', 'forum'),
<a name="l3876"><span class="linenum">3876</span></a>                  'class' =&gt; 'discussiontoggle iconsmall',
<a name="l3877"><span class="linenum">3877</span></a>                  'data-forumid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l3878"><span class="linenum">3878</span></a>                  'data-discussionid' =&gt; <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>,
<a name="l3879"><span class="linenum">3879</span></a>                  'data-includetext' =&gt; <a class="var it16126" onMouseOver="hilite(16126)" onMouseOut="lolite()" onClick="logVariable('includetext')" href="../../_variables/includetext.html">$includetext</a>,
<a name="l3880"><span class="linenum">3880</span></a>              ));
<a name="l3881"><span class="linenum">3881</span></a>      }
<a name="l3882"><span class="linenum">3882</span></a>  }
<a name="l3883"><span class="linenum">3883</span></a>  
<a name="l3884"><span class="linenum">3884</span></a>  <span class="comment">/**</span>
<a name="l3885"><span class="linenum">3885</span></a>  <span class="comment"> * Return a pair of spans containing classes to allow the subscribe and</span>
<a name="l3886"><span class="linenum">3886</span></a>  <span class="comment"> * unsubscribe icons to be pre-loaded by a browser.</span>
<a name="l3887"><span class="linenum">3887</span></a>  <span class="comment"> *</span>
<a name="l3888"><span class="linenum">3888</span></a>  <span class="comment"> * @return string The generated markup</span>
<a name="l3889"><span class="linenum">3889</span></a>  <span class="comment"> */</span>
<a name="l3890"><span class="linenum">3890</span></a>  function <a class="function" onClick="logFunction('forum_get_discussion_subscription_icon_preloaders')" href="../../_functions/forum_get_discussion_subscription_icon_preloaders.html" onMouseOver="funcPopup(event,'forum_get_discussion_subscription_icon_preloaders')">forum_get_discussion_subscription_icon_preloaders</a>() {
<a name="l3891"><span class="linenum">3891</span></a>      <a class="var it1491" onMouseOver="hilite(1491)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../_variables/o.html">$o</a> = '';
<a name="l3892"><span class="linenum">3892</span></a>      <a class="var it1491" onMouseOver="hilite(1491)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../_variables/o.html">$o</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('span')" href="../../_functions/span.html" onMouseOver="funcPopup(event,'span')">span</a>('&amp;nbsp;', 'preload-subscribe');
<a name="l3893"><span class="linenum">3893</span></a>      <a class="var it1491" onMouseOver="hilite(1491)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../_variables/o.html">$o</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('span')" href="../../_functions/span.html" onMouseOver="funcPopup(event,'span')">span</a>('&amp;nbsp;', 'preload-unsubscribe');
<a name="l3894"><span class="linenum">3894</span></a>      return <a class="var it1491" onMouseOver="hilite(1491)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../_variables/o.html">$o</a>;
<a name="l3895"><span class="linenum">3895</span></a>  }
<a name="l3896"><span class="linenum">3896</span></a>  
<a name="l3897"><span class="linenum">3897</span></a>  <span class="comment">/**</span>
<a name="l3898"><span class="linenum">3898</span></a>  <span class="comment"> * Print the drop down that allows the user to select how they want to have</span>
<a name="l3899"><span class="linenum">3899</span></a>  <span class="comment"> * the discussion displayed.</span>
<a name="l3900"><span class="linenum">3900</span></a>  <span class="comment"> *</span>
<a name="l3901"><span class="linenum">3901</span></a>  <span class="comment"> * @param int $id forum id if $forumtype is 'single',</span>
<a name="l3902"><span class="linenum">3902</span></a>  <span class="comment"> *              discussion id for any other forum type</span>
<a name="l3903"><span class="linenum">3903</span></a>  <span class="comment"> * @param mixed $mode forum layout mode</span>
<a name="l3904"><span class="linenum">3904</span></a>  <span class="comment"> * @param string $forumtype optional</span>
<a name="l3905"><span class="linenum">3905</span></a>  <span class="comment"> */</span>
<a name="l3906"><span class="linenum">3906</span></a>  function <a class="function" onClick="logFunction('forum_print_mode_form')" href="../../_functions/forum_print_mode_form.html" onMouseOver="funcPopup(event,'forum_print_mode_form')">forum_print_mode_form</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>, <a class="var it41528" onMouseOver="hilite(41528)" onMouseOut="lolite()" onClick="logVariable('forumtype')" href="../../_variables/forumtype.html">$forumtype</a>='') {
<a name="l3907"><span class="linenum">3907</span></a>      global <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l3908"><span class="linenum">3908</span></a>      if (<a class="var it41528" onMouseOver="hilite(41528)" onMouseOut="lolite()" onClick="logVariable('forumtype')" href="../../_variables/forumtype.html">$forumtype</a> == 'single') {
<a name="l3909"><span class="linenum">3909</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = <span class="keyword">new </span><a class="class" onClick="logClass('single_select')" href="../../_classes/single_select.html" onMouseOver="classPopup(event,'single_select')">single_select</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>("<a class="filename" href="../../mod/forum/view.php.html">/mod/forum/view.php</a>", array('f'=&gt;<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>)), 'mode', <a class="function" onClick="logFunction('forum_get_layout_modes')" href="../../_functions/forum_get_layout_modes.html" onMouseOver="funcPopup(event,'forum_get_layout_modes')">forum_get_layout_modes</a>(), <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>, null, &quot;mode&quot;);
<a name="l3910"><span class="linenum">3910</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>-&gt;<a class="function" onClick="logFunction('set_label')" href="../../_functions/set_label.html" onMouseOver="funcPopup(event,'set_label')">set_label</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('displaymode', 'forum'), array('class' =&gt; 'accesshide'));
<a name="l3911"><span class="linenum">3911</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>-&gt;<a onClick="logVariable('class')" class="var it43232" onMouseOver="hilite(43232)" onMouseOut="lolite()" href="../../_variables/class.html">class</a> = &quot;forummode&quot;;
<a name="l3912"><span class="linenum">3912</span></a>      } else {
<a name="l3913"><span class="linenum">3913</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = <span class="keyword">new </span><a class="class" onClick="logClass('single_select')" href="../../_classes/single_select.html" onMouseOver="classPopup(event,'single_select')">single_select</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>("<a class="filename" href="../../mod/forum/discuss.php.html">/mod/forum/discuss.php</a>", array('d'=&gt;<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>)), 'mode', <a class="function" onClick="logFunction('forum_get_layout_modes')" href="../../_functions/forum_get_layout_modes.html" onMouseOver="funcPopup(event,'forum_get_layout_modes')">forum_get_layout_modes</a>(), <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>, null, &quot;mode&quot;);
<a name="l3914"><span class="linenum">3914</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>-&gt;<a class="function" onClick="logFunction('set_label')" href="../../_functions/set_label.html" onMouseOver="funcPopup(event,'set_label')">set_label</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('displaymode', 'forum'), array('class' =&gt; 'accesshide'));
<a name="l3915"><span class="linenum">3915</span></a>      }
<a name="l3916"><span class="linenum">3916</span></a>      echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>);
<a name="l3917"><span class="linenum">3917</span></a>  }
<a name="l3918"><span class="linenum">3918</span></a>  
<a name="l3919"><span class="linenum">3919</span></a>  <span class="comment">/**</span>
<a name="l3920"><span class="linenum">3920</span></a>  <span class="comment"> * @global object</span>
<a name="l3921"><span class="linenum">3921</span></a>  <span class="comment"> * @param object $course</span>
<a name="l3922"><span class="linenum">3922</span></a>  <span class="comment"> * @param string $search</span>
<a name="l3923"><span class="linenum">3923</span></a>  <span class="comment"> * @return string</span>
<a name="l3924"><span class="linenum">3924</span></a>  <span class="comment"> */</span>
<a name="l3925"><span class="linenum">3925</span></a>  function <a class="function" onClick="logFunction('forum_search_form')" href="../../_functions/forum_search_form.html" onMouseOver="funcPopup(event,'forum_search_form')">forum_search_form</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it228" onMouseOver="hilite(228)" onMouseOut="lolite()" onClick="logVariable('search')" href="../../_variables/search.html">$search</a>='') {
<a name="l3926"><span class="linenum">3926</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l3927"><span class="linenum">3927</span></a>  
<a name="l3928"><span class="linenum">3928</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>  = '&lt;div class=&quot;forumsearch&quot;&gt;';
<a name="l3929"><span class="linenum">3929</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;form action=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/search.php&quot; style=&quot;display:inline&quot;&gt;';
<a name="l3930"><span class="linenum">3930</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;fieldset class=&quot;invisiblefieldset&quot;&gt;';
<a name="l3931"><span class="linenum">3931</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('help_icon')" href="../../_functions/help_icon.html" onMouseOver="funcPopup(event,'help_icon')">help_icon</a>('search');
<a name="l3932"><span class="linenum">3932</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;label class=&quot;accesshide&quot; for=&quot;search&quot; &gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('search', 'forum').'&lt;/label&gt;';
<a name="l3933"><span class="linenum">3933</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;input id=&quot;search&quot; name=&quot;search&quot; type=&quot;text&quot; size=&quot;18&quot; value=&quot;'.<a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="var it228" onMouseOver="hilite(228)" onMouseOut="lolite()" onClick="logVariable('search')" href="../../_variables/search.html">$search</a>, true).'&quot; /&gt;';
<a name="l3934"><span class="linenum">3934</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;label class=&quot;accesshide&quot; for=&quot;searchforums&quot; &gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('searchforums', 'forum').'&lt;/label&gt;';
<a name="l3935"><span class="linenum">3935</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;input id=&quot;searchforums&quot; value=&quot;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('searchforums', 'forum').'&quot; type=&quot;submit&quot; /&gt;';
<a name="l3936"><span class="linenum">3936</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;input name=&quot;id&quot; type=&quot;hidden&quot; value=&quot;'.<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'&quot; /&gt;';
<a name="l3937"><span class="linenum">3937</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;/fieldset&gt;';
<a name="l3938"><span class="linenum">3938</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;/form&gt;';
<a name="l3939"><span class="linenum">3939</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;/div&gt;';
<a name="l3940"><span class="linenum">3940</span></a>  
<a name="l3941"><span class="linenum">3941</span></a>      return <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l3942"><span class="linenum">3942</span></a>  }
<a name="l3943"><span class="linenum">3943</span></a>  
<a name="l3944"><span class="linenum">3944</span></a>  
<a name="l3945"><span class="linenum">3945</span></a>  <span class="comment">/**</span>
<a name="l3946"><span class="linenum">3946</span></a>  <span class="comment"> * @global object</span>
<a name="l3947"><span class="linenum">3947</span></a>  <span class="comment"> * @global object</span>
<a name="l3948"><span class="linenum">3948</span></a>  <span class="comment"> */</span>
<a name="l3949"><span class="linenum">3949</span></a>  function <a class="function" onClick="logFunction('forum_set_return')" href="../../_functions/forum_set_return.html" onMouseOver="funcPopup(event,'forum_set_return')">forum_set_return</a>() {
<a name="l3950"><span class="linenum">3950</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>;
<a name="l3951"><span class="linenum">3951</span></a>  
<a name="l3952"><span class="linenum">3952</span></a>      if (! isset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('fromdiscussion')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/fromdiscussion.html">fromdiscussion</a>)) {
<a name="l3953"><span class="linenum">3953</span></a>          <a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../../_variables/referer.html">$referer</a> = <a class="function" onClick="logFunction('get_local_referer')" href="../../_functions/get_local_referer.html" onMouseOver="funcPopup(event,'get_local_referer')">get_local_referer</a>(false);
<a name="l3954"><span class="linenum">3954</span></a>  <span class="comment">        // If the referer is NOT a login screen then save it.</span>
<a name="l3955"><span class="linenum">3955</span></a>          if (! <a class="phpfunction" onClick="logFunction('strncasecmp')" href="../../_functions/strncasecmp.html" onMouseOver="phpfuncPopup(event,'strncasecmp')">strncasecmp</a>(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/login&quot;, <a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../../_variables/referer.html">$referer</a>, 300)) {
<a name="l3956"><span class="linenum">3956</span></a>              <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('fromdiscussion')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/fromdiscussion.html">fromdiscussion</a> = <a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../../_variables/referer.html">$referer</a>;
<a name="l3957"><span class="linenum">3957</span></a>          }
<a name="l3958"><span class="linenum">3958</span></a>      }
<a name="l3959"><span class="linenum">3959</span></a>  }
<a name="l3960"><span class="linenum">3960</span></a>  
<a name="l3961"><span class="linenum">3961</span></a>  
<a name="l3962"><span class="linenum">3962</span></a>  <span class="comment">/**</span>
<a name="l3963"><span class="linenum">3963</span></a>  <span class="comment"> * @global object</span>
<a name="l3964"><span class="linenum">3964</span></a>  <span class="comment"> * @param string|\moodle_url $default</span>
<a name="l3965"><span class="linenum">3965</span></a>  <span class="comment"> * @return string</span>
<a name="l3966"><span class="linenum">3966</span></a>  <span class="comment"> */</span>
<a name="l3967"><span class="linenum">3967</span></a>  function <a class="function" onClick="logFunction('forum_go_back_to')" href="../../_functions/forum_go_back_to.html" onMouseOver="funcPopup(event,'forum_go_back_to')">forum_go_back_to</a>(<a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a>) {
<a name="l3968"><span class="linenum">3968</span></a>      global <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>;
<a name="l3969"><span class="linenum">3969</span></a>  
<a name="l3970"><span class="linenum">3970</span></a>      if (!empty(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('fromdiscussion')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/fromdiscussion.html">fromdiscussion</a>)) {
<a name="l3971"><span class="linenum">3971</span></a>          <a class="var it510" onMouseOver="hilite(510)" onMouseOut="lolite()" onClick="logVariable('returnto')" href="../../_variables/returnto.html">$returnto</a> = <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('fromdiscussion')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/fromdiscussion.html">fromdiscussion</a>;
<a name="l3972"><span class="linenum">3972</span></a>          unset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('fromdiscussion')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/fromdiscussion.html">fromdiscussion</a>);
<a name="l3973"><span class="linenum">3973</span></a>          return <a class="var it510" onMouseOver="hilite(510)" onMouseOut="lolite()" onClick="logVariable('returnto')" href="../../_variables/returnto.html">$returnto</a>;
<a name="l3974"><span class="linenum">3974</span></a>      } else {
<a name="l3975"><span class="linenum">3975</span></a>          return <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a>;
<a name="l3976"><span class="linenum">3976</span></a>      }
<a name="l3977"><span class="linenum">3977</span></a>  }
<a name="l3978"><span class="linenum">3978</span></a>  
<a name="l3979"><span class="linenum">3979</span></a>  <span class="comment">/**</span>
<a name="l3980"><span class="linenum">3980</span></a>  <span class="comment"> * Given a discussion object that is being moved to $forumto,</span>
<a name="l3981"><span class="linenum">3981</span></a>  <span class="comment"> * this function checks all posts in that discussion</span>
<a name="l3982"><span class="linenum">3982</span></a>  <span class="comment"> * for attachments, and if any are found, these are</span>
<a name="l3983"><span class="linenum">3983</span></a>  <span class="comment"> * moved to the new forum directory.</span>
<a name="l3984"><span class="linenum">3984</span></a>  <span class="comment"> *</span>
<a name="l3985"><span class="linenum">3985</span></a>  <span class="comment"> * @global object</span>
<a name="l3986"><span class="linenum">3986</span></a>  <span class="comment"> * @param object $discussion</span>
<a name="l3987"><span class="linenum">3987</span></a>  <span class="comment"> * @param int $forumfrom source forum id</span>
<a name="l3988"><span class="linenum">3988</span></a>  <span class="comment"> * @param int $forumto target forum id</span>
<a name="l3989"><span class="linenum">3989</span></a>  <span class="comment"> * @return bool success</span>
<a name="l3990"><span class="linenum">3990</span></a>  <span class="comment"> */</span>
<a name="l3991"><span class="linenum">3991</span></a>  function <a class="function" onClick="logFunction('forum_move_attachments')" href="../../_functions/forum_move_attachments.html" onMouseOver="funcPopup(event,'forum_move_attachments')">forum_move_attachments</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it41599" onMouseOver="hilite(41599)" onMouseOut="lolite()" onClick="logVariable('forumfrom')" href="../../_variables/forumfrom.html">$forumfrom</a>, <a class="var it24362" onMouseOver="hilite(24362)" onMouseOut="lolite()" onClick="logVariable('forumto')" href="../../_variables/forumto.html">$forumto</a>) {
<a name="l3992"><span class="linenum">3992</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l3993"><span class="linenum">3993</span></a>  
<a name="l3994"><span class="linenum">3994</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l3995"><span class="linenum">3995</span></a>  
<a name="l3996"><span class="linenum">3996</span></a>      <a class="var it21179" onMouseOver="hilite(21179)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../../_variables/newcm.html">$newcm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it24362" onMouseOver="hilite(24362)" onMouseOut="lolite()" onClick="logVariable('forumto')" href="../../_variables/forumto.html">$forumto</a>);
<a name="l3997"><span class="linenum">3997</span></a>      <a class="var it41600" onMouseOver="hilite(41600)" onMouseOut="lolite()" onClick="logVariable('oldcm')" href="../../_variables/oldcm.html">$oldcm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it41599" onMouseOver="hilite(41599)" onMouseOut="lolite()" onClick="logVariable('forumfrom')" href="../../_variables/forumfrom.html">$forumfrom</a>);
<a name="l3998"><span class="linenum">3998</span></a>  
<a name="l3999"><span class="linenum">3999</span></a>      <a class="var it12558" onMouseOver="hilite(12558)" onMouseOut="lolite()" onClick="logVariable('newcontext')" href="../../_variables/newcontext.html">$newcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it21179" onMouseOver="hilite(21179)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('id')" class="var it43923" onMouseOver="hilite(43923)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4000"><span class="linenum">4000</span></a>      <a class="var it7759" onMouseOver="hilite(7759)" onMouseOut="lolite()" onClick="logVariable('oldcontext')" href="../../_variables/oldcontext.html">$oldcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it41600" onMouseOver="hilite(41600)" onMouseOut="lolite()" onClick="logVariable('oldcm')" href="../../_variables/oldcm.html">$oldcm</a>-&gt;<a onClick="logVariable('id')" class="var it44623" onMouseOver="hilite(44623)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4001"><span class="linenum">4001</span></a>  
<a name="l4002"><span class="linenum">4002</span></a>  <span class="comment">    // loop through all posts, better not use attachment flag ;-)</span>
<a name="l4003"><span class="linenum">4003</span></a>      if (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('forum_posts', array('discussion'=&gt;<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), '', 'id, attachment')) {
<a name="l4004"><span class="linenum">4004</span></a>          foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l4005"><span class="linenum">4005</span></a>              <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('move_area_files_to_new_context')" href="../../_functions/move_area_files_to_new_context.html" onMouseOver="funcPopup(event,'move_area_files_to_new_context')">move_area_files_to_new_context</a>(<a class="var it7759" onMouseOver="hilite(7759)" onMouseOut="lolite()" onClick="logVariable('oldcontext')" href="../../_variables/oldcontext.html">$oldcontext</a>-&gt;<a onClick="logVariable('id')" class="var it43400" onMouseOver="hilite(43400)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4006"><span class="linenum">4006</span></a>                      <a class="var it12558" onMouseOver="hilite(12558)" onMouseOut="lolite()" onClick="logVariable('newcontext')" href="../../_variables/newcontext.html">$newcontext</a>-&gt;<a onClick="logVariable('id')" class="var it44345" onMouseOver="hilite(44345)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'post', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4007"><span class="linenum">4007</span></a>              <a class="var it41601" onMouseOver="hilite(41601)" onMouseOut="lolite()" onClick="logVariable('attachmentsmoved')" href="../../_variables/attachmentsmoved.html">$attachmentsmoved</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('move_area_files_to_new_context')" href="../../_functions/move_area_files_to_new_context.html" onMouseOver="funcPopup(event,'move_area_files_to_new_context')">move_area_files_to_new_context</a>(<a class="var it7759" onMouseOver="hilite(7759)" onMouseOut="lolite()" onClick="logVariable('oldcontext')" href="../../_variables/oldcontext.html">$oldcontext</a>-&gt;<a onClick="logVariable('id')" class="var it43400" onMouseOver="hilite(43400)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4008"><span class="linenum">4008</span></a>                      <a class="var it12558" onMouseOver="hilite(12558)" onMouseOut="lolite()" onClick="logVariable('newcontext')" href="../../_variables/newcontext.html">$newcontext</a>-&gt;<a onClick="logVariable('id')" class="var it44345" onMouseOver="hilite(44345)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'attachment', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4009"><span class="linenum">4009</span></a>              if (<a class="var it41601" onMouseOver="hilite(41601)" onMouseOut="lolite()" onClick="logVariable('attachmentsmoved')" href="../../_variables/attachmentsmoved.html">$attachmentsmoved</a> &gt; 0 &amp;&amp; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachment')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachment.html">attachment</a> != '1') {
<a name="l4010"><span class="linenum">4010</span></a>  <span class="comment">                // Weird - let's fix it</span>
<a name="l4011"><span class="linenum">4011</span></a>                  <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachment')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachment.html">attachment</a> = '1';
<a name="l4012"><span class="linenum">4012</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_posts', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>);
<a name="l4013"><span class="linenum">4013</span></a>              } else if (<a class="var it41601" onMouseOver="hilite(41601)" onMouseOut="lolite()" onClick="logVariable('attachmentsmoved')" href="../../_variables/attachmentsmoved.html">$attachmentsmoved</a> == 0 &amp;&amp; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachment')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachment.html">attachment</a> != '') {
<a name="l4014"><span class="linenum">4014</span></a>  <span class="comment">                // Weird - let's fix it</span>
<a name="l4015"><span class="linenum">4015</span></a>                  <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachment')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachment.html">attachment</a> = '';
<a name="l4016"><span class="linenum">4016</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_posts', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>);
<a name="l4017"><span class="linenum">4017</span></a>              }
<a name="l4018"><span class="linenum">4018</span></a>          }
<a name="l4019"><span class="linenum">4019</span></a>      }
<a name="l4020"><span class="linenum">4020</span></a>  
<a name="l4021"><span class="linenum">4021</span></a>      return true;
<a name="l4022"><span class="linenum">4022</span></a>  }
<a name="l4023"><span class="linenum">4023</span></a>  
<a name="l4024"><span class="linenum">4024</span></a>  <span class="comment">/**</span>
<a name="l4025"><span class="linenum">4025</span></a>  <span class="comment"> * Returns attachments as formated text/html optionally with separate images</span>
<a name="l4026"><span class="linenum">4026</span></a>  <span class="comment"> *</span>
<a name="l4027"><span class="linenum">4027</span></a>  <span class="comment"> * @global object</span>
<a name="l4028"><span class="linenum">4028</span></a>  <span class="comment"> * @global object</span>
<a name="l4029"><span class="linenum">4029</span></a>  <span class="comment"> * @global object</span>
<a name="l4030"><span class="linenum">4030</span></a>  <span class="comment"> * @param object $post</span>
<a name="l4031"><span class="linenum">4031</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l4032"><span class="linenum">4032</span></a>  <span class="comment"> * @param string $type html/text/separateimages</span>
<a name="l4033"><span class="linenum">4033</span></a>  <span class="comment"> * @return mixed string or array of (html text withouth images and image HTML)</span>
<a name="l4034"><span class="linenum">4034</span></a>  <span class="comment"> */</span>
<a name="l4035"><span class="linenum">4035</span></a>  function <a class="function" onClick="logFunction('forum_print_attachments')" href="../../_functions/forum_print_attachments.html" onMouseOver="funcPopup(event,'forum_print_attachments')">forum_print_attachments</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l4036"><span class="linenum">4036</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l4037"><span class="linenum">4037</span></a>  
<a name="l4038"><span class="linenum">4038</span></a>      if (empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachment')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachment.html">attachment</a>)) {
<a name="l4039"><span class="linenum">4039</span></a>          return <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> !== 'separateimages' ? '' : array('', '');
<a name="l4040"><span class="linenum">4040</span></a>      }
<a name="l4041"><span class="linenum">4041</span></a>  
<a name="l4042"><span class="linenum">4042</span></a>      if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>, array('separateimages', 'html', 'text'))) {
<a name="l4043"><span class="linenum">4043</span></a>          return <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> !== 'separateimages' ? '' : array('', '');
<a name="l4044"><span class="linenum">4044</span></a>      }
<a name="l4045"><span class="linenum">4045</span></a>  
<a name="l4046"><span class="linenum">4046</span></a>      if (!<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l4047"><span class="linenum">4047</span></a>          return <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> !== 'separateimages' ? '' : array('', '');
<a name="l4048"><span class="linenum">4048</span></a>      }
<a name="l4049"><span class="linenum">4049</span></a>      <a class="var it12607" onMouseOver="hilite(12607)" onMouseOut="lolite()" onClick="logVariable('strattachment')" href="../../_variables/strattachment.html">$strattachment</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('attachment', 'forum');
<a name="l4050"><span class="linenum">4050</span></a>  
<a name="l4051"><span class="linenum">4051</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l4052"><span class="linenum">4052</span></a>  
<a name="l4053"><span class="linenum">4053</span></a>      <a class="var it12608" onMouseOver="hilite(12608)" onMouseOut="lolite()" onClick="logVariable('imagereturn')" href="../../_variables/imagereturn.html">$imagereturn</a> = '';
<a name="l4054"><span class="linenum">4054</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = '';
<a name="l4055"><span class="linenum">4055</span></a>  
<a name="l4056"><span class="linenum">4056</span></a>      <a class="var it40409" onMouseOver="hilite(40409)" onMouseOut="lolite()" onClick="logVariable('canexport')" href="../../_variables/canexport.html">$canexport</a> = !empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableportfolios')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/enableportfolios.html">enableportfolios</a>) &amp;&amp; (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:exportpost', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) || (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> == <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:exportownpost', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)));
<a name="l4057"><span class="linenum">4057</span></a>  
<a name="l4058"><span class="linenum">4058</span></a>      if (<a class="var it40409" onMouseOver="hilite(40409)" onMouseOut="lolite()" onClick="logVariable('canexport')" href="../../_variables/canexport.html">$canexport</a>) {
<a name="l4059"><span class="linenum">4059</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/portfoliolib.php');
<a name="l4060"><span class="linenum">4060</span></a>      }
<a name="l4061"><span class="linenum">4061</span></a>  
<a name="l4062"><span class="linenum">4062</span></a>  <span class="comment">    // We retrieve all files according to the time that they were created.  In the case that several files were uploaded</span>
<a name="l4063"><span class="linenum">4063</span></a>  <span class="comment">    // at the sametime (e.g. in the case of drag/drop upload) we revert to using the filename.</span>
<a name="l4064"><span class="linenum">4064</span></a>      <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'attachment', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, &quot;filename&quot;, false);
<a name="l4065"><span class="linenum">4065</span></a>      if (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>) {
<a name="l4066"><span class="linenum">4066</span></a>          if (<a class="var it40409" onMouseOver="hilite(40409)" onMouseOut="lolite()" onClick="logVariable('canexport')" href="../../_variables/canexport.html">$canexport</a>) {
<a name="l4067"><span class="linenum">4067</span></a>              <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a> = <span class="keyword">new </span><a class="class" onClick="logClass('portfolio_add_button')" href="../../_classes/portfolio_add_button.html" onMouseOver="classPopup(event,'portfolio_add_button')">portfolio_add_button</a>();
<a name="l4068"><span class="linenum">4068</span></a>          }
<a name="l4069"><span class="linenum">4069</span></a>          foreach (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> as <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>) {
<a name="l4070"><span class="linenum">4070</span></a>              <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>();
<a name="l4071"><span class="linenum">4071</span></a>              <a class="var it3340" onMouseOver="hilite(3340)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_mimetype')" href="../../_functions/get_mimetype.html" onMouseOver="funcPopup(event,'get_mimetype')">get_mimetype</a>();
<a name="l4072"><span class="linenum">4072</span></a>              <a class="var it12609" onMouseOver="hilite(12609)" onMouseOut="lolite()" onClick="logVariable('iconimage')" href="../../_variables/iconimage.html">$iconimage</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_icon')" href="../../_functions/pix_icon.html" onMouseOver="funcPopup(event,'pix_icon')">pix_icon</a>(<a class="function" onClick="logFunction('file_file_icon')" href="../../_functions/file_file_icon.html" onMouseOver="funcPopup(event,'file_file_icon')">file_file_icon</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>), <a class="function" onClick="logFunction('get_mimetype_description')" href="../../_functions/get_mimetype_description.html" onMouseOver="funcPopup(event,'get_mimetype_description')">get_mimetype_description</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>), 'moodle', array('class' =&gt; 'icon'));
<a name="l4073"><span class="linenum">4073</span></a>              <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a> = <a class="function" onClick="logFunction('file_encode_url')" href="../../_functions/file_encode_url.html" onMouseOver="funcPopup(event,'file_encode_url')">file_encode_url</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'<a class="filename" href="../../pluginfile.php.html">/pluginfile.php</a>', '/'.<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'/mod_forum/attachment/'.<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'/'.<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l4074"><span class="linenum">4074</span></a>  
<a name="l4075"><span class="linenum">4075</span></a>              if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> == 'html') {
<a name="l4076"><span class="linenum">4076</span></a>                  <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= &quot;&lt;a href=\&quot;<a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a>\&quot;&gt;<a class="var it12609" onMouseOver="hilite(12609)" onMouseOut="lolite()" onClick="logVariable('iconimage')" href="../../_variables/iconimage.html">$iconimage</a>&lt;/a&gt; &quot;;
<a name="l4077"><span class="linenum">4077</span></a>                  <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= &quot;&lt;a href=\&quot;<a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a>\&quot;&gt;&quot;.<a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>).&quot;&lt;/a&gt;&quot;;
<a name="l4078"><span class="linenum">4078</span></a>                  if (<a class="var it40409" onMouseOver="hilite(40409)" onMouseOut="lolite()" onClick="logVariable('canexport')" href="../../_variables/canexport.html">$canexport</a>) {
<a name="l4079"><span class="linenum">4079</span></a>                      <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('set_callback_options')" href="../../_functions/set_callback_options.html" onMouseOver="funcPopup(event,'set_callback_options')">set_callback_options</a>('forum_portfolio_caller', array('postid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'attachment' =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()), 'mod_forum');
<a name="l4080"><span class="linenum">4080</span></a>                      <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('set_format_by_file')" href="../../_functions/set_format_by_file.html" onMouseOver="funcPopup(event,'set_format_by_file')">set_format_by_file</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>);
<a name="l4081"><span class="linenum">4081</span></a>                      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('to_html')" href="../../_functions/to_html.html" onMouseOver="funcPopup(event,'to_html')">to_html</a>(<a class="constant" onClick="logConstant('PORTFOLIO_ADD_ICON_LINK')" href="../../_constants/PORTFOLIO_ADD_ICON_LINK.html" onMouseOver="constPopup(event,'PORTFOLIO_ADD_ICON_LINK')">PORTFOLIO_ADD_ICON_LINK</a>);
<a name="l4082"><span class="linenum">4082</span></a>                  }
<a name="l4083"><span class="linenum">4083</span></a>                  <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= &quot;&lt;br /&gt;&quot;;
<a name="l4084"><span class="linenum">4084</span></a>  
<a name="l4085"><span class="linenum">4085</span></a>              } else if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> == 'text') {
<a name="l4086"><span class="linenum">4086</span></a>                  <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= &quot;<a class="var it12607" onMouseOver="hilite(12607)" onMouseOut="lolite()" onClick="logVariable('strattachment')" href="../../_variables/strattachment.html">$strattachment</a> &quot;.<a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>).&quot;:\n<a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a>\n&quot;;
<a name="l4087"><span class="linenum">4087</span></a>  
<a name="l4088"><span class="linenum">4088</span></a>              } else { //'returnimages'
<a name="l4089"><span class="linenum">4089</span></a>                  if (<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it3340" onMouseOver="hilite(3340)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>, array('image/gif', 'image/jpeg', 'image/png'))) {
<a name="l4090"><span class="linenum">4090</span></a>  <span class="comment">                    // Image attachments don't get printed as links</span>
<a name="l4091"><span class="linenum">4091</span></a>                      <a class="var it12608" onMouseOver="hilite(12608)" onMouseOut="lolite()" onClick="logVariable('imagereturn')" href="../../_variables/imagereturn.html">$imagereturn</a> .= &quot;&lt;br /&gt;&lt;img src=\&quot;<a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a>\&quot; alt=\&quot;\&quot; /&gt;&quot;;
<a name="l4092"><span class="linenum">4092</span></a>                      if (<a class="var it40409" onMouseOver="hilite(40409)" onMouseOut="lolite()" onClick="logVariable('canexport')" href="../../_variables/canexport.html">$canexport</a>) {
<a name="l4093"><span class="linenum">4093</span></a>                          <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('set_callback_options')" href="../../_functions/set_callback_options.html" onMouseOver="funcPopup(event,'set_callback_options')">set_callback_options</a>('forum_portfolio_caller', array('postid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'attachment' =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()), 'mod_forum');
<a name="l4094"><span class="linenum">4094</span></a>                          <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('set_format_by_file')" href="../../_functions/set_format_by_file.html" onMouseOver="funcPopup(event,'set_format_by_file')">set_format_by_file</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>);
<a name="l4095"><span class="linenum">4095</span></a>                          <a class="var it12608" onMouseOver="hilite(12608)" onMouseOut="lolite()" onClick="logVariable('imagereturn')" href="../../_variables/imagereturn.html">$imagereturn</a> .= <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('to_html')" href="../../_functions/to_html.html" onMouseOver="funcPopup(event,'to_html')">to_html</a>(<a class="constant" onClick="logConstant('PORTFOLIO_ADD_ICON_LINK')" href="../../_constants/PORTFOLIO_ADD_ICON_LINK.html" onMouseOver="constPopup(event,'PORTFOLIO_ADD_ICON_LINK')">PORTFOLIO_ADD_ICON_LINK</a>);
<a name="l4096"><span class="linenum">4096</span></a>                      }
<a name="l4097"><span class="linenum">4097</span></a>                  } else {
<a name="l4098"><span class="linenum">4098</span></a>                      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= &quot;&lt;a href=\&quot;<a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a>\&quot;&gt;<a class="var it12609" onMouseOver="hilite(12609)" onMouseOut="lolite()" onClick="logVariable('iconimage')" href="../../_variables/iconimage.html">$iconimage</a>&lt;/a&gt; &quot;;
<a name="l4099"><span class="linenum">4099</span></a>                      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="function" onClick="logFunction('format_text')" href="../../_functions/format_text.html" onMouseOver="funcPopup(event,'format_text')">format_text</a>(&quot;&lt;a href=\&quot;<a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a>\&quot;&gt;&quot;.<a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>).&quot;&lt;/a&gt;&quot;, <a class="constant" onClick="logConstant('FORMAT_HTML')" href="../../_constants/FORMAT_HTML.html" onMouseOver="constPopup(event,'FORMAT_HTML')">FORMAT_HTML</a>, array('context'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>));
<a name="l4100"><span class="linenum">4100</span></a>                      if (<a class="var it40409" onMouseOver="hilite(40409)" onMouseOut="lolite()" onClick="logVariable('canexport')" href="../../_variables/canexport.html">$canexport</a>) {
<a name="l4101"><span class="linenum">4101</span></a>                          <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('set_callback_options')" href="../../_functions/set_callback_options.html" onMouseOver="funcPopup(event,'set_callback_options')">set_callback_options</a>('forum_portfolio_caller', array('postid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'attachment' =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()), 'mod_forum');
<a name="l4102"><span class="linenum">4102</span></a>                          <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('set_format_by_file')" href="../../_functions/set_format_by_file.html" onMouseOver="funcPopup(event,'set_format_by_file')">set_format_by_file</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>);
<a name="l4103"><span class="linenum">4103</span></a>                          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="var it2196" onMouseOver="hilite(2196)" onMouseOut="lolite()" onClick="logVariable('button')" href="../../_variables/button.html">$button</a>-&gt;<a class="function" onClick="logFunction('to_html')" href="../../_functions/to_html.html" onMouseOver="funcPopup(event,'to_html')">to_html</a>(<a class="constant" onClick="logConstant('PORTFOLIO_ADD_ICON_LINK')" href="../../_constants/PORTFOLIO_ADD_ICON_LINK.html" onMouseOver="constPopup(event,'PORTFOLIO_ADD_ICON_LINK')">PORTFOLIO_ADD_ICON_LINK</a>);
<a name="l4104"><span class="linenum">4104</span></a>                      }
<a name="l4105"><span class="linenum">4105</span></a>                      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;br /&gt;';
<a name="l4106"><span class="linenum">4106</span></a>                  }
<a name="l4107"><span class="linenum">4107</span></a>              }
<a name="l4108"><span class="linenum">4108</span></a>  
<a name="l4109"><span class="linenum">4109</span></a>              if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableplagiarism')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/enableplagiarism.html">enableplagiarism</a>)) {
<a name="l4110"><span class="linenum">4110</span></a>                  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/plagiarismlib.php');
<a name="l4111"><span class="linenum">4111</span></a>                  <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="function" onClick="logFunction('plagiarism_get_links')" href="../../_functions/plagiarism_get_links.html" onMouseOver="funcPopup(event,'plagiarism_get_links')">plagiarism_get_links</a>(array('userid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>,
<a name="l4112"><span class="linenum">4112</span></a>                      'file' =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>,
<a name="l4113"><span class="linenum">4113</span></a>                      'cmid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4114"><span class="linenum">4114</span></a>                      'course' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>,
<a name="l4115"><span class="linenum">4115</span></a>                      'forum' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>));
<a name="l4116"><span class="linenum">4116</span></a>                  <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= '&lt;br /&gt;';
<a name="l4117"><span class="linenum">4117</span></a>              }
<a name="l4118"><span class="linenum">4118</span></a>          }
<a name="l4119"><span class="linenum">4119</span></a>      }
<a name="l4120"><span class="linenum">4120</span></a>  
<a name="l4121"><span class="linenum">4121</span></a>      if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> !== 'separateimages') {
<a name="l4122"><span class="linenum">4122</span></a>          return <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l4123"><span class="linenum">4123</span></a>  
<a name="l4124"><span class="linenum">4124</span></a>      } else {
<a name="l4125"><span class="linenum">4125</span></a>          return array(<a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>, <a class="var it12608" onMouseOver="hilite(12608)" onMouseOut="lolite()" onClick="logVariable('imagereturn')" href="../../_variables/imagereturn.html">$imagereturn</a>);
<a name="l4126"><span class="linenum">4126</span></a>      }
<a name="l4127"><span class="linenum">4127</span></a>  }
<a name="l4128"><span class="linenum">4128</span></a>  
<a name="l4129"><span class="linenum">4129</span></a>  <span class="comment">////////////////////////////////////////////////////////////////////////////////</span>
<a name="l4130"><span class="linenum">4130</span></a>  <span class="comment">// File API                                                                   //</span>
<a name="l4131"><span class="linenum">4131</span></a>  <span class="comment">////////////////////////////////////////////////////////////////////////////////</span>
<a name="l4132"><span class="linenum">4132</span></a>  
<a name="l4133"><span class="linenum">4133</span></a>  <span class="comment">/**</span>
<a name="l4134"><span class="linenum">4134</span></a>  <span class="comment"> * Lists all browsable file areas</span>
<a name="l4135"><span class="linenum">4135</span></a>  <span class="comment"> *</span>
<a name="l4136"><span class="linenum">4136</span></a>  <span class="comment"> * @package  mod_forum</span>
<a name="l4137"><span class="linenum">4137</span></a>  <span class="comment"> * @category files</span>
<a name="l4138"><span class="linenum">4138</span></a>  <span class="comment"> * @param stdClass $course course object</span>
<a name="l4139"><span class="linenum">4139</span></a>  <span class="comment"> * @param stdClass $cm course module object</span>
<a name="l4140"><span class="linenum">4140</span></a>  <span class="comment"> * @param stdClass $context context object</span>
<a name="l4141"><span class="linenum">4141</span></a>  <span class="comment"> * @return array</span>
<a name="l4142"><span class="linenum">4142</span></a>  <span class="comment"> */</span>
<a name="l4143"><span class="linenum">4143</span></a>  function <a class="function" onClick="logFunction('forum_get_file_areas')" href="../../_functions/forum_get_file_areas.html" onMouseOver="funcPopup(event,'forum_get_file_areas')">forum_get_file_areas</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l4144"><span class="linenum">4144</span></a>      return array(
<a name="l4145"><span class="linenum">4145</span></a>          'attachment' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('areaattachment', 'mod_forum'),
<a name="l4146"><span class="linenum">4146</span></a>          'post' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('areapost', 'mod_forum'),
<a name="l4147"><span class="linenum">4147</span></a>      );
<a name="l4148"><span class="linenum">4148</span></a>  }
<a name="l4149"><span class="linenum">4149</span></a>  
<a name="l4150"><span class="linenum">4150</span></a>  <span class="comment">/**</span>
<a name="l4151"><span class="linenum">4151</span></a>  <span class="comment"> * File browsing support for forum module.</span>
<a name="l4152"><span class="linenum">4152</span></a>  <span class="comment"> *</span>
<a name="l4153"><span class="linenum">4153</span></a>  <span class="comment"> * @package  mod_forum</span>
<a name="l4154"><span class="linenum">4154</span></a>  <span class="comment"> * @category files</span>
<a name="l4155"><span class="linenum">4155</span></a>  <span class="comment"> * @param stdClass $browser file browser object</span>
<a name="l4156"><span class="linenum">4156</span></a>  <span class="comment"> * @param stdClass $areas file areas</span>
<a name="l4157"><span class="linenum">4157</span></a>  <span class="comment"> * @param stdClass $course course object</span>
<a name="l4158"><span class="linenum">4158</span></a>  <span class="comment"> * @param stdClass $cm course module</span>
<a name="l4159"><span class="linenum">4159</span></a>  <span class="comment"> * @param stdClass $context context module</span>
<a name="l4160"><span class="linenum">4160</span></a>  <span class="comment"> * @param string $filearea file area</span>
<a name="l4161"><span class="linenum">4161</span></a>  <span class="comment"> * @param int $itemid item ID</span>
<a name="l4162"><span class="linenum">4162</span></a>  <span class="comment"> * @param string $filepath file path</span>
<a name="l4163"><span class="linenum">4163</span></a>  <span class="comment"> * @param string $filename file name</span>
<a name="l4164"><span class="linenum">4164</span></a>  <span class="comment"> * @return file_info instance or null if not found</span>
<a name="l4165"><span class="linenum">4165</span></a>  <span class="comment"> */</span>
<a name="l4166"><span class="linenum">4166</span></a>  function <a class="function" onClick="logFunction('forum_get_file_info')" href="../../_functions/forum_get_file_info.html" onMouseOver="funcPopup(event,'forum_get_file_info')">forum_get_file_info</a>(<a class="var it1462" onMouseOver="hilite(1462)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) {
<a name="l4167"><span class="linenum">4167</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l4168"><span class="linenum">4168</span></a>  
<a name="l4169"><span class="linenum">4169</span></a>      if (<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l4170"><span class="linenum">4170</span></a>          return null;
<a name="l4171"><span class="linenum">4171</span></a>      }
<a name="l4172"><span class="linenum">4172</span></a>  
<a name="l4173"><span class="linenum">4173</span></a>  <span class="comment">    // filearea must contain a real area</span>
<a name="l4174"><span class="linenum">4174</span></a>      if (!isset(<a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>[<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>])) {
<a name="l4175"><span class="linenum">4175</span></a>          return null;
<a name="l4176"><span class="linenum">4176</span></a>      }
<a name="l4177"><span class="linenum">4177</span></a>  
<a name="l4178"><span class="linenum">4178</span></a>  <span class="comment">    // Note that forum_user_can_see_post() additionally allows access for parent roles</span>
<a name="l4179"><span class="linenum">4179</span></a>  <span class="comment">    // and it explicitly checks qanda forum type, too. One day, when we stop requiring</span>
<a name="l4180"><span class="linenum">4180</span></a>  <span class="comment">    // course:managefiles, we will need to extend this.</span>
<a name="l4181"><span class="linenum">4181</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l4182"><span class="linenum">4182</span></a>          return null;
<a name="l4183"><span class="linenum">4183</span></a>      }
<a name="l4184"><span class="linenum">4184</span></a>  
<a name="l4185"><span class="linenum">4185</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>)) {
<a name="l4186"><span class="linenum">4186</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../mod/forum/locallib.php.html">/mod/forum/locallib.php</a>');
<a name="l4187"><span class="linenum">4187</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('forum_file_info_container')" href="../../_classes/forum_file_info_container.html" onMouseOver="classPopup(event,'forum_file_info_container')">forum_file_info_container</a>(<a class="var it1462" onMouseOver="hilite(1462)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>);
<a name="l4188"><span class="linenum">4188</span></a>      }
<a name="l4189"><span class="linenum">4189</span></a>  
<a name="l4190"><span class="linenum">4190</span></a>      static <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a> = array();
<a name="l4191"><span class="linenum">4191</span></a>  <span class="comment">    // $cached will store last retrieved post, discussion and forum. To make sure that the cache</span>
<a name="l4192"><span class="linenum">4192</span></a>  <span class="comment">    // is cleared between unit tests we check if this is the same session</span>
<a name="l4193"><span class="linenum">4193</span></a>      if (!isset(<a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['sesskey']) || <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['sesskey'] != <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>()) {
<a name="l4194"><span class="linenum">4194</span></a>          <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a> = array('sesskey' =&gt; <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>());
<a name="l4195"><span class="linenum">4195</span></a>      }
<a name="l4196"><span class="linenum">4196</span></a>  
<a name="l4197"><span class="linenum">4197</span></a>      if (isset(<a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['post']) &amp;&amp; <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['post']-&gt;id == <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>) {
<a name="l4198"><span class="linenum">4198</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['post'];
<a name="l4199"><span class="linenum">4199</span></a>      } else if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_posts', array('id' =&gt; <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>))) {
<a name="l4200"><span class="linenum">4200</span></a>          <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['post'] = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>;
<a name="l4201"><span class="linenum">4201</span></a>      } else {
<a name="l4202"><span class="linenum">4202</span></a>          return null;
<a name="l4203"><span class="linenum">4203</span></a>      }
<a name="l4204"><span class="linenum">4204</span></a>  
<a name="l4205"><span class="linenum">4205</span></a>      if (isset(<a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['discussion']) &amp;&amp; <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['discussion']-&gt;id == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>) {
<a name="l4206"><span class="linenum">4206</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['discussion'];
<a name="l4207"><span class="linenum">4207</span></a>      } else if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('id' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>))) {
<a name="l4208"><span class="linenum">4208</span></a>          <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['discussion'] = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>;
<a name="l4209"><span class="linenum">4209</span></a>      } else {
<a name="l4210"><span class="linenum">4210</span></a>          return null;
<a name="l4211"><span class="linenum">4211</span></a>      }
<a name="l4212"><span class="linenum">4212</span></a>  
<a name="l4213"><span class="linenum">4213</span></a>      if (isset(<a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['forum']) &amp;&amp; <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['forum']-&gt;id == <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>) {
<a name="l4214"><span class="linenum">4214</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['forum'];
<a name="l4215"><span class="linenum">4215</span></a>      } else if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>))) {
<a name="l4216"><span class="linenum">4216</span></a>          <a class="var it9459" onMouseOver="hilite(9459)" onMouseOut="lolite()" onClick="logVariable('cached')" href="../../_variables/cached.html">$cached</a>['forum'] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>;
<a name="l4217"><span class="linenum">4217</span></a>      } else {
<a name="l4218"><span class="linenum">4218</span></a>          return null;
<a name="l4219"><span class="linenum">4219</span></a>      }
<a name="l4220"><span class="linenum">4220</span></a>  
<a name="l4221"><span class="linenum">4221</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l4222"><span class="linenum">4222</span></a>      <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>) ? '/' : <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>;
<a name="l4223"><span class="linenum">4223</span></a>      <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) ? '.' : <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>;
<a name="l4224"><span class="linenum">4224</span></a>      if (!(<a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file')" href="../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>))) {
<a name="l4225"><span class="linenum">4225</span></a>          return null;
<a name="l4226"><span class="linenum">4226</span></a>      }
<a name="l4227"><span class="linenum">4227</span></a>  
<a name="l4228"><span class="linenum">4228</span></a>  <span class="comment">    // Checks to see if the user can manage files or is the owner.</span>
<a name="l4229"><span class="linenum">4229</span></a>  <span class="comment">    // TODO MDL-33805 - Do not use userid here and move the capability check above.</span>
<a name="l4230"><span class="linenum">4230</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:managefiles', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) &amp;&amp; <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>() != <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l4231"><span class="linenum">4231</span></a>          return null;
<a name="l4232"><span class="linenum">4232</span></a>      }
<a name="l4233"><span class="linenum">4233</span></a>  <span class="comment">    // Make sure groups allow this user to see this file</span>
<a name="l4234"><span class="linenum">4234</span></a>      if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> &gt; 0 &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l4235"><span class="linenum">4235</span></a>          <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l4236"><span class="linenum">4236</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a> &amp;&amp; !<a class="function" onClick="logFunction('groups_is_member')" href="../../_functions/groups_is_member.html" onMouseOver="funcPopup(event,'groups_is_member')">groups_is_member</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>)) {
<a name="l4237"><span class="linenum">4237</span></a>              return null;
<a name="l4238"><span class="linenum">4238</span></a>          }
<a name="l4239"><span class="linenum">4239</span></a>      }
<a name="l4240"><span class="linenum">4240</span></a>  
<a name="l4241"><span class="linenum">4241</span></a>  <span class="comment">    // Make sure we're allowed to see it...</span>
<a name="l4242"><span class="linenum">4242</span></a>      if (!<a class="function" onClick="logFunction('forum_user_can_see_post')" href="../../_functions/forum_user_can_see_post.html" onMouseOver="funcPopup(event,'forum_user_can_see_post')">forum_user_can_see_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, NULL, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l4243"><span class="linenum">4243</span></a>          return null;
<a name="l4244"><span class="linenum">4244</span></a>      }
<a name="l4245"><span class="linenum">4245</span></a>  
<a name="l4246"><span class="linenum">4246</span></a>      <a class="var it2276" onMouseOver="hilite(2276)" onMouseOut="lolite()" onClick="logVariable('urlbase')" href="../../_variables/urlbase.html">$urlbase</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'<a class="filename" href="../../pluginfile.php.html">/pluginfile.php</a>';
<a name="l4247"><span class="linenum">4247</span></a>      return <span class="keyword">new </span><a class="class" onClick="logClass('file_info_stored')" href="../../_classes/file_info_stored.html" onMouseOver="classPopup(event,'file_info_stored')">file_info_stored</a>(<a class="var it1462" onMouseOver="hilite(1462)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>, <a class="var it2276" onMouseOver="hilite(2276)" onMouseOut="lolite()" onClick="logVariable('urlbase')" href="../../_variables/urlbase.html">$urlbase</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, true, true, false, false);
<a name="l4248"><span class="linenum">4248</span></a>  }
<a name="l4249"><span class="linenum">4249</span></a>  
<a name="l4250"><span class="linenum">4250</span></a>  <span class="comment">/**</span>
<a name="l4251"><span class="linenum">4251</span></a>  <span class="comment"> * Serves the forum attachments. Implements needed access control ;-)</span>
<a name="l4252"><span class="linenum">4252</span></a>  <span class="comment"> *</span>
<a name="l4253"><span class="linenum">4253</span></a>  <span class="comment"> * @package  mod_forum</span>
<a name="l4254"><span class="linenum">4254</span></a>  <span class="comment"> * @category files</span>
<a name="l4255"><span class="linenum">4255</span></a>  <span class="comment"> * @param stdClass $course course object</span>
<a name="l4256"><span class="linenum">4256</span></a>  <span class="comment"> * @param stdClass $cm course module object</span>
<a name="l4257"><span class="linenum">4257</span></a>  <span class="comment"> * @param stdClass $context context object</span>
<a name="l4258"><span class="linenum">4258</span></a>  <span class="comment"> * @param string $filearea file area</span>
<a name="l4259"><span class="linenum">4259</span></a>  <span class="comment"> * @param array $args extra arguments</span>
<a name="l4260"><span class="linenum">4260</span></a>  <span class="comment"> * @param bool $forcedownload whether or not force download</span>
<a name="l4261"><span class="linenum">4261</span></a>  <span class="comment"> * @param array $options additional options affecting the file serving</span>
<a name="l4262"><span class="linenum">4262</span></a>  <span class="comment"> * @return bool false if file not found, does not return if found - justsend the file</span>
<a name="l4263"><span class="linenum">4263</span></a>  <span class="comment"> */</span>
<a name="l4264"><span class="linenum">4264</span></a>  function <a class="function" onClick="logFunction('forum_pluginfile')" href="../../_functions/forum_pluginfile.html" onMouseOver="funcPopup(event,'forum_pluginfile')">forum_pluginfile</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('forcedownload')" href="../../_variables/forcedownload.html">$forcedownload</a>, array <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>=array()) {
<a name="l4265"><span class="linenum">4265</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4266"><span class="linenum">4266</span></a>  
<a name="l4267"><span class="linenum">4267</span></a>      if (<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l4268"><span class="linenum">4268</span></a>          return false;
<a name="l4269"><span class="linenum">4269</span></a>      }
<a name="l4270"><span class="linenum">4270</span></a>  
<a name="l4271"><span class="linenum">4271</span></a>      <a class="function" onClick="logFunction('require_course_login')" href="../../_functions/require_course_login.html" onMouseOver="funcPopup(event,'require_course_login')">require_course_login</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, true, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l4272"><span class="linenum">4272</span></a>  
<a name="l4273"><span class="linenum">4273</span></a>      <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a> = <a class="function" onClick="logFunction('forum_get_file_areas')" href="../../_functions/forum_get_file_areas.html" onMouseOver="funcPopup(event,'forum_get_file_areas')">forum_get_file_areas</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l4274"><span class="linenum">4274</span></a>  
<a name="l4275"><span class="linenum">4275</span></a>  <span class="comment">    // filearea must contain a real area</span>
<a name="l4276"><span class="linenum">4276</span></a>      if (!isset(<a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>[<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>])) {
<a name="l4277"><span class="linenum">4277</span></a>          return false;
<a name="l4278"><span class="linenum">4278</span></a>      }
<a name="l4279"><span class="linenum">4279</span></a>  
<a name="l4280"><span class="linenum">4280</span></a>      <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a> = (int)<a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l4281"><span class="linenum">4281</span></a>  
<a name="l4282"><span class="linenum">4282</span></a>      if (!<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_posts', array('id'=&gt;<a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>))) {
<a name="l4283"><span class="linenum">4283</span></a>          return false;
<a name="l4284"><span class="linenum">4284</span></a>      }
<a name="l4285"><span class="linenum">4285</span></a>  
<a name="l4286"><span class="linenum">4286</span></a>      if (!<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('id'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>))) {
<a name="l4287"><span class="linenum">4287</span></a>          return false;
<a name="l4288"><span class="linenum">4288</span></a>      }
<a name="l4289"><span class="linenum">4289</span></a>  
<a name="l4290"><span class="linenum">4290</span></a>      if (!<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id'=&gt;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>))) {
<a name="l4291"><span class="linenum">4291</span></a>          return false;
<a name="l4292"><span class="linenum">4292</span></a>      }
<a name="l4293"><span class="linenum">4293</span></a>  
<a name="l4294"><span class="linenum">4294</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l4295"><span class="linenum">4295</span></a>      <a class="var it2277" onMouseOver="hilite(2277)" onMouseOut="lolite()" onClick="logVariable('relativepath')" href="../../_variables/relativepath.html">$relativepath</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l4296"><span class="linenum">4296</span></a>      <a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_forum/<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/<a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>/<a class="var it2277" onMouseOver="hilite(2277)" onMouseOut="lolite()" onClick="logVariable('relativepath')" href="../../_variables/relativepath.html">$relativepath</a>&quot;;
<a name="l4297"><span class="linenum">4297</span></a>      if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file_by_hash')" href="../../_functions/get_file_by_hash.html" onMouseOver="funcPopup(event,'get_file_by_hash')">get_file_by_hash</a>(<a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a>)) or <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('is_directory')" href="../../_functions/is_directory.html" onMouseOver="funcPopup(event,'is_directory')">is_directory</a>()) {
<a name="l4298"><span class="linenum">4298</span></a>          return false;
<a name="l4299"><span class="linenum">4299</span></a>      }
<a name="l4300"><span class="linenum">4300</span></a>  
<a name="l4301"><span class="linenum">4301</span></a>  <span class="comment">    // Make sure groups allow this user to see this file</span>
<a name="l4302"><span class="linenum">4302</span></a>      if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> &gt; 0) {
<a name="l4303"><span class="linenum">4303</span></a>          <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l4304"><span class="linenum">4304</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>) {
<a name="l4305"><span class="linenum">4305</span></a>              if (!<a class="function" onClick="logFunction('groups_is_member')" href="../../_functions/groups_is_member.html" onMouseOver="funcPopup(event,'groups_is_member')">groups_is_member</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>) and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l4306"><span class="linenum">4306</span></a>                  return false;
<a name="l4307"><span class="linenum">4307</span></a>              }
<a name="l4308"><span class="linenum">4308</span></a>          }
<a name="l4309"><span class="linenum">4309</span></a>      }
<a name="l4310"><span class="linenum">4310</span></a>  
<a name="l4311"><span class="linenum">4311</span></a>  <span class="comment">    // Make sure we're allowed to see it...</span>
<a name="l4312"><span class="linenum">4312</span></a>      if (!<a class="function" onClick="logFunction('forum_user_can_see_post')" href="../../_functions/forum_user_can_see_post.html" onMouseOver="funcPopup(event,'forum_user_can_see_post')">forum_user_can_see_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, NULL, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l4313"><span class="linenum">4313</span></a>          return false;
<a name="l4314"><span class="linenum">4314</span></a>      }
<a name="l4315"><span class="linenum">4315</span></a>  
<a name="l4316"><span class="linenum">4316</span></a>  <span class="comment">    // finally send the file</span>
<a name="l4317"><span class="linenum">4317</span></a>      <a class="function" onClick="logFunction('send_stored_file')" href="../../_functions/send_stored_file.html" onMouseOver="funcPopup(event,'send_stored_file')">send_stored_file</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, 0, 0, true, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>); <span class="comment">// download MUST be forced - security!</span>
<a name="l4318"><span class="linenum">4318</span></a>  }
<a name="l4319"><span class="linenum">4319</span></a>  
<a name="l4320"><span class="linenum">4320</span></a>  <span class="comment">/**</span>
<a name="l4321"><span class="linenum">4321</span></a>  <span class="comment"> * If successful, this function returns the name of the file</span>
<a name="l4322"><span class="linenum">4322</span></a>  <span class="comment"> *</span>
<a name="l4323"><span class="linenum">4323</span></a>  <span class="comment"> * @global object</span>
<a name="l4324"><span class="linenum">4324</span></a>  <span class="comment"> * @param object $post is a full post record, including course and forum</span>
<a name="l4325"><span class="linenum">4325</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l4326"><span class="linenum">4326</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l4327"><span class="linenum">4327</span></a>  <span class="comment"> * @param mixed $mform</span>
<a name="l4328"><span class="linenum">4328</span></a>  <span class="comment"> * @param string $unused</span>
<a name="l4329"><span class="linenum">4329</span></a>  <span class="comment"> * @return bool</span>
<a name="l4330"><span class="linenum">4330</span></a>  <span class="comment"> */</span>
<a name="l4331"><span class="linenum">4331</span></a>  function <a class="function" onClick="logFunction('forum_add_attachment')" href="../../_functions/forum_add_attachment.html" onMouseOver="funcPopup(event,'forum_add_attachment')">forum_add_attachment</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>=null, <a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>=null) {
<a name="l4332"><span class="linenum">4332</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4333"><span class="linenum">4333</span></a>  
<a name="l4334"><span class="linenum">4334</span></a>      if (empty(<a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>)) {
<a name="l4335"><span class="linenum">4335</span></a>          return false;
<a name="l4336"><span class="linenum">4336</span></a>      }
<a name="l4337"><span class="linenum">4337</span></a>  
<a name="l4338"><span class="linenum">4338</span></a>      if (empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachments')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachments.html">attachments</a>)) {
<a name="l4339"><span class="linenum">4339</span></a>          return true;   <span class="comment">// Nothing to do</span>
<a name="l4340"><span class="linenum">4340</span></a>      }
<a name="l4341"><span class="linenum">4341</span></a>  
<a name="l4342"><span class="linenum">4342</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4343"><span class="linenum">4343</span></a>  
<a name="l4344"><span class="linenum">4344</span></a>      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = <a class="function" onClick="logFunction('file_get_draft_area_info')" href="../../_functions/file_get_draft_area_info.html" onMouseOver="funcPopup(event,'file_get_draft_area_info')">file_get_draft_area_info</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachments')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachments.html">attachments</a>);
<a name="l4345"><span class="linenum">4345</span></a>      <a class="var it8460" onMouseOver="hilite(8460)" onMouseOut="lolite()" onClick="logVariable('present')" href="../../_variables/present.html">$present</a> = (<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['filecount']&gt;0) ? '1' : '';
<a name="l4346"><span class="linenum">4346</span></a>      <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachments')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachments.html">attachments</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'attachment', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4347"><span class="linenum">4347</span></a>              <a class="class" onClick="logClass('mod_forum_post_form')" href="../../_classes/mod_forum_post_form.html" onMouseOver="classPopup(event,'mod_forum_post_form')">mod_forum_post_form</a>::<a class="function" onClick="logFunction('attachment_options')" href="../../_functions/attachment_options.html" onMouseOver="funcPopup(event,'attachment_options')">attachment_options</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>));
<a name="l4348"><span class="linenum">4348</span></a>  
<a name="l4349"><span class="linenum">4349</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('forum_posts', 'attachment', <a class="var it8460" onMouseOver="hilite(8460)" onMouseOut="lolite()" onClick="logVariable('present')" href="../../_variables/present.html">$present</a>, array('id'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4350"><span class="linenum">4350</span></a>  
<a name="l4351"><span class="linenum">4351</span></a>      return true;
<a name="l4352"><span class="linenum">4352</span></a>  }
<a name="l4353"><span class="linenum">4353</span></a>  
<a name="l4354"><span class="linenum">4354</span></a>  <span class="comment">/**</span>
<a name="l4355"><span class="linenum">4355</span></a>  <span class="comment"> * Add a new post in an existing discussion.</span>
<a name="l4356"><span class="linenum">4356</span></a>  <span class="comment"> *</span>
<a name="l4357"><span class="linenum">4357</span></a>  <span class="comment"> * @global object</span>
<a name="l4358"><span class="linenum">4358</span></a>  <span class="comment"> * @global object</span>
<a name="l4359"><span class="linenum">4359</span></a>  <span class="comment"> * @global object</span>
<a name="l4360"><span class="linenum">4360</span></a>  <span class="comment"> * @param object $post</span>
<a name="l4361"><span class="linenum">4361</span></a>  <span class="comment"> * @param mixed $mform</span>
<a name="l4362"><span class="linenum">4362</span></a>  <span class="comment"> * @param string $unused formerly $message, renamed in 2.8 as it was unused.</span>
<a name="l4363"><span class="linenum">4363</span></a>  <span class="comment"> * @return int</span>
<a name="l4364"><span class="linenum">4364</span></a>  <span class="comment"> */</span>
<a name="l4365"><span class="linenum">4365</span></a>  function <a class="function" onClick="logFunction('forum_add_new_post')" href="../../_functions/forum_add_new_post.html" onMouseOver="funcPopup(event,'forum_add_new_post')">forum_add_new_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>, <a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a> = null) {
<a name="l4366"><span class="linenum">4366</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4367"><span class="linenum">4367</span></a>  
<a name="l4368"><span class="linenum">4368</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('id' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>));
<a name="l4369"><span class="linenum">4369</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>      = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>));
<a name="l4370"><span class="linenum">4370</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>         = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4371"><span class="linenum">4371</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>    = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4372"><span class="linenum">4372</span></a>  
<a name="l4373"><span class="linenum">4373</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('created')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/created.html">created</a>    = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l4374"><span class="linenum">4374</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('mailed')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/mailed.html">mailed</a>     = <a class="constant" onClick="logConstant('FORUM_MAILED_PENDING')" href="../../_constants/FORUM_MAILED_PENDING.html" onMouseOver="constPopup(event,'FORUM_MAILED_PENDING')">FORUM_MAILED_PENDING</a>;
<a name="l4375"><span class="linenum">4375</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>     = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l4376"><span class="linenum">4376</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachment')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachment.html">attachment</a> = &quot;&quot;;
<a name="l4377"><span class="linenum">4377</span></a>      if (!isset(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('totalscore')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/totalscore.html">totalscore</a>)) {
<a name="l4378"><span class="linenum">4378</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('totalscore')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/totalscore.html">totalscore</a> = 0;
<a name="l4379"><span class="linenum">4379</span></a>      }
<a name="l4380"><span class="linenum">4380</span></a>      if (!isset(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('mailnow')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/mailnow.html">mailnow</a>)) {
<a name="l4381"><span class="linenum">4381</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('mailnow')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/mailnow.html">mailnow</a>    = 0;
<a name="l4382"><span class="linenum">4382</span></a>      }
<a name="l4383"><span class="linenum">4383</span></a>  
<a name="l4384"><span class="linenum">4384</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(&quot;forum_posts&quot;, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>);
<a name="l4385"><span class="linenum">4385</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a> = <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('itemid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'post', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4386"><span class="linenum">4386</span></a>              <a class="class" onClick="logClass('mod_forum_post_form')" href="../../_classes/mod_forum_post_form.html" onMouseOver="classPopup(event,'mod_forum_post_form')">mod_forum_post_form</a>::<a class="function" onClick="logFunction('editor_options')" href="../../_functions/editor_options.html" onMouseOver="funcPopup(event,'editor_options')">editor_options</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, null), <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>);
<a name="l4387"><span class="linenum">4387</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('forum_posts', 'message', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>, array('id'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4388"><span class="linenum">4388</span></a>      <a class="function" onClick="logFunction('forum_add_attachment')" href="../../_functions/forum_add_attachment.html" onMouseOver="funcPopup(event,'forum_add_attachment')">forum_add_attachment</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>);
<a name="l4389"><span class="linenum">4389</span></a>  
<a name="l4390"><span class="linenum">4390</span></a>  <span class="comment">    // Update discussion modified date</span>
<a name="l4391"><span class="linenum">4391</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>(&quot;forum_discussions&quot;, &quot;timemodified&quot;, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>, array(&quot;id&quot; =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>));
<a name="l4392"><span class="linenum">4392</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>(&quot;forum_discussions&quot;, &quot;usermodified&quot;, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, array(&quot;id&quot; =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>));
<a name="l4393"><span class="linenum">4393</span></a>  
<a name="l4394"><span class="linenum">4394</span></a>      if (<a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) &amp;&amp; <a class="function" onClick="logFunction('forum_tp_is_tracked')" href="../../_functions/forum_tp_is_tracked.html" onMouseOver="funcPopup(event,'forum_tp_is_tracked')">forum_tp_is_tracked</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l4395"><span class="linenum">4395</span></a>          <a class="function" onClick="logFunction('forum_tp_mark_post_read')" href="../../_functions/forum_tp_mark_post_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_post_read')">forum_tp_mark_post_read</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>);
<a name="l4396"><span class="linenum">4396</span></a>      }
<a name="l4397"><span class="linenum">4397</span></a>  
<a name="l4398"><span class="linenum">4398</span></a>  <span class="comment">    // Let Moodle know that assessable content is uploaded (eg for plagiarism detection)</span>
<a name="l4399"><span class="linenum">4399</span></a>      <a class="function" onClick="logFunction('forum_trigger_content_uploaded_event')" href="../../_functions/forum_trigger_content_uploaded_event.html" onMouseOver="funcPopup(event,'forum_trigger_content_uploaded_event')">forum_trigger_content_uploaded_event</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, 'forum_add_new_post');
<a name="l4400"><span class="linenum">4400</span></a>  
<a name="l4401"><span class="linenum">4401</span></a>      return <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l4402"><span class="linenum">4402</span></a>  }
<a name="l4403"><span class="linenum">4403</span></a>  
<a name="l4404"><span class="linenum">4404</span></a>  <span class="comment">/**</span>
<a name="l4405"><span class="linenum">4405</span></a>  <span class="comment"> * Update a post</span>
<a name="l4406"><span class="linenum">4406</span></a>  <span class="comment"> *</span>
<a name="l4407"><span class="linenum">4407</span></a>  <span class="comment"> * @global object</span>
<a name="l4408"><span class="linenum">4408</span></a>  <span class="comment"> * @global object</span>
<a name="l4409"><span class="linenum">4409</span></a>  <span class="comment"> * @global object</span>
<a name="l4410"><span class="linenum">4410</span></a>  <span class="comment"> * @param object $post</span>
<a name="l4411"><span class="linenum">4411</span></a>  <span class="comment"> * @param mixed $mform</span>
<a name="l4412"><span class="linenum">4412</span></a>  <span class="comment"> * @param string $message</span>
<a name="l4413"><span class="linenum">4413</span></a>  <span class="comment"> * @return bool</span>
<a name="l4414"><span class="linenum">4414</span></a>  <span class="comment"> */</span>
<a name="l4415"><span class="linenum">4415</span></a>  function <a class="function" onClick="logFunction('forum_update_post')" href="../../_functions/forum_update_post.html" onMouseOver="funcPopup(event,'forum_update_post')">forum_update_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>, &amp;<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>) {
<a name="l4416"><span class="linenum">4416</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4417"><span class="linenum">4417</span></a>  
<a name="l4418"><span class="linenum">4418</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions', array('id' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>));
<a name="l4419"><span class="linenum">4419</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>      = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>));
<a name="l4420"><span class="linenum">4420</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>         = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4421"><span class="linenum">4421</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>    = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4422"><span class="linenum">4422</span></a>  
<a name="l4423"><span class="linenum">4423</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l4424"><span class="linenum">4424</span></a>  
<a name="l4425"><span class="linenum">4425</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_posts', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>);
<a name="l4426"><span class="linenum">4426</span></a>  
<a name="l4427"><span class="linenum">4427</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>; <span class="comment">// last modified tracking</span>
<a name="l4428"><span class="linenum">4428</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('usermodified')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;   <span class="comment">// last modified tracking</span>
<a name="l4429"><span class="linenum">4429</span></a>  
<a name="l4430"><span class="linenum">4430</span></a>      if (!<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>) {   // Post is a discussion starter - update discussion title and times too
<a name="l4431"><span class="linenum">4431</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>      = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>;
<a name="l4432"><span class="linenum">4432</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timestart')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timestart')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>;
<a name="l4433"><span class="linenum">4433</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timeend')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a>   = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timeend')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a>;
<a name="l4434"><span class="linenum">4434</span></a>  
<a name="l4435"><span class="linenum">4435</span></a>          if (isset(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('pinned')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/pinned.html">pinned</a>)) {
<a name="l4436"><span class="linenum">4436</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('pinned')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/pinned.html">pinned</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('pinned')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/pinned.html">pinned</a>;
<a name="l4437"><span class="linenum">4437</span></a>          }
<a name="l4438"><span class="linenum">4438</span></a>      }
<a name="l4439"><span class="linenum">4439</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a> = <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('itemid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'post', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4440"><span class="linenum">4440</span></a>              <a class="class" onClick="logClass('mod_forum_post_form')" href="../../_classes/mod_forum_post_form.html" onMouseOver="classPopup(event,'mod_forum_post_form')">mod_forum_post_form</a>::<a class="function" onClick="logFunction('editor_options')" href="../../_functions/editor_options.html" onMouseOver="funcPopup(event,'editor_options')">editor_options</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>);
<a name="l4441"><span class="linenum">4441</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('forum_posts', 'message', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>, array('id'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4442"><span class="linenum">4442</span></a>  
<a name="l4443"><span class="linenum">4443</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_discussions', <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>);
<a name="l4444"><span class="linenum">4444</span></a>  
<a name="l4445"><span class="linenum">4445</span></a>      <a class="function" onClick="logFunction('forum_add_attachment')" href="../../_functions/forum_add_attachment.html" onMouseOver="funcPopup(event,'forum_add_attachment')">forum_add_attachment</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>, <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>);
<a name="l4446"><span class="linenum">4446</span></a>  
<a name="l4447"><span class="linenum">4447</span></a>      if (<a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) &amp;&amp; <a class="function" onClick="logFunction('forum_tp_is_tracked')" href="../../_functions/forum_tp_is_tracked.html" onMouseOver="funcPopup(event,'forum_tp_is_tracked')">forum_tp_is_tracked</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l4448"><span class="linenum">4448</span></a>          <a class="function" onClick="logFunction('forum_tp_mark_post_read')" href="../../_functions/forum_tp_mark_post_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_post_read')">forum_tp_mark_post_read</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>);
<a name="l4449"><span class="linenum">4449</span></a>      }
<a name="l4450"><span class="linenum">4450</span></a>  
<a name="l4451"><span class="linenum">4451</span></a>  <span class="comment">    // Let Moodle know that assessable content is uploaded (eg for plagiarism detection)</span>
<a name="l4452"><span class="linenum">4452</span></a>      <a class="function" onClick="logFunction('forum_trigger_content_uploaded_event')" href="../../_functions/forum_trigger_content_uploaded_event.html" onMouseOver="funcPopup(event,'forum_trigger_content_uploaded_event')">forum_trigger_content_uploaded_event</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, 'forum_update_post');
<a name="l4453"><span class="linenum">4453</span></a>  
<a name="l4454"><span class="linenum">4454</span></a>      return true;
<a name="l4455"><span class="linenum">4455</span></a>  }
<a name="l4456"><span class="linenum">4456</span></a>  
<a name="l4457"><span class="linenum">4457</span></a>  <span class="comment">/**</span>
<a name="l4458"><span class="linenum">4458</span></a>  <span class="comment"> * Given an object containing all the necessary data,</span>
<a name="l4459"><span class="linenum">4459</span></a>  <span class="comment"> * create a new discussion and return the id</span>
<a name="l4460"><span class="linenum">4460</span></a>  <span class="comment"> *</span>
<a name="l4461"><span class="linenum">4461</span></a>  <span class="comment"> * @param object $post</span>
<a name="l4462"><span class="linenum">4462</span></a>  <span class="comment"> * @param mixed $mform</span>
<a name="l4463"><span class="linenum">4463</span></a>  <span class="comment"> * @param string $unused</span>
<a name="l4464"><span class="linenum">4464</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l4465"><span class="linenum">4465</span></a>  <span class="comment"> * @return object</span>
<a name="l4466"><span class="linenum">4466</span></a>  <span class="comment"> */</span>
<a name="l4467"><span class="linenum">4467</span></a>  function <a class="function" onClick="logFunction('forum_add_discussion')" href="../../_functions/forum_add_discussion.html" onMouseOver="funcPopup(event,'forum_add_discussion')">forum_add_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>=null, <a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>=null, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=null) {
<a name="l4468"><span class="linenum">4468</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4469"><span class="linenum">4469</span></a>  
<a name="l4470"><span class="linenum">4470</span></a>      <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a> = isset(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timenow')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timenow.html">timenow</a>) ? <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timenow')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timenow.html">timenow</a> : <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l4471"><span class="linenum">4471</span></a>  
<a name="l4472"><span class="linenum">4472</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l4473"><span class="linenum">4473</span></a>          <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l4474"><span class="linenum">4474</span></a>      }
<a name="l4475"><span class="linenum">4475</span></a>  
<a name="l4476"><span class="linenum">4476</span></a>  <span class="comment">    // The first post is stored as a real post, and linked</span>
<a name="l4477"><span class="linenum">4477</span></a>  <span class="comment">    // to from the discuss entry.</span>
<a name="l4478"><span class="linenum">4478</span></a>  
<a name="l4479"><span class="linenum">4479</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id'=&gt;<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>));
<a name="l4480"><span class="linenum">4480</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>    = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4481"><span class="linenum">4481</span></a>  
<a name="l4482"><span class="linenum">4482</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = new stdClass();
<a name="l4483"><span class="linenum">4483</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>    = 0;
<a name="l4484"><span class="linenum">4484</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>        = 0;
<a name="l4485"><span class="linenum">4485</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>        = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l4486"><span class="linenum">4486</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('created')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/created.html">created</a>       = <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>;
<a name="l4487"><span class="linenum">4487</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>      = <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>;
<a name="l4488"><span class="linenum">4488</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('mailed')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/mailed.html">mailed</a>        = <a class="constant" onClick="logConstant('FORUM_MAILED_PENDING')" href="../../_constants/FORUM_MAILED_PENDING.html" onMouseOver="constPopup(event,'FORUM_MAILED_PENDING')">FORUM_MAILED_PENDING</a>;
<a name="l4489"><span class="linenum">4489</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>       = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l4490"><span class="linenum">4490</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>       = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('message')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>;
<a name="l4491"><span class="linenum">4491</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('messageformat')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/messageformat.html">messageformat</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('messageformat')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/messageformat.html">messageformat</a>;
<a name="l4492"><span class="linenum">4492</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('messagetrust')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/messagetrust.html">messagetrust</a>  = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('messagetrust')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/messagetrust.html">messagetrust</a>;
<a name="l4493"><span class="linenum">4493</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('attachments')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/attachments.html">attachments</a>   = isset(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('attachments')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/attachments.html">attachments</a>) ? <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('attachments')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/attachments.html">attachments</a> : null;
<a name="l4494"><span class="linenum">4494</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>         = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;     <span class="comment">// speedup</span>
<a name="l4495"><span class="linenum">4495</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('course')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>        = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>; <span class="comment">// speedup</span>
<a name="l4496"><span class="linenum">4496</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('mailnow')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/mailnow.html">mailnow</a>       = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('mailnow')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/mailnow.html">mailnow</a>;
<a name="l4497"><span class="linenum">4497</span></a>  
<a name="l4498"><span class="linenum">4498</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(&quot;forum_posts&quot;, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>);
<a name="l4499"><span class="linenum">4499</span></a>  
<a name="l4500"><span class="linenum">4500</span></a>  <span class="comment">    // TODO: Fix the calling code so that there always is a $cm when this function is called</span>
<a name="l4501"><span class="linenum">4501</span></a>      if (!empty(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) &amp;&amp; !empty(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('itemid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>)) {   // In &quot;single simple discussions&quot; this may not exist yet
<a name="l4502"><span class="linenum">4502</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4503"><span class="linenum">4503</span></a>          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> = <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('itemid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'post', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4504"><span class="linenum">4504</span></a>                  <a class="class" onClick="logClass('mod_forum_post_form')" href="../../_classes/mod_forum_post_form.html" onMouseOver="classPopup(event,'mod_forum_post_form')">mod_forum_post_form</a>::<a class="function" onClick="logFunction('editor_options')" href="../../_functions/editor_options.html" onMouseOver="funcPopup(event,'editor_options')">editor_options</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, null), <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>);
<a name="l4505"><span class="linenum">4505</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('forum_posts', 'message', <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, array('id'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4506"><span class="linenum">4506</span></a>      }
<a name="l4507"><span class="linenum">4507</span></a>  
<a name="l4508"><span class="linenum">4508</span></a>  <span class="comment">    // Now do the main entry for the discussion, linking to this first post</span>
<a name="l4509"><span class="linenum">4509</span></a>  
<a name="l4510"><span class="linenum">4510</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('firstpost')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/firstpost.html">firstpost</a>    = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l4511"><span class="linenum">4511</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>;
<a name="l4512"><span class="linenum">4512</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('usermodified')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l4513"><span class="linenum">4513</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('userid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>       = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l4514"><span class="linenum">4514</span></a>      <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('assessed')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>     = 0;
<a name="l4515"><span class="linenum">4515</span></a>  
<a name="l4516"><span class="linenum">4516</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(&quot;forum_discussions&quot;, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>);
<a name="l4517"><span class="linenum">4517</span></a>  
<a name="l4518"><span class="linenum">4518</span></a>  <span class="comment">    // Finally, set the pointer on the post.</span>
<a name="l4519"><span class="linenum">4519</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>(&quot;forum_posts&quot;, &quot;discussion&quot;, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>, array(&quot;id&quot;=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4520"><span class="linenum">4520</span></a>  
<a name="l4521"><span class="linenum">4521</span></a>      if (!empty(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l4522"><span class="linenum">4522</span></a>          <a class="function" onClick="logFunction('forum_add_attachment')" href="../../_functions/forum_add_attachment.html" onMouseOver="funcPopup(event,'forum_add_attachment')">forum_add_attachment</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>, <a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>);
<a name="l4523"><span class="linenum">4523</span></a>      }
<a name="l4524"><span class="linenum">4524</span></a>  
<a name="l4525"><span class="linenum">4525</span></a>      if (<a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) &amp;&amp; <a class="function" onClick="logFunction('forum_tp_is_tracked')" href="../../_functions/forum_tp_is_tracked.html" onMouseOver="funcPopup(event,'forum_tp_is_tracked')">forum_tp_is_tracked</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l4526"><span class="linenum">4526</span></a>          <a class="function" onClick="logFunction('forum_tp_mark_post_read')" href="../../_functions/forum_tp_mark_post_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_post_read')">forum_tp_mark_post_read</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>);
<a name="l4527"><span class="linenum">4527</span></a>      }
<a name="l4528"><span class="linenum">4528</span></a>  
<a name="l4529"><span class="linenum">4529</span></a>  <span class="comment">    // Let Moodle know that assessable content is uploaded (eg for plagiarism detection)</span>
<a name="l4530"><span class="linenum">4530</span></a>      if (!empty(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l4531"><span class="linenum">4531</span></a>          <a class="function" onClick="logFunction('forum_trigger_content_uploaded_event')" href="../../_functions/forum_trigger_content_uploaded_event.html" onMouseOver="funcPopup(event,'forum_trigger_content_uploaded_event')">forum_trigger_content_uploaded_event</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, 'forum_add_discussion');
<a name="l4532"><span class="linenum">4532</span></a>      }
<a name="l4533"><span class="linenum">4533</span></a>  
<a name="l4534"><span class="linenum">4534</span></a>      return <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>;
<a name="l4535"><span class="linenum">4535</span></a>  }
<a name="l4536"><span class="linenum">4536</span></a>  
<a name="l4537"><span class="linenum">4537</span></a>  
<a name="l4538"><span class="linenum">4538</span></a>  <span class="comment">/**</span>
<a name="l4539"><span class="linenum">4539</span></a>  <span class="comment"> * Deletes a discussion and handles all associated cleanup.</span>
<a name="l4540"><span class="linenum">4540</span></a>  <span class="comment"> *</span>
<a name="l4541"><span class="linenum">4541</span></a>  <span class="comment"> * @global object</span>
<a name="l4542"><span class="linenum">4542</span></a>  <span class="comment"> * @param object $discussion Discussion to delete</span>
<a name="l4543"><span class="linenum">4543</span></a>  <span class="comment"> * @param bool $fulldelete True when deleting entire forum</span>
<a name="l4544"><span class="linenum">4544</span></a>  <span class="comment"> * @param object $course Course</span>
<a name="l4545"><span class="linenum">4545</span></a>  <span class="comment"> * @param object $cm Course-module</span>
<a name="l4546"><span class="linenum">4546</span></a>  <span class="comment"> * @param object $forum Forum</span>
<a name="l4547"><span class="linenum">4547</span></a>  <span class="comment"> * @return bool</span>
<a name="l4548"><span class="linenum">4548</span></a>  <span class="comment"> */</span>
<a name="l4549"><span class="linenum">4549</span></a>  function <a class="function" onClick="logFunction('forum_delete_discussion')" href="../../_functions/forum_delete_discussion.html" onMouseOver="funcPopup(event,'forum_delete_discussion')">forum_delete_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it2406" onMouseOver="hilite(2406)" onMouseOut="lolite()" onClick="logVariable('fulldelete')" href="../../_variables/fulldelete.html">$fulldelete</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l4550"><span class="linenum">4550</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l4551"><span class="linenum">4551</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/completionlib.php');
<a name="l4552"><span class="linenum">4552</span></a>  
<a name="l4553"><span class="linenum">4553</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = true;
<a name="l4554"><span class="linenum">4554</span></a>  
<a name="l4555"><span class="linenum">4555</span></a>      if (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(&quot;forum_posts&quot;, array(&quot;discussion&quot; =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l4556"><span class="linenum">4556</span></a>          foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l4557"><span class="linenum">4557</span></a>              <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('course')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('course')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>;
<a name="l4558"><span class="linenum">4558</span></a>              <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>  = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>;
<a name="l4559"><span class="linenum">4559</span></a>              if (!<a class="function" onClick="logFunction('forum_delete_post')" href="../../_functions/forum_delete_post.html" onMouseOver="funcPopup(event,'forum_delete_post')">forum_delete_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, 'ignore', <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it2406" onMouseOver="hilite(2406)" onMouseOut="lolite()" onClick="logVariable('fulldelete')" href="../../_variables/fulldelete.html">$fulldelete</a>)) {
<a name="l4560"><span class="linenum">4560</span></a>                  <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l4561"><span class="linenum">4561</span></a>              }
<a name="l4562"><span class="linenum">4562</span></a>          }
<a name="l4563"><span class="linenum">4563</span></a>      }
<a name="l4564"><span class="linenum">4564</span></a>  
<a name="l4565"><span class="linenum">4565</span></a>      <a class="function" onClick="logFunction('forum_tp_delete_read_records')" href="../../_functions/forum_tp_delete_read_records.html" onMouseOver="funcPopup(event,'forum_tp_delete_read_records')">forum_tp_delete_read_records</a>(-1, -1, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4566"><span class="linenum">4566</span></a>  
<a name="l4567"><span class="linenum">4567</span></a>  <span class="comment">    // Discussion subscriptions must be removed before discussions because of key constraints.</span>
<a name="l4568"><span class="linenum">4568</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_discussion_subs', array('discussion' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4569"><span class="linenum">4569</span></a>      if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>(&quot;forum_discussions&quot;, array(&quot;id&quot; =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l4570"><span class="linenum">4570</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l4571"><span class="linenum">4571</span></a>      }
<a name="l4572"><span class="linenum">4572</span></a>  
<a name="l4573"><span class="linenum">4573</span></a>  <span class="comment">    // Update completion state if we are tracking completion based on number of posts</span>
<a name="l4574"><span class="linenum">4574</span></a>  <span class="comment">    // But don't bother when deleting whole thing</span>
<a name="l4575"><span class="linenum">4575</span></a>      if (!<a class="var it2406" onMouseOver="hilite(2406)" onMouseOut="lolite()" onClick="logVariable('fulldelete')" href="../../_variables/fulldelete.html">$fulldelete</a>) {
<a name="l4576"><span class="linenum">4576</span></a>          <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a> = <span class="keyword">new </span><a class="class" onClick="logClass('completion_info')" href="../../_classes/completion_info.html" onMouseOver="classPopup(event,'completion_info')">completion_info</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l4577"><span class="linenum">4577</span></a>          if (<a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('is_enabled')" href="../../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) == <a class="constant" onClick="logConstant('COMPLETION_TRACKING_AUTOMATIC')" href="../../_constants/COMPLETION_TRACKING_AUTOMATIC.html" onMouseOver="constPopup(event,'COMPLETION_TRACKING_AUTOMATIC')">COMPLETION_TRACKING_AUTOMATIC</a> &amp;&amp;
<a name="l4578"><span class="linenum">4578</span></a>             (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completiondiscussions')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completiondiscussions.html">completiondiscussions</a> || <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completionreplies')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completionreplies.html">completionreplies</a> || <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completionposts')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completionposts.html">completionposts</a>)) {
<a name="l4579"><span class="linenum">4579</span></a>              <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('update_state')" href="../../_functions/update_state.html" onMouseOver="funcPopup(event,'update_state')">update_state</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="constant" onClick="logConstant('COMPLETION_INCOMPLETE')" href="../../_constants/COMPLETION_INCOMPLETE.html" onMouseOver="constPopup(event,'COMPLETION_INCOMPLETE')">COMPLETION_INCOMPLETE</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('userid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l4580"><span class="linenum">4580</span></a>          }
<a name="l4581"><span class="linenum">4581</span></a>      }
<a name="l4582"><span class="linenum">4582</span></a>  
<a name="l4583"><span class="linenum">4583</span></a>      return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l4584"><span class="linenum">4584</span></a>  }
<a name="l4585"><span class="linenum">4585</span></a>  
<a name="l4586"><span class="linenum">4586</span></a>  
<a name="l4587"><span class="linenum">4587</span></a>  <span class="comment">/**</span>
<a name="l4588"><span class="linenum">4588</span></a>  <span class="comment"> * Deletes a single forum post.</span>
<a name="l4589"><span class="linenum">4589</span></a>  <span class="comment"> *</span>
<a name="l4590"><span class="linenum">4590</span></a>  <span class="comment"> * @global object</span>
<a name="l4591"><span class="linenum">4591</span></a>  <span class="comment"> * @param object $post Forum post object</span>
<a name="l4592"><span class="linenum">4592</span></a>  <span class="comment"> * @param mixed $children Whether to delete children. If false, returns false</span>
<a name="l4593"><span class="linenum">4593</span></a>  <span class="comment"> *   if there are any children (without deleting the post). If true,</span>
<a name="l4594"><span class="linenum">4594</span></a>  <span class="comment"> *   recursively deletes all children. If set to special value 'ignore', deletes</span>
<a name="l4595"><span class="linenum">4595</span></a>  <span class="comment"> *   post regardless of children (this is for use only when deleting all posts</span>
<a name="l4596"><span class="linenum">4596</span></a>  <span class="comment"> *   in a disussion).</span>
<a name="l4597"><span class="linenum">4597</span></a>  <span class="comment"> * @param object $course Course</span>
<a name="l4598"><span class="linenum">4598</span></a>  <span class="comment"> * @param object $cm Course-module</span>
<a name="l4599"><span class="linenum">4599</span></a>  <span class="comment"> * @param object $forum Forum</span>
<a name="l4600"><span class="linenum">4600</span></a>  <span class="comment"> * @param bool $skipcompletion True to skip updating completion state if it</span>
<a name="l4601"><span class="linenum">4601</span></a>  <span class="comment"> *   would otherwise be updated, i.e. when deleting entire forum anyway.</span>
<a name="l4602"><span class="linenum">4602</span></a>  <span class="comment"> * @return bool</span>
<a name="l4603"><span class="linenum">4603</span></a>  <span class="comment"> */</span>
<a name="l4604"><span class="linenum">4604</span></a>  function <a class="function" onClick="logFunction('forum_delete_post')" href="../../_functions/forum_delete_post.html" onMouseOver="funcPopup(event,'forum_delete_post')">forum_delete_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it41602" onMouseOver="hilite(41602)" onMouseOut="lolite()" onClick="logVariable('skipcompletion')" href="../../_variables/skipcompletion.html">$skipcompletion</a>=false) {
<a name="l4605"><span class="linenum">4605</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l4606"><span class="linenum">4606</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/completionlib.php');
<a name="l4607"><span class="linenum">4607</span></a>  
<a name="l4608"><span class="linenum">4608</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4609"><span class="linenum">4609</span></a>  
<a name="l4610"><span class="linenum">4610</span></a>      if (<a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> !== 'ignore' &amp;&amp; (<a class="var it41603" onMouseOver="hilite(41603)" onMouseOut="lolite()" onClick="logVariable('childposts')" href="../../_variables/childposts.html">$childposts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('forum_posts', array('parent'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)))) {
<a name="l4611"><span class="linenum">4611</span></a>         if (<a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a>) {
<a name="l4612"><span class="linenum">4612</span></a>             foreach (<a class="var it41603" onMouseOver="hilite(41603)" onMouseOut="lolite()" onClick="logVariable('childposts')" href="../../_variables/childposts.html">$childposts</a> as <a class="var it41604" onMouseOver="hilite(41604)" onMouseOut="lolite()" onClick="logVariable('childpost')" href="../../_variables/childpost.html">$childpost</a>) {
<a name="l4613"><span class="linenum">4613</span></a>                 <a class="function" onClick="logFunction('forum_delete_post')" href="../../_functions/forum_delete_post.html" onMouseOver="funcPopup(event,'forum_delete_post')">forum_delete_post</a>(<a class="var it41604" onMouseOver="hilite(41604)" onMouseOut="lolite()" onClick="logVariable('childpost')" href="../../_variables/childpost.html">$childpost</a>, true, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it41602" onMouseOver="hilite(41602)" onMouseOut="lolite()" onClick="logVariable('skipcompletion')" href="../../_variables/skipcompletion.html">$skipcompletion</a>);
<a name="l4614"><span class="linenum">4614</span></a>             }
<a name="l4615"><span class="linenum">4615</span></a>         } else {
<a name="l4616"><span class="linenum">4616</span></a>             return false;
<a name="l4617"><span class="linenum">4617</span></a>         }
<a name="l4618"><span class="linenum">4618</span></a>      }
<a name="l4619"><span class="linenum">4619</span></a>  
<a name="l4620"><span class="linenum">4620</span></a>  <span class="comment">    // Delete ratings.</span>
<a name="l4621"><span class="linenum">4621</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../rating/lib.php.html">/rating/lib.php</a>');
<a name="l4622"><span class="linenum">4622</span></a>      <a class="var it13895" onMouseOver="hilite(13895)" onMouseOut="lolite()" onClick="logVariable('delopt')" href="../../_variables/delopt.html">$delopt</a> = new stdClass;
<a name="l4623"><span class="linenum">4623</span></a>      <a class="var it13895" onMouseOver="hilite(13895)" onMouseOut="lolite()" onClick="logVariable('delopt')" href="../../_variables/delopt.html">$delopt</a>-&gt;<a onClick="logVariable('contextid')" class="var it44194" onMouseOver="hilite(44194)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l4624"><span class="linenum">4624</span></a>      <a class="var it13895" onMouseOver="hilite(13895)" onMouseOut="lolite()" onClick="logVariable('delopt')" href="../../_variables/delopt.html">$delopt</a>-&gt;<a onClick="logVariable('component')" class="var it44194" onMouseOver="hilite(44194)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = 'mod_forum';
<a name="l4625"><span class="linenum">4625</span></a>      <a class="var it13895" onMouseOver="hilite(13895)" onMouseOut="lolite()" onClick="logVariable('delopt')" href="../../_variables/delopt.html">$delopt</a>-&gt;<a onClick="logVariable('ratingarea')" class="var it44194" onMouseOver="hilite(44194)" onMouseOut="lolite()" href="../../_variables/ratingarea.html">ratingarea</a> = 'post';
<a name="l4626"><span class="linenum">4626</span></a>      <a class="var it13895" onMouseOver="hilite(13895)" onMouseOut="lolite()" onClick="logVariable('delopt')" href="../../_variables/delopt.html">$delopt</a>-&gt;<a onClick="logVariable('itemid')" class="var it44194" onMouseOver="hilite(44194)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l4627"><span class="linenum">4627</span></a>      <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a> = <span class="keyword">new </span><a class="class" onClick="logClass('rating_manager')" href="../../_classes/rating_manager.html" onMouseOver="classPopup(event,'rating_manager')">rating_manager</a>();
<a name="l4628"><span class="linenum">4628</span></a>      <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a>-&gt;<a class="function" onClick="logFunction('delete_ratings')" href="../../_functions/delete_ratings.html" onMouseOver="funcPopup(event,'delete_ratings')">delete_ratings</a>(<a class="var it13895" onMouseOver="hilite(13895)" onMouseOut="lolite()" onClick="logVariable('delopt')" href="../../_variables/delopt.html">$delopt</a>);
<a name="l4629"><span class="linenum">4629</span></a>  
<a name="l4630"><span class="linenum">4630</span></a>  <span class="comment">    // Delete attachments.</span>
<a name="l4631"><span class="linenum">4631</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l4632"><span class="linenum">4632</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'attachment', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4633"><span class="linenum">4633</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'post', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4634"><span class="linenum">4634</span></a>  
<a name="l4635"><span class="linenum">4635</span></a>  <span class="comment">    // Delete cached RSS feeds.</span>
<a name="l4636"><span class="linenum">4636</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablerssfeeds')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/enablerssfeeds.html">enablerssfeeds</a>)) {
<a name="l4637"><span class="linenum">4637</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../mod/forum/rsslib.php.html">/mod/forum/rsslib.php</a>');
<a name="l4638"><span class="linenum">4638</span></a>          <a class="function" onClick="logFunction('forum_rss_delete_file')" href="../../_functions/forum_rss_delete_file.html" onMouseOver="funcPopup(event,'forum_rss_delete_file')">forum_rss_delete_file</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l4639"><span class="linenum">4639</span></a>      }
<a name="l4640"><span class="linenum">4640</span></a>  
<a name="l4641"><span class="linenum">4641</span></a>      if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>(&quot;forum_posts&quot;, array(&quot;id&quot; =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l4642"><span class="linenum">4642</span></a>  
<a name="l4643"><span class="linenum">4643</span></a>          <a class="function" onClick="logFunction('forum_tp_delete_read_records')" href="../../_functions/forum_tp_delete_read_records.html" onMouseOver="funcPopup(event,'forum_tp_delete_read_records')">forum_tp_delete_read_records</a>(-1, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4644"><span class="linenum">4644</span></a>  
<a name="l4645"><span class="linenum">4645</span></a>  <span class="comment">    // Just in case we are deleting the last post</span>
<a name="l4646"><span class="linenum">4646</span></a>          <a class="function" onClick="logFunction('forum_discussion_update_last_post')" href="../../_functions/forum_discussion_update_last_post.html" onMouseOver="funcPopup(event,'forum_discussion_update_last_post')">forum_discussion_update_last_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>);
<a name="l4647"><span class="linenum">4647</span></a>  
<a name="l4648"><span class="linenum">4648</span></a>  <span class="comment">        // Update completion state if we are tracking completion based on number of posts</span>
<a name="l4649"><span class="linenum">4649</span></a>  <span class="comment">        // But don't bother when deleting whole thing</span>
<a name="l4650"><span class="linenum">4650</span></a>  
<a name="l4651"><span class="linenum">4651</span></a>          if (!<a class="var it41602" onMouseOver="hilite(41602)" onMouseOut="lolite()" onClick="logVariable('skipcompletion')" href="../../_variables/skipcompletion.html">$skipcompletion</a>) {
<a name="l4652"><span class="linenum">4652</span></a>              <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a> = <span class="keyword">new </span><a class="class" onClick="logClass('completion_info')" href="../../_classes/completion_info.html" onMouseOver="classPopup(event,'completion_info')">completion_info</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l4653"><span class="linenum">4653</span></a>              if (<a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('is_enabled')" href="../../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) == <a class="constant" onClick="logConstant('COMPLETION_TRACKING_AUTOMATIC')" href="../../_constants/COMPLETION_TRACKING_AUTOMATIC.html" onMouseOver="constPopup(event,'COMPLETION_TRACKING_AUTOMATIC')">COMPLETION_TRACKING_AUTOMATIC</a> &amp;&amp;
<a name="l4654"><span class="linenum">4654</span></a>                 (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completiondiscussions')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completiondiscussions.html">completiondiscussions</a> || <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completionreplies')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completionreplies.html">completionreplies</a> || <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('completionposts')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/completionposts.html">completionposts</a>)) {
<a name="l4655"><span class="linenum">4655</span></a>                  <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('update_state')" href="../../_functions/update_state.html" onMouseOver="funcPopup(event,'update_state')">update_state</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="constant" onClick="logConstant('COMPLETION_INCOMPLETE')" href="../../_constants/COMPLETION_INCOMPLETE.html" onMouseOver="constPopup(event,'COMPLETION_INCOMPLETE')">COMPLETION_INCOMPLETE</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l4656"><span class="linenum">4656</span></a>              }
<a name="l4657"><span class="linenum">4657</span></a>          }
<a name="l4658"><span class="linenum">4658</span></a>  
<a name="l4659"><span class="linenum">4659</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l4660"><span class="linenum">4660</span></a>              'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>,
<a name="l4661"><span class="linenum">4661</span></a>              'objectid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4662"><span class="linenum">4662</span></a>              'other' =&gt; array(
<a name="l4663"><span class="linenum">4663</span></a>                  'discussionid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>,
<a name="l4664"><span class="linenum">4664</span></a>                  'forumid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4665"><span class="linenum">4665</span></a>                  'forumtype' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>,
<a name="l4666"><span class="linenum">4666</span></a>              )
<a name="l4667"><span class="linenum">4667</span></a>          );
<a name="l4668"><span class="linenum">4668</span></a>          if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> !== <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l4669"><span class="linenum">4669</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['relateduserid'] = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l4670"><span class="linenum">4670</span></a>          }
<a name="l4671"><span class="linenum">4671</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \mod_forum\event\<a class="class" onClick="logClass('post_deleted')" href="../../_classes/post_deleted.html" onMouseOver="classPopup(event,'post_deleted')">post_deleted</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l4672"><span class="linenum">4672</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('forum_posts', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>);
<a name="l4673"><span class="linenum">4673</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l4674"><span class="linenum">4674</span></a>  
<a name="l4675"><span class="linenum">4675</span></a>          return true;
<a name="l4676"><span class="linenum">4676</span></a>      }
<a name="l4677"><span class="linenum">4677</span></a>      return false;
<a name="l4678"><span class="linenum">4678</span></a>  }
<a name="l4679"><span class="linenum">4679</span></a>  
<a name="l4680"><span class="linenum">4680</span></a>  <span class="comment">/**</span>
<a name="l4681"><span class="linenum">4681</span></a>  <span class="comment"> * Sends post content to plagiarism plugin</span>
<a name="l4682"><span class="linenum">4682</span></a>  <span class="comment"> * @param object $post Forum post object</span>
<a name="l4683"><span class="linenum">4683</span></a>  <span class="comment"> * @param object $cm Course-module</span>
<a name="l4684"><span class="linenum">4684</span></a>  <span class="comment"> * @param string $name</span>
<a name="l4685"><span class="linenum">4685</span></a>  <span class="comment"> * @return bool</span>
<a name="l4686"><span class="linenum">4686</span></a>  <span class="comment">*/</span>
<a name="l4687"><span class="linenum">4687</span></a>  function <a class="function" onClick="logFunction('forum_trigger_content_uploaded_event')" href="../../_functions/forum_trigger_content_uploaded_event.html" onMouseOver="funcPopup(event,'forum_trigger_content_uploaded_event')">forum_trigger_content_uploaded_event</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>) {
<a name="l4688"><span class="linenum">4688</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4689"><span class="linenum">4689</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l4690"><span class="linenum">4690</span></a>      <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'attachment', <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, &quot;timemodified&quot;, false);
<a name="l4691"><span class="linenum">4691</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l4692"><span class="linenum">4692</span></a>          'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>,
<a name="l4693"><span class="linenum">4693</span></a>          'objectid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4694"><span class="linenum">4694</span></a>          'other' =&gt; array(
<a name="l4695"><span class="linenum">4695</span></a>              'content' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('message')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>,
<a name="l4696"><span class="linenum">4696</span></a>              'pathnamehashes' =&gt; <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>),
<a name="l4697"><span class="linenum">4697</span></a>              'discussionid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>,
<a name="l4698"><span class="linenum">4698</span></a>              'triggeredfrom' =&gt; <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>,
<a name="l4699"><span class="linenum">4699</span></a>          )
<a name="l4700"><span class="linenum">4700</span></a>      );
<a name="l4701"><span class="linenum">4701</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \mod_forum\event\<a class="class" onClick="logClass('assessable_uploaded')" href="../../_classes/assessable_uploaded.html" onMouseOver="classPopup(event,'assessable_uploaded')">assessable_uploaded</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l4702"><span class="linenum">4702</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l4703"><span class="linenum">4703</span></a>      return true;
<a name="l4704"><span class="linenum">4704</span></a>  }
<a name="l4705"><span class="linenum">4705</span></a>  
<a name="l4706"><span class="linenum">4706</span></a>  <span class="comment">/**</span>
<a name="l4707"><span class="linenum">4707</span></a>  <span class="comment"> * @global object</span>
<a name="l4708"><span class="linenum">4708</span></a>  <span class="comment"> * @param object $post</span>
<a name="l4709"><span class="linenum">4709</span></a>  <span class="comment"> * @param bool $children</span>
<a name="l4710"><span class="linenum">4710</span></a>  <span class="comment"> * @return int</span>
<a name="l4711"><span class="linenum">4711</span></a>  <span class="comment"> */</span>
<a name="l4712"><span class="linenum">4712</span></a>  function <a class="function" onClick="logFunction('forum_count_replies')" href="../../_functions/forum_count_replies.html" onMouseOver="funcPopup(event,'forum_count_replies')">forum_count_replies</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a>=true) {
<a name="l4713"><span class="linenum">4713</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4714"><span class="linenum">4714</span></a>      <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = 0;
<a name="l4715"><span class="linenum">4715</span></a>  
<a name="l4716"><span class="linenum">4716</span></a>      if (<a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a>) {
<a name="l4717"><span class="linenum">4717</span></a>          if (<a class="var it41603" onMouseOver="hilite(41603)" onMouseOut="lolite()" onClick="logVariable('childposts')" href="../../_variables/childposts.html">$childposts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('forum_posts', array('parent' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l4718"><span class="linenum">4718</span></a>             foreach (<a class="var it41603" onMouseOver="hilite(41603)" onMouseOut="lolite()" onClick="logVariable('childposts')" href="../../_variables/childposts.html">$childposts</a> as <a class="var it41604" onMouseOver="hilite(41604)" onMouseOut="lolite()" onClick="logVariable('childpost')" href="../../_variables/childpost.html">$childpost</a>) {
<a name="l4719"><span class="linenum">4719</span></a>                 <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> ++;                   <span class="comment">// For this child</span>
<a name="l4720"><span class="linenum">4720</span></a>                 <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> += <a class="function" onClick="logFunction('forum_count_replies')" href="../../_functions/forum_count_replies.html" onMouseOver="funcPopup(event,'forum_count_replies')">forum_count_replies</a>(<a class="var it41604" onMouseOver="hilite(41604)" onMouseOut="lolite()" onClick="logVariable('childpost')" href="../../_variables/childpost.html">$childpost</a>, true);
<a name="l4721"><span class="linenum">4721</span></a>             }
<a name="l4722"><span class="linenum">4722</span></a>          }
<a name="l4723"><span class="linenum">4723</span></a>      } else {
<a name="l4724"><span class="linenum">4724</span></a>          <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> += <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('forum_posts', array('parent' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4725"><span class="linenum">4725</span></a>      }
<a name="l4726"><span class="linenum">4726</span></a>  
<a name="l4727"><span class="linenum">4727</span></a>      return <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>;
<a name="l4728"><span class="linenum">4728</span></a>  }
<a name="l4729"><span class="linenum">4729</span></a>  
<a name="l4730"><span class="linenum">4730</span></a>  <span class="comment">/**</span>
<a name="l4731"><span class="linenum">4731</span></a>  <span class="comment"> * Given a new post, subscribes or unsubscribes as appropriate.</span>
<a name="l4732"><span class="linenum">4732</span></a>  <span class="comment"> * Returns some text which describes what happened.</span>
<a name="l4733"><span class="linenum">4733</span></a>  <span class="comment"> *</span>
<a name="l4734"><span class="linenum">4734</span></a>  <span class="comment"> * @param object $fromform The submitted form</span>
<a name="l4735"><span class="linenum">4735</span></a>  <span class="comment"> * @param stdClass $forum The forum record</span>
<a name="l4736"><span class="linenum">4736</span></a>  <span class="comment"> * @param stdClass $discussion The forum discussion record</span>
<a name="l4737"><span class="linenum">4737</span></a>  <span class="comment"> * @return string</span>
<a name="l4738"><span class="linenum">4738</span></a>  <span class="comment"> */</span>
<a name="l4739"><span class="linenum">4739</span></a>  function <a class="function" onClick="logFunction('forum_post_subscription')" href="../../_functions/forum_post_subscription.html" onMouseOver="funcPopup(event,'forum_post_subscription')">forum_post_subscription</a>(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../_variables/fromform.html">$fromform</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>) {
<a name="l4740"><span class="linenum">4740</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l4741"><span class="linenum">4741</span></a>  
<a name="l4742"><span class="linenum">4742</span></a>      if (\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_forcesubscribed')" href="../../_functions/is_forcesubscribed.html" onMouseOver="funcPopup(event,'is_forcesubscribed')">is_forcesubscribed</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l4743"><span class="linenum">4743</span></a>          return &quot;&quot;;
<a name="l4744"><span class="linenum">4744</span></a>      } else if (\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('subscription_disabled')" href="../../_functions/subscription_disabled.html" onMouseOver="funcPopup(event,'subscription_disabled')">subscription_disabled</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l4745"><span class="linenum">4745</span></a>          <a class="var it12020" onMouseOver="hilite(12020)" onMouseOut="lolite()" onClick="logVariable('subscribed')" href="../../_variables/subscribed.html">$subscribed</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_subscribed')" href="../../_functions/is_subscribed.html" onMouseOver="funcPopup(event,'is_subscribed')">is_subscribed</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l4746"><span class="linenum">4746</span></a>          if (<a class="var it12020" onMouseOver="hilite(12020)" onMouseOut="lolite()" onClick="logVariable('subscribed')" href="../../_variables/subscribed.html">$subscribed</a> &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:manageactivities', <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>), <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l4747"><span class="linenum">4747</span></a>  <span class="comment">            // This user should not be subscribed to the forum.</span>
<a name="l4748"><span class="linenum">4748</span></a>              \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('unsubscribe_user')" href="../../_functions/unsubscribe_user.html" onMouseOver="funcPopup(event,'unsubscribe_user')">unsubscribe_user</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l4749"><span class="linenum">4749</span></a>          }
<a name="l4750"><span class="linenum">4750</span></a>          return &quot;&quot;;
<a name="l4751"><span class="linenum">4751</span></a>      }
<a name="l4752"><span class="linenum">4752</span></a>  
<a name="l4753"><span class="linenum">4753</span></a>      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = new stdClass();
<a name="l4754"><span class="linenum">4754</span></a>      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>-&gt;<a onClick="logVariable('name')" class="var it42982" onMouseOver="hilite(42982)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>  = <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>);
<a name="l4755"><span class="linenum">4755</span></a>      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>-&gt;<a onClick="logVariable('discussion')" class="var it42982" onMouseOver="hilite(42982)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>);
<a name="l4756"><span class="linenum">4756</span></a>      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>-&gt;<a onClick="logVariable('forum')" class="var it42982" onMouseOver="hilite(42982)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('name')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>);
<a name="l4757"><span class="linenum">4757</span></a>  
<a name="l4758"><span class="linenum">4758</span></a>      if (isset(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('discussionsubscribe')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../_variables/discussionsubscribe.html">discussionsubscribe</a>) &amp;&amp; <a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('discussionsubscribe')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../_variables/discussionsubscribe.html">discussionsubscribe</a>) {
<a name="l4759"><span class="linenum">4759</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('subscribe_user_to_discussion')" href="../../_functions/subscribe_user_to_discussion.html" onMouseOver="funcPopup(event,'subscribe_user_to_discussion')">subscribe_user_to_discussion</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>)) {
<a name="l4760"><span class="linenum">4760</span></a>              return <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('p', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('discussionnowsubscribed', 'forum', <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>));
<a name="l4761"><span class="linenum">4761</span></a>          }
<a name="l4762"><span class="linenum">4762</span></a>      } else {
<a name="l4763"><span class="linenum">4763</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('unsubscribe_user_from_discussion')" href="../../_functions/unsubscribe_user_from_discussion.html" onMouseOver="funcPopup(event,'unsubscribe_user_from_discussion')">unsubscribe_user_from_discussion</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>)) {
<a name="l4764"><span class="linenum">4764</span></a>              return <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('p', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('discussionnownotsubscribed', 'forum', <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>));
<a name="l4765"><span class="linenum">4765</span></a>          }
<a name="l4766"><span class="linenum">4766</span></a>      }
<a name="l4767"><span class="linenum">4767</span></a>  
<a name="l4768"><span class="linenum">4768</span></a>      return '';
<a name="l4769"><span class="linenum">4769</span></a>  }
<a name="l4770"><span class="linenum">4770</span></a>  
<a name="l4771"><span class="linenum">4771</span></a>  <span class="comment">/**</span>
<a name="l4772"><span class="linenum">4772</span></a>  <span class="comment"> * Generate and return the subscribe or unsubscribe link for a forum.</span>
<a name="l4773"><span class="linenum">4773</span></a>  <span class="comment"> *</span>
<a name="l4774"><span class="linenum">4774</span></a>  <span class="comment"> * @param object $forum the forum. Fields used are $forum-&gt;id and $forum-&gt;forcesubscribe.</span>
<a name="l4775"><span class="linenum">4775</span></a>  <span class="comment"> * @param object $context the context object for this forum.</span>
<a name="l4776"><span class="linenum">4776</span></a>  <span class="comment"> * @param array $messages text used for the link in its various states</span>
<a name="l4777"><span class="linenum">4777</span></a>  <span class="comment"> *      (subscribed, unsubscribed, forcesubscribed or cantsubscribe).</span>
<a name="l4778"><span class="linenum">4778</span></a>  <span class="comment"> *      Any strings not passed in are taken from the $defaultmessages array</span>
<a name="l4779"><span class="linenum">4779</span></a>  <span class="comment"> *      at the top of the function.</span>
<a name="l4780"><span class="linenum">4780</span></a>  <span class="comment"> * @param bool $cantaccessagroup</span>
<a name="l4781"><span class="linenum">4781</span></a>  <span class="comment"> * @param bool $fakelink</span>
<a name="l4782"><span class="linenum">4782</span></a>  <span class="comment"> * @param bool $backtoindex</span>
<a name="l4783"><span class="linenum">4783</span></a>  <span class="comment"> * @param array $subscribed_forums</span>
<a name="l4784"><span class="linenum">4784</span></a>  <span class="comment"> * @return string</span>
<a name="l4785"><span class="linenum">4785</span></a>  <span class="comment"> */</span>
<a name="l4786"><span class="linenum">4786</span></a>  function <a class="function" onClick="logFunction('forum_get_subscribe_link')" href="../../_functions/forum_get_subscribe_link.html" onMouseOver="funcPopup(event,'forum_get_subscribe_link')">forum_get_subscribe_link</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it925" onMouseOver="hilite(925)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../../_variables/messages.html">$messages</a> = array(), <a class="var it41605" onMouseOver="hilite(41605)" onMouseOut="lolite()" onClick="logVariable('cantaccessagroup')" href="../../_variables/cantaccessagroup.html">$cantaccessagroup</a> = false, <a class="var it41606" onMouseOver="hilite(41606)" onMouseOut="lolite()" onClick="logVariable('fakelink')" href="../../_variables/fakelink.html">$fakelink</a>=true, <a class="var it503" onMouseOver="hilite(503)" onMouseOut="lolite()" onClick="logVariable('backtoindex')" href="../../_variables/backtoindex.html">$backtoindex</a>=false, <a class="var it41607" onMouseOver="hilite(41607)" onMouseOut="lolite()" onClick="logVariable('subscribed_forums')" href="../../_variables/subscribed_forums.html">$subscribed_forums</a>=null) {
<a name="l4787"><span class="linenum">4787</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l4788"><span class="linenum">4788</span></a>      <a class="var it41608" onMouseOver="hilite(41608)" onMouseOut="lolite()" onClick="logVariable('defaultmessages')" href="../../_variables/defaultmessages.html">$defaultmessages</a> = array(
<a name="l4789"><span class="linenum">4789</span></a>          'subscribed' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unsubscribe', 'forum'),
<a name="l4790"><span class="linenum">4790</span></a>          'unsubscribed' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscribe', 'forum'),
<a name="l4791"><span class="linenum">4791</span></a>          'cantaccessgroup' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('no'),
<a name="l4792"><span class="linenum">4792</span></a>          'forcesubscribed' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('everyoneissubscribed', 'forum'),
<a name="l4793"><span class="linenum">4793</span></a>          'cantsubscribe' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('disallowsubscribe','forum')
<a name="l4794"><span class="linenum">4794</span></a>      );
<a name="l4795"><span class="linenum">4795</span></a>      <a class="var it925" onMouseOver="hilite(925)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../../_variables/messages.html">$messages</a> = <a class="var it925" onMouseOver="hilite(925)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../../_variables/messages.html">$messages</a> + <a class="var it41608" onMouseOver="hilite(41608)" onMouseOut="lolite()" onClick="logVariable('defaultmessages')" href="../../_variables/defaultmessages.html">$defaultmessages</a>;
<a name="l4796"><span class="linenum">4796</span></a>  
<a name="l4797"><span class="linenum">4797</span></a>      if (\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_forcesubscribed')" href="../../_functions/is_forcesubscribed.html" onMouseOver="funcPopup(event,'is_forcesubscribed')">is_forcesubscribed</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l4798"><span class="linenum">4798</span></a>          return <a class="var it925" onMouseOver="hilite(925)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../../_variables/messages.html">$messages</a>['forcesubscribed'];
<a name="l4799"><span class="linenum">4799</span></a>      } else if (\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('subscription_disabled')" href="../../_functions/subscription_disabled.html" onMouseOver="funcPopup(event,'subscription_disabled')">subscription_disabled</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) &amp;&amp;
<a name="l4800"><span class="linenum">4800</span></a>              !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:managesubscriptions', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l4801"><span class="linenum">4801</span></a>          return <a class="var it925" onMouseOver="hilite(925)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../../_variables/messages.html">$messages</a>['cantsubscribe'];
<a name="l4802"><span class="linenum">4802</span></a>      } else if (<a class="var it41605" onMouseOver="hilite(41605)" onMouseOut="lolite()" onClick="logVariable('cantaccessagroup')" href="../../_variables/cantaccessagroup.html">$cantaccessagroup</a>) {
<a name="l4803"><span class="linenum">4803</span></a>          return <a class="var it925" onMouseOver="hilite(925)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../../_variables/messages.html">$messages</a>['cantaccessgroup'];
<a name="l4804"><span class="linenum">4804</span></a>      } else {
<a name="l4805"><span class="linenum">4805</span></a>          if (!<a class="function" onClick="logFunction('is_enrolled')" href="../../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, '', true)) {
<a name="l4806"><span class="linenum">4806</span></a>              return '';
<a name="l4807"><span class="linenum">4807</span></a>          }
<a name="l4808"><span class="linenum">4808</span></a>  
<a name="l4809"><span class="linenum">4809</span></a>          <a class="var it12020" onMouseOver="hilite(12020)" onMouseOut="lolite()" onClick="logVariable('subscribed')" href="../../_variables/subscribed.html">$subscribed</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_subscribed')" href="../../_functions/is_subscribed.html" onMouseOver="funcPopup(event,'is_subscribed')">is_subscribed</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l4810"><span class="linenum">4810</span></a>          if (<a class="var it12020" onMouseOver="hilite(12020)" onMouseOut="lolite()" onClick="logVariable('subscribed')" href="../../_variables/subscribed.html">$subscribed</a>) {
<a name="l4811"><span class="linenum">4811</span></a>              <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a> = <a class="var it925" onMouseOver="hilite(925)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../../_variables/messages.html">$messages</a>['subscribed'];
<a name="l4812"><span class="linenum">4812</span></a>              <a class="var it21272" onMouseOver="hilite(21272)" onMouseOut="lolite()" onClick="logVariable('linktitle')" href="../../_variables/linktitle.html">$linktitle</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscribestop', 'forum');
<a name="l4813"><span class="linenum">4813</span></a>          } else {
<a name="l4814"><span class="linenum">4814</span></a>              <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a> = <a class="var it925" onMouseOver="hilite(925)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../../_variables/messages.html">$messages</a>['unsubscribed'];
<a name="l4815"><span class="linenum">4815</span></a>              <a class="var it21272" onMouseOver="hilite(21272)" onMouseOut="lolite()" onClick="logVariable('linktitle')" href="../../_variables/linktitle.html">$linktitle</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscribestart', 'forum');
<a name="l4816"><span class="linenum">4816</span></a>          }
<a name="l4817"><span class="linenum">4817</span></a>  
<a name="l4818"><span class="linenum">4818</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = array();
<a name="l4819"><span class="linenum">4819</span></a>          if (<a class="var it503" onMouseOver="hilite(503)" onMouseOut="lolite()" onClick="logVariable('backtoindex')" href="../../_variables/backtoindex.html">$backtoindex</a>) {
<a name="l4820"><span class="linenum">4820</span></a>              <a class="var it41609" onMouseOver="hilite(41609)" onMouseOut="lolite()" onClick="logVariable('backtoindexlink')" href="../../_variables/backtoindexlink.html">$backtoindexlink</a> = '&amp;amp;backtoindex=1';
<a name="l4821"><span class="linenum">4821</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['backtoindex'] = 1;
<a name="l4822"><span class="linenum">4822</span></a>          } else {
<a name="l4823"><span class="linenum">4823</span></a>              <a class="var it41609" onMouseOver="hilite(41609)" onMouseOut="lolite()" onClick="logVariable('backtoindexlink')" href="../../_variables/backtoindexlink.html">$backtoindexlink</a> = '';
<a name="l4824"><span class="linenum">4824</span></a>          }
<a name="l4825"><span class="linenum">4825</span></a>          <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = '';
<a name="l4826"><span class="linenum">4826</span></a>  
<a name="l4827"><span class="linenum">4827</span></a>          if (<a class="var it41606" onMouseOver="hilite(41606)" onMouseOut="lolite()" onClick="logVariable('fakelink')" href="../../_variables/fakelink.html">$fakelink</a>) {
<a name="l4828"><span class="linenum">4828</span></a>              <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('requires')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/requires.html">requires</a>-&gt;<a class="function" onClick="logFunction('js')" href="../../_functions/js.html" onMouseOver="funcPopup(event,'js')">js</a>('<a class="filename" href="../../mod/forum/forum.js.html">/mod/forum/forum.js</a>');
<a name="l4829"><span class="linenum">4829</span></a>              <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('requires')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/requires.html">requires</a>-&gt;<a class="function" onClick="logFunction('js_function_call')" href="../../_functions/js_function_call.html" onMouseOver="funcPopup(event,'js_function_call')">js_function_call</a>('forum_produce_subscribe_link', array(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it41609" onMouseOver="hilite(41609)" onMouseOut="lolite()" onClick="logVariable('backtoindexlink')" href="../../_variables/backtoindexlink.html">$backtoindexlink</a>, <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a>, <a class="var it21272" onMouseOver="hilite(21272)" onMouseOut="lolite()" onClick="logVariable('linktitle')" href="../../_variables/linktitle.html">$linktitle</a>));
<a name="l4830"><span class="linenum">4830</span></a>              <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = &quot;&lt;noscript&gt;&quot;;
<a name="l4831"><span class="linenum">4831</span></a>          }
<a name="l4832"><span class="linenum">4832</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['id'] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l4833"><span class="linenum">4833</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['sesskey'] = <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>();
<a name="l4834"><span class="linenum">4834</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/subscribe.php.html">/mod/forum/subscribe.php</a>', <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>);
<a name="l4835"><span class="linenum">4835</span></a>          <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> .= <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('single_button')" href="../../_functions/single_button.html" onMouseOver="funcPopup(event,'single_button')">single_button</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a>, 'get', array('title'=&gt;<a class="var it21272" onMouseOver="hilite(21272)" onMouseOut="lolite()" onClick="logVariable('linktitle')" href="../../_variables/linktitle.html">$linktitle</a>));
<a name="l4836"><span class="linenum">4836</span></a>          if (<a class="var it41606" onMouseOver="hilite(41606)" onMouseOut="lolite()" onClick="logVariable('fakelink')" href="../../_variables/fakelink.html">$fakelink</a>) {
<a name="l4837"><span class="linenum">4837</span></a>              <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> .= '&lt;/noscript&gt;';
<a name="l4838"><span class="linenum">4838</span></a>          }
<a name="l4839"><span class="linenum">4839</span></a>  
<a name="l4840"><span class="linenum">4840</span></a>          return <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>;
<a name="l4841"><span class="linenum">4841</span></a>      }
<a name="l4842"><span class="linenum">4842</span></a>  }
<a name="l4843"><span class="linenum">4843</span></a>  
<a name="l4844"><span class="linenum">4844</span></a>  <span class="comment">/**</span>
<a name="l4845"><span class="linenum">4845</span></a>  <span class="comment"> * Returns true if user created new discussion already.</span>
<a name="l4846"><span class="linenum">4846</span></a>  <span class="comment"> *</span>
<a name="l4847"><span class="linenum">4847</span></a>  <span class="comment"> * @param int $forumid  The forum to check for postings</span>
<a name="l4848"><span class="linenum">4848</span></a>  <span class="comment"> * @param int $userid   The user to check for postings</span>
<a name="l4849"><span class="linenum">4849</span></a>  <span class="comment"> * @param int $groupid  The group to restrict the check to</span>
<a name="l4850"><span class="linenum">4850</span></a>  <span class="comment"> * @return bool</span>
<a name="l4851"><span class="linenum">4851</span></a>  <span class="comment"> */</span>
<a name="l4852"><span class="linenum">4852</span></a>  function <a class="function" onClick="logFunction('forum_user_has_posted_discussion')" href="../../_functions/forum_user_has_posted_discussion.html" onMouseOver="funcPopup(event,'forum_user_has_posted_discussion')">forum_user_has_posted_discussion</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> = null) {
<a name="l4853"><span class="linenum">4853</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4854"><span class="linenum">4854</span></a>  
<a name="l4855"><span class="linenum">4855</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT 'x'
<a name="l4856"><span class="linenum">4856</span></a>                FROM {forum_discussions} d, {forum_posts} p
<a name="l4857"><span class="linenum">4857</span></a>               WHERE d.forum = ? AND p.discussion = d.id AND p.parent = 0 AND p.userid = ?&quot;;
<a name="l4858"><span class="linenum">4858</span></a>  
<a name="l4859"><span class="linenum">4859</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = [<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>];
<a name="l4860"><span class="linenum">4860</span></a>  
<a name="l4861"><span class="linenum">4861</span></a>      if (<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>) {
<a name="l4862"><span class="linenum">4862</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> .= &quot; AND d.groupid = ?&quot;;
<a name="l4863"><span class="linenum">4863</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l4864"><span class="linenum">4864</span></a>      }
<a name="l4865"><span class="linenum">4865</span></a>  
<a name="l4866"><span class="linenum">4866</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_sql')" href="../../_functions/record_exists_sql.html" onMouseOver="funcPopup(event,'record_exists_sql')">record_exists_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l4867"><span class="linenum">4867</span></a>  }
<a name="l4868"><span class="linenum">4868</span></a>  
<a name="l4869"><span class="linenum">4869</span></a>  <span class="comment">/**</span>
<a name="l4870"><span class="linenum">4870</span></a>  <span class="comment"> * @global object</span>
<a name="l4871"><span class="linenum">4871</span></a>  <span class="comment"> * @global object</span>
<a name="l4872"><span class="linenum">4872</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l4873"><span class="linenum">4873</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l4874"><span class="linenum">4874</span></a>  <span class="comment"> * @return array</span>
<a name="l4875"><span class="linenum">4875</span></a>  <span class="comment"> */</span>
<a name="l4876"><span class="linenum">4876</span></a>  function <a class="function" onClick="logFunction('forum_discussions_user_has_posted_in')" href="../../_functions/forum_discussions_user_has_posted_in.html" onMouseOver="funcPopup(event,'forum_discussions_user_has_posted_in')">forum_discussions_user_has_posted_in</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l4877"><span class="linenum">4877</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4878"><span class="linenum">4878</span></a>  
<a name="l4879"><span class="linenum">4879</span></a>      <a class="var it41610" onMouseOver="hilite(41610)" onMouseOut="lolite()" onClick="logVariable('haspostedsql')" href="../../_variables/haspostedsql.html">$haspostedsql</a> = &quot;SELECT d.id AS id,
<a name="l4880"><span class="linenum">4880</span></a>                              d.*
<a name="l4881"><span class="linenum">4881</span></a>                         FROM {forum_posts} p,
<a name="l4882"><span class="linenum">4882</span></a>                              {forum_discussions} d
<a name="l4883"><span class="linenum">4883</span></a>                        WHERE p.discussion = d.id
<a name="l4884"><span class="linenum">4884</span></a>                          AND d.forum = ?
<a name="l4885"><span class="linenum">4885</span></a>                          AND p.userid = ?&quot;;
<a name="l4886"><span class="linenum">4886</span></a>  
<a name="l4887"><span class="linenum">4887</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it41610" onMouseOver="hilite(41610)" onMouseOut="lolite()" onClick="logVariable('haspostedsql')" href="../../_variables/haspostedsql.html">$haspostedsql</a>, array(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>));
<a name="l4888"><span class="linenum">4888</span></a>  }
<a name="l4889"><span class="linenum">4889</span></a>  
<a name="l4890"><span class="linenum">4890</span></a>  <span class="comment">/**</span>
<a name="l4891"><span class="linenum">4891</span></a>  <span class="comment"> * @global object</span>
<a name="l4892"><span class="linenum">4892</span></a>  <span class="comment"> * @global object</span>
<a name="l4893"><span class="linenum">4893</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l4894"><span class="linenum">4894</span></a>  <span class="comment"> * @param int $did</span>
<a name="l4895"><span class="linenum">4895</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l4896"><span class="linenum">4896</span></a>  <span class="comment"> * @return bool</span>
<a name="l4897"><span class="linenum">4897</span></a>  <span class="comment"> */</span>
<a name="l4898"><span class="linenum">4898</span></a>  function <a class="function" onClick="logFunction('forum_user_has_posted')" href="../../_functions/forum_user_has_posted.html" onMouseOver="funcPopup(event,'forum_user_has_posted')">forum_user_has_posted</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it40253" onMouseOver="hilite(40253)" onMouseOut="lolite()" onClick="logVariable('did')" href="../../_variables/did.html">$did</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l4899"><span class="linenum">4899</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4900"><span class="linenum">4900</span></a>  
<a name="l4901"><span class="linenum">4901</span></a>      if (empty(<a class="var it40253" onMouseOver="hilite(40253)" onMouseOut="lolite()" onClick="logVariable('did')" href="../../_variables/did.html">$did</a>)) {
<a name="l4902"><span class="linenum">4902</span></a>  <span class="comment">        // posted in any forum discussion?</span>
<a name="l4903"><span class="linenum">4903</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT 'x'
<a name="l4904"><span class="linenum">4904</span></a>                    FROM {forum_posts} p
<a name="l4905"><span class="linenum">4905</span></a>                    JOIN {forum_discussions} d ON d.id = p.discussion
<a name="l4906"><span class="linenum">4906</span></a>                   WHERE p.userid = :userid AND d.forum = :forumid&quot;;
<a name="l4907"><span class="linenum">4907</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_sql')" href="../../_functions/record_exists_sql.html" onMouseOver="funcPopup(event,'record_exists_sql')">record_exists_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('forumid'=&gt;<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>,'userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>));
<a name="l4908"><span class="linenum">4908</span></a>      } else {
<a name="l4909"><span class="linenum">4909</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('forum_posts', array('discussion'=&gt;<a class="var it40253" onMouseOver="hilite(40253)" onMouseOut="lolite()" onClick="logVariable('did')" href="../../_variables/did.html">$did</a>,'userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>));
<a name="l4910"><span class="linenum">4910</span></a>      }
<a name="l4911"><span class="linenum">4911</span></a>  }
<a name="l4912"><span class="linenum">4912</span></a>  
<a name="l4913"><span class="linenum">4913</span></a>  <span class="comment">/**</span>
<a name="l4914"><span class="linenum">4914</span></a>  <span class="comment"> * Returns creation time of the first user's post in given discussion</span>
<a name="l4915"><span class="linenum">4915</span></a>  <span class="comment"> * @global object $DB</span>
<a name="l4916"><span class="linenum">4916</span></a>  <span class="comment"> * @param int $did Discussion id</span>
<a name="l4917"><span class="linenum">4917</span></a>  <span class="comment"> * @param int $userid User id</span>
<a name="l4918"><span class="linenum">4918</span></a>  <span class="comment"> * @return int|bool post creation time stamp or return false</span>
<a name="l4919"><span class="linenum">4919</span></a>  <span class="comment"> */</span>
<a name="l4920"><span class="linenum">4920</span></a>  function <a class="function" onClick="logFunction('forum_get_user_posted_time')" href="../../_functions/forum_get_user_posted_time.html" onMouseOver="funcPopup(event,'forum_get_user_posted_time')">forum_get_user_posted_time</a>(<a class="var it40253" onMouseOver="hilite(40253)" onMouseOut="lolite()" onClick="logVariable('did')" href="../../_variables/did.html">$did</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l4921"><span class="linenum">4921</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4922"><span class="linenum">4922</span></a>  
<a name="l4923"><span class="linenum">4923</span></a>      <a class="var it40548" onMouseOver="hilite(40548)" onMouseOut="lolite()" onClick="logVariable('posttime')" href="../../_variables/posttime.html">$posttime</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('forum_posts', '<a class="phpfunction" onClick="logFunction('MIN')" href="../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">MIN</a>(created)', array('userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'discussion'=&gt;<a class="var it40253" onMouseOver="hilite(40253)" onMouseOut="lolite()" onClick="logVariable('did')" href="../../_variables/did.html">$did</a>));
<a name="l4924"><span class="linenum">4924</span></a>      if (empty(<a class="var it40548" onMouseOver="hilite(40548)" onMouseOut="lolite()" onClick="logVariable('posttime')" href="../../_variables/posttime.html">$posttime</a>)) {
<a name="l4925"><span class="linenum">4925</span></a>          return false;
<a name="l4926"><span class="linenum">4926</span></a>      }
<a name="l4927"><span class="linenum">4927</span></a>      return <a class="var it40548" onMouseOver="hilite(40548)" onMouseOut="lolite()" onClick="logVariable('posttime')" href="../../_variables/posttime.html">$posttime</a>;
<a name="l4928"><span class="linenum">4928</span></a>  }
<a name="l4929"><span class="linenum">4929</span></a>  
<a name="l4930"><span class="linenum">4930</span></a>  <span class="comment">/**</span>
<a name="l4931"><span class="linenum">4931</span></a>  <span class="comment"> * @global object</span>
<a name="l4932"><span class="linenum">4932</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l4933"><span class="linenum">4933</span></a>  <span class="comment"> * @param object $currentgroup</span>
<a name="l4934"><span class="linenum">4934</span></a>  <span class="comment"> * @param int $unused</span>
<a name="l4935"><span class="linenum">4935</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l4936"><span class="linenum">4936</span></a>  <span class="comment"> * @param object $context</span>
<a name="l4937"><span class="linenum">4937</span></a>  <span class="comment"> * @return bool</span>
<a name="l4938"><span class="linenum">4938</span></a>  <span class="comment"> */</span>
<a name="l4939"><span class="linenum">4939</span></a>  function <a class="function" onClick="logFunction('forum_user_can_post_discussion')" href="../../_functions/forum_user_can_post_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_post_discussion')">forum_user_can_post_discussion</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>=null, <a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>=-1, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>=NULL, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>=NULL) {
<a name="l4940"><span class="linenum">4940</span></a>  <span class="comment">// $forum is an object</span>
<a name="l4941"><span class="linenum">4941</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l4942"><span class="linenum">4942</span></a>  
<a name="l4943"><span class="linenum">4943</span></a>  <span class="comment">    // shortcut - guest and not-logged-in users can not post</span>
<a name="l4944"><span class="linenum">4944</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>() or !<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l4945"><span class="linenum">4945</span></a>          return false;
<a name="l4946"><span class="linenum">4946</span></a>      }
<a name="l4947"><span class="linenum">4947</span></a>  
<a name="l4948"><span class="linenum">4948</span></a>      if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l4949"><span class="linenum">4949</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('missing cm', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l4950"><span class="linenum">4950</span></a>          if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)) {
<a name="l4951"><span class="linenum">4951</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidcoursemodule');
<a name="l4952"><span class="linenum">4952</span></a>          }
<a name="l4953"><span class="linenum">4953</span></a>      }
<a name="l4954"><span class="linenum">4954</span></a>  
<a name="l4955"><span class="linenum">4955</span></a>      if (!<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l4956"><span class="linenum">4956</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4957"><span class="linenum">4957</span></a>      }
<a name="l4958"><span class="linenum">4958</span></a>  
<a name="l4959"><span class="linenum">4959</span></a>      if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> === null) {
<a name="l4960"><span class="linenum">4960</span></a>          <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = <a class="function" onClick="logFunction('groups_get_activity_group')" href="../../_functions/groups_get_activity_group.html" onMouseOver="funcPopup(event,'groups_get_activity_group')">groups_get_activity_group</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l4961"><span class="linenum">4961</span></a>      }
<a name="l4962"><span class="linenum">4962</span></a>  
<a name="l4963"><span class="linenum">4963</span></a>      <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l4964"><span class="linenum">4964</span></a>  
<a name="l4965"><span class="linenum">4965</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'news') {
<a name="l4966"><span class="linenum">4966</span></a>          <a class="var it25100" onMouseOver="hilite(25100)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../../_variables/capname.html">$capname</a> = 'mod/forum:addnews';
<a name="l4967"><span class="linenum">4967</span></a>      } else if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'qanda') {
<a name="l4968"><span class="linenum">4968</span></a>          <a class="var it25100" onMouseOver="hilite(25100)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../../_variables/capname.html">$capname</a> = 'mod/forum:addquestion';
<a name="l4969"><span class="linenum">4969</span></a>      } else {
<a name="l4970"><span class="linenum">4970</span></a>          <a class="var it25100" onMouseOver="hilite(25100)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../../_variables/capname.html">$capname</a> = 'mod/forum:startdiscussion';
<a name="l4971"><span class="linenum">4971</span></a>      }
<a name="l4972"><span class="linenum">4972</span></a>  
<a name="l4973"><span class="linenum">4973</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it25100" onMouseOver="hilite(25100)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../../_variables/capname.html">$capname</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l4974"><span class="linenum">4974</span></a>          return false;
<a name="l4975"><span class="linenum">4975</span></a>      }
<a name="l4976"><span class="linenum">4976</span></a>  
<a name="l4977"><span class="linenum">4977</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'single') {
<a name="l4978"><span class="linenum">4978</span></a>          return false;
<a name="l4979"><span class="linenum">4979</span></a>      }
<a name="l4980"><span class="linenum">4980</span></a>  
<a name="l4981"><span class="linenum">4981</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'eachuser') {
<a name="l4982"><span class="linenum">4982</span></a>          if (<a class="function" onClick="logFunction('forum_user_has_posted_discussion')" href="../../_functions/forum_user_has_posted_discussion.html" onMouseOver="funcPopup(event,'forum_user_has_posted_discussion')">forum_user_has_posted_discussion</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>)) {
<a name="l4983"><span class="linenum">4983</span></a>              return false;
<a name="l4984"><span class="linenum">4984</span></a>          }
<a name="l4985"><span class="linenum">4985</span></a>      }
<a name="l4986"><span class="linenum">4986</span></a>  
<a name="l4987"><span class="linenum">4987</span></a>      if (!<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> or <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l4988"><span class="linenum">4988</span></a>          return true;
<a name="l4989"><span class="linenum">4989</span></a>      }
<a name="l4990"><span class="linenum">4990</span></a>  
<a name="l4991"><span class="linenum">4991</span></a>      if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l4992"><span class="linenum">4992</span></a>          return <a class="function" onClick="logFunction('groups_is_member')" href="../../_functions/groups_is_member.html" onMouseOver="funcPopup(event,'groups_is_member')">groups_is_member</a>(<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>);
<a name="l4993"><span class="linenum">4993</span></a>      } else {
<a name="l4994"><span class="linenum">4994</span></a>  <span class="comment">        // no group membership and no accessallgroups means no new discussions</span>
<a name="l4995"><span class="linenum">4995</span></a>  <span class="comment">        // reverted to 1.7 behaviour in 1.9+,  buggy in 1.8.0-1.9.0</span>
<a name="l4996"><span class="linenum">4996</span></a>          return false;
<a name="l4997"><span class="linenum">4997</span></a>      }
<a name="l4998"><span class="linenum">4998</span></a>  }
<a name="l4999"><span class="linenum">4999</span></a>  
<a name="l5000"><span class="linenum">5000</span></a>  <span class="comment">/**</span>
<a name="l5001"><span class="linenum">5001</span></a>  <span class="comment"> * This function checks whether the user can reply to posts in a forum</span>
<a name="l5002"><span class="linenum">5002</span></a>  <span class="comment"> * discussion. Use forum_user_can_post_discussion() to check whether the user</span>
<a name="l5003"><span class="linenum">5003</span></a>  <span class="comment"> * can start discussions.</span>
<a name="l5004"><span class="linenum">5004</span></a>  <span class="comment"> *</span>
<a name="l5005"><span class="linenum">5005</span></a>  <span class="comment"> * @global object</span>
<a name="l5006"><span class="linenum">5006</span></a>  <span class="comment"> * @global object</span>
<a name="l5007"><span class="linenum">5007</span></a>  <span class="comment"> * @uses DEBUG_DEVELOPER</span>
<a name="l5008"><span class="linenum">5008</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l5009"><span class="linenum">5009</span></a>  <span class="comment"> * @uses VISIBLEGROUPS</span>
<a name="l5010"><span class="linenum">5010</span></a>  <span class="comment"> * @param object $forum forum object</span>
<a name="l5011"><span class="linenum">5011</span></a>  <span class="comment"> * @param object $discussion</span>
<a name="l5012"><span class="linenum">5012</span></a>  <span class="comment"> * @param object $user</span>
<a name="l5013"><span class="linenum">5013</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l5014"><span class="linenum">5014</span></a>  <span class="comment"> * @param object $course</span>
<a name="l5015"><span class="linenum">5015</span></a>  <span class="comment"> * @param object $context</span>
<a name="l5016"><span class="linenum">5016</span></a>  <span class="comment"> * @return bool</span>
<a name="l5017"><span class="linenum">5017</span></a>  <span class="comment"> */</span>
<a name="l5018"><span class="linenum">5018</span></a>  function <a class="function" onClick="logFunction('forum_user_can_post')" href="../../_functions/forum_user_can_post.html" onMouseOver="funcPopup(event,'forum_user_can_post')">forum_user_can_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>=NULL, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>=NULL, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>=NULL, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>=NULL) {
<a name="l5019"><span class="linenum">5019</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l5020"><span class="linenum">5020</span></a>      if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l5021"><span class="linenum">5021</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l5022"><span class="linenum">5022</span></a>      }
<a name="l5023"><span class="linenum">5023</span></a>  
<a name="l5024"><span class="linenum">5024</span></a>  <span class="comment">    // shortcut - guest and not-logged-in users can not post</span>
<a name="l5025"><span class="linenum">5025</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) or empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l5026"><span class="linenum">5026</span></a>          return false;
<a name="l5027"><span class="linenum">5027</span></a>      }
<a name="l5028"><span class="linenum">5028</span></a>  
<a name="l5029"><span class="linenum">5029</span></a>      if (!isset(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>)) {
<a name="l5030"><span class="linenum">5030</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('incorrect discussion parameter', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5031"><span class="linenum">5031</span></a>          return false;
<a name="l5032"><span class="linenum">5032</span></a>      }
<a name="l5033"><span class="linenum">5033</span></a>  
<a name="l5034"><span class="linenum">5034</span></a>      if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l5035"><span class="linenum">5035</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('missing cm', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5036"><span class="linenum">5036</span></a>          if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)) {
<a name="l5037"><span class="linenum">5037</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidcoursemodule');
<a name="l5038"><span class="linenum">5038</span></a>          }
<a name="l5039"><span class="linenum">5039</span></a>      }
<a name="l5040"><span class="linenum">5040</span></a>  
<a name="l5041"><span class="linenum">5041</span></a>      if (!<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l5042"><span class="linenum">5042</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('missing course', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5043"><span class="linenum">5043</span></a>          if (!<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>))) {
<a name="l5044"><span class="linenum">5044</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidcourseid');
<a name="l5045"><span class="linenum">5045</span></a>          }
<a name="l5046"><span class="linenum">5046</span></a>      }
<a name="l5047"><span class="linenum">5047</span></a>  
<a name="l5048"><span class="linenum">5048</span></a>      if (!<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l5049"><span class="linenum">5049</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5050"><span class="linenum">5050</span></a>      }
<a name="l5051"><span class="linenum">5051</span></a>  
<a name="l5052"><span class="linenum">5052</span></a>  <span class="comment">    // normal users with temporary guest access can not post, suspended users can not post either</span>
<a name="l5053"><span class="linenum">5053</span></a>      if (!<a class="function" onClick="logFunction('is_viewing')" href="../../_functions/is_viewing.html" onMouseOver="funcPopup(event,'is_viewing')">is_viewing</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) and !<a class="function" onClick="logFunction('is_enrolled')" href="../../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, '', true)) {
<a name="l5054"><span class="linenum">5054</span></a>          return false;
<a name="l5055"><span class="linenum">5055</span></a>      }
<a name="l5056"><span class="linenum">5056</span></a>  
<a name="l5057"><span class="linenum">5057</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'news') {
<a name="l5058"><span class="linenum">5058</span></a>          <a class="var it25100" onMouseOver="hilite(25100)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../../_variables/capname.html">$capname</a> = 'mod/forum:replynews';
<a name="l5059"><span class="linenum">5059</span></a>      } else {
<a name="l5060"><span class="linenum">5060</span></a>          <a class="var it25100" onMouseOver="hilite(25100)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../../_variables/capname.html">$capname</a> = 'mod/forum:replypost';
<a name="l5061"><span class="linenum">5061</span></a>      }
<a name="l5062"><span class="linenum">5062</span></a>  
<a name="l5063"><span class="linenum">5063</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it25100" onMouseOver="hilite(25100)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../../_variables/capname.html">$capname</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l5064"><span class="linenum">5064</span></a>          return false;
<a name="l5065"><span class="linenum">5065</span></a>      }
<a name="l5066"><span class="linenum">5066</span></a>  
<a name="l5067"><span class="linenum">5067</span></a>      if (!<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>)) {
<a name="l5068"><span class="linenum">5068</span></a>          return true;
<a name="l5069"><span class="linenum">5069</span></a>      }
<a name="l5070"><span class="linenum">5070</span></a>  
<a name="l5071"><span class="linenum">5071</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l5072"><span class="linenum">5072</span></a>          return true;
<a name="l5073"><span class="linenum">5073</span></a>      }
<a name="l5074"><span class="linenum">5074</span></a>  
<a name="l5075"><span class="linenum">5075</span></a>      if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == <a class="constant" onClick="logConstant('VISIBLEGROUPS')" href="../../_constants/VISIBLEGROUPS.html" onMouseOver="constPopup(event,'VISIBLEGROUPS')">VISIBLEGROUPS</a>) {
<a name="l5076"><span class="linenum">5076</span></a>          if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> == -1) {
<a name="l5077"><span class="linenum">5077</span></a>  <span class="comment">            // allow students to reply to all participants discussions - this was not possible in Moodle &lt;1.8</span>
<a name="l5078"><span class="linenum">5078</span></a>              return true;
<a name="l5079"><span class="linenum">5079</span></a>          }
<a name="l5080"><span class="linenum">5080</span></a>          return <a class="function" onClick="logFunction('groups_is_member')" href="../../_functions/groups_is_member.html" onMouseOver="funcPopup(event,'groups_is_member')">groups_is_member</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>);
<a name="l5081"><span class="linenum">5081</span></a>  
<a name="l5082"><span class="linenum">5082</span></a>      } else {
<a name="l5083"><span class="linenum">5083</span></a>  <span class="comment">        //separate groups</span>
<a name="l5084"><span class="linenum">5084</span></a>          if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> == -1) {
<a name="l5085"><span class="linenum">5085</span></a>              return false;
<a name="l5086"><span class="linenum">5086</span></a>          }
<a name="l5087"><span class="linenum">5087</span></a>          return <a class="function" onClick="logFunction('groups_is_member')" href="../../_functions/groups_is_member.html" onMouseOver="funcPopup(event,'groups_is_member')">groups_is_member</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>);
<a name="l5088"><span class="linenum">5088</span></a>      }
<a name="l5089"><span class="linenum">5089</span></a>  }
<a name="l5090"><span class="linenum">5090</span></a>  
<a name="l5091"><span class="linenum">5091</span></a>  <span class="comment">/**</span>
<a name="l5092"><span class="linenum">5092</span></a>  <span class="comment">* Check to ensure a user can view a timed discussion.</span>
<a name="l5093"><span class="linenum">5093</span></a>  <span class="comment">*</span>
<a name="l5094"><span class="linenum">5094</span></a>  <span class="comment">* @param object $discussion</span>
<a name="l5095"><span class="linenum">5095</span></a>  <span class="comment">* @param object $user</span>
<a name="l5096"><span class="linenum">5096</span></a>  <span class="comment">* @param object $context</span>
<a name="l5097"><span class="linenum">5097</span></a>  <span class="comment">* @return boolean returns true if they can view post, false otherwise</span>
<a name="l5098"><span class="linenum">5098</span></a>  <span class="comment">*/</span>
<a name="l5099"><span class="linenum">5099</span></a>  function <a class="function" onClick="logFunction('forum_user_can_see_timed_discussion')" href="../../_functions/forum_user_can_see_timed_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_see_timed_discussion')">forum_user_can_see_timed_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l5100"><span class="linenum">5100</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l5101"><span class="linenum">5101</span></a>  
<a name="l5102"><span class="linenum">5102</span></a>  <span class="comment">    // Check that the user can view a discussion that is normally hidden due to access times.</span>
<a name="l5103"><span class="linenum">5103</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l5104"><span class="linenum">5104</span></a>          <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l5105"><span class="linenum">5105</span></a>          if ((<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timestart')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> != 0 &amp;&amp; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timestart')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> &gt; <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>)
<a name="l5106"><span class="linenum">5106</span></a>              || (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timeend')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a> != 0 &amp;&amp; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('timeend')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a> &lt; <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>)) {
<a name="l5107"><span class="linenum">5107</span></a>              if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l5108"><span class="linenum">5108</span></a>                  return false;
<a name="l5109"><span class="linenum">5109</span></a>              }
<a name="l5110"><span class="linenum">5110</span></a>          }
<a name="l5111"><span class="linenum">5111</span></a>      }
<a name="l5112"><span class="linenum">5112</span></a>  
<a name="l5113"><span class="linenum">5113</span></a>      return true;
<a name="l5114"><span class="linenum">5114</span></a>  }
<a name="l5115"><span class="linenum">5115</span></a>  
<a name="l5116"><span class="linenum">5116</span></a>  <span class="comment">/**</span>
<a name="l5117"><span class="linenum">5117</span></a>  <span class="comment">* Check to ensure a user can view a group discussion.</span>
<a name="l5118"><span class="linenum">5118</span></a>  <span class="comment">*</span>
<a name="l5119"><span class="linenum">5119</span></a>  <span class="comment">* @param object $discussion</span>
<a name="l5120"><span class="linenum">5120</span></a>  <span class="comment">* @param object $cm</span>
<a name="l5121"><span class="linenum">5121</span></a>  <span class="comment">* @param object $context</span>
<a name="l5122"><span class="linenum">5122</span></a>  <span class="comment">* @return boolean returns true if they can view post, false otherwise</span>
<a name="l5123"><span class="linenum">5123</span></a>  <span class="comment">*/</span>
<a name="l5124"><span class="linenum">5124</span></a>  function <a class="function" onClick="logFunction('forum_user_can_see_group_discussion')" href="../../_functions/forum_user_can_see_group_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_see_group_discussion')">forum_user_can_see_group_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l5125"><span class="linenum">5125</span></a>  
<a name="l5126"><span class="linenum">5126</span></a>  <span class="comment">    // If it's a grouped discussion, make sure the user is a member.</span>
<a name="l5127"><span class="linenum">5127</span></a>      if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> &gt; 0) {
<a name="l5128"><span class="linenum">5128</span></a>          <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l5129"><span class="linenum">5129</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>) {
<a name="l5130"><span class="linenum">5130</span></a>              return <a class="function" onClick="logFunction('groups_is_member')" href="../../_functions/groups_is_member.html" onMouseOver="funcPopup(event,'groups_is_member')">groups_is_member</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>) || <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l5131"><span class="linenum">5131</span></a>          }
<a name="l5132"><span class="linenum">5132</span></a>      }
<a name="l5133"><span class="linenum">5133</span></a>  
<a name="l5134"><span class="linenum">5134</span></a>      return true;
<a name="l5135"><span class="linenum">5135</span></a>  }
<a name="l5136"><span class="linenum">5136</span></a>  
<a name="l5137"><span class="linenum">5137</span></a>  <span class="comment">/**</span>
<a name="l5138"><span class="linenum">5138</span></a>  <span class="comment"> * @global object</span>
<a name="l5139"><span class="linenum">5139</span></a>  <span class="comment"> * @global object</span>
<a name="l5140"><span class="linenum">5140</span></a>  <span class="comment"> * @uses DEBUG_DEVELOPER</span>
<a name="l5141"><span class="linenum">5141</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l5142"><span class="linenum">5142</span></a>  <span class="comment"> * @param object $discussion</span>
<a name="l5143"><span class="linenum">5143</span></a>  <span class="comment"> * @param object $context</span>
<a name="l5144"><span class="linenum">5144</span></a>  <span class="comment"> * @param object $user</span>
<a name="l5145"><span class="linenum">5145</span></a>  <span class="comment"> * @return bool</span>
<a name="l5146"><span class="linenum">5146</span></a>  <span class="comment"> */</span>
<a name="l5147"><span class="linenum">5147</span></a>  function <a class="function" onClick="logFunction('forum_user_can_see_discussion')" href="../../_functions/forum_user_can_see_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_see_discussion')">forum_user_can_see_discussion</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>=NULL) {
<a name="l5148"><span class="linenum">5148</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l5149"><span class="linenum">5149</span></a>  
<a name="l5150"><span class="linenum">5150</span></a>      if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) || empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l5151"><span class="linenum">5151</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l5152"><span class="linenum">5152</span></a>      }
<a name="l5153"><span class="linenum">5153</span></a>  
<a name="l5154"><span class="linenum">5154</span></a>  <span class="comment">    // retrieve objects (yuk)</span>
<a name="l5155"><span class="linenum">5155</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l5156"><span class="linenum">5156</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('missing full forum', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5157"><span class="linenum">5157</span></a>          if (!<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum',array('id'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>))) {
<a name="l5158"><span class="linenum">5158</span></a>              return false;
<a name="l5159"><span class="linenum">5159</span></a>          }
<a name="l5160"><span class="linenum">5160</span></a>      }
<a name="l5161"><span class="linenum">5161</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>)) {
<a name="l5162"><span class="linenum">5162</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('missing full discussion', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5163"><span class="linenum">5163</span></a>          if (!<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions',array('id'=&gt;<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>))) {
<a name="l5164"><span class="linenum">5164</span></a>              return false;
<a name="l5165"><span class="linenum">5165</span></a>          }
<a name="l5166"><span class="linenum">5166</span></a>      }
<a name="l5167"><span class="linenum">5167</span></a>      if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)) {
<a name="l5168"><span class="linenum">5168</span></a>          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidcoursemodule');
<a name="l5169"><span class="linenum">5169</span></a>      }
<a name="l5170"><span class="linenum">5170</span></a>  
<a name="l5171"><span class="linenum">5171</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l5172"><span class="linenum">5172</span></a>          return false;
<a name="l5173"><span class="linenum">5173</span></a>      }
<a name="l5174"><span class="linenum">5174</span></a>  
<a name="l5175"><span class="linenum">5175</span></a>      if (!<a class="function" onClick="logFunction('forum_user_can_see_timed_discussion')" href="../../_functions/forum_user_can_see_timed_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_see_timed_discussion')">forum_user_can_see_timed_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l5176"><span class="linenum">5176</span></a>          return false;
<a name="l5177"><span class="linenum">5177</span></a>      }
<a name="l5178"><span class="linenum">5178</span></a>  
<a name="l5179"><span class="linenum">5179</span></a>      if (!<a class="function" onClick="logFunction('forum_user_can_see_group_discussion')" href="../../_functions/forum_user_can_see_group_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_see_group_discussion')">forum_user_can_see_group_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l5180"><span class="linenum">5180</span></a>          return false;
<a name="l5181"><span class="linenum">5181</span></a>      }
<a name="l5182"><span class="linenum">5182</span></a>  
<a name="l5183"><span class="linenum">5183</span></a>      return true;
<a name="l5184"><span class="linenum">5184</span></a>  }
<a name="l5185"><span class="linenum">5185</span></a>  
<a name="l5186"><span class="linenum">5186</span></a>  <span class="comment">/**</span>
<a name="l5187"><span class="linenum">5187</span></a>  <span class="comment"> * @global object</span>
<a name="l5188"><span class="linenum">5188</span></a>  <span class="comment"> * @global object</span>
<a name="l5189"><span class="linenum">5189</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l5190"><span class="linenum">5190</span></a>  <span class="comment"> * @param object $discussion</span>
<a name="l5191"><span class="linenum">5191</span></a>  <span class="comment"> * @param object $post</span>
<a name="l5192"><span class="linenum">5192</span></a>  <span class="comment"> * @param object $user</span>
<a name="l5193"><span class="linenum">5193</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l5194"><span class="linenum">5194</span></a>  <span class="comment"> * @return bool</span>
<a name="l5195"><span class="linenum">5195</span></a>  <span class="comment"> */</span>
<a name="l5196"><span class="linenum">5196</span></a>  function <a class="function" onClick="logFunction('forum_user_can_see_post')" href="../../_functions/forum_user_can_see_post.html" onMouseOver="funcPopup(event,'forum_user_can_see_post')">forum_user_can_see_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>=NULL, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>=NULL) {
<a name="l5197"><span class="linenum">5197</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l5198"><span class="linenum">5198</span></a>  
<a name="l5199"><span class="linenum">5199</span></a>  <span class="comment">    // Context used throughout function.</span>
<a name="l5200"><span class="linenum">5200</span></a>      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5201"><span class="linenum">5201</span></a>  
<a name="l5202"><span class="linenum">5202</span></a>  <span class="comment">    // retrieve objects (yuk)</span>
<a name="l5203"><span class="linenum">5203</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l5204"><span class="linenum">5204</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('missing full forum', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5205"><span class="linenum">5205</span></a>          if (!<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum',array('id'=&gt;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>))) {
<a name="l5206"><span class="linenum">5206</span></a>              return false;
<a name="l5207"><span class="linenum">5207</span></a>          }
<a name="l5208"><span class="linenum">5208</span></a>      }
<a name="l5209"><span class="linenum">5209</span></a>  
<a name="l5210"><span class="linenum">5210</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>)) {
<a name="l5211"><span class="linenum">5211</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('missing full discussion', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5212"><span class="linenum">5212</span></a>          if (!<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussions',array('id'=&gt;<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>))) {
<a name="l5213"><span class="linenum">5213</span></a>              return false;
<a name="l5214"><span class="linenum">5214</span></a>          }
<a name="l5215"><span class="linenum">5215</span></a>      }
<a name="l5216"><span class="linenum">5216</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>)) {
<a name="l5217"><span class="linenum">5217</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('missing full post', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5218"><span class="linenum">5218</span></a>          if (!<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_posts',array('id'=&gt;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>))) {
<a name="l5219"><span class="linenum">5219</span></a>              return false;
<a name="l5220"><span class="linenum">5220</span></a>          }
<a name="l5221"><span class="linenum">5221</span></a>      }
<a name="l5222"><span class="linenum">5222</span></a>  
<a name="l5223"><span class="linenum">5223</span></a>      if (!isset(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) &amp;&amp; isset(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>)) {
<a name="l5224"><span class="linenum">5224</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>;
<a name="l5225"><span class="linenum">5225</span></a>      }
<a name="l5226"><span class="linenum">5226</span></a>  
<a name="l5227"><span class="linenum">5227</span></a>      if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l5228"><span class="linenum">5228</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('missing cm', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5229"><span class="linenum">5229</span></a>          if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)) {
<a name="l5230"><span class="linenum">5230</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidcoursemodule');
<a name="l5231"><span class="linenum">5231</span></a>          }
<a name="l5232"><span class="linenum">5232</span></a>      }
<a name="l5233"><span class="linenum">5233</span></a>  
<a name="l5234"><span class="linenum">5234</span></a>      if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) || empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l5235"><span class="linenum">5235</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l5236"><span class="linenum">5236</span></a>      }
<a name="l5237"><span class="linenum">5237</span></a>  
<a name="l5238"><span class="linenum">5238</span></a>      <a class="var it41611" onMouseOver="hilite(41611)" onMouseOut="lolite()" onClick="logVariable('canviewdiscussion')" href="../../_variables/canviewdiscussion.html">$canviewdiscussion</a> = !empty(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;caps['mod/forum:viewdiscussion']) || <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5239"><span class="linenum">5239</span></a>      if (!<a class="var it41611" onMouseOver="hilite(41611)" onMouseOut="lolite()" onClick="logVariable('canviewdiscussion')" href="../../_variables/canviewdiscussion.html">$canviewdiscussion</a> &amp;&amp; !<a class="function" onClick="logFunction('has_all_capabilities')" href="../../_functions/has_all_capabilities.html" onMouseOver="funcPopup(event,'has_all_capabilities')">has_all_capabilities</a>(array('moodle/user:viewdetails', 'moodle/user:readuserposts'), <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>))) {
<a name="l5240"><span class="linenum">5240</span></a>          return false;
<a name="l5241"><span class="linenum">5241</span></a>      }
<a name="l5242"><span class="linenum">5242</span></a>  
<a name="l5243"><span class="linenum">5243</span></a>      if (isset(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('uservisible')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/uservisible.html">uservisible</a>)) {
<a name="l5244"><span class="linenum">5244</span></a>          if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('uservisible')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/uservisible.html">uservisible</a>) {
<a name="l5245"><span class="linenum">5245</span></a>              return false;
<a name="l5246"><span class="linenum">5246</span></a>          }
<a name="l5247"><span class="linenum">5247</span></a>      } else {
<a name="l5248"><span class="linenum">5248</span></a>          if (!\core_availability\<a class="class" onClick="logClass('info_module')" href="../../_classes/info_module.html" onMouseOver="classPopup(event,'info_module')">info_module</a>::<a class="function" onClick="logFunction('is_user_visible')" href="../../_functions/is_user_visible.html" onMouseOver="funcPopup(event,'is_user_visible')">is_user_visible</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, false)) {
<a name="l5249"><span class="linenum">5249</span></a>              return false;
<a name="l5250"><span class="linenum">5250</span></a>          }
<a name="l5251"><span class="linenum">5251</span></a>      }
<a name="l5252"><span class="linenum">5252</span></a>  
<a name="l5253"><span class="linenum">5253</span></a>      if (!<a class="function" onClick="logFunction('forum_user_can_see_timed_discussion')" href="../../_functions/forum_user_can_see_timed_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_see_timed_discussion')">forum_user_can_see_timed_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l5254"><span class="linenum">5254</span></a>          return false;
<a name="l5255"><span class="linenum">5255</span></a>      }
<a name="l5256"><span class="linenum">5256</span></a>  
<a name="l5257"><span class="linenum">5257</span></a>      if (!<a class="function" onClick="logFunction('forum_user_can_see_group_discussion')" href="../../_functions/forum_user_can_see_group_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_see_group_discussion')">forum_user_can_see_group_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l5258"><span class="linenum">5258</span></a>          return false;
<a name="l5259"><span class="linenum">5259</span></a>      }
<a name="l5260"><span class="linenum">5260</span></a>  
<a name="l5261"><span class="linenum">5261</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'qanda') {
<a name="l5262"><span class="linenum">5262</span></a>          <a class="var it6180" onMouseOver="hilite(6180)" onMouseOut="lolite()" onClick="logVariable('firstpost')" href="../../_variables/firstpost.html">$firstpost</a> = <a class="function" onClick="logFunction('forum_get_firstpost_from_discussion')" href="../../_functions/forum_get_firstpost_from_discussion.html" onMouseOver="funcPopup(event,'forum_get_firstpost_from_discussion')">forum_get_firstpost_from_discussion</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5263"><span class="linenum">5263</span></a>          <a class="var it41612" onMouseOver="hilite(41612)" onMouseOut="lolite()" onClick="logVariable('userfirstpost')" href="../../_variables/userfirstpost.html">$userfirstpost</a> = <a class="function" onClick="logFunction('forum_get_user_posted_time')" href="../../_functions/forum_get_user_posted_time.html" onMouseOver="funcPopup(event,'forum_get_user_posted_time')">forum_get_user_posted_time</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5264"><span class="linenum">5264</span></a>  
<a name="l5265"><span class="linenum">5265</span></a>          return ((<a class="var it41612" onMouseOver="hilite(41612)" onMouseOut="lolite()" onClick="logVariable('userfirstpost')" href="../../_variables/userfirstpost.html">$userfirstpost</a> !== false &amp;&amp; (<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it41612" onMouseOver="hilite(41612)" onMouseOut="lolite()" onClick="logVariable('userfirstpost')" href="../../_variables/userfirstpost.html">$userfirstpost</a> &gt;= <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('maxeditingtime')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/maxeditingtime.html">maxeditingtime</a>)) ||
<a name="l5266"><span class="linenum">5266</span></a>                  <a class="var it6180" onMouseOver="hilite(6180)" onMouseOut="lolite()" onClick="logVariable('firstpost')" href="../../_variables/firstpost.html">$firstpost</a>-&gt;<a onClick="logVariable('id')" class="var it44624" onMouseOver="hilite(44624)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> || <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> == <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> || <a class="var it6180" onMouseOver="hilite(6180)" onMouseOut="lolite()" onClick="logVariable('firstpost')" href="../../_variables/firstpost.html">$firstpost</a>-&gt;<a onClick="logVariable('userid')" class="var it44624" onMouseOver="hilite(44624)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> == <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> ||
<a name="l5267"><span class="linenum">5267</span></a>                  <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewqandawithoutposting', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l5268"><span class="linenum">5268</span></a>      }
<a name="l5269"><span class="linenum">5269</span></a>      return true;
<a name="l5270"><span class="linenum">5270</span></a>  }
<a name="l5271"><span class="linenum">5271</span></a>  
<a name="l5272"><span class="linenum">5272</span></a>  
<a name="l5273"><span class="linenum">5273</span></a>  <span class="comment">/**</span>
<a name="l5274"><span class="linenum">5274</span></a>  <span class="comment"> * Prints the discussion view screen for a forum.</span>
<a name="l5275"><span class="linenum">5275</span></a>  <span class="comment"> *</span>
<a name="l5276"><span class="linenum">5276</span></a>  <span class="comment"> * @global object</span>
<a name="l5277"><span class="linenum">5277</span></a>  <span class="comment"> * @global object</span>
<a name="l5278"><span class="linenum">5278</span></a>  <span class="comment"> * @param object $course The current course object.</span>
<a name="l5279"><span class="linenum">5279</span></a>  <span class="comment"> * @param object $forum Forum to be printed.</span>
<a name="l5280"><span class="linenum">5280</span></a>  <span class="comment"> * @param int $maxdiscussions .</span>
<a name="l5281"><span class="linenum">5281</span></a>  <span class="comment"> * @param string $displayformat The display format to use (optional).</span>
<a name="l5282"><span class="linenum">5282</span></a>  <span class="comment"> * @param string $sort Sort arguments for database query (optional).</span>
<a name="l5283"><span class="linenum">5283</span></a>  <span class="comment"> * @param int $groupmode Group mode of the forum (optional).</span>
<a name="l5284"><span class="linenum">5284</span></a>  <span class="comment"> * @param void $unused (originally current group)</span>
<a name="l5285"><span class="linenum">5285</span></a>  <span class="comment"> * @param int $page Page mode, page to display (optional).</span>
<a name="l5286"><span class="linenum">5286</span></a>  <span class="comment"> * @param int $perpage The maximum number of discussions per page(optional)</span>
<a name="l5287"><span class="linenum">5287</span></a>  <span class="comment"> * @param boolean $subscriptionstatus Whether the user is currently subscribed to the discussion in some fashion.</span>
<a name="l5288"><span class="linenum">5288</span></a>  <span class="comment"> *</span>
<a name="l5289"><span class="linenum">5289</span></a>  <span class="comment"> */</span>
<a name="l5290"><span class="linenum">5290</span></a>  function <a class="function" onClick="logFunction('forum_print_latest_discussions')" href="../../_functions/forum_print_latest_discussions.html" onMouseOver="funcPopup(event,'forum_print_latest_discussions')">forum_print_latest_discussions</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it41613" onMouseOver="hilite(41613)" onMouseOut="lolite()" onClick="logVariable('maxdiscussions')" href="../../_variables/maxdiscussions.html">$maxdiscussions</a> = -1, <a class="var it7403" onMouseOver="hilite(7403)" onMouseOut="lolite()" onClick="logVariable('displayformat')" href="../../_variables/displayformat.html">$displayformat</a> = 'plain', <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = '',
<a name="l5291"><span class="linenum">5291</span></a>                                          <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = -1, <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = -1, <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a> = -1, <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a> = 100, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = null) {
<a name="l5292"><span class="linenum">5292</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l5293"><span class="linenum">5293</span></a>  
<a name="l5294"><span class="linenum">5294</span></a>      if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l5295"><span class="linenum">5295</span></a>          if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)) {
<a name="l5296"><span class="linenum">5296</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidcoursemodule');
<a name="l5297"><span class="linenum">5297</span></a>          }
<a name="l5298"><span class="linenum">5298</span></a>      }
<a name="l5299"><span class="linenum">5299</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5300"><span class="linenum">5300</span></a>  
<a name="l5301"><span class="linenum">5301</span></a>      if (empty(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>)) {
<a name="l5302"><span class="linenum">5302</span></a>          <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = <a class="function" onClick="logFunction('forum_get_default_sort_order')" href="../../_functions/forum_get_default_sort_order.html" onMouseOver="funcPopup(event,'forum_get_default_sort_order')">forum_get_default_sort_order</a>();
<a name="l5303"><span class="linenum">5303</span></a>      }
<a name="l5304"><span class="linenum">5304</span></a>  
<a name="l5305"><span class="linenum">5305</span></a>      <a class="var it41614" onMouseOver="hilite(41614)" onMouseOut="lolite()" onClick="logVariable('olddiscussionlink')" href="../../_variables/olddiscussionlink.html">$olddiscussionlink</a> = false;
<a name="l5306"><span class="linenum">5306</span></a>  
<a name="l5307"><span class="linenum">5307</span></a>  <span class="comment"> // Sort out some defaults</span>
<a name="l5308"><span class="linenum">5308</span></a>      if (<a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a> &lt;= 0) {
<a name="l5309"><span class="linenum">5309</span></a>          <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a> = 0;
<a name="l5310"><span class="linenum">5310</span></a>          <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>    = -1;
<a name="l5311"><span class="linenum">5311</span></a>      }
<a name="l5312"><span class="linenum">5312</span></a>  
<a name="l5313"><span class="linenum">5313</span></a>      if (<a class="var it41613" onMouseOver="hilite(41613)" onMouseOut="lolite()" onClick="logVariable('maxdiscussions')" href="../../_variables/maxdiscussions.html">$maxdiscussions</a> == 0) {
<a name="l5314"><span class="linenum">5314</span></a>  <span class="comment">        // all discussions - backwards compatibility</span>
<a name="l5315"><span class="linenum">5315</span></a>          <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>    = -1;
<a name="l5316"><span class="linenum">5316</span></a>          <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a> = 0;
<a name="l5317"><span class="linenum">5317</span></a>          if (<a class="var it7403" onMouseOver="hilite(7403)" onMouseOut="lolite()" onClick="logVariable('displayformat')" href="../../_variables/displayformat.html">$displayformat</a> == 'plain') {
<a name="l5318"><span class="linenum">5318</span></a>              <a class="var it7403" onMouseOver="hilite(7403)" onMouseOut="lolite()" onClick="logVariable('displayformat')" href="../../_variables/displayformat.html">$displayformat</a> = 'header';  <span class="comment">// Abbreviate display by default</span>
<a name="l5319"><span class="linenum">5319</span></a>          }
<a name="l5320"><span class="linenum">5320</span></a>  
<a name="l5321"><span class="linenum">5321</span></a>      } else if (<a class="var it41613" onMouseOver="hilite(41613)" onMouseOut="lolite()" onClick="logVariable('maxdiscussions')" href="../../_variables/maxdiscussions.html">$maxdiscussions</a> &gt; 0) {
<a name="l5322"><span class="linenum">5322</span></a>          <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>    = -1;
<a name="l5323"><span class="linenum">5323</span></a>          <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a> = <a class="var it41613" onMouseOver="hilite(41613)" onMouseOut="lolite()" onClick="logVariable('maxdiscussions')" href="../../_variables/maxdiscussions.html">$maxdiscussions</a>;
<a name="l5324"><span class="linenum">5324</span></a>      }
<a name="l5325"><span class="linenum">5325</span></a>  
<a name="l5326"><span class="linenum">5326</span></a>      <a class="var it41555" onMouseOver="hilite(41555)" onMouseOut="lolite()" onClick="logVariable('fullpost')" href="../../_variables/fullpost.html">$fullpost</a> = false;
<a name="l5327"><span class="linenum">5327</span></a>      if (<a class="var it7403" onMouseOver="hilite(7403)" onMouseOut="lolite()" onClick="logVariable('displayformat')" href="../../_variables/displayformat.html">$displayformat</a> == 'plain') {
<a name="l5328"><span class="linenum">5328</span></a>          <a class="var it41555" onMouseOver="hilite(41555)" onMouseOut="lolite()" onClick="logVariable('fullpost')" href="../../_variables/fullpost.html">$fullpost</a> = true;
<a name="l5329"><span class="linenum">5329</span></a>      }
<a name="l5330"><span class="linenum">5330</span></a>  
<a name="l5331"><span class="linenum">5331</span></a>  
<a name="l5332"><span class="linenum">5332</span></a>  <span class="comment">// Decide if current user is allowed to see ALL the current discussions or not</span>
<a name="l5333"><span class="linenum">5333</span></a>  
<a name="l5334"><span class="linenum">5334</span></a>  <span class="comment">// First check the group stuff</span>
<a name="l5335"><span class="linenum">5335</span></a>      if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> == -1 or <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == -1) {
<a name="l5336"><span class="linenum">5336</span></a>          <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>    = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l5337"><span class="linenum">5337</span></a>          <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = <a class="function" onClick="logFunction('groups_get_activity_group')" href="../../_functions/groups_get_activity_group.html" onMouseOver="funcPopup(event,'groups_get_activity_group')">groups_get_activity_group</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l5338"><span class="linenum">5338</span></a>      }
<a name="l5339"><span class="linenum">5339</span></a>  
<a name="l5340"><span class="linenum">5340</span></a>      <a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a> = array(); <span class="comment">//cache</span>
<a name="l5341"><span class="linenum">5341</span></a>  
<a name="l5342"><span class="linenum">5342</span></a>  <span class="comment">// If the user can post discussions, then this is a good place to put the</span>
<a name="l5343"><span class="linenum">5343</span></a>  <span class="comment">// button for it. We do not show the button if we are showing site news</span>
<a name="l5344"><span class="linenum">5344</span></a>  <span class="comment">// and the current user is a guest.</span>
<a name="l5345"><span class="linenum">5345</span></a>  
<a name="l5346"><span class="linenum">5346</span></a>      <a class="var it41615" onMouseOver="hilite(41615)" onMouseOut="lolite()" onClick="logVariable('canstart')" href="../../_variables/canstart.html">$canstart</a> = <a class="function" onClick="logFunction('forum_user_can_post_discussion')" href="../../_functions/forum_user_can_post_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_post_discussion')">forum_user_can_post_discussion</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>, <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l5347"><span class="linenum">5347</span></a>      if (!<a class="var it41615" onMouseOver="hilite(41615)" onMouseOut="lolite()" onClick="logVariable('canstart')" href="../../_variables/canstart.html">$canstart</a> and <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> !== 'news') {
<a name="l5348"><span class="linenum">5348</span></a>          if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>() or !<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l5349"><span class="linenum">5349</span></a>              <a class="var it41615" onMouseOver="hilite(41615)" onMouseOut="lolite()" onClick="logVariable('canstart')" href="../../_variables/canstart.html">$canstart</a> = true;
<a name="l5350"><span class="linenum">5350</span></a>          }
<a name="l5351"><span class="linenum">5351</span></a>          if (!<a class="function" onClick="logFunction('is_enrolled')" href="../../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) and !<a class="function" onClick="logFunction('is_viewing')" href="../../_functions/is_viewing.html" onMouseOver="funcPopup(event,'is_viewing')">is_viewing</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l5352"><span class="linenum">5352</span></a>  <span class="comment">            // allow guests and not-logged-in to see the button - they are prompted to log in after clicking the link</span>
<a name="l5353"><span class="linenum">5353</span></a>  <span class="comment">            // normal users with temporary guest access see this button too, they are asked to enrol instead</span>
<a name="l5354"><span class="linenum">5354</span></a>  <span class="comment">            // do not show the button to users with suspended enrolments here</span>
<a name="l5355"><span class="linenum">5355</span></a>              <a class="var it41615" onMouseOver="hilite(41615)" onMouseOut="lolite()" onClick="logVariable('canstart')" href="../../_variables/canstart.html">$canstart</a> = <a class="function" onClick="logFunction('enrol_selfenrol_available')" href="../../_functions/enrol_selfenrol_available.html" onMouseOver="funcPopup(event,'enrol_selfenrol_available')">enrol_selfenrol_available</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5356"><span class="linenum">5356</span></a>          }
<a name="l5357"><span class="linenum">5357</span></a>      }
<a name="l5358"><span class="linenum">5358</span></a>  
<a name="l5359"><span class="linenum">5359</span></a>      if (<a class="var it41615" onMouseOver="hilite(41615)" onMouseOut="lolite()" onClick="logVariable('canstart')" href="../../_variables/canstart.html">$canstart</a>) {
<a name="l5360"><span class="linenum">5360</span></a>          echo '&lt;div class=&quot;singlebutton forumaddnew&quot;&gt;';
<a name="l5361"><span class="linenum">5361</span></a>          echo &quot;&lt;form id=\&quot;newdiscussionform\&quot; method=\&quot;get\&quot; action=\&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/mod/forum/post.php\&quot;&gt;&quot;;
<a name="l5362"><span class="linenum">5362</span></a>          echo '&lt;div&gt;';
<a name="l5363"><span class="linenum">5363</span></a>          echo &quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;forum\&quot; value=\&quot;<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>\&quot; /&gt;&quot;;
<a name="l5364"><span class="linenum">5364</span></a>          switch (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>) {
<a name="l5365"><span class="linenum">5365</span></a>              case 'news':
<a name="l5366"><span class="linenum">5366</span></a>              case 'blog':
<a name="l5367"><span class="linenum">5367</span></a>                  <a class="var it41616" onMouseOver="hilite(41616)" onMouseOut="lolite()" onClick="logVariable('buttonadd')" href="../../_variables/buttonadd.html">$buttonadd</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('addanewtopic', 'forum');
<a name="l5368"><span class="linenum">5368</span></a>                  break;
<a name="l5369"><span class="linenum">5369</span></a>              case 'qanda':
<a name="l5370"><span class="linenum">5370</span></a>                  <a class="var it41616" onMouseOver="hilite(41616)" onMouseOut="lolite()" onClick="logVariable('buttonadd')" href="../../_variables/buttonadd.html">$buttonadd</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('addanewquestion', 'forum');
<a name="l5371"><span class="linenum">5371</span></a>                  break;
<a name="l5372"><span class="linenum">5372</span></a>              default:
<a name="l5373"><span class="linenum">5373</span></a>                  <a class="var it41616" onMouseOver="hilite(41616)" onMouseOut="lolite()" onClick="logVariable('buttonadd')" href="../../_variables/buttonadd.html">$buttonadd</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('addanewdiscussion', 'forum');
<a name="l5374"><span class="linenum">5374</span></a>                  break;
<a name="l5375"><span class="linenum">5375</span></a>          }
<a name="l5376"><span class="linenum">5376</span></a>          echo '&lt;input type=&quot;submit&quot; value=&quot;'.<a class="var it41616" onMouseOver="hilite(41616)" onMouseOut="lolite()" onClick="logVariable('buttonadd')" href="../../_variables/buttonadd.html">$buttonadd</a>.'&quot; /&gt;';
<a name="l5377"><span class="linenum">5377</span></a>          echo '&lt;/div&gt;';
<a name="l5378"><span class="linenum">5378</span></a>          echo '&lt;/form&gt;';
<a name="l5379"><span class="linenum">5379</span></a>          echo &quot;&lt;/div&gt;\n&quot;;
<a name="l5380"><span class="linenum">5380</span></a>  
<a name="l5381"><span class="linenum">5381</span></a>      } else if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>() or !<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>() or <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'news' or
<a name="l5382"><span class="linenum">5382</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'qanda' and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:addquestion', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) or
<a name="l5383"><span class="linenum">5383</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> != 'qanda' and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:startdiscussion', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l5384"><span class="linenum">5384</span></a>  <span class="comment">        // no button and no info</span>
<a name="l5385"><span class="linenum">5385</span></a>  
<a name="l5386"><span class="linenum">5386</span></a>      } else if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l5387"><span class="linenum">5387</span></a>  <span class="comment">        // inform users why they can not post new discussion</span>
<a name="l5388"><span class="linenum">5388</span></a>          if (!<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l5389"><span class="linenum">5389</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('cannotadddiscussionall', 'forum'));
<a name="l5390"><span class="linenum">5390</span></a>          } else if (!<a class="function" onClick="logFunction('groups_is_member')" href="../../_functions/groups_is_member.html" onMouseOver="funcPopup(event,'groups_is_member')">groups_is_member</a>(<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>)) {
<a name="l5391"><span class="linenum">5391</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('cannotadddiscussion', 'forum'));
<a name="l5392"><span class="linenum">5392</span></a>          }
<a name="l5393"><span class="linenum">5393</span></a>      }
<a name="l5394"><span class="linenum">5394</span></a>  
<a name="l5395"><span class="linenum">5395</span></a>  <span class="comment">// Get all the recent discussions we're allowed to see</span>
<a name="l5396"><span class="linenum">5396</span></a>  
<a name="l5397"><span class="linenum">5397</span></a>      <a class="var it41617" onMouseOver="hilite(41617)" onMouseOut="lolite()" onClick="logVariable('getuserlastmodified')" href="../../_variables/getuserlastmodified.html">$getuserlastmodified</a> = (<a class="var it7403" onMouseOver="hilite(7403)" onMouseOut="lolite()" onClick="logVariable('displayformat')" href="../../_variables/displayformat.html">$displayformat</a> == 'header');
<a name="l5398"><span class="linenum">5398</span></a>  
<a name="l5399"><span class="linenum">5399</span></a>      if (! <a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a> = <a class="function" onClick="logFunction('forum_get_discussions')" href="../../_functions/forum_get_discussions.html" onMouseOver="funcPopup(event,'forum_get_discussions')">forum_get_discussions</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>, <a class="var it41555" onMouseOver="hilite(41555)" onMouseOut="lolite()" onClick="logVariable('fullpost')" href="../../_variables/fullpost.html">$fullpost</a>, null, <a class="var it41613" onMouseOver="hilite(41613)" onMouseOut="lolite()" onClick="logVariable('maxdiscussions')" href="../../_variables/maxdiscussions.html">$maxdiscussions</a>, <a class="var it41617" onMouseOver="hilite(41617)" onMouseOut="lolite()" onClick="logVariable('getuserlastmodified')" href="../../_variables/getuserlastmodified.html">$getuserlastmodified</a>, <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>, <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>) ) {
<a name="l5400"><span class="linenum">5400</span></a>          echo '&lt;div class=&quot;forumnodiscuss&quot;&gt;';
<a name="l5401"><span class="linenum">5401</span></a>          if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'news') {
<a name="l5402"><span class="linenum">5402</span></a>              echo '('.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nonews', 'forum').')';
<a name="l5403"><span class="linenum">5403</span></a>          } else if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'qanda') {
<a name="l5404"><span class="linenum">5404</span></a>              echo '('.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('noquestions','forum').')';
<a name="l5405"><span class="linenum">5405</span></a>          } else {
<a name="l5406"><span class="linenum">5406</span></a>              echo '('.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nodiscussions', 'forum').')';
<a name="l5407"><span class="linenum">5407</span></a>          }
<a name="l5408"><span class="linenum">5408</span></a>          echo &quot;&lt;/div&gt;\n&quot;;
<a name="l5409"><span class="linenum">5409</span></a>          return;
<a name="l5410"><span class="linenum">5410</span></a>      }
<a name="l5411"><span class="linenum">5411</span></a>  
<a name="l5412"><span class="linenum">5412</span></a>  <span class="comment">// If we want paging</span>
<a name="l5413"><span class="linenum">5413</span></a>      if (<a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a> != -1) {
<a name="l5414"><span class="linenum">5414</span></a>  <span class="comment">        ///Get the number of discussions found</span>
<a name="l5415"><span class="linenum">5415</span></a>          <a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('numdiscussions')" href="../../_variables/numdiscussions.html">$numdiscussions</a> = <a class="function" onClick="logFunction('forum_get_discussions_count')" href="../../_functions/forum_get_discussions_count.html" onMouseOver="funcPopup(event,'forum_get_discussions_count')">forum_get_discussions_count</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l5416"><span class="linenum">5416</span></a>  
<a name="l5417"><span class="linenum">5417</span></a>  <span class="comment">        ///Show the paging bar</span>
<a name="l5418"><span class="linenum">5418</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('paging_bar')" href="../../_functions/paging_bar.html" onMouseOver="funcPopup(event,'paging_bar')">paging_bar</a>(<a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('numdiscussions')" href="../../_variables/numdiscussions.html">$numdiscussions</a>, <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>, <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>, &quot;view.php?f=<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&quot;);
<a name="l5419"><span class="linenum">5419</span></a>          if (<a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('numdiscussions')" href="../../_variables/numdiscussions.html">$numdiscussions</a> &gt; 1000) {
<a name="l5420"><span class="linenum">5420</span></a>  <span class="comment">            // saves some memory on sites with very large forums</span>
<a name="l5421"><span class="linenum">5421</span></a>              <a class="var it18735" onMouseOver="hilite(18735)" onMouseOut="lolite()" onClick="logVariable('replies')" href="../../_variables/replies.html">$replies</a> = <a class="function" onClick="logFunction('forum_count_discussion_replies')" href="../../_functions/forum_count_discussion_replies.html" onMouseOver="funcPopup(event,'forum_count_discussion_replies')">forum_count_discussion_replies</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>, <a class="var it41613" onMouseOver="hilite(41613)" onMouseOut="lolite()" onClick="logVariable('maxdiscussions')" href="../../_variables/maxdiscussions.html">$maxdiscussions</a>, <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>, <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>);
<a name="l5422"><span class="linenum">5422</span></a>          } else {
<a name="l5423"><span class="linenum">5423</span></a>              <a class="var it18735" onMouseOver="hilite(18735)" onMouseOut="lolite()" onClick="logVariable('replies')" href="../../_variables/replies.html">$replies</a> = <a class="function" onClick="logFunction('forum_count_discussion_replies')" href="../../_functions/forum_count_discussion_replies.html" onMouseOver="funcPopup(event,'forum_count_discussion_replies')">forum_count_discussion_replies</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5424"><span class="linenum">5424</span></a>          }
<a name="l5425"><span class="linenum">5425</span></a>  
<a name="l5426"><span class="linenum">5426</span></a>      } else {
<a name="l5427"><span class="linenum">5427</span></a>          <a class="var it18735" onMouseOver="hilite(18735)" onMouseOut="lolite()" onClick="logVariable('replies')" href="../../_variables/replies.html">$replies</a> = <a class="function" onClick="logFunction('forum_count_discussion_replies')" href="../../_functions/forum_count_discussion_replies.html" onMouseOver="funcPopup(event,'forum_count_discussion_replies')">forum_count_discussion_replies</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5428"><span class="linenum">5428</span></a>  
<a name="l5429"><span class="linenum">5429</span></a>          if (<a class="var it41613" onMouseOver="hilite(41613)" onMouseOut="lolite()" onClick="logVariable('maxdiscussions')" href="../../_variables/maxdiscussions.html">$maxdiscussions</a> &gt; 0 and <a class="var it41613" onMouseOver="hilite(41613)" onMouseOut="lolite()" onClick="logVariable('maxdiscussions')" href="../../_variables/maxdiscussions.html">$maxdiscussions</a> &lt;= <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a>)) {
<a name="l5430"><span class="linenum">5430</span></a>              <a class="var it41614" onMouseOver="hilite(41614)" onMouseOut="lolite()" onClick="logVariable('olddiscussionlink')" href="../../_variables/olddiscussionlink.html">$olddiscussionlink</a> = true;
<a name="l5431"><span class="linenum">5431</span></a>          }
<a name="l5432"><span class="linenum">5432</span></a>      }
<a name="l5433"><span class="linenum">5433</span></a>  
<a name="l5434"><span class="linenum">5434</span></a>      <a class="var it41590" onMouseOver="hilite(41590)" onMouseOut="lolite()" onClick="logVariable('canviewparticipants')" href="../../_variables/canviewparticipants.html">$canviewparticipants</a> = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewparticipants',<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l5435"><span class="linenum">5435</span></a>      <a class="var it41591" onMouseOver="hilite(41591)" onMouseOut="lolite()" onClick="logVariable('canviewhiddentimedposts')" href="../../_variables/canviewhiddentimedposts.html">$canviewhiddentimedposts</a> = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l5436"><span class="linenum">5436</span></a>  
<a name="l5437"><span class="linenum">5437</span></a>      <a class="var it41618" onMouseOver="hilite(41618)" onMouseOut="lolite()" onClick="logVariable('strdatestring')" href="../../_variables/strdatestring.html">$strdatestring</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimerecentfull');
<a name="l5438"><span class="linenum">5438</span></a>  
<a name="l5439"><span class="linenum">5439</span></a>  <span class="comment">    // Check if the forum is tracked.</span>
<a name="l5440"><span class="linenum">5440</span></a>      if (<a class="var it30670" onMouseOver="hilite(30670)" onMouseOut="lolite()" onClick="logVariable('cantrack')" href="../../_variables/cantrack.html">$cantrack</a> = <a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l5441"><span class="linenum">5441</span></a>          <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a> = <a class="function" onClick="logFunction('forum_tp_is_tracked')" href="../../_functions/forum_tp_is_tracked.html" onMouseOver="funcPopup(event,'forum_tp_is_tracked')">forum_tp_is_tracked</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l5442"><span class="linenum">5442</span></a>      } else {
<a name="l5443"><span class="linenum">5443</span></a>          <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a> = false;
<a name="l5444"><span class="linenum">5444</span></a>      }
<a name="l5445"><span class="linenum">5445</span></a>  
<a name="l5446"><span class="linenum">5446</span></a>      if (<a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>) {
<a name="l5447"><span class="linenum">5447</span></a>          <a class="var it30669" onMouseOver="hilite(30669)" onMouseOut="lolite()" onClick="logVariable('unreads')" href="../../_variables/unreads.html">$unreads</a> = <a class="function" onClick="logFunction('forum_get_discussions_unread')" href="../../_functions/forum_get_discussions_unread.html" onMouseOver="funcPopup(event,'forum_get_discussions_unread')">forum_get_discussions_unread</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l5448"><span class="linenum">5448</span></a>      } else {
<a name="l5449"><span class="linenum">5449</span></a>          <a class="var it30669" onMouseOver="hilite(30669)" onMouseOut="lolite()" onClick="logVariable('unreads')" href="../../_variables/unreads.html">$unreads</a> = array();
<a name="l5450"><span class="linenum">5450</span></a>      }
<a name="l5451"><span class="linenum">5451</span></a>  
<a name="l5452"><span class="linenum">5452</span></a>      if (<a class="var it7403" onMouseOver="hilite(7403)" onMouseOut="lolite()" onClick="logVariable('displayformat')" href="../../_variables/displayformat.html">$displayformat</a> == 'header') {
<a name="l5453"><span class="linenum">5453</span></a>          echo '&lt;table cellspacing=&quot;0&quot; class=&quot;forumheaderlist&quot;&gt;';
<a name="l5454"><span class="linenum">5454</span></a>          echo '&lt;thead&gt;';
<a name="l5455"><span class="linenum">5455</span></a>          echo '&lt;tr&gt;';
<a name="l5456"><span class="linenum">5456</span></a>          echo '&lt;th class=&quot;header topic&quot; scope=&quot;col&quot;&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('discussion', 'forum').'&lt;/th&gt;';
<a name="l5457"><span class="linenum">5457</span></a>          echo '&lt;th class=&quot;header author&quot; colspan=&quot;2&quot; scope=&quot;col&quot;&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('startedby', 'forum').'&lt;/th&gt;';
<a name="l5458"><span class="linenum">5458</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> &gt; 0) {
<a name="l5459"><span class="linenum">5459</span></a>              echo '&lt;th class=&quot;header group&quot; scope=&quot;col&quot;&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('group').'&lt;/th&gt;';
<a name="l5460"><span class="linenum">5460</span></a>          }
<a name="l5461"><span class="linenum">5461</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l5462"><span class="linenum">5462</span></a>              echo '&lt;th class=&quot;header replies&quot; scope=&quot;col&quot;&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('replies', 'forum').'&lt;/th&gt;';
<a name="l5463"><span class="linenum">5463</span></a>  <span class="comment">            // If the forum can be tracked, display the unread column.</span>
<a name="l5464"><span class="linenum">5464</span></a>              if (<a class="var it30670" onMouseOver="hilite(30670)" onMouseOut="lolite()" onClick="logVariable('cantrack')" href="../../_variables/cantrack.html">$cantrack</a>) {
<a name="l5465"><span class="linenum">5465</span></a>                  echo '&lt;th class=&quot;header replies&quot; scope=&quot;col&quot;&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unread', 'forum');
<a name="l5466"><span class="linenum">5466</span></a>                  if (<a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>) {
<a name="l5467"><span class="linenum">5467</span></a>                      echo '&lt;a title=&quot;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('markallread', 'forum').
<a name="l5468"><span class="linenum">5468</span></a>                           '&quot; href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/markposts.php?f='.
<a name="l5469"><span class="linenum">5469</span></a>                           <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'&amp;amp;mark=read&amp;amp;returnpage=view.php&amp;amp;sesskey=' . <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>() . '&quot;&gt;'.
<a name="l5470"><span class="linenum">5470</span></a>                           '&lt;img src=&quot;'.<a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_url')" href="../../_functions/pix_url.html" onMouseOver="funcPopup(event,'pix_url')">pix_url</a>('t/markasread') . '&quot; class=&quot;iconsmall&quot; alt=&quot;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('markallread', 'forum').'&quot; /&gt;&lt;/a&gt;';
<a name="l5471"><span class="linenum">5471</span></a>                  }
<a name="l5472"><span class="linenum">5472</span></a>                  echo '&lt;/th&gt;';
<a name="l5473"><span class="linenum">5473</span></a>              }
<a name="l5474"><span class="linenum">5474</span></a>          }
<a name="l5475"><span class="linenum">5475</span></a>          echo '&lt;th class=&quot;header lastpost&quot; scope=&quot;col&quot;&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lastpost', 'forum').'&lt;/th&gt;';
<a name="l5476"><span class="linenum">5476</span></a>          if ((!<a class="function" onClick="logFunction('is_guest')" href="../../_functions/is_guest.html" onMouseOver="funcPopup(event,'is_guest')">is_guest</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>) &amp;&amp; <a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l5477"><span class="linenum">5477</span></a>              if (\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_subscribable')" href="../../_functions/is_subscribable.html" onMouseOver="funcPopup(event,'is_subscribable')">is_subscribable</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l5478"><span class="linenum">5478</span></a>                  echo '&lt;th class=&quot;header discussionsubscription&quot; scope=&quot;col&quot;&gt;';
<a name="l5479"><span class="linenum">5479</span></a>                  echo <a class="function" onClick="logFunction('forum_get_discussion_subscription_icon_preloaders')" href="../../_functions/forum_get_discussion_subscription_icon_preloaders.html" onMouseOver="funcPopup(event,'forum_get_discussion_subscription_icon_preloaders')">forum_get_discussion_subscription_icon_preloaders</a>();
<a name="l5480"><span class="linenum">5480</span></a>                  echo '&lt;/th&gt;';
<a name="l5481"><span class="linenum">5481</span></a>              }
<a name="l5482"><span class="linenum">5482</span></a>          }
<a name="l5483"><span class="linenum">5483</span></a>          echo '&lt;/tr&gt;';
<a name="l5484"><span class="linenum">5484</span></a>          echo '&lt;/thead&gt;';
<a name="l5485"><span class="linenum">5485</span></a>          echo '&lt;tbody&gt;';
<a name="l5486"><span class="linenum">5486</span></a>      }
<a name="l5487"><span class="linenum">5487</span></a>  
<a name="l5488"><span class="linenum">5488</span></a>      foreach (<a class="var it4235" onMouseOver="hilite(4235)" onMouseOut="lolite()" onClick="logVariable('discussions')" href="../../_variables/discussions.html">$discussions</a> as <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>) {
<a name="l5489"><span class="linenum">5489</span></a>          if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'qanda' &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewqandawithoutposting', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) &amp;&amp;
<a name="l5490"><span class="linenum">5490</span></a>              !<a class="function" onClick="logFunction('forum_user_has_posted')" href="../../_functions/forum_user_has_posted.html" onMouseOver="funcPopup(event,'forum_user_has_posted')">forum_user_has_posted</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('discussion')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l5491"><span class="linenum">5491</span></a>              <a class="var it41590" onMouseOver="hilite(41590)" onMouseOut="lolite()" onClick="logVariable('canviewparticipants')" href="../../_variables/canviewparticipants.html">$canviewparticipants</a> = false;
<a name="l5492"><span class="linenum">5492</span></a>          }
<a name="l5493"><span class="linenum">5493</span></a>  
<a name="l5494"><span class="linenum">5494</span></a>          if (!empty(<a class="var it18735" onMouseOver="hilite(18735)" onMouseOut="lolite()" onClick="logVariable('replies')" href="../../_variables/replies.html">$replies</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('discussion')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>])) {
<a name="l5495"><span class="linenum">5495</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('replies')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/replies.html">replies</a> = <a class="var it18735" onMouseOver="hilite(18735)" onMouseOut="lolite()" onClick="logVariable('replies')" href="../../_variables/replies.html">$replies</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('discussion')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>]-&gt;replies;
<a name="l5496"><span class="linenum">5496</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('lastpostid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/lastpostid.html">lastpostid</a> = <a class="var it18735" onMouseOver="hilite(18735)" onMouseOut="lolite()" onClick="logVariable('replies')" href="../../_variables/replies.html">$replies</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('discussion')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>]-&gt;lastpostid;
<a name="l5497"><span class="linenum">5497</span></a>          } else {
<a name="l5498"><span class="linenum">5498</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('replies')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/replies.html">replies</a> = 0;
<a name="l5499"><span class="linenum">5499</span></a>          }
<a name="l5500"><span class="linenum">5500</span></a>  
<a name="l5501"><span class="linenum">5501</span></a>  <span class="comment">        // SPECIAL CASE: The front page can display a news item post to non-logged in users.</span>
<a name="l5502"><span class="linenum">5502</span></a>  <span class="comment">        // All posts are read in this case.</span>
<a name="l5503"><span class="linenum">5503</span></a>          if (!<a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>) {
<a name="l5504"><span class="linenum">5504</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('unread')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a> = '-';
<a name="l5505"><span class="linenum">5505</span></a>          } else if (empty(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>)) {
<a name="l5506"><span class="linenum">5506</span></a>              <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('unread')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a> = 0;
<a name="l5507"><span class="linenum">5507</span></a>          } else {
<a name="l5508"><span class="linenum">5508</span></a>              if (empty(<a class="var it30669" onMouseOver="hilite(30669)" onMouseOut="lolite()" onClick="logVariable('unreads')" href="../../_variables/unreads.html">$unreads</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('discussion')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>])) {
<a name="l5509"><span class="linenum">5509</span></a>                  <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('unread')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a> = 0;
<a name="l5510"><span class="linenum">5510</span></a>              } else {
<a name="l5511"><span class="linenum">5511</span></a>                  <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('unread')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a> = <a class="var it30669" onMouseOver="hilite(30669)" onMouseOut="lolite()" onClick="logVariable('unreads')" href="../../_variables/unreads.html">$unreads</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('discussion')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>];
<a name="l5512"><span class="linenum">5512</span></a>              }
<a name="l5513"><span class="linenum">5513</span></a>          }
<a name="l5514"><span class="linenum">5514</span></a>  
<a name="l5515"><span class="linenum">5515</span></a>          if (<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l5516"><span class="linenum">5516</span></a>              <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a> = (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('userid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> == <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5517"><span class="linenum">5517</span></a>          } else {
<a name="l5518"><span class="linenum">5518</span></a>              <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a>=false;
<a name="l5519"><span class="linenum">5519</span></a>          }
<a name="l5520"><span class="linenum">5520</span></a>  <span class="comment">        // Use discussion name instead of subject of first post.</span>
<a name="l5521"><span class="linenum">5521</span></a>          <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('subject')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('name')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l5522"><span class="linenum">5522</span></a>  
<a name="l5523"><span class="linenum">5523</span></a>          switch (<a class="var it7403" onMouseOver="hilite(7403)" onMouseOut="lolite()" onClick="logVariable('displayformat')" href="../../_variables/displayformat.html">$displayformat</a>) {
<a name="l5524"><span class="linenum">5524</span></a>              case 'header':
<a name="l5525"><span class="linenum">5525</span></a>                  if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> &gt; 0) {
<a name="l5526"><span class="linenum">5526</span></a>                      if (isset(<a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>])) {
<a name="l5527"><span class="linenum">5527</span></a>                          <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a> = <a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>];
<a name="l5528"><span class="linenum">5528</span></a>                      } else {
<a name="l5529"><span class="linenum">5529</span></a>                          <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a> = <a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>[<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>] = <a class="function" onClick="logFunction('groups_get_group')" href="../../_functions/groups_get_group.html" onMouseOver="funcPopup(event,'groups_get_group')">groups_get_group</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('groupid')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>);
<a name="l5530"><span class="linenum">5530</span></a>                      }
<a name="l5531"><span class="linenum">5531</span></a>                  } else {
<a name="l5532"><span class="linenum">5532</span></a>                      <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a> = -1;
<a name="l5533"><span class="linenum">5533</span></a>                  }
<a name="l5534"><span class="linenum">5534</span></a>                  <a class="function" onClick="logFunction('forum_print_discussion_header')" href="../../_functions/forum_print_discussion_header.html" onMouseOver="funcPopup(event,'forum_print_discussion_header')">forum_print_discussion_header</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>, <a class="var it41618" onMouseOver="hilite(41618)" onMouseOut="lolite()" onClick="logVariable('strdatestring')" href="../../_variables/strdatestring.html">$strdatestring</a>, <a class="var it30670" onMouseOver="hilite(30670)" onMouseOut="lolite()" onClick="logVariable('cantrack')" href="../../_variables/cantrack.html">$cantrack</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>,
<a name="l5535"><span class="linenum">5535</span></a>                      <a class="var it41590" onMouseOver="hilite(41590)" onMouseOut="lolite()" onClick="logVariable('canviewparticipants')" href="../../_variables/canviewparticipants.html">$canviewparticipants</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it41591" onMouseOver="hilite(41591)" onMouseOut="lolite()" onClick="logVariable('canviewhiddentimedposts')" href="../../_variables/canviewhiddentimedposts.html">$canviewhiddentimedposts</a>);
<a name="l5536"><span class="linenum">5536</span></a>              break;
<a name="l5537"><span class="linenum">5537</span></a>              default:
<a name="l5538"><span class="linenum">5538</span></a>                  <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = false;
<a name="l5539"><span class="linenum">5539</span></a>  
<a name="l5540"><span class="linenum">5540</span></a>                  if (<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('replies')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/replies.html">replies</a>) {
<a name="l5541"><span class="linenum">5541</span></a>                      <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = true;
<a name="l5542"><span class="linenum">5542</span></a>                  } else {
<a name="l5543"><span class="linenum">5543</span></a>                      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5544"><span class="linenum">5544</span></a>                      <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = <a class="function" onClick="logFunction('forum_user_can_see_discussion')" href="../../_functions/forum_user_can_see_discussion.html" onMouseOver="funcPopup(event,'forum_user_can_see_discussion')">forum_user_can_see_discussion</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>);
<a name="l5545"><span class="linenum">5545</span></a>                  }
<a name="l5546"><span class="linenum">5546</span></a>  
<a name="l5547"><span class="linenum">5547</span></a>                  <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l5548"><span class="linenum">5548</span></a>  
<a name="l5549"><span class="linenum">5549</span></a>                  <a class="function" onClick="logFunction('forum_print_post')" href="../../_functions/forum_print_post.html" onMouseOver="funcPopup(event,'forum_print_post')">forum_print_post</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a>, 0, <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>, false,
<a name="l5550"><span class="linenum">5550</span></a>                          '', null, true, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>);
<a name="l5551"><span class="linenum">5551</span></a>              break;
<a name="l5552"><span class="linenum">5552</span></a>          }
<a name="l5553"><span class="linenum">5553</span></a>      }
<a name="l5554"><span class="linenum">5554</span></a>  
<a name="l5555"><span class="linenum">5555</span></a>      if (<a class="var it7403" onMouseOver="hilite(7403)" onMouseOut="lolite()" onClick="logVariable('displayformat')" href="../../_variables/displayformat.html">$displayformat</a> == &quot;header&quot;) {
<a name="l5556"><span class="linenum">5556</span></a>          echo '&lt;/tbody&gt;';
<a name="l5557"><span class="linenum">5557</span></a>          echo '&lt;/table&gt;';
<a name="l5558"><span class="linenum">5558</span></a>      }
<a name="l5559"><span class="linenum">5559</span></a>  
<a name="l5560"><span class="linenum">5560</span></a>      if (<a class="var it41614" onMouseOver="hilite(41614)" onMouseOut="lolite()" onClick="logVariable('olddiscussionlink')" href="../../_variables/olddiscussionlink.html">$olddiscussionlink</a>) {
<a name="l5561"><span class="linenum">5561</span></a>          if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'news') {
<a name="l5562"><span class="linenum">5562</span></a>              <a class="var it41619" onMouseOver="hilite(41619)" onMouseOut="lolite()" onClick="logVariable('strolder')" href="../../_variables/strolder.html">$strolder</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('oldertopics', 'forum');
<a name="l5563"><span class="linenum">5563</span></a>          } else {
<a name="l5564"><span class="linenum">5564</span></a>              <a class="var it41619" onMouseOver="hilite(41619)" onMouseOut="lolite()" onClick="logVariable('strolder')" href="../../_variables/strolder.html">$strolder</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('olderdiscussions', 'forum');
<a name="l5565"><span class="linenum">5565</span></a>          }
<a name="l5566"><span class="linenum">5566</span></a>          echo '&lt;div class=&quot;forumolddiscuss&quot;&gt;';
<a name="l5567"><span class="linenum">5567</span></a>          echo '&lt;a href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/forum/view.php?f='.<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'&amp;amp;showall=1&quot;&gt;';
<a name="l5568"><span class="linenum">5568</span></a>          echo <a class="var it41619" onMouseOver="hilite(41619)" onMouseOut="lolite()" onClick="logVariable('strolder')" href="../../_variables/strolder.html">$strolder</a>.'&lt;/a&gt; ...&lt;/div&gt;';
<a name="l5569"><span class="linenum">5569</span></a>      }
<a name="l5570"><span class="linenum">5570</span></a>  
<a name="l5571"><span class="linenum">5571</span></a>      if (<a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a> != -1) { ///Show the paging bar
<a name="l5572"><span class="linenum">5572</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('paging_bar')" href="../../_functions/paging_bar.html" onMouseOver="funcPopup(event,'paging_bar')">paging_bar</a>(<a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('numdiscussions')" href="../../_variables/numdiscussions.html">$numdiscussions</a>, <a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a>, <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('perpage')" href="../../_variables/perpage.html">$perpage</a>, &quot;view.php?f=<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&quot;);
<a name="l5573"><span class="linenum">5573</span></a>      }
<a name="l5574"><span class="linenum">5574</span></a>  }
<a name="l5575"><span class="linenum">5575</span></a>  
<a name="l5576"><span class="linenum">5576</span></a>  
<a name="l5577"><span class="linenum">5577</span></a>  <span class="comment">/**</span>
<a name="l5578"><span class="linenum">5578</span></a>  <span class="comment"> * Prints a forum discussion</span>
<a name="l5579"><span class="linenum">5579</span></a>  <span class="comment"> *</span>
<a name="l5580"><span class="linenum">5580</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l5581"><span class="linenum">5581</span></a>  <span class="comment"> * @uses FORUM_MODE_FLATNEWEST</span>
<a name="l5582"><span class="linenum">5582</span></a>  <span class="comment"> * @uses FORUM_MODE_FLATOLDEST</span>
<a name="l5583"><span class="linenum">5583</span></a>  <span class="comment"> * @uses FORUM_MODE_THREADED</span>
<a name="l5584"><span class="linenum">5584</span></a>  <span class="comment"> * @uses FORUM_MODE_NESTED</span>
<a name="l5585"><span class="linenum">5585</span></a>  <span class="comment"> * @param stdClass $course</span>
<a name="l5586"><span class="linenum">5586</span></a>  <span class="comment"> * @param stdClass $cm</span>
<a name="l5587"><span class="linenum">5587</span></a>  <span class="comment"> * @param stdClass $forum</span>
<a name="l5588"><span class="linenum">5588</span></a>  <span class="comment"> * @param stdClass $discussion</span>
<a name="l5589"><span class="linenum">5589</span></a>  <span class="comment"> * @param stdClass $post</span>
<a name="l5590"><span class="linenum">5590</span></a>  <span class="comment"> * @param int $mode</span>
<a name="l5591"><span class="linenum">5591</span></a>  <span class="comment"> * @param mixed $canreply</span>
<a name="l5592"><span class="linenum">5592</span></a>  <span class="comment"> * @param bool $canrate</span>
<a name="l5593"><span class="linenum">5593</span></a>  <span class="comment"> */</span>
<a name="l5594"><span class="linenum">5594</span></a>  function <a class="function" onClick="logFunction('forum_print_discussion')" href="../../_functions/forum_print_discussion.html" onMouseOver="funcPopup(event,'forum_print_discussion')">forum_print_discussion</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>, <a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a>=NULL, <a class="var it24390" onMouseOver="hilite(24390)" onMouseOut="lolite()" onClick="logVariable('canrate')" href="../../_variables/canrate.html">$canrate</a>=false) {
<a name="l5595"><span class="linenum">5595</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l5596"><span class="linenum">5596</span></a>  
<a name="l5597"><span class="linenum">5597</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../rating/lib.php.html">/rating/lib.php</a>');
<a name="l5598"><span class="linenum">5598</span></a>  
<a name="l5599"><span class="linenum">5599</span></a>      <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a> = (<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>() &amp;&amp; <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l5600"><span class="linenum">5600</span></a>  
<a name="l5601"><span class="linenum">5601</span></a>      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5602"><span class="linenum">5602</span></a>      if (<a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a> === NULL) {
<a name="l5603"><span class="linenum">5603</span></a>          <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a> = <a class="function" onClick="logFunction('forum_user_can_post')" href="../../_functions/forum_user_can_post.html" onMouseOver="funcPopup(event,'forum_user_can_post')">forum_user_can_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l5604"><span class="linenum">5604</span></a>      } else {
<a name="l5605"><span class="linenum">5605</span></a>          <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a> = <a class="var it24379" onMouseOver="hilite(24379)" onMouseOut="lolite()" onClick="logVariable('canreply')" href="../../_variables/canreply.html">$canreply</a>;
<a name="l5606"><span class="linenum">5606</span></a>      }
<a name="l5607"><span class="linenum">5607</span></a>  
<a name="l5608"><span class="linenum">5608</span></a>  <span class="comment">    // $cm holds general cache for forum functions</span>
<a name="l5609"><span class="linenum">5609</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a> = new stdClass;
<a name="l5610"><span class="linenum">5610</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;groups      = <a class="function" onClick="logFunction('groups_get_all_groups')" href="../../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 0, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>);
<a name="l5611"><span class="linenum">5611</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;usersgroups = array();
<a name="l5612"><span class="linenum">5612</span></a>  
<a name="l5613"><span class="linenum">5613</span></a>      <a class="var it41620" onMouseOver="hilite(41620)" onMouseOut="lolite()" onClick="logVariable('posters')" href="../../_variables/posters.html">$posters</a> = array();
<a name="l5614"><span class="linenum">5614</span></a>  
<a name="l5615"><span class="linenum">5615</span></a>  <span class="comment">    // preload all posts - TODO: improve...</span>
<a name="l5616"><span class="linenum">5616</span></a>      if (<a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a> == <a class="constant" onClick="logConstant('FORUM_MODE_FLATNEWEST')" href="../../_constants/FORUM_MODE_FLATNEWEST.html" onMouseOver="constPopup(event,'FORUM_MODE_FLATNEWEST')">FORUM_MODE_FLATNEWEST</a>) {
<a name="l5617"><span class="linenum">5617</span></a>          <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = &quot;p.created DESC&quot;;
<a name="l5618"><span class="linenum">5618</span></a>      } else {
<a name="l5619"><span class="linenum">5619</span></a>          <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = &quot;p.created ASC&quot;;
<a name="l5620"><span class="linenum">5620</span></a>      }
<a name="l5621"><span class="linenum">5621</span></a>  
<a name="l5622"><span class="linenum">5622</span></a>      <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a> = <a class="function" onClick="logFunction('forum_tp_is_tracked')" href="../../_functions/forum_tp_is_tracked.html" onMouseOver="funcPopup(event,'forum_tp_is_tracked')">forum_tp_is_tracked</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l5623"><span class="linenum">5623</span></a>      <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="function" onClick="logFunction('forum_get_all_discussion_posts')" href="../../_functions/forum_get_all_discussion_posts.html" onMouseOver="funcPopup(event,'forum_get_all_discussion_posts')">forum_get_all_discussion_posts</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>);
<a name="l5624"><span class="linenum">5624</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l5625"><span class="linenum">5625</span></a>  
<a name="l5626"><span class="linenum">5626</span></a>      foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it18850" onMouseOver="hilite(18850)" onMouseOut="lolite()" onClick="logVariable('pid')" href="../../_variables/pid.html">$pid</a>=&gt;<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>) {
<a name="l5627"><span class="linenum">5627</span></a>          <a class="var it41620" onMouseOver="hilite(41620)" onMouseOut="lolite()" onClick="logVariable('posters')" href="../../_variables/posters.html">$posters</a>[<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>-&gt;<a onClick="logVariable('userid')" class="var it43186" onMouseOver="hilite(43186)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>] = <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('p')" href="../../_variables/p.html">$p</a>-&gt;<a onClick="logVariable('userid')" class="var it43186" onMouseOver="hilite(43186)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l5628"><span class="linenum">5628</span></a>      }
<a name="l5629"><span class="linenum">5629</span></a>  
<a name="l5630"><span class="linenum">5630</span></a>  <span class="comment">    // preload all groups of ppl that posted in this discussion</span>
<a name="l5631"><span class="linenum">5631</span></a>      if (<a class="var it41621" onMouseOver="hilite(41621)" onMouseOut="lolite()" onClick="logVariable('postersgroups')" href="../../_variables/postersgroups.html">$postersgroups</a> = <a class="function" onClick="logFunction('groups_get_all_groups')" href="../../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it41620" onMouseOver="hilite(41620)" onMouseOut="lolite()" onClick="logVariable('posters')" href="../../_variables/posters.html">$posters</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>, 'gm.id, gm.groupid, gm.userid')) {
<a name="l5632"><span class="linenum">5632</span></a>          foreach(<a class="var it41621" onMouseOver="hilite(41621)" onMouseOut="lolite()" onClick="logVariable('postersgroups')" href="../../_variables/postersgroups.html">$postersgroups</a> as <a class="var it2330" onMouseOver="hilite(2330)" onMouseOut="lolite()" onClick="logVariable('pg')" href="../../_variables/pg.html">$pg</a>) {
<a name="l5633"><span class="linenum">5633</span></a>              if (!isset(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;usersgroups[<a class="var it2330" onMouseOver="hilite(2330)" onMouseOut="lolite()" onClick="logVariable('pg')" href="../../_variables/pg.html">$pg</a>-&gt;<a onClick="logVariable('userid')" class="var it44625" onMouseOver="hilite(44625)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>])) {
<a name="l5634"><span class="linenum">5634</span></a>                  <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;usersgroups[<a class="var it2330" onMouseOver="hilite(2330)" onMouseOut="lolite()" onClick="logVariable('pg')" href="../../_variables/pg.html">$pg</a>-&gt;<a onClick="logVariable('userid')" class="var it44625" onMouseOver="hilite(44625)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>] = array();
<a name="l5635"><span class="linenum">5635</span></a>              }
<a name="l5636"><span class="linenum">5636</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('cache')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/cache.html">cache</a>-&gt;usersgroups[<a class="var it2330" onMouseOver="hilite(2330)" onMouseOut="lolite()" onClick="logVariable('pg')" href="../../_variables/pg.html">$pg</a>-&gt;<a onClick="logVariable('userid')" class="var it44625" onMouseOver="hilite(44625)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>][<a class="var it2330" onMouseOver="hilite(2330)" onMouseOut="lolite()" onClick="logVariable('pg')" href="../../_variables/pg.html">$pg</a>-&gt;<a onClick="logVariable('groupid')" class="var it44625" onMouseOver="hilite(44625)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>] = <a class="var it2330" onMouseOver="hilite(2330)" onMouseOut="lolite()" onClick="logVariable('pg')" href="../../_variables/pg.html">$pg</a>-&gt;<a onClick="logVariable('groupid')" class="var it44625" onMouseOver="hilite(44625)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>;
<a name="l5637"><span class="linenum">5637</span></a>          }
<a name="l5638"><span class="linenum">5638</span></a>          unset(<a class="var it41621" onMouseOver="hilite(41621)" onMouseOut="lolite()" onClick="logVariable('postersgroups')" href="../../_variables/postersgroups.html">$postersgroups</a>);
<a name="l5639"><span class="linenum">5639</span></a>      }
<a name="l5640"><span class="linenum">5640</span></a>  
<a name="l5641"><span class="linenum">5641</span></a>  <span class="comment">    //load ratings</span>
<a name="l5642"><span class="linenum">5642</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a> != <a class="constant" onClick="logConstant('RATING_AGGREGATE_NONE')" href="../../_constants/RATING_AGGREGATE_NONE.html" onMouseOver="constPopup(event,'RATING_AGGREGATE_NONE')">RATING_AGGREGATE_NONE</a>) {
<a name="l5643"><span class="linenum">5643</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a> = new stdClass;
<a name="l5644"><span class="linenum">5644</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('context')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/context.html">context</a> = <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>;
<a name="l5645"><span class="linenum">5645</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('component')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = 'mod_forum';
<a name="l5646"><span class="linenum">5646</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('ratingarea')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/ratingarea.html">ratingarea</a> = 'post';
<a name="l5647"><span class="linenum">5647</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('items')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/items.html">items</a> = <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>;
<a name="l5648"><span class="linenum">5648</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('aggregate')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/aggregate.html">aggregate</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assessed')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assessed.html">assessed</a>;<span class="comment">//the aggregation method</span>
<a name="l5649"><span class="linenum">5649</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('scaleid')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('scale')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>;
<a name="l5650"><span class="linenum">5650</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('userid')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l5651"><span class="linenum">5651</span></a>          if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'single' or !<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l5652"><span class="linenum">5652</span></a>              <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('returnurl')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/returnurl.html">returnurl</a> = &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/mod/forum/view.php?id=<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&quot;;
<a name="l5653"><span class="linenum">5653</span></a>          } else {
<a name="l5654"><span class="linenum">5654</span></a>              <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('returnurl')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/returnurl.html">returnurl</a> = &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/mod/forum/discuss.php?d=<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&quot;;
<a name="l5655"><span class="linenum">5655</span></a>          }
<a name="l5656"><span class="linenum">5656</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('assesstimestart')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/assesstimestart.html">assesstimestart</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimestart')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimestart.html">assesstimestart</a>;
<a name="l5657"><span class="linenum">5657</span></a>          <a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>-&gt;<a onClick="logVariable('assesstimefinish')" class="var it42994" onMouseOver="hilite(42994)" onMouseOut="lolite()" href="../../_variables/assesstimefinish.html">assesstimefinish</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('assesstimefinish')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/assesstimefinish.html">assesstimefinish</a>;
<a name="l5658"><span class="linenum">5658</span></a>  
<a name="l5659"><span class="linenum">5659</span></a>          <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a> = <span class="keyword">new </span><a class="class" onClick="logClass('rating_manager')" href="../../_classes/rating_manager.html" onMouseOver="classPopup(event,'rating_manager')">rating_manager</a>();
<a name="l5660"><span class="linenum">5660</span></a>          <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a>-&gt;<a class="function" onClick="logFunction('get_ratings')" href="../../_functions/get_ratings.html" onMouseOver="funcPopup(event,'get_ratings')">get_ratings</a>(<a class="var it7885" onMouseOver="hilite(7885)" onMouseOut="lolite()" onClick="logVariable('ratingoptions')" href="../../_variables/ratingoptions.html">$ratingoptions</a>);
<a name="l5661"><span class="linenum">5661</span></a>      }
<a name="l5662"><span class="linenum">5662</span></a>  
<a name="l5663"><span class="linenum">5663</span></a>  
<a name="l5664"><span class="linenum">5664</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;   <span class="comment">// Add the forum id to the post object, later used by forum_print_post</span>
<a name="l5665"><span class="linenum">5665</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forumtype')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forumtype.html">forumtype</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>;
<a name="l5666"><span class="linenum">5666</span></a>  
<a name="l5667"><span class="linenum">5667</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>);
<a name="l5668"><span class="linenum">5668</span></a>  
<a name="l5669"><span class="linenum">5669</span></a>      <a class="var it30668" onMouseOver="hilite(30668)" onMouseOut="lolite()" onClick="logVariable('postread')" href="../../_variables/postread.html">$postread</a> = !empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('postread')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/postread.html">postread</a>);
<a name="l5670"><span class="linenum">5670</span></a>  
<a name="l5671"><span class="linenum">5671</span></a>      <a class="function" onClick="logFunction('forum_print_post')" href="../../_functions/forum_print_post.html" onMouseOver="funcPopup(event,'forum_print_post')">forum_print_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, false,
<a name="l5672"><span class="linenum">5672</span></a>                           '', '', <a class="var it30668" onMouseOver="hilite(30668)" onMouseOut="lolite()" onClick="logVariable('postread')" href="../../_variables/postread.html">$postread</a>, true, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>);
<a name="l5673"><span class="linenum">5673</span></a>  
<a name="l5674"><span class="linenum">5674</span></a>      switch (<a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>) {
<a name="l5675"><span class="linenum">5675</span></a>          case <a class="constant" onClick="logConstant('FORUM_MODE_FLATOLDEST')" href="../../_constants/FORUM_MODE_FLATOLDEST.html" onMouseOver="constPopup(event,'FORUM_MODE_FLATOLDEST')">FORUM_MODE_FLATOLDEST</a> :
<a name="l5676"><span class="linenum">5676</span></a>          case <a class="constant" onClick="logConstant('FORUM_MODE_FLATNEWEST')" href="../../_constants/FORUM_MODE_FLATNEWEST.html" onMouseOver="constPopup(event,'FORUM_MODE_FLATNEWEST')">FORUM_MODE_FLATNEWEST</a> :
<a name="l5677"><span class="linenum">5677</span></a>          default:
<a name="l5678"><span class="linenum">5678</span></a>              <a class="function" onClick="logFunction('forum_print_posts_flat')" href="../../_functions/forum_print_posts_flat.html" onMouseOver="funcPopup(event,'forum_print_posts_flat')">forum_print_posts_flat</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>, <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>);
<a name="l5679"><span class="linenum">5679</span></a>              break;
<a name="l5680"><span class="linenum">5680</span></a>  
<a name="l5681"><span class="linenum">5681</span></a>          case <a class="constant" onClick="logConstant('FORUM_MODE_THREADED')" href="../../_constants/FORUM_MODE_THREADED.html" onMouseOver="constPopup(event,'FORUM_MODE_THREADED')">FORUM_MODE_THREADED</a> :
<a name="l5682"><span class="linenum">5682</span></a>              <a class="function" onClick="logFunction('forum_print_posts_threaded')" href="../../_functions/forum_print_posts_threaded.html" onMouseOver="funcPopup(event,'forum_print_posts_threaded')">forum_print_posts_threaded</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, 0, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>, <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>);
<a name="l5683"><span class="linenum">5683</span></a>              break;
<a name="l5684"><span class="linenum">5684</span></a>  
<a name="l5685"><span class="linenum">5685</span></a>          case <a class="constant" onClick="logConstant('FORUM_MODE_NESTED')" href="../../_constants/FORUM_MODE_NESTED.html" onMouseOver="constPopup(event,'FORUM_MODE_NESTED')">FORUM_MODE_NESTED</a> :
<a name="l5686"><span class="linenum">5686</span></a>              <a class="function" onClick="logFunction('forum_print_posts_nested')" href="../../_functions/forum_print_posts_nested.html" onMouseOver="funcPopup(event,'forum_print_posts_nested')">forum_print_posts_nested</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>, <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>);
<a name="l5687"><span class="linenum">5687</span></a>              break;
<a name="l5688"><span class="linenum">5688</span></a>      }
<a name="l5689"><span class="linenum">5689</span></a>  }
<a name="l5690"><span class="linenum">5690</span></a>  
<a name="l5691"><span class="linenum">5691</span></a>  
<a name="l5692"><span class="linenum">5692</span></a>  <span class="comment">/**</span>
<a name="l5693"><span class="linenum">5693</span></a>  <span class="comment"> * @global object</span>
<a name="l5694"><span class="linenum">5694</span></a>  <span class="comment"> * @global object</span>
<a name="l5695"><span class="linenum">5695</span></a>  <span class="comment"> * @uses FORUM_MODE_FLATNEWEST</span>
<a name="l5696"><span class="linenum">5696</span></a>  <span class="comment"> * @param object $course</span>
<a name="l5697"><span class="linenum">5697</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l5698"><span class="linenum">5698</span></a>  <span class="comment"> * @param object $forum</span>
<a name="l5699"><span class="linenum">5699</span></a>  <span class="comment"> * @param object $discussion</span>
<a name="l5700"><span class="linenum">5700</span></a>  <span class="comment"> * @param object $post</span>
<a name="l5701"><span class="linenum">5701</span></a>  <span class="comment"> * @param object $mode</span>
<a name="l5702"><span class="linenum">5702</span></a>  <span class="comment"> * @param bool $reply</span>
<a name="l5703"><span class="linenum">5703</span></a>  <span class="comment"> * @param bool $forumtracked</span>
<a name="l5704"><span class="linenum">5704</span></a>  <span class="comment"> * @param array $posts</span>
<a name="l5705"><span class="linenum">5705</span></a>  <span class="comment"> * @return void</span>
<a name="l5706"><span class="linenum">5706</span></a>  <span class="comment"> */</span>
<a name="l5707"><span class="linenum">5707</span></a>  function <a class="function" onClick="logFunction('forum_print_posts_flat')" href="../../_functions/forum_print_posts_flat.html" onMouseOver="funcPopup(event,'forum_print_posts_flat')">forum_print_posts_flat</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, &amp;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>, <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>) {
<a name="l5708"><span class="linenum">5708</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l5709"><span class="linenum">5709</span></a>  
<a name="l5710"><span class="linenum">5710</span></a>      <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>  = false;
<a name="l5711"><span class="linenum">5711</span></a>  
<a name="l5712"><span class="linenum">5712</span></a>      foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l5713"><span class="linenum">5713</span></a>          if (!<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>) {
<a name="l5714"><span class="linenum">5714</span></a>              continue;
<a name="l5715"><span class="linenum">5715</span></a>          }
<a name="l5716"><span class="linenum">5716</span></a>          <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>);
<a name="l5717"><span class="linenum">5717</span></a>          <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a> = (<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l5718"><span class="linenum">5718</span></a>  
<a name="l5719"><span class="linenum">5719</span></a>          <a class="var it30668" onMouseOver="hilite(30668)" onMouseOut="lolite()" onClick="logVariable('postread')" href="../../_variables/postread.html">$postread</a> = !empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('postread')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/postread.html">postread</a>);
<a name="l5720"><span class="linenum">5720</span></a>  
<a name="l5721"><span class="linenum">5721</span></a>          <a class="function" onClick="logFunction('forum_print_post')" href="../../_functions/forum_print_post.html" onMouseOver="funcPopup(event,'forum_print_post')">forum_print_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>,
<a name="l5722"><span class="linenum">5722</span></a>                               '', '', <a class="var it30668" onMouseOver="hilite(30668)" onMouseOut="lolite()" onClick="logVariable('postread')" href="../../_variables/postread.html">$postread</a>, true, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>);
<a name="l5723"><span class="linenum">5723</span></a>      }
<a name="l5724"><span class="linenum">5724</span></a>  }
<a name="l5725"><span class="linenum">5725</span></a>  
<a name="l5726"><span class="linenum">5726</span></a>  <span class="comment">/**</span>
<a name="l5727"><span class="linenum">5727</span></a>  <span class="comment"> * @todo Document this function</span>
<a name="l5728"><span class="linenum">5728</span></a>  <span class="comment"> *</span>
<a name="l5729"><span class="linenum">5729</span></a>  <span class="comment"> * @global object</span>
<a name="l5730"><span class="linenum">5730</span></a>  <span class="comment"> * @global object</span>
<a name="l5731"><span class="linenum">5731</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l5732"><span class="linenum">5732</span></a>  <span class="comment"> * @return void</span>
<a name="l5733"><span class="linenum">5733</span></a>  <span class="comment"> */</span>
<a name="l5734"><span class="linenum">5734</span></a>  function <a class="function" onClick="logFunction('forum_print_posts_threaded')" href="../../_functions/forum_print_posts_threaded.html" onMouseOver="funcPopup(event,'forum_print_posts_threaded')">forum_print_posts_threaded</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, &amp;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>, <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('depth')" href="../../_variables/depth.html">$depth</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>, <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>) {
<a name="l5735"><span class="linenum">5735</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l5736"><span class="linenum">5736</span></a>  
<a name="l5737"><span class="linenum">5737</span></a>      <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>  = false;
<a name="l5738"><span class="linenum">5738</span></a>  
<a name="l5739"><span class="linenum">5739</span></a>      if (!empty(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('id')" class="var it43399" onMouseOver="hilite(43399)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;children)) {
<a name="l5740"><span class="linenum">5740</span></a>          <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('id')" class="var it43399" onMouseOver="hilite(43399)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;children;
<a name="l5741"><span class="linenum">5741</span></a>  
<a name="l5742"><span class="linenum">5742</span></a>          <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>       = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5743"><span class="linenum">5743</span></a>          <a class="var it7922" onMouseOver="hilite(7922)" onMouseOut="lolite()" onClick="logVariable('canviewfullnames')" href="../../_variables/canviewfullnames.html">$canviewfullnames</a> = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>);
<a name="l5744"><span class="linenum">5744</span></a>  
<a name="l5745"><span class="linenum">5745</span></a>          foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l5746"><span class="linenum">5746</span></a>  
<a name="l5747"><span class="linenum">5747</span></a>              echo '&lt;div class=&quot;indent&quot;&gt;';
<a name="l5748"><span class="linenum">5748</span></a>              if (<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('depth')" href="../../_variables/depth.html">$depth</a> &gt; 0) {
<a name="l5749"><span class="linenum">5749</span></a>                  <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a> = (<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l5750"><span class="linenum">5750</span></a>                  <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>);
<a name="l5751"><span class="linenum">5751</span></a>  
<a name="l5752"><span class="linenum">5752</span></a>                  <a class="var it30668" onMouseOver="hilite(30668)" onMouseOut="lolite()" onClick="logVariable('postread')" href="../../_variables/postread.html">$postread</a> = !empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('postread')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/postread.html">postread</a>);
<a name="l5753"><span class="linenum">5753</span></a>  
<a name="l5754"><span class="linenum">5754</span></a>                  <a class="function" onClick="logFunction('forum_print_post')" href="../../_functions/forum_print_post.html" onMouseOver="funcPopup(event,'forum_print_post')">forum_print_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>,
<a name="l5755"><span class="linenum">5755</span></a>                                       '', '', <a class="var it30668" onMouseOver="hilite(30668)" onMouseOut="lolite()" onClick="logVariable('postread')" href="../../_variables/postread.html">$postread</a>, true, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>);
<a name="l5756"><span class="linenum">5756</span></a>              } else {
<a name="l5757"><span class="linenum">5757</span></a>                  if (!<a class="function" onClick="logFunction('forum_user_can_see_post')" href="../../_functions/forum_user_can_see_post.html" onMouseOver="funcPopup(event,'forum_user_can_see_post')">forum_user_can_see_post</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, NULL, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l5758"><span class="linenum">5758</span></a>                      echo &quot;&lt;/div&gt;\n&quot;;
<a name="l5759"><span class="linenum">5759</span></a>                      continue;
<a name="l5760"><span class="linenum">5760</span></a>                  }
<a name="l5761"><span class="linenum">5761</span></a>                  <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a> = new stdClass();
<a name="l5762"><span class="linenum">5762</span></a>                  <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a>-&gt;<a onClick="logVariable('name')" class="var it44595" onMouseOver="hilite(44595)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it7922" onMouseOver="hilite(7922)" onMouseOut="lolite()" onClick="logVariable('canviewfullnames')" href="../../_variables/canviewfullnames.html">$canviewfullnames</a>);
<a name="l5763"><span class="linenum">5763</span></a>                  <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a>-&gt;<a onClick="logVariable('date')" class="var it44595" onMouseOver="hilite(44595)" onMouseOut="lolite()" href="../../_variables/date.html">date</a> = <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>);
<a name="l5764"><span class="linenum">5764</span></a>  
<a name="l5765"><span class="linenum">5765</span></a>                  if (<a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>) {
<a name="l5766"><span class="linenum">5766</span></a>                      if (!empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('postread')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/postread.html">postread</a>)) {
<a name="l5767"><span class="linenum">5767</span></a>                          <a class="var it1577" onMouseOver="hilite(1577)" onMouseOut="lolite()" onClick="logVariable('style')" href="../../_variables/style.html">$style</a> = '&lt;span class=&quot;forumthread read&quot;&gt;';
<a name="l5768"><span class="linenum">5768</span></a>                      } else {
<a name="l5769"><span class="linenum">5769</span></a>                          <a class="var it1577" onMouseOver="hilite(1577)" onMouseOut="lolite()" onClick="logVariable('style')" href="../../_variables/style.html">$style</a> = '&lt;span class=&quot;forumthread unread&quot;&gt;';
<a name="l5770"><span class="linenum">5770</span></a>                      }
<a name="l5771"><span class="linenum">5771</span></a>                  } else {
<a name="l5772"><span class="linenum">5772</span></a>                      <a class="var it1577" onMouseOver="hilite(1577)" onMouseOut="lolite()" onClick="logVariable('style')" href="../../_variables/style.html">$style</a> = '&lt;span class=&quot;forumthread&quot;&gt;';
<a name="l5773"><span class="linenum">5773</span></a>                  }
<a name="l5774"><span class="linenum">5774</span></a>                  echo <a class="var it1577" onMouseOver="hilite(1577)" onMouseOut="lolite()" onClick="logVariable('style')" href="../../_variables/style.html">$style</a>.&quot;&lt;a name=\&quot;<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>\&quot;&gt;&lt;/a&gt;&quot;.
<a name="l5775"><span class="linenum">5775</span></a>                       &quot;&lt;a href=\&quot;discuss.php?d=<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>&amp;amp;parent=<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>\&quot;&gt;&quot;.<a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>,true).&quot;&lt;/a&gt; &quot;;
<a name="l5776"><span class="linenum">5776</span></a>                  <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>(&quot;bynameondate&quot;, &quot;forum&quot;, <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a>);
<a name="l5777"><span class="linenum">5777</span></a>                  echo &quot;&lt;/span&gt;&quot;;
<a name="l5778"><span class="linenum">5778</span></a>              }
<a name="l5779"><span class="linenum">5779</span></a>  
<a name="l5780"><span class="linenum">5780</span></a>              <a class="function" onClick="logFunction('forum_print_posts_threaded')" href="../../_functions/forum_print_posts_threaded.html" onMouseOver="funcPopup(event,'forum_print_posts_threaded')">forum_print_posts_threaded</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('depth')" href="../../_variables/depth.html">$depth</a>-1, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>, <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>);
<a name="l5781"><span class="linenum">5781</span></a>              echo &quot;&lt;/div&gt;\n&quot;;
<a name="l5782"><span class="linenum">5782</span></a>          }
<a name="l5783"><span class="linenum">5783</span></a>      }
<a name="l5784"><span class="linenum">5784</span></a>  }
<a name="l5785"><span class="linenum">5785</span></a>  
<a name="l5786"><span class="linenum">5786</span></a>  <span class="comment">/**</span>
<a name="l5787"><span class="linenum">5787</span></a>  <span class="comment"> * @todo Document this function</span>
<a name="l5788"><span class="linenum">5788</span></a>  <span class="comment"> * @global object</span>
<a name="l5789"><span class="linenum">5789</span></a>  <span class="comment"> * @global object</span>
<a name="l5790"><span class="linenum">5790</span></a>  <span class="comment"> * @return void</span>
<a name="l5791"><span class="linenum">5791</span></a>  <span class="comment"> */</span>
<a name="l5792"><span class="linenum">5792</span></a>  function <a class="function" onClick="logFunction('forum_print_posts_nested')" href="../../_functions/forum_print_posts_nested.html" onMouseOver="funcPopup(event,'forum_print_posts_nested')">forum_print_posts_nested</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, &amp;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>, <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>) {
<a name="l5793"><span class="linenum">5793</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l5794"><span class="linenum">5794</span></a>  
<a name="l5795"><span class="linenum">5795</span></a>      <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>  = false;
<a name="l5796"><span class="linenum">5796</span></a>  
<a name="l5797"><span class="linenum">5797</span></a>      if (!empty(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('id')" class="var it43399" onMouseOver="hilite(43399)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;children)) {
<a name="l5798"><span class="linenum">5798</span></a>          <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>[<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('id')" class="var it43399" onMouseOver="hilite(43399)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;children;
<a name="l5799"><span class="linenum">5799</span></a>  
<a name="l5800"><span class="linenum">5800</span></a>          foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l5801"><span class="linenum">5801</span></a>  
<a name="l5802"><span class="linenum">5802</span></a>              echo '&lt;div class=&quot;indent&quot;&gt;';
<a name="l5803"><span class="linenum">5803</span></a>              if (!<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l5804"><span class="linenum">5804</span></a>                  <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a> = false;
<a name="l5805"><span class="linenum">5805</span></a>              } else {
<a name="l5806"><span class="linenum">5806</span></a>                  <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a> = (<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l5807"><span class="linenum">5807</span></a>              }
<a name="l5808"><span class="linenum">5808</span></a>  
<a name="l5809"><span class="linenum">5809</span></a>              <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>);
<a name="l5810"><span class="linenum">5810</span></a>              <a class="var it30668" onMouseOver="hilite(30668)" onMouseOut="lolite()" onClick="logVariable('postread')" href="../../_variables/postread.html">$postread</a> = !empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('postread')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/postread.html">postread</a>);
<a name="l5811"><span class="linenum">5811</span></a>  
<a name="l5812"><span class="linenum">5812</span></a>              <a class="function" onClick="logFunction('forum_print_post')" href="../../_functions/forum_print_post.html" onMouseOver="funcPopup(event,'forum_print_post')">forum_print_post</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it29769" onMouseOver="hilite(29769)" onMouseOut="lolite()" onClick="logVariable('ownpost')" href="../../_variables/ownpost.html">$ownpost</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>,
<a name="l5813"><span class="linenum">5813</span></a>                                   '', '', <a class="var it30668" onMouseOver="hilite(30668)" onMouseOut="lolite()" onClick="logVariable('postread')" href="../../_variables/postread.html">$postread</a>, true, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>);
<a name="l5814"><span class="linenum">5814</span></a>              <a class="function" onClick="logFunction('forum_print_posts_nested')" href="../../_functions/forum_print_posts_nested.html" onMouseOver="funcPopup(event,'forum_print_posts_nested')">forum_print_posts_nested</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it26092" onMouseOver="hilite(26092)" onMouseOut="lolite()" onClick="logVariable('reply')" href="../../_variables/reply.html">$reply</a>, <a class="var it30666" onMouseOver="hilite(30666)" onMouseOut="lolite()" onClick="logVariable('forumtracked')" href="../../_variables/forumtracked.html">$forumtracked</a>, <a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>);
<a name="l5815"><span class="linenum">5815</span></a>              echo &quot;&lt;/div&gt;\n&quot;;
<a name="l5816"><span class="linenum">5816</span></a>          }
<a name="l5817"><span class="linenum">5817</span></a>      }
<a name="l5818"><span class="linenum">5818</span></a>  }
<a name="l5819"><span class="linenum">5819</span></a>  
<a name="l5820"><span class="linenum">5820</span></a>  <span class="comment">/**</span>
<a name="l5821"><span class="linenum">5821</span></a>  <span class="comment"> * Returns all forum posts since a given time in specified forum.</span>
<a name="l5822"><span class="linenum">5822</span></a>  <span class="comment"> *</span>
<a name="l5823"><span class="linenum">5823</span></a>  <span class="comment"> * @todo Document this functions args</span>
<a name="l5824"><span class="linenum">5824</span></a>  <span class="comment"> * @global object</span>
<a name="l5825"><span class="linenum">5825</span></a>  <span class="comment"> * @global object</span>
<a name="l5826"><span class="linenum">5826</span></a>  <span class="comment"> * @global object</span>
<a name="l5827"><span class="linenum">5827</span></a>  <span class="comment"> * @global object</span>
<a name="l5828"><span class="linenum">5828</span></a>  <span class="comment"> */</span>
<a name="l5829"><span class="linenum">5829</span></a>  function <a class="function" onClick="logFunction('forum_get_recent_mod_activity')" href="../../_functions/forum_get_recent_mod_activity.html" onMouseOver="funcPopup(event,'forum_get_recent_mod_activity')">forum_get_recent_mod_activity</a>(&amp;<a class="var it561" onMouseOver="hilite(561)" onMouseOut="lolite()" onClick="logVariable('activities')" href="../../_variables/activities.html">$activities</a>, &amp;<a class="var it290" onMouseOver="hilite(290)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=0, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>=0)  {
<a name="l5830"><span class="linenum">5830</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l5831"><span class="linenum">5831</span></a>  
<a name="l5832"><span class="linenum">5832</span></a>      if (<a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('id')" class="var it43316" onMouseOver="hilite(43316)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l5833"><span class="linenum">5833</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>;
<a name="l5834"><span class="linenum">5834</span></a>      } else {
<a name="l5835"><span class="linenum">5835</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>));
<a name="l5836"><span class="linenum">5836</span></a>      }
<a name="l5837"><span class="linenum">5837</span></a>  
<a name="l5838"><span class="linenum">5838</span></a>      <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l5839"><span class="linenum">5839</span></a>  
<a name="l5840"><span class="linenum">5840</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('cms')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/cms.html">cms</a>[<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>];
<a name="l5841"><span class="linenum">5841</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>);
<a name="l5842"><span class="linenum">5842</span></a>  
<a name="l5843"><span class="linenum">5843</span></a>      if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l5844"><span class="linenum">5844</span></a>          <a class="var it3979" onMouseOver="hilite(3979)" onMouseOut="lolite()" onClick="logVariable('userselect')" href="../../_variables/userselect.html">$userselect</a> = &quot;AND u.id = ?&quot;;
<a name="l5845"><span class="linenum">5845</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l5846"><span class="linenum">5846</span></a>      } else {
<a name="l5847"><span class="linenum">5847</span></a>          <a class="var it3979" onMouseOver="hilite(3979)" onMouseOut="lolite()" onClick="logVariable('userselect')" href="../../_variables/userselect.html">$userselect</a> = &quot;&quot;;
<a name="l5848"><span class="linenum">5848</span></a>      }
<a name="l5849"><span class="linenum">5849</span></a>  
<a name="l5850"><span class="linenum">5850</span></a>      if (<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>) {
<a name="l5851"><span class="linenum">5851</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND d.groupid = ?&quot;;
<a name="l5852"><span class="linenum">5852</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l5853"><span class="linenum">5853</span></a>      } else {
<a name="l5854"><span class="linenum">5854</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l5855"><span class="linenum">5855</span></a>      }
<a name="l5856"><span class="linenum">5856</span></a>  
<a name="l5857"><span class="linenum">5857</span></a>      <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u');
<a name="l5858"><span class="linenum">5858</span></a>      if (!<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT p.*, f.type AS forumtype, d.forum, d.groupid,
<a name="l5859"><span class="linenum">5859</span></a>                                                d.timestart, d.timeend, d.userid AS duserid,
<a name="l5860"><span class="linenum">5860</span></a>                                                <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../_variables/allnames.html">$allnames</a>, u.email, u.picture, u.imagealt, u.email
<a name="l5861"><span class="linenum">5861</span></a>                                           FROM {forum_posts} p
<a name="l5862"><span class="linenum">5862</span></a>                                                JOIN {forum_discussions} d ON d.id = p.discussion
<a name="l5863"><span class="linenum">5863</span></a>                                                JOIN {forum} f             ON f.id = d.forum
<a name="l5864"><span class="linenum">5864</span></a>                                                JOIN {user} u              ON u.id = p.userid
<a name="l5865"><span class="linenum">5865</span></a>                                          WHERE p.created &gt; ? AND f.id = ?
<a name="l5866"><span class="linenum">5866</span></a>                                                <a class="var it3979" onMouseOver="hilite(3979)" onMouseOut="lolite()" onClick="logVariable('userselect')" href="../../_variables/userselect.html">$userselect</a> <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a>
<a name="l5867"><span class="linenum">5867</span></a>                                       ORDER BY p.id ASC&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) { // order by initial posting date
<a name="l5868"><span class="linenum">5868</span></a>           return;
<a name="l5869"><span class="linenum">5869</span></a>      }
<a name="l5870"><span class="linenum">5870</span></a>  
<a name="l5871"><span class="linenum">5871</span></a>      <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>       = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l5872"><span class="linenum">5872</span></a>      <a class="var it5399" onMouseOver="hilite(5399)" onMouseOut="lolite()" onClick="logVariable('cm_context')" href="../../_variables/cm_context.html">$cm_context</a>      = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l5873"><span class="linenum">5873</span></a>      <a class="var it41622" onMouseOver="hilite(41622)" onMouseOut="lolite()" onClick="logVariable('viewhiddentimed')" href="../../_variables/viewhiddentimed.html">$viewhiddentimed</a> = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts', <a class="var it5399" onMouseOver="hilite(5399)" onMouseOut="lolite()" onClick="logVariable('cm_context')" href="../../_variables/cm_context.html">$cm_context</a>);
<a name="l5874"><span class="linenum">5874</span></a>      <a class="var it9805" onMouseOver="hilite(9805)" onMouseOut="lolite()" onClick="logVariable('accessallgroups')" href="../../_variables/accessallgroups.html">$accessallgroups</a> = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it5399" onMouseOver="hilite(5399)" onMouseOut="lolite()" onClick="logVariable('cm_context')" href="../../_variables/cm_context.html">$cm_context</a>);
<a name="l5875"><span class="linenum">5875</span></a>  
<a name="l5876"><span class="linenum">5876</span></a>      <a class="var it41525" onMouseOver="hilite(41525)" onMouseOut="lolite()" onClick="logVariable('printposts')" href="../../_variables/printposts.html">$printposts</a> = array();
<a name="l5877"><span class="linenum">5877</span></a>      foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l5878"><span class="linenum">5878</span></a>  
<a name="l5879"><span class="linenum">5879</span></a>          if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>) and <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> != <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;duserid
<a name="l5880"><span class="linenum">5880</span></a>            and ((<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timestart')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> &gt; 0 and <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timestart')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> &gt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) <a class="function" onClick="logFunction('or')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timeend')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a> &gt; 0 and <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('timeend')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()))) {
<a name="l5881"><span class="linenum">5881</span></a>              if (!<a class="var it41622" onMouseOver="hilite(41622)" onMouseOut="lolite()" onClick="logVariable('viewhiddentimed')" href="../../_variables/viewhiddentimed.html">$viewhiddentimed</a>) {
<a name="l5882"><span class="linenum">5882</span></a>                  continue;
<a name="l5883"><span class="linenum">5883</span></a>              }
<a name="l5884"><span class="linenum">5884</span></a>          }
<a name="l5885"><span class="linenum">5885</span></a>  
<a name="l5886"><span class="linenum">5886</span></a>          if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a>) {
<a name="l5887"><span class="linenum">5887</span></a>              if (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('groupid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> == -1 or <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> == <a class="constant" onClick="logConstant('VISIBLEGROUPS')" href="../../_constants/VISIBLEGROUPS.html" onMouseOver="constPopup(event,'VISIBLEGROUPS')">VISIBLEGROUPS</a> or <a class="var it9805" onMouseOver="hilite(9805)" onMouseOut="lolite()" onClick="logVariable('accessallgroups')" href="../../_variables/accessallgroups.html">$accessallgroups</a>) {
<a name="l5888"><span class="linenum">5888</span></a>  <span class="comment">                // oki (Open discussions have groupid -1)</span>
<a name="l5889"><span class="linenum">5889</span></a>              } else {
<a name="l5890"><span class="linenum">5890</span></a>  <span class="comment">                // separate mode</span>
<a name="l5891"><span class="linenum">5891</span></a>                  if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>()) {
<a name="l5892"><span class="linenum">5892</span></a>  <span class="comment">                    // shortcut</span>
<a name="l5893"><span class="linenum">5893</span></a>                      continue;
<a name="l5894"><span class="linenum">5894</span></a>                  }
<a name="l5895"><span class="linenum">5895</span></a>  
<a name="l5896"><span class="linenum">5896</span></a>                  if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('groupid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>, <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_groups')" href="../../_functions/get_groups.html" onMouseOver="funcPopup(event,'get_groups')">get_groups</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>))) {
<a name="l5897"><span class="linenum">5897</span></a>                      continue;
<a name="l5898"><span class="linenum">5898</span></a>                  }
<a name="l5899"><span class="linenum">5899</span></a>              }
<a name="l5900"><span class="linenum">5900</span></a>          }
<a name="l5901"><span class="linenum">5901</span></a>  
<a name="l5902"><span class="linenum">5902</span></a>          <a class="var it41525" onMouseOver="hilite(41525)" onMouseOut="lolite()" onClick="logVariable('printposts')" href="../../_variables/printposts.html">$printposts</a>[] = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>;
<a name="l5903"><span class="linenum">5903</span></a>      }
<a name="l5904"><span class="linenum">5904</span></a>  
<a name="l5905"><span class="linenum">5905</span></a>      if (!<a class="var it41525" onMouseOver="hilite(41525)" onMouseOut="lolite()" onClick="logVariable('printposts')" href="../../_variables/printposts.html">$printposts</a>) {
<a name="l5906"><span class="linenum">5906</span></a>          return;
<a name="l5907"><span class="linenum">5907</span></a>      }
<a name="l5908"><span class="linenum">5908</span></a>  
<a name="l5909"><span class="linenum">5909</span></a>      <a class="var it9806" onMouseOver="hilite(9806)" onMouseOut="lolite()" onClick="logVariable('aname')" href="../../_variables/aname.html">$aname</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('name')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>,true);
<a name="l5910"><span class="linenum">5910</span></a>  
<a name="l5911"><span class="linenum">5911</span></a>      foreach (<a class="var it41525" onMouseOver="hilite(41525)" onMouseOut="lolite()" onClick="logVariable('printposts')" href="../../_variables/printposts.html">$printposts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l5912"><span class="linenum">5912</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a> = new stdClass();
<a name="l5913"><span class="linenum">5913</span></a>  
<a name="l5914"><span class="linenum">5914</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('type')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>         = 'forum';
<a name="l5915"><span class="linenum">5915</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('cmid')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/cmid.html">cmid</a>         = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l5916"><span class="linenum">5916</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('name')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>         = <a class="var it9806" onMouseOver="hilite(9806)" onMouseOut="lolite()" onClick="logVariable('aname')" href="../../_variables/aname.html">$aname</a>;
<a name="l5917"><span class="linenum">5917</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('sectionnum')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/sectionnum.html">sectionnum</a>   = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('sectionnum')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/sectionnum.html">sectionnum</a>;
<a name="l5918"><span class="linenum">5918</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('timestamp')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/timestamp.html">timestamp</a>    = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>;
<a name="l5919"><span class="linenum">5919</span></a>  
<a name="l5920"><span class="linenum">5920</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('content')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/content.html">content</a> = new stdClass();
<a name="l5921"><span class="linenum">5921</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('content')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/content.html">content</a>-&gt;id         = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l5922"><span class="linenum">5922</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('content')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/content.html">content</a>-&gt;discussion = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('discussion')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>;
<a name="l5923"><span class="linenum">5923</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('content')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/content.html">content</a>-&gt;subject    = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('subject')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>);
<a name="l5924"><span class="linenum">5924</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('content')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/content.html">content</a>-&gt;parent     = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>;
<a name="l5925"><span class="linenum">5925</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('content')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/content.html">content</a>-&gt;forumtype  = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forumtype')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forumtype.html">forumtype</a>;
<a name="l5926"><span class="linenum">5926</span></a>  
<a name="l5927"><span class="linenum">5927</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('user')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/user.html">user</a> = new stdClass();
<a name="l5928"><span class="linenum">5928</span></a>          <a class="var it3762" onMouseOver="hilite(3762)" onMouseOut="lolite()" onClick="logVariable('additionalfields')" href="../../_variables/additionalfields.html">$additionalfields</a> = array('id' =&gt; 'userid', 'picture', 'imagealt', 'email');
<a name="l5929"><span class="linenum">5929</span></a>          <a class="var it3762" onMouseOver="hilite(3762)" onMouseOut="lolite()" onClick="logVariable('additionalfields')" href="../../_variables/additionalfields.html">$additionalfields</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="class" onClick="logClass('user_picture')" href="../../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>());
<a name="l5930"><span class="linenum">5930</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('user')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/user.html">user</a> = <a class="function" onClick="logFunction('username_load_fields_from_object')" href="../../_functions/username_load_fields_from_object.html" onMouseOver="funcPopup(event,'username_load_fields_from_object')">username_load_fields_from_object</a>(<a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('user')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/user.html">user</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, null, <a class="var it3762" onMouseOver="hilite(3762)" onMouseOut="lolite()" onClick="logVariable('additionalfields')" href="../../_variables/additionalfields.html">$additionalfields</a>);
<a name="l5931"><span class="linenum">5931</span></a>          <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>-&gt;<a onClick="logVariable('user')" class="var it44548" onMouseOver="hilite(44548)" onMouseOut="lolite()" href="../../_variables/user.html">user</a>-&gt;id = <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('userid')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l5932"><span class="linenum">5932</span></a>  
<a name="l5933"><span class="linenum">5933</span></a>          <a class="var it561" onMouseOver="hilite(561)" onMouseOut="lolite()" onClick="logVariable('activities')" href="../../_variables/activities.html">$activities</a>[<a class="var it290" onMouseOver="hilite(290)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>++] = <a class="var it9807" onMouseOver="hilite(9807)" onMouseOut="lolite()" onClick="logVariable('tmpactivity')" href="../../_variables/tmpactivity.html">$tmpactivity</a>;
<a name="l5934"><span class="linenum">5934</span></a>      }
<a name="l5935"><span class="linenum">5935</span></a>  
<a name="l5936"><span class="linenum">5936</span></a>      return;
<a name="l5937"><span class="linenum">5937</span></a>  }
<a name="l5938"><span class="linenum">5938</span></a>  
<a name="l5939"><span class="linenum">5939</span></a>  <span class="comment">/**</span>
<a name="l5940"><span class="linenum">5940</span></a>  <span class="comment"> * Outputs the forum post indicated by $activity.</span>
<a name="l5941"><span class="linenum">5941</span></a>  <span class="comment"> *</span>
<a name="l5942"><span class="linenum">5942</span></a>  <span class="comment"> * @param object $activity      the activity object the forum resides in</span>
<a name="l5943"><span class="linenum">5943</span></a>  <span class="comment"> * @param int    $courseid      the id of the course the forum resides in</span>
<a name="l5944"><span class="linenum">5944</span></a>  <span class="comment"> * @param bool   $detail        not used, but required for compatibilty with other modules</span>
<a name="l5945"><span class="linenum">5945</span></a>  <span class="comment"> * @param int    $modnames      not used, but required for compatibilty with other modules</span>
<a name="l5946"><span class="linenum">5946</span></a>  <span class="comment"> * @param bool   $viewfullnames not used, but required for compatibilty with other modules</span>
<a name="l5947"><span class="linenum">5947</span></a>  <span class="comment"> */</span>
<a name="l5948"><span class="linenum">5948</span></a>  function <a class="function" onClick="logFunction('forum_print_recent_mod_activity')" href="../../_functions/forum_print_recent_mod_activity.html" onMouseOver="funcPopup(event,'forum_print_recent_mod_activity')">forum_print_recent_mod_activity</a>(<a class="var it562" onMouseOver="hilite(562)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it5390" onMouseOver="hilite(5390)" onMouseOut="lolite()" onClick="logVariable('detail')" href="../../_variables/detail.html">$detail</a>, <a class="var it733" onMouseOver="hilite(733)" onMouseOut="lolite()" onClick="logVariable('modnames')" href="../../_variables/modnames.html">$modnames</a>, <a class="var it5397" onMouseOver="hilite(5397)" onMouseOut="lolite()" onClick="logVariable('viewfullnames')" href="../../_variables/viewfullnames.html">$viewfullnames</a>) {
<a name="l5949"><span class="linenum">5949</span></a>      global <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l5950"><span class="linenum">5950</span></a>  
<a name="l5951"><span class="linenum">5951</span></a>      <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="var it562" onMouseOver="hilite(562)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('content')" class="var it42975" onMouseOver="hilite(42975)" onMouseOut="lolite()" href="../../_variables/content.html">content</a>;
<a name="l5952"><span class="linenum">5952</span></a>      if (<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>-&gt;<a onClick="logVariable('parent')" class="var it43077" onMouseOver="hilite(43077)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>) {
<a name="l5953"><span class="linenum">5953</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a> = 'reply';
<a name="l5954"><span class="linenum">5954</span></a>      } else {
<a name="l5955"><span class="linenum">5955</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a> = 'discussion';
<a name="l5956"><span class="linenum">5956</span></a>      }
<a name="l5957"><span class="linenum">5957</span></a>  
<a name="l5958"><span class="linenum">5958</span></a>      <a class="var it8577" onMouseOver="hilite(8577)" onMouseOut="lolite()" onClick="logVariable('tableoptions')" href="../../_variables/tableoptions.html">$tableoptions</a> = [
<a name="l5959"><span class="linenum">5959</span></a>          'border' =&gt; '0',
<a name="l5960"><span class="linenum">5960</span></a>          'cellpadding' =&gt; '3',
<a name="l5961"><span class="linenum">5961</span></a>          'cellspacing' =&gt; '0',
<a name="l5962"><span class="linenum">5962</span></a>          'class' =&gt; 'forum-recent'
<a name="l5963"><span class="linenum">5963</span></a>      ];
<a name="l5964"><span class="linenum">5964</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('table', <a class="var it8577" onMouseOver="hilite(8577)" onMouseOut="lolite()" onClick="logVariable('tableoptions')" href="../../_variables/tableoptions.html">$tableoptions</a>);
<a name="l5965"><span class="linenum">5965</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('tr');
<a name="l5966"><span class="linenum">5966</span></a>  
<a name="l5967"><span class="linenum">5967</span></a>      <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a> = (object) ['parent' =&gt; <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>-&gt;<a onClick="logVariable('parent')" class="var it43077" onMouseOver="hilite(43077)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>];
<a name="l5968"><span class="linenum">5968</span></a>      <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = (object) ['type' =&gt; <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>-&gt;<a onClick="logVariable('forumtype')" class="var it43077" onMouseOver="hilite(43077)" onMouseOut="lolite()" href="../../_variables/forumtype.html">forumtype</a>];
<a name="l5969"><span class="linenum">5969</span></a>      <a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a> = <a class="function" onClick="logFunction('forum_is_author_hidden')" href="../../_functions/forum_is_author_hidden.html" onMouseOver="funcPopup(event,'forum_is_author_hidden')">forum_is_author_hidden</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l5970"><span class="linenum">5970</span></a>  
<a name="l5971"><span class="linenum">5971</span></a>  <span class="comment">    // Show user picture if author should not be hidden.</span>
<a name="l5972"><span class="linenum">5972</span></a>      if (!<a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a>) {
<a name="l5973"><span class="linenum">5973</span></a>          <a class="var it41623" onMouseOver="hilite(41623)" onMouseOut="lolite()" onClick="logVariable('pictureoptions')" href="../../_variables/pictureoptions.html">$pictureoptions</a> = [
<a name="l5974"><span class="linenum">5974</span></a>              'courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>,
<a name="l5975"><span class="linenum">5975</span></a>              'link' =&gt; <a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a>,
<a name="l5976"><span class="linenum">5976</span></a>              'alttext' =&gt; <a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a>,
<a name="l5977"><span class="linenum">5977</span></a>          ];
<a name="l5978"><span class="linenum">5978</span></a>          <a class="var it3382" onMouseOver="hilite(3382)" onMouseOut="lolite()" onClick="logVariable('picture')" href="../../_variables/picture.html">$picture</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it562" onMouseOver="hilite(562)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('user')" class="var it42975" onMouseOver="hilite(42975)" onMouseOut="lolite()" href="../../_variables/user.html">user</a>, <a class="var it41623" onMouseOver="hilite(41623)" onMouseOut="lolite()" onClick="logVariable('pictureoptions')" href="../../_variables/pictureoptions.html">$pictureoptions</a>);
<a name="l5979"><span class="linenum">5979</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('td', <a class="var it3382" onMouseOver="hilite(3382)" onMouseOut="lolite()" onClick="logVariable('picture')" href="../../_variables/picture.html">$picture</a>, ['class' =&gt; 'userpicture', 'valign' =&gt; 'top']);
<a name="l5980"><span class="linenum">5980</span></a>      }
<a name="l5981"><span class="linenum">5981</span></a>  
<a name="l5982"><span class="linenum">5982</span></a>  <span class="comment">    // Discussion title and author.</span>
<a name="l5983"><span class="linenum">5983</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('td', ['class' =&gt; <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a>]);
<a name="l5984"><span class="linenum">5984</span></a>      if (<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>-&gt;<a onClick="logVariable('parent')" class="var it43077" onMouseOver="hilite(43077)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>) {
<a name="l5985"><span class="linenum">5985</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a> = 'title';
<a name="l5986"><span class="linenum">5986</span></a>      } else {
<a name="l5987"><span class="linenum">5987</span></a>  <span class="comment">        // Bold the title of new discussions so they stand out.</span>
<a name="l5988"><span class="linenum">5988</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a> = 'title bold';
<a name="l5989"><span class="linenum">5989</span></a>      }
<a name="l5990"><span class="linenum">5990</span></a>  
<a name="l5991"><span class="linenum">5991</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_div')" href="../../_functions/start_div.html" onMouseOver="funcPopup(event,'start_div')">start_div</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a>);
<a name="l5992"><span class="linenum">5992</span></a>      if (<a class="var it5390" onMouseOver="hilite(5390)" onMouseOut="lolite()" onClick="logVariable('detail')" href="../../_variables/detail.html">$detail</a>) {
<a name="l5993"><span class="linenum">5993</span></a>          <a class="var it9806" onMouseOver="hilite(9806)" onMouseOut="lolite()" onClick="logVariable('aname')" href="../../_variables/aname.html">$aname</a> = <a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="var it562" onMouseOver="hilite(562)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('name')" class="var it42975" onMouseOver="hilite(42975)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>);
<a name="l5994"><span class="linenum">5994</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('img')" href="../../_functions/img.html" onMouseOver="funcPopup(event,'img')">img</a>(<a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_url')" href="../../_functions/pix_url.html" onMouseOver="funcPopup(event,'pix_url')">pix_url</a>('icon', <a class="var it562" onMouseOver="hilite(562)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('type')" class="var it42975" onMouseOver="hilite(42975)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>), <a class="var it9806" onMouseOver="hilite(9806)" onMouseOut="lolite()" onClick="logVariable('aname')" href="../../_variables/aname.html">$aname</a>, ['class' =&gt; 'icon']);
<a name="l5995"><span class="linenum">5995</span></a>      }
<a name="l5996"><span class="linenum">5996</span></a>      <a class="var it7455" onMouseOver="hilite(7455)" onMouseOut="lolite()" onClick="logVariable('discussionurl')" href="../../_variables/discussionurl.html">$discussionurl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/discuss.php.html">/mod/forum/discuss.php</a>', ['d' =&gt; <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>-&gt;<a onClick="logVariable('discussion')" class="var it43077" onMouseOver="hilite(43077)" onMouseOut="lolite()" href="../../_variables/discussion.html">discussion</a>]);
<a name="l5997"><span class="linenum">5997</span></a>      <a class="var it7455" onMouseOver="hilite(7455)" onMouseOut="lolite()" onClick="logVariable('discussionurl')" href="../../_variables/discussionurl.html">$discussionurl</a>-&gt;<a class="function" onClick="logFunction('set_anchor')" href="../../_functions/set_anchor.html" onMouseOver="funcPopup(event,'set_anchor')">set_anchor</a>('p' . <a class="var it562" onMouseOver="hilite(562)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('content')" class="var it42975" onMouseOver="hilite(42975)" onMouseOut="lolite()" href="../../_variables/content.html">content</a>-&gt;id);
<a name="l5998"><span class="linenum">5998</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it7455" onMouseOver="hilite(7455)" onMouseOut="lolite()" onClick="logVariable('discussionurl')" href="../../_variables/discussionurl.html">$discussionurl</a>, <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>-&gt;<a onClick="logVariable('subject')" class="var it43077" onMouseOver="hilite(43077)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>);
<a name="l5999"><span class="linenum">5999</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_div')" href="../../_functions/end_div.html" onMouseOver="funcPopup(event,'end_div')">end_div</a>();
<a name="l6000"><span class="linenum">6000</span></a>  
<a name="l6001"><span class="linenum">6001</span></a>      <a class="var it1769" onMouseOver="hilite(1769)" onMouseOut="lolite()" onClick="logVariable('timestamp')" href="../../_variables/timestamp.html">$timestamp</a> = <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it562" onMouseOver="hilite(562)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('timestamp')" class="var it42975" onMouseOver="hilite(42975)" onMouseOut="lolite()" href="../../_variables/timestamp.html">timestamp</a>);
<a name="l6002"><span class="linenum">6002</span></a>      if (<a class="var it41527" onMouseOver="hilite(41527)" onMouseOut="lolite()" onClick="logVariable('authorhidden')" href="../../_variables/authorhidden.html">$authorhidden</a>) {
<a name="l6003"><span class="linenum">6003</span></a>          <a class="var it41624" onMouseOver="hilite(41624)" onMouseOut="lolite()" onClick="logVariable('authornamedate')" href="../../_variables/authornamedate.html">$authornamedate</a> = <a class="var it1769" onMouseOver="hilite(1769)" onMouseOut="lolite()" onClick="logVariable('timestamp')" href="../../_variables/timestamp.html">$timestamp</a>;
<a name="l6004"><span class="linenum">6004</span></a>      } else {
<a name="l6005"><span class="linenum">6005</span></a>          <a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a> = <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it562" onMouseOver="hilite(562)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('user')" class="var it42975" onMouseOver="hilite(42975)" onMouseOut="lolite()" href="../../_variables/user.html">user</a>, <a class="var it5397" onMouseOver="hilite(5397)" onMouseOut="lolite()" onClick="logVariable('viewfullnames')" href="../../_variables/viewfullnames.html">$viewfullnames</a>);
<a name="l6006"><span class="linenum">6006</span></a>          <a class="var it12090" onMouseOver="hilite(12090)" onMouseOut="lolite()" onClick="logVariable('userurl')" href="../../_variables/userurl.html">$userurl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../user/view.php.html">/user/view.php</a>');
<a name="l6007"><span class="linenum">6007</span></a>          <a class="var it12090" onMouseOver="hilite(12090)" onMouseOut="lolite()" onClick="logVariable('userurl')" href="../../_variables/userurl.html">$userurl</a>-&gt;<a class="function" onClick="logFunction('params')" href="../../_functions/params.html" onMouseOver="funcPopup(event,'params')">params</a>(['id' =&gt; <a class="var it562" onMouseOver="hilite(562)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('user')" class="var it42975" onMouseOver="hilite(42975)" onMouseOut="lolite()" href="../../_variables/user.html">user</a>-&gt;id, 'course' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>]);
<a name="l6008"><span class="linenum">6008</span></a>          <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a> = new stdClass();
<a name="l6009"><span class="linenum">6009</span></a>          <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a>-&gt;<a onClick="logVariable('name')" class="var it44595" onMouseOver="hilite(44595)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it12090" onMouseOver="hilite(12090)" onMouseOut="lolite()" onClick="logVariable('userurl')" href="../../_variables/userurl.html">$userurl</a>, <a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>);
<a name="l6010"><span class="linenum">6010</span></a>          <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a>-&gt;<a onClick="logVariable('date')" class="var it44595" onMouseOver="hilite(44595)" onMouseOut="lolite()" href="../../_variables/date.html">date</a> = <a class="var it1769" onMouseOver="hilite(1769)" onMouseOut="lolite()" onClick="logVariable('timestamp')" href="../../_variables/timestamp.html">$timestamp</a>;
<a name="l6011"><span class="linenum">6011</span></a>          <a class="var it41624" onMouseOver="hilite(41624)" onMouseOut="lolite()" onClick="logVariable('authornamedate')" href="../../_variables/authornamedate.html">$authornamedate</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('bynameondate', 'forum', <a class="var it4884" onMouseOver="hilite(4884)" onMouseOut="lolite()" onClick="logVariable('by')" href="../../_variables/by.html">$by</a>);
<a name="l6012"><span class="linenum">6012</span></a>      }
<a name="l6013"><span class="linenum">6013</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('div')" href="../../_functions/div.html" onMouseOver="funcPopup(event,'div')">div</a>(<a class="var it41624" onMouseOver="hilite(41624)" onMouseOut="lolite()" onClick="logVariable('authornamedate')" href="../../_variables/authornamedate.html">$authornamedate</a>, 'user');
<a name="l6014"><span class="linenum">6014</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('td');
<a name="l6015"><span class="linenum">6015</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('tr');
<a name="l6016"><span class="linenum">6016</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('table');
<a name="l6017"><span class="linenum">6017</span></a>  
<a name="l6018"><span class="linenum">6018</span></a>      echo <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l6019"><span class="linenum">6019</span></a>  }
<a name="l6020"><span class="linenum">6020</span></a>  
<a name="l6021"><span class="linenum">6021</span></a>  <span class="comment">/**</span>
<a name="l6022"><span class="linenum">6022</span></a>  <span class="comment"> * recursively sets the discussion field to $discussionid on $postid and all its children</span>
<a name="l6023"><span class="linenum">6023</span></a>  <span class="comment"> * used when pruning a post</span>
<a name="l6024"><span class="linenum">6024</span></a>  <span class="comment"> *</span>
<a name="l6025"><span class="linenum">6025</span></a>  <span class="comment"> * @global object</span>
<a name="l6026"><span class="linenum">6026</span></a>  <span class="comment"> * @param int $postid</span>
<a name="l6027"><span class="linenum">6027</span></a>  <span class="comment"> * @param int $discussionid</span>
<a name="l6028"><span class="linenum">6028</span></a>  <span class="comment"> * @return bool</span>
<a name="l6029"><span class="linenum">6029</span></a>  <span class="comment"> */</span>
<a name="l6030"><span class="linenum">6030</span></a>  function <a class="function" onClick="logFunction('forum_change_discussionid')" href="../../_functions/forum_change_discussionid.html" onMouseOver="funcPopup(event,'forum_change_discussionid')">forum_change_discussionid</a>(<a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>, <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>) {
<a name="l6031"><span class="linenum">6031</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6032"><span class="linenum">6032</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('forum_posts', 'discussion', <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>, array('id' =&gt; <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>));
<a name="l6033"><span class="linenum">6033</span></a>      if (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('forum_posts', array('parent' =&gt; <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>))) {
<a name="l6034"><span class="linenum">6034</span></a>          foreach (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l6035"><span class="linenum">6035</span></a>              <a class="function" onClick="logFunction('forum_change_discussionid')" href="../../_functions/forum_change_discussionid.html" onMouseOver="funcPopup(event,'forum_change_discussionid')">forum_change_discussionid</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>);
<a name="l6036"><span class="linenum">6036</span></a>          }
<a name="l6037"><span class="linenum">6037</span></a>      }
<a name="l6038"><span class="linenum">6038</span></a>      return true;
<a name="l6039"><span class="linenum">6039</span></a>  }
<a name="l6040"><span class="linenum">6040</span></a>  
<a name="l6041"><span class="linenum">6041</span></a>  <span class="comment">/**</span>
<a name="l6042"><span class="linenum">6042</span></a>  <span class="comment"> * Prints the editing button on subscribers page</span>
<a name="l6043"><span class="linenum">6043</span></a>  <span class="comment"> *</span>
<a name="l6044"><span class="linenum">6044</span></a>  <span class="comment"> * @global object</span>
<a name="l6045"><span class="linenum">6045</span></a>  <span class="comment"> * @global object</span>
<a name="l6046"><span class="linenum">6046</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l6047"><span class="linenum">6047</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l6048"><span class="linenum">6048</span></a>  <span class="comment"> * @return string</span>
<a name="l6049"><span class="linenum">6049</span></a>  <span class="comment"> */</span>
<a name="l6050"><span class="linenum">6050</span></a>  function <a class="function" onClick="logFunction('forum_update_subscriptions_button')" href="../../_functions/forum_update_subscriptions_button.html" onMouseOver="funcPopup(event,'forum_update_subscriptions_button')">forum_update_subscriptions_button</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>) {
<a name="l6051"><span class="linenum">6051</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l6052"><span class="linenum">6052</span></a>  
<a name="l6053"><span class="linenum">6053</span></a>      if (!empty(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('subscriptionsediting')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/subscriptionsediting.html">subscriptionsediting</a>)) {
<a name="l6054"><span class="linenum">6054</span></a>          <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('turneditingoff');
<a name="l6055"><span class="linenum">6055</span></a>          <a class="var it417" onMouseOver="hilite(417)" onMouseOut="lolite()" onClick="logVariable('edit')" href="../../_variables/edit.html">$edit</a> = &quot;off&quot;;
<a name="l6056"><span class="linenum">6056</span></a>      } else {
<a name="l6057"><span class="linenum">6057</span></a>          <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('turneditingon');
<a name="l6058"><span class="linenum">6058</span></a>          <a class="var it417" onMouseOver="hilite(417)" onMouseOut="lolite()" onClick="logVariable('edit')" href="../../_variables/edit.html">$edit</a> = &quot;on&quot;;
<a name="l6059"><span class="linenum">6059</span></a>      }
<a name="l6060"><span class="linenum">6060</span></a>  
<a name="l6061"><span class="linenum">6061</span></a>      return &quot;&lt;form method=\&quot;get\&quot; action=\&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/mod/forum/subscribers.php\&quot;&gt;&quot;.
<a name="l6062"><span class="linenum">6062</span></a>             &quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;id\&quot; value=\&quot;<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>\&quot; /&gt;&quot;.
<a name="l6063"><span class="linenum">6063</span></a>             &quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;edit\&quot; value=\&quot;<a class="var it417" onMouseOver="hilite(417)" onMouseOut="lolite()" onClick="logVariable('edit')" href="../../_variables/edit.html">$edit</a>\&quot; /&gt;&quot;.
<a name="l6064"><span class="linenum">6064</span></a>             &quot;&lt;input type=\&quot;submit\&quot; value=\&quot;<a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>\&quot; /&gt;&lt;/form&gt;&quot;;
<a name="l6065"><span class="linenum">6065</span></a>  }
<a name="l6066"><span class="linenum">6066</span></a>  
<a name="l6067"><span class="linenum">6067</span></a>  <span class="comment">// Functions to do with read tracking.</span>
<a name="l6068"><span class="linenum">6068</span></a>  
<a name="l6069"><span class="linenum">6069</span></a>  <span class="comment">/**</span>
<a name="l6070"><span class="linenum">6070</span></a>  <span class="comment"> * Mark posts as read.</span>
<a name="l6071"><span class="linenum">6071</span></a>  <span class="comment"> *</span>
<a name="l6072"><span class="linenum">6072</span></a>  <span class="comment"> * @global object</span>
<a name="l6073"><span class="linenum">6073</span></a>  <span class="comment"> * @global object</span>
<a name="l6074"><span class="linenum">6074</span></a>  <span class="comment"> * @param object $user object</span>
<a name="l6075"><span class="linenum">6075</span></a>  <span class="comment"> * @param array $postids array of post ids</span>
<a name="l6076"><span class="linenum">6076</span></a>  <span class="comment"> * @return boolean success</span>
<a name="l6077"><span class="linenum">6077</span></a>  <span class="comment"> */</span>
<a name="l6078"><span class="linenum">6078</span></a>  function <a class="function" onClick="logFunction('forum_tp_mark_posts_read')" href="../../_functions/forum_tp_mark_posts_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_posts_read')">forum_tp_mark_posts_read</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it41625" onMouseOver="hilite(41625)" onMouseOut="lolite()" onClick="logVariable('postids')" href="../../_variables/postids.html">$postids</a>) {
<a name="l6079"><span class="linenum">6079</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6080"><span class="linenum">6080</span></a>  
<a name="l6081"><span class="linenum">6081</span></a>      if (!<a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>(false, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l6082"><span class="linenum">6082</span></a>          return true;
<a name="l6083"><span class="linenum">6083</span></a>      }
<a name="l6084"><span class="linenum">6084</span></a>  
<a name="l6085"><span class="linenum">6085</span></a>      <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = true;
<a name="l6086"><span class="linenum">6086</span></a>  
<a name="l6087"><span class="linenum">6087</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l6088"><span class="linenum">6088</span></a>      <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a> * 24 * 3600);
<a name="l6089"><span class="linenum">6089</span></a>  
<a name="l6090"><span class="linenum">6090</span></a>      if (empty(<a class="var it41625" onMouseOver="hilite(41625)" onMouseOut="lolite()" onClick="logVariable('postids')" href="../../_variables/postids.html">$postids</a>)) {
<a name="l6091"><span class="linenum">6091</span></a>          return true;
<a name="l6092"><span class="linenum">6092</span></a>  
<a name="l6093"><span class="linenum">6093</span></a>      } else if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it41625" onMouseOver="hilite(41625)" onMouseOut="lolite()" onClick="logVariable('postids')" href="../../_variables/postids.html">$postids</a>) &gt; 200) {
<a name="l6094"><span class="linenum">6094</span></a>          while (<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a> = <a class="phpfunction" onClick="logFunction('array_splice')" href="../../_functions/array_splice.html" onMouseOver="phpfuncPopup(event,'array_splice')">array_splice</a>(<a class="var it41625" onMouseOver="hilite(41625)" onMouseOut="lolite()" onClick="logVariable('postids')" href="../../_variables/postids.html">$postids</a>, 0, 200)) {
<a name="l6095"><span class="linenum">6095</span></a>              <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = <a class="function" onClick="logFunction('forum_tp_mark_posts_read')" href="../../_functions/forum_tp_mark_posts_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_posts_read')">forum_tp_mark_posts_read</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a>) &amp;&amp; <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>;
<a name="l6096"><span class="linenum">6096</span></a>          }
<a name="l6097"><span class="linenum">6097</span></a>          return <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>;
<a name="l6098"><span class="linenum">6098</span></a>      }
<a name="l6099"><span class="linenum">6099</span></a>  
<a name="l6100"><span class="linenum">6100</span></a>      <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2642" onMouseOver="hilite(2642)" onMouseOut="lolite()" onClick="logVariable('usql')" href="../../_variables/usql.html">$usql</a>, <a class="var it41626" onMouseOver="hilite(41626)" onMouseOut="lolite()" onClick="logVariable('postidparams')" href="../../_variables/postidparams.html">$postidparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it41625" onMouseOver="hilite(41625)" onMouseOut="lolite()" onClick="logVariable('postids')" href="../../_variables/postids.html">$postids</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'postid');
<a name="l6101"><span class="linenum">6101</span></a>  
<a name="l6102"><span class="linenum">6102</span></a>      <a class="var it41627" onMouseOver="hilite(41627)" onMouseOut="lolite()" onClick="logVariable('insertparams')" href="../../_variables/insertparams.html">$insertparams</a> = array(
<a name="l6103"><span class="linenum">6103</span></a>          'userid1' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l6104"><span class="linenum">6104</span></a>          'userid2' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l6105"><span class="linenum">6105</span></a>          'userid3' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l6106"><span class="linenum">6106</span></a>          'firstread' =&gt; <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>,
<a name="l6107"><span class="linenum">6107</span></a>          'lastread' =&gt; <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>,
<a name="l6108"><span class="linenum">6108</span></a>          'cutoffdate' =&gt; <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a>,
<a name="l6109"><span class="linenum">6109</span></a>      );
<a name="l6110"><span class="linenum">6110</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it41626" onMouseOver="hilite(41626)" onMouseOut="lolite()" onClick="logVariable('postidparams')" href="../../_variables/postidparams.html">$postidparams</a>, <a class="var it41627" onMouseOver="hilite(41627)" onMouseOut="lolite()" onClick="logVariable('insertparams')" href="../../_variables/insertparams.html">$insertparams</a>);
<a name="l6111"><span class="linenum">6111</span></a>  
<a name="l6112"><span class="linenum">6112</span></a>      if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_allowforcedreadtracking')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_allowforcedreadtracking.html">forum_allowforcedreadtracking</a>) {
<a name="l6113"><span class="linenum">6113</span></a>          <a class="var it41628" onMouseOver="hilite(41628)" onMouseOut="lolite()" onClick="logVariable('trackingsql')" href="../../_variables/trackingsql.html">$trackingsql</a> = &quot;AND (f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_FORCED')" href="../../_constants/FORUM_TRACKING_FORCED.html" onMouseOver="constPopup(event,'FORUM_TRACKING_FORCED')">FORUM_TRACKING_FORCED</a>.&quot;
<a name="l6114"><span class="linenum">6114</span></a>                          <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>.&quot; AND tf.id IS NULL))&quot;;
<a name="l6115"><span class="linenum">6115</span></a>      } else {
<a name="l6116"><span class="linenum">6116</span></a>          <a class="var it41628" onMouseOver="hilite(41628)" onMouseOut="lolite()" onClick="logVariable('trackingsql')" href="../../_variables/trackingsql.html">$trackingsql</a> = &quot;AND ((f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>.&quot;  OR f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_FORCED')" href="../../_constants/FORUM_TRACKING_FORCED.html" onMouseOver="constPopup(event,'FORUM_TRACKING_FORCED')">FORUM_TRACKING_FORCED</a>.&quot;)
<a name="l6117"><span class="linenum">6117</span></a>                              AND tf.id IS NULL)&quot;;
<a name="l6118"><span class="linenum">6118</span></a>      }
<a name="l6119"><span class="linenum">6119</span></a>  
<a name="l6120"><span class="linenum">6120</span></a>  <span class="comment">    // First insert any new entries.</span>
<a name="l6121"><span class="linenum">6121</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;INSERT INTO {forum_read} (userid, postid, discussionid, forumid, firstread, lastread)
<a name="l6122"><span class="linenum">6122</span></a>  
<a name="l6123"><span class="linenum">6123</span></a>              SELECT :userid1, p.id, p.discussion, d.forum, :firstread, :lastread
<a name="l6124"><span class="linenum">6124</span></a>                  FROM {forum_posts} p
<a name="l6125"><span class="linenum">6125</span></a>                      JOIN {forum_discussions} d       ON d.id = p.discussion
<a name="l6126"><span class="linenum">6126</span></a>                      JOIN {forum} f                   ON f.id = d.forum
<a name="l6127"><span class="linenum">6127</span></a>                      LEFT JOIN {forum_track_prefs} tf <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (tf.userid = :userid2 AND tf.forumid = f.id)
<a name="l6128"><span class="linenum">6128</span></a>                      LEFT JOIN {forum_read} fr        <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (
<a name="l6129"><span class="linenum">6129</span></a>                              fr.userid = :userid3
<a name="l6130"><span class="linenum">6130</span></a>                          AND fr.postid = p.id
<a name="l6131"><span class="linenum">6131</span></a>                          AND fr.discussionid = d.id
<a name="l6132"><span class="linenum">6132</span></a>                          AND fr.forumid = f.id
<a name="l6133"><span class="linenum">6133</span></a>                      )
<a name="l6134"><span class="linenum">6134</span></a>                  WHERE p.id <a class="var it2642" onMouseOver="hilite(2642)" onMouseOut="lolite()" onClick="logVariable('usql')" href="../../_variables/usql.html">$usql</a>
<a name="l6135"><span class="linenum">6135</span></a>                      AND p.modified &gt;= :cutoffdate
<a name="l6136"><span class="linenum">6136</span></a>                      <a class="var it41628" onMouseOver="hilite(41628)" onMouseOut="lolite()" onClick="logVariable('trackingsql')" href="../../_variables/trackingsql.html">$trackingsql</a>
<a name="l6137"><span class="linenum">6137</span></a>                      AND fr.id IS NULL&quot;;
<a name="l6138"><span class="linenum">6138</span></a>  
<a name="l6139"><span class="linenum">6139</span></a>      <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) &amp;&amp; <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>;
<a name="l6140"><span class="linenum">6140</span></a>  
<a name="l6141"><span class="linenum">6141</span></a>  <span class="comment">    // Then update all records.</span>
<a name="l6142"><span class="linenum">6142</span></a>      <a class="var it41629" onMouseOver="hilite(41629)" onMouseOut="lolite()" onClick="logVariable('updateparams')" href="../../_variables/updateparams.html">$updateparams</a> = array(
<a name="l6143"><span class="linenum">6143</span></a>          'userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l6144"><span class="linenum">6144</span></a>          'lastread' =&gt; <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>,
<a name="l6145"><span class="linenum">6145</span></a>      );
<a name="l6146"><span class="linenum">6146</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it41626" onMouseOver="hilite(41626)" onMouseOut="lolite()" onClick="logVariable('postidparams')" href="../../_variables/postidparams.html">$postidparams</a>, <a class="var it41629" onMouseOver="hilite(41629)" onMouseOut="lolite()" onClick="logVariable('updateparams')" href="../../_variables/updateparams.html">$updateparams</a>);
<a name="l6147"><span class="linenum">6147</span></a>      <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('forum_read', 'lastread', <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>, '
<a name="l6148"><span class="linenum">6148</span></a>                  userid      =  :userid
<a name="l6149"><span class="linenum">6149</span></a>              AND lastread    &lt;&gt; :lastread
<a name="l6150"><span class="linenum">6150</span></a>              AND postid      ' . <a class="var it2642" onMouseOver="hilite(2642)" onMouseOut="lolite()" onClick="logVariable('usql')" href="../../_variables/usql.html">$usql</a>,
<a name="l6151"><span class="linenum">6151</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) &amp;&amp; <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>;
<a name="l6152"><span class="linenum">6152</span></a>  
<a name="l6153"><span class="linenum">6153</span></a>      return <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>;
<a name="l6154"><span class="linenum">6154</span></a>  }
<a name="l6155"><span class="linenum">6155</span></a>  
<a name="l6156"><span class="linenum">6156</span></a>  <span class="comment">/**</span>
<a name="l6157"><span class="linenum">6157</span></a>  <span class="comment"> * Mark post as read.</span>
<a name="l6158"><span class="linenum">6158</span></a>  <span class="comment"> * @global object</span>
<a name="l6159"><span class="linenum">6159</span></a>  <span class="comment"> * @global object</span>
<a name="l6160"><span class="linenum">6160</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l6161"><span class="linenum">6161</span></a>  <span class="comment"> * @param int $postid</span>
<a name="l6162"><span class="linenum">6162</span></a>  <span class="comment"> */</span>
<a name="l6163"><span class="linenum">6163</span></a>  function <a class="function" onClick="logFunction('forum_tp_add_read_record')" href="../../_functions/forum_tp_add_read_record.html" onMouseOver="funcPopup(event,'forum_tp_add_read_record')">forum_tp_add_read_record</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>) {
<a name="l6164"><span class="linenum">6164</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6165"><span class="linenum">6165</span></a>  
<a name="l6166"><span class="linenum">6166</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l6167"><span class="linenum">6167</span></a>      <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a> * 24 * 3600);
<a name="l6168"><span class="linenum">6168</span></a>  
<a name="l6169"><span class="linenum">6169</span></a>      if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('forum_read', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'postid' =&gt; <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>))) {
<a name="l6170"><span class="linenum">6170</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;INSERT INTO {forum_read} (userid, postid, discussionid, forumid, firstread, lastread)
<a name="l6171"><span class="linenum">6171</span></a>  
<a name="l6172"><span class="linenum">6172</span></a>                  SELECT ?, p.id, p.discussion, d.forum, ?, ?
<a name="l6173"><span class="linenum">6173</span></a>                    FROM {forum_posts} p
<a name="l6174"><span class="linenum">6174</span></a>                         JOIN {forum_discussions} d ON d.id = p.discussion
<a name="l6175"><span class="linenum">6175</span></a>                   WHERE p.id = ? AND p.modified &gt;= ?&quot;;
<a name="l6176"><span class="linenum">6176</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>, <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>, <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a>));
<a name="l6177"><span class="linenum">6177</span></a>  
<a name="l6178"><span class="linenum">6178</span></a>      } else {
<a name="l6179"><span class="linenum">6179</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {forum_read}
<a name="l6180"><span class="linenum">6180</span></a>                     SET lastread = ?
<a name="l6181"><span class="linenum">6181</span></a>                   WHERE userid = ? AND postid = ?&quot;;
<a name="l6182"><span class="linenum">6182</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>));
<a name="l6183"><span class="linenum">6183</span></a>      }
<a name="l6184"><span class="linenum">6184</span></a>  }
<a name="l6185"><span class="linenum">6185</span></a>  
<a name="l6186"><span class="linenum">6186</span></a>  <span class="comment">/**</span>
<a name="l6187"><span class="linenum">6187</span></a>  <span class="comment"> * If its an old post, do nothing. If the record exists, the maintenance will clear it up later.</span>
<a name="l6188"><span class="linenum">6188</span></a>  <span class="comment"> *</span>
<a name="l6189"><span class="linenum">6189</span></a>  <span class="comment"> * @return bool</span>
<a name="l6190"><span class="linenum">6190</span></a>  <span class="comment"> */</span>
<a name="l6191"><span class="linenum">6191</span></a>  function <a class="function" onClick="logFunction('forum_tp_mark_post_read')" href="../../_functions/forum_tp_mark_post_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_post_read')">forum_tp_mark_post_read</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>) {
<a name="l6192"><span class="linenum">6192</span></a>      if (!<a class="function" onClick="logFunction('forum_tp_is_post_old')" href="../../_functions/forum_tp_is_post_old.html" onMouseOver="funcPopup(event,'forum_tp_is_post_old')">forum_tp_is_post_old</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>)) {
<a name="l6193"><span class="linenum">6193</span></a>          return <a class="function" onClick="logFunction('forum_tp_add_read_record')" href="../../_functions/forum_tp_add_read_record.html" onMouseOver="funcPopup(event,'forum_tp_add_read_record')">forum_tp_add_read_record</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l6194"><span class="linenum">6194</span></a>      } else {
<a name="l6195"><span class="linenum">6195</span></a>          return true;
<a name="l6196"><span class="linenum">6196</span></a>      }
<a name="l6197"><span class="linenum">6197</span></a>  }
<a name="l6198"><span class="linenum">6198</span></a>  
<a name="l6199"><span class="linenum">6199</span></a>  <span class="comment">/**</span>
<a name="l6200"><span class="linenum">6200</span></a>  <span class="comment"> * Marks a whole forum as read, for a given user</span>
<a name="l6201"><span class="linenum">6201</span></a>  <span class="comment"> *</span>
<a name="l6202"><span class="linenum">6202</span></a>  <span class="comment"> * @global object</span>
<a name="l6203"><span class="linenum">6203</span></a>  <span class="comment"> * @global object</span>
<a name="l6204"><span class="linenum">6204</span></a>  <span class="comment"> * @param object $user</span>
<a name="l6205"><span class="linenum">6205</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l6206"><span class="linenum">6206</span></a>  <span class="comment"> * @param int|bool $groupid</span>
<a name="l6207"><span class="linenum">6207</span></a>  <span class="comment"> * @return bool</span>
<a name="l6208"><span class="linenum">6208</span></a>  <span class="comment"> */</span>
<a name="l6209"><span class="linenum">6209</span></a>  function <a class="function" onClick="logFunction('forum_tp_mark_forum_read')" href="../../_functions/forum_tp_mark_forum_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_forum_read')">forum_tp_mark_forum_read</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>=false) {
<a name="l6210"><span class="linenum">6210</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6211"><span class="linenum">6211</span></a>  
<a name="l6212"><span class="linenum">6212</span></a>      <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a>*24*60*60);
<a name="l6213"><span class="linenum">6213</span></a>  
<a name="l6214"><span class="linenum">6214</span></a>      <a class="var it41630" onMouseOver="hilite(41630)" onMouseOut="lolite()" onClick="logVariable('groupsel')" href="../../_variables/groupsel.html">$groupsel</a> = &quot;&quot;;
<a name="l6215"><span class="linenum">6215</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a>);
<a name="l6216"><span class="linenum">6216</span></a>  
<a name="l6217"><span class="linenum">6217</span></a>      if (<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> !== false) {
<a name="l6218"><span class="linenum">6218</span></a>          <a class="var it41630" onMouseOver="hilite(41630)" onMouseOut="lolite()" onClick="logVariable('groupsel')" href="../../_variables/groupsel.html">$groupsel</a> = &quot; AND (d.groupid = ? OR d.groupid = -1)&quot;;
<a name="l6219"><span class="linenum">6219</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l6220"><span class="linenum">6220</span></a>      }
<a name="l6221"><span class="linenum">6221</span></a>  
<a name="l6222"><span class="linenum">6222</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT p.id
<a name="l6223"><span class="linenum">6223</span></a>                FROM {forum_posts} p
<a name="l6224"><span class="linenum">6224</span></a>                     LEFT JOIN {forum_discussions} d ON d.id = p.discussion
<a name="l6225"><span class="linenum">6225</span></a>                     LEFT JOIN {forum_read} r        <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (r.postid = p.id AND r.userid = ?)
<a name="l6226"><span class="linenum">6226</span></a>               WHERE d.forum = ?
<a name="l6227"><span class="linenum">6227</span></a>                     AND p.modified &gt;= ? AND r.id is NULL
<a name="l6228"><span class="linenum">6228</span></a>                     <a class="var it41630" onMouseOver="hilite(41630)" onMouseOut="lolite()" onClick="logVariable('groupsel')" href="../../_variables/groupsel.html">$groupsel</a>&quot;;
<a name="l6229"><span class="linenum">6229</span></a>  
<a name="l6230"><span class="linenum">6230</span></a>      if (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l6231"><span class="linenum">6231</span></a>          <a class="var it41625" onMouseOver="hilite(41625)" onMouseOut="lolite()" onClick="logVariable('postids')" href="../../_variables/postids.html">$postids</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>);
<a name="l6232"><span class="linenum">6232</span></a>          return <a class="function" onClick="logFunction('forum_tp_mark_posts_read')" href="../../_functions/forum_tp_mark_posts_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_posts_read')">forum_tp_mark_posts_read</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it41625" onMouseOver="hilite(41625)" onMouseOut="lolite()" onClick="logVariable('postids')" href="../../_variables/postids.html">$postids</a>);
<a name="l6233"><span class="linenum">6233</span></a>      }
<a name="l6234"><span class="linenum">6234</span></a>  
<a name="l6235"><span class="linenum">6235</span></a>      return true;
<a name="l6236"><span class="linenum">6236</span></a>  }
<a name="l6237"><span class="linenum">6237</span></a>  
<a name="l6238"><span class="linenum">6238</span></a>  <span class="comment">/**</span>
<a name="l6239"><span class="linenum">6239</span></a>  <span class="comment"> * Marks a whole discussion as read, for a given user</span>
<a name="l6240"><span class="linenum">6240</span></a>  <span class="comment"> *</span>
<a name="l6241"><span class="linenum">6241</span></a>  <span class="comment"> * @global object</span>
<a name="l6242"><span class="linenum">6242</span></a>  <span class="comment"> * @global object</span>
<a name="l6243"><span class="linenum">6243</span></a>  <span class="comment"> * @param object $user</span>
<a name="l6244"><span class="linenum">6244</span></a>  <span class="comment"> * @param int $discussionid</span>
<a name="l6245"><span class="linenum">6245</span></a>  <span class="comment"> * @return bool</span>
<a name="l6246"><span class="linenum">6246</span></a>  <span class="comment"> */</span>
<a name="l6247"><span class="linenum">6247</span></a>  function <a class="function" onClick="logFunction('forum_tp_mark_discussion_read')" href="../../_functions/forum_tp_mark_discussion_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_discussion_read')">forum_tp_mark_discussion_read</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>) {
<a name="l6248"><span class="linenum">6248</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6249"><span class="linenum">6249</span></a>  
<a name="l6250"><span class="linenum">6250</span></a>      <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a>*24*60*60);
<a name="l6251"><span class="linenum">6251</span></a>  
<a name="l6252"><span class="linenum">6252</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT p.id
<a name="l6253"><span class="linenum">6253</span></a>                FROM {forum_posts} p
<a name="l6254"><span class="linenum">6254</span></a>                     LEFT JOIN {forum_read} r <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (r.postid = p.id AND r.userid = ?)
<a name="l6255"><span class="linenum">6255</span></a>               WHERE p.discussion = ?
<a name="l6256"><span class="linenum">6256</span></a>                     AND p.modified &gt;= ? AND r.id is NULL&quot;;
<a name="l6257"><span class="linenum">6257</span></a>  
<a name="l6258"><span class="linenum">6258</span></a>      if (<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>, <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a>))) {
<a name="l6259"><span class="linenum">6259</span></a>          <a class="var it41625" onMouseOver="hilite(41625)" onMouseOut="lolite()" onClick="logVariable('postids')" href="../../_variables/postids.html">$postids</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it4236" onMouseOver="hilite(4236)" onMouseOut="lolite()" onClick="logVariable('posts')" href="../../_variables/posts.html">$posts</a>);
<a name="l6260"><span class="linenum">6260</span></a>          return <a class="function" onClick="logFunction('forum_tp_mark_posts_read')" href="../../_functions/forum_tp_mark_posts_read.html" onMouseOver="funcPopup(event,'forum_tp_mark_posts_read')">forum_tp_mark_posts_read</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it41625" onMouseOver="hilite(41625)" onMouseOut="lolite()" onClick="logVariable('postids')" href="../../_variables/postids.html">$postids</a>);
<a name="l6261"><span class="linenum">6261</span></a>      }
<a name="l6262"><span class="linenum">6262</span></a>  
<a name="l6263"><span class="linenum">6263</span></a>      return true;
<a name="l6264"><span class="linenum">6264</span></a>  }
<a name="l6265"><span class="linenum">6265</span></a>  
<a name="l6266"><span class="linenum">6266</span></a>  <span class="comment">/**</span>
<a name="l6267"><span class="linenum">6267</span></a>  <span class="comment"> * @global object</span>
<a name="l6268"><span class="linenum">6268</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l6269"><span class="linenum">6269</span></a>  <span class="comment"> * @param object $post</span>
<a name="l6270"><span class="linenum">6270</span></a>  <span class="comment"> */</span>
<a name="l6271"><span class="linenum">6271</span></a>  function <a class="function" onClick="logFunction('forum_tp_is_post_read')" href="../../_functions/forum_tp_is_post_read.html" onMouseOver="funcPopup(event,'forum_tp_is_post_read')">forum_tp_is_post_read</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l6272"><span class="linenum">6272</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6273"><span class="linenum">6273</span></a>      return (<a class="function" onClick="logFunction('forum_tp_is_post_old')" href="../../_functions/forum_tp_is_post_old.html" onMouseOver="funcPopup(event,'forum_tp_is_post_old')">forum_tp_is_post_old</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) ||
<a name="l6274"><span class="linenum">6274</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('forum_read', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'postid' =&gt; <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('id')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)));
<a name="l6275"><span class="linenum">6275</span></a>  }
<a name="l6276"><span class="linenum">6276</span></a>  
<a name="l6277"><span class="linenum">6277</span></a>  <span class="comment">/**</span>
<a name="l6278"><span class="linenum">6278</span></a>  <span class="comment"> * @global object</span>
<a name="l6279"><span class="linenum">6279</span></a>  <span class="comment"> * @param object $post</span>
<a name="l6280"><span class="linenum">6280</span></a>  <span class="comment"> * @param int $time Defautls to time()</span>
<a name="l6281"><span class="linenum">6281</span></a>  <span class="comment"> */</span>
<a name="l6282"><span class="linenum">6282</span></a>  function <a class="function" onClick="logFunction('forum_tp_is_post_old')" href="../../_functions/forum_tp_is_post_old.html" onMouseOver="funcPopup(event,'forum_tp_is_post_old')">forum_tp_is_post_old</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>=null) {
<a name="l6283"><span class="linenum">6283</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l6284"><span class="linenum">6284</span></a>  
<a name="l6285"><span class="linenum">6285</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>)) {
<a name="l6286"><span class="linenum">6286</span></a>          <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l6287"><span class="linenum">6287</span></a>      }
<a name="l6288"><span class="linenum">6288</span></a>      return (<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('modified')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a> &lt; (<a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a> - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a> * 24 * 3600)));
<a name="l6289"><span class="linenum">6289</span></a>  }
<a name="l6290"><span class="linenum">6290</span></a>  
<a name="l6291"><span class="linenum">6291</span></a>  <span class="comment">/**</span>
<a name="l6292"><span class="linenum">6292</span></a>  <span class="comment"> * Returns the count of records for the provided user and course.</span>
<a name="l6293"><span class="linenum">6293</span></a>  <span class="comment"> * Please note that group access is ignored!</span>
<a name="l6294"><span class="linenum">6294</span></a>  <span class="comment"> *</span>
<a name="l6295"><span class="linenum">6295</span></a>  <span class="comment"> * @global object</span>
<a name="l6296"><span class="linenum">6296</span></a>  <span class="comment"> * @global object</span>
<a name="l6297"><span class="linenum">6297</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l6298"><span class="linenum">6298</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l6299"><span class="linenum">6299</span></a>  <span class="comment"> * @return array</span>
<a name="l6300"><span class="linenum">6300</span></a>  <span class="comment"> */</span>
<a name="l6301"><span class="linenum">6301</span></a>  function <a class="function" onClick="logFunction('forum_tp_get_course_unread_posts')" href="../../_functions/forum_tp_get_course_unread_posts.html" onMouseOver="funcPopup(event,'forum_tp_get_course_unread_posts')">forum_tp_get_course_unread_posts</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l6302"><span class="linenum">6302</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6303"><span class="linenum">6303</span></a>  
<a name="l6304"><span class="linenum">6304</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2); <span class="comment">// DB cache friendliness.</span>
<a name="l6305"><span class="linenum">6305</span></a>      <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a> * 24 * 60 * 60);
<a name="l6306"><span class="linenum">6306</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l6307"><span class="linenum">6307</span></a>  
<a name="l6308"><span class="linenum">6308</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l6309"><span class="linenum">6309</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;AND d.timestart &lt; ? AND (d.timeend = 0 OR d.timeend &gt; ?)&quot;;
<a name="l6310"><span class="linenum">6310</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l6311"><span class="linenum">6311</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l6312"><span class="linenum">6312</span></a>      } else {
<a name="l6313"><span class="linenum">6313</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;&quot;;
<a name="l6314"><span class="linenum">6314</span></a>      }
<a name="l6315"><span class="linenum">6315</span></a>  
<a name="l6316"><span class="linenum">6316</span></a>      if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_allowforcedreadtracking')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_allowforcedreadtracking.html">forum_allowforcedreadtracking</a>) {
<a name="l6317"><span class="linenum">6317</span></a>          <a class="var it41628" onMouseOver="hilite(41628)" onMouseOut="lolite()" onClick="logVariable('trackingsql')" href="../../_variables/trackingsql.html">$trackingsql</a> = &quot;AND (f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_FORCED')" href="../../_constants/FORUM_TRACKING_FORCED.html" onMouseOver="constPopup(event,'FORUM_TRACKING_FORCED')">FORUM_TRACKING_FORCED</a>.&quot;
<a name="l6318"><span class="linenum">6318</span></a>                              <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>.&quot; AND tf.id IS NULL
<a name="l6319"><span class="linenum">6319</span></a>                                  AND (SELECT trackforums FROM {user} WHERE id = ?) = 1))&quot;;
<a name="l6320"><span class="linenum">6320</span></a>      } else {
<a name="l6321"><span class="linenum">6321</span></a>          <a class="var it41628" onMouseOver="hilite(41628)" onMouseOut="lolite()" onClick="logVariable('trackingsql')" href="../../_variables/trackingsql.html">$trackingsql</a> = &quot;AND ((f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>.&quot; OR f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_FORCED')" href="../../_constants/FORUM_TRACKING_FORCED.html" onMouseOver="constPopup(event,'FORUM_TRACKING_FORCED')">FORUM_TRACKING_FORCED</a>.&quot;)
<a name="l6322"><span class="linenum">6322</span></a>                              AND tf.id IS NULL
<a name="l6323"><span class="linenum">6323</span></a>                              AND (SELECT trackforums FROM {user} WHERE id = ?) = 1)&quot;;
<a name="l6324"><span class="linenum">6324</span></a>      }
<a name="l6325"><span class="linenum">6325</span></a>  
<a name="l6326"><span class="linenum">6326</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT f.id, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(p.id) AS unread
<a name="l6327"><span class="linenum">6327</span></a>                FROM {forum_posts} p
<a name="l6328"><span class="linenum">6328</span></a>                     JOIN {forum_discussions} d       ON d.id = p.discussion
<a name="l6329"><span class="linenum">6329</span></a>                     JOIN {forum} f                   ON f.id = d.forum
<a name="l6330"><span class="linenum">6330</span></a>                     JOIN {course} c                  ON c.id = f.course
<a name="l6331"><span class="linenum">6331</span></a>                     LEFT JOIN {forum_read} r         <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (r.postid = p.id AND r.userid = ?)
<a name="l6332"><span class="linenum">6332</span></a>                     LEFT JOIN {forum_track_prefs} tf <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (tf.userid = ? AND tf.forumid = f.id)
<a name="l6333"><span class="linenum">6333</span></a>               WHERE f.course = ?
<a name="l6334"><span class="linenum">6334</span></a>                     AND p.modified &gt;= ? AND r.id is NULL
<a name="l6335"><span class="linenum">6335</span></a>                     <a class="var it41628" onMouseOver="hilite(41628)" onMouseOut="lolite()" onClick="logVariable('trackingsql')" href="../../_variables/trackingsql.html">$trackingsql</a>
<a name="l6336"><span class="linenum">6336</span></a>                     <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a>
<a name="l6337"><span class="linenum">6337</span></a>            GROUP BY f.id&quot;;
<a name="l6338"><span class="linenum">6338</span></a>  
<a name="l6339"><span class="linenum">6339</span></a>      if (<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l6340"><span class="linenum">6340</span></a>          return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l6341"><span class="linenum">6341</span></a>      }
<a name="l6342"><span class="linenum">6342</span></a>  
<a name="l6343"><span class="linenum">6343</span></a>      return array();
<a name="l6344"><span class="linenum">6344</span></a>  }
<a name="l6345"><span class="linenum">6345</span></a>  
<a name="l6346"><span class="linenum">6346</span></a>  <span class="comment">/**</span>
<a name="l6347"><span class="linenum">6347</span></a>  <span class="comment"> * Returns the count of records for the provided user and forum and [optionally] group.</span>
<a name="l6348"><span class="linenum">6348</span></a>  <span class="comment"> *</span>
<a name="l6349"><span class="linenum">6349</span></a>  <span class="comment"> * @global object</span>
<a name="l6350"><span class="linenum">6350</span></a>  <span class="comment"> * @global object</span>
<a name="l6351"><span class="linenum">6351</span></a>  <span class="comment"> * @global object</span>
<a name="l6352"><span class="linenum">6352</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l6353"><span class="linenum">6353</span></a>  <span class="comment"> * @param object $course</span>
<a name="l6354"><span class="linenum">6354</span></a>  <span class="comment"> * @return int</span>
<a name="l6355"><span class="linenum">6355</span></a>  <span class="comment"> */</span>
<a name="l6356"><span class="linenum">6356</span></a>  function <a class="function" onClick="logFunction('forum_tp_count_forum_unread_posts')" href="../../_functions/forum_tp_count_forum_unread_posts.html" onMouseOver="funcPopup(event,'forum_tp_count_forum_unread_posts')">forum_tp_count_forum_unread_posts</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l6357"><span class="linenum">6357</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6358"><span class="linenum">6358</span></a>  
<a name="l6359"><span class="linenum">6359</span></a>      static <a class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" onClick="logVariable('readcache')" href="../../_variables/readcache.html">$readcache</a> = array();
<a name="l6360"><span class="linenum">6360</span></a>  
<a name="l6361"><span class="linenum">6361</span></a>      <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a> = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>;
<a name="l6362"><span class="linenum">6362</span></a>  
<a name="l6363"><span class="linenum">6363</span></a>      if (!isset(<a class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" onClick="logVariable('readcache')" href="../../_variables/readcache.html">$readcache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l6364"><span class="linenum">6364</span></a>          <a class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" onClick="logVariable('readcache')" href="../../_variables/readcache.html">$readcache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = array();
<a name="l6365"><span class="linenum">6365</span></a>          if (<a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('counts')" href="../../_variables/counts.html">$counts</a> = <a class="function" onClick="logFunction('forum_tp_get_course_unread_posts')" href="../../_functions/forum_tp_get_course_unread_posts.html" onMouseOver="funcPopup(event,'forum_tp_get_course_unread_posts')">forum_tp_get_course_unread_posts</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l6366"><span class="linenum">6366</span></a>              foreach (<a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('counts')" href="../../_variables/counts.html">$counts</a> as <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>) {
<a name="l6367"><span class="linenum">6367</span></a>                  <a class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" onClick="logVariable('readcache')" href="../../_variables/readcache.html">$readcache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>][<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>-&gt;<a onClick="logVariable('id')" class="var it43239" onMouseOver="hilite(43239)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>-&gt;<a onClick="logVariable('unread')" class="var it43239" onMouseOver="hilite(43239)" onMouseOut="lolite()" href="../../_variables/unread.html">unread</a>;
<a name="l6368"><span class="linenum">6368</span></a>              }
<a name="l6369"><span class="linenum">6369</span></a>          }
<a name="l6370"><span class="linenum">6370</span></a>      }
<a name="l6371"><span class="linenum">6371</span></a>  
<a name="l6372"><span class="linenum">6372</span></a>      if (empty(<a class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" onClick="logVariable('readcache')" href="../../_variables/readcache.html">$readcache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>])) {
<a name="l6373"><span class="linenum">6373</span></a>  <span class="comment">        // no need to check group mode ;-)</span>
<a name="l6374"><span class="linenum">6374</span></a>          return 0;
<a name="l6375"><span class="linenum">6375</span></a>      }
<a name="l6376"><span class="linenum">6376</span></a>  
<a name="l6377"><span class="linenum">6377</span></a>      <a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> = <a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l6378"><span class="linenum">6378</span></a>  
<a name="l6379"><span class="linenum">6379</span></a>      if (<a class="var it688" onMouseOver="hilite(688)" onMouseOut="lolite()" onClick="logVariable('groupmode')" href="../../_variables/groupmode.html">$groupmode</a> != <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>) {
<a name="l6380"><span class="linenum">6380</span></a>          return <a class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" onClick="logVariable('readcache')" href="../../_variables/readcache.html">$readcache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>];
<a name="l6381"><span class="linenum">6381</span></a>      }
<a name="l6382"><span class="linenum">6382</span></a>  
<a name="l6383"><span class="linenum">6383</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l6384"><span class="linenum">6384</span></a>          return <a class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" onClick="logVariable('readcache')" href="../../_variables/readcache.html">$readcache</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>];
<a name="l6385"><span class="linenum">6385</span></a>      }
<a name="l6386"><span class="linenum">6386</span></a>  
<a name="l6387"><span class="linenum">6387</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../course/lib.php.html">/course/lib.php</a>');
<a name="l6388"><span class="linenum">6388</span></a>  
<a name="l6389"><span class="linenum">6389</span></a>      <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l6390"><span class="linenum">6390</span></a>  
<a name="l6391"><span class="linenum">6391</span></a>      <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_groups')" href="../../_functions/get_groups.html" onMouseOver="funcPopup(event,'get_groups')">get_groups</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>);
<a name="l6392"><span class="linenum">6392</span></a>  
<a name="l6393"><span class="linenum">6393</span></a>  <span class="comment">    // add all groups posts</span>
<a name="l6394"><span class="linenum">6394</span></a>      <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a>[-1] = -1;
<a name="l6395"><span class="linenum">6395</span></a>  
<a name="l6396"><span class="linenum">6396</span></a>      <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a> (<a class="var it41632" onMouseOver="hilite(41632)" onMouseOut="lolite()" onClick="logVariable('groups_sql')" href="../../_variables/groups_sql.html">$groups_sql</a>, <a class="var it41633" onMouseOver="hilite(41633)" onMouseOut="lolite()" onClick="logVariable('groups_params')" href="../../_variables/groups_params.html">$groups_params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a>);
<a name="l6397"><span class="linenum">6397</span></a>  
<a name="l6398"><span class="linenum">6398</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2); <span class="comment">// db cache friendliness</span>
<a name="l6399"><span class="linenum">6399</span></a>      <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a>*24*60*60);
<a name="l6400"><span class="linenum">6400</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a>);
<a name="l6401"><span class="linenum">6401</span></a>  
<a name="l6402"><span class="linenum">6402</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>)) {
<a name="l6403"><span class="linenum">6403</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;AND d.timestart &lt; ? AND (d.timeend = 0 OR d.timeend &gt; ?)&quot;;
<a name="l6404"><span class="linenum">6404</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l6405"><span class="linenum">6405</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l6406"><span class="linenum">6406</span></a>      } else {
<a name="l6407"><span class="linenum">6407</span></a>          <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a> = &quot;&quot;;
<a name="l6408"><span class="linenum">6408</span></a>      }
<a name="l6409"><span class="linenum">6409</span></a>  
<a name="l6410"><span class="linenum">6410</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it41633" onMouseOver="hilite(41633)" onMouseOut="lolite()" onClick="logVariable('groups_params')" href="../../_variables/groups_params.html">$groups_params</a>);
<a name="l6411"><span class="linenum">6411</span></a>  
<a name="l6412"><span class="linenum">6412</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(p.id)
<a name="l6413"><span class="linenum">6413</span></a>                FROM {forum_posts} p
<a name="l6414"><span class="linenum">6414</span></a>                     JOIN {forum_discussions} d ON p.discussion = d.id
<a name="l6415"><span class="linenum">6415</span></a>                     LEFT JOIN {forum_read} r   <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (r.postid = p.id AND r.userid = ?)
<a name="l6416"><span class="linenum">6416</span></a>               WHERE d.forum = ?
<a name="l6417"><span class="linenum">6417</span></a>                     AND p.modified &gt;= ? AND r.id is NULL
<a name="l6418"><span class="linenum">6418</span></a>                     <a class="var it41552" onMouseOver="hilite(41552)" onMouseOut="lolite()" onClick="logVariable('timedsql')" href="../../_variables/timedsql.html">$timedsql</a>
<a name="l6419"><span class="linenum">6419</span></a>                     AND d.groupid <a class="var it41632" onMouseOver="hilite(41632)" onMouseOut="lolite()" onClick="logVariable('groups_sql')" href="../../_variables/groups_sql.html">$groups_sql</a>&quot;;
<a name="l6420"><span class="linenum">6420</span></a>  
<a name="l6421"><span class="linenum">6421</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l6422"><span class="linenum">6422</span></a>  }
<a name="l6423"><span class="linenum">6423</span></a>  
<a name="l6424"><span class="linenum">6424</span></a>  <span class="comment">/**</span>
<a name="l6425"><span class="linenum">6425</span></a>  <span class="comment"> * Deletes read records for the specified index. At least one parameter must be specified.</span>
<a name="l6426"><span class="linenum">6426</span></a>  <span class="comment"> *</span>
<a name="l6427"><span class="linenum">6427</span></a>  <span class="comment"> * @global object</span>
<a name="l6428"><span class="linenum">6428</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l6429"><span class="linenum">6429</span></a>  <span class="comment"> * @param int $postid</span>
<a name="l6430"><span class="linenum">6430</span></a>  <span class="comment"> * @param int $discussionid</span>
<a name="l6431"><span class="linenum">6431</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l6432"><span class="linenum">6432</span></a>  <span class="comment"> * @return bool</span>
<a name="l6433"><span class="linenum">6433</span></a>  <span class="comment"> */</span>
<a name="l6434"><span class="linenum">6434</span></a>  function <a class="function" onClick="logFunction('forum_tp_delete_read_records')" href="../../_functions/forum_tp_delete_read_records.html" onMouseOver="funcPopup(event,'forum_tp_delete_read_records')">forum_tp_delete_read_records</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=-1, <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>=-1, <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>=-1, <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>=-1) {
<a name="l6435"><span class="linenum">6435</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6436"><span class="linenum">6436</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l6437"><span class="linenum">6437</span></a>  
<a name="l6438"><span class="linenum">6438</span></a>      <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = '';
<a name="l6439"><span class="linenum">6439</span></a>      if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> &gt; -1) {
<a name="l6440"><span class="linenum">6440</span></a>          if (<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> != '') <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= ' AND ';
<a name="l6441"><span class="linenum">6441</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= 'userid = ?';
<a name="l6442"><span class="linenum">6442</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l6443"><span class="linenum">6443</span></a>      }
<a name="l6444"><span class="linenum">6444</span></a>      if (<a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a> &gt; -1) {
<a name="l6445"><span class="linenum">6445</span></a>          if (<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> != '') <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= ' AND ';
<a name="l6446"><span class="linenum">6446</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= 'postid = ?';
<a name="l6447"><span class="linenum">6447</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it23839" onMouseOver="hilite(23839)" onMouseOut="lolite()" onClick="logVariable('postid')" href="../../_variables/postid.html">$postid</a>;
<a name="l6448"><span class="linenum">6448</span></a>      }
<a name="l6449"><span class="linenum">6449</span></a>      if (<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a> &gt; -1) {
<a name="l6450"><span class="linenum">6450</span></a>          if (<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> != '') <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= ' AND ';
<a name="l6451"><span class="linenum">6451</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= 'discussionid = ?';
<a name="l6452"><span class="linenum">6452</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>;
<a name="l6453"><span class="linenum">6453</span></a>      }
<a name="l6454"><span class="linenum">6454</span></a>      if (<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a> &gt; -1) {
<a name="l6455"><span class="linenum">6455</span></a>          if (<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> != '') <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= ' AND ';
<a name="l6456"><span class="linenum">6456</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= 'forumid = ?';
<a name="l6457"><span class="linenum">6457</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>;
<a name="l6458"><span class="linenum">6458</span></a>      }
<a name="l6459"><span class="linenum">6459</span></a>      if (<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> == '') {
<a name="l6460"><span class="linenum">6460</span></a>          return false;
<a name="l6461"><span class="linenum">6461</span></a>      }
<a name="l6462"><span class="linenum">6462</span></a>      else {
<a name="l6463"><span class="linenum">6463</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_read', <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l6464"><span class="linenum">6464</span></a>      }
<a name="l6465"><span class="linenum">6465</span></a>  }
<a name="l6466"><span class="linenum">6466</span></a>  <span class="comment">/**</span>
<a name="l6467"><span class="linenum">6467</span></a>  <span class="comment"> * Get a list of forums not tracked by the user.</span>
<a name="l6468"><span class="linenum">6468</span></a>  <span class="comment"> *</span>
<a name="l6469"><span class="linenum">6469</span></a>  <span class="comment"> * @global object</span>
<a name="l6470"><span class="linenum">6470</span></a>  <span class="comment"> * @global object</span>
<a name="l6471"><span class="linenum">6471</span></a>  <span class="comment"> * @param int $userid The id of the user to use.</span>
<a name="l6472"><span class="linenum">6472</span></a>  <span class="comment"> * @param int $courseid The id of the course being checked.</span>
<a name="l6473"><span class="linenum">6473</span></a>  <span class="comment"> * @return mixed An array indexed by forum id, or false.</span>
<a name="l6474"><span class="linenum">6474</span></a>  <span class="comment"> */</span>
<a name="l6475"><span class="linenum">6475</span></a>  function <a class="function" onClick="logFunction('forum_tp_get_untracked_forums')" href="../../_functions/forum_tp_get_untracked_forums.html" onMouseOver="funcPopup(event,'forum_tp_get_untracked_forums')">forum_tp_get_untracked_forums</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l6476"><span class="linenum">6476</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6477"><span class="linenum">6477</span></a>  
<a name="l6478"><span class="linenum">6478</span></a>      if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_allowforcedreadtracking')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_allowforcedreadtracking.html">forum_allowforcedreadtracking</a>) {
<a name="l6479"><span class="linenum">6479</span></a>          <a class="var it41628" onMouseOver="hilite(41628)" onMouseOut="lolite()" onClick="logVariable('trackingsql')" href="../../_variables/trackingsql.html">$trackingsql</a> = &quot;AND (f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_OFF')" href="../../_constants/FORUM_TRACKING_OFF.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OFF')">FORUM_TRACKING_OFF</a>.&quot;
<a name="l6480"><span class="linenum">6480</span></a>                              <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>.&quot; AND (ft.id IS NOT NULL
<a name="l6481"><span class="linenum">6481</span></a>                                  <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (SELECT trackforums FROM {user} WHERE id = ?) = 0)))&quot;;
<a name="l6482"><span class="linenum">6482</span></a>      } else {
<a name="l6483"><span class="linenum">6483</span></a>          <a class="var it41628" onMouseOver="hilite(41628)" onMouseOut="lolite()" onClick="logVariable('trackingsql')" href="../../_variables/trackingsql.html">$trackingsql</a> = &quot;AND (f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_OFF')" href="../../_constants/FORUM_TRACKING_OFF.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OFF')">FORUM_TRACKING_OFF</a>.&quot;
<a name="l6484"><span class="linenum">6484</span></a>                              <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> ((f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>.&quot; OR f.trackingtype = &quot;.<a class="constant" onClick="logConstant('FORUM_TRACKING_FORCED')" href="../../_constants/FORUM_TRACKING_FORCED.html" onMouseOver="constPopup(event,'FORUM_TRACKING_FORCED')">FORUM_TRACKING_FORCED</a>.&quot;)
<a name="l6485"><span class="linenum">6485</span></a>                                  AND (ft.id IS NOT NULL
<a name="l6486"><span class="linenum">6486</span></a>                                      <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (SELECT trackforums FROM {user} WHERE id = ?) = 0)))&quot;;
<a name="l6487"><span class="linenum">6487</span></a>      }
<a name="l6488"><span class="linenum">6488</span></a>  
<a name="l6489"><span class="linenum">6489</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT f.id
<a name="l6490"><span class="linenum">6490</span></a>                FROM {forum} f
<a name="l6491"><span class="linenum">6491</span></a>                     LEFT JOIN {forum_track_prefs} ft <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ft.forumid = f.id AND ft.userid = ?)
<a name="l6492"><span class="linenum">6492</span></a>               WHERE f.course = ?
<a name="l6493"><span class="linenum">6493</span></a>                     <a class="var it41628" onMouseOver="hilite(41628)" onMouseOut="lolite()" onClick="logVariable('trackingsql')" href="../../_variables/trackingsql.html">$trackingsql</a>&quot;;
<a name="l6494"><span class="linenum">6494</span></a>  
<a name="l6495"><span class="linenum">6495</span></a>      if (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>))) {
<a name="l6496"><span class="linenum">6496</span></a>          foreach (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> as <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l6497"><span class="linenum">6497</span></a>              <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>;
<a name="l6498"><span class="linenum">6498</span></a>          }
<a name="l6499"><span class="linenum">6499</span></a>          return <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>;
<a name="l6500"><span class="linenum">6500</span></a>  
<a name="l6501"><span class="linenum">6501</span></a>      } else {
<a name="l6502"><span class="linenum">6502</span></a>          return array();
<a name="l6503"><span class="linenum">6503</span></a>      }
<a name="l6504"><span class="linenum">6504</span></a>  }
<a name="l6505"><span class="linenum">6505</span></a>  
<a name="l6506"><span class="linenum">6506</span></a>  <span class="comment">/**</span>
<a name="l6507"><span class="linenum">6507</span></a>  <span class="comment"> * Determine if a user can track forums and optionally a particular forum.</span>
<a name="l6508"><span class="linenum">6508</span></a>  <span class="comment"> * Checks the site settings, the user settings and the forum settings (if</span>
<a name="l6509"><span class="linenum">6509</span></a>  <span class="comment"> * requested).</span>
<a name="l6510"><span class="linenum">6510</span></a>  <span class="comment"> *</span>
<a name="l6511"><span class="linenum">6511</span></a>  <span class="comment"> * @global object</span>
<a name="l6512"><span class="linenum">6512</span></a>  <span class="comment"> * @global object</span>
<a name="l6513"><span class="linenum">6513</span></a>  <span class="comment"> * @global object</span>
<a name="l6514"><span class="linenum">6514</span></a>  <span class="comment"> * @param mixed $forum The forum object to test, or the int id (optional).</span>
<a name="l6515"><span class="linenum">6515</span></a>  <span class="comment"> * @param mixed $userid The user object to check for (optional).</span>
<a name="l6516"><span class="linenum">6516</span></a>  <span class="comment"> * @return boolean</span>
<a name="l6517"><span class="linenum">6517</span></a>  <span class="comment"> */</span>
<a name="l6518"><span class="linenum">6518</span></a>  function <a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>=false, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>=false) {
<a name="l6519"><span class="linenum">6519</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6520"><span class="linenum">6520</span></a>  
<a name="l6521"><span class="linenum">6521</span></a>  <span class="comment">    // if possible, avoid expensive</span>
<a name="l6522"><span class="linenum">6522</span></a>  <span class="comment">    // queries</span>
<a name="l6523"><span class="linenum">6523</span></a>      if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_trackreadposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_trackreadposts.html">forum_trackreadposts</a>)) {
<a name="l6524"><span class="linenum">6524</span></a>          return false;
<a name="l6525"><span class="linenum">6525</span></a>      }
<a name="l6526"><span class="linenum">6526</span></a>  
<a name="l6527"><span class="linenum">6527</span></a>      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> === false) {
<a name="l6528"><span class="linenum">6528</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l6529"><span class="linenum">6529</span></a>      }
<a name="l6530"><span class="linenum">6530</span></a>  
<a name="l6531"><span class="linenum">6531</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) or empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l6532"><span class="linenum">6532</span></a>          return false;
<a name="l6533"><span class="linenum">6533</span></a>      }
<a name="l6534"><span class="linenum">6534</span></a>  
<a name="l6535"><span class="linenum">6535</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> === false) {
<a name="l6536"><span class="linenum">6536</span></a>          if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_allowforcedreadtracking')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_allowforcedreadtracking.html">forum_allowforcedreadtracking</a>) {
<a name="l6537"><span class="linenum">6537</span></a>  <span class="comment">            // Since we can force tracking, assume yes without a specific forum.</span>
<a name="l6538"><span class="linenum">6538</span></a>              return true;
<a name="l6539"><span class="linenum">6539</span></a>          } else {
<a name="l6540"><span class="linenum">6540</span></a>              return (bool)<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('trackforums')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/trackforums.html">trackforums</a>;
<a name="l6541"><span class="linenum">6541</span></a>          }
<a name="l6542"><span class="linenum">6542</span></a>      }
<a name="l6543"><span class="linenum">6543</span></a>  
<a name="l6544"><span class="linenum">6544</span></a>  <span class="comment">    // Work toward always passing an object...</span>
<a name="l6545"><span class="linenum">6545</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l6546"><span class="linenum">6546</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Better use proper forum object.', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l6547"><span class="linenum">6547</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>), '', 'id,trackingtype');
<a name="l6548"><span class="linenum">6548</span></a>      }
<a name="l6549"><span class="linenum">6549</span></a>  
<a name="l6550"><span class="linenum">6550</span></a>      <a class="var it41634" onMouseOver="hilite(41634)" onMouseOut="lolite()" onClick="logVariable('forumallows')" href="../../_variables/forumallows.html">$forumallows</a> = (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('trackingtype')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/trackingtype.html">trackingtype</a> == <a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>);
<a name="l6551"><span class="linenum">6551</span></a>      <a class="var it41635" onMouseOver="hilite(41635)" onMouseOut="lolite()" onClick="logVariable('forumforced')" href="../../_variables/forumforced.html">$forumforced</a> = (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('trackingtype')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/trackingtype.html">trackingtype</a> == <a class="constant" onClick="logConstant('FORUM_TRACKING_FORCED')" href="../../_constants/FORUM_TRACKING_FORCED.html" onMouseOver="constPopup(event,'FORUM_TRACKING_FORCED')">FORUM_TRACKING_FORCED</a>);
<a name="l6552"><span class="linenum">6552</span></a>  
<a name="l6553"><span class="linenum">6553</span></a>      if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_allowforcedreadtracking')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_allowforcedreadtracking.html">forum_allowforcedreadtracking</a>) {
<a name="l6554"><span class="linenum">6554</span></a>  <span class="comment">        // If we allow forcing, then forced forums takes procidence over user setting.</span>
<a name="l6555"><span class="linenum">6555</span></a>          return (<a class="var it41635" onMouseOver="hilite(41635)" onMouseOut="lolite()" onClick="logVariable('forumforced')" href="../../_variables/forumforced.html">$forumforced</a> || (<a class="var it41634" onMouseOver="hilite(41634)" onMouseOut="lolite()" onClick="logVariable('forumallows')" href="../../_variables/forumallows.html">$forumallows</a>  &amp;&amp; (!empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('trackforums')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/trackforums.html">trackforums</a>) &amp;&amp; (bool)<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('trackforums')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/trackforums.html">trackforums</a>)));
<a name="l6556"><span class="linenum">6556</span></a>      } else {
<a name="l6557"><span class="linenum">6557</span></a>  <span class="comment">        // If we don't allow forcing, user setting trumps.</span>
<a name="l6558"><span class="linenum">6558</span></a>          return (<a class="var it41635" onMouseOver="hilite(41635)" onMouseOut="lolite()" onClick="logVariable('forumforced')" href="../../_variables/forumforced.html">$forumforced</a> || <a class="var it41634" onMouseOver="hilite(41634)" onMouseOut="lolite()" onClick="logVariable('forumallows')" href="../../_variables/forumallows.html">$forumallows</a>)  &amp;&amp; !empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('trackforums')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/trackforums.html">trackforums</a>);
<a name="l6559"><span class="linenum">6559</span></a>      }
<a name="l6560"><span class="linenum">6560</span></a>  }
<a name="l6561"><span class="linenum">6561</span></a>  
<a name="l6562"><span class="linenum">6562</span></a>  <span class="comment">/**</span>
<a name="l6563"><span class="linenum">6563</span></a>  <span class="comment"> * Tells whether a specific forum is tracked by the user. A user can optionally</span>
<a name="l6564"><span class="linenum">6564</span></a>  <span class="comment"> * be specified. If not specified, the current user is assumed.</span>
<a name="l6565"><span class="linenum">6565</span></a>  <span class="comment"> *</span>
<a name="l6566"><span class="linenum">6566</span></a>  <span class="comment"> * @global object</span>
<a name="l6567"><span class="linenum">6567</span></a>  <span class="comment"> * @global object</span>
<a name="l6568"><span class="linenum">6568</span></a>  <span class="comment"> * @global object</span>
<a name="l6569"><span class="linenum">6569</span></a>  <span class="comment"> * @param mixed $forum If int, the id of the forum being checked; if object, the forum object</span>
<a name="l6570"><span class="linenum">6570</span></a>  <span class="comment"> * @param int $userid The id of the user being checked (optional).</span>
<a name="l6571"><span class="linenum">6571</span></a>  <span class="comment"> * @return boolean</span>
<a name="l6572"><span class="linenum">6572</span></a>  <span class="comment"> */</span>
<a name="l6573"><span class="linenum">6573</span></a>  function <a class="function" onClick="logFunction('forum_tp_is_tracked')" href="../../_functions/forum_tp_is_tracked.html" onMouseOver="funcPopup(event,'forum_tp_is_tracked')">forum_tp_is_tracked</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>=false) {
<a name="l6574"><span class="linenum">6574</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6575"><span class="linenum">6575</span></a>  
<a name="l6576"><span class="linenum">6576</span></a>      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> === false) {
<a name="l6577"><span class="linenum">6577</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l6578"><span class="linenum">6578</span></a>      }
<a name="l6579"><span class="linenum">6579</span></a>  
<a name="l6580"><span class="linenum">6580</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) or empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l6581"><span class="linenum">6581</span></a>          return false;
<a name="l6582"><span class="linenum">6582</span></a>      }
<a name="l6583"><span class="linenum">6583</span></a>  
<a name="l6584"><span class="linenum">6584</span></a>  <span class="comment">    // Work toward always passing an object...</span>
<a name="l6585"><span class="linenum">6585</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l6586"><span class="linenum">6586</span></a>          <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Better use proper forum object.', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l6587"><span class="linenum">6587</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>));
<a name="l6588"><span class="linenum">6588</span></a>      }
<a name="l6589"><span class="linenum">6589</span></a>  
<a name="l6590"><span class="linenum">6590</span></a>      if (!<a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l6591"><span class="linenum">6591</span></a>          return false;
<a name="l6592"><span class="linenum">6592</span></a>      }
<a name="l6593"><span class="linenum">6593</span></a>  
<a name="l6594"><span class="linenum">6594</span></a>      <a class="var it41634" onMouseOver="hilite(41634)" onMouseOut="lolite()" onClick="logVariable('forumallows')" href="../../_variables/forumallows.html">$forumallows</a> = (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('trackingtype')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/trackingtype.html">trackingtype</a> == <a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>);
<a name="l6595"><span class="linenum">6595</span></a>      <a class="var it41635" onMouseOver="hilite(41635)" onMouseOut="lolite()" onClick="logVariable('forumforced')" href="../../_variables/forumforced.html">$forumforced</a> = (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('trackingtype')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/trackingtype.html">trackingtype</a> == <a class="constant" onClick="logConstant('FORUM_TRACKING_FORCED')" href="../../_constants/FORUM_TRACKING_FORCED.html" onMouseOver="constPopup(event,'FORUM_TRACKING_FORCED')">FORUM_TRACKING_FORCED</a>);
<a name="l6596"><span class="linenum">6596</span></a>      <a class="var it15791" onMouseOver="hilite(15791)" onMouseOut="lolite()" onClick="logVariable('userpref')" href="../../_variables/userpref.html">$userpref</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_track_prefs', array('userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'forumid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l6597"><span class="linenum">6597</span></a>  
<a name="l6598"><span class="linenum">6598</span></a>      if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_allowforcedreadtracking')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_allowforcedreadtracking.html">forum_allowforcedreadtracking</a>) {
<a name="l6599"><span class="linenum">6599</span></a>          return <a class="var it41635" onMouseOver="hilite(41635)" onMouseOut="lolite()" onClick="logVariable('forumforced')" href="../../_variables/forumforced.html">$forumforced</a> || (<a class="var it41634" onMouseOver="hilite(41634)" onMouseOut="lolite()" onClick="logVariable('forumallows')" href="../../_variables/forumallows.html">$forumallows</a> &amp;&amp; <a class="var it15791" onMouseOver="hilite(15791)" onMouseOut="lolite()" onClick="logVariable('userpref')" href="../../_variables/userpref.html">$userpref</a> === false);
<a name="l6600"><span class="linenum">6600</span></a>      } else {
<a name="l6601"><span class="linenum">6601</span></a>          return  (<a class="var it41634" onMouseOver="hilite(41634)" onMouseOut="lolite()" onClick="logVariable('forumallows')" href="../../_variables/forumallows.html">$forumallows</a> || <a class="var it41635" onMouseOver="hilite(41635)" onMouseOut="lolite()" onClick="logVariable('forumforced')" href="../../_variables/forumforced.html">$forumforced</a>) &amp;&amp; <a class="var it15791" onMouseOver="hilite(15791)" onMouseOut="lolite()" onClick="logVariable('userpref')" href="../../_variables/userpref.html">$userpref</a> === false;
<a name="l6602"><span class="linenum">6602</span></a>      }
<a name="l6603"><span class="linenum">6603</span></a>  }
<a name="l6604"><span class="linenum">6604</span></a>  
<a name="l6605"><span class="linenum">6605</span></a>  <span class="comment">/**</span>
<a name="l6606"><span class="linenum">6606</span></a>  <span class="comment"> * @global object</span>
<a name="l6607"><span class="linenum">6607</span></a>  <span class="comment"> * @global object</span>
<a name="l6608"><span class="linenum">6608</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l6609"><span class="linenum">6609</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l6610"><span class="linenum">6610</span></a>  <span class="comment"> */</span>
<a name="l6611"><span class="linenum">6611</span></a>  function <a class="function" onClick="logFunction('forum_tp_start_tracking')" href="../../_functions/forum_tp_start_tracking.html" onMouseOver="funcPopup(event,'forum_tp_start_tracking')">forum_tp_start_tracking</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=false) {
<a name="l6612"><span class="linenum">6612</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6613"><span class="linenum">6613</span></a>  
<a name="l6614"><span class="linenum">6614</span></a>      if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> === false) {
<a name="l6615"><span class="linenum">6615</span></a>          <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l6616"><span class="linenum">6616</span></a>      }
<a name="l6617"><span class="linenum">6617</span></a>  
<a name="l6618"><span class="linenum">6618</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_track_prefs', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'forumid' =&gt; <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>));
<a name="l6619"><span class="linenum">6619</span></a>  }
<a name="l6620"><span class="linenum">6620</span></a>  
<a name="l6621"><span class="linenum">6621</span></a>  <span class="comment">/**</span>
<a name="l6622"><span class="linenum">6622</span></a>  <span class="comment"> * @global object</span>
<a name="l6623"><span class="linenum">6623</span></a>  <span class="comment"> * @global object</span>
<a name="l6624"><span class="linenum">6624</span></a>  <span class="comment"> * @param int $forumid</span>
<a name="l6625"><span class="linenum">6625</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l6626"><span class="linenum">6626</span></a>  <span class="comment"> */</span>
<a name="l6627"><span class="linenum">6627</span></a>  function <a class="function" onClick="logFunction('forum_tp_stop_tracking')" href="../../_functions/forum_tp_stop_tracking.html" onMouseOver="funcPopup(event,'forum_tp_stop_tracking')">forum_tp_stop_tracking</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=false) {
<a name="l6628"><span class="linenum">6628</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6629"><span class="linenum">6629</span></a>  
<a name="l6630"><span class="linenum">6630</span></a>      if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> === false) {
<a name="l6631"><span class="linenum">6631</span></a>          <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l6632"><span class="linenum">6632</span></a>      }
<a name="l6633"><span class="linenum">6633</span></a>  
<a name="l6634"><span class="linenum">6634</span></a>      if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('forum_track_prefs', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'forumid' =&gt; <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>))) {
<a name="l6635"><span class="linenum">6635</span></a>          <a class="var it41636" onMouseOver="hilite(41636)" onMouseOut="lolite()" onClick="logVariable('track_prefs')" href="../../_variables/track_prefs.html">$track_prefs</a> = new stdClass();
<a name="l6636"><span class="linenum">6636</span></a>          <a class="var it41636" onMouseOver="hilite(41636)" onMouseOut="lolite()" onClick="logVariable('track_prefs')" href="../../_variables/track_prefs.html">$track_prefs</a>-&gt;<a onClick="logVariable('userid')" class="var it44626" onMouseOver="hilite(44626)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l6637"><span class="linenum">6637</span></a>          <a class="var it41636" onMouseOver="hilite(41636)" onMouseOut="lolite()" onClick="logVariable('track_prefs')" href="../../_variables/track_prefs.html">$track_prefs</a>-&gt;<a onClick="logVariable('forumid')" class="var it44626" onMouseOver="hilite(44626)" onMouseOut="lolite()" href="../../_variables/forumid.html">forumid</a> = <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>;
<a name="l6638"><span class="linenum">6638</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('forum_track_prefs', <a class="var it41636" onMouseOver="hilite(41636)" onMouseOut="lolite()" onClick="logVariable('track_prefs')" href="../../_variables/track_prefs.html">$track_prefs</a>);
<a name="l6639"><span class="linenum">6639</span></a>      }
<a name="l6640"><span class="linenum">6640</span></a>  
<a name="l6641"><span class="linenum">6641</span></a>      return <a class="function" onClick="logFunction('forum_tp_delete_read_records')" href="../../_functions/forum_tp_delete_read_records.html" onMouseOver="funcPopup(event,'forum_tp_delete_read_records')">forum_tp_delete_read_records</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, -1, -1, <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>);
<a name="l6642"><span class="linenum">6642</span></a>  }
<a name="l6643"><span class="linenum">6643</span></a>  
<a name="l6644"><span class="linenum">6644</span></a>  
<a name="l6645"><span class="linenum">6645</span></a>  <span class="comment">/**</span>
<a name="l6646"><span class="linenum">6646</span></a>  <span class="comment"> * Clean old records from the forum_read table.</span>
<a name="l6647"><span class="linenum">6647</span></a>  <span class="comment"> * @global object</span>
<a name="l6648"><span class="linenum">6648</span></a>  <span class="comment"> * @global object</span>
<a name="l6649"><span class="linenum">6649</span></a>  <span class="comment"> * @return void</span>
<a name="l6650"><span class="linenum">6650</span></a>  <span class="comment"> */</span>
<a name="l6651"><span class="linenum">6651</span></a>  function <a class="function" onClick="logFunction('forum_tp_clean_read_records')" href="../../_functions/forum_tp_clean_read_records.html" onMouseOver="funcPopup(event,'forum_tp_clean_read_records')">forum_tp_clean_read_records</a>() {
<a name="l6652"><span class="linenum">6652</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6653"><span class="linenum">6653</span></a>  
<a name="l6654"><span class="linenum">6654</span></a>      if (!isset(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a>)) {
<a name="l6655"><span class="linenum">6655</span></a>          return;
<a name="l6656"><span class="linenum">6656</span></a>      }
<a name="l6657"><span class="linenum">6657</span></a>  <span class="comment">// Look for records older than the cutoffdate that are still in the forum_read table.</span>
<a name="l6658"><span class="linenum">6658</span></a>      <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_oldpostdays')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_oldpostdays.html">forum_oldpostdays</a>*24*60*60);
<a name="l6659"><span class="linenum">6659</span></a>  
<a name="l6660"><span class="linenum">6660</span></a>  <span class="comment">    //first get the oldest tracking present - we need tis to speedup the next delete query</span>
<a name="l6661"><span class="linenum">6661</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('MIN')" href="../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">MIN</a>(fp.modified) AS first
<a name="l6662"><span class="linenum">6662</span></a>                FROM {forum_posts} fp
<a name="l6663"><span class="linenum">6663</span></a>                     JOIN {forum_read} fr ON fr.postid=fp.id&quot;;
<a name="l6664"><span class="linenum">6664</span></a>      if (!<a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('first')" href="../../_variables/first.html">$first</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>)) {
<a name="l6665"><span class="linenum">6665</span></a>  <span class="comment">        // nothing to delete;</span>
<a name="l6666"><span class="linenum">6666</span></a>          return;
<a name="l6667"><span class="linenum">6667</span></a>      }
<a name="l6668"><span class="linenum">6668</span></a>  
<a name="l6669"><span class="linenum">6669</span></a>  <span class="comment">    // now delete old tracking info</span>
<a name="l6670"><span class="linenum">6670</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;DELETE
<a name="l6671"><span class="linenum">6671</span></a>                FROM {forum_read}
<a name="l6672"><span class="linenum">6672</span></a>               WHERE postid IN (SELECT fp.id
<a name="l6673"><span class="linenum">6673</span></a>                                  FROM {forum_posts} fp
<a name="l6674"><span class="linenum">6674</span></a>                                 WHERE fp.modified &gt;= ? AND fp.modified &lt; ?)&quot;;
<a name="l6675"><span class="linenum">6675</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('first')" href="../../_variables/first.html">$first</a>, <a class="var it2266" onMouseOver="hilite(2266)" onMouseOut="lolite()" onClick="logVariable('cutoffdate')" href="../../_variables/cutoffdate.html">$cutoffdate</a>));
<a name="l6676"><span class="linenum">6676</span></a>  }
<a name="l6677"><span class="linenum">6677</span></a>  
<a name="l6678"><span class="linenum">6678</span></a>  <span class="comment">/**</span>
<a name="l6679"><span class="linenum">6679</span></a>  <span class="comment"> * Sets the last post for a given discussion</span>
<a name="l6680"><span class="linenum">6680</span></a>  <span class="comment"> *</span>
<a name="l6681"><span class="linenum">6681</span></a>  <span class="comment"> * @global object</span>
<a name="l6682"><span class="linenum">6682</span></a>  <span class="comment"> * @global object</span>
<a name="l6683"><span class="linenum">6683</span></a>  <span class="comment"> * @param into $discussionid</span>
<a name="l6684"><span class="linenum">6684</span></a>  <span class="comment"> * @return bool|int</span>
<a name="l6685"><span class="linenum">6685</span></a>  <span class="comment"> **/</span>
<a name="l6686"><span class="linenum">6686</span></a>  function <a class="function" onClick="logFunction('forum_discussion_update_last_post')" href="../../_functions/forum_discussion_update_last_post.html" onMouseOver="funcPopup(event,'forum_discussion_update_last_post')">forum_discussion_update_last_post</a>(<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>) {
<a name="l6687"><span class="linenum">6687</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6688"><span class="linenum">6688</span></a>  
<a name="l6689"><span class="linenum">6689</span></a>  <span class="comment">// Check the given discussion exists</span>
<a name="l6690"><span class="linenum">6690</span></a>      if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('forum_discussions', array('id' =&gt; <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>))) {
<a name="l6691"><span class="linenum">6691</span></a>          return false;
<a name="l6692"><span class="linenum">6692</span></a>      }
<a name="l6693"><span class="linenum">6693</span></a>  
<a name="l6694"><span class="linenum">6694</span></a>  <span class="comment">// Use SQL to find the last post for this discussion</span>
<a name="l6695"><span class="linenum">6695</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT id, userid, modified
<a name="l6696"><span class="linenum">6696</span></a>                FROM {forum_posts}
<a name="l6697"><span class="linenum">6697</span></a>               WHERE discussion=?
<a name="l6698"><span class="linenum">6698</span></a>               ORDER BY modified DESC&quot;;
<a name="l6699"><span class="linenum">6699</span></a>  
<a name="l6700"><span class="linenum">6700</span></a>  <span class="comment">// Lets go find the last post</span>
<a name="l6701"><span class="linenum">6701</span></a>      if ((<a class="var it41637" onMouseOver="hilite(41637)" onMouseOut="lolite()" onClick="logVariable('lastposts')" href="../../_variables/lastposts.html">$lastposts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>), 0, 1))) {
<a name="l6702"><span class="linenum">6702</span></a>          <a class="var it23996" onMouseOver="hilite(23996)" onMouseOut="lolite()" onClick="logVariable('lastpost')" href="../../_variables/lastpost.html">$lastpost</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it41637" onMouseOver="hilite(41637)" onMouseOut="lolite()" onClick="logVariable('lastposts')" href="../../_variables/lastposts.html">$lastposts</a>);
<a name="l6703"><span class="linenum">6703</span></a>          <a class="var it41638" onMouseOver="hilite(41638)" onMouseOut="lolite()" onClick="logVariable('discussionobject')" href="../../_variables/discussionobject.html">$discussionobject</a> = new stdClass();
<a name="l6704"><span class="linenum">6704</span></a>          <a class="var it41638" onMouseOver="hilite(41638)" onMouseOut="lolite()" onClick="logVariable('discussionobject')" href="../../_variables/discussionobject.html">$discussionobject</a>-&gt;<a onClick="logVariable('id')" class="var it44627" onMouseOver="hilite(44627)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>           = <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>;
<a name="l6705"><span class="linenum">6705</span></a>          <a class="var it41638" onMouseOver="hilite(41638)" onMouseOut="lolite()" onClick="logVariable('discussionobject')" href="../../_variables/discussionobject.html">$discussionobject</a>-&gt;<a onClick="logVariable('usermodified')" class="var it44627" onMouseOver="hilite(44627)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> = <a class="var it23996" onMouseOver="hilite(23996)" onMouseOut="lolite()" onClick="logVariable('lastpost')" href="../../_variables/lastpost.html">$lastpost</a>-&gt;<a onClick="logVariable('userid')" class="var it44628" onMouseOver="hilite(44628)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l6706"><span class="linenum">6706</span></a>          <a class="var it41638" onMouseOver="hilite(41638)" onMouseOut="lolite()" onClick="logVariable('discussionobject')" href="../../_variables/discussionobject.html">$discussionobject</a>-&gt;<a onClick="logVariable('timemodified')" class="var it44627" onMouseOver="hilite(44627)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it23996" onMouseOver="hilite(23996)" onMouseOut="lolite()" onClick="logVariable('lastpost')" href="../../_variables/lastpost.html">$lastpost</a>-&gt;<a onClick="logVariable('modified')" class="var it44628" onMouseOver="hilite(44628)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>;
<a name="l6707"><span class="linenum">6707</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_discussions', <a class="var it41638" onMouseOver="hilite(41638)" onMouseOut="lolite()" onClick="logVariable('discussionobject')" href="../../_variables/discussionobject.html">$discussionobject</a>);
<a name="l6708"><span class="linenum">6708</span></a>          return <a class="var it23996" onMouseOver="hilite(23996)" onMouseOut="lolite()" onClick="logVariable('lastpost')" href="../../_variables/lastpost.html">$lastpost</a>-&gt;<a onClick="logVariable('id')" class="var it44628" onMouseOver="hilite(44628)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l6709"><span class="linenum">6709</span></a>      }
<a name="l6710"><span class="linenum">6710</span></a>  
<a name="l6711"><span class="linenum">6711</span></a>  <span class="comment">// To get here either we couldn't find a post for the discussion (weird)</span>
<a name="l6712"><span class="linenum">6712</span></a>  <span class="comment">// or we couldn't update the discussion record (weird x2)</span>
<a name="l6713"><span class="linenum">6713</span></a>      return false;
<a name="l6714"><span class="linenum">6714</span></a>  }
<a name="l6715"><span class="linenum">6715</span></a>  
<a name="l6716"><span class="linenum">6716</span></a>  
<a name="l6717"><span class="linenum">6717</span></a>  <span class="comment">/**</span>
<a name="l6718"><span class="linenum">6718</span></a>  <span class="comment"> * List the actions that correspond to a view of this module.</span>
<a name="l6719"><span class="linenum">6719</span></a>  <span class="comment"> * This is used by the participation report.</span>
<a name="l6720"><span class="linenum">6720</span></a>  <span class="comment"> *</span>
<a name="l6721"><span class="linenum">6721</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l6722"><span class="linenum">6722</span></a>  <span class="comment"> *       crud = 'r' and edulevel = LEVEL_PARTICIPATING will</span>
<a name="l6723"><span class="linenum">6723</span></a>  <span class="comment"> *       be considered as view action.</span>
<a name="l6724"><span class="linenum">6724</span></a>  <span class="comment"> *</span>
<a name="l6725"><span class="linenum">6725</span></a>  <span class="comment"> * @return array</span>
<a name="l6726"><span class="linenum">6726</span></a>  <span class="comment"> */</span>
<a name="l6727"><span class="linenum">6727</span></a>  function <a class="function" onClick="logFunction('forum_get_view_actions')" href="../../_functions/forum_get_view_actions.html" onMouseOver="funcPopup(event,'forum_get_view_actions')">forum_get_view_actions</a>() {
<a name="l6728"><span class="linenum">6728</span></a>      return array('view discussion', 'search', 'forum', 'forums', 'subscribers', 'view forum');
<a name="l6729"><span class="linenum">6729</span></a>  }
<a name="l6730"><span class="linenum">6730</span></a>  
<a name="l6731"><span class="linenum">6731</span></a>  <span class="comment">/**</span>
<a name="l6732"><span class="linenum">6732</span></a>  <span class="comment"> * List the actions that correspond to a post of this module.</span>
<a name="l6733"><span class="linenum">6733</span></a>  <span class="comment"> * This is used by the participation report.</span>
<a name="l6734"><span class="linenum">6734</span></a>  <span class="comment"> *</span>
<a name="l6735"><span class="linenum">6735</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l6736"><span class="linenum">6736</span></a>  <span class="comment"> *       crud = ('c' || 'u' || 'd') and edulevel = LEVEL_PARTICIPATING</span>
<a name="l6737"><span class="linenum">6737</span></a>  <span class="comment"> *       will be considered as post action.</span>
<a name="l6738"><span class="linenum">6738</span></a>  <span class="comment"> *</span>
<a name="l6739"><span class="linenum">6739</span></a>  <span class="comment"> * @return array</span>
<a name="l6740"><span class="linenum">6740</span></a>  <span class="comment"> */</span>
<a name="l6741"><span class="linenum">6741</span></a>  function <a class="function" onClick="logFunction('forum_get_post_actions')" href="../../_functions/forum_get_post_actions.html" onMouseOver="funcPopup(event,'forum_get_post_actions')">forum_get_post_actions</a>() {
<a name="l6742"><span class="linenum">6742</span></a>      return array('add discussion','add post','delete discussion','delete post','move discussion','prune post','update post');
<a name="l6743"><span class="linenum">6743</span></a>  }
<a name="l6744"><span class="linenum">6744</span></a>  
<a name="l6745"><span class="linenum">6745</span></a>  <span class="comment">/**</span>
<a name="l6746"><span class="linenum">6746</span></a>  <span class="comment"> * Returns a warning object if a user has reached the number of posts equal to</span>
<a name="l6747"><span class="linenum">6747</span></a>  <span class="comment"> * the warning/blocking setting, or false if there is no warning to show.</span>
<a name="l6748"><span class="linenum">6748</span></a>  <span class="comment"> *</span>
<a name="l6749"><span class="linenum">6749</span></a>  <span class="comment"> * @param int|stdClass $forum the forum id or the forum object</span>
<a name="l6750"><span class="linenum">6750</span></a>  <span class="comment"> * @param stdClass $cm the course module</span>
<a name="l6751"><span class="linenum">6751</span></a>  <span class="comment"> * @return stdClass|bool returns an object with the warning information, else</span>
<a name="l6752"><span class="linenum">6752</span></a>  <span class="comment"> *         returns false if no warning is required.</span>
<a name="l6753"><span class="linenum">6753</span></a>  <span class="comment"> */</span>
<a name="l6754"><span class="linenum">6754</span></a>  function <a class="function" onClick="logFunction('forum_check_throttling')" href="../../_functions/forum_check_throttling.html" onMouseOver="funcPopup(event,'forum_check_throttling')">forum_check_throttling</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = null) {
<a name="l6755"><span class="linenum">6755</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l6756"><span class="linenum">6756</span></a>  
<a name="l6757"><span class="linenum">6757</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l6758"><span class="linenum">6758</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l6759"><span class="linenum">6759</span></a>      }
<a name="l6760"><span class="linenum">6760</span></a>  
<a name="l6761"><span class="linenum">6761</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l6762"><span class="linenum">6762</span></a>          return false; <span class="comment">// This is broken.</span>
<a name="l6763"><span class="linenum">6763</span></a>      }
<a name="l6764"><span class="linenum">6764</span></a>  
<a name="l6765"><span class="linenum">6765</span></a>      if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l6766"><span class="linenum">6766</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, false, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l6767"><span class="linenum">6767</span></a>      }
<a name="l6768"><span class="linenum">6768</span></a>  
<a name="l6769"><span class="linenum">6769</span></a>      if (empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('blockafter')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/blockafter.html">blockafter</a>)) {
<a name="l6770"><span class="linenum">6770</span></a>          return false;
<a name="l6771"><span class="linenum">6771</span></a>      }
<a name="l6772"><span class="linenum">6772</span></a>  
<a name="l6773"><span class="linenum">6773</span></a>      if (empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('blockperiod')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/blockperiod.html">blockperiod</a>)) {
<a name="l6774"><span class="linenum">6774</span></a>          return false;
<a name="l6775"><span class="linenum">6775</span></a>      }
<a name="l6776"><span class="linenum">6776</span></a>  
<a name="l6777"><span class="linenum">6777</span></a>      <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l6778"><span class="linenum">6778</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:postwithoutthrottling', <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>)) {
<a name="l6779"><span class="linenum">6779</span></a>          return false;
<a name="l6780"><span class="linenum">6780</span></a>      }
<a name="l6781"><span class="linenum">6781</span></a>  
<a name="l6782"><span class="linenum">6782</span></a>  <span class="comment">    // Get the number of posts in the last period we care about.</span>
<a name="l6783"><span class="linenum">6783</span></a>      <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l6784"><span class="linenum">6784</span></a>      <a class="var it19878" onMouseOver="hilite(19878)" onMouseOut="lolite()" onClick="logVariable('timeafter')" href="../../_variables/timeafter.html">$timeafter</a> = <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a> - <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('blockperiod')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/blockperiod.html">blockperiod</a>;
<a name="l6785"><span class="linenum">6785</span></a>      <a class="var it15256" onMouseOver="hilite(15256)" onMouseOut="lolite()" onClick="logVariable('numposts')" href="../../_variables/numposts.html">$numposts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>('SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(p.id) FROM {forum_posts} p
<a name="l6786"><span class="linenum">6786</span></a>                                          JOIN {forum_discussions} d
<a name="l6787"><span class="linenum">6787</span></a>                                          ON p.discussion = d.id WHERE d.forum = ?
<a name="l6788"><span class="linenum">6788</span></a>                                          AND p.userid = ? AND p.created &gt; ?', array(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it19878" onMouseOver="hilite(19878)" onMouseOut="lolite()" onClick="logVariable('timeafter')" href="../../_variables/timeafter.html">$timeafter</a>));
<a name="l6789"><span class="linenum">6789</span></a>  
<a name="l6790"><span class="linenum">6790</span></a>      <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a> = new stdClass();
<a name="l6791"><span class="linenum">6791</span></a>      <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('blockafter')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/blockafter.html">blockafter</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('blockafter')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/blockafter.html">blockafter</a>;
<a name="l6792"><span class="linenum">6792</span></a>      <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('numposts')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/numposts.html">numposts</a> = <a class="var it15256" onMouseOver="hilite(15256)" onMouseOut="lolite()" onClick="logVariable('numposts')" href="../../_variables/numposts.html">$numposts</a>;
<a name="l6793"><span class="linenum">6793</span></a>      <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('blockperiod')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/blockperiod.html">blockperiod</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('secondstotime'.<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('blockperiod')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/blockperiod.html">blockperiod</a>);
<a name="l6794"><span class="linenum">6794</span></a>  
<a name="l6795"><span class="linenum">6795</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('blockafter')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/blockafter.html">blockafter</a> &lt;= <a class="var it15256" onMouseOver="hilite(15256)" onMouseOut="lolite()" onClick="logVariable('numposts')" href="../../_variables/numposts.html">$numposts</a>) {
<a name="l6796"><span class="linenum">6796</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a> = new stdClass();
<a name="l6797"><span class="linenum">6797</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('canpost')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a> = false;
<a name="l6798"><span class="linenum">6798</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('errorcode')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/errorcode.html">errorcode</a> = 'forumblockingtoomanyposts';
<a name="l6799"><span class="linenum">6799</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('module')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/module.html">module</a> = 'error';
<a name="l6800"><span class="linenum">6800</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('additional')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/additional.html">additional</a> = <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>;
<a name="l6801"><span class="linenum">6801</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('link')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/link.html">link</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a> . '/mod/forum/view.php?f=' . <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l6802"><span class="linenum">6802</span></a>  
<a name="l6803"><span class="linenum">6803</span></a>          return <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>;
<a name="l6804"><span class="linenum">6804</span></a>      }
<a name="l6805"><span class="linenum">6805</span></a>  
<a name="l6806"><span class="linenum">6806</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('warnafter')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/warnafter.html">warnafter</a> &lt;= <a class="var it15256" onMouseOver="hilite(15256)" onMouseOut="lolite()" onClick="logVariable('numposts')" href="../../_variables/numposts.html">$numposts</a>) {
<a name="l6807"><span class="linenum">6807</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a> = new stdClass();
<a name="l6808"><span class="linenum">6808</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('canpost')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a> = true;
<a name="l6809"><span class="linenum">6809</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('errorcode')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/errorcode.html">errorcode</a> = 'forumblockingalmosttoomanyposts';
<a name="l6810"><span class="linenum">6810</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('module')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/module.html">module</a> = 'forum';
<a name="l6811"><span class="linenum">6811</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('additional')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/additional.html">additional</a> = <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>;
<a name="l6812"><span class="linenum">6812</span></a>          <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>-&gt;<a onClick="logVariable('link')" class="var it44629" onMouseOver="hilite(44629)" onMouseOut="lolite()" href="../../_variables/link.html">link</a> = null;
<a name="l6813"><span class="linenum">6813</span></a>  
<a name="l6814"><span class="linenum">6814</span></a>          return <a class="var it3502" onMouseOver="hilite(3502)" onMouseOut="lolite()" onClick="logVariable('warning')" href="../../_variables/warning.html">$warning</a>;
<a name="l6815"><span class="linenum">6815</span></a>      }
<a name="l6816"><span class="linenum">6816</span></a>  }
<a name="l6817"><span class="linenum">6817</span></a>  
<a name="l6818"><span class="linenum">6818</span></a>  <span class="comment">/**</span>
<a name="l6819"><span class="linenum">6819</span></a>  <span class="comment"> * Throws an error if the user is no longer allowed to post due to having reached</span>
<a name="l6820"><span class="linenum">6820</span></a>  <span class="comment"> * or exceeded the number of posts specified in 'Post threshold for blocking'</span>
<a name="l6821"><span class="linenum">6821</span></a>  <span class="comment"> * setting.</span>
<a name="l6822"><span class="linenum">6822</span></a>  <span class="comment"> *</span>
<a name="l6823"><span class="linenum">6823</span></a>  <span class="comment"> * @since Moodle 2.5</span>
<a name="l6824"><span class="linenum">6824</span></a>  <span class="comment"> * @param stdClass $thresholdwarning the warning information returned</span>
<a name="l6825"><span class="linenum">6825</span></a>  <span class="comment"> *        from the function forum_check_throttling.</span>
<a name="l6826"><span class="linenum">6826</span></a>  <span class="comment"> */</span>
<a name="l6827"><span class="linenum">6827</span></a>  function <a class="function" onClick="logFunction('forum_check_blocking_threshold')" href="../../_functions/forum_check_blocking_threshold.html" onMouseOver="funcPopup(event,'forum_check_blocking_threshold')">forum_check_blocking_threshold</a>(<a class="var it7440" onMouseOver="hilite(7440)" onMouseOut="lolite()" onClick="logVariable('thresholdwarning')" href="../../_variables/thresholdwarning.html">$thresholdwarning</a>) {
<a name="l6828"><span class="linenum">6828</span></a>      if (!empty(<a class="var it7440" onMouseOver="hilite(7440)" onMouseOut="lolite()" onClick="logVariable('thresholdwarning')" href="../../_variables/thresholdwarning.html">$thresholdwarning</a>) &amp;&amp; !<a class="var it7440" onMouseOver="hilite(7440)" onMouseOut="lolite()" onClick="logVariable('thresholdwarning')" href="../../_variables/thresholdwarning.html">$thresholdwarning</a>-&gt;<a onClick="logVariable('canpost')" class="var it44630" onMouseOver="hilite(44630)" onMouseOut="lolite()" href="../../_variables/canpost.html">canpost</a>) {
<a name="l6829"><span class="linenum">6829</span></a>          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>(<a class="var it7440" onMouseOver="hilite(7440)" onMouseOut="lolite()" onClick="logVariable('thresholdwarning')" href="../../_variables/thresholdwarning.html">$thresholdwarning</a>-&gt;<a onClick="logVariable('errorcode')" class="var it44630" onMouseOver="hilite(44630)" onMouseOut="lolite()" href="../../_variables/errorcode.html">errorcode</a>,
<a name="l6830"><span class="linenum">6830</span></a>                      <a class="var it7440" onMouseOver="hilite(7440)" onMouseOut="lolite()" onClick="logVariable('thresholdwarning')" href="../../_variables/thresholdwarning.html">$thresholdwarning</a>-&gt;<a onClick="logVariable('module')" class="var it44630" onMouseOver="hilite(44630)" onMouseOut="lolite()" href="../../_variables/module.html">module</a>,
<a name="l6831"><span class="linenum">6831</span></a>                      <a class="var it7440" onMouseOver="hilite(7440)" onMouseOut="lolite()" onClick="logVariable('thresholdwarning')" href="../../_variables/thresholdwarning.html">$thresholdwarning</a>-&gt;<a onClick="logVariable('link')" class="var it44630" onMouseOver="hilite(44630)" onMouseOut="lolite()" href="../../_variables/link.html">link</a>,
<a name="l6832"><span class="linenum">6832</span></a>                      <a class="var it7440" onMouseOver="hilite(7440)" onMouseOut="lolite()" onClick="logVariable('thresholdwarning')" href="../../_variables/thresholdwarning.html">$thresholdwarning</a>-&gt;<a onClick="logVariable('additional')" class="var it44630" onMouseOver="hilite(44630)" onMouseOut="lolite()" href="../../_variables/additional.html">additional</a>);
<a name="l6833"><span class="linenum">6833</span></a>      }
<a name="l6834"><span class="linenum">6834</span></a>  }
<a name="l6835"><span class="linenum">6835</span></a>  
<a name="l6836"><span class="linenum">6836</span></a>  
<a name="l6837"><span class="linenum">6837</span></a>  <span class="comment">/**</span>
<a name="l6838"><span class="linenum">6838</span></a>  <span class="comment"> * Removes all grades from gradebook</span>
<a name="l6839"><span class="linenum">6839</span></a>  <span class="comment"> *</span>
<a name="l6840"><span class="linenum">6840</span></a>  <span class="comment"> * @global object</span>
<a name="l6841"><span class="linenum">6841</span></a>  <span class="comment"> * @global object</span>
<a name="l6842"><span class="linenum">6842</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l6843"><span class="linenum">6843</span></a>  <span class="comment"> * @param string $type optional</span>
<a name="l6844"><span class="linenum">6844</span></a>  <span class="comment"> */</span>
<a name="l6845"><span class="linenum">6845</span></a>  function <a class="function" onClick="logFunction('forum_reset_gradebook')" href="../../_functions/forum_reset_gradebook.html" onMouseOver="funcPopup(event,'forum_reset_gradebook')">forum_reset_gradebook</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>='') {
<a name="l6846"><span class="linenum">6846</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6847"><span class="linenum">6847</span></a>  
<a name="l6848"><span class="linenum">6848</span></a>      <a class="var it5302" onMouseOver="hilite(5302)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a> = '';
<a name="l6849"><span class="linenum">6849</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l6850"><span class="linenum">6850</span></a>      if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l6851"><span class="linenum">6851</span></a>          <a class="var it5302" onMouseOver="hilite(5302)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a> = &quot;AND f.type=?&quot;;
<a name="l6852"><span class="linenum">6852</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>;
<a name="l6853"><span class="linenum">6853</span></a>      }
<a name="l6854"><span class="linenum">6854</span></a>  
<a name="l6855"><span class="linenum">6855</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT f.*, cm.idnumber as cmidnumber, f.course as courseid
<a name="l6856"><span class="linenum">6856</span></a>                FROM {forum} f, {course_modules} cm, {modules} m
<a name="l6857"><span class="linenum">6857</span></a>               WHERE m.name='forum' AND m.id=cm.module AND cm.instance=f.id AND f.course=? <a class="var it5302" onMouseOver="hilite(5302)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a>&quot;;
<a name="l6858"><span class="linenum">6858</span></a>  
<a name="l6859"><span class="linenum">6859</span></a>      if (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l6860"><span class="linenum">6860</span></a>          foreach (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> as <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l6861"><span class="linenum">6861</span></a>              <a class="function" onClick="logFunction('forum_grade_item_update')" href="../../_functions/forum_grade_item_update.html" onMouseOver="funcPopup(event,'forum_grade_item_update')">forum_grade_item_update</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, 'reset');
<a name="l6862"><span class="linenum">6862</span></a>          }
<a name="l6863"><span class="linenum">6863</span></a>      }
<a name="l6864"><span class="linenum">6864</span></a>  }
<a name="l6865"><span class="linenum">6865</span></a>  
<a name="l6866"><span class="linenum">6866</span></a>  <span class="comment">/**</span>
<a name="l6867"><span class="linenum">6867</span></a>  <span class="comment"> * This function is used by the reset_course_userdata function in moodlelib.</span>
<a name="l6868"><span class="linenum">6868</span></a>  <span class="comment"> * This function will remove all posts from the specified forum</span>
<a name="l6869"><span class="linenum">6869</span></a>  <span class="comment"> * and clean up any related data.</span>
<a name="l6870"><span class="linenum">6870</span></a>  <span class="comment"> *</span>
<a name="l6871"><span class="linenum">6871</span></a>  <span class="comment"> * @global object</span>
<a name="l6872"><span class="linenum">6872</span></a>  <span class="comment"> * @global object</span>
<a name="l6873"><span class="linenum">6873</span></a>  <span class="comment"> * @param $data the data submitted from the reset course.</span>
<a name="l6874"><span class="linenum">6874</span></a>  <span class="comment"> * @return array status array</span>
<a name="l6875"><span class="linenum">6875</span></a>  <span class="comment"> */</span>
<a name="l6876"><span class="linenum">6876</span></a>  function <a class="function" onClick="logFunction('forum_reset_userdata')" href="../../_functions/forum_reset_userdata.html" onMouseOver="funcPopup(event,'forum_reset_userdata')">forum_reset_userdata</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>) {
<a name="l6877"><span class="linenum">6877</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l6878"><span class="linenum">6878</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../rating/lib.php.html">/rating/lib.php</a>');
<a name="l6879"><span class="linenum">6879</span></a>  
<a name="l6880"><span class="linenum">6880</span></a>      <a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulenameplural', 'forum');
<a name="l6881"><span class="linenum">6881</span></a>      <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = array();
<a name="l6882"><span class="linenum">6882</span></a>  
<a name="l6883"><span class="linenum">6883</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l6884"><span class="linenum">6884</span></a>  
<a name="l6885"><span class="linenum">6885</span></a>      <a class="var it41639" onMouseOver="hilite(41639)" onMouseOut="lolite()" onClick="logVariable('removeposts')" href="../../_variables/removeposts.html">$removeposts</a> = false;
<a name="l6886"><span class="linenum">6886</span></a>      <a class="var it32814" onMouseOver="hilite(32814)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../../_variables/typesql.html">$typesql</a>     = &quot;&quot;;
<a name="l6887"><span class="linenum">6887</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_forum_all')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_forum_all.html">reset_forum_all</a>)) {
<a name="l6888"><span class="linenum">6888</span></a>          <a class="var it41639" onMouseOver="hilite(41639)" onMouseOut="lolite()" onClick="logVariable('removeposts')" href="../../_variables/removeposts.html">$removeposts</a> = true;
<a name="l6889"><span class="linenum">6889</span></a>          <a class="var it41641" onMouseOver="hilite(41641)" onMouseOut="lolite()" onClick="logVariable('typesstr')" href="../../_variables/typesstr.html">$typesstr</a>    = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resetforumsall', 'forum');
<a name="l6890"><span class="linenum">6890</span></a>          <a class="var it1455" onMouseOver="hilite(1455)" onMouseOut="lolite()" onClick="logVariable('types')" href="../../_variables/types.html">$types</a>       = array();
<a name="l6891"><span class="linenum">6891</span></a>      } else if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_forum_types')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_forum_types.html">reset_forum_types</a>)){
<a name="l6892"><span class="linenum">6892</span></a>          <a class="var it41639" onMouseOver="hilite(41639)" onMouseOut="lolite()" onClick="logVariable('removeposts')" href="../../_variables/removeposts.html">$removeposts</a> = true;
<a name="l6893"><span class="linenum">6893</span></a>          <a class="var it1455" onMouseOver="hilite(1455)" onMouseOut="lolite()" onClick="logVariable('types')" href="../../_variables/types.html">$types</a>       = array();
<a name="l6894"><span class="linenum">6894</span></a>          <a class="var it41643" onMouseOver="hilite(41643)" onMouseOut="lolite()" onClick="logVariable('sqltypes')" href="../../_variables/sqltypes.html">$sqltypes</a>    = array();
<a name="l6895"><span class="linenum">6895</span></a>          <a class="var it41644" onMouseOver="hilite(41644)" onMouseOut="lolite()" onClick="logVariable('forum_types_all')" href="../../_variables/forum_types_all.html">$forum_types_all</a> = <a class="function" onClick="logFunction('forum_get_forum_types_all')" href="../../_functions/forum_get_forum_types_all.html" onMouseOver="funcPopup(event,'forum_get_forum_types_all')">forum_get_forum_types_all</a>();
<a name="l6896"><span class="linenum">6896</span></a>          foreach (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_forum_types')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_forum_types.html">reset_forum_types</a> as <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l6897"><span class="linenum">6897</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>, <a class="var it41644" onMouseOver="hilite(41644)" onMouseOut="lolite()" onClick="logVariable('forum_types_all')" href="../../_variables/forum_types_all.html">$forum_types_all</a>)) {
<a name="l6898"><span class="linenum">6898</span></a>                  continue;
<a name="l6899"><span class="linenum">6899</span></a>              }
<a name="l6900"><span class="linenum">6900</span></a>              <a class="var it1455" onMouseOver="hilite(1455)" onMouseOut="lolite()" onClick="logVariable('types')" href="../../_variables/types.html">$types</a>[] = <a class="var it41644" onMouseOver="hilite(41644)" onMouseOut="lolite()" onClick="logVariable('forum_types_all')" href="../../_variables/forum_types_all.html">$forum_types_all</a>[<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>];
<a name="l6901"><span class="linenum">6901</span></a>              <a class="var it41643" onMouseOver="hilite(41643)" onMouseOut="lolite()" onClick="logVariable('sqltypes')" href="../../_variables/sqltypes.html">$sqltypes</a>[] = <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>;
<a name="l6902"><span class="linenum">6902</span></a>          }
<a name="l6903"><span class="linenum">6903</span></a>          if (!empty(<a class="var it41643" onMouseOver="hilite(41643)" onMouseOut="lolite()" onClick="logVariable('sqltypes')" href="../../_variables/sqltypes.html">$sqltypes</a>)) {
<a name="l6904"><span class="linenum">6904</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it32814" onMouseOver="hilite(32814)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../../_variables/typesql.html">$typesql</a>, <a class="var it19649" onMouseOver="hilite(19649)" onMouseOut="lolite()" onClick="logVariable('typeparams')" href="../../_variables/typeparams.html">$typeparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it41643" onMouseOver="hilite(41643)" onMouseOut="lolite()" onClick="logVariable('sqltypes')" href="../../_variables/sqltypes.html">$sqltypes</a>);
<a name="l6905"><span class="linenum">6905</span></a>              <a class="var it32814" onMouseOver="hilite(32814)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../../_variables/typesql.html">$typesql</a> = &quot; AND f.type &quot; . <a class="var it32814" onMouseOver="hilite(32814)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../../_variables/typesql.html">$typesql</a>;
<a name="l6906"><span class="linenum">6906</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it19649" onMouseOver="hilite(19649)" onMouseOut="lolite()" onClick="logVariable('typeparams')" href="../../_variables/typeparams.html">$typeparams</a>);
<a name="l6907"><span class="linenum">6907</span></a>          }
<a name="l6908"><span class="linenum">6908</span></a>          <a class="var it41641" onMouseOver="hilite(41641)" onMouseOut="lolite()" onClick="logVariable('typesstr')" href="../../_variables/typesstr.html">$typesstr</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resetforums', 'forum').': '.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it1455" onMouseOver="hilite(1455)" onMouseOut="lolite()" onClick="logVariable('types')" href="../../_variables/types.html">$types</a>);
<a name="l6909"><span class="linenum">6909</span></a>      }
<a name="l6910"><span class="linenum">6910</span></a>      <a class="var it41645" onMouseOver="hilite(41645)" onMouseOut="lolite()" onClick="logVariable('alldiscussionssql')" href="../../_variables/alldiscussionssql.html">$alldiscussionssql</a> = &quot;SELECT fd.id
<a name="l6911"><span class="linenum">6911</span></a>                              FROM {forum_discussions} fd, {forum} f
<a name="l6912"><span class="linenum">6912</span></a>                             WHERE f.course=? AND f.id=fd.forum&quot;;
<a name="l6913"><span class="linenum">6913</span></a>  
<a name="l6914"><span class="linenum">6914</span></a>      <a class="var it41646" onMouseOver="hilite(41646)" onMouseOut="lolite()" onClick="logVariable('allforumssql')" href="../../_variables/allforumssql.html">$allforumssql</a>      = &quot;SELECT f.id
<a name="l6915"><span class="linenum">6915</span></a>                              FROM {forum} f
<a name="l6916"><span class="linenum">6916</span></a>                             WHERE f.course=?&quot;;
<a name="l6917"><span class="linenum">6917</span></a>  
<a name="l6918"><span class="linenum">6918</span></a>      <a class="var it41647" onMouseOver="hilite(41647)" onMouseOut="lolite()" onClick="logVariable('allpostssql')" href="../../_variables/allpostssql.html">$allpostssql</a>       = &quot;SELECT fp.id
<a name="l6919"><span class="linenum">6919</span></a>                              FROM {forum_posts} fp, {forum_discussions} fd, {forum} f
<a name="l6920"><span class="linenum">6920</span></a>                             WHERE f.course=? AND f.id=fd.forum AND fd.id=fp.discussion&quot;;
<a name="l6921"><span class="linenum">6921</span></a>  
<a name="l6922"><span class="linenum">6922</span></a>      <a class="var it41648" onMouseOver="hilite(41648)" onMouseOut="lolite()" onClick="logVariable('forumssql')" href="../../_variables/forumssql.html">$forumssql</a> = <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> = <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a> = null;
<a name="l6923"><span class="linenum">6923</span></a>  
<a name="l6924"><span class="linenum">6924</span></a>      if( <a class="var it41639" onMouseOver="hilite(41639)" onMouseOut="lolite()" onClick="logVariable('removeposts')" href="../../_variables/removeposts.html">$removeposts</a> || !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_forum_ratings')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_forum_ratings.html">reset_forum_ratings</a>) ) {
<a name="l6925"><span class="linenum">6925</span></a>          <a class="var it41648" onMouseOver="hilite(41648)" onMouseOut="lolite()" onClick="logVariable('forumssql')" href="../../_variables/forumssql.html">$forumssql</a>      = &quot;<a class="var it41646" onMouseOver="hilite(41646)" onMouseOut="lolite()" onClick="logVariable('allforumssql')" href="../../_variables/allforumssql.html">$allforumssql</a> <a class="var it32814" onMouseOver="hilite(32814)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../../_variables/typesql.html">$typesql</a>&quot;;
<a name="l6926"><span class="linenum">6926</span></a>          <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> = <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it41648" onMouseOver="hilite(41648)" onMouseOut="lolite()" onClick="logVariable('forumssql')" href="../../_variables/forumssql.html">$forumssql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l6927"><span class="linenum">6927</span></a>          <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a> = <span class="keyword">new </span><a class="class" onClick="logClass('rating_manager')" href="../../_classes/rating_manager.html" onMouseOver="classPopup(event,'rating_manager')">rating_manager</a>();
<a name="l6928"><span class="linenum">6928</span></a>          <a class="var it12674" onMouseOver="hilite(12674)" onMouseOut="lolite()" onClick="logVariable('ratingdeloptions')" href="../../_variables/ratingdeloptions.html">$ratingdeloptions</a> = new stdClass;
<a name="l6929"><span class="linenum">6929</span></a>          <a class="var it12674" onMouseOver="hilite(12674)" onMouseOut="lolite()" onClick="logVariable('ratingdeloptions')" href="../../_variables/ratingdeloptions.html">$ratingdeloptions</a>-&gt;<a onClick="logVariable('component')" class="var it44555" onMouseOver="hilite(44555)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = 'mod_forum';
<a name="l6930"><span class="linenum">6930</span></a>          <a class="var it12674" onMouseOver="hilite(12674)" onMouseOut="lolite()" onClick="logVariable('ratingdeloptions')" href="../../_variables/ratingdeloptions.html">$ratingdeloptions</a>-&gt;<a onClick="logVariable('ratingarea')" class="var it44555" onMouseOver="hilite(44555)" onMouseOut="lolite()" href="../../_variables/ratingarea.html">ratingarea</a> = 'post';
<a name="l6931"><span class="linenum">6931</span></a>      }
<a name="l6932"><span class="linenum">6932</span></a>  
<a name="l6933"><span class="linenum">6933</span></a>      if (<a class="var it41639" onMouseOver="hilite(41639)" onMouseOut="lolite()" onClick="logVariable('removeposts')" href="../../_variables/removeposts.html">$removeposts</a>) {
<a name="l6934"><span class="linenum">6934</span></a>          <a class="var it41650" onMouseOver="hilite(41650)" onMouseOut="lolite()" onClick="logVariable('discussionssql')" href="../../_variables/discussionssql.html">$discussionssql</a> = &quot;<a class="var it41645" onMouseOver="hilite(41645)" onMouseOut="lolite()" onClick="logVariable('alldiscussionssql')" href="../../_variables/alldiscussionssql.html">$alldiscussionssql</a> <a class="var it32814" onMouseOver="hilite(32814)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../../_variables/typesql.html">$typesql</a>&quot;;
<a name="l6935"><span class="linenum">6935</span></a>          <a class="var it41651" onMouseOver="hilite(41651)" onMouseOut="lolite()" onClick="logVariable('postssql')" href="../../_variables/postssql.html">$postssql</a>       = &quot;<a class="var it41647" onMouseOver="hilite(41647)" onMouseOut="lolite()" onClick="logVariable('allpostssql')" href="../../_variables/allpostssql.html">$allpostssql</a> <a class="var it32814" onMouseOver="hilite(32814)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../../_variables/typesql.html">$typesql</a>&quot;;
<a name="l6936"><span class="linenum">6936</span></a>  
<a name="l6937"><span class="linenum">6937</span></a>  <span class="comment">        // now get rid of all attachments</span>
<a name="l6938"><span class="linenum">6938</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l6939"><span class="linenum">6939</span></a>          if (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>) {
<a name="l6940"><span class="linenum">6940</span></a>              foreach (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> as <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>=&gt;<a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>) {
<a name="l6941"><span class="linenum">6941</span></a>                  if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>)) {
<a name="l6942"><span class="linenum">6942</span></a>                      continue;
<a name="l6943"><span class="linenum">6943</span></a>                  }
<a name="l6944"><span class="linenum">6944</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l6945"><span class="linenum">6945</span></a>                  <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'attachment');
<a name="l6946"><span class="linenum">6946</span></a>                  <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_forum', 'post');
<a name="l6947"><span class="linenum">6947</span></a>  
<a name="l6948"><span class="linenum">6948</span></a>  <span class="comment">                //remove ratings</span>
<a name="l6949"><span class="linenum">6949</span></a>                  <a class="var it12674" onMouseOver="hilite(12674)" onMouseOut="lolite()" onClick="logVariable('ratingdeloptions')" href="../../_variables/ratingdeloptions.html">$ratingdeloptions</a>-&gt;<a onClick="logVariable('contextid')" class="var it44555" onMouseOver="hilite(44555)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l6950"><span class="linenum">6950</span></a>                  <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a>-&gt;<a class="function" onClick="logFunction('delete_ratings')" href="../../_functions/delete_ratings.html" onMouseOver="funcPopup(event,'delete_ratings')">delete_ratings</a>(<a class="var it12674" onMouseOver="hilite(12674)" onMouseOut="lolite()" onClick="logVariable('ratingdeloptions')" href="../../_variables/ratingdeloptions.html">$ratingdeloptions</a>);
<a name="l6951"><span class="linenum">6951</span></a>              }
<a name="l6952"><span class="linenum">6952</span></a>          }
<a name="l6953"><span class="linenum">6953</span></a>  
<a name="l6954"><span class="linenum">6954</span></a>  <span class="comment">        // first delete all read flags</span>
<a name="l6955"><span class="linenum">6955</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_read', &quot;forumid IN (<a class="var it41648" onMouseOver="hilite(41648)" onMouseOut="lolite()" onClick="logVariable('forumssql')" href="../../_variables/forumssql.html">$forumssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l6956"><span class="linenum">6956</span></a>  
<a name="l6957"><span class="linenum">6957</span></a>  <span class="comment">        // remove tracking prefs</span>
<a name="l6958"><span class="linenum">6958</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_track_prefs', &quot;forumid IN (<a class="var it41648" onMouseOver="hilite(41648)" onMouseOut="lolite()" onClick="logVariable('forumssql')" href="../../_variables/forumssql.html">$forumssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l6959"><span class="linenum">6959</span></a>  
<a name="l6960"><span class="linenum">6960</span></a>  <span class="comment">        // remove posts from queue</span>
<a name="l6961"><span class="linenum">6961</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_queue', &quot;discussionid IN (<a class="var it41650" onMouseOver="hilite(41650)" onMouseOut="lolite()" onClick="logVariable('discussionssql')" href="../../_variables/discussionssql.html">$discussionssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l6962"><span class="linenum">6962</span></a>  
<a name="l6963"><span class="linenum">6963</span></a>  <span class="comment">        // all posts - initial posts must be kept in single simple discussion forums</span>
<a name="l6964"><span class="linenum">6964</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_posts', &quot;discussion IN (<a class="var it41650" onMouseOver="hilite(41650)" onMouseOut="lolite()" onClick="logVariable('discussionssql')" href="../../_variables/discussionssql.html">$discussionssql</a>) AND parent &lt;&gt; 0&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>); <span class="comment">// first all children</span>
<a name="l6965"><span class="linenum">6965</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_posts', &quot;discussion IN (<a class="var it41650" onMouseOver="hilite(41650)" onMouseOut="lolite()" onClick="logVariable('discussionssql')" href="../../_variables/discussionssql.html">$discussionssql</a> AND f.type &lt;&gt; 'single') AND parent = 0&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>); <span class="comment">// now the initial posts for non single simple</span>
<a name="l6966"><span class="linenum">6966</span></a>  
<a name="l6967"><span class="linenum">6967</span></a>  <span class="comment">        // finally all discussions except single simple forums</span>
<a name="l6968"><span class="linenum">6968</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_discussions', &quot;forum IN (<a class="var it41648" onMouseOver="hilite(41648)" onMouseOut="lolite()" onClick="logVariable('forumssql')" href="../../_variables/forumssql.html">$forumssql</a> AND f.type &lt;&gt; 'single')&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l6969"><span class="linenum">6969</span></a>  
<a name="l6970"><span class="linenum">6970</span></a>  <span class="comment">        // remove all grades from gradebook</span>
<a name="l6971"><span class="linenum">6971</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_gradebook_grades')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_gradebook_grades.html">reset_gradebook_grades</a>)) {
<a name="l6972"><span class="linenum">6972</span></a>              if (empty(<a class="var it1455" onMouseOver="hilite(1455)" onMouseOut="lolite()" onClick="logVariable('types')" href="../../_variables/types.html">$types</a>)) {
<a name="l6973"><span class="linenum">6973</span></a>                  <a class="function" onClick="logFunction('forum_reset_gradebook')" href="../../_functions/forum_reset_gradebook.html" onMouseOver="funcPopup(event,'forum_reset_gradebook')">forum_reset_gradebook</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l6974"><span class="linenum">6974</span></a>              } else {
<a name="l6975"><span class="linenum">6975</span></a>                  foreach (<a class="var it1455" onMouseOver="hilite(1455)" onMouseOut="lolite()" onClick="logVariable('types')" href="../../_variables/types.html">$types</a> as <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l6976"><span class="linenum">6976</span></a>                      <a class="function" onClick="logFunction('forum_reset_gradebook')" href="../../_functions/forum_reset_gradebook.html" onMouseOver="funcPopup(event,'forum_reset_gradebook')">forum_reset_gradebook</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>);
<a name="l6977"><span class="linenum">6977</span></a>                  }
<a name="l6978"><span class="linenum">6978</span></a>              }
<a name="l6979"><span class="linenum">6979</span></a>          }
<a name="l6980"><span class="linenum">6980</span></a>  
<a name="l6981"><span class="linenum">6981</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component'=&gt;<a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item'=&gt;<a class="var it41641" onMouseOver="hilite(41641)" onMouseOut="lolite()" onClick="logVariable('typesstr')" href="../../_variables/typesstr.html">$typesstr</a>, 'error'=&gt;false);
<a name="l6982"><span class="linenum">6982</span></a>      }
<a name="l6983"><span class="linenum">6983</span></a>  
<a name="l6984"><span class="linenum">6984</span></a>  <span class="comment">    // remove all ratings in this course's forums</span>
<a name="l6985"><span class="linenum">6985</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_forum_ratings')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_forum_ratings.html">reset_forum_ratings</a>)) {
<a name="l6986"><span class="linenum">6986</span></a>          if (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>) {
<a name="l6987"><span class="linenum">6987</span></a>              foreach (<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> as <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>=&gt;<a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>) {
<a name="l6988"><span class="linenum">6988</span></a>                  if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>)) {
<a name="l6989"><span class="linenum">6989</span></a>                      continue;
<a name="l6990"><span class="linenum">6990</span></a>                  }
<a name="l6991"><span class="linenum">6991</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l6992"><span class="linenum">6992</span></a>  
<a name="l6993"><span class="linenum">6993</span></a>  <span class="comment">                //remove ratings</span>
<a name="l6994"><span class="linenum">6994</span></a>                  <a class="var it12674" onMouseOver="hilite(12674)" onMouseOut="lolite()" onClick="logVariable('ratingdeloptions')" href="../../_variables/ratingdeloptions.html">$ratingdeloptions</a>-&gt;<a onClick="logVariable('contextid')" class="var it44555" onMouseOver="hilite(44555)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l6995"><span class="linenum">6995</span></a>                  <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../../_variables/rm.html">$rm</a>-&gt;<a class="function" onClick="logFunction('delete_ratings')" href="../../_functions/delete_ratings.html" onMouseOver="funcPopup(event,'delete_ratings')">delete_ratings</a>(<a class="var it12674" onMouseOver="hilite(12674)" onMouseOut="lolite()" onClick="logVariable('ratingdeloptions')" href="../../_variables/ratingdeloptions.html">$ratingdeloptions</a>);
<a name="l6996"><span class="linenum">6996</span></a>              }
<a name="l6997"><span class="linenum">6997</span></a>          }
<a name="l6998"><span class="linenum">6998</span></a>  
<a name="l6999"><span class="linenum">6999</span></a>  <span class="comment">        // remove all grades from gradebook</span>
<a name="l7000"><span class="linenum">7000</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_gradebook_grades')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_gradebook_grades.html">reset_gradebook_grades</a>)) {
<a name="l7001"><span class="linenum">7001</span></a>              <a class="function" onClick="logFunction('forum_reset_gradebook')" href="../../_functions/forum_reset_gradebook.html" onMouseOver="funcPopup(event,'forum_reset_gradebook')">forum_reset_gradebook</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l7002"><span class="linenum">7002</span></a>          }
<a name="l7003"><span class="linenum">7003</span></a>      }
<a name="l7004"><span class="linenum">7004</span></a>  
<a name="l7005"><span class="linenum">7005</span></a>  <span class="comment">    // remove all digest settings unconditionally - even for users still enrolled in course.</span>
<a name="l7006"><span class="linenum">7006</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_forum_digests')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_forum_digests.html">reset_forum_digests</a>)) {
<a name="l7007"><span class="linenum">7007</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_digests', &quot;forum IN (<a class="var it41646" onMouseOver="hilite(41646)" onMouseOut="lolite()" onClick="logVariable('allforumssql')" href="../../_variables/allforumssql.html">$allforumssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l7008"><span class="linenum">7008</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component' =&gt; <a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resetdigests', 'forum'), 'error' =&gt; false);
<a name="l7009"><span class="linenum">7009</span></a>      }
<a name="l7010"><span class="linenum">7010</span></a>  
<a name="l7011"><span class="linenum">7011</span></a>  <span class="comment">    // remove all subscriptions unconditionally - even for users still enrolled in course</span>
<a name="l7012"><span class="linenum">7012</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_forum_subscriptions')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_forum_subscriptions.html">reset_forum_subscriptions</a>)) {
<a name="l7013"><span class="linenum">7013</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_subscriptions', &quot;forum IN (<a class="var it41646" onMouseOver="hilite(41646)" onMouseOut="lolite()" onClick="logVariable('allforumssql')" href="../../_variables/allforumssql.html">$allforumssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l7014"><span class="linenum">7014</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_discussion_subs', &quot;forum IN (<a class="var it41646" onMouseOver="hilite(41646)" onMouseOut="lolite()" onClick="logVariable('allforumssql')" href="../../_variables/allforumssql.html">$allforumssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l7015"><span class="linenum">7015</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component' =&gt; <a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resetsubscriptions', 'forum'), 'error' =&gt; false);
<a name="l7016"><span class="linenum">7016</span></a>      }
<a name="l7017"><span class="linenum">7017</span></a>  
<a name="l7018"><span class="linenum">7018</span></a>  <span class="comment">    // remove all tracking prefs unconditionally - even for users still enrolled in course</span>
<a name="l7019"><span class="linenum">7019</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_forum_track_prefs')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_forum_track_prefs.html">reset_forum_track_prefs</a>)) {
<a name="l7020"><span class="linenum">7020</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_track_prefs', &quot;forumid IN (<a class="var it41646" onMouseOver="hilite(41646)" onMouseOut="lolite()" onClick="logVariable('allforumssql')" href="../../_variables/allforumssql.html">$allforumssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l7021"><span class="linenum">7021</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component'=&gt;<a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resettrackprefs','forum'), 'error'=&gt;false);
<a name="l7022"><span class="linenum">7022</span></a>      }
<a name="l7023"><span class="linenum">7023</span></a>  
<a name="l7024"><span class="linenum">7024</span></a>  <span class="comment">    /// updating dates - shift may be negative too</span>
<a name="l7025"><span class="linenum">7025</span></a>      if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>) {
<a name="l7026"><span class="linenum">7026</span></a>          <a class="function" onClick="logFunction('shift_course_mod_dates')" href="../../_functions/shift_course_mod_dates.html" onMouseOver="funcPopup(event,'shift_course_mod_dates')">shift_course_mod_dates</a>('forum', array('assesstimestart', 'assesstimefinish'), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l7027"><span class="linenum">7027</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component'=&gt;<a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('datechanged'), 'error'=&gt;false);
<a name="l7028"><span class="linenum">7028</span></a>      }
<a name="l7029"><span class="linenum">7029</span></a>  
<a name="l7030"><span class="linenum">7030</span></a>      return <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>;
<a name="l7031"><span class="linenum">7031</span></a>  }
<a name="l7032"><span class="linenum">7032</span></a>  
<a name="l7033"><span class="linenum">7033</span></a>  <span class="comment">/**</span>
<a name="l7034"><span class="linenum">7034</span></a>  <span class="comment"> * Called by course/reset.php</span>
<a name="l7035"><span class="linenum">7035</span></a>  <span class="comment"> *</span>
<a name="l7036"><span class="linenum">7036</span></a>  <span class="comment"> * @param $mform form passed by reference</span>
<a name="l7037"><span class="linenum">7037</span></a>  <span class="comment"> */</span>
<a name="l7038"><span class="linenum">7038</span></a>  function <a class="function" onClick="logFunction('forum_reset_course_form_definition')" href="../../_functions/forum_reset_course_form_definition.html" onMouseOver="funcPopup(event,'forum_reset_course_form_definition')">forum_reset_course_form_definition</a>(&amp;<a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l7039"><span class="linenum">7039</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('header', 'forumheader', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulenameplural', 'forum'));
<a name="l7040"><span class="linenum">7040</span></a>  
<a name="l7041"><span class="linenum">7041</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('checkbox', 'reset_forum_all', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resetforumsall','forum'));
<a name="l7042"><span class="linenum">7042</span></a>  
<a name="l7043"><span class="linenum">7043</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('select', 'reset_forum_types', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resetforums', 'forum'), <a class="function" onClick="logFunction('forum_get_forum_types_all')" href="../../_functions/forum_get_forum_types_all.html" onMouseOver="funcPopup(event,'forum_get_forum_types_all')">forum_get_forum_types_all</a>(), array('multiple' =&gt; 'multiple'));
<a name="l7044"><span class="linenum">7044</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('setAdvanced')" href="../../_functions/setadvanced.html" onMouseOver="funcPopup(event,'setadvanced')">setAdvanced</a>('reset_forum_types');
<a name="l7045"><span class="linenum">7045</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('disabledIf')" href="../../_functions/disabledif.html" onMouseOver="funcPopup(event,'disabledif')">disabledIf</a>('reset_forum_types', 'reset_forum_all', 'checked');
<a name="l7046"><span class="linenum">7046</span></a>  
<a name="l7047"><span class="linenum">7047</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('checkbox', 'reset_forum_digests', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resetdigests','forum'));
<a name="l7048"><span class="linenum">7048</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('setAdvanced')" href="../../_functions/setadvanced.html" onMouseOver="funcPopup(event,'setadvanced')">setAdvanced</a>('reset_forum_digests');
<a name="l7049"><span class="linenum">7049</span></a>  
<a name="l7050"><span class="linenum">7050</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('checkbox', 'reset_forum_subscriptions', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resetsubscriptions','forum'));
<a name="l7051"><span class="linenum">7051</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('setAdvanced')" href="../../_functions/setadvanced.html" onMouseOver="funcPopup(event,'setadvanced')">setAdvanced</a>('reset_forum_subscriptions');
<a name="l7052"><span class="linenum">7052</span></a>  
<a name="l7053"><span class="linenum">7053</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('checkbox', 'reset_forum_track_prefs', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('resettrackprefs','forum'));
<a name="l7054"><span class="linenum">7054</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('setAdvanced')" href="../../_functions/setadvanced.html" onMouseOver="funcPopup(event,'setadvanced')">setAdvanced</a>('reset_forum_track_prefs');
<a name="l7055"><span class="linenum">7055</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('disabledIf')" href="../../_functions/disabledif.html" onMouseOver="funcPopup(event,'disabledif')">disabledIf</a>('reset_forum_track_prefs', 'reset_forum_all', 'checked');
<a name="l7056"><span class="linenum">7056</span></a>  
<a name="l7057"><span class="linenum">7057</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('checkbox', 'reset_forum_ratings', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('deleteallratings'));
<a name="l7058"><span class="linenum">7058</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('disabledIf')" href="../../_functions/disabledif.html" onMouseOver="funcPopup(event,'disabledif')">disabledIf</a>('reset_forum_ratings', 'reset_forum_all', 'checked');
<a name="l7059"><span class="linenum">7059</span></a>  }
<a name="l7060"><span class="linenum">7060</span></a>  
<a name="l7061"><span class="linenum">7061</span></a>  <span class="comment">/**</span>
<a name="l7062"><span class="linenum">7062</span></a>  <span class="comment"> * Course reset form defaults.</span>
<a name="l7063"><span class="linenum">7063</span></a>  <span class="comment"> * @return array</span>
<a name="l7064"><span class="linenum">7064</span></a>  <span class="comment"> */</span>
<a name="l7065"><span class="linenum">7065</span></a>  function <a class="function" onClick="logFunction('forum_reset_course_form_defaults')" href="../../_functions/forum_reset_course_form_defaults.html" onMouseOver="funcPopup(event,'forum_reset_course_form_defaults')">forum_reset_course_form_defaults</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l7066"><span class="linenum">7066</span></a>      return array('reset_forum_all'=&gt;1, 'reset_forum_digests' =&gt; 0, 'reset_forum_subscriptions'=&gt;0, 'reset_forum_track_prefs'=&gt;0, 'reset_forum_ratings'=&gt;1);
<a name="l7067"><span class="linenum">7067</span></a>  }
<a name="l7068"><span class="linenum">7068</span></a>  
<a name="l7069"><span class="linenum">7069</span></a>  <span class="comment">/**</span>
<a name="l7070"><span class="linenum">7070</span></a>  <span class="comment"> * Returns array of forum layout modes</span>
<a name="l7071"><span class="linenum">7071</span></a>  <span class="comment"> *</span>
<a name="l7072"><span class="linenum">7072</span></a>  <span class="comment"> * @return array</span>
<a name="l7073"><span class="linenum">7073</span></a>  <span class="comment"> */</span>
<a name="l7074"><span class="linenum">7074</span></a>  function <a class="function" onClick="logFunction('forum_get_layout_modes')" href="../../_functions/forum_get_layout_modes.html" onMouseOver="funcPopup(event,'forum_get_layout_modes')">forum_get_layout_modes</a>() {
<a name="l7075"><span class="linenum">7075</span></a>      return array (<a class="constant" onClick="logConstant('FORUM_MODE_FLATOLDEST')" href="../../_constants/FORUM_MODE_FLATOLDEST.html" onMouseOver="constPopup(event,'FORUM_MODE_FLATOLDEST')">FORUM_MODE_FLATOLDEST</a> =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modeflatoldestfirst', 'forum'),
<a name="l7076"><span class="linenum">7076</span></a>                    <a class="constant" onClick="logConstant('FORUM_MODE_FLATNEWEST')" href="../../_constants/FORUM_MODE_FLATNEWEST.html" onMouseOver="constPopup(event,'FORUM_MODE_FLATNEWEST')">FORUM_MODE_FLATNEWEST</a> =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modeflatnewestfirst', 'forum'),
<a name="l7077"><span class="linenum">7077</span></a>                    <a class="constant" onClick="logConstant('FORUM_MODE_THREADED')" href="../../_constants/FORUM_MODE_THREADED.html" onMouseOver="constPopup(event,'FORUM_MODE_THREADED')">FORUM_MODE_THREADED</a>   =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modethreaded', 'forum'),
<a name="l7078"><span class="linenum">7078</span></a>                    <a class="constant" onClick="logConstant('FORUM_MODE_NESTED')" href="../../_constants/FORUM_MODE_NESTED.html" onMouseOver="constPopup(event,'FORUM_MODE_NESTED')">FORUM_MODE_NESTED</a>     =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modenested', 'forum'));
<a name="l7079"><span class="linenum">7079</span></a>  }
<a name="l7080"><span class="linenum">7080</span></a>  
<a name="l7081"><span class="linenum">7081</span></a>  <span class="comment">/**</span>
<a name="l7082"><span class="linenum">7082</span></a>  <span class="comment"> * Returns array of forum types chooseable on the forum editing form</span>
<a name="l7083"><span class="linenum">7083</span></a>  <span class="comment"> *</span>
<a name="l7084"><span class="linenum">7084</span></a>  <span class="comment"> * @return array</span>
<a name="l7085"><span class="linenum">7085</span></a>  <span class="comment"> */</span>
<a name="l7086"><span class="linenum">7086</span></a>  function <a class="function" onClick="logFunction('forum_get_forum_types')" href="../../_functions/forum_get_forum_types.html" onMouseOver="funcPopup(event,'forum_get_forum_types')">forum_get_forum_types</a>() {
<a name="l7087"><span class="linenum">7087</span></a>      return array ('general'  =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('generalforum', 'forum'),
<a name="l7088"><span class="linenum">7088</span></a>                    'eachuser' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('eachuserforum', 'forum'),
<a name="l7089"><span class="linenum">7089</span></a>                    'single'   =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('singleforum', 'forum'),
<a name="l7090"><span class="linenum">7090</span></a>                    'qanda'    =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('qandaforum', 'forum'),
<a name="l7091"><span class="linenum">7091</span></a>                    'blog'     =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('blogforum', 'forum'));
<a name="l7092"><span class="linenum">7092</span></a>  }
<a name="l7093"><span class="linenum">7093</span></a>  
<a name="l7094"><span class="linenum">7094</span></a>  <span class="comment">/**</span>
<a name="l7095"><span class="linenum">7095</span></a>  <span class="comment"> * Returns array of all forum layout modes</span>
<a name="l7096"><span class="linenum">7096</span></a>  <span class="comment"> *</span>
<a name="l7097"><span class="linenum">7097</span></a>  <span class="comment"> * @return array</span>
<a name="l7098"><span class="linenum">7098</span></a>  <span class="comment"> */</span>
<a name="l7099"><span class="linenum">7099</span></a>  function <a class="function" onClick="logFunction('forum_get_forum_types_all')" href="../../_functions/forum_get_forum_types_all.html" onMouseOver="funcPopup(event,'forum_get_forum_types_all')">forum_get_forum_types_all</a>() {
<a name="l7100"><span class="linenum">7100</span></a>      return array ('news'     =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('namenews','forum'),
<a name="l7101"><span class="linenum">7101</span></a>                    'social'   =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('namesocial','forum'),
<a name="l7102"><span class="linenum">7102</span></a>                    'general'  =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('generalforum', 'forum'),
<a name="l7103"><span class="linenum">7103</span></a>                    'eachuser' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('eachuserforum', 'forum'),
<a name="l7104"><span class="linenum">7104</span></a>                    'single'   =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('singleforum', 'forum'),
<a name="l7105"><span class="linenum">7105</span></a>                    'qanda'    =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('qandaforum', 'forum'),
<a name="l7106"><span class="linenum">7106</span></a>                    'blog'     =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('blogforum', 'forum'));
<a name="l7107"><span class="linenum">7107</span></a>  }
<a name="l7108"><span class="linenum">7108</span></a>  
<a name="l7109"><span class="linenum">7109</span></a>  <span class="comment">/**</span>
<a name="l7110"><span class="linenum">7110</span></a>  <span class="comment"> * Returns all other caps used in module</span>
<a name="l7111"><span class="linenum">7111</span></a>  <span class="comment"> *</span>
<a name="l7112"><span class="linenum">7112</span></a>  <span class="comment"> * @return array</span>
<a name="l7113"><span class="linenum">7113</span></a>  <span class="comment"> */</span>
<a name="l7114"><span class="linenum">7114</span></a>  function <a class="function" onClick="logFunction('forum_get_extra_capabilities')" href="../../_functions/forum_get_extra_capabilities.html" onMouseOver="funcPopup(event,'forum_get_extra_capabilities')">forum_get_extra_capabilities</a>() {
<a name="l7115"><span class="linenum">7115</span></a>      return array('moodle/site:accessallgroups', 'moodle/site:viewfullnames', 'moodle/site:trustcontent', 'moodle/rating:view', 'moodle/rating:viewany', 'moodle/rating:viewall', 'moodle/rating:rate');
<a name="l7116"><span class="linenum">7116</span></a>  }
<a name="l7117"><span class="linenum">7117</span></a>  
<a name="l7118"><span class="linenum">7118</span></a>  <span class="comment">/**</span>
<a name="l7119"><span class="linenum">7119</span></a>  <span class="comment"> * Adds module specific settings to the settings block</span>
<a name="l7120"><span class="linenum">7120</span></a>  <span class="comment"> *</span>
<a name="l7121"><span class="linenum">7121</span></a>  <span class="comment"> * @param settings_navigation $settings The settings navigation object</span>
<a name="l7122"><span class="linenum">7122</span></a>  <span class="comment"> * @param navigation_node $forumnode The node to add module settings to</span>
<a name="l7123"><span class="linenum">7123</span></a>  <span class="comment"> */</span>
<a name="l7124"><span class="linenum">7124</span></a>  function <a class="function" onClick="logFunction('forum_extend_settings_navigation')" href="../../_functions/forum_extend_settings_navigation.html" onMouseOver="funcPopup(event,'forum_extend_settings_navigation')">forum_extend_settings_navigation</a>(settings_navigation <a class="var it5557" onMouseOver="hilite(5557)" onMouseOut="lolite()" onClick="logVariable('settingsnav')" href="../../_variables/settingsnav.html">$settingsnav</a>, navigation_node <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>) {
<a name="l7125"><span class="linenum">7125</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l7126"><span class="linenum">7126</span></a>  
<a name="l7127"><span class="linenum">7127</span></a>      <a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(&quot;forum&quot;, array(&quot;id&quot; =&gt; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;instance));
<a name="l7128"><span class="linenum">7128</span></a>      if (empty(<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l7129"><span class="linenum">7129</span></a>          <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;instance);
<a name="l7130"><span class="linenum">7130</span></a>      }
<a name="l7131"><span class="linenum">7131</span></a>  
<a name="l7132"><span class="linenum">7132</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/url.html">url</a>-&gt;<a class="function" onClick="logFunction('params')" href="../../_functions/params.html" onMouseOver="funcPopup(event,'params')">params</a>();
<a name="l7133"><span class="linenum">7133</span></a>      if (!empty(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['d'])) {
<a name="l7134"><span class="linenum">7134</span></a>          <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a> = <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['d'];
<a name="l7135"><span class="linenum">7135</span></a>      }
<a name="l7136"><span class="linenum">7136</span></a>  
<a name="l7137"><span class="linenum">7137</span></a>  <span class="comment">    // for some actions you need to be enrolled, beiing admin is not enough sometimes here</span>
<a name="l7138"><span class="linenum">7138</span></a>      <a class="var it30774" onMouseOver="hilite(30774)" onMouseOut="lolite()" onClick="logVariable('enrolled')" href="../../_variables/enrolled.html">$enrolled</a> = <a class="function" onClick="logFunction('is_enrolled')" href="../../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, '', false);
<a name="l7139"><span class="linenum">7139</span></a>      <a class="var it41656" onMouseOver="hilite(41656)" onMouseOut="lolite()" onClick="logVariable('activeenrolled')" href="../../_variables/activeenrolled.html">$activeenrolled</a> = <a class="function" onClick="logFunction('is_enrolled')" href="../../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, '', true);
<a name="l7140"><span class="linenum">7140</span></a>  
<a name="l7141"><span class="linenum">7141</span></a>      <a class="var it1205" onMouseOver="hilite(1205)" onMouseOut="lolite()" onClick="logVariable('canmanage')" href="../../_variables/canmanage.html">$canmanage</a>  = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:managesubscriptions', <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context);
<a name="l7142"><span class="linenum">7142</span></a>      <a class="var it41657" onMouseOver="hilite(41657)" onMouseOut="lolite()" onClick="logVariable('subscriptionmode')" href="../../_variables/subscriptionmode.html">$subscriptionmode</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('get_subscription_mode')" href="../../_functions/get_subscription_mode.html" onMouseOver="funcPopup(event,'get_subscription_mode')">get_subscription_mode</a>(<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>);
<a name="l7143"><span class="linenum">7143</span></a>      <a class="var it41658" onMouseOver="hilite(41658)" onMouseOut="lolite()" onClick="logVariable('cansubscribe')" href="../../_variables/cansubscribe.html">$cansubscribe</a> = <a class="var it41656" onMouseOver="hilite(41656)" onMouseOut="lolite()" onClick="logVariable('activeenrolled')" href="../../_variables/activeenrolled.html">$activeenrolled</a> &amp;&amp; !\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_forcesubscribed')" href="../../_functions/is_forcesubscribed.html" onMouseOver="funcPopup(event,'is_forcesubscribed')">is_forcesubscribed</a>(<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>) &amp;&amp;
<a name="l7144"><span class="linenum">7144</span></a>              (!\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('subscription_disabled')" href="../../_functions/subscription_disabled.html" onMouseOver="funcPopup(event,'subscription_disabled')">subscription_disabled</a>(<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>) || <a class="var it1205" onMouseOver="hilite(1205)" onMouseOut="lolite()" onClick="logVariable('canmanage')" href="../../_variables/canmanage.html">$canmanage</a>);
<a name="l7145"><span class="linenum">7145</span></a>  
<a name="l7146"><span class="linenum">7146</span></a>      if (<a class="var it1205" onMouseOver="hilite(1205)" onMouseOut="lolite()" onClick="logVariable('canmanage')" href="../../_variables/canmanage.html">$canmanage</a>) {
<a name="l7147"><span class="linenum">7147</span></a>          <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a> = <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscriptionmode', 'forum'), null, <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_CONTAINER);
<a name="l7148"><span class="linenum">7148</span></a>  
<a name="l7149"><span class="linenum">7149</span></a>          <a class="var it41659" onMouseOver="hilite(41659)" onMouseOut="lolite()" onClick="logVariable('allowchoice')" href="../../_variables/allowchoice.html">$allowchoice</a> = <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscriptionoptional', 'forum'), <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/subscribe.php.html">/mod/forum/subscribe.php</a>', array('id'=&gt;<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('id')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mode'=&gt;<a class="constant" onClick="logConstant('FORUM_CHOOSESUBSCRIBE')" href="../../_constants/FORUM_CHOOSESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_CHOOSESUBSCRIBE')">FORUM_CHOOSESUBSCRIBE</a>, 'sesskey'=&gt;<a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>())), <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l7150"><span class="linenum">7150</span></a>          <a class="var it41660" onMouseOver="hilite(41660)" onMouseOut="lolite()" onClick="logVariable('forceforever')" href="../../_variables/forceforever.html">$forceforever</a> = <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;subscriptionforced&quot;, &quot;forum&quot;), <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/subscribe.php.html">/mod/forum/subscribe.php</a>', array('id'=&gt;<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('id')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mode'=&gt;<a class="constant" onClick="logConstant('FORUM_FORCESUBSCRIBE')" href="../../_constants/FORUM_FORCESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_FORCESUBSCRIBE')">FORUM_FORCESUBSCRIBE</a>, 'sesskey'=&gt;<a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>())), <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l7151"><span class="linenum">7151</span></a>          <a class="var it41661" onMouseOver="hilite(41661)" onMouseOut="lolite()" onClick="logVariable('forceinitially')" href="../../_variables/forceinitially.html">$forceinitially</a> = <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;subscriptionauto&quot;, &quot;forum&quot;), <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/subscribe.php.html">/mod/forum/subscribe.php</a>', array('id'=&gt;<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('id')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mode'=&gt;<a class="constant" onClick="logConstant('FORUM_INITIALSUBSCRIBE')" href="../../_constants/FORUM_INITIALSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_INITIALSUBSCRIBE')">FORUM_INITIALSUBSCRIBE</a>, 'sesskey'=&gt;<a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>())), <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l7152"><span class="linenum">7152</span></a>          <a class="var it41662" onMouseOver="hilite(41662)" onMouseOut="lolite()" onClick="logVariable('disallowchoice')" href="../../_variables/disallowchoice.html">$disallowchoice</a> = <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscriptiondisabled', 'forum'), <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/subscribe.php.html">/mod/forum/subscribe.php</a>', array('id'=&gt;<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('id')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mode'=&gt;<a class="constant" onClick="logConstant('FORUM_DISALLOWSUBSCRIBE')" href="../../_constants/FORUM_DISALLOWSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_DISALLOWSUBSCRIBE')">FORUM_DISALLOWSUBSCRIBE</a>, 'sesskey'=&gt;<a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>())), <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l7153"><span class="linenum">7153</span></a>  
<a name="l7154"><span class="linenum">7154</span></a>          switch (<a class="var it41657" onMouseOver="hilite(41657)" onMouseOut="lolite()" onClick="logVariable('subscriptionmode')" href="../../_variables/subscriptionmode.html">$subscriptionmode</a>) {
<a name="l7155"><span class="linenum">7155</span></a>              case <a class="constant" onClick="logConstant('FORUM_CHOOSESUBSCRIBE')" href="../../_constants/FORUM_CHOOSESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_CHOOSESUBSCRIBE')">FORUM_CHOOSESUBSCRIBE</a> : // 0
<a name="l7156"><span class="linenum">7156</span></a>                  <a class="var it41659" onMouseOver="hilite(41659)" onMouseOut="lolite()" onClick="logVariable('allowchoice')" href="../../_variables/allowchoice.html">$allowchoice</a>-&gt;<a onClick="logVariable('action')" class="var it44632" onMouseOver="hilite(44632)" onMouseOut="lolite()" href="../../_variables/action.html">action</a> = null;
<a name="l7157"><span class="linenum">7157</span></a>                  <a class="var it41659" onMouseOver="hilite(41659)" onMouseOut="lolite()" onClick="logVariable('allowchoice')" href="../../_variables/allowchoice.html">$allowchoice</a>-&gt;<a class="function" onClick="logFunction('add_class')" href="../../_functions/add_class.html" onMouseOver="funcPopup(event,'add_class')">add_class</a>('activesetting');
<a name="l7158"><span class="linenum">7158</span></a>                  break;
<a name="l7159"><span class="linenum">7159</span></a>              case <a class="constant" onClick="logConstant('FORUM_FORCESUBSCRIBE')" href="../../_constants/FORUM_FORCESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_FORCESUBSCRIBE')">FORUM_FORCESUBSCRIBE</a> : // 1
<a name="l7160"><span class="linenum">7160</span></a>                  <a class="var it41660" onMouseOver="hilite(41660)" onMouseOut="lolite()" onClick="logVariable('forceforever')" href="../../_variables/forceforever.html">$forceforever</a>-&gt;<a onClick="logVariable('action')" class="var it44633" onMouseOver="hilite(44633)" onMouseOut="lolite()" href="../../_variables/action.html">action</a> = null;
<a name="l7161"><span class="linenum">7161</span></a>                  <a class="var it41660" onMouseOver="hilite(41660)" onMouseOut="lolite()" onClick="logVariable('forceforever')" href="../../_variables/forceforever.html">$forceforever</a>-&gt;<a class="function" onClick="logFunction('add_class')" href="../../_functions/add_class.html" onMouseOver="funcPopup(event,'add_class')">add_class</a>('activesetting');
<a name="l7162"><span class="linenum">7162</span></a>                  break;
<a name="l7163"><span class="linenum">7163</span></a>              case <a class="constant" onClick="logConstant('FORUM_INITIALSUBSCRIBE')" href="../../_constants/FORUM_INITIALSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_INITIALSUBSCRIBE')">FORUM_INITIALSUBSCRIBE</a> : // 2
<a name="l7164"><span class="linenum">7164</span></a>                  <a class="var it41661" onMouseOver="hilite(41661)" onMouseOut="lolite()" onClick="logVariable('forceinitially')" href="../../_variables/forceinitially.html">$forceinitially</a>-&gt;<a onClick="logVariable('action')" class="var it44634" onMouseOver="hilite(44634)" onMouseOut="lolite()" href="../../_variables/action.html">action</a> = null;
<a name="l7165"><span class="linenum">7165</span></a>                  <a class="var it41661" onMouseOver="hilite(41661)" onMouseOut="lolite()" onClick="logVariable('forceinitially')" href="../../_variables/forceinitially.html">$forceinitially</a>-&gt;<a class="function" onClick="logFunction('add_class')" href="../../_functions/add_class.html" onMouseOver="funcPopup(event,'add_class')">add_class</a>('activesetting');
<a name="l7166"><span class="linenum">7166</span></a>                  break;
<a name="l7167"><span class="linenum">7167</span></a>              case <a class="constant" onClick="logConstant('FORUM_DISALLOWSUBSCRIBE')" href="../../_constants/FORUM_DISALLOWSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_DISALLOWSUBSCRIBE')">FORUM_DISALLOWSUBSCRIBE</a> : // 3
<a name="l7168"><span class="linenum">7168</span></a>                  <a class="var it41662" onMouseOver="hilite(41662)" onMouseOut="lolite()" onClick="logVariable('disallowchoice')" href="../../_variables/disallowchoice.html">$disallowchoice</a>-&gt;<a onClick="logVariable('action')" class="var it44635" onMouseOver="hilite(44635)" onMouseOut="lolite()" href="../../_variables/action.html">action</a> = null;
<a name="l7169"><span class="linenum">7169</span></a>                  <a class="var it41662" onMouseOver="hilite(41662)" onMouseOut="lolite()" onClick="logVariable('disallowchoice')" href="../../_variables/disallowchoice.html">$disallowchoice</a>-&gt;<a class="function" onClick="logFunction('add_class')" href="../../_functions/add_class.html" onMouseOver="funcPopup(event,'add_class')">add_class</a>('activesetting');
<a name="l7170"><span class="linenum">7170</span></a>                  break;
<a name="l7171"><span class="linenum">7171</span></a>          }
<a name="l7172"><span class="linenum">7172</span></a>  
<a name="l7173"><span class="linenum">7173</span></a>      } else if (<a class="var it41656" onMouseOver="hilite(41656)" onMouseOut="lolite()" onClick="logVariable('activeenrolled')" href="../../_variables/activeenrolled.html">$activeenrolled</a>) {
<a name="l7174"><span class="linenum">7174</span></a>  
<a name="l7175"><span class="linenum">7175</span></a>          switch (<a class="var it41657" onMouseOver="hilite(41657)" onMouseOut="lolite()" onClick="logVariable('subscriptionmode')" href="../../_variables/subscriptionmode.html">$subscriptionmode</a>) {
<a name="l7176"><span class="linenum">7176</span></a>              case <a class="constant" onClick="logConstant('FORUM_CHOOSESUBSCRIBE')" href="../../_constants/FORUM_CHOOSESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_CHOOSESUBSCRIBE')">FORUM_CHOOSESUBSCRIBE</a> : // 0
<a name="l7177"><span class="linenum">7177</span></a>                  <a class="var it34617" onMouseOver="hilite(34617)" onMouseOut="lolite()" onClick="logVariable('notenode')" href="../../_variables/notenode.html">$notenode</a> = <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscriptionoptional', 'forum'));
<a name="l7178"><span class="linenum">7178</span></a>                  break;
<a name="l7179"><span class="linenum">7179</span></a>              case <a class="constant" onClick="logConstant('FORUM_FORCESUBSCRIBE')" href="../../_constants/FORUM_FORCESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_FORCESUBSCRIBE')">FORUM_FORCESUBSCRIBE</a> : // 1
<a name="l7180"><span class="linenum">7180</span></a>                  <a class="var it34617" onMouseOver="hilite(34617)" onMouseOut="lolite()" onClick="logVariable('notenode')" href="../../_variables/notenode.html">$notenode</a> = <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscriptionforced', 'forum'));
<a name="l7181"><span class="linenum">7181</span></a>                  break;
<a name="l7182"><span class="linenum">7182</span></a>              case <a class="constant" onClick="logConstant('FORUM_INITIALSUBSCRIBE')" href="../../_constants/FORUM_INITIALSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_INITIALSUBSCRIBE')">FORUM_INITIALSUBSCRIBE</a> : // 2
<a name="l7183"><span class="linenum">7183</span></a>                  <a class="var it34617" onMouseOver="hilite(34617)" onMouseOut="lolite()" onClick="logVariable('notenode')" href="../../_variables/notenode.html">$notenode</a> = <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscriptionauto', 'forum'));
<a name="l7184"><span class="linenum">7184</span></a>                  break;
<a name="l7185"><span class="linenum">7185</span></a>              case <a class="constant" onClick="logConstant('FORUM_DISALLOWSUBSCRIBE')" href="../../_constants/FORUM_DISALLOWSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_DISALLOWSUBSCRIBE')">FORUM_DISALLOWSUBSCRIBE</a> : // 3
<a name="l7186"><span class="linenum">7186</span></a>                  <a class="var it34617" onMouseOver="hilite(34617)" onMouseOut="lolite()" onClick="logVariable('notenode')" href="../../_variables/notenode.html">$notenode</a> = <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscriptiondisabled', 'forum'));
<a name="l7187"><span class="linenum">7187</span></a>                  break;
<a name="l7188"><span class="linenum">7188</span></a>          }
<a name="l7189"><span class="linenum">7189</span></a>      }
<a name="l7190"><span class="linenum">7190</span></a>  
<a name="l7191"><span class="linenum">7191</span></a>      if (<a class="var it41658" onMouseOver="hilite(41658)" onMouseOut="lolite()" onClick="logVariable('cansubscribe')" href="../../_variables/cansubscribe.html">$cansubscribe</a>) {
<a name="l7192"><span class="linenum">7192</span></a>          if (\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_subscribed')" href="../../_functions/is_subscribed.html" onMouseOver="funcPopup(event,'is_subscribed')">is_subscribed</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>, null, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>)) {
<a name="l7193"><span class="linenum">7193</span></a>              <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unsubscribe', 'forum');
<a name="l7194"><span class="linenum">7194</span></a>          } else {
<a name="l7195"><span class="linenum">7195</span></a>              <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscribe', 'forum');
<a name="l7196"><span class="linenum">7196</span></a>          }
<a name="l7197"><span class="linenum">7197</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/subscribe.php.html">/mod/forum/subscribe.php</a>', array('id'=&gt;<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('id')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'sesskey'=&gt;<a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>()));
<a name="l7198"><span class="linenum">7198</span></a>          <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a>, <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l7199"><span class="linenum">7199</span></a>  
<a name="l7200"><span class="linenum">7200</span></a>          if (isset(<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>)) {
<a name="l7201"><span class="linenum">7201</span></a>              if (\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_subscribed')" href="../../_functions/is_subscribed.html" onMouseOver="funcPopup(event,'is_subscribed')">is_subscribed</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>, <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>)) {
<a name="l7202"><span class="linenum">7202</span></a>                  <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unsubscribediscussion', 'forum');
<a name="l7203"><span class="linenum">7203</span></a>              } else {
<a name="l7204"><span class="linenum">7204</span></a>                  <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('subscribediscussion', 'forum');
<a name="l7205"><span class="linenum">7205</span></a>              }
<a name="l7206"><span class="linenum">7206</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/subscribe.php.html">/mod/forum/subscribe.php</a>', array(
<a name="l7207"><span class="linenum">7207</span></a>                      'id' =&gt; <a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('id')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l7208"><span class="linenum">7208</span></a>                      'sesskey' =&gt; <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>(),
<a name="l7209"><span class="linenum">7209</span></a>                      'd' =&gt; <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../_variables/discussionid.html">$discussionid</a>,
<a name="l7210"><span class="linenum">7210</span></a>                      'returnurl' =&gt; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/url.html">url</a>-&gt;<a class="function" onClick="logFunction('out')" href="../../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>(),
<a name="l7211"><span class="linenum">7211</span></a>                  ));
<a name="l7212"><span class="linenum">7212</span></a>              <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a>, <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l7213"><span class="linenum">7213</span></a>          }
<a name="l7214"><span class="linenum">7214</span></a>      }
<a name="l7215"><span class="linenum">7215</span></a>  
<a name="l7216"><span class="linenum">7216</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewsubscribers', <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)){
<a name="l7217"><span class="linenum">7217</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/subscribers.php.html">/mod/forum/subscribers.php</a>', array('id'=&gt;<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('id')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l7218"><span class="linenum">7218</span></a>          <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('showsubscribers', 'forum'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l7219"><span class="linenum">7219</span></a>      }
<a name="l7220"><span class="linenum">7220</span></a>  
<a name="l7221"><span class="linenum">7221</span></a>      if (<a class="var it30774" onMouseOver="hilite(30774)" onMouseOut="lolite()" onClick="logVariable('enrolled')" href="../../_variables/enrolled.html">$enrolled</a> &amp;&amp; <a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>(<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>)) { // keep tracking info for users with suspended enrolments
<a name="l7222"><span class="linenum">7222</span></a>          if (<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('trackingtype')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/trackingtype.html">trackingtype</a> == <a class="constant" onClick="logConstant('FORUM_TRACKING_OPTIONAL')" href="../../_constants/FORUM_TRACKING_OPTIONAL.html" onMouseOver="constPopup(event,'FORUM_TRACKING_OPTIONAL')">FORUM_TRACKING_OPTIONAL</a>
<a name="l7223"><span class="linenum">7223</span></a>                  || ((!<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_allowforcedreadtracking')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_allowforcedreadtracking.html">forum_allowforcedreadtracking</a>) &amp;&amp; <a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('trackingtype')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/trackingtype.html">trackingtype</a> == <a class="constant" onClick="logConstant('FORUM_TRACKING_FORCED')" href="../../_constants/FORUM_TRACKING_FORCED.html" onMouseOver="constPopup(event,'FORUM_TRACKING_FORCED')">FORUM_TRACKING_FORCED</a>)) {
<a name="l7224"><span class="linenum">7224</span></a>              if (<a class="function" onClick="logFunction('forum_tp_is_tracked')" href="../../_functions/forum_tp_is_tracked.html" onMouseOver="funcPopup(event,'forum_tp_is_tracked')">forum_tp_is_tracked</a>(<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>)) {
<a name="l7225"><span class="linenum">7225</span></a>                  <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('notrackforum', 'forum');
<a name="l7226"><span class="linenum">7226</span></a>              } else {
<a name="l7227"><span class="linenum">7227</span></a>                  <a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('trackforum', 'forum');
<a name="l7228"><span class="linenum">7228</span></a>              }
<a name="l7229"><span class="linenum">7229</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/settracking.php.html">/mod/forum/settracking.php</a>', array(
<a name="l7230"><span class="linenum">7230</span></a>                      'id' =&gt; <a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('id')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l7231"><span class="linenum">7231</span></a>                      'sesskey' =&gt; <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>(),
<a name="l7232"><span class="linenum">7232</span></a>                  ));
<a name="l7233"><span class="linenum">7233</span></a>              <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="var it2503" onMouseOver="hilite(2503)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../../_variables/linktext.html">$linktext</a>, <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l7234"><span class="linenum">7234</span></a>          }
<a name="l7235"><span class="linenum">7235</span></a>      }
<a name="l7236"><span class="linenum">7236</span></a>  
<a name="l7237"><span class="linenum">7237</span></a>      if (!<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>() &amp;&amp; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('course')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id == <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l7238"><span class="linenum">7238</span></a>          <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="function" onClick="logFunction('guest_user')" href="../../_functions/guest_user.html" onMouseOver="funcPopup(event,'guest_user')">guest_user</a>()-&gt;id;
<a name="l7239"><span class="linenum">7239</span></a>      } else {
<a name="l7240"><span class="linenum">7240</span></a>          <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l7241"><span class="linenum">7241</span></a>      }
<a name="l7242"><span class="linenum">7242</span></a>  
<a name="l7243"><span class="linenum">7243</span></a>      <a class="var it41663" onMouseOver="hilite(41663)" onMouseOut="lolite()" onClick="logVariable('hascourseaccess')" href="../../_variables/hascourseaccess.html">$hascourseaccess</a> = (<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('course')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id == <a class="constant" onClick="logConstant('SITEID')" href="../../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) || <a class="function" onClick="logFunction('can_access_course')" href="../../_functions/can_access_course.html" onMouseOver="funcPopup(event,'can_access_course')">can_access_course</a>(<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('course')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l7244"><span class="linenum">7244</span></a>      <a class="var it1875" onMouseOver="hilite(1875)" onMouseOut="lolite()" onClick="logVariable('enablerssfeeds')" href="../../_variables/enablerssfeeds.html">$enablerssfeeds</a> = !empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablerssfeeds')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/enablerssfeeds.html">enablerssfeeds</a>) &amp;&amp; !empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enablerssfeeds')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enablerssfeeds.html">forum_enablerssfeeds</a>);
<a name="l7245"><span class="linenum">7245</span></a>  
<a name="l7246"><span class="linenum">7246</span></a>      if (<a class="var it1875" onMouseOver="hilite(1875)" onMouseOut="lolite()" onClick="logVariable('enablerssfeeds')" href="../../_variables/enablerssfeeds.html">$enablerssfeeds</a> &amp;&amp; <a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('rsstype')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/rsstype.html">rsstype</a> &amp;&amp; <a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('rssarticles')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/rssarticles.html">rssarticles</a> &amp;&amp; <a class="var it41663" onMouseOver="hilite(41663)" onMouseOut="lolite()" onClick="logVariable('hascourseaccess')" href="../../_variables/hascourseaccess.html">$hascourseaccess</a>) {
<a name="l7247"><span class="linenum">7247</span></a>  
<a name="l7248"><span class="linenum">7248</span></a>          if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('rss_get_url')) {
<a name="l7249"><span class="linenum">7249</span></a>              require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>/rsslib.php&quot;);
<a name="l7250"><span class="linenum">7250</span></a>          }
<a name="l7251"><span class="linenum">7251</span></a>  
<a name="l7252"><span class="linenum">7252</span></a>          if (<a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('rsstype')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/rsstype.html">rsstype</a> == 1) {
<a name="l7253"><span class="linenum">7253</span></a>              <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('rsssubscriberssdiscussions','forum');
<a name="l7254"><span class="linenum">7254</span></a>          } else {
<a name="l7255"><span class="linenum">7255</span></a>              <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('rsssubscriberssposts','forum');
<a name="l7256"><span class="linenum">7256</span></a>          }
<a name="l7257"><span class="linenum">7257</span></a>  
<a name="l7258"><span class="linenum">7258</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="function" onClick="logFunction('rss_get_url')" href="../../_functions/rss_get_url.html" onMouseOver="funcPopup(event,'rss_get_url')">rss_get_url</a>(<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context-&gt;id, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, &quot;mod_forum&quot;, <a class="var it41655" onMouseOver="hilite(41655)" onMouseOut="lolite()" onClick="logVariable('forumobject')" href="../../_variables/forumobject.html">$forumobject</a>-&gt;<a onClick="logVariable('id')" class="var it44631" onMouseOver="hilite(44631)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l7259"><span class="linenum">7259</span></a>          <a class="var it24378" onMouseOver="hilite(24378)" onMouseOut="lolite()" onClick="logVariable('forumnode')" href="../../_variables/forumnode.html">$forumnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>, <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="class" onClick="logClass('settings_navigation')" href="../../_classes/settings_navigation.html" onMouseOver="classPopup(event,'settings_navigation')">settings_navigation</a>::TYPE_SETTING, null, null, <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/rss', ''));
<a name="l7260"><span class="linenum">7260</span></a>      }
<a name="l7261"><span class="linenum">7261</span></a>  }
<a name="l7262"><span class="linenum">7262</span></a>  
<a name="l7263"><span class="linenum">7263</span></a>  <span class="comment">/**</span>
<a name="l7264"><span class="linenum">7264</span></a>  <span class="comment"> * Adds information about unread messages, that is only required for the course view page (and</span>
<a name="l7265"><span class="linenum">7265</span></a>  <span class="comment"> * similar), to the course-module object.</span>
<a name="l7266"><span class="linenum">7266</span></a>  <span class="comment"> * @param cm_info $cm Course-module object</span>
<a name="l7267"><span class="linenum">7267</span></a>  <span class="comment"> */</span>
<a name="l7268"><span class="linenum">7268</span></a>  function <a class="function" onClick="logFunction('forum_cm_info_view')" href="../../_functions/forum_cm_info_view.html" onMouseOver="funcPopup(event,'forum_cm_info_view')">forum_cm_info_view</a>(cm_info <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l7269"><span class="linenum">7269</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l7270"><span class="linenum">7270</span></a>  
<a name="l7271"><span class="linenum">7271</span></a>      if (<a class="function" onClick="logFunction('forum_tp_can_track_forums')" href="../../_functions/forum_tp_can_track_forums.html" onMouseOver="funcPopup(event,'forum_tp_can_track_forums')">forum_tp_can_track_forums</a>()) {
<a name="l7272"><span class="linenum">7272</span></a>          if (<a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a> = <a class="function" onClick="logFunction('forum_tp_count_forum_unread_posts')" href="../../_functions/forum_tp_count_forum_unread_posts.html" onMouseOver="funcPopup(event,'forum_tp_count_forum_unread_posts')">forum_tp_count_forum_unread_posts</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a class="function" onClick="logFunction('get_course')" href="../../_functions/get_course.html" onMouseOver="funcPopup(event,'get_course')">get_course</a>())) {
<a name="l7273"><span class="linenum">7273</span></a>              <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('out')" href="../../_variables/out.html">$out</a> = '&lt;span class=&quot;unread&quot;&gt; &lt;a href=&quot;' . <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('url')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/url.html">url</a> . '&quot;&gt;';
<a name="l7274"><span class="linenum">7274</span></a>              if (<a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a> == 1) {
<a name="l7275"><span class="linenum">7275</span></a>                  <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('out')" href="../../_variables/out.html">$out</a> .= <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unreadpostsone', 'forum');
<a name="l7276"><span class="linenum">7276</span></a>              } else {
<a name="l7277"><span class="linenum">7277</span></a>                  <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('out')" href="../../_variables/out.html">$out</a> .= <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unreadpostsnumber', 'forum', <a class="var it32725" onMouseOver="hilite(32725)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../../_variables/unread.html">$unread</a>);
<a name="l7278"><span class="linenum">7278</span></a>              }
<a name="l7279"><span class="linenum">7279</span></a>              <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('out')" href="../../_variables/out.html">$out</a> .= '&lt;/a&gt;&lt;/span&gt;';
<a name="l7280"><span class="linenum">7280</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a class="function" onClick="logFunction('set_after_link')" href="../../_functions/set_after_link.html" onMouseOver="funcPopup(event,'set_after_link')">set_after_link</a>(<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('out')" href="../../_variables/out.html">$out</a>);
<a name="l7281"><span class="linenum">7281</span></a>          }
<a name="l7282"><span class="linenum">7282</span></a>      }
<a name="l7283"><span class="linenum">7283</span></a>  }
<a name="l7284"><span class="linenum">7284</span></a>  
<a name="l7285"><span class="linenum">7285</span></a>  <span class="comment">/**</span>
<a name="l7286"><span class="linenum">7286</span></a>  <span class="comment"> * Return a list of page types</span>
<a name="l7287"><span class="linenum">7287</span></a>  <span class="comment"> * @param string $pagetype current page type</span>
<a name="l7288"><span class="linenum">7288</span></a>  <span class="comment"> * @param stdClass $parentcontext Block's parent context</span>
<a name="l7289"><span class="linenum">7289</span></a>  <span class="comment"> * @param stdClass $currentcontext Current context of block</span>
<a name="l7290"><span class="linenum">7290</span></a>  <span class="comment"> */</span>
<a name="l7291"><span class="linenum">7291</span></a>  function <a class="function" onClick="logFunction('forum_page_type_list')" href="../../_functions/forum_page_type_list.html" onMouseOver="funcPopup(event,'forum_page_type_list')">forum_page_type_list</a>(<a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../../_variables/pagetype.html">$pagetype</a>, <a class="var it2279" onMouseOver="hilite(2279)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../../_variables/parentcontext.html">$parentcontext</a>, <a class="var it2280" onMouseOver="hilite(2280)" onMouseOut="lolite()" onClick="logVariable('currentcontext')" href="../../_variables/currentcontext.html">$currentcontext</a>) {
<a name="l7292"><span class="linenum">7292</span></a>      <a class="var it41664" onMouseOver="hilite(41664)" onMouseOut="lolite()" onClick="logVariable('forum_pagetype')" href="../../_variables/forum_pagetype.html">$forum_pagetype</a> = array(
<a name="l7293"><span class="linenum">7293</span></a>          'mod-forum-*'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-forum-x', 'forum'),
<a name="l7294"><span class="linenum">7294</span></a>          'mod-forum-view'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-forum-view', 'forum'),
<a name="l7295"><span class="linenum">7295</span></a>          'mod-forum-discuss'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-forum-discuss', 'forum')
<a name="l7296"><span class="linenum">7296</span></a>      );
<a name="l7297"><span class="linenum">7297</span></a>      return <a class="var it41664" onMouseOver="hilite(41664)" onMouseOut="lolite()" onClick="logVariable('forum_pagetype')" href="../../_variables/forum_pagetype.html">$forum_pagetype</a>;
<a name="l7298"><span class="linenum">7298</span></a>  }
<a name="l7299"><span class="linenum">7299</span></a>  
<a name="l7300"><span class="linenum">7300</span></a>  <span class="comment">/**</span>
<a name="l7301"><span class="linenum">7301</span></a>  <span class="comment"> * Gets all of the courses where the provided user has posted in a forum.</span>
<a name="l7302"><span class="linenum">7302</span></a>  <span class="comment"> *</span>
<a name="l7303"><span class="linenum">7303</span></a>  <span class="comment"> * @global moodle_database $DB The database connection</span>
<a name="l7304"><span class="linenum">7304</span></a>  <span class="comment"> * @param stdClass $user The user who's posts we are looking for</span>
<a name="l7305"><span class="linenum">7305</span></a>  <span class="comment"> * @param bool $discussionsonly If true only look for discussions started by the user</span>
<a name="l7306"><span class="linenum">7306</span></a>  <span class="comment"> * @param bool $includecontexts If set to trye contexts for the courses will be preloaded</span>
<a name="l7307"><span class="linenum">7307</span></a>  <span class="comment"> * @param int $limitfrom The offset of records to return</span>
<a name="l7308"><span class="linenum">7308</span></a>  <span class="comment"> * @param int $limitnum The number of records to return</span>
<a name="l7309"><span class="linenum">7309</span></a>  <span class="comment"> * @return array An array of courses</span>
<a name="l7310"><span class="linenum">7310</span></a>  <span class="comment"> */</span>
<a name="l7311"><span class="linenum">7311</span></a>  function <a class="function" onClick="logFunction('forum_get_courses_user_posted_in')" href="../../_functions/forum_get_courses_user_posted_in.html" onMouseOver="funcPopup(event,'forum_get_courses_user_posted_in')">forum_get_courses_user_posted_in</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it16022" onMouseOver="hilite(16022)" onMouseOut="lolite()" onClick="logVariable('discussionsonly')" href="../../_variables/discussionsonly.html">$discussionsonly</a> = false, <a class="var it41665" onMouseOver="hilite(41665)" onMouseOut="lolite()" onClick="logVariable('includecontexts')" href="../../_variables/includecontexts.html">$includecontexts</a> = true, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> = null, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a> = null) {
<a name="l7312"><span class="linenum">7312</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l7313"><span class="linenum">7313</span></a>  
<a name="l7314"><span class="linenum">7314</span></a>  <span class="comment">    // If we are only after discussions we need only look at the forum_discussions</span>
<a name="l7315"><span class="linenum">7315</span></a>  <span class="comment">    // table and join to the userid there. If we are looking for posts then we need</span>
<a name="l7316"><span class="linenum">7316</span></a>  <span class="comment">    // to join to the forum_posts table.</span>
<a name="l7317"><span class="linenum">7317</span></a>      if (!<a class="var it16022" onMouseOver="hilite(16022)" onMouseOut="lolite()" onClick="logVariable('discussionsonly')" href="../../_variables/discussionsonly.html">$discussionsonly</a>) {
<a name="l7318"><span class="linenum">7318</span></a>          <a class="var it12903" onMouseOver="hilite(12903)" onMouseOut="lolite()" onClick="logVariable('subquery')" href="../../_variables/subquery.html">$subquery</a> = &quot;(SELECT DISTINCT fd.course
<a name="l7319"><span class="linenum">7319</span></a>                           FROM {forum_discussions} fd
<a name="l7320"><span class="linenum">7320</span></a>                           JOIN {forum_posts} fp ON fp.discussion = fd.id
<a name="l7321"><span class="linenum">7321</span></a>                          WHERE fp.userid = :userid )&quot;;
<a name="l7322"><span class="linenum">7322</span></a>      } else {
<a name="l7323"><span class="linenum">7323</span></a>          <a class="var it12903" onMouseOver="hilite(12903)" onMouseOut="lolite()" onClick="logVariable('subquery')" href="../../_variables/subquery.html">$subquery</a>= &quot;(SELECT DISTINCT fd.course
<a name="l7324"><span class="linenum">7324</span></a>                           FROM {forum_discussions} fd
<a name="l7325"><span class="linenum">7325</span></a>                          WHERE fd.userid = :userid )&quot;;
<a name="l7326"><span class="linenum">7326</span></a>      }
<a name="l7327"><span class="linenum">7327</span></a>  
<a name="l7328"><span class="linenum">7328</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l7329"><span class="linenum">7329</span></a>  
<a name="l7330"><span class="linenum">7330</span></a>  <span class="comment">    // Join to the context table so that we can preload contexts if required.</span>
<a name="l7331"><span class="linenum">7331</span></a>      if (<a class="var it41665" onMouseOver="hilite(41665)" onMouseOut="lolite()" onClick="logVariable('includecontexts')" href="../../_variables/includecontexts.html">$includecontexts</a>) {
<a name="l7332"><span class="linenum">7332</span></a>          <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('ctxselect')" href="../../_variables/ctxselect.html">$ctxselect</a> = ', ' . <a class="class" onClick="logClass('context_helper')" href="../../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('get_preload_record_columns_sql')" href="../../_functions/get_preload_record_columns_sql.html" onMouseOver="funcPopup(event,'get_preload_record_columns_sql')">get_preload_record_columns_sql</a>('ctx');
<a name="l7333"><span class="linenum">7333</span></a>          <a class="var it18089" onMouseOver="hilite(18089)" onMouseOut="lolite()" onClick="logVariable('ctxjoin')" href="../../_variables/ctxjoin.html">$ctxjoin</a> = &quot;LEFT JOIN {context} ctx <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ctx.instanceid = c.id AND ctx.contextlevel = :contextlevel)&quot;;
<a name="l7334"><span class="linenum">7334</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['contextlevel'] = <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>;
<a name="l7335"><span class="linenum">7335</span></a>      } else {
<a name="l7336"><span class="linenum">7336</span></a>          <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('ctxselect')" href="../../_variables/ctxselect.html">$ctxselect</a> = '';
<a name="l7337"><span class="linenum">7337</span></a>          <a class="var it18089" onMouseOver="hilite(18089)" onMouseOut="lolite()" onClick="logVariable('ctxjoin')" href="../../_variables/ctxjoin.html">$ctxjoin</a> = '';
<a name="l7338"><span class="linenum">7338</span></a>      }
<a name="l7339"><span class="linenum">7339</span></a>  
<a name="l7340"><span class="linenum">7340</span></a>  <span class="comment">    // Now we need to get all of the courses to search.</span>
<a name="l7341"><span class="linenum">7341</span></a>  <span class="comment">    // All courses where the user has posted within a forum will be returned.</span>
<a name="l7342"><span class="linenum">7342</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT c.* <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('ctxselect')" href="../../_variables/ctxselect.html">$ctxselect</a>
<a name="l7343"><span class="linenum">7343</span></a>              FROM {course} c
<a name="l7344"><span class="linenum">7344</span></a>              <a class="var it18089" onMouseOver="hilite(18089)" onMouseOut="lolite()" onClick="logVariable('ctxjoin')" href="../../_variables/ctxjoin.html">$ctxjoin</a>
<a name="l7345"><span class="linenum">7345</span></a>              WHERE c.id IN (<a class="var it12903" onMouseOver="hilite(12903)" onMouseOut="lolite()" onClick="logVariable('subquery')" href="../../_variables/subquery.html">$subquery</a>)&quot;;
<a name="l7346"><span class="linenum">7346</span></a>      <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a>, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>);
<a name="l7347"><span class="linenum">7347</span></a>      if (<a class="var it41665" onMouseOver="hilite(41665)" onMouseOut="lolite()" onClick="logVariable('includecontexts')" href="../../_variables/includecontexts.html">$includecontexts</a>) {
<a name="l7348"><span class="linenum">7348</span></a>          <a class="phpfunction" onClick="logFunction('array_map')" href="../../_functions/array_map.html" onMouseOver="phpfuncPopup(event,'array_map')">array_map</a>('<a class="class" onClick="logClass('context_helper')" href="../../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::preload_from_record', <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>);
<a name="l7349"><span class="linenum">7349</span></a>      }
<a name="l7350"><span class="linenum">7350</span></a>      return <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>;
<a name="l7351"><span class="linenum">7351</span></a>  }
<a name="l7352"><span class="linenum">7352</span></a>  
<a name="l7353"><span class="linenum">7353</span></a>  <span class="comment">/**</span>
<a name="l7354"><span class="linenum">7354</span></a>  <span class="comment"> * Gets all of the forums a user has posted in for one or more courses.</span>
<a name="l7355"><span class="linenum">7355</span></a>  <span class="comment"> *</span>
<a name="l7356"><span class="linenum">7356</span></a>  <span class="comment"> * @global moodle_database $DB</span>
<a name="l7357"><span class="linenum">7357</span></a>  <span class="comment"> * @param stdClass $user</span>
<a name="l7358"><span class="linenum">7358</span></a>  <span class="comment"> * @param array $courseids An array of courseids to search or if not provided</span>
<a name="l7359"><span class="linenum">7359</span></a>  <span class="comment"> *                       all courses the user has posted within</span>
<a name="l7360"><span class="linenum">7360</span></a>  <span class="comment"> * @param bool $discussionsonly If true then only forums where the user has started</span>
<a name="l7361"><span class="linenum">7361</span></a>  <span class="comment"> *                       a discussion will be returned.</span>
<a name="l7362"><span class="linenum">7362</span></a>  <span class="comment"> * @param int $limitfrom The offset of records to return</span>
<a name="l7363"><span class="linenum">7363</span></a>  <span class="comment"> * @param int $limitnum The number of records to return</span>
<a name="l7364"><span class="linenum">7364</span></a>  <span class="comment"> * @return array An array of forums the user has posted within in the provided courses</span>
<a name="l7365"><span class="linenum">7365</span></a>  <span class="comment"> */</span>
<a name="l7366"><span class="linenum">7366</span></a>  function <a class="function" onClick="logFunction('forum_get_forums_user_posted_in')" href="../../_functions/forum_get_forums_user_posted_in.html" onMouseOver="funcPopup(event,'forum_get_forums_user_posted_in')">forum_get_forums_user_posted_in</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, array <a class="var it2413" onMouseOver="hilite(2413)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../../_variables/courseids.html">$courseids</a> = null, <a class="var it16022" onMouseOver="hilite(16022)" onMouseOut="lolite()" onClick="logVariable('discussionsonly')" href="../../_variables/discussionsonly.html">$discussionsonly</a> = false, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> = null, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a> = null) {
<a name="l7367"><span class="linenum">7367</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l7368"><span class="linenum">7368</span></a>  
<a name="l7369"><span class="linenum">7369</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it2413" onMouseOver="hilite(2413)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../../_variables/courseids.html">$courseids</a>)) {
<a name="l7370"><span class="linenum">7370</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it41666" onMouseOver="hilite(41666)" onMouseOut="lolite()" onClick="logVariable('coursewhere')" href="../../_variables/coursewhere.html">$coursewhere</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it2413" onMouseOver="hilite(2413)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../../_variables/courseids.html">$courseids</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'courseid');
<a name="l7371"><span class="linenum">7371</span></a>          <a class="var it41666" onMouseOver="hilite(41666)" onMouseOut="lolite()" onClick="logVariable('coursewhere')" href="../../_variables/coursewhere.html">$coursewhere</a> = ' AND f.course '.<a class="var it41666" onMouseOver="hilite(41666)" onMouseOut="lolite()" onClick="logVariable('coursewhere')" href="../../_variables/coursewhere.html">$coursewhere</a>;
<a name="l7372"><span class="linenum">7372</span></a>      } else {
<a name="l7373"><span class="linenum">7373</span></a>          <a class="var it41666" onMouseOver="hilite(41666)" onMouseOut="lolite()" onClick="logVariable('coursewhere')" href="../../_variables/coursewhere.html">$coursewhere</a> = '';
<a name="l7374"><span class="linenum">7374</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l7375"><span class="linenum">7375</span></a>      }
<a name="l7376"><span class="linenum">7376</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['userid'] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l7377"><span class="linenum">7377</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['forum'] = 'forum';
<a name="l7378"><span class="linenum">7378</span></a>  
<a name="l7379"><span class="linenum">7379</span></a>      if (<a class="var it16022" onMouseOver="hilite(16022)" onMouseOut="lolite()" onClick="logVariable('discussionsonly')" href="../../_variables/discussionsonly.html">$discussionsonly</a>) {
<a name="l7380"><span class="linenum">7380</span></a>          <a class="var it11538" onMouseOver="hilite(11538)" onMouseOut="lolite()" onClick="logVariable('join')" href="../../_variables/join.html">$join</a> = 'JOIN {forum_discussions} ff ON ff.forum = f.id';
<a name="l7381"><span class="linenum">7381</span></a>      } else {
<a name="l7382"><span class="linenum">7382</span></a>          <a class="var it11538" onMouseOver="hilite(11538)" onMouseOut="lolite()" onClick="logVariable('join')" href="../../_variables/join.html">$join</a> = 'JOIN {forum_discussions} fd ON fd.forum = f.id
<a name="l7383"><span class="linenum">7383</span></a>                   JOIN {forum_posts} ff ON ff.discussion = fd.id';
<a name="l7384"><span class="linenum">7384</span></a>      }
<a name="l7385"><span class="linenum">7385</span></a>  
<a name="l7386"><span class="linenum">7386</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT f.*, cm.id AS cmid
<a name="l7387"><span class="linenum">7387</span></a>                FROM {forum} f
<a name="l7388"><span class="linenum">7388</span></a>                JOIN {course_modules} cm ON cm.instance = f.id
<a name="l7389"><span class="linenum">7389</span></a>                JOIN {modules} m ON m.id = cm.module
<a name="l7390"><span class="linenum">7390</span></a>                <a class="function" onClick="logFunction('JOIN')" href="../../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (
<a name="l7391"><span class="linenum">7391</span></a>                    SELECT f.id
<a name="l7392"><span class="linenum">7392</span></a>                      FROM {forum} f
<a name="l7393"><span class="linenum">7393</span></a>                      {<a class="var it11538" onMouseOver="hilite(11538)" onMouseOut="lolite()" onClick="logVariable('join')" href="../../_variables/join.html">$join</a>}
<a name="l7394"><span class="linenum">7394</span></a>                     WHERE ff.userid = :userid
<a name="l7395"><span class="linenum">7395</span></a>                  GROUP BY f.id
<a name="l7396"><span class="linenum">7396</span></a>                     ) j ON j.id = f.id
<a name="l7397"><span class="linenum">7397</span></a>               WHERE m.name = :forum
<a name="l7398"><span class="linenum">7398</span></a>                   {<a class="var it41666" onMouseOver="hilite(41666)" onMouseOut="lolite()" onClick="logVariable('coursewhere')" href="../../_variables/coursewhere.html">$coursewhere</a>}&quot;;
<a name="l7399"><span class="linenum">7399</span></a>  
<a name="l7400"><span class="linenum">7400</span></a>      <a class="var it41536" onMouseOver="hilite(41536)" onMouseOut="lolite()" onClick="logVariable('courseforums')" href="../../_variables/courseforums.html">$courseforums</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a>, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>);
<a name="l7401"><span class="linenum">7401</span></a>      return <a class="var it41536" onMouseOver="hilite(41536)" onMouseOut="lolite()" onClick="logVariable('courseforums')" href="../../_variables/courseforums.html">$courseforums</a>;
<a name="l7402"><span class="linenum">7402</span></a>  }
<a name="l7403"><span class="linenum">7403</span></a>  
<a name="l7404"><span class="linenum">7404</span></a>  <span class="comment">/**</span>
<a name="l7405"><span class="linenum">7405</span></a>  <span class="comment"> * Returns posts made by the selected user in the requested courses.</span>
<a name="l7406"><span class="linenum">7406</span></a>  <span class="comment"> *</span>
<a name="l7407"><span class="linenum">7407</span></a>  <span class="comment"> * This method can be used to return all of the posts made by the requested user</span>
<a name="l7408"><span class="linenum">7408</span></a>  <span class="comment"> * within the given courses.</span>
<a name="l7409"><span class="linenum">7409</span></a>  <span class="comment"> * For each course the access of the current user and requested user is checked</span>
<a name="l7410"><span class="linenum">7410</span></a>  <span class="comment"> * and then for each post access to the post and forum is checked as well.</span>
<a name="l7411"><span class="linenum">7411</span></a>  <span class="comment"> *</span>
<a name="l7412"><span class="linenum">7412</span></a>  <span class="comment"> * This function is safe to use with usercapabilities.</span>
<a name="l7413"><span class="linenum">7413</span></a>  <span class="comment"> *</span>
<a name="l7414"><span class="linenum">7414</span></a>  <span class="comment"> * @global moodle_database $DB</span>
<a name="l7415"><span class="linenum">7415</span></a>  <span class="comment"> * @param stdClass $user The user whose posts we want to get</span>
<a name="l7416"><span class="linenum">7416</span></a>  <span class="comment"> * @param array $courses The courses to search</span>
<a name="l7417"><span class="linenum">7417</span></a>  <span class="comment"> * @param bool $musthaveaccess If set to true errors will be thrown if the user</span>
<a name="l7418"><span class="linenum">7418</span></a>  <span class="comment"> *                             cannot access one or more of the courses to search</span>
<a name="l7419"><span class="linenum">7419</span></a>  <span class="comment"> * @param bool $discussionsonly If set to true only discussion starting posts</span>
<a name="l7420"><span class="linenum">7420</span></a>  <span class="comment"> *                              will be returned.</span>
<a name="l7421"><span class="linenum">7421</span></a>  <span class="comment"> * @param int $limitfrom The offset of records to return</span>
<a name="l7422"><span class="linenum">7422</span></a>  <span class="comment"> * @param int $limitnum The number of records to return</span>
<a name="l7423"><span class="linenum">7423</span></a>  <span class="comment"> * @return stdClass An object the following properties</span>
<a name="l7424"><span class="linenum">7424</span></a>  <span class="comment"> *               -&gt;totalcount: the total number of posts made by the requested user</span>
<a name="l7425"><span class="linenum">7425</span></a>  <span class="comment"> *                             that the current user can see.</span>
<a name="l7426"><span class="linenum">7426</span></a>  <span class="comment"> *               -&gt;courses: An array of courses the current user can see that the</span>
<a name="l7427"><span class="linenum">7427</span></a>  <span class="comment"> *                          requested user has posted in.</span>
<a name="l7428"><span class="linenum">7428</span></a>  <span class="comment"> *               -&gt;forums: An array of forums relating to the posts returned in the</span>
<a name="l7429"><span class="linenum">7429</span></a>  <span class="comment"> *                         property below.</span>
<a name="l7430"><span class="linenum">7430</span></a>  <span class="comment"> *               -&gt;posts: An array containing the posts to show for this request.</span>
<a name="l7431"><span class="linenum">7431</span></a>  <span class="comment"> */</span>
<a name="l7432"><span class="linenum">7432</span></a>  function <a class="function" onClick="logFunction('forum_get_posts_by_user')" href="../../_functions/forum_get_posts_by_user.html" onMouseOver="funcPopup(event,'forum_get_posts_by_user')">forum_get_posts_by_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, array <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>, <a class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" onClick="logVariable('musthaveaccess')" href="../../_variables/musthaveaccess.html">$musthaveaccess</a> = false, <a class="var it16022" onMouseOver="hilite(16022)" onMouseOut="lolite()" onClick="logVariable('discussionsonly')" href="../../_variables/discussionsonly.html">$discussionsonly</a> = false, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a> = 0, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a> = 50) {
<a name="l7433"><span class="linenum">7433</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l7434"><span class="linenum">7434</span></a>  
<a name="l7435"><span class="linenum">7435</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = new stdClass;
<a name="l7436"><span class="linenum">7436</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('totalcount')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/totalcount.html">totalcount</a> = 0;    <span class="comment">// The total number of posts that the current user is able to view</span>
<a name="l7437"><span class="linenum">7437</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('courses')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/courses.html">courses</a> = array(); <span class="comment">// The courses the current user can access</span>
<a name="l7438"><span class="linenum">7438</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('forums')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/forums.html">forums</a> = array();  <span class="comment">// The forums that the current user can access that contain posts</span>
<a name="l7439"><span class="linenum">7439</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('posts')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/posts.html">posts</a> = array();   <span class="comment">// The posts to display</span>
<a name="l7440"><span class="linenum">7440</span></a>  
<a name="l7441"><span class="linenum">7441</span></a>  <span class="comment">    // First up a small sanity check. If there are no courses to check we can</span>
<a name="l7442"><span class="linenum">7442</span></a>  <span class="comment">    // return immediately, there is obviously nothing to search.</span>
<a name="l7443"><span class="linenum">7443</span></a>      if (empty(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>)) {
<a name="l7444"><span class="linenum">7444</span></a>          return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l7445"><span class="linenum">7445</span></a>      }
<a name="l7446"><span class="linenum">7446</span></a>  
<a name="l7447"><span class="linenum">7447</span></a>  <span class="comment">    // A couple of quick setups</span>
<a name="l7448"><span class="linenum">7448</span></a>      <a class="var it16024" onMouseOver="hilite(16024)" onMouseOut="lolite()" onClick="logVariable('isloggedin')" href="../../_variables/isloggedin.html">$isloggedin</a> = <a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>();
<a name="l7449"><span class="linenum">7449</span></a>      <a class="var it16025" onMouseOver="hilite(16025)" onMouseOut="lolite()" onClick="logVariable('isguestuser')" href="../../_variables/isguestuser.html">$isguestuser</a> = <a class="var it16024" onMouseOver="hilite(16024)" onMouseOut="lolite()" onClick="logVariable('isloggedin')" href="../../_variables/isloggedin.html">$isloggedin</a> &amp;&amp; <a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>();
<a name="l7450"><span class="linenum">7450</span></a>      <a class="var it6531" onMouseOver="hilite(6531)" onMouseOut="lolite()" onClick="logVariable('iscurrentuser')" href="../../_variables/iscurrentuser.html">$iscurrentuser</a> = <a class="var it16024" onMouseOver="hilite(16024)" onMouseOut="lolite()" onClick="logVariable('isloggedin')" href="../../_variables/isloggedin.html">$isloggedin</a> &amp;&amp; <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l7451"><span class="linenum">7451</span></a>  
<a name="l7452"><span class="linenum">7452</span></a>  <span class="comment">    // Checkout whether or not the current user has capabilities over the requested</span>
<a name="l7453"><span class="linenum">7453</span></a>  <span class="comment">    // user and if so they have the capabilities required to view the requested</span>
<a name="l7454"><span class="linenum">7454</span></a>  <span class="comment">    // users content.</span>
<a name="l7455"><span class="linenum">7455</span></a>      <a class="var it639" onMouseOver="hilite(639)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../../_variables/usercontext.html">$usercontext</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l7456"><span class="linenum">7456</span></a>      <a class="var it41668" onMouseOver="hilite(41668)" onMouseOut="lolite()" onClick="logVariable('hascapsonuser')" href="../../_variables/hascapsonuser.html">$hascapsonuser</a> = !<a class="var it6531" onMouseOver="hilite(6531)" onMouseOut="lolite()" onClick="logVariable('iscurrentuser')" href="../../_variables/iscurrentuser.html">$iscurrentuser</a> &amp;&amp; <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('role_assignments', array('userid' =&gt; <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'contextid' =&gt; <a class="var it639" onMouseOver="hilite(639)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../../_variables/usercontext.html">$usercontext</a>-&gt;<a onClick="logVariable('id')" class="var it43024" onMouseOver="hilite(43024)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l7457"><span class="linenum">7457</span></a>      <a class="var it41668" onMouseOver="hilite(41668)" onMouseOut="lolite()" onClick="logVariable('hascapsonuser')" href="../../_variables/hascapsonuser.html">$hascapsonuser</a> = <a class="var it41668" onMouseOver="hilite(41668)" onMouseOut="lolite()" onClick="logVariable('hascapsonuser')" href="../../_variables/hascapsonuser.html">$hascapsonuser</a> &amp;&amp; <a class="function" onClick="logFunction('has_all_capabilities')" href="../../_functions/has_all_capabilities.html" onMouseOver="funcPopup(event,'has_all_capabilities')">has_all_capabilities</a>(array('moodle/user:viewdetails', 'moodle/user:readuserposts'), <a class="var it639" onMouseOver="hilite(639)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../../_variables/usercontext.html">$usercontext</a>);
<a name="l7458"><span class="linenum">7458</span></a>  
<a name="l7459"><span class="linenum">7459</span></a>  <span class="comment">    // Before we actually search each course we need to check the user's access to the</span>
<a name="l7460"><span class="linenum">7460</span></a>  <span class="comment">    // course. If the user doesn't have the appropraite access then we either throw an</span>
<a name="l7461"><span class="linenum">7461</span></a>  <span class="comment">    // error if a particular course was requested or we just skip over the course.</span>
<a name="l7462"><span class="linenum">7462</span></a>      foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l7463"><span class="linenum">7463</span></a>          <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l7464"><span class="linenum">7464</span></a>          if (<a class="var it6531" onMouseOver="hilite(6531)" onMouseOut="lolite()" onClick="logVariable('iscurrentuser')" href="../../_variables/iscurrentuser.html">$iscurrentuser</a> || <a class="var it41668" onMouseOver="hilite(41668)" onMouseOut="lolite()" onClick="logVariable('hascapsonuser')" href="../../_variables/hascapsonuser.html">$hascapsonuser</a>) {
<a name="l7465"><span class="linenum">7465</span></a>  <span class="comment">            // If it is the current user, or the current user has capabilities to the</span>
<a name="l7466"><span class="linenum">7466</span></a>  <span class="comment">            // requested user then all we need to do is check the requested users</span>
<a name="l7467"><span class="linenum">7467</span></a>  <span class="comment">            // current access to the course.</span>
<a name="l7468"><span class="linenum">7468</span></a>  <span class="comment">            // Note: There is no need to check group access or anything of the like</span>
<a name="l7469"><span class="linenum">7469</span></a>  <span class="comment">            // as either the current user is the requested user, or has granted</span>
<a name="l7470"><span class="linenum">7470</span></a>  <span class="comment">            // capabilities on the requested user. Either way they can see what the</span>
<a name="l7471"><span class="linenum">7471</span></a>  <span class="comment">            // requested user posted, although its VERY unlikely in the `parent` situation</span>
<a name="l7472"><span class="linenum">7472</span></a>  <span class="comment">            // that the current user will be able to view the posts in context.</span>
<a name="l7473"><span class="linenum">7473</span></a>              if (!<a class="function" onClick="logFunction('is_viewing')" href="../../_functions/is_viewing.html" onMouseOver="funcPopup(event,'is_viewing')">is_viewing</a>(<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) &amp;&amp; !<a class="function" onClick="logFunction('is_enrolled')" href="../../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l7474"><span class="linenum">7474</span></a>  <span class="comment">                // Need to have full access to a course to see the rest of own info</span>
<a name="l7475"><span class="linenum">7475</span></a>                  if (<a class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" onClick="logVariable('musthaveaccess')" href="../../_variables/musthaveaccess.html">$musthaveaccess</a>) {
<a name="l7476"><span class="linenum">7476</span></a>                      <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('errorenrolmentrequired', 'forum');
<a name="l7477"><span class="linenum">7477</span></a>                  }
<a name="l7478"><span class="linenum">7478</span></a>                  continue;
<a name="l7479"><span class="linenum">7479</span></a>              }
<a name="l7480"><span class="linenum">7480</span></a>          } else {
<a name="l7481"><span class="linenum">7481</span></a>  <span class="comment">            // Check whether the current user is enrolled or has access to view the course</span>
<a name="l7482"><span class="linenum">7482</span></a>  <span class="comment">            // if they don't we immediately have a problem.</span>
<a name="l7483"><span class="linenum">7483</span></a>              if (!<a class="function" onClick="logFunction('can_access_course')" href="../../_functions/can_access_course.html" onMouseOver="funcPopup(event,'can_access_course')">can_access_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>)) {
<a name="l7484"><span class="linenum">7484</span></a>                  if (<a class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" onClick="logVariable('musthaveaccess')" href="../../_variables/musthaveaccess.html">$musthaveaccess</a>) {
<a name="l7485"><span class="linenum">7485</span></a>                      <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('errorenrolmentrequired', 'forum');
<a name="l7486"><span class="linenum">7486</span></a>                  }
<a name="l7487"><span class="linenum">7487</span></a>                  continue;
<a name="l7488"><span class="linenum">7488</span></a>              }
<a name="l7489"><span class="linenum">7489</span></a>  
<a name="l7490"><span class="linenum">7490</span></a>  <span class="comment">            // Check whether the requested user is enrolled or has access to view the course</span>
<a name="l7491"><span class="linenum">7491</span></a>  <span class="comment">            // if they don't we immediately have a problem.</span>
<a name="l7492"><span class="linenum">7492</span></a>              if (!<a class="function" onClick="logFunction('can_access_course')" href="../../_functions/can_access_course.html" onMouseOver="funcPopup(event,'can_access_course')">can_access_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) &amp;&amp; !<a class="function" onClick="logFunction('is_enrolled')" href="../../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l7493"><span class="linenum">7493</span></a>                  if (<a class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" onClick="logVariable('musthaveaccess')" href="../../_variables/musthaveaccess.html">$musthaveaccess</a>) {
<a name="l7494"><span class="linenum">7494</span></a>                      <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('notenrolled', 'forum');
<a name="l7495"><span class="linenum">7495</span></a>                  }
<a name="l7496"><span class="linenum">7496</span></a>                  continue;
<a name="l7497"><span class="linenum">7497</span></a>              }
<a name="l7498"><span class="linenum">7498</span></a>  
<a name="l7499"><span class="linenum">7499</span></a>  <span class="comment">            // If groups are in use and enforced throughout the course then make sure</span>
<a name="l7500"><span class="linenum">7500</span></a>  <span class="comment">            // we can meet in at least one course level group.</span>
<a name="l7501"><span class="linenum">7501</span></a>  <span class="comment">            // Note that we check if either the current user or the requested user have</span>
<a name="l7502"><span class="linenum">7502</span></a>  <span class="comment">            // the capability to access all groups. This is because with that capability</span>
<a name="l7503"><span class="linenum">7503</span></a>  <span class="comment">            // a user in group A could post in the group B forum. Grrrr.</span>
<a name="l7504"><span class="linenum">7504</span></a>              if (<a class="function" onClick="logFunction('groups_get_course_groupmode')" href="../../_functions/groups_get_course_groupmode.html" onMouseOver="funcPopup(event,'groups_get_course_groupmode')">groups_get_course_groupmode</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) == <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a> &amp;&amp; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;groupmodeforce
<a name="l7505"><span class="linenum">7505</span></a>                &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>) &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l7506"><span class="linenum">7506</span></a>  <span class="comment">                // If its the guest user to bad... the guest user cannot access groups</span>
<a name="l7507"><span class="linenum">7507</span></a>                  if (!<a class="var it16024" onMouseOver="hilite(16024)" onMouseOut="lolite()" onClick="logVariable('isloggedin')" href="../../_variables/isloggedin.html">$isloggedin</a> or <a class="var it16025" onMouseOver="hilite(16025)" onMouseOut="lolite()" onClick="logVariable('isguestuser')" href="../../_variables/isguestuser.html">$isguestuser</a>) {
<a name="l7508"><span class="linenum">7508</span></a>  <span class="comment">                    // do not use require_login() here because we might have already used require_login($course)</span>
<a name="l7509"><span class="linenum">7509</span></a>                      if (<a class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" onClick="logVariable('musthaveaccess')" href="../../_variables/musthaveaccess.html">$musthaveaccess</a>) {
<a name="l7510"><span class="linenum">7510</span></a>                          <a class="function" onClick="logFunction('redirect')" href="../../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<a class="function" onClick="logFunction('get_login_url')" href="../../_functions/get_login_url.html" onMouseOver="funcPopup(event,'get_login_url')">get_login_url</a>());
<a name="l7511"><span class="linenum">7511</span></a>                      }
<a name="l7512"><span class="linenum">7512</span></a>                      continue;
<a name="l7513"><span class="linenum">7513</span></a>                  }
<a name="l7514"><span class="linenum">7514</span></a>  <span class="comment">                // Get the groups of the current user</span>
<a name="l7515"><span class="linenum">7515</span></a>                  <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="function" onClick="logFunction('groups_get_all_groups')" href="../../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('defaultgroupingid')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/defaultgroupingid.html">defaultgroupingid</a>, 'g.id, g.name'));
<a name="l7516"><span class="linenum">7516</span></a>  <span class="comment">                // Get the groups the requested user is a member of</span>
<a name="l7517"><span class="linenum">7517</span></a>                  <a class="var it3731" onMouseOver="hilite(3731)" onMouseOut="lolite()" onClick="logVariable('usergroups')" href="../../_variables/usergroups.html">$usergroups</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="function" onClick="logFunction('groups_get_all_groups')" href="../../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('defaultgroupingid')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/defaultgroupingid.html">defaultgroupingid</a>, 'g.id, g.name'));
<a name="l7518"><span class="linenum">7518</span></a>  <span class="comment">                // Check whether they are members of the same group. If they are great.</span>
<a name="l7519"><span class="linenum">7519</span></a>                  <a class="var it22934" onMouseOver="hilite(22934)" onMouseOut="lolite()" onClick="logVariable('intersect')" href="../../_variables/intersect.html">$intersect</a> = <a class="phpfunction" onClick="logFunction('array_intersect')" href="../../_functions/array_intersect.html" onMouseOver="phpfuncPopup(event,'array_intersect')">array_intersect</a>(<a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('mygroups')" href="../../_variables/mygroups.html">$mygroups</a>, <a class="var it3731" onMouseOver="hilite(3731)" onMouseOut="lolite()" onClick="logVariable('usergroups')" href="../../_variables/usergroups.html">$usergroups</a>);
<a name="l7520"><span class="linenum">7520</span></a>                  if (empty(<a class="var it22934" onMouseOver="hilite(22934)" onMouseOut="lolite()" onClick="logVariable('intersect')" href="../../_variables/intersect.html">$intersect</a>)) {
<a name="l7521"><span class="linenum">7521</span></a>  <span class="comment">                    // But they're not... if it was a specific course throw an error otherwise</span>
<a name="l7522"><span class="linenum">7522</span></a>  <span class="comment">                    // just skip this course so that it is not searched.</span>
<a name="l7523"><span class="linenum">7523</span></a>                      if (<a class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" onClick="logVariable('musthaveaccess')" href="../../_variables/musthaveaccess.html">$musthaveaccess</a>) {
<a name="l7524"><span class="linenum">7524</span></a>                          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>(&quot;groupnotamember&quot;, '', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.&quot;/course/view.php?id=<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&quot;);
<a name="l7525"><span class="linenum">7525</span></a>                      }
<a name="l7526"><span class="linenum">7526</span></a>                      continue;
<a name="l7527"><span class="linenum">7527</span></a>                  }
<a name="l7528"><span class="linenum">7528</span></a>              }
<a name="l7529"><span class="linenum">7529</span></a>          }
<a name="l7530"><span class="linenum">7530</span></a>  <span class="comment">        // Woo hoo we got this far which means the current user can search this</span>
<a name="l7531"><span class="linenum">7531</span></a>  <span class="comment">        // this course for the requested user. Although this is only the course accessibility</span>
<a name="l7532"><span class="linenum">7532</span></a>  <span class="comment">        // handling that is complete, the forum accessibility tests are yet to come.</span>
<a name="l7533"><span class="linenum">7533</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('courses')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/courses.html">courses</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>;
<a name="l7534"><span class="linenum">7534</span></a>      }
<a name="l7535"><span class="linenum">7535</span></a>  <span class="comment">    // No longer beed $courses array - lose it not it may be big</span>
<a name="l7536"><span class="linenum">7536</span></a>      unset(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>);
<a name="l7537"><span class="linenum">7537</span></a>  
<a name="l7538"><span class="linenum">7538</span></a>  <span class="comment">    // Make sure that we have some courses to search</span>
<a name="l7539"><span class="linenum">7539</span></a>      if (empty(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('courses')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/courses.html">courses</a>)) {
<a name="l7540"><span class="linenum">7540</span></a>  <span class="comment">        // If we don't have any courses to search then the reality is that the current</span>
<a name="l7541"><span class="linenum">7541</span></a>  <span class="comment">        // user doesn't have access to any courses is which the requested user has posted.</span>
<a name="l7542"><span class="linenum">7542</span></a>  <span class="comment">        // Although we do know at this point that the requested user has posts.</span>
<a name="l7543"><span class="linenum">7543</span></a>          if (<a class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" onClick="logVariable('musthaveaccess')" href="../../_variables/musthaveaccess.html">$musthaveaccess</a>) {
<a name="l7544"><span class="linenum">7544</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('permissiondenied');
<a name="l7545"><span class="linenum">7545</span></a>          } else {
<a name="l7546"><span class="linenum">7546</span></a>              return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l7547"><span class="linenum">7547</span></a>          }
<a name="l7548"><span class="linenum">7548</span></a>      }
<a name="l7549"><span class="linenum">7549</span></a>  
<a name="l7550"><span class="linenum">7550</span></a>  <span class="comment">    // Next step: Collect all of the forums that we will want to search.</span>
<a name="l7551"><span class="linenum">7551</span></a>  <span class="comment">    // It is important to note that this step isn't actually about searching, it is</span>
<a name="l7552"><span class="linenum">7552</span></a>  <span class="comment">    // about determining which forums we can search by testing accessibility.</span>
<a name="l7553"><span class="linenum">7553</span></a>      <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a> = <a class="function" onClick="logFunction('forum_get_forums_user_posted_in')" href="../../_functions/forum_get_forums_user_posted_in.html" onMouseOver="funcPopup(event,'forum_get_forums_user_posted_in')">forum_get_forums_user_posted_in</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('courses')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/courses.html">courses</a>), <a class="var it16022" onMouseOver="hilite(16022)" onMouseOut="lolite()" onClick="logVariable('discussionsonly')" href="../../_variables/discussionsonly.html">$discussionsonly</a>);
<a name="l7554"><span class="linenum">7554</span></a>  
<a name="l7555"><span class="linenum">7555</span></a>  <span class="comment">    // Will be used to build the where conditions for the search</span>
<a name="l7556"><span class="linenum">7556</span></a>      <a class="var it41669" onMouseOver="hilite(41669)" onMouseOut="lolite()" onClick="logVariable('forumsearchwhere')" href="../../_variables/forumsearchwhere.html">$forumsearchwhere</a> = array();
<a name="l7557"><span class="linenum">7557</span></a>  <span class="comment">    // Will be used to store the where condition params for the search</span>
<a name="l7558"><span class="linenum">7558</span></a>      <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a> = array();
<a name="l7559"><span class="linenum">7559</span></a>  <span class="comment">    // Will record forums where the user can freely access everything</span>
<a name="l7560"><span class="linenum">7560</span></a>      <a class="var it41671" onMouseOver="hilite(41671)" onMouseOut="lolite()" onClick="logVariable('forumsearchfullaccess')" href="../../_variables/forumsearchfullaccess.html">$forumsearchfullaccess</a> = array();
<a name="l7561"><span class="linenum">7561</span></a>  <span class="comment">    // DB caching friendly</span>
<a name="l7562"><span class="linenum">7562</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2);
<a name="l7563"><span class="linenum">7563</span></a>  <span class="comment">    // For each course to search we want to find the forums the user has posted in</span>
<a name="l7564"><span class="linenum">7564</span></a>  <span class="comment">    // and providing the current user can access the forum create a search condition</span>
<a name="l7565"><span class="linenum">7565</span></a>  <span class="comment">    // for the forum to get the requested users posts.</span>
<a name="l7566"><span class="linenum">7566</span></a>      foreach (<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('courses')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/courses.html">courses</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l7567"><span class="linenum">7567</span></a>  <span class="comment">        // Now we need to get the forums</span>
<a name="l7568"><span class="linenum">7568</span></a>          <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l7569"><span class="linenum">7569</span></a>          if (empty(<a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('instances')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/instances.html">instances</a>['forum'])) {
<a name="l7570"><span class="linenum">7570</span></a>  <span class="comment">            // hmmm, no forums? well at least its easy... skip!</span>
<a name="l7571"><span class="linenum">7571</span></a>              continue;
<a name="l7572"><span class="linenum">7572</span></a>          }
<a name="l7573"><span class="linenum">7573</span></a>  <span class="comment">        // Iterate</span>
<a name="l7574"><span class="linenum">7574</span></a>          foreach (<a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_instances_of')" href="../../_functions/get_instances_of.html" onMouseOver="funcPopup(event,'get_instances_of')">get_instances_of</a>('forum') as <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a> =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l7575"><span class="linenum">7575</span></a>              if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('uservisible')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/uservisible.html">uservisible</a> or !isset(<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>])) {
<a name="l7576"><span class="linenum">7576</span></a>                  continue;
<a name="l7577"><span class="linenum">7577</span></a>              }
<a name="l7578"><span class="linenum">7578</span></a>  <span class="comment">            // Get the forum in question</span>
<a name="l7579"><span class="linenum">7579</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>];
<a name="l7580"><span class="linenum">7580</span></a>  
<a name="l7581"><span class="linenum">7581</span></a>  <span class="comment">            // This is needed for functionality later on in the forum code. It is converted to an object</span>
<a name="l7582"><span class="linenum">7582</span></a>  <span class="comment">            // because the cm_info is readonly from 2.6. This is a dirty hack because some other parts of the</span>
<a name="l7583"><span class="linenum">7583</span></a>  <span class="comment">            // code were expecting an writeable object. See {@link forum_print_post()}.</span>
<a name="l7584"><span class="linenum">7584</span></a>              <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('cm')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a> = new stdClass();
<a name="l7585"><span class="linenum">7585</span></a>              foreach (<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l7586"><span class="linenum">7586</span></a>                  <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('cm')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l7587"><span class="linenum">7587</span></a>              }
<a name="l7588"><span class="linenum">7588</span></a>  
<a name="l7589"><span class="linenum">7589</span></a>  <span class="comment">            // Check that either the current user can view the forum, or that the</span>
<a name="l7590"><span class="linenum">7590</span></a>  <span class="comment">            // current user has capabilities over the requested user and the requested</span>
<a name="l7591"><span class="linenum">7591</span></a>  <span class="comment">            // user can view the discussion</span>
<a name="l7592"><span class="linenum">7592</span></a>              if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('context')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>) &amp;&amp; !(<a class="var it41668" onMouseOver="hilite(41668)" onMouseOut="lolite()" onClick="logVariable('hascapsonuser')" href="../../_variables/hascapsonuser.html">$hascapsonuser</a> &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewdiscussion', <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('context')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l7593"><span class="linenum">7593</span></a>                  continue;
<a name="l7594"><span class="linenum">7594</span></a>              }
<a name="l7595"><span class="linenum">7595</span></a>  
<a name="l7596"><span class="linenum">7596</span></a>  <span class="comment">            // This will contain forum specific where clauses</span>
<a name="l7597"><span class="linenum">7597</span></a>              <a class="var it41672" onMouseOver="hilite(41672)" onMouseOut="lolite()" onClick="logVariable('forumsearchselect')" href="../../_variables/forumsearchselect.html">$forumsearchselect</a> = array();
<a name="l7598"><span class="linenum">7598</span></a>              if (!<a class="var it6531" onMouseOver="hilite(6531)" onMouseOut="lolite()" onClick="logVariable('iscurrentuser')" href="../../_variables/iscurrentuser.html">$iscurrentuser</a> &amp;&amp; !<a class="var it41668" onMouseOver="hilite(41668)" onMouseOut="lolite()" onClick="logVariable('hascapsonuser')" href="../../_variables/hascapsonuser.html">$hascapsonuser</a>) {
<a name="l7599"><span class="linenum">7599</span></a>  <span class="comment">                // Make sure we check group access</span>
<a name="l7600"><span class="linenum">7600</span></a>                  if (<a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) == <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a> and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('context')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>)) {
<a name="l7601"><span class="linenum">7601</span></a>                      <a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_groups')" href="../../_functions/get_groups.html" onMouseOver="funcPopup(event,'get_groups')">get_groups</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>);
<a name="l7602"><span class="linenum">7602</span></a>                      <a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>[] = -1;
<a name="l7603"><span class="linenum">7603</span></a>                      <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it41544" onMouseOver="hilite(41544)" onMouseOut="lolite()" onClick="logVariable('groupid_sql')" href="../../_variables/groupid_sql.html">$groupid_sql</a>, <a class="var it41545" onMouseOver="hilite(41545)" onMouseOut="lolite()" onClick="logVariable('groupid_params')" href="../../_variables/groupid_params.html">$groupid_params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it670" onMouseOver="hilite(670)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../_variables/groups.html">$groups</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'grps'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>.'_');
<a name="l7604"><span class="linenum">7604</span></a>                      <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>, <a class="var it41545" onMouseOver="hilite(41545)" onMouseOut="lolite()" onClick="logVariable('groupid_params')" href="../../_variables/groupid_params.html">$groupid_params</a>);
<a name="l7605"><span class="linenum">7605</span></a>                      <a class="var it41672" onMouseOver="hilite(41672)" onMouseOut="lolite()" onClick="logVariable('forumsearchselect')" href="../../_variables/forumsearchselect.html">$forumsearchselect</a>[] = &quot;d.groupid <a class="var it41544" onMouseOver="hilite(41544)" onMouseOut="lolite()" onClick="logVariable('groupid_sql')" href="../../_variables/groupid_sql.html">$groupid_sql</a>&quot;;
<a name="l7606"><span class="linenum">7606</span></a>                  }
<a name="l7607"><span class="linenum">7607</span></a>  
<a name="l7608"><span class="linenum">7608</span></a>  <span class="comment">                // hidden timed discussions</span>
<a name="l7609"><span class="linenum">7609</span></a>                  if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forum_enabletimedposts')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/forum_enabletimedposts.html">forum_enabletimedposts</a>) &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewhiddentimedposts', <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('context')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>)) {
<a name="l7610"><span class="linenum">7610</span></a>                      <a class="var it41672" onMouseOver="hilite(41672)" onMouseOut="lolite()" onClick="logVariable('forumsearchselect')" href="../../_variables/forumsearchselect.html">$forumsearchselect</a>[] = &quot;(d.userid = :userid{<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>} <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (d.timestart &lt; :timestart{<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>} AND (d.timeend = 0 OR d.timeend &gt; :timeend{<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>})))&quot;;
<a name="l7611"><span class="linenum">7611</span></a>                      <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>['userid'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l7612"><span class="linenum">7612</span></a>                      <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>['timestart'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l7613"><span class="linenum">7613</span></a>                      <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>['timeend'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>] = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l7614"><span class="linenum">7614</span></a>                  }
<a name="l7615"><span class="linenum">7615</span></a>  
<a name="l7616"><span class="linenum">7616</span></a>  <span class="comment">                // qanda access</span>
<a name="l7617"><span class="linenum">7617</span></a>                  if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> == 'qanda' &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:viewqandawithoutposting', <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('context')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>)) {
<a name="l7618"><span class="linenum">7618</span></a>  <span class="comment">                    // We need to check whether the user has posted in the qanda forum.</span>
<a name="l7619"><span class="linenum">7619</span></a>                      <a class="var it41540" onMouseOver="hilite(41540)" onMouseOut="lolite()" onClick="logVariable('discussionspostedin')" href="../../_variables/discussionspostedin.html">$discussionspostedin</a> = <a class="function" onClick="logFunction('forum_discussions_user_has_posted_in')" href="../../_functions/forum_discussions_user_has_posted_in.html" onMouseOver="funcPopup(event,'forum_discussions_user_has_posted_in')">forum_discussions_user_has_posted_in</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l7620"><span class="linenum">7620</span></a>                      if (!empty(<a class="var it41540" onMouseOver="hilite(41540)" onMouseOut="lolite()" onClick="logVariable('discussionspostedin')" href="../../_variables/discussionspostedin.html">$discussionspostedin</a>)) {
<a name="l7621"><span class="linenum">7621</span></a>                          <a class="var it41673" onMouseOver="hilite(41673)" onMouseOut="lolite()" onClick="logVariable('forumonlydiscussions')" href="../../_variables/forumonlydiscussions.html">$forumonlydiscussions</a> = array();  <span class="comment">// Holds discussion ids for the discussions the user is allowed to see in this forum.</span>
<a name="l7622"><span class="linenum">7622</span></a>                          foreach (<a class="var it41540" onMouseOver="hilite(41540)" onMouseOut="lolite()" onClick="logVariable('discussionspostedin')" href="../../_variables/discussionspostedin.html">$discussionspostedin</a> as <a class="var it775" onMouseOver="hilite(775)" onMouseOut="lolite()" onClick="logVariable('d')" href="../../_variables/d.html">$d</a>) {
<a name="l7623"><span class="linenum">7623</span></a>                              <a class="var it41673" onMouseOver="hilite(41673)" onMouseOut="lolite()" onClick="logVariable('forumonlydiscussions')" href="../../_variables/forumonlydiscussions.html">$forumonlydiscussions</a>[] = <a class="var it775" onMouseOver="hilite(775)" onMouseOut="lolite()" onClick="logVariable('d')" href="../../_variables/d.html">$d</a>-&gt;<a onClick="logVariable('id')" class="var it43413" onMouseOver="hilite(43413)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l7624"><span class="linenum">7624</span></a>                          }
<a name="l7625"><span class="linenum">7625</span></a>                          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it41542" onMouseOver="hilite(41542)" onMouseOut="lolite()" onClick="logVariable('discussionid_sql')" href="../../_variables/discussionid_sql.html">$discussionid_sql</a>, <a class="var it41543" onMouseOver="hilite(41543)" onMouseOut="lolite()" onClick="logVariable('discussionid_params')" href="../../_variables/discussionid_params.html">$discussionid_params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it41673" onMouseOver="hilite(41673)" onMouseOut="lolite()" onClick="logVariable('forumonlydiscussions')" href="../../_variables/forumonlydiscussions.html">$forumonlydiscussions</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'qanda'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>.'_');
<a name="l7626"><span class="linenum">7626</span></a>                          <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>, <a class="var it41543" onMouseOver="hilite(41543)" onMouseOut="lolite()" onClick="logVariable('discussionid_params')" href="../../_variables/discussionid_params.html">$discussionid_params</a>);
<a name="l7627"><span class="linenum">7627</span></a>                          <a class="var it41672" onMouseOver="hilite(41672)" onMouseOut="lolite()" onClick="logVariable('forumsearchselect')" href="../../_variables/forumsearchselect.html">$forumsearchselect</a>[] = &quot;(d.id <a class="var it41542" onMouseOver="hilite(41542)" onMouseOut="lolite()" onClick="logVariable('discussionid_sql')" href="../../_variables/discussionid_sql.html">$discussionid_sql</a> OR p.parent = 0)&quot;;
<a name="l7628"><span class="linenum">7628</span></a>                      } else {
<a name="l7629"><span class="linenum">7629</span></a>                          <a class="var it41672" onMouseOver="hilite(41672)" onMouseOut="lolite()" onClick="logVariable('forumsearchselect')" href="../../_variables/forumsearchselect.html">$forumsearchselect</a>[] = &quot;p.parent = 0&quot;;
<a name="l7630"><span class="linenum">7630</span></a>                      }
<a name="l7631"><span class="linenum">7631</span></a>  
<a name="l7632"><span class="linenum">7632</span></a>                  }
<a name="l7633"><span class="linenum">7633</span></a>  
<a name="l7634"><span class="linenum">7634</span></a>                  if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it41672" onMouseOver="hilite(41672)" onMouseOut="lolite()" onClick="logVariable('forumsearchselect')" href="../../_variables/forumsearchselect.html">$forumsearchselect</a>) &gt; 0) {
<a name="l7635"><span class="linenum">7635</span></a>                      <a class="var it41669" onMouseOver="hilite(41669)" onMouseOut="lolite()" onClick="logVariable('forumsearchwhere')" href="../../_variables/forumsearchwhere.html">$forumsearchwhere</a>[] = &quot;(d.forum = :forum{<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>} AND &quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot; AND &quot;, <a class="var it41672" onMouseOver="hilite(41672)" onMouseOut="lolite()" onClick="logVariable('forumsearchselect')" href="../../_variables/forumsearchselect.html">$forumsearchselect</a>).&quot;)&quot;;
<a name="l7636"><span class="linenum">7636</span></a>                      <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>['forum'.<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>] = <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>;
<a name="l7637"><span class="linenum">7637</span></a>                  } else {
<a name="l7638"><span class="linenum">7638</span></a>                      <a class="var it41671" onMouseOver="hilite(41671)" onMouseOut="lolite()" onClick="logVariable('forumsearchfullaccess')" href="../../_variables/forumsearchfullaccess.html">$forumsearchfullaccess</a>[] = <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>;
<a name="l7639"><span class="linenum">7639</span></a>                  }
<a name="l7640"><span class="linenum">7640</span></a>              } else {
<a name="l7641"><span class="linenum">7641</span></a>  <span class="comment">                // The current user/parent can see all of their own posts</span>
<a name="l7642"><span class="linenum">7642</span></a>                  <a class="var it41671" onMouseOver="hilite(41671)" onMouseOut="lolite()" onClick="logVariable('forumsearchfullaccess')" href="../../_variables/forumsearchfullaccess.html">$forumsearchfullaccess</a>[] = <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>;
<a name="l7643"><span class="linenum">7643</span></a>              }
<a name="l7644"><span class="linenum">7644</span></a>          }
<a name="l7645"><span class="linenum">7645</span></a>      }
<a name="l7646"><span class="linenum">7646</span></a>  
<a name="l7647"><span class="linenum">7647</span></a>  <span class="comment">    // If we dont have any search conditions, and we don't have any forums where</span>
<a name="l7648"><span class="linenum">7648</span></a>  <span class="comment">    // the user has full access then we just return the default.</span>
<a name="l7649"><span class="linenum">7649</span></a>      if (empty(<a class="var it41669" onMouseOver="hilite(41669)" onMouseOut="lolite()" onClick="logVariable('forumsearchwhere')" href="../../_variables/forumsearchwhere.html">$forumsearchwhere</a>) &amp;&amp; empty(<a class="var it41671" onMouseOver="hilite(41671)" onMouseOut="lolite()" onClick="logVariable('forumsearchfullaccess')" href="../../_variables/forumsearchfullaccess.html">$forumsearchfullaccess</a>)) {
<a name="l7650"><span class="linenum">7650</span></a>          return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l7651"><span class="linenum">7651</span></a>      }
<a name="l7652"><span class="linenum">7652</span></a>  
<a name="l7653"><span class="linenum">7653</span></a>  <span class="comment">    // Prepare a where condition for the full access forums.</span>
<a name="l7654"><span class="linenum">7654</span></a>      if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it41671" onMouseOver="hilite(41671)" onMouseOut="lolite()" onClick="logVariable('forumsearchfullaccess')" href="../../_variables/forumsearchfullaccess.html">$forumsearchfullaccess</a>) &gt; 0) {
<a name="l7655"><span class="linenum">7655</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it41674" onMouseOver="hilite(41674)" onMouseOut="lolite()" onClick="logVariable('fullidsql')" href="../../_variables/fullidsql.html">$fullidsql</a>, <a class="var it41675" onMouseOver="hilite(41675)" onMouseOut="lolite()" onClick="logVariable('fullidparams')" href="../../_variables/fullidparams.html">$fullidparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it41671" onMouseOver="hilite(41671)" onMouseOut="lolite()" onClick="logVariable('forumsearchfullaccess')" href="../../_variables/forumsearchfullaccess.html">$forumsearchfullaccess</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'fula');
<a name="l7656"><span class="linenum">7656</span></a>          <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>, <a class="var it41675" onMouseOver="hilite(41675)" onMouseOut="lolite()" onClick="logVariable('fullidparams')" href="../../_variables/fullidparams.html">$fullidparams</a>);
<a name="l7657"><span class="linenum">7657</span></a>          <a class="var it41669" onMouseOver="hilite(41669)" onMouseOut="lolite()" onClick="logVariable('forumsearchwhere')" href="../../_variables/forumsearchwhere.html">$forumsearchwhere</a>[] = &quot;(d.forum <a class="var it41674" onMouseOver="hilite(41674)" onMouseOut="lolite()" onClick="logVariable('fullidsql')" href="../../_variables/fullidsql.html">$fullidsql</a>)&quot;;
<a name="l7658"><span class="linenum">7658</span></a>      }
<a name="l7659"><span class="linenum">7659</span></a>  
<a name="l7660"><span class="linenum">7660</span></a>  <span class="comment">    // Prepare SQL to both count and search.</span>
<a name="l7661"><span class="linenum">7661</span></a>  <span class="comment">    // We alias user.id to useridx because we forum_posts already has a userid field and not aliasing this would break</span>
<a name="l7662"><span class="linenum">7662</span></a>  <span class="comment">    // oracle and mssql.</span>
<a name="l7663"><span class="linenum">7663</span></a>      <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = <a class="class" onClick="logClass('user_picture')" href="../../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('u', null, 'useridx');
<a name="l7664"><span class="linenum">7664</span></a>      <a class="var it5529" onMouseOver="hilite(5529)" onMouseOut="lolite()" onClick="logVariable('countsql')" href="../../_variables/countsql.html">$countsql</a> = 'SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) ';
<a name="l7665"><span class="linenum">7665</span></a>      <a class="var it12567" onMouseOver="hilite(12567)" onMouseOut="lolite()" onClick="logVariable('selectsql')" href="../../_variables/selectsql.html">$selectsql</a> = 'SELECT p.*, d.forum, d.name AS discussionname, '.<a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>.' ';
<a name="l7666"><span class="linenum">7666</span></a>      <a class="var it5302" onMouseOver="hilite(5302)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot; OR &quot;, <a class="var it41669" onMouseOver="hilite(41669)" onMouseOut="lolite()" onClick="logVariable('forumsearchwhere')" href="../../_variables/forumsearchwhere.html">$forumsearchwhere</a>);
<a name="l7667"><span class="linenum">7667</span></a>  
<a name="l7668"><span class="linenum">7668</span></a>      if (<a class="var it16022" onMouseOver="hilite(16022)" onMouseOut="lolite()" onClick="logVariable('discussionsonly')" href="../../_variables/discussionsonly.html">$discussionsonly</a>) {
<a name="l7669"><span class="linenum">7669</span></a>          if (<a class="var it5302" onMouseOver="hilite(5302)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a> == '') {
<a name="l7670"><span class="linenum">7670</span></a>              <a class="var it5302" onMouseOver="hilite(5302)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a> = 'p.parent = 0';
<a name="l7671"><span class="linenum">7671</span></a>          } else {
<a name="l7672"><span class="linenum">7672</span></a>              <a class="var it5302" onMouseOver="hilite(5302)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a> = 'p.parent = 0 AND ('.<a class="var it5302" onMouseOver="hilite(5302)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a>.')';
<a name="l7673"><span class="linenum">7673</span></a>          }
<a name="l7674"><span class="linenum">7674</span></a>      }
<a name="l7675"><span class="linenum">7675</span></a>  
<a name="l7676"><span class="linenum">7676</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;FROM {forum_posts} p
<a name="l7677"><span class="linenum">7677</span></a>              JOIN {forum_discussions} d ON d.id = p.discussion
<a name="l7678"><span class="linenum">7678</span></a>              JOIN {user} u ON u.id = p.userid
<a name="l7679"><span class="linenum">7679</span></a>             <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (<a class="var it5302" onMouseOver="hilite(5302)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a>)
<a name="l7680"><span class="linenum">7680</span></a>               AND p.userid = :userid &quot;;
<a name="l7681"><span class="linenum">7681</span></a>      <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a> = &quot;ORDER BY p.modified DESC&quot;;
<a name="l7682"><span class="linenum">7682</span></a>      <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>['userid'] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l7683"><span class="linenum">7683</span></a>  
<a name="l7684"><span class="linenum">7684</span></a>  <span class="comment">    // Set the total number posts made by the requested user that the current user can see</span>
<a name="l7685"><span class="linenum">7685</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('totalcount')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/totalcount.html">totalcount</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it5529" onMouseOver="hilite(5529)" onMouseOut="lolite()" onClick="logVariable('countsql')" href="../../_variables/countsql.html">$countsql</a>.<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>);
<a name="l7686"><span class="linenum">7686</span></a>  <span class="comment">    // Set the collection of posts that has been requested</span>
<a name="l7687"><span class="linenum">7687</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('posts')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/posts.html">posts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it12567" onMouseOver="hilite(12567)" onMouseOut="lolite()" onClick="logVariable('selectsql')" href="../../_variables/selectsql.html">$selectsql</a>.<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>.<a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a>, <a class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" onClick="logVariable('forumsearchparams')" href="../../_variables/forumsearchparams.html">$forumsearchparams</a>, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../_variables/limitfrom.html">$limitfrom</a>, <a class="var it1014" onMouseOver="hilite(1014)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../../_variables/limitnum.html">$limitnum</a>);
<a name="l7688"><span class="linenum">7688</span></a>  
<a name="l7689"><span class="linenum">7689</span></a>  <span class="comment">    // We need to build an array of forums for which posts will be displayed.</span>
<a name="l7690"><span class="linenum">7690</span></a>  <span class="comment">    // We do this here to save the caller needing to retrieve them themselves before</span>
<a name="l7691"><span class="linenum">7691</span></a>  <span class="comment">    // printing these forums posts. Given we have the forums already there is</span>
<a name="l7692"><span class="linenum">7692</span></a>  <span class="comment">    // practically no overhead here.</span>
<a name="l7693"><span class="linenum">7693</span></a>      foreach (<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('posts')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/posts.html">posts</a> as <a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>) {
<a name="l7694"><span class="linenum">7694</span></a>          if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('forums')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/forums.html">forums</a>)) {
<a name="l7695"><span class="linenum">7695</span></a>              <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('forums')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/forums.html">forums</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>] = <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../_variables/forums.html">$forums</a>[<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('forum')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a>];
<a name="l7696"><span class="linenum">7696</span></a>          }
<a name="l7697"><span class="linenum">7697</span></a>      }
<a name="l7698"><span class="linenum">7698</span></a>  
<a name="l7699"><span class="linenum">7699</span></a>      return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l7700"><span class="linenum">7700</span></a>  }
<a name="l7701"><span class="linenum">7701</span></a>  
<a name="l7702"><span class="linenum">7702</span></a>  <span class="comment">/**</span>
<a name="l7703"><span class="linenum">7703</span></a>  <span class="comment"> * Set the per-forum maildigest option for the specified user.</span>
<a name="l7704"><span class="linenum">7704</span></a>  <span class="comment"> *</span>
<a name="l7705"><span class="linenum">7705</span></a>  <span class="comment"> * @param stdClass $forum The forum to set the option for.</span>
<a name="l7706"><span class="linenum">7706</span></a>  <span class="comment"> * @param int $maildigest The maildigest option.</span>
<a name="l7707"><span class="linenum">7707</span></a>  <span class="comment"> * @param stdClass $user The user object. This defaults to the global $USER object.</span>
<a name="l7708"><span class="linenum">7708</span></a>  <span class="comment"> * @throws invalid_digest_setting thrown if an invalid maildigest option is provided.</span>
<a name="l7709"><span class="linenum">7709</span></a>  <span class="comment"> */</span>
<a name="l7710"><span class="linenum">7710</span></a>  function <a class="function" onClick="logFunction('forum_set_user_maildigest')" href="../../_functions/forum_set_user_maildigest.html" onMouseOver="funcPopup(event,'forum_set_user_maildigest')">forum_set_user_maildigest</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = null) {
<a name="l7711"><span class="linenum">7711</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l7712"><span class="linenum">7712</span></a>  
<a name="l7713"><span class="linenum">7713</span></a>      if (<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>)) {
<a name="l7714"><span class="linenum">7714</span></a>          <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum', array('id' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>));
<a name="l7715"><span class="linenum">7715</span></a>      }
<a name="l7716"><span class="linenum">7716</span></a>  
<a name="l7717"><span class="linenum">7717</span></a>      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> === null) {
<a name="l7718"><span class="linenum">7718</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l7719"><span class="linenum">7719</span></a>      }
<a name="l7720"><span class="linenum">7720</span></a>  
<a name="l7721"><span class="linenum">7721</span></a>      <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>  = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l7722"><span class="linenum">7722</span></a>      <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>      = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, false, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l7723"><span class="linenum">7723</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l7724"><span class="linenum">7724</span></a>  
<a name="l7725"><span class="linenum">7725</span></a>  <span class="comment">    // User must be allowed to see this forum.</span>
<a name="l7726"><span class="linenum">7726</span></a>      <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('mod/forum:viewdiscussion', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l7727"><span class="linenum">7727</span></a>  
<a name="l7728"><span class="linenum">7728</span></a>  <span class="comment">    // Validate the maildigest setting.</span>
<a name="l7729"><span class="linenum">7729</span></a>      <a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a> = <a class="function" onClick="logFunction('forum_get_user_digest_options')" href="../../_functions/forum_get_user_digest_options.html" onMouseOver="funcPopup(event,'forum_get_user_digest_options')">forum_get_user_digest_options</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l7730"><span class="linenum">7730</span></a>  
<a name="l7731"><span class="linenum">7731</span></a>      if (!isset(<a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a>[<a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a>])) {
<a name="l7732"><span class="linenum">7732</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invaliddigestsetting', 'mod_forum');
<a name="l7733"><span class="linenum">7733</span></a>      }
<a name="l7734"><span class="linenum">7734</span></a>  
<a name="l7735"><span class="linenum">7735</span></a>  <span class="comment">    // Attempt to retrieve any existing forum digest record.</span>
<a name="l7736"><span class="linenum">7736</span></a>      <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_digests', array(
<a name="l7737"><span class="linenum">7737</span></a>          'userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l7738"><span class="linenum">7738</span></a>          'forum' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l7739"><span class="linenum">7739</span></a>      ));
<a name="l7740"><span class="linenum">7740</span></a>  
<a name="l7741"><span class="linenum">7741</span></a>  <span class="comment">    // Create or Update the existing maildigest setting.</span>
<a name="l7742"><span class="linenum">7742</span></a>      if (<a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a>) {
<a name="l7743"><span class="linenum">7743</span></a>          if (<a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> == -1) {
<a name="l7744"><span class="linenum">7744</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_digests', array('forum' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l7745"><span class="linenum">7745</span></a>          } else if (<a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> !== <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('maildigest')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../_variables/maildigest.html">maildigest</a>) {
<a name="l7746"><span class="linenum">7746</span></a>  <span class="comment">            // Only update the maildigest setting if it's changed.</span>
<a name="l7747"><span class="linenum">7747</span></a>  
<a name="l7748"><span class="linenum">7748</span></a>              <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('maildigest')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../_variables/maildigest.html">maildigest</a> = <a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a>;
<a name="l7749"><span class="linenum">7749</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_digests', <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a>);
<a name="l7750"><span class="linenum">7750</span></a>          }
<a name="l7751"><span class="linenum">7751</span></a>      } else {
<a name="l7752"><span class="linenum">7752</span></a>          if (<a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> != -1) {
<a name="l7753"><span class="linenum">7753</span></a>  <span class="comment">            // Only insert the maildigest setting if it's non-default.</span>
<a name="l7754"><span class="linenum">7754</span></a>  
<a name="l7755"><span class="linenum">7755</span></a>              <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a> = new stdClass();
<a name="l7756"><span class="linenum">7756</span></a>              <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('forum')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../_variables/forum.html">forum</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l7757"><span class="linenum">7757</span></a>              <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('userid')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l7758"><span class="linenum">7758</span></a>              <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('maildigest')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../_variables/maildigest.html">maildigest</a> = <a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a>;
<a name="l7759"><span class="linenum">7759</span></a>              <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('id')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('forum_digests', <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../_variables/subscription.html">$subscription</a>);
<a name="l7760"><span class="linenum">7760</span></a>          }
<a name="l7761"><span class="linenum">7761</span></a>      }
<a name="l7762"><span class="linenum">7762</span></a>  }
<a name="l7763"><span class="linenum">7763</span></a>  
<a name="l7764"><span class="linenum">7764</span></a>  <span class="comment">/**</span>
<a name="l7765"><span class="linenum">7765</span></a>  <span class="comment"> * Determine the maildigest setting for the specified user against the</span>
<a name="l7766"><span class="linenum">7766</span></a>  <span class="comment"> * specified forum.</span>
<a name="l7767"><span class="linenum">7767</span></a>  <span class="comment"> *</span>
<a name="l7768"><span class="linenum">7768</span></a>  <span class="comment"> * @param Array $digests An array of forums and user digest settings.</span>
<a name="l7769"><span class="linenum">7769</span></a>  <span class="comment"> * @param stdClass $user The user object containing the id and maildigest default.</span>
<a name="l7770"><span class="linenum">7770</span></a>  <span class="comment"> * @param int $forumid The ID of the forum to check.</span>
<a name="l7771"><span class="linenum">7771</span></a>  <span class="comment"> * @return int The calculated maildigest setting for this user and forum.</span>
<a name="l7772"><span class="linenum">7772</span></a>  <span class="comment"> */</span>
<a name="l7773"><span class="linenum">7773</span></a>  function <a class="function" onClick="logFunction('forum_get_user_maildigest_bulk')" href="../../_functions/forum_get_user_maildigest_bulk.html" onMouseOver="funcPopup(event,'forum_get_user_maildigest_bulk')">forum_get_user_maildigest_bulk</a>(<a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>) {
<a name="l7774"><span class="linenum">7774</span></a>      if (isset(<a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>]) &amp;&amp; isset(<a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>][<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>])) {
<a name="l7775"><span class="linenum">7775</span></a>          <a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> = <a class="var it36009" onMouseOver="hilite(36009)" onMouseOut="lolite()" onClick="logVariable('digests')" href="../../_variables/digests.html">$digests</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>][<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l7776"><span class="linenum">7776</span></a>          if (<a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> === -1) {
<a name="l7777"><span class="linenum">7777</span></a>              <a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('maildigest')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/maildigest.html">maildigest</a>;
<a name="l7778"><span class="linenum">7778</span></a>          }
<a name="l7779"><span class="linenum">7779</span></a>      } else {
<a name="l7780"><span class="linenum">7780</span></a>          <a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('maildigest')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/maildigest.html">maildigest</a>;
<a name="l7781"><span class="linenum">7781</span></a>      }
<a name="l7782"><span class="linenum">7782</span></a>      return <a class="var it502" onMouseOver="hilite(502)" onMouseOut="lolite()" onClick="logVariable('maildigest')" href="../../_variables/maildigest.html">$maildigest</a>;
<a name="l7783"><span class="linenum">7783</span></a>  }
<a name="l7784"><span class="linenum">7784</span></a>  
<a name="l7785"><span class="linenum">7785</span></a>  <span class="comment">/**</span>
<a name="l7786"><span class="linenum">7786</span></a>  <span class="comment"> * Retrieve the list of available user digest options.</span>
<a name="l7787"><span class="linenum">7787</span></a>  <span class="comment"> *</span>
<a name="l7788"><span class="linenum">7788</span></a>  <span class="comment"> * @param stdClass $user The user object. This defaults to the global $USER object.</span>
<a name="l7789"><span class="linenum">7789</span></a>  <span class="comment"> * @return array The mapping of values to digest options.</span>
<a name="l7790"><span class="linenum">7790</span></a>  <span class="comment"> */</span>
<a name="l7791"><span class="linenum">7791</span></a>  function <a class="function" onClick="logFunction('forum_get_user_digest_options')" href="../../_functions/forum_get_user_digest_options.html" onMouseOver="funcPopup(event,'forum_get_user_digest_options')">forum_get_user_digest_options</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = null) {
<a name="l7792"><span class="linenum">7792</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l7793"><span class="linenum">7793</span></a>  
<a name="l7794"><span class="linenum">7794</span></a>  <span class="comment">    // Revert to the global user object.</span>
<a name="l7795"><span class="linenum">7795</span></a>      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> === null) {
<a name="l7796"><span class="linenum">7796</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l7797"><span class="linenum">7797</span></a>      }
<a name="l7798"><span class="linenum">7798</span></a>  
<a name="l7799"><span class="linenum">7799</span></a>      <a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a> = array();
<a name="l7800"><span class="linenum">7800</span></a>      <a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a>['0']  = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('emaildigestoffshort', 'mod_forum');
<a name="l7801"><span class="linenum">7801</span></a>      <a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a>['1']  = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('emaildigestcompleteshort', 'mod_forum');
<a name="l7802"><span class="linenum">7802</span></a>      <a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a>['2']  = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('emaildigestsubjectsshort', 'mod_forum');
<a name="l7803"><span class="linenum">7803</span></a>  
<a name="l7804"><span class="linenum">7804</span></a>  <span class="comment">    // We need to add the default digest option at the end - it relies on</span>
<a name="l7805"><span class="linenum">7805</span></a>  <span class="comment">    // the contents of the existing values.</span>
<a name="l7806"><span class="linenum">7806</span></a>      <a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a>['-1'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('emaildigestdefault', 'mod_forum',
<a name="l7807"><span class="linenum">7807</span></a>              <a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('maildigest')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/maildigest.html">maildigest</a>]);
<a name="l7808"><span class="linenum">7808</span></a>  
<a name="l7809"><span class="linenum">7809</span></a>  <span class="comment">    // Resort the options to be in a sensible order.</span>
<a name="l7810"><span class="linenum">7810</span></a>      <a class="phpfunction" onClick="logFunction('ksort')" href="../../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a>);
<a name="l7811"><span class="linenum">7811</span></a>  
<a name="l7812"><span class="linenum">7812</span></a>      return <a class="var it505" onMouseOver="hilite(505)" onMouseOut="lolite()" onClick="logVariable('digestoptions')" href="../../_variables/digestoptions.html">$digestoptions</a>;
<a name="l7813"><span class="linenum">7813</span></a>  }
<a name="l7814"><span class="linenum">7814</span></a>  
<a name="l7815"><span class="linenum">7815</span></a>  <span class="comment">/**</span>
<a name="l7816"><span class="linenum">7816</span></a>  <span class="comment"> * Determine the current context if one was not already specified.</span>
<a name="l7817"><span class="linenum">7817</span></a>  <span class="comment"> *</span>
<a name="l7818"><span class="linenum">7818</span></a>  <span class="comment"> * If a context of type context_module is specified, it is immediately</span>
<a name="l7819"><span class="linenum">7819</span></a>  <span class="comment"> * returned and not checked.</span>
<a name="l7820"><span class="linenum">7820</span></a>  <span class="comment"> *</span>
<a name="l7821"><span class="linenum">7821</span></a>  <span class="comment"> * @param int $forumid The ID of the forum</span>
<a name="l7822"><span class="linenum">7822</span></a>  <span class="comment"> * @param context_module $context The current context.</span>
<a name="l7823"><span class="linenum">7823</span></a>  <span class="comment"> * @return context_module The context determined</span>
<a name="l7824"><span class="linenum">7824</span></a>  <span class="comment"> */</span>
<a name="l7825"><span class="linenum">7825</span></a>  function <a class="function" onClick="logFunction('forum_get_context')" href="../../_functions/forum_get_context.html" onMouseOver="funcPopup(event,'forum_get_context')">forum_get_context</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = null) {
<a name="l7826"><span class="linenum">7826</span></a>      global <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>;
<a name="l7827"><span class="linenum">7827</span></a>  
<a name="l7828"><span class="linenum">7828</span></a>      if (!<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> || !(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> instanceof context_module)) {
<a name="l7829"><span class="linenum">7829</span></a>  <span class="comment">        // Find out forum context. First try to take current page context to save on DB query.</span>
<a name="l7830"><span class="linenum">7830</span></a>          if (<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a> &amp;&amp; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;modname === 'forum' &amp;&amp; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;instance == <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>
<a name="l7831"><span class="linenum">7831</span></a>                  &amp;&amp; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('context')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>-&gt;contextlevel == <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a> &amp;&amp; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('context')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>-&gt;instanceid == <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id) {
<a name="l7832"><span class="linenum">7832</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('context')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>;
<a name="l7833"><span class="linenum">7833</span></a>          } else {
<a name="l7834"><span class="linenum">7834</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../_variables/forumid.html">$forumid</a>);
<a name="l7835"><span class="linenum">7835</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = \<a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l7836"><span class="linenum">7836</span></a>          }
<a name="l7837"><span class="linenum">7837</span></a>      }
<a name="l7838"><span class="linenum">7838</span></a>  
<a name="l7839"><span class="linenum">7839</span></a>      return <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>;
<a name="l7840"><span class="linenum">7840</span></a>  }
<a name="l7841"><span class="linenum">7841</span></a>  
<a name="l7842"><span class="linenum">7842</span></a>  <span class="comment">/**</span>
<a name="l7843"><span class="linenum">7843</span></a>  <span class="comment"> * Mark the activity completed (if required) and trigger the course_module_viewed event.</span>
<a name="l7844"><span class="linenum">7844</span></a>  <span class="comment"> *</span>
<a name="l7845"><span class="linenum">7845</span></a>  <span class="comment"> * @param  stdClass $forum   forum object</span>
<a name="l7846"><span class="linenum">7846</span></a>  <span class="comment"> * @param  stdClass $course  course object</span>
<a name="l7847"><span class="linenum">7847</span></a>  <span class="comment"> * @param  stdClass $cm      course module object</span>
<a name="l7848"><span class="linenum">7848</span></a>  <span class="comment"> * @param  stdClass $context context object</span>
<a name="l7849"><span class="linenum">7849</span></a>  <span class="comment"> * @since Moodle 2.9</span>
<a name="l7850"><span class="linenum">7850</span></a>  <span class="comment"> */</span>
<a name="l7851"><span class="linenum">7851</span></a>  function <a class="function" onClick="logFunction('forum_view')" href="../../_functions/forum_view.html" onMouseOver="funcPopup(event,'forum_view')">forum_view</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l7852"><span class="linenum">7852</span></a>  
<a name="l7853"><span class="linenum">7853</span></a>  <span class="comment">    // Completion.</span>
<a name="l7854"><span class="linenum">7854</span></a>      <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a> = <span class="keyword">new </span><a class="class" onClick="logClass('completion_info')" href="../../_classes/completion_info.html" onMouseOver="classPopup(event,'completion_info')">completion_info</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l7855"><span class="linenum">7855</span></a>      <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('set_module_viewed')" href="../../_functions/set_module_viewed.html" onMouseOver="funcPopup(event,'set_module_viewed')">set_module_viewed</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l7856"><span class="linenum">7856</span></a>  
<a name="l7857"><span class="linenum">7857</span></a>  <span class="comment">    // Trigger course_module_viewed event.</span>
<a name="l7858"><span class="linenum">7858</span></a>  
<a name="l7859"><span class="linenum">7859</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l7860"><span class="linenum">7860</span></a>          'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>,
<a name="l7861"><span class="linenum">7861</span></a>          'objectid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;id
<a name="l7862"><span class="linenum">7862</span></a>      );
<a name="l7863"><span class="linenum">7863</span></a>  
<a name="l7864"><span class="linenum">7864</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \mod_forum\event\<a class="class" onClick="logClass('course_module_viewed')" href="../../_classes/course_module_viewed.html" onMouseOver="classPopup(event,'course_module_viewed')">course_module_viewed</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l7865"><span class="linenum">7865</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('course_modules', <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l7866"><span class="linenum">7866</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('course', <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l7867"><span class="linenum">7867</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l7868"><span class="linenum">7868</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l7869"><span class="linenum">7869</span></a>  }
<a name="l7870"><span class="linenum">7870</span></a>  
<a name="l7871"><span class="linenum">7871</span></a>  <span class="comment">/**</span>
<a name="l7872"><span class="linenum">7872</span></a>  <span class="comment"> * Trigger the discussion viewed event</span>
<a name="l7873"><span class="linenum">7873</span></a>  <span class="comment"> *</span>
<a name="l7874"><span class="linenum">7874</span></a>  <span class="comment"> * @param  stdClass $modcontext module context object</span>
<a name="l7875"><span class="linenum">7875</span></a>  <span class="comment"> * @param  stdClass $forum      forum object</span>
<a name="l7876"><span class="linenum">7876</span></a>  <span class="comment"> * @param  stdClass $discussion discussion object</span>
<a name="l7877"><span class="linenum">7877</span></a>  <span class="comment"> * @since Moodle 2.9</span>
<a name="l7878"><span class="linenum">7878</span></a>  <span class="comment"> */</span>
<a name="l7879"><span class="linenum">7879</span></a>  function <a class="function" onClick="logFunction('forum_discussion_view')" href="../../_functions/forum_discussion_view.html" onMouseOver="funcPopup(event,'forum_discussion_view')">forum_discussion_view</a>(<a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>) {
<a name="l7880"><span class="linenum">7880</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l7881"><span class="linenum">7881</span></a>          'context' =&gt; <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>,
<a name="l7882"><span class="linenum">7882</span></a>          'objectid' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l7883"><span class="linenum">7883</span></a>      );
<a name="l7884"><span class="linenum">7884</span></a>  
<a name="l7885"><span class="linenum">7885</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \mod_forum\event\<a class="class" onClick="logClass('discussion_viewed')" href="../../_classes/discussion_viewed.html" onMouseOver="classPopup(event,'discussion_viewed')">discussion_viewed</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l7886"><span class="linenum">7886</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('forum_discussions', <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>);
<a name="l7887"><span class="linenum">7887</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>);
<a name="l7888"><span class="linenum">7888</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l7889"><span class="linenum">7889</span></a>  }
<a name="l7890"><span class="linenum">7890</span></a>  
<a name="l7891"><span class="linenum">7891</span></a>  <span class="comment">/**</span>
<a name="l7892"><span class="linenum">7892</span></a>  <span class="comment"> * Set the discussion to pinned and trigger the discussion pinned event</span>
<a name="l7893"><span class="linenum">7893</span></a>  <span class="comment"> *</span>
<a name="l7894"><span class="linenum">7894</span></a>  <span class="comment"> * @param  stdClass $modcontext module context object</span>
<a name="l7895"><span class="linenum">7895</span></a>  <span class="comment"> * @param  stdClass $forum      forum object</span>
<a name="l7896"><span class="linenum">7896</span></a>  <span class="comment"> * @param  stdClass $discussion discussion object</span>
<a name="l7897"><span class="linenum">7897</span></a>  <span class="comment"> * @since Moodle 3.1</span>
<a name="l7898"><span class="linenum">7898</span></a>  <span class="comment"> */</span>
<a name="l7899"><span class="linenum">7899</span></a>  function <a class="function" onClick="logFunction('forum_discussion_pin')" href="../../_functions/forum_discussion_pin.html" onMouseOver="funcPopup(event,'forum_discussion_pin')">forum_discussion_pin</a>(<a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>) {
<a name="l7900"><span class="linenum">7900</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l7901"><span class="linenum">7901</span></a>  
<a name="l7902"><span class="linenum">7902</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('forum_discussions', 'pinned', <a class="constant" onClick="logConstant('FORUM_DISCUSSION_PINNED')" href="../../_constants/FORUM_DISCUSSION_PINNED.html" onMouseOver="constPopup(event,'FORUM_DISCUSSION_PINNED')">FORUM_DISCUSSION_PINNED</a>, array('id' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l7903"><span class="linenum">7903</span></a>  
<a name="l7904"><span class="linenum">7904</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l7905"><span class="linenum">7905</span></a>          'context' =&gt; <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>,
<a name="l7906"><span class="linenum">7906</span></a>          'objectid' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l7907"><span class="linenum">7907</span></a>          'other' =&gt; array('forumid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)
<a name="l7908"><span class="linenum">7908</span></a>      );
<a name="l7909"><span class="linenum">7909</span></a>  
<a name="l7910"><span class="linenum">7910</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \mod_forum\event\<a class="class" onClick="logClass('discussion_pinned')" href="../../_classes/discussion_pinned.html" onMouseOver="classPopup(event,'discussion_pinned')">discussion_pinned</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l7911"><span class="linenum">7911</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('forum_discussions', <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>);
<a name="l7912"><span class="linenum">7912</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l7913"><span class="linenum">7913</span></a>  }
<a name="l7914"><span class="linenum">7914</span></a>  
<a name="l7915"><span class="linenum">7915</span></a>  <span class="comment">/**</span>
<a name="l7916"><span class="linenum">7916</span></a>  <span class="comment"> * Set discussion to unpinned and trigger the discussion unpin event</span>
<a name="l7917"><span class="linenum">7917</span></a>  <span class="comment"> *</span>
<a name="l7918"><span class="linenum">7918</span></a>  <span class="comment"> * @param  stdClass $modcontext module context object</span>
<a name="l7919"><span class="linenum">7919</span></a>  <span class="comment"> * @param  stdClass $forum      forum object</span>
<a name="l7920"><span class="linenum">7920</span></a>  <span class="comment"> * @param  stdClass $discussion discussion object</span>
<a name="l7921"><span class="linenum">7921</span></a>  <span class="comment"> * @since Moodle 3.1</span>
<a name="l7922"><span class="linenum">7922</span></a>  <span class="comment"> */</span>
<a name="l7923"><span class="linenum">7923</span></a>  function <a class="function" onClick="logFunction('forum_discussion_unpin')" href="../../_functions/forum_discussion_unpin.html" onMouseOver="funcPopup(event,'forum_discussion_unpin')">forum_discussion_unpin</a>(<a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>) {
<a name="l7924"><span class="linenum">7924</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l7925"><span class="linenum">7925</span></a>  
<a name="l7926"><span class="linenum">7926</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('forum_discussions', 'pinned', <a class="constant" onClick="logConstant('FORUM_DISCUSSION_UNPINNED')" href="../../_constants/FORUM_DISCUSSION_UNPINNED.html" onMouseOver="constPopup(event,'FORUM_DISCUSSION_UNPINNED')">FORUM_DISCUSSION_UNPINNED</a>, array('id' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l7927"><span class="linenum">7927</span></a>  
<a name="l7928"><span class="linenum">7928</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l7929"><span class="linenum">7929</span></a>          'context' =&gt; <a class="var it2714" onMouseOver="hilite(2714)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../../_variables/modcontext.html">$modcontext</a>,
<a name="l7930"><span class="linenum">7930</span></a>          'objectid' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l7931"><span class="linenum">7931</span></a>          'other' =&gt; array('forumid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)
<a name="l7932"><span class="linenum">7932</span></a>      );
<a name="l7933"><span class="linenum">7933</span></a>  
<a name="l7934"><span class="linenum">7934</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \mod_forum\event\<a class="class" onClick="logClass('discussion_unpinned')" href="../../_classes/discussion_unpinned.html" onMouseOver="classPopup(event,'discussion_unpinned')">discussion_unpinned</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l7935"><span class="linenum">7935</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('forum_discussions', <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../_variables/discussion.html">$discussion</a>);
<a name="l7936"><span class="linenum">7936</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l7937"><span class="linenum">7937</span></a>  }
<a name="l7938"><span class="linenum">7938</span></a>  
<a name="l7939"><span class="linenum">7939</span></a>  <span class="comment">/**</span>
<a name="l7940"><span class="linenum">7940</span></a>  <span class="comment"> * Add nodes to myprofile page.</span>
<a name="l7941"><span class="linenum">7941</span></a>  <span class="comment"> *</span>
<a name="l7942"><span class="linenum">7942</span></a>  <span class="comment"> * @param \core_user\output\myprofile\tree $tree Tree object</span>
<a name="l7943"><span class="linenum">7943</span></a>  <span class="comment"> * @param stdClass $user user object</span>
<a name="l7944"><span class="linenum">7944</span></a>  <span class="comment"> * @param bool $iscurrentuser</span>
<a name="l7945"><span class="linenum">7945</span></a>  <span class="comment"> * @param stdClass $course Course object</span>
<a name="l7946"><span class="linenum">7946</span></a>  <span class="comment"> *</span>
<a name="l7947"><span class="linenum">7947</span></a>  <span class="comment"> * @return bool</span>
<a name="l7948"><span class="linenum">7948</span></a>  <span class="comment"> */</span>
<a name="l7949"><span class="linenum">7949</span></a>  function <a class="function" onClick="logFunction('mod_forum_myprofile_navigation')" href="../../_functions/mod_forum_myprofile_navigation.html" onMouseOver="funcPopup(event,'mod_forum_myprofile_navigation')">mod_forum_myprofile_navigation</a>(core_user\output\myprofile\tree <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it6531" onMouseOver="hilite(6531)" onMouseOut="lolite()" onClick="logVariable('iscurrentuser')" href="../../_variables/iscurrentuser.html">$iscurrentuser</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l7950"><span class="linenum">7950</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l7951"><span class="linenum">7951</span></a>  <span class="comment">        // The guest user cannot post, so it is not possible to view any posts.</span>
<a name="l7952"><span class="linenum">7952</span></a>  <span class="comment">        // May as well just bail aggressively here.</span>
<a name="l7953"><span class="linenum">7953</span></a>          return false;
<a name="l7954"><span class="linenum">7954</span></a>      }
<a name="l7955"><span class="linenum">7955</span></a>      <a class="var it41676" onMouseOver="hilite(41676)" onMouseOut="lolite()" onClick="logVariable('postsurl')" href="../../_variables/postsurl.html">$postsurl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/user.php.html">/mod/forum/user.php</a>', array('id' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l7956"><span class="linenum">7956</span></a>      if (!empty(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>)) {
<a name="l7957"><span class="linenum">7957</span></a>          <a class="var it41676" onMouseOver="hilite(41676)" onMouseOut="lolite()" onClick="logVariable('postsurl')" href="../../_variables/postsurl.html">$postsurl</a>-&gt;<a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>('course', <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l7958"><span class="linenum">7958</span></a>      }
<a name="l7959"><span class="linenum">7959</span></a>      <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('forumposts', 'mod_forum');
<a name="l7960"><span class="linenum">7960</span></a>      <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a> = <span class="keyword">new </span><a class="class" onClick="logClass('core_user')" href="../../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>\output\myprofile\<a class="function" onClick="logFunction('node')" href="../../_functions/node.html" onMouseOver="funcPopup(event,'node')">node</a>('miscellaneous', 'forumposts', <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>, null, <a class="var it41676" onMouseOver="hilite(41676)" onMouseOut="lolite()" onClick="logVariable('postsurl')" href="../../_variables/postsurl.html">$postsurl</a>);
<a name="l7961"><span class="linenum">7961</span></a>      <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a class="function" onClick="logFunction('add_node')" href="../../_functions/add_node.html" onMouseOver="funcPopup(event,'add_node')">add_node</a>(<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>);
<a name="l7962"><span class="linenum">7962</span></a>  
<a name="l7963"><span class="linenum">7963</span></a>      <a class="var it41677" onMouseOver="hilite(41677)" onMouseOut="lolite()" onClick="logVariable('discussionssurl')" href="../../_variables/discussionssurl.html">$discussionssurl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/forum/user.php.html">/mod/forum/user.php</a>', array('id' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mode' =&gt; 'discussions'));
<a name="l7964"><span class="linenum">7964</span></a>      if (!empty(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>)) {
<a name="l7965"><span class="linenum">7965</span></a>          <a class="var it41677" onMouseOver="hilite(41677)" onMouseOut="lolite()" onClick="logVariable('discussionssurl')" href="../../_variables/discussionssurl.html">$discussionssurl</a>-&gt;<a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>('course', <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l7966"><span class="linenum">7966</span></a>      }
<a name="l7967"><span class="linenum">7967</span></a>      <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('myprofileotherdis', 'mod_forum');
<a name="l7968"><span class="linenum">7968</span></a>      <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a> = <span class="keyword">new </span><a class="class" onClick="logClass('core_user')" href="../../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>\output\myprofile\<a class="function" onClick="logFunction('node')" href="../../_functions/node.html" onMouseOver="funcPopup(event,'node')">node</a>('miscellaneous', 'forumdiscussions', <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>, null,
<a name="l7969"><span class="linenum">7969</span></a>          <a class="var it41677" onMouseOver="hilite(41677)" onMouseOut="lolite()" onClick="logVariable('discussionssurl')" href="../../_variables/discussionssurl.html">$discussionssurl</a>);
<a name="l7970"><span class="linenum">7970</span></a>      <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a class="function" onClick="logFunction('add_node')" href="../../_functions/add_node.html" onMouseOver="funcPopup(event,'add_node')">add_node</a>(<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>);
<a name="l7971"><span class="linenum">7971</span></a>  
<a name="l7972"><span class="linenum">7972</span></a>      return true;
<a name="l7973"><span class="linenum">7973</span></a>  }
<a name="l7974"><span class="linenum">7974</span></a>  
<a name="l7975"><span class="linenum">7975</span></a>  <span class="comment">/**</span>
<a name="l7976"><span class="linenum">7976</span></a>  <span class="comment"> * Checks whether the author's name and picture for a given post should be hidden or not.</span>
<a name="l7977"><span class="linenum">7977</span></a>  <span class="comment"> *</span>
<a name="l7978"><span class="linenum">7978</span></a>  <span class="comment"> * @param object $post The forum post.</span>
<a name="l7979"><span class="linenum">7979</span></a>  <span class="comment"> * @param object $forum The forum object.</span>
<a name="l7980"><span class="linenum">7980</span></a>  <span class="comment"> * @return bool</span>
<a name="l7981"><span class="linenum">7981</span></a>  <span class="comment"> * @throws coding_exception</span>
<a name="l7982"><span class="linenum">7982</span></a>  <span class="comment"> */</span>
<a name="l7983"><span class="linenum">7983</span></a>  function <a class="function" onClick="logFunction('forum_is_author_hidden')" href="../../_functions/forum_is_author_hidden.html" onMouseOver="funcPopup(event,'forum_is_author_hidden')">forum_is_author_hidden</a>(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>) {
<a name="l7984"><span class="linenum">7984</span></a>      if (!isset(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>)) {
<a name="l7985"><span class="linenum">7985</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a> must be set.');
<a name="l7986"><span class="linenum">7986</span></a>      }
<a name="l7987"><span class="linenum">7987</span></a>      if (!isset(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>)) {
<a name="l7988"><span class="linenum">7988</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> must be set.');
<a name="l7989"><span class="linenum">7989</span></a>      }
<a name="l7990"><span class="linenum">7990</span></a>      if (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('type')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> === 'single' &amp;&amp; empty(<a class="var it4569" onMouseOver="hilite(4569)" onMouseOut="lolite()" onClick="logVariable('post')" href="../../_variables/post.html">$post</a>-&gt;<a onClick="logVariable('parent')" class="var it43223" onMouseOver="hilite(43223)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a>)) {
<a name="l7991"><span class="linenum">7991</span></a>          return true;
<a name="l7992"><span class="linenum">7992</span></a>      }
<a name="l7993"><span class="linenum">7993</span></a>      return false;
<a name="l7994"><span class="linenum">7994</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'forum_scale_used': ['forum_scale_used', 'This function returns if a scale is being used by one forum ', [['mod/forum','lib.php',1753]], 0],
'forum_get_post_full': ['forum_get_post_full', 'Gets a post with all info ready for forum_print_post Most of these joins are just to get the forum id ', [['mod/forum','lib.php',1794]], 13],
'forum_user_can_see_timed_discussion': ['forum_user_can_see_timed_discussion', 'Check to ensure a user can view a timed discussion. ', [['mod/forum','lib.php',5091]], 2],
'container': ['container', 'Outputs a container. ', [['lib','outputrenderers.php',3126]], 195],
'img': ['img', 'Generates a simple image tag with attributes. ', [['lib','outputcomponents.php',1169]], 54],
'forum_discussion_pin': ['forum_discussion_pin', 'Set the discussion to pinned and trigger the discussion pinned event ', [['mod/forum','lib.php',7891]], 1],
'pix_icon': ['pix_icon', 'Return HTML for a pix_icon. ', [['lib','outputrenderers.php',2161]], 504],
'js': ['js', 'Minify JS code. ', [['lib/classes','minify.php',31],['lib','outputrequirementslib.php',407],['grade/report/singleview/classes/local/screen','screen.php',245]], 68],
'forum_update_grades': ['forum_update_grades', 'Update activity grades ', [['mod/forum','lib.php',1668]], 1],
'forum_pluginfile': ['forum_pluginfile', 'Serves the forum attachments. Implements needed access control ;-) ', [['mod/forum','lib.php',4250]], 0],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'forum_rating_validate': ['forum_rating_validate', 'Validates a submitted rating ', [['mod/forum','lib.php',3517]], 0],
'is_number': ['is_number', 'Return true if given value is integer or string with integer value ', [['lib','moodlelib.php',1291],['lib/phpexcel/PHPExcel/Calculation','Functions.php',464]], 68],
'forum_user_has_posted': ['forum_user_has_posted', '', [['mod/forum','lib.php',4898]], 3],
'forum_discussions_user_has_posted_in': ['forum_discussions_user_has_posted_in', '', [['mod/forum','lib.php',4876]], 2],
'fields': ['fields', '', [['lib/adodb/drivers','adodb-odbtp.inc.php',720],['lib/adodb/drivers','adodb-sqlite3.inc.php',403],['mod/quiz/classes','admin_review_setting.php',65],['lib/adodb/drivers','adodb-ibase.inc.php',865],['lib/adodb/drivers','adodb-postgres64.inc.php',968],['lib/adodb/drivers','adodb-odbc.inc.php',644],['lib/adodb/drivers','adodb-sqlite.inc.php',420],['lib/adodb/drivers','adodb-pdo.inc.php',742],['lib','outputcomponents.php',235],['lib/adodb/drivers','adodb-oci8po.inc.php',104],['lib/adodb/drivers','adodb-mssql.inc.php',906],['lib/adodb/drivers','adodb-mysql.inc.php',774],['lib/adodb/drivers','adodb-mssqlnative.inc.php',895],['lib/adodb/drivers','adodb-oracle.inc.php',267],['lib/adodb','adodb.inc.php',3781],['lib/adodb','adodb.inc.php',4459],['lib/adodb/drivers','adodb-ado5.inc.php',412],['lib/adodb/drivers','adodb-db2.inc.php',756],['lib/adodb/drivers','adodb-oci8.inc.php',1701],['lib/adodb/drivers','adodb-mysqli.inc.php',973],['lib/adodb/drivers','adodb-ado.inc.php',375],['lib/adodb/drivers','adodb-ads.inc.php',690]], 156],
'get_subject': ['get_subject', 'The formatted subject for the current post. ', [['mod/forum/classes/output','forum_post.php',419]], 3],
'pix_url': ['pix_url', 'Return the moodle_url for an image. ', [['lib','outputrenderers.php',237],['lib','outputlib.php',1394]], 367],
'forum_get_layout_modes': ['forum_get_layout_modes', 'Returns array of forum layout modes ', [['mod/forum','lib.php',7069]], 3],
'format_text': ['format_text', 'Formats a text string coming from the search engine. ', [['search/classes','document.php',606],['lib/classes','grading_external.php',182],['search/engine/solr/classes','document.php',129],['lib','weblib.php',1158],['lib','tablelib.php',860],['lib','tablelib.php',1667],['question/type','questionbase.php',345]], 322],
'forum_tp_delete_read_records': ['forum_tp_delete_read_records', 'Deletes read records for the specified index. At least one parameter must be specified. ', [['mod/forum','lib.php',6424]], 6],
'forum_get_firstpost_from_discussion': ['forum_get_firstpost_from_discussion', 'Given a discussion id, return the first post from the discussion ', [['mod/forum','lib.php',2341]], 1],
'get_fast_modinfo': ['get_fast_modinfo', 'Returns reference to full info about modules in course (including visibility). Cached and as fast as possible (0 or 1 db query). ', [['lib','modinfolib.php',1977]], 289],
'render': ['render', 'Renders this element ', [['lib/classes/output','inplace_editable.php',238],['lib/adodb','adodb-pager.inc.php',241],['lib/phpexcel/PHPExcel','Chart.php',656],['lib','formslib.php',948],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/fullscreen','fullscreen.htm',82],['lib','outputrenderers.php',170],['lib','outputrenderers.php',302],['question/behaviour','behaviourbase.php',97],['lib/htmlpurifier/HTMLPurifier/Printer','HTMLDefinition.php',15],['lib/htmlpurifier/HTMLPurifier/Printer','CSSDefinition.php',14],['filter/tex','latex.php',88],['lib','portfoliolib.php',241],['mod/quiz/classes/question/bank','custom_view.php',133],['lib/mustache/src/Mustache','Engine.php',204],['question/engine/tests','helpers.php',797],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',85],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',235],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',298],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',391],['lib/mustache/src/Mustache','Template.php',57],['lib/phpexcel/PHPExcel/Chart/Renderer','jpgraph.php',790],['question/engine','questionattempt.php',814],['lib/mustache/src/Mustache','LambdaHelper.php',39]], 942],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'delete_records_select': ['delete_records_select', '', [['lib/dml','pdo_moodle_database.php',208],['lib/dml','oci_native_moodle_database.php',1495],['lib/dml','pgsql_native_moodle_database.php',1162],['lib/dml','mssql_native_moodle_database.php',1146],['lib/dml','mysqli_native_moodle_database.php',1477],['lib/dml','sqlsrv_native_moodle_database.php',1220],['lib/dml/tests','dml_test.php',5553]], 163],
'forum_delete_discussion': ['forum_delete_discussion', 'Deletes a discussion and handles all associated cleanup. ', [['mod/forum','lib.php',4538]], 3],
'user_picture': ['user_picture', '', [['mod/quiz','attemptlib.php',2467],['lib','outputrenderers.php',2454],['lib','outputrenderers.php',5000]], 138],
'disabledif': ['disabledif', 'Adds a dependency for $elementName which will be disabled if $condition is met. If $condition = \'notchecked\' (default) then the condition is that the $dependentOn element is not checked. If $condition = \'checked\' then the condition is that the $dependentOn element is checked. If $condition is something else (like "eq" for equals) then it is checked to see if the value of the $dependentOn element is $condition (such as equal) to $value. ', [['lib','formslib.php',2429]], 343],
'clone': ['clone', '', [['lib/editor/tinymce/tiny_mce/3.5.11/plugins/media/js','media.js',11]], 370],
'forum_get_course_forum': ['forum_get_course_forum', '', [['mod/forum','lib.php',2980]], 3],
'forum_move_attachments': ['forum_move_attachments', 'Given a discussion object that is being moved to $forumto, this function checks all posts in that discussion for attachments, and if any are found, these are moved to the new forum directory. ', [['mod/forum','lib.php',3979]], 1],
'get_filename': ['get_filename', 'Returns file name ', [['lib/filebrowser','virtual_root_file.php',227],['lib/filestorage','stored_file.php',699],['lib','medialib.php',169]], 248],
'forum_discussion_view': ['forum_discussion_view', 'Trigger the discussion viewed event ', [['mod/forum','lib.php',7871]], 3],
'subscription_disabled': ['subscription_disabled', 'Helper to determine whether a forum has it\'s subscription mode set to disabled. ', [['mod/forum/classes','subscriptions.php',150]], 11],
'search_generate_sql': ['search_generate_sql', 'Primitive function to generate a SQL string from a parse tree. Parameters: ', [['lib','searchlib.php',381]], 3],
'set_anchor': ['set_anchor', 'Sets the anchor for the URI (the bit after the hash) ', [['lib','weblib.php',686]], 39],
'add': ['add', 'Add HashTable item ', [['lib/phpexcel/PHPExcel','HashTable.php',78],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',95],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',109],['lib/google/src/Google/Http','Batch.php',52],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',37],['lib','csslib.php',1508],['lib/horde/framework/Horde/Mail/Rfc822','List.php',116],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',33],['lib/horde/framework/Horde/Support','ConsistentHash.php',148],['lib/horde/framework/Horde','Variables.php',297],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',29],['lib','outputcomponents.php',2705],['lib','outputcomponents.php',3380],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',436],['lib','adminlib.php',735],['lib','adminlib.php',894],['lib','adminlib.php',1446],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',27],['lib/xhprof/xhprof_html/jquery','jquery-1.2.6.js',3450],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',80],['lib/google/src/Google/Service','Webmasters.php',436],['lib','navigationlib.php',304],['lib','navigationlib.php',761],['lib','navigationlib.php',3305],['lib','navigationlib.php',3583],['lib/horde/framework/Horde/Imap/Client','Ids.php',155],['backup/cc/cc_lib/gral_lib','cssparser.php',121],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',428],['lib/horde/framework/Horde','Stream.php',116],['comment','lib.php',679],['lib/mustache/src/Mustache','HelperCollection.php',56],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',207],['backup/cc/cc_lib','cc_utils.php',395],['backup/cc/cc_lib','cc_utils.php',454],['lib/lessphp/Output','Mapped.php',50],['lib','licenselib.php',32],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',50],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',74],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',14],['lib/horde/framework/Horde/Mail/Rfc822','GroupList.php',25],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',31],['tag/classes','tag.php',152],['blog','locallib.php',242],['lib/classes','notification.php',50],['lib/lessphp','Output.php',18],['tag/classes/output','tagfeed.php',61],['backup/cc','validator.php',51],['lib/horde/framework/Horde/Stream','TempString.php',118],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',11]], 6188],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'forum_get_courses_user_posted_in': ['forum_get_courses_user_posted_in', 'Gets all of the courses where the provided user has posted in a forum. ', [['mod/forum','lib.php',7300]], 5],
'forum_get_completion_state': ['forum_get_completion_state', 'Obtains the automatic completion state for this forum based on any conditions in forum settings. ', [['mod/forum','lib.php',343]], 0],
'add_class': ['add_class', 'Adds a CSS class to this action link object ', [['lib','outputcomponents.php',1040],['lib','outputcomponents.php',1787],['lib','outputcomponents.php',2596],['lib','navigationlib.php',458]], 33],
'forum_get_view_actions': ['forum_get_view_actions', 'List the actions that correspond to a view of this module. This is used by the participation report. ', [['mod/forum','lib.php',6717]], 0],
'enrol_selfenrol_available': ['enrol_selfenrol_available', 'Is there a chance users might self enrol ', [['lib','enrollib.php',937]], 3],
'forum_get_discussion_neighbours': ['forum_get_discussion_neighbours', 'Gets the neighbours (previous and next) of a discussion. ', [['mod/forum','lib.php',2646]], 127],
'forum_print_posts_nested': ['forum_print_posts_nested', '', [['mod/forum','lib.php',5792]], 3],
'forum_tp_add_read_record': ['forum_tp_add_read_record', 'Mark post as read. ', [['mod/forum','lib.php',6156]], 3],
'break_up_long_words': ['break_up_long_words', 'Given some normal text this function will break up any long words to a given size by inserting the given character ', [['lib','weblib.php',968]], 3],
'forum_user_can_post': ['forum_user_can_post', 'This function checks whether the user can reply to posts in a forum discussion. Use forum_user_can_post_discussion() to check whether the user can start discussions. ', [['mod/forum','lib.php',5000]], 14],
'forum_get_user_digest_options': ['forum_get_user_digest_options', 'Retrieve the list of available user digest options. ', [['mod/forum','lib.php',7785]], 7],
'heading': ['heading', 'Outputs a heading ', [['lib','outputrenderers.php',3072],['lib','outputrenderers.php',4364],['lib','outputrenderers.php',4552],['grade/report/singleview/classes/local/screen','screen.php',197],['grade/report/singleview/classes/local/screen','user.php',264],['grade/report/singleview/classes/local/screen','grade.php',283]], 796],
'forum_tp_mark_discussion_read': ['forum_tp_mark_discussion_read', 'Marks a whole discussion as read, for a given user ', [['mod/forum','lib.php',6238]], 1],
'file_encode_url': ['file_encode_url', 'Encodes file serving url ', [['lib','filelib.php',42]], 28],
'span': ['span', 'Creates a <span> tag. (Shortcut function.) ', [['lib','outputcomponents.php',1846]], 161],
'forum_print_posts_threaded': ['forum_print_posts_threaded', '', [['mod/forum','lib.php',5734]], 3],
'instance_by_id': ['instance_by_id', 'Get a context instance as an object, from a given context id. ', [['lib','accesslib.php',5434]], 235],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',3012]], 1007],
'single_button': ['single_button', 'Returns a form with a single button. ', [['lib','outputrenderers.php',1772]], 316],
'forum_get_post_actions': ['forum_get_post_actions', 'List the actions that correspond to a post of this module. This is used by the participation report. ', [['mod/forum','lib.php',6731]], 0],
'get_field_sql': ['get_field_sql', 'Get a single field value (first field) using a SQL statement. ', [['lib/dml','moodle_database.php',1588]], 138],
'can_access_course': ['can_access_course', 'Checks if current user has access to the course ', [['tag/classes','index_builder.php',335],['lib','accesslib.php',2130]], 19],
'forum_user_can_post_discussion': ['forum_user_can_post_discussion', '', [['mod/forum','lib.php',4939]], 25],
'get_record_sql': ['get_record_sql', 'Get a single database record as an object using a SQL statement. ', [['lib/dml','oci_native_moodle_database.php',1076],['lib/dml','moodle_database.php',1506]], 157],
'forum_get_file_areas': ['forum_get_file_areas', 'Lists all browsable file areas ', [['mod/forum','lib.php',4133]], 1],
'tag': ['tag', 'Outputs a tag with attributes and contents ', [['lib','outputcomponents.php',1073]], 1292],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'generate_email_messageid': ['generate_email_messageid', 'Generate a unique email Message-ID using the moodle domain and install path ', [['lib','moodlelib.php',5515]], 4],
'unsubscribe_user': ['unsubscribe_user', 'Removes user from the subscriber list ', [['mod/forum/classes','subscriptions.php',643]], 19],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'forum_tp_clean_read_records': ['forum_tp_clean_read_records', 'Clean old records from the forum_read table. ', [['mod/forum','lib.php',6645]], 1],
'file_get_submitted_draft_itemid': ['file_get_submitted_draft_itemid', 'Returns draft area itemid for a given element. ', [['lib','filelib.php',725]], 48],
'end_div': ['end_div', 'Ends a <div> tag. (Shortcut function.) ', [['lib','outputcomponents.php',1837]], 100],
'get_groups': ['get_groups', 'Returns groups that the current user belongs to on the course. Note: If not already available, this may make a database query. ', [['lib','modinfolib.php',289],['group','externallib.php',164]], 29],
'forum_get_all_discussion_posts': ['forum_get_all_discussion_posts', 'Gets all posts in discussion including top parent. ', [['mod/forum','lib.php',1814]], 5],
'get_ratings': ['get_ratings', 'Adds rating objects to an array of items (forum posts, glossary entries etc). Rating objects are available at $item->rating ', [['rating','lib.php',471],['lib/simplepie/library/SimplePie','Enclosure.php',736]], 17],
'require_capability': ['require_capability', 'Wrapper round the require_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',306],['mod/quiz','attemptlib.php',929],['lib','accesslib.php',762],['backup/util/ui','restore_ui_components.php',157]], 690],
'forum_is_author_hidden': ['forum_is_author_hidden', 'Checks whether the author\'s name and picture for a given post should be hidden or not. ', [['mod/forum','lib.php',7975]], 9],
'timed_discussion_tooltip': ['timed_discussion_tooltip', 'Generate the HTML for an icon to be displayed beside the subject of a timed discussion. ', [['mod/forum','renderer.php',163]], 1],
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',840]], 332],
'forum_is_user_group_discussion': ['forum_is_user_group_discussion', 'Returns whether the discussion group is visible by the current user or not. ', [['mod/forum','lib.php',1358]], 2],
'get_coursemodule_from_instance': ['get_coursemodule_from_instance', 'Given an instance number of a module, finds the coursemodule description ', [['lib','datalib.php',1300]], 441],
'forum_get_user_maildigest_bulk': ['forum_get_user_maildigest_bulk', 'Determine the maildigest setting for the specified user against the specified forum. ', [['mod/forum','lib.php',7764]], 2],
'get_parsed_array': ['get_parsed_array', '', [['lib','searchlib.php',235]], 1],
'out': ['out', 'Returns the selector for use in a CSS rule ', [['lib','csslib.php',1540],['lib','csslib.php',1698],['lib','csslib.php',2078],['lib','csslib.php',2162],['lib','csslib.php',2306],['lib','csslib.php',2495],['lib','csslib.php',3240],['mod/feedback/classes','responses_table.php',332],['lib','moodlelib.php',9729],['lib','weblib.php',545],['lib','tablelib.php',1594],['report/loglive/classes','table_log_ajax.php',37]], 626],
'set_module_viewed': ['set_module_viewed', 'Update the module completion status (set it viewed). ', [['mod/assign','locallib.php',8075],['lib','completionlib.php',657]], 29],
'generate': ['generate', 'Generate an AdSense report based on the report request sent in the query parameters. Returns the result as JSON; to retrieve output in CSV format specify "alt=csv" as a query parameter. (reports.generate) ', [['lib/google/src/Google/Service','AdSense.php',1416],['lib/google/src/Google/Service','AdSense.php',1465],['lib/google/src/Google/Service','AdSense.php',1946],['lib/google/src/Google/Service','AdSense.php',1995],['lib/horde/framework/Horde/Support','Randomid.php',34],['lib/google/src/Google/Service','Doubleclicksearch.php',367],['lib/google/src/Google/Service','AdExchangeSeller.php',708],['lib/google/src/Google/Service','AdExchangeSeller.php',752],['lib/google/src/Google/Service','Directory.php',3344],['lib/google/src/Google/Service','AdSenseHost.php',874],['lib/google/src/Google/Service','AdSenseHost.php',1125],['lib/horde/framework/Horde/Mime','Mdn.php',119],['backup/cc/cc_lib','cc_asssesment.php',260],['backup/cc/cc_lib','cc_asssesment.php',406],['backup/cc/cc_lib','cc_asssesment.php',419],['backup/cc/cc_lib','cc_asssesment.php',426],['backup/cc/cc_lib','cc_asssesment.php',433],['backup/cc/cc_lib','cc_asssesment.php',465],['backup/cc/cc_lib','cc_asssesment.php',500],['backup/cc/cc_lib','cc_asssesment.php',516],['backup/cc/cc_lib','cc_asssesment.php',531],['backup/cc/cc_lib','cc_asssesment.php',569],['backup/cc/cc_lib','cc_asssesment.php',607],['backup/cc/cc_lib','cc_asssesment.php',623],['backup/cc/cc_lib','cc_asssesment.php',651],['backup/cc/cc_lib','cc_asssesment.php',659],['backup/cc/cc_lib','cc_asssesment.php',686],['backup/cc/cc_lib','cc_asssesment.php',712],['backup/cc/cc_lib','cc_asssesment.php',764],['backup/cc/cc_lib','cc_asssesment.php',801],['backup/cc/cc_lib','cc_asssesment.php',824],['backup/cc/cc_lib','cc_asssesment.php',863],['backup/cc/cc_lib','cc_asssesment.php',904],['backup/cc/cc_lib','cc_asssesment.php',947],['backup/cc/cc_lib','cc_asssesment.php',990],['backup/cc/cc_lib','cc_asssesment.php',1089],['backup/cc/cc_lib','cc_asssesment.php',1140],['backup/cc/cc_lib','cc_asssesment.php',1217],['backup/cc/cc_lib','cc_asssesment.php',1283],['backup/cc/cc_lib','cc_asssesment.php',1361],['backup/cc/cc_lib','cc_asssesment.php',1405],['backup/cc/cc_lib','cc_asssesment.php',1511],['backup/cc/cc_lib','cc_asssesment.php',1597],['backup/cc/cc_lib','cc_asssesment.php',1676],['backup/cc/cc_lib','cc_asssesment.php',1759],['backup/cc/cc_lib','cc_asssesment.php',2249],['lib/classes/message/inbound','address_manager.php',226],['lib/horde/framework/Horde/Support','Uuid.php',31],['lib/horde/framework/Horde/Support','Guid.php',41]], 94],
'forum_count_discussions': ['forum_count_discussions', '', [['mod/forum','lib.php',2424]], 3],
'end_tag': ['end_tag', 'Outputs a closing tag ', [['lib','outputcomponents.php',1096],['backup/util/xml/parser','progressive_parser.class.php',261],['backup/util/xml','xml_writer.class.php',177]], 867],
'forum_count_replies': ['forum_count_replies', '', [['mod/forum','lib.php',4712]], 2],
'forum_user_can_see_discussion': ['forum_user_can_see_discussion', '', [['mod/forum','lib.php',5147]], 4],
'forum_user_can_see_group_discussion': ['forum_user_can_see_group_discussion', 'Check to ensure a user can view a group discussion. ', [['mod/forum','lib.php',5116]], 2],
'attachment_options': ['attachment_options', 'Returns the options array to use in filemanager for forum attachments ', [['mod/forum/classes','post_form.php',39],['question/type/essay','questiontype.php',136]], 4],
'fetch_data_key': ['fetch_data_key', 'Return the data key for the data item. ', [['lib/classes/message/inbound','address_manager.php',174]], 2],
'forum_print_recent_mod_activity': ['forum_print_recent_mod_activity', 'Outputs the forum post indicated by $activity. ', [['mod/forum','lib.php',5939]], 0],
'add_node': ['add_node', 'Add a node to this category. ', [['user/classes/output/myprofile','category.php',83],['lib','navigationlib.php',323],['user/classes/output/myprofile','tree.php',52]], 101],
'is_viewing': ['is_viewing', 'Returns true if the user has moodle/course:view capability in the course, this is intended for admins, managers (aka small admins), inspectors, etc. ', [['lib','accesslib.php',2005]], 25],
'rss_get_url': ['rss_get_url', 'This function returns the URL for the RSS XML file. ', [['lib','rsslib.php',72]], 7],
'forum_update_post': ['forum_update_post', 'Update a post ', [['mod/forum','lib.php',4404]], 1],
'get_login_url': ['get_login_url', 'Returns full login url. ', [['lib','moodlelib.php',2432],['lib','oauthlib.php',466]], 48],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'forum_user_has_posted_discussion': ['forum_user_has_posted_discussion', 'Returns true if user created new discussion already. ', [['mod/forum','lib.php',4844]], 18],
'get_server_timezone': ['get_server_timezone', 'Returns server timezone. ', [['lib/classes','date.php',166]], 14],
'usergetmidnight': ['usergetmidnight', 'Given a time, return the GMT timestamp of the most recent midnight for the current user. ', [['lib','moodlelib.php',2252]], 24],
'forum_update_subscriptions_button': ['forum_update_subscriptions_button', 'Prints the editing button on subscribers page ', [['mod/forum','lib.php',6041]], 1],
'set_format_by_file': ['set_format_by_file', 'If we already know we have exactly one file, bypass set_formats and just pass the file so we can detect the formats by mimetype. ', [['lib','portfoliolib.php',201]], 4],
'forum_reset_course_form_definition': ['forum_reset_course_form_definition', 'Called by course/reset.php ', [['mod/forum','lib.php',7033]], 0],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'groups_get_course_groupmode': ['groups_get_course_groupmode', 'Returns effective groupmode used in course ', [['lib','grouplib.php',457]], 30],
'set_data': ['set_data', '', [['mod/scorm','mod_form.php',456],['mod/feedback/item/multichoicerated','multichoicerated_form.php',84],['backup/util/structure','restore_path_element.class.php',95],['course','moodleform_mod.php',458],['blocks/html','edit_form.php',53],['question/type','edit_question_form.php',450],['question/type/random','edit_random_form.php',68],['lib','formslib.php',456],['question/type/missingtype','edit_missingtype_form.php',52],['badges','edit_form.php',137],['blocks','edit_form.php',255],['course','editsection_form.php',88],['admin/tool/filetypes','edit_form.php',83],['question','category_form.php',73],['lib/classes/message/inbound','address_manager.php',146],['question/type/multianswer','edit_multianswer_form.php',262],['cache','forms.php',242],['question/type/calculated','datasetitems_form.php',360],['mod/feedback/item/multichoice','multichoice_form.php',79]], 235],
'get_user_preferences': ['get_user_preferences', 'Used to fetch user preference(s) ', [['lib','moodlelib.php',1974],['user','externallib.php',1381]], 188],
'get_courseidnumber': ['get_courseidnumber', 'ID number of the course that the forum is in. ', [['mod/forum/classes/output','forum_post.php',437]], 1],
'update_state': ['update_state', 'Updates (if necessary) the completion state of activity $cm for the given user. ', [['lib','completionlib.php',507]], 40],
'forum_add_new_post': ['forum_add_new_post', 'Add a new post in an existing discussion. ', [['mod/forum','lib.php',4354]], 3],
'get_all_user_name_fields': ['get_all_user_name_fields', 'A centralised location for the all name fields. Returns an array / sql string snippet. ', [['lib','moodlelib.php',3360]], 94],
'forum_tp_get_course_unread_posts': ['forum_tp_get_course_unread_posts', 'Returns the count of records for the provided user and course. Please note that group access is ignored! ', [['mod/forum','lib.php',6291]], 9],
'shorten_text': ['shorten_text', 'Given some text (which may contain HTML) and an ideal length, this function truncates the text neatly on a word boundary if possible ', [['lib','moodlelib.php',7822]], 87],
'get_modinfo': ['get_modinfo', '', [['availability/tests/fixtures','mock_info.php',70],['lib','modinfolib.php',1420],['lib','modinfolib.php',2715],['availability/classes','info.php',86]], 10],
'forum_instance_created': ['forum_instance_created', 'Handle changes following the creation of a forum instance. This function is typically called by the course_module_created observer. ', [['mod/forum','lib.php',136]], 1],
'is_forcesubscribed': ['is_forcesubscribed', 'Helper to determine whether a forum has it\'s subscription mode set to forced subscription. ', [['mod/forum/classes','subscriptions.php',139]], 19],
'forum_print_mode_form': ['forum_print_mode_form', 'Print the drop down that allows the user to select how they want to have the discussion displayed. ', [['mod/forum','lib.php',3897]], 2],
'forum_get_discussions_unread': ['forum_get_discussions_unread', '', [['mod/forum','lib.php',2839]], 2],
'forum_set_return': ['forum_set_return', '', [['mod/forum','lib.php',3949]], 1],
'is_subscribed': ['is_subscribed', 'Whether a user is subscribed to this forum, or a discussion within the forum. ', [['mod/forum/classes','subscriptions.php',87]], 67],
'forum_discussion_unpin': ['forum_discussion_unpin', 'Set discussion to unpinned and trigger the discussion unpin event ', [['mod/forum','lib.php',7915]], 1],
'grade_get_grades': ['grade_get_grades', 'Returns grading information for given activity, optionally with user grades Manual, course or category items can not be queried. ', [['lib','gradelib.php',408]], 53],
'subscribe_user_to_discussion': ['subscribe_user_to_discussion', 'Subscribes the user to the specified discussion. ', [['mod/forum/classes','subscriptions.php',702]], 26],
'print_string': ['print_string', 'Prints out a translated string. ', [['lib','moodlelib.php',6877]], 458],
'params': ['params', 'Add an array of params to the params for this url. ', [['lib','weblib.php',392],['question/classes/bank/search','condition.php',43],['question/classes/bank/search','category_condition.php',100]], 93],
'send_stored_file': ['send_stored_file', 'Handles the sending of file data to the user\'s browser, including support for byteranges etc. ', [['lib','filelib.php',2192]], 75],
'forum_user_outline': ['forum_user_outline', '', [['mod/forum','lib.php',1241]], 0],
'forum_grade_item_update': ['forum_grade_item_update', 'Create/update grade item for given forum ', [['mod/forum','lib.php',1698]], 7],
'count_records_sql': ['count_records_sql', 'Get the result of a SQL SELECT COUNT(...) query. ', [['lib/dml','moodle_database.php',1796]], 155],
'forum_get_subscribe_link': ['forum_get_subscribe_link', 'Generate and return the subscribe or unsubscribe link for a forum. ', [['mod/forum','lib.php',4771]], 3],
'forum_get_extra_capabilities': ['forum_get_extra_capabilities', 'Returns all other caps used in module ', [['mod/forum','lib.php',7109]], 0],
'forum_get_user_grades': ['forum_get_user_grades', 'Return grade for given user or all users. ', [['mod/forum','lib.php',1637]], 1],
'forum_count_user_posts': ['forum_count_user_posts', 'Get all the posts for a user in a forum suitable for forum_print_post ', [['mod/forum','lib.php',2265]], 1],
'file_rewrite_pluginfile_urls': ['file_rewrite_pluginfile_urls', 'Convert encoded URLs in $text from the @@PLUGINFILE@@/... form to an actual URL. Passing a new option reverse = true in the $options var will make the function to convert actual URLs in $text to encoded URLs in the @@PLUGINFILE@@ form. ', [['lib','filelib.php',446]], 96],
'get_coursename': ['get_coursename', 'The name of the course that the forum is in. ', [['mod/forum/classes/output','forum_post.php',457]], 3],
'where': ['where', '', [['question/engine','datalib.php',1883],['question/engine','datalib.php',1965],['mod/glossary/classes','entry_query_builder.php',448],['question/classes/bank/search','hidden_condition.php',53],['question/classes/bank/search','category_condition.php',96]], 64],
'record_exists': ['record_exists', 'Check if a record exists by ID. ', [['competency/classes','persistent.php',842],['lib/dml','moodle_database.php',1817]], 901],
'add_course_module': ['add_course_module', '', [['course','lib.php',1429]], 4],
'record_exists_sql': ['record_exists_sql', 'Test whether a SQL SELECT statement returns any records. ', [['lib/dml','moodle_database.php',1846]], 52],
'get_area_files': ['get_area_files', 'Returns all area files (optionally limited by itemid) ', [['lib/filestorage','file_storage.php',782],['lib','externallib.php',1134]], 216],
'forum_tp_is_tracked': ['forum_tp_is_tracked', 'Tells whether a specific forum is tracked by the user. A user can optionally be specified. If not specified, the current user is assumed. ', [['mod/forum','lib.php',6562]], 32],
'forum_delete_instance': ['forum_delete_instance', 'Given an ID of an instance of this module, this function will permanently delete the instance and any data that depends on it. ', [['mod/forum','lib.php',256]], 0],
'parse': ['parse', 'Parse the input data ', [['lib/simplepie/library/SimplePie/XML/Declaration','Parser.php',122],['lib/minify/lib','JSMinPlus.php',732],['lib/google/src/Google/Utils','URITemplate.php',59],['lib/simplepie/library/SimplePie','Parser.php',78],['lib/simplepie/library/SimplePie/Parse','Date.php',582],['lib/horde/framework/Horde/Mail/Rfc822','Identification.php',44],['mnet/xmlrpc','xmlparser.php',61],['backup/cc/cc_lib/gral_lib','cssparser.php',251],['backup/util/xml/parser','progressive_parser.class.php',178],['lib/mustache/src/Mustache','Parser.php',27],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',365],['lib/htmlpurifier/HTMLPurifier','VarParser.php',51],['mod/wiki/parser','parser.php',16],['mod/wiki/parser','parser.php',100],['lib/htmlpurifier/HTMLPurifier','URIParser.php',20],['lib/simplepie/library/SimplePie','gzdecode.php',197],['mod/scorm/datamodels','scormlib.php',911],['lib/simplepie/library/SimplePie/Decode/HTML','Entities.php',91],['lib/mustache/src/Mustache','Engine.php',731],['lib/lessphp','Parser.php',294],['lib','lexer.php',325],['lib/simplepie/library/SimplePie/HTTP','Parser.php',142]], 342],
'forum_add_instance': ['forum_add_instance', 'Given an object containing all the necessary data, (defined by the form in mod_form.php) this function will create a new instance and return the id number of the new instance. ', [['mod/forum','lib.php',77]], 0],
'get_file': ['get_file', 'Downloads a repository file and saves to a path. ', [['repository/boxnet','lib.php',179],['repository/flickr_public','lib.php',453],['repository/dropbox','lib.php',410],['repository/skydrive','lib.php',130],['repository','lib.php',1647],['repository/s3','lib.php',227],['repository/equella','lib.php',166],['mod/data/field/picture','field.class.php',126],['mod/data/field/file','field.class.php',123],['repository/googledocs','lib.php',408],['lib/filestorage','file_storage.php',700],['repository/webdav','lib.php',73],['repository/filesystem','lib.php',398],['repository/flickr','lib.php',277],['lib','externallib.php',1076],['repository/dropbox','locallib.php',114],['lib','webdavlib.php',391]], 169],
'forum_tp_start_tracking': ['forum_tp_start_tracking', '', [['mod/forum','lib.php',6611]], 1],
'editor_options': ['editor_options', 'Returns the options array to use in forum text editor ', [['mod/forum/classes','post_form.php',57]], 5],
'forum_get_readable_forums': ['forum_get_readable_forums', 'An array of forum objects that the user is allowed to read/search through. ', [['mod/forum','lib.php',1884]], 1],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'forum_change_discussionid': ['forum_change_discussionid', 'recursively sets the discussion field to $discussionid on $postid and all its children used when pruning a post ', [['mod/forum','lib.php',6021]], 2],
'get_string_manager': ['get_string_manager', 'Returns current string_manager instance. ', [['lib','moodlelib.php',6678]], 163],
'require_course_login': ['require_course_login', 'Weaker version of require_login() ', [['lib','moodlelib.php',2902]], 68],
'forum_get_discussions_count': ['forum_get_discussions_count', '', [['mod/forum','lib.php',2911]], 1],
'get_noreply_user': ['get_noreply_user', 'Return noreply user record, this is currently used in messaging system only for sending messages from noreply email. It will return record of $CFG->noreplyuserid if set else return dummy user object with hard-coded $user->emailstop = 1 so noreply can be sent to user. ', [['lib/classes','user.php',137]], 34],
'forum_get_recent_mod_activity': ['forum_get_recent_mod_activity', 'Returns all forum posts since a given time in specified forum. ', [['mod/forum','lib.php',5820]], 0],
'forum_check_throttling': ['forum_check_throttling', 'Returns a warning object if a user has reached the number of posts equal to the warning/blocking setting, or false if there is no warning to show. ', [['mod/forum','lib.php',6745]], 4],
'forum_extend_settings_navigation': ['forum_extend_settings_navigation', 'Adds module specific settings to the settings block ', [['mod/forum','lib.php',7118]], 0],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 556],
'groups_group_exists': ['groups_group_exists', 'Determines if a group with a given groupid exists. ', [['lib','grouplib.php',42]], 4],
'is_user_visible': ['is_user_visible', 'Checks if an activity is visible to the given user. ', [['availability/classes','info_module.php',140]], 26],
'forum_print_discussion': ['forum_print_discussion', 'Prints a forum discussion ', [['mod/forum','lib.php',5577]], 2],
'has_all_capabilities': ['has_all_capabilities', 'Check if the user has all the capabilities in a list. ', [['lib','accesslib.php',521]], 31],
'forum_page_type_list': ['forum_page_type_list', 'Return a list of page types ', [['mod/forum','lib.php',7285]], 0],
'forum_tp_is_post_old': ['forum_tp_is_post_old', '', [['mod/forum','lib.php',6282]], 3],
'is_enrolled': ['is_enrolled', 'Returns true if user is enrolled (is participating) in course this is intended for students and teachers. ', [['lib','accesslib.php',2038]], 145],
'forum_trigger_content_uploaded_event': ['forum_trigger_content_uploaded_event', 'Sends post content to plagiarism plugin ', [['mod/forum','lib.php',4680]], 4],
'message_send': ['message_send', 'Called when a message provider wants to send a message. This functions checks the message recipient\'s message processor configuration then sends the message to the configured processors ', [['lib','messagelib.php',29]], 94],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'shift_course_mod_dates': ['shift_course_mod_dates', 'Change dates in module - used from course reset. ', [['lib','moodlelib.php',5026]], 10],
'file_get_draft_area_info': ['file_get_draft_area_info', 'Returns information about files in a draft area. ', [['lib','filelib.php',491]], 8],
'execute': ['execute', 'Run langpack update ', [['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['backup/converter/imscc1','lib.php',84],['lib/classes/task','blog_cron_task.php',40],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/dml','pdo_moodle_database.php',227],['lib/classes/task','tag_cron_task.php',42],['enrol/imsenterprise/classes/task','cron_task.php',43],['lib/classes/task','completion_daily_task.php',42],['lib/google/src/Google/Http','Batch.php',61],['lib/dml','oci_native_moodle_database.php',1048],['lib/classes/task','context_cleanup_task.php',41],['backup/util/plan','backup_structure_step.class.php',50],['backup/util/ui','restore_ui.class.php',206],['webservice','lib.php',1319],['lib/classes/task','stats_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['lib/classes/task','legacy_plugin_cron_task.php',42],['backup/moodle2','restore_activity_task.class.php',189],['lib/classes/task','portfolio_cron_task.php',40],['lib/google/src/Google/Http','REST.php',27],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['backup/converter/imscc11','backuplib.php',42],['lib/classes/task','question_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',62],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/adodb/drivers','adodb-pdo.inc.php',559],['lib/editor/atto/classes/task','autosave_cleanup_task.php',42],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',43],['lib/classes/task','completion_regular_task.php',42],['lib/adodb/drivers','adodb-oci8po.inc.php',54],['lib/classes/task','events_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',47],['auth/cas/classes/task','sync_task.php',43],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',43],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['backup/util/helper','restore_decode_processor.class.php',73],['lib/behat','behat_base.php',840],['enrol/flatfile/classes/task','flatfile_sync_task.php',46],['lib/classes/task','registration_cron_task.php',40],['backup/moodle2','backup_section_task.class.php',97],['lib/classes/task','check_for_updates_task.php',40],['backup/util/plan/tests/fixtures','plan_fixtures.php',48],['backup/util/plan/tests/fixtures','plan_fixtures.php',56],['mod/forum/classes/task','cron_task.php',39],['lib/classes/task','send_failed_login_notifications_task.php',43],['enrol/lti/classes/task','sync_grades.php',45],['lib/dml','pgsql_native_moodle_database.php',665],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/classes/update','validator.php',117],['lib/google/src/Google','Client.php',574],['lib/dml','mssql_native_moodle_database.php',711],['mod/lti/service/profile/classes/local/resource','profile.php',76],['backup/util/plan','backup_plan.class.php',112],['lib/dml','mysqli_native_moodle_database.php',963],['backup/util/ui','backup_ui.class.php',122],['admin/tool/monitor/classes/task','clean_events.php',41],['backup/converter/moodle1','backuplib.php',10],['backup/converter/imscc11','lib.php',85],['lib/classes/task','grade_cron_task.php',40],['lib/classes/task','file_temp_cleanup_task.php',40],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['filter/tex','latex.php',70],['lib/adodb','adodb.inc.php',1088],['lib/classes/task','plagiarism_cron_task.php',40],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['backup/converter/moodle1','lib.php',142],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','search_index_task.php',44],['enrol/lti/classes/task','sync_members.php',55],['lib/classes/task','session_cleanup_task.php',40],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['lib/classes/task','backup_cleanup_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','badges_cron_task.php',40],['admin/tool/uploadcourse/classes','processor.php',174],['lib/classes/task','calendar_cron_task.php',40],['backup/util/plan','base_plan.class.php',158],['auth/ldap/classes/task','sync_task.php',43],['lib/adodb/drivers','adodb-oci8.inc.php',920],['backup/util/plan','restore_plan.class.php',159],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['lib/dml','sqlsrv_native_moodle_database.php',795],['lib/classes/task','create_contexts_task.php',40],['lib/classes/task','file_trash_cleanup_task.php',40],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',46],['lib/classes/task','complete_plans_task.php',52],['lib/classes/task','messaging_cleanup_task.php',40],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','cache_cleanup_task.php',40],['backup/moodle2','backup_activity_task.class.php',211],['filter/tex','texdebug.php',287],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','search_optimize_task.php',47],['mod/assign','adminlib.php',342],['lib/classes/task','delete_incomplete_users_task.php',40],['lib/classes/task','automated_backup_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','restore_execution_step.class.php',25],['lib/classes/task','sync_plans_from_template_cohorts_task.php',50],['admin/tool/monitor/classes','notification_task.php',39],['lib/dml/tests','dml_test.php',5543],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',60],['admin/tool/monitor/classes/task','check_subscriptions.php',60],['backup/util/interfaces','executable.class.php',32],['backup/util/plan','base_task.class.php',162]], 1058],
'forum_set_user_maildigest': ['forum_set_user_maildigest', 'Set the per-forum maildigest option for the specified user. ', [['mod/forum','lib.php',7702]], 17],
'forum_print_attachments': ['forum_print_attachments', 'Returns attachments as formated text/html optionally with separate images ', [['mod/forum','lib.php',4024]], 3],
'forum_print_latest_discussions': ['forum_print_latest_discussions', 'Prints the discussion view screen for a forum. ', [['mod/forum','lib.php',5273]], 10],
'valid': ['valid', 'Did we reach the end? ', [['lib/filestorage','zip_archive.php',514],['lib/spout/src/Spout/Reader/XLSX','SheetIterator.php',51],['lib/dml','mssql_native_moodle_recordset.php',83],['lib/phpexcel/PHPExcel/Worksheet','RowCellIterator.php',191],['lib/phpexcel/PHPExcel/Worksheet','ColumnIterator.php',184],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',329],['lib/dml','mysqli_native_moodle_recordset.php',82],['lib/phpexcel/PHPExcel/Worksheet','RowIterator.php',175],['lib/horde/framework/Horde/Mail/Rfc822','List.php',439],['lib/dml','pdo_moodle_recordset.php',75],['lib/spout/src/Spout/Reader/CSV','RowIterator.php',104],['lib/phpexcel/PHPExcel','WorksheetIterator.php',99],['backup/util/helper','backup_null_iterator.class.php',49],['lib/horde/framework/Horde','Domhtml.php',331],['lib/dml','sqlsrv_native_moodle_recordset.php',129],['lib/classes/dml','recordset_walk.php',127],['lib/horde/framework/Horde/Imap/Client','Ids.php',419],['backup/util/helper','backup_array_iterator.class.php',59],['lib/spout/src/Spout/Reader/CSV','SheetIterator.php',44],['lib/dml','oci_native_moodle_recordset.php',76],['lib/adodb','adodb.inc.php',3041],['lib/adodb','adodb.inc.php',3168],['lib/phpexcel/PHPExcel/Worksheet','ColumnCellIterator.php',182],['lib/spout/src/Spout/Reader/XLSX','RowIterator.php',110],['question/engine','questionusage.php',999],['question/engine/tests','helpers.php',1237],['backup/cc/cc_lib','cc_version11.php',47],['lib/spout/src/Spout/Reader/ODS','SheetIterator.php',75],['backup/cc/cc_lib','cc_version1.php',47],['backup/cc/cc_lib','cc_asssesment.php',58],['lib/spout/src/Spout/Reader/ODS','RowIterator.php',80],['lib/google/src/Google','Collection.php',45],['lib/horde/framework/Horde/Imap/Client/Data','AclRights.php',182],['lib/horde/framework/Horde/Imap/Client/Fetch','Query.php',378],['question/engine','questionattempt.php',1643],['question/engine','questionattempt.php',1762],['lib/tests','completionlib_test.php',903],['lib/dml','pgsql_native_moodle_recordset.php',103]], 81],
'print_group_picture': ['print_group_picture', 'Print a specified group\'s avatar. ', [['lib','weblib.php',2365]], 9],
'plagiarism_get_links': ['plagiarism_get_links', 'displays the similarity score and provides a link to the full report if allowed. ', [['lib','plagiarismlib.php',34]], 7],
'forum_get_forum_types_all': ['forum_get_forum_types_all', 'Returns array of all forum layout modes ', [['mod/forum','lib.php',7094]], 2],
'strlen': ['strlen', 'Counts the number of characters. Unit-tested by Kasper (single byte charsets only) ', [['lib/typo3','class.t3lib_cs.php',1520],['lib/classes','text.php',305]], 1649],
'groups_is_member': ['groups_is_member', 'Determines if the user is a member of the given group. ', [['lib','grouplib.php',353]], 97],
'setadvanced': ['setadvanced', 'Use this method to indicate an element in a form is an advanced field. If items in a form are marked as advanced then \'Hide/Show Advanced\' buttons will automatically be displayed in the form so the user can decide whether to display advanced form controls. ', [['lib','formslib.php',1497]], 166],
'userdate': ['userdate', 'Returns a formatted string that represents a date in user time. ', [['lib','moodlelib.php',2155],['lib/adodb','adodb.inc.php',2842],['lib/adodb','adodb.inc.php',3569]], 525],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'get_renderer': ['get_renderer', 'Returns instance of page renderer used by this plugin ', [['course/format','lib.php',905],['question/type/multichoice','question.php',156],['question/type/multichoice','question.php',278],['question/behaviour','behaviourbase.php',135],['question/type','questionbase.php',275],['lib','pagelib.php',802],['lib','outputlib.php',1828],['lib','outputfactories.php',70],['lib','outputfactories.php',292],['lib','outputfactories.php',377],['mod/assign','locallib.php',2987],['grade/grading/form/rubric','lib.php',486],['lib/tests/fixtures','test_renderer_factory.php',49],['grade/grading/form/guide','lib.php',492]], 452],
'forum_search_posts': ['forum_search_posts', 'Returns a list of posts found using an array of search terms. ', [['mod/forum','lib.php',1983]], 1],
'get_id': ['get_id', 'Getter for $id. ', [['lib/classes/task','adhoc_task.php',51],['backup/converter','convertlib.php',100],['lib/filebrowser','virtual_root_file.php',290],['lib','adminlib.php',1719],['admin/tool/uploadcourse/classes','course.php',335],['lib/simplepie/library/SimplePie','Item.php',199],['lib/filestorage','stored_file.php',786],['cache/classes','definition.php',613],['grade/grading/form','lib.php',854],['question/engine','questionusage.php',120],['mod/lti/classes/local/ltiservice','service_base.php',76],['blocks/rss_client/classes/output','item.php',152],['backup/controller','backup_controller.class.php',263],['question/engine','questionattemptstep.php',136],['mod/lti/classes/local/ltiservice','resource_base.php',81]], 2250],
'html_to_text': ['html_to_text', 'Given HTML text, make it into plain text using external function ', [['lib','weblib.php',1947],['question/type','questionbase.php',367]], 65],
'mtrace': ['mtrace', 'Outputs the given message via {@link mtrace()}. ', [['lib/classes','plugin_manager.php',1376],['lib','moodlelib.php',8509]], 406],
'is_guest': ['is_guest', 'Does user have a (temporary or real) guest access to course? ', [['lib','accesslib.php',1965]], 4],
'forum_view': ['forum_view', 'Mark the activity completed (if required) and trigger the course_module_viewed event. ', [['mod/forum','lib.php',7842]], 3],
'move_area_files_to_new_context': ['move_area_files_to_new_context', 'Move all the files in a file area from one context to another. ', [['lib/filestorage','file_storage.php',1069]], 21],
'forum_cron': ['forum_cron', 'Function to be run periodically according to the scheduled task. ', [['mod/forum','lib.php',441]], 7],
'forum_supports': ['forum_supports', 'Indicates API features that the forum supports. ', [['mod/forum','lib.php',311]], 0],
'cron_setup_user': ['cron_setup_user', 'Sets up current user and course environment (lang, etc.) in cron. Do not use outside of cron script! ', [['lib','sessionlib.php',153]], 35],
'highlight': ['highlight', '', [['lib/editor/atto/yui/build/moodle-editor_atto-rangy','moodle-editor_atto-rangy-debug.js',5692],['lib/yuilib/3.17.2/datatable-highlight','datatable-highlight-debug.js',25],['lib','weblib.php',2009],['lib/yuilib/3.17.2/datatable-highlight','datatable-highlight.js',25],['lib/editor/atto/yui/build/moodle-editor_atto-rangy','moodle-editor_atto-rangy.js',5692],['lib/editor/atto/yui/src/rangy/js','rangy-highlighter.js',206]], 84],
'forum_tp_get_untracked_forums': ['forum_tp_get_untracked_forums', 'Get a list of forums not tracked by the user. ', [['mod/forum','lib.php',6466]], 9],
'forum_get_post_from_log': ['forum_get_post_from_log', 'Given a log entry, return the forum post details for it. ', [['mod/forum','lib.php',2299]], 0],
'forum_get_posts_by_user': ['forum_get_posts_by_user', 'Returns posts made by the selected user in the requested courses. ', [['mod/forum','lib.php',7404]], 1],
'get_mimetype': ['get_mimetype', 'Returns mimetype ', [['lib/filebrowser','file_info.php',277],['lib/filebrowser','virtual_root_file.php',254],['lib/filebrowser','file_info_stored.php',240],['lib/filestorage','stored_file.php',738],['lib','medialib.php',192],['lib/portfolio','caller.php',453]], 59],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1379]], 880],
'forum_get_discussion_subscription_icon_preloaders': ['forum_get_discussion_subscription_icon_preloaders', 'Return a pair of spans containing classes to allow the subscribe and unsubscribe icons to be pre-loaded by a browser. ', [['mod/forum','lib.php',3884]], 2],
'get_userid': ['get_userid', 'Returns user ID ', [['lib/filebrowser','virtual_root_file.php',236],['mod/quiz','attemptlib.php',804],['lib/filestorage','stored_file.php',708],['mod/data','lib.php',2585],['backup/util/plan','restore_task.class.php',54],['backup/util/plan','restore_plan.class.php',115],['backup/controller','backup_controller.class.php',283],['backup/controller','restore_controller.class.php',285]], 220],
'help_icon': ['help_icon', 'Returns HTML to display a help icon. ', [['lib','outputrenderers.php',2341]], 79],
'notification': ['notification', 'Output a notification (that is, a status message about something that has just happened). ', [['lib','outputrenderers.php',2849],['lib','outputrenderers.php',4412],['lib','outputrenderers.php',4496]], 540],
'forum_add_discussion': ['forum_add_discussion', 'Given an object containing all the necessary data, create a new discussion and return the id ', [['mod/forum','lib.php',4457]], 6],
'set_formats': ['set_formats', 'Sets the available export formats for this content. This function will also poll the static function in the caller class and make sure we\'re not overriding a format that has nothing to do with mimetypes. Eg: if you pass IMAGE here but the caller can export LEAP2A it will keep LEAP2A as well. ', [['lib','portfoliolib.php',164]], 12],
'get_all_instances_in_courses': ['get_all_instances_in_courses', 'Returns an array of all the active instances of a particular module in given courses, sorted in the order they are defined ', [['lib','datalib.php',1382]], 23],
'groups_get_activity_groupmode': ['groups_get_activity_groupmode', 'Returns effective groupmode used in activity, course setting overrides activity setting if groupmodeforce enabled. ', [['lib','grouplib.php',468]], 136],
'on': ['on', '', [['lib/requirejs','require.js',508],['lib/jquery','jquery-3.1.0.js',4809]], 3823],
'count_words': ['count_words', 'Count words in a string. ', [['lib','moodlelib.php',7697]], 16],
'trusttext_trusted': ['trusttext_trusted', 'Is current user trusted to enter no dangerous XSS in this context? ', [['lib','weblib.php',1614]], 8],
'get_recordset_select': ['get_recordset_select', 'Get a number of records as a moodle_recordset which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1224]], 45],
'forum_get_email_message_id': ['forum_get_email_message_id', 'Create a message-id string to use in the custom headers of forum notification emails ', [['mod/forum','lib.php',406]], 4],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',481]], 1488],
'get_local_referer': ['get_local_referer', 'Returns the cleaned local URL of the HTTP_REFERER less the URL query string parameters if required. ', [['lib','weblib.php',219]], 31],
'set_additional_content': ['set_additional_content', 'This method lets you define content that would be added to the message only for specific message processors. ', [['lib/classes/message','message.php',232]], 7],
'forum_get_context': ['forum_get_context', 'Determine the current context if one was not already specified. ', [['mod/forum','lib.php',7815]], 12],
'get_subscription_mode': ['get_subscription_mode', 'Returns the current subscription mode for the forum. ', [['mod/forum/classes','subscriptions.php',185]], 5],
'file_file_icon': ['file_file_icon', 'Return the relative icon path for a given file ', [['lib','filelib.php',1505]], 35],
'count_records': ['count_records', 'Count a list of records. ', [['competency/classes','persistent.php',815],['mod/glossary/classes','entry_query_builder.php',152],['lib/dml','moodle_database.php',1766]], 1630],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',6144]], 546],
'get_records_select': ['get_records_select', 'Load a list of records based on a select query. ', [['competency/classes','persistent.php',751],['lib/dml','moodle_database.php',1332]], 166],
'hash': ['hash', 'Expose the hash function for testing, probing, and extension. ', [['lib/horde/framework/Horde/Support','ConsistentHash.php',218],['mod/assign/feedback/editpdf/classes','document_services.php',100],['filter/censor','filter.php',47],['lib','filterlib.php',393],['lib/horde/framework/Horde/Imap/Client/Fetch','Query.php',288]], 195],
'subscribe_user': ['subscribe_user', 'Subscribe an user to this rule. ', [['admin/tool/monitor/classes','rule.php',137],['mod/forum/classes','subscriptions.php',575]], 26],
'set_label': ['set_label', 'Sets the label. ', [['backup/util/ui','backup_ui_setting.class.php',143],['lib','outputcomponents.php',839],['lib','outputcomponents.php',961],['lib/classes','chart_axis.php',143],['backup/cc/cc_lib','cc_asssesment.php',378],['backup/cc/cc_lib','cc_asssesment.php',492],['backup/cc/cc_lib','cc_asssesment.php',1725]], 54],
'forum_update_instance': ['forum_update_instance', 'Given an object containing all the necessary data, (defined by the form in mod_form.php) this function will update an existing instance with new data. ', [['mod/forum','lib.php',153]], 0],
'get_user_grades': ['get_user_grades', 'Returns an array of grades calculated by aggregating item ratings. ', [['rating','lib.php',765]], 4],
'grade_update': ['grade_update', 'Submit new or update grade; update/create grade_item definition. Grade must have userid specified, rawgrade and feedback with format are optional. rawgrade NULL means \'Not graded\'. Missing property or key means does not change the existing value. ', [['lib','gradelib.php',40]], 27],
'forum_tp_mark_posts_read': ['forum_tp_mark_posts_read', 'Mark posts as read. ', [['mod/forum','lib.php',6069]], 5],
'forum_tp_stop_tracking': ['forum_tp_stop_tracking', '', [['mod/forum','lib.php',6627]], 14],
'forum_get_user_posted_time': ['forum_get_user_posted_time', 'Returns creation time of the first user\'s post in given discussion ', [['mod/forum','lib.php',4913]], 2],
'delete_area_files': ['delete_area_files', 'Delete all area files (optionally limited by itemid). ', [['lib/filestorage','file_storage.php',992]], 123],
'forum_user_complete': ['forum_user_complete', '', [['mod/forum','lib.php',1288]], 0],
'forum_check_blocking_threshold': ['forum_check_blocking_threshold', 'Throws an error if the user is no longer allowed to post due to having reached or exceeded the number of posts specified in \'Post threshold for blocking\' setting. ', [['mod/forum','lib.php',6818]], 5],
'fetch_subscribed_users': ['fetch_subscribed_users', 'Returns a list of user objects who are subscribed to this forum. ', [['mod/forum/classes','subscriptions.php',379]], 22],
'forum_filter_user_groups_discussions': ['forum_filter_user_groups_discussions', 'Filters the forum discussions according to groups membership and config. ', [['mod/forum','lib.php',1321]], 1],
'div': ['div', 'Creates a <div> tag. (Shortcut function.) ', [['lib','outputcomponents.php',1814],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',239]], 207],
'forum_tp_can_track_forums': ['forum_tp_can_track_forums', 'Determine if a user can track forums and optionally a particular forum. Checks the site settings, the user settings and the forum settings (if requested). ', [['mod/forum','lib.php',6506]], 25],
'groups_get_all_groups': ['groups_get_all_groups', 'Gets array of all groups in a specified course. ', [['lib','grouplib.php',189]], 108],
'forum_mark_old_posts_as_mailed': ['forum_mark_old_posts_as_mailed', 'Marks posts before a certain time as being mailed already ', [['mod/forum','lib.php',2156]], 1],
'get_mimetype_description': ['get_mimetype_description', 'Obtains descriptions for file types (e.g. \'Microsoft Word document\') from the mimetypes.php language file. ', [['lib','filelib.php',1635]], 21],
'start_div': ['start_div', 'Starts a <div> tag. (Shortcut function.) ', [['lib','outputcomponents.php',1826]], 107],
'forum_add_attachment': ['forum_add_attachment', 'If successful, this function returns the name of the file ', [['mod/forum','lib.php',4320]], 3],
'forum_tp_mark_post_read': ['forum_tp_mark_post_read', 'If its an old post, do nothing. If the record exists, the maintenance will clear it up later. ', [['mod/forum','lib.php',6186]], 4],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'groups_group_visible': ['groups_group_visible', 'Determine if a given group is visible to user or not in a given context. ', [['lib','grouplib.php',896]], 51],
'forum_scale_used_anywhere': ['forum_scale_used_anywhere', 'Checks if scale is being used by any instance of forum ', [['mod/forum','lib.php',1774]], 0],
'forum_get_discussion_subscription_icon': ['forum_get_discussion_subscription_icon', 'Return the markup for the discussion subscription toggling icon. ', [['mod/forum','lib.php',3827]], 3],
'forum_get_default_sort_order': ['forum_get_default_sort_order', 'Get the sql to use in the ORDER BY clause for forum discussions. ', [['mod/forum','lib.php',2793]], 5],
'start_tag': ['start_tag', 'Outputs an opening tag with attributes ', [['lib','outputcomponents.php',1085],['backup/util/xml/parser','progressive_parser.class.php',215]], 701],
'enrol_get_users_courses': ['enrol_get_users_courses', 'Returns list of courses user is enrolled into. (Note: use enrol_get_all_users_courses if you want to use the list wihtout any cap checks ) ', [['lib','enrollib.php',679]], 17],
'forum_print_overview': ['forum_print_overview', '', [['mod/forum','lib.php',1391]], 6],
'param': ['param', '', [['lib/adodb/drivers','adodb-postgres64.inc.php',609],['lib','weblib.php',453],['lib/adodb/drivers','adodb-oci8po.inc.php',39],['lib/adodb','adodb.inc.php',934],['lib/adodb/drivers','adodb-oci8.inc.php',1179],['lib/adodb/drivers','adodb-db2oci.inc.php',163]], 640],
'forum_get_user_involved_discussions': ['forum_get_user_involved_discussions', 'Get all the discussions user participated in ', [['mod/forum','lib.php',2231]], 1],
'forum_tp_mark_forum_read': ['forum_tp_mark_forum_read', 'Marks a whole forum as read, for a given user ', [['mod/forum','lib.php',6199]], 1],
'forum_reset_gradebook': ['forum_reset_gradebook', 'Removes all grades from gradebook ', [['mod/forum','lib.php',6837]], 3],
'join': ['join', 'Join a room. For internal use by the Games SDK only. Calling this method directly is unsupported. (rooms.join) ', [['lib/google/src/Google/Service','Games.php',1716],['lib/google/src/Google/Service','Games.php',2100]], 1030],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'get_preload_record_columns_sql': ['get_preload_record_columns_sql', 'Returns all fields necessary for context preloading from user $rec. ', [['lib','accesslib.php',6066]], 56],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'mod_forum_rating_can_see_item_ratings': ['mod_forum_rating_can_see_item_ratings', 'Can the current user see ratings for a given itemid? ', [['mod/forum','lib.php',3617]], 13],
'forum_grade_item_delete': ['forum_grade_item_delete', 'Delete grade item for given forum ', [['mod/forum','lib.php',1738]], 1],
'is_subscribable': ['is_subscribable', 'Helper to determine whether the specified forum can be subscribed to. ', [['mod/forum/classes','subscriptions.php',160]], 9],
'file_save_draft_area_files': ['file_save_draft_area_files', 'Saves files from a draft file area to a real one (merging the list of files). Can rewrite URLs in some content at the same time if desired. ', [['lib','filelib.php',778]], 61],
'forum_rating_permissions': ['forum_rating_permissions', 'Return rating related permissions ', [['mod/forum','lib.php',3496]], 0],
'forum_post_subscription': ['forum_post_subscription', 'Given a new post, subscribes or unsubscribes as appropriate. Returns some text which describes what happened. ', [['mod/forum','lib.php',4730]], 5],
'username_load_fields_from_object': ['username_load_fields_from_object', 'Reduces lines of duplicated code for getting user name fields. ', [['lib','moodlelib.php',3418]], 27],
'forum_delete_post': ['forum_delete_post', 'Deletes a single forum post. ', [['mod/forum','lib.php',4587]], 4],
'is_directory': ['is_directory', 'Whether or not this is a directory ', [['lib/filebrowser','file_info_context_system.php',133],['mod/lesson/classes','file_info.php',94],['mod/imscp','locallib.php',328],['lib/filebrowser','file_info_context_coursecat.php',146],['mod/book','locallib.php',463],['lib/filebrowser','file_info_context_user.php',265],['lib/filebrowser','virtual_root_file.php',60],['mod/data','locallib.php',477],['lib/filebrowser','file_info_stored.php',267],['lib/filestorage','stored_file.php',310],['mod/workshop','fileinfolib.php',82],['mod/workshop','fileinfolib.php',241],['lib/filebrowser','file_info_context_module.php',249],['mod/glossary','locallib.php',525],['lib/filebrowser','file_info_context_course.php',372],['lib/filebrowser','file_info_context_course.php',657],['lib/filebrowser','file_info_context_course.php',803],['mod/forum','locallib.php',463]], 140],
'groups_get_group': ['groups_get_group', 'Get the group object ', [['lib','grouplib.php',161]], 20],
'get_coursefullname': ['get_coursefullname', 'The full name of the course that the forum is in. ', [['mod/forum/classes/output','forum_post.php',446]], 1],
'forum_get_forums_user_posted_in': ['forum_get_forums_user_posted_in', 'Gets all of the forums a user has posted in for one or more courses. ', [['mod/forum','lib.php',7353]], 1],
'get_course': ['get_course', 'Get the course id. ', [['course','moodleform_mod.php',132],['search/classes','engine.php',102],['course/format','lib.php',231],['mod/quiz','attemptlib.php',180],['mod/quiz','attemptlib.php',722],['tag/classes','index_builder.php',296],['lib','modinfolib.php',180],['lib','modinfolib.php',1424],['lib','modinfolib.php',2706],['lib','datalib.php',568],['availability/classes','info.php',70],['mod/assign','locallib.php',1316],['admin/tool/uploadcourse/classes','processor.php',232],['enrol','locallib.php',912],['search/tests/fixtures','mock_search_engine.php',56]], 302],
'to_html': ['to_html', 'Returns html string. ', [['lib','listlib.php',110],['lib','listlib.php',523],['lib','portfoliolib.php',254]], 17],
'forum_print_post': ['forum_print_post', 'Print a forum post ', [['mod/forum','lib.php',3049]], 12],
'forum_get_unmailed_posts': ['forum_get_unmailed_posts', 'Returns a list of all new posts that have not been mailed yet ', [['mod/forum','lib.php',2115]], 3],
's': ['s', 'Count of attempts selected by $this->whichattempts ', [['mod/quiz/report/statistics/classes','calculated.php',91],['lib','weblib.php',84]], 1072],
'raise': ['raise', 'Sets the PHP time limit to a number of seconds from now. ', [['lib/classes','php_time_limit.php',41]], 90],
'forum_get_file_info': ['forum_get_file_info', 'File browsing support for forum module. ', [['mod/forum','lib.php',4150]], 0],
'set_after_link': ['set_after_link', 'Sets HTML that displays after link on course view page. ', [['lib','modinfolib.php',1568]], 2],
'set_config': ['set_config', 'Set a key in global configuration ', [['lib','moodlelib.php',1336],['lib','enrollib.php',1153],['lib/editor/tinymce/classes','plugin.php',84],['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515]], 1119],
'groups_get_activity_group': ['groups_get_activity_group', 'Returns group active in activity, changes the group by default if \'group\' page param present ', [['lib','grouplib.php',814]], 97],
'fill_discussion_subscription_cache': ['fill_discussion_subscription_cache', 'Fill the discussion subscription data for the specified userid and forum. ', [['mod/forum/classes','subscriptions.php',489]], 3],
'forum_reset_course_form_defaults': ['forum_reset_course_form_defaults', 'Course reset form defaults. ', [['mod/forum','lib.php',7061]], 0],
'fill_subscription_cache': ['fill_subscription_cache', 'Fill the forum subscription data for the specified userid and forum. ', [['mod/forum/classes','subscriptions.php',299]], 5],
'forum_tp_count_forum_unread_posts': ['forum_tp_count_forum_unread_posts', 'Returns the count of records for the provided user and forum and [optionally] group. ', [['mod/forum','lib.php',6346]], 3],
'get_site': ['get_site', 'Returns $course object of the top-level site. ', [['lib','datalib.php',547]], 77],
'forum_get_discussions': ['forum_get_discussions', 'Get all discussions in a forum ', [['mod/forum','lib.php',2501]], 16],
'forum_print_recent_activity': ['forum_print_recent_activity', 'Given a course and a date, prints a summary of all the new messages posted in the course since that date ', [['mod/forum','lib.php',1531]], 0],
'set_handler': ['set_handler', 'Set the handler to use for the subsequent Inbound Message commands. ', [['lib/classes/message/inbound','address_manager.php',128]], 19],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'get_recordset': ['get_recordset', 'Get the recordset. ', [['mod/glossary/classes','entry_query_builder.php',305],['lib/dml','moodle_database.php',1162]], 92],
'set_field_select': ['set_field_select', 'Set a single field in every table row where the select statement evaluates to true. ', [['lib/dml','pdo_moodle_database.php',492],['lib/dml','oci_native_moodle_database.php',1436],['lib/dml','pgsql_native_moodle_database.php',1121],['lib/dml','mssql_native_moodle_database.php',1097],['lib/dml','mysqli_native_moodle_database.php',1435],['lib/dml','sqlsrv_native_moodle_database.php',1178],['lib/dml/tests','dml_test.php',5552]], 67],
'redirect': ['redirect', '', [['enrol/lti/ims-blti','blti.php',230],['lib','weblib.php',2659]], 999],
'set_callback_options': ['set_callback_options', 'Function to set the callback options ', [['lib','portfoliolib.php',134]], 18],
'forum_get_forum_types': ['forum_get_forum_types', 'Returns array of forum types chooseable on the forum editing form ', [['mod/forum','lib.php',7081]], 1],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'node': ['node', 'Enter description here ... ', [['backup/cc/cc_lib','xmlbase.php',241],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',3483]], 151],
'forum_print_discussion_header': ['forum_print_discussion_header', 'This function prints the overview of a discussion in the forum listing. It needs some discussion information and some post information, these happen to be combined for efficiency in the $post parameter by the function that calls this one: forum_print_latest_discussions() ', [['mod/forum','lib.php',3660]], 1],
'mod_forum_myprofile_navigation': ['mod_forum_myprofile_navigation', 'Add nodes to myprofile page. ', [['mod/forum','lib.php',7939]], 3],
'guest_user': ['guest_user', 'Retrieve the guest user object. ', [['lib','moodlelib.php',4060]], 10],
'forum_cm_info_view': ['forum_cm_info_view', 'Adds information about unread messages, that is only required for the course view page (and similar), to the course-module object. ', [['mod/forum','lib.php',7263]], 0],
'get_file_by_hash': ['get_file_by_hash', 'Fetch file using local file full pathname hash ', [['lib/filestorage','file_storage.php',679]], 73],
'isloggedin': ['isloggedin', 'Determines if a user is currently logged in ', [['lib','accesslib.php',1910]], 184],
'fetch_discussion_subscription': ['fetch_discussion_subscription', 'Retrieve the discussion subscription data for the specified userid and forum. ', [['mod/forum/classes','subscriptions.php',470]], 5],
'js_function_call': ['js_function_call', '!!!DEPRECATED!!! please use js_init_call() if possible Ensure that the specified JavaScript function is called from an inline script somewhere on this page. ', [['lib','outputrequirementslib.php',945]], 18],
'forum_go_back_to': ['forum_go_back_to', '', [['mod/forum','lib.php',3967]], 13],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'isguestuser': ['isguestuser', 'Determines if a user is logged in as real guest user with username \'guest\'. ', [['lib','accesslib.php',1923]], 260],
'get_instances': ['get_instances', 'Obtains all module instances on this course. ', [['lib','modinfolib.php',235],['repository','lib.php',993],['admin/tool/monitor/classes','rule_manager.php',276],['admin/tool/monitor/classes','subscription_manager.php',370]], 33],
'forum_cron_minimise_user_record': ['forum_cron_minimise_user_record', 'Removes properties from user record that are not necessary for sending post notifications. ', [['mod/forum','lib.php',419]], 7],
'forum_discussion_update_last_post': ['forum_discussion_update_last_post', 'Sets the last post for a given discussion ', [['mod/forum','lib.php',6678]], 4],
'course_add_cm_to_section': ['course_add_cm_to_section', 'Adds an existing module to the section ', [['course','lib.php',1475]], 11],
'forum_tp_is_post_read': ['forum_tp_is_post_read', '', [['mod/forum','lib.php',6271]], 1],
'forum_count_discussion_replies': ['forum_count_discussion_replies', 'Returns an array of counts of replies to each discussion ', [['mod/forum','lib.php',2359]], 12],
'forum_get_user_posts': ['forum_get_user_posts', 'Get all the posts for a user in a forum suitable for forum_print_post ', [['mod/forum','lib.php',2195]], 1],
'delete_ratings': ['delete_ratings', 'Delete one or more ratings. Specify either a rating id, an item id or just the context id. ', [['rating','lib.php',381]], 16],
'get_unsubscribediscussionlink': ['get_unsubscribediscussionlink', 'Get the link to unsubscribe from the discussion. ', [['mod/forum/classes/output','forum_post.php',390]], 3],
'paging_bar': ['paging_bar', 'Returns HTML to display a single paging bar to provide access to other pages  (usually in a search) ', [['lib','outputrenderers.php',3006]], 59],
'sesskey': ['sesskey', 'Makes sure that $USER->sesskey exists, if $USER itself exists. It sets a new sesskey if one does not already exist, but does not overwrite existing sesskeys. Returns the sesskey string if $USER exists, or boolean false if not. ', [['lib','sessionlib.php',28]], 641],
'forum_rss_delete_file': ['forum_rss_delete_file', 'Given a forum object, deletes all cached RSS files associated with it. ', [['mod/forum','rsslib.php',89]], 3],
'get_potential_subscribers': ['get_potential_subscribers', 'Get the list of potential subscribers to a forum. ', [['mod/forum/classes','subscriptions.php',252]], 5],
'is_enabled': ['is_enabled', 'Tools cannot be disabled. ', [['lib/classes/plugininfo','tool.php',39],['admin/tool/recyclebin/classes','category_bin.php',54],['admin/tool/log/classes/plugininfo','logstore.php',35],['admin/tool/recyclebin/classes','course_bin.php',54],['mod/assign/feedback/offline','locallib.php',380],['admin/tool/recyclebin/classes','base_bin.php',38],['lib','adminlib.php',1955],['search/classes','base.php',190],['lib','medialib.php',318],['lib','medialib.php',635],['lib','medialib.php',1268],['admin/tool/health','index.php',393],['lib/classes/plugininfo','mnetservice.php',33],['lib/classes/message/inbound','manager.php',37],['mod/assignment/classes/plugininfo','assignment.php',32],['competency/classes','api.php',49],['mod/assign','assignmentplugin.php',223],['lib/classes/plugininfo','orphaned.php',37],['search/tests/fixtures','mock_search_area.php',38],['tag/classes','area.php',106],['lib/classes/plugininfo','base.php',383],['mod/assign/feedback/editpdf','locallib.php',340],['tag/classes','tag.php',1269],['mod/assign/submission/comments','locallib.php',172],['lib','completionlib.php',269]], 276],
'forum_reset_userdata': ['forum_reset_userdata', 'This function is used by the reset_course_userdata function in moodlelib. This function will remove all posts from the specified forum and clean up any related data. ', [['mod/forum','lib.php',6866]], 0],
'get_instances_of': ['get_instances_of', 'Obtains all instances of a particular module on this course. ', [['lib','modinfolib.php',261]], 29],
'addelement': ['addelement', 'Adds a custom element to your HTML definition ', [['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',124],['lib/htmlpurifier/HTMLPurifier','HTMLModule.php',130],['lib/pear/HTML','QuickForm.php',592]], 3302],
'unsubscribe_user_from_discussion': ['unsubscribe_user_from_discussion', 'Unsubscribes the user from the specified discussion. ', [['mod/forum/classes','subscriptions.php',764]], 27],
'forum_print_posts_flat': ['forum_print_posts_flat', '', [['mod/forum','lib.php',5707]], 1],
'forum_user_can_see_post': ['forum_user_can_see_post', '', [['mod/forum','lib.php',5196]], 13],
'forum_search_form': ['forum_search_form', '', [['mod/forum','lib.php',3925]], 4],
'message': ['message', 'Send XMPP Message ', [['lib/jabber/XMPP','XMPP.php',156],['mod/lesson','renderer.php',145]], 31],
'fullname': ['fullname', 'Returns a persons full name ', [['lib','moodlelib.php',3249],['mod/assign','locallib.php',3915]], 546],
'defined': ['defined', '', [], 4731],
'array_merge': ['array_merge', '', [], 2944],
'strip_tags': ['strip_tags', '', [], 150],
'round': ['round', '', [], 1002],
'function_exists': ['function_exists', '', [], 419],
'array_keys': ['array_keys', '', [], 1256],
'str_replace': ['str_replace', '', [], 1648],
'array_splice': ['array_splice', '', [], 52],
'reset': ['reset', '', [], 1213],
'array_key_exists': ['array_key_exists', '', [], 1445],
'sha1': ['sha1', '', [], 186],
'implode': ['implode', '', [], 1281],
'array_pop': ['array_pop', '', [], 483],
'is_array': ['is_array', '', [], 1608],
'define': ['define', '', [], 2373],
'count': ['count', '', [], 4095],
'is_numeric': ['is_numeric', '', [], 672],
'time': ['time', '', [], 1959],
'strncasecmp': ['strncasecmp', '', [], 7],
'array_intersect': ['array_intersect', '', [], 50],
'is_null': ['is_null', '', [], 2003],
'array_map': ['array_map', '', [], 169],
'min': ['min', '', [], 898],
'key': ['key', '', [], 204],
'link': ['link', '', [], 695],
'substr': ['substr', '', [], 2823],
'array_shift': ['array_shift', '', [], 700],
'is_object': ['is_object', '', [], 544],
'end': ['end', '', [], 433],
'in_array': ['in_array', '', [], 1234],
'max': ['max', '', [], 1266],
'strtolower': ['strtolower', '', [], 817],
'sort': ['sort', '', [], 241],
'explode': ['explode', '', [], 1572],
'ksort': ['ksort', '', [], 153]};
CLASS_DATA={
'single_select': ['single_select', 'Simple form with just one select field that gets submitted automatically. ', [['lib','outputcomponents.php',697]], 50],
'exception': ['exception', 'Session related exception class. ', [['lib/classes/session','exception.php',29],['lib/horde/framework/Horde/Socket/Client','Exception.php',17]], 219],
'pix_icon': ['pix_icon', 'Data structure representing an icon. ', [['lib','outputcomponents.php',497]], 275],
'file_info_stored': ['file_info_stored', 'Represents an actual file or folder - a row in the file table in the tree navigated by {@link file_browser}. ', [['lib/filebrowser','file_info_stored.php',28]], 33],
'mod_forum_post_form': ['mod_forum_post_form', 'Class to post in a forum. ', [['mod/forum/classes','post_form.php',30]], 7],
'discussion_viewed': ['discussion_viewed', 'The mod_forum discussion viewed event class. ', [['mod/forum/classes/event','discussion_viewed.php',29]], 3],
'html_writer': ['html_writer', 'Simple html output class ', [['lib','outputcomponents.php',1062]], 5120],
'rating_manager': ['rating_manager', 'The rating_manager class provides the ability to retrieve sets of ratings from the database ', [['rating','lib.php',365]], 24],
'context_user': ['context_user', 'User context class ', [['lib','accesslib.php',6398]], 414],
'portfolio_add_button': ['portfolio_add_button', 'Use this to add a portfolio button or icon or form to a page. ', [['lib','portfoliolib.php',54]], 13],
'core_user': ['core_user', 'User class to access user details. ', [['lib/classes','user.php',27]], 457],
'discussion_pinned': ['discussion_pinned', 'The mod_forum discussion pinned event. ', [['mod/forum/classes/event','discussion_pinned.php',27]], 1],
'user_picture': ['user_picture', 'Data structure representing a user picture. ', [['lib','outputcomponents.php',142]], 165],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',7039]], 1106],
'assessable_uploaded': ['assessable_uploaded', 'The mod_forum assessable uploaded event class. ', [['mod/forum/classes/event','assessable_uploaded.php',29],['mod/workshop/classes/event','assessable_uploaded.php',29],['mod/assign/submission/onlinetext/classes/event','assessable_uploaded.php',29],['mod/assign/submission/file/classes/event','assessable_uploaded.php',29]], 4],
'moodle_exception': ['moodle_exception', 'Base Moodle Exception class ', [['lib','setuplib.php',75]], 606],
'rating_exception': ['rating_exception', 'The rating_exception class for exceptions specific to the ratings system ', [['rating','lib.php',1056]], 45],
'search_lexer': ['search_lexer', 'This class does the heavy lifting of lexing the search string into tokens. Using a full-blown lexer is probably overkill for this application, but might be useful for other tasks. ', [['lib','searchlib.php',84]], 1],
'search_parser': ['search_parser', 'This class takes care of sticking the proper token type/value pairs into the parsed token  array. Most functions in this class should only be called by the lexer, the one exception being getParseArray() which returns the result. ', [['lib','searchlib.php',221]], 1],
'navigation_node': ['navigation_node', 'This class is used to represent a node in a navigation tree ', [['lib','navigationlib.php',34]], 348],
'info_module': ['info_module', 'Class handles conditional availability information for an activity. ', [['availability/classes','info_module.php',29]], 39],
'context_helper': ['context_helper', 'Context maintenance and helper methods. ', [['lib','accesslib.php',5875]], 203],
'settings_navigation': ['settings_navigation', 'Class used to manage the settings option for the current page ', [['lib','navigationlib.php',3434]], 17],
'course_module_viewed': ['course_module_viewed', 'The mod_page course module viewed event class. ', [['mod/page/classes/event','course_module_viewed.php',28],['mod/chat/classes/event','course_module_viewed.php',29],['mod/quiz/classes/event','course_module_viewed.php',29],['mod/data/classes/event','course_module_viewed.php',30],['mod/choice/classes/event','course_module_viewed.php',28],['mod/forum/classes/event','course_module_viewed.php',29],['mod/resource/classes/event','course_module_viewed.php',29],['mod/book/classes/event','course_module_viewed.php',28],['mod/imscp/classes/event','course_module_viewed.php',30],['mod/lti/classes/event','course_module_viewed.php',29],['mod/feedback/classes/event','course_module_viewed.php',28],['mod/survey/classes/event','course_module_viewed.php',29],['mod/folder/classes/event','course_module_viewed.php',29],['mod/glossary/classes/event','course_module_viewed.php',28],['mod/scorm/classes/event','course_module_viewed.php',28],['mod/url/classes/event','course_module_viewed.php',29],['mod/wiki/classes/event','course_module_viewed.php',28],['lib/tests/fixtures','event_fixtures.php',232],['mod/lesson/classes/event','course_module_viewed.php',30],['mod/workshop/classes/event','course_module_viewed.php',32]], 37],
'core_date': ['core_date', 'Core date and time related code. ', [['lib/classes','date.php',26]], 192],
'discussion_unpinned': ['discussion_unpinned', 'The mod_forum discussion unpinned event. ', [['mod/forum/classes/event','discussion_unpinned.php',27]], 1],
'post_deleted': ['post_deleted', 'The mod_forum post deleted event class. ', [['mod/forum/classes/event','post_deleted.php',29]], 7],
'core_php_time_limit': ['core_php_time_limit', 'Utility class to manage PHP time limit. ', [['lib/classes','php_time_limit.php',27]], 92],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',238]], 3088],
'subscriptions': ['subscriptions', 'Forum subscription manager. ', [['mod/forum/classes','subscriptions.php',29]], 299],
'completion_info': ['completion_info', 'Class represents completion information for a course. ', [['lib','completionlib.php',210]], 141],
'forum_file_info_container': ['forum_file_info_container', 'Class representing the virtual node with all itemids in the file browser ', [['mod/forum','locallib.php',396]], 1],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',239]], 1200],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323]};
CONST_DATA={
'SITEID': ['SITEID', '', [['admin/cli','install.php',219],['lib/db','install.php',87],['','install.php',242],['lib','setup.php',755]], 608],
'PORTFOLIO_FORMAT_RICHHTML': ['PORTFOLIO_FORMAT_RICHHTML', '', [['lib/portfolio','constants.php',92]], 19],
'SEPARATEGROUPS': ['SEPARATEGROUPS', '', [['lib','grouplib.php',34]], 190],
'FORUM_TRACKING_OPTIONAL': ['FORUM_TRACKING_OPTIONAL', '', [['mod/forum','lib.php',50]], 18],
'FORUM_MODE_FLATNEWEST': ['FORUM_MODE_FLATNEWEST', '', [['mod/forum','lib.php',33]], 5],
'RATING_AGGREGATE_NONE': ['RATING_AGGREGATE_NONE', '', [['rating','lib.php',28]], 11],
'COMPLETION_TRACKING_AUTOMATIC': ['COMPLETION_TRACKING_AUTOMATIC', '', [['lib','completionlib.php',64]], 44],
'FORUM_FORCESUBSCRIBE': ['FORUM_FORCESUBSCRIBE', '', [['mod/forum','lib.php',38]], 23],
'CONTEXT_COURSE': ['CONTEXT_COURSE', '', [['lib','accesslib.php',148]], 441],
'FORUM_TRACKING_FORCED': ['FORUM_TRACKING_FORCED', '', [['mod/forum','lib.php',56]], 21],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'FORUM_MAILED_SUCCESS': ['FORUM_MAILED_SUCCESS', '', [['mod/forum','lib.php',59]], 2],
'FEATURE_COMPLETION_HAS_RULES': ['FEATURE_COMPLETION_HAS_RULES', '', [['lib','moodlelib.php',407]], 12],
'FEATURE_GROUPINGS': ['FEATURE_GROUPINGS', '', [['lib','moodlelib.php',416]], 23],
'IGNORE_MULTIPLE': ['IGNORE_MULTIPLE', '', [['lib','dmllib.php',50]], 43],
'FORUM_DISCUSSION_PINNED': ['FORUM_DISCUSSION_PINNED', '', [['mod/forum','lib.php',72]], 20],
'RATING_UNSET_RATING': ['RATING_UNSET_RATING', '', [['rating','lib.php',26]], 7],
'FEATURE_GROUPS': ['FEATURE_GROUPS', '', [['lib','moodlelib.php',414]], 25],
'FORUM_MAILED_PENDING': ['FORUM_MAILED_PENDING', '', [['mod/forum','lib.php',58]], 5],
'GRADE_TYPE_VALUE': ['GRADE_TYPE_VALUE', '', [['lib/grade','constants.php',85]], 80],
'FEATURE_SHOW_DESCRIPTION': ['FEATURE_SHOW_DESCRIPTION', '', [['lib','moodlelib.php',437]], 22],
'PORTFOLIO_FORMAT_PLAINHTML': ['PORTFOLIO_FORMAT_PLAINHTML', '', [['lib/portfolio','constants.php',97]], 17],
'FORUM_POSTS_ALL_USER_GROUPS': ['FORUM_POSTS_ALL_USER_GROUPS', '', [['mod/forum','lib.php',70]], 4],
'FEATURE_MOD_INTRO': ['FEATURE_MOD_INTRO', '', [['lib','moodlelib.php',426]], 31],
'FORUM_DISCUSSION_UNPINNED': ['FORUM_DISCUSSION_UNPINNED', '', [['mod/forum','lib.php',73]], 14],
'FORMAT_PLAIN': ['FORMAT_PLAIN', '', [['lib','weblib.php',52]], 152],
'GRADE_TYPE_SCALE': ['GRADE_TYPE_SCALE', '', [['lib/grade','constants.php',90]], 70],
'FORUM_INITIALSUBSCRIBE': ['FORUM_INITIALSUBSCRIBE', '', [['mod/forum','lib.php',39]], 32],
'FORUM_TRACKING_OFF': ['FORUM_TRACKING_OFF', '', [['mod/forum','lib.php',45]], 15],
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 315],
'FORUM_MODE_NESTED': ['FORUM_MODE_NESTED', '', [['mod/forum','lib.php',35]], 5],
'FEATURE_RATE': ['FEATURE_RATE', '', [['lib','moodlelib.php',432]], 10],
'COMPLETION_AND': ['COMPLETION_AND', '', [['lib','completionlib.php',131]], 9],
'FORUM_DISALLOWSUBSCRIBE': ['FORUM_DISALLOWSUBSCRIBE', '', [['mod/forum','lib.php',40]], 14],
'FEATURE_PLAGIARISM': ['FEATURE_PLAGIARISM', '', [['lib','moodlelib.php',402]], 4],
'FORUM_CRON_USER_CACHE': ['FORUM_CRON_USER_CACHE', '', [['mod/forum','lib.php',64]], 5],
'PORTFOLIO_ADD_ICON_LINK': ['PORTFOLIO_ADD_ICON_LINK', '', [['lib/portfolio','constants.php',190]], 8],
'PORTFOLIO_ADD_TEXT_LINK': ['PORTFOLIO_ADD_TEXT_LINK', '', [['lib/portfolio','constants.php',196]], 5],
'GRADE_TYPE_NONE': ['GRADE_TYPE_NONE', '', [['lib/grade','constants.php',80]], 47],
'VISIBLEGROUPS': ['VISIBLEGROUPS', '', [['lib','grouplib.php',39]], 113],
'DEBUG_DEVELOPER': ['DEBUG_DEVELOPER', '', [['lib','setuplib.php',40]], 736],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'FORUM_MODE_THREADED': ['FORUM_MODE_THREADED', '', [['mod/forum','lib.php',34]], 5],
'FORUM_MAILED_ERROR': ['FORUM_MAILED_ERROR', '', [['mod/forum','lib.php',60]], 2],
'FEATURE_GRADE_HAS_GRADE': ['FEATURE_GRADE_HAS_GRADE', '', [['lib','moodlelib.php',394]], 29],
'FEATURE_GRADE_OUTCOMES': ['FEATURE_GRADE_OUTCOMES', '', [['lib','moodlelib.php',396]], 23],
'FORUM_CHOOSESUBSCRIBE': ['FORUM_CHOOSESUBSCRIBE', '', [['mod/forum','lib.php',37]], 38],
'FORMAT_HTML': ['FORMAT_HTML', '', [['lib','weblib.php',47]], 1121],
'FEATURE_COMPLETION_TRACKS_VIEWS': ['FEATURE_COMPLETION_TRACKS_VIEWS', '', [['lib','moodlelib.php',405]], 23],
'COMPLETION_INCOMPLETE': ['COMPLETION_INCOMPLETE', '', [['lib','completionlib.php',70]], 53],
'FEATURE_BACKUP_MOODLE2': ['FEATURE_BACKUP_MOODLE2', '', [['lib','moodlelib.php',434]], 35],
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 466],
'FORUM_MODE_FLATOLDEST': ['FORUM_MODE_FLATOLDEST', '', [['mod/forum','lib.php',32]], 4]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
