<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mod/forum/classes/subscriptions.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='mod/forum/classes';
filename='subscriptions.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mod/forum/classes/</a> -> <a href="subscriptions.php.html">subscriptions.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="subscriptions.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="subscriptions.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Forum subscription manager.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    mod_forum</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright  2014 Andrew Nicols &lt;andrew@nicols.co.uk&gt;</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  namespace mod_forum;
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment">/**</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * Forum subscription manager.</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> *</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * @copyright  2014 Andrew Nicols &lt;andrew@nicols.co.uk&gt;</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> */</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('subscriptions')" href="../../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a> {
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>      <span class="comment">/**</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">     * The status value for an unsubscribed discussion.</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">     *</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">     * @var int</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">     */</span>
<a name="l42"><span class="linenum">  42</span></a>      const FORUM_DISCUSSION_UNSUBSCRIBED = -1;
<a name="l43"><span class="linenum">  43</span></a>  
<a name="l44"><span class="linenum">  44</span></a>      <span class="comment">/**</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">     * The subscription cache for forums.</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment">     *</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment">     * The first level key is the user ID</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">     * The second level is the forum ID</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">     * The Value then is bool for subscribed of not.</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">     *</span>
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment">     * @var array[] An array of arrays.</span>
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment">     */</span>
<a name="l53"><span class="linenum">  53</span></a>      protected static <a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a> = array();
<a name="l54"><span class="linenum">  54</span></a>  
<a name="l55"><span class="linenum">  55</span></a>      <span class="comment">/**</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">     * The list of forums which have been wholly retrieved for the forum subscription cache.</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">     *</span>
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment">     * This allows for prior caching of an entire forum to reduce the</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment">     * number of DB queries in a subscription check loop.</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">     *</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">     * @var bool[]</span>
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">     */</span>
<a name="l63"><span class="linenum">  63</span></a>      protected static <a class="var it23848" onMouseOver="hilite(23848)" onMouseOut="lolite()" onClick="logVariable('fetchedforums')" href="../../../_variables/fetchedforums.html">$fetchedforums</a> = array();
<a name="l64"><span class="linenum">  64</span></a>  
<a name="l65"><span class="linenum">  65</span></a>      <span class="comment">/**</span>
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment">     * The subscription cache for forum discussions.</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment">     *</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">     * The first level key is the user ID</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment">     * The second level is the forum ID</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">     * The third level key is the discussion ID</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment">     * The value is then the users preference (int)</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment">     *</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment">     * @var array[]</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">     */</span>
<a name="l75"><span class="linenum">  75</span></a>      protected static <a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a> = array();
<a name="l76"><span class="linenum">  76</span></a>  
<a name="l77"><span class="linenum">  77</span></a>      <span class="comment">/**</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">     * The list of forums which have been wholly retrieved for the forum discussion subscription cache.</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">     *</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">     * This allows for prior caching of an entire forum to reduce the</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">     * number of DB queries in a subscription check loop.</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment">     *</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">     * @var bool[]</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment">     */</span>
<a name="l85"><span class="linenum">  85</span></a>      protected static <a class="var it23850" onMouseOver="hilite(23850)" onMouseOut="lolite()" onClick="logVariable('discussionfetchedforums')" href="../../../_variables/discussionfetchedforums.html">$discussionfetchedforums</a> = array();
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>      <span class="comment">/**</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">     * Whether a user is subscribed to this forum, or a discussion within</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">     * the forum.</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">     *</span>
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment">     * If a discussion is specified, then report whether the user is</span>
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">     * subscribed to posts to this particular discussion, taking into</span>
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">     * account the forum preference.</span>
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment">     *</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">     * If it is not specified then only the forum preference is considered.</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment">     *</span>
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">     * @param int $userid The user ID</span>
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">     * @param \stdClass $forum The record of the forum to test</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment">     * @param int $discussionid The ID of the discussion to check</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment">     * @param $cm The coursemodule record. If not supplied, this will be calculated using get_fast_modinfo instead.</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">     * @return boolean</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">     */</span>
<a name="l103"><span class="linenum"> 103</span></a>      public static function <a class="function" onClick="logFunction('is_subscribed')" href="../../../_functions/is_subscribed.html" onMouseOver="funcPopup(event,'is_subscribed')">is_subscribed</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>, <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../../_variables/discussionid.html">$discussionid</a> = null, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../../_variables/cm.html">$cm</a> = null) {
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment">        // If forum is force subscribed and has allowforcesubscribe, then user is subscribed.</span>
<a name="l105"><span class="linenum"> 105</span></a>          if (self::<a class="function" onClick="logFunction('is_forcesubscribed')" href="../../../_functions/is_forcesubscribed.html" onMouseOver="funcPopup(event,'is_forcesubscribed')">is_forcesubscribed</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>)) {
<a name="l106"><span class="linenum"> 106</span></a>              if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../../_variables/cm.html">$cm</a>) {
<a name="l107"><span class="linenum"> 107</span></a>                  <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/course.html">course</a>)-&gt;instances['forum'][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>];
<a name="l108"><span class="linenum"> 108</span></a>              }
<a name="l109"><span class="linenum"> 109</span></a>              if (<a class="function" onClick="logFunction('has_capability')" href="../../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/forum:allowforcesubscribe', \<a class="class" onClick="logClass('context_module')" href="../../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>), <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>)) {
<a name="l110"><span class="linenum"> 110</span></a>                  return true;
<a name="l111"><span class="linenum"> 111</span></a>              }
<a name="l112"><span class="linenum"> 112</span></a>          }
<a name="l113"><span class="linenum"> 113</span></a>  
<a name="l114"><span class="linenum"> 114</span></a>          if (<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../../_variables/discussionid.html">$discussionid</a> === null) {
<a name="l115"><span class="linenum"> 115</span></a>              return self::<a class="function" onClick="logFunction('is_subscribed_to_forum')" href="../../../_functions/is_subscribed_to_forum.html" onMouseOver="funcPopup(event,'is_subscribed_to_forum')">is_subscribed_to_forum</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>);
<a name="l116"><span class="linenum"> 116</span></a>          }
<a name="l117"><span class="linenum"> 117</span></a>  
<a name="l118"><span class="linenum"> 118</span></a>          <a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a> = self::<a class="function" onClick="logFunction('fetch_discussion_subscription')" href="../../../_functions/fetch_discussion_subscription.html" onMouseOver="funcPopup(event,'fetch_discussion_subscription')">fetch_discussion_subscription</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>);
<a name="l119"><span class="linenum"> 119</span></a>  
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment">        // Check whether there is a record for this discussion subscription.</span>
<a name="l121"><span class="linenum"> 121</span></a>          if (isset(<a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../../_variables/discussionid.html">$discussionid</a>])) {
<a name="l122"><span class="linenum"> 122</span></a>              return (<a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a>[<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../../_variables/discussionid.html">$discussionid</a>] != self::FORUM_DISCUSSION_UNSUBSCRIBED);
<a name="l123"><span class="linenum"> 123</span></a>          }
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>          return self::<a class="function" onClick="logFunction('is_subscribed_to_forum')" href="../../../_functions/is_subscribed_to_forum.html" onMouseOver="funcPopup(event,'is_subscribed_to_forum')">is_subscribed_to_forum</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>);
<a name="l126"><span class="linenum"> 126</span></a>      }
<a name="l127"><span class="linenum"> 127</span></a>  
<a name="l128"><span class="linenum"> 128</span></a>      <span class="comment">/**</span>
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">     * Whether a user is subscribed to this forum.</span>
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">     *</span>
<a name="l131"><span class="linenum"> 131</span></a>  <span class="comment">     * @param int $userid The user ID</span>
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">     * @param \stdClass $forum The record of the forum to test</span>
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">     * @return boolean</span>
<a name="l134"><span class="linenum"> 134</span></a>  <span class="comment">     */</span>
<a name="l135"><span class="linenum"> 135</span></a>      protected static function <a class="function" onClick="logFunction('is_subscribed_to_forum')" href="../../../_functions/is_subscribed_to_forum.html" onMouseOver="funcPopup(event,'is_subscribed_to_forum')">is_subscribed_to_forum</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>) {
<a name="l136"><span class="linenum"> 136</span></a>          return self::<a class="function" onClick="logFunction('fetch_subscription_cache')" href="../../../_functions/fetch_subscription_cache.html" onMouseOver="funcPopup(event,'fetch_subscription_cache')">fetch_subscription_cache</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>);
<a name="l137"><span class="linenum"> 137</span></a>      }
<a name="l138"><span class="linenum"> 138</span></a>  
<a name="l139"><span class="linenum"> 139</span></a>      <span class="comment">/**</span>
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">     * Helper to determine whether a forum has it's subscription mode set</span>
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment">     * to forced subscription.</span>
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment">     *</span>
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">     * @param \stdClass $forum The record of the forum to test</span>
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">     * @return bool</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">     */</span>
<a name="l146"><span class="linenum"> 146</span></a>      public static function <a class="function" onClick="logFunction('is_forcesubscribed')" href="../../../_functions/is_forcesubscribed.html" onMouseOver="funcPopup(event,'is_forcesubscribed')">is_forcesubscribed</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>) {
<a name="l147"><span class="linenum"> 147</span></a>          return (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/forcesubscribe.html">forcesubscribe</a> == <a class="constant" onClick="logConstant('FORUM_FORCESUBSCRIBE')" href="../../../_constants/FORUM_FORCESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_FORCESUBSCRIBE')">FORUM_FORCESUBSCRIBE</a>);
<a name="l148"><span class="linenum"> 148</span></a>      }
<a name="l149"><span class="linenum"> 149</span></a>  
<a name="l150"><span class="linenum"> 150</span></a>      <span class="comment">/**</span>
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment">     * Helper to determine whether a forum has it's subscription mode set to disabled.</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment">     *</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment">     * @param \stdClass $forum The record of the forum to test</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">     * @return bool</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">     */</span>
<a name="l156"><span class="linenum"> 156</span></a>      public static function <a class="function" onClick="logFunction('subscription_disabled')" href="../../../_functions/subscription_disabled.html" onMouseOver="funcPopup(event,'subscription_disabled')">subscription_disabled</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>) {
<a name="l157"><span class="linenum"> 157</span></a>          return (<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/forcesubscribe.html">forcesubscribe</a> == <a class="constant" onClick="logConstant('FORUM_DISALLOWSUBSCRIBE')" href="../../../_constants/FORUM_DISALLOWSUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_DISALLOWSUBSCRIBE')">FORUM_DISALLOWSUBSCRIBE</a>);
<a name="l158"><span class="linenum"> 158</span></a>      }
<a name="l159"><span class="linenum"> 159</span></a>  
<a name="l160"><span class="linenum"> 160</span></a>      <span class="comment">/**</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment">     * Helper to determine whether the specified forum can be subscribed to.</span>
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment">     *</span>
<a name="l163"><span class="linenum"> 163</span></a>  <span class="comment">     * @param \stdClass $forum The record of the forum to test</span>
<a name="l164"><span class="linenum"> 164</span></a>  <span class="comment">     * @return bool</span>
<a name="l165"><span class="linenum"> 165</span></a>  <span class="comment">     */</span>
<a name="l166"><span class="linenum"> 166</span></a>      public static function <a class="function" onClick="logFunction('is_subscribable')" href="../../../_functions/is_subscribable.html" onMouseOver="funcPopup(event,'is_subscribable')">is_subscribable</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>) {
<a name="l167"><span class="linenum"> 167</span></a>          return (!\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('is_forcesubscribed')" href="../../../_functions/is_forcesubscribed.html" onMouseOver="funcPopup(event,'is_forcesubscribed')">is_forcesubscribed</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>) &amp;&amp;
<a name="l168"><span class="linenum"> 168</span></a>                  !\mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('subscription_disabled')" href="../../../_functions/subscription_disabled.html" onMouseOver="funcPopup(event,'subscription_disabled')">subscription_disabled</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>));
<a name="l169"><span class="linenum"> 169</span></a>      }
<a name="l170"><span class="linenum"> 170</span></a>  
<a name="l171"><span class="linenum"> 171</span></a>      <span class="comment">/**</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment">     * Set the forum subscription mode.</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">     *</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment">     * By default when called without options, this is set to FORUM_FORCESUBSCRIBE.</span>
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">     *</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">     * @param \stdClass $forum The record of the forum to set</span>
<a name="l177"><span class="linenum"> 177</span></a>  <span class="comment">     * @param int $status The new subscription state</span>
<a name="l178"><span class="linenum"> 178</span></a>  <span class="comment">     * @return bool</span>
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment">     */</span>
<a name="l180"><span class="linenum"> 180</span></a>      public static function <a class="function" onClick="logFunction('set_subscription_mode')" href="../../../_functions/set_subscription_mode.html" onMouseOver="funcPopup(event,'set_subscription_mode')">set_subscription_mode</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> = 1) {
<a name="l181"><span class="linenum"> 181</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l182"><span class="linenum"> 182</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>(&quot;forum&quot;, &quot;forcesubscribe&quot;, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>, array(&quot;id&quot; =&gt; <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>));
<a name="l183"><span class="linenum"> 183</span></a>      }
<a name="l184"><span class="linenum"> 184</span></a>  
<a name="l185"><span class="linenum"> 185</span></a>      <span class="comment">/**</span>
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment">     * Returns the current subscription mode for the forum.</span>
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment">     *</span>
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment">     * @param \stdClass $forum The record of the forum to set</span>
<a name="l189"><span class="linenum"> 189</span></a>  <span class="comment">     * @return int The forum subscription mode</span>
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment">     */</span>
<a name="l191"><span class="linenum"> 191</span></a>      public static function <a class="function" onClick="logFunction('get_subscription_mode')" href="../../../_functions/get_subscription_mode.html" onMouseOver="funcPopup(event,'get_subscription_mode')">get_subscription_mode</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>) {
<a name="l192"><span class="linenum"> 192</span></a>          return <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('forcesubscribe')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/forcesubscribe.html">forcesubscribe</a>;
<a name="l193"><span class="linenum"> 193</span></a>      }
<a name="l194"><span class="linenum"> 194</span></a>  
<a name="l195"><span class="linenum"> 195</span></a>      <span class="comment">/**</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">     * Returns an array of forums that the current user is subscribed to and is allowed to unsubscribe from</span>
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment">     *</span>
<a name="l198"><span class="linenum"> 198</span></a>  <span class="comment">     * @return array An array of unsubscribable forums</span>
<a name="l199"><span class="linenum"> 199</span></a>  <span class="comment">     */</span>
<a name="l200"><span class="linenum"> 200</span></a>      public static function <a class="function" onClick="logFunction('get_unsubscribable_forums')" href="../../../_functions/get_unsubscribable_forums.html" onMouseOver="funcPopup(event,'get_unsubscribable_forums')">get_unsubscribable_forums</a>() {
<a name="l201"><span class="linenum"> 201</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l202"><span class="linenum"> 202</span></a>  
<a name="l203"><span class="linenum"> 203</span></a>  <span class="comment">        // Get courses that $USER is enrolled in and can see.</span>
<a name="l204"><span class="linenum"> 204</span></a>          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../../_variables/courses.html">$courses</a> = <a class="function" onClick="logFunction('enrol_get_my_courses')" href="../../../_functions/enrol_get_my_courses.html" onMouseOver="funcPopup(event,'enrol_get_my_courses')">enrol_get_my_courses</a>();
<a name="l205"><span class="linenum"> 205</span></a>          if (empty(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../../_variables/courses.html">$courses</a>)) {
<a name="l206"><span class="linenum"> 206</span></a>              return array();
<a name="l207"><span class="linenum"> 207</span></a>          }
<a name="l208"><span class="linenum"> 208</span></a>  
<a name="l209"><span class="linenum"> 209</span></a>          <a class="var it2413" onMouseOver="hilite(2413)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../../../_variables/courseids.html">$courseids</a> = array();
<a name="l210"><span class="linenum"> 210</span></a>          foreach(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../../_variables/courses.html">$courses</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>) {
<a name="l211"><span class="linenum"> 211</span></a>              <a class="var it2413" onMouseOver="hilite(2413)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../../../_variables/courseids.html">$courseids</a>[] = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l212"><span class="linenum"> 212</span></a>          }
<a name="l213"><span class="linenum"> 213</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../../_variables/coursesql.html">$coursesql</a>, <a class="var it23267" onMouseOver="hilite(23267)" onMouseOut="lolite()" onClick="logVariable('courseparams')" href="../../../_variables/courseparams.html">$courseparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it2413" onMouseOver="hilite(2413)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../../../_variables/courseids.html">$courseids</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'c');
<a name="l214"><span class="linenum"> 214</span></a>  
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment">        // Get all forums from the user's courses that they are subscribed to and which are not set to forced.</span>
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment">        // It is possible for users to be subscribed to a forum in subscription disallowed mode so they must be listed</span>
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment">        // here so that that can be unsubscribed from.</span>
<a name="l218"><span class="linenum"> 218</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT f.id, cm.id as cm, cm.visible, f.course
<a name="l219"><span class="linenum"> 219</span></a>                  FROM {forum} f
<a name="l220"><span class="linenum"> 220</span></a>                  JOIN {course_modules} cm ON cm.instance = f.id
<a name="l221"><span class="linenum"> 221</span></a>                  JOIN {modules} m ON m.name = :modulename AND m.id = cm.module
<a name="l222"><span class="linenum"> 222</span></a>                  LEFT JOIN {forum_subscriptions} fs <a class="function" onClick="logFunction('ON')" href="../../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (fs.forum = f.id AND fs.userid = :userid)
<a name="l223"><span class="linenum"> 223</span></a>                  WHERE f.forcesubscribe &lt;&gt; :forcesubscribe
<a name="l224"><span class="linenum"> 224</span></a>                  AND fs.id IS NOT NULL
<a name="l225"><span class="linenum"> 225</span></a>                  AND cm.course
<a name="l226"><span class="linenum"> 226</span></a>                  <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../../_variables/coursesql.html">$coursesql</a>&quot;;
<a name="l227"><span class="linenum"> 227</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it23267" onMouseOver="hilite(23267)" onMouseOut="lolite()" onClick="logVariable('courseparams')" href="../../../_variables/courseparams.html">$courseparams</a>, array(
<a name="l228"><span class="linenum"> 228</span></a>              'modulename'=&gt;'forum',
<a name="l229"><span class="linenum"> 229</span></a>              'userid' =&gt; <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l230"><span class="linenum"> 230</span></a>              'forcesubscribe' =&gt; <a class="constant" onClick="logConstant('FORUM_FORCESUBSCRIBE')" href="../../../_constants/FORUM_FORCESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_FORCESUBSCRIBE')">FORUM_FORCESUBSCRIBE</a>,
<a name="l231"><span class="linenum"> 231</span></a>          ));
<a name="l232"><span class="linenum"> 232</span></a>          <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../../_variables/forums.html">$forums</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>);
<a name="l233"><span class="linenum"> 233</span></a>  
<a name="l234"><span class="linenum"> 234</span></a>          <a class="var it23851" onMouseOver="hilite(23851)" onMouseOut="lolite()" onClick="logVariable('unsubscribableforums')" href="../../../_variables/unsubscribableforums.html">$unsubscribableforums</a> = array();
<a name="l235"><span class="linenum"> 235</span></a>          foreach(<a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../../_variables/forums.html">$forums</a> as <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>) {
<a name="l236"><span class="linenum"> 236</span></a>              if (empty(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('visible')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/visible.html">visible</a>)) {
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment">                // The forum is hidden - check if the user can view the forum.</span>
<a name="l238"><span class="linenum"> 238</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = \<a class="class" onClick="logClass('context_module')" href="../../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('cm')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/cm.html">cm</a>);
<a name="l239"><span class="linenum"> 239</span></a>                  if (!<a class="function" onClick="logFunction('has_capability')" href="../../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewhiddenactivities', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>)) {
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment">                    // The user can't see the hidden forum to cannot unsubscribe.</span>
<a name="l241"><span class="linenum"> 241</span></a>                      continue;
<a name="l242"><span class="linenum"> 242</span></a>                  }
<a name="l243"><span class="linenum"> 243</span></a>              }
<a name="l244"><span class="linenum"> 244</span></a>  
<a name="l245"><span class="linenum"> 245</span></a>              <a class="var it23851" onMouseOver="hilite(23851)" onMouseOut="lolite()" onClick="logVariable('unsubscribableforums')" href="../../../_variables/unsubscribableforums.html">$unsubscribableforums</a>[] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>;
<a name="l246"><span class="linenum"> 246</span></a>          }
<a name="l247"><span class="linenum"> 247</span></a>          <a class="var it3262" onMouseOver="hilite(3262)" onMouseOut="lolite()" onClick="logVariable('forums')" href="../../../_variables/forums.html">$forums</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>          return <a class="var it23851" onMouseOver="hilite(23851)" onMouseOut="lolite()" onClick="logVariable('unsubscribableforums')" href="../../../_variables/unsubscribableforums.html">$unsubscribableforums</a>;
<a name="l250"><span class="linenum"> 250</span></a>      }
<a name="l251"><span class="linenum"> 251</span></a>  
<a name="l252"><span class="linenum"> 252</span></a>      <span class="comment">/**</span>
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment">     * Get the list of potential subscribers to a forum.</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment">     *</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">     * @param context_module $context the forum context.</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment">     * @param integer $groupid the id of a group, or 0 for all groups.</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">     * @param string $fields the list of fields to return for each user. As for get_users_by_capability.</span>
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment">     * @param string $sort sort order. As for get_users_by_capability.</span>
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment">     * @return array list of users.</span>
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment">     */</span>
<a name="l261"><span class="linenum"> 261</span></a>      public static function <a class="function" onClick="logFunction('get_potential_subscribers')" href="../../../_functions/get_potential_subscribers.html" onMouseOver="funcPopup(event,'get_potential_subscribers')">get_potential_subscribers</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../../_variables/groupid.html">$groupid</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../../_variables/fields.html">$fields</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../../_variables/sort.html">$sort</a> = '') {
<a name="l262"><span class="linenum"> 262</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l263"><span class="linenum"> 263</span></a>  
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">        // Only active enrolled users or everybody on the frontpage.</span>
<a name="l265"><span class="linenum"> 265</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it4199" onMouseOver="hilite(4199)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../../../_variables/esql.html">$esql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>) = <a class="function" onClick="logFunction('get_enrolled_sql')" href="../../../_functions/get_enrolled_sql.html" onMouseOver="funcPopup(event,'get_enrolled_sql')">get_enrolled_sql</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>, 'mod/forum:allowforcesubscribe', <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../../_variables/groupid.html">$groupid</a>, true);
<a name="l266"><span class="linenum"> 266</span></a>          if (!<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../../_variables/sort.html">$sort</a>) {
<a name="l267"><span class="linenum"> 267</span></a>              <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../../_variables/sort.html">$sort</a>, <a class="var it13756" onMouseOver="hilite(13756)" onMouseOut="lolite()" onClick="logVariable('sortparams')" href="../../../_variables/sortparams.html">$sortparams</a>) = <a class="function" onClick="logFunction('users_order_by_sql')" href="../../../_functions/users_order_by_sql.html" onMouseOver="funcPopup(event,'users_order_by_sql')">users_order_by_sql</a>('u');
<a name="l268"><span class="linenum"> 268</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>, <a class="var it13756" onMouseOver="hilite(13756)" onMouseOut="lolite()" onClick="logVariable('sortparams')" href="../../../_variables/sortparams.html">$sortparams</a>);
<a name="l269"><span class="linenum"> 269</span></a>          }
<a name="l270"><span class="linenum"> 270</span></a>  
<a name="l271"><span class="linenum"> 271</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../../_variables/fields.html">$fields</a>
<a name="l272"><span class="linenum"> 272</span></a>                  FROM {user} u
<a name="l273"><span class="linenum"> 273</span></a>                  <a class="function" onClick="logFunction('JOIN')" href="../../../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (<a class="var it4199" onMouseOver="hilite(4199)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../../../_variables/esql.html">$esql</a>) je ON je.id = u.id
<a name="l274"><span class="linenum"> 274</span></a>              ORDER BY <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../../_variables/sort.html">$sort</a>&quot;;
<a name="l275"><span class="linenum"> 275</span></a>  
<a name="l276"><span class="linenum"> 276</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>);
<a name="l277"><span class="linenum"> 277</span></a>      }
<a name="l278"><span class="linenum"> 278</span></a>  
<a name="l279"><span class="linenum"> 279</span></a>      <span class="comment">/**</span>
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment">     * Fetch the forum subscription data for the specified userid and forum.</span>
<a name="l281"><span class="linenum"> 281</span></a>  <span class="comment">     *</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">     * @param int $forumid The forum to retrieve a cache for</span>
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment">     * @param int $userid The user ID</span>
<a name="l284"><span class="linenum"> 284</span></a>  <span class="comment">     * @return boolean</span>
<a name="l285"><span class="linenum"> 285</span></a>  <span class="comment">     */</span>
<a name="l286"><span class="linenum"> 286</span></a>      public static function <a class="function" onClick="logFunction('fetch_subscription_cache')" href="../../../_functions/fetch_subscription_cache.html" onMouseOver="funcPopup(event,'fetch_subscription_cache')">fetch_subscription_cache</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>) {
<a name="l287"><span class="linenum"> 287</span></a>          if (isset(self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>]) &amp;&amp; isset(self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>])) {
<a name="l288"><span class="linenum"> 288</span></a>              return self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>];
<a name="l289"><span class="linenum"> 289</span></a>          }
<a name="l290"><span class="linenum"> 290</span></a>          self::<a class="function" onClick="logFunction('fill_subscription_cache')" href="../../../_functions/fill_subscription_cache.html" onMouseOver="funcPopup(event,'fill_subscription_cache')">fill_subscription_cache</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>);
<a name="l291"><span class="linenum"> 291</span></a>  
<a name="l292"><span class="linenum"> 292</span></a>          if (!isset(self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>]) || !isset(self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>])) {
<a name="l293"><span class="linenum"> 293</span></a>              return false;
<a name="l294"><span class="linenum"> 294</span></a>          }
<a name="l295"><span class="linenum"> 295</span></a>  
<a name="l296"><span class="linenum"> 296</span></a>          return self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>];
<a name="l297"><span class="linenum"> 297</span></a>      }
<a name="l298"><span class="linenum"> 298</span></a>  
<a name="l299"><span class="linenum"> 299</span></a>      <span class="comment">/**</span>
<a name="l300"><span class="linenum"> 300</span></a>  <span class="comment">     * Fill the forum subscription data for the specified userid and forum.</span>
<a name="l301"><span class="linenum"> 301</span></a>  <span class="comment">     *</span>
<a name="l302"><span class="linenum"> 302</span></a>  <span class="comment">     * If the userid is not specified, then all subscription data for that forum is fetched in a single query and used</span>
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment">     * for subsequent lookups without requiring further database queries.</span>
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment">     *</span>
<a name="l305"><span class="linenum"> 305</span></a>  <span class="comment">     * @param int $forumid The forum to retrieve a cache for</span>
<a name="l306"><span class="linenum"> 306</span></a>  <span class="comment">     * @param int $userid The user ID</span>
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">     * @return void</span>
<a name="l308"><span class="linenum"> 308</span></a>  <span class="comment">     */</span>
<a name="l309"><span class="linenum"> 309</span></a>      public static function <a class="function" onClick="logFunction('fill_subscription_cache')" href="../../../_functions/fill_subscription_cache.html" onMouseOver="funcPopup(event,'fill_subscription_cache')">fill_subscription_cache</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a> = null) {
<a name="l310"><span class="linenum"> 310</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l311"><span class="linenum"> 311</span></a>  
<a name="l312"><span class="linenum"> 312</span></a>          if (!isset(self::<a class="var it23848" onMouseOver="hilite(23848)" onMouseOut="lolite()" onClick="logVariable('fetchedforums')" href="../../../_variables/fetchedforums.html">$fetchedforums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>])) {
<a name="l313"><span class="linenum"> 313</span></a>  <span class="comment">            // This forum has not been fetched as a whole.</span>
<a name="l314"><span class="linenum"> 314</span></a>              if (isset(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>)) {
<a name="l315"><span class="linenum"> 315</span></a>                  if (!isset(self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>])) {
<a name="l316"><span class="linenum"> 316</span></a>                      self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>] = array();
<a name="l317"><span class="linenum"> 317</span></a>                  }
<a name="l318"><span class="linenum"> 318</span></a>  
<a name="l319"><span class="linenum"> 319</span></a>                  if (!isset(self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>])) {
<a name="l320"><span class="linenum"> 320</span></a>                      if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('forum_subscriptions', array(
<a name="l321"><span class="linenum"> 321</span></a>                          'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l322"><span class="linenum"> 322</span></a>                          'forum' =&gt; <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>,
<a name="l323"><span class="linenum"> 323</span></a>                      ))) {
<a name="l324"><span class="linenum"> 324</span></a>                          self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>] = true;
<a name="l325"><span class="linenum"> 325</span></a>                      } else {
<a name="l326"><span class="linenum"> 326</span></a>                          self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>] = false;
<a name="l327"><span class="linenum"> 327</span></a>                      }
<a name="l328"><span class="linenum"> 328</span></a>                  }
<a name="l329"><span class="linenum"> 329</span></a>              } else {
<a name="l330"><span class="linenum"> 330</span></a>                  <a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('forum_subscriptions', array(
<a name="l331"><span class="linenum"> 331</span></a>                      'forum' =&gt; <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>,
<a name="l332"><span class="linenum"> 332</span></a>                  ), '', 'id, userid');
<a name="l333"><span class="linenum"> 333</span></a>                  foreach (<a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a> =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>) {
<a name="l334"><span class="linenum"> 334</span></a>                      if (!isset(self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('userid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a>])) {
<a name="l335"><span class="linenum"> 335</span></a>                          self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('userid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a>] = array();
<a name="l336"><span class="linenum"> 336</span></a>                      }
<a name="l337"><span class="linenum"> 337</span></a>                      self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('userid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>] = true;
<a name="l338"><span class="linenum"> 338</span></a>                  }
<a name="l339"><span class="linenum"> 339</span></a>                  self::<a class="var it23848" onMouseOver="hilite(23848)" onMouseOut="lolite()" onClick="logVariable('fetchedforums')" href="../../../_variables/fetchedforums.html">$fetchedforums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>] = true;
<a name="l340"><span class="linenum"> 340</span></a>                  <a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l341"><span class="linenum"> 341</span></a>              }
<a name="l342"><span class="linenum"> 342</span></a>          }
<a name="l343"><span class="linenum"> 343</span></a>      }
<a name="l344"><span class="linenum"> 344</span></a>  
<a name="l345"><span class="linenum"> 345</span></a>      <span class="comment">/**</span>
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment">     * Fill the forum subscription data for all forums that the specified userid can subscribe to in the specified course.</span>
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment">     *</span>
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment">     * @param int $courseid The course to retrieve a cache for</span>
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment">     * @param int $userid The user ID</span>
<a name="l350"><span class="linenum"> 350</span></a>  <span class="comment">     * @return void</span>
<a name="l351"><span class="linenum"> 351</span></a>  <span class="comment">     */</span>
<a name="l352"><span class="linenum"> 352</span></a>      public static function <a class="function" onClick="logFunction('fill_subscription_cache_for_course')" href="../../../_functions/fill_subscription_cache_for_course.html" onMouseOver="funcPopup(event,'fill_subscription_cache_for_course')">fill_subscription_cache_for_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>) {
<a name="l353"><span class="linenum"> 353</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l354"><span class="linenum"> 354</span></a>  
<a name="l355"><span class="linenum"> 355</span></a>          if (!isset(self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>])) {
<a name="l356"><span class="linenum"> 356</span></a>              self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>] = array();
<a name="l357"><span class="linenum"> 357</span></a>          }
<a name="l358"><span class="linenum"> 358</span></a>  
<a name="l359"><span class="linenum"> 359</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT
<a name="l360"><span class="linenum"> 360</span></a>                      f.id AS forumid,
<a name="l361"><span class="linenum"> 361</span></a>                      s.id AS subscriptionid
<a name="l362"><span class="linenum"> 362</span></a>                  FROM {forum} f
<a name="l363"><span class="linenum"> 363</span></a>                  LEFT JOIN {forum_subscriptions} s <a class="function" onClick="logFunction('ON')" href="../../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (s.forum = f.id AND s.userid = :userid)
<a name="l364"><span class="linenum"> 364</span></a>                  WHERE f.course = :course
<a name="l365"><span class="linenum"> 365</span></a>                  AND f.forcesubscribe &lt;&gt; :subscriptionforced&quot;;
<a name="l366"><span class="linenum"> 366</span></a>  
<a name="l367"><span class="linenum"> 367</span></a>          <a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, array(
<a name="l368"><span class="linenum"> 368</span></a>              'course' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../_variables/courseid.html">$courseid</a>,
<a name="l369"><span class="linenum"> 369</span></a>              'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l370"><span class="linenum"> 370</span></a>              'subscriptionforced' =&gt; <a class="constant" onClick="logConstant('FORUM_FORCESUBSCRIBE')" href="../../../_constants/FORUM_FORCESUBSCRIBE.html" onMouseOver="constPopup(event,'FORUM_FORCESUBSCRIBE')">FORUM_FORCESUBSCRIBE</a>,
<a name="l371"><span class="linenum"> 371</span></a>          ));
<a name="l372"><span class="linenum"> 372</span></a>  
<a name="l373"><span class="linenum"> 373</span></a>          foreach (<a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a> =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>) {
<a name="l374"><span class="linenum"> 374</span></a>              self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a>] = !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('subscriptionid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../../_variables/subscriptionid.html">subscriptionid</a>);
<a name="l375"><span class="linenum"> 375</span></a>          }
<a name="l376"><span class="linenum"> 376</span></a>          <a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l377"><span class="linenum"> 377</span></a>      }
<a name="l378"><span class="linenum"> 378</span></a>  
<a name="l379"><span class="linenum"> 379</span></a>      <span class="comment">/**</span>
<a name="l380"><span class="linenum"> 380</span></a>  <span class="comment">     * Returns a list of user objects who are subscribed to this forum.</span>
<a name="l381"><span class="linenum"> 381</span></a>  <span class="comment">     *</span>
<a name="l382"><span class="linenum"> 382</span></a>  <span class="comment">     * @param stdClass $forum The forum record.</span>
<a name="l383"><span class="linenum"> 383</span></a>  <span class="comment">     * @param int $groupid The group id if restricting subscriptions to a group of users, or 0 for all.</span>
<a name="l384"><span class="linenum"> 384</span></a>  <span class="comment">     * @param context_module $context the forum context, to save re-fetching it where possible.</span>
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment">     * @param string $fields requested user fields (with &quot;u.&quot; table prefix).</span>
<a name="l386"><span class="linenum"> 386</span></a>  <span class="comment">     * @param boolean $includediscussionsubscriptions Whether to take discussion subscriptions and unsubscriptions into consideration.</span>
<a name="l387"><span class="linenum"> 387</span></a>  <span class="comment">     * @return array list of users.</span>
<a name="l388"><span class="linenum"> 388</span></a>  <span class="comment">     */</span>
<a name="l389"><span class="linenum"> 389</span></a>      public static function <a class="function" onClick="logFunction('fetch_subscribed_users')" href="../../../_functions/fetch_subscribed_users.html" onMouseOver="funcPopup(event,'fetch_subscribed_users')">fetch_subscribed_users</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../../_variables/groupid.html">$groupid</a> = 0, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = null, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../../_variables/fields.html">$fields</a> = null,
<a name="l390"><span class="linenum"> 390</span></a>              <a class="var it23852" onMouseOver="hilite(23852)" onMouseOut="lolite()" onClick="logVariable('includediscussionsubscriptions')" href="../../../_variables/includediscussionsubscriptions.html">$includediscussionsubscriptions</a> = false) {
<a name="l391"><span class="linenum"> 391</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l392"><span class="linenum"> 392</span></a>  
<a name="l393"><span class="linenum"> 393</span></a>          if (empty(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../../_variables/fields.html">$fields</a>)) {
<a name="l394"><span class="linenum"> 394</span></a>              <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../../_variables/allnames.html">$allnames</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../../../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u');
<a name="l395"><span class="linenum"> 395</span></a>              <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../../_variables/fields.html">$fields</a> =&quot;u.id,
<a name="l396"><span class="linenum"> 396</span></a>                        u.username,
<a name="l397"><span class="linenum"> 397</span></a>                        <a class="var it4609" onMouseOver="hilite(4609)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../../../_variables/allnames.html">$allnames</a>,
<a name="l398"><span class="linenum"> 398</span></a>                        u.maildisplay,
<a name="l399"><span class="linenum"> 399</span></a>                        u.mailformat,
<a name="l400"><span class="linenum"> 400</span></a>                        u.maildigest,
<a name="l401"><span class="linenum"> 401</span></a>                        u.imagealt,
<a name="l402"><span class="linenum"> 402</span></a>                        u.email,
<a name="l403"><span class="linenum"> 403</span></a>                        u.emailstop,
<a name="l404"><span class="linenum"> 404</span></a>                        u.city,
<a name="l405"><span class="linenum"> 405</span></a>                        u.country,
<a name="l406"><span class="linenum"> 406</span></a>                        u.lastaccess,
<a name="l407"><span class="linenum"> 407</span></a>                        u.lastlogin,
<a name="l408"><span class="linenum"> 408</span></a>                        u.picture,
<a name="l409"><span class="linenum"> 409</span></a>                        u.timezone,
<a name="l410"><span class="linenum"> 410</span></a>                        u.theme,
<a name="l411"><span class="linenum"> 411</span></a>                        u.lang,
<a name="l412"><span class="linenum"> 412</span></a>                        u.trackforums,
<a name="l413"><span class="linenum"> 413</span></a>                        u.mnethostid&quot;;
<a name="l414"><span class="linenum"> 414</span></a>          }
<a name="l415"><span class="linenum"> 415</span></a>  
<a name="l416"><span class="linenum"> 416</span></a>  <span class="comment">        // Retrieve the forum context if it wasn't specified.</span>
<a name="l417"><span class="linenum"> 417</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = <a class="function" onClick="logFunction('forum_get_context')" href="../../../_functions/forum_get_context.html" onMouseOver="funcPopup(event,'forum_get_context')">forum_get_context</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>);
<a name="l418"><span class="linenum"> 418</span></a>  
<a name="l419"><span class="linenum"> 419</span></a>          if (self::<a class="function" onClick="logFunction('is_forcesubscribed')" href="../../../_functions/is_forcesubscribed.html" onMouseOver="funcPopup(event,'is_forcesubscribed')">is_forcesubscribed</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>)) {
<a name="l420"><span class="linenum"> 420</span></a>              <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a> = \mod_forum\<a class="class" onClick="logClass('subscriptions')" href="../../../_classes/subscriptions.html" onMouseOver="classPopup(event,'subscriptions')">subscriptions</a>::<a class="function" onClick="logFunction('get_potential_subscribers')" href="../../../_functions/get_potential_subscribers.html" onMouseOver="funcPopup(event,'get_potential_subscribers')">get_potential_subscribers</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../../_variables/groupid.html">$groupid</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../../_variables/fields.html">$fields</a>, &quot;u.email ASC&quot;);
<a name="l421"><span class="linenum"> 421</span></a>  
<a name="l422"><span class="linenum"> 422</span></a>          } else {
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment">            // Only active enrolled users or everybody on the frontpage.</span>
<a name="l424"><span class="linenum"> 424</span></a>              <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it4199" onMouseOver="hilite(4199)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../../../_variables/esql.html">$esql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>) = <a class="function" onClick="logFunction('get_enrolled_sql')" href="../../../_functions/get_enrolled_sql.html" onMouseOver="funcPopup(event,'get_enrolled_sql')">get_enrolled_sql</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>, '', <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../../_variables/groupid.html">$groupid</a>, true);
<a name="l425"><span class="linenum"> 425</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['forumid'] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l426"><span class="linenum"> 426</span></a>  
<a name="l427"><span class="linenum"> 427</span></a>              if (<a class="var it23852" onMouseOver="hilite(23852)" onMouseOut="lolite()" onClick="logVariable('includediscussionsubscriptions')" href="../../../_variables/includediscussionsubscriptions.html">$includediscussionsubscriptions</a>) {
<a name="l428"><span class="linenum"> 428</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['sforumid'] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l429"><span class="linenum"> 429</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['dsforumid'] = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l430"><span class="linenum"> 430</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['unsubscribed'] = self::FORUM_DISCUSSION_UNSUBSCRIBED;
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>                  <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../../_variables/fields.html">$fields</a>
<a name="l433"><span class="linenum"> 433</span></a>                          FROM (
<a name="l434"><span class="linenum"> 434</span></a>                              SELECT userid FROM {forum_subscriptions} s
<a name="l435"><span class="linenum"> 435</span></a>                              WHERE
<a name="l436"><span class="linenum"> 436</span></a>                                  s.forum = :sforumid
<a name="l437"><span class="linenum"> 437</span></a>                                  UNION
<a name="l438"><span class="linenum"> 438</span></a>                              SELECT userid FROM {forum_discussion_subs} ds
<a name="l439"><span class="linenum"> 439</span></a>                              WHERE
<a name="l440"><span class="linenum"> 440</span></a>                                  ds.forum = :dsforumid AND ds.preference &lt;&gt; :unsubscribed
<a name="l441"><span class="linenum"> 441</span></a>                          ) subscriptions
<a name="l442"><span class="linenum"> 442</span></a>                          JOIN {user} u ON u.id = subscriptions.userid
<a name="l443"><span class="linenum"> 443</span></a>                          <a class="function" onClick="logFunction('JOIN')" href="../../../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (<a class="var it4199" onMouseOver="hilite(4199)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../../../_variables/esql.html">$esql</a>) je ON je.id = u.id
<a name="l444"><span class="linenum"> 444</span></a>                          ORDER BY u.email ASC&quot;;
<a name="l445"><span class="linenum"> 445</span></a>  
<a name="l446"><span class="linenum"> 446</span></a>              } else {
<a name="l447"><span class="linenum"> 447</span></a>                  <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../../_variables/fields.html">$fields</a>
<a name="l448"><span class="linenum"> 448</span></a>                          FROM {user} u
<a name="l449"><span class="linenum"> 449</span></a>                          <a class="function" onClick="logFunction('JOIN')" href="../../../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (<a class="var it4199" onMouseOver="hilite(4199)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../../../_variables/esql.html">$esql</a>) je ON je.id = u.id
<a name="l450"><span class="linenum"> 450</span></a>                          JOIN {forum_subscriptions} s ON s.userid = u.id
<a name="l451"><span class="linenum"> 451</span></a>                          WHERE
<a name="l452"><span class="linenum"> 452</span></a>                            s.forum = :forumid
<a name="l453"><span class="linenum"> 453</span></a>                          ORDER BY u.email ASC&quot;;
<a name="l454"><span class="linenum"> 454</span></a>              }
<a name="l455"><span class="linenum"> 455</span></a>              <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>);
<a name="l456"><span class="linenum"> 456</span></a>          }
<a name="l457"><span class="linenum"> 457</span></a>  
<a name="l458"><span class="linenum"> 458</span></a>  <span class="comment">        // Guest user should never be subscribed to a forum.</span>
<a name="l459"><span class="linenum"> 459</span></a>          unset(<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>[<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/siteguest.html">siteguest</a>]);
<a name="l460"><span class="linenum"> 460</span></a>  
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">        // Apply the activity module availability resetrictions.</span>
<a name="l462"><span class="linenum"> 462</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('forum', <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/course.html">course</a>);
<a name="l463"><span class="linenum"> 463</span></a>          <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('course')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/course.html">course</a>);
<a name="l464"><span class="linenum"> 464</span></a>          <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a> = new \core_availability\info_module(<a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_cm')" href="../../../_functions/get_cm.html" onMouseOver="funcPopup(event,'get_cm')">get_cm</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l465"><span class="linenum"> 465</span></a>          <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a> = <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>-&gt;<a class="function" onClick="logFunction('filter_user_list')" href="../../../_functions/filter_user_list.html" onMouseOver="funcPopup(event,'filter_user_list')">filter_user_list</a>(<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>);
<a name="l466"><span class="linenum"> 466</span></a>  
<a name="l467"><span class="linenum"> 467</span></a>          return <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../../_variables/results.html">$results</a>;
<a name="l468"><span class="linenum"> 468</span></a>      }
<a name="l469"><span class="linenum"> 469</span></a>  
<a name="l470"><span class="linenum"> 470</span></a>      <span class="comment">/**</span>
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment">     * Retrieve the discussion subscription data for the specified userid and forum.</span>
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment">     *</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">     * This is returned as an array of discussions for that forum which contain the preference in a stdClass.</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment">     *</span>
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">     * @param int $forumid The forum to retrieve a cache for</span>
<a name="l476"><span class="linenum"> 476</span></a>  <span class="comment">     * @param int $userid The user ID</span>
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">     * @return array of stdClass objects with one per discussion in the forum.</span>
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">     */</span>
<a name="l479"><span class="linenum"> 479</span></a>      public static function <a class="function" onClick="logFunction('fetch_discussion_subscription')" href="../../../_functions/fetch_discussion_subscription.html" onMouseOver="funcPopup(event,'fetch_discussion_subscription')">fetch_discussion_subscription</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a> = null) {
<a name="l480"><span class="linenum"> 480</span></a>          self::<a class="function" onClick="logFunction('fill_discussion_subscription_cache')" href="../../../_functions/fill_discussion_subscription_cache.html" onMouseOver="funcPopup(event,'fill_discussion_subscription_cache')">fill_discussion_subscription_cache</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>);
<a name="l481"><span class="linenum"> 481</span></a>  
<a name="l482"><span class="linenum"> 482</span></a>          if (!isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>]) || !isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>])) {
<a name="l483"><span class="linenum"> 483</span></a>              return array();
<a name="l484"><span class="linenum"> 484</span></a>          }
<a name="l485"><span class="linenum"> 485</span></a>  
<a name="l486"><span class="linenum"> 486</span></a>          return self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>];
<a name="l487"><span class="linenum"> 487</span></a>      }
<a name="l488"><span class="linenum"> 488</span></a>  
<a name="l489"><span class="linenum"> 489</span></a>      <span class="comment">/**</span>
<a name="l490"><span class="linenum"> 490</span></a>  <span class="comment">     * Fill the discussion subscription data for the specified userid and forum.</span>
<a name="l491"><span class="linenum"> 491</span></a>  <span class="comment">     *</span>
<a name="l492"><span class="linenum"> 492</span></a>  <span class="comment">     * If the userid is not specified, then all discussion subscription data for that forum is fetched in a single query</span>
<a name="l493"><span class="linenum"> 493</span></a>  <span class="comment">     * and used for subsequent lookups without requiring further database queries.</span>
<a name="l494"><span class="linenum"> 494</span></a>  <span class="comment">     *</span>
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment">     * @param int $forumid The forum to retrieve a cache for</span>
<a name="l496"><span class="linenum"> 496</span></a>  <span class="comment">     * @param int $userid The user ID</span>
<a name="l497"><span class="linenum"> 497</span></a>  <span class="comment">     * @return void</span>
<a name="l498"><span class="linenum"> 498</span></a>  <span class="comment">     */</span>
<a name="l499"><span class="linenum"> 499</span></a>      public static function <a class="function" onClick="logFunction('fill_discussion_subscription_cache')" href="../../../_functions/fill_discussion_subscription_cache.html" onMouseOver="funcPopup(event,'fill_discussion_subscription_cache')">fill_discussion_subscription_cache</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a> = null) {
<a name="l500"><span class="linenum"> 500</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l501"><span class="linenum"> 501</span></a>  
<a name="l502"><span class="linenum"> 502</span></a>          if (!isset(self::<a class="var it23850" onMouseOver="hilite(23850)" onMouseOut="lolite()" onClick="logVariable('discussionfetchedforums')" href="../../../_variables/discussionfetchedforums.html">$discussionfetchedforums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>])) {
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment">            // This forum hasn't been fetched as a whole yet.</span>
<a name="l504"><span class="linenum"> 504</span></a>              if (isset(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>)) {
<a name="l505"><span class="linenum"> 505</span></a>                  if (!isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>])) {
<a name="l506"><span class="linenum"> 506</span></a>                      self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>] = array();
<a name="l507"><span class="linenum"> 507</span></a>                  }
<a name="l508"><span class="linenum"> 508</span></a>  
<a name="l509"><span class="linenum"> 509</span></a>                  if (!isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>])) {
<a name="l510"><span class="linenum"> 510</span></a>                      <a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('forum_discussion_subs', array(
<a name="l511"><span class="linenum"> 511</span></a>                          'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l512"><span class="linenum"> 512</span></a>                          'forum' =&gt; <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>,
<a name="l513"><span class="linenum"> 513</span></a>                      ), null, 'id, discussion, preference');
<a name="l514"><span class="linenum"> 514</span></a>                      foreach (<a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a> =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>) {
<a name="l515"><span class="linenum"> 515</span></a>                          self::<a class="function" onClick="logFunction('add_to_discussion_cache')" href="../../../_functions/add_to_discussion_cache.html" onMouseOver="funcPopup(event,'add_to_discussion_cache')">add_to_discussion_cache</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('discussion')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../../_variables/discussion.html">discussion</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('preference')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a>);
<a name="l516"><span class="linenum"> 516</span></a>                      }
<a name="l517"><span class="linenum"> 517</span></a>                      <a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l518"><span class="linenum"> 518</span></a>                  }
<a name="l519"><span class="linenum"> 519</span></a>              } else {
<a name="l520"><span class="linenum"> 520</span></a>                  <a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('forum_discussion_subs', array(
<a name="l521"><span class="linenum"> 521</span></a>                      'forum' =&gt; <a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>,
<a name="l522"><span class="linenum"> 522</span></a>                  ), null, 'id, userid, discussion, preference');
<a name="l523"><span class="linenum"> 523</span></a>                  foreach (<a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a> =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>) {
<a name="l524"><span class="linenum"> 524</span></a>                      self::<a class="function" onClick="logFunction('add_to_discussion_cache')" href="../../../_functions/add_to_discussion_cache.html" onMouseOver="funcPopup(event,'add_to_discussion_cache')">add_to_discussion_cache</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('userid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('discussion')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../../_variables/discussion.html">discussion</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('preference')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a>);
<a name="l525"><span class="linenum"> 525</span></a>                  }
<a name="l526"><span class="linenum"> 526</span></a>                  self::<a class="var it23850" onMouseOver="hilite(23850)" onMouseOut="lolite()" onClick="logVariable('discussionfetchedforums')" href="../../../_variables/discussionfetchedforums.html">$discussionfetchedforums</a>[<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>] = true;
<a name="l527"><span class="linenum"> 527</span></a>                  <a class="var it8229" onMouseOver="hilite(8229)" onMouseOut="lolite()" onClick="logVariable('subscriptions')" href="../../../_variables/subscriptions.html">$subscriptions</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l528"><span class="linenum"> 528</span></a>              }
<a name="l529"><span class="linenum"> 529</span></a>          }
<a name="l530"><span class="linenum"> 530</span></a>      }
<a name="l531"><span class="linenum"> 531</span></a>  
<a name="l532"><span class="linenum"> 532</span></a>      <span class="comment">/**</span>
<a name="l533"><span class="linenum"> 533</span></a>  <span class="comment">     * Add the specified discussion and user preference to the discussion</span>
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment">     * subscription cache.</span>
<a name="l535"><span class="linenum"> 535</span></a>  <span class="comment">     *</span>
<a name="l536"><span class="linenum"> 536</span></a>  <span class="comment">     * @param int $forumid The ID of the forum that this preference belongs to</span>
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment">     * @param int $userid The ID of the user that this preference belongs to</span>
<a name="l538"><span class="linenum"> 538</span></a>  <span class="comment">     * @param int $discussion The ID of the discussion that this preference relates to</span>
<a name="l539"><span class="linenum"> 539</span></a>  <span class="comment">     * @param int $preference The preference to store</span>
<a name="l540"><span class="linenum"> 540</span></a>  <span class="comment">     */</span>
<a name="l541"><span class="linenum"> 541</span></a>      protected static function <a class="function" onClick="logFunction('add_to_discussion_cache')" href="../../../_functions/add_to_discussion_cache.html" onMouseOver="funcPopup(event,'add_to_discussion_cache')">add_to_discussion_cache</a>(<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>, <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>) {
<a name="l542"><span class="linenum"> 542</span></a>          if (!isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>])) {
<a name="l543"><span class="linenum"> 543</span></a>              self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>] = array();
<a name="l544"><span class="linenum"> 544</span></a>          }
<a name="l545"><span class="linenum"> 545</span></a>  
<a name="l546"><span class="linenum"> 546</span></a>          if (!isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>])) {
<a name="l547"><span class="linenum"> 547</span></a>              self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>] = array();
<a name="l548"><span class="linenum"> 548</span></a>          }
<a name="l549"><span class="linenum"> 549</span></a>  
<a name="l550"><span class="linenum"> 550</span></a>          self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it7863" onMouseOver="hilite(7863)" onMouseOut="lolite()" onClick="logVariable('forumid')" href="../../../_variables/forumid.html">$forumid</a>][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>] = <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>;
<a name="l551"><span class="linenum"> 551</span></a>      }
<a name="l552"><span class="linenum"> 552</span></a>  
<a name="l553"><span class="linenum"> 553</span></a>      <span class="comment">/**</span>
<a name="l554"><span class="linenum"> 554</span></a>  <span class="comment">     * Reset the discussion cache.</span>
<a name="l555"><span class="linenum"> 555</span></a>  <span class="comment">     *</span>
<a name="l556"><span class="linenum"> 556</span></a>  <span class="comment">     * This cache is used to reduce the number of database queries when</span>
<a name="l557"><span class="linenum"> 557</span></a>  <span class="comment">     * checking forum discussion subscription states.</span>
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment">     */</span>
<a name="l559"><span class="linenum"> 559</span></a>      public static function <a class="function" onClick="logFunction('reset_discussion_cache')" href="../../../_functions/reset_discussion_cache.html" onMouseOver="funcPopup(event,'reset_discussion_cache')">reset_discussion_cache</a>() {
<a name="l560"><span class="linenum"> 560</span></a>          self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a> = array();
<a name="l561"><span class="linenum"> 561</span></a>          self::<a class="var it23850" onMouseOver="hilite(23850)" onMouseOut="lolite()" onClick="logVariable('discussionfetchedforums')" href="../../../_variables/discussionfetchedforums.html">$discussionfetchedforums</a> = array();
<a name="l562"><span class="linenum"> 562</span></a>      }
<a name="l563"><span class="linenum"> 563</span></a>  
<a name="l564"><span class="linenum"> 564</span></a>      <span class="comment">/**</span>
<a name="l565"><span class="linenum"> 565</span></a>  <span class="comment">     * Reset the forum cache.</span>
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment">     *</span>
<a name="l567"><span class="linenum"> 567</span></a>  <span class="comment">     * This cache is used to reduce the number of database queries when</span>
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment">     * checking forum subscription states.</span>
<a name="l569"><span class="linenum"> 569</span></a>  <span class="comment">     */</span>
<a name="l570"><span class="linenum"> 570</span></a>      public static function <a class="function" onClick="logFunction('reset_forum_cache')" href="../../../_functions/reset_forum_cache.html" onMouseOver="funcPopup(event,'reset_forum_cache')">reset_forum_cache</a>() {
<a name="l571"><span class="linenum"> 571</span></a>          self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a> = array();
<a name="l572"><span class="linenum"> 572</span></a>          self::<a class="var it23848" onMouseOver="hilite(23848)" onMouseOut="lolite()" onClick="logVariable('fetchedforums')" href="../../../_variables/fetchedforums.html">$fetchedforums</a> = array();
<a name="l573"><span class="linenum"> 573</span></a>      }
<a name="l574"><span class="linenum"> 574</span></a>  
<a name="l575"><span class="linenum"> 575</span></a>      <span class="comment">/**</span>
<a name="l576"><span class="linenum"> 576</span></a>  <span class="comment">     * Adds user to the subscriber list.</span>
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment">     *</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment">     * @param int $userid The ID of the user to subscribe</span>
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment">     * @param \stdClass $forum The forum record for this forum.</span>
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment">     * @param \context_module|null $context Module context, may be omitted if not known or if called for the current</span>
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment">     *      module set in page.</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment">     * @param boolean $userrequest Whether the user requested this change themselves. This has an effect on whether</span>
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment">     *     discussion subscriptions are removed too.</span>
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment">     * @return bool|int Returns true if the user is already subscribed, or the forum_subscriptions ID if the user was</span>
<a name="l585"><span class="linenum"> 585</span></a>  <span class="comment">     *     successfully subscribed.</span>
<a name="l586"><span class="linenum"> 586</span></a>  <span class="comment">     */</span>
<a name="l587"><span class="linenum"> 587</span></a>      public static function <a class="function" onClick="logFunction('subscribe_user')" href="../../../_functions/subscribe_user.html" onMouseOver="funcPopup(event,'subscribe_user')">subscribe_user</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = null, <a class="var it23853" onMouseOver="hilite(23853)" onMouseOut="lolite()" onClick="logVariable('userrequest')" href="../../../_variables/userrequest.html">$userrequest</a> = false) {
<a name="l588"><span class="linenum"> 588</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l589"><span class="linenum"> 589</span></a>  
<a name="l590"><span class="linenum"> 590</span></a>          if (self::<a class="function" onClick="logFunction('is_subscribed')" href="../../../_functions/is_subscribed.html" onMouseOver="funcPopup(event,'is_subscribed')">is_subscribed</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>)) {
<a name="l591"><span class="linenum"> 591</span></a>              return true;
<a name="l592"><span class="linenum"> 592</span></a>          }
<a name="l593"><span class="linenum"> 593</span></a>  
<a name="l594"><span class="linenum"> 594</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('sub')" href="../../../_variables/sub.html">$sub</a> = new \stdClass();
<a name="l595"><span class="linenum"> 595</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('sub')" href="../../../_variables/sub.html">$sub</a>-&gt;<a onClick="logVariable('userid')" class="var it43072" onMouseOver="hilite(43072)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a>  = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>;
<a name="l596"><span class="linenum"> 596</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('sub')" href="../../../_variables/sub.html">$sub</a>-&gt;<a onClick="logVariable('forum')" class="var it43072" onMouseOver="hilite(43072)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a> = <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l597"><span class="linenum"> 597</span></a>  
<a name="l598"><span class="linenum"> 598</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(&quot;forum_subscriptions&quot;, <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('sub')" href="../../../_variables/sub.html">$sub</a>);
<a name="l599"><span class="linenum"> 599</span></a>  
<a name="l600"><span class="linenum"> 600</span></a>          if (<a class="var it23853" onMouseOver="hilite(23853)" onMouseOut="lolite()" onClick="logVariable('userrequest')" href="../../../_variables/userrequest.html">$userrequest</a>) {
<a name="l601"><span class="linenum"> 601</span></a>              <a class="var it23854" onMouseOver="hilite(23854)" onMouseOut="lolite()" onClick="logVariable('discussionsubscriptions')" href="../../../_variables/discussionsubscriptions.html">$discussionsubscriptions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('forum_discussion_subs', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, 'forum' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l602"><span class="linenum"> 602</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('forum_discussion_subs',
<a name="l603"><span class="linenum"> 603</span></a>                      'userid = :userid AND forum = :forumid AND preference &lt;&gt; :preference', array(
<a name="l604"><span class="linenum"> 604</span></a>                          'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l605"><span class="linenum"> 605</span></a>                          'forumid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l606"><span class="linenum"> 606</span></a>                          'preference' =&gt; self::FORUM_DISCUSSION_UNSUBSCRIBED,
<a name="l607"><span class="linenum"> 607</span></a>                      ));
<a name="l608"><span class="linenum"> 608</span></a>  
<a name="l609"><span class="linenum"> 609</span></a>  <span class="comment">            // Reset the subscription caches for this forum.</span>
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment">            // We know that the there were previously entries and there aren't any more.</span>
<a name="l611"><span class="linenum"> 611</span></a>              if (isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>]) &amp;&amp; isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>])) {
<a name="l612"><span class="linenum"> 612</span></a>                  foreach (self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>] as <a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../../_variables/discussionid.html">$discussionid</a> =&gt; <a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a>) {
<a name="l613"><span class="linenum"> 613</span></a>                      if (<a class="var it11341" onMouseOver="hilite(11341)" onMouseOut="lolite()" onClick="logVariable('preference')" href="../../../_variables/preference.html">$preference</a> != self::FORUM_DISCUSSION_UNSUBSCRIBED) {
<a name="l614"><span class="linenum"> 614</span></a>                          unset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>][<a class="var it16125" onMouseOver="hilite(16125)" onMouseOut="lolite()" onClick="logVariable('discussionid')" href="../../../_variables/discussionid.html">$discussionid</a>]);
<a name="l615"><span class="linenum"> 615</span></a>                      }
<a name="l616"><span class="linenum"> 616</span></a>                  }
<a name="l617"><span class="linenum"> 617</span></a>              }
<a name="l618"><span class="linenum"> 618</span></a>          }
<a name="l619"><span class="linenum"> 619</span></a>  
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment">        // Reset the cache for this forum.</span>
<a name="l621"><span class="linenum"> 621</span></a>          self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>] = true;
<a name="l622"><span class="linenum"> 622</span></a>  
<a name="l623"><span class="linenum"> 623</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = <a class="function" onClick="logFunction('forum_get_context')" href="../../../_functions/forum_get_context.html" onMouseOver="funcPopup(event,'forum_get_context')">forum_get_context</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>);
<a name="l624"><span class="linenum"> 624</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array(
<a name="l625"><span class="linenum"> 625</span></a>              'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>,
<a name="l626"><span class="linenum"> 626</span></a>              'objectid' =&gt; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>,
<a name="l627"><span class="linenum"> 627</span></a>              'relateduserid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l628"><span class="linenum"> 628</span></a>              'other' =&gt; array('forumid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>),
<a name="l629"><span class="linenum"> 629</span></a>  
<a name="l630"><span class="linenum"> 630</span></a>          );
<a name="l631"><span class="linenum"> 631</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>  = event\<a class="class" onClick="logClass('subscription_created')" href="../../../_classes/subscription_created.html" onMouseOver="classPopup(event,'subscription_created')">subscription_created</a>::<a class="function" onClick="logFunction('create')" href="../../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>);
<a name="l632"><span class="linenum"> 632</span></a>          if (<a class="var it23853" onMouseOver="hilite(23853)" onMouseOut="lolite()" onClick="logVariable('userrequest')" href="../../../_variables/userrequest.html">$userrequest</a> &amp;&amp; <a class="var it23854" onMouseOver="hilite(23854)" onMouseOut="lolite()" onClick="logVariable('discussionsubscriptions')" href="../../../_variables/discussionsubscriptions.html">$discussionsubscriptions</a>) {
<a name="l633"><span class="linenum"> 633</span></a>              foreach (<a class="var it23854" onMouseOver="hilite(23854)" onMouseOut="lolite()" onClick="logVariable('discussionsubscriptions')" href="../../../_variables/discussionsubscriptions.html">$discussionsubscriptions</a> as <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>) {
<a name="l634"><span class="linenum"> 634</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('forum_discussion_subs', <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>);
<a name="l635"><span class="linenum"> 635</span></a>              }
<a name="l636"><span class="linenum"> 636</span></a>              <a class="var it23854" onMouseOver="hilite(23854)" onMouseOut="lolite()" onClick="logVariable('discussionsubscriptions')" href="../../../_variables/discussionsubscriptions.html">$discussionsubscriptions</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l637"><span class="linenum"> 637</span></a>          }
<a name="l638"><span class="linenum"> 638</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l639"><span class="linenum"> 639</span></a>  
<a name="l640"><span class="linenum"> 640</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l641"><span class="linenum"> 641</span></a>      }
<a name="l642"><span class="linenum"> 642</span></a>  
<a name="l643"><span class="linenum"> 643</span></a>      <span class="comment">/**</span>
<a name="l644"><span class="linenum"> 644</span></a>  <span class="comment">     * Removes user from the subscriber list</span>
<a name="l645"><span class="linenum"> 645</span></a>  <span class="comment">     *</span>
<a name="l646"><span class="linenum"> 646</span></a>  <span class="comment">     * @param int $userid The ID of the user to unsubscribe</span>
<a name="l647"><span class="linenum"> 647</span></a>  <span class="comment">     * @param \stdClass $forum The forum record for this forum.</span>
<a name="l648"><span class="linenum"> 648</span></a>  <span class="comment">     * @param \context_module|null $context Module context, may be omitted if not known or if called for the current</span>
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment">     *     module set in page.</span>
<a name="l650"><span class="linenum"> 650</span></a>  <span class="comment">     * @param boolean $userrequest Whether the user requested this change themselves. This has an effect on whether</span>
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">     *     discussion subscriptions are removed too.</span>
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">     * @return boolean Always returns true.</span>
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment">     */</span>
<a name="l654"><span class="linenum"> 654</span></a>      public static function <a class="function" onClick="logFunction('unsubscribe_user')" href="../../../_functions/unsubscribe_user.html" onMouseOver="funcPopup(event,'unsubscribe_user')">unsubscribe_user</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = null, <a class="var it23853" onMouseOver="hilite(23853)" onMouseOut="lolite()" onClick="logVariable('userrequest')" href="../../../_variables/userrequest.html">$userrequest</a> = false) {
<a name="l655"><span class="linenum"> 655</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l656"><span class="linenum"> 656</span></a>  
<a name="l657"><span class="linenum"> 657</span></a>          <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('sqlparams')" href="../../../_variables/sqlparams.html">$sqlparams</a> = array(
<a name="l658"><span class="linenum"> 658</span></a>              'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l659"><span class="linenum"> 659</span></a>              'forum' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l660"><span class="linenum"> 660</span></a>          );
<a name="l661"><span class="linenum"> 661</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_digests', <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('sqlparams')" href="../../../_variables/sqlparams.html">$sqlparams</a>);
<a name="l662"><span class="linenum"> 662</span></a>  
<a name="l663"><span class="linenum"> 663</span></a>          if (<a class="var it23855" onMouseOver="hilite(23855)" onMouseOut="lolite()" onClick="logVariable('forumsubscription')" href="../../../_variables/forumsubscription.html">$forumsubscription</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_subscriptions', <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('sqlparams')" href="../../../_variables/sqlparams.html">$sqlparams</a>)) {
<a name="l664"><span class="linenum"> 664</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_subscriptions', array('id' =&gt; <a class="var it23855" onMouseOver="hilite(23855)" onMouseOut="lolite()" onClick="logVariable('forumsubscription')" href="../../../_variables/forumsubscription.html">$forumsubscription</a>-&gt;<a onClick="logVariable('id')" class="var it45558" onMouseOver="hilite(45558)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l665"><span class="linenum"> 665</span></a>  
<a name="l666"><span class="linenum"> 666</span></a>              if (<a class="var it23853" onMouseOver="hilite(23853)" onMouseOut="lolite()" onClick="logVariable('userrequest')" href="../../../_variables/userrequest.html">$userrequest</a>) {
<a name="l667"><span class="linenum"> 667</span></a>                  <a class="var it23854" onMouseOver="hilite(23854)" onMouseOut="lolite()" onClick="logVariable('discussionsubscriptions')" href="../../../_variables/discussionsubscriptions.html">$discussionsubscriptions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('forum_discussion_subs', <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('sqlparams')" href="../../../_variables/sqlparams.html">$sqlparams</a>);
<a name="l668"><span class="linenum"> 668</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_discussion_subs',
<a name="l669"><span class="linenum"> 669</span></a>                          array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, 'forum' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 'preference' =&gt; self::FORUM_DISCUSSION_UNSUBSCRIBED));
<a name="l670"><span class="linenum"> 670</span></a>  
<a name="l671"><span class="linenum"> 671</span></a>  <span class="comment">                // We know that the there were previously entries and there aren't any more.</span>
<a name="l672"><span class="linenum"> 672</span></a>                  if (isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>]) &amp;&amp; isset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>])) {
<a name="l673"><span class="linenum"> 673</span></a>                      self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>] = array();
<a name="l674"><span class="linenum"> 674</span></a>                  }
<a name="l675"><span class="linenum"> 675</span></a>              }
<a name="l676"><span class="linenum"> 676</span></a>  
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment">            // Reset the cache for this forum.</span>
<a name="l678"><span class="linenum"> 678</span></a>              self::<a class="var it23847" onMouseOver="hilite(23847)" onMouseOut="lolite()" onClick="logVariable('forumcache')" href="../../../_variables/forumcache.html">$forumcache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>] = false;
<a name="l679"><span class="linenum"> 679</span></a>  
<a name="l680"><span class="linenum"> 680</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = <a class="function" onClick="logFunction('forum_get_context')" href="../../../_functions/forum_get_context.html" onMouseOver="funcPopup(event,'forum_get_context')">forum_get_context</a>(<a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>);
<a name="l681"><span class="linenum"> 681</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array(
<a name="l682"><span class="linenum"> 682</span></a>                  'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>,
<a name="l683"><span class="linenum"> 683</span></a>                  'objectid' =&gt; <a class="var it23855" onMouseOver="hilite(23855)" onMouseOut="lolite()" onClick="logVariable('forumsubscription')" href="../../../_variables/forumsubscription.html">$forumsubscription</a>-&gt;<a onClick="logVariable('id')" class="var it45558" onMouseOver="hilite(45558)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l684"><span class="linenum"> 684</span></a>                  'relateduserid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l685"><span class="linenum"> 685</span></a>                  'other' =&gt; array('forumid' =&gt; <a class="var it504" onMouseOver="hilite(504)" onMouseOut="lolite()" onClick="logVariable('forum')" href="../../../_variables/forum.html">$forum</a>-&gt;<a onClick="logVariable('id')" class="var it43075" onMouseOver="hilite(43075)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>),
<a name="l686"><span class="linenum"> 686</span></a>  
<a name="l687"><span class="linenum"> 687</span></a>              );
<a name="l688"><span class="linenum"> 688</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a> = event\<a class="class" onClick="logClass('subscription_deleted')" href="../../../_classes/subscription_deleted.html" onMouseOver="classPopup(event,'subscription_deleted')">subscription_deleted</a>::<a class="function" onClick="logFunction('create')" href="../../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>);
<a name="l689"><span class="linenum"> 689</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('forum_subscriptions', <a class="var it23855" onMouseOver="hilite(23855)" onMouseOut="lolite()" onClick="logVariable('forumsubscription')" href="../../../_variables/forumsubscription.html">$forumsubscription</a>);
<a name="l690"><span class="linenum"> 690</span></a>              if (<a class="var it23853" onMouseOver="hilite(23853)" onMouseOut="lolite()" onClick="logVariable('userrequest')" href="../../../_variables/userrequest.html">$userrequest</a> &amp;&amp; <a class="var it23854" onMouseOver="hilite(23854)" onMouseOut="lolite()" onClick="logVariable('discussionsubscriptions')" href="../../../_variables/discussionsubscriptions.html">$discussionsubscriptions</a>) {
<a name="l691"><span class="linenum"> 691</span></a>                  foreach (<a class="var it23854" onMouseOver="hilite(23854)" onMouseOut="lolite()" onClick="logVariable('discussionsubscriptions')" href="../../../_variables/discussionsubscriptions.html">$discussionsubscriptions</a> as <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>) {
<a name="l692"><span class="linenum"> 692</span></a>                      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('forum_discussion_subs', <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>);
<a name="l693"><span class="linenum"> 693</span></a>                  }
<a name="l694"><span class="linenum"> 694</span></a>                  <a class="var it23854" onMouseOver="hilite(23854)" onMouseOut="lolite()" onClick="logVariable('discussionsubscriptions')" href="../../../_variables/discussionsubscriptions.html">$discussionsubscriptions</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l695"><span class="linenum"> 695</span></a>              }
<a name="l696"><span class="linenum"> 696</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l697"><span class="linenum"> 697</span></a>          }
<a name="l698"><span class="linenum"> 698</span></a>  
<a name="l699"><span class="linenum"> 699</span></a>          return true;
<a name="l700"><span class="linenum"> 700</span></a>      }
<a name="l701"><span class="linenum"> 701</span></a>  
<a name="l702"><span class="linenum"> 702</span></a>      <span class="comment">/**</span>
<a name="l703"><span class="linenum"> 703</span></a>  <span class="comment">     * Subscribes the user to the specified discussion.</span>
<a name="l704"><span class="linenum"> 704</span></a>  <span class="comment">     *</span>
<a name="l705"><span class="linenum"> 705</span></a>  <span class="comment">     * @param int $userid The userid of the user being subscribed</span>
<a name="l706"><span class="linenum"> 706</span></a>  <span class="comment">     * @param \stdClass $discussion The discussion to subscribe to</span>
<a name="l707"><span class="linenum"> 707</span></a>  <span class="comment">     * @param \context_module|null $context Module context, may be omitted if not known or if called for the current</span>
<a name="l708"><span class="linenum"> 708</span></a>  <span class="comment">     *     module set in page.</span>
<a name="l709"><span class="linenum"> 709</span></a>  <span class="comment">     * @return boolean Whether a change was made</span>
<a name="l710"><span class="linenum"> 710</span></a>  <span class="comment">     */</span>
<a name="l711"><span class="linenum"> 711</span></a>      public static function <a class="function" onClick="logFunction('subscribe_user_to_discussion')" href="../../../_functions/subscribe_user_to_discussion.html" onMouseOver="funcPopup(event,'subscribe_user_to_discussion')">subscribe_user_to_discussion</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = null) {
<a name="l712"><span class="linenum"> 712</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l713"><span class="linenum"> 713</span></a>  
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment">        // First check whether the user is subscribed to the discussion already.</span>
<a name="l715"><span class="linenum"> 715</span></a>          <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussion_subs', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, 'discussion' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l716"><span class="linenum"> 716</span></a>          if (<a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>) {
<a name="l717"><span class="linenum"> 717</span></a>              if (<a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a> != self::FORUM_DISCUSSION_UNSUBSCRIBED) {
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment">                // The user is already subscribed to the discussion. Ignore.</span>
<a name="l719"><span class="linenum"> 719</span></a>                  return false;
<a name="l720"><span class="linenum"> 720</span></a>              }
<a name="l721"><span class="linenum"> 721</span></a>          }
<a name="l722"><span class="linenum"> 722</span></a>  <span class="comment">        // No discussion-level subscription. Check for a forum level subscription.</span>
<a name="l723"><span class="linenum"> 723</span></a>          if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('forum_subscriptions', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, 'forum' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>))) {
<a name="l724"><span class="linenum"> 724</span></a>              if (<a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a> &amp;&amp; <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a> == self::FORUM_DISCUSSION_UNSUBSCRIBED) {
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment">                // The user is subscribed to the forum, but unsubscribed from the discussion, delete the discussion preference.</span>
<a name="l726"><span class="linenum"> 726</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_discussion_subs', array('id' =&gt; <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('id')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l727"><span class="linenum"> 727</span></a>                  unset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>]);
<a name="l728"><span class="linenum"> 728</span></a>              } else {
<a name="l729"><span class="linenum"> 729</span></a>  <span class="comment">                // The user is already subscribed to the forum. Ignore.</span>
<a name="l730"><span class="linenum"> 730</span></a>                  return false;
<a name="l731"><span class="linenum"> 731</span></a>              }
<a name="l732"><span class="linenum"> 732</span></a>          } else {
<a name="l733"><span class="linenum"> 733</span></a>              if (<a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>) {
<a name="l734"><span class="linenum"> 734</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l735"><span class="linenum"> 735</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_discussion_subs', <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>);
<a name="l736"><span class="linenum"> 736</span></a>              } else {
<a name="l737"><span class="linenum"> 737</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a> = new \stdClass();
<a name="l738"><span class="linenum"> 738</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('userid')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a>  = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>;
<a name="l739"><span class="linenum"> 739</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('forum')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>;
<a name="l740"><span class="linenum"> 740</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('discussion')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/discussion.html">discussion</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l741"><span class="linenum"> 741</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l742"><span class="linenum"> 742</span></a>  
<a name="l743"><span class="linenum"> 743</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('id')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('forum_discussion_subs', <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>);
<a name="l744"><span class="linenum"> 744</span></a>                  self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>] = <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a>;
<a name="l745"><span class="linenum"> 745</span></a>              }
<a name="l746"><span class="linenum"> 746</span></a>          }
<a name="l747"><span class="linenum"> 747</span></a>  
<a name="l748"><span class="linenum"> 748</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = <a class="function" onClick="logFunction('forum_get_context')" href="../../../_functions/forum_get_context.html" onMouseOver="funcPopup(event,'forum_get_context')">forum_get_context</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>);
<a name="l749"><span class="linenum"> 749</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array(
<a name="l750"><span class="linenum"> 750</span></a>              'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>,
<a name="l751"><span class="linenum"> 751</span></a>              'objectid' =&gt; <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('id')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l752"><span class="linenum"> 752</span></a>              'relateduserid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l753"><span class="linenum"> 753</span></a>              'other' =&gt; array(
<a name="l754"><span class="linenum"> 754</span></a>                  'forumid' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>,
<a name="l755"><span class="linenum"> 755</span></a>                  'discussion' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l756"><span class="linenum"> 756</span></a>              ),
<a name="l757"><span class="linenum"> 757</span></a>  
<a name="l758"><span class="linenum"> 758</span></a>          );
<a name="l759"><span class="linenum"> 759</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>  = event\<a class="class" onClick="logClass('discussion_subscription_created')" href="../../../_classes/discussion_subscription_created.html" onMouseOver="classPopup(event,'discussion_subscription_created')">discussion_subscription_created</a>::<a class="function" onClick="logFunction('create')" href="../../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>);
<a name="l760"><span class="linenum"> 760</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l761"><span class="linenum"> 761</span></a>  
<a name="l762"><span class="linenum"> 762</span></a>          return true;
<a name="l763"><span class="linenum"> 763</span></a>      }
<a name="l764"><span class="linenum"> 764</span></a>      <span class="comment">/**</span>
<a name="l765"><span class="linenum"> 765</span></a>  <span class="comment">     * Unsubscribes the user from the specified discussion.</span>
<a name="l766"><span class="linenum"> 766</span></a>  <span class="comment">     *</span>
<a name="l767"><span class="linenum"> 767</span></a>  <span class="comment">     * @param int $userid The userid of the user being unsubscribed</span>
<a name="l768"><span class="linenum"> 768</span></a>  <span class="comment">     * @param \stdClass $discussion The discussion to unsubscribe from</span>
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment">     * @param \context_module|null $context Module context, may be omitted if not known or if called for the current</span>
<a name="l770"><span class="linenum"> 770</span></a>  <span class="comment">     *     module set in page.</span>
<a name="l771"><span class="linenum"> 771</span></a>  <span class="comment">     * @return boolean Whether a change was made</span>
<a name="l772"><span class="linenum"> 772</span></a>  <span class="comment">     */</span>
<a name="l773"><span class="linenum"> 773</span></a>      public static function <a class="function" onClick="logFunction('unsubscribe_user_from_discussion')" href="../../../_functions/unsubscribe_user_from_discussion.html" onMouseOver="funcPopup(event,'unsubscribe_user_from_discussion')">unsubscribe_user_from_discussion</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = null) {
<a name="l774"><span class="linenum"> 774</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l775"><span class="linenum"> 775</span></a>  
<a name="l776"><span class="linenum"> 776</span></a>  <span class="comment">        // First check whether the user's subscription preference for this discussion.</span>
<a name="l777"><span class="linenum"> 777</span></a>          <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('forum_discussion_subs', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, 'discussion' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l778"><span class="linenum"> 778</span></a>          if (<a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>) {
<a name="l779"><span class="linenum"> 779</span></a>              if (<a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a> == self::FORUM_DISCUSSION_UNSUBSCRIBED) {
<a name="l780"><span class="linenum"> 780</span></a>  <span class="comment">                // The user is already unsubscribed from the discussion. Ignore.</span>
<a name="l781"><span class="linenum"> 781</span></a>                  return false;
<a name="l782"><span class="linenum"> 782</span></a>              }
<a name="l783"><span class="linenum"> 783</span></a>          }
<a name="l784"><span class="linenum"> 784</span></a>  <span class="comment">        // No discussion-level preference. Check for a forum level subscription.</span>
<a name="l785"><span class="linenum"> 785</span></a>          if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('forum_subscriptions', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>, 'forum' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>))) {
<a name="l786"><span class="linenum"> 786</span></a>              if (<a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a> &amp;&amp; <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a> != self::FORUM_DISCUSSION_UNSUBSCRIBED) {
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment">                // The user is not subscribed to the forum, but subscribed from the discussion, delete the discussion subscription.</span>
<a name="l788"><span class="linenum"> 788</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('forum_discussion_subs', array('id' =&gt; <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('id')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l789"><span class="linenum"> 789</span></a>                  unset(self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>]);
<a name="l790"><span class="linenum"> 790</span></a>              } else {
<a name="l791"><span class="linenum"> 791</span></a>  <span class="comment">                // The user is not subscribed from the forum. Ignore.</span>
<a name="l792"><span class="linenum"> 792</span></a>                  return false;
<a name="l793"><span class="linenum"> 793</span></a>              }
<a name="l794"><span class="linenum"> 794</span></a>          } else {
<a name="l795"><span class="linenum"> 795</span></a>              if (<a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>) {
<a name="l796"><span class="linenum"> 796</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a> = self::FORUM_DISCUSSION_UNSUBSCRIBED;
<a name="l797"><span class="linenum"> 797</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('forum_discussion_subs', <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>);
<a name="l798"><span class="linenum"> 798</span></a>              } else {
<a name="l799"><span class="linenum"> 799</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a> = new \stdClass();
<a name="l800"><span class="linenum"> 800</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('userid')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/userid.html">userid</a>  = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>;
<a name="l801"><span class="linenum"> 801</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('forum')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>;
<a name="l802"><span class="linenum"> 802</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('discussion')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/discussion.html">discussion</a> = <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l803"><span class="linenum"> 803</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a> = self::FORUM_DISCUSSION_UNSUBSCRIBED;
<a name="l804"><span class="linenum"> 804</span></a>  
<a name="l805"><span class="linenum"> 805</span></a>                  <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('id')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('forum_discussion_subs', <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>);
<a name="l806"><span class="linenum"> 806</span></a>              }
<a name="l807"><span class="linenum"> 807</span></a>              self::<a class="var it23849" onMouseOver="hilite(23849)" onMouseOut="lolite()" onClick="logVariable('forumdiscussioncache')" href="../../../_variables/forumdiscussioncache.html">$forumdiscussioncache</a>[<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>][<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>] = <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('preference')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/preference.html">preference</a>;
<a name="l808"><span class="linenum"> 808</span></a>          }
<a name="l809"><span class="linenum"> 809</span></a>  
<a name="l810"><span class="linenum"> 810</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = <a class="function" onClick="logFunction('forum_get_context')" href="../../../_functions/forum_get_context.html" onMouseOver="funcPopup(event,'forum_get_context')">forum_get_context</a>(<a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>);
<a name="l811"><span class="linenum"> 811</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array(
<a name="l812"><span class="linenum"> 812</span></a>              'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>,
<a name="l813"><span class="linenum"> 813</span></a>              'objectid' =&gt; <a class="var it1800" onMouseOver="hilite(1800)" onMouseOut="lolite()" onClick="logVariable('subscription')" href="../../../_variables/subscription.html">$subscription</a>-&gt;<a onClick="logVariable('id')" class="var it44636" onMouseOver="hilite(44636)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l814"><span class="linenum"> 814</span></a>              'relateduserid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../../_variables/userid.html">$userid</a>,
<a name="l815"><span class="linenum"> 815</span></a>              'other' =&gt; array(
<a name="l816"><span class="linenum"> 816</span></a>                  'forumid' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('forum')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/forum.html">forum</a>,
<a name="l817"><span class="linenum"> 817</span></a>                  'discussion' =&gt; <a class="var it4240" onMouseOver="hilite(4240)" onMouseOut="lolite()" onClick="logVariable('discussion')" href="../../../_variables/discussion.html">$discussion</a>-&gt;<a onClick="logVariable('id')" class="var it43540" onMouseOver="hilite(43540)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l818"><span class="linenum"> 818</span></a>              ),
<a name="l819"><span class="linenum"> 819</span></a>  
<a name="l820"><span class="linenum"> 820</span></a>          );
<a name="l821"><span class="linenum"> 821</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>  = event\<a class="class" onClick="logClass('discussion_subscription_deleted')" href="../../../_classes/discussion_subscription_deleted.html" onMouseOver="classPopup(event,'discussion_subscription_deleted')">discussion_subscription_deleted</a>::<a class="function" onClick="logFunction('create')" href="../../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>);
<a name="l822"><span class="linenum"> 822</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l823"><span class="linenum"> 823</span></a>  
<a name="l824"><span class="linenum"> 824</span></a>          return true;
<a name="l825"><span class="linenum"> 825</span></a>      }
<a name="l826"><span class="linenum"> 826</span></a>  
<a name="l827"><span class="linenum"> 827</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'on': ['on', '', [['lib/requirejs','require.js',508],['lib/jquery','jquery-3.1.0.js',4809]], 3823],
'unsubscribe_user_from_discussion': ['unsubscribe_user_from_discussion', 'Unsubscribes the user from the specified discussion. ', [['mod/forum/classes','subscriptions.php',764]], 27],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'fill_discussion_subscription_cache': ['fill_discussion_subscription_cache', 'Fill the discussion subscription data for the specified userid and forum. ', [['mod/forum/classes','subscriptions.php',489]], 3],
'get_recordset': ['get_recordset', 'Get the recordset. ', [['mod/glossary/classes','entry_query_builder.php',305],['lib/dml','moodle_database.php',1162]], 92],
'is_subscribable': ['is_subscribable', 'Helper to determine whether the specified forum can be subscribed to. ', [['mod/forum/classes','subscriptions.php',160]], 9],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'unsubscribe_user': ['unsubscribe_user', 'Removes user from the subscriber list ', [['mod/forum/classes','subscriptions.php',643]], 19],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'get_fast_modinfo': ['get_fast_modinfo', 'Returns reference to full info about modules in course (including visibility). Cached and as fast as possible (0 or 1 db query). ', [['lib','modinfolib.php',1977]], 289],
'get_unsubscribable_forums': ['get_unsubscribable_forums', 'Returns an array of forums that the current user is subscribed to and is allowed to unsubscribe from ', [['mod/forum/classes','subscriptions.php',195]], 8],
'reset_discussion_cache': ['reset_discussion_cache', 'Reset the discussion cache. ', [['mod/forum/classes','subscriptions.php',553]], 6],
'users_order_by_sql': ['users_order_by_sql', 'This function generates the standard ORDER BY clause for use when generating lists of users. If you don\'t have a reason to use a different order, then you should use this method to generate the order when displaying lists of users. ', [['lib','datalib.php',290]], 62],
'record_exists': ['record_exists', 'Check if a record exists by ID. ', [['competency/classes','persistent.php',842],['lib/dml','moodle_database.php',1817]], 901],
'fetch_subscribed_users': ['fetch_subscribed_users', 'Returns a list of user objects who are subscribed to this forum. ', [['mod/forum/classes','subscriptions.php',379]], 22],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'get_potential_subscribers': ['get_potential_subscribers', 'Get the list of potential subscribers to a forum. ', [['mod/forum/classes','subscriptions.php',252]], 5],
'reset_forum_cache': ['reset_forum_cache', 'Reset the forum cache. ', [['mod/forum/classes','subscriptions.php',564]], 18],
'set_subscription_mode': ['set_subscription_mode', 'Set the forum subscription mode. ', [['mod/forum/classes','subscriptions.php',171]], 10],
'fetch_discussion_subscription': ['fetch_discussion_subscription', 'Retrieve the discussion subscription data for the specified userid and forum. ', [['mod/forum/classes','subscriptions.php',470]], 5],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'is_subscribed_to_forum': ['is_subscribed_to_forum', 'Whether a user is subscribed to this forum. ', [['mod/forum/classes','subscriptions.php',128]], 2],
'enrol_get_my_courses': ['enrol_get_my_courses', 'Returns list of courses current $USER is enrolled in and can access ', [['lib','enrollib.php',512]], 30],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as an moodle_recordset.  $sql must be a complete SQL query. Since this method is a little less readable, use of it should be restricted to code where it\'s possible there might be large datasets being returned.  For known small datasets use get_records_sql - it leads to simpler code. ', [['lib/dml','pdo_moodle_database.php',252],['lib/dml','oci_native_moodle_database.php',1106],['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','mssql_native_moodle_database.php',736],['lib/dml','mysqli_native_moodle_database.php',993],['lib/dml','sqlsrv_native_moodle_database.php',811],['lib/dml/tests','dml_test.php',5544]], 283],
'fill_subscription_cache_for_course': ['fill_subscription_cache_for_course', 'Fill the forum subscription data for all forums that the specified userid can subscribe to in the specified course. ', [['mod/forum/classes','subscriptions.php',345]], 4],
'fetch_subscription_cache': ['fetch_subscription_cache', 'Fetch the forum subscription data for the specified userid and forum. ', [['mod/forum/classes','subscriptions.php',279]], 9],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'get_subscription_mode': ['get_subscription_mode', 'Returns the current subscription mode for the forum. ', [['mod/forum/classes','subscriptions.php',185]], 5],
'get_cm': ['get_cm', 'Returns the current course module ', [['mod/feedback/classes','complete_form.php',245],['search/classes','base_mod.php',51],['mod/feedback/classes','structure.php',72],['mod/quiz','attemptlib.php',215],['mod/quiz','attemptlib.php',742],['lib','modinfolib.php',222],['comment','lib.php',1010]], 137],
'filter_user_list': ['filter_user_list', 'Tests this condition against a user list. Users who do not meet the condition will be removed from the list, unless they have the ability to view hidden activities/sections. ', [['availability/classes','tree_node.php',161],['availability/classes','info_module.php',76],['availability/condition/grouping/classes','condition.php',225],['availability/tests/fixtures','mock_condition.php',111],['availability/condition/group/classes','condition.php',193],['availability/classes','tree.php',297],['availability/classes','info.php',613],['availability/condition/profile/classes','condition.php',448]], 39],
'fill_subscription_cache': ['fill_subscription_cache', 'Fill the forum subscription data for the specified userid and forum. ', [['mod/forum/classes','subscriptions.php',299]], 5],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'delete_records_select': ['delete_records_select', '', [['lib/dml','pdo_moodle_database.php',208],['lib/dml','oci_native_moodle_database.php',1495],['lib/dml','pgsql_native_moodle_database.php',1162],['lib/dml','mssql_native_moodle_database.php',1146],['lib/dml','mysqli_native_moodle_database.php',1477],['lib/dml','sqlsrv_native_moodle_database.php',1220],['lib/dml/tests','dml_test.php',5553]], 163],
'subscription_disabled': ['subscription_disabled', 'Helper to determine whether a forum has it\'s subscription mode set to disabled. ', [['mod/forum/classes','subscriptions.php',150]], 11],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'is_forcesubscribed': ['is_forcesubscribed', 'Helper to determine whether a forum has it\'s subscription mode set to forced subscription. ', [['mod/forum/classes','subscriptions.php',139]], 19],
'is_subscribed': ['is_subscribed', 'Whether a user is subscribed to this forum, or a discussion within the forum. ', [['mod/forum/classes','subscriptions.php',87]], 67],
'get_all_user_name_fields': ['get_all_user_name_fields', 'A centralised location for the all name fields. Returns an array / sql string snippet. ', [['lib','moodlelib.php',3360]], 94],
'subscribe_user_to_discussion': ['subscribe_user_to_discussion', 'Subscribes the user to the specified discussion. ', [['mod/forum/classes','subscriptions.php',702]], 26],
'get_enrolled_sql': ['get_enrolled_sql', 'Returns array with sql code and parameters returning all ids of users enrolled into course. ', [['lib','accesslib.php',2247]], 47],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'join': ['join', 'Join a room. For internal use by the Games SDK only. Calling this method directly is unsupported. (rooms.join) ', [['lib/google/src/Google/Service','Games.php',1716],['lib/google/src/Google/Service','Games.php',2100]], 1030],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'subscribe_user': ['subscribe_user', 'Subscribe an user to this rule. ', [['admin/tool/monitor/classes','rule.php',137],['mod/forum/classes','subscriptions.php',575]], 26],
'forum_get_context': ['forum_get_context', 'Determine the current context if one was not already specified. ', [['mod/forum','lib.php',7815]], 12],
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',840]], 332],
'get_coursemodule_from_instance': ['get_coursemodule_from_instance', 'Given an instance number of a module, finds the coursemodule description ', [['lib','datalib.php',1300]], 441],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'add_to_discussion_cache': ['add_to_discussion_cache', 'Add the specified discussion and user preference to the discussion subscription cache. ', [['mod/forum/classes','subscriptions.php',532]], 2],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'defined': ['defined', '', [], 4731],
'array_merge': ['array_merge', '', [], 2944],
'time': ['time', '', [], 1959]};
CLASS_DATA={
'discussion_subscription_created': ['discussion_subscription_created', 'The mod_forum discussion_subscription created event class. ', [['mod/forum/classes/event','discussion_subscription_created.php',29]], 6],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',7039]], 1106],
'discussion_subscription_deleted': ['discussion_subscription_deleted', 'The mod_forum discussion_subscription deleted event class. ', [['mod/forum/classes/event','discussion_subscription_deleted.php',29]], 6],
'subscription_created': ['subscription_created', 'The mod_forum subscription created event class. ', [['mod/forum/classes/event','subscription_created.php',29],['admin/tool/monitor/classes/event','subscription_created.php',29]], 6],
'subscription_deleted': ['subscription_deleted', 'The mod_forum subscription deleted event class. ', [['mod/forum/classes/event','subscription_deleted.php',29],['admin/tool/monitor/classes/event','subscription_deleted.php',29]], 7],
'subscriptions': ['subscriptions', 'Forum subscription manager. ', [['mod/forum/classes','subscriptions.php',29]], 299]};
CONST_DATA={
'FORUM_FORCESUBSCRIBE': ['FORUM_FORCESUBSCRIBE', '', [['mod/forum','lib.php',38]], 23],
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 315],
'FORUM_DISALLOWSUBSCRIBE': ['FORUM_DISALLOWSUBSCRIBE', '', [['mod/forum','lib.php',40]], 14],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
