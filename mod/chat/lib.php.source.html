<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mod/chat/lib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='mod/chat';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mod/chat/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Library of functions and constants for module chat</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package   mod_chat</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright 1999 onwards Martin Dougiamas  {@link http://moodle.com}</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../calendar/lib.php.html">/calendar/lib.php</a>');
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment">// The HTML head for the message window to start with (&lt;!-- nix --&gt; is used to get some browsers starting with output.</span>
<a name="l30"><span class="linenum">  30</span></a>  global <a class="var it12888" onMouseOver="hilite(12888)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD')" href="../../_variables/CHAT_HTMLHEAD.html">$CHAT_HTMLHEAD</a>;
<a name="l31"><span class="linenum">  31</span></a>  <a class="var it12888" onMouseOver="hilite(12888)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD')" href="../../_variables/CHAT_HTMLHEAD.html">$CHAT_HTMLHEAD</a> = &quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 4.0 Transitional//EN\&quot; \&quot;http://www.w3.org/TR/REC-html40/loose.dtd\&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;\n&lt;body&gt;\n\n&quot;.<a class="function" onClick="logFunction('padding')" href="../../_functions/padding.html" onMouseOver="funcPopup(event,'padding')">padding</a>(200);
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment">// The HTML head for the message window to start with (with js scrolling).</span>
<a name="l34"><span class="linenum">  34</span></a>  global <a class="var it12889" onMouseOver="hilite(12889)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_JS')" href="../../_variables/CHAT_HTMLHEAD_JS.html">$CHAT_HTMLHEAD_JS</a>;
<a name="l35"><span class="linenum">  35</span></a>  <a class="var it12889" onMouseOver="hilite(12889)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_JS')" href="../../_variables/CHAT_HTMLHEAD_JS.html">$CHAT_HTMLHEAD_JS</a> = &lt;&lt;&lt;EOD
<a name="l36"><span class="linenum">  36</span></a>  &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/REC-html40/loose.dtd&quot;&gt;
<a name="l37"><span class="linenum">  37</span></a>  &lt;html&gt;&lt;head&gt;&lt;script type=&quot;text/javascript&quot;&gt;
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">//&lt;![CDATA[</span>
<a name="l39"><span class="linenum">  39</span></a>  function <a class="function" onClick="logFunction('move')" href="../../_functions/move.html" onMouseOver="funcPopup(event,'move')">move</a>() {
<a name="l40"><span class="linenum">  40</span></a>      if (scroll_active)
<a name="l41"><span class="linenum">  41</span></a>          window.scroll(1,400000);
<a name="l42"><span class="linenum">  42</span></a>      window.<a class="function" onClick="logFunction('setTimeout')" href="../../_functions/settimeout.html" onMouseOver="funcPopup(event,'settimeout')">setTimeout</a>(&quot;<a class="function" onClick="logFunction('move')" href="../../_functions/move.html" onMouseOver="funcPopup(event,'move')">move</a>()&quot;,100);
<a name="l43"><span class="linenum">  43</span></a>  }
<a name="l44"><span class="linenum">  44</span></a>  var scroll_active = true;
<a name="l45"><span class="linenum">  45</span></a>  <a class="function" onClick="logFunction('move')" href="../../_functions/move.html" onMouseOver="funcPopup(event,'move')">move</a>();
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment">//]]&gt;</span>
<a name="l47"><span class="linenum">  47</span></a>  &lt;/script&gt;
<a name="l48"><span class="linenum">  48</span></a>  &lt;/head&gt;
<a name="l49"><span class="linenum">  49</span></a>  &lt;body onBlur=&quot;scroll_active = true&quot; onFocus=&quot;scroll_active = false&quot;&gt;
<a name="l50"><span class="linenum">  50</span></a>  EOD;
<a name="l51"><span class="linenum">  51</span></a>  global <a class="var it12889" onMouseOver="hilite(12889)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_JS')" href="../../_variables/CHAT_HTMLHEAD_JS.html">$CHAT_HTMLHEAD_JS</a>;
<a name="l52"><span class="linenum">  52</span></a>  <a class="var it12889" onMouseOver="hilite(12889)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_JS')" href="../../_variables/CHAT_HTMLHEAD_JS.html">$CHAT_HTMLHEAD_JS</a> .= <a class="function" onClick="logFunction('padding')" href="../../_functions/padding.html" onMouseOver="funcPopup(event,'padding')">padding</a>(200);
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">// The HTML code for standard empty pages (e.g. if a user was kicked out).</span>
<a name="l55"><span class="linenum">  55</span></a>  global <a class="var it12890" onMouseOver="hilite(12890)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_OUT')" href="../../_variables/CHAT_HTMLHEAD_OUT.html">$CHAT_HTMLHEAD_OUT</a>;
<a name="l56"><span class="linenum">  56</span></a>  <a class="var it12890" onMouseOver="hilite(12890)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_OUT')" href="../../_variables/CHAT_HTMLHEAD_OUT.html">$CHAT_HTMLHEAD_OUT</a> = &quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 4.0 Transitional//EN\&quot; \&quot;http://www.w3.org/TR/REC-html40/loose.dtd\&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;You are out!&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;&quot;;
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment">// The HTML head for the message input page.</span>
<a name="l59"><span class="linenum">  59</span></a>  global <a class="var it12891" onMouseOver="hilite(12891)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_MSGINPUT')" href="../../_variables/CHAT_HTMLHEAD_MSGINPUT.html">$CHAT_HTMLHEAD_MSGINPUT</a>;
<a name="l60"><span class="linenum">  60</span></a>  <a class="var it12891" onMouseOver="hilite(12891)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_MSGINPUT')" href="../../_variables/CHAT_HTMLHEAD_MSGINPUT.html">$CHAT_HTMLHEAD_MSGINPUT</a> = &quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 4.0 Transitional//EN\&quot; \&quot;http://www.w3.org/TR/REC-html40/loose.dtd\&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Message Input&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;;
<a name="l61"><span class="linenum">  61</span></a>  
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">// The HTML code for the message input page, with JavaScript.</span>
<a name="l63"><span class="linenum">  63</span></a>  global <a class="var it12892" onMouseOver="hilite(12892)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_MSGINPUT_JS')" href="../../_variables/CHAT_HTMLHEAD_MSGINPUT_JS.html">$CHAT_HTMLHEAD_MSGINPUT_JS</a>;
<a name="l64"><span class="linenum">  64</span></a>  <a class="var it12892" onMouseOver="hilite(12892)" onMouseOut="lolite()" onClick="logVariable('CHAT_HTMLHEAD_MSGINPUT_JS')" href="../../_variables/CHAT_HTMLHEAD_MSGINPUT_JS.html">$CHAT_HTMLHEAD_MSGINPUT_JS</a> = &lt;&lt;&lt;EOD
<a name="l65"><span class="linenum">  65</span></a>  &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/REC-html40/loose.dtd&quot;&gt;
<a name="l66"><span class="linenum">  66</span></a>  &lt;html&gt;
<a name="l67"><span class="linenum">  67</span></a>      &lt;head&gt;&lt;title&gt;Message Input&lt;/title&gt;
<a name="l68"><span class="linenum">  68</span></a>      &lt;script type=&quot;text/javascript&quot;&gt;
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment">    //&lt;![CDATA[</span>
<a name="l70"><span class="linenum">  70</span></a>      scroll_active = true;
<a name="l71"><span class="linenum">  71</span></a>      function <a class="function" onClick="logFunction('empty_field_and_submit')" href="../../_functions/empty_field_and_submit.html" onMouseOver="funcPopup(event,'empty_field_and_submit')">empty_field_and_submit</a>() {
<a name="l72"><span class="linenum">  72</span></a>          document.fdummy.arsc_message.value=document.f.arsc_message.value;
<a name="l73"><span class="linenum">  73</span></a>          document.fdummy.<a class="function" onClick="logFunction('submit')" href="../../_functions/submit.html" onMouseOver="funcPopup(event,'submit')">submit</a>();
<a name="l74"><span class="linenum">  74</span></a>          document.f.arsc_message.<a class="function" onClick="logFunction('focus')" href="../../_functions/focus.html" onMouseOver="funcPopup(event,'focus')">focus</a>();
<a name="l75"><span class="linenum">  75</span></a>          document.f.arsc_message.<a class="function" onClick="logFunction('select')" href="../../_functions/select.html" onMouseOver="funcPopup(event,'select')">select</a>();
<a name="l76"><span class="linenum">  76</span></a>          return false;
<a name="l77"><span class="linenum">  77</span></a>      }
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">    //]]&gt;</span>
<a name="l79"><span class="linenum">  79</span></a>      &lt;/script&gt;
<a name="l80"><span class="linenum">  80</span></a>      &lt;/head&gt;&lt;body OnLoad=&quot;document.f.arsc_message.<a class="function" onClick="logFunction('focus')" href="../../_functions/focus.html" onMouseOver="funcPopup(event,'focus')">focus</a>();document.f.arsc_message.<a class="function" onClick="logFunction('select')" href="../../_functions/select.html" onMouseOver="funcPopup(event,'select')">select</a>();&quot;&gt;;
<a name="l81"><span class="linenum">  81</span></a>  EOD;
<a name="l82"><span class="linenum">  82</span></a>  
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">// Dummy data that gets output to the browser as needed, in order to make it show output.</span>
<a name="l84"><span class="linenum">  84</span></a>  global <a class="var it12893" onMouseOver="hilite(12893)" onMouseOut="lolite()" onClick="logVariable('CHAT_DUMMY_DATA')" href="../../_variables/CHAT_DUMMY_DATA.html">$CHAT_DUMMY_DATA</a>;
<a name="l85"><span class="linenum">  85</span></a>  <a class="var it12893" onMouseOver="hilite(12893)" onMouseOut="lolite()" onClick="logVariable('CHAT_DUMMY_DATA')" href="../../_variables/CHAT_DUMMY_DATA.html">$CHAT_DUMMY_DATA</a> = <a class="function" onClick="logFunction('padding')" href="../../_functions/padding.html" onMouseOver="funcPopup(event,'padding')">padding</a>(200);
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment">/**</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment"> * @param int $n</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment"> * @return string</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment"> */</span>
<a name="l91"><span class="linenum">  91</span></a>  function <a class="function" onClick="logFunction('padding')" href="../../_functions/padding.html" onMouseOver="funcPopup(event,'padding')">padding</a>(<a class="var it2074" onMouseOver="hilite(2074)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../_variables/n.html">$n</a>) {
<a name="l92"><span class="linenum">  92</span></a>      <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = '';
<a name="l93"><span class="linenum">  93</span></a>      for (<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> &lt; <a class="var it2074" onMouseOver="hilite(2074)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../_variables/n.html">$n</a>; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++) {
<a name="l94"><span class="linenum">  94</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= &quot;&lt;!-- nix --&gt;\n&quot;;
<a name="l95"><span class="linenum">  95</span></a>      }
<a name="l96"><span class="linenum">  96</span></a>      return <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>;
<a name="l97"><span class="linenum">  97</span></a>  }
<a name="l98"><span class="linenum">  98</span></a>  
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment">/**</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment"> * Given an object containing all the necessary data,</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment"> * (defined by the form in mod_form.php) this function</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment"> * will create a new instance and return the id number</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment"> * of the new instance.</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment"> *</span>
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment"> * @global object</span>
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment"> * @param object $chat</span>
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment"> * @return int</span>
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment"> */</span>
<a name="l109"><span class="linenum"> 109</span></a>  function <a class="function" onClick="logFunction('chat_add_instance')" href="../../_functions/chat_add_instance.html" onMouseOver="funcPopup(event,'chat_add_instance')">chat_add_instance</a>(<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>) {
<a name="l110"><span class="linenum"> 110</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l111"><span class="linenum"> 111</span></a>  
<a name="l112"><span class="linenum"> 112</span></a>      <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l113"><span class="linenum"> 113</span></a>  
<a name="l114"><span class="linenum"> 114</span></a>      <a class="var it3467" onMouseOver="hilite(3467)" onMouseOut="lolite()" onClick="logVariable('returnid')" href="../../_variables/returnid.html">$returnid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(&quot;chat&quot;, <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>);
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = new stdClass();
<a name="l117"><span class="linenum"> 117</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('name')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>        = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('name')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l118"><span class="linenum"> 118</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('description')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/description.html">description</a> = <a class="function" onClick="logFunction('format_module_intro')" href="../../_functions/format_module_intro.html" onMouseOver="funcPopup(event,'format_module_intro')">format_module_intro</a>('chat', <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>, <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>);
<a name="l119"><span class="linenum"> 119</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('courseid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>    = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('course')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>;
<a name="l120"><span class="linenum"> 120</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('groupid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>     = 0;
<a name="l121"><span class="linenum"> 121</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('userid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>      = 0;
<a name="l122"><span class="linenum"> 122</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('modulename')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a>  = 'chat';
<a name="l123"><span class="linenum"> 123</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('instance')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>    = <a class="var it3467" onMouseOver="hilite(3467)" onMouseOut="lolite()" onClick="logVariable('returnid')" href="../../_variables/returnid.html">$returnid</a>;
<a name="l124"><span class="linenum"> 124</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('eventtype')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/eventtype.html">eventtype</a>   = 'chattime';
<a name="l125"><span class="linenum"> 125</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timestart')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>   = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a>;
<a name="l126"><span class="linenum"> 126</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timeduration')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timeduration.html">timeduration</a> = 0;
<a name="l127"><span class="linenum"> 127</span></a>  
<a name="l128"><span class="linenum"> 128</span></a>      <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l129"><span class="linenum"> 129</span></a>  
<a name="l130"><span class="linenum"> 130</span></a>      return <a class="var it3467" onMouseOver="hilite(3467)" onMouseOut="lolite()" onClick="logVariable('returnid')" href="../../_variables/returnid.html">$returnid</a>;
<a name="l131"><span class="linenum"> 131</span></a>  }
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">/**</span>
<a name="l134"><span class="linenum"> 134</span></a>  <span class="comment"> * Given an object containing all the necessary data,</span>
<a name="l135"><span class="linenum"> 135</span></a>  <span class="comment"> * (defined by the form in mod_form.php) this function</span>
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment"> * will update an existing instance with new data.</span>
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment"> *</span>
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment"> * @global object</span>
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment"> * @param object $chat</span>
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment"> * @return bool</span>
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment"> */</span>
<a name="l142"><span class="linenum"> 142</span></a>  function <a class="function" onClick="logFunction('chat_update_instance')" href="../../_functions/chat_update_instance.html" onMouseOver="funcPopup(event,'chat_update_instance')">chat_update_instance</a>(<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>) {
<a name="l143"><span class="linenum"> 143</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l144"><span class="linenum"> 144</span></a>  
<a name="l145"><span class="linenum"> 145</span></a>      <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l146"><span class="linenum"> 146</span></a>      <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('instance')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>;
<a name="l147"><span class="linenum"> 147</span></a>  
<a name="l148"><span class="linenum"> 148</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>(&quot;chat&quot;, <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>);
<a name="l149"><span class="linenum"> 149</span></a>  
<a name="l150"><span class="linenum"> 150</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = new stdClass();
<a name="l151"><span class="linenum"> 151</span></a>  
<a name="l152"><span class="linenum"> 152</span></a>      if (<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('event', 'id', array('modulename' =&gt; 'chat', 'instance' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l153"><span class="linenum"> 153</span></a>  
<a name="l154"><span class="linenum"> 154</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('name')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>        = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('name')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l155"><span class="linenum"> 155</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('description')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/description.html">description</a> = <a class="function" onClick="logFunction('format_module_intro')" href="../../_functions/format_module_intro.html" onMouseOver="funcPopup(event,'format_module_intro')">format_module_intro</a>('chat', <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>, <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>);
<a name="l156"><span class="linenum"> 156</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timestart')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>   = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a>;
<a name="l157"><span class="linenum"> 157</span></a>  
<a name="l158"><span class="linenum"> 158</span></a>          <a class="var it12895" onMouseOver="hilite(12895)" onMouseOut="lolite()" onClick="logVariable('calendarevent')" href="../../_variables/calendarevent.html">$calendarevent</a> = <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('load')" href="../../_functions/load.html" onMouseOver="funcPopup(event,'load')">load</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l159"><span class="linenum"> 159</span></a>          <a class="var it12895" onMouseOver="hilite(12895)" onMouseOut="lolite()" onClick="logVariable('calendarevent')" href="../../_variables/calendarevent.html">$calendarevent</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l160"><span class="linenum"> 160</span></a>      }
<a name="l161"><span class="linenum"> 161</span></a>  
<a name="l162"><span class="linenum"> 162</span></a>      return true;
<a name="l163"><span class="linenum"> 163</span></a>  }
<a name="l164"><span class="linenum"> 164</span></a>  
<a name="l165"><span class="linenum"> 165</span></a>  <span class="comment">/**</span>
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment"> * Given an ID of an instance of this module,</span>
<a name="l167"><span class="linenum"> 167</span></a>  <span class="comment"> * this function will permanently delete the instance</span>
<a name="l168"><span class="linenum"> 168</span></a>  <span class="comment"> * and any data that depends on it.</span>
<a name="l169"><span class="linenum"> 169</span></a>  <span class="comment"> *</span>
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment"> * @global object</span>
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment"> * @param int $id</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment"> * @return bool</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment"> */</span>
<a name="l174"><span class="linenum"> 174</span></a>  function <a class="function" onClick="logFunction('chat_delete_instance')" href="../../_functions/chat_delete_instance.html" onMouseOver="funcPopup(event,'chat_delete_instance')">chat_delete_instance</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l175"><span class="linenum"> 175</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l176"><span class="linenum"> 176</span></a>  
<a name="l177"><span class="linenum"> 177</span></a>      if (! <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('chat', array('id' =&gt; <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>))) {
<a name="l178"><span class="linenum"> 178</span></a>          return false;
<a name="l179"><span class="linenum"> 179</span></a>      }
<a name="l180"><span class="linenum"> 180</span></a>  
<a name="l181"><span class="linenum"> 181</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = true;
<a name="l182"><span class="linenum"> 182</span></a>  
<a name="l183"><span class="linenum"> 183</span></a>  <span class="comment">    // Delete any dependent records here.</span>
<a name="l184"><span class="linenum"> 184</span></a>  
<a name="l185"><span class="linenum"> 185</span></a>      if (! <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('chat', array('id' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l186"><span class="linenum"> 186</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l187"><span class="linenum"> 187</span></a>      }
<a name="l188"><span class="linenum"> 188</span></a>      if (! <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('chat_messages', array('chatid' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l189"><span class="linenum"> 189</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l190"><span class="linenum"> 190</span></a>      }
<a name="l191"><span class="linenum"> 191</span></a>      if (! <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('chat_messages_current', array('chatid' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l192"><span class="linenum"> 192</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l193"><span class="linenum"> 193</span></a>      }
<a name="l194"><span class="linenum"> 194</span></a>      if (! <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('chat_users', array('chatid' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l195"><span class="linenum"> 195</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l196"><span class="linenum"> 196</span></a>      }
<a name="l197"><span class="linenum"> 197</span></a>  
<a name="l198"><span class="linenum"> 198</span></a>      if (! <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('event', array('modulename' =&gt; 'chat', 'instance' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l199"><span class="linenum"> 199</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l200"><span class="linenum"> 200</span></a>      }
<a name="l201"><span class="linenum"> 201</span></a>  
<a name="l202"><span class="linenum"> 202</span></a>      return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l203"><span class="linenum"> 203</span></a>  }
<a name="l204"><span class="linenum"> 204</span></a>  
<a name="l205"><span class="linenum"> 205</span></a>  <span class="comment">/**</span>
<a name="l206"><span class="linenum"> 206</span></a>  <span class="comment"> * Given a course and a date, prints a summary of all chat rooms past and present</span>
<a name="l207"><span class="linenum"> 207</span></a>  <span class="comment"> * This function is called from block_recent_activity</span>
<a name="l208"><span class="linenum"> 208</span></a>  <span class="comment"> *</span>
<a name="l209"><span class="linenum"> 209</span></a>  <span class="comment"> * @global object</span>
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment"> * @global object</span>
<a name="l211"><span class="linenum"> 211</span></a>  <span class="comment"> * @global object</span>
<a name="l212"><span class="linenum"> 212</span></a>  <span class="comment"> * @param object $course</span>
<a name="l213"><span class="linenum"> 213</span></a>  <span class="comment"> * @param bool $viewfullnames</span>
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment"> * @param int|string $timestart Timestamp</span>
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment"> * @return bool</span>
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment"> */</span>
<a name="l217"><span class="linenum"> 217</span></a>  function <a class="function" onClick="logFunction('chat_print_recent_activity')" href="../../_functions/chat_print_recent_activity.html" onMouseOver="funcPopup(event,'chat_print_recent_activity')">chat_print_recent_activity</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it5397" onMouseOver="hilite(5397)" onMouseOut="lolite()" onClick="logVariable('viewfullnames')" href="../../_variables/viewfullnames.html">$viewfullnames</a>, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>) {
<a name="l218"><span class="linenum"> 218</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l219"><span class="linenum"> 219</span></a>  
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment">    // This is approximate only, but it is really fast.</span>
<a name="l221"><span class="linenum"> 221</span></a>      <a class="var it1356" onMouseOver="hilite(1356)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('chat_old_ping')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/chat_old_ping.html">chat_old_ping</a> * 10;
<a name="l222"><span class="linenum"> 222</span></a>  
<a name="l223"><span class="linenum"> 223</span></a>      if (!<a class="var it12896" onMouseOver="hilite(12896)" onMouseOut="lolite()" onClick="logVariable('mcms')" href="../../_variables/mcms.html">$mcms</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT cm.id, <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(chm.timestamp) AS lasttime
<a name="l224"><span class="linenum"> 224</span></a>                                           FROM {course_modules} cm
<a name="l225"><span class="linenum"> 225</span></a>                                           JOIN {modules} md        ON md.id = cm.module
<a name="l226"><span class="linenum"> 226</span></a>                                           JOIN {chat} ch           ON ch.id = cm.instance
<a name="l227"><span class="linenum"> 227</span></a>                                           JOIN {chat_messages} chm ON chm.chatid = ch.id
<a name="l228"><span class="linenum"> 228</span></a>                                          WHERE chm.timestamp &gt; ? AND ch.course = ? AND md.name = 'chat'
<a name="l229"><span class="linenum"> 229</span></a>                                       GROUP BY cm.id
<a name="l230"><span class="linenum"> 230</span></a>                                       ORDER BY lasttime ASC&quot;, array(<a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l231"><span class="linenum"> 231</span></a>           return false;
<a name="l232"><span class="linenum"> 232</span></a>      }
<a name="l233"><span class="linenum"> 233</span></a>  
<a name="l234"><span class="linenum"> 234</span></a>      <a class="var it12897" onMouseOver="hilite(12897)" onMouseOut="lolite()" onClick="logVariable('past')" href="../../_variables/past.html">$past</a>     = array();
<a name="l235"><span class="linenum"> 235</span></a>      <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>  = array();
<a name="l236"><span class="linenum"> 236</span></a>      <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>); <span class="comment">// Reference needed because we might load the groups.</span>
<a name="l237"><span class="linenum"> 237</span></a>  
<a name="l238"><span class="linenum"> 238</span></a>      foreach (<a class="var it12896" onMouseOver="hilite(12896)" onMouseOut="lolite()" onClick="logVariable('mcms')" href="../../_variables/mcms.html">$mcms</a> as <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> =&gt; <a class="var it12898" onMouseOver="hilite(12898)" onMouseOut="lolite()" onClick="logVariable('mcm')" href="../../_variables/mcm.html">$mcm</a>) {
<a name="l239"><span class="linenum"> 239</span></a>          if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>, <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('cms')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/cms.html">cms</a>)) {
<a name="l240"><span class="linenum"> 240</span></a>              continue;
<a name="l241"><span class="linenum"> 241</span></a>          }
<a name="l242"><span class="linenum"> 242</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('cms')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/cms.html">cms</a>[<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>];
<a name="l243"><span class="linenum"> 243</span></a>          if (!<a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('cms')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/cms.html">cms</a>[<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;uservisible) {
<a name="l244"><span class="linenum"> 244</span></a>              continue;
<a name="l245"><span class="linenum"> 245</span></a>          }
<a name="l246"><span class="linenum"> 246</span></a>  
<a name="l247"><span class="linenum"> 247</span></a>          if (<a class="function" onClick="logFunction('groups_get_activity_groupmode')" href="../../_functions/groups_get_activity_groupmode.html" onMouseOver="funcPopup(event,'groups_get_activity_groupmode')">groups_get_activity_groupmode</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) != <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>
<a name="l248"><span class="linenum"> 248</span></a>           or <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l249"><span class="linenum"> 249</span></a>              if (<a class="var it1356" onMouseOver="hilite(1356)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> &gt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it12898" onMouseOver="hilite(12898)" onMouseOut="lolite()" onClick="logVariable('mcm')" href="../../_variables/mcm.html">$mcm</a>-&gt;<a onClick="logVariable('lasttime')" class="var it45138" onMouseOver="hilite(45138)" onMouseOut="lolite()" href="../../_variables/lasttime.html">lasttime</a>) {
<a name="l250"><span class="linenum"> 250</span></a>                  <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>[] = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>;
<a name="l251"><span class="linenum"> 251</span></a>              } else {
<a name="l252"><span class="linenum"> 252</span></a>                  <a class="var it12897" onMouseOver="hilite(12897)" onMouseOut="lolite()" onClick="logVariable('past')" href="../../_variables/past.html">$past</a>[] = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>;
<a name="l253"><span class="linenum"> 253</span></a>              }
<a name="l254"><span class="linenum"> 254</span></a>  
<a name="l255"><span class="linenum"> 255</span></a>              continue;
<a name="l256"><span class="linenum"> 256</span></a>          }
<a name="l257"><span class="linenum"> 257</span></a>  
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment">        // Verify groups in separate mode.</span>
<a name="l259"><span class="linenum"> 259</span></a>          if (!<a class="var it12899" onMouseOver="hilite(12899)" onMouseOut="lolite()" onClick="logVariable('mygroupids')" href="../../_variables/mygroupids.html">$mygroupids</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_groups')" href="../../_functions/get_groups.html" onMouseOver="funcPopup(event,'get_groups')">get_groups</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>)) {
<a name="l260"><span class="linenum"> 260</span></a>              continue;
<a name="l261"><span class="linenum"> 261</span></a>          }
<a name="l262"><span class="linenum"> 262</span></a>  
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment">        // Ok, last post was not for my group - we have to query db to get last message from one of my groups.</span>
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">        // The only minor problem is that the order will not be correct.</span>
<a name="l265"><span class="linenum"> 265</span></a>          <a class="var it12899" onMouseOver="hilite(12899)" onMouseOut="lolite()" onClick="logVariable('mygroupids')" href="../../_variables/mygroupids.html">$mygroupids</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it12899" onMouseOver="hilite(12899)" onMouseOut="lolite()" onClick="logVariable('mygroupids')" href="../../_variables/mygroupids.html">$mygroupids</a>);
<a name="l266"><span class="linenum"> 266</span></a>  
<a name="l267"><span class="linenum"> 267</span></a>          if (!<a class="var it12898" onMouseOver="hilite(12898)" onMouseOut="lolite()" onClick="logVariable('mcm')" href="../../_variables/mcm.html">$mcm</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT cm.id, <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(chm.timestamp) AS lasttime
<a name="l268"><span class="linenum"> 268</span></a>                                             FROM {course_modules} cm
<a name="l269"><span class="linenum"> 269</span></a>                                             JOIN {chat} ch           ON ch.id = cm.instance
<a name="l270"><span class="linenum"> 270</span></a>                                             JOIN {chat_messages_current} chm ON chm.chatid = ch.id
<a name="l271"><span class="linenum"> 271</span></a>                                            WHERE chm.timestamp &gt; ? AND cm.id = ? AND
<a name="l272"><span class="linenum"> 272</span></a>                                                  (chm.groupid IN (<a class="var it12899" onMouseOver="hilite(12899)" onMouseOut="lolite()" onClick="logVariable('mygroupids')" href="../../_variables/mygroupids.html">$mygroupids</a>) OR chm.groupid = 0)
<a name="l273"><span class="linenum"> 273</span></a>                                         GROUP BY cm.id&quot;, array(<a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l274"><span class="linenum"> 274</span></a>               continue;
<a name="l275"><span class="linenum"> 275</span></a>          }
<a name="l276"><span class="linenum"> 276</span></a>  
<a name="l277"><span class="linenum"> 277</span></a>          <a class="var it12896" onMouseOver="hilite(12896)" onMouseOut="lolite()" onClick="logVariable('mcms')" href="../../_variables/mcms.html">$mcms</a>[<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>]-&gt;lasttime = <a class="var it12898" onMouseOver="hilite(12898)" onMouseOut="lolite()" onClick="logVariable('mcm')" href="../../_variables/mcm.html">$mcm</a>-&gt;<a onClick="logVariable('lasttime')" class="var it45138" onMouseOver="hilite(45138)" onMouseOut="lolite()" href="../../_variables/lasttime.html">lasttime</a>;
<a name="l278"><span class="linenum"> 278</span></a>          if (<a class="var it1356" onMouseOver="hilite(1356)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> &gt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it12898" onMouseOver="hilite(12898)" onMouseOut="lolite()" onClick="logVariable('mcm')" href="../../_variables/mcm.html">$mcm</a>-&gt;<a onClick="logVariable('lasttime')" class="var it45138" onMouseOver="hilite(45138)" onMouseOut="lolite()" href="../../_variables/lasttime.html">lasttime</a>) {
<a name="l279"><span class="linenum"> 279</span></a>              <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>[] = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>;
<a name="l280"><span class="linenum"> 280</span></a>          } else {
<a name="l281"><span class="linenum"> 281</span></a>              <a class="var it12897" onMouseOver="hilite(12897)" onMouseOut="lolite()" onClick="logVariable('past')" href="../../_variables/past.html">$past</a>[] = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>;
<a name="l282"><span class="linenum"> 282</span></a>          }
<a name="l283"><span class="linenum"> 283</span></a>      }
<a name="l284"><span class="linenum"> 284</span></a>  
<a name="l285"><span class="linenum"> 285</span></a>      if (!<a class="var it12897" onMouseOver="hilite(12897)" onMouseOut="lolite()" onClick="logVariable('past')" href="../../_variables/past.html">$past</a> and !<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>) {
<a name="l286"><span class="linenum"> 286</span></a>          return false;
<a name="l287"><span class="linenum"> 287</span></a>      }
<a name="l288"><span class="linenum"> 288</span></a>  
<a name="l289"><span class="linenum"> 289</span></a>      <a class="var it12571" onMouseOver="hilite(12571)" onMouseOut="lolite()" onClick="logVariable('strftimerecent')" href="../../_variables/strftimerecent.html">$strftimerecent</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimerecent');
<a name="l290"><span class="linenum"> 290</span></a>  
<a name="l291"><span class="linenum"> 291</span></a>      if (<a class="var it12897" onMouseOver="hilite(12897)" onMouseOut="lolite()" onClick="logVariable('past')" href="../../_variables/past.html">$past</a>) {
<a name="l292"><span class="linenum"> 292</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('heading')" href="../../_functions/heading.html" onMouseOver="funcPopup(event,'heading')">heading</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;pastchats&quot;, 'chat').':', 3);
<a name="l293"><span class="linenum"> 293</span></a>  
<a name="l294"><span class="linenum"> 294</span></a>          foreach (<a class="var it12897" onMouseOver="hilite(12897)" onMouseOut="lolite()" onClick="logVariable('past')" href="../../_variables/past.html">$past</a> as <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l295"><span class="linenum"> 295</span></a>              <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/chat/view.php?id='.<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l296"><span class="linenum"> 296</span></a>              <a class="var it1098" onMouseOver="hilite(1098)" onMouseOut="lolite()" onClick="logVariable('date')" href="../../_variables/date.html">$date</a> = <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it12896" onMouseOver="hilite(12896)" onMouseOut="lolite()" onClick="logVariable('mcms')" href="../../_variables/mcms.html">$mcms</a>[<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;lasttime, <a class="var it12571" onMouseOver="hilite(12571)" onMouseOut="lolite()" onClick="logVariable('strftimerecent')" href="../../_variables/strftimerecent.html">$strftimerecent</a>);
<a name="l297"><span class="linenum"> 297</span></a>              echo '&lt;div class=&quot;head&quot;&gt;&lt;div class=&quot;date&quot;&gt;'.<a class="var it1098" onMouseOver="hilite(1098)" onMouseOut="lolite()" onClick="logVariable('date')" href="../../_variables/date.html">$date</a>.'&lt;/div&gt;&lt;/div&gt;';
<a name="l298"><span class="linenum"> 298</span></a>              echo '&lt;div class=&quot;info&quot;&gt;&lt;a href=&quot;'.<a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>.'&quot;&gt;'.<a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('name')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>, true).'&lt;/a&gt;&lt;/div&gt;';
<a name="l299"><span class="linenum"> 299</span></a>          }
<a name="l300"><span class="linenum"> 300</span></a>      }
<a name="l301"><span class="linenum"> 301</span></a>  
<a name="l302"><span class="linenum"> 302</span></a>      if (<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>) {
<a name="l303"><span class="linenum"> 303</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('heading')" href="../../_functions/heading.html" onMouseOver="funcPopup(event,'heading')">heading</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;currentchats&quot;, 'chat').':', 3);
<a name="l304"><span class="linenum"> 304</span></a>  
<a name="l305"><span class="linenum"> 305</span></a>          <a class="var it12900" onMouseOver="hilite(12900)" onMouseOut="lolite()" onClick="logVariable('oldest')" href="../../_variables/oldest.html">$oldest</a> = <a class="phpfunction" onClick="logFunction('floor')" href="../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>((<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('chat_old_ping')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/chat_old_ping.html">chat_old_ping</a>) / 10) * 10;  <span class="comment">// Better db caching.</span>
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>          <a class="var it12901" onMouseOver="hilite(12901)" onMouseOut="lolite()" onClick="logVariable('timeold')" href="../../_variables/timeold.html">$timeold</a>    = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('chat_old_ping')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/chat_old_ping.html">chat_old_ping</a>;
<a name="l308"><span class="linenum"> 308</span></a>          <a class="var it12901" onMouseOver="hilite(12901)" onMouseOut="lolite()" onClick="logVariable('timeold')" href="../../_variables/timeold.html">$timeold</a>    = <a class="phpfunction" onClick="logFunction('floor')" href="../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>(<a class="var it12901" onMouseOver="hilite(12901)" onMouseOut="lolite()" onClick="logVariable('timeold')" href="../../_variables/timeold.html">$timeold</a> / 10) * 10;  <span class="comment">// Better db caching.</span>
<a name="l309"><span class="linenum"> 309</span></a>          <a class="var it12902" onMouseOver="hilite(12902)" onMouseOut="lolite()" onClick="logVariable('timeoldext')" href="../../_variables/timeoldext.html">$timeoldext</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('chat_old_ping')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/chat_old_ping.html">chat_old_ping</a> * 10); <span class="comment">// JSless gui_basic needs much longer timeouts.</span>
<a name="l310"><span class="linenum"> 310</span></a>          <a class="var it12902" onMouseOver="hilite(12902)" onMouseOut="lolite()" onClick="logVariable('timeoldext')" href="../../_variables/timeoldext.html">$timeoldext</a> = <a class="phpfunction" onClick="logFunction('floor')" href="../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>(<a class="var it12902" onMouseOver="hilite(12902)" onMouseOut="lolite()" onClick="logVariable('timeoldext')" href="../../_variables/timeoldext.html">$timeoldext</a> / 10) * 10;  <span class="comment">// Better db caching.</span>
<a name="l311"><span class="linenum"> 311</span></a>  
<a name="l312"><span class="linenum"> 312</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('timeold' =&gt; <a class="var it12901" onMouseOver="hilite(12901)" onMouseOut="lolite()" onClick="logVariable('timeold')" href="../../_variables/timeold.html">$timeold</a>, 'timeoldext' =&gt; <a class="var it12902" onMouseOver="hilite(12902)" onMouseOut="lolite()" onClick="logVariable('timeoldext')" href="../../_variables/timeoldext.html">$timeoldext</a>, 'cmid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l313"><span class="linenum"> 313</span></a>  
<a name="l314"><span class="linenum"> 314</span></a>          <a class="var it1356" onMouseOver="hilite(1356)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> = &quot;AND ((chu.version&lt;&gt;'basic' AND chu.lastping&gt;:timeold) <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (chu.version='basic' AND chu.lastping&gt;:timeoldext))&quot;;
<a name="l315"><span class="linenum"> 315</span></a>  
<a name="l316"><span class="linenum"> 316</span></a>          foreach (<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a> as <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment">            // Count users first.</span>
<a name="l318"><span class="linenum"> 318</span></a>              <a class="var it12899" onMouseOver="hilite(12899)" onMouseOut="lolite()" onClick="logVariable('mygroupids')" href="../../_variables/mygroupids.html">$mygroupids</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a onClick="logVariable('groups')" class="var it43006" onMouseOver="hilite(43006)" onMouseOut="lolite()" href="../../_variables/groups.html">groups</a>[<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>];
<a name="l319"><span class="linenum"> 319</span></a>              if (!empty(<a class="var it12899" onMouseOver="hilite(12899)" onMouseOut="lolite()" onClick="logVariable('mygroupids')" href="../../_variables/mygroupids.html">$mygroupids</a>)) {
<a name="l320"><span class="linenum"> 320</span></a>                  <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it12903" onMouseOver="hilite(12903)" onMouseOut="lolite()" onClick="logVariable('subquery')" href="../../_variables/subquery.html">$subquery</a>, <a class="var it12904" onMouseOver="hilite(12904)" onMouseOut="lolite()" onClick="logVariable('subparams')" href="../../_variables/subparams.html">$subparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it12899" onMouseOver="hilite(12899)" onMouseOut="lolite()" onClick="logVariable('mygroupids')" href="../../_variables/mygroupids.html">$mygroupids</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'gid');
<a name="l321"><span class="linenum"> 321</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> += <a class="var it12904" onMouseOver="hilite(12904)" onMouseOut="lolite()" onClick="logVariable('subparams')" href="../../_variables/subparams.html">$subparams</a>;
<a name="l322"><span class="linenum"> 322</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND (chu.groupid <a class="var it12903" onMouseOver="hilite(12903)" onMouseOut="lolite()" onClick="logVariable('subquery')" href="../../_variables/subquery.html">$subquery</a> OR chu.groupid = 0)&quot;;
<a name="l323"><span class="linenum"> 323</span></a>              } else {
<a name="l324"><span class="linenum"> 324</span></a>                  <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l325"><span class="linenum"> 325</span></a>              }
<a name="l326"><span class="linenum"> 326</span></a>  
<a name="l327"><span class="linenum"> 327</span></a>              <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = <a class="class" onClick="logClass('user_picture')" href="../../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('u');
<a name="l328"><span class="linenum"> 328</span></a>              if (!<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>
<a name="l329"><span class="linenum"> 329</span></a>                                                    FROM {course_modules} cm
<a name="l330"><span class="linenum"> 330</span></a>                                                    JOIN {chat} ch        ON ch.id = cm.instance
<a name="l331"><span class="linenum"> 331</span></a>                                                    JOIN {chat_users} chu ON chu.chatid = ch.id
<a name="l332"><span class="linenum"> 332</span></a>                                                    JOIN {user} u         ON u.id = chu.userid
<a name="l333"><span class="linenum"> 333</span></a>                                                   WHERE cm.id = :cmid <a class="var it1356" onMouseOver="hilite(1356)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a>
<a name="l334"><span class="linenum"> 334</span></a>                                                GROUP BY <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l335"><span class="linenum"> 335</span></a>              }
<a name="l336"><span class="linenum"> 336</span></a>  
<a name="l337"><span class="linenum"> 337</span></a>              <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/chat/view.php?id='.<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l338"><span class="linenum"> 338</span></a>              <a class="var it1098" onMouseOver="hilite(1098)" onMouseOut="lolite()" onClick="logVariable('date')" href="../../_variables/date.html">$date</a> = <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it12896" onMouseOver="hilite(12896)" onMouseOut="lolite()" onClick="logVariable('mcms')" href="../../_variables/mcms.html">$mcms</a>[<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;lasttime, <a class="var it12571" onMouseOver="hilite(12571)" onMouseOut="lolite()" onClick="logVariable('strftimerecent')" href="../../_variables/strftimerecent.html">$strftimerecent</a>);
<a name="l339"><span class="linenum"> 339</span></a>  
<a name="l340"><span class="linenum"> 340</span></a>              echo '&lt;div class=&quot;head&quot;&gt;&lt;div class=&quot;date&quot;&gt;'.<a class="var it1098" onMouseOver="hilite(1098)" onMouseOut="lolite()" onClick="logVariable('date')" href="../../_variables/date.html">$date</a>.'&lt;/div&gt;&lt;/div&gt;';
<a name="l341"><span class="linenum"> 341</span></a>              echo '&lt;div class=&quot;info&quot;&gt;&lt;a href=&quot;'.<a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>.'&quot;&gt;'.<a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('name')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>, true).'&lt;/a&gt;&lt;/div&gt;';
<a name="l342"><span class="linenum"> 342</span></a>              echo '&lt;div class=&quot;userlist&quot;&gt;';
<a name="l343"><span class="linenum"> 343</span></a>              if (<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>) {
<a name="l344"><span class="linenum"> 344</span></a>                  echo '&lt;ul&gt;';
<a name="l345"><span class="linenum"> 345</span></a>                  foreach (<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> as <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l346"><span class="linenum"> 346</span></a>                      echo '&lt;li&gt;'.<a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it5397" onMouseOver="hilite(5397)" onMouseOut="lolite()" onClick="logVariable('viewfullnames')" href="../../_variables/viewfullnames.html">$viewfullnames</a>).'&lt;/li&gt;';
<a name="l347"><span class="linenum"> 347</span></a>                  }
<a name="l348"><span class="linenum"> 348</span></a>                  echo '&lt;/ul&gt;';
<a name="l349"><span class="linenum"> 349</span></a>              }
<a name="l350"><span class="linenum"> 350</span></a>              echo '&lt;/div&gt;';
<a name="l351"><span class="linenum"> 351</span></a>          }
<a name="l352"><span class="linenum"> 352</span></a>      }
<a name="l353"><span class="linenum"> 353</span></a>  
<a name="l354"><span class="linenum"> 354</span></a>      return true;
<a name="l355"><span class="linenum"> 355</span></a>  }
<a name="l356"><span class="linenum"> 356</span></a>  
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment">/**</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment"> * Function to be run periodically according to the moodle cron</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment"> * This function searches for things that need to be done, such</span>
<a name="l360"><span class="linenum"> 360</span></a>  <span class="comment"> * as sending out mail, toggling flags etc ...</span>
<a name="l361"><span class="linenum"> 361</span></a>  <span class="comment"> *</span>
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment"> * @global object</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment"> * @return bool</span>
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment"> */</span>
<a name="l365"><span class="linenum"> 365</span></a>  function <a class="function" onClick="logFunction('chat_cron')" href="../../_functions/chat_cron.html" onMouseOver="funcPopup(event,'chat_cron')">chat_cron</a> () {
<a name="l366"><span class="linenum"> 366</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l367"><span class="linenum"> 367</span></a>  
<a name="l368"><span class="linenum"> 368</span></a>      <a class="function" onClick="logFunction('chat_update_chat_times')" href="../../_functions/chat_update_chat_times.html" onMouseOver="funcPopup(event,'chat_update_chat_times')">chat_update_chat_times</a>();
<a name="l369"><span class="linenum"> 369</span></a>  
<a name="l370"><span class="linenum"> 370</span></a>      <a class="function" onClick="logFunction('chat_delete_old_users')" href="../../_functions/chat_delete_old_users.html" onMouseOver="funcPopup(event,'chat_delete_old_users')">chat_delete_old_users</a>();
<a name="l371"><span class="linenum"> 371</span></a>  
<a name="l372"><span class="linenum"> 372</span></a>  <span class="comment">    // Delete old messages with a single SQL query.</span>
<a name="l373"><span class="linenum"> 373</span></a>      <a class="var it12905" onMouseOver="hilite(12905)" onMouseOut="lolite()" onClick="logVariable('subselect')" href="../../_variables/subselect.html">$subselect</a> = &quot;SELECT c.keepdays
<a name="l374"><span class="linenum"> 374</span></a>                      FROM {chat} c
<a name="l375"><span class="linenum"> 375</span></a>                     WHERE c.id = {chat_messages}.chatid&quot;;
<a name="l376"><span class="linenum"> 376</span></a>  
<a name="l377"><span class="linenum"> 377</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;DELETE
<a name="l378"><span class="linenum"> 378</span></a>                FROM {chat_messages}
<a name="l379"><span class="linenum"> 379</span></a>               <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (<a class="var it12905" onMouseOver="hilite(12905)" onMouseOut="lolite()" onClick="logVariable('subselect')" href="../../_variables/subselect.html">$subselect</a>) &gt; 0 AND timestamp &lt; ( &quot;.<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>().&quot; -(<a class="var it12905" onMouseOver="hilite(12905)" onMouseOut="lolite()" onClick="logVariable('subselect')" href="../../_variables/subselect.html">$subselect</a>) * 24 * 3600)&quot;;
<a name="l380"><span class="linenum"> 380</span></a>  
<a name="l381"><span class="linenum"> 381</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l382"><span class="linenum"> 382</span></a>  
<a name="l383"><span class="linenum"> 383</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;DELETE
<a name="l384"><span class="linenum"> 384</span></a>                FROM {chat_messages_current}
<a name="l385"><span class="linenum"> 385</span></a>               WHERE timestamp &lt; ( &quot;.<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>().&quot; - 8 * 3600)&quot;;
<a name="l386"><span class="linenum"> 386</span></a>  
<a name="l387"><span class="linenum"> 387</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l388"><span class="linenum"> 388</span></a>  
<a name="l389"><span class="linenum"> 389</span></a>      return true;
<a name="l390"><span class="linenum"> 390</span></a>  }
<a name="l391"><span class="linenum"> 391</span></a>  
<a name="l392"><span class="linenum"> 392</span></a>  <span class="comment">/**</span>
<a name="l393"><span class="linenum"> 393</span></a>  <span class="comment"> * This standard function will check all instances of this module</span>
<a name="l394"><span class="linenum"> 394</span></a>  <span class="comment"> * and make sure there are up-to-date events created for each of them.</span>
<a name="l395"><span class="linenum"> 395</span></a>  <span class="comment"> * If courseid = 0, then every chat event in the site is checked, else</span>
<a name="l396"><span class="linenum"> 396</span></a>  <span class="comment"> * only chat events belonging to the course specified are checked.</span>
<a name="l397"><span class="linenum"> 397</span></a>  <span class="comment"> * This function is used, in its new format, by restore_refresh_events()</span>
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment"> *</span>
<a name="l399"><span class="linenum"> 399</span></a>  <span class="comment"> * @global object</span>
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment"> * @return bool</span>
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment"> */</span>
<a name="l403"><span class="linenum"> 403</span></a>  function <a class="function" onClick="logFunction('chat_refresh_events')" href="../../_functions/chat_refresh_events.html" onMouseOver="funcPopup(event,'chat_refresh_events')">chat_refresh_events</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = 0) {
<a name="l404"><span class="linenum"> 404</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>      if (<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l407"><span class="linenum"> 407</span></a>          if (! <a class="var it8761" onMouseOver="hilite(8761)" onMouseOut="lolite()" onClick="logVariable('chats')" href="../../_variables/chats.html">$chats</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(&quot;chat&quot;, array(&quot;course&quot; =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>))) {
<a name="l408"><span class="linenum"> 408</span></a>              return true;
<a name="l409"><span class="linenum"> 409</span></a>          }
<a name="l410"><span class="linenum"> 410</span></a>      } else {
<a name="l411"><span class="linenum"> 411</span></a>          if (! <a class="var it8761" onMouseOver="hilite(8761)" onMouseOut="lolite()" onClick="logVariable('chats')" href="../../_variables/chats.html">$chats</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(&quot;chat&quot;)) {
<a name="l412"><span class="linenum"> 412</span></a>              return true;
<a name="l413"><span class="linenum"> 413</span></a>          }
<a name="l414"><span class="linenum"> 414</span></a>      }
<a name="l415"><span class="linenum"> 415</span></a>      <a class="var it2352" onMouseOver="hilite(2352)" onMouseOut="lolite()" onClick="logVariable('moduleid')" href="../../_variables/moduleid.html">$moduleid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('modules', 'id', array('name' =&gt; 'chat'));
<a name="l416"><span class="linenum"> 416</span></a>  
<a name="l417"><span class="linenum"> 417</span></a>      foreach (<a class="var it8761" onMouseOver="hilite(8761)" onMouseOut="lolite()" onClick="logVariable('chats')" href="../../_variables/chats.html">$chats</a> as <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>) {
<a name="l418"><span class="linenum"> 418</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('chat', <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('course')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>);
<a name="l419"><span class="linenum"> 419</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = new stdClass();
<a name="l420"><span class="linenum"> 420</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('name')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>        = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('name')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l421"><span class="linenum"> 421</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('description')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/description.html">description</a> = <a class="function" onClick="logFunction('format_module_intro')" href="../../_functions/format_module_intro.html" onMouseOver="funcPopup(event,'format_module_intro')">format_module_intro</a>('chat', <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l422"><span class="linenum"> 422</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timestart')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>   = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a>;
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>          if (<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('event', 'id', array('modulename' =&gt; 'chat', 'instance' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l425"><span class="linenum"> 425</span></a>              <a class="var it12895" onMouseOver="hilite(12895)" onMouseOut="lolite()" onClick="logVariable('calendarevent')" href="../../_variables/calendarevent.html">$calendarevent</a> = <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('load')" href="../../_functions/load.html" onMouseOver="funcPopup(event,'load')">load</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l426"><span class="linenum"> 426</span></a>              <a class="var it12895" onMouseOver="hilite(12895)" onMouseOut="lolite()" onClick="logVariable('calendarevent')" href="../../_variables/calendarevent.html">$calendarevent</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l427"><span class="linenum"> 427</span></a>          } else {
<a name="l428"><span class="linenum"> 428</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('courseid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>    = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('course')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>;
<a name="l429"><span class="linenum"> 429</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('groupid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>     = 0;
<a name="l430"><span class="linenum"> 430</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('userid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>      = 0;
<a name="l431"><span class="linenum"> 431</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('modulename')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a>  = 'chat';
<a name="l432"><span class="linenum"> 432</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('instance')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>    = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l433"><span class="linenum"> 433</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('eventtype')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/eventtype.html">eventtype</a>   = 'chattime';
<a name="l434"><span class="linenum"> 434</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timeduration')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timeduration.html">timeduration</a> = 0;
<a name="l435"><span class="linenum"> 435</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('visible')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('course_modules', 'visible', array('module' =&gt; <a class="var it2352" onMouseOver="hilite(2352)" onMouseOut="lolite()" onClick="logVariable('moduleid')" href="../../_variables/moduleid.html">$moduleid</a>, 'instance' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l436"><span class="linenum"> 436</span></a>  
<a name="l437"><span class="linenum"> 437</span></a>              <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l438"><span class="linenum"> 438</span></a>          }
<a name="l439"><span class="linenum"> 439</span></a>      }
<a name="l440"><span class="linenum"> 440</span></a>      return true;
<a name="l441"><span class="linenum"> 441</span></a>  }
<a name="l442"><span class="linenum"> 442</span></a>  
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">// Functions that require some SQL.</span>
<a name="l444"><span class="linenum"> 444</span></a>  
<a name="l445"><span class="linenum"> 445</span></a>  <span class="comment">/**</span>
<a name="l446"><span class="linenum"> 446</span></a>  <span class="comment"> * @global object</span>
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment"> * @param int $chatid</span>
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment"> * @param int $groupid</span>
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment"> * @param int $groupingid</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment"> * @return array</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment"> */</span>
<a name="l452"><span class="linenum"> 452</span></a>  function <a class="function" onClick="logFunction('chat_get_users')" href="../../_functions/chat_get_users.html" onMouseOver="funcPopup(event,'chat_get_users')">chat_get_users</a>(<a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>=0, <a class="var it680" onMouseOver="hilite(680)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>=0) {
<a name="l453"><span class="linenum"> 453</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l454"><span class="linenum"> 454</span></a>  
<a name="l455"><span class="linenum"> 455</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('chatid' =&gt; <a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>, 'groupid' =&gt; <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>, 'groupingid' =&gt; <a class="var it680" onMouseOver="hilite(680)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>);
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>      if (<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>) {
<a name="l458"><span class="linenum"> 458</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot; AND (c.groupid=:groupid OR c.groupid='0')&quot;;
<a name="l459"><span class="linenum"> 459</span></a>      } else {
<a name="l460"><span class="linenum"> 460</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l461"><span class="linenum"> 461</span></a>      }
<a name="l462"><span class="linenum"> 462</span></a>  
<a name="l463"><span class="linenum"> 463</span></a>      if (!empty(<a class="var it680" onMouseOver="hilite(680)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>)) {
<a name="l464"><span class="linenum"> 464</span></a>          <a class="var it12906" onMouseOver="hilite(12906)" onMouseOut="lolite()" onClick="logVariable('groupingjoin')" href="../../_variables/groupingjoin.html">$groupingjoin</a> = &quot;JOIN {groups_members} gm ON u.id = gm.userid
<a name="l465"><span class="linenum"> 465</span></a>                           JOIN {groupings_groups} gg ON gm.groupid = gg.groupid AND gg.groupingid = :groupingid &quot;;
<a name="l466"><span class="linenum"> 466</span></a>  
<a name="l467"><span class="linenum"> 467</span></a>      } else {
<a name="l468"><span class="linenum"> 468</span></a>          <a class="var it12906" onMouseOver="hilite(12906)" onMouseOut="lolite()" onClick="logVariable('groupingjoin')" href="../../_variables/groupingjoin.html">$groupingjoin</a> = '';
<a name="l469"><span class="linenum"> 469</span></a>      }
<a name="l470"><span class="linenum"> 470</span></a>  
<a name="l471"><span class="linenum"> 471</span></a>      <a class="var it9804" onMouseOver="hilite(9804)" onMouseOut="lolite()" onClick="logVariable('ufields')" href="../../_variables/ufields.html">$ufields</a> = <a class="class" onClick="logClass('user_picture')" href="../../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('u');
<a name="l472"><span class="linenum"> 472</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT DISTINCT <a class="var it9804" onMouseOver="hilite(9804)" onMouseOut="lolite()" onClick="logVariable('ufields')" href="../../_variables/ufields.html">$ufields</a>, c.lastmessageping, c.firstping
<a name="l473"><span class="linenum"> 473</span></a>                                     FROM {chat_users} c
<a name="l474"><span class="linenum"> 474</span></a>                                     JOIN {user} u ON u.id = c.userid <a class="var it12906" onMouseOver="hilite(12906)" onMouseOut="lolite()" onClick="logVariable('groupingjoin')" href="../../_variables/groupingjoin.html">$groupingjoin</a>
<a name="l475"><span class="linenum"> 475</span></a>                                    WHERE c.chatid = :chatid <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a>
<a name="l476"><span class="linenum"> 476</span></a>                                 ORDER BY c.firstping ASC&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l477"><span class="linenum"> 477</span></a>  }
<a name="l478"><span class="linenum"> 478</span></a>  
<a name="l479"><span class="linenum"> 479</span></a>  <span class="comment">/**</span>
<a name="l480"><span class="linenum"> 480</span></a>  <span class="comment"> * @global object</span>
<a name="l481"><span class="linenum"> 481</span></a>  <span class="comment"> * @param int $chatid</span>
<a name="l482"><span class="linenum"> 482</span></a>  <span class="comment"> * @param int $groupid</span>
<a name="l483"><span class="linenum"> 483</span></a>  <span class="comment"> * @return array</span>
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment"> */</span>
<a name="l485"><span class="linenum"> 485</span></a>  function <a class="function" onClick="logFunction('chat_get_latest_message')" href="../../_functions/chat_get_latest_message.html" onMouseOver="funcPopup(event,'chat_get_latest_message')">chat_get_latest_message</a>(<a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>=0) {
<a name="l486"><span class="linenum"> 486</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l487"><span class="linenum"> 487</span></a>  
<a name="l488"><span class="linenum"> 488</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('chatid' =&gt; <a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>, 'groupid' =&gt; <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>);
<a name="l489"><span class="linenum"> 489</span></a>  
<a name="l490"><span class="linenum"> 490</span></a>      if (<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>) {
<a name="l491"><span class="linenum"> 491</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;AND (groupid=:groupid OR groupid=0)&quot;;
<a name="l492"><span class="linenum"> 492</span></a>      } else {
<a name="l493"><span class="linenum"> 493</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot;&quot;;
<a name="l494"><span class="linenum"> 494</span></a>      }
<a name="l495"><span class="linenum"> 495</span></a>  
<a name="l496"><span class="linenum"> 496</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l497"><span class="linenum"> 497</span></a>          FROM {chat_messages_current} WHERE chatid = :chatid <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a>
<a name="l498"><span class="linenum"> 498</span></a>          ORDER BY timestamp DESC&quot;;
<a name="l499"><span class="linenum"> 499</span></a>  
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">    // Return the lastest one message.</span>
<a name="l501"><span class="linenum"> 501</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, true);
<a name="l502"><span class="linenum"> 502</span></a>  }
<a name="l503"><span class="linenum"> 503</span></a>  
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">/**</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment"> * login if not already logged in</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment"> *</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment"> * @global object</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment"> * @global object</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment"> * @param int $chatid</span>
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment"> * @param string $version</span>
<a name="l511"><span class="linenum"> 511</span></a>  <span class="comment"> * @param int $groupid</span>
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment"> * @param object $course</span>
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment"> * @return bool|int Returns the chat users sid or false</span>
<a name="l514"><span class="linenum"> 514</span></a>  <span class="comment"> */</span>
<a name="l515"><span class="linenum"> 515</span></a>  function <a class="function" onClick="logFunction('chat_login_user')" href="../../_functions/chat_login_user.html" onMouseOver="funcPopup(event,'chat_login_user')">chat_login_user</a>(<a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>, <a class="var it347" onMouseOver="hilite(347)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l516"><span class="linenum"> 516</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l517"><span class="linenum"> 517</span></a>  
<a name="l518"><span class="linenum"> 518</span></a>      if ((<a class="var it347" onMouseOver="hilite(347)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a> != 'sockets') and <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('chat_users', array('chatid' =&gt; <a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>,
<a name="l519"><span class="linenum"> 519</span></a>                                                                                      'userid' =&gt; <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l520"><span class="linenum"> 520</span></a>                                                                                      'groupid' =&gt; <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>))) {
<a name="l521"><span class="linenum"> 521</span></a>  <span class="comment">        // This will update logged user information.</span>
<a name="l522"><span class="linenum"> 522</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('version')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/version.html">version</a>  = <a class="var it347" onMouseOver="hilite(347)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a>;
<a name="l523"><span class="linenum"> 523</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('ip')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/ip.html">ip</a>       = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('lastip')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/lastip.html">lastip</a>;
<a name="l524"><span class="linenum"> 524</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('lastping')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/lastping.html">lastping</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l525"><span class="linenum"> 525</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('lang')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a>     = <a class="function" onClick="logFunction('current_language')" href="../../_functions/current_language.html" onMouseOver="funcPopup(event,'current_language')">current_language</a>();
<a name="l526"><span class="linenum"> 526</span></a>  
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment">        // Sometimes $USER-&gt;lastip is not setup properly during login.</span>
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment">        // Update with current value if possible or provide a dummy value for the db.</span>
<a name="l529"><span class="linenum"> 529</span></a>          if (empty(<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('ip')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/ip.html">ip</a>)) {
<a name="l530"><span class="linenum"> 530</span></a>              <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('ip')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/ip.html">ip</a> = <a class="function" onClick="logFunction('getremoteaddr')" href="../../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>();
<a name="l531"><span class="linenum"> 531</span></a>          }
<a name="l532"><span class="linenum"> 532</span></a>  
<a name="l533"><span class="linenum"> 533</span></a>          if ((<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('course')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> != <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) <a class="function" onClick="logFunction('or')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('userid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> != <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l534"><span class="linenum"> 534</span></a>              return false;
<a name="l535"><span class="linenum"> 535</span></a>          }
<a name="l536"><span class="linenum"> 536</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('chat_users', <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>);
<a name="l537"><span class="linenum"> 537</span></a>  
<a name="l538"><span class="linenum"> 538</span></a>      } else {
<a name="l539"><span class="linenum"> 539</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a> = new stdClass();
<a name="l540"><span class="linenum"> 540</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('chatid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/chatid.html">chatid</a>   = <a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>;
<a name="l541"><span class="linenum"> 541</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('userid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>   = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l542"><span class="linenum"> 542</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('groupid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>  = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l543"><span class="linenum"> 543</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('version')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/version.html">version</a>  = <a class="var it347" onMouseOver="hilite(347)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a>;
<a name="l544"><span class="linenum"> 544</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('ip')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/ip.html">ip</a>       = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('lastip')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/lastip.html">lastip</a>;
<a name="l545"><span class="linenum"> 545</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('lastping')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/lastping.html">lastping</a> = <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('firstping')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/firstping.html">firstping</a> = <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('lastmessageping')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/lastmessageping.html">lastmessageping</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l546"><span class="linenum"> 546</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('sid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/sid.html">sid</a>      = <a class="function" onClick="logFunction('random_string')" href="../../_functions/random_string.html" onMouseOver="funcPopup(event,'random_string')">random_string</a>(32);
<a name="l547"><span class="linenum"> 547</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('course')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>   = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>; <span class="comment">// Caching - needed for current_language too.</span>
<a name="l548"><span class="linenum"> 548</span></a>          <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('lang')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a>     = <a class="function" onClick="logFunction('current_language')" href="../../_functions/current_language.html" onMouseOver="funcPopup(event,'current_language')">current_language</a>(); <span class="comment">// Caching - to resource intensive to find out later.</span>
<a name="l549"><span class="linenum"> 549</span></a>  
<a name="l550"><span class="linenum"> 550</span></a>  <span class="comment">        // Sometimes $USER-&gt;lastip is not setup properly during login.</span>
<a name="l551"><span class="linenum"> 551</span></a>  <span class="comment">        // Update with current value if possible or provide a dummy value for the db.</span>
<a name="l552"><span class="linenum"> 552</span></a>          if (empty(<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('ip')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/ip.html">ip</a>)) {
<a name="l553"><span class="linenum"> 553</span></a>              <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('ip')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/ip.html">ip</a> = <a class="function" onClick="logFunction('getremoteaddr')" href="../../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>();
<a name="l554"><span class="linenum"> 554</span></a>          }
<a name="l555"><span class="linenum"> 555</span></a>  
<a name="l556"><span class="linenum"> 556</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('chat_users', <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>);
<a name="l557"><span class="linenum"> 557</span></a>  
<a name="l558"><span class="linenum"> 558</span></a>          if (<a class="var it347" onMouseOver="hilite(347)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a> == 'sockets') {
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">            // Do not send 'enter' message, chatd will do it.</span>
<a name="l560"><span class="linenum"> 560</span></a>          } else {
<a name="l561"><span class="linenum"> 561</span></a>              <a class="function" onClick="logFunction('chat_send_chatmessage')" href="../../_functions/chat_send_chatmessage.html" onMouseOver="funcPopup(event,'chat_send_chatmessage')">chat_send_chatmessage</a>(<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>, 'enter', true);
<a name="l562"><span class="linenum"> 562</span></a>          }
<a name="l563"><span class="linenum"> 563</span></a>      }
<a name="l564"><span class="linenum"> 564</span></a>  
<a name="l565"><span class="linenum"> 565</span></a>      return <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('sid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/sid.html">sid</a>;
<a name="l566"><span class="linenum"> 566</span></a>  }
<a name="l567"><span class="linenum"> 567</span></a>  
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment">/**</span>
<a name="l569"><span class="linenum"> 569</span></a>  <span class="comment"> * Delete the old and in the way</span>
<a name="l570"><span class="linenum"> 570</span></a>  <span class="comment"> *</span>
<a name="l571"><span class="linenum"> 571</span></a>  <span class="comment"> * @global object</span>
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment"> * @global object</span>
<a name="l573"><span class="linenum"> 573</span></a>  <span class="comment"> */</span>
<a name="l574"><span class="linenum"> 574</span></a>  function <a class="function" onClick="logFunction('chat_delete_old_users')" href="../../_functions/chat_delete_old_users.html" onMouseOver="funcPopup(event,'chat_delete_old_users')">chat_delete_old_users</a>() {
<a name="l575"><span class="linenum"> 575</span></a>  <span class="comment">    // Delete the old and in the way.</span>
<a name="l576"><span class="linenum"> 576</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l577"><span class="linenum"> 577</span></a>  
<a name="l578"><span class="linenum"> 578</span></a>      <a class="var it12901" onMouseOver="hilite(12901)" onMouseOut="lolite()" onClick="logVariable('timeold')" href="../../_variables/timeold.html">$timeold</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('chat_old_ping')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/chat_old_ping.html">chat_old_ping</a>;
<a name="l579"><span class="linenum"> 579</span></a>      <a class="var it12902" onMouseOver="hilite(12902)" onMouseOut="lolite()" onClick="logVariable('timeoldext')" href="../../_variables/timeoldext.html">$timeoldext</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('chat_old_ping')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/chat_old_ping.html">chat_old_ping</a> * 10); <span class="comment">// JSless gui_basic needs much longer timeouts.</span>
<a name="l580"><span class="linenum"> 580</span></a>  
<a name="l581"><span class="linenum"> 581</span></a>      <a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;(version&lt;&gt;'basic' AND lastping&lt;?) <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (version='basic' AND lastping&lt;?)&quot;;
<a name="l582"><span class="linenum"> 582</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it12901" onMouseOver="hilite(12901)" onMouseOut="lolite()" onClick="logVariable('timeold')" href="../../_variables/timeold.html">$timeold</a>, <a class="var it12902" onMouseOver="hilite(12902)" onMouseOut="lolite()" onClick="logVariable('timeoldext')" href="../../_variables/timeoldext.html">$timeoldext</a>);
<a name="l583"><span class="linenum"> 583</span></a>  
<a name="l584"><span class="linenum"> 584</span></a>      if (<a class="var it12909" onMouseOver="hilite(12909)" onMouseOut="lolite()" onClick="logVariable('oldusers')" href="../../_variables/oldusers.html">$oldusers</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('chat_users', <a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) ) {
<a name="l585"><span class="linenum"> 585</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('chat_users', <a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l586"><span class="linenum"> 586</span></a>          foreach (<a class="var it12909" onMouseOver="hilite(12909)" onMouseOut="lolite()" onClick="logVariable('oldusers')" href="../../_variables/oldusers.html">$oldusers</a> as <a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>) {
<a name="l587"><span class="linenum"> 587</span></a>              <a class="function" onClick="logFunction('chat_send_chatmessage')" href="../../_functions/chat_send_chatmessage.html" onMouseOver="funcPopup(event,'chat_send_chatmessage')">chat_send_chatmessage</a>(<a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>, 'exit', true);
<a name="l588"><span class="linenum"> 588</span></a>          }
<a name="l589"><span class="linenum"> 589</span></a>      }
<a name="l590"><span class="linenum"> 590</span></a>  }
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">/**</span>
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment"> * Updates chat records so that the next chat time is correct</span>
<a name="l594"><span class="linenum"> 594</span></a>  <span class="comment"> *</span>
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment"> * @global object</span>
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment"> * @param int $chatid</span>
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment"> * @return void</span>
<a name="l598"><span class="linenum"> 598</span></a>  <span class="comment"> */</span>
<a name="l599"><span class="linenum"> 599</span></a>  function <a class="function" onClick="logFunction('chat_update_chat_times')" href="../../_functions/chat_update_chat_times.html" onMouseOver="funcPopup(event,'chat_update_chat_times')">chat_update_chat_times</a>(<a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>=0) {
<a name="l600"><span class="linenum"> 600</span></a>  <span class="comment">    // Updates chat records so that the next chat time is correct.</span>
<a name="l601"><span class="linenum"> 601</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l602"><span class="linenum"> 602</span></a>  
<a name="l603"><span class="linenum"> 603</span></a>      <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l604"><span class="linenum"> 604</span></a>  
<a name="l605"><span class="linenum"> 605</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('timenow' =&gt; <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>, 'chatid' =&gt; <a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>);
<a name="l606"><span class="linenum"> 606</span></a>  
<a name="l607"><span class="linenum"> 607</span></a>      if (<a class="var it11332" onMouseOver="hilite(11332)" onMouseOut="lolite()" onClick="logVariable('chatid')" href="../../_variables/chatid.html">$chatid</a>) {
<a name="l608"><span class="linenum"> 608</span></a>          if (!<a class="var it8761" onMouseOver="hilite(8761)" onMouseOut="lolite()" onClick="logVariable('chats')" href="../../_variables/chats.html">$chats</a>[] = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_select')" href="../../_functions/get_record_select.html" onMouseOver="funcPopup(event,'get_record_select')">get_record_select</a>(&quot;chat&quot;, &quot;id = :chatid AND chattime &lt;= :timenow AND schedule &gt; 0&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l609"><span class="linenum"> 609</span></a>              return;
<a name="l610"><span class="linenum"> 610</span></a>          }
<a name="l611"><span class="linenum"> 611</span></a>      } else {
<a name="l612"><span class="linenum"> 612</span></a>          if (!<a class="var it8761" onMouseOver="hilite(8761)" onMouseOut="lolite()" onClick="logVariable('chats')" href="../../_variables/chats.html">$chats</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(&quot;chat&quot;, &quot;chattime &lt;= :timenow AND schedule &gt; 0&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l613"><span class="linenum"> 613</span></a>              return;
<a name="l614"><span class="linenum"> 614</span></a>          }
<a name="l615"><span class="linenum"> 615</span></a>      }
<a name="l616"><span class="linenum"> 616</span></a>  
<a name="l617"><span class="linenum"> 617</span></a>      foreach (<a class="var it8761" onMouseOver="hilite(8761)" onMouseOut="lolite()" onClick="logVariable('chats')" href="../../_variables/chats.html">$chats</a> as <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>) {
<a name="l618"><span class="linenum"> 618</span></a>          switch (<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('schedule')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/schedule.html">schedule</a>) {
<a name="l619"><span class="linenum"> 619</span></a>              case 1: // Single event - turn off schedule and disable.
<a name="l620"><span class="linenum"> 620</span></a>                  <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a> = 0;
<a name="l621"><span class="linenum"> 621</span></a>                  <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('schedule')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/schedule.html">schedule</a> = 0;
<a name="l622"><span class="linenum"> 622</span></a>                  break;
<a name="l623"><span class="linenum"> 623</span></a>              case 2: // Repeat daily.
<a name="l624"><span class="linenum"> 624</span></a>                  while (<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a> &lt;= <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>) {
<a name="l625"><span class="linenum"> 625</span></a>                      <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a> += 24 * 3600;
<a name="l626"><span class="linenum"> 626</span></a>                  }
<a name="l627"><span class="linenum"> 627</span></a>                  break;
<a name="l628"><span class="linenum"> 628</span></a>              case 3: // Repeat weekly.
<a name="l629"><span class="linenum"> 629</span></a>                  while (<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a> &lt;= <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../../_variables/timenow.html">$timenow</a>) {
<a name="l630"><span class="linenum"> 630</span></a>                      <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a> += 7 * 24 * 3600;
<a name="l631"><span class="linenum"> 631</span></a>                  }
<a name="l632"><span class="linenum"> 632</span></a>                  break;
<a name="l633"><span class="linenum"> 633</span></a>          }
<a name="l634"><span class="linenum"> 634</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>(&quot;chat&quot;, <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>);
<a name="l635"><span class="linenum"> 635</span></a>  
<a name="l636"><span class="linenum"> 636</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = new stdClass(); <span class="comment">// Update calendar too.</span>
<a name="l637"><span class="linenum"> 637</span></a>  
<a name="l638"><span class="linenum"> 638</span></a>          <a class="var it2047" onMouseOver="hilite(2047)" onMouseOut="lolite()" onClick="logVariable('cond')" href="../../_variables/cond.html">$cond</a> = &quot;modulename='chat' AND instance = :chatid AND timestart &lt;&gt; :chattime&quot;;
<a name="l639"><span class="linenum"> 639</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('chattime' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a>, 'chatid' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l640"><span class="linenum"> 640</span></a>  
<a name="l641"><span class="linenum"> 641</span></a>          if (<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_select')" href="../../_functions/get_field_select.html" onMouseOver="funcPopup(event,'get_field_select')">get_field_select</a>('event', 'id', <a class="var it2047" onMouseOver="hilite(2047)" onMouseOut="lolite()" onClick="logVariable('cond')" href="../../_variables/cond.html">$cond</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l642"><span class="linenum"> 642</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timestart')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>   = <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a>;
<a name="l643"><span class="linenum"> 643</span></a>              <a class="var it12895" onMouseOver="hilite(12895)" onMouseOut="lolite()" onClick="logVariable('calendarevent')" href="../../_variables/calendarevent.html">$calendarevent</a> = <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('load')" href="../../_functions/load.html" onMouseOver="funcPopup(event,'load')">load</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l644"><span class="linenum"> 644</span></a>              <a class="var it12895" onMouseOver="hilite(12895)" onMouseOut="lolite()" onClick="logVariable('calendarevent')" href="../../_variables/calendarevent.html">$calendarevent</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>, false);
<a name="l645"><span class="linenum"> 645</span></a>          }
<a name="l646"><span class="linenum"> 646</span></a>      }
<a name="l647"><span class="linenum"> 647</span></a>  }
<a name="l648"><span class="linenum"> 648</span></a>  
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment">/**</span>
<a name="l650"><span class="linenum"> 650</span></a>  <span class="comment"> * Send a message on the chat.</span>
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment"> *</span>
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment"> * @param object $chatuser The chat user record.</span>
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment"> * @param string $messagetext The message to be sent.</span>
<a name="l654"><span class="linenum"> 654</span></a>  <span class="comment"> * @param bool $system False for non-system messages, true for system messages.</span>
<a name="l655"><span class="linenum"> 655</span></a>  <span class="comment"> * @param object $cm The course module object, pass it to save a database query when we trigger the event.</span>
<a name="l656"><span class="linenum"> 656</span></a>  <span class="comment"> * @return int The message ID.</span>
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment"> * @since Moodle 2.6</span>
<a name="l658"><span class="linenum"> 658</span></a>  <span class="comment"> */</span>
<a name="l659"><span class="linenum"> 659</span></a>  function <a class="function" onClick="logFunction('chat_send_chatmessage')" href="../../_functions/chat_send_chatmessage.html" onMouseOver="funcPopup(event,'chat_send_chatmessage')">chat_send_chatmessage</a>(<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>, <a class="var it12911" onMouseOver="hilite(12911)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../../_variables/messagetext.html">$messagetext</a>, <a class="var it11338" onMouseOver="hilite(11338)" onMouseOut="lolite()" onClick="logVariable('system')" href="../../_variables/system.html">$system</a> = false, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = null) {
<a name="l660"><span class="linenum"> 660</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l661"><span class="linenum"> 661</span></a>  
<a name="l662"><span class="linenum"> 662</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a> = new stdClass();
<a name="l663"><span class="linenum"> 663</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('chatid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/chatid.html">chatid</a>    = <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('chatid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/chatid.html">chatid</a>;
<a name="l664"><span class="linenum"> 664</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>    = <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('userid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l665"><span class="linenum"> 665</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('groupid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>   = <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('groupid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>;
<a name="l666"><span class="linenum"> 666</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('message')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>   = <a class="var it12911" onMouseOver="hilite(12911)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../../_variables/messagetext.html">$messagetext</a>;
<a name="l667"><span class="linenum"> 667</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('system')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/system.html">system</a>    = <a class="var it11338" onMouseOver="hilite(11338)" onMouseOut="lolite()" onClick="logVariable('system')" href="../../_variables/system.html">$system</a> ? 1 : 0;
<a name="l668"><span class="linenum"> 668</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timestamp')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/timestamp.html">timestamp</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l669"><span class="linenum"> 669</span></a>  
<a name="l670"><span class="linenum"> 670</span></a>      <a class="var it5664" onMouseOver="hilite(5664)" onMouseOut="lolite()" onClick="logVariable('messageid')" href="../../_variables/messageid.html">$messageid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('chat_messages', <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>);
<a name="l671"><span class="linenum"> 671</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('chat_messages_current', <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>);
<a name="l672"><span class="linenum"> 672</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5664" onMouseOver="hilite(5664)" onMouseOut="lolite()" onClick="logVariable('messageid')" href="../../_variables/messageid.html">$messageid</a>;
<a name="l673"><span class="linenum"> 673</span></a>  
<a name="l674"><span class="linenum"> 674</span></a>      if (!<a class="var it11338" onMouseOver="hilite(11338)" onMouseOut="lolite()" onClick="logVariable('system')" href="../../_variables/system.html">$system</a>) {
<a name="l675"><span class="linenum"> 675</span></a>  
<a name="l676"><span class="linenum"> 676</span></a>          if (empty(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l677"><span class="linenum"> 677</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('chat', <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('chatid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/chatid.html">chatid</a>, <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('course')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>);
<a name="l678"><span class="linenum"> 678</span></a>          }
<a name="l679"><span class="linenum"> 679</span></a>  
<a name="l680"><span class="linenum"> 680</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l681"><span class="linenum"> 681</span></a>              'context' =&gt; <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>),
<a name="l682"><span class="linenum"> 682</span></a>              'objectid' =&gt; <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l683"><span class="linenum"> 683</span></a>  <span class="comment">            // We set relateduserid, because when triggered from the chat daemon, the event userid is null.</span>
<a name="l684"><span class="linenum"> 684</span></a>              'relateduserid' =&gt; <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;userid
<a name="l685"><span class="linenum"> 685</span></a>          );
<a name="l686"><span class="linenum"> 686</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \mod_chat\event\<a class="class" onClick="logClass('message_sent')" href="../../_classes/message_sent.html" onMouseOver="classPopup(event,'message_sent')">message_sent</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l687"><span class="linenum"> 687</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('chat_messages', <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>);
<a name="l688"><span class="linenum"> 688</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l689"><span class="linenum"> 689</span></a>      }
<a name="l690"><span class="linenum"> 690</span></a>  
<a name="l691"><span class="linenum"> 691</span></a>      return <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l692"><span class="linenum"> 692</span></a>  }
<a name="l693"><span class="linenum"> 693</span></a>  
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment">/**</span>
<a name="l695"><span class="linenum"> 695</span></a>  <span class="comment"> * @global object</span>
<a name="l696"><span class="linenum"> 696</span></a>  <span class="comment"> * @global object</span>
<a name="l697"><span class="linenum"> 697</span></a>  <span class="comment"> * @param object $message</span>
<a name="l698"><span class="linenum"> 698</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment"> * @param object $sender</span>
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment"> * @param object $currentuser</span>
<a name="l701"><span class="linenum"> 701</span></a>  <span class="comment"> * @param string $chatlastrow</span>
<a name="l702"><span class="linenum"> 702</span></a>  <span class="comment"> * @return bool|string Returns HTML or false</span>
<a name="l703"><span class="linenum"> 703</span></a>  <span class="comment"> */</span>
<a name="l704"><span class="linenum"> 704</span></a>  function <a class="function" onClick="logFunction('chat_format_message_manually')" href="../../_functions/chat_format_message_manually.html" onMouseOver="funcPopup(event,'chat_format_message_manually')">chat_format_message_manually</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>, <a class="var it12913" onMouseOver="hilite(12913)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../../_variables/currentuser.html">$currentuser</a>, <a class="var it11331" onMouseOver="hilite(11331)" onMouseOut="lolite()" onClick="logVariable('chatlastrow')" href="../../_variables/chatlastrow.html">$chatlastrow</a> = null) {
<a name="l705"><span class="linenum"> 705</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l706"><span class="linenum"> 706</span></a>  
<a name="l707"><span class="linenum"> 707</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = new stdClass();
<a name="l708"><span class="linenum"> 708</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('beep')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/beep.html">beep</a> = false;       <span class="comment">// By default.</span>
<a name="l709"><span class="linenum"> 709</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('refreshusers')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/refreshusers.html">refreshusers</a> = false; <span class="comment">// By default.</span>
<a name="l710"><span class="linenum"> 710</span></a>  
<a name="l711"><span class="linenum"> 711</span></a>  <span class="comment">    // Find the correct timezone for displaying this message.</span>
<a name="l712"><span class="linenum"> 712</span></a>      <a class="var it2632" onMouseOver="hilite(2632)" onMouseOut="lolite()" onClick="logVariable('tz')" href="../../_variables/tz.html">$tz</a> = <a class="class" onClick="logClass('core_date')" href="../../_classes/core_date.html" onMouseOver="classPopup(event,'core_date')">core_date</a>::<a class="function" onClick="logFunction('get_user_timezone')" href="../../_functions/get_user_timezone.html" onMouseOver="funcPopup(event,'get_user_timezone')">get_user_timezone</a>(<a class="var it12913" onMouseOver="hilite(12913)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../../_variables/currentuser.html">$currentuser</a>);
<a name="l713"><span class="linenum"> 713</span></a>  
<a name="l714"><span class="linenum"> 714</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a> = <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timestamp')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/timestamp.html">timestamp</a>, <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimemessage', 'chat'), <a class="var it2632" onMouseOver="hilite(2632)" onMouseOut="lolite()" onClick="logVariable('tz')" href="../../_variables/tz.html">$tz</a>);
<a name="l715"><span class="linenum"> 715</span></a>  
<a name="l716"><span class="linenum"> 716</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('picture')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>, array('size' =&gt; false, 'courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, 'link' =&gt; false));
<a name="l717"><span class="linenum"> 717</span></a>  
<a name="l718"><span class="linenum"> 718</span></a>      if (<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l719"><span class="linenum"> 719</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('picture')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a> = &quot;&lt;a onclick=\&quot;window.<a class="function" onClick="logFunction('open')" href="../../_functions/open.html" onMouseOver="funcPopup(event,'open')">open</a>('<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/user/view.php?id=<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('id')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&amp;amp;course=<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>')\&quot;&quot;.
<a name="l720"><span class="linenum"> 720</span></a>                              &quot; href=\&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/user/view.php?id=<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('id')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&amp;amp;course=<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>\&quot;&gt;<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('picture')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a>&lt;/a&gt;&quot;;
<a name="l721"><span class="linenum"> 721</span></a>      }
<a name="l722"><span class="linenum"> 722</span></a>  
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment">    // Calculate the row class.</span>
<a name="l724"><span class="linenum"> 724</span></a>      if (<a class="var it11331" onMouseOver="hilite(11331)" onMouseOut="lolite()" onClick="logVariable('chatlastrow')" href="../../_variables/chatlastrow.html">$chatlastrow</a> !== null) {
<a name="l725"><span class="linenum"> 725</span></a>          <a class="var it11448" onMouseOver="hilite(11448)" onMouseOut="lolite()" onClick="logVariable('rowclass')" href="../../_variables/rowclass.html">$rowclass</a> = ' class=&quot;r'.<a class="var it11331" onMouseOver="hilite(11331)" onMouseOut="lolite()" onClick="logVariable('chatlastrow')" href="../../_variables/chatlastrow.html">$chatlastrow</a>.'&quot; ';
<a name="l726"><span class="linenum"> 726</span></a>      } else {
<a name="l727"><span class="linenum"> 727</span></a>          <a class="var it11448" onMouseOver="hilite(11448)" onMouseOut="lolite()" onClick="logVariable('rowclass')" href="../../_variables/rowclass.html">$rowclass</a> = '';
<a name="l728"><span class="linenum"> 728</span></a>      }
<a name="l729"><span class="linenum"> 729</span></a>  
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment">    // Start processing the message.</span>
<a name="l731"><span class="linenum"> 731</span></a>  
<a name="l732"><span class="linenum"> 732</span></a>      if (!empty(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('system')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/system.html">system</a>)) {
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment">        // System event.</span>
<a name="l734"><span class="linenum"> 734</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('text')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/text.html">text</a> = <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a>.': '.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('message'.<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('message')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>, 'chat', <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>));
<a name="l735"><span class="linenum"> 735</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('html')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/html.html">html</a>  = '&lt;table class=&quot;chat-event&quot;&gt;&lt;tr'.<a class="var it11448" onMouseOver="hilite(11448)" onMouseOut="lolite()" onClick="logVariable('rowclass')" href="../../_variables/rowclass.html">$rowclass</a>.'&gt;&lt;td class=&quot;picture&quot;&gt;'.<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('picture')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a>.'&lt;/td&gt;';
<a name="l736"><span class="linenum"> 736</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('html')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/html.html">html</a> .= '&lt;td class=&quot;text&quot;&gt;&lt;span class=&quot;event&quot;&gt;'.<a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('text')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/text.html">text</a>.'&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';
<a name="l737"><span class="linenum"> 737</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('basic')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/basic.html">basic</a> = '&lt;tr class=&quot;r1&quot;&gt;
<a name="l738"><span class="linenum"> 738</span></a>                              &lt;th scope=&quot;row&quot; class=&quot;cell c1 title&quot;&gt;&lt;/th&gt;
<a name="l739"><span class="linenum"> 739</span></a>                              &lt;td class=&quot;cell c2 text&quot;&gt;' . <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('message'.<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('message')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>, 'chat', <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>)) . '&lt;/td&gt;
<a name="l740"><span class="linenum"> 740</span></a>                              &lt;td class=&quot;cell c3&quot;&gt;' . <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a> . '&lt;/td&gt;
<a name="l741"><span class="linenum"> 741</span></a>                            &lt;/tr&gt;';
<a name="l742"><span class="linenum"> 742</span></a>          if (<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('message')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/message.html">message</a> == 'exit' or <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('message')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/message.html">message</a> == 'enter') {
<a name="l743"><span class="linenum"> 743</span></a>              <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('refreshusers')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/refreshusers.html">refreshusers</a> = true; <span class="comment">// Force user panel refresh ASAP.</span>
<a name="l744"><span class="linenum"> 744</span></a>          }
<a name="l745"><span class="linenum"> 745</span></a>          return <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l746"><span class="linenum"> 746</span></a>      }
<a name="l747"><span class="linenum"> 747</span></a>  
<a name="l748"><span class="linenum"> 748</span></a>  <span class="comment">    // It's not a system event.</span>
<a name="l749"><span class="linenum"> 749</span></a>      <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('message')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>);
<a name="l750"><span class="linenum"> 750</span></a>  
<a name="l751"><span class="linenum"> 751</span></a>  <span class="comment">    // Parse the text to clean and filter it.</span>
<a name="l752"><span class="linenum"> 752</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = new stdClass();
<a name="l753"><span class="linenum"> 753</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('para')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../_variables/para.html">para</a> = false;
<a name="l754"><span class="linenum"> 754</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('blanktarget')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../_variables/blanktarget.html">blanktarget</a> = true;
<a name="l755"><span class="linenum"> 755</span></a>      <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> = <a class="function" onClick="logFunction('format_text')" href="../../_functions/format_text.html" onMouseOver="funcPopup(event,'format_text')">format_text</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, <a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l756"><span class="linenum"> 756</span></a>  
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment">    // And now check for special cases.</span>
<a name="l758"><span class="linenum"> 758</span></a>      <a class="var it12918" onMouseOver="hilite(12918)" onMouseOut="lolite()" onClick="logVariable('patternto')" href="../../_variables/patternto.html">$patternto</a> = '#^\s*To\<a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>([^:]+):(.*)#';
<a name="l759"><span class="linenum"> 759</span></a>      <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = false;
<a name="l760"><span class="linenum"> 760</span></a>  
<a name="l761"><span class="linenum"> 761</span></a>      if (<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, 0, 5) == 'beep ') {
<a name="l762"><span class="linenum"> 762</span></a>  <span class="comment">        // It's a beep!</span>
<a name="l763"><span class="linenum"> 763</span></a>          <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = true;
<a name="l764"><span class="linenum"> 764</span></a>          <a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, 5));
<a name="l765"><span class="linenum"> 765</span></a>  
<a name="l766"><span class="linenum"> 766</span></a>          if (<a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a> == 'all') {   // Everyone.
<a name="l767"><span class="linenum"> 767</span></a>              <a class="var it12920" onMouseOver="hilite(12920)" onMouseOut="lolite()" onClick="logVariable('outinfobasic')" href="../../_variables/outinfobasic.html">$outinfobasic</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('messagebeepseveryone', 'chat', <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>));
<a name="l768"><span class="linenum"> 768</span></a>              <a class="var it12921" onMouseOver="hilite(12921)" onMouseOut="lolite()" onClick="logVariable('outinfo')" href="../../_variables/outinfo.html">$outinfo</a> = <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a> . ': ' . <a class="var it12920" onMouseOver="hilite(12920)" onMouseOut="lolite()" onClick="logVariable('outinfobasic')" href="../../_variables/outinfobasic.html">$outinfobasic</a>;
<a name="l769"><span class="linenum"> 769</span></a>              <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = '';
<a name="l770"><span class="linenum"> 770</span></a>  
<a name="l771"><span class="linenum"> 771</span></a>              <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('beep')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/beep.html">beep</a> = true;  <span class="comment">// Eventually this should be set to a filename uploaded by the user.</span>
<a name="l772"><span class="linenum"> 772</span></a>  
<a name="l773"><span class="linenum"> 773</span></a>          } else if (<a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a> == <a class="var it12913" onMouseOver="hilite(12913)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../../_variables/currentuser.html">$currentuser</a>-&gt;<a onClick="logVariable('id')" class="var it43403" onMouseOver="hilite(43403)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {  // Current user.
<a name="l774"><span class="linenum"> 774</span></a>              <a class="var it12920" onMouseOver="hilite(12920)" onMouseOut="lolite()" onClick="logVariable('outinfobasic')" href="../../_variables/outinfobasic.html">$outinfobasic</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('messagebeepsyou', 'chat', <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>));
<a name="l775"><span class="linenum"> 775</span></a>              <a class="var it12921" onMouseOver="hilite(12921)" onMouseOut="lolite()" onClick="logVariable('outinfo')" href="../../_variables/outinfo.html">$outinfo</a> = <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a> . ': ' . <a class="var it12920" onMouseOver="hilite(12920)" onMouseOut="lolite()" onClick="logVariable('outinfobasic')" href="../../_variables/outinfobasic.html">$outinfobasic</a>;
<a name="l776"><span class="linenum"> 776</span></a>              <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = '';
<a name="l777"><span class="linenum"> 777</span></a>              <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('beep')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/beep.html">beep</a> = true;
<a name="l778"><span class="linenum"> 778</span></a>  
<a name="l779"><span class="linenum"> 779</span></a>          } else {  // Something is not caught?
<a name="l780"><span class="linenum"> 780</span></a>              return false;
<a name="l781"><span class="linenum"> 781</span></a>          }
<a name="l782"><span class="linenum"> 782</span></a>      } else if (<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, 0, 1) == '/') {     // It's a user command.
<a name="l783"><span class="linenum"> 783</span></a>          <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = true;
<a name="l784"><span class="linenum"> 784</span></a>          <a class="var it1833" onMouseOver="hilite(1833)" onMouseOut="lolite()" onClick="logVariable('pattern')" href="../../_variables/pattern.html">$pattern</a> = '#(^\/)(\w+).*#';
<a name="l785"><span class="linenum"> 785</span></a>          <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(<a class="var it1833" onMouseOver="hilite(1833)" onMouseOut="lolite()" onClick="logVariable('pattern')" href="../../_variables/pattern.html">$pattern</a>, <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l786"><span class="linenum"> 786</span></a>          <a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a> = isset(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2]) ? <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2] : false;
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment">        // Support some IRC commands.</span>
<a name="l788"><span class="linenum"> 788</span></a>          switch (<a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a>) {
<a name="l789"><span class="linenum"> 789</span></a>              case 'me':
<a name="l790"><span class="linenum"> 790</span></a>                  <a class="var it12921" onMouseOver="hilite(12921)" onMouseOut="lolite()" onClick="logVariable('outinfo')" href="../../_variables/outinfo.html">$outinfo</a> = <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a>;
<a name="l791"><span class="linenum"> 791</span></a>                  <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = '*** &lt;b&gt;'.<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('firstname')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a>.' '.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, 4).'&lt;/b&gt;';
<a name="l792"><span class="linenum"> 792</span></a>                  break;
<a name="l793"><span class="linenum"> 793</span></a>              default:
<a name="l794"><span class="linenum"> 794</span></a>  <span class="comment">                // Error, we set special back to false to use the classic message output.</span>
<a name="l795"><span class="linenum"> 795</span></a>                  <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = false;
<a name="l796"><span class="linenum"> 796</span></a>                  break;
<a name="l797"><span class="linenum"> 797</span></a>          }
<a name="l798"><span class="linenum"> 798</span></a>      } else if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(<a class="var it12918" onMouseOver="hilite(12918)" onMouseOut="lolite()" onClick="logVariable('patternto')" href="../../_variables/patternto.html">$patternto</a>, <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>)) {
<a name="l799"><span class="linenum"> 799</span></a>          <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = true;
<a name="l800"><span class="linenum"> 800</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l801"><span class="linenum"> 801</span></a>          <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(<a class="var it12918" onMouseOver="hilite(12918)" onMouseOut="lolite()" onClick="logVariable('patternto')" href="../../_variables/patternto.html">$patternto</a>, <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l802"><span class="linenum"> 802</span></a>          if (isset(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]) &amp;&amp; isset(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2])) {
<a name="l803"><span class="linenum"> 803</span></a>              <a class="var it12921" onMouseOver="hilite(12921)" onMouseOut="lolite()" onClick="logVariable('outinfo')" href="../../_variables/outinfo.html">$outinfo</a> = <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a>;
<a name="l804"><span class="linenum"> 804</span></a>              <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = <a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('firstname')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a>.' '.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('saidto', 'chat').' &lt;i&gt;'.<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1].'&lt;/i&gt;: '.<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2];
<a name="l805"><span class="linenum"> 805</span></a>          } else {
<a name="l806"><span class="linenum"> 806</span></a>  <span class="comment">            // Error, we set special back to false to use the classic message output.</span>
<a name="l807"><span class="linenum"> 807</span></a>              <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = false;
<a name="l808"><span class="linenum"> 808</span></a>          }
<a name="l809"><span class="linenum"> 809</span></a>      }
<a name="l810"><span class="linenum"> 810</span></a>  
<a name="l811"><span class="linenum"> 811</span></a>      if (!<a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a>) {
<a name="l812"><span class="linenum"> 812</span></a>          <a class="var it12921" onMouseOver="hilite(12921)" onMouseOut="lolite()" onClick="logVariable('outinfo')" href="../../_variables/outinfo.html">$outinfo</a> = <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a>.' '.<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('firstname')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a>;
<a name="l813"><span class="linenum"> 813</span></a>          <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>;
<a name="l814"><span class="linenum"> 814</span></a>      }
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>  <span class="comment">    // Format the message as a small table.</span>
<a name="l817"><span class="linenum"> 817</span></a>  
<a name="l818"><span class="linenum"> 818</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('text')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/text.html">text</a>  = <a class="phpfunction" onClick="logFunction('strip_tags')" href="../../_functions/strip_tags.html" onMouseOver="phpfuncPopup(event,'strip_tags')">strip_tags</a>(<a class="var it12921" onMouseOver="hilite(12921)" onMouseOut="lolite()" onClick="logVariable('outinfo')" href="../../_variables/outinfo.html">$outinfo</a>.': '.<a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a>);
<a name="l819"><span class="linenum"> 819</span></a>  
<a name="l820"><span class="linenum"> 820</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('html')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/html.html">html</a>  = &quot;&lt;table class=\&quot;chat-message\&quot;&gt;&lt;tr<a class="var it11448" onMouseOver="hilite(11448)" onMouseOut="lolite()" onClick="logVariable('rowclass')" href="../../_variables/rowclass.html">$rowclass</a>&gt;&lt;td class=\&quot;picture\&quot; valign=\&quot;top\&quot;&gt;<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('picture')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a>&lt;/td&gt;&quot;;
<a name="l821"><span class="linenum"> 821</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('html')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/html.html">html</a> .= &quot;&lt;td class=\&quot;text\&quot;&gt;&lt;span class=\&quot;title\&quot;&gt;<a class="var it12921" onMouseOver="hilite(12921)" onMouseOut="lolite()" onClick="logVariable('outinfo')" href="../../_variables/outinfo.html">$outinfo</a>&lt;/span&gt;&quot;;
<a name="l822"><span class="linenum"> 822</span></a>      if (<a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a>) {
<a name="l823"><span class="linenum"> 823</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('html')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/html.html">html</a> .= &quot;: <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a>&quot;;
<a name="l824"><span class="linenum"> 824</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('basic')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/basic.html">basic</a> = '&lt;tr class=&quot;r0&quot;&gt;
<a name="l825"><span class="linenum"> 825</span></a>                              &lt;th scope=&quot;row&quot; class=&quot;cell c1 title&quot;&gt;' . <a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('firstname')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a> . '&lt;/th&gt;
<a name="l826"><span class="linenum"> 826</span></a>                              &lt;td class=&quot;cell c2 text&quot;&gt;' . <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> . '&lt;/td&gt;
<a name="l827"><span class="linenum"> 827</span></a>                              &lt;td class=&quot;cell c3&quot;&gt;' . <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a> . '&lt;/td&gt;
<a name="l828"><span class="linenum"> 828</span></a>                            &lt;/tr&gt;';
<a name="l829"><span class="linenum"> 829</span></a>      } else {
<a name="l830"><span class="linenum"> 830</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('basic')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/basic.html">basic</a> = '&lt;tr class=&quot;r1&quot;&gt;
<a name="l831"><span class="linenum"> 831</span></a>                              &lt;th scope=&quot;row&quot; class=&quot;cell c1 title&quot;&gt;&lt;/th&gt;
<a name="l832"><span class="linenum"> 832</span></a>                              &lt;td class=&quot;cell c2 text&quot;&gt;' . <a class="var it12920" onMouseOver="hilite(12920)" onMouseOut="lolite()" onClick="logVariable('outinfobasic')" href="../../_variables/outinfobasic.html">$outinfobasic</a> . '&lt;/td&gt;
<a name="l833"><span class="linenum"> 833</span></a>                              &lt;td class=&quot;cell c3&quot;&gt;' . <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a> . '&lt;/td&gt;
<a name="l834"><span class="linenum"> 834</span></a>                            &lt;/tr&gt;';
<a name="l835"><span class="linenum"> 835</span></a>      }
<a name="l836"><span class="linenum"> 836</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a onClick="logVariable('html')" class="var it43995" onMouseOver="hilite(43995)" onMouseOut="lolite()" href="../../_variables/html.html">html</a> .= &quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;;
<a name="l837"><span class="linenum"> 837</span></a>      return <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l838"><span class="linenum"> 838</span></a>  }
<a name="l839"><span class="linenum"> 839</span></a>  
<a name="l840"><span class="linenum"> 840</span></a>  <span class="comment">/**</span>
<a name="l841"><span class="linenum"> 841</span></a>  <span class="comment"> * Given a message object this function formats it appropriately into text and html then returns the formatted data</span>
<a name="l842"><span class="linenum"> 842</span></a>  <span class="comment"> * @global object</span>
<a name="l843"><span class="linenum"> 843</span></a>  <span class="comment"> * @param object $message</span>
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment"> * @param object $currentuser</span>
<a name="l846"><span class="linenum"> 846</span></a>  <span class="comment"> * @param string $chatlastrow</span>
<a name="l847"><span class="linenum"> 847</span></a>  <span class="comment"> * @return bool|string Returns HTML or false</span>
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment"> */</span>
<a name="l849"><span class="linenum"> 849</span></a>  function <a class="function" onClick="logFunction('chat_format_message')" href="../../_functions/chat_format_message.html" onMouseOver="funcPopup(event,'chat_format_message')">chat_format_message</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it12913" onMouseOver="hilite(12913)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../../_variables/currentuser.html">$currentuser</a>, <a class="var it11331" onMouseOver="hilite(11331)" onMouseOut="lolite()" onClick="logVariable('chatlastrow')" href="../../_variables/chatlastrow.html">$chatlastrow</a>=null) {
<a name="l850"><span class="linenum"> 850</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l851"><span class="linenum"> 851</span></a>  
<a name="l852"><span class="linenum"> 852</span></a>      static <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>;     <span class="comment">// Cache user lookups.</span>
<a name="l853"><span class="linenum"> 853</span></a>  
<a name="l854"><span class="linenum"> 854</span></a>      if (isset(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>])) {
<a name="l855"><span class="linenum"> 855</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>];
<a name="l856"><span class="linenum"> 856</span></a>      } else if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>), <a class="class" onClick="logClass('user_picture')" href="../../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>())) {
<a name="l857"><span class="linenum"> 857</span></a>          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>;
<a name="l858"><span class="linenum"> 858</span></a>      } else {
<a name="l859"><span class="linenum"> 859</span></a>          return null;
<a name="l860"><span class="linenum"> 860</span></a>      }
<a name="l861"><span class="linenum"> 861</span></a>      return <a class="function" onClick="logFunction('chat_format_message_manually')" href="../../_functions/chat_format_message_manually.html" onMouseOver="funcPopup(event,'chat_format_message_manually')">chat_format_message_manually</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it12913" onMouseOver="hilite(12913)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../../_variables/currentuser.html">$currentuser</a>, <a class="var it11331" onMouseOver="hilite(11331)" onMouseOut="lolite()" onClick="logVariable('chatlastrow')" href="../../_variables/chatlastrow.html">$chatlastrow</a>);
<a name="l862"><span class="linenum"> 862</span></a>  }
<a name="l863"><span class="linenum"> 863</span></a>  
<a name="l864"><span class="linenum"> 864</span></a>  <span class="comment">/**</span>
<a name="l865"><span class="linenum"> 865</span></a>  <span class="comment"> * @global object</span>
<a name="l866"><span class="linenum"> 866</span></a>  <span class="comment"> * @param object $message message to be displayed.</span>
<a name="l867"><span class="linenum"> 867</span></a>  <span class="comment"> * @param mixed $chatuser user chat data</span>
<a name="l868"><span class="linenum"> 868</span></a>  <span class="comment"> * @param object $currentuser current user for whom the message should be displayed.</span>
<a name="l869"><span class="linenum"> 869</span></a>  <span class="comment"> * @param int $groupingid course module grouping id</span>
<a name="l870"><span class="linenum"> 870</span></a>  <span class="comment"> * @param string $theme name of the chat theme.</span>
<a name="l871"><span class="linenum"> 871</span></a>  <span class="comment"> * @return bool|string Returns HTML or false</span>
<a name="l872"><span class="linenum"> 872</span></a>  <span class="comment"> */</span>
<a name="l873"><span class="linenum"> 873</span></a>  function <a class="function" onClick="logFunction('chat_format_message_theme')" href="../../_functions/chat_format_message_theme.html" onMouseOver="funcPopup(event,'chat_format_message_theme')">chat_format_message_theme</a> (<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>, <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>, <a class="var it12913" onMouseOver="hilite(12913)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../../_variables/currentuser.html">$currentuser</a>, <a class="var it680" onMouseOver="hilite(680)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>, <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('theme')" href="../../_variables/theme.html">$theme</a> = 'bubble') {
<a name="l874"><span class="linenum"> 874</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>;
<a name="l875"><span class="linenum"> 875</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../mod/chat/locallib.php.html">/mod/chat/locallib.php</a>');
<a name="l876"><span class="linenum"> 876</span></a>  
<a name="l877"><span class="linenum"> 877</span></a>      static <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>;     <span class="comment">// Cache user lookups.</span>
<a name="l878"><span class="linenum"> 878</span></a>  
<a name="l879"><span class="linenum"> 879</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = new stdClass();
<a name="l880"><span class="linenum"> 880</span></a>  
<a name="l881"><span class="linenum"> 881</span></a>      if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '/mod/chat/gui_ajax/theme/'.<a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('theme')" href="../../_variables/theme.html">$theme</a>.'/config.php')) {
<a name="l882"><span class="linenum"> 882</span></a>          include(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '/mod/chat/gui_ajax/theme/'.<a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('theme')" href="../../_variables/theme.html">$theme</a>.'/config.php');
<a name="l883"><span class="linenum"> 883</span></a>      }
<a name="l884"><span class="linenum"> 884</span></a>  
<a name="l885"><span class="linenum"> 885</span></a>      if (isset(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>])) {
<a name="l886"><span class="linenum"> 886</span></a>          <a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a> = <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>];
<a name="l887"><span class="linenum"> 887</span></a>      } else if (<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>), <a class="class" onClick="logClass('user_picture')" href="../../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>())) {
<a name="l888"><span class="linenum"> 888</span></a>          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userid')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>] = <a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>;
<a name="l889"><span class="linenum"> 889</span></a>      } else {
<a name="l890"><span class="linenum"> 890</span></a>          return null;
<a name="l891"><span class="linenum"> 891</span></a>      }
<a name="l892"><span class="linenum"> 892</span></a>  
<a name="l893"><span class="linenum"> 893</span></a>  <span class="comment">    // Find the correct timezone for displaying this message.</span>
<a name="l894"><span class="linenum"> 894</span></a>      <a class="var it2632" onMouseOver="hilite(2632)" onMouseOut="lolite()" onClick="logVariable('tz')" href="../../_variables/tz.html">$tz</a> = <a class="class" onClick="logClass('core_date')" href="../../_classes/core_date.html" onMouseOver="classPopup(event,'core_date')">core_date</a>::<a class="function" onClick="logFunction('get_user_timezone')" href="../../_functions/get_user_timezone.html" onMouseOver="funcPopup(event,'get_user_timezone')">get_user_timezone</a>(<a class="var it12913" onMouseOver="hilite(12913)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../../_variables/currentuser.html">$currentuser</a>);
<a name="l895"><span class="linenum"> 895</span></a>  
<a name="l896"><span class="linenum"> 896</span></a>      if (empty(<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('course')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)) {
<a name="l897"><span class="linenum"> 897</span></a>          <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('id')" class="var it43316" onMouseOver="hilite(43316)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l898"><span class="linenum"> 898</span></a>      } else {
<a name="l899"><span class="linenum"> 899</span></a>          <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('course')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>;
<a name="l900"><span class="linenum"> 900</span></a>      }
<a name="l901"><span class="linenum"> 901</span></a>  
<a name="l902"><span class="linenum"> 902</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a> = <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timestamp')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/timestamp.html">timestamp</a>, <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimemessage', 'chat'), <a class="var it2632" onMouseOver="hilite(2632)" onMouseOut="lolite()" onClick="logVariable('tz')" href="../../_variables/tz.html">$tz</a>);
<a name="l903"><span class="linenum"> 903</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('picture')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>, array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>));
<a name="l904"><span class="linenum"> 904</span></a>  
<a name="l905"><span class="linenum"> 905</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('picture')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a> = &quot;&lt;a target='_blank'&quot;.
<a name="l906"><span class="linenum"> 906</span></a>                          &quot; href=\&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/user/view.php?id=<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('id')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&amp;amp;course=<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>\&quot;&gt;<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('picture')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a>&lt;/a&gt;&quot;;
<a name="l907"><span class="linenum"> 907</span></a>  
<a name="l908"><span class="linenum"> 908</span></a>  <span class="comment">    // Start processing the message.</span>
<a name="l909"><span class="linenum"> 909</span></a>      if (!empty(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('system')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/system.html">system</a>)) {
<a name="l910"><span class="linenum"> 910</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('type')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> = 'system';
<a name="l911"><span class="linenum"> 911</span></a>  
<a name="l912"><span class="linenum"> 912</span></a>          <a class="var it3372" onMouseOver="hilite(3372)" onMouseOut="lolite()" onClick="logVariable('senderprofile')" href="../../_variables/senderprofile.html">$senderprofile</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/user/view.php?id='.<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('id')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'&amp;amp;course='.<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l913"><span class="linenum"> 913</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('message'.<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('message')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>, 'chat', <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>));
<a name="l914"><span class="linenum"> 914</span></a>          <a class="var it12923" onMouseOver="hilite(12923)" onMouseOut="lolite()" onClick="logVariable('eventmessage')" href="../../_variables/eventmessage.html">$eventmessage</a> = <span class="keyword">new </span><a class="class" onClick="logClass('event_message')" href="../../_classes/event_message.html" onMouseOver="classPopup(event,'event_message')">event_message</a>(<a class="var it3372" onMouseOver="hilite(3372)" onMouseOut="lolite()" onClick="logVariable('senderprofile')" href="../../_variables/senderprofile.html">$senderprofile</a>, <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>), <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a>, <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>, <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('theme')" href="../../_variables/theme.html">$theme</a>);
<a name="l915"><span class="linenum"> 915</span></a>  
<a name="l916"><span class="linenum"> 916</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('mod_chat');
<a name="l917"><span class="linenum"> 917</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('html')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/html.html">html</a> = <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it12923" onMouseOver="hilite(12923)" onMouseOut="lolite()" onClick="logVariable('eventmessage')" href="../../_variables/eventmessage.html">$eventmessage</a>);
<a name="l918"><span class="linenum"> 918</span></a>  
<a name="l919"><span class="linenum"> 919</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l920"><span class="linenum"> 920</span></a>      }
<a name="l921"><span class="linenum"> 921</span></a>  
<a name="l922"><span class="linenum"> 922</span></a>  <span class="comment">    // It's not a system event.</span>
<a name="l923"><span class="linenum"> 923</span></a>      <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('message')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>);
<a name="l924"><span class="linenum"> 924</span></a>  
<a name="l925"><span class="linenum"> 925</span></a>  <span class="comment">    // Parse the text to clean and filter it.</span>
<a name="l926"><span class="linenum"> 926</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = new stdClass();
<a name="l927"><span class="linenum"> 927</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('para')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../_variables/para.html">para</a> = false;
<a name="l928"><span class="linenum"> 928</span></a>      <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('blanktarget')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../_variables/blanktarget.html">blanktarget</a> = true;
<a name="l929"><span class="linenum"> 929</span></a>      <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> = <a class="function" onClick="logFunction('format_text')" href="../../_functions/format_text.html" onMouseOver="funcPopup(event,'format_text')">format_text</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, <a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l930"><span class="linenum"> 930</span></a>  
<a name="l931"><span class="linenum"> 931</span></a>  <span class="comment">    // And now check for special cases.</span>
<a name="l932"><span class="linenum"> 932</span></a>      <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = false;
<a name="l933"><span class="linenum"> 933</span></a>      <a class="var it12924" onMouseOver="hilite(12924)" onMouseOut="lolite()" onClick="logVariable('outtime')" href="../../_variables/outtime.html">$outtime</a> = <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('strtime')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/strtime.html">strtime</a>;
<a name="l934"><span class="linenum"> 934</span></a>  
<a name="l935"><span class="linenum"> 935</span></a>  <span class="comment">    // Initialise variables.</span>
<a name="l936"><span class="linenum"> 936</span></a>      <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = '';
<a name="l937"><span class="linenum"> 937</span></a>      <a class="var it12918" onMouseOver="hilite(12918)" onMouseOut="lolite()" onClick="logVariable('patternto')" href="../../_variables/patternto.html">$patternto</a> = '#^\s*To\<a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>([^:]+):(.*)#';
<a name="l938"><span class="linenum"> 938</span></a>  
<a name="l939"><span class="linenum"> 939</span></a>      if (<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, 0, 5) == 'beep ') {
<a name="l940"><span class="linenum"> 940</span></a>          <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = true;
<a name="l941"><span class="linenum"> 941</span></a>  <span class="comment">        // It's a beep!</span>
<a name="l942"><span class="linenum"> 942</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('type')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> = 'beep';
<a name="l943"><span class="linenum"> 943</span></a>          <a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, 5));
<a name="l944"><span class="linenum"> 944</span></a>  
<a name="l945"><span class="linenum"> 945</span></a>          if (<a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a> == 'all') {   // Everyone.
<a name="l946"><span class="linenum"> 946</span></a>              <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('messagebeepseveryone', 'chat', <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>));
<a name="l947"><span class="linenum"> 947</span></a>          } else if (<a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a> == <a class="var it12913" onMouseOver="hilite(12913)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../../_variables/currentuser.html">$currentuser</a>-&gt;<a onClick="logVariable('id')" class="var it43403" onMouseOver="hilite(43403)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {  // Current user.
<a name="l948"><span class="linenum"> 948</span></a>              <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('messagebeepsyou', 'chat', <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>));
<a name="l949"><span class="linenum"> 949</span></a>          } else if (<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('id')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it12913" onMouseOver="hilite(12913)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../../_variables/currentuser.html">$currentuser</a>-&gt;<a onClick="logVariable('id')" class="var it43403" onMouseOver="hilite(43403)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {  // Something is not caught?
<a name="l950"><span class="linenum"> 950</span></a>  <span class="comment">            // Allow beep for a active chat user only, else user can beep anyone and get fullname.</span>
<a name="l951"><span class="linenum"> 951</span></a>              if (!empty(<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a>)) {
<a name="l952"><span class="linenum"> 952</span></a>                  <a class="var it5675" onMouseOver="hilite(5675)" onMouseOut="lolite()" onClick="logVariable('chatusers')" href="../../_variables/chatusers.html">$chatusers</a> = <a class="function" onClick="logFunction('chat_get_users')" href="../../_functions/chat_get_users.html" onMouseOver="funcPopup(event,'chat_get_users')">chat_get_users</a>(<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('chatid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/chatid.html">chatid</a>, <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('groupid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>, <a class="var it680" onMouseOver="hilite(680)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>);
<a name="l953"><span class="linenum"> 953</span></a>                  if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a>, <a class="var it5675" onMouseOver="hilite(5675)" onMouseOut="lolite()" onClick="logVariable('chatusers')" href="../../_variables/chatusers.html">$chatusers</a>)) {
<a name="l954"><span class="linenum"> 954</span></a>                      <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('messageyoubeep', 'chat', <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it5675" onMouseOver="hilite(5675)" onMouseOut="lolite()" onClick="logVariable('chatusers')" href="../../_variables/chatusers.html">$chatusers</a>[<a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a>]));
<a name="l955"><span class="linenum"> 955</span></a>                  } else {
<a name="l956"><span class="linenum"> 956</span></a>                      <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('messageyoubeep', 'chat', <a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a>);
<a name="l957"><span class="linenum"> 957</span></a>                  }
<a name="l958"><span class="linenum"> 958</span></a>              } else {
<a name="l959"><span class="linenum"> 959</span></a>                  <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('messageyoubeep', 'chat', <a class="var it12919" onMouseOver="hilite(12919)" onMouseOut="lolite()" onClick="logVariable('beepwho')" href="../../_variables/beepwho.html">$beepwho</a>);
<a name="l960"><span class="linenum"> 960</span></a>              }
<a name="l961"><span class="linenum"> 961</span></a>          }
<a name="l962"><span class="linenum"> 962</span></a>      } else if (<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, 0, 1) == '/') {     // It's a user command.
<a name="l963"><span class="linenum"> 963</span></a>          <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = true;
<a name="l964"><span class="linenum"> 964</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('type')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> = 'command';
<a name="l965"><span class="linenum"> 965</span></a>          <a class="var it1833" onMouseOver="hilite(1833)" onMouseOut="lolite()" onClick="logVariable('pattern')" href="../../_variables/pattern.html">$pattern</a> = '#(^\/)(\w+).*#';
<a name="l966"><span class="linenum"> 966</span></a>          <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(<a class="var it1833" onMouseOver="hilite(1833)" onMouseOut="lolite()" onClick="logVariable('pattern')" href="../../_variables/pattern.html">$pattern</a>, <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l967"><span class="linenum"> 967</span></a>          <a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a> = isset(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2]) ? <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2] : false;
<a name="l968"><span class="linenum"> 968</span></a>  <span class="comment">        // Support some IRC commands.</span>
<a name="l969"><span class="linenum"> 969</span></a>          switch (<a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a>) {
<a name="l970"><span class="linenum"> 970</span></a>              case 'me':
<a name="l971"><span class="linenum"> 971</span></a>                  <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = '*** &lt;b&gt;'.<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('firstname')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a>.' '.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, 4).'&lt;/b&gt;';
<a name="l972"><span class="linenum"> 972</span></a>                  break;
<a name="l973"><span class="linenum"> 973</span></a>              default:
<a name="l974"><span class="linenum"> 974</span></a>  <span class="comment">                // Error, we set special back to false to use the classic message output.</span>
<a name="l975"><span class="linenum"> 975</span></a>                  <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = false;
<a name="l976"><span class="linenum"> 976</span></a>                  break;
<a name="l977"><span class="linenum"> 977</span></a>          }
<a name="l978"><span class="linenum"> 978</span></a>      } else if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(<a class="var it12918" onMouseOver="hilite(12918)" onMouseOut="lolite()" onClick="logVariable('patternto')" href="../../_variables/patternto.html">$patternto</a>, <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>)) {
<a name="l979"><span class="linenum"> 979</span></a>          <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = true;
<a name="l980"><span class="linenum"> 980</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('type')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> = 'dialogue';
<a name="l981"><span class="linenum"> 981</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l982"><span class="linenum"> 982</span></a>          <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(<a class="var it12918" onMouseOver="hilite(12918)" onMouseOut="lolite()" onClick="logVariable('patternto')" href="../../_variables/patternto.html">$patternto</a>, <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l983"><span class="linenum"> 983</span></a>          if (isset(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]) &amp;&amp; isset(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2])) {
<a name="l984"><span class="linenum"> 984</span></a>              <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = <a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('firstname')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a>.' &lt;b&gt;'.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('saidto', 'chat').'&lt;/b&gt; &lt;i&gt;'.<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1].'&lt;/i&gt;: '.<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2];
<a name="l985"><span class="linenum"> 985</span></a>          } else {
<a name="l986"><span class="linenum"> 986</span></a>  <span class="comment">            // Error, we set special back to false to use the classic message output.</span>
<a name="l987"><span class="linenum"> 987</span></a>              <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a> = false;
<a name="l988"><span class="linenum"> 988</span></a>          }
<a name="l989"><span class="linenum"> 989</span></a>      }
<a name="l990"><span class="linenum"> 990</span></a>  
<a name="l991"><span class="linenum"> 991</span></a>      if (!<a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a>) {
<a name="l992"><span class="linenum"> 992</span></a>          <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a> = <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>;
<a name="l993"><span class="linenum"> 993</span></a>      }
<a name="l994"><span class="linenum"> 994</span></a>  
<a name="l995"><span class="linenum"> 995</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('text')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/text.html">text</a> = <a class="phpfunction" onClick="logFunction('strip_tags')" href="../../_functions/strip_tags.html" onMouseOver="phpfuncPopup(event,'strip_tags')">strip_tags</a>(<a class="var it12924" onMouseOver="hilite(12924)" onMouseOut="lolite()" onClick="logVariable('outtime')" href="../../_variables/outtime.html">$outtime</a>.': '.<a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a>);
<a name="l996"><span class="linenum"> 996</span></a>  
<a name="l997"><span class="linenum"> 997</span></a>      <a class="var it3375" onMouseOver="hilite(3375)" onMouseOut="lolite()" onClick="logVariable('mymessageclass')" href="../../_variables/mymessageclass.html">$mymessageclass</a> = '';
<a name="l998"><span class="linenum"> 998</span></a>      if (<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('id')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> == <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l999"><span class="linenum"> 999</span></a>          <a class="var it3375" onMouseOver="hilite(3375)" onMouseOut="lolite()" onClick="logVariable('mymessageclass')" href="../../_variables/mymessageclass.html">$mymessageclass</a> = 'chat-message-mymessage';
<a name="l1000"><span class="linenum">1000</span></a>      }
<a name="l1001"><span class="linenum">1001</span></a>  
<a name="l1002"><span class="linenum">1002</span></a>      <a class="var it3372" onMouseOver="hilite(3372)" onMouseOut="lolite()" onClick="logVariable('senderprofile')" href="../../_variables/senderprofile.html">$senderprofile</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/user/view.php?id='.<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>-&gt;<a onClick="logVariable('id')" class="var it44107" onMouseOver="hilite(44107)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'&amp;amp;course='.<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l1003"><span class="linenum">1003</span></a>      <a class="var it12925" onMouseOver="hilite(12925)" onMouseOut="lolite()" onClick="logVariable('usermessage')" href="../../_variables/usermessage.html">$usermessage</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_message')" href="../../_classes/user_message.html" onMouseOver="classPopup(event,'user_message')">user_message</a>(<a class="var it3372" onMouseOver="hilite(3372)" onMouseOut="lolite()" onClick="logVariable('senderprofile')" href="../../_variables/senderprofile.html">$senderprofile</a>, <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it12912" onMouseOver="hilite(12912)" onMouseOut="lolite()" onClick="logVariable('sender')" href="../../_variables/sender.html">$sender</a>), <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('picture')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../../_variables/picture.html">picture</a>,
<a name="l1004"><span class="linenum">1004</span></a>                                      <a class="var it3375" onMouseOver="hilite(3375)" onMouseOut="lolite()" onClick="logVariable('mymessageclass')" href="../../_variables/mymessageclass.html">$mymessageclass</a>, <a class="var it12924" onMouseOver="hilite(12924)" onMouseOut="lolite()" onClick="logVariable('outtime')" href="../../_variables/outtime.html">$outtime</a>, <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a>, <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('theme')" href="../../_variables/theme.html">$theme</a>);
<a name="l1005"><span class="linenum">1005</span></a>  
<a name="l1006"><span class="linenum">1006</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('mod_chat');
<a name="l1007"><span class="linenum">1007</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('html')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../_variables/html.html">html</a> = <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>-&gt;<a class="function" onClick="logFunction('render')" href="../../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it12925" onMouseOver="hilite(12925)" onMouseOut="lolite()" onClick="logVariable('usermessage')" href="../../_variables/usermessage.html">$usermessage</a>);
<a name="l1008"><span class="linenum">1008</span></a>  
<a name="l1009"><span class="linenum">1009</span></a>  <span class="comment">    // When user beeps other user, then don't show any timestamp to other users in chat.</span>
<a name="l1010"><span class="linenum">1010</span></a>      if (('' === <a class="var it12922" onMouseOver="hilite(12922)" onMouseOut="lolite()" onClick="logVariable('outmain')" href="../../_variables/outmain.html">$outmain</a>) &amp;&amp; <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('special')" href="../../_variables/special.html">$special</a>) {
<a name="l1011"><span class="linenum">1011</span></a>          return false;
<a name="l1012"><span class="linenum">1012</span></a>      } else {
<a name="l1013"><span class="linenum">1013</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1014"><span class="linenum">1014</span></a>      }
<a name="l1015"><span class="linenum">1015</span></a>  }
<a name="l1016"><span class="linenum">1016</span></a>  
<a name="l1017"><span class="linenum">1017</span></a>  <span class="comment">/**</span>
<a name="l1018"><span class="linenum">1018</span></a>  <span class="comment"> * @global object $DB</span>
<a name="l1019"><span class="linenum">1019</span></a>  <span class="comment"> * @global object $CFG</span>
<a name="l1020"><span class="linenum">1020</span></a>  <span class="comment"> * @global object $COURSE</span>
<a name="l1021"><span class="linenum">1021</span></a>  <span class="comment"> * @global object $OUTPUT</span>
<a name="l1022"><span class="linenum">1022</span></a>  <span class="comment"> * @param object $users</span>
<a name="l1023"><span class="linenum">1023</span></a>  <span class="comment"> * @param object $course</span>
<a name="l1024"><span class="linenum">1024</span></a>  <span class="comment"> * @return array return formatted user list</span>
<a name="l1025"><span class="linenum">1025</span></a>  <span class="comment"> */</span>
<a name="l1026"><span class="linenum">1026</span></a>  function <a class="function" onClick="logFunction('chat_format_userlist')" href="../../_functions/chat_format_userlist.html" onMouseOver="funcPopup(event,'chat_format_userlist')">chat_format_userlist</a>(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l1027"><span class="linenum">1027</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l1028"><span class="linenum">1028</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l1029"><span class="linenum">1029</span></a>      foreach (<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> as <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l1030"><span class="linenum">1030</span></a>          <a class="var it749" onMouseOver="hilite(749)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a> = array();
<a name="l1031"><span class="linenum">1031</span></a>          <a class="var it749" onMouseOver="hilite(749)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>['name'] = <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l1032"><span class="linenum">1032</span></a>          <a class="var it749" onMouseOver="hilite(749)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>['url'] = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/user/view.php?id='.<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'&amp;amp;course='.<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1033"><span class="linenum">1033</span></a>          <a class="var it749" onMouseOver="hilite(749)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>['picture'] = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l1034"><span class="linenum">1034</span></a>          <a class="var it749" onMouseOver="hilite(749)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>['id'] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1035"><span class="linenum">1035</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[] = <a class="var it749" onMouseOver="hilite(749)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>;
<a name="l1036"><span class="linenum">1036</span></a>      }
<a name="l1037"><span class="linenum">1037</span></a>      return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1038"><span class="linenum">1038</span></a>  }
<a name="l1039"><span class="linenum">1039</span></a>  
<a name="l1040"><span class="linenum">1040</span></a>  <span class="comment">/**</span>
<a name="l1041"><span class="linenum">1041</span></a>  <span class="comment"> * Print json format error</span>
<a name="l1042"><span class="linenum">1042</span></a>  <span class="comment"> * @param string $level</span>
<a name="l1043"><span class="linenum">1043</span></a>  <span class="comment"> * @param string $msg</span>
<a name="l1044"><span class="linenum">1044</span></a>  <span class="comment"> */</span>
<a name="l1045"><span class="linenum">1045</span></a>  function <a class="function" onClick="logFunction('chat_print_error')" href="../../_functions/chat_print_error.html" onMouseOver="funcPopup(event,'chat_print_error')">chat_print_error</a>(<a class="var it482" onMouseOver="hilite(482)" onMouseOut="lolite()" onClick="logVariable('level')" href="../../_variables/level.html">$level</a>, <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a>) {
<a name="l1046"><span class="linenum">1046</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Content-Length: ' . <a class="phpfunction" onClick="logFunction('ob_get_length')" href="../../_functions/ob_get_length.html" onMouseOver="phpfuncPopup(event,'ob_get_length')">ob_get_length</a>() );
<a name="l1047"><span class="linenum">1047</span></a>      <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../_variables/error.html">$error</a> = new stdClass();
<a name="l1048"><span class="linenum">1048</span></a>      <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../_variables/error.html">$error</a>-&gt;<a onClick="logVariable('level')" class="var it43394" onMouseOver="hilite(43394)" onMouseOut="lolite()" href="../../_variables/level.html">level</a> = <a class="var it482" onMouseOver="hilite(482)" onMouseOut="lolite()" onClick="logVariable('level')" href="../../_variables/level.html">$level</a>;
<a name="l1049"><span class="linenum">1049</span></a>      <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../_variables/error.html">$error</a>-&gt;<a onClick="logVariable('msg')" class="var it43394" onMouseOver="hilite(43394)" onMouseOut="lolite()" href="../../_variables/msg.html">msg</a>   = <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a>;
<a name="l1050"><span class="linenum">1050</span></a>      <a class="var it187" onMouseOver="hilite(187)" onMouseOut="lolite()" onClick="logVariable('response')" href="../../_variables/response.html">$response</a>['error'] = <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../_variables/error.html">$error</a>;
<a name="l1051"><span class="linenum">1051</span></a>      echo <a class="function" onClick="logFunction('json_encode')" href="../../_functions/json_encode.html" onMouseOver="funcPopup(event,'json_encode')">json_encode</a>(<a class="var it187" onMouseOver="hilite(187)" onMouseOut="lolite()" onClick="logVariable('response')" href="../../_variables/response.html">$response</a>);
<a name="l1052"><span class="linenum">1052</span></a>      <a class="phpfunction" onClick="logFunction('ob_end_flush')" href="../../_functions/ob_end_flush.html" onMouseOver="phpfuncPopup(event,'ob_end_flush')">ob_end_flush</a>();
<a name="l1053"><span class="linenum">1053</span></a>      exit;
<a name="l1054"><span class="linenum">1054</span></a>  }
<a name="l1055"><span class="linenum">1055</span></a>  
<a name="l1056"><span class="linenum">1056</span></a>  <span class="comment">/**</span>
<a name="l1057"><span class="linenum">1057</span></a>  <span class="comment"> * List the actions that correspond to a view of this module.</span>
<a name="l1058"><span class="linenum">1058</span></a>  <span class="comment"> * This is used by the participation report.</span>
<a name="l1059"><span class="linenum">1059</span></a>  <span class="comment"> *</span>
<a name="l1060"><span class="linenum">1060</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l1061"><span class="linenum">1061</span></a>  <span class="comment"> *       crud = 'r' and edulevel = LEVEL_PARTICIPATING will</span>
<a name="l1062"><span class="linenum">1062</span></a>  <span class="comment"> *       be considered as view action.</span>
<a name="l1063"><span class="linenum">1063</span></a>  <span class="comment"> *</span>
<a name="l1064"><span class="linenum">1064</span></a>  <span class="comment"> * @return array</span>
<a name="l1065"><span class="linenum">1065</span></a>  <span class="comment"> */</span>
<a name="l1066"><span class="linenum">1066</span></a>  function <a class="function" onClick="logFunction('chat_get_view_actions')" href="../../_functions/chat_get_view_actions.html" onMouseOver="funcPopup(event,'chat_get_view_actions')">chat_get_view_actions</a>() {
<a name="l1067"><span class="linenum">1067</span></a>      return array('view', 'view all', 'report');
<a name="l1068"><span class="linenum">1068</span></a>  }
<a name="l1069"><span class="linenum">1069</span></a>  
<a name="l1070"><span class="linenum">1070</span></a>  <span class="comment">/**</span>
<a name="l1071"><span class="linenum">1071</span></a>  <span class="comment"> * List the actions that correspond to a post of this module.</span>
<a name="l1072"><span class="linenum">1072</span></a>  <span class="comment"> * This is used by the participation report.</span>
<a name="l1073"><span class="linenum">1073</span></a>  <span class="comment"> *</span>
<a name="l1074"><span class="linenum">1074</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l1075"><span class="linenum">1075</span></a>  <span class="comment"> *       crud = ('c' || 'u' || 'd') and edulevel = LEVEL_PARTICIPATING</span>
<a name="l1076"><span class="linenum">1076</span></a>  <span class="comment"> *       will be considered as post action.</span>
<a name="l1077"><span class="linenum">1077</span></a>  <span class="comment"> *</span>
<a name="l1078"><span class="linenum">1078</span></a>  <span class="comment"> * @return array</span>
<a name="l1079"><span class="linenum">1079</span></a>  <span class="comment"> */</span>
<a name="l1080"><span class="linenum">1080</span></a>  function <a class="function" onClick="logFunction('chat_get_post_actions')" href="../../_functions/chat_get_post_actions.html" onMouseOver="funcPopup(event,'chat_get_post_actions')">chat_get_post_actions</a>() {
<a name="l1081"><span class="linenum">1081</span></a>      return array('talk');
<a name="l1082"><span class="linenum">1082</span></a>  }
<a name="l1083"><span class="linenum">1083</span></a>  
<a name="l1084"><span class="linenum">1084</span></a>  <span class="comment">/**</span>
<a name="l1085"><span class="linenum">1085</span></a>  <span class="comment"> * @global object</span>
<a name="l1086"><span class="linenum">1086</span></a>  <span class="comment"> * @global object</span>
<a name="l1087"><span class="linenum">1087</span></a>  <span class="comment"> * @param array $courses</span>
<a name="l1088"><span class="linenum">1088</span></a>  <span class="comment"> * @param array $htmlarray Passed by reference</span>
<a name="l1089"><span class="linenum">1089</span></a>  <span class="comment"> */</span>
<a name="l1090"><span class="linenum">1090</span></a>  function <a class="function" onClick="logFunction('chat_print_overview')" href="../../_functions/chat_print_overview.html" onMouseOver="funcPopup(event,'chat_print_overview')">chat_print_overview</a>(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>, &amp;<a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>) {
<a name="l1091"><span class="linenum">1091</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1092"><span class="linenum">1092</span></a>  
<a name="l1093"><span class="linenum">1093</span></a>      if (empty(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>) || !<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>) || <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>) == 0) {
<a name="l1094"><span class="linenum">1094</span></a>          return array();
<a name="l1095"><span class="linenum">1095</span></a>      }
<a name="l1096"><span class="linenum">1096</span></a>  
<a name="l1097"><span class="linenum">1097</span></a>      if (!<a class="var it8761" onMouseOver="hilite(8761)" onMouseOut="lolite()" onClick="logVariable('chats')" href="../../_variables/chats.html">$chats</a> = <a class="function" onClick="logFunction('get_all_instances_in_courses')" href="../../_functions/get_all_instances_in_courses.html" onMouseOver="funcPopup(event,'get_all_instances_in_courses')">get_all_instances_in_courses</a>('chat', <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>)) {
<a name="l1098"><span class="linenum">1098</span></a>          return;
<a name="l1099"><span class="linenum">1099</span></a>      }
<a name="l1100"><span class="linenum">1100</span></a>  
<a name="l1101"><span class="linenum">1101</span></a>      <a class="var it5671" onMouseOver="hilite(5671)" onMouseOut="lolite()" onClick="logVariable('strchat')" href="../../_variables/strchat.html">$strchat</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulename', 'chat');
<a name="l1102"><span class="linenum">1102</span></a>      <a class="var it12926" onMouseOver="hilite(12926)" onMouseOut="lolite()" onClick="logVariable('strnextsession')" href="../../_variables/strnextsession.html">$strnextsession</a>  = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nextsession', 'chat');
<a name="l1103"><span class="linenum">1103</span></a>  
<a name="l1104"><span class="linenum">1104</span></a>      foreach (<a class="var it8761" onMouseOver="hilite(8761)" onMouseOut="lolite()" onClick="logVariable('chats')" href="../../_variables/chats.html">$chats</a> as <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>) {
<a name="l1105"><span class="linenum">1105</span></a>          if (<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a> and <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('schedule')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/schedule.html">schedule</a>) {  // A chat is scheduled.
<a name="l1106"><span class="linenum">1106</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = '&lt;div class=&quot;chat overview&quot;&gt;&lt;div class=&quot;name&quot;&gt;'.
<a name="l1107"><span class="linenum">1107</span></a>                     <a class="var it5671" onMouseOver="hilite(5671)" onMouseOut="lolite()" onClick="logVariable('strchat')" href="../../_variables/strchat.html">$strchat</a>.': &lt;a '.(<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('visible')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a> ? '' : ' class=&quot;dimmed&quot;').
<a name="l1108"><span class="linenum">1108</span></a>                     ' href=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/chat/view.php?id='.<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>.'&quot;&gt;'.
<a name="l1109"><span class="linenum">1109</span></a>                     <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('name')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>.'&lt;/a&gt;&lt;/div&gt;';
<a name="l1110"><span class="linenum">1110</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= '&lt;div class=&quot;info&quot;&gt;'.<a class="var it12926" onMouseOver="hilite(12926)" onMouseOut="lolite()" onClick="logVariable('strnextsession')" href="../../_variables/strnextsession.html">$strnextsession</a>.': '.<a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a>).'&lt;/div&gt;&lt;/div&gt;';
<a name="l1111"><span class="linenum">1111</span></a>  
<a name="l1112"><span class="linenum">1112</span></a>              if (empty(<a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('course')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['chat'])) {
<a name="l1113"><span class="linenum">1113</span></a>                  <a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('course')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['chat'] = <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>;
<a name="l1114"><span class="linenum">1114</span></a>              } else {
<a name="l1115"><span class="linenum">1115</span></a>                  <a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('course')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['chat'] .= <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>;
<a name="l1116"><span class="linenum">1116</span></a>              }
<a name="l1117"><span class="linenum">1117</span></a>          }
<a name="l1118"><span class="linenum">1118</span></a>      }
<a name="l1119"><span class="linenum">1119</span></a>  }
<a name="l1120"><span class="linenum">1120</span></a>  
<a name="l1121"><span class="linenum">1121</span></a>  
<a name="l1122"><span class="linenum">1122</span></a>  <span class="comment">/**</span>
<a name="l1123"><span class="linenum">1123</span></a>  <span class="comment"> * Implementation of the function for printing the form elements that control</span>
<a name="l1124"><span class="linenum">1124</span></a>  <span class="comment"> * whether the course reset functionality affects the chat.</span>
<a name="l1125"><span class="linenum">1125</span></a>  <span class="comment"> *</span>
<a name="l1126"><span class="linenum">1126</span></a>  <span class="comment"> * @param object $mform form passed by reference</span>
<a name="l1127"><span class="linenum">1127</span></a>  <span class="comment"> */</span>
<a name="l1128"><span class="linenum">1128</span></a>  function <a class="function" onClick="logFunction('chat_reset_course_form_definition')" href="../../_functions/chat_reset_course_form_definition.html" onMouseOver="funcPopup(event,'chat_reset_course_form_definition')">chat_reset_course_form_definition</a>(&amp;<a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l1129"><span class="linenum">1129</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('header', 'chatheader', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulenameplural', 'chat'));
<a name="l1130"><span class="linenum">1130</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('advcheckbox', 'reset_chat', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('removemessages', 'chat'));
<a name="l1131"><span class="linenum">1131</span></a>  }
<a name="l1132"><span class="linenum">1132</span></a>  
<a name="l1133"><span class="linenum">1133</span></a>  <span class="comment">/**</span>
<a name="l1134"><span class="linenum">1134</span></a>  <span class="comment"> * Course reset form defaults.</span>
<a name="l1135"><span class="linenum">1135</span></a>  <span class="comment"> *</span>
<a name="l1136"><span class="linenum">1136</span></a>  <span class="comment"> * @param object $course</span>
<a name="l1137"><span class="linenum">1137</span></a>  <span class="comment"> * @return array</span>
<a name="l1138"><span class="linenum">1138</span></a>  <span class="comment"> */</span>
<a name="l1139"><span class="linenum">1139</span></a>  function <a class="function" onClick="logFunction('chat_reset_course_form_defaults')" href="../../_functions/chat_reset_course_form_defaults.html" onMouseOver="funcPopup(event,'chat_reset_course_form_defaults')">chat_reset_course_form_defaults</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l1140"><span class="linenum">1140</span></a>      return array('reset_chat' =&gt; 1);
<a name="l1141"><span class="linenum">1141</span></a>  }
<a name="l1142"><span class="linenum">1142</span></a>  
<a name="l1143"><span class="linenum">1143</span></a>  <span class="comment">/**</span>
<a name="l1144"><span class="linenum">1144</span></a>  <span class="comment"> * Actual implementation of the reset course functionality, delete all the</span>
<a name="l1145"><span class="linenum">1145</span></a>  <span class="comment"> * chat messages for course $data-&gt;courseid.</span>
<a name="l1146"><span class="linenum">1146</span></a>  <span class="comment"> *</span>
<a name="l1147"><span class="linenum">1147</span></a>  <span class="comment"> * @global object</span>
<a name="l1148"><span class="linenum">1148</span></a>  <span class="comment"> * @global object</span>
<a name="l1149"><span class="linenum">1149</span></a>  <span class="comment"> * @param object $data the data submitted from the reset course.</span>
<a name="l1150"><span class="linenum">1150</span></a>  <span class="comment"> * @return array status array</span>
<a name="l1151"><span class="linenum">1151</span></a>  <span class="comment"> */</span>
<a name="l1152"><span class="linenum">1152</span></a>  function <a class="function" onClick="logFunction('chat_reset_userdata')" href="../../_functions/chat_reset_userdata.html" onMouseOver="funcPopup(event,'chat_reset_userdata')">chat_reset_userdata</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>) {
<a name="l1153"><span class="linenum">1153</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1154"><span class="linenum">1154</span></a>  
<a name="l1155"><span class="linenum">1155</span></a>      <a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulenameplural', 'chat');
<a name="l1156"><span class="linenum">1156</span></a>      <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = array();
<a name="l1157"><span class="linenum">1157</span></a>  
<a name="l1158"><span class="linenum">1158</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_chat')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_chat.html">reset_chat</a>)) {
<a name="l1159"><span class="linenum">1159</span></a>          <a class="var it12928" onMouseOver="hilite(12928)" onMouseOut="lolite()" onClick="logVariable('chatessql')" href="../../_variables/chatessql.html">$chatessql</a> = &quot;SELECT ch.id
<a name="l1160"><span class="linenum">1160</span></a>                          FROM {chat} ch
<a name="l1161"><span class="linenum">1161</span></a>                         WHERE ch.course=?&quot;;
<a name="l1162"><span class="linenum">1162</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l1163"><span class="linenum">1163</span></a>  
<a name="l1164"><span class="linenum">1164</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('chat_messages', &quot;chatid IN (<a class="var it12928" onMouseOver="hilite(12928)" onMouseOut="lolite()" onClick="logVariable('chatessql')" href="../../_variables/chatessql.html">$chatessql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1165"><span class="linenum">1165</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('chat_messages_current', &quot;chatid IN (<a class="var it12928" onMouseOver="hilite(12928)" onMouseOut="lolite()" onClick="logVariable('chatessql')" href="../../_variables/chatessql.html">$chatessql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1166"><span class="linenum">1166</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('chat_users', &quot;chatid IN (<a class="var it12928" onMouseOver="hilite(12928)" onMouseOut="lolite()" onClick="logVariable('chatessql')" href="../../_variables/chatessql.html">$chatessql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1167"><span class="linenum">1167</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component' =&gt; <a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('removemessages', 'chat'), 'error' =&gt; false);
<a name="l1168"><span class="linenum">1168</span></a>      }
<a name="l1169"><span class="linenum">1169</span></a>  
<a name="l1170"><span class="linenum">1170</span></a>  <span class="comment">    // Updating dates - shift may be negative too.</span>
<a name="l1171"><span class="linenum">1171</span></a>      if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>) {
<a name="l1172"><span class="linenum">1172</span></a>          <a class="function" onClick="logFunction('shift_course_mod_dates')" href="../../_functions/shift_course_mod_dates.html" onMouseOver="funcPopup(event,'shift_course_mod_dates')">shift_course_mod_dates</a>('chat', array('chattime'), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l1173"><span class="linenum">1173</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component' =&gt; <a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('datechanged'), 'error' =&gt; false);
<a name="l1174"><span class="linenum">1174</span></a>      }
<a name="l1175"><span class="linenum">1175</span></a>  
<a name="l1176"><span class="linenum">1176</span></a>      return <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>;
<a name="l1177"><span class="linenum">1177</span></a>  }
<a name="l1178"><span class="linenum">1178</span></a>  
<a name="l1179"><span class="linenum">1179</span></a>  <span class="comment">/**</span>
<a name="l1180"><span class="linenum">1180</span></a>  <span class="comment"> * Returns all other caps used in module</span>
<a name="l1181"><span class="linenum">1181</span></a>  <span class="comment"> *</span>
<a name="l1182"><span class="linenum">1182</span></a>  <span class="comment"> * @return array</span>
<a name="l1183"><span class="linenum">1183</span></a>  <span class="comment"> */</span>
<a name="l1184"><span class="linenum">1184</span></a>  function <a class="function" onClick="logFunction('chat_get_extra_capabilities')" href="../../_functions/chat_get_extra_capabilities.html" onMouseOver="funcPopup(event,'chat_get_extra_capabilities')">chat_get_extra_capabilities</a>() {
<a name="l1185"><span class="linenum">1185</span></a>      return array('moodle/site:accessallgroups', 'moodle/site:viewfullnames');
<a name="l1186"><span class="linenum">1186</span></a>  }
<a name="l1187"><span class="linenum">1187</span></a>  
<a name="l1188"><span class="linenum">1188</span></a>  
<a name="l1189"><span class="linenum">1189</span></a>  <span class="comment">/**</span>
<a name="l1190"><span class="linenum">1190</span></a>  <span class="comment"> * @param string $feature FEATURE_xx constant for requested feature</span>
<a name="l1191"><span class="linenum">1191</span></a>  <span class="comment"> * @return mixed True if module supports feature, null if doesn't know</span>
<a name="l1192"><span class="linenum">1192</span></a>  <span class="comment"> */</span>
<a name="l1193"><span class="linenum">1193</span></a>  function <a class="function" onClick="logFunction('chat_supports')" href="../../_functions/chat_supports.html" onMouseOver="funcPopup(event,'chat_supports')">chat_supports</a>(<a class="var it2267" onMouseOver="hilite(2267)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l1194"><span class="linenum">1194</span></a>      switch(<a class="var it2267" onMouseOver="hilite(2267)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l1195"><span class="linenum">1195</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPS')" href="../../_constants/FEATURE_GROUPS.html" onMouseOver="constPopup(event,'FEATURE_GROUPS')">FEATURE_GROUPS</a>:
<a name="l1196"><span class="linenum">1196</span></a>              return true;
<a name="l1197"><span class="linenum">1197</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPINGS')" href="../../_constants/FEATURE_GROUPINGS.html" onMouseOver="constPopup(event,'FEATURE_GROUPINGS')">FEATURE_GROUPINGS</a>:
<a name="l1198"><span class="linenum">1198</span></a>              return true;
<a name="l1199"><span class="linenum">1199</span></a>          case <a class="constant" onClick="logConstant('FEATURE_MOD_INTRO')" href="../../_constants/FEATURE_MOD_INTRO.html" onMouseOver="constPopup(event,'FEATURE_MOD_INTRO')">FEATURE_MOD_INTRO</a>:
<a name="l1200"><span class="linenum">1200</span></a>              return true;
<a name="l1201"><span class="linenum">1201</span></a>          case <a class="constant" onClick="logConstant('FEATURE_BACKUP_MOODLE2')" href="../../_constants/FEATURE_BACKUP_MOODLE2.html" onMouseOver="constPopup(event,'FEATURE_BACKUP_MOODLE2')">FEATURE_BACKUP_MOODLE2</a>:
<a name="l1202"><span class="linenum">1202</span></a>              return true;
<a name="l1203"><span class="linenum">1203</span></a>          case <a class="constant" onClick="logConstant('FEATURE_COMPLETION_TRACKS_VIEWS')" href="../../_constants/FEATURE_COMPLETION_TRACKS_VIEWS.html" onMouseOver="constPopup(event,'FEATURE_COMPLETION_TRACKS_VIEWS')">FEATURE_COMPLETION_TRACKS_VIEWS</a>:
<a name="l1204"><span class="linenum">1204</span></a>              return true;
<a name="l1205"><span class="linenum">1205</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_HAS_GRADE')" href="../../_constants/FEATURE_GRADE_HAS_GRADE.html" onMouseOver="constPopup(event,'FEATURE_GRADE_HAS_GRADE')">FEATURE_GRADE_HAS_GRADE</a>:
<a name="l1206"><span class="linenum">1206</span></a>              return false;
<a name="l1207"><span class="linenum">1207</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_OUTCOMES')" href="../../_constants/FEATURE_GRADE_OUTCOMES.html" onMouseOver="constPopup(event,'FEATURE_GRADE_OUTCOMES')">FEATURE_GRADE_OUTCOMES</a>:
<a name="l1208"><span class="linenum">1208</span></a>              return true;
<a name="l1209"><span class="linenum">1209</span></a>          case <a class="constant" onClick="logConstant('FEATURE_SHOW_DESCRIPTION')" href="../../_constants/FEATURE_SHOW_DESCRIPTION.html" onMouseOver="constPopup(event,'FEATURE_SHOW_DESCRIPTION')">FEATURE_SHOW_DESCRIPTION</a>:
<a name="l1210"><span class="linenum">1210</span></a>              return true;
<a name="l1211"><span class="linenum">1211</span></a>          default:
<a name="l1212"><span class="linenum">1212</span></a>              return null;
<a name="l1213"><span class="linenum">1213</span></a>      }
<a name="l1214"><span class="linenum">1214</span></a>  }
<a name="l1215"><span class="linenum">1215</span></a>  
<a name="l1216"><span class="linenum">1216</span></a>  function <a class="function" onClick="logFunction('chat_extend_navigation')" href="../../_functions/chat_extend_navigation.html" onMouseOver="funcPopup(event,'chat_extend_navigation')">chat_extend_navigation</a>(<a class="var it2565" onMouseOver="hilite(2565)" onMouseOut="lolite()" onClick="logVariable('navigation')" href="../../_variables/navigation.html">$navigation</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it994" onMouseOver="hilite(994)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l1217"><span class="linenum">1217</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1218"><span class="linenum">1218</span></a>  
<a name="l1219"><span class="linenum">1219</span></a>      <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = <a class="function" onClick="logFunction('groups_get_activity_group')" href="../../_functions/groups_get_activity_group.html" onMouseOver="funcPopup(event,'groups_get_activity_group')">groups_get_activity_group</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, true);
<a name="l1220"><span class="linenum">1220</span></a>  
<a name="l1221"><span class="linenum">1221</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/chat:chat', <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l1222"><span class="linenum">1222</span></a>          <a class="var it12929" onMouseOver="hilite(12929)" onMouseOut="lolite()" onClick="logVariable('strenterchat')" href="../../_variables/strenterchat.html">$strenterchat</a>    = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('enterchat', 'chat');
<a name="l1223"><span class="linenum">1223</span></a>  
<a name="l1224"><span class="linenum">1224</span></a>          <a class="var it713" onMouseOver="hilite(713)" onMouseOut="lolite()" onClick="logVariable('target')" href="../../_variables/target.html">$target</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/mod/chat/';
<a name="l1225"><span class="linenum">1225</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('id' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>);
<a name="l1226"><span class="linenum">1226</span></a>  
<a name="l1227"><span class="linenum">1227</span></a>          if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l1228"><span class="linenum">1228</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['groupid'] = <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>;
<a name="l1229"><span class="linenum">1229</span></a>          }
<a name="l1230"><span class="linenum">1230</span></a>  
<a name="l1231"><span class="linenum">1231</span></a>          <a class="var it1003" onMouseOver="hilite(1003)" onMouseOut="lolite()" onClick="logVariable('links')" href="../../_variables/links.html">$links</a> = array();
<a name="l1232"><span class="linenum">1232</span></a>  
<a name="l1233"><span class="linenum">1233</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it713" onMouseOver="hilite(713)" onMouseOut="lolite()" onClick="logVariable('target')" href="../../_variables/target.html">$target</a>.'gui_'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('chat_method')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/chat_method.html">chat_method</a>.'<a class="filename" href="../../index.php.html">/index.php</a>', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1234"><span class="linenum">1234</span></a>          <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <span class="keyword">new </span><a class="class" onClick="logClass('popup_action')" href="../../_classes/popup_action.html" onMouseOver="classPopup(event,'popup_action')">popup_action</a>('click', <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, 'chat'.<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>.<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>,
<a name="l1235"><span class="linenum">1235</span></a>                                     array('height' =&gt; 500, 'width' =&gt; 700));
<a name="l1236"><span class="linenum">1236</span></a>          <a class="var it1003" onMouseOver="hilite(1003)" onMouseOut="lolite()" onClick="logVariable('links')" href="../../_variables/links.html">$links</a>[] = <span class="keyword">new </span><a class="class" onClick="logClass('action_link')" href="../../_classes/action_link.html" onMouseOver="classPopup(event,'action_link')">action_link</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="var it12929" onMouseOver="hilite(12929)" onMouseOut="lolite()" onClick="logVariable('strenterchat')" href="../../_variables/strenterchat.html">$strenterchat</a>, <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>);
<a name="l1237"><span class="linenum">1237</span></a>  
<a name="l1238"><span class="linenum">1238</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it713" onMouseOver="hilite(713)" onMouseOut="lolite()" onClick="logVariable('target')" href="../../_variables/target.html">$target</a>.'gui_basic/index.php', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1239"><span class="linenum">1239</span></a>          <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <span class="keyword">new </span><a class="class" onClick="logClass('popup_action')" href="../../_classes/popup_action.html" onMouseOver="classPopup(event,'popup_action')">popup_action</a>('click', <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, 'chat'.<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>.<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>,
<a name="l1240"><span class="linenum">1240</span></a>                                     array('height' =&gt; 500, 'width' =&gt; 700));
<a name="l1241"><span class="linenum">1241</span></a>          <a class="var it1003" onMouseOver="hilite(1003)" onMouseOut="lolite()" onClick="logVariable('links')" href="../../_variables/links.html">$links</a>[] = <span class="keyword">new </span><a class="class" onClick="logClass('action_link')" href="../../_classes/action_link.html" onMouseOver="classPopup(event,'action_link')">action_link</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('noframesjs', 'message'), <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>);
<a name="l1242"><span class="linenum">1242</span></a>  
<a name="l1243"><span class="linenum">1243</span></a>          foreach (<a class="var it1003" onMouseOver="hilite(1003)" onMouseOut="lolite()" onClick="logVariable('links')" href="../../_variables/links.html">$links</a> as <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>) {
<a name="l1244"><span class="linenum">1244</span></a>              <a class="var it2565" onMouseOver="hilite(2565)" onMouseOut="lolite()" onClick="logVariable('navigation')" href="../../_variables/navigation.html">$navigation</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>-&gt;<a onClick="logVariable('text')" class="var it44335" onMouseOver="hilite(44335)" onMouseOut="lolite()" href="../../_variables/text.html">text</a>, <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>, <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null , null, <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/group' , ''));
<a name="l1245"><span class="linenum">1245</span></a>          }
<a name="l1246"><span class="linenum">1246</span></a>      }
<a name="l1247"><span class="linenum">1247</span></a>  
<a name="l1248"><span class="linenum">1248</span></a>      <a class="var it5675" onMouseOver="hilite(5675)" onMouseOut="lolite()" onClick="logVariable('chatusers')" href="../../_variables/chatusers.html">$chatusers</a> = <a class="function" onClick="logFunction('chat_get_users')" href="../../_functions/chat_get_users.html" onMouseOver="funcPopup(event,'chat_get_users')">chat_get_users</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>, <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>);
<a name="l1249"><span class="linenum">1249</span></a>      if (<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it5675" onMouseOver="hilite(5675)" onMouseOut="lolite()" onClick="logVariable('chatusers')" href="../../_variables/chatusers.html">$chatusers</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it5675" onMouseOver="hilite(5675)" onMouseOut="lolite()" onClick="logVariable('chatusers')" href="../../_variables/chatusers.html">$chatusers</a>) &gt; 0) {
<a name="l1250"><span class="linenum">1250</span></a>          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="var it2565" onMouseOver="hilite(2565)" onMouseOut="lolite()" onClick="logVariable('navigation')" href="../../_variables/navigation.html">$navigation</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('currentusers', 'chat'));
<a name="l1251"><span class="linenum">1251</span></a>          foreach (<a class="var it5675" onMouseOver="hilite(5675)" onMouseOut="lolite()" onClick="logVariable('chatusers')" href="../../_variables/chatusers.html">$chatusers</a> as <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>) {
<a name="l1252"><span class="linenum">1252</span></a>              <a class="var it12931" onMouseOver="hilite(12931)" onMouseOut="lolite()" onClick="logVariable('userlink')" href="../../_variables/userlink.html">$userlink</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../user/view.php.html">/user/view.php</a>', array('id' =&gt; <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('id')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'course' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1253"><span class="linenum">1253</span></a>              <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>).' '.<a class="function" onClick="logFunction('format_time')" href="../../_functions/format_time.html" onMouseOver="funcPopup(event,'format_time')">format_time</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('lastmessageping')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/lastmessageping.html">lastmessageping</a>),
<a name="l1254"><span class="linenum">1254</span></a>                          <a class="var it12931" onMouseOver="hilite(12931)" onMouseOut="lolite()" onClick="logVariable('userlink')" href="../../_variables/userlink.html">$userlink</a>, <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_USER, null, null, <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/user', ''));
<a name="l1255"><span class="linenum">1255</span></a>          }
<a name="l1256"><span class="linenum">1256</span></a>      }
<a name="l1257"><span class="linenum">1257</span></a>  }
<a name="l1258"><span class="linenum">1258</span></a>  
<a name="l1259"><span class="linenum">1259</span></a>  <span class="comment">/**</span>
<a name="l1260"><span class="linenum">1260</span></a>  <span class="comment"> * Adds module specific settings to the settings block</span>
<a name="l1261"><span class="linenum">1261</span></a>  <span class="comment"> *</span>
<a name="l1262"><span class="linenum">1262</span></a>  <span class="comment"> * @param settings_navigation $settings The settings navigation object</span>
<a name="l1263"><span class="linenum">1263</span></a>  <span class="comment"> * @param navigation_node $chatnode The node to add module settings to</span>
<a name="l1264"><span class="linenum">1264</span></a>  <span class="comment"> */</span>
<a name="l1265"><span class="linenum">1265</span></a>  function <a class="function" onClick="logFunction('chat_extend_settings_navigation')" href="../../_functions/chat_extend_settings_navigation.html" onMouseOver="funcPopup(event,'chat_extend_settings_navigation')">chat_extend_settings_navigation</a>(settings_navigation <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>, navigation_node <a class="var it12932" onMouseOver="hilite(12932)" onMouseOut="lolite()" onClick="logVariable('chatnode')" href="../../_variables/chatnode.html">$chatnode</a>) {
<a name="l1266"><span class="linenum">1266</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l1267"><span class="linenum">1267</span></a>      <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(&quot;chat&quot;, array(&quot;id&quot; =&gt; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;instance));
<a name="l1268"><span class="linenum">1268</span></a>  
<a name="l1269"><span class="linenum">1269</span></a>      if (<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a> &amp;&amp; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('schedule')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/schedule.html">schedule</a>) {
<a name="l1270"><span class="linenum">1270</span></a>          <a class="var it12933" onMouseOver="hilite(12933)" onMouseOut="lolite()" onClick="logVariable('nextsessionnode')" href="../../_variables/nextsessionnode.html">$nextsessionnode</a> = <a class="var it12932" onMouseOver="hilite(12932)" onMouseOut="lolite()" onClick="logVariable('chatnode')" href="../../_variables/chatnode.html">$chatnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nextsession', 'chat').
<a name="l1271"><span class="linenum">1271</span></a>                                            ': '.<a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('chattime')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/chattime.html">chattime</a>).
<a name="l1272"><span class="linenum">1272</span></a>                                            ' ('.<a class="function" onClick="logFunction('usertimezone')" href="../../_functions/usertimezone.html" onMouseOver="funcPopup(event,'usertimezone')">usertimezone</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('timezone')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/timezone.html">timezone</a>).')');
<a name="l1273"><span class="linenum">1273</span></a>          <a class="var it12933" onMouseOver="hilite(12933)" onMouseOut="lolite()" onClick="logVariable('nextsessionnode')" href="../../_variables/nextsessionnode.html">$nextsessionnode</a>-&gt;<a class="function" onClick="logFunction('add_class')" href="../../_functions/add_class.html" onMouseOver="funcPopup(event,'add_class')">add_class</a>('note');
<a name="l1274"><span class="linenum">1274</span></a>      }
<a name="l1275"><span class="linenum">1275</span></a>  
<a name="l1276"><span class="linenum">1276</span></a>      <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a> = <a class="function" onClick="logFunction('groups_get_activity_group')" href="../../_functions/groups_get_activity_group.html" onMouseOver="funcPopup(event,'groups_get_activity_group')">groups_get_activity_group</a>(<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>, true);
<a name="l1277"><span class="linenum">1277</span></a>      if (<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>) {
<a name="l1278"><span class="linenum">1278</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = &quot; AND groupid = '<a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('currentgroup')" href="../../_variables/currentgroup.html">$currentgroup</a>'&quot;;
<a name="l1279"><span class="linenum">1279</span></a>      } else {
<a name="l1280"><span class="linenum">1280</span></a>          <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = '';
<a name="l1281"><span class="linenum">1281</span></a>      }
<a name="l1282"><span class="linenum">1282</span></a>  
<a name="l1283"><span class="linenum">1283</span></a>      if (<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('studentlogs')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/studentlogs.html">studentlogs</a> || <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/chat:readlog', <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l1284"><span class="linenum">1284</span></a>          if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('chat_messages', &quot;chatid = ? <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a>&quot;, array(<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;<a onClick="logVariable('id')" class="var it42903" onMouseOver="hilite(42903)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l1285"><span class="linenum">1285</span></a>              <a class="var it12932" onMouseOver="hilite(12932)" onMouseOut="lolite()" onClick="logVariable('chatnode')" href="../../_variables/chatnode.html">$chatnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('viewreport', 'chat'), <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/chat/report.php.html">/mod/chat/report.php</a>', array('id' =&gt; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id)));
<a name="l1286"><span class="linenum">1286</span></a>          }
<a name="l1287"><span class="linenum">1287</span></a>      }
<a name="l1288"><span class="linenum">1288</span></a>  }
<a name="l1289"><span class="linenum">1289</span></a>  
<a name="l1290"><span class="linenum">1290</span></a>  <span class="comment">/**</span>
<a name="l1291"><span class="linenum">1291</span></a>  <span class="comment"> * user logout event handler</span>
<a name="l1292"><span class="linenum">1292</span></a>  <span class="comment"> *</span>
<a name="l1293"><span class="linenum">1293</span></a>  <span class="comment"> * @param \core\event\user_loggedout $event The event.</span>
<a name="l1294"><span class="linenum">1294</span></a>  <span class="comment"> * @return void</span>
<a name="l1295"><span class="linenum">1295</span></a>  <span class="comment"> */</span>
<a name="l1296"><span class="linenum">1296</span></a>  function <a class="function" onClick="logFunction('chat_user_logout')" href="../../_functions/chat_user_logout.html" onMouseOver="funcPopup(event,'chat_user_logout')">chat_user_logout</a>(\core\event\user_loggedout <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>) {
<a name="l1297"><span class="linenum">1297</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1298"><span class="linenum">1298</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('chat_users', array('userid' =&gt; <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('objectid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/objectid.html">objectid</a>));
<a name="l1299"><span class="linenum">1299</span></a>  }
<a name="l1300"><span class="linenum">1300</span></a>  
<a name="l1301"><span class="linenum">1301</span></a>  <span class="comment">/**</span>
<a name="l1302"><span class="linenum">1302</span></a>  <span class="comment"> * Return a list of page types</span>
<a name="l1303"><span class="linenum">1303</span></a>  <span class="comment"> * @param string $pagetype current page type</span>
<a name="l1304"><span class="linenum">1304</span></a>  <span class="comment"> * @param stdClass $parentcontext Block's parent context</span>
<a name="l1305"><span class="linenum">1305</span></a>  <span class="comment"> * @param stdClass $currentcontext Current context of block</span>
<a name="l1306"><span class="linenum">1306</span></a>  <span class="comment"> */</span>
<a name="l1307"><span class="linenum">1307</span></a>  function <a class="function" onClick="logFunction('chat_page_type_list')" href="../../_functions/chat_page_type_list.html" onMouseOver="funcPopup(event,'chat_page_type_list')">chat_page_type_list</a>(<a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../../_variables/pagetype.html">$pagetype</a>, <a class="var it2279" onMouseOver="hilite(2279)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../../_variables/parentcontext.html">$parentcontext</a>, <a class="var it2280" onMouseOver="hilite(2280)" onMouseOut="lolite()" onClick="logVariable('currentcontext')" href="../../_variables/currentcontext.html">$currentcontext</a>) {
<a name="l1308"><span class="linenum">1308</span></a>      <a class="var it2281" onMouseOver="hilite(2281)" onMouseOut="lolite()" onClick="logVariable('modulepagetype')" href="../../_variables/modulepagetype.html">$modulepagetype</a> = array('mod-chat-*' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-chat-x', 'chat'));
<a name="l1309"><span class="linenum">1309</span></a>      return <a class="var it2281" onMouseOver="hilite(2281)" onMouseOut="lolite()" onClick="logVariable('modulepagetype')" href="../../_variables/modulepagetype.html">$modulepagetype</a>;
<a name="l1310"><span class="linenum">1310</span></a>  }
<a name="l1311"><span class="linenum">1311</span></a>  
<a name="l1312"><span class="linenum">1312</span></a>  <span class="comment">/**</span>
<a name="l1313"><span class="linenum">1313</span></a>  <span class="comment"> * Return a list of the latest messages in the given chat session.</span>
<a name="l1314"><span class="linenum">1314</span></a>  <span class="comment"> *</span>
<a name="l1315"><span class="linenum">1315</span></a>  <span class="comment"> * @param  stdClass $chatuser     chat user session data</span>
<a name="l1316"><span class="linenum">1316</span></a>  <span class="comment"> * @param  int      $chatlasttime last time messages were retrieved</span>
<a name="l1317"><span class="linenum">1317</span></a>  <span class="comment"> * @return array    list of messages</span>
<a name="l1318"><span class="linenum">1318</span></a>  <span class="comment"> * @since  Moodle 3.0</span>
<a name="l1319"><span class="linenum">1319</span></a>  <span class="comment"> */</span>
<a name="l1320"><span class="linenum">1320</span></a>  function <a class="function" onClick="logFunction('chat_get_latest_messages')" href="../../_functions/chat_get_latest_messages.html" onMouseOver="funcPopup(event,'chat_get_latest_messages')">chat_get_latest_messages</a>(<a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>, <a class="var it11330" onMouseOver="hilite(11330)" onMouseOut="lolite()" onClick="logVariable('chatlasttime')" href="../../_variables/chatlasttime.html">$chatlasttime</a>) {
<a name="l1321"><span class="linenum">1321</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1322"><span class="linenum">1322</span></a>  
<a name="l1323"><span class="linenum">1323</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('groupid' =&gt; <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('groupid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>, 'chatid' =&gt; <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('chatid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/chatid.html">chatid</a>, 'lasttime' =&gt; <a class="var it11330" onMouseOver="hilite(11330)" onMouseOut="lolite()" onClick="logVariable('chatlasttime')" href="../../_variables/chatlasttime.html">$chatlasttime</a>);
<a name="l1324"><span class="linenum">1324</span></a>  
<a name="l1325"><span class="linenum">1325</span></a>      <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a> = <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('groupid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> ? &quot; AND (groupid=&quot; . <a class="var it5679" onMouseOver="hilite(5679)" onMouseOut="lolite()" onClick="logVariable('chatuser')" href="../../_variables/chatuser.html">$chatuser</a>-&gt;<a onClick="logVariable('groupid')" class="var it44596" onMouseOver="hilite(44596)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> . &quot; OR groupid=0) &quot; : &quot;&quot;;
<a name="l1326"><span class="linenum">1326</span></a>  
<a name="l1327"><span class="linenum">1327</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('chat_messages_current', 'chatid = :chatid AND timestamp &gt; :lasttime ' . <a class="var it5686" onMouseOver="hilite(5686)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../../_variables/groupselect.html">$groupselect</a>,
<a name="l1328"><span class="linenum">1328</span></a>                                      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, 'timestamp ASC');
<a name="l1329"><span class="linenum">1329</span></a>  }
<a name="l1330"><span class="linenum">1330</span></a>  
<a name="l1331"><span class="linenum">1331</span></a>  <span class="comment">/**</span>
<a name="l1332"><span class="linenum">1332</span></a>  <span class="comment"> * Mark the activity completed (if required) and trigger the course_module_viewed event.</span>
<a name="l1333"><span class="linenum">1333</span></a>  <span class="comment"> *</span>
<a name="l1334"><span class="linenum">1334</span></a>  <span class="comment"> * @param  stdClass $chat       chat object</span>
<a name="l1335"><span class="linenum">1335</span></a>  <span class="comment"> * @param  stdClass $course     course object</span>
<a name="l1336"><span class="linenum">1336</span></a>  <span class="comment"> * @param  stdClass $cm         course module object</span>
<a name="l1337"><span class="linenum">1337</span></a>  <span class="comment"> * @param  stdClass $context    context object</span>
<a name="l1338"><span class="linenum">1338</span></a>  <span class="comment"> * @since Moodle 3.0</span>
<a name="l1339"><span class="linenum">1339</span></a>  <span class="comment"> */</span>
<a name="l1340"><span class="linenum">1340</span></a>  function <a class="function" onClick="logFunction('chat_view')" href="../../_functions/chat_view.html" onMouseOver="funcPopup(event,'chat_view')">chat_view</a>(<a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l1341"><span class="linenum">1341</span></a>  
<a name="l1342"><span class="linenum">1342</span></a>  <span class="comment">    // Trigger course_module_viewed event.</span>
<a name="l1343"><span class="linenum">1343</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l1344"><span class="linenum">1344</span></a>          'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>,
<a name="l1345"><span class="linenum">1345</span></a>          'objectid' =&gt; <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>-&gt;id
<a name="l1346"><span class="linenum">1346</span></a>      );
<a name="l1347"><span class="linenum">1347</span></a>  
<a name="l1348"><span class="linenum">1348</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \mod_chat\event\<a class="class" onClick="logClass('course_module_viewed')" href="../../_classes/course_module_viewed.html" onMouseOver="classPopup(event,'course_module_viewed')">course_module_viewed</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1349"><span class="linenum">1349</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('course_modules', <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1350"><span class="linenum">1350</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('course', <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l1351"><span class="linenum">1351</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('chat', <a class="var it3367" onMouseOver="hilite(3367)" onMouseOut="lolite()" onClick="logVariable('chat')" href="../../_variables/chat.html">$chat</a>);
<a name="l1352"><span class="linenum">1352</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1353"><span class="linenum">1353</span></a>  
<a name="l1354"><span class="linenum">1354</span></a>  <span class="comment">    // Completion.</span>
<a name="l1355"><span class="linenum">1355</span></a>      <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a> = <span class="keyword">new </span><a class="class" onClick="logClass('completion_info')" href="../../_classes/completion_info.html" onMouseOver="classPopup(event,'completion_info')">completion_info</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l1356"><span class="linenum">1356</span></a>      <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('set_module_viewed')" href="../../_functions/set_module_viewed.html" onMouseOver="funcPopup(event,'set_module_viewed')">set_module_viewed</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1357"><span class="linenum">1357</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'chat_delete_instance': ['chat_delete_instance', 'Given an ID of an instance of this module, this function will permanently delete the instance and any data that depends on it. ', [['mod/chat','lib.php',165]], 0],
'chat_get_latest_messages': ['chat_get_latest_messages', 'Return a list of the latest messages in the given chat session. ', [['mod/chat','lib.php',1312]], 2],
'chat_update_chat_times': ['chat_update_chat_times', 'Updates chat records so that the next chat time is correct ', [['mod/chat','lib.php',592]], 3],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'select': ['select', '', [['lib/jquery/ui-1.11.4/external/jquery','jquery.js',2845],['lib','outputcomponents.php',1265]], 591],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'where': ['where', '', [['question/engine','datalib.php',1883],['question/engine','datalib.php',1965],['mod/glossary/classes','entry_query_builder.php',448],['question/classes/bank/search','hidden_condition.php',53],['question/classes/bank/search','category_condition.php',96]], 64],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'chat_extend_navigation': ['chat_extend_navigation', '', [['mod/chat','lib.php',1216]], 0],
'get_user_timezone': ['get_user_timezone', 'Returns a float or a string which denotes the user\'s timezone A float value means that a simple offset from GMT is used, while a string (it will be the name of a timezone in the database) means that for this timezone there are also DST rules to be taken into account Checks various settings and picks the most dominant of those which have a value ', [['lib','moodlelib.php',2284],['lib/classes','date.php',220]], 69],
'chat_view': ['chat_view', 'Mark the activity completed (if required) and trigger the course_module_viewed event. ', [['mod/chat','lib.php',1331]], 2],
'user_picture': ['user_picture', '', [['mod/quiz','attemptlib.php',2467],['lib','outputrenderers.php',2454],['lib','outputrenderers.php',5000]], 138],
'settimeout': ['settimeout', 'Set the maximum request time in seconds. ', [['lib/google/src/Google/IO','Stream.php',200],['lib/google/src/Google/Service','Appengine.php',1018],['lib/phpmailer','class.smtp.php',1164],['lib/google/src/Google/IO','Curl.php',154],['lib/google','curlio.php',156]], 707],
'format_text': ['format_text', 'Formats a text string coming from the search engine. ', [['search/classes','document.php',606],['lib/classes','grading_external.php',182],['search/engine/solr/classes','document.php',129],['lib','weblib.php',1158],['lib','tablelib.php',860],['lib','tablelib.php',1667],['question/type','questionbase.php',345]], 322],
'get_coursemodule_from_instance': ['get_coursemodule_from_instance', 'Given an instance number of a module, finds the coursemodule description ', [['lib','datalib.php',1300]], 441],
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',840]], 332],
'get_record_sql': ['get_record_sql', 'Get a single database record as an object using a SQL statement. ', [['lib/dml','oci_native_moodle_database.php',1076],['lib/dml','moodle_database.php',1506]], 157],
'groups_get_activity_group': ['groups_get_activity_group', 'Returns group active in activity, changes the group by default if \'group\' page param present ', [['lib','grouplib.php',814]], 97],
'addelement': ['addelement', 'Adds a custom element to your HTML definition ', [['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',124],['lib/htmlpurifier/HTMLPurifier','HTMLModule.php',130],['lib/pear/HTML','QuickForm.php',592]], 3302],
'chat_get_users': ['chat_get_users', '', [['mod/chat','lib.php',452]], 8],
'chat_extend_settings_navigation': ['chat_extend_settings_navigation', 'Adds module specific settings to the settings block ', [['mod/chat','lib.php',1259]], 0],
'get_all_instances_in_courses': ['get_all_instances_in_courses', 'Returns an array of all the active instances of a particular module in given courses, sorted in the order they are defined ', [['lib','datalib.php',1382]], 23],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1379]], 880],
'random_string': ['random_string', 'Generate and return a random string of the specified length. ', [['lib','moodlelib.php',7736]], 42],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'submit': ['submit', 'Submits a sitemap for a site. (sitemaps.submit) ', [['lib/google/src/Google/Service','Webmasters.php',408],['lib/google/src/Google/Service','Games.php',1893]], 77],
'format_module_intro': ['format_module_intro', 'Formats activity intro text ', [['lib','weblib.php',1542]], 65],
'set_module_viewed': ['set_module_viewed', 'Update the module completion status (set it viewed). ', [['mod/assign','locallib.php',8075],['lib','completionlib.php',657]], 29],
'chat_login_user': ['chat_login_user', 'login if not already logged in ', [['mod/chat','lib.php',504]], 7],
'get_field_select': ['get_field_select', 'Get a single field value from a table record which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1563]], 49],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 556],
'add_class': ['add_class', 'Adds a CSS class to this action link object ', [['lib','outputcomponents.php',1040],['lib','outputcomponents.php',1787],['lib','outputcomponents.php',2596],['lib','navigationlib.php',458]], 33],
'chat_reset_course_form_definition': ['chat_reset_course_form_definition', 'Implementation of the function for printing the form elements that control whether the course reset functionality affects the chat. ', [['mod/chat','lib.php',1122]], 0],
'delete_records_select': ['delete_records_select', '', [['lib/dml','pdo_moodle_database.php',208],['lib/dml','oci_native_moodle_database.php',1495],['lib/dml','pgsql_native_moodle_database.php',1162],['lib/dml','mssql_native_moodle_database.php',1146],['lib/dml','mysqli_native_moodle_database.php',1477],['lib/dml','sqlsrv_native_moodle_database.php',1220],['lib/dml/tests','dml_test.php',5553]], 163],
'chat_user_logout': ['chat_user_logout', 'user logout event handler ', [['mod/chat','lib.php',1290]], 0],
'fields': ['fields', '', [['lib/adodb/drivers','adodb-odbtp.inc.php',720],['lib/adodb/drivers','adodb-sqlite3.inc.php',403],['mod/quiz/classes','admin_review_setting.php',65],['lib/adodb/drivers','adodb-ibase.inc.php',865],['lib/adodb/drivers','adodb-postgres64.inc.php',968],['lib/adodb/drivers','adodb-odbc.inc.php',644],['lib/adodb/drivers','adodb-sqlite.inc.php',420],['lib/adodb/drivers','adodb-pdo.inc.php',742],['lib','outputcomponents.php',235],['lib/adodb/drivers','adodb-oci8po.inc.php',104],['lib/adodb/drivers','adodb-mssql.inc.php',906],['lib/adodb/drivers','adodb-mysql.inc.php',774],['lib/adodb/drivers','adodb-mssqlnative.inc.php',895],['lib/adodb/drivers','adodb-oracle.inc.php',267],['lib/adodb','adodb.inc.php',3781],['lib/adodb','adodb.inc.php',4459],['lib/adodb/drivers','adodb-ado5.inc.php',412],['lib/adodb/drivers','adodb-db2.inc.php',756],['lib/adodb/drivers','adodb-oci8.inc.php',1701],['lib/adodb/drivers','adodb-mysqli.inc.php',973],['lib/adodb/drivers','adodb-ado.inc.php',375],['lib/adodb/drivers','adodb-ads.inc.php',690]], 156],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'heading': ['heading', 'Outputs a heading ', [['lib','outputrenderers.php',3072],['lib','outputrenderers.php',4364],['lib','outputrenderers.php',4552],['grade/report/singleview/classes/local/screen','screen.php',197],['grade/report/singleview/classes/local/screen','user.php',264],['grade/report/singleview/classes/local/screen','grade.php',283]], 796],
'current_language': ['current_language', 'Returns the code for the current language ', [['lib','moodlelib.php',6589]], 44],
'chat_reset_course_form_defaults': ['chat_reset_course_form_defaults', 'Course reset form defaults. ', [['mod/chat','lib.php',1133]], 0],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
's': ['s', 'Count of attempts selected by $this->whichattempts ', [['mod/quiz/report/statistics/classes','calculated.php',91],['lib','weblib.php',84]], 1072],
'chat_refresh_events': ['chat_refresh_events', 'This standard function will check all instances of this module and make sure there are up-to-date events created for each of them. If courseid = 0, then every chat event in the site is checked, else only chat events belonging to the course specified are checked. This function is used, in its new format, by restore_refresh_events() ', [['mod/chat','lib.php',392]], 0],
'groups_get_activity_groupmode': ['groups_get_activity_groupmode', 'Returns effective groupmode used in activity, course setting overrides activity setting if groupmodeforce enabled. ', [['lib','grouplib.php',468]], 136],
'userdate': ['userdate', 'Returns a formatted string that represents a date in user time. ', [['lib','moodlelib.php',2155],['lib/adodb','adodb.inc.php',2842],['lib/adodb','adodb.inc.php',3569]], 525],
'chat_print_error': ['chat_print_error', 'Print json format error ', [['mod/chat','lib.php',1040]], 0],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'chat_print_overview': ['chat_print_overview', '', [['mod/chat','lib.php',1090]], 0],
'json_encode': ['json_encode', 'encodes an arbitrary variable into JSON format ', [['lib/minify/lib','FirePHP.php',1124]], 307],
'chat_supports': ['chat_supports', '', [['mod/chat','lib.php',1193]], 0],
'getremoteaddr': ['getremoteaddr', 'Returns most reliable client address ', [['lib','moodlelib.php',8569]], 61],
'execute': ['execute', 'Run langpack update ', [['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['backup/converter/imscc1','lib.php',84],['lib/classes/task','blog_cron_task.php',40],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/dml','pdo_moodle_database.php',227],['lib/classes/task','tag_cron_task.php',42],['enrol/imsenterprise/classes/task','cron_task.php',43],['lib/classes/task','completion_daily_task.php',42],['lib/google/src/Google/Http','Batch.php',61],['lib/dml','oci_native_moodle_database.php',1048],['lib/classes/task','context_cleanup_task.php',41],['backup/util/plan','backup_structure_step.class.php',50],['backup/util/ui','restore_ui.class.php',206],['webservice','lib.php',1319],['lib/classes/task','stats_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['lib/classes/task','legacy_plugin_cron_task.php',42],['backup/moodle2','restore_activity_task.class.php',189],['lib/classes/task','portfolio_cron_task.php',40],['lib/google/src/Google/Http','REST.php',27],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['backup/converter/imscc11','backuplib.php',42],['lib/classes/task','question_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',62],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/adodb/drivers','adodb-pdo.inc.php',559],['lib/editor/atto/classes/task','autosave_cleanup_task.php',42],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',43],['lib/classes/task','completion_regular_task.php',42],['lib/adodb/drivers','adodb-oci8po.inc.php',54],['lib/classes/task','events_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',47],['auth/cas/classes/task','sync_task.php',43],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',43],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['backup/util/helper','restore_decode_processor.class.php',73],['lib/behat','behat_base.php',840],['enrol/flatfile/classes/task','flatfile_sync_task.php',46],['lib/classes/task','registration_cron_task.php',40],['backup/moodle2','backup_section_task.class.php',97],['lib/classes/task','check_for_updates_task.php',40],['backup/util/plan/tests/fixtures','plan_fixtures.php',48],['backup/util/plan/tests/fixtures','plan_fixtures.php',56],['mod/forum/classes/task','cron_task.php',39],['lib/classes/task','send_failed_login_notifications_task.php',43],['enrol/lti/classes/task','sync_grades.php',45],['lib/dml','pgsql_native_moodle_database.php',665],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/classes/update','validator.php',117],['lib/google/src/Google','Client.php',574],['lib/dml','mssql_native_moodle_database.php',711],['mod/lti/service/profile/classes/local/resource','profile.php',76],['backup/util/plan','backup_plan.class.php',112],['lib/dml','mysqli_native_moodle_database.php',963],['backup/util/ui','backup_ui.class.php',122],['admin/tool/monitor/classes/task','clean_events.php',41],['backup/converter/moodle1','backuplib.php',10],['backup/converter/imscc11','lib.php',85],['lib/classes/task','grade_cron_task.php',40],['lib/classes/task','file_temp_cleanup_task.php',40],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['filter/tex','latex.php',70],['lib/adodb','adodb.inc.php',1088],['lib/classes/task','plagiarism_cron_task.php',40],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['backup/converter/moodle1','lib.php',142],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','search_index_task.php',44],['enrol/lti/classes/task','sync_members.php',55],['lib/classes/task','session_cleanup_task.php',40],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['lib/classes/task','backup_cleanup_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','badges_cron_task.php',40],['admin/tool/uploadcourse/classes','processor.php',174],['lib/classes/task','calendar_cron_task.php',40],['backup/util/plan','base_plan.class.php',158],['auth/ldap/classes/task','sync_task.php',43],['lib/adodb/drivers','adodb-oci8.inc.php',920],['backup/util/plan','restore_plan.class.php',159],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['lib/dml','sqlsrv_native_moodle_database.php',795],['lib/classes/task','create_contexts_task.php',40],['lib/classes/task','file_trash_cleanup_task.php',40],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',46],['lib/classes/task','complete_plans_task.php',52],['lib/classes/task','messaging_cleanup_task.php',40],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','cache_cleanup_task.php',40],['backup/moodle2','backup_activity_task.class.php',211],['filter/tex','texdebug.php',287],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','search_optimize_task.php',47],['mod/assign','adminlib.php',342],['lib/classes/task','delete_incomplete_users_task.php',40],['lib/classes/task','automated_backup_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','restore_execution_step.class.php',25],['lib/classes/task','sync_plans_from_template_cohorts_task.php',50],['admin/tool/monitor/classes','notification_task.php',39],['lib/dml/tests','dml_test.php',5543],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',60],['admin/tool/monitor/classes/task','check_subscriptions.php',60],['backup/util/interfaces','executable.class.php',32],['backup/util/plan','base_task.class.php',162]], 1058],
'chat_get_extra_capabilities': ['chat_get_extra_capabilities', 'Returns all other caps used in module ', [['mod/chat','lib.php',1179]], 0],
'update': ['update', 'In addition to update() as defined in grade_object, handle the grade_outcome and grade_scale objects. Force regrading if necessary, rounds the float numbers using php function, the reason is we need to compare the db value with computed number to skip regrading if possible. ', [['lib/grade','grade_item.php',274],['lib/google/src/Google/Service','Tasks.php',386],['lib/google/src/Google/Service','Tasks.php',556],['lib/google/src/Google/Service','AndroidPublisher.php',1413],['lib/google/src/Google/Service','AndroidPublisher.php',1545],['lib/google/src/Google/Service','AndroidPublisher.php',1615],['lib/google/src/Google/Service','AndroidPublisher.php',1853],['lib/google/src/Google/Service','AndroidPublisher.php',1919],['lib/google/src/Google/Service','AndroidPublisher.php',2003],['lib/google/src/Google/Service','AndroidPublisher.php',2177],['lib/google/src/Google/Service','Reseller.php',344],['lib/grade','grade_category.php',226],['lib/grade','grade_scale.php',125],['lib/adodb','adodb-active-record.inc.php',1004],['lib/grade','grade_object.php',238],['lib/google/src/Google/Service','YouTubeAnalytics.php',534],['completion','data_object.php',252],['mod/lesson/pagetypes','matching.php',308],['tag/classes','collection.php',215],['lib/google/src/Google/Service','AdExchangeBuyer.php',802],['lib/google/src/Google/Service','AdExchangeBuyer.php',906],['lib/google/src/Google/Service','AdExchangeBuyer.php',1013],['lib/google/src/Google/Service','AdExchangeBuyer.php',1181],['lib/google/src/Google/Service','AdExchangeBuyer.php',1357],['lib/google/src/Google/Service','AdExchangeBuyer.php',1640],['lib/google/src/Google/Service','Books.php',2025],['lib/grade','grade_grade.php',1009],['lib/grade','grade_outcome.php',144],['lib/google/src/Google/Service','Analytics.php',2215],['lib/google/src/Google/Service','Analytics.php',2388],['lib/google/src/Google/Service','Analytics.php',2501],['lib/google/src/Google/Service','Analytics.php',2626],['lib/google/src/Google/Service','Analytics.php',2736],['lib/google/src/Google/Service','Analytics.php',2843],['lib/google/src/Google/Service','Analytics.php',2971],['lib/google/src/Google/Service','Analytics.php',3062],['lib/google/src/Google/Service','Analytics.php',3185],['lib/google/src/Google/Service','Analytics.php',3502],['lib/google/src/Google/Service','Analytics.php',3604],['lib/google/src/Google/Service','Analytics.php',3686],['lib/google/src/Google/Service','Coordinate.php',611],['lib/google/src/Google/Service','Coordinate.php',727],['lib/google/src/Google/Service','DeploymentManager.php',589],['tag/classes/output','tagareacollection.php',68],['lib','weblib.php',3312],['lib/google/src/Google/Service','Blogger.php',1349],['lib/google/src/Google/Service','Blogger.php',1647],['lib/google/src/Google/Service','Dataflow.php',350],['tag/classes/output','tagcollname.php',58],['competency/classes','persistent.php',452],['lib/google/src/Google/Service','Cloudresourcemanager.php',344],['lib/google/src/Google/Service','Cloudresourcemanager.php',555],['lib/google/src/Google/Service','TagManager.php',977],['lib/google/src/Google/Service','TagManager.php',1066],['lib/google/src/Google/Service','TagManager.php',1159],['lib/google/src/Google/Service','TagManager.php',1219],['lib/google/src/Google/Service','TagManager.php',1311],['lib/google/src/Google/Service','TagManager.php',1405],['lib/google/src/Google/Service','TagManager.php',1499],['lib/google/src/Google/Service','TagManager.php',1650],['lib/google/src/Google/Service','TagManager.php',1743],['mod/lesson','locallib.php',2691],['lib/google/src/Google/Service','Bigquery.php',621],['lib/google/src/Google/Service','Bigquery.php',953],['lib/google/src/Google/Service','ShoppingContent.php',1136],['lib/google/src/Google/Service','ShoppingContent.php',1238],['lib/google/src/Google/Service','ShoppingContent.php',1401],['lib/google/src/Google/Service','ShoppingContent.php',1534],['mod/lesson/pagetypes','truefalse.php',163],['lib/google/src/Google/Service','Clouddebugger.php',307],['lib/filestorage','stored_file.php',103],['lib/google/src/Google/Service','Container.php',366],['lib/horde/framework/Horde/Support','Array.php',70],['lib/google/src/Google/Service','Storage.php',1127],['lib/google/src/Google/Service','Storage.php',1268],['lib/google/src/Google/Service','Storage.php',1423],['lib/google/src/Google/Service','Storage.php',1564],['lib/google/src/Google/Service','Storage.php',1904],['tag/classes/output','tagname.php',56],['tag/classes/output','tagcollsearchable.php',72],['lib/google/src/Google/Service','Games.php',1508],['lib/google/src/Google/Service','Licensing.php',335],['lib/google/src/Google/Service','Fitness.php',478],['lib/google/src/Google/Service','Fitness.php',691],['lib/google/src/Google/Service','Gmail.php',833],['lib/google/src/Google/Service','Gmail.php',986],['lib/google/src/Google/Service','Taskqueue.php',398],['lib/adodb','adodb-active-recordx.inc.php',1136],['grade/grading/form','lib.php',905],['lib/google/src/Google/Service','Doubleclicksearch.php',326],['lib/google/src/Google/Service','Autoscaler.php',400],['tag/classes/output','tagisstandard.php',70],['lib/google/src/Google/Service','Prediction.php',339],['lib/google/src/Google/Service','SiteVerification.php',227],['lib/google/src/Google/Service','Drive.php',1691],['lib/google/src/Google/Service','Drive.php',1961],['lib/google/src/Google/Service','Drive.php',2208],['lib/google/src/Google/Service','Drive.php',2320],['lib/google/src/Google/Service','Drive.php',2370],['lib/google/src/Google/Service','Drive.php',2494],['lib/google/src/Google/Service','Drive.php',2582],['tag/classes/output','tagflag.php',71],['lib/google/src/Google/Service','Proximitybeacon.php',440],['lib/google/src/Google/Service','Groupssettings.php',138],['lib/google/src/Google/Service','Directory.php',1829],['lib/google/src/Google/Service','Directory.php',1889],['lib/google/src/Google/Service','Directory.php',2141],['lib/google/src/Google/Service','Directory.php',2306],['lib/google/src/Google/Service','Directory.php',2489],['lib/google/src/Google/Service','Directory.php',2597],['lib/google/src/Google/Service','Directory.php',2808],['lib/google/src/Google/Service','Directory.php',2910],['lib/google/src/Google/Service','Directory.php',3131],['lib/google/src/Google/Service','Directory.php',3317],['lib/google/src/Google/Service','Fusiontables.php',727],['lib/google/src/Google/Service','Fusiontables.php',892],['lib/google/src/Google/Service','Fusiontables.php',1094],['lib/google/src/Google/Service','Fusiontables.php',1269],['lib/google/src/Google/Service','AdSenseHost.php',846],['lib/google/src/Google/Service','AdSenseHost.php',1097],['course/classes/output','course_module_name.php',81],['lib/google/src/Google/Service','Mirror.php',496],['lib/google/src/Google/Service','Mirror.php',634],['lib/google/src/Google/Service','Mirror.php',745],['tag/classes','area.php',226],['lib/google/src/Google/Service','AndroidEnterprise.php',1064],['lib/google/src/Google/Service','AndroidEnterprise.php',1165],['lib/google/src/Google/Service','AndroidEnterprise.php',1489],['lib/google/src/Google/Service','AndroidEnterprise.php',1672],['grade/grading/form/rubric','lib.php',828],['lib/xhprof/xhprof_html/jquery','jquery.tooltip.js',200],['mod/lesson/pagetypes','essay.php',158],['lib','coursecatlib.php',438],['tag/classes','tag.php',893],['lib/google/src/Google/Service','Calendar.php',1006],['lib/google/src/Google/Service','Calendar.php',1181],['lib/google/src/Google/Service','Calendar.php',1333],['lib/google/src/Google/Service','Calendar.php',1714],['lib/google/src/Google/Service','PlusDomains.php',692],['lib/google/src/Google/Service','GamesConfiguration.php',334],['lib/google/src/Google/Service','GamesConfiguration.php',473],['mod/lesson/pagetypes','branchtable.php',262],['tag/classes/output','tagareashowstandard.php',64],['lib/google/src/Google/Service','AppState.php',202],['calendar','lib.php',2206],['tag/classes/output','tagareaenabled.php',69],['cohort/classes/output','cohortidnumber.php',53],['lib/google/src/Google/Service','Classroom.php',564],['cohort/classes/output','cohortname.php',53],['lib/google/src/Google/Service','SQLAdmin.php',947],['lib/google/src/Google/Service','SQLAdmin.php',1267],['lib/google/src/Google/Service','SQLAdmin.php',1534],['grade/grading/form/guide','lib.php',836],['lib/google/src/Google/Service','Compute.php',4253],['lib/google/src/Google/Service','Compute.php',4398],['lib/google/src/Google/Service','Compute.php',4767],['lib/google/src/Google/Service','Compute.php',5348],['lib/google/src/Google/Service','Compute.php',5478],['lib/google/src/Google/Service','Compute.php',8131],['lib/google/src/Google/Service','YouTube.php',1959],['lib/google/src/Google/Service','YouTube.php',2194],['lib/google/src/Google/Service','YouTube.php',2303],['lib/google/src/Google/Service','YouTube.php',2429],['lib/google/src/Google/Service','YouTube.php',2570],['lib/google/src/Google/Service','YouTube.php',3111],['lib/google/src/Google/Service','YouTube.php',3348],['lib/google/src/Google/Service','YouTube.php',3518],['lib/google/src/Google/Service','YouTube.php',3708],['lib/google/src/Google/Service','YouTube.php',4400],['lib/google/src/Google/Service','Dfareporting.php',4752],['lib/google/src/Google/Service','Dfareporting.php',4840],['lib/google/src/Google/Service','Dfareporting.php',4973],['lib/google/src/Google/Service','Dfareporting.php',5090],['lib/google/src/Google/Service','Dfareporting.php',5204],['lib/google/src/Google/Service','Dfareporting.php',5400],['lib/google/src/Google/Service','Dfareporting.php',5656],['lib/google/src/Google/Service','Dfareporting.php',5848],['lib/google/src/Google/Service','Dfareporting.php',5970],['lib/google/src/Google/Service','Dfareporting.php',6078],['lib/google/src/Google/Service','Dfareporting.php',6196],['lib/google/src/Google/Service','Dfareporting.php',6502],['lib/google/src/Google/Service','Dfareporting.php',6704],['lib/google/src/Google/Service','Dfareporting.php',6834],['lib/google/src/Google/Service','Dfareporting.php',6912],['lib/google/src/Google/Service','Dfareporting.php',7077],['lib/google/src/Google/Service','Dfareporting.php',7476],['lib/google/src/Google/Service','Dfareporting.php',7594],['lib/google/src/Google/Service','Dfareporting.php',7744],['lib/google/src/Google/Service','Dfareporting.php',7968],['lib/google/src/Google/Service','Dfareporting.php',8075],['lib/google/src/Google/Service','Dfareporting.php',8202],['lib/google/src/Google/Service','Dfareporting.php',8394],['lib/google/src/Google/Service','Dfareporting.php',8557],['lib/google/src/Google/Service','Dfareporting.php',8861],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',72]], 498],
'chat_format_message_manually': ['chat_format_message_manually', '', [['mod/chat','lib.php',704]], 2],
'add': ['add', 'Add HashTable item ', [['lib/phpexcel/PHPExcel','HashTable.php',78],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',95],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',109],['lib/google/src/Google/Http','Batch.php',52],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',37],['lib','csslib.php',1508],['lib/horde/framework/Horde/Mail/Rfc822','List.php',116],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',33],['lib/horde/framework/Horde/Support','ConsistentHash.php',148],['lib/horde/framework/Horde','Variables.php',297],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',29],['lib','outputcomponents.php',2705],['lib','outputcomponents.php',3380],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',436],['lib','adminlib.php',735],['lib','adminlib.php',894],['lib','adminlib.php',1446],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',27],['lib/xhprof/xhprof_html/jquery','jquery-1.2.6.js',3450],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',80],['lib/google/src/Google/Service','Webmasters.php',436],['lib','navigationlib.php',304],['lib','navigationlib.php',761],['lib','navigationlib.php',3305],['lib','navigationlib.php',3583],['lib/horde/framework/Horde/Imap/Client','Ids.php',155],['backup/cc/cc_lib/gral_lib','cssparser.php',121],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',428],['lib/horde/framework/Horde','Stream.php',116],['comment','lib.php',679],['lib/mustache/src/Mustache','HelperCollection.php',56],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',207],['backup/cc/cc_lib','cc_utils.php',395],['backup/cc/cc_lib','cc_utils.php',454],['lib/lessphp/Output','Mapped.php',50],['lib','licenselib.php',32],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',50],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',74],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',14],['lib/horde/framework/Horde/Mail/Rfc822','GroupList.php',25],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',31],['tag/classes','tag.php',152],['blog','locallib.php',242],['lib/classes','notification.php',50],['lib/lessphp','Output.php',18],['tag/classes/output','tagfeed.php',61],['backup/cc','validator.php',51],['lib/horde/framework/Horde/Stream','TempString.php',118],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',11]], 6188],
'chat_get_view_actions': ['chat_get_view_actions', 'List the actions that correspond to a view of this module. This is used by the participation report. ', [['mod/chat','lib.php',1056]], 0],
'render': ['render', 'Renders this element ', [['lib/classes/output','inplace_editable.php',238],['lib/adodb','adodb-pager.inc.php',241],['lib/phpexcel/PHPExcel','Chart.php',656],['lib','formslib.php',948],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/fullscreen','fullscreen.htm',82],['lib','outputrenderers.php',170],['lib','outputrenderers.php',302],['question/behaviour','behaviourbase.php',97],['lib/htmlpurifier/HTMLPurifier/Printer','HTMLDefinition.php',15],['lib/htmlpurifier/HTMLPurifier/Printer','CSSDefinition.php',14],['filter/tex','latex.php',88],['lib','portfoliolib.php',241],['mod/quiz/classes/question/bank','custom_view.php',133],['lib/mustache/src/Mustache','Engine.php',204],['question/engine/tests','helpers.php',797],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',85],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',235],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',298],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',391],['lib/mustache/src/Mustache','Template.php',57],['lib/phpexcel/PHPExcel/Chart/Renderer','jpgraph.php',790],['question/engine','questionattempt.php',814],['lib/mustache/src/Mustache','LambdaHelper.php',39]], 942],
'get_groups': ['get_groups', 'Returns groups that the current user belongs to on the course. Note: If not already available, this may make a database query. ', [['lib','modinfolib.php',289],['group','externallib.php',164]], 29],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'empty_field_and_submit': ['empty_field_and_submit', '', [['mod/chat','lib.php',71],['mod/chat/gui_sockets','chat_gui_sockets.js',2]], 1],
'chat_format_message_theme': ['chat_format_message_theme', '', [['mod/chat','lib.php',873]], 1],
'get_record_select': ['get_record_select', 'Get a single database record as an object which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1481]], 19],
'chat_add_instance': ['chat_add_instance', 'Given an object containing all the necessary data, (defined by the form in mod_form.php) this function will create a new instance and return the id number of the new instance. ', [['mod/chat','lib.php',99]], 0],
'load': ['load', 'Load the class from cache using `require_once`. ', [['lib/mustache/src/Mustache/Cache','FilesystemCache.php',39],['lib/phpexcel/PHPExcel/Reader','Excel2007.php',320],['lib/phpexcel/PHPExcel/Reader','OOCalc.php',284],['lib/pear/HTML/QuickForm','select.php',430],['lib/phpexcel/PHPExcel/Reader','Excel5.php',612],['lib/mustache/src/Mustache/Cache','NoopCache.php',20],['lib/adodb','adodb-active-record.inc.php',775],['backup/cc/cc_lib','xmlbase.php',92],['lib/mustache/src/Mustache/Loader','FilesystemLoader.php',69],['lib/simplepie/library/SimplePie/Cache','File.php',118],['lib/mustache/src/Mustache/Loader','CascadingLoader.php',48],['lib/phpexcel/PHPExcel','Autoloader.php',58],['lib/phpexcel/PHPExcel/Reader','IReader.php',38],['grade/grading','lib.php',227],['mod/lesson','locallib.php',1022],['mod/lesson','locallib.php',2240],['mod/lesson','locallib.php',3200],['lib/phpexcel/PHPExcel','IOFactory.php',180],['lib/mustache/src/Mustache','Cache.php',20],['lib','outputlib.php',432],['cache/classes','definition.php',335],['lib/phpexcel/PHPExcel/Reader/Excel5','Escher.php',87],['lib/adodb','adodb-active-recordx.inc.php',813],['lib/simplepie/library/SimplePie/Cache','Base.php',87],['lib/phpexcel/PHPExcel/Reader','HTML.php',143],['lib/simplepie/library/SimplePie/Cache','MySQL.php',286],['lib/mustache/src/Mustache/Loader','InlineLoader.php',87],['lib/mustache/src/Mustache','Loader.php',17],['lib/phpexcel/PHPExcel/Reader','CSV.php',203],['lib/simplepie/library/SimplePie/Cache','Memcache.php',123],['lib/mustache/src/Mustache/Loader','StringLoader.php',28],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',44],['lib/phpunit/classes','autoloader.php',46],['lib/phpexcel/PHPExcel/Reader','Excel2003XML.php',216],['lib/htmlpurifier/HTMLPurifier','Language.php',69],['lib/phpexcel/PHPExcel/Reader','SYLK.php',190],['calendar','lib.php',2666],['lib/phpexcel/PHPExcel/Reader','Gnumeric.php',189],['lib/mustache/src/Mustache/Loader','ArrayLoader.php',41],['cache/classes','config.php',128]], 190],
'chat_delete_old_users': ['chat_delete_old_users', 'Delete the old and in the way ', [['mod/chat','lib.php',568]], 11],
'fullname': ['fullname', 'Returns a persons full name ', [['lib','moodlelib.php',3249],['mod/assign','locallib.php',3915]], 546],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'chat_print_recent_activity': ['chat_print_recent_activity', 'Given a course and a date, prints a summary of all chat rooms past and present This function is called from block_recent_activity ', [['mod/chat','lib.php',205]], 0],
'padding': ['padding', '', [['mod/chat','lib.php',91]], 4],
'format_time': ['format_time', 'Format a date/time (seconds) as weeks, days, hours etc as needed ', [['lib','moodlelib.php',2065]], 70],
'chat_page_type_list': ['chat_page_type_list', 'Return a list of page types ', [['mod/chat','lib.php',1301]], 0],
'get_renderer': ['get_renderer', 'Returns instance of page renderer used by this plugin ', [['course/format','lib.php',905],['question/type/multichoice','question.php',156],['question/type/multichoice','question.php',278],['question/behaviour','behaviourbase.php',135],['question/type','questionbase.php',275],['lib','pagelib.php',802],['lib','outputlib.php',1828],['lib','outputfactories.php',70],['lib','outputfactories.php',292],['lib','outputfactories.php',377],['mod/assign','locallib.php',2987],['grade/grading/form/rubric','lib.php',486],['lib/tests/fixtures','test_renderer_factory.php',49],['grade/grading/form/guide','lib.php',492]], 452],
'chat_format_message': ['chat_format_message', 'Given a message object this function formats it appropriately into text and html then returns the formatted data ', [['mod/chat','lib.php',840]], 5],
'usertimezone': ['usertimezone', 'Returns a string that prints the user\'s timezone ', [['lib','moodlelib.php',2271]], 9],
'get_records_select': ['get_records_select', 'Load a list of records based on a select query. ', [['competency/classes','persistent.php',751],['lib/dml','moodle_database.php',1332]], 166],
'move': ['move', 'Moves the specified task to another position in the task list. This can include putting it as a child task under a new parent and/or move it to a different position among its sibling tasks. (tasks.move) ', [['lib/google/src/Google/Service','Tasks.php',516],['mod/chat','lib.php',39],['mod/lesson','locallib.php',2338],['lib/adodb','adodb.inc.php',3720],['lib/google/src/Google/Service','Calendar.php',1639],['lib','webdavlib.php',531]], 50],
'chat_format_userlist': ['chat_format_userlist', '', [['mod/chat','lib.php',1026]], 2],
'focus': ['focus', 'To autofocus on first form element or first element with error. ', [['lib','formslib.php',239]], 962],
'shift_course_mod_dates': ['shift_course_mod_dates', 'Change dates in module - used from course reset. ', [['lib','moodlelib.php',5026]], 10],
'chat_reset_userdata': ['chat_reset_userdata', 'Actual implementation of the reset course functionality, delete all the chat messages for course $data->courseid. ', [['mod/chat','lib.php',1143]], 0],
'chat_cron': ['chat_cron', 'Function to be run periodically according to the moodle cron This function searches for things that need to be done, such as sending out mail, toggling flags etc ... ', [['mod/chat','lib.php',357]], 0],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'get_fast_modinfo': ['get_fast_modinfo', 'Returns reference to full info about modules in course (including visibility). Cached and as fast as possible (0 or 1 db query). ', [['lib','modinfolib.php',1977]], 289],
'open': ['open', 'Open or create archive (depending on $mode). ', [['lib/filestorage','zip_archive.php',73],['auth/fc','fcFPP.php',48],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/searchreplace','editor_plugin_src.js',14],['lib/spout/src/Spout/Reader','ReaderInterface.php',12],['auth/cas/CAS/CAS/ProxiedService','Imap.php',179],['lib/tcpdf','tcpdf.php',2931],['lib/google/src/Google/Logger','File.php',96],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',56],['lib/spout/src/Spout/Reader/Wrapper','XMLReader.php',17],['lib/spout/src/Spout/Reader','AbstractReader.php',61],['lib/pear/Net','GeoIP.php',400],['lib/pear/Auth','RADIUS.php',271],['lib/pear/Auth','RADIUS.php',593],['lib/pear/Auth','RADIUS.php',898],['lib','webdavlib.php',156]], 261],
'chat_get_latest_message': ['chat_get_latest_message', '', [['mod/chat','lib.php',485]], 4],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'chat_get_post_actions': ['chat_get_post_actions', 'List the actions that correspond to a post of this module. This is used by the participation report. ', [['mod/chat','lib.php',1070]], 0],
'chat_send_chatmessage': ['chat_send_chatmessage', 'Send a message on the chat. ', [['mod/chat','lib.php',649]], 14],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'chat_update_instance': ['chat_update_instance', 'Given an object containing all the necessary data, (defined by the form in mod_form.php) this function will update an existing instance with new data. ', [['mod/chat','lib.php',133]], 0],
'ob_end_flush': ['ob_end_flush', '', [], 18],
'array_key_exists': ['array_key_exists', '', [], 1445],
'header': ['header', '', [], 1355],
'preg_match': ['preg_match', '', [], 1286],
'strip_tags': ['strip_tags', '', [], 150],
'floor': ['floor', '', [], 514],
'defined': ['defined', '', [], 4731],
'max': ['max', '', [], 1266],
'ob_get_length': ['ob_get_length', '', [], 7],
'substr': ['substr', '', [], 2823],
'implode': ['implode', '', [], 1281],
'is_array': ['is_array', '', [], 1608],
'is_numeric': ['is_numeric', '', [], 672],
'count': ['count', '', [], 4095],
'file_exists': ['file_exists', '', [], 867],
'time': ['time', '', [], 1959],
'trim': ['trim', '', [], 1948]};
CLASS_DATA={
'event_message': ['event_message', 'A chat event such a user entering or leaving a chat activity ', [['mod/chat','locallib.php',157]], 1],
'calendar_event': ['calendar_event', 'Manage calendar events ', [['calendar','lib.php',1951]], 75],
'navigation_node': ['navigation_node', 'This class is used to represent a node in a navigation tree ', [['lib','navigationlib.php',34]], 348],
'user_message': ['user_message', 'A chat message from a user ', [['mod/chat','locallib.php',199]], 1],
'core_date': ['core_date', 'Core date and time related code. ', [['lib/classes','date.php',26]], 192],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',238]], 3088],
'completion_info': ['completion_info', 'Class represents completion information for a course. ', [['lib','completionlib.php',210]], 141],
'action_link': ['action_link', 'Data structure describing html link with special action attached. ', [['lib','outputcomponents.php',973]], 16],
'popup_action': ['popup_action', 'Component action for a popup window. ', [['lib','outputactions.php',114]], 31],
'pix_icon': ['pix_icon', 'Data structure representing an icon. ', [['lib','outputcomponents.php',497]], 275],
'message_sent': ['message_sent', 'The mod_chat message sent event class. ', [['mod/chat/classes/event','message_sent.php',28],['lib/classes/event','message_sent.php',29]], 4],
'user_picture': ['user_picture', 'Data structure representing a user picture. ', [['lib','outputcomponents.php',142]], 165],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',7039]], 1106],
'course_module_viewed': ['course_module_viewed', 'The mod_page course module viewed event class. ', [['mod/page/classes/event','course_module_viewed.php',28],['mod/chat/classes/event','course_module_viewed.php',29],['mod/quiz/classes/event','course_module_viewed.php',29],['mod/data/classes/event','course_module_viewed.php',30],['mod/choice/classes/event','course_module_viewed.php',28],['mod/forum/classes/event','course_module_viewed.php',29],['mod/resource/classes/event','course_module_viewed.php',29],['mod/book/classes/event','course_module_viewed.php',28],['mod/imscp/classes/event','course_module_viewed.php',30],['mod/lti/classes/event','course_module_viewed.php',29],['mod/feedback/classes/event','course_module_viewed.php',28],['mod/survey/classes/event','course_module_viewed.php',29],['mod/folder/classes/event','course_module_viewed.php',29],['mod/glossary/classes/event','course_module_viewed.php',28],['mod/scorm/classes/event','course_module_viewed.php',28],['mod/url/classes/event','course_module_viewed.php',29],['mod/wiki/classes/event','course_module_viewed.php',28],['lib/tests/fixtures','event_fixtures.php',232],['mod/lesson/classes/event','course_module_viewed.php',30],['mod/workshop/classes/event','course_module_viewed.php',32]], 37]};
CONST_DATA={
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 315],
'FEATURE_SHOW_DESCRIPTION': ['FEATURE_SHOW_DESCRIPTION', '', [['lib','moodlelib.php',437]], 22],
'FORMAT_MOODLE': ['FORMAT_MOODLE', '', [['lib','weblib.php',42]], 506],
'FEATURE_MOD_INTRO': ['FEATURE_MOD_INTRO', '', [['lib','moodlelib.php',426]], 31],
'FEATURE_GRADE_OUTCOMES': ['FEATURE_GRADE_OUTCOMES', '', [['lib','moodlelib.php',396]], 23],
'FEATURE_COMPLETION_TRACKS_VIEWS': ['FEATURE_COMPLETION_TRACKS_VIEWS', '', [['lib','moodlelib.php',405]], 23],
'FEATURE_GRADE_HAS_GRADE': ['FEATURE_GRADE_HAS_GRADE', '', [['lib','moodlelib.php',394]], 29],
'FEATURE_BACKUP_MOODLE2': ['FEATURE_BACKUP_MOODLE2', '', [['lib','moodlelib.php',434]], 35],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'SEPARATEGROUPS': ['SEPARATEGROUPS', '', [['lib','grouplib.php',34]], 190],
'FEATURE_GROUPS': ['FEATURE_GROUPS', '', [['lib','moodlelib.php',414]], 25],
'FEATURE_GROUPINGS': ['FEATURE_GROUPINGS', '', [['lib','moodlelib.php',416]], 23]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
