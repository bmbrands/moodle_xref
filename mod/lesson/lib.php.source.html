<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mod/lesson/lib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='mod/lesson';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mod/lesson/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">//</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">//</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">//</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Standard library of functions and constants for lesson</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package mod_lesson</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @copyright  1999 onwards Martin Dougiamas  {@link http://moodle.com}</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> **/</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment">/* Do not include any libraries here! */</span>
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">/**</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * Given an object containing all the necessary data,</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * (defined by the form in mod_form.php) this function</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * will create a new instance and return the id number</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * of the new instance.</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> *</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * @global object</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @global object</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> * @param object $lesson Lesson post data from the form</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * @return int</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> **/</span>
<a name="l41"><span class="linenum">  41</span></a>  function <a class="function" onClick="logFunction('lesson_add_instance')" href="../../_functions/lesson_add_instance.html" onMouseOver="funcPopup(event,'lesson_add_instance')">lesson_add_instance</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l42"><span class="linenum">  42</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l43"><span class="linenum">  43</span></a>  
<a name="l44"><span class="linenum">  44</span></a>      <a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> = <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>;
<a name="l45"><span class="linenum">  45</span></a>      <a class="var it2832" onMouseOver="hilite(2832)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a> = <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('mediafile')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/mediafile.html">mediafile</a>;
<a name="l46"><span class="linenum">  46</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>);
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>      <a class="function" onClick="logFunction('lesson_process_pre_save')" href="../../_functions/lesson_process_pre_save.html" onMouseOver="funcPopup(event,'lesson_process_pre_save')">lesson_process_pre_save</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l49"><span class="linenum">  49</span></a>  
<a name="l50"><span class="linenum">  50</span></a>      unset(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('mediafile')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/mediafile.html">mediafile</a>);
<a name="l51"><span class="linenum">  51</span></a>      <a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(&quot;lesson&quot;, <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l52"><span class="linenum">  52</span></a>      <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>;
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>      <a class="function" onClick="logFunction('lesson_update_media_file')" href="../../_functions/lesson_update_media_file.html" onMouseOver="funcPopup(event,'lesson_update_media_file')">lesson_update_media_file</a>(<a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2832" onMouseOver="hilite(2832)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>);
<a name="l55"><span class="linenum">  55</span></a>  
<a name="l56"><span class="linenum">  56</span></a>      <a class="function" onClick="logFunction('lesson_process_post_save')" href="../../_functions/lesson_process_post_save.html" onMouseOver="funcPopup(event,'lesson_process_post_save')">lesson_process_post_save</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>      <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>      return <a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>;
<a name="l61"><span class="linenum">  61</span></a>  }
<a name="l62"><span class="linenum">  62</span></a>  
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">/**</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment"> * Given an object containing all the necessary data,</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment"> * (defined by the form in mod_form.php) this function</span>
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment"> * will update an existing instance with new data.</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment"> *</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment"> * @global object</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment"> * @param object $lesson Lesson post data from the form</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment"> * @return boolean</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment"> **/</span>
<a name="l72"><span class="linenum">  72</span></a>  function <a class="function" onClick="logFunction('lesson_update_instance')" href="../../_functions/lesson_update_instance.html" onMouseOver="funcPopup(event,'lesson_update_instance')">lesson_update_instance</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l73"><span class="linenum">  73</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l74"><span class="linenum">  74</span></a>  
<a name="l75"><span class="linenum">  75</span></a>      <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('instance')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>;
<a name="l76"><span class="linenum">  76</span></a>      <a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> = <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>;
<a name="l77"><span class="linenum">  77</span></a>      <a class="var it2832" onMouseOver="hilite(2832)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a> = <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('mediafile')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/mediafile.html">mediafile</a>;
<a name="l78"><span class="linenum">  78</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>);
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>      <a class="function" onClick="logFunction('lesson_process_pre_save')" href="../../_functions/lesson_process_pre_save.html" onMouseOver="funcPopup(event,'lesson_process_pre_save')">lesson_process_pre_save</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l81"><span class="linenum">  81</span></a>  
<a name="l82"><span class="linenum">  82</span></a>      unset(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('mediafile')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/mediafile.html">mediafile</a>);
<a name="l83"><span class="linenum">  83</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>(&quot;lesson&quot;, <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>      <a class="function" onClick="logFunction('lesson_update_media_file')" href="../../_functions/lesson_update_media_file.html" onMouseOver="funcPopup(event,'lesson_update_media_file')">lesson_update_media_file</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2832" onMouseOver="hilite(2832)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>);
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>      <a class="function" onClick="logFunction('lesson_process_post_save')" href="../../_functions/lesson_process_post_save.html" onMouseOver="funcPopup(event,'lesson_process_post_save')">lesson_process_post_save</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l88"><span class="linenum">  88</span></a>  
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">    // update grade item definition</span>
<a name="l90"><span class="linenum">  90</span></a>      <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">    // update grades - TODO: do it only when grading style changes</span>
<a name="l93"><span class="linenum">  93</span></a>      <a class="function" onClick="logFunction('lesson_update_grades')" href="../../_functions/lesson_update_grades.html" onMouseOver="funcPopup(event,'lesson_update_grades')">lesson_update_grades</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, 0, false);
<a name="l94"><span class="linenum">  94</span></a>  
<a name="l95"><span class="linenum">  95</span></a>      return true;
<a name="l96"><span class="linenum">  96</span></a>  }
<a name="l97"><span class="linenum">  97</span></a>  
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">/**</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment"> * This function updates the events associated to the lesson.</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment"> * If $override is non-zero, then it updates only the events</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment"> * associated with the specified override.</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment"> *</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment"> * @uses LESSON_MAX_EVENT_LENGTH</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment"> * @param object $lesson the lesson object.</span>
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment"> * @param object $override (optional) limit to a specific override</span>
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment"> */</span>
<a name="l107"><span class="linenum"> 107</span></a>  function <a class="function" onClick="logFunction('lesson_update_events')" href="../../_functions/lesson_update_events.html" onMouseOver="funcPopup(event,'lesson_update_events')">lesson_update_events</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a> = null) {
<a name="l108"><span class="linenum"> 108</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l109"><span class="linenum"> 109</span></a>  
<a name="l110"><span class="linenum"> 110</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../calendar/lib.php.html">/calendar/lib.php</a>');
<a name="l111"><span class="linenum"> 111</span></a>  
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment">    // Load the old events relating to this lesson.</span>
<a name="l113"><span class="linenum"> 113</span></a>      <a class="var it23931" onMouseOver="hilite(23931)" onMouseOut="lolite()" onClick="logVariable('conds')" href="../../_variables/conds.html">$conds</a> = array('modulename' =&gt; 'lesson',
<a name="l114"><span class="linenum"> 114</span></a>                     'instance' =&gt; <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l115"><span class="linenum"> 115</span></a>      if (!empty(<a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>)) {
<a name="l116"><span class="linenum"> 116</span></a>  <span class="comment">        // Only load events for this override.</span>
<a name="l117"><span class="linenum"> 117</span></a>          if (isset(<a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a onClick="logVariable('userid')" class="var it40850" onMouseOver="hilite(40850)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>)) {
<a name="l118"><span class="linenum"> 118</span></a>              <a class="var it23931" onMouseOver="hilite(23931)" onMouseOut="lolite()" onClick="logVariable('conds')" href="../../_variables/conds.html">$conds</a>['userid'] = <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a onClick="logVariable('userid')" class="var it40850" onMouseOver="hilite(40850)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l119"><span class="linenum"> 119</span></a>          } else {
<a name="l120"><span class="linenum"> 120</span></a>              <a class="var it23931" onMouseOver="hilite(23931)" onMouseOut="lolite()" onClick="logVariable('conds')" href="../../_variables/conds.html">$conds</a>['groupid'] = <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a onClick="logVariable('groupid')" class="var it40850" onMouseOver="hilite(40850)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>;
<a name="l121"><span class="linenum"> 121</span></a>          }
<a name="l122"><span class="linenum"> 122</span></a>      }
<a name="l123"><span class="linenum"> 123</span></a>      <a class="var it24075" onMouseOver="hilite(24075)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('event', <a class="var it23931" onMouseOver="hilite(23931)" onMouseOut="lolite()" onClick="logVariable('conds')" href="../../_variables/conds.html">$conds</a>);
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">    // Now make a todo list of all that needs to be updated.</span>
<a name="l126"><span class="linenum"> 126</span></a>      if (empty(<a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>)) {
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment">        // We are updating the primary settings for the lesson, so we</span>
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">        // need to add all the overrides.</span>
<a name="l129"><span class="linenum"> 129</span></a>          <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('lesson_overrides', array('lessonid' =&gt; <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">        // As well as the original lesson (empty override).</span>
<a name="l131"><span class="linenum"> 131</span></a>          <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a>[] = new stdClass();
<a name="l132"><span class="linenum"> 132</span></a>      } else {
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">        // Just do the one override.</span>
<a name="l134"><span class="linenum"> 134</span></a>          <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a> = array(<a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>);
<a name="l135"><span class="linenum"> 135</span></a>      }
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>      foreach (<a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a> as <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>) {
<a name="l138"><span class="linenum"> 138</span></a>          <a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>   = isset(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('groupid')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>) ? <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('groupid')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> : 0;
<a name="l139"><span class="linenum"> 139</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>    = isset(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('userid')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>) ? <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('userid')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> : 0;
<a name="l140"><span class="linenum"> 140</span></a>          <a class="var it527" onMouseOver="hilite(527)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a>  = isset(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('available')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/available.html">available</a>) ? <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('available')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/available.html">available</a> : <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('available')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/available.html">available</a>;
<a name="l141"><span class="linenum"> 141</span></a>          <a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a> = isset(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('deadline')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a>) ? <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('deadline')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a> : <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('deadline')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a>;
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">        // Only add open/close events for an override if they differ from the lesson default.</span>
<a name="l144"><span class="linenum"> 144</span></a>          <a class="var it24076" onMouseOver="hilite(24076)" onMouseOut="lolite()" onClick="logVariable('addopen')" href="../../_variables/addopen.html">$addopen</a>  = empty(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('id')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) || !empty(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('available')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/available.html">available</a>);
<a name="l145"><span class="linenum"> 145</span></a>          <a class="var it24077" onMouseOver="hilite(24077)" onMouseOut="lolite()" onClick="logVariable('addclose')" href="../../_variables/addclose.html">$addclose</a> = empty(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('id')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) || !empty(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('deadline')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a>);
<a name="l146"><span class="linenum"> 146</span></a>  
<a name="l147"><span class="linenum"> 147</span></a>          if (!empty(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>)) {
<a name="l148"><span class="linenum"> 148</span></a>              <a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>;
<a name="l149"><span class="linenum"> 149</span></a>          } else {
<a name="l150"><span class="linenum"> 150</span></a>              <a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('lesson', <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)-&gt;id;
<a name="l151"><span class="linenum"> 151</span></a>          }
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = new stdClass();
<a name="l154"><span class="linenum"> 154</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('description')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/description.html">description</a> = <a class="function" onClick="logFunction('format_module_intro')" href="../../_functions/format_module_intro.html" onMouseOver="funcPopup(event,'format_module_intro')">format_module_intro</a>('lesson', <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>);
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">        // Events module won't show user events when the courseid is nonzero.</span>
<a name="l156"><span class="linenum"> 156</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('courseid')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>    = (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) ? 0 : <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>;
<a name="l157"><span class="linenum"> 157</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('groupid')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>     = <a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l158"><span class="linenum"> 158</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('userid')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>      = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l159"><span class="linenum"> 159</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('modulename')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a>  = 'lesson';
<a name="l160"><span class="linenum"> 160</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('instance')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>    = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l161"><span class="linenum"> 161</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timestart')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>   = <a class="var it527" onMouseOver="hilite(527)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a>;
<a name="l162"><span class="linenum"> 162</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timeduration')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/timeduration.html">timeduration</a> = <a class="phpfunction" onClick="logFunction('max')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a> - <a class="var it527" onMouseOver="hilite(527)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a>, 0);
<a name="l163"><span class="linenum"> 163</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('visible')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a>     = <a class="function" onClick="logFunction('instance_is_visible')" href="../../_functions/instance_is_visible.html" onMouseOver="funcPopup(event,'instance_is_visible')">instance_is_visible</a>('lesson', <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l164"><span class="linenum"> 164</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('eventtype')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/eventtype.html">eventtype</a>   = 'open';
<a name="l165"><span class="linenum"> 165</span></a>  
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">        // Determine the event name.</span>
<a name="l167"><span class="linenum"> 167</span></a>          if (<a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>) {
<a name="l168"><span class="linenum"> 168</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = new stdClass();
<a name="l169"><span class="linenum"> 169</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>-&gt;<a onClick="logVariable('lesson')" class="var it39554" onMouseOver="hilite(39554)" onMouseOut="lolite()" href="../../_variables/lesson.html">lesson</a> = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l170"><span class="linenum"> 170</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>-&gt;<a onClick="logVariable('group')" class="var it39554" onMouseOver="hilite(39554)" onMouseOut="lolite()" href="../../_variables/group.html">group</a> = <a class="function" onClick="logFunction('groups_get_group_name')" href="../../_functions/groups_get_group_name.html" onMouseOver="funcPopup(event,'groups_get_group_name')">groups_get_group_name</a>(<a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>);
<a name="l171"><span class="linenum"> 171</span></a>              if (<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>-&gt;<a onClick="logVariable('group')" class="var it39554" onMouseOver="hilite(39554)" onMouseOut="lolite()" href="../../_variables/group.html">group</a> === false) {
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment">                // Group doesn't exist, just skip it.</span>
<a name="l173"><span class="linenum"> 173</span></a>                  continue;
<a name="l174"><span class="linenum"> 174</span></a>              }
<a name="l175"><span class="linenum"> 175</span></a>              <a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('overridegroupeventname', 'lesson', <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l176"><span class="linenum"> 176</span></a>          } else if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l177"><span class="linenum"> 177</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = new stdClass();
<a name="l178"><span class="linenum"> 178</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>-&gt;<a onClick="logVariable('lesson')" class="var it39554" onMouseOver="hilite(39554)" onMouseOut="lolite()" href="../../_variables/lesson.html">lesson</a> = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l179"><span class="linenum"> 179</span></a>              <a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('overrideusereventname', 'lesson', <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l180"><span class="linenum"> 180</span></a>          } else {
<a name="l181"><span class="linenum"> 181</span></a>              <a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a> = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l182"><span class="linenum"> 182</span></a>          }
<a name="l183"><span class="linenum"> 183</span></a>          if (<a class="var it24076" onMouseOver="hilite(24076)" onMouseOut="lolite()" onClick="logVariable('addopen')" href="../../_variables/addopen.html">$addopen</a> or <a class="var it24077" onMouseOver="hilite(24077)" onMouseOut="lolite()" onClick="logVariable('addclose')" href="../../_variables/addclose.html">$addclose</a>) {
<a name="l184"><span class="linenum"> 184</span></a>              if (<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a> and <a class="var it527" onMouseOver="hilite(527)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a> and <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timeduration')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/timeduration.html">timeduration</a> &lt;= <a class="constant" onClick="logConstant('LESSON_MAX_EVENT_LENGTH')" href="../../_constants/LESSON_MAX_EVENT_LENGTH.html" onMouseOver="constPopup(event,'LESSON_MAX_EVENT_LENGTH')">LESSON_MAX_EVENT_LENGTH</a>) {
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment">                // Single event for the whole lesson.</span>
<a name="l186"><span class="linenum"> 186</span></a>                  if (<a class="var it11516" onMouseOver="hilite(11516)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it24075" onMouseOver="hilite(24075)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a>)) {
<a name="l187"><span class="linenum"> 187</span></a>                      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it11516" onMouseOver="hilite(11516)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a>-&gt;<a onClick="logVariable('id')" class="var it40855" onMouseOver="hilite(40855)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l188"><span class="linenum"> 188</span></a>                  } else {
<a name="l189"><span class="linenum"> 189</span></a>                      unset(<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l190"><span class="linenum"> 190</span></a>                  }
<a name="l191"><span class="linenum"> 191</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('name')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a>;
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment">                // The method calendar_event::create will reuse a db record if the id field is set.</span>
<a name="l193"><span class="linenum"> 193</span></a>                  <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l194"><span class="linenum"> 194</span></a>              } else {
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">                // Separate start and end events.</span>
<a name="l196"><span class="linenum"> 196</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timeduration')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/timeduration.html">timeduration</a>  = 0;
<a name="l197"><span class="linenum"> 197</span></a>                  if (<a class="var it527" onMouseOver="hilite(527)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a> &amp;&amp; <a class="var it24076" onMouseOver="hilite(24076)" onMouseOut="lolite()" onClick="logVariable('addopen')" href="../../_variables/addopen.html">$addopen</a>) {
<a name="l198"><span class="linenum"> 198</span></a>                      if (<a class="var it11516" onMouseOver="hilite(11516)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it24075" onMouseOver="hilite(24075)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a>)) {
<a name="l199"><span class="linenum"> 199</span></a>                          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it11516" onMouseOver="hilite(11516)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a>-&gt;<a onClick="logVariable('id')" class="var it40855" onMouseOver="hilite(40855)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l200"><span class="linenum"> 200</span></a>                      } else {
<a name="l201"><span class="linenum"> 201</span></a>                          unset(<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l202"><span class="linenum"> 202</span></a>                      }
<a name="l203"><span class="linenum"> 203</span></a>                      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('name')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a>.' ('.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lessonopens', 'lesson').')';
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment">                    // The method calendar_event::create will reuse a db record if the id field is set.</span>
<a name="l205"><span class="linenum"> 205</span></a>                      <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l206"><span class="linenum"> 206</span></a>                  }
<a name="l207"><span class="linenum"> 207</span></a>                  if (<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a> &amp;&amp; <a class="var it24077" onMouseOver="hilite(24077)" onMouseOut="lolite()" onClick="logVariable('addclose')" href="../../_variables/addclose.html">$addclose</a>) {
<a name="l208"><span class="linenum"> 208</span></a>                      if (<a class="var it11516" onMouseOver="hilite(11516)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it24075" onMouseOver="hilite(24075)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a>)) {
<a name="l209"><span class="linenum"> 209</span></a>                          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it11516" onMouseOver="hilite(11516)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a>-&gt;<a onClick="logVariable('id')" class="var it40855" onMouseOver="hilite(40855)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l210"><span class="linenum"> 210</span></a>                      } else {
<a name="l211"><span class="linenum"> 211</span></a>                          unset(<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l212"><span class="linenum"> 212</span></a>                      }
<a name="l213"><span class="linenum"> 213</span></a>                      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('name')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>      = <a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a>.' ('.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lessoncloses', 'lesson').')';
<a name="l214"><span class="linenum"> 214</span></a>                      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timestart')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> = <a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a>;
<a name="l215"><span class="linenum"> 215</span></a>                      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('eventtype')" class="var it39510" onMouseOver="hilite(39510)" onMouseOut="lolite()" href="../../_variables/eventtype.html">eventtype</a> = 'close';
<a name="l216"><span class="linenum"> 216</span></a>                      <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l217"><span class="linenum"> 217</span></a>                  }
<a name="l218"><span class="linenum"> 218</span></a>              }
<a name="l219"><span class="linenum"> 219</span></a>          }
<a name="l220"><span class="linenum"> 220</span></a>      }
<a name="l221"><span class="linenum"> 221</span></a>  
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment">    // Delete any leftover events.</span>
<a name="l223"><span class="linenum"> 223</span></a>      foreach (<a class="var it24075" onMouseOver="hilite(24075)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a> as <a class="var it24078" onMouseOver="hilite(24078)" onMouseOut="lolite()" onClick="logVariable('badevent')" href="../../_variables/badevent.html">$badevent</a>) {
<a name="l224"><span class="linenum"> 224</span></a>          <a class="var it24078" onMouseOver="hilite(24078)" onMouseOut="lolite()" onClick="logVariable('badevent')" href="../../_variables/badevent.html">$badevent</a> = <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('load')" href="../../_functions/load.html" onMouseOver="funcPopup(event,'load')">load</a>(<a class="var it24078" onMouseOver="hilite(24078)" onMouseOut="lolite()" onClick="logVariable('badevent')" href="../../_variables/badevent.html">$badevent</a>);
<a name="l225"><span class="linenum"> 225</span></a>          <a class="var it24078" onMouseOver="hilite(24078)" onMouseOut="lolite()" onClick="logVariable('badevent')" href="../../_variables/badevent.html">$badevent</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l226"><span class="linenum"> 226</span></a>      }
<a name="l227"><span class="linenum"> 227</span></a>  }
<a name="l228"><span class="linenum"> 228</span></a>  
<a name="l229"><span class="linenum"> 229</span></a>  <span class="comment">/**</span>
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment"> * This standard function will check all instances of this module</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment"> * and make sure there are up-to-date events created for each of them.</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment"> * If courseid = 0, then every lesson event in the site is checked, else</span>
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment"> * only lesson events belonging to the course specified are checked.</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment"> * This function is used, in its new format, by restore_refresh_events()</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment"> *</span>
<a name="l236"><span class="linenum"> 236</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment"> * @return bool</span>
<a name="l238"><span class="linenum"> 238</span></a>  <span class="comment"> */</span>
<a name="l239"><span class="linenum"> 239</span></a>  function <a class="function" onClick="logFunction('lesson_refresh_events')" href="../../_functions/lesson_refresh_events.html" onMouseOver="funcPopup(event,'lesson_refresh_events')">lesson_refresh_events</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = 0) {
<a name="l240"><span class="linenum"> 240</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l241"><span class="linenum"> 241</span></a>  
<a name="l242"><span class="linenum"> 242</span></a>      if (<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> == 0) {
<a name="l243"><span class="linenum"> 243</span></a>          if (!<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('lessons')) {
<a name="l244"><span class="linenum"> 244</span></a>              return true;
<a name="l245"><span class="linenum"> 245</span></a>          }
<a name="l246"><span class="linenum"> 246</span></a>      } else {
<a name="l247"><span class="linenum"> 247</span></a>          if (!<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('lesson', array('course' =&gt; <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>))) {
<a name="l248"><span class="linenum"> 248</span></a>              return true;
<a name="l249"><span class="linenum"> 249</span></a>          }
<a name="l250"><span class="linenum"> 250</span></a>      }
<a name="l251"><span class="linenum"> 251</span></a>  
<a name="l252"><span class="linenum"> 252</span></a>      foreach (<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l253"><span class="linenum"> 253</span></a>          <a class="function" onClick="logFunction('lesson_update_events')" href="../../_functions/lesson_update_events.html" onMouseOver="funcPopup(event,'lesson_update_events')">lesson_update_events</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l254"><span class="linenum"> 254</span></a>      }
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>      return true;
<a name="l257"><span class="linenum"> 257</span></a>  }
<a name="l258"><span class="linenum"> 258</span></a>  
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment">/**</span>
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment"> * Given an ID of an instance of this module,</span>
<a name="l261"><span class="linenum"> 261</span></a>  <span class="comment"> * this function will permanently delete the instance</span>
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment"> * and any data that depends on it.</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment"> *</span>
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment"> * @global object</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment"> * @param int $id</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment"> * @return bool</span>
<a name="l267"><span class="linenum"> 267</span></a>  <span class="comment"> */</span>
<a name="l268"><span class="linenum"> 268</span></a>  function <a class="function" onClick="logFunction('lesson_delete_instance')" href="../../_functions/lesson_delete_instance.html" onMouseOver="funcPopup(event,'lesson_delete_instance')">lesson_delete_instance</a>(<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l269"><span class="linenum"> 269</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l270"><span class="linenum"> 270</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../mod/lesson/locallib.php.html">/mod/lesson/locallib.php</a>');
<a name="l271"><span class="linenum"> 271</span></a>  
<a name="l272"><span class="linenum"> 272</span></a>      <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(&quot;lesson&quot;, array(&quot;id&quot;=&gt;<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l273"><span class="linenum"> 273</span></a>      <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a> = <span class="keyword">new </span><a class="class" onClick="logClass('lesson')" href="../../_classes/lesson.html" onMouseOver="classPopup(event,'lesson')">lesson</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l274"><span class="linenum"> 274</span></a>      return <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l275"><span class="linenum"> 275</span></a>  }
<a name="l276"><span class="linenum"> 276</span></a>  
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment">/**</span>
<a name="l278"><span class="linenum"> 278</span></a>  <span class="comment"> * Given a course object, this function will clean up anything that</span>
<a name="l279"><span class="linenum"> 279</span></a>  <span class="comment"> * would be leftover after all the instances were deleted</span>
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment"> *</span>
<a name="l281"><span class="linenum"> 281</span></a>  <span class="comment"> * @global object</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment"> * @param object $course an object representing the course that is being deleted</span>
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment"> * @param boolean $feedback to specify if the process must output a summary of its work</span>
<a name="l284"><span class="linenum"> 284</span></a>  <span class="comment"> * @return boolean</span>
<a name="l285"><span class="linenum"> 285</span></a>  <span class="comment"> */</span>
<a name="l286"><span class="linenum"> 286</span></a>  function <a class="function" onClick="logFunction('lesson_delete_course')" href="../../_functions/lesson_delete_course.html" onMouseOver="funcPopup(event,'lesson_delete_course')">lesson_delete_course</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it714" onMouseOver="hilite(714)" onMouseOut="lolite()" onClick="logVariable('feedback')" href="../../_variables/feedback.html">$feedback</a>=true) {
<a name="l287"><span class="linenum"> 287</span></a>      return true;
<a name="l288"><span class="linenum"> 288</span></a>  }
<a name="l289"><span class="linenum"> 289</span></a>  
<a name="l290"><span class="linenum"> 290</span></a>  <span class="comment">/**</span>
<a name="l291"><span class="linenum"> 291</span></a>  <span class="comment"> * Return a small object with summary information about what a</span>
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment"> * user has done with a given particular instance of this module</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment"> * Used for user activity reports.</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment"> * $return-&gt;time = the time they did it</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment"> * $return-&gt;info = a short text description</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment"> *</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment"> * @global object</span>
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment"> * @param object $course</span>
<a name="l299"><span class="linenum"> 299</span></a>  <span class="comment"> * @param object $user</span>
<a name="l300"><span class="linenum"> 300</span></a>  <span class="comment"> * @param object $mod</span>
<a name="l301"><span class="linenum"> 301</span></a>  <span class="comment"> * @param object $lesson</span>
<a name="l302"><span class="linenum"> 302</span></a>  <span class="comment"> * @return object</span>
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment"> */</span>
<a name="l304"><span class="linenum"> 304</span></a>  function <a class="function" onClick="logFunction('lesson_user_outline')" href="../../_functions/lesson_user_outline.html" onMouseOver="funcPopup(event,'lesson_user_outline')">lesson_user_outline</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it414" onMouseOver="hilite(414)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>, <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l305"><span class="linenum"> 305</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>      require_once(&quot;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>/gradelib.php&quot;);
<a name="l308"><span class="linenum"> 308</span></a>      <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="function" onClick="logFunction('grade_get_grades')" href="../../_functions/grade_get_grades.html" onMouseOver="funcPopup(event,'grade_get_grades')">grade_get_grades</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod', 'lesson', <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l309"><span class="linenum"> 309</span></a>  
<a name="l310"><span class="linenum"> 310</span></a>      <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = new stdClass();
<a name="l311"><span class="linenum"> 311</span></a>      if (empty(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it40209" onMouseOver="hilite(40209)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades)) {
<a name="l312"><span class="linenum"> 312</span></a>          <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('info')" class="var it40015" onMouseOver="hilite(40015)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;no&quot;).&quot; &quot;.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;attempts&quot;, &quot;lesson&quot;);
<a name="l313"><span class="linenum"> 313</span></a>      } else {
<a name="l314"><span class="linenum"> 314</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it40209" onMouseOver="hilite(40209)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades);
<a name="l315"><span class="linenum"> 315</span></a>          <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('info')" class="var it40015" onMouseOver="hilite(40015)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;grade&quot;) . ': ' . <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_long_grade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/str_long_grade.html">str_long_grade</a>;
<a name="l316"><span class="linenum"> 316</span></a>  
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment">        //datesubmitted == time created. dategraded == time modified or time overridden</span>
<a name="l318"><span class="linenum"> 318</span></a>  <span class="comment">        //if grade was last modified by the user themselves use date graded. Otherwise use date submitted</span>
<a name="l319"><span class="linenum"> 319</span></a>  <span class="comment">        //TODO: move this copied &amp; pasted code somewhere in the grades API. See MDL-26704</span>
<a name="l320"><span class="linenum"> 320</span></a>          if (<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('usermodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> == <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> || empty(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('datesubmitted')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/datesubmitted.html">datesubmitted</a>)) {
<a name="l321"><span class="linenum"> 321</span></a>              <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('time')" class="var it40015" onMouseOver="hilite(40015)" onMouseOut="lolite()" href="../../_variables/time.html">time</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('dategraded')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/dategraded.html">dategraded</a>;
<a name="l322"><span class="linenum"> 322</span></a>          } else {
<a name="l323"><span class="linenum"> 323</span></a>              <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('time')" class="var it40015" onMouseOver="hilite(40015)" onMouseOut="lolite()" href="../../_variables/time.html">time</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('datesubmitted')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/datesubmitted.html">datesubmitted</a>;
<a name="l324"><span class="linenum"> 324</span></a>          }
<a name="l325"><span class="linenum"> 325</span></a>      }
<a name="l326"><span class="linenum"> 326</span></a>      return <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l327"><span class="linenum"> 327</span></a>  }
<a name="l328"><span class="linenum"> 328</span></a>  
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment">/**</span>
<a name="l330"><span class="linenum"> 330</span></a>  <span class="comment"> * Print a detailed representation of what a  user has done with</span>
<a name="l331"><span class="linenum"> 331</span></a>  <span class="comment"> * a given particular instance of this module, for user activity reports.</span>
<a name="l332"><span class="linenum"> 332</span></a>  <span class="comment"> *</span>
<a name="l333"><span class="linenum"> 333</span></a>  <span class="comment"> * @global object</span>
<a name="l334"><span class="linenum"> 334</span></a>  <span class="comment"> * @param object $course</span>
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment"> * @param object $user</span>
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment"> * @param object $mod</span>
<a name="l337"><span class="linenum"> 337</span></a>  <span class="comment"> * @param object $lesson</span>
<a name="l338"><span class="linenum"> 338</span></a>  <span class="comment"> * @return bool</span>
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment"> */</span>
<a name="l340"><span class="linenum"> 340</span></a>  function <a class="function" onClick="logFunction('lesson_user_complete')" href="../../_functions/lesson_user_complete.html" onMouseOver="funcPopup(event,'lesson_user_complete')">lesson_user_complete</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it414" onMouseOver="hilite(414)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>, <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l341"><span class="linenum"> 341</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l342"><span class="linenum"> 342</span></a>  
<a name="l343"><span class="linenum"> 343</span></a>      require_once(&quot;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>/gradelib.php&quot;);
<a name="l344"><span class="linenum"> 344</span></a>  
<a name="l345"><span class="linenum"> 345</span></a>      <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="function" onClick="logFunction('grade_get_grades')" href="../../_functions/grade_get_grades.html" onMouseOver="funcPopup(event,'grade_get_grades')">grade_get_grades</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod', 'lesson', <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l346"><span class="linenum"> 346</span></a>      if (!empty(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it40209" onMouseOver="hilite(40209)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades)) {
<a name="l347"><span class="linenum"> 347</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it40209" onMouseOver="hilite(40209)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades);
<a name="l348"><span class="linenum"> 348</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('container')" href="../../_functions/container.html" onMouseOver="funcPopup(event,'container')">container</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('grade').': '.<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_long_grade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/str_long_grade.html">str_long_grade</a>);
<a name="l349"><span class="linenum"> 349</span></a>          if (<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/str_feedback.html">str_feedback</a>) {
<a name="l350"><span class="linenum"> 350</span></a>              echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('container')" href="../../_functions/container.html" onMouseOver="funcPopup(event,'container')">container</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('feedback').': '.<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/str_feedback.html">str_feedback</a>);
<a name="l351"><span class="linenum"> 351</span></a>          }
<a name="l352"><span class="linenum"> 352</span></a>      }
<a name="l353"><span class="linenum"> 353</span></a>  
<a name="l354"><span class="linenum"> 354</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array (&quot;lessonid&quot; =&gt; <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, &quot;userid&quot; =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l355"><span class="linenum"> 355</span></a>      if (<a class="var it659" onMouseOver="hilite(659)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(&quot;lesson_attempts&quot;, &quot;lessonid = :lessonid AND userid = :userid&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>,
<a name="l356"><span class="linenum"> 356</span></a>                  &quot;retry, timeseen&quot;)) {
<a name="l357"><span class="linenum"> 357</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_start')" href="../../_functions/box_start.html" onMouseOver="funcPopup(event,'box_start')">box_start</a>();
<a name="l358"><span class="linenum"> 358</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('html_table')" href="../../_classes/html_table.html" onMouseOver="classPopup(event,'html_table')">html_table</a>();
<a name="l359"><span class="linenum"> 359</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('head')" class="var it39441" onMouseOver="hilite(39441)" onMouseOut="lolite()" href="../../_variables/head.html">head</a> = array (<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;attemptheader&quot;, &quot;lesson&quot;),  <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;numberofpagesviewedheader&quot;, &quot;lesson&quot;),
<a name="l360"><span class="linenum"> 360</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;numberofcorrectanswersheader&quot;, &quot;lesson&quot;), <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;time&quot;));
<a name="l361"><span class="linenum"> 361</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('width')" class="var it39441" onMouseOver="hilite(39441)" onMouseOut="lolite()" href="../../_variables/width.html">width</a> = &quot;100%&quot;;
<a name="l362"><span class="linenum"> 362</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('align')" class="var it39441" onMouseOver="hilite(39441)" onMouseOut="lolite()" href="../../_variables/align.html">align</a> = array (&quot;center&quot;, &quot;center&quot;, &quot;center&quot;, &quot;center&quot;);
<a name="l363"><span class="linenum"> 363</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('size')" class="var it39441" onMouseOver="hilite(39441)" onMouseOut="lolite()" href="../../_variables/size.html">size</a> = array (&quot;*&quot;, &quot;*&quot;, &quot;*&quot;, &quot;*&quot;);
<a name="l364"><span class="linenum"> 364</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('cellpadding')" class="var it39441" onMouseOver="hilite(39441)" onMouseOut="lolite()" href="../../_variables/cellpadding.html">cellpadding</a> = 2;
<a name="l365"><span class="linenum"> 365</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('cellspacing')" class="var it39441" onMouseOver="hilite(39441)" onMouseOut="lolite()" href="../../_variables/cellspacing.html">cellspacing</a> = 0;
<a name="l366"><span class="linenum"> 366</span></a>  
<a name="l367"><span class="linenum"> 367</span></a>          <a class="var it10067" onMouseOver="hilite(10067)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a> = 0;
<a name="l368"><span class="linenum"> 368</span></a>          <a class="var it9356" onMouseOver="hilite(9356)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a> = 0;
<a name="l369"><span class="linenum"> 369</span></a>          <a class="var it23915" onMouseOver="hilite(23915)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a> = 0;
<a name="l370"><span class="linenum"> 370</span></a>  
<a name="l371"><span class="linenum"> 371</span></a>          foreach (<a class="var it659" onMouseOver="hilite(659)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a> as <a class="var it660" onMouseOver="hilite(660)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>) {
<a name="l372"><span class="linenum"> 372</span></a>              if (<a class="var it660" onMouseOver="hilite(660)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('retry')" class="var it39607" onMouseOver="hilite(39607)" onMouseOut="lolite()" href="../../_variables/retry.html">retry</a> == <a class="var it10067" onMouseOver="hilite(10067)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a>) {
<a name="l373"><span class="linenum"> 373</span></a>                  <a class="var it9356" onMouseOver="hilite(9356)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a>++;
<a name="l374"><span class="linenum"> 374</span></a>                  if (<a class="var it660" onMouseOver="hilite(660)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('correct')" class="var it39607" onMouseOver="hilite(39607)" onMouseOut="lolite()" href="../../_variables/correct.html">correct</a>) {
<a name="l375"><span class="linenum"> 375</span></a>                      <a class="var it23915" onMouseOver="hilite(23915)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a>++;
<a name="l376"><span class="linenum"> 376</span></a>                  }
<a name="l377"><span class="linenum"> 377</span></a>                  <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('timeseen')" href="../../_variables/timeseen.html">$timeseen</a> = <a class="var it660" onMouseOver="hilite(660)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('timeseen')" class="var it39607" onMouseOver="hilite(39607)" onMouseOut="lolite()" href="../../_variables/timeseen.html">timeseen</a>;
<a name="l378"><span class="linenum"> 378</span></a>              } else {
<a name="l379"><span class="linenum"> 379</span></a>                  <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('data')" class="var it39441" onMouseOver="hilite(39441)" onMouseOut="lolite()" href="../../_variables/data.html">data</a>[] = array(<a class="var it10067" onMouseOver="hilite(10067)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a> + 1, <a class="var it9356" onMouseOver="hilite(9356)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a>, <a class="var it23915" onMouseOver="hilite(23915)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a>, <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('timeseen')" href="../../_variables/timeseen.html">$timeseen</a>));
<a name="l380"><span class="linenum"> 380</span></a>                  <a class="var it10067" onMouseOver="hilite(10067)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a>++;
<a name="l381"><span class="linenum"> 381</span></a>                  <a class="var it9356" onMouseOver="hilite(9356)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a> = 1;
<a name="l382"><span class="linenum"> 382</span></a>                  if (<a class="var it660" onMouseOver="hilite(660)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('correct')" class="var it39607" onMouseOver="hilite(39607)" onMouseOut="lolite()" href="../../_variables/correct.html">correct</a>) {
<a name="l383"><span class="linenum"> 383</span></a>                      <a class="var it23915" onMouseOver="hilite(23915)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a> = 1;
<a name="l384"><span class="linenum"> 384</span></a>                  } else {
<a name="l385"><span class="linenum"> 385</span></a>                      <a class="var it23915" onMouseOver="hilite(23915)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a> = 0;
<a name="l386"><span class="linenum"> 386</span></a>                  }
<a name="l387"><span class="linenum"> 387</span></a>              }
<a name="l388"><span class="linenum"> 388</span></a>          }
<a name="l389"><span class="linenum"> 389</span></a>          if (<a class="var it9356" onMouseOver="hilite(9356)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a>) {
<a name="l390"><span class="linenum"> 390</span></a>                  <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('data')" class="var it39441" onMouseOver="hilite(39441)" onMouseOut="lolite()" href="../../_variables/data.html">data</a>[] = array(<a class="var it10067" onMouseOver="hilite(10067)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a> + 1, <a class="var it9356" onMouseOver="hilite(9356)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a>, <a class="var it23915" onMouseOver="hilite(23915)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a>, <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('timeseen')" href="../../_variables/timeseen.html">$timeseen</a>));
<a name="l391"><span class="linenum"> 391</span></a>          }
<a name="l392"><span class="linenum"> 392</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('table')" href="../../_functions/table.html" onMouseOver="funcPopup(event,'table')">table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l393"><span class="linenum"> 393</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_end')" href="../../_functions/box_end.html" onMouseOver="funcPopup(event,'box_end')">box_end</a>();
<a name="l394"><span class="linenum"> 394</span></a>      }
<a name="l395"><span class="linenum"> 395</span></a>  
<a name="l396"><span class="linenum"> 396</span></a>      return true;
<a name="l397"><span class="linenum"> 397</span></a>  }
<a name="l398"><span class="linenum"> 398</span></a>  
<a name="l399"><span class="linenum"> 399</span></a>  <span class="comment">/**</span>
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment"> * Prints lesson summaries on MyMoodle Page</span>
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment"> *</span>
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment"> * Prints lesson name, due date and attempt information on</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment"> * lessons that have a deadline that has not already passed</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment"> * and it is available for taking.</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment"> *</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment"> * @global object</span>
<a name="l407"><span class="linenum"> 407</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment"> * @global object</span>
<a name="l409"><span class="linenum"> 409</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l410"><span class="linenum"> 410</span></a>  <span class="comment"> * @param array $courses An array of course objects to get lesson instances from</span>
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment"> * @param array $htmlarray Store overview output array( course ID =&gt; 'lesson' =&gt; HTML output )</span>
<a name="l412"><span class="linenum"> 412</span></a>  <span class="comment"> * @return void</span>
<a name="l413"><span class="linenum"> 413</span></a>  <span class="comment"> */</span>
<a name="l414"><span class="linenum"> 414</span></a>  function <a class="function" onClick="logFunction('lesson_print_overview')" href="../../_functions/lesson_print_overview.html" onMouseOver="funcPopup(event,'lesson_print_overview')">lesson_print_overview</a>(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>, &amp;<a class="var it7035" onMouseOver="hilite(7035)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>) {
<a name="l415"><span class="linenum"> 415</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l416"><span class="linenum"> 416</span></a>  
<a name="l417"><span class="linenum"> 417</span></a>      if (!<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="function" onClick="logFunction('get_all_instances_in_courses')" href="../../_functions/get_all_instances_in_courses.html" onMouseOver="funcPopup(event,'get_all_instances_in_courses')">get_all_instances_in_courses</a>('lesson', <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>)) {
<a name="l418"><span class="linenum"> 418</span></a>          return;
<a name="l419"><span class="linenum"> 419</span></a>      }
<a name="l420"><span class="linenum"> 420</span></a>  
<a name="l421"><span class="linenum"> 421</span></a>  <span class="comment">    // Get all of the current users attempts on all lessons.</span>
<a name="l422"><span class="linenum"> 422</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l423"><span class="linenum"> 423</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT lessonid, userid, <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(userid) as attempts
<a name="l424"><span class="linenum"> 424</span></a>                FROM {lesson_grades}
<a name="l425"><span class="linenum"> 425</span></a>               WHERE userid = ?
<a name="l426"><span class="linenum"> 426</span></a>            GROUP BY lessonid, userid';
<a name="l427"><span class="linenum"> 427</span></a>      <a class="var it10064" onMouseOver="hilite(10064)" onMouseOut="lolite()" onClick="logVariable('allattempts')" href="../../_variables/allattempts.html">$allattempts</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l428"><span class="linenum"> 428</span></a>      <a class="var it24080" onMouseOver="hilite(24080)" onMouseOut="lolite()" onClick="logVariable('completedattempts')" href="../../_variables/completedattempts.html">$completedattempts</a> = array();
<a name="l429"><span class="linenum"> 429</span></a>      foreach (<a class="var it10064" onMouseOver="hilite(10064)" onMouseOut="lolite()" onClick="logVariable('allattempts')" href="../../_variables/allattempts.html">$allattempts</a> as <a class="var it24081" onMouseOver="hilite(24081)" onMouseOut="lolite()" onClick="logVariable('myattempt')" href="../../_variables/myattempt.html">$myattempt</a>) {
<a name="l430"><span class="linenum"> 430</span></a>          <a class="var it24080" onMouseOver="hilite(24080)" onMouseOut="lolite()" onClick="logVariable('completedattempts')" href="../../_variables/completedattempts.html">$completedattempts</a>[<a class="var it24081" onMouseOver="hilite(24081)" onMouseOut="lolite()" onClick="logVariable('myattempt')" href="../../_variables/myattempt.html">$myattempt</a>-&gt;<a onClick="logVariable('lessonid')" class="var it41629" onMouseOver="hilite(41629)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>] = <a class="var it24081" onMouseOver="hilite(24081)" onMouseOut="lolite()" onClick="logVariable('myattempt')" href="../../_variables/myattempt.html">$myattempt</a>-&gt;<a onClick="logVariable('attempts')" class="var it41629" onMouseOver="hilite(41629)" onMouseOut="lolite()" href="../../_variables/attempts.html">attempts</a>;
<a name="l431"><span class="linenum"> 431</span></a>      }
<a name="l432"><span class="linenum"> 432</span></a>  
<a name="l433"><span class="linenum"> 433</span></a>  <span class="comment">    // Get the current course ID.</span>
<a name="l434"><span class="linenum"> 434</span></a>      <a class="var it24082" onMouseOver="hilite(24082)" onMouseOut="lolite()" onClick="logVariable('listoflessons')" href="../../_variables/listoflessons.html">$listoflessons</a> = array();
<a name="l435"><span class="linenum"> 435</span></a>      foreach (<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l436"><span class="linenum"> 436</span></a>          <a class="var it24082" onMouseOver="hilite(24082)" onMouseOut="lolite()" onClick="logVariable('listoflessons')" href="../../_variables/listoflessons.html">$listoflessons</a>[] = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l437"><span class="linenum"> 437</span></a>      }
<a name="l438"><span class="linenum"> 438</span></a>  <span class="comment">    // Get the last page viewed by the current user for every lesson in this course.</span>
<a name="l439"><span class="linenum"> 439</span></a>      <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it10795" onMouseOver="hilite(10795)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it6275" onMouseOver="hilite(6275)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it24082" onMouseOver="hilite(24082)" onMouseOut="lolite()" onClick="logVariable('listoflessons')" href="../../_variables/listoflessons.html">$listoflessons</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l440"><span class="linenum"> 440</span></a>      <a class="var it4355" onMouseOver="hilite(4355)" onMouseOut="lolite()" onClick="logVariable('dbparams')" href="../../_variables/dbparams.html">$dbparams</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it6275" onMouseOver="hilite(6275)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>, array('userid1' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid2' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l441"><span class="linenum"> 441</span></a>  
<a name="l442"><span class="linenum"> 442</span></a>      <a class="var it24083" onMouseOver="hilite(24083)" onMouseOut="lolite()" onClick="logVariable('lastattempts')" href="../../_variables/lastattempts.html">$lastattempts</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT l.id, l.timeseen,l.lessonid, l.userid,
<a name="l443"><span class="linenum"> 443</span></a>                                                   l.retry, l.pageid, l.nextpageid, p.qtype <a class="function" onClick="logFunction('FROM')" href="../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a> (
<a name="l444"><span class="linenum"> 444</span></a>                                            SELECT lessonid, userid, pageid, timeseen, retry, id, answerid AS nextpageid
<a name="l445"><span class="linenum"> 445</span></a>                                              FROM {lesson_attempts}
<a name="l446"><span class="linenum"> 446</span></a>                                             WHERE userid = :userid1
<a name="l447"><span class="linenum"> 447</span></a>                                             UNION
<a name="l448"><span class="linenum"> 448</span></a>                                            SELECT lessonid, userid, pageid, timeseen, retry, id, nextpageid
<a name="l449"><span class="linenum"> 449</span></a>                                              FROM {lesson_branch}
<a name="l450"><span class="linenum"> 450</span></a>                                             WHERE userid = :userid2) l
<a name="l451"><span class="linenum"> 451</span></a>                                              JOIN {lesson_pages} p
<a name="l452"><span class="linenum"> 452</span></a>                                                ON l.pageid = p.id
<a name="l453"><span class="linenum"> 453</span></a>                                             WHERE l.lessonid <a class="var it10795" onMouseOver="hilite(10795)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>
<a name="l454"><span class="linenum"> 454</span></a>                                          ORDER BY l.lessonid asc, l.timeseen desc&quot;, <a class="var it4355" onMouseOver="hilite(4355)" onMouseOut="lolite()" onClick="logVariable('dbparams')" href="../../_variables/dbparams.html">$dbparams</a>);
<a name="l455"><span class="linenum"> 455</span></a>  
<a name="l456"><span class="linenum"> 456</span></a>      <a class="var it24084" onMouseOver="hilite(24084)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a> = array();
<a name="l457"><span class="linenum"> 457</span></a>      foreach (<a class="var it24083" onMouseOver="hilite(24083)" onMouseOut="lolite()" onClick="logVariable('lastattempts')" href="../../_variables/lastattempts.html">$lastattempts</a> as <a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>) {
<a name="l458"><span class="linenum"> 458</span></a>          if (!isset(<a class="var it24084" onMouseOver="hilite(24084)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>-&gt;<a onClick="logVariable('lessonid')" class="var it40856" onMouseOver="hilite(40856)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>])) {
<a name="l459"><span class="linenum"> 459</span></a>              <a class="var it24084" onMouseOver="hilite(24084)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>-&gt;<a onClick="logVariable('lessonid')" class="var it40856" onMouseOver="hilite(40856)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>] = <a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>;
<a name="l460"><span class="linenum"> 460</span></a>          } else if (<a class="var it24084" onMouseOver="hilite(24084)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>-&gt;<a onClick="logVariable('lessonid')" class="var it40856" onMouseOver="hilite(40856)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>]-&gt;timeseen &lt; <a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>-&gt;<a onClick="logVariable('timeseen')" class="var it40856" onMouseOver="hilite(40856)" onMouseOut="lolite()" href="../../_variables/timeseen.html">timeseen</a>) {
<a name="l461"><span class="linenum"> 461</span></a>                  <a class="var it24084" onMouseOver="hilite(24084)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>-&gt;<a onClick="logVariable('lessonid')" class="var it40856" onMouseOver="hilite(40856)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>] = <a class="var it3800" onMouseOver="hilite(3800)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>;
<a name="l462"><span class="linenum"> 462</span></a>          }
<a name="l463"><span class="linenum"> 463</span></a>      }
<a name="l464"><span class="linenum"> 464</span></a>  
<a name="l465"><span class="linenum"> 465</span></a>  <span class="comment">    // Since we have lessons in this course, now include the constants we need.</span>
<a name="l466"><span class="linenum"> 466</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../mod/lesson/locallib.php.html">/mod/lesson/locallib.php</a>');
<a name="l467"><span class="linenum"> 467</span></a>  
<a name="l468"><span class="linenum"> 468</span></a>      <a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l469"><span class="linenum"> 469</span></a>      foreach (<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l470"><span class="linenum"> 470</span></a>          if (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('deadline')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a> != 0                                         // The lesson has a deadline
<a name="l471"><span class="linenum"> 471</span></a>              and <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('deadline')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a> &gt;= <a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>                                  // And it is before the deadline has been met
<a name="l472"><span class="linenum"> 472</span></a>              and (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('available')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/available.html">available</a> == 0 or <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('available')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/available.html">available</a> &lt;= <a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>)) { // And the lesson is available
<a name="l473"><span class="linenum"> 473</span></a>  
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment">            // Visibility.</span>
<a name="l475"><span class="linenum"> 475</span></a>              <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a> = (!<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('visible')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a>) ? 'dimmed' : '';
<a name="l476"><span class="linenum"> 476</span></a>  
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">            // Context.</span>
<a name="l478"><span class="linenum"> 478</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>);
<a name="l479"><span class="linenum"> 479</span></a>  
<a name="l480"><span class="linenum"> 480</span></a>  <span class="comment">            // Link to activity.</span>
<a name="l481"><span class="linenum"> 481</span></a>              <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/view.php.html">/mod/lesson/view.php</a>', array('id' =&gt; <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>));
<a name="l482"><span class="linenum"> 482</span></a>              <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>, true, array('context' =&gt; <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)), array('class' =&gt; <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a>));
<a name="l483"><span class="linenum"> 483</span></a>              <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lessonname', 'lesson', <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>), 'name');
<a name="l484"><span class="linenum"> 484</span></a>  
<a name="l485"><span class="linenum"> 485</span></a>  <span class="comment">            // Deadline.</span>
<a name="l486"><span class="linenum"> 486</span></a>              <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lessoncloseson', 'lesson', <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('deadline')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a>)), 'info');
<a name="l487"><span class="linenum"> 487</span></a>  
<a name="l488"><span class="linenum"> 488</span></a>  <span class="comment">            // Attempt information.</span>
<a name="l489"><span class="linenum"> 489</span></a>              if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:manage', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l490"><span class="linenum"> 490</span></a>  <span class="comment">                // This is a teacher, Get the Number of user attempts.</span>
<a name="l491"><span class="linenum"> 491</span></a>                  <a class="var it659" onMouseOver="hilite(659)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('lesson_grades', array('lessonid' =&gt; <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l492"><span class="linenum"> 492</span></a>                  <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>     .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('xattempts', 'lesson', <a class="var it659" onMouseOver="hilite(659)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a>), 'info');
<a name="l493"><span class="linenum"> 493</span></a>                  <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>      = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l494"><span class="linenum"> 494</span></a>              } else {
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment">                // This is a student, See if the user has at least started the lesson.</span>
<a name="l496"><span class="linenum"> 496</span></a>                  if (isset(<a class="var it24084" onMouseOver="hilite(24084)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;timeseen)) {
<a name="l497"><span class="linenum"> 497</span></a>  <span class="comment">                    // See if the user has finished this attempt.</span>
<a name="l498"><span class="linenum"> 498</span></a>                      if (isset(<a class="var it24080" onMouseOver="hilite(24080)" onMouseOut="lolite()" onClick="logVariable('completedattempts')" href="../../_variables/completedattempts.html">$completedattempts</a>[<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]) &amp;&amp;
<a name="l499"><span class="linenum"> 499</span></a>                               (<a class="var it24080" onMouseOver="hilite(24080)" onMouseOut="lolite()" onClick="logVariable('completedattempts')" href="../../_variables/completedattempts.html">$completedattempts</a>[<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] == (<a class="var it24084" onMouseOver="hilite(24084)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;retry + 1))) {
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">                        // Are additional attempts allowed?</span>
<a name="l501"><span class="linenum"> 501</span></a>                          if (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('retake')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/retake.html">retake</a>) {
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment">                            // User can retake the lesson.</span>
<a name="l503"><span class="linenum"> 503</span></a>                              <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('additionalattemptsremaining', 'lesson'), 'info');
<a name="l504"><span class="linenum"> 504</span></a>                              <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l505"><span class="linenum"> 505</span></a>                          } else {
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment">                            // User has completed the lesson and no retakes are allowed.</span>
<a name="l507"><span class="linenum"> 507</span></a>                              <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = '';
<a name="l508"><span class="linenum"> 508</span></a>                          }
<a name="l509"><span class="linenum"> 509</span></a>  
<a name="l510"><span class="linenum"> 510</span></a>                      } else {
<a name="l511"><span class="linenum"> 511</span></a>  <span class="comment">                        // The last attempt was not finished or the lesson does not contain questions.</span>
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment">                        // See if the last page viewed was a branchtable.</span>
<a name="l513"><span class="linenum"> 513</span></a>                          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../mod/lesson/pagetypes/branchtable.php.html">/mod/lesson/pagetypes/branchtable.php</a>');
<a name="l514"><span class="linenum"> 514</span></a>                          if (<a class="var it24084" onMouseOver="hilite(24084)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;qtype == <a class="constant" onClick="logConstant('LESSON_PAGE_BRANCHTABLE')" href="../../_constants/LESSON_PAGE_BRANCHTABLE.html" onMouseOver="constPopup(event,'LESSON_PAGE_BRANCHTABLE')">LESSON_PAGE_BRANCHTABLE</a>) {
<a name="l515"><span class="linenum"> 515</span></a>  <span class="comment">                            // See if the next pageid is the end of lesson.</span>
<a name="l516"><span class="linenum"> 516</span></a>                              if (<a class="var it24084" onMouseOver="hilite(24084)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;nextpageid == <a class="constant" onClick="logConstant('LESSON_EOL')" href="../../_constants/LESSON_EOL.html" onMouseOver="constPopup(event,'LESSON_EOL')">LESSON_EOL</a>) {
<a name="l517"><span class="linenum"> 517</span></a>  <span class="comment">                                // The last page viewed was the End of Lesson.</span>
<a name="l518"><span class="linenum"> 518</span></a>                                  if (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('retake')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/retake.html">retake</a>) {
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment">                                    // User can retake the lesson.</span>
<a name="l520"><span class="linenum"> 520</span></a>                                      <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('additionalattemptsremaining', 'lesson'), 'info');
<a name="l521"><span class="linenum"> 521</span></a>                                      <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l522"><span class="linenum"> 522</span></a>                                  } else {
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">                                    // User has completed the lesson and no retakes are allowed.</span>
<a name="l524"><span class="linenum"> 524</span></a>                                      <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = '';
<a name="l525"><span class="linenum"> 525</span></a>                                  }
<a name="l526"><span class="linenum"> 526</span></a>  
<a name="l527"><span class="linenum"> 527</span></a>                              } else {
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment">                                // The last page viewed was NOT the end of lesson.</span>
<a name="l529"><span class="linenum"> 529</span></a>                                  <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('notyetcompleted', 'lesson'), 'info');
<a name="l530"><span class="linenum"> 530</span></a>                                  <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l531"><span class="linenum"> 531</span></a>                              }
<a name="l532"><span class="linenum"> 532</span></a>  
<a name="l533"><span class="linenum"> 533</span></a>                          } else {
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment">                            // Last page was a question page, so the attempt is not completed yet.</span>
<a name="l535"><span class="linenum"> 535</span></a>                              <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('notyetcompleted', 'lesson'), 'info');
<a name="l536"><span class="linenum"> 536</span></a>                              <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l537"><span class="linenum"> 537</span></a>                          }
<a name="l538"><span class="linenum"> 538</span></a>                      }
<a name="l539"><span class="linenum"> 539</span></a>  
<a name="l540"><span class="linenum"> 540</span></a>                  } else {
<a name="l541"><span class="linenum"> 541</span></a>  <span class="comment">                    // User has not yet started this lesson.</span>
<a name="l542"><span class="linenum"> 542</span></a>                      <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nolessonattempts', 'lesson'), 'info');
<a name="l543"><span class="linenum"> 543</span></a>                      <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l544"><span class="linenum"> 544</span></a>                  }
<a name="l545"><span class="linenum"> 545</span></a>              }
<a name="l546"><span class="linenum"> 546</span></a>              if (!empty(<a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>)) {
<a name="l547"><span class="linenum"> 547</span></a>                  if (empty(<a class="var it7035" onMouseOver="hilite(7035)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['lesson'])) {
<a name="l548"><span class="linenum"> 548</span></a>                      <a class="var it7035" onMouseOver="hilite(7035)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['lesson'] = <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>;
<a name="l549"><span class="linenum"> 549</span></a>                  } else {
<a name="l550"><span class="linenum"> 550</span></a>                      <a class="var it7035" onMouseOver="hilite(7035)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['lesson'] .= <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>;
<a name="l551"><span class="linenum"> 551</span></a>                  }
<a name="l552"><span class="linenum"> 552</span></a>              }
<a name="l553"><span class="linenum"> 553</span></a>          }
<a name="l554"><span class="linenum"> 554</span></a>      }
<a name="l555"><span class="linenum"> 555</span></a>  }
<a name="l556"><span class="linenum"> 556</span></a>  
<a name="l557"><span class="linenum"> 557</span></a>  <span class="comment">/**</span>
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment"> * Function to be run periodically according to the moodle cron</span>
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment"> * This function searches for things that need to be done, such</span>
<a name="l560"><span class="linenum"> 560</span></a>  <span class="comment"> * as sending out mail, toggling flags etc ...</span>
<a name="l561"><span class="linenum"> 561</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment"> * @return bool true</span>
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment"> */</span>
<a name="l564"><span class="linenum"> 564</span></a>  function <a class="function" onClick="logFunction('lesson_cron')" href="../../_functions/lesson_cron.html" onMouseOver="funcPopup(event,'lesson_cron')">lesson_cron</a> () {
<a name="l565"><span class="linenum"> 565</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l566"><span class="linenum"> 566</span></a>  
<a name="l567"><span class="linenum"> 567</span></a>      return true;
<a name="l568"><span class="linenum"> 568</span></a>  }
<a name="l569"><span class="linenum"> 569</span></a>  
<a name="l570"><span class="linenum"> 570</span></a>  <span class="comment">/**</span>
<a name="l571"><span class="linenum"> 571</span></a>  <span class="comment"> * Return grade for given user or all users.</span>
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment"> *</span>
<a name="l573"><span class="linenum"> 573</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l574"><span class="linenum"> 574</span></a>  <span class="comment"> * @global object</span>
<a name="l575"><span class="linenum"> 575</span></a>  <span class="comment"> * @param int $lessonid id of lesson</span>
<a name="l576"><span class="linenum"> 576</span></a>  <span class="comment"> * @param int $userid optional user id, 0 means all users</span>
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment"> * @return array array of grades, false if none</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment"> */</span>
<a name="l579"><span class="linenum"> 579</span></a>  function <a class="function" onClick="logFunction('lesson_get_user_grades')" href="../../_functions/lesson_get_user_grades.html" onMouseOver="funcPopup(event,'lesson_get_user_grades')">lesson_get_user_grades</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=0) {
<a name="l580"><span class="linenum"> 580</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l581"><span class="linenum"> 581</span></a>  
<a name="l582"><span class="linenum"> 582</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(&quot;lessonid&quot; =&gt; <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,&quot;lessonid2&quot; =&gt; <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l583"><span class="linenum"> 583</span></a>  
<a name="l584"><span class="linenum"> 584</span></a>      if (!empty(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l585"><span class="linenum"> 585</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[&quot;userid&quot;] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l586"><span class="linenum"> 586</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[&quot;userid2&quot;] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l587"><span class="linenum"> 587</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = &quot;AND u.id = :userid&quot;;
<a name="l588"><span class="linenum"> 588</span></a>          <a class="var it24085" onMouseOver="hilite(24085)" onMouseOut="lolite()" onClick="logVariable('fuser')" href="../../_variables/fuser.html">$fuser</a> = &quot;AND uu.id = :userid2&quot;;
<a name="l589"><span class="linenum"> 589</span></a>      }
<a name="l590"><span class="linenum"> 590</span></a>      else {
<a name="l591"><span class="linenum"> 591</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>=&quot;&quot;;
<a name="l592"><span class="linenum"> 592</span></a>          <a class="var it24085" onMouseOver="hilite(24085)" onMouseOut="lolite()" onClick="logVariable('fuser')" href="../../_variables/fuser.html">$fuser</a>=&quot;&quot;;
<a name="l593"><span class="linenum"> 593</span></a>      }
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>      if (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('retake')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/retake.html">retake</a>) {
<a name="l596"><span class="linenum"> 596</span></a>          if (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('usemaxgrade')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/usemaxgrade.html">usemaxgrade</a>) {
<a name="l597"><span class="linenum"> 597</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT u.id, u.id AS userid, <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(g.grade) AS rawgrade
<a name="l598"><span class="linenum"> 598</span></a>                        FROM {user} u, {lesson_grades} g
<a name="l599"><span class="linenum"> 599</span></a>                       WHERE u.id = g.userid AND g.lessonid = :lessonid
<a name="l600"><span class="linenum"> 600</span></a>                             <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>
<a name="l601"><span class="linenum"> 601</span></a>                    GROUP BY u.id&quot;;
<a name="l602"><span class="linenum"> 602</span></a>          } else {
<a name="l603"><span class="linenum"> 603</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT u.id, u.id AS userid, <a class="function" onClick="logFunction('AVG')" href="../../_functions/avg.html" onMouseOver="funcPopup(event,'avg')">AVG</a>(g.grade) AS rawgrade
<a name="l604"><span class="linenum"> 604</span></a>                        FROM {user} u, {lesson_grades} g
<a name="l605"><span class="linenum"> 605</span></a>                       WHERE u.id = g.userid AND g.lessonid = :lessonid
<a name="l606"><span class="linenum"> 606</span></a>                             <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>
<a name="l607"><span class="linenum"> 607</span></a>                    GROUP BY u.id&quot;;
<a name="l608"><span class="linenum"> 608</span></a>          }
<a name="l609"><span class="linenum"> 609</span></a>          unset(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['lessonid2']);
<a name="l610"><span class="linenum"> 610</span></a>          unset(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['userid2']);
<a name="l611"><span class="linenum"> 611</span></a>      } else {
<a name="l612"><span class="linenum"> 612</span></a>  <span class="comment">        // use only first attempts (with lowest id in lesson_grades table)</span>
<a name="l613"><span class="linenum"> 613</span></a>          <a class="var it24087" onMouseOver="hilite(24087)" onMouseOut="lolite()" onClick="logVariable('firstonly')" href="../../_variables/firstonly.html">$firstonly</a> = &quot;SELECT uu.id AS userid, <a class="phpfunction" onClick="logFunction('MIN')" href="../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">MIN</a>(gg.id) AS firstcompleted
<a name="l614"><span class="linenum"> 614</span></a>                          FROM {user} uu, {lesson_grades} gg
<a name="l615"><span class="linenum"> 615</span></a>                         WHERE uu.id = gg.userid AND gg.lessonid = :lessonid2
<a name="l616"><span class="linenum"> 616</span></a>                               <a class="var it24085" onMouseOver="hilite(24085)" onMouseOut="lolite()" onClick="logVariable('fuser')" href="../../_variables/fuser.html">$fuser</a>
<a name="l617"><span class="linenum"> 617</span></a>                         GROUP BY uu.id&quot;;
<a name="l618"><span class="linenum"> 618</span></a>  
<a name="l619"><span class="linenum"> 619</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT u.id, u.id AS userid, g.grade AS rawgrade
<a name="l620"><span class="linenum"> 620</span></a>                    FROM {user} u, {lesson_grades} g, (<a class="var it24087" onMouseOver="hilite(24087)" onMouseOut="lolite()" onClick="logVariable('firstonly')" href="../../_variables/firstonly.html">$firstonly</a>) f
<a name="l621"><span class="linenum"> 621</span></a>                   WHERE u.id = g.userid AND g.lessonid = :lessonid
<a name="l622"><span class="linenum"> 622</span></a>                         AND g.id = f.firstcompleted AND g.userid=f.userid
<a name="l623"><span class="linenum"> 623</span></a>                         <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>&quot;;
<a name="l624"><span class="linenum"> 624</span></a>      }
<a name="l625"><span class="linenum"> 625</span></a>  
<a name="l626"><span class="linenum"> 626</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l627"><span class="linenum"> 627</span></a>  }
<a name="l628"><span class="linenum"> 628</span></a>  
<a name="l629"><span class="linenum"> 629</span></a>  <span class="comment">/**</span>
<a name="l630"><span class="linenum"> 630</span></a>  <span class="comment"> * Update grades in central gradebook</span>
<a name="l631"><span class="linenum"> 631</span></a>  <span class="comment"> *</span>
<a name="l632"><span class="linenum"> 632</span></a>  <span class="comment"> * @category grade</span>
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment"> * @param object $lesson</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment"> * @param int $userid specific user only, 0 means all</span>
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment"> * @param bool $nullifnone</span>
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment"> */</span>
<a name="l637"><span class="linenum"> 637</span></a>  function <a class="function" onClick="logFunction('lesson_update_grades')" href="../../_functions/lesson_update_grades.html" onMouseOver="funcPopup(event,'lesson_update_grades')">lesson_update_grades</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=0, <a class="var it7075" onMouseOver="hilite(7075)" onMouseOut="lolite()" onClick="logVariable('nullifnone')" href="../../_variables/nullifnone.html">$nullifnone</a>=true) {
<a name="l638"><span class="linenum"> 638</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l639"><span class="linenum"> 639</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/gradelib.php');
<a name="l640"><span class="linenum"> 640</span></a>  
<a name="l641"><span class="linenum"> 641</span></a>      if (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a> == 0 || <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('practice')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/practice.html">practice</a>) {
<a name="l642"><span class="linenum"> 642</span></a>          <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l643"><span class="linenum"> 643</span></a>  
<a name="l644"><span class="linenum"> 644</span></a>      } else if (<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="function" onClick="logFunction('lesson_get_user_grades')" href="../../_functions/lesson_get_user_grades.html" onMouseOver="funcPopup(event,'lesson_get_user_grades')">lesson_get_user_grades</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l645"><span class="linenum"> 645</span></a>          <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l646"><span class="linenum"> 646</span></a>  
<a name="l647"><span class="linenum"> 647</span></a>      } else if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> and <a class="var it7075" onMouseOver="hilite(7075)" onMouseOut="lolite()" onClick="logVariable('nullifnone')" href="../../_variables/nullifnone.html">$nullifnone</a>) {
<a name="l648"><span class="linenum"> 648</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = new stdClass();
<a name="l649"><span class="linenum"> 649</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('userid')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>   = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l650"><span class="linenum"> 650</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a> = null;
<a name="l651"><span class="linenum"> 651</span></a>          <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>);
<a name="l652"><span class="linenum"> 652</span></a>  
<a name="l653"><span class="linenum"> 653</span></a>      } else {
<a name="l654"><span class="linenum"> 654</span></a>          <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l655"><span class="linenum"> 655</span></a>      }
<a name="l656"><span class="linenum"> 656</span></a>  }
<a name="l657"><span class="linenum"> 657</span></a>  
<a name="l658"><span class="linenum"> 658</span></a>  <span class="comment">/**</span>
<a name="l659"><span class="linenum"> 659</span></a>  <span class="comment"> * Create grade item for given lesson</span>
<a name="l660"><span class="linenum"> 660</span></a>  <span class="comment"> *</span>
<a name="l661"><span class="linenum"> 661</span></a>  <span class="comment"> * @category grade</span>
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment"> * @uses GRADE_TYPE_VALUE</span>
<a name="l663"><span class="linenum"> 663</span></a>  <span class="comment"> * @uses GRADE_TYPE_NONE</span>
<a name="l664"><span class="linenum"> 664</span></a>  <span class="comment"> * @param object $lesson object with extra cmidnumber</span>
<a name="l665"><span class="linenum"> 665</span></a>  <span class="comment"> * @param array|object $grades optional array/object of grade(s); 'reset' means reset grades in gradebook</span>
<a name="l666"><span class="linenum"> 666</span></a>  <span class="comment"> * @return int 0 if ok, error code otherwise</span>
<a name="l667"><span class="linenum"> 667</span></a>  <span class="comment"> */</span>
<a name="l668"><span class="linenum"> 668</span></a>  function <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>=null) {
<a name="l669"><span class="linenum"> 669</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l670"><span class="linenum"> 670</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('grade_update')) { //workaround for buggy PHP versions
<a name="l671"><span class="linenum"> 671</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/gradelib.php');
<a name="l672"><span class="linenum"> 672</span></a>      }
<a name="l673"><span class="linenum"> 673</span></a>  
<a name="l674"><span class="linenum"> 674</span></a>      if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('cmidnumber', <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>)) { //it may not be always present
<a name="l675"><span class="linenum"> 675</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('itemname'=&gt;<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>, 'idnumber'=&gt;<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/cmidnumber.html">cmidnumber</a>);
<a name="l676"><span class="linenum"> 676</span></a>      } else {
<a name="l677"><span class="linenum"> 677</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('itemname'=&gt;<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>);
<a name="l678"><span class="linenum"> 678</span></a>      }
<a name="l679"><span class="linenum"> 679</span></a>  
<a name="l680"><span class="linenum"> 680</span></a>      if (!<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('practice')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/practice.html">practice</a> and <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a> &gt; 0) {
<a name="l681"><span class="linenum"> 681</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gradetype']  = <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a>;
<a name="l682"><span class="linenum"> 682</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademax']   = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a>;
<a name="l683"><span class="linenum"> 683</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademin']   = 0;
<a name="l684"><span class="linenum"> 684</span></a>      } else if (!<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('practice')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/practice.html">practice</a> and <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a> &lt; 0) {
<a name="l685"><span class="linenum"> 685</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gradetype']  = <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>;
<a name="l686"><span class="linenum"> 686</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['scaleid']   = -<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a>;
<a name="l687"><span class="linenum"> 687</span></a>  
<a name="l688"><span class="linenum"> 688</span></a>  <span class="comment">        // Make sure current grade fetched correctly from $grades</span>
<a name="l689"><span class="linenum"> 689</span></a>          <a class="var it24088" onMouseOver="hilite(24088)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a> = null;
<a name="l690"><span class="linenum"> 690</span></a>          if (!empty(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l691"><span class="linenum"> 691</span></a>              if (<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l692"><span class="linenum"> 692</span></a>                  <a class="var it24088" onMouseOver="hilite(24088)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l693"><span class="linenum"> 693</span></a>              } else {
<a name="l694"><span class="linenum"> 694</span></a>                  <a class="var it24088" onMouseOver="hilite(24088)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a> = <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>;
<a name="l695"><span class="linenum"> 695</span></a>              }
<a name="l696"><span class="linenum"> 696</span></a>          }
<a name="l697"><span class="linenum"> 697</span></a>  
<a name="l698"><span class="linenum"> 698</span></a>  <span class="comment">        // When converting a score to a scale, use scale's grade maximum to calculate it.</span>
<a name="l699"><span class="linenum"> 699</span></a>          if (!empty(<a class="var it24088" onMouseOver="hilite(24088)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a>) &amp;&amp; <a class="var it24088" onMouseOver="hilite(24088)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it41630" onMouseOver="hilite(41630)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a> !== null) {
<a name="l700"><span class="linenum"> 700</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <a class="function" onClick="logFunction('grade_get_grades')" href="../../_functions/grade_get_grades.html" onMouseOver="funcPopup(event,'grade_get_grades')">grade_get_grades</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, 'mod', 'lesson', <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it24088" onMouseOver="hilite(24088)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a>-&gt;<a onClick="logVariable('userid')" class="var it41630" onMouseOver="hilite(41630)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l701"><span class="linenum"> 701</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademax']   = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('items')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>)-&gt;grademax;
<a name="l702"><span class="linenum"> 702</span></a>          }
<a name="l703"><span class="linenum"> 703</span></a>      } else {
<a name="l704"><span class="linenum"> 704</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gradetype']  = <a class="constant" onClick="logConstant('GRADE_TYPE_NONE')" href="../../_constants/GRADE_TYPE_NONE.html" onMouseOver="constPopup(event,'GRADE_TYPE_NONE')">GRADE_TYPE_NONE</a>;
<a name="l705"><span class="linenum"> 705</span></a>      }
<a name="l706"><span class="linenum"> 706</span></a>  
<a name="l707"><span class="linenum"> 707</span></a>      if (<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>  === 'reset') {
<a name="l708"><span class="linenum"> 708</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['reset'] = true;
<a name="l709"><span class="linenum"> 709</span></a>          <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = null;
<a name="l710"><span class="linenum"> 710</span></a>      } else if (!empty(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l711"><span class="linenum"> 711</span></a>  <span class="comment">        // Need to calculate raw grade (Note: $grades has many forms)</span>
<a name="l712"><span class="linenum"> 712</span></a>          if (<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l713"><span class="linenum"> 713</span></a>              <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = array(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('userid')" class="var it40209" onMouseOver="hilite(40209)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> =&gt; <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l714"><span class="linenum"> 714</span></a>          } else if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('userid', <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l715"><span class="linenum"> 715</span></a>              <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = array(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>['userid'] =&gt; <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l716"><span class="linenum"> 716</span></a>          }
<a name="l717"><span class="linenum"> 717</span></a>          foreach (<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>) {
<a name="l718"><span class="linenum"> 718</span></a>              if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>)) {
<a name="l719"><span class="linenum"> 719</span></a>                  <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>] = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = (array) <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>;
<a name="l720"><span class="linenum"> 720</span></a>              }
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment">            //check raw grade isnt null otherwise we erroneously insert a grade of 0</span>
<a name="l722"><span class="linenum"> 722</span></a>              if (<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>['rawgrade'] !== null) {
<a name="l723"><span class="linenum"> 723</span></a>                  <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>]['rawgrade'] = (<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>['rawgrade'] * <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademax'] / 100);
<a name="l724"><span class="linenum"> 724</span></a>              } else {
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment">                //setting rawgrade to null just in case user is deleting a grade</span>
<a name="l726"><span class="linenum"> 726</span></a>                  <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>]['rawgrade'] = null;
<a name="l727"><span class="linenum"> 727</span></a>              }
<a name="l728"><span class="linenum"> 728</span></a>          }
<a name="l729"><span class="linenum"> 729</span></a>      }
<a name="l730"><span class="linenum"> 730</span></a>  
<a name="l731"><span class="linenum"> 731</span></a>      return <a class="function" onClick="logFunction('grade_update')" href="../../_functions/grade_update.html" onMouseOver="funcPopup(event,'grade_update')">grade_update</a>('mod/lesson', <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, 'mod', 'lesson', <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 0, <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l732"><span class="linenum"> 732</span></a>  }
<a name="l733"><span class="linenum"> 733</span></a>  
<a name="l734"><span class="linenum"> 734</span></a>  <span class="comment">/**</span>
<a name="l735"><span class="linenum"> 735</span></a>  <span class="comment"> * List the actions that correspond to a view of this module.</span>
<a name="l736"><span class="linenum"> 736</span></a>  <span class="comment"> * This is used by the participation report.</span>
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment"> *</span>
<a name="l738"><span class="linenum"> 738</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l739"><span class="linenum"> 739</span></a>  <span class="comment"> *       crud = 'r' and edulevel = LEVEL_PARTICIPATING will</span>
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment"> *       be considered as view action.</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment"> *</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment"> * @return array</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="comment"> */</span>
<a name="l744"><span class="linenum"> 744</span></a>  function <a class="function" onClick="logFunction('lesson_get_view_actions')" href="../../_functions/lesson_get_view_actions.html" onMouseOver="funcPopup(event,'lesson_get_view_actions')">lesson_get_view_actions</a>() {
<a name="l745"><span class="linenum"> 745</span></a>      return array('view','view all');
<a name="l746"><span class="linenum"> 746</span></a>  }
<a name="l747"><span class="linenum"> 747</span></a>  
<a name="l748"><span class="linenum"> 748</span></a>  <span class="comment">/**</span>
<a name="l749"><span class="linenum"> 749</span></a>  <span class="comment"> * List the actions that correspond to a post of this module.</span>
<a name="l750"><span class="linenum"> 750</span></a>  <span class="comment"> * This is used by the participation report.</span>
<a name="l751"><span class="linenum"> 751</span></a>  <span class="comment"> *</span>
<a name="l752"><span class="linenum"> 752</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l753"><span class="linenum"> 753</span></a>  <span class="comment"> *       crud = ('c' || 'u' || 'd') and edulevel = LEVEL_PARTICIPATING</span>
<a name="l754"><span class="linenum"> 754</span></a>  <span class="comment"> *       will be considered as post action.</span>
<a name="l755"><span class="linenum"> 755</span></a>  <span class="comment"> *</span>
<a name="l756"><span class="linenum"> 756</span></a>  <span class="comment"> * @return array</span>
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment"> */</span>
<a name="l758"><span class="linenum"> 758</span></a>  function <a class="function" onClick="logFunction('lesson_get_post_actions')" href="../../_functions/lesson_get_post_actions.html" onMouseOver="funcPopup(event,'lesson_get_post_actions')">lesson_get_post_actions</a>() {
<a name="l759"><span class="linenum"> 759</span></a>      return array('end','start');
<a name="l760"><span class="linenum"> 760</span></a>  }
<a name="l761"><span class="linenum"> 761</span></a>  
<a name="l762"><span class="linenum"> 762</span></a>  <span class="comment">/**</span>
<a name="l763"><span class="linenum"> 763</span></a>  <span class="comment"> * Runs any processes that must run before</span>
<a name="l764"><span class="linenum"> 764</span></a>  <span class="comment"> * a lesson insert/update</span>
<a name="l765"><span class="linenum"> 765</span></a>  <span class="comment"> *</span>
<a name="l766"><span class="linenum"> 766</span></a>  <span class="comment"> * @global object</span>
<a name="l767"><span class="linenum"> 767</span></a>  <span class="comment"> * @param object $lesson Lesson form data</span>
<a name="l768"><span class="linenum"> 768</span></a>  <span class="comment"> * @return void</span>
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment"> **/</span>
<a name="l770"><span class="linenum"> 770</span></a>  function <a class="function" onClick="logFunction('lesson_process_pre_save')" href="../../_functions/lesson_process_pre_save.html" onMouseOver="funcPopup(event,'lesson_process_pre_save')">lesson_process_pre_save</a>(&amp;<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l771"><span class="linenum"> 771</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l772"><span class="linenum"> 772</span></a>  
<a name="l773"><span class="linenum"> 773</span></a>      <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l774"><span class="linenum"> 774</span></a>  
<a name="l775"><span class="linenum"> 775</span></a>      if (empty(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timelimit')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/timelimit.html">timelimit</a>)) {
<a name="l776"><span class="linenum"> 776</span></a>          <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timelimit')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/timelimit.html">timelimit</a> = 0;
<a name="l777"><span class="linenum"> 777</span></a>      }
<a name="l778"><span class="linenum"> 778</span></a>      if (empty(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a>) or !<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a>) or <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a> &lt; 0) {
<a name="l779"><span class="linenum"> 779</span></a>          <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a> = 0;
<a name="l780"><span class="linenum"> 780</span></a>      }
<a name="l781"><span class="linenum"> 781</span></a>      if (!isset(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completed')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a>)) {
<a name="l782"><span class="linenum"> 782</span></a>          <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completed')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a> = 0;
<a name="l783"><span class="linenum"> 783</span></a>      }
<a name="l784"><span class="linenum"> 784</span></a>      if (empty(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a>) or !<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a>) or <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> &lt; 0) {
<a name="l785"><span class="linenum"> 785</span></a>          <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> = 0;
<a name="l786"><span class="linenum"> 786</span></a>      } else if (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> &gt; 100) {
<a name="l787"><span class="linenum"> 787</span></a>          <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> = 100;
<a name="l788"><span class="linenum"> 788</span></a>      }
<a name="l789"><span class="linenum"> 789</span></a>  
<a name="l790"><span class="linenum"> 790</span></a>      if (empty(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('width')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/width.html">width</a>)) {
<a name="l791"><span class="linenum"> 791</span></a>          <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('width')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/width.html">width</a> = 640;
<a name="l792"><span class="linenum"> 792</span></a>      }
<a name="l793"><span class="linenum"> 793</span></a>      if (empty(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('height')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/height.html">height</a>)) {
<a name="l794"><span class="linenum"> 794</span></a>          <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('height')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/height.html">height</a> = 480;
<a name="l795"><span class="linenum"> 795</span></a>      }
<a name="l796"><span class="linenum"> 796</span></a>      if (empty(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('bgcolor')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/bgcolor.html">bgcolor</a>)) {
<a name="l797"><span class="linenum"> 797</span></a>          <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('bgcolor')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/bgcolor.html">bgcolor</a> = '#FFFFFF';
<a name="l798"><span class="linenum"> 798</span></a>      }
<a name="l799"><span class="linenum"> 799</span></a>  
<a name="l800"><span class="linenum"> 800</span></a>  <span class="comment">    // Conditions for dependency</span>
<a name="l801"><span class="linenum"> 801</span></a>      <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a> = new stdClass;
<a name="l802"><span class="linenum"> 802</span></a>      <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>-&gt;<a onClick="logVariable('timespent')" class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a> = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a>;
<a name="l803"><span class="linenum"> 803</span></a>      <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>-&gt;<a onClick="logVariable('completed')" class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a> = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completed')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a>;
<a name="l804"><span class="linenum"> 804</span></a>      <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it41631" onMouseOver="hilite(41631)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> = <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a>;
<a name="l805"><span class="linenum"> 805</span></a>      <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('conditions')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/conditions.html">conditions</a> = <a class="phpfunction" onClick="logFunction('serialize')" href="../../_functions/serialize.html" onMouseOver="phpfuncPopup(event,'serialize')">serialize</a>(<a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>);
<a name="l806"><span class="linenum"> 806</span></a>      unset(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a>);
<a name="l807"><span class="linenum"> 807</span></a>      unset(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completed')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a>);
<a name="l808"><span class="linenum"> 808</span></a>      unset(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a>);
<a name="l809"><span class="linenum"> 809</span></a>  
<a name="l810"><span class="linenum"> 810</span></a>      if (empty(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('password')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/password.html">password</a>)) {
<a name="l811"><span class="linenum"> 811</span></a>          unset(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('password')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/password.html">password</a>);
<a name="l812"><span class="linenum"> 812</span></a>      }
<a name="l813"><span class="linenum"> 813</span></a>  }
<a name="l814"><span class="linenum"> 814</span></a>  
<a name="l815"><span class="linenum"> 815</span></a>  <span class="comment">/**</span>
<a name="l816"><span class="linenum"> 816</span></a>  <span class="comment"> * Runs any processes that must be run</span>
<a name="l817"><span class="linenum"> 817</span></a>  <span class="comment"> * after a lesson insert/update</span>
<a name="l818"><span class="linenum"> 818</span></a>  <span class="comment"> *</span>
<a name="l819"><span class="linenum"> 819</span></a>  <span class="comment"> * @global object</span>
<a name="l820"><span class="linenum"> 820</span></a>  <span class="comment"> * @param object $lesson Lesson form data</span>
<a name="l821"><span class="linenum"> 821</span></a>  <span class="comment"> * @return void</span>
<a name="l822"><span class="linenum"> 822</span></a>  <span class="comment"> **/</span>
<a name="l823"><span class="linenum"> 823</span></a>  function <a class="function" onClick="logFunction('lesson_process_post_save')" href="../../_functions/lesson_process_post_save.html" onMouseOver="funcPopup(event,'lesson_process_post_save')">lesson_process_post_save</a>(&amp;<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l824"><span class="linenum"> 824</span></a>  <span class="comment">    // Update the events relating to this lesson.</span>
<a name="l825"><span class="linenum"> 825</span></a>      <a class="function" onClick="logFunction('lesson_update_events')" href="../../_functions/lesson_update_events.html" onMouseOver="funcPopup(event,'lesson_update_events')">lesson_update_events</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l826"><span class="linenum"> 826</span></a>  }
<a name="l827"><span class="linenum"> 827</span></a>  
<a name="l828"><span class="linenum"> 828</span></a>  
<a name="l829"><span class="linenum"> 829</span></a>  <span class="comment">/**</span>
<a name="l830"><span class="linenum"> 830</span></a>  <span class="comment"> * Implementation of the function for printing the form elements that control</span>
<a name="l831"><span class="linenum"> 831</span></a>  <span class="comment"> * whether the course reset functionality affects the lesson.</span>
<a name="l832"><span class="linenum"> 832</span></a>  <span class="comment"> *</span>
<a name="l833"><span class="linenum"> 833</span></a>  <span class="comment"> * @param $mform form passed by reference</span>
<a name="l834"><span class="linenum"> 834</span></a>  <span class="comment"> */</span>
<a name="l835"><span class="linenum"> 835</span></a>  function <a class="function" onClick="logFunction('lesson_reset_course_form_definition')" href="../../_functions/lesson_reset_course_form_definition.html" onMouseOver="funcPopup(event,'lesson_reset_course_form_definition')">lesson_reset_course_form_definition</a>(&amp;<a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l836"><span class="linenum"> 836</span></a>      <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('header', 'lessonheader', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulenameplural', 'lesson'));
<a name="l837"><span class="linenum"> 837</span></a>      <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('advcheckbox', 'reset_lesson', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('deleteallattempts','lesson'));
<a name="l838"><span class="linenum"> 838</span></a>      <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('advcheckbox', 'reset_lesson_user_overrides',
<a name="l839"><span class="linenum"> 839</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('removealluseroverrides', 'lesson'));
<a name="l840"><span class="linenum"> 840</span></a>      <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('advcheckbox', 'reset_lesson_group_overrides',
<a name="l841"><span class="linenum"> 841</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('removeallgroupoverrides', 'lesson'));
<a name="l842"><span class="linenum"> 842</span></a>  }
<a name="l843"><span class="linenum"> 843</span></a>  
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">/**</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment"> * Course reset form defaults.</span>
<a name="l846"><span class="linenum"> 846</span></a>  <span class="comment"> * @param object $course</span>
<a name="l847"><span class="linenum"> 847</span></a>  <span class="comment"> * @return array</span>
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment"> */</span>
<a name="l849"><span class="linenum"> 849</span></a>  function <a class="function" onClick="logFunction('lesson_reset_course_form_defaults')" href="../../_functions/lesson_reset_course_form_defaults.html" onMouseOver="funcPopup(event,'lesson_reset_course_form_defaults')">lesson_reset_course_form_defaults</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l850"><span class="linenum"> 850</span></a>      return array('reset_lesson' =&gt; 1,
<a name="l851"><span class="linenum"> 851</span></a>              'reset_lesson_group_overrides' =&gt; 1,
<a name="l852"><span class="linenum"> 852</span></a>              'reset_lesson_user_overrides' =&gt; 1);
<a name="l853"><span class="linenum"> 853</span></a>  }
<a name="l854"><span class="linenum"> 854</span></a>  
<a name="l855"><span class="linenum"> 855</span></a>  <span class="comment">/**</span>
<a name="l856"><span class="linenum"> 856</span></a>  <span class="comment"> * Removes all grades from gradebook</span>
<a name="l857"><span class="linenum"> 857</span></a>  <span class="comment"> *</span>
<a name="l858"><span class="linenum"> 858</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l859"><span class="linenum"> 859</span></a>  <span class="comment"> * @global object</span>
<a name="l860"><span class="linenum"> 860</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l861"><span class="linenum"> 861</span></a>  <span class="comment"> * @param string optional type</span>
<a name="l862"><span class="linenum"> 862</span></a>  <span class="comment"> */</span>
<a name="l863"><span class="linenum"> 863</span></a>  function <a class="function" onClick="logFunction('lesson_reset_gradebook')" href="../../_functions/lesson_reset_gradebook.html" onMouseOver="funcPopup(event,'lesson_reset_gradebook')">lesson_reset_gradebook</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>='') {
<a name="l864"><span class="linenum"> 864</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l865"><span class="linenum"> 865</span></a>  
<a name="l866"><span class="linenum"> 866</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT l.*, cm.idnumber as cmidnumber, l.course as courseid
<a name="l867"><span class="linenum"> 867</span></a>                FROM {lesson} l, {course_modules} cm, {modules} m
<a name="l868"><span class="linenum"> 868</span></a>               WHERE m.name='lesson' AND m.id=cm.module AND cm.instance=l.id AND l.course=:course&quot;;
<a name="l869"><span class="linenum"> 869</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array (&quot;course&quot; =&gt; <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l870"><span class="linenum"> 870</span></a>      if (<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>,<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l871"><span class="linenum"> 871</span></a>          foreach (<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l872"><span class="linenum"> 872</span></a>              <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, 'reset');
<a name="l873"><span class="linenum"> 873</span></a>          }
<a name="l874"><span class="linenum"> 874</span></a>      }
<a name="l875"><span class="linenum"> 875</span></a>  }
<a name="l876"><span class="linenum"> 876</span></a>  
<a name="l877"><span class="linenum"> 877</span></a>  <span class="comment">/**</span>
<a name="l878"><span class="linenum"> 878</span></a>  <span class="comment"> * Actual implementation of the reset course functionality, delete all the</span>
<a name="l879"><span class="linenum"> 879</span></a>  <span class="comment"> * lesson attempts for course $data-&gt;courseid.</span>
<a name="l880"><span class="linenum"> 880</span></a>  <span class="comment"> *</span>
<a name="l881"><span class="linenum"> 881</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l882"><span class="linenum"> 882</span></a>  <span class="comment"> * @global object</span>
<a name="l883"><span class="linenum"> 883</span></a>  <span class="comment"> * @param object $data the data submitted from the reset course.</span>
<a name="l884"><span class="linenum"> 884</span></a>  <span class="comment"> * @return array status array</span>
<a name="l885"><span class="linenum"> 885</span></a>  <span class="comment"> */</span>
<a name="l886"><span class="linenum"> 886</span></a>  function <a class="function" onClick="logFunction('lesson_reset_userdata')" href="../../_functions/lesson_reset_userdata.html" onMouseOver="funcPopup(event,'lesson_reset_userdata')">lesson_reset_userdata</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>) {
<a name="l887"><span class="linenum"> 887</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l888"><span class="linenum"> 888</span></a>  
<a name="l889"><span class="linenum"> 889</span></a>      <a class="var it13021" onMouseOver="hilite(13021)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulenameplural', 'lesson');
<a name="l890"><span class="linenum"> 890</span></a>      <a class="var it741" onMouseOver="hilite(741)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = array();
<a name="l891"><span class="linenum"> 891</span></a>  
<a name="l892"><span class="linenum"> 892</span></a>      if (!empty(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_lesson')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/reset_lesson.html">reset_lesson</a>)) {
<a name="l893"><span class="linenum"> 893</span></a>          <a class="var it24090" onMouseOver="hilite(24090)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a> = &quot;SELECT l.id
<a name="l894"><span class="linenum"> 894</span></a>                           FROM {lesson} l
<a name="l895"><span class="linenum"> 895</span></a>                          WHERE l.course=:course&quot;;
<a name="l896"><span class="linenum"> 896</span></a>  
<a name="l897"><span class="linenum"> 897</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array (&quot;course&quot; =&gt; <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l898"><span class="linenum"> 898</span></a>          <a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it24090" onMouseOver="hilite(24090)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l899"><span class="linenum"> 899</span></a>  
<a name="l900"><span class="linenum"> 900</span></a>  <span class="comment">        // Get rid of attempts files.</span>
<a name="l901"><span class="linenum"> 901</span></a>          <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l902"><span class="linenum"> 902</span></a>          if (<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a>) {
<a name="l903"><span class="linenum"> 903</span></a>              foreach (<a class="var it24079" onMouseOver="hilite(24079)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a> =&gt; <a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>) {
<a name="l904"><span class="linenum"> 904</span></a>                  if (!<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('lesson', <a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>)) {
<a name="l905"><span class="linenum"> 905</span></a>                      continue;
<a name="l906"><span class="linenum"> 906</span></a>                  }
<a name="l907"><span class="linenum"> 907</span></a>                  <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l908"><span class="linenum"> 908</span></a>                  <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_lesson', 'essay_responses');
<a name="l909"><span class="linenum"> 909</span></a>              }
<a name="l910"><span class="linenum"> 910</span></a>          }
<a name="l911"><span class="linenum"> 911</span></a>  
<a name="l912"><span class="linenum"> 912</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_timer', &quot;lessonid IN (<a class="var it24090" onMouseOver="hilite(24090)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>)&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l913"><span class="linenum"> 913</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_high_scores', &quot;lessonid IN (<a class="var it24090" onMouseOver="hilite(24090)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>)&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l914"><span class="linenum"> 914</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_grades', &quot;lessonid IN (<a class="var it24090" onMouseOver="hilite(24090)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>)&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l915"><span class="linenum"> 915</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_attempts', &quot;lessonid IN (<a class="var it24090" onMouseOver="hilite(24090)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>)&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l916"><span class="linenum"> 916</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_branch', &quot;lessonid IN (<a class="var it24090" onMouseOver="hilite(24090)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>)&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l917"><span class="linenum"> 917</span></a>  
<a name="l918"><span class="linenum"> 918</span></a>  <span class="comment">        // remove all grades from gradebook</span>
<a name="l919"><span class="linenum"> 919</span></a>          if (empty(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_gradebook_grades')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/reset_gradebook_grades.html">reset_gradebook_grades</a>)) {
<a name="l920"><span class="linenum"> 920</span></a>              <a class="function" onClick="logFunction('lesson_reset_gradebook')" href="../../_functions/lesson_reset_gradebook.html" onMouseOver="funcPopup(event,'lesson_reset_gradebook')">lesson_reset_gradebook</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l921"><span class="linenum"> 921</span></a>          }
<a name="l922"><span class="linenum"> 922</span></a>  
<a name="l923"><span class="linenum"> 923</span></a>          <a class="var it741" onMouseOver="hilite(741)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component'=&gt;<a class="var it13021" onMouseOver="hilite(13021)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('deleteallattempts', 'lesson'), 'error'=&gt;false);
<a name="l924"><span class="linenum"> 924</span></a>      }
<a name="l925"><span class="linenum"> 925</span></a>  
<a name="l926"><span class="linenum"> 926</span></a>  <span class="comment">    // Remove user overrides.</span>
<a name="l927"><span class="linenum"> 927</span></a>      if (!empty(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_lesson_user_overrides')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/reset_lesson_user_overrides.html">reset_lesson_user_overrides</a>)) {
<a name="l928"><span class="linenum"> 928</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_overrides',
<a name="l929"><span class="linenum"> 929</span></a>                  'lessonid IN (SELECT id FROM {lesson} WHERE course = ?) AND userid IS NOT NULL', array(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l930"><span class="linenum"> 930</span></a>          <a class="var it741" onMouseOver="hilite(741)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array(
<a name="l931"><span class="linenum"> 931</span></a>          'component' =&gt; <a class="var it13021" onMouseOver="hilite(13021)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>,
<a name="l932"><span class="linenum"> 932</span></a>          'item' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('useroverridesdeleted', 'lesson'),
<a name="l933"><span class="linenum"> 933</span></a>          'error' =&gt; false);
<a name="l934"><span class="linenum"> 934</span></a>      }
<a name="l935"><span class="linenum"> 935</span></a>  <span class="comment">    // Remove group overrides.</span>
<a name="l936"><span class="linenum"> 936</span></a>      if (!empty(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_lesson_group_overrides')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/reset_lesson_group_overrides.html">reset_lesson_group_overrides</a>)) {
<a name="l937"><span class="linenum"> 937</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_overrides',
<a name="l938"><span class="linenum"> 938</span></a>          'lessonid IN (SELECT id FROM {lesson} WHERE course = ?) AND groupid IS NOT NULL', array(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l939"><span class="linenum"> 939</span></a>          <a class="var it741" onMouseOver="hilite(741)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array(
<a name="l940"><span class="linenum"> 940</span></a>          'component' =&gt; <a class="var it13021" onMouseOver="hilite(13021)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>,
<a name="l941"><span class="linenum"> 941</span></a>          'item' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('groupoverridesdeleted', 'lesson'),
<a name="l942"><span class="linenum"> 942</span></a>          'error' =&gt; false);
<a name="l943"><span class="linenum"> 943</span></a>      }
<a name="l944"><span class="linenum"> 944</span></a>  <span class="comment">    /// updating dates - shift may be negative too</span>
<a name="l945"><span class="linenum"> 945</span></a>      if (<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>) {
<a name="l946"><span class="linenum"> 946</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;UPDATE {lesson_overrides}
<a name="l947"><span class="linenum"> 947</span></a>                           SET available = available + ?
<a name="l948"><span class="linenum"> 948</span></a>                         WHERE lessonid IN (SELECT id FROM {lesson} WHERE course = ?)
<a name="l949"><span class="linenum"> 949</span></a>                           AND available &lt;&gt; 0&quot;, array(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>, <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l950"><span class="linenum"> 950</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;UPDATE {lesson_overrides}
<a name="l951"><span class="linenum"> 951</span></a>                           SET deadline = deadline + ?
<a name="l952"><span class="linenum"> 952</span></a>                         WHERE lessonid IN (SELECT id FROM {lesson} WHERE course = ?)
<a name="l953"><span class="linenum"> 953</span></a>                           AND deadline &lt;&gt; 0&quot;, array(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>, <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l954"><span class="linenum"> 954</span></a>  
<a name="l955"><span class="linenum"> 955</span></a>          <a class="function" onClick="logFunction('shift_course_mod_dates')" href="../../_functions/shift_course_mod_dates.html" onMouseOver="funcPopup(event,'shift_course_mod_dates')">shift_course_mod_dates</a>('lesson', array('available', 'deadline'), <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>, <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it39495" onMouseOver="hilite(39495)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l956"><span class="linenum"> 956</span></a>          <a class="var it741" onMouseOver="hilite(741)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component'=&gt;<a class="var it13021" onMouseOver="hilite(13021)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('datechanged'), 'error'=&gt;false);
<a name="l957"><span class="linenum"> 957</span></a>      }
<a name="l958"><span class="linenum"> 958</span></a>  
<a name="l959"><span class="linenum"> 959</span></a>      return <a class="var it741" onMouseOver="hilite(741)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>;
<a name="l960"><span class="linenum"> 960</span></a>  }
<a name="l961"><span class="linenum"> 961</span></a>  
<a name="l962"><span class="linenum"> 962</span></a>  <span class="comment">/**</span>
<a name="l963"><span class="linenum"> 963</span></a>  <span class="comment"> * Returns all other caps used in module</span>
<a name="l964"><span class="linenum"> 964</span></a>  <span class="comment"> * @return array</span>
<a name="l965"><span class="linenum"> 965</span></a>  <span class="comment"> */</span>
<a name="l966"><span class="linenum"> 966</span></a>  function <a class="function" onClick="logFunction('lesson_get_extra_capabilities')" href="../../_functions/lesson_get_extra_capabilities.html" onMouseOver="funcPopup(event,'lesson_get_extra_capabilities')">lesson_get_extra_capabilities</a>() {
<a name="l967"><span class="linenum"> 967</span></a>      return array('moodle/site:accessallgroups');
<a name="l968"><span class="linenum"> 968</span></a>  }
<a name="l969"><span class="linenum"> 969</span></a>  
<a name="l970"><span class="linenum"> 970</span></a>  <span class="comment">/**</span>
<a name="l971"><span class="linenum"> 971</span></a>  <span class="comment"> * @uses FEATURE_GROUPS</span>
<a name="l972"><span class="linenum"> 972</span></a>  <span class="comment"> * @uses FEATURE_GROUPINGS</span>
<a name="l973"><span class="linenum"> 973</span></a>  <span class="comment"> * @uses FEATURE_MOD_INTRO</span>
<a name="l974"><span class="linenum"> 974</span></a>  <span class="comment"> * @uses FEATURE_COMPLETION_TRACKS_VIEWS</span>
<a name="l975"><span class="linenum"> 975</span></a>  <span class="comment"> * @uses FEATURE_GRADE_HAS_GRADE</span>
<a name="l976"><span class="linenum"> 976</span></a>  <span class="comment"> * @uses FEATURE_GRADE_OUTCOMES</span>
<a name="l977"><span class="linenum"> 977</span></a>  <span class="comment"> * @param string $feature FEATURE_xx constant for requested feature</span>
<a name="l978"><span class="linenum"> 978</span></a>  <span class="comment"> * @return mixed True if module supports feature, false if not, null if doesn't know</span>
<a name="l979"><span class="linenum"> 979</span></a>  <span class="comment"> */</span>
<a name="l980"><span class="linenum"> 980</span></a>  function <a class="function" onClick="logFunction('lesson_supports')" href="../../_functions/lesson_supports.html" onMouseOver="funcPopup(event,'lesson_supports')">lesson_supports</a>(<a class="var it2238" onMouseOver="hilite(2238)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l981"><span class="linenum"> 981</span></a>      switch(<a class="var it2238" onMouseOver="hilite(2238)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l982"><span class="linenum"> 982</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPS')" href="../../_constants/FEATURE_GROUPS.html" onMouseOver="constPopup(event,'FEATURE_GROUPS')">FEATURE_GROUPS</a>:
<a name="l983"><span class="linenum"> 983</span></a>              return true;
<a name="l984"><span class="linenum"> 984</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPINGS')" href="../../_constants/FEATURE_GROUPINGS.html" onMouseOver="constPopup(event,'FEATURE_GROUPINGS')">FEATURE_GROUPINGS</a>:
<a name="l985"><span class="linenum"> 985</span></a>              return true;
<a name="l986"><span class="linenum"> 986</span></a>          case <a class="constant" onClick="logConstant('FEATURE_MOD_INTRO')" href="../../_constants/FEATURE_MOD_INTRO.html" onMouseOver="constPopup(event,'FEATURE_MOD_INTRO')">FEATURE_MOD_INTRO</a>:
<a name="l987"><span class="linenum"> 987</span></a>              return true;
<a name="l988"><span class="linenum"> 988</span></a>          case <a class="constant" onClick="logConstant('FEATURE_COMPLETION_TRACKS_VIEWS')" href="../../_constants/FEATURE_COMPLETION_TRACKS_VIEWS.html" onMouseOver="constPopup(event,'FEATURE_COMPLETION_TRACKS_VIEWS')">FEATURE_COMPLETION_TRACKS_VIEWS</a>:
<a name="l989"><span class="linenum"> 989</span></a>              return true;
<a name="l990"><span class="linenum"> 990</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_HAS_GRADE')" href="../../_constants/FEATURE_GRADE_HAS_GRADE.html" onMouseOver="constPopup(event,'FEATURE_GRADE_HAS_GRADE')">FEATURE_GRADE_HAS_GRADE</a>:
<a name="l991"><span class="linenum"> 991</span></a>              return true;
<a name="l992"><span class="linenum"> 992</span></a>          case <a class="constant" onClick="logConstant('FEATURE_COMPLETION_HAS_RULES')" href="../../_constants/FEATURE_COMPLETION_HAS_RULES.html" onMouseOver="constPopup(event,'FEATURE_COMPLETION_HAS_RULES')">FEATURE_COMPLETION_HAS_RULES</a>:
<a name="l993"><span class="linenum"> 993</span></a>              return true;
<a name="l994"><span class="linenum"> 994</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_OUTCOMES')" href="../../_constants/FEATURE_GRADE_OUTCOMES.html" onMouseOver="constPopup(event,'FEATURE_GRADE_OUTCOMES')">FEATURE_GRADE_OUTCOMES</a>:
<a name="l995"><span class="linenum"> 995</span></a>              return true;
<a name="l996"><span class="linenum"> 996</span></a>          case <a class="constant" onClick="logConstant('FEATURE_BACKUP_MOODLE2')" href="../../_constants/FEATURE_BACKUP_MOODLE2.html" onMouseOver="constPopup(event,'FEATURE_BACKUP_MOODLE2')">FEATURE_BACKUP_MOODLE2</a>:
<a name="l997"><span class="linenum"> 997</span></a>              return true;
<a name="l998"><span class="linenum"> 998</span></a>          case <a class="constant" onClick="logConstant('FEATURE_SHOW_DESCRIPTION')" href="../../_constants/FEATURE_SHOW_DESCRIPTION.html" onMouseOver="constPopup(event,'FEATURE_SHOW_DESCRIPTION')">FEATURE_SHOW_DESCRIPTION</a>:
<a name="l999"><span class="linenum"> 999</span></a>              return true;
<a name="l1000"><span class="linenum">1000</span></a>          default:
<a name="l1001"><span class="linenum">1001</span></a>              return null;
<a name="l1002"><span class="linenum">1002</span></a>      }
<a name="l1003"><span class="linenum">1003</span></a>  }
<a name="l1004"><span class="linenum">1004</span></a>  
<a name="l1005"><span class="linenum">1005</span></a>  <span class="comment">/**</span>
<a name="l1006"><span class="linenum">1006</span></a>  <span class="comment"> * Obtains the automatic completion state for this lesson based on any conditions</span>
<a name="l1007"><span class="linenum">1007</span></a>  <span class="comment"> * in lesson settings.</span>
<a name="l1008"><span class="linenum">1008</span></a>  <span class="comment"> *</span>
<a name="l1009"><span class="linenum">1009</span></a>  <span class="comment"> * @param object $course Course</span>
<a name="l1010"><span class="linenum">1010</span></a>  <span class="comment"> * @param object $cm course-module</span>
<a name="l1011"><span class="linenum">1011</span></a>  <span class="comment"> * @param int $userid User ID</span>
<a name="l1012"><span class="linenum">1012</span></a>  <span class="comment"> * @param bool $type Type of comparison (or/and; can be used as return value if no conditions)</span>
<a name="l1013"><span class="linenum">1013</span></a>  <span class="comment"> * @return bool True if completed, false if not, $type if conditions not set.</span>
<a name="l1014"><span class="linenum">1014</span></a>  <span class="comment"> */</span>
<a name="l1015"><span class="linenum">1015</span></a>  function <a class="function" onClick="logFunction('lesson_get_completion_state')" href="../../_functions/lesson_get_completion_state.html" onMouseOver="funcPopup(event,'lesson_get_completion_state')">lesson_get_completion_state</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l1016"><span class="linenum">1016</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1017"><span class="linenum">1017</span></a>  
<a name="l1018"><span class="linenum">1018</span></a>  <span class="comment">    // Get lesson details.</span>
<a name="l1019"><span class="linenum">1019</span></a>      <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson', array('id' =&gt; <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>), '*',
<a name="l1020"><span class="linenum">1020</span></a>              <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1021"><span class="linenum">1021</span></a>  
<a name="l1022"><span class="linenum">1022</span></a>      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>; <span class="comment">// Default return value.</span>
<a name="l1023"><span class="linenum">1023</span></a>  <span class="comment">    // If completion option is enabled, evaluate it and return true/false.</span>
<a name="l1024"><span class="linenum">1024</span></a>      if (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completionendreached')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/completionendreached.html">completionendreached</a>) {
<a name="l1025"><span class="linenum">1025</span></a>          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('lesson_timer', array(
<a name="l1026"><span class="linenum">1026</span></a>                  'lessonid' =&gt; <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'completed' =&gt; 1));
<a name="l1027"><span class="linenum">1027</span></a>          if (<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> == <a class="constant" onClick="logConstant('COMPLETION_AND')" href="../../_constants/COMPLETION_AND.html" onMouseOver="constPopup(event,'COMPLETION_AND')">COMPLETION_AND</a>) {
<a name="l1028"><span class="linenum">1028</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l1029"><span class="linenum">1029</span></a>          } else {
<a name="l1030"><span class="linenum">1030</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> || <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l1031"><span class="linenum">1031</span></a>          }
<a name="l1032"><span class="linenum">1032</span></a>      }
<a name="l1033"><span class="linenum">1033</span></a>      if (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completiontimespent')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/completiontimespent.html">completiontimespent</a> != 0) {
<a name="l1034"><span class="linenum">1034</span></a>          <a class="var it7715" onMouseOver="hilite(7715)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(
<a name="l1035"><span class="linenum">1035</span></a>                          &quot;SELECT <a class="function" onClick="logFunction('SUM')" href="../../_functions/sum.html" onMouseOver="funcPopup(event,'sum')">SUM</a>(lessontime - starttime)
<a name="l1036"><span class="linenum">1036</span></a>                                 FROM {lesson_timer}
<a name="l1037"><span class="linenum">1037</span></a>                                WHERE lessonid = :lessonid
<a name="l1038"><span class="linenum">1038</span></a>                                  AND userid = :userid&quot;,
<a name="l1039"><span class="linenum">1039</span></a>                          array('userid' =&gt; <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'lessonid' =&gt; <a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1040"><span class="linenum">1040</span></a>          if (!<a class="var it7715" onMouseOver="hilite(7715)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a>) {
<a name="l1041"><span class="linenum">1041</span></a>              <a class="var it7715" onMouseOver="hilite(7715)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a> = 0;
<a name="l1042"><span class="linenum">1042</span></a>          }
<a name="l1043"><span class="linenum">1043</span></a>          if (<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> == <a class="constant" onClick="logConstant('COMPLETION_AND')" href="../../_constants/COMPLETION_AND.html" onMouseOver="constPopup(event,'COMPLETION_AND')">COMPLETION_AND</a>) {
<a name="l1044"><span class="linenum">1044</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completiontimespent')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/completiontimespent.html">completiontimespent</a> &lt; <a class="var it7715" onMouseOver="hilite(7715)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a>);
<a name="l1045"><span class="linenum">1045</span></a>          } else {
<a name="l1046"><span class="linenum">1046</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> || (<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completiontimespent')" class="var it39901" onMouseOver="hilite(39901)" onMouseOut="lolite()" href="../../_variables/completiontimespent.html">completiontimespent</a> &lt; <a class="var it7715" onMouseOver="hilite(7715)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a>);
<a name="l1047"><span class="linenum">1047</span></a>          }
<a name="l1048"><span class="linenum">1048</span></a>      }
<a name="l1049"><span class="linenum">1049</span></a>      return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1050"><span class="linenum">1050</span></a>  }
<a name="l1051"><span class="linenum">1051</span></a>  <span class="comment">/**</span>
<a name="l1052"><span class="linenum">1052</span></a>  <span class="comment"> * This function extends the settings navigation block for the site.</span>
<a name="l1053"><span class="linenum">1053</span></a>  <span class="comment"> *</span>
<a name="l1054"><span class="linenum">1054</span></a>  <span class="comment"> * It is safe to rely on PAGE here as we will only ever be within the module</span>
<a name="l1055"><span class="linenum">1055</span></a>  <span class="comment"> * context when this is called</span>
<a name="l1056"><span class="linenum">1056</span></a>  <span class="comment"> *</span>
<a name="l1057"><span class="linenum">1057</span></a>  <span class="comment"> * @param settings_navigation $settings</span>
<a name="l1058"><span class="linenum">1058</span></a>  <span class="comment"> * @param navigation_node $lessonnode</span>
<a name="l1059"><span class="linenum">1059</span></a>  <span class="comment"> */</span>
<a name="l1060"><span class="linenum">1060</span></a>  function <a class="function" onClick="logFunction('lesson_extend_settings_navigation')" href="../../_functions/lesson_extend_settings_navigation.html" onMouseOver="funcPopup(event,'lesson_extend_settings_navigation')">lesson_extend_settings_navigation</a>(<a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>, <a class="var it24093" onMouseOver="hilite(24093)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>) {
<a name="l1061"><span class="linenum">1061</span></a>      global <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1062"><span class="linenum">1062</span></a>  
<a name="l1063"><span class="linenum">1063</span></a>  <span class="comment">    // We want to add these new nodes after the Edit settings node, and before the</span>
<a name="l1064"><span class="linenum">1064</span></a>  <span class="comment">    // Locally assigned roles node. Of course, both of those are controlled by capabilities.</span>
<a name="l1065"><span class="linenum">1065</span></a>      <a class="var it1933" onMouseOver="hilite(1933)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a> = <a class="var it24093" onMouseOver="hilite(24093)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('get_children_key_list')" href="../../_functions/get_children_key_list.html" onMouseOver="funcPopup(event,'get_children_key_list')">get_children_key_list</a>();
<a name="l1066"><span class="linenum">1066</span></a>      <a class="var it24094" onMouseOver="hilite(24094)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a> = null;
<a name="l1067"><span class="linenum">1067</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = <a class="phpfunction" onClick="logFunction('array_search')" href="../../_functions/array_search.html" onMouseOver="phpfuncPopup(event,'array_search')">array_search</a>('modedit', <a class="var it1933" onMouseOver="hilite(1933)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>);
<a name="l1068"><span class="linenum">1068</span></a>      if (<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> === false and <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(0, <a class="var it1933" onMouseOver="hilite(1933)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>)) {
<a name="l1069"><span class="linenum">1069</span></a>          <a class="var it24094" onMouseOver="hilite(24094)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a> = <a class="var it1933" onMouseOver="hilite(1933)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>[0];
<a name="l1070"><span class="linenum">1070</span></a>      } else if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> + 1, <a class="var it1933" onMouseOver="hilite(1933)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>)) {
<a name="l1071"><span class="linenum">1071</span></a>          <a class="var it24094" onMouseOver="hilite(24094)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a> = <a class="var it1933" onMouseOver="hilite(1933)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>[<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> + 1];
<a name="l1072"><span class="linenum">1072</span></a>      }
<a name="l1073"><span class="linenum">1073</span></a>  
<a name="l1074"><span class="linenum">1074</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:manageoverrides', <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l1075"><span class="linenum">1075</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/overrides.php.html">/mod/lesson/overrides.php</a>', array('cmid' =&gt; <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id));
<a name="l1076"><span class="linenum">1076</span></a>          <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a> = <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('groupoverrides', 'lesson'),
<a name="l1077"><span class="linenum">1077</span></a>                  <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, array('mode' =&gt; 'group')),
<a name="l1078"><span class="linenum">1078</span></a>                  <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'mod_lesson_groupoverrides');
<a name="l1079"><span class="linenum">1079</span></a>          <a class="var it24093" onMouseOver="hilite(24093)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add_node')" href="../../_functions/add_node.html" onMouseOver="funcPopup(event,'add_node')">add_node</a>(<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>, <a class="var it24094" onMouseOver="hilite(24094)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a>);
<a name="l1080"><span class="linenum">1080</span></a>  
<a name="l1081"><span class="linenum">1081</span></a>          <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a> = <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('useroverrides', 'lesson'),
<a name="l1082"><span class="linenum">1082</span></a>                  <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, array('mode' =&gt; 'user')),
<a name="l1083"><span class="linenum">1083</span></a>                  <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'mod_lesson_useroverrides');
<a name="l1084"><span class="linenum">1084</span></a>          <a class="var it24093" onMouseOver="hilite(24093)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add_node')" href="../../_functions/add_node.html" onMouseOver="funcPopup(event,'add_node')">add_node</a>(<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>, <a class="var it24094" onMouseOver="hilite(24094)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a>);
<a name="l1085"><span class="linenum">1085</span></a>      }
<a name="l1086"><span class="linenum">1086</span></a>  
<a name="l1087"><span class="linenum">1087</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:edit', <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l1088"><span class="linenum">1088</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/view.php.html">/mod/lesson/view.php</a>', array('id' =&gt; <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id));
<a name="l1089"><span class="linenum">1089</span></a>          <a class="var it24093" onMouseOver="hilite(24093)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('preview', 'lesson'), <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1090"><span class="linenum">1090</span></a>          <a class="var it24095" onMouseOver="hilite(24095)" onMouseOut="lolite()" onClick="logVariable('editnode')" href="../../_variables/editnode.html">$editnode</a> = <a class="var it24093" onMouseOver="hilite(24093)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('edit', 'lesson'));
<a name="l1091"><span class="linenum">1091</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/edit.php.html">/mod/lesson/edit.php</a>', array('id' =&gt; <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id, 'mode' =&gt; 'collapsed'));
<a name="l1092"><span class="linenum">1092</span></a>          <a class="var it24095" onMouseOver="hilite(24095)" onMouseOut="lolite()" onClick="logVariable('editnode')" href="../../_variables/editnode.html">$editnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('collapsed', 'lesson'), <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1093"><span class="linenum">1093</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/edit.php.html">/mod/lesson/edit.php</a>', array('id' =&gt; <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id, 'mode' =&gt; 'full'));
<a name="l1094"><span class="linenum">1094</span></a>          <a class="var it24095" onMouseOver="hilite(24095)" onMouseOut="lolite()" onClick="logVariable('editnode')" href="../../_variables/editnode.html">$editnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('full', 'lesson'), <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1095"><span class="linenum">1095</span></a>      }
<a name="l1096"><span class="linenum">1096</span></a>  
<a name="l1097"><span class="linenum">1097</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:viewreports', <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l1098"><span class="linenum">1098</span></a>          <a class="var it24096" onMouseOver="hilite(24096)" onMouseOut="lolite()" onClick="logVariable('reportsnode')" href="../../_variables/reportsnode.html">$reportsnode</a> = <a class="var it24093" onMouseOver="hilite(24093)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('reports', 'lesson'));
<a name="l1099"><span class="linenum">1099</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/report.php.html">/mod/lesson/report.php</a>', array('id'=&gt;<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id, 'action'=&gt;'reportoverview'));
<a name="l1100"><span class="linenum">1100</span></a>          <a class="var it24096" onMouseOver="hilite(24096)" onMouseOut="lolite()" onClick="logVariable('reportsnode')" href="../../_variables/reportsnode.html">$reportsnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('overview', 'lesson'), <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1101"><span class="linenum">1101</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/report.php.html">/mod/lesson/report.php</a>', array('id'=&gt;<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id, 'action'=&gt;'reportdetail'));
<a name="l1102"><span class="linenum">1102</span></a>          <a class="var it24096" onMouseOver="hilite(24096)" onMouseOut="lolite()" onClick="logVariable('reportsnode')" href="../../_variables/reportsnode.html">$reportsnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('detailedstats', 'lesson'), <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1103"><span class="linenum">1103</span></a>      }
<a name="l1104"><span class="linenum">1104</span></a>  
<a name="l1105"><span class="linenum">1105</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:grade', <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l1106"><span class="linenum">1106</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/essay.php.html">/mod/lesson/essay.php</a>', array('id'=&gt;<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id));
<a name="l1107"><span class="linenum">1107</span></a>          <a class="var it24093" onMouseOver="hilite(24093)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('manualgrading', 'lesson'), <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1108"><span class="linenum">1108</span></a>      }
<a name="l1109"><span class="linenum">1109</span></a>  
<a name="l1110"><span class="linenum">1110</span></a>      if (<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('activityrecord')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/activityrecord.html">activityrecord</a>-&gt;highscores) {
<a name="l1111"><span class="linenum">1111</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/highscores.php.html">/mod/lesson/highscores.php</a>', array('id'=&gt;<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id));
<a name="l1112"><span class="linenum">1112</span></a>          <a class="var it24093" onMouseOver="hilite(24093)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('highscores', 'lesson'), <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1113"><span class="linenum">1113</span></a>      }
<a name="l1114"><span class="linenum">1114</span></a>  }
<a name="l1115"><span class="linenum">1115</span></a>  
<a name="l1116"><span class="linenum">1116</span></a>  <span class="comment">/**</span>
<a name="l1117"><span class="linenum">1117</span></a>  <span class="comment"> * Get list of available import or export formats</span>
<a name="l1118"><span class="linenum">1118</span></a>  <span class="comment"> *</span>
<a name="l1119"><span class="linenum">1119</span></a>  <span class="comment"> * Copied and modified from lib/questionlib.php</span>
<a name="l1120"><span class="linenum">1120</span></a>  <span class="comment"> *</span>
<a name="l1121"><span class="linenum">1121</span></a>  <span class="comment"> * @param string $type 'import' if import list, otherwise export list assumed</span>
<a name="l1122"><span class="linenum">1122</span></a>  <span class="comment"> * @return array sorted list of import/export formats available</span>
<a name="l1123"><span class="linenum">1123</span></a>  <span class="comment"> */</span>
<a name="l1124"><span class="linenum">1124</span></a>  function <a class="function" onClick="logFunction('lesson_get_import_export_formats')" href="../../_functions/lesson_get_import_export_formats.html" onMouseOver="funcPopup(event,'lesson_get_import_export_formats')">lesson_get_import_export_formats</a>(<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l1125"><span class="linenum">1125</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1126"><span class="linenum">1126</span></a>      <a class="var it24097" onMouseOver="hilite(24097)" onMouseOut="lolite()" onClick="logVariable('fileformats')" href="../../_variables/fileformats.html">$fileformats</a> = <a class="class" onClick="logClass('core_component')" href="../../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_list')" href="../../_functions/get_plugin_list.html" onMouseOver="funcPopup(event,'get_plugin_list')">get_plugin_list</a>(&quot;qformat&quot;);
<a name="l1127"><span class="linenum">1127</span></a>  
<a name="l1128"><span class="linenum">1128</span></a>      <a class="var it12654" onMouseOver="hilite(12654)" onMouseOut="lolite()" onClick="logVariable('fileformatname')" href="../../_variables/fileformatname.html">$fileformatname</a>=array();
<a name="l1129"><span class="linenum">1129</span></a>      foreach (<a class="var it24097" onMouseOver="hilite(24097)" onMouseOut="lolite()" onClick="logVariable('fileformats')" href="../../_variables/fileformats.html">$fileformats</a> as <a class="var it12657" onMouseOver="hilite(12657)" onMouseOut="lolite()" onClick="logVariable('fileformat')" href="../../_variables/fileformat.html">$fileformat</a>=&gt;<a class="var it2433" onMouseOver="hilite(2433)" onMouseOut="lolite()" onClick="logVariable('fdir')" href="../../_variables/fdir.html">$fdir</a>) {
<a name="l1130"><span class="linenum">1130</span></a>          <a class="var it24098" onMouseOver="hilite(24098)" onMouseOut="lolite()" onClick="logVariable('format_file')" href="../../_variables/format_file.html">$format_file</a> = &quot;<a class="var it2433" onMouseOver="hilite(2433)" onMouseOut="lolite()" onClick="logVariable('fdir')" href="../../_variables/fdir.html">$fdir</a>/format.php&quot;;
<a name="l1131"><span class="linenum">1131</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it24098" onMouseOver="hilite(24098)" onMouseOut="lolite()" onClick="logVariable('format_file')" href="../../_variables/format_file.html">$format_file</a>) ) {
<a name="l1132"><span class="linenum">1132</span></a>              require_once(<a class="var it24098" onMouseOver="hilite(24098)" onMouseOut="lolite()" onClick="logVariable('format_file')" href="../../_variables/format_file.html">$format_file</a>);
<a name="l1133"><span class="linenum">1133</span></a>          } else {
<a name="l1134"><span class="linenum">1134</span></a>              continue;
<a name="l1135"><span class="linenum">1135</span></a>          }
<a name="l1136"><span class="linenum">1136</span></a>          <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../../_variables/classname.html">$classname</a> = &quot;qformat_<a class="var it12657" onMouseOver="hilite(12657)" onMouseOut="lolite()" onClick="logVariable('fileformat')" href="../../_variables/fileformat.html">$fileformat</a>&quot;;
<a name="l1137"><span class="linenum">1137</span></a>          <a class="var it24099" onMouseOver="hilite(24099)" onMouseOut="lolite()" onClick="logVariable('format_class')" href="../../_variables/format_class.html">$format_class</a> = new <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../../_variables/classname.html">$classname</a>();
<a name="l1138"><span class="linenum">1138</span></a>          if (<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>=='import') {
<a name="l1139"><span class="linenum">1139</span></a>              <a class="var it12656" onMouseOver="hilite(12656)" onMouseOut="lolite()" onClick="logVariable('provided')" href="../../_variables/provided.html">$provided</a> = <a class="var it24099" onMouseOver="hilite(24099)" onMouseOut="lolite()" onClick="logVariable('format_class')" href="../../_variables/format_class.html">$format_class</a>-&gt;<a class="function" onClick="logFunction('provide_import')" href="../../_functions/provide_import.html" onMouseOver="funcPopup(event,'provide_import')">provide_import</a>();
<a name="l1140"><span class="linenum">1140</span></a>          } else {
<a name="l1141"><span class="linenum">1141</span></a>              <a class="var it12656" onMouseOver="hilite(12656)" onMouseOut="lolite()" onClick="logVariable('provided')" href="../../_variables/provided.html">$provided</a> = <a class="var it24099" onMouseOver="hilite(24099)" onMouseOut="lolite()" onClick="logVariable('format_class')" href="../../_variables/format_class.html">$format_class</a>-&gt;<a class="function" onClick="logFunction('provide_export')" href="../../_functions/provide_export.html" onMouseOver="funcPopup(event,'provide_export')">provide_export</a>();
<a name="l1142"><span class="linenum">1142</span></a>          }
<a name="l1143"><span class="linenum">1143</span></a>          if (<a class="var it12656" onMouseOver="hilite(12656)" onMouseOut="lolite()" onClick="logVariable('provided')" href="../../_variables/provided.html">$provided</a>) {
<a name="l1144"><span class="linenum">1144</span></a>              <a class="var it12658" onMouseOver="hilite(12658)" onMouseOut="lolite()" onClick="logVariable('fileformatnames')" href="../../_variables/fileformatnames.html">$fileformatnames</a>[<a class="var it12657" onMouseOver="hilite(12657)" onMouseOut="lolite()" onClick="logVariable('fileformat')" href="../../_variables/fileformat.html">$fileformat</a>] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', 'qformat_'.<a class="var it12657" onMouseOver="hilite(12657)" onMouseOut="lolite()" onClick="logVariable('fileformat')" href="../../_variables/fileformat.html">$fileformat</a>);
<a name="l1145"><span class="linenum">1145</span></a>          }
<a name="l1146"><span class="linenum">1146</span></a>      }
<a name="l1147"><span class="linenum">1147</span></a>      <a class="phpfunction" onClick="logFunction('natcasesort')" href="../../_functions/natcasesort.html" onMouseOver="phpfuncPopup(event,'natcasesort')">natcasesort</a>(<a class="var it12658" onMouseOver="hilite(12658)" onMouseOut="lolite()" onClick="logVariable('fileformatnames')" href="../../_variables/fileformatnames.html">$fileformatnames</a>);
<a name="l1148"><span class="linenum">1148</span></a>  
<a name="l1149"><span class="linenum">1149</span></a>      return <a class="var it12658" onMouseOver="hilite(12658)" onMouseOut="lolite()" onClick="logVariable('fileformatnames')" href="../../_variables/fileformatnames.html">$fileformatnames</a>;
<a name="l1150"><span class="linenum">1150</span></a>  }
<a name="l1151"><span class="linenum">1151</span></a>  
<a name="l1152"><span class="linenum">1152</span></a>  <span class="comment">/**</span>
<a name="l1153"><span class="linenum">1153</span></a>  <span class="comment"> * Serves the lesson attachments. Implements needed access control ;-)</span>
<a name="l1154"><span class="linenum">1154</span></a>  <span class="comment"> *</span>
<a name="l1155"><span class="linenum">1155</span></a>  <span class="comment"> * @package mod_lesson</span>
<a name="l1156"><span class="linenum">1156</span></a>  <span class="comment"> * @category files</span>
<a name="l1157"><span class="linenum">1157</span></a>  <span class="comment"> * @param stdClass $course course object</span>
<a name="l1158"><span class="linenum">1158</span></a>  <span class="comment"> * @param stdClass $cm course module object</span>
<a name="l1159"><span class="linenum">1159</span></a>  <span class="comment"> * @param stdClass $context context object</span>
<a name="l1160"><span class="linenum">1160</span></a>  <span class="comment"> * @param string $filearea file area</span>
<a name="l1161"><span class="linenum">1161</span></a>  <span class="comment"> * @param array $args extra arguments</span>
<a name="l1162"><span class="linenum">1162</span></a>  <span class="comment"> * @param bool $forcedownload whether or not force download</span>
<a name="l1163"><span class="linenum">1163</span></a>  <span class="comment"> * @param array $options additional options affecting the file serving</span>
<a name="l1164"><span class="linenum">1164</span></a>  <span class="comment"> * @return bool false if file not found, does not return if found - justsend the file</span>
<a name="l1165"><span class="linenum">1165</span></a>  <span class="comment"> */</span>
<a name="l1166"><span class="linenum">1166</span></a>  function <a class="function" onClick="logFunction('lesson_pluginfile')" href="../../_functions/lesson_pluginfile.html" onMouseOver="funcPopup(event,'lesson_pluginfile')">lesson_pluginfile</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>, <a class="var it713" onMouseOver="hilite(713)" onMouseOut="lolite()" onClick="logVariable('forcedownload')" href="../../_variables/forcedownload.html">$forcedownload</a>, array <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>=array()) {
<a name="l1167"><span class="linenum">1167</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1168"><span class="linenum">1168</span></a>  
<a name="l1169"><span class="linenum">1169</span></a>      if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l1170"><span class="linenum">1170</span></a>          return false;
<a name="l1171"><span class="linenum">1171</span></a>      }
<a name="l1172"><span class="linenum">1172</span></a>  
<a name="l1173"><span class="linenum">1173</span></a>      <a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('fileareas')" href="../../_variables/fileareas.html">$fileareas</a> = <a class="function" onClick="logFunction('lesson_get_file_areas')" href="../../_functions/lesson_get_file_areas.html" onMouseOver="funcPopup(event,'lesson_get_file_areas')">lesson_get_file_areas</a>();
<a name="l1174"><span class="linenum">1174</span></a>      if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('fileareas')" href="../../_variables/fileareas.html">$fileareas</a>)) {
<a name="l1175"><span class="linenum">1175</span></a>          return false;
<a name="l1176"><span class="linenum">1176</span></a>      }
<a name="l1177"><span class="linenum">1177</span></a>  
<a name="l1178"><span class="linenum">1178</span></a>      if (!<a class="var it657" onMouseOver="hilite(657)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson', array('id'=&gt;<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>))) {
<a name="l1179"><span class="linenum">1179</span></a>          return false;
<a name="l1180"><span class="linenum">1180</span></a>      }
<a name="l1181"><span class="linenum">1181</span></a>  
<a name="l1182"><span class="linenum">1182</span></a>      <a class="function" onClick="logFunction('require_course_login')" href="../../_functions/require_course_login.html" onMouseOver="funcPopup(event,'require_course_login')">require_course_login</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, true, <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1183"><span class="linenum">1183</span></a>  
<a name="l1184"><span class="linenum">1184</span></a>      if (<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'page_contents') {
<a name="l1185"><span class="linenum">1185</span></a>          <a class="var it1764" onMouseOver="hilite(1764)" onMouseOut="lolite()" onClick="logVariable('pageid')" href="../../_variables/pageid.html">$pageid</a> = (int)<a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1186"><span class="linenum">1186</span></a>          if (!<a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson_pages', array('id'=&gt;<a class="var it1764" onMouseOver="hilite(1764)" onMouseOut="lolite()" onClick="logVariable('pageid')" href="../../_variables/pageid.html">$pageid</a>))) {
<a name="l1187"><span class="linenum">1187</span></a>              return false;
<a name="l1188"><span class="linenum">1188</span></a>          }
<a name="l1189"><span class="linenum">1189</span></a>          <a class="var it1176" onMouseOver="hilite(1176)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_lesson/<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/<a class="var it1764" onMouseOver="hilite(1764)" onMouseOut="lolite()" onClick="logVariable('pageid')" href="../../_variables/pageid.html">$pageid</a>/&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1190"><span class="linenum">1190</span></a>  
<a name="l1191"><span class="linenum">1191</span></a>      } else if (<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'page_answers' || <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'page_responses') {
<a name="l1192"><span class="linenum">1192</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = (int)<a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1193"><span class="linenum">1193</span></a>          if (!<a class="var it24100" onMouseOver="hilite(24100)" onMouseOut="lolite()" onClick="logVariable('pageanswers')" href="../../_variables/pageanswers.html">$pageanswers</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson_answers', array('id' =&gt; <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>))) {
<a name="l1194"><span class="linenum">1194</span></a>              return false;
<a name="l1195"><span class="linenum">1195</span></a>          }
<a name="l1196"><span class="linenum">1196</span></a>          <a class="var it1176" onMouseOver="hilite(1176)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_lesson/<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>/&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1197"><span class="linenum">1197</span></a>  
<a name="l1198"><span class="linenum">1198</span></a>      } else if (<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'essay_responses') {
<a name="l1199"><span class="linenum">1199</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = (int)<a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1200"><span class="linenum">1200</span></a>          if (!<a class="var it660" onMouseOver="hilite(660)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson_attempts', array('id' =&gt; <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>))) {
<a name="l1201"><span class="linenum">1201</span></a>              return false;
<a name="l1202"><span class="linenum">1202</span></a>          }
<a name="l1203"><span class="linenum">1203</span></a>          <a class="var it1176" onMouseOver="hilite(1176)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_lesson/<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>/&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1204"><span class="linenum">1204</span></a>  
<a name="l1205"><span class="linenum">1205</span></a>      } else if (<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'mediafile') {
<a name="l1206"><span class="linenum">1206</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>) &gt; 1) {
<a name="l1207"><span class="linenum">1207</span></a>  <span class="comment">            // Remove the itemid when it appears to be part of the arguments. If there is only one argument</span>
<a name="l1208"><span class="linenum">1208</span></a>  <span class="comment">            // then it is surely the file name. The itemid is sometimes used to prevent browser caching.</span>
<a name="l1209"><span class="linenum">1209</span></a>              <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1210"><span class="linenum">1210</span></a>          }
<a name="l1211"><span class="linenum">1211</span></a>          <a class="var it1176" onMouseOver="hilite(1176)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_lesson/<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/0/&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it626" onMouseOver="hilite(626)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1212"><span class="linenum">1212</span></a>  
<a name="l1213"><span class="linenum">1213</span></a>      } else {
<a name="l1214"><span class="linenum">1214</span></a>          return false;
<a name="l1215"><span class="linenum">1215</span></a>      }
<a name="l1216"><span class="linenum">1216</span></a>  
<a name="l1217"><span class="linenum">1217</span></a>      <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l1218"><span class="linenum">1218</span></a>      if (!<a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file_by_hash')" href="../../_functions/get_file_by_hash.html" onMouseOver="funcPopup(event,'get_file_by_hash')">get_file_by_hash</a>(<a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it1176" onMouseOver="hilite(1176)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a>)) or <a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('is_directory')" href="../../_functions/is_directory.html" onMouseOver="funcPopup(event,'is_directory')">is_directory</a>()) {
<a name="l1219"><span class="linenum">1219</span></a>          return false;
<a name="l1220"><span class="linenum">1220</span></a>      }
<a name="l1221"><span class="linenum">1221</span></a>  
<a name="l1222"><span class="linenum">1222</span></a>  <span class="comment">    // finally send the file</span>
<a name="l1223"><span class="linenum">1223</span></a>      <a class="function" onClick="logFunction('send_stored_file')" href="../../_functions/send_stored_file.html" onMouseOver="funcPopup(event,'send_stored_file')">send_stored_file</a>(<a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, 0, 0, <a class="var it713" onMouseOver="hilite(713)" onMouseOut="lolite()" onClick="logVariable('forcedownload')" href="../../_variables/forcedownload.html">$forcedownload</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>); <span class="comment">// download MUST be forced - security!</span>
<a name="l1224"><span class="linenum">1224</span></a>  }
<a name="l1225"><span class="linenum">1225</span></a>  
<a name="l1226"><span class="linenum">1226</span></a>  <span class="comment">/**</span>
<a name="l1227"><span class="linenum">1227</span></a>  <span class="comment"> * Returns an array of file areas</span>
<a name="l1228"><span class="linenum">1228</span></a>  <span class="comment"> *</span>
<a name="l1229"><span class="linenum">1229</span></a>  <span class="comment"> * @package  mod_lesson</span>
<a name="l1230"><span class="linenum">1230</span></a>  <span class="comment"> * @category files</span>
<a name="l1231"><span class="linenum">1231</span></a>  <span class="comment"> * @return array a list of available file areas</span>
<a name="l1232"><span class="linenum">1232</span></a>  <span class="comment"> */</span>
<a name="l1233"><span class="linenum">1233</span></a>  function <a class="function" onClick="logFunction('lesson_get_file_areas')" href="../../_functions/lesson_get_file_areas.html" onMouseOver="funcPopup(event,'lesson_get_file_areas')">lesson_get_file_areas</a>() {
<a name="l1234"><span class="linenum">1234</span></a>      <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a> = array();
<a name="l1235"><span class="linenum">1235</span></a>      <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['page_contents'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pagecontents', 'mod_lesson');
<a name="l1236"><span class="linenum">1236</span></a>      <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['mediafile'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('mediafile', 'mod_lesson');
<a name="l1237"><span class="linenum">1237</span></a>      <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['page_answers'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pageanswers', 'mod_lesson');
<a name="l1238"><span class="linenum">1238</span></a>      <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['page_responses'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pageresponses', 'mod_lesson');
<a name="l1239"><span class="linenum">1239</span></a>      <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['essay_responses'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('essayresponses', 'mod_lesson');
<a name="l1240"><span class="linenum">1240</span></a>      return <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>;
<a name="l1241"><span class="linenum">1241</span></a>  }
<a name="l1242"><span class="linenum">1242</span></a>  
<a name="l1243"><span class="linenum">1243</span></a>  <span class="comment">/**</span>
<a name="l1244"><span class="linenum">1244</span></a>  <span class="comment"> * Returns a file_info_stored object for the file being requested here</span>
<a name="l1245"><span class="linenum">1245</span></a>  <span class="comment"> *</span>
<a name="l1246"><span class="linenum">1246</span></a>  <span class="comment"> * @package  mod_lesson</span>
<a name="l1247"><span class="linenum">1247</span></a>  <span class="comment"> * @category files</span>
<a name="l1248"><span class="linenum">1248</span></a>  <span class="comment"> * @global stdClass $CFG</span>
<a name="l1249"><span class="linenum">1249</span></a>  <span class="comment"> * @param file_browse $browser file browser instance</span>
<a name="l1250"><span class="linenum">1250</span></a>  <span class="comment"> * @param array $areas file areas</span>
<a name="l1251"><span class="linenum">1251</span></a>  <span class="comment"> * @param stdClass $course course object</span>
<a name="l1252"><span class="linenum">1252</span></a>  <span class="comment"> * @param stdClass $cm course module object</span>
<a name="l1253"><span class="linenum">1253</span></a>  <span class="comment"> * @param stdClass $context context object</span>
<a name="l1254"><span class="linenum">1254</span></a>  <span class="comment"> * @param string $filearea file area</span>
<a name="l1255"><span class="linenum">1255</span></a>  <span class="comment"> * @param int $itemid item ID</span>
<a name="l1256"><span class="linenum">1256</span></a>  <span class="comment"> * @param string $filepath file path</span>
<a name="l1257"><span class="linenum">1257</span></a>  <span class="comment"> * @param string $filename file name</span>
<a name="l1258"><span class="linenum">1258</span></a>  <span class="comment"> * @return file_info_stored</span>
<a name="l1259"><span class="linenum">1259</span></a>  <span class="comment"> */</span>
<a name="l1260"><span class="linenum">1260</span></a>  function <a class="function" onClick="logFunction('lesson_get_file_info')" href="../../_functions/lesson_get_file_info.html" onMouseOver="funcPopup(event,'lesson_get_file_info')">lesson_get_file_info</a>(<a class="var it577" onMouseOver="hilite(577)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it549" onMouseOver="hilite(549)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it93" onMouseOver="hilite(93)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) {
<a name="l1261"><span class="linenum">1261</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1262"><span class="linenum">1262</span></a>  
<a name="l1263"><span class="linenum">1263</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:managefiles', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1264"><span class="linenum">1264</span></a>  <span class="comment">        // No peaking here for students!</span>
<a name="l1265"><span class="linenum">1265</span></a>          return null;
<a name="l1266"><span class="linenum">1266</span></a>      }
<a name="l1267"><span class="linenum">1267</span></a>  
<a name="l1268"><span class="linenum">1268</span></a>  <span class="comment">    // Mediafile area does not have sub directories, so let's select the default itemid to prevent</span>
<a name="l1269"><span class="linenum">1269</span></a>  <span class="comment">    // the user from selecting a directory to access the mediafile content.</span>
<a name="l1270"><span class="linenum">1270</span></a>      if (<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> == 'mediafile' &amp;&amp; <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>)) {
<a name="l1271"><span class="linenum">1271</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = 0;
<a name="l1272"><span class="linenum">1272</span></a>      }
<a name="l1273"><span class="linenum">1273</span></a>  
<a name="l1274"><span class="linenum">1274</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>)) {
<a name="l1275"><span class="linenum">1275</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('mod_lesson_file_info')" href="../../_classes/mod_lesson_file_info.html" onMouseOver="classPopup(event,'mod_lesson_file_info')">mod_lesson_file_info</a>(<a class="var it577" onMouseOver="hilite(577)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>, <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>);
<a name="l1276"><span class="linenum">1276</span></a>      }
<a name="l1277"><span class="linenum">1277</span></a>  
<a name="l1278"><span class="linenum">1278</span></a>      <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l1279"><span class="linenum">1279</span></a>      <a class="var it549" onMouseOver="hilite(549)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it549" onMouseOver="hilite(549)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>) ? '/' : <a class="var it549" onMouseOver="hilite(549)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>;
<a name="l1280"><span class="linenum">1280</span></a>      <a class="var it93" onMouseOver="hilite(93)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it93" onMouseOver="hilite(93)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) ? '.' : <a class="var it93" onMouseOver="hilite(93)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>;
<a name="l1281"><span class="linenum">1281</span></a>      if (!<a class="var it1219" onMouseOver="hilite(1219)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a> = <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file')" href="../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_lesson', <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it549" onMouseOver="hilite(549)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it93" onMouseOver="hilite(93)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>)) {
<a name="l1282"><span class="linenum">1282</span></a>          return null;
<a name="l1283"><span class="linenum">1283</span></a>      }
<a name="l1284"><span class="linenum">1284</span></a>  
<a name="l1285"><span class="linenum">1285</span></a>      <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a> = <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>;
<a name="l1286"><span class="linenum">1286</span></a>      if (<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> == 'page_contents') {
<a name="l1287"><span class="linenum">1287</span></a>          <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('lesson_pages', 'title', array('lessonid' =&gt; <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>, 'id' =&gt; <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>));
<a name="l1288"><span class="linenum">1288</span></a>          <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>, true, array('context' =&gt; <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>));
<a name="l1289"><span class="linenum">1289</span></a>      } else {
<a name="l1290"><span class="linenum">1290</span></a>          <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a> = <a class="function" onClick="logFunction('lesson_get_file_areas')" href="../../_functions/lesson_get_file_areas.html" onMouseOver="funcPopup(event,'lesson_get_file_areas')">lesson_get_file_areas</a>();
<a name="l1291"><span class="linenum">1291</span></a>          if (isset(<a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>[<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>])) {
<a name="l1292"><span class="linenum">1292</span></a>              <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a> = <a class="var it1700" onMouseOver="hilite(1700)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>[<a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>];
<a name="l1293"><span class="linenum">1293</span></a>          }
<a name="l1294"><span class="linenum">1294</span></a>      }
<a name="l1295"><span class="linenum">1295</span></a>  
<a name="l1296"><span class="linenum">1296</span></a>      <a class="var it1695" onMouseOver="hilite(1695)" onMouseOut="lolite()" onClick="logVariable('urlbase')" href="../../_variables/urlbase.html">$urlbase</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a> . '<a class="filename" href="../../pluginfile.php.html">/pluginfile.php</a>';
<a name="l1297"><span class="linenum">1297</span></a>      return <span class="keyword">new </span><a class="class" onClick="logClass('file_info_stored')" href="../../_classes/file_info_stored.html" onMouseOver="classPopup(event,'file_info_stored')">file_info_stored</a>(<a class="var it577" onMouseOver="hilite(577)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it1219" onMouseOver="hilite(1219)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>, <a class="var it1695" onMouseOver="hilite(1695)" onMouseOut="lolite()" onClick="logVariable('urlbase')" href="../../_variables/urlbase.html">$urlbase</a>, <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, true, true, false);
<a name="l1298"><span class="linenum">1298</span></a>  }
<a name="l1299"><span class="linenum">1299</span></a>  
<a name="l1300"><span class="linenum">1300</span></a>  
<a name="l1301"><span class="linenum">1301</span></a>  <span class="comment">/**</span>
<a name="l1302"><span class="linenum">1302</span></a>  <span class="comment"> * Return a list of page types</span>
<a name="l1303"><span class="linenum">1303</span></a>  <span class="comment"> * @param string $pagetype current page type</span>
<a name="l1304"><span class="linenum">1304</span></a>  <span class="comment"> * @param stdClass $parentcontext Block's parent context</span>
<a name="l1305"><span class="linenum">1305</span></a>  <span class="comment"> * @param stdClass $currentcontext Current context of block</span>
<a name="l1306"><span class="linenum">1306</span></a>  <span class="comment"> */</span>
<a name="l1307"><span class="linenum">1307</span></a>  function <a class="function" onClick="logFunction('lesson_page_type_list')" href="../../_functions/lesson_page_type_list.html" onMouseOver="funcPopup(event,'lesson_page_type_list')">lesson_page_type_list</a>(<a class="var it3667" onMouseOver="hilite(3667)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../../_variables/pagetype.html">$pagetype</a>, <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../../_variables/parentcontext.html">$parentcontext</a>, <a class="var it5093" onMouseOver="hilite(5093)" onMouseOut="lolite()" onClick="logVariable('currentcontext')" href="../../_variables/currentcontext.html">$currentcontext</a>) {
<a name="l1308"><span class="linenum">1308</span></a>      <a class="var it8026" onMouseOver="hilite(8026)" onMouseOut="lolite()" onClick="logVariable('module_pagetype')" href="../../_variables/module_pagetype.html">$module_pagetype</a> = array(
<a name="l1309"><span class="linenum">1309</span></a>          'mod-lesson-*'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-lesson-x', 'lesson'),
<a name="l1310"><span class="linenum">1310</span></a>          'mod-lesson-view'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-lesson-view', 'lesson'),
<a name="l1311"><span class="linenum">1311</span></a>          'mod-lesson-edit'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-lesson-edit', 'lesson'));
<a name="l1312"><span class="linenum">1312</span></a>      return <a class="var it8026" onMouseOver="hilite(8026)" onMouseOut="lolite()" onClick="logVariable('module_pagetype')" href="../../_variables/module_pagetype.html">$module_pagetype</a>;
<a name="l1313"><span class="linenum">1313</span></a>  }
<a name="l1314"><span class="linenum">1314</span></a>  
<a name="l1315"><span class="linenum">1315</span></a>  <span class="comment">/**</span>
<a name="l1316"><span class="linenum">1316</span></a>  <span class="comment"> * Update the lesson activity to include any file</span>
<a name="l1317"><span class="linenum">1317</span></a>  <span class="comment"> * that was uploaded, or if there is none, set the</span>
<a name="l1318"><span class="linenum">1318</span></a>  <span class="comment"> * mediafile field to blank.</span>
<a name="l1319"><span class="linenum">1319</span></a>  <span class="comment"> *</span>
<a name="l1320"><span class="linenum">1320</span></a>  <span class="comment"> * @param int $lessonid the lesson id</span>
<a name="l1321"><span class="linenum">1321</span></a>  <span class="comment"> * @param stdClass $context the context</span>
<a name="l1322"><span class="linenum">1322</span></a>  <span class="comment"> * @param int $draftitemid the draft item</span>
<a name="l1323"><span class="linenum">1323</span></a>  <span class="comment"> */</span>
<a name="l1324"><span class="linenum">1324</span></a>  function <a class="function" onClick="logFunction('lesson_update_media_file')" href="../../_functions/lesson_update_media_file.html" onMouseOver="funcPopup(event,'lesson_update_media_file')">lesson_update_media_file</a>(<a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2832" onMouseOver="hilite(2832)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>) {
<a name="l1325"><span class="linenum">1325</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1326"><span class="linenum">1326</span></a>  
<a name="l1327"><span class="linenum">1327</span></a>  <span class="comment">    // Set the filestorage object.</span>
<a name="l1328"><span class="linenum">1328</span></a>      <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l1329"><span class="linenum">1329</span></a>  <span class="comment">    // Save the file if it exists that is currently in the draft area.</span>
<a name="l1330"><span class="linenum">1330</span></a>      <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it2832" onMouseOver="hilite(2832)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_lesson', 'mediafile', 0);
<a name="l1331"><span class="linenum">1331</span></a>  <span class="comment">    // Get the file if it exists.</span>
<a name="l1332"><span class="linenum">1332</span></a>      <a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_lesson', 'mediafile', 0, 'itemid, filepath, filename', false);
<a name="l1333"><span class="linenum">1333</span></a>  <span class="comment">    // Check that there is a file to process.</span>
<a name="l1334"><span class="linenum">1334</span></a>      if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>) == 1) {
<a name="l1335"><span class="linenum">1335</span></a>  <span class="comment">        // Get the first (and only) file.</span>
<a name="l1336"><span class="linenum">1336</span></a>          <a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it595" onMouseOver="hilite(595)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>);
<a name="l1337"><span class="linenum">1337</span></a>  <span class="comment">        // Set the mediafile column in the lessons table.</span>
<a name="l1338"><span class="linenum">1338</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('lesson', 'mediafile', '/' . <a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>(), array('id' =&gt; <a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>));
<a name="l1339"><span class="linenum">1339</span></a>      } else {
<a name="l1340"><span class="linenum">1340</span></a>  <span class="comment">        // Set the mediafile column in the lessons table.</span>
<a name="l1341"><span class="linenum">1341</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('lesson', 'mediafile', '', array('id' =&gt; <a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>));
<a name="l1342"><span class="linenum">1342</span></a>      }
<a name="l1343"><span class="linenum">1343</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_filename': ['get_filename', 'Returns file name or \'.\' in case of directories. ', [['lib/filestorage','stored_file.php',699],['lib/filebrowser','virtual_root_file.php',227],['lib','medialib.php',169]], 223],
'load': ['load', 'Load the config.php file for a particular theme, and return an instance of this class. (That is, this is a factory method.) ', [['lib','outputlib.php',399],['lib/adodb','adodb-active-recordx.inc.php',747],['lib/phpexcel/PHPExcel/Reader/Excel5','Escher.php',94],['lib/htmlpurifier/HTMLPurifier','Language.php',69],['cache/classes','definition.php',323],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',44],['lib/mustache/src/Mustache','Loader.php',17],['lib/phpexcel/PHPExcel','IOFactory.php',181],['lib/simplepie/library/SimplePie/Cache','MySQL.php',286],['lib/phpexcel/PHPExcel/Reader','OOCalc.php',293],['lib/mustache/src/Mustache/Cache','NoopCache.php',20],['lib/phpexcel/PHPExcel/Reader','SYLK.php',197],['lib/phpexcel/PHPExcel/Reader','Excel5.php',602],['lib/simplepie/library/SimplePie/Cache','Base.php',87],['lib/pear/HTML/QuickForm','select.php',421],['lib/simplepie/library/SimplePie/Cache','File.php',118],['calendar','lib.php',2631],['backup/cc/cc_lib','xmlbase.php',92],['mod/lesson','locallib.php',1024],['mod/lesson','locallib.php',2243],['mod/lesson','locallib.php',3191],['lib/phpexcel/PHPExcel/Reader','Excel2007.php',337],['lib/mustache/src/Mustache/Cache','FilesystemCache.php',39],['lib/zend/Zend/Loader','PluginLoader.php',350],['lib/mustache/src/Mustache/Loader','StringLoader.php',28],['cache/classes','config.php',128],['lib/phpexcel/PHPExcel/Reader','IReader.php',46],['lib/mustache/src/Mustache/Loader','FilesystemLoader.php',69],['lib/phpexcel/PHPExcel/Reader','Excel2003XML.php',224],['lib/phpexcel/PHPExcel/Reader','CSV.php',218],['lib/phpexcel/PHPExcel','Autoloader.php',62],['lib/phpexcel/PHPExcel/Reader','Gnumeric.php',205],['lib/zend/Zend/Loader/PluginLoader','Interface.php',68],['lib/mustache/src/Mustache','Cache.php',20],['lib/simplepie/library/SimplePie/Cache','Memcache.php',123],['lib/phpunit/classes','autoloader.php',46],['grade/grading','lib.php',227],['lib/zend/Zend/Loader/Autoloader','Resource.php',428],['lib/mustache/src/Mustache/Loader','ArrayLoader.php',41],['lib/phpexcel/PHPExcel/Reader','HTML.php',128],['lib/mustache/src/Mustache/Loader','InlineLoader.php',87],['lib/adodb','adodb-active-record.inc.php',682],['lib/mustache/src/Mustache/Loader','CascadingLoader.php',48]], 182],
'require_course_login': ['require_course_login', 'Weaker version of require_login() ', [['lib','moodlelib.php',2887]], 68],
'lesson_get_post_actions': ['lesson_get_post_actions', 'List the actions that correspond to a post of this module. This is used by the participation report. ', [['mod/lesson','lib.php',748]], 0],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1318]], 854],
'addelement': ['addelement', 'Adds a custom element to your HTML definition ', [['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',124],['lib/zend/Zend/Soap','Wsdl.php',641],['lib/htmlpurifier/HTMLPurifier','HTMLModule.php',130],['lib/pear/HTML','QuickForm.php',582]], 3296],
'grade_get_grades': ['grade_get_grades', 'Returns grading information for given activity, optionally with user grades Manual, course or category items can not be queried. ', [['lib','gradelib.php',328]], 53],
'box_start': ['box_start', 'Outputs the opening section of a box. ', [['lib','outputrenderers.php',2987]], 351],
'send_stored_file': ['send_stored_file', 'Handles the sending of file data to the user\'s browser, including support for byteranges etc. ', [['lib','filelib.php',2170]], 73],
'get_area_files': ['get_area_files', 'Returns all area files (optionally limited by itemid) ', [['lib/filestorage','file_storage.php',530]], 174],
'box_end': ['box_end', 'Outputs the closing section of a box. ', [['lib','outputrenderers.php',3002]], 351],
'count_records': ['count_records', 'Count the records in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1717]], 1399],
'delete_area_files': ['delete_area_files', 'Delete all area files (optionally limited by itemid). ', [['lib/filestorage','file_storage.php',740]], 117],
'lesson_delete_instance': ['lesson_delete_instance', 'Given an ID of an instance of this module, this function will permanently delete the instance and any data that depends on it. ', [['mod/lesson','lib.php',259]], 0],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required. ', [['lib/dml','pgsql_native_moodle_database.php',883],['lib/dml','oci_native_moodle_database.php',1249],['lib/dml','sqlsrv_native_moodle_database.php',978],['lib/dml','mssql_native_moodle_database.php',898],['lib/dml','mysqli_native_moodle_database.php',1177],['lib/dml/tests','dml_test.php',5427],['lib/dml','pdo_moodle_database.php',386],['question/engine/upgrade','upgradelib.php',121]], 1512],
'lesson_supports': ['lesson_supports', '', [['mod/lesson','lib.php',980]], 0],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',884],['lib','accesslib.php',346]], 1929],
'lesson_reset_gradebook': ['lesson_reset_gradebook', 'Removes all grades from gradebook ', [['mod/lesson','lib.php',855]], 1],
'lesson_pluginfile': ['lesson_pluginfile', 'Serves the lesson attachments. Implements needed access control ;-) ', [['mod/lesson','lib.php',1152]], 0],
'get_string': ['get_string', 'Return a core get_string() call ', [['lib/external','externallib.php',112],['lib','moodlelib.php',6538],['lib','moodlelib.php',9417],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38],['lib/classes','string_manager_install.php',95],['question/behaviour','behaviourbase.php',756]], 19235],
'lesson_user_outline': ['lesson_user_outline', 'Return a small object with summary information about what a user has done with a given particular instance of this module Used for user activity reports. $return->time = the time they did it $return->info = a short text description ', [['mod/lesson','lib.php',290]], 0],
'file_save_draft_area_files': ['file_save_draft_area_files', 'Saves files from a draft file area to a real one (merging the list of files). Can rewrite URLs in some content at the same time if desired. ', [['lib','filelib.php',772]], 53],
'lesson_delete_course': ['lesson_delete_course', 'Given a course object, this function will clean up anything that would be leftover after all the instances were deleted ', [['mod/lesson','lib.php',277]], 0],
'delete': ['delete', 'Deletes a key pair ', [['lib/zend/Zend/Service/Amazon/Ec2','Keypair.php',110],['lib/google/src/Google/Service','Reseller.php',440],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',1006],['lib/adodb','adodb-active-recordx.inc.php',949],['lib/zend/Zend/Service/Delicious','Post.php',236],['lib/grade','grade_object.php',270],['lib/zend/Zend/Gdata','Gapps.php',258],['lib/google/src/Google/Service','Fusiontables.php',644],['lib/google/src/Google/Service','Fusiontables.php',809],['lib/google/src/Google/Service','Fusiontables.php',934],['lib/google/src/Google/Service','Fusiontables.php',1127],['lib/google/src/Google/Service','Fusiontables.php',1188],['blog','locallib.php',325],['lib/google/src/Google/Service','Blogger.php',1051],['lib/google/src/Google/Service','Blogger.php',1212],['lib/google/src/Google/Service','Blogger.php',1434],['lib/portfolio','plugin.php',692],['lib/google/src/Google/Service','AdExchangeBuyer.php',605],['lib/google/src/Google/Service','Manager.php',240],['lib/google/src/Google/Service','Manager.php',320],['lib/zend/Zend/Service/Amazon/Ec2','Securitygroups.php',137],['lib','webdavlib.php',691],['lib/grade','grade_item.php',354],['lib/google/src/Google/Service','Gmail.php',686],['lib/google/src/Google/Service','Gmail.php',843],['lib/google/src/Google/Service','Gmail.php',936],['lib/google/src/Google/Service','Gmail.php',1146],['course','lib.php',3133],['lib/google/src/Google/Service','Mirror.php',424],['lib/google/src/Google/Service','Mirror.php',592],['lib/google/src/Google/Service','Mirror.php',660],['lib/google/src/Google/Service','Mirror.php',771],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',731],['lib/google/src/Google/Service','Genomics.php',963],['lib/google/src/Google/Service','Genomics.php',1327],['lib/google/src/Google/Service','Genomics.php',1399],['cache/classes','interfaces.php',161],['lib/google/src/Google/Service','Dfareporting.php',470],['lib/zend/Zend/Gdata/Gbase','ItemEntry.php',133],['lib/google/src/Google/Service','Licensing.php',221],['lib/google/src/Google/Service','Drive.php',1462],['lib/google/src/Google/Service','Drive.php',1536],['lib/google/src/Google/Service','Drive.php',1681],['lib/google/src/Google/Service','Drive.php',1932],['lib/google/src/Google/Service','Drive.php',2002],['lib/google/src/Google/Service','Drive.php',2131],['lib/google/src/Google/Service','Drive.php',2294],['lib/google/src/Google/Service','Drive.php',2414],['completion','data_object.php',272],['lib/google/src/Google/Service','Books.php',1804],['lib/zend/Zend/Gdata','App.php',914],['lib/google/src/Google/Cache','Memcache.php',142],['lib/google/src/Google/Service','Bigquery.php',512],['lib/google/src/Google/Service','Bigquery.php',822],['cache','disabledlib.php',102],['lib/zend/Zend/Server','Cache.php',132],['lib/zend/Zend/Gdata/App','Entry.php',212],['cache/stores/memcached','lib.php',368],['lib/google/src/Google/Service','YouTube.php',1470],['lib/google/src/Google/Service','YouTube.php',1979],['lib/google/src/Google/Service','YouTube.php',2277],['lib/google/src/Google/Service','YouTube.php',2510],['lib/google/src/Google/Service','YouTube.php',2657],['lib/google/src/Google/Service','YouTube.php',2998],['lib/google/src/Google/Service','YouTube.php',3196],['lib/google/src/Google/Service','Webmasters.php',298],['lib/google/src/Google/Service','Webmasters.php',388],['lib/google/src/Google/Service','Autoscaler.php',314],['lib/google/src/Google/Service','Autoscaler.php',428],['calendar','lib.php',2388],['lib/zend/Zend/Service/Amazon','Sqs.php',129],['lib/google/src/Google/Service','ShoppingContent.php',553],['lib/google/src/Google/Service','ShoppingContent.php',735],['lib/google/src/Google/Service','ShoppingContent.php',969],['mod/lesson','locallib.php',1039],['mod/lesson','locallib.php',2274],['lib/google/src/Google/Service','SQLAdmin.php',628],['lib/google/src/Google/Service','SQLAdmin.php',923],['lib/google/src/Google/Service','Fitness.php',458],['lib/google/src/Google/Service','Fitness.php',563],['lib/google/src/Google/Service','TagManager.php',1049],['lib/google/src/Google/Service','TagManager.php',1140],['lib/google/src/Google/Service','TagManager.php',1233],['lib/google/src/Google/Service','TagManager.php',1326],['lib/google/src/Google/Service','TagManager.php',1419],['lib/google/src/Google/Service','TagManager.php',1513],['lib/google/src/Google/Service','TagManager.php',1607],['lib/google/src/Google/Service','TagManager.php',1757],['lib/google/src/Google/Service','Directory.php',1300],['lib/google/src/Google/Service','Directory.php',1477],['lib/google/src/Google/Service','Directory.php',1587],['lib/google/src/Google/Service','Directory.php',1642],['lib/google/src/Google/Service','Directory.php',1769],['lib/google/src/Google/Service','Directory.php',1838],['lib/google/src/Google/Service','Directory.php',1935],['lib/google/src/Google/Service','Directory.php',2042],['lib/google/src/Google/Service','Directory.php',2144],['lib/google/src/Google/Service','Directory.php',2205],['lib/google/src/Google/Service','Directory.php',2405],['lib/google/src/Google/Service','Directory.php',2480],['cache/stores/static','lib.php',374],['lib/google/src/Google/Service','AppState.php',153],['lib/google/src/Google/Service','Taskqueue.php',292],['lib/google/src/Google/Service','Container.php',343],['lib/google/src/Google/Service','AndroidPublisher.php',1177],['lib/google/src/Google/Service','AndroidPublisher.php',1257],['lib/google/src/Google/Service','AndroidPublisher.php',1595],['lib/google/src/Google/Service','AndroidPublisher.php',1690],['lib/google/src/Google/Service','AndroidPublisher.php',1972],['repository','lib.php',427],['repository','lib.php',2012],['lib','accesslib.php',5529],['lib/google/src/Google/Service','AdSenseHost.php',733],['lib/google/src/Google/Service','AdSenseHost.php',1009],['lib/google/src/Google/Service','AdSenseHost.php',1167],['cache/stores/memcache','lib.php',401],['lib','filelib.php',3440],['lib/google/src/Google/Service','MapsEngine.php',1692],['lib/google/src/Google/Service','MapsEngine.php',1990],['lib/google/src/Google/Service','MapsEngine.php',2343],['lib/google/src/Google/Service','MapsEngine.php',2650],['lib/google/src/Google/Service','MapsEngine.php',2911],['lib/grade','grade_grade.php',955],['comment','lib.php',786],['lib/google/src/Google/Service','SiteVerification.php',138],['lib/google/src/Google/Service','Prediction.php',261],['cache/stores/session','lib.php',417],['cache/classes','dummystore.php',198],['lib/google/src/Google/Service','Compute.php',2812],['lib/google/src/Google/Service','Compute.php',2896],['lib/google/src/Google/Service','Compute.php',3139],['lib/google/src/Google/Service','Compute.php',3225],['lib/google/src/Google/Service','Compute.php',3361],['lib/google/src/Google/Service','Compute.php',3463],['lib/google/src/Google/Service','Compute.php',3543],['lib/google/src/Google/Service','Compute.php',3662],['lib/google/src/Google/Service','Compute.php',3725],['lib/google/src/Google/Service','Compute.php',3844],['lib/google/src/Google/Service','Compute.php',3941],['lib/google/src/Google/Service','Compute.php',4080],['lib/google/src/Google/Service','Compute.php',4406],['lib/google/src/Google/Service','Compute.php',4543],['lib/google/src/Google/Service','Compute.php',4660],['lib/google/src/Google/Service','Compute.php',4740],['lib/google/src/Google/Service','Compute.php',4806],['lib/google/src/Google/Service','Compute.php',4927],['lib/google/src/Google/Service','Compute.php',5069],['lib/google/src/Google/Service','Compute.php',5229],['lib/google/src/Google/Service','Compute.php',5360],['badges/criteria','award_criteria.php',330],['badges/criteria','award_criteria_manual.php',220],['lib/google/src/Google/Service','Calendar.php',886],['lib/google/src/Google/Service','Calendar.php',1040],['lib/google/src/Google/Service','Calendar.php',1228],['lib/google/src/Google/Service','Calendar.php',1362],['lib/google/src/Google/Service','Analytics.php',2068],['lib/google/src/Google/Service','Analytics.php',2211],['lib/google/src/Google/Service','Analytics.php',2293],['lib/google/src/Google/Service','Analytics.php',2414],['lib/google/src/Google/Service','Analytics.php',2631],['lib/google/src/Google/Service','Analytics.php',2760],['lib/google/src/Google/Service','Analytics.php',2851],['lib/google/src/Google/Service','Analytics.php',3181],['lib/google/src/Google/Service','Analytics.php',3406],['lib/google/src/Google/Service','Tasks.php',309],['lib/google/src/Google/Service','Tasks.php',427],['cache/classes','loaders.php',777],['cache/classes','loaders.php',1491],['cache/classes','loaders.php',1859],['cache/stores/mongodb','lib.php',361],['lib/grade','grade_category.php',259],['cache/stores/file','lib.php',392],['lib/google/src/Google/Service','Storage.php',945],['lib/google/src/Google/Service','Storage.php',1060],['lib/google/src/Google/Service','Storage.php',1227],['lib/google/src/Google/Service','Storage.php',1349],['lib/google/src/Google/Service','Storage.php',1565],['admin/tool/uploadcourse/classes','course.php',226],['lib/google/src/Google/Cache','Null.php',51],['lib/filestorage','stored_file.php',323],['lib/filebrowser','virtual_root_file.php',69],['lib/google/src/Google/Service','AdSense.php',1257],['lib/google/src/Google/Service','AdSense.php',1729],['lib/google/src/Google/Service','Pubsub.php',239],['lib/google/src/Google/Service','Pubsub.php',378],['lib/grade','grade_scale.php',136],['lib/filebrowser','file_info.php',418],['lib/google/src/Google/Cache','File.php',106],['lib/htmlpurifier/HTMLPurifier','Zipper.php',89],['lib/google/src/Google/Service','Dns.php',370],['lib/filebrowser','file_info_stored.php',631],['lib/google/src/Google/Service','Replicapool.php',374],['lib/google/src/Google/Service','Resourceviews.php',419],['lib','badgeslib.php',620],['lib/google/src/Google/Cache','Apc.php',103],['lib/adodb','adodb-active-record.inc.php',792],['mnet','peer.php',122],['lib/grade','grade_outcome.php',97]], 260],
'get_records_select': ['get_records_select', 'Get a number of records as an array of objects which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1283]], 163],
'lesson_page_type_list': ['lesson_page_type_list', 'Return a list of page types ', [['mod/lesson','lib.php',1301]], 0],
'userdate': ['userdate', 'Also in ADORecordSet. ', [['lib/adodb','adodb.inc.php',2607],['lib/adodb','adodb.inc.php',3271],['lib','moodlelib.php',2150]], 496],
'get_records': ['get_records', 'Get a number of records as an array of objects where all the given conditions met. ', [['lib/dml','moodle_database.php',1236],['lib','coursecatlib.php',654],['question','category_class.php',63]], 860],
'lesson_reset_userdata': ['lesson_reset_userdata', 'Actual implementation of the reset course functionality, delete all the lesson attempts for course $data->courseid. ', [['mod/lesson','lib.php',877]], 0],
'lesson_user_complete': ['lesson_user_complete', 'Print a detailed representation of what a  user has done with a given particular instance of this module, for user activity reports. ', [['mod/lesson','lib.php',329]], 0],
'lesson_grade_item_update': ['lesson_grade_item_update', 'Create grade item for given lesson ', [['mod/lesson','lib.php',658]], 7],
'set_field': ['set_field', 'Sets the custom profile field used for testing. ', [['availability/condition/profile/tests','condition_test.php',349],['lib/dml','moodle_database.php',1688]], 462],
'table': ['table', '', [['lib/adodb','adodb-perf.inc.php',232],['lib/minify/lib','FirePHP.php',454],['lib','outputcomponents.php',1492]], 255],
'lesson_get_completion_state': ['lesson_get_completion_state', 'Obtains the automatic completion state for this lesson based on any conditions in lesson settings. ', [['mod/lesson','lib.php',1005]], 0],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'record_exists': ['record_exists', 'Test whether a record exists in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1768]], 735],
'get_field_sql': ['get_field_sql', 'Get a single field value (first field) using a SQL statement. ', [['lib/dml','moodle_database.php',1539]], 135],
'groups_get_group_name': ['groups_get_group_name', 'Gets the name of a group with a specified id ', [['lib','grouplib.php',55]], 14],
'lesson_reset_course_form_definition': ['lesson_reset_course_form_definition', 'Implementation of the function for printing the form elements that control whether the course reset functionality affects the lesson. ', [['mod/lesson','lib.php',829]], 0],
'lesson_cron': ['lesson_cron', 'Function to be run periodically according to the moodle cron This function searches for things that need to be done, such as sending out mail, toggling flags etc ... ', [['mod/lesson','lib.php',557]], 0],
'lesson_update_grades': ['lesson_update_grades', 'Update grades in central gradebook ', [['mod/lesson','lib.php',629]], 4],
'lesson_get_view_actions': ['lesson_get_view_actions', 'List the actions that correspond to a view of this module. This is used by the participation report. ', [['mod/lesson','lib.php',734]], 0],
'container': ['container', 'Outputs a container. ', [['lib','outputrenderers.php',3011]], 186],
'lesson_get_user_grades': ['lesson_get_user_grades', 'Return grade for given user or all users. ', [['mod/lesson','lib.php',570]], 2],
'add_node': ['add_node', 'Add a node to the tree. ', [['user/classes/output/myprofile','tree.php',52],['user/classes/output/myprofile','category.php',83],['lib','navigationlib.php',321]], 95],
'shift_course_mod_dates': ['shift_course_mod_dates', 'Change dates in module - used from course reset. ', [['lib','moodlelib.php',4968]], 9],
'grade_update': ['grade_update', 'Submit new or update grade; update/create grade_item definition. Grade must have userid specified, rawgrade and feedback with format are optional. rawgrade NULL means \'Not graded\'. Missing property or key means does not change the existing value. ', [['lib','gradelib.php',40]], 27],
'lesson_process_pre_save': ['lesson_process_pre_save', 'Runs any processes that must run before a lesson insert/update ', [['mod/lesson','lib.php',762]], 2],
'lesson_update_instance': ['lesson_update_instance', 'Given an object containing all the necessary data, (defined by the form in mod_form.php) this function will update an existing instance with new data. ', [['mod/lesson','lib.php',63]], 0],
'add': ['add', '', [['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',454],['blog','locallib.php',242],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',11],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',31],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',428],['backup/cc','validator.php',51],['lib/google/src/Google/Http','Batch.php',47],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',37],['lib/horde/framework/Horde/Support','ConsistentHash.php',148],['lib/horde/framework/Horde/Imap/Client','Ids.php',155],['lib/zend/Zend/Service/Simpy','WatchlistFilterSet.php',47],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',109],['lib/lessphp/Output','Mapped.php',50],['lib/horde/framework/Horde/Stream','TempString.php',118],['lib','licenselib.php',32],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',207],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',29],['lib/horde/framework/Horde/Mail/Rfc822','List.php',116],['lib/xhprof/xhprof_html/jquery','jquery-1.2.6.js',3450],['lib/google/src/Google/Service','Webmasters.php',375],['lib/horde/framework/Horde','Variables.php',297],['lib','outputcomponents.php',2700],['lib','outputcomponents.php',3375],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',14],['lib/zend/Zend','Date.php',1081],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',33],['comment','lib.php',675],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',86],['lib/horde/framework/Horde','Stream.php',116],['backup/cc/cc_lib/gral_lib','cssparser.php',111],['lib/lessphp','Output.php',18],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',50],['lib','adminlib.php',736],['lib','adminlib.php',895],['lib','adminlib.php',1447],['lib','csslib.php',1508],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',95],['lib','navigationlib.php',302],['lib','navigationlib.php',758],['lib','navigationlib.php',3288],['lib','navigationlib.php',3542],['lib/phpexcel/PHPExcel','HashTable.php',85],['lib/mustache/src/Mustache','HelperCollection.php',56],['lib/horde/framework/Horde/Mail/Rfc822','GroupList.php',25],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',27],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',80],['backup/cc/cc_lib','cc_utils.php',395],['backup/cc/cc_lib','cc_utils.php',454]], 5988],
'lesson_update_events': ['lesson_update_events', 'This function updates the events associated to the lesson. If $override is non-zero, then it updates only the events associated with the specified override. ', [['mod/lesson','lib.php',98]], 3],
'provide_export': ['provide_export', '', [['question','format.php',66],['question/format/xhtml','format.php',39],['question/format/gift','format.php',68],['question/format/xml','format.php',53]], 2],
'lesson_get_file_info': ['lesson_get_file_info', 'Returns a file_info_stored object for the file being requested here ', [['mod/lesson','lib.php',1243]], 0],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 1891],
'get_all_instances_in_courses': ['get_all_instances_in_courses', 'Returns an array of all the active instances of a particular module in given courses, sorted in the order they are defined ', [['lib','datalib.php',1413]], 13],
'get_coursemodule_from_instance': ['get_coursemodule_from_instance', 'Given an instance number of a module, finds the coursemodule description ', [['lib','datalib.php',1331]], 365],
'instance_is_visible': ['instance_is_visible', 'Determine whether a module instance is visible within a course ', [['lib','datalib.php',1510]], 6],
'create': ['create', 'Creates a new 2048 bit RSA key pair and returns a unique ID that can be used to reference this key pair when launching new instances. ', [['lib/zend/Zend/Service/Amazon/Ec2','Keypair.php',39],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',271],['repository/filesystem','lib.php',283],['lib/zend/Zend/Service/Amazon/Ec2','Securitygroups.php',39],['lib/google/src/Google/Service','Gmail.php',670],['lib/google/src/Google/Service','Gmail.php',827],['course','lib.php',2874],['lib/classes/event','base.php',139],['lib/google/src/Google/Service','Genomics.php',618],['lib/google/src/Google/Service','Genomics.php',717],['lib/google/src/Google/Service','Genomics.php',850],['lib/google/src/Google/Service','Genomics.php',1313],['lib','modinfolib.php',1747],['calendar','lib.php',2651],['lib/zend/Zend/Service/Amazon','Sqs.php',82],['lib','weblib.php',3048],['mod/lesson','locallib.php',1013],['mod/lesson','locallib.php',2166],['mod/lesson','locallib.php',3203],['lib/google/src/Google/Service','Fitness.php',340],['lib/google/src/Google/Service','TagManager.php',1034],['lib/google/src/Google/Service','TagManager.php',1124],['lib/google/src/Google/Service','TagManager.php',1217],['lib/google/src/Google/Service','TagManager.php',1310],['lib/google/src/Google/Service','TagManager.php',1403],['lib/google/src/Google/Service','TagManager.php',1497],['lib/google/src/Google/Service','TagManager.php',1591],['lib/google/src/Google/Service','TagManager.php',1742],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Container.php',314],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['repository','lib.php',206],['repository','lib.php',1960],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',555],['lib/google/src/Google/Service','Games.php',1648],['lib/google/src/Google/Service','Games.php',2012],['lib/google/src/Google/Service','MapsEngine.php',1676],['lib/google/src/Google/Service','MapsEngine.php',1976],['lib/google/src/Google/Service','MapsEngine.php',2252],['lib/google/src/Google/Service','MapsEngine.php',2329],['lib/google/src/Google/Service','MapsEngine.php',2897],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Pubsub.php',219],['lib/google/src/Google/Service','Pubsub.php',364],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/simplepie/library/SimplePie','Registry.php',153],['lib','navigationlib.php',266],['lib/google/src/Google/Service','Dns.php',282],['lib/google/src/Google/Service','Dns.php',355],['lib','coursecatlib.php',328],['mod/quiz/classes','structure.php',65]], 3074],
'lesson_update_media_file': ['lesson_update_media_file', 'Update the lesson activity to include any file that was uploaded, or if there is none, set the mediafile field to blank. ', [['mod/lesson','lib.php',1315]], 2],
'avg': ['avg', 'Average grade for the attempts selected by $this->whichattempts ', [['mod/quiz/report/statistics/classes','calculated.php',100]], 19],
'lesson_add_instance': ['lesson_add_instance', 'Given an object containing all the necessary data, (defined by the form in mod_form.php) this function will create a new instance and return the id number of the new instance. ', [['mod/lesson','lib.php',30]], 0],
'lesson_extend_settings_navigation': ['lesson_extend_settings_navigation', 'This function extends the settings navigation block for the site. ', [['mod/lesson','lib.php',1051]], 0],
'lesson_refresh_events': ['lesson_refresh_events', 'This standard function will check all instances of this module and make sure there are up-to-date events created for each of them. If courseid = 0, then every lesson event in the site is checked, else only lesson events belonging to the course specified are checked. This function is used, in its new format, by restore_refresh_events() ', [['mod/lesson','lib.php',229]], 0],
'get_children_key_list': ['get_children_key_list', 'Return a list of all the keys of all the child nodes. ', [['lib','navigationlib.php',359]], 4],
'provide_import': ['provide_import', 'This plugin provide import ', [['question/format/webct','format.php',172],['question','format.php',61],['question/format/multianswer','format.php',38],['question/format/examview','format.php',56],['question/format/aiken','format.php',56],['question/format/blackboard_six','formatbase.php',40],['question/format/gift','format.php',64],['question/format/xml','format.php',49],['mod/lesson','format.php',326],['question/format/missingword','format.php',54]], 2],
'delete_records_select': ['delete_records_select', 'Delete one or more records from a table which match a particular WHERE clause. ', [['lib/dml','pgsql_native_moodle_database.php',1247],['lib/dml','oci_native_moodle_database.php',1445],['lib/dml','sqlsrv_native_moodle_database.php',1153],['lib/dml','mssql_native_moodle_database.php',1082],['lib/dml','mysqli_native_moodle_database.php',1469],['lib/dml/tests','dml_test.php',5432],['lib/dml','pdo_moodle_database.php',207]], 166],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','oci_native_moodle_database.php',1102],['lib/dml','sqlsrv_native_moodle_database.php',823],['lib/dml','mssql_native_moodle_database.php',741],['lib/dml','mysqli_native_moodle_database.php',1049],['lib/dml/tests','dml_test.php',5424],['lib/dml','pdo_moodle_database.php',308]], 678],
'box': ['box', 'Outputs a box. ', [['lib','outputrenderers.php',2974]], 295],
'format_module_intro': ['format_module_intro', 'Formats activity intro text ', [['lib','weblib.php',1473]], 57],
'execute': ['execute', 'Exceptionally override the execute method, so, based in the activity_included setting, we are able to skip the execution of one task completely ', [['backup/moodle2','backup_activity_task.class.php',205],['backup/converter/moodle1','backuplib.php',10],['filter/tex','latex.php',60],['backup/util/plan','base_plan.class.php',158],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['mod/lti/service/profile/classes/local/resource','profile.php',76],['webservice','lib.php',1772],['lib/classes/task','context_cleanup_task.php',41],['lib/adodb','adodb.inc.php',967],['enrol/imsenterprise/classes/task','cron_task.php',43],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/classes/task','calendar_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['lib/classes/task','registration_cron_task.php',40],['lib/classes/task','portfolio_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/google/src/Google/Http','Batch.php',56],['backup/converter/imscc11','lib.php',85],['lib/classes/task','file_temp_cleanup_task.php',40],['filter/tex','texdebug.php',287],['admin/tool/monitor/classes','notification_task.php',39],['lib/classes/task','stats_cron_task.php',40],['lib/classes/task','backup_cleanup_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['backup/util/ui','backup_ui.class.php',122],['lib/dml','pgsql_native_moodle_database.php',665],['lib/classes/task','messaging_cleanup_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','RetryN.php',68],['lib/classes/task','session_cleanup_task.php',40],['lib/classes/task','completion_cron_task.php',40],['lib/dml','oci_native_moodle_database.php',1009],['backup/util/plan','base_task.class.php',162],['lib/adodb/drivers','adodb-pdo.inc.php',464],['backup/util/plan','backup_plan.class.php',112],['backup/util/ui','restore_ui.class.php',206],['backup/converter/imscc11','backuplib.php',42],['backup/moodle2','restore_activity_task.class.php',183],['','mdeploy.php',743],['lib/dml','sqlsrv_native_moodle_database.php',745],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['lib/google/src/Google/Http','REST.php',28],['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['lib/classes/task','plagiarism_cron_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','backup_structure_step.class.php',50],['mod/forum/classes/task','cron_task.php',39],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','file_trash_cleanup_task.php',40],['backup/util/plan','restore_execution_step.class.php',25],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['admin/tool/installaddon/classes','validator.php',114],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','automated_backup_task.php',40],['backup/converter/moodle1','lib.php',142],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/classes/task','create_contexts_task.php',40],['backup/util/plan','restore_plan.class.php',159],['backup/converter/imscc1','lib.php',84],['lib/dml','mssql_native_moodle_database.php',662],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/classes/task','cache_cleanup_task.php',40],['lib/classes/task','badges_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['backup/util/interfaces','executable.class.php',32],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['lib/adodb/drivers','adodb-oci8po.inc.php',52],['lib/classes/task','question_cron_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','NoRetry.php',37],['lib/dml','mysqli_native_moodle_database.php',955],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['backup/util/plan/tests/fixtures','plan_fixtures.php',47],['backup/util/plan/tests/fixtures','plan_fixtures.php',55],['lib/classes/task','events_cron_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['lib/adodb/drivers','adodb-oci8.inc.php',786],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','tag_cron_task.php',40],['lib/classes/task','blog_cron_task.php',40],['lib/classes/task','send_failed_login_notifications_task.php',43],['lib/classes/task','grade_cron_task.php',40],['lib/dml/tests','dml_test.php',5422],['admin/tool/uploadcourse/classes','processor.php',174],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['lib/google/src/Google','Client.php',545],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','legacy_plugin_cron_task.php',42],['lib/dml','pdo_moodle_database.php',226],['lib/classes/task','check_for_updates_task.php',40],['backup/util/helper','restore_decode_processor.class.php',73],['backup/moodle2','backup_section_task.class.php',97],['webservice/amf/testclient','AMFTester.mxml',282],['lib/classes/task','delete_incomplete_users_task.php',40],['mod/assign','adminlib.php',342],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/monitor/classes/task','clean_events.php',41]], 733],
'lesson_process_post_save': ['lesson_process_post_save', 'Runs any processes that must be run after a lesson insert/update ', [['mod/lesson','lib.php',815]], 2],
'lesson_reset_course_form_defaults': ['lesson_reset_course_form_defaults', 'Course reset form defaults. ', [['mod/lesson','lib.php',844]], 0],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pgsql_native_moodle_database.php',1137],['lib/dml','oci_native_moodle_database.php',1355],['lib/dml','sqlsrv_native_moodle_database.php',1081],['lib/dml','mssql_native_moodle_database.php',1003],['lib/dml','mysqli_native_moodle_database.php',1397],['lib/dml/tests','dml_test.php',5430],['lib/dml','pdo_moodle_database.php',460]], 565],
'get_plugin_list': ['get_plugin_list', 'Get list of plugins of given type. ', [['lib/classes','component.php',781],['lib','deprecatedlib.php',467],['admin/tool/monitor/classes','eventlist.php',176]], 184],
'lesson_get_extra_capabilities': ['lesson_get_extra_capabilities', 'Returns all other caps used in module ', [['mod/lesson','lib.php',962]], 0],
'sum': ['sum', '', [['lib/evalmath','evalmath.class.php',520],['lib/phpexcel/PHPExcel/Calculation','MathTrig.php',1111]], 90],
'is_directory': ['is_directory', 'Whether or not this is a directory ', [['lib/filebrowser','file_info_context_course.php',372],['lib/filebrowser','file_info_context_course.php',657],['lib/filebrowser','file_info_context_course.php',803],['lib/filebrowser','file_info_context_system.php',83],['mod/book','locallib.php',454],['lib/filebrowser','file_info_context_coursecat.php',143],['mod/forum','locallib.php',463],['lib/filebrowser','file_info_context_module.php',249],['lib/filebrowser','file_info_context_user.php',265],['mod/data','locallib.php',475],['mod/workshop','fileinfolib.php',82],['mod/workshop','fileinfolib.php',241],['mod/imscp','locallib.php',328],['mod/lesson/classes','file_info.php',94],['mod/glossary','locallib.php',525],['lib/filestorage','stored_file.php',310],['lib/filebrowser','virtual_root_file.php',60],['lib/filebrowser','file_info_stored.php',267]], 131],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1583],['lib/dml','moodle_database.php',678]], 375],
'lesson_print_overview': ['lesson_print_overview', 'Prints lesson summaries on MyMoodle Page ', [['mod/lesson','lib.php',399]], 0],
'from': ['from', 'From clause ', [['lib/zend/Zend/Service/WindowsAzure/Storage','TableEntityQuery.php',84]], 226],
'lesson_get_file_areas': ['lesson_get_file_areas', 'Returns an array of file areas ', [['mod/lesson','lib.php',1226]], 2],
'get_file_by_hash': ['get_file_by_hash', 'Fetch file using local file full pathname hash ', [['lib/filestorage','file_storage.php',427]], 75],
'lesson_get_import_export_formats': ['lesson_get_import_export_formats', 'Get list of available import or export formats ', [['mod/lesson','lib.php',1116]], 1],
'get_file': ['get_file', 'Return file path. ', [['repository/filesystem','lib.php',183],['repository/flickr_public','lib.php',453],['repository/boxnet','lib.php',179],['lib','webdavlib.php',391],['repository/dropbox','lib.php',410],['mod/data/field/picture','field.class.php',124],['repository/s3','lib.php',201],['lib/filestorage','file_storage.php',448],['repository/skydrive','lib.php',130],['repository/webdav','lib.php',73],['repository/dropbox','locallib.php',114],['repository','lib.php',1701],['repository/flickr','lib.php',277],['repository/googledocs','lib.php',408],['lib','externallib.php',870],['mod/data/field/file','field.class.php',121],['repository/equella','lib.php',166],['repository/alfresco','lib.php',195]], 162],
'get_field': ['get_field', 'Get the right field name to fetch a stat for these attempts that is calculated for more than one $whichattempts (count or avg). ', [['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1497],['user/filters','lib.php',124],['lib/behat','behat_field_manager.php',243]], 485],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',5950]], 486],
'is_array': ['is_array', '', [], 1820],
'count': ['count', '', [], 3984],
'time': ['time', '', [], 1768],
'array_shift': ['array_shift', '', [], 607],
'implode': ['implode', '', [], 1259],
'array_key_exists': ['array_key_exists', '', [], 1539],
'array_search': ['array_search', '', [], 188],
'natcasesort': ['natcasesort', '', [], 4],
'is_null': ['is_null', '', [], 1992],
'sha1': ['sha1', '', [], 188],
'file_exists': ['file_exists', '', [], 873],
'is_numeric': ['is_numeric', '', [], 723],
'array_merge': ['array_merge', '', [], 2320],
'max': ['max', '', [], 1096],
'defined': ['defined', '', [], 4098],
'function_exists': ['function_exists', '', [], 443],
'serialize': ['serialize', '', [], 266],
'reset': ['reset', '', [], 1070],
'link': ['link', '', [], 635],
'is_object': ['is_object', '', [], 508],
'min': ['min', '', [], 754]};
CLASS_DATA={
'mod_lesson_file_info': ['mod_lesson_file_info', 'File browsing support class. ', [['mod/lesson/classes','file_info.php',27]], 1],
'file_info_stored': ['file_info_stored', 'Represents an actual file or folder - a row in the file table in the tree navigated by {@link file_browser}. ', [['lib/filebrowser','file_info_stored.php',28]], 32],
'navigation_node': ['navigation_node', 'This class is used to represent a node in a navigation tree ', [['lib','navigationlib.php',34]], 338],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',240]], 2887],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',6988]], 942],
'html_writer': ['html_writer', 'Simple html output class ', [['lib','outputcomponents.php',1052]], 4832],
'html_table': ['html_table', 'Holds all the information required to render a <table> by {@link core_renderer::table()} ', [['lib','outputcomponents.php',2006]], 224],
'core_component': ['core_component', 'Collection of components related methods. ', [['lib/classes','component.php',41]], 485],
'lesson': ['lesson', 'Class representation of a lesson ', [['mod/lesson','locallib.php',921]], 28],
'calendar_event': ['calendar_event', 'Manage calendar events ', [['calendar','lib.php',1916]], 59]};
CONST_DATA={
'LESSON_MAX_EVENT_LENGTH': ['LESSON_MAX_EVENT_LENGTH', '', [['mod/lesson','locallib.php',59]], 2],
'FEATURE_MOD_INTRO': ['FEATURE_MOD_INTRO', '', [['lib','moodlelib.php',426]], 31],
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 462],
'FEATURE_COMPLETION_HAS_RULES': ['FEATURE_COMPLETION_HAS_RULES', '', [['lib','moodlelib.php',407]], 11],
'LESSON_PAGE_BRANCHTABLE': ['LESSON_PAGE_BRANCHTABLE', '', [['mod/lesson/pagetypes','branchtable.php',29]], 24],
'LESSON_EOL': ['LESSON_EOL', '', [['mod/lesson','locallib.php',44]], 29],
'FEATURE_GRADE_HAS_GRADE': ['FEATURE_GRADE_HAS_GRADE', '', [['lib','moodlelib.php',394]], 29],
'COMPLETION_AND': ['COMPLETION_AND', '', [['lib','completionlib.php',131]], 9],
'FEATURE_SHOW_DESCRIPTION': ['FEATURE_SHOW_DESCRIPTION', '', [['lib','moodlelib.php',437]], 22],
'FEATURE_GRADE_OUTCOMES': ['FEATURE_GRADE_OUTCOMES', '', [['lib','moodlelib.php',396]], 23],
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 271],
'GRADE_TYPE_NONE': ['GRADE_TYPE_NONE', '', [['lib/grade','constants.php',80]], 41],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1252],
'GRADE_TYPE_SCALE': ['GRADE_TYPE_SCALE', '', [['lib/grade','constants.php',90]], 63],
'FEATURE_BACKUP_MOODLE2': ['FEATURE_BACKUP_MOODLE2', '', [['lib','moodlelib.php',434]], 34],
'FEATURE_COMPLETION_TRACKS_VIEWS': ['FEATURE_COMPLETION_TRACKS_VIEWS', '', [['lib','moodlelib.php',405]], 23],
'FEATURE_GROUPS': ['FEATURE_GROUPS', '', [['lib','moodlelib.php',414]], 25],
'GRADE_TYPE_VALUE': ['GRADE_TYPE_VALUE', '', [['lib/grade','constants.php',85]], 71],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',138],['','install.php',93],['lib','setup.php',386]], 3532],
'FEATURE_GROUPINGS': ['FEATURE_GROUPINGS', '', [['lib','moodlelib.php',416]], 23]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
