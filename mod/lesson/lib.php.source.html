<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mod/lesson/lib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='mod/lesson';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mod/lesson/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">//</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">//</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">//</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Standard library of functions and constants for lesson</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package mod_lesson</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @copyright  1999 onwards Martin Dougiamas  {@link http://moodle.com}</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> **/</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment">/* Do not include any libraries here! */</span>
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">/**</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * Given an object containing all the necessary data,</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * (defined by the form in mod_form.php) this function</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * will create a new instance and return the id number</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * of the new instance.</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> *</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * @global object</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @global object</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> * @param object $lesson Lesson post data from the form</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * @return int</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> **/</span>
<a name="l41"><span class="linenum">  41</span></a>  function <a class="function" onClick="logFunction('lesson_add_instance')" href="../../_functions/lesson_add_instance.html" onMouseOver="funcPopup(event,'lesson_add_instance')">lesson_add_instance</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l42"><span class="linenum">  42</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l43"><span class="linenum">  43</span></a>  
<a name="l44"><span class="linenum">  44</span></a>      <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>;
<a name="l45"><span class="linenum">  45</span></a>      <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('mediafile')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/mediafile.html">mediafile</a>;
<a name="l46"><span class="linenum">  46</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>);
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>      <a class="function" onClick="logFunction('lesson_process_pre_save')" href="../../_functions/lesson_process_pre_save.html" onMouseOver="funcPopup(event,'lesson_process_pre_save')">lesson_process_pre_save</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l49"><span class="linenum">  49</span></a>  
<a name="l50"><span class="linenum">  50</span></a>      unset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('mediafile')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/mediafile.html">mediafile</a>);
<a name="l51"><span class="linenum">  51</span></a>      <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(&quot;lesson&quot;, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l52"><span class="linenum">  52</span></a>      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>;
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>      <a class="function" onClick="logFunction('lesson_update_media_file')" href="../../_functions/lesson_update_media_file.html" onMouseOver="funcPopup(event,'lesson_update_media_file')">lesson_update_media_file</a>(<a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>);
<a name="l55"><span class="linenum">  55</span></a>  
<a name="l56"><span class="linenum">  56</span></a>      <a class="function" onClick="logFunction('lesson_process_post_save')" href="../../_functions/lesson_process_post_save.html" onMouseOver="funcPopup(event,'lesson_process_post_save')">lesson_process_post_save</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>      <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>      return <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>;
<a name="l61"><span class="linenum">  61</span></a>  }
<a name="l62"><span class="linenum">  62</span></a>  
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">/**</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment"> * Given an object containing all the necessary data,</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment"> * (defined by the form in mod_form.php) this function</span>
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment"> * will update an existing instance with new data.</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment"> *</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment"> * @global object</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment"> * @param object $lesson Lesson post data from the form</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment"> * @return boolean</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment"> **/</span>
<a name="l72"><span class="linenum">  72</span></a>  function <a class="function" onClick="logFunction('lesson_update_instance')" href="../../_functions/lesson_update_instance.html" onMouseOver="funcPopup(event,'lesson_update_instance')">lesson_update_instance</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l73"><span class="linenum">  73</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l74"><span class="linenum">  74</span></a>  
<a name="l75"><span class="linenum">  75</span></a>      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('instance')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>;
<a name="l76"><span class="linenum">  76</span></a>      <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>;
<a name="l77"><span class="linenum">  77</span></a>      <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('mediafile')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/mediafile.html">mediafile</a>;
<a name="l78"><span class="linenum">  78</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>);
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>      <a class="function" onClick="logFunction('lesson_process_pre_save')" href="../../_functions/lesson_process_pre_save.html" onMouseOver="funcPopup(event,'lesson_process_pre_save')">lesson_process_pre_save</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l81"><span class="linenum">  81</span></a>  
<a name="l82"><span class="linenum">  82</span></a>      unset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('mediafile')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/mediafile.html">mediafile</a>);
<a name="l83"><span class="linenum">  83</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>(&quot;lesson&quot;, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>      <a class="function" onClick="logFunction('lesson_update_media_file')" href="../../_functions/lesson_update_media_file.html" onMouseOver="funcPopup(event,'lesson_update_media_file')">lesson_update_media_file</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>);
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>      <a class="function" onClick="logFunction('lesson_process_post_save')" href="../../_functions/lesson_process_post_save.html" onMouseOver="funcPopup(event,'lesson_process_post_save')">lesson_process_post_save</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l88"><span class="linenum">  88</span></a>  
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">    // update grade item definition</span>
<a name="l90"><span class="linenum">  90</span></a>      <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">    // update grades - TODO: do it only when grading style changes</span>
<a name="l93"><span class="linenum">  93</span></a>      <a class="function" onClick="logFunction('lesson_update_grades')" href="../../_functions/lesson_update_grades.html" onMouseOver="funcPopup(event,'lesson_update_grades')">lesson_update_grades</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, 0, false);
<a name="l94"><span class="linenum">  94</span></a>  
<a name="l95"><span class="linenum">  95</span></a>      return true;
<a name="l96"><span class="linenum">  96</span></a>  }
<a name="l97"><span class="linenum">  97</span></a>  
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">/**</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment"> * This function updates the events associated to the lesson.</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment"> * If $override is non-zero, then it updates only the events</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment"> * associated with the specified override.</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment"> *</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment"> * @uses LESSON_MAX_EVENT_LENGTH</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment"> * @param object $lesson the lesson object.</span>
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment"> * @param object $override (optional) limit to a specific override</span>
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment"> */</span>
<a name="l107"><span class="linenum"> 107</span></a>  function <a class="function" onClick="logFunction('lesson_update_events')" href="../../_functions/lesson_update_events.html" onMouseOver="funcPopup(event,'lesson_update_events')">lesson_update_events</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it1845" onMouseOver="hilite(1845)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a> = null) {
<a name="l108"><span class="linenum"> 108</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l109"><span class="linenum"> 109</span></a>  
<a name="l110"><span class="linenum"> 110</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../calendar/lib.php.html">/calendar/lib.php</a>');
<a name="l111"><span class="linenum"> 111</span></a>  
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment">    // Load the old events relating to this lesson.</span>
<a name="l113"><span class="linenum"> 113</span></a>      <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conds')" href="../../_variables/conds.html">$conds</a> = array('modulename' =&gt; 'lesson',
<a name="l114"><span class="linenum"> 114</span></a>                     'instance' =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l115"><span class="linenum"> 115</span></a>      if (!empty(<a class="var it1845" onMouseOver="hilite(1845)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>)) {
<a name="l116"><span class="linenum"> 116</span></a>  <span class="comment">        // Only load events for this override.</span>
<a name="l117"><span class="linenum"> 117</span></a>          if (isset(<a class="var it1845" onMouseOver="hilite(1845)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a onClick="logVariable('userid')" class="var it43563" onMouseOver="hilite(43563)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>)) {
<a name="l118"><span class="linenum"> 118</span></a>              <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conds')" href="../../_variables/conds.html">$conds</a>['userid'] = <a class="var it1845" onMouseOver="hilite(1845)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a onClick="logVariable('userid')" class="var it43563" onMouseOver="hilite(43563)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l119"><span class="linenum"> 119</span></a>          } else {
<a name="l120"><span class="linenum"> 120</span></a>              <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conds')" href="../../_variables/conds.html">$conds</a>['groupid'] = <a class="var it1845" onMouseOver="hilite(1845)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>-&gt;<a onClick="logVariable('groupid')" class="var it43563" onMouseOver="hilite(43563)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>;
<a name="l121"><span class="linenum"> 121</span></a>          }
<a name="l122"><span class="linenum"> 122</span></a>      }
<a name="l123"><span class="linenum"> 123</span></a>      <a class="var it9822" onMouseOver="hilite(9822)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('event', <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conds')" href="../../_variables/conds.html">$conds</a>);
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">    // Now make a todo list of all that needs to be updated.</span>
<a name="l126"><span class="linenum"> 126</span></a>      if (empty(<a class="var it1845" onMouseOver="hilite(1845)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>)) {
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment">        // We are updating the primary settings for the lesson, so we</span>
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">        // need to add all the overrides.</span>
<a name="l129"><span class="linenum"> 129</span></a>          <a class="var it9782" onMouseOver="hilite(9782)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('lesson_overrides', array('lessonid' =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">        // As well as the original lesson (empty override).</span>
<a name="l131"><span class="linenum"> 131</span></a>          <a class="var it9782" onMouseOver="hilite(9782)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a>[] = new stdClass();
<a name="l132"><span class="linenum"> 132</span></a>      } else {
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">        // Just do the one override.</span>
<a name="l134"><span class="linenum"> 134</span></a>          <a class="var it9782" onMouseOver="hilite(9782)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a> = array(<a class="var it1845" onMouseOver="hilite(1845)" onMouseOut="lolite()" onClick="logVariable('override')" href="../../_variables/override.html">$override</a>);
<a name="l135"><span class="linenum"> 135</span></a>      }
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>      foreach (<a class="var it9782" onMouseOver="hilite(9782)" onMouseOut="lolite()" onClick="logVariable('overrides')" href="../../_variables/overrides.html">$overrides</a> as <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>) {
<a name="l138"><span class="linenum"> 138</span></a>          <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>   = isset(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('groupid')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>) ? <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('groupid')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> : 0;
<a name="l139"><span class="linenum"> 139</span></a>          <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>    = isset(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('userid')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>) ? <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('userid')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> : 0;
<a name="l140"><span class="linenum"> 140</span></a>          <a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a>  = isset(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('available')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/available.html">available</a>) ? <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('available')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/available.html">available</a> : <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('available')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/available.html">available</a>;
<a name="l141"><span class="linenum"> 141</span></a>          <a class="var it1210" onMouseOver="hilite(1210)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a> = isset(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('deadline')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a>) ? <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('deadline')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a> : <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('deadline')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a>;
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">        // Only add open/close events for an override if they differ from the lesson default.</span>
<a name="l144"><span class="linenum"> 144</span></a>          <a class="var it9823" onMouseOver="hilite(9823)" onMouseOut="lolite()" onClick="logVariable('addopen')" href="../../_variables/addopen.html">$addopen</a>  = empty(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('id')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) || !empty(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('available')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/available.html">available</a>);
<a name="l145"><span class="linenum"> 145</span></a>          <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('addclose')" href="../../_variables/addclose.html">$addclose</a> = empty(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('id')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) || !empty(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('deadline')" class="var it43284" onMouseOver="hilite(43284)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a>);
<a name="l146"><span class="linenum"> 146</span></a>  
<a name="l147"><span class="linenum"> 147</span></a>          if (!empty(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>)) {
<a name="l148"><span class="linenum"> 148</span></a>              <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>;
<a name="l149"><span class="linenum"> 149</span></a>          } else {
<a name="l150"><span class="linenum"> 150</span></a>              <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('lesson', <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)-&gt;id;
<a name="l151"><span class="linenum"> 151</span></a>          }
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = new stdClass();
<a name="l154"><span class="linenum"> 154</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('description')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/description.html">description</a> = <a class="function" onClick="logFunction('format_module_intro')" href="../../_functions/format_module_intro.html" onMouseOver="funcPopup(event,'format_module_intro')">format_module_intro</a>('lesson', <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>);
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">        // Events module won't show user events when the courseid is nonzero.</span>
<a name="l156"><span class="linenum"> 156</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('courseid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>    = (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) ? 0 : <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>;
<a name="l157"><span class="linenum"> 157</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('groupid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>     = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l158"><span class="linenum"> 158</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('userid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>      = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l159"><span class="linenum"> 159</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('modulename')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a>  = 'lesson';
<a name="l160"><span class="linenum"> 160</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('instance')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>    = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l161"><span class="linenum"> 161</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timestart')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>   = <a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a>;
<a name="l162"><span class="linenum"> 162</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timeduration')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timeduration.html">timeduration</a> = <a class="phpfunction" onClick="logFunction('max')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(<a class="var it1210" onMouseOver="hilite(1210)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a> - <a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a>, 0);
<a name="l163"><span class="linenum"> 163</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('visible')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a>     = <a class="function" onClick="logFunction('instance_is_visible')" href="../../_functions/instance_is_visible.html" onMouseOver="funcPopup(event,'instance_is_visible')">instance_is_visible</a>('lesson', <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l164"><span class="linenum"> 164</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('eventtype')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/eventtype.html">eventtype</a>   = 'open';
<a name="l165"><span class="linenum"> 165</span></a>  
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">        // Determine the event name.</span>
<a name="l167"><span class="linenum"> 167</span></a>          if (<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>) {
<a name="l168"><span class="linenum"> 168</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = new stdClass();
<a name="l169"><span class="linenum"> 169</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>-&gt;<a onClick="logVariable('lesson')" class="var it43459" onMouseOver="hilite(43459)" onMouseOut="lolite()" href="../../_variables/lesson.html">lesson</a> = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l170"><span class="linenum"> 170</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>-&gt;<a onClick="logVariable('group')" class="var it43459" onMouseOver="hilite(43459)" onMouseOut="lolite()" href="../../_variables/group.html">group</a> = <a class="function" onClick="logFunction('groups_get_group_name')" href="../../_functions/groups_get_group_name.html" onMouseOver="funcPopup(event,'groups_get_group_name')">groups_get_group_name</a>(<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>);
<a name="l171"><span class="linenum"> 171</span></a>              if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>-&gt;<a onClick="logVariable('group')" class="var it43459" onMouseOver="hilite(43459)" onMouseOut="lolite()" href="../../_variables/group.html">group</a> === false) {
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment">                // Group doesn't exist, just skip it.</span>
<a name="l173"><span class="linenum"> 173</span></a>                  continue;
<a name="l174"><span class="linenum"> 174</span></a>              }
<a name="l175"><span class="linenum"> 175</span></a>              <a class="var it2532" onMouseOver="hilite(2532)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('overridegroupeventname', 'lesson', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l176"><span class="linenum"> 176</span></a>          } else if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l177"><span class="linenum"> 177</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = new stdClass();
<a name="l178"><span class="linenum"> 178</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>-&gt;<a onClick="logVariable('lesson')" class="var it43459" onMouseOver="hilite(43459)" onMouseOut="lolite()" href="../../_variables/lesson.html">lesson</a> = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l179"><span class="linenum"> 179</span></a>              <a class="var it2532" onMouseOver="hilite(2532)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('overrideusereventname', 'lesson', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l180"><span class="linenum"> 180</span></a>          } else {
<a name="l181"><span class="linenum"> 181</span></a>              <a class="var it2532" onMouseOver="hilite(2532)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a> = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l182"><span class="linenum"> 182</span></a>          }
<a name="l183"><span class="linenum"> 183</span></a>          if (<a class="var it9823" onMouseOver="hilite(9823)" onMouseOut="lolite()" onClick="logVariable('addopen')" href="../../_variables/addopen.html">$addopen</a> or <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('addclose')" href="../../_variables/addclose.html">$addclose</a>) {
<a name="l184"><span class="linenum"> 184</span></a>              if (<a class="var it1210" onMouseOver="hilite(1210)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a> and <a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a> and <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timeduration')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timeduration.html">timeduration</a> &lt;= <a class="constant" onClick="logConstant('LESSON_MAX_EVENT_LENGTH')" href="../../_constants/LESSON_MAX_EVENT_LENGTH.html" onMouseOver="constPopup(event,'LESSON_MAX_EVENT_LENGTH')">LESSON_MAX_EVENT_LENGTH</a>) {
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment">                // Single event for the whole lesson.</span>
<a name="l186"><span class="linenum"> 186</span></a>                  if (<a class="var it9825" onMouseOver="hilite(9825)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it9822" onMouseOver="hilite(9822)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a>)) {
<a name="l187"><span class="linenum"> 187</span></a>                      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it9825" onMouseOver="hilite(9825)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a>-&gt;<a onClick="logVariable('id')" class="var it44770" onMouseOver="hilite(44770)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l188"><span class="linenum"> 188</span></a>                  } else {
<a name="l189"><span class="linenum"> 189</span></a>                      unset(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l190"><span class="linenum"> 190</span></a>                  }
<a name="l191"><span class="linenum"> 191</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('name')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="var it2532" onMouseOver="hilite(2532)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a>;
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment">                // The method calendar_event::create will reuse a db record if the id field is set.</span>
<a name="l193"><span class="linenum"> 193</span></a>                  <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l194"><span class="linenum"> 194</span></a>              } else {
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">                // Separate start and end events.</span>
<a name="l196"><span class="linenum"> 196</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timeduration')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timeduration.html">timeduration</a>  = 0;
<a name="l197"><span class="linenum"> 197</span></a>                  if (<a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('available')" href="../../_variables/available.html">$available</a> &amp;&amp; <a class="var it9823" onMouseOver="hilite(9823)" onMouseOut="lolite()" onClick="logVariable('addopen')" href="../../_variables/addopen.html">$addopen</a>) {
<a name="l198"><span class="linenum"> 198</span></a>                      if (<a class="var it9825" onMouseOver="hilite(9825)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it9822" onMouseOver="hilite(9822)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a>)) {
<a name="l199"><span class="linenum"> 199</span></a>                          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it9825" onMouseOver="hilite(9825)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a>-&gt;<a onClick="logVariable('id')" class="var it44770" onMouseOver="hilite(44770)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l200"><span class="linenum"> 200</span></a>                      } else {
<a name="l201"><span class="linenum"> 201</span></a>                          unset(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l202"><span class="linenum"> 202</span></a>                      }
<a name="l203"><span class="linenum"> 203</span></a>                      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('name')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="var it2532" onMouseOver="hilite(2532)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a>.' ('.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lessonopens', 'lesson').')';
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment">                    // The method calendar_event::create will reuse a db record if the id field is set.</span>
<a name="l205"><span class="linenum"> 205</span></a>                      <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l206"><span class="linenum"> 206</span></a>                  }
<a name="l207"><span class="linenum"> 207</span></a>                  if (<a class="var it1210" onMouseOver="hilite(1210)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a> &amp;&amp; <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('addclose')" href="../../_variables/addclose.html">$addclose</a>) {
<a name="l208"><span class="linenum"> 208</span></a>                      if (<a class="var it9825" onMouseOver="hilite(9825)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it9822" onMouseOver="hilite(9822)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a>)) {
<a name="l209"><span class="linenum"> 209</span></a>                          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it9825" onMouseOver="hilite(9825)" onMouseOut="lolite()" onClick="logVariable('oldevent')" href="../../_variables/oldevent.html">$oldevent</a>-&gt;<a onClick="logVariable('id')" class="var it44770" onMouseOver="hilite(44770)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l210"><span class="linenum"> 210</span></a>                      } else {
<a name="l211"><span class="linenum"> 211</span></a>                          unset(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('id')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l212"><span class="linenum"> 212</span></a>                      }
<a name="l213"><span class="linenum"> 213</span></a>                      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('name')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>      = <a class="var it2532" onMouseOver="hilite(2532)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../_variables/eventname.html">$eventname</a>.' ('.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lessoncloses', 'lesson').')';
<a name="l214"><span class="linenum"> 214</span></a>                      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('timestart')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> = <a class="var it1210" onMouseOver="hilite(1210)" onMouseOut="lolite()" onClick="logVariable('deadline')" href="../../_variables/deadline.html">$deadline</a>;
<a name="l215"><span class="linenum"> 215</span></a>                      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('eventtype')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/eventtype.html">eventtype</a> = 'close';
<a name="l216"><span class="linenum"> 216</span></a>                      <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>);
<a name="l217"><span class="linenum"> 217</span></a>                  }
<a name="l218"><span class="linenum"> 218</span></a>              }
<a name="l219"><span class="linenum"> 219</span></a>          }
<a name="l220"><span class="linenum"> 220</span></a>      }
<a name="l221"><span class="linenum"> 221</span></a>  
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment">    // Delete any leftover events.</span>
<a name="l223"><span class="linenum"> 223</span></a>      foreach (<a class="var it9822" onMouseOver="hilite(9822)" onMouseOut="lolite()" onClick="logVariable('oldevents')" href="../../_variables/oldevents.html">$oldevents</a> as <a class="var it9826" onMouseOver="hilite(9826)" onMouseOut="lolite()" onClick="logVariable('badevent')" href="../../_variables/badevent.html">$badevent</a>) {
<a name="l224"><span class="linenum"> 224</span></a>          <a class="var it9826" onMouseOver="hilite(9826)" onMouseOut="lolite()" onClick="logVariable('badevent')" href="../../_variables/badevent.html">$badevent</a> = <a class="class" onClick="logClass('calendar_event')" href="../../_classes/calendar_event.html" onMouseOver="classPopup(event,'calendar_event')">calendar_event</a>::<a class="function" onClick="logFunction('load')" href="../../_functions/load.html" onMouseOver="funcPopup(event,'load')">load</a>(<a class="var it9826" onMouseOver="hilite(9826)" onMouseOut="lolite()" onClick="logVariable('badevent')" href="../../_variables/badevent.html">$badevent</a>);
<a name="l225"><span class="linenum"> 225</span></a>          <a class="var it9826" onMouseOver="hilite(9826)" onMouseOut="lolite()" onClick="logVariable('badevent')" href="../../_variables/badevent.html">$badevent</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l226"><span class="linenum"> 226</span></a>      }
<a name="l227"><span class="linenum"> 227</span></a>  }
<a name="l228"><span class="linenum"> 228</span></a>  
<a name="l229"><span class="linenum"> 229</span></a>  <span class="comment">/**</span>
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment"> * This standard function will check all instances of this module</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment"> * and make sure there are up-to-date events created for each of them.</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment"> * If courseid = 0, then every lesson event in the site is checked, else</span>
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment"> * only lesson events belonging to the course specified are checked.</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment"> * This function is used, in its new format, by restore_refresh_events()</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment"> *</span>
<a name="l236"><span class="linenum"> 236</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment"> * @return bool</span>
<a name="l238"><span class="linenum"> 238</span></a>  <span class="comment"> */</span>
<a name="l239"><span class="linenum"> 239</span></a>  function <a class="function" onClick="logFunction('lesson_refresh_events')" href="../../_functions/lesson_refresh_events.html" onMouseOver="funcPopup(event,'lesson_refresh_events')">lesson_refresh_events</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = 0) {
<a name="l240"><span class="linenum"> 240</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l241"><span class="linenum"> 241</span></a>  
<a name="l242"><span class="linenum"> 242</span></a>      if (<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> == 0) {
<a name="l243"><span class="linenum"> 243</span></a>          if (!<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('lessons')) {
<a name="l244"><span class="linenum"> 244</span></a>              return true;
<a name="l245"><span class="linenum"> 245</span></a>          }
<a name="l246"><span class="linenum"> 246</span></a>      } else {
<a name="l247"><span class="linenum"> 247</span></a>          if (!<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('lesson', array('course' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>))) {
<a name="l248"><span class="linenum"> 248</span></a>              return true;
<a name="l249"><span class="linenum"> 249</span></a>          }
<a name="l250"><span class="linenum"> 250</span></a>      }
<a name="l251"><span class="linenum"> 251</span></a>  
<a name="l252"><span class="linenum"> 252</span></a>      foreach (<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l253"><span class="linenum"> 253</span></a>          <a class="function" onClick="logFunction('lesson_update_events')" href="../../_functions/lesson_update_events.html" onMouseOver="funcPopup(event,'lesson_update_events')">lesson_update_events</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l254"><span class="linenum"> 254</span></a>      }
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>      return true;
<a name="l257"><span class="linenum"> 257</span></a>  }
<a name="l258"><span class="linenum"> 258</span></a>  
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment">/**</span>
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment"> * Given an ID of an instance of this module,</span>
<a name="l261"><span class="linenum"> 261</span></a>  <span class="comment"> * this function will permanently delete the instance</span>
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment"> * and any data that depends on it.</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment"> *</span>
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment"> * @global object</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment"> * @param int $id</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment"> * @return bool</span>
<a name="l267"><span class="linenum"> 267</span></a>  <span class="comment"> */</span>
<a name="l268"><span class="linenum"> 268</span></a>  function <a class="function" onClick="logFunction('lesson_delete_instance')" href="../../_functions/lesson_delete_instance.html" onMouseOver="funcPopup(event,'lesson_delete_instance')">lesson_delete_instance</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l269"><span class="linenum"> 269</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l270"><span class="linenum"> 270</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../mod/lesson/locallib.php.html">/mod/lesson/locallib.php</a>');
<a name="l271"><span class="linenum"> 271</span></a>  
<a name="l272"><span class="linenum"> 272</span></a>      <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(&quot;lesson&quot;, array(&quot;id&quot;=&gt;<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l273"><span class="linenum"> 273</span></a>      <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a> = <span class="keyword">new </span><a class="class" onClick="logClass('lesson')" href="../../_classes/lesson.html" onMouseOver="classPopup(event,'lesson')">lesson</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l274"><span class="linenum"> 274</span></a>      return <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l275"><span class="linenum"> 275</span></a>  }
<a name="l276"><span class="linenum"> 276</span></a>  
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment">/**</span>
<a name="l278"><span class="linenum"> 278</span></a>  <span class="comment"> * Return a small object with summary information about what a</span>
<a name="l279"><span class="linenum"> 279</span></a>  <span class="comment"> * user has done with a given particular instance of this module</span>
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment"> * Used for user activity reports.</span>
<a name="l281"><span class="linenum"> 281</span></a>  <span class="comment"> * $return-&gt;time = the time they did it</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment"> * $return-&gt;info = a short text description</span>
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment"> *</span>
<a name="l284"><span class="linenum"> 284</span></a>  <span class="comment"> * @global object</span>
<a name="l285"><span class="linenum"> 285</span></a>  <span class="comment"> * @param object $course</span>
<a name="l286"><span class="linenum"> 286</span></a>  <span class="comment"> * @param object $user</span>
<a name="l287"><span class="linenum"> 287</span></a>  <span class="comment"> * @param object $mod</span>
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment"> * @param object $lesson</span>
<a name="l289"><span class="linenum"> 289</span></a>  <span class="comment"> * @return object</span>
<a name="l290"><span class="linenum"> 290</span></a>  <span class="comment"> */</span>
<a name="l291"><span class="linenum"> 291</span></a>  function <a class="function" onClick="logFunction('lesson_user_outline')" href="../../_functions/lesson_user_outline.html" onMouseOver="funcPopup(event,'lesson_user_outline')">lesson_user_outline</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>, <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l292"><span class="linenum"> 292</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l293"><span class="linenum"> 293</span></a>  
<a name="l294"><span class="linenum"> 294</span></a>      require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>/gradelib.php&quot;);
<a name="l295"><span class="linenum"> 295</span></a>      <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="function" onClick="logFunction('grade_get_grades')" href="../../_functions/grade_get_grades.html" onMouseOver="funcPopup(event,'grade_get_grades')">grade_get_grades</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod', 'lesson', <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l296"><span class="linenum"> 296</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = new stdClass();
<a name="l297"><span class="linenum"> 297</span></a>  
<a name="l298"><span class="linenum"> 298</span></a>      if (empty(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it43825" onMouseOver="hilite(43825)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades)) {
<a name="l299"><span class="linenum"> 299</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('info')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;nolessonattempts&quot;, &quot;lesson&quot;);
<a name="l300"><span class="linenum"> 300</span></a>      } else {
<a name="l301"><span class="linenum"> 301</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it43825" onMouseOver="hilite(43825)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades);
<a name="l302"><span class="linenum"> 302</span></a>          if (empty(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a>)) {
<a name="l303"><span class="linenum"> 303</span></a>  
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment">            // Check to see if it an ungraded / incomplete attempt.</span>
<a name="l305"><span class="linenum"> 305</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l306"><span class="linenum"> 306</span></a>                        FROM {lesson_timer}
<a name="l307"><span class="linenum"> 307</span></a>                       WHERE lessonid = :lessonid
<a name="l308"><span class="linenum"> 308</span></a>                         AND userid = :userid
<a name="l309"><span class="linenum"> 309</span></a>                    ORDER BY starttime DESC&quot;;
<a name="l310"><span class="linenum"> 310</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('lessonid' =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l311"><span class="linenum"> 311</span></a>  
<a name="l312"><span class="linenum"> 312</span></a>              if (<a class="var it744" onMouseOver="hilite(744)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, 0, 1)) {
<a name="l313"><span class="linenum"> 313</span></a>                  <a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it744" onMouseOver="hilite(744)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a>);
<a name="l314"><span class="linenum"> 314</span></a>                  if (<a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('completed')" class="var it43015" onMouseOver="hilite(43015)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a>) {
<a name="l315"><span class="linenum"> 315</span></a>                      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('info')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;completed&quot;, &quot;lesson&quot;);
<a name="l316"><span class="linenum"> 316</span></a>                  } else {
<a name="l317"><span class="linenum"> 317</span></a>                      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('info')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;notyetcompleted&quot;, &quot;lesson&quot;);
<a name="l318"><span class="linenum"> 318</span></a>                  }
<a name="l319"><span class="linenum"> 319</span></a>                  <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('time')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/time.html">time</a> = <a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('lessontime')" class="var it43015" onMouseOver="hilite(43015)" onMouseOut="lolite()" href="../../_variables/lessontime.html">lessontime</a>;
<a name="l320"><span class="linenum"> 320</span></a>              } else {
<a name="l321"><span class="linenum"> 321</span></a>                  <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('info')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;nolessonattempts&quot;, &quot;lesson&quot;);
<a name="l322"><span class="linenum"> 322</span></a>              }
<a name="l323"><span class="linenum"> 323</span></a>          } else {
<a name="l324"><span class="linenum"> 324</span></a>              <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('info')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/info.html">info</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;grade&quot;) . ': ' . <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_long_grade')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/str_long_grade.html">str_long_grade</a>;
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>  <span class="comment">            // Datesubmitted == time created. dategraded == time modified or time overridden.</span>
<a name="l327"><span class="linenum"> 327</span></a>  <span class="comment">            // If grade was last modified by the user themselves use date graded. Otherwise use date submitted.</span>
<a name="l328"><span class="linenum"> 328</span></a>  <span class="comment">            // TODO: move this copied &amp; pasted code somewhere in the grades API. See MDL-26704.</span>
<a name="l329"><span class="linenum"> 329</span></a>              if (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('usermodified')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> == <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> || empty(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('datesubmitted')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/datesubmitted.html">datesubmitted</a>)) {
<a name="l330"><span class="linenum"> 330</span></a>                  <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('time')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/time.html">time</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('dategraded')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/dategraded.html">dategraded</a>;
<a name="l331"><span class="linenum"> 331</span></a>              } else {
<a name="l332"><span class="linenum"> 332</span></a>                  <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('time')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/time.html">time</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('datesubmitted')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/datesubmitted.html">datesubmitted</a>;
<a name="l333"><span class="linenum"> 333</span></a>              }
<a name="l334"><span class="linenum"> 334</span></a>          }
<a name="l335"><span class="linenum"> 335</span></a>      }
<a name="l336"><span class="linenum"> 336</span></a>      return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l337"><span class="linenum"> 337</span></a>  }
<a name="l338"><span class="linenum"> 338</span></a>  
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment">/**</span>
<a name="l340"><span class="linenum"> 340</span></a>  <span class="comment"> * Print a detailed representation of what a  user has done with</span>
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment"> * a given particular instance of this module, for user activity reports.</span>
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment"> *</span>
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment"> * @global object</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment"> * @param object $course</span>
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment"> * @param object $user</span>
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment"> * @param object $mod</span>
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment"> * @param object $lesson</span>
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment"> * @return bool</span>
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment"> */</span>
<a name="l350"><span class="linenum"> 350</span></a>  function <a class="function" onClick="logFunction('lesson_user_complete')" href="../../_functions/lesson_user_complete.html" onMouseOver="funcPopup(event,'lesson_user_complete')">lesson_user_complete</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it2586" onMouseOver="hilite(2586)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../../_variables/mod.html">$mod</a>, <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l351"><span class="linenum"> 351</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l352"><span class="linenum"> 352</span></a>  
<a name="l353"><span class="linenum"> 353</span></a>      require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>/gradelib.php&quot;);
<a name="l354"><span class="linenum"> 354</span></a>  
<a name="l355"><span class="linenum"> 355</span></a>      <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="function" onClick="logFunction('grade_get_grades')" href="../../_functions/grade_get_grades.html" onMouseOver="funcPopup(event,'grade_get_grades')">grade_get_grades</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod', 'lesson', <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l356"><span class="linenum"> 356</span></a>  
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment">    // Display the grade and feedback.</span>
<a name="l358"><span class="linenum"> 358</span></a>      if (empty(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it43825" onMouseOver="hilite(43825)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades)) {
<a name="l359"><span class="linenum"> 359</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('container')" href="../../_functions/container.html" onMouseOver="funcPopup(event,'container')">container</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;nolessonattempts&quot;, &quot;lesson&quot;));
<a name="l360"><span class="linenum"> 360</span></a>      } else {
<a name="l361"><span class="linenum"> 361</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('items')" class="var it43825" onMouseOver="hilite(43825)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>[0]-&gt;grades);
<a name="l362"><span class="linenum"> 362</span></a>          if (empty(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a>)) {
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment">            // Check to see if it an ungraded / incomplete attempt.</span>
<a name="l364"><span class="linenum"> 364</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l365"><span class="linenum"> 365</span></a>                        FROM {lesson_timer}
<a name="l366"><span class="linenum"> 366</span></a>                       WHERE lessonid = :lessonid
<a name="l367"><span class="linenum"> 367</span></a>                         AND userid = :userid
<a name="l368"><span class="linenum"> 368</span></a>                       ORDER by starttime desc&quot;;
<a name="l369"><span class="linenum"> 369</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('lessonid' =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l370"><span class="linenum"> 370</span></a>  
<a name="l371"><span class="linenum"> 371</span></a>              if (<a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="constant" onClick="logConstant('IGNORE_MULTIPLE')" href="../../_constants/IGNORE_MULTIPLE.html" onMouseOver="constPopup(event,'IGNORE_MULTIPLE')">IGNORE_MULTIPLE</a>)) {
<a name="l372"><span class="linenum"> 372</span></a>                  if (<a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('completed')" class="var it43015" onMouseOver="hilite(43015)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a>) {
<a name="l373"><span class="linenum"> 373</span></a>                      <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;completed&quot;, &quot;lesson&quot;);
<a name="l374"><span class="linenum"> 374</span></a>                  } else {
<a name="l375"><span class="linenum"> 375</span></a>                      <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;notyetcompleted&quot;, &quot;lesson&quot;);
<a name="l376"><span class="linenum"> 376</span></a>                  }
<a name="l377"><span class="linenum"> 377</span></a>              } else {
<a name="l378"><span class="linenum"> 378</span></a>                  <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;nolessonattempts&quot;, &quot;lesson&quot;);
<a name="l379"><span class="linenum"> 379</span></a>              }
<a name="l380"><span class="linenum"> 380</span></a>          } else {
<a name="l381"><span class="linenum"> 381</span></a>              <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;grade&quot;) . ': ' . <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_long_grade')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/str_long_grade.html">str_long_grade</a>;
<a name="l382"><span class="linenum"> 382</span></a>          }
<a name="l383"><span class="linenum"> 383</span></a>  
<a name="l384"><span class="linenum"> 384</span></a>  <span class="comment">        // Display the grade or lesson status if there isn't one.</span>
<a name="l385"><span class="linenum"> 385</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('container')" href="../../_functions/container.html" onMouseOver="funcPopup(event,'container')">container</a>(<a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>);
<a name="l386"><span class="linenum"> 386</span></a>  
<a name="l387"><span class="linenum"> 387</span></a>          if (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_feedback')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/str_feedback.html">str_feedback</a>) {
<a name="l388"><span class="linenum"> 388</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('container')" href="../../_functions/container.html" onMouseOver="funcPopup(event,'container')">container</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('feedback').': '.<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('str_feedback')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/str_feedback.html">str_feedback</a>);
<a name="l389"><span class="linenum"> 389</span></a>          }
<a name="l390"><span class="linenum"> 390</span></a>      }
<a name="l391"><span class="linenum"> 391</span></a>  
<a name="l392"><span class="linenum"> 392</span></a>  <span class="comment">    // Display the lesson progress.</span>
<a name="l393"><span class="linenum"> 393</span></a>  <span class="comment">    // Attempt, pages viewed, questions answered, correct answers, time.</span>
<a name="l394"><span class="linenum"> 394</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array (&quot;lessonid&quot; =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, &quot;userid&quot; =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l395"><span class="linenum"> 395</span></a>      <a class="var it744" onMouseOver="hilite(744)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(&quot;lesson_attempts&quot;, &quot;lessonid = :lessonid AND userid = :userid&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, &quot;retry, timeseen&quot;);
<a name="l396"><span class="linenum"> 396</span></a>      <a class="var it14956" onMouseOver="hilite(14956)" onMouseOut="lolite()" onClick="logVariable('branches')" href="../../_variables/branches.html">$branches</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(&quot;lesson_branch&quot;, &quot;lessonid = :lessonid AND userid = :userid&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, &quot;retry, timeseen&quot;);
<a name="l397"><span class="linenum"> 397</span></a>      if (!empty(<a class="var it744" onMouseOver="hilite(744)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a>) or !empty(<a class="var it14956" onMouseOver="hilite(14956)" onMouseOut="lolite()" onClick="logVariable('branches')" href="../../_variables/branches.html">$branches</a>)) {
<a name="l398"><span class="linenum"> 398</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_start')" href="../../_functions/box_start.html" onMouseOver="funcPopup(event,'box_start')">box_start</a>();
<a name="l399"><span class="linenum"> 399</span></a>          <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('html_table')" href="../../_classes/html_table.html" onMouseOver="classPopup(event,'html_table')">html_table</a>();
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment">        // Table Headings.</span>
<a name="l401"><span class="linenum"> 401</span></a>          <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('head')" class="var it42921" onMouseOver="hilite(42921)" onMouseOut="lolite()" href="../../_variables/head.html">head</a> = array (<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;attemptheader&quot;, &quot;lesson&quot;),
<a name="l402"><span class="linenum"> 402</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;totalpagesviewedheader&quot;, &quot;lesson&quot;),
<a name="l403"><span class="linenum"> 403</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;numberofpagesviewedheader&quot;, &quot;lesson&quot;),
<a name="l404"><span class="linenum"> 404</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;numberofcorrectanswersheader&quot;, &quot;lesson&quot;),
<a name="l405"><span class="linenum"> 405</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;time&quot;));
<a name="l406"><span class="linenum"> 406</span></a>          <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('width')" class="var it42921" onMouseOver="hilite(42921)" onMouseOut="lolite()" href="../../_variables/width.html">width</a> = &quot;100%&quot;;
<a name="l407"><span class="linenum"> 407</span></a>          <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('align')" class="var it42921" onMouseOver="hilite(42921)" onMouseOut="lolite()" href="../../_variables/align.html">align</a> = array (&quot;center&quot;, &quot;center&quot;, &quot;center&quot;, &quot;center&quot;, &quot;center&quot;);
<a name="l408"><span class="linenum"> 408</span></a>          <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('size')" class="var it42921" onMouseOver="hilite(42921)" onMouseOut="lolite()" href="../../_variables/size.html">size</a> = array (&quot;*&quot;, &quot;*&quot;, &quot;*&quot;, &quot;*&quot;, &quot;*&quot;);
<a name="l409"><span class="linenum"> 409</span></a>          <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('cellpadding')" class="var it42921" onMouseOver="hilite(42921)" onMouseOut="lolite()" href="../../_variables/cellpadding.html">cellpadding</a> = 2;
<a name="l410"><span class="linenum"> 410</span></a>          <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('cellspacing')" class="var it42921" onMouseOver="hilite(42921)" onMouseOut="lolite()" href="../../_variables/cellspacing.html">cellspacing</a> = 0;
<a name="l411"><span class="linenum"> 411</span></a>  
<a name="l412"><span class="linenum"> 412</span></a>          <a class="var it1236" onMouseOver="hilite(1236)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a> = 0;
<a name="l413"><span class="linenum"> 413</span></a>          <a class="var it1260" onMouseOver="hilite(1260)" onMouseOut="lolite()" onClick="logVariable('nquestions')" href="../../_variables/nquestions.html">$nquestions</a> = 0;
<a name="l414"><span class="linenum"> 414</span></a>          <a class="var it26002" onMouseOver="hilite(26002)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a> = 0;
<a name="l415"><span class="linenum"> 415</span></a>          <a class="var it19259" onMouseOver="hilite(19259)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a> = 0;
<a name="l416"><span class="linenum"> 416</span></a>  
<a name="l417"><span class="linenum"> 417</span></a>  <span class="comment">        // Filter question pages (from lesson_attempts).</span>
<a name="l418"><span class="linenum"> 418</span></a>          foreach (<a class="var it744" onMouseOver="hilite(744)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a> as <a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>) {
<a name="l419"><span class="linenum"> 419</span></a>              if (<a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('retry')" class="var it43015" onMouseOver="hilite(43015)" onMouseOut="lolite()" href="../../_variables/retry.html">retry</a> == <a class="var it1236" onMouseOver="hilite(1236)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a>) {
<a name="l420"><span class="linenum"> 420</span></a>                  <a class="var it26002" onMouseOver="hilite(26002)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a>++;
<a name="l421"><span class="linenum"> 421</span></a>                  <a class="var it1260" onMouseOver="hilite(1260)" onMouseOut="lolite()" onClick="logVariable('nquestions')" href="../../_variables/nquestions.html">$nquestions</a>++;
<a name="l422"><span class="linenum"> 422</span></a>                  if (<a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('correct')" class="var it43015" onMouseOver="hilite(43015)" onMouseOut="lolite()" href="../../_variables/correct.html">correct</a>) {
<a name="l423"><span class="linenum"> 423</span></a>                      <a class="var it19259" onMouseOver="hilite(19259)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a>++;
<a name="l424"><span class="linenum"> 424</span></a>                  }
<a name="l425"><span class="linenum"> 425</span></a>                  <a class="var it1242" onMouseOver="hilite(1242)" onMouseOut="lolite()" onClick="logVariable('timeseen')" href="../../_variables/timeseen.html">$timeseen</a> = <a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('timeseen')" class="var it43015" onMouseOver="hilite(43015)" onMouseOut="lolite()" href="../../_variables/timeseen.html">timeseen</a>;
<a name="l426"><span class="linenum"> 426</span></a>              } else {
<a name="l427"><span class="linenum"> 427</span></a>                  <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('data')" class="var it42921" onMouseOver="hilite(42921)" onMouseOut="lolite()" href="../../_variables/data.html">data</a>[] = array(<a class="var it1236" onMouseOver="hilite(1236)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a> + 1, <a class="var it26002" onMouseOver="hilite(26002)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a>, <a class="var it1260" onMouseOver="hilite(1260)" onMouseOut="lolite()" onClick="logVariable('nquestions')" href="../../_variables/nquestions.html">$nquestions</a>, <a class="var it19259" onMouseOver="hilite(19259)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a>, <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it1242" onMouseOver="hilite(1242)" onMouseOut="lolite()" onClick="logVariable('timeseen')" href="../../_variables/timeseen.html">$timeseen</a>));
<a name="l428"><span class="linenum"> 428</span></a>                  <a class="var it1236" onMouseOver="hilite(1236)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a>++;
<a name="l429"><span class="linenum"> 429</span></a>                  <a class="var it1260" onMouseOver="hilite(1260)" onMouseOut="lolite()" onClick="logVariable('nquestions')" href="../../_variables/nquestions.html">$nquestions</a> = 1;
<a name="l430"><span class="linenum"> 430</span></a>                  <a class="var it26002" onMouseOver="hilite(26002)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a> = 1;
<a name="l431"><span class="linenum"> 431</span></a>                  if (<a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a>-&gt;<a onClick="logVariable('correct')" class="var it43015" onMouseOver="hilite(43015)" onMouseOut="lolite()" href="../../_variables/correct.html">correct</a>) {
<a name="l432"><span class="linenum"> 432</span></a>                      <a class="var it19259" onMouseOver="hilite(19259)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a> = 1;
<a name="l433"><span class="linenum"> 433</span></a>                  } else {
<a name="l434"><span class="linenum"> 434</span></a>                      <a class="var it19259" onMouseOver="hilite(19259)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a> = 0;
<a name="l435"><span class="linenum"> 435</span></a>                  }
<a name="l436"><span class="linenum"> 436</span></a>              }
<a name="l437"><span class="linenum"> 437</span></a>          }
<a name="l438"><span class="linenum"> 438</span></a>  
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">        // Filter content pages (from lesson_branch).</span>
<a name="l440"><span class="linenum"> 440</span></a>          foreach (<a class="var it14956" onMouseOver="hilite(14956)" onMouseOut="lolite()" onClick="logVariable('branches')" href="../../_variables/branches.html">$branches</a> as <a class="var it5093" onMouseOver="hilite(5093)" onMouseOut="lolite()" onClick="logVariable('branch')" href="../../_variables/branch.html">$branch</a>) {
<a name="l441"><span class="linenum"> 441</span></a>              if (<a class="var it5093" onMouseOver="hilite(5093)" onMouseOut="lolite()" onClick="logVariable('branch')" href="../../_variables/branch.html">$branch</a>-&gt;<a onClick="logVariable('retry')" class="var it44771" onMouseOver="hilite(44771)" onMouseOut="lolite()" href="../../_variables/retry.html">retry</a> == <a class="var it1236" onMouseOver="hilite(1236)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a>) {
<a name="l442"><span class="linenum"> 442</span></a>                  <a class="var it26002" onMouseOver="hilite(26002)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a>++;
<a name="l443"><span class="linenum"> 443</span></a>  
<a name="l444"><span class="linenum"> 444</span></a>                  <a class="var it1242" onMouseOver="hilite(1242)" onMouseOut="lolite()" onClick="logVariable('timeseen')" href="../../_variables/timeseen.html">$timeseen</a> = <a class="var it5093" onMouseOver="hilite(5093)" onMouseOut="lolite()" onClick="logVariable('branch')" href="../../_variables/branch.html">$branch</a>-&gt;<a onClick="logVariable('timeseen')" class="var it44771" onMouseOver="hilite(44771)" onMouseOut="lolite()" href="../../_variables/timeseen.html">timeseen</a>;
<a name="l445"><span class="linenum"> 445</span></a>              } else {
<a name="l446"><span class="linenum"> 446</span></a>                  <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('data')" class="var it42921" onMouseOver="hilite(42921)" onMouseOut="lolite()" href="../../_variables/data.html">data</a>[] = array(<a class="var it1236" onMouseOver="hilite(1236)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a> + 1, <a class="var it26002" onMouseOver="hilite(26002)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a>, <a class="var it1260" onMouseOver="hilite(1260)" onMouseOut="lolite()" onClick="logVariable('nquestions')" href="../../_variables/nquestions.html">$nquestions</a>, <a class="var it19259" onMouseOver="hilite(19259)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a>, <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it1242" onMouseOver="hilite(1242)" onMouseOut="lolite()" onClick="logVariable('timeseen')" href="../../_variables/timeseen.html">$timeseen</a>));
<a name="l447"><span class="linenum"> 447</span></a>                  <a class="var it1236" onMouseOver="hilite(1236)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a>++;
<a name="l448"><span class="linenum"> 448</span></a>                  <a class="var it26002" onMouseOver="hilite(26002)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a> = 1;
<a name="l449"><span class="linenum"> 449</span></a>              }
<a name="l450"><span class="linenum"> 450</span></a>          }
<a name="l451"><span class="linenum"> 451</span></a>          if (<a class="var it26002" onMouseOver="hilite(26002)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a> &gt; 0) {
<a name="l452"><span class="linenum"> 452</span></a>                  <a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a onClick="logVariable('data')" class="var it42921" onMouseOver="hilite(42921)" onMouseOut="lolite()" href="../../_variables/data.html">data</a>[] = array(<a class="var it1236" onMouseOver="hilite(1236)" onMouseOut="lolite()" onClick="logVariable('retry')" href="../../_variables/retry.html">$retry</a> + 1, <a class="var it26002" onMouseOver="hilite(26002)" onMouseOut="lolite()" onClick="logVariable('npages')" href="../../_variables/npages.html">$npages</a>, <a class="var it1260" onMouseOver="hilite(1260)" onMouseOut="lolite()" onClick="logVariable('nquestions')" href="../../_variables/nquestions.html">$nquestions</a>, <a class="var it19259" onMouseOver="hilite(19259)" onMouseOut="lolite()" onClick="logVariable('ncorrect')" href="../../_variables/ncorrect.html">$ncorrect</a>, <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it1242" onMouseOver="hilite(1242)" onMouseOut="lolite()" onClick="logVariable('timeseen')" href="../../_variables/timeseen.html">$timeseen</a>));
<a name="l453"><span class="linenum"> 453</span></a>          }
<a name="l454"><span class="linenum"> 454</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('table')" href="../../_functions/table.html" onMouseOver="funcPopup(event,'table')">table</a>(<a class="var it61" onMouseOver="hilite(61)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l455"><span class="linenum"> 455</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_end')" href="../../_functions/box_end.html" onMouseOver="funcPopup(event,'box_end')">box_end</a>();
<a name="l456"><span class="linenum"> 456</span></a>      }
<a name="l457"><span class="linenum"> 457</span></a>  
<a name="l458"><span class="linenum"> 458</span></a>      return true;
<a name="l459"><span class="linenum"> 459</span></a>  }
<a name="l460"><span class="linenum"> 460</span></a>  
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">/**</span>
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment"> * Prints lesson summaries on MyMoodle Page</span>
<a name="l463"><span class="linenum"> 463</span></a>  <span class="comment"> *</span>
<a name="l464"><span class="linenum"> 464</span></a>  <span class="comment"> * Prints lesson name, due date and attempt information on</span>
<a name="l465"><span class="linenum"> 465</span></a>  <span class="comment"> * lessons that have a deadline that has not already passed</span>
<a name="l466"><span class="linenum"> 466</span></a>  <span class="comment"> * and it is available for taking.</span>
<a name="l467"><span class="linenum"> 467</span></a>  <span class="comment"> *</span>
<a name="l468"><span class="linenum"> 468</span></a>  <span class="comment"> * @global object</span>
<a name="l469"><span class="linenum"> 469</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l470"><span class="linenum"> 470</span></a>  <span class="comment"> * @global object</span>
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment"> * @uses CONTEXT_MODULE</span>
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment"> * @param array $courses An array of course objects to get lesson instances from</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment"> * @param array $htmlarray Store overview output array( course ID =&gt; 'lesson' =&gt; HTML output )</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment"> * @return void</span>
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment"> */</span>
<a name="l476"><span class="linenum"> 476</span></a>  function <a class="function" onClick="logFunction('lesson_print_overview')" href="../../_functions/lesson_print_overview.html" onMouseOver="funcPopup(event,'lesson_print_overview')">lesson_print_overview</a>(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>, &amp;<a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>) {
<a name="l477"><span class="linenum"> 477</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l478"><span class="linenum"> 478</span></a>  
<a name="l479"><span class="linenum"> 479</span></a>      if (!<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="function" onClick="logFunction('get_all_instances_in_courses')" href="../../_functions/get_all_instances_in_courses.html" onMouseOver="funcPopup(event,'get_all_instances_in_courses')">get_all_instances_in_courses</a>('lesson', <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>)) {
<a name="l480"><span class="linenum"> 480</span></a>          return;
<a name="l481"><span class="linenum"> 481</span></a>      }
<a name="l482"><span class="linenum"> 482</span></a>  
<a name="l483"><span class="linenum"> 483</span></a>  <span class="comment">    // Get all of the current users attempts on all lessons.</span>
<a name="l484"><span class="linenum"> 484</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l485"><span class="linenum"> 485</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT lessonid, userid, <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(userid) as attempts
<a name="l486"><span class="linenum"> 486</span></a>                FROM {lesson_grades}
<a name="l487"><span class="linenum"> 487</span></a>               WHERE userid = ?
<a name="l488"><span class="linenum"> 488</span></a>            GROUP BY lessonid, userid';
<a name="l489"><span class="linenum"> 489</span></a>      <a class="var it1231" onMouseOver="hilite(1231)" onMouseOut="lolite()" onClick="logVariable('allattempts')" href="../../_variables/allattempts.html">$allattempts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l490"><span class="linenum"> 490</span></a>      <a class="var it26003" onMouseOver="hilite(26003)" onMouseOut="lolite()" onClick="logVariable('completedattempts')" href="../../_variables/completedattempts.html">$completedattempts</a> = array();
<a name="l491"><span class="linenum"> 491</span></a>      foreach (<a class="var it1231" onMouseOver="hilite(1231)" onMouseOut="lolite()" onClick="logVariable('allattempts')" href="../../_variables/allattempts.html">$allattempts</a> as <a class="var it26004" onMouseOver="hilite(26004)" onMouseOut="lolite()" onClick="logVariable('myattempt')" href="../../_variables/myattempt.html">$myattempt</a>) {
<a name="l492"><span class="linenum"> 492</span></a>          <a class="var it26003" onMouseOver="hilite(26003)" onMouseOut="lolite()" onClick="logVariable('completedattempts')" href="../../_variables/completedattempts.html">$completedattempts</a>[<a class="var it26004" onMouseOver="hilite(26004)" onMouseOut="lolite()" onClick="logVariable('myattempt')" href="../../_variables/myattempt.html">$myattempt</a>-&gt;<a onClick="logVariable('lessonid')" class="var it44772" onMouseOver="hilite(44772)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>] = <a class="var it26004" onMouseOver="hilite(26004)" onMouseOut="lolite()" onClick="logVariable('myattempt')" href="../../_variables/myattempt.html">$myattempt</a>-&gt;<a onClick="logVariable('attempts')" class="var it44772" onMouseOver="hilite(44772)" onMouseOut="lolite()" href="../../_variables/attempts.html">attempts</a>;
<a name="l493"><span class="linenum"> 493</span></a>      }
<a name="l494"><span class="linenum"> 494</span></a>  
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment">    // Get the current course ID.</span>
<a name="l496"><span class="linenum"> 496</span></a>      <a class="var it26005" onMouseOver="hilite(26005)" onMouseOut="lolite()" onClick="logVariable('listoflessons')" href="../../_variables/listoflessons.html">$listoflessons</a> = array();
<a name="l497"><span class="linenum"> 497</span></a>      foreach (<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l498"><span class="linenum"> 498</span></a>          <a class="var it26005" onMouseOver="hilite(26005)" onMouseOut="lolite()" onClick="logVariable('listoflessons')" href="../../_variables/listoflessons.html">$listoflessons</a>[] = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l499"><span class="linenum"> 499</span></a>      }
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">    // Get the last page viewed by the current user for every lesson in this course.</span>
<a name="l501"><span class="linenum"> 501</span></a>      <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it26005" onMouseOver="hilite(26005)" onMouseOut="lolite()" onClick="logVariable('listoflessons')" href="../../_variables/listoflessons.html">$listoflessons</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l502"><span class="linenum"> 502</span></a>      <a class="var it11272" onMouseOver="hilite(11272)" onMouseOut="lolite()" onClick="logVariable('dbparams')" href="../../_variables/dbparams.html">$dbparams</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>, array('userid' =&gt; <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l503"><span class="linenum"> 503</span></a>  
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">    // Get the lesson attempts for the user that have the maximum 'timeseen' value.</span>
<a name="l505"><span class="linenum"> 505</span></a>      <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = &quot;SELECT l.id, l.timeseen, l.lessonid, l.userid, l.retry, l.pageid, l.answerid as nextpageid, p.qtype &quot;;
<a name="l506"><span class="linenum"> 506</span></a>      <a class="var it114" onMouseOver="hilite(114)" onMouseOut="lolite()" onClick="logVariable('from')" href="../../_variables/from.html">$from</a> = &quot;FROM {lesson_attempts} l
<a name="l507"><span class="linenum"> 507</span></a>               <a class="function" onClick="logFunction('JOIN')" href="../../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (
<a name="l508"><span class="linenum"> 508</span></a>                     SELECT idselect.lessonid, idselect.userid, <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(idselect.id) AS id
<a name="l509"><span class="linenum"> 509</span></a>                       FROM {lesson_attempts} idselect
<a name="l510"><span class="linenum"> 510</span></a>                       <a class="function" onClick="logFunction('JOIN')" href="../../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (
<a name="l511"><span class="linenum"> 511</span></a>                             SELECT lessonid, userid, <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(timeseen) AS timeseen
<a name="l512"><span class="linenum"> 512</span></a>                               FROM {lesson_attempts}
<a name="l513"><span class="linenum"> 513</span></a>                              WHERE userid = :userid
<a name="l514"><span class="linenum"> 514</span></a>                                AND lessonid <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>
<a name="l515"><span class="linenum"> 515</span></a>                           GROUP BY userid, lessonid
<a name="l516"><span class="linenum"> 516</span></a>                             ) timeselect
<a name="l517"><span class="linenum"> 517</span></a>                         ON timeselect.timeseen = idselect.timeseen
<a name="l518"><span class="linenum"> 518</span></a>                        AND timeselect.userid = idselect.userid
<a name="l519"><span class="linenum"> 519</span></a>                        AND timeselect.lessonid = idselect.lessonid
<a name="l520"><span class="linenum"> 520</span></a>                   GROUP BY idselect.userid, idselect.lessonid
<a name="l521"><span class="linenum"> 521</span></a>                     ) aid
<a name="l522"><span class="linenum"> 522</span></a>                 ON l.id = aid.id
<a name="l523"><span class="linenum"> 523</span></a>               JOIN {lesson_pages} p
<a name="l524"><span class="linenum"> 524</span></a>                 ON l.pageid = p.id &quot;;
<a name="l525"><span class="linenum"> 525</span></a>      <a class="var it26006" onMouseOver="hilite(26006)" onMouseOut="lolite()" onClick="logVariable('lastattempts')" href="../../_variables/lastattempts.html">$lastattempts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> . <a class="var it114" onMouseOver="hilite(114)" onMouseOut="lolite()" onClick="logVariable('from')" href="../../_variables/from.html">$from</a>, <a class="var it11272" onMouseOver="hilite(11272)" onMouseOut="lolite()" onClick="logVariable('dbparams')" href="../../_variables/dbparams.html">$dbparams</a>);
<a name="l526"><span class="linenum"> 526</span></a>  
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment">    // Now, get the lesson branches for the user that have the maximum 'timeseen' value.</span>
<a name="l528"><span class="linenum"> 528</span></a>      <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = &quot;SELECT l.id, l.timeseen, l.lessonid, l.userid, l.retry, l.pageid, l.nextpageid, p.qtype &quot;;
<a name="l529"><span class="linenum"> 529</span></a>      <a class="var it114" onMouseOver="hilite(114)" onMouseOut="lolite()" onClick="logVariable('from')" href="../../_variables/from.html">$from</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('{lesson_attempts}', '{lesson_branch}', <a class="var it114" onMouseOver="hilite(114)" onMouseOut="lolite()" onClick="logVariable('from')" href="../../_variables/from.html">$from</a>);
<a name="l530"><span class="linenum"> 530</span></a>      <a class="var it26007" onMouseOver="hilite(26007)" onMouseOut="lolite()" onClick="logVariable('lastbranches')" href="../../_variables/lastbranches.html">$lastbranches</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> . <a class="var it114" onMouseOver="hilite(114)" onMouseOut="lolite()" onClick="logVariable('from')" href="../../_variables/from.html">$from</a>, <a class="var it11272" onMouseOver="hilite(11272)" onMouseOut="lolite()" onClick="logVariable('dbparams')" href="../../_variables/dbparams.html">$dbparams</a>);
<a name="l531"><span class="linenum"> 531</span></a>  
<a name="l532"><span class="linenum"> 532</span></a>      <a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a> = array();
<a name="l533"><span class="linenum"> 533</span></a>      foreach (<a class="var it26006" onMouseOver="hilite(26006)" onMouseOut="lolite()" onClick="logVariable('lastattempts')" href="../../_variables/lastattempts.html">$lastattempts</a> as <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>) {
<a name="l534"><span class="linenum"> 534</span></a>          <a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>-&gt;<a onClick="logVariable('lessonid')" class="var it43541" onMouseOver="hilite(43541)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>] = <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('lastattempt')" href="../../_variables/lastattempt.html">$lastattempt</a>;
<a name="l535"><span class="linenum"> 535</span></a>      }
<a name="l536"><span class="linenum"> 536</span></a>  
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment">    // Go through the branch times and record the 'timeseen' value if it doesn't exist</span>
<a name="l538"><span class="linenum"> 538</span></a>  <span class="comment">    // for the lesson, or replace it if it exceeds the current recorded time.</span>
<a name="l539"><span class="linenum"> 539</span></a>      foreach (<a class="var it26007" onMouseOver="hilite(26007)" onMouseOut="lolite()" onClick="logVariable('lastbranches')" href="../../_variables/lastbranches.html">$lastbranches</a> as <a class="var it26009" onMouseOver="hilite(26009)" onMouseOut="lolite()" onClick="logVariable('lastbranch')" href="../../_variables/lastbranch.html">$lastbranch</a>) {
<a name="l540"><span class="linenum"> 540</span></a>          if (!isset(<a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it26009" onMouseOver="hilite(26009)" onMouseOut="lolite()" onClick="logVariable('lastbranch')" href="../../_variables/lastbranch.html">$lastbranch</a>-&gt;<a onClick="logVariable('lessonid')" class="var it44773" onMouseOver="hilite(44773)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>])) {
<a name="l541"><span class="linenum"> 541</span></a>              <a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it26009" onMouseOver="hilite(26009)" onMouseOut="lolite()" onClick="logVariable('lastbranch')" href="../../_variables/lastbranch.html">$lastbranch</a>-&gt;<a onClick="logVariable('lessonid')" class="var it44773" onMouseOver="hilite(44773)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>] = <a class="var it26009" onMouseOver="hilite(26009)" onMouseOut="lolite()" onClick="logVariable('lastbranch')" href="../../_variables/lastbranch.html">$lastbranch</a>;
<a name="l542"><span class="linenum"> 542</span></a>          } else if (<a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it26009" onMouseOver="hilite(26009)" onMouseOut="lolite()" onClick="logVariable('lastbranch')" href="../../_variables/lastbranch.html">$lastbranch</a>-&gt;<a onClick="logVariable('lessonid')" class="var it44773" onMouseOver="hilite(44773)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>]-&gt;timeseen &lt; <a class="var it26009" onMouseOver="hilite(26009)" onMouseOut="lolite()" onClick="logVariable('lastbranch')" href="../../_variables/lastbranch.html">$lastbranch</a>-&gt;<a onClick="logVariable('timeseen')" class="var it44773" onMouseOver="hilite(44773)" onMouseOut="lolite()" href="../../_variables/timeseen.html">timeseen</a>) {
<a name="l543"><span class="linenum"> 543</span></a>              <a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it26009" onMouseOver="hilite(26009)" onMouseOut="lolite()" onClick="logVariable('lastbranch')" href="../../_variables/lastbranch.html">$lastbranch</a>-&gt;<a onClick="logVariable('lessonid')" class="var it44773" onMouseOver="hilite(44773)" onMouseOut="lolite()" href="../../_variables/lessonid.html">lessonid</a>] = <a class="var it26009" onMouseOver="hilite(26009)" onMouseOut="lolite()" onClick="logVariable('lastbranch')" href="../../_variables/lastbranch.html">$lastbranch</a>;
<a name="l544"><span class="linenum"> 544</span></a>          }
<a name="l545"><span class="linenum"> 545</span></a>      }
<a name="l546"><span class="linenum"> 546</span></a>  
<a name="l547"><span class="linenum"> 547</span></a>  <span class="comment">    // Since we have lessons in this course, now include the constants we need.</span>
<a name="l548"><span class="linenum"> 548</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../mod/lesson/locallib.php.html">/mod/lesson/locallib.php</a>');
<a name="l549"><span class="linenum"> 549</span></a>  
<a name="l550"><span class="linenum"> 550</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l551"><span class="linenum"> 551</span></a>      foreach (<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l552"><span class="linenum"> 552</span></a>          if (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('deadline')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a> != 0                                         // The lesson has a deadline
<a name="l553"><span class="linenum"> 553</span></a>              and <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('deadline')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a> &gt;= <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>                                  // And it is before the deadline has been met
<a name="l554"><span class="linenum"> 554</span></a>              and (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('available')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/available.html">available</a> == 0 or <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('available')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/available.html">available</a> &lt;= <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>)) { // And the lesson is available
<a name="l555"><span class="linenum"> 555</span></a>  
<a name="l556"><span class="linenum"> 556</span></a>  <span class="comment">            // Visibility.</span>
<a name="l557"><span class="linenum"> 557</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a> = (!<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('visible')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a>) ? 'dimmed' : '';
<a name="l558"><span class="linenum"> 558</span></a>  
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">            // Context.</span>
<a name="l560"><span class="linenum"> 560</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>);
<a name="l561"><span class="linenum"> 561</span></a>  
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment">            // Link to activity.</span>
<a name="l563"><span class="linenum"> 563</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/view.php.html">/mod/lesson/view.php</a>', array('id' =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/coursemodule.html">coursemodule</a>));
<a name="l564"><span class="linenum"> 564</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>, true, array('context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)), array('class' =&gt; <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a>));
<a name="l565"><span class="linenum"> 565</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lessonname', 'lesson', <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>), 'name');
<a name="l566"><span class="linenum"> 566</span></a>  
<a name="l567"><span class="linenum"> 567</span></a>  <span class="comment">            // Deadline.</span>
<a name="l568"><span class="linenum"> 568</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lessoncloseson', 'lesson', <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('deadline')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/deadline.html">deadline</a>)), 'info');
<a name="l569"><span class="linenum"> 569</span></a>  
<a name="l570"><span class="linenum"> 570</span></a>  <span class="comment">            // Attempt information.</span>
<a name="l571"><span class="linenum"> 571</span></a>              if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:manage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment">                // This is a teacher, Get the Number of user attempts.</span>
<a name="l573"><span class="linenum"> 573</span></a>                  <a class="var it744" onMouseOver="hilite(744)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('lesson_grades', array('lessonid' =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l574"><span class="linenum"> 574</span></a>                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>     .= <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('xattempts', 'lesson', <a class="var it744" onMouseOver="hilite(744)" onMouseOut="lolite()" onClick="logVariable('attempts')" href="../../_variables/attempts.html">$attempts</a>), 'info');
<a name="l575"><span class="linenum"> 575</span></a>                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>      = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l576"><span class="linenum"> 576</span></a>              } else {
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment">                // This is a student, See if the user has at least started the lesson.</span>
<a name="l578"><span class="linenum"> 578</span></a>                  if (isset(<a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;timeseen)) {
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment">                    // See if the user has finished this attempt.</span>
<a name="l580"><span class="linenum"> 580</span></a>                      if (isset(<a class="var it26003" onMouseOver="hilite(26003)" onMouseOut="lolite()" onClick="logVariable('completedattempts')" href="../../_variables/completedattempts.html">$completedattempts</a>[<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]) &amp;&amp;
<a name="l581"><span class="linenum"> 581</span></a>                               (<a class="var it26003" onMouseOver="hilite(26003)" onMouseOut="lolite()" onClick="logVariable('completedattempts')" href="../../_variables/completedattempts.html">$completedattempts</a>[<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] == (<a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;retry + 1))) {
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment">                        // Are additional attempts allowed?</span>
<a name="l583"><span class="linenum"> 583</span></a>                          if (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('retake')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/retake.html">retake</a>) {
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment">                            // User can retake the lesson.</span>
<a name="l585"><span class="linenum"> 585</span></a>                              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('additionalattemptsremaining', 'lesson'), 'info');
<a name="l586"><span class="linenum"> 586</span></a>                              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l587"><span class="linenum"> 587</span></a>                          } else {
<a name="l588"><span class="linenum"> 588</span></a>  <span class="comment">                            // User has completed the lesson and no retakes are allowed.</span>
<a name="l589"><span class="linenum"> 589</span></a>                              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = '';
<a name="l590"><span class="linenum"> 590</span></a>                          }
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>                      } else {
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment">                        // The last attempt was not finished or the lesson does not contain questions.</span>
<a name="l594"><span class="linenum"> 594</span></a>  <span class="comment">                        // See if the last page viewed was a branchtable.</span>
<a name="l595"><span class="linenum"> 595</span></a>                          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../mod/lesson/pagetypes/branchtable.php.html">/mod/lesson/pagetypes/branchtable.php</a>');
<a name="l596"><span class="linenum"> 596</span></a>                          if (<a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;qtype == <a class="constant" onClick="logConstant('LESSON_PAGE_BRANCHTABLE')" href="../../_constants/LESSON_PAGE_BRANCHTABLE.html" onMouseOver="constPopup(event,'LESSON_PAGE_BRANCHTABLE')">LESSON_PAGE_BRANCHTABLE</a>) {
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment">                            // See if the next pageid is the end of lesson.</span>
<a name="l598"><span class="linenum"> 598</span></a>                              if (<a class="var it26008" onMouseOver="hilite(26008)" onMouseOut="lolite()" onClick="logVariable('lastviewed')" href="../../_variables/lastviewed.html">$lastviewed</a>[<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;nextpageid == <a class="constant" onClick="logConstant('LESSON_EOL')" href="../../_constants/LESSON_EOL.html" onMouseOver="constPopup(event,'LESSON_EOL')">LESSON_EOL</a>) {
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment">                                // The last page viewed was the End of Lesson.</span>
<a name="l600"><span class="linenum"> 600</span></a>                                  if (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('retake')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/retake.html">retake</a>) {
<a name="l601"><span class="linenum"> 601</span></a>  <span class="comment">                                    // User can retake the lesson.</span>
<a name="l602"><span class="linenum"> 602</span></a>                                      <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('additionalattemptsremaining', 'lesson'), 'info');
<a name="l603"><span class="linenum"> 603</span></a>                                      <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l604"><span class="linenum"> 604</span></a>                                  } else {
<a name="l605"><span class="linenum"> 605</span></a>  <span class="comment">                                    // User has completed the lesson and no retakes are allowed.</span>
<a name="l606"><span class="linenum"> 606</span></a>                                      <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = '';
<a name="l607"><span class="linenum"> 607</span></a>                                  }
<a name="l608"><span class="linenum"> 608</span></a>  
<a name="l609"><span class="linenum"> 609</span></a>                              } else {
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment">                                // The last page viewed was NOT the end of lesson.</span>
<a name="l611"><span class="linenum"> 611</span></a>                                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('notyetcompleted', 'lesson'), 'info');
<a name="l612"><span class="linenum"> 612</span></a>                                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l613"><span class="linenum"> 613</span></a>                              }
<a name="l614"><span class="linenum"> 614</span></a>  
<a name="l615"><span class="linenum"> 615</span></a>                          } else {
<a name="l616"><span class="linenum"> 616</span></a>  <span class="comment">                            // Last page was a question page, so the attempt is not completed yet.</span>
<a name="l617"><span class="linenum"> 617</span></a>                              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('notyetcompleted', 'lesson'), 'info');
<a name="l618"><span class="linenum"> 618</span></a>                              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l619"><span class="linenum"> 619</span></a>                          }
<a name="l620"><span class="linenum"> 620</span></a>                      }
<a name="l621"><span class="linenum"> 621</span></a>  
<a name="l622"><span class="linenum"> 622</span></a>                  } else {
<a name="l623"><span class="linenum"> 623</span></a>  <span class="comment">                    // User has not yet started this lesson.</span>
<a name="l624"><span class="linenum"> 624</span></a>                      <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> .= <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nolessonattempts', 'lesson'), 'info');
<a name="l625"><span class="linenum"> 625</span></a>                      <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, 'lesson overview');
<a name="l626"><span class="linenum"> 626</span></a>                  }
<a name="l627"><span class="linenum"> 627</span></a>              }
<a name="l628"><span class="linenum"> 628</span></a>              if (!empty(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>)) {
<a name="l629"><span class="linenum"> 629</span></a>                  if (empty(<a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['lesson'])) {
<a name="l630"><span class="linenum"> 630</span></a>                      <a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['lesson'] = <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>;
<a name="l631"><span class="linenum"> 631</span></a>                  } else {
<a name="l632"><span class="linenum"> 632</span></a>                      <a class="var it9833" onMouseOver="hilite(9833)" onMouseOut="lolite()" onClick="logVariable('htmlarray')" href="../../_variables/htmlarray.html">$htmlarray</a>[<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]['lesson'] .= <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>;
<a name="l633"><span class="linenum"> 633</span></a>                  }
<a name="l634"><span class="linenum"> 634</span></a>              }
<a name="l635"><span class="linenum"> 635</span></a>          }
<a name="l636"><span class="linenum"> 636</span></a>      }
<a name="l637"><span class="linenum"> 637</span></a>  }
<a name="l638"><span class="linenum"> 638</span></a>  
<a name="l639"><span class="linenum"> 639</span></a>  <span class="comment">/**</span>
<a name="l640"><span class="linenum"> 640</span></a>  <span class="comment"> * Function to be run periodically according to the moodle cron</span>
<a name="l641"><span class="linenum"> 641</span></a>  <span class="comment"> * This function searches for things that need to be done, such</span>
<a name="l642"><span class="linenum"> 642</span></a>  <span class="comment"> * as sending out mail, toggling flags etc ...</span>
<a name="l643"><span class="linenum"> 643</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l644"><span class="linenum"> 644</span></a>  <span class="comment"> * @return bool true</span>
<a name="l645"><span class="linenum"> 645</span></a>  <span class="comment"> */</span>
<a name="l646"><span class="linenum"> 646</span></a>  function <a class="function" onClick="logFunction('lesson_cron')" href="../../_functions/lesson_cron.html" onMouseOver="funcPopup(event,'lesson_cron')">lesson_cron</a> () {
<a name="l647"><span class="linenum"> 647</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l648"><span class="linenum"> 648</span></a>  
<a name="l649"><span class="linenum"> 649</span></a>      return true;
<a name="l650"><span class="linenum"> 650</span></a>  }
<a name="l651"><span class="linenum"> 651</span></a>  
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">/**</span>
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment"> * Return grade for given user or all users.</span>
<a name="l654"><span class="linenum"> 654</span></a>  <span class="comment"> *</span>
<a name="l655"><span class="linenum"> 655</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l656"><span class="linenum"> 656</span></a>  <span class="comment"> * @global object</span>
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment"> * @param int $lessonid id of lesson</span>
<a name="l658"><span class="linenum"> 658</span></a>  <span class="comment"> * @param int $userid optional user id, 0 means all users</span>
<a name="l659"><span class="linenum"> 659</span></a>  <span class="comment"> * @return array array of grades, false if none</span>
<a name="l660"><span class="linenum"> 660</span></a>  <span class="comment"> */</span>
<a name="l661"><span class="linenum"> 661</span></a>  function <a class="function" onClick="logFunction('lesson_get_user_grades')" href="../../_functions/lesson_get_user_grades.html" onMouseOver="funcPopup(event,'lesson_get_user_grades')">lesson_get_user_grades</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=0) {
<a name="l662"><span class="linenum"> 662</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l663"><span class="linenum"> 663</span></a>  
<a name="l664"><span class="linenum"> 664</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(&quot;lessonid&quot; =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,&quot;lessonid2&quot; =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l665"><span class="linenum"> 665</span></a>  
<a name="l666"><span class="linenum"> 666</span></a>      if (!empty(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l667"><span class="linenum"> 667</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[&quot;userid&quot;] = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l668"><span class="linenum"> 668</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[&quot;userid2&quot;] = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l669"><span class="linenum"> 669</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = &quot;AND u.id = :userid&quot;;
<a name="l670"><span class="linenum"> 670</span></a>          <a class="var it26010" onMouseOver="hilite(26010)" onMouseOut="lolite()" onClick="logVariable('fuser')" href="../../_variables/fuser.html">$fuser</a> = &quot;AND uu.id = :userid2&quot;;
<a name="l671"><span class="linenum"> 671</span></a>      }
<a name="l672"><span class="linenum"> 672</span></a>      else {
<a name="l673"><span class="linenum"> 673</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>=&quot;&quot;;
<a name="l674"><span class="linenum"> 674</span></a>          <a class="var it26010" onMouseOver="hilite(26010)" onMouseOut="lolite()" onClick="logVariable('fuser')" href="../../_variables/fuser.html">$fuser</a>=&quot;&quot;;
<a name="l675"><span class="linenum"> 675</span></a>      }
<a name="l676"><span class="linenum"> 676</span></a>  
<a name="l677"><span class="linenum"> 677</span></a>      if (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('retake')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/retake.html">retake</a>) {
<a name="l678"><span class="linenum"> 678</span></a>          if (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('usemaxgrade')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/usemaxgrade.html">usemaxgrade</a>) {
<a name="l679"><span class="linenum"> 679</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT u.id, u.id AS userid, <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(g.grade) AS rawgrade
<a name="l680"><span class="linenum"> 680</span></a>                        FROM {user} u, {lesson_grades} g
<a name="l681"><span class="linenum"> 681</span></a>                       WHERE u.id = g.userid AND g.lessonid = :lessonid
<a name="l682"><span class="linenum"> 682</span></a>                             <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>
<a name="l683"><span class="linenum"> 683</span></a>                    GROUP BY u.id&quot;;
<a name="l684"><span class="linenum"> 684</span></a>          } else {
<a name="l685"><span class="linenum"> 685</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT u.id, u.id AS userid, <a class="function" onClick="logFunction('AVG')" href="../../_functions/avg.html" onMouseOver="funcPopup(event,'avg')">AVG</a>(g.grade) AS rawgrade
<a name="l686"><span class="linenum"> 686</span></a>                        FROM {user} u, {lesson_grades} g
<a name="l687"><span class="linenum"> 687</span></a>                       WHERE u.id = g.userid AND g.lessonid = :lessonid
<a name="l688"><span class="linenum"> 688</span></a>                             <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>
<a name="l689"><span class="linenum"> 689</span></a>                    GROUP BY u.id&quot;;
<a name="l690"><span class="linenum"> 690</span></a>          }
<a name="l691"><span class="linenum"> 691</span></a>          unset(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['lessonid2']);
<a name="l692"><span class="linenum"> 692</span></a>          unset(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['userid2']);
<a name="l693"><span class="linenum"> 693</span></a>      } else {
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment">        // use only first attempts (with lowest id in lesson_grades table)</span>
<a name="l695"><span class="linenum"> 695</span></a>          <a class="var it26012" onMouseOver="hilite(26012)" onMouseOut="lolite()" onClick="logVariable('firstonly')" href="../../_variables/firstonly.html">$firstonly</a> = &quot;SELECT uu.id AS userid, <a class="phpfunction" onClick="logFunction('MIN')" href="../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">MIN</a>(gg.id) AS firstcompleted
<a name="l696"><span class="linenum"> 696</span></a>                          FROM {user} uu, {lesson_grades} gg
<a name="l697"><span class="linenum"> 697</span></a>                         WHERE uu.id = gg.userid AND gg.lessonid = :lessonid2
<a name="l698"><span class="linenum"> 698</span></a>                               <a class="var it26010" onMouseOver="hilite(26010)" onMouseOut="lolite()" onClick="logVariable('fuser')" href="../../_variables/fuser.html">$fuser</a>
<a name="l699"><span class="linenum"> 699</span></a>                         GROUP BY uu.id&quot;;
<a name="l700"><span class="linenum"> 700</span></a>  
<a name="l701"><span class="linenum"> 701</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT u.id, u.id AS userid, g.grade AS rawgrade
<a name="l702"><span class="linenum"> 702</span></a>                    FROM {user} u, {lesson_grades} g, (<a class="var it26012" onMouseOver="hilite(26012)" onMouseOut="lolite()" onClick="logVariable('firstonly')" href="../../_variables/firstonly.html">$firstonly</a>) f
<a name="l703"><span class="linenum"> 703</span></a>                   WHERE u.id = g.userid AND g.lessonid = :lessonid
<a name="l704"><span class="linenum"> 704</span></a>                         AND g.id = f.firstcompleted AND g.userid=f.userid
<a name="l705"><span class="linenum"> 705</span></a>                         <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>&quot;;
<a name="l706"><span class="linenum"> 706</span></a>      }
<a name="l707"><span class="linenum"> 707</span></a>  
<a name="l708"><span class="linenum"> 708</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l709"><span class="linenum"> 709</span></a>  }
<a name="l710"><span class="linenum"> 710</span></a>  
<a name="l711"><span class="linenum"> 711</span></a>  <span class="comment">/**</span>
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment"> * Update grades in central gradebook</span>
<a name="l713"><span class="linenum"> 713</span></a>  <span class="comment"> *</span>
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment"> * @category grade</span>
<a name="l715"><span class="linenum"> 715</span></a>  <span class="comment"> * @param object $lesson</span>
<a name="l716"><span class="linenum"> 716</span></a>  <span class="comment"> * @param int $userid specific user only, 0 means all</span>
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment"> * @param bool $nullifnone</span>
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment"> */</span>
<a name="l719"><span class="linenum"> 719</span></a>  function <a class="function" onClick="logFunction('lesson_update_grades')" href="../../_functions/lesson_update_grades.html" onMouseOver="funcPopup(event,'lesson_update_grades')">lesson_update_grades</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=0, <a class="var it9796" onMouseOver="hilite(9796)" onMouseOut="lolite()" onClick="logVariable('nullifnone')" href="../../_variables/nullifnone.html">$nullifnone</a>=true) {
<a name="l720"><span class="linenum"> 720</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l721"><span class="linenum"> 721</span></a>      require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/gradelib.php');
<a name="l722"><span class="linenum"> 722</span></a>  
<a name="l723"><span class="linenum"> 723</span></a>      if (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a> == 0 || <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('practice')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/practice.html">practice</a>) {
<a name="l724"><span class="linenum"> 724</span></a>          <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l725"><span class="linenum"> 725</span></a>  
<a name="l726"><span class="linenum"> 726</span></a>      } else if (<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="function" onClick="logFunction('lesson_get_user_grades')" href="../../_functions/lesson_get_user_grades.html" onMouseOver="funcPopup(event,'lesson_get_user_grades')">lesson_get_user_grades</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l727"><span class="linenum"> 727</span></a>          <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l728"><span class="linenum"> 728</span></a>  
<a name="l729"><span class="linenum"> 729</span></a>      } else if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> and <a class="var it9796" onMouseOver="hilite(9796)" onMouseOut="lolite()" onClick="logVariable('nullifnone')" href="../../_variables/nullifnone.html">$nullifnone</a>) {
<a name="l730"><span class="linenum"> 730</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = new stdClass();
<a name="l731"><span class="linenum"> 731</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('userid')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>   = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l732"><span class="linenum"> 732</span></a>          <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a> = null;
<a name="l733"><span class="linenum"> 733</span></a>          <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>);
<a name="l734"><span class="linenum"> 734</span></a>  
<a name="l735"><span class="linenum"> 735</span></a>      } else {
<a name="l736"><span class="linenum"> 736</span></a>          <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l737"><span class="linenum"> 737</span></a>      }
<a name="l738"><span class="linenum"> 738</span></a>  }
<a name="l739"><span class="linenum"> 739</span></a>  
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment">/**</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment"> * Create grade item for given lesson</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment"> *</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="comment"> * @category grade</span>
<a name="l744"><span class="linenum"> 744</span></a>  <span class="comment"> * @uses GRADE_TYPE_VALUE</span>
<a name="l745"><span class="linenum"> 745</span></a>  <span class="comment"> * @uses GRADE_TYPE_NONE</span>
<a name="l746"><span class="linenum"> 746</span></a>  <span class="comment"> * @param object $lesson object with extra cmidnumber</span>
<a name="l747"><span class="linenum"> 747</span></a>  <span class="comment"> * @param array|object $grades optional array/object of grade(s); 'reset' means reset grades in gradebook</span>
<a name="l748"><span class="linenum"> 748</span></a>  <span class="comment"> * @return int 0 if ok, error code otherwise</span>
<a name="l749"><span class="linenum"> 749</span></a>  <span class="comment"> */</span>
<a name="l750"><span class="linenum"> 750</span></a>  function <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>=null) {
<a name="l751"><span class="linenum"> 751</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l752"><span class="linenum"> 752</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('grade_update')) { //workaround for buggy PHP versions
<a name="l753"><span class="linenum"> 753</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/gradelib.php');
<a name="l754"><span class="linenum"> 754</span></a>      }
<a name="l755"><span class="linenum"> 755</span></a>  
<a name="l756"><span class="linenum"> 756</span></a>      if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('cmidnumber', <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>)) { //it may not be always present
<a name="l757"><span class="linenum"> 757</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('itemname'=&gt;<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>, 'idnumber'=&gt;<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/cmidnumber.html">cmidnumber</a>);
<a name="l758"><span class="linenum"> 758</span></a>      } else {
<a name="l759"><span class="linenum"> 759</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('itemname'=&gt;<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('name')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>);
<a name="l760"><span class="linenum"> 760</span></a>      }
<a name="l761"><span class="linenum"> 761</span></a>  
<a name="l762"><span class="linenum"> 762</span></a>      if (!<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('practice')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/practice.html">practice</a> and <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a> &gt; 0) {
<a name="l763"><span class="linenum"> 763</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gradetype']  = <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a>;
<a name="l764"><span class="linenum"> 764</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademax']   = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a>;
<a name="l765"><span class="linenum"> 765</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademin']   = 0;
<a name="l766"><span class="linenum"> 766</span></a>      } else if (!<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('practice')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/practice.html">practice</a> and <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a> &lt; 0) {
<a name="l767"><span class="linenum"> 767</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gradetype']  = <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>;
<a name="l768"><span class="linenum"> 768</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['scaleid']   = -<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('grade')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a>;
<a name="l769"><span class="linenum"> 769</span></a>  
<a name="l770"><span class="linenum"> 770</span></a>  <span class="comment">        // Make sure current grade fetched correctly from $grades</span>
<a name="l771"><span class="linenum"> 771</span></a>          <a class="var it9945" onMouseOver="hilite(9945)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a> = null;
<a name="l772"><span class="linenum"> 772</span></a>          if (!empty(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l773"><span class="linenum"> 773</span></a>              if (<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l774"><span class="linenum"> 774</span></a>                  <a class="var it9945" onMouseOver="hilite(9945)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l775"><span class="linenum"> 775</span></a>              } else {
<a name="l776"><span class="linenum"> 776</span></a>                  <a class="var it9945" onMouseOver="hilite(9945)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a> = <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>;
<a name="l777"><span class="linenum"> 777</span></a>              }
<a name="l778"><span class="linenum"> 778</span></a>          }
<a name="l779"><span class="linenum"> 779</span></a>  
<a name="l780"><span class="linenum"> 780</span></a>  <span class="comment">        // When converting a score to a scale, use scale's grade maximum to calculate it.</span>
<a name="l781"><span class="linenum"> 781</span></a>          if (!empty(<a class="var it9945" onMouseOver="hilite(9945)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a>) &amp;&amp; <a class="var it9945" onMouseOver="hilite(9945)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it43455" onMouseOver="hilite(43455)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a> !== null) {
<a name="l782"><span class="linenum"> 782</span></a>              <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <a class="function" onClick="logFunction('grade_get_grades')" href="../../_functions/grade_get_grades.html" onMouseOver="funcPopup(event,'grade_get_grades')">grade_get_grades</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, 'mod', 'lesson', <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it9945" onMouseOver="hilite(9945)" onMouseOut="lolite()" onClick="logVariable('currentgrade')" href="../../_variables/currentgrade.html">$currentgrade</a>-&gt;<a onClick="logVariable('userid')" class="var it43455" onMouseOver="hilite(43455)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l783"><span class="linenum"> 783</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademax']   = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('items')" class="var it42963" onMouseOver="hilite(42963)" onMouseOut="lolite()" href="../../_variables/items.html">items</a>)-&gt;grademax;
<a name="l784"><span class="linenum"> 784</span></a>          }
<a name="l785"><span class="linenum"> 785</span></a>      } else {
<a name="l786"><span class="linenum"> 786</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gradetype']  = <a class="constant" onClick="logConstant('GRADE_TYPE_NONE')" href="../../_constants/GRADE_TYPE_NONE.html" onMouseOver="constPopup(event,'GRADE_TYPE_NONE')">GRADE_TYPE_NONE</a>;
<a name="l787"><span class="linenum"> 787</span></a>      }
<a name="l788"><span class="linenum"> 788</span></a>  
<a name="l789"><span class="linenum"> 789</span></a>      if (<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>  === 'reset') {
<a name="l790"><span class="linenum"> 790</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['reset'] = true;
<a name="l791"><span class="linenum"> 791</span></a>          <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = null;
<a name="l792"><span class="linenum"> 792</span></a>      } else if (!empty(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l793"><span class="linenum"> 793</span></a>  <span class="comment">        // Need to calculate raw grade (Note: $grades has many forms)</span>
<a name="l794"><span class="linenum"> 794</span></a>          if (<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l795"><span class="linenum"> 795</span></a>              <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = array(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>-&gt;<a onClick="logVariable('userid')" class="var it43825" onMouseOver="hilite(43825)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> =&gt; <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l796"><span class="linenum"> 796</span></a>          } else if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('userid', <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>)) {
<a name="l797"><span class="linenum"> 797</span></a>              <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = array(<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>['userid'] =&gt; <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>);
<a name="l798"><span class="linenum"> 798</span></a>          }
<a name="l799"><span class="linenum"> 799</span></a>          foreach (<a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>) {
<a name="l800"><span class="linenum"> 800</span></a>              if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>)) {
<a name="l801"><span class="linenum"> 801</span></a>                  <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>] = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = (array) <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>;
<a name="l802"><span class="linenum"> 802</span></a>              }
<a name="l803"><span class="linenum"> 803</span></a>  <span class="comment">            //check raw grade isnt null otherwise we erroneously insert a grade of 0</span>
<a name="l804"><span class="linenum"> 804</span></a>              if (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>['rawgrade'] !== null) {
<a name="l805"><span class="linenum"> 805</span></a>                  <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>]['rawgrade'] = (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>['rawgrade'] * <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['grademax'] / 100);
<a name="l806"><span class="linenum"> 806</span></a>              } else {
<a name="l807"><span class="linenum"> 807</span></a>  <span class="comment">                //setting rawgrade to null just in case user is deleting a grade</span>
<a name="l808"><span class="linenum"> 808</span></a>                  <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>]['rawgrade'] = null;
<a name="l809"><span class="linenum"> 809</span></a>              }
<a name="l810"><span class="linenum"> 810</span></a>          }
<a name="l811"><span class="linenum"> 811</span></a>      }
<a name="l812"><span class="linenum"> 812</span></a>  
<a name="l813"><span class="linenum"> 813</span></a>      return <a class="function" onClick="logFunction('grade_update')" href="../../_functions/grade_update.html" onMouseOver="funcPopup(event,'grade_update')">grade_update</a>('mod/lesson', <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('course')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, 'mod', 'lesson', <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 0, <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l814"><span class="linenum"> 814</span></a>  }
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>  <span class="comment">/**</span>
<a name="l817"><span class="linenum"> 817</span></a>  <span class="comment"> * List the actions that correspond to a view of this module.</span>
<a name="l818"><span class="linenum"> 818</span></a>  <span class="comment"> * This is used by the participation report.</span>
<a name="l819"><span class="linenum"> 819</span></a>  <span class="comment"> *</span>
<a name="l820"><span class="linenum"> 820</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l821"><span class="linenum"> 821</span></a>  <span class="comment"> *       crud = 'r' and edulevel = LEVEL_PARTICIPATING will</span>
<a name="l822"><span class="linenum"> 822</span></a>  <span class="comment"> *       be considered as view action.</span>
<a name="l823"><span class="linenum"> 823</span></a>  <span class="comment"> *</span>
<a name="l824"><span class="linenum"> 824</span></a>  <span class="comment"> * @return array</span>
<a name="l825"><span class="linenum"> 825</span></a>  <span class="comment"> */</span>
<a name="l826"><span class="linenum"> 826</span></a>  function <a class="function" onClick="logFunction('lesson_get_view_actions')" href="../../_functions/lesson_get_view_actions.html" onMouseOver="funcPopup(event,'lesson_get_view_actions')">lesson_get_view_actions</a>() {
<a name="l827"><span class="linenum"> 827</span></a>      return array('view','view all');
<a name="l828"><span class="linenum"> 828</span></a>  }
<a name="l829"><span class="linenum"> 829</span></a>  
<a name="l830"><span class="linenum"> 830</span></a>  <span class="comment">/**</span>
<a name="l831"><span class="linenum"> 831</span></a>  <span class="comment"> * List the actions that correspond to a post of this module.</span>
<a name="l832"><span class="linenum"> 832</span></a>  <span class="comment"> * This is used by the participation report.</span>
<a name="l833"><span class="linenum"> 833</span></a>  <span class="comment"> *</span>
<a name="l834"><span class="linenum"> 834</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l835"><span class="linenum"> 835</span></a>  <span class="comment"> *       crud = ('c' || 'u' || 'd') and edulevel = LEVEL_PARTICIPATING</span>
<a name="l836"><span class="linenum"> 836</span></a>  <span class="comment"> *       will be considered as post action.</span>
<a name="l837"><span class="linenum"> 837</span></a>  <span class="comment"> *</span>
<a name="l838"><span class="linenum"> 838</span></a>  <span class="comment"> * @return array</span>
<a name="l839"><span class="linenum"> 839</span></a>  <span class="comment"> */</span>
<a name="l840"><span class="linenum"> 840</span></a>  function <a class="function" onClick="logFunction('lesson_get_post_actions')" href="../../_functions/lesson_get_post_actions.html" onMouseOver="funcPopup(event,'lesson_get_post_actions')">lesson_get_post_actions</a>() {
<a name="l841"><span class="linenum"> 841</span></a>      return array('end','start');
<a name="l842"><span class="linenum"> 842</span></a>  }
<a name="l843"><span class="linenum"> 843</span></a>  
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">/**</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment"> * Runs any processes that must run before</span>
<a name="l846"><span class="linenum"> 846</span></a>  <span class="comment"> * a lesson insert/update</span>
<a name="l847"><span class="linenum"> 847</span></a>  <span class="comment"> *</span>
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment"> * @global object</span>
<a name="l849"><span class="linenum"> 849</span></a>  <span class="comment"> * @param object $lesson Lesson form data</span>
<a name="l850"><span class="linenum"> 850</span></a>  <span class="comment"> * @return void</span>
<a name="l851"><span class="linenum"> 851</span></a>  <span class="comment"> **/</span>
<a name="l852"><span class="linenum"> 852</span></a>  function <a class="function" onClick="logFunction('lesson_process_pre_save')" href="../../_functions/lesson_process_pre_save.html" onMouseOver="funcPopup(event,'lesson_process_pre_save')">lesson_process_pre_save</a>(&amp;<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l853"><span class="linenum"> 853</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l854"><span class="linenum"> 854</span></a>  
<a name="l855"><span class="linenum"> 855</span></a>      <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l856"><span class="linenum"> 856</span></a>  
<a name="l857"><span class="linenum"> 857</span></a>      if (empty(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timelimit')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/timelimit.html">timelimit</a>)) {
<a name="l858"><span class="linenum"> 858</span></a>          <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timelimit')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/timelimit.html">timelimit</a> = 0;
<a name="l859"><span class="linenum"> 859</span></a>      }
<a name="l860"><span class="linenum"> 860</span></a>      if (empty(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a>) or !<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a>) or <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a> &lt; 0) {
<a name="l861"><span class="linenum"> 861</span></a>          <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a> = 0;
<a name="l862"><span class="linenum"> 862</span></a>      }
<a name="l863"><span class="linenum"> 863</span></a>      if (!isset(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completed')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a>)) {
<a name="l864"><span class="linenum"> 864</span></a>          <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completed')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a> = 0;
<a name="l865"><span class="linenum"> 865</span></a>      }
<a name="l866"><span class="linenum"> 866</span></a>      if (empty(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a>) or !<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a>) or <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> &lt; 0) {
<a name="l867"><span class="linenum"> 867</span></a>          <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> = 0;
<a name="l868"><span class="linenum"> 868</span></a>      } else if (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> &gt; 100) {
<a name="l869"><span class="linenum"> 869</span></a>          <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> = 100;
<a name="l870"><span class="linenum"> 870</span></a>      }
<a name="l871"><span class="linenum"> 871</span></a>  
<a name="l872"><span class="linenum"> 872</span></a>      if (empty(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('width')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/width.html">width</a>)) {
<a name="l873"><span class="linenum"> 873</span></a>          <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('width')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/width.html">width</a> = 640;
<a name="l874"><span class="linenum"> 874</span></a>      }
<a name="l875"><span class="linenum"> 875</span></a>      if (empty(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('height')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/height.html">height</a>)) {
<a name="l876"><span class="linenum"> 876</span></a>          <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('height')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/height.html">height</a> = 480;
<a name="l877"><span class="linenum"> 877</span></a>      }
<a name="l878"><span class="linenum"> 878</span></a>      if (empty(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('bgcolor')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/bgcolor.html">bgcolor</a>)) {
<a name="l879"><span class="linenum"> 879</span></a>          <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('bgcolor')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/bgcolor.html">bgcolor</a> = '#FFFFFF';
<a name="l880"><span class="linenum"> 880</span></a>      }
<a name="l881"><span class="linenum"> 881</span></a>  
<a name="l882"><span class="linenum"> 882</span></a>  <span class="comment">    // Conditions for dependency</span>
<a name="l883"><span class="linenum"> 883</span></a>      <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a> = new stdClass;
<a name="l884"><span class="linenum"> 884</span></a>      <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>-&gt;<a onClick="logVariable('timespent')" class="var it44774" onMouseOver="hilite(44774)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a> = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a>;
<a name="l885"><span class="linenum"> 885</span></a>      <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>-&gt;<a onClick="logVariable('completed')" class="var it44774" onMouseOver="hilite(44774)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a> = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completed')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a>;
<a name="l886"><span class="linenum"> 886</span></a>      <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it44774" onMouseOver="hilite(44774)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a> = <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a>;
<a name="l887"><span class="linenum"> 887</span></a>      <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('conditions')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/conditions.html">conditions</a> = <a class="phpfunction" onClick="logFunction('serialize')" href="../../_functions/serialize.html" onMouseOver="phpfuncPopup(event,'serialize')">serialize</a>(<a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>);
<a name="l888"><span class="linenum"> 888</span></a>      unset(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('timespent')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/timespent.html">timespent</a>);
<a name="l889"><span class="linenum"> 889</span></a>      unset(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completed')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/completed.html">completed</a>);
<a name="l890"><span class="linenum"> 890</span></a>      unset(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('gradebetterthan')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/gradebetterthan.html">gradebetterthan</a>);
<a name="l891"><span class="linenum"> 891</span></a>  
<a name="l892"><span class="linenum"> 892</span></a>      if (empty(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('password')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/password.html">password</a>)) {
<a name="l893"><span class="linenum"> 893</span></a>          unset(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('password')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/password.html">password</a>);
<a name="l894"><span class="linenum"> 894</span></a>      }
<a name="l895"><span class="linenum"> 895</span></a>  }
<a name="l896"><span class="linenum"> 896</span></a>  
<a name="l897"><span class="linenum"> 897</span></a>  <span class="comment">/**</span>
<a name="l898"><span class="linenum"> 898</span></a>  <span class="comment"> * Runs any processes that must be run</span>
<a name="l899"><span class="linenum"> 899</span></a>  <span class="comment"> * after a lesson insert/update</span>
<a name="l900"><span class="linenum"> 900</span></a>  <span class="comment"> *</span>
<a name="l901"><span class="linenum"> 901</span></a>  <span class="comment"> * @global object</span>
<a name="l902"><span class="linenum"> 902</span></a>  <span class="comment"> * @param object $lesson Lesson form data</span>
<a name="l903"><span class="linenum"> 903</span></a>  <span class="comment"> * @return void</span>
<a name="l904"><span class="linenum"> 904</span></a>  <span class="comment"> **/</span>
<a name="l905"><span class="linenum"> 905</span></a>  function <a class="function" onClick="logFunction('lesson_process_post_save')" href="../../_functions/lesson_process_post_save.html" onMouseOver="funcPopup(event,'lesson_process_post_save')">lesson_process_post_save</a>(&amp;<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l906"><span class="linenum"> 906</span></a>  <span class="comment">    // Update the events relating to this lesson.</span>
<a name="l907"><span class="linenum"> 907</span></a>      <a class="function" onClick="logFunction('lesson_update_events')" href="../../_functions/lesson_update_events.html" onMouseOver="funcPopup(event,'lesson_update_events')">lesson_update_events</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>);
<a name="l908"><span class="linenum"> 908</span></a>  }
<a name="l909"><span class="linenum"> 909</span></a>  
<a name="l910"><span class="linenum"> 910</span></a>  
<a name="l911"><span class="linenum"> 911</span></a>  <span class="comment">/**</span>
<a name="l912"><span class="linenum"> 912</span></a>  <span class="comment"> * Implementation of the function for printing the form elements that control</span>
<a name="l913"><span class="linenum"> 913</span></a>  <span class="comment"> * whether the course reset functionality affects the lesson.</span>
<a name="l914"><span class="linenum"> 914</span></a>  <span class="comment"> *</span>
<a name="l915"><span class="linenum"> 915</span></a>  <span class="comment"> * @param $mform form passed by reference</span>
<a name="l916"><span class="linenum"> 916</span></a>  <span class="comment"> */</span>
<a name="l917"><span class="linenum"> 917</span></a>  function <a class="function" onClick="logFunction('lesson_reset_course_form_definition')" href="../../_functions/lesson_reset_course_form_definition.html" onMouseOver="funcPopup(event,'lesson_reset_course_form_definition')">lesson_reset_course_form_definition</a>(&amp;<a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l918"><span class="linenum"> 918</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('header', 'lessonheader', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulenameplural', 'lesson'));
<a name="l919"><span class="linenum"> 919</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('advcheckbox', 'reset_lesson', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('deleteallattempts','lesson'));
<a name="l920"><span class="linenum"> 920</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('advcheckbox', 'reset_lesson_user_overrides',
<a name="l921"><span class="linenum"> 921</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('removealluseroverrides', 'lesson'));
<a name="l922"><span class="linenum"> 922</span></a>      <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('advcheckbox', 'reset_lesson_group_overrides',
<a name="l923"><span class="linenum"> 923</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('removeallgroupoverrides', 'lesson'));
<a name="l924"><span class="linenum"> 924</span></a>  }
<a name="l925"><span class="linenum"> 925</span></a>  
<a name="l926"><span class="linenum"> 926</span></a>  <span class="comment">/**</span>
<a name="l927"><span class="linenum"> 927</span></a>  <span class="comment"> * Course reset form defaults.</span>
<a name="l928"><span class="linenum"> 928</span></a>  <span class="comment"> * @param object $course</span>
<a name="l929"><span class="linenum"> 929</span></a>  <span class="comment"> * @return array</span>
<a name="l930"><span class="linenum"> 930</span></a>  <span class="comment"> */</span>
<a name="l931"><span class="linenum"> 931</span></a>  function <a class="function" onClick="logFunction('lesson_reset_course_form_defaults')" href="../../_functions/lesson_reset_course_form_defaults.html" onMouseOver="funcPopup(event,'lesson_reset_course_form_defaults')">lesson_reset_course_form_defaults</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l932"><span class="linenum"> 932</span></a>      return array('reset_lesson' =&gt; 1,
<a name="l933"><span class="linenum"> 933</span></a>              'reset_lesson_group_overrides' =&gt; 1,
<a name="l934"><span class="linenum"> 934</span></a>              'reset_lesson_user_overrides' =&gt; 1);
<a name="l935"><span class="linenum"> 935</span></a>  }
<a name="l936"><span class="linenum"> 936</span></a>  
<a name="l937"><span class="linenum"> 937</span></a>  <span class="comment">/**</span>
<a name="l938"><span class="linenum"> 938</span></a>  <span class="comment"> * Removes all grades from gradebook</span>
<a name="l939"><span class="linenum"> 939</span></a>  <span class="comment"> *</span>
<a name="l940"><span class="linenum"> 940</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l941"><span class="linenum"> 941</span></a>  <span class="comment"> * @global object</span>
<a name="l942"><span class="linenum"> 942</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l943"><span class="linenum"> 943</span></a>  <span class="comment"> * @param string optional type</span>
<a name="l944"><span class="linenum"> 944</span></a>  <span class="comment"> */</span>
<a name="l945"><span class="linenum"> 945</span></a>  function <a class="function" onClick="logFunction('lesson_reset_gradebook')" href="../../_functions/lesson_reset_gradebook.html" onMouseOver="funcPopup(event,'lesson_reset_gradebook')">lesson_reset_gradebook</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>='') {
<a name="l946"><span class="linenum"> 946</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l947"><span class="linenum"> 947</span></a>  
<a name="l948"><span class="linenum"> 948</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT l.*, cm.idnumber as cmidnumber, l.course as courseid
<a name="l949"><span class="linenum"> 949</span></a>                FROM {lesson} l, {course_modules} cm, {modules} m
<a name="l950"><span class="linenum"> 950</span></a>               WHERE m.name='lesson' AND m.id=cm.module AND cm.instance=l.id AND l.course=:course&quot;;
<a name="l951"><span class="linenum"> 951</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array (&quot;course&quot; =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l952"><span class="linenum"> 952</span></a>      if (<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>,<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l953"><span class="linenum"> 953</span></a>          foreach (<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>) {
<a name="l954"><span class="linenum"> 954</span></a>              <a class="function" onClick="logFunction('lesson_grade_item_update')" href="../../_functions/lesson_grade_item_update.html" onMouseOver="funcPopup(event,'lesson_grade_item_update')">lesson_grade_item_update</a>(<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>, 'reset');
<a name="l955"><span class="linenum"> 955</span></a>          }
<a name="l956"><span class="linenum"> 956</span></a>      }
<a name="l957"><span class="linenum"> 957</span></a>  }
<a name="l958"><span class="linenum"> 958</span></a>  
<a name="l959"><span class="linenum"> 959</span></a>  <span class="comment">/**</span>
<a name="l960"><span class="linenum"> 960</span></a>  <span class="comment"> * Actual implementation of the reset course functionality, delete all the</span>
<a name="l961"><span class="linenum"> 961</span></a>  <span class="comment"> * lesson attempts for course $data-&gt;courseid.</span>
<a name="l962"><span class="linenum"> 962</span></a>  <span class="comment"> *</span>
<a name="l963"><span class="linenum"> 963</span></a>  <span class="comment"> * @global stdClass</span>
<a name="l964"><span class="linenum"> 964</span></a>  <span class="comment"> * @global object</span>
<a name="l965"><span class="linenum"> 965</span></a>  <span class="comment"> * @param object $data the data submitted from the reset course.</span>
<a name="l966"><span class="linenum"> 966</span></a>  <span class="comment"> * @return array status array</span>
<a name="l967"><span class="linenum"> 967</span></a>  <span class="comment"> */</span>
<a name="l968"><span class="linenum"> 968</span></a>  function <a class="function" onClick="logFunction('lesson_reset_userdata')" href="../../_functions/lesson_reset_userdata.html" onMouseOver="funcPopup(event,'lesson_reset_userdata')">lesson_reset_userdata</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>) {
<a name="l969"><span class="linenum"> 969</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l970"><span class="linenum"> 970</span></a>  
<a name="l971"><span class="linenum"> 971</span></a>      <a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulenameplural', 'lesson');
<a name="l972"><span class="linenum"> 972</span></a>      <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = array();
<a name="l973"><span class="linenum"> 973</span></a>  
<a name="l974"><span class="linenum"> 974</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_lesson')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_lesson.html">reset_lesson</a>)) {
<a name="l975"><span class="linenum"> 975</span></a>          <a class="var it26014" onMouseOver="hilite(26014)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a> = &quot;SELECT l.id
<a name="l976"><span class="linenum"> 976</span></a>                           FROM {lesson} l
<a name="l977"><span class="linenum"> 977</span></a>                          WHERE l.course=:course&quot;;
<a name="l978"><span class="linenum"> 978</span></a>  
<a name="l979"><span class="linenum"> 979</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array (&quot;course&quot; =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l980"><span class="linenum"> 980</span></a>          <a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it26014" onMouseOver="hilite(26014)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l981"><span class="linenum"> 981</span></a>  
<a name="l982"><span class="linenum"> 982</span></a>  <span class="comment">        // Get rid of attempts files.</span>
<a name="l983"><span class="linenum"> 983</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l984"><span class="linenum"> 984</span></a>          if (<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a>) {
<a name="l985"><span class="linenum"> 985</span></a>              foreach (<a class="var it6408" onMouseOver="hilite(6408)" onMouseOut="lolite()" onClick="logVariable('lessons')" href="../../_variables/lessons.html">$lessons</a> as <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a> =&gt; <a class="var it1292" onMouseOver="hilite(1292)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>) {
<a name="l986"><span class="linenum"> 986</span></a>                  if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>('lesson', <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>)) {
<a name="l987"><span class="linenum"> 987</span></a>                      continue;
<a name="l988"><span class="linenum"> 988</span></a>                  }
<a name="l989"><span class="linenum"> 989</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l990"><span class="linenum"> 990</span></a>                  <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_lesson', 'essay_responses');
<a name="l991"><span class="linenum"> 991</span></a>              }
<a name="l992"><span class="linenum"> 992</span></a>          }
<a name="l993"><span class="linenum"> 993</span></a>  
<a name="l994"><span class="linenum"> 994</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_timer', &quot;lessonid IN (<a class="var it26014" onMouseOver="hilite(26014)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l995"><span class="linenum"> 995</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_grades', &quot;lessonid IN (<a class="var it26014" onMouseOver="hilite(26014)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l996"><span class="linenum"> 996</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_attempts', &quot;lessonid IN (<a class="var it26014" onMouseOver="hilite(26014)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l997"><span class="linenum"> 997</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_branch', &quot;lessonid IN (<a class="var it26014" onMouseOver="hilite(26014)" onMouseOut="lolite()" onClick="logVariable('lessonssql')" href="../../_variables/lessonssql.html">$lessonssql</a>)&quot;, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l998"><span class="linenum"> 998</span></a>  
<a name="l999"><span class="linenum"> 999</span></a>  <span class="comment">        // remove all grades from gradebook</span>
<a name="l1000"><span class="linenum">1000</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_gradebook_grades')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_gradebook_grades.html">reset_gradebook_grades</a>)) {
<a name="l1001"><span class="linenum">1001</span></a>              <a class="function" onClick="logFunction('lesson_reset_gradebook')" href="../../_functions/lesson_reset_gradebook.html" onMouseOver="funcPopup(event,'lesson_reset_gradebook')">lesson_reset_gradebook</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l1002"><span class="linenum">1002</span></a>          }
<a name="l1003"><span class="linenum">1003</span></a>  
<a name="l1004"><span class="linenum">1004</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component'=&gt;<a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('deleteallattempts', 'lesson'), 'error'=&gt;false);
<a name="l1005"><span class="linenum">1005</span></a>      }
<a name="l1006"><span class="linenum">1006</span></a>  
<a name="l1007"><span class="linenum">1007</span></a>  <span class="comment">    // Remove user overrides.</span>
<a name="l1008"><span class="linenum">1008</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_lesson_user_overrides')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_lesson_user_overrides.html">reset_lesson_user_overrides</a>)) {
<a name="l1009"><span class="linenum">1009</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_overrides',
<a name="l1010"><span class="linenum">1010</span></a>                  'lessonid IN (SELECT id FROM {lesson} WHERE course = ?) AND userid IS NOT NULL', array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l1011"><span class="linenum">1011</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array(
<a name="l1012"><span class="linenum">1012</span></a>          'component' =&gt; <a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>,
<a name="l1013"><span class="linenum">1013</span></a>          'item' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('useroverridesdeleted', 'lesson'),
<a name="l1014"><span class="linenum">1014</span></a>          'error' =&gt; false);
<a name="l1015"><span class="linenum">1015</span></a>      }
<a name="l1016"><span class="linenum">1016</span></a>  <span class="comment">    // Remove group overrides.</span>
<a name="l1017"><span class="linenum">1017</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('reset_lesson_group_overrides')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/reset_lesson_group_overrides.html">reset_lesson_group_overrides</a>)) {
<a name="l1018"><span class="linenum">1018</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('lesson_overrides',
<a name="l1019"><span class="linenum">1019</span></a>          'lessonid IN (SELECT id FROM {lesson} WHERE course = ?) AND groupid IS NOT NULL', array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l1020"><span class="linenum">1020</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array(
<a name="l1021"><span class="linenum">1021</span></a>          'component' =&gt; <a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>,
<a name="l1022"><span class="linenum">1022</span></a>          'item' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('groupoverridesdeleted', 'lesson'),
<a name="l1023"><span class="linenum">1023</span></a>          'error' =&gt; false);
<a name="l1024"><span class="linenum">1024</span></a>      }
<a name="l1025"><span class="linenum">1025</span></a>  <span class="comment">    /// updating dates - shift may be negative too</span>
<a name="l1026"><span class="linenum">1026</span></a>      if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>) {
<a name="l1027"><span class="linenum">1027</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;UPDATE {lesson_overrides}
<a name="l1028"><span class="linenum">1028</span></a>                           SET available = available + ?
<a name="l1029"><span class="linenum">1029</span></a>                         WHERE lessonid IN (SELECT id FROM {lesson} WHERE course = ?)
<a name="l1030"><span class="linenum">1030</span></a>                           AND available &lt;&gt; 0&quot;, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l1031"><span class="linenum">1031</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;UPDATE {lesson_overrides}
<a name="l1032"><span class="linenum">1032</span></a>                           SET deadline = deadline + ?
<a name="l1033"><span class="linenum">1033</span></a>                         WHERE lessonid IN (SELECT id FROM {lesson} WHERE course = ?)
<a name="l1034"><span class="linenum">1034</span></a>                           AND deadline &lt;&gt; 0&quot;, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l1035"><span class="linenum">1035</span></a>  
<a name="l1036"><span class="linenum">1036</span></a>          <a class="function" onClick="logFunction('shift_course_mod_dates')" href="../../_functions/shift_course_mod_dates.html" onMouseOver="funcPopup(event,'shift_course_mod_dates')">shift_course_mod_dates</a>('lesson', array('available', 'deadline'), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeshift')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timeshift.html">timeshift</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('courseid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l1037"><span class="linenum">1037</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>[] = array('component'=&gt;<a class="var it9827" onMouseOver="hilite(9827)" onMouseOut="lolite()" onClick="logVariable('componentstr')" href="../../_variables/componentstr.html">$componentstr</a>, 'item'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('datechanged'), 'error'=&gt;false);
<a name="l1038"><span class="linenum">1038</span></a>      }
<a name="l1039"><span class="linenum">1039</span></a>  
<a name="l1040"><span class="linenum">1040</span></a>      return <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>;
<a name="l1041"><span class="linenum">1041</span></a>  }
<a name="l1042"><span class="linenum">1042</span></a>  
<a name="l1043"><span class="linenum">1043</span></a>  <span class="comment">/**</span>
<a name="l1044"><span class="linenum">1044</span></a>  <span class="comment"> * Returns all other caps used in module</span>
<a name="l1045"><span class="linenum">1045</span></a>  <span class="comment"> * @return array</span>
<a name="l1046"><span class="linenum">1046</span></a>  <span class="comment"> */</span>
<a name="l1047"><span class="linenum">1047</span></a>  function <a class="function" onClick="logFunction('lesson_get_extra_capabilities')" href="../../_functions/lesson_get_extra_capabilities.html" onMouseOver="funcPopup(event,'lesson_get_extra_capabilities')">lesson_get_extra_capabilities</a>() {
<a name="l1048"><span class="linenum">1048</span></a>      return array('moodle/site:accessallgroups');
<a name="l1049"><span class="linenum">1049</span></a>  }
<a name="l1050"><span class="linenum">1050</span></a>  
<a name="l1051"><span class="linenum">1051</span></a>  <span class="comment">/**</span>
<a name="l1052"><span class="linenum">1052</span></a>  <span class="comment"> * @uses FEATURE_GROUPS</span>
<a name="l1053"><span class="linenum">1053</span></a>  <span class="comment"> * @uses FEATURE_GROUPINGS</span>
<a name="l1054"><span class="linenum">1054</span></a>  <span class="comment"> * @uses FEATURE_MOD_INTRO</span>
<a name="l1055"><span class="linenum">1055</span></a>  <span class="comment"> * @uses FEATURE_COMPLETION_TRACKS_VIEWS</span>
<a name="l1056"><span class="linenum">1056</span></a>  <span class="comment"> * @uses FEATURE_GRADE_HAS_GRADE</span>
<a name="l1057"><span class="linenum">1057</span></a>  <span class="comment"> * @uses FEATURE_GRADE_OUTCOMES</span>
<a name="l1058"><span class="linenum">1058</span></a>  <span class="comment"> * @param string $feature FEATURE_xx constant for requested feature</span>
<a name="l1059"><span class="linenum">1059</span></a>  <span class="comment"> * @return mixed True if module supports feature, false if not, null if doesn't know</span>
<a name="l1060"><span class="linenum">1060</span></a>  <span class="comment"> */</span>
<a name="l1061"><span class="linenum">1061</span></a>  function <a class="function" onClick="logFunction('lesson_supports')" href="../../_functions/lesson_supports.html" onMouseOver="funcPopup(event,'lesson_supports')">lesson_supports</a>(<a class="var it2267" onMouseOver="hilite(2267)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l1062"><span class="linenum">1062</span></a>      switch(<a class="var it2267" onMouseOver="hilite(2267)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l1063"><span class="linenum">1063</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPS')" href="../../_constants/FEATURE_GROUPS.html" onMouseOver="constPopup(event,'FEATURE_GROUPS')">FEATURE_GROUPS</a>:
<a name="l1064"><span class="linenum">1064</span></a>              return true;
<a name="l1065"><span class="linenum">1065</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPINGS')" href="../../_constants/FEATURE_GROUPINGS.html" onMouseOver="constPopup(event,'FEATURE_GROUPINGS')">FEATURE_GROUPINGS</a>:
<a name="l1066"><span class="linenum">1066</span></a>              return true;
<a name="l1067"><span class="linenum">1067</span></a>          case <a class="constant" onClick="logConstant('FEATURE_MOD_INTRO')" href="../../_constants/FEATURE_MOD_INTRO.html" onMouseOver="constPopup(event,'FEATURE_MOD_INTRO')">FEATURE_MOD_INTRO</a>:
<a name="l1068"><span class="linenum">1068</span></a>              return true;
<a name="l1069"><span class="linenum">1069</span></a>          case <a class="constant" onClick="logConstant('FEATURE_COMPLETION_TRACKS_VIEWS')" href="../../_constants/FEATURE_COMPLETION_TRACKS_VIEWS.html" onMouseOver="constPopup(event,'FEATURE_COMPLETION_TRACKS_VIEWS')">FEATURE_COMPLETION_TRACKS_VIEWS</a>:
<a name="l1070"><span class="linenum">1070</span></a>              return true;
<a name="l1071"><span class="linenum">1071</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_HAS_GRADE')" href="../../_constants/FEATURE_GRADE_HAS_GRADE.html" onMouseOver="constPopup(event,'FEATURE_GRADE_HAS_GRADE')">FEATURE_GRADE_HAS_GRADE</a>:
<a name="l1072"><span class="linenum">1072</span></a>              return true;
<a name="l1073"><span class="linenum">1073</span></a>          case <a class="constant" onClick="logConstant('FEATURE_COMPLETION_HAS_RULES')" href="../../_constants/FEATURE_COMPLETION_HAS_RULES.html" onMouseOver="constPopup(event,'FEATURE_COMPLETION_HAS_RULES')">FEATURE_COMPLETION_HAS_RULES</a>:
<a name="l1074"><span class="linenum">1074</span></a>              return true;
<a name="l1075"><span class="linenum">1075</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_OUTCOMES')" href="../../_constants/FEATURE_GRADE_OUTCOMES.html" onMouseOver="constPopup(event,'FEATURE_GRADE_OUTCOMES')">FEATURE_GRADE_OUTCOMES</a>:
<a name="l1076"><span class="linenum">1076</span></a>              return true;
<a name="l1077"><span class="linenum">1077</span></a>          case <a class="constant" onClick="logConstant('FEATURE_BACKUP_MOODLE2')" href="../../_constants/FEATURE_BACKUP_MOODLE2.html" onMouseOver="constPopup(event,'FEATURE_BACKUP_MOODLE2')">FEATURE_BACKUP_MOODLE2</a>:
<a name="l1078"><span class="linenum">1078</span></a>              return true;
<a name="l1079"><span class="linenum">1079</span></a>          case <a class="constant" onClick="logConstant('FEATURE_SHOW_DESCRIPTION')" href="../../_constants/FEATURE_SHOW_DESCRIPTION.html" onMouseOver="constPopup(event,'FEATURE_SHOW_DESCRIPTION')">FEATURE_SHOW_DESCRIPTION</a>:
<a name="l1080"><span class="linenum">1080</span></a>              return true;
<a name="l1081"><span class="linenum">1081</span></a>          default:
<a name="l1082"><span class="linenum">1082</span></a>              return null;
<a name="l1083"><span class="linenum">1083</span></a>      }
<a name="l1084"><span class="linenum">1084</span></a>  }
<a name="l1085"><span class="linenum">1085</span></a>  
<a name="l1086"><span class="linenum">1086</span></a>  <span class="comment">/**</span>
<a name="l1087"><span class="linenum">1087</span></a>  <span class="comment"> * Obtains the automatic completion state for this lesson based on any conditions</span>
<a name="l1088"><span class="linenum">1088</span></a>  <span class="comment"> * in lesson settings.</span>
<a name="l1089"><span class="linenum">1089</span></a>  <span class="comment"> *</span>
<a name="l1090"><span class="linenum">1090</span></a>  <span class="comment"> * @param object $course Course</span>
<a name="l1091"><span class="linenum">1091</span></a>  <span class="comment"> * @param object $cm course-module</span>
<a name="l1092"><span class="linenum">1092</span></a>  <span class="comment"> * @param int $userid User ID</span>
<a name="l1093"><span class="linenum">1093</span></a>  <span class="comment"> * @param bool $type Type of comparison (or/and; can be used as return value if no conditions)</span>
<a name="l1094"><span class="linenum">1094</span></a>  <span class="comment"> * @return bool True if completed, false if not, $type if conditions not set.</span>
<a name="l1095"><span class="linenum">1095</span></a>  <span class="comment"> */</span>
<a name="l1096"><span class="linenum">1096</span></a>  function <a class="function" onClick="logFunction('lesson_get_completion_state')" href="../../_functions/lesson_get_completion_state.html" onMouseOver="funcPopup(event,'lesson_get_completion_state')">lesson_get_completion_state</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l1097"><span class="linenum">1097</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1098"><span class="linenum">1098</span></a>  
<a name="l1099"><span class="linenum">1099</span></a>  <span class="comment">    // Get lesson details.</span>
<a name="l1100"><span class="linenum">1100</span></a>      <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson', array('id' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>), '*',
<a name="l1101"><span class="linenum">1101</span></a>              <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1102"><span class="linenum">1102</span></a>  
<a name="l1103"><span class="linenum">1103</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>; <span class="comment">// Default return value.</span>
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment">    // If completion option is enabled, evaluate it and return true/false.</span>
<a name="l1105"><span class="linenum">1105</span></a>      if (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completionendreached')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/completionendreached.html">completionendreached</a>) {
<a name="l1106"><span class="linenum">1106</span></a>          <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('lesson_timer', array(
<a name="l1107"><span class="linenum">1107</span></a>                  'lessonid' =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'completed' =&gt; 1));
<a name="l1108"><span class="linenum">1108</span></a>          if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> == <a class="constant" onClick="logConstant('COMPLETION_AND')" href="../../_constants/COMPLETION_AND.html" onMouseOver="constPopup(event,'COMPLETION_AND')">COMPLETION_AND</a>) {
<a name="l1109"><span class="linenum">1109</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l1110"><span class="linenum">1110</span></a>          } else {
<a name="l1111"><span class="linenum">1111</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> || <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l1112"><span class="linenum">1112</span></a>          }
<a name="l1113"><span class="linenum">1113</span></a>      }
<a name="l1114"><span class="linenum">1114</span></a>      if (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completiontimespent')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/completiontimespent.html">completiontimespent</a> != 0) {
<a name="l1115"><span class="linenum">1115</span></a>          <a class="var it1221" onMouseOver="hilite(1221)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(
<a name="l1116"><span class="linenum">1116</span></a>                          &quot;SELECT <a class="function" onClick="logFunction('SUM')" href="../../_functions/sum.html" onMouseOver="funcPopup(event,'sum')">SUM</a>(lessontime - starttime)
<a name="l1117"><span class="linenum">1117</span></a>                                 FROM {lesson_timer}
<a name="l1118"><span class="linenum">1118</span></a>                                WHERE lessonid = :lessonid
<a name="l1119"><span class="linenum">1119</span></a>                                  AND userid = :userid&quot;,
<a name="l1120"><span class="linenum">1120</span></a>                          array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'lessonid' =&gt; <a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('id')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1121"><span class="linenum">1121</span></a>          if (!<a class="var it1221" onMouseOver="hilite(1221)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a>) {
<a name="l1122"><span class="linenum">1122</span></a>              <a class="var it1221" onMouseOver="hilite(1221)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a> = 0;
<a name="l1123"><span class="linenum">1123</span></a>          }
<a name="l1124"><span class="linenum">1124</span></a>          if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> == <a class="constant" onClick="logConstant('COMPLETION_AND')" href="../../_constants/COMPLETION_AND.html" onMouseOver="constPopup(event,'COMPLETION_AND')">COMPLETION_AND</a>) {
<a name="l1125"><span class="linenum">1125</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completiontimespent')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/completiontimespent.html">completiontimespent</a> &lt; <a class="var it1221" onMouseOver="hilite(1221)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a>);
<a name="l1126"><span class="linenum">1126</span></a>          } else {
<a name="l1127"><span class="linenum">1127</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> || (<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a>-&gt;<a onClick="logVariable('completiontimespent')" class="var it43331" onMouseOver="hilite(43331)" onMouseOut="lolite()" href="../../_variables/completiontimespent.html">completiontimespent</a> &lt; <a class="var it1221" onMouseOver="hilite(1221)" onMouseOut="lolite()" onClick="logVariable('duration')" href="../../_variables/duration.html">$duration</a>);
<a name="l1128"><span class="linenum">1128</span></a>          }
<a name="l1129"><span class="linenum">1129</span></a>      }
<a name="l1130"><span class="linenum">1130</span></a>      return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1131"><span class="linenum">1131</span></a>  }
<a name="l1132"><span class="linenum">1132</span></a>  <span class="comment">/**</span>
<a name="l1133"><span class="linenum">1133</span></a>  <span class="comment"> * This function extends the settings navigation block for the site.</span>
<a name="l1134"><span class="linenum">1134</span></a>  <span class="comment"> *</span>
<a name="l1135"><span class="linenum">1135</span></a>  <span class="comment"> * It is safe to rely on PAGE here as we will only ever be within the module</span>
<a name="l1136"><span class="linenum">1136</span></a>  <span class="comment"> * context when this is called</span>
<a name="l1137"><span class="linenum">1137</span></a>  <span class="comment"> *</span>
<a name="l1138"><span class="linenum">1138</span></a>  <span class="comment"> * @param settings_navigation $settings</span>
<a name="l1139"><span class="linenum">1139</span></a>  <span class="comment"> * @param navigation_node $lessonnode</span>
<a name="l1140"><span class="linenum">1140</span></a>  <span class="comment"> */</span>
<a name="l1141"><span class="linenum">1141</span></a>  function <a class="function" onClick="logFunction('lesson_extend_settings_navigation')" href="../../_functions/lesson_extend_settings_navigation.html" onMouseOver="funcPopup(event,'lesson_extend_settings_navigation')">lesson_extend_settings_navigation</a>(<a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>, <a class="var it26017" onMouseOver="hilite(26017)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>) {
<a name="l1142"><span class="linenum">1142</span></a>      global <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1143"><span class="linenum">1143</span></a>  
<a name="l1144"><span class="linenum">1144</span></a>  <span class="comment">    // We want to add these new nodes after the Edit settings node, and before the</span>
<a name="l1145"><span class="linenum">1145</span></a>  <span class="comment">    // Locally assigned roles node. Of course, both of those are controlled by capabilities.</span>
<a name="l1146"><span class="linenum">1146</span></a>      <a class="var it408" onMouseOver="hilite(408)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a> = <a class="var it26017" onMouseOver="hilite(26017)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('get_children_key_list')" href="../../_functions/get_children_key_list.html" onMouseOver="funcPopup(event,'get_children_key_list')">get_children_key_list</a>();
<a name="l1147"><span class="linenum">1147</span></a>      <a class="var it9840" onMouseOver="hilite(9840)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a> = null;
<a name="l1148"><span class="linenum">1148</span></a>      <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = <a class="phpfunction" onClick="logFunction('array_search')" href="../../_functions/array_search.html" onMouseOver="phpfuncPopup(event,'array_search')">array_search</a>('modedit', <a class="var it408" onMouseOver="hilite(408)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>);
<a name="l1149"><span class="linenum">1149</span></a>      if (<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> === false and <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(0, <a class="var it408" onMouseOver="hilite(408)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>)) {
<a name="l1150"><span class="linenum">1150</span></a>          <a class="var it9840" onMouseOver="hilite(9840)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a> = <a class="var it408" onMouseOver="hilite(408)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>[0];
<a name="l1151"><span class="linenum">1151</span></a>      } else if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> + 1, <a class="var it408" onMouseOver="hilite(408)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>)) {
<a name="l1152"><span class="linenum">1152</span></a>          <a class="var it9840" onMouseOver="hilite(9840)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a> = <a class="var it408" onMouseOver="hilite(408)" onMouseOut="lolite()" onClick="logVariable('keys')" href="../../_variables/keys.html">$keys</a>[<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> + 1];
<a name="l1153"><span class="linenum">1153</span></a>      }
<a name="l1154"><span class="linenum">1154</span></a>  
<a name="l1155"><span class="linenum">1155</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:manageoverrides', <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l1156"><span class="linenum">1156</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/overrides.php.html">/mod/lesson/overrides.php</a>', array('cmid' =&gt; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id));
<a name="l1157"><span class="linenum">1157</span></a>          <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a> = <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('groupoverrides', 'lesson'),
<a name="l1158"><span class="linenum">1158</span></a>                  <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, array('mode' =&gt; 'group')),
<a name="l1159"><span class="linenum">1159</span></a>                  <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'mod_lesson_groupoverrides');
<a name="l1160"><span class="linenum">1160</span></a>          <a class="var it26017" onMouseOver="hilite(26017)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add_node')" href="../../_functions/add_node.html" onMouseOver="funcPopup(event,'add_node')">add_node</a>(<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>, <a class="var it9840" onMouseOver="hilite(9840)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a>);
<a name="l1161"><span class="linenum">1161</span></a>  
<a name="l1162"><span class="linenum">1162</span></a>          <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a> = <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('useroverrides', 'lesson'),
<a name="l1163"><span class="linenum">1163</span></a>                  <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, array('mode' =&gt; 'user')),
<a name="l1164"><span class="linenum">1164</span></a>                  <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'mod_lesson_useroverrides');
<a name="l1165"><span class="linenum">1165</span></a>          <a class="var it26017" onMouseOver="hilite(26017)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add_node')" href="../../_functions/add_node.html" onMouseOver="funcPopup(event,'add_node')">add_node</a>(<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>, <a class="var it9840" onMouseOver="hilite(9840)" onMouseOut="lolite()" onClick="logVariable('beforekey')" href="../../_variables/beforekey.html">$beforekey</a>);
<a name="l1166"><span class="linenum">1166</span></a>      }
<a name="l1167"><span class="linenum">1167</span></a>  
<a name="l1168"><span class="linenum">1168</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:edit', <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l1169"><span class="linenum">1169</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/view.php.html">/mod/lesson/view.php</a>', array('id' =&gt; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id));
<a name="l1170"><span class="linenum">1170</span></a>          <a class="var it26017" onMouseOver="hilite(26017)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('preview', 'lesson'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1171"><span class="linenum">1171</span></a>          <a class="var it26018" onMouseOver="hilite(26018)" onMouseOut="lolite()" onClick="logVariable('editnode')" href="../../_variables/editnode.html">$editnode</a> = <a class="var it26017" onMouseOver="hilite(26017)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('edit', 'lesson'));
<a name="l1172"><span class="linenum">1172</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/edit.php.html">/mod/lesson/edit.php</a>', array('id' =&gt; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id, 'mode' =&gt; 'collapsed'));
<a name="l1173"><span class="linenum">1173</span></a>          <a class="var it26018" onMouseOver="hilite(26018)" onMouseOut="lolite()" onClick="logVariable('editnode')" href="../../_variables/editnode.html">$editnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('collapsed', 'lesson'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1174"><span class="linenum">1174</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/edit.php.html">/mod/lesson/edit.php</a>', array('id' =&gt; <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id, 'mode' =&gt; 'full'));
<a name="l1175"><span class="linenum">1175</span></a>          <a class="var it26018" onMouseOver="hilite(26018)" onMouseOut="lolite()" onClick="logVariable('editnode')" href="../../_variables/editnode.html">$editnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('full', 'lesson'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1176"><span class="linenum">1176</span></a>      }
<a name="l1177"><span class="linenum">1177</span></a>  
<a name="l1178"><span class="linenum">1178</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:viewreports', <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l1179"><span class="linenum">1179</span></a>          <a class="var it26019" onMouseOver="hilite(26019)" onMouseOut="lolite()" onClick="logVariable('reportsnode')" href="../../_variables/reportsnode.html">$reportsnode</a> = <a class="var it26017" onMouseOver="hilite(26017)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('reports', 'lesson'));
<a name="l1180"><span class="linenum">1180</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/report.php.html">/mod/lesson/report.php</a>', array('id'=&gt;<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id, 'action'=&gt;'reportoverview'));
<a name="l1181"><span class="linenum">1181</span></a>          <a class="var it26019" onMouseOver="hilite(26019)" onMouseOut="lolite()" onClick="logVariable('reportsnode')" href="../../_variables/reportsnode.html">$reportsnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('overview', 'lesson'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1182"><span class="linenum">1182</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/report.php.html">/mod/lesson/report.php</a>', array('id'=&gt;<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id, 'action'=&gt;'reportdetail'));
<a name="l1183"><span class="linenum">1183</span></a>          <a class="var it26019" onMouseOver="hilite(26019)" onMouseOut="lolite()" onClick="logVariable('reportsnode')" href="../../_variables/reportsnode.html">$reportsnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('detailedstats', 'lesson'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1184"><span class="linenum">1184</span></a>      }
<a name="l1185"><span class="linenum">1185</span></a>  
<a name="l1186"><span class="linenum">1186</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/lesson:grade', <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l1187"><span class="linenum">1187</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/lesson/essay.php.html">/mod/lesson/essay.php</a>', array('id'=&gt;<a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;id));
<a name="l1188"><span class="linenum">1188</span></a>          <a class="var it26017" onMouseOver="hilite(26017)" onMouseOut="lolite()" onClick="logVariable('lessonnode')" href="../../_variables/lessonnode.html">$lessonnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('manualgrading', 'lesson'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1189"><span class="linenum">1189</span></a>      }
<a name="l1190"><span class="linenum">1190</span></a>  
<a name="l1191"><span class="linenum">1191</span></a>  }
<a name="l1192"><span class="linenum">1192</span></a>  
<a name="l1193"><span class="linenum">1193</span></a>  <span class="comment">/**</span>
<a name="l1194"><span class="linenum">1194</span></a>  <span class="comment"> * Get list of available import or export formats</span>
<a name="l1195"><span class="linenum">1195</span></a>  <span class="comment"> *</span>
<a name="l1196"><span class="linenum">1196</span></a>  <span class="comment"> * Copied and modified from lib/questionlib.php</span>
<a name="l1197"><span class="linenum">1197</span></a>  <span class="comment"> *</span>
<a name="l1198"><span class="linenum">1198</span></a>  <span class="comment"> * @param string $type 'import' if import list, otherwise export list assumed</span>
<a name="l1199"><span class="linenum">1199</span></a>  <span class="comment"> * @return array sorted list of import/export formats available</span>
<a name="l1200"><span class="linenum">1200</span></a>  <span class="comment"> */</span>
<a name="l1201"><span class="linenum">1201</span></a>  function <a class="function" onClick="logFunction('lesson_get_import_export_formats')" href="../../_functions/lesson_get_import_export_formats.html" onMouseOver="funcPopup(event,'lesson_get_import_export_formats')">lesson_get_import_export_formats</a>(<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>) {
<a name="l1202"><span class="linenum">1202</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1203"><span class="linenum">1203</span></a>      <a class="var it26020" onMouseOver="hilite(26020)" onMouseOut="lolite()" onClick="logVariable('fileformats')" href="../../_variables/fileformats.html">$fileformats</a> = <a class="class" onClick="logClass('core_component')" href="../../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_list')" href="../../_functions/get_plugin_list.html" onMouseOver="funcPopup(event,'get_plugin_list')">get_plugin_list</a>(&quot;qformat&quot;);
<a name="l1204"><span class="linenum">1204</span></a>  
<a name="l1205"><span class="linenum">1205</span></a>      <a class="var it22158" onMouseOver="hilite(22158)" onMouseOut="lolite()" onClick="logVariable('fileformatname')" href="../../_variables/fileformatname.html">$fileformatname</a>=array();
<a name="l1206"><span class="linenum">1206</span></a>      foreach (<a class="var it26020" onMouseOver="hilite(26020)" onMouseOut="lolite()" onClick="logVariable('fileformats')" href="../../_variables/fileformats.html">$fileformats</a> as <a class="var it22160" onMouseOver="hilite(22160)" onMouseOut="lolite()" onClick="logVariable('fileformat')" href="../../_variables/fileformat.html">$fileformat</a>=&gt;<a class="var it2889" onMouseOver="hilite(2889)" onMouseOut="lolite()" onClick="logVariable('fdir')" href="../../_variables/fdir.html">$fdir</a>) {
<a name="l1207"><span class="linenum">1207</span></a>          <a class="var it26021" onMouseOver="hilite(26021)" onMouseOut="lolite()" onClick="logVariable('format_file')" href="../../_variables/format_file.html">$format_file</a> = &quot;<a class="var it2889" onMouseOver="hilite(2889)" onMouseOut="lolite()" onClick="logVariable('fdir')" href="../../_variables/fdir.html">$fdir</a>/format.php&quot;;
<a name="l1208"><span class="linenum">1208</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it26021" onMouseOver="hilite(26021)" onMouseOut="lolite()" onClick="logVariable('format_file')" href="../../_variables/format_file.html">$format_file</a>) ) {
<a name="l1209"><span class="linenum">1209</span></a>              require_once(<a class="var it26021" onMouseOver="hilite(26021)" onMouseOut="lolite()" onClick="logVariable('format_file')" href="../../_variables/format_file.html">$format_file</a>);
<a name="l1210"><span class="linenum">1210</span></a>          } else {
<a name="l1211"><span class="linenum">1211</span></a>              continue;
<a name="l1212"><span class="linenum">1212</span></a>          }
<a name="l1213"><span class="linenum">1213</span></a>          <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../../_variables/classname.html">$classname</a> = &quot;qformat_<a class="var it22160" onMouseOver="hilite(22160)" onMouseOut="lolite()" onClick="logVariable('fileformat')" href="../../_variables/fileformat.html">$fileformat</a>&quot;;
<a name="l1214"><span class="linenum">1214</span></a>          <a class="var it26022" onMouseOver="hilite(26022)" onMouseOut="lolite()" onClick="logVariable('format_class')" href="../../_variables/format_class.html">$format_class</a> = new <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../../_variables/classname.html">$classname</a>();
<a name="l1215"><span class="linenum">1215</span></a>          if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>=='import') {
<a name="l1216"><span class="linenum">1216</span></a>              <a class="var it22159" onMouseOver="hilite(22159)" onMouseOut="lolite()" onClick="logVariable('provided')" href="../../_variables/provided.html">$provided</a> = <a class="var it26022" onMouseOver="hilite(26022)" onMouseOut="lolite()" onClick="logVariable('format_class')" href="../../_variables/format_class.html">$format_class</a>-&gt;<a class="function" onClick="logFunction('provide_import')" href="../../_functions/provide_import.html" onMouseOver="funcPopup(event,'provide_import')">provide_import</a>();
<a name="l1217"><span class="linenum">1217</span></a>          } else {
<a name="l1218"><span class="linenum">1218</span></a>              <a class="var it22159" onMouseOver="hilite(22159)" onMouseOut="lolite()" onClick="logVariable('provided')" href="../../_variables/provided.html">$provided</a> = <a class="var it26022" onMouseOver="hilite(26022)" onMouseOut="lolite()" onClick="logVariable('format_class')" href="../../_variables/format_class.html">$format_class</a>-&gt;<a class="function" onClick="logFunction('provide_export')" href="../../_functions/provide_export.html" onMouseOver="funcPopup(event,'provide_export')">provide_export</a>();
<a name="l1219"><span class="linenum">1219</span></a>          }
<a name="l1220"><span class="linenum">1220</span></a>          if (<a class="var it22159" onMouseOver="hilite(22159)" onMouseOut="lolite()" onClick="logVariable('provided')" href="../../_variables/provided.html">$provided</a>) {
<a name="l1221"><span class="linenum">1221</span></a>              <a class="var it22161" onMouseOver="hilite(22161)" onMouseOut="lolite()" onClick="logVariable('fileformatnames')" href="../../_variables/fileformatnames.html">$fileformatnames</a>[<a class="var it22160" onMouseOver="hilite(22160)" onMouseOut="lolite()" onClick="logVariable('fileformat')" href="../../_variables/fileformat.html">$fileformat</a>] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', 'qformat_'.<a class="var it22160" onMouseOver="hilite(22160)" onMouseOut="lolite()" onClick="logVariable('fileformat')" href="../../_variables/fileformat.html">$fileformat</a>);
<a name="l1222"><span class="linenum">1222</span></a>          }
<a name="l1223"><span class="linenum">1223</span></a>      }
<a name="l1224"><span class="linenum">1224</span></a>      <a class="phpfunction" onClick="logFunction('natcasesort')" href="../../_functions/natcasesort.html" onMouseOver="phpfuncPopup(event,'natcasesort')">natcasesort</a>(<a class="var it22161" onMouseOver="hilite(22161)" onMouseOut="lolite()" onClick="logVariable('fileformatnames')" href="../../_variables/fileformatnames.html">$fileformatnames</a>);
<a name="l1225"><span class="linenum">1225</span></a>  
<a name="l1226"><span class="linenum">1226</span></a>      return <a class="var it22161" onMouseOver="hilite(22161)" onMouseOut="lolite()" onClick="logVariable('fileformatnames')" href="../../_variables/fileformatnames.html">$fileformatnames</a>;
<a name="l1227"><span class="linenum">1227</span></a>  }
<a name="l1228"><span class="linenum">1228</span></a>  
<a name="l1229"><span class="linenum">1229</span></a>  <span class="comment">/**</span>
<a name="l1230"><span class="linenum">1230</span></a>  <span class="comment"> * Serves the lesson attachments. Implements needed access control ;-)</span>
<a name="l1231"><span class="linenum">1231</span></a>  <span class="comment"> *</span>
<a name="l1232"><span class="linenum">1232</span></a>  <span class="comment"> * @package mod_lesson</span>
<a name="l1233"><span class="linenum">1233</span></a>  <span class="comment"> * @category files</span>
<a name="l1234"><span class="linenum">1234</span></a>  <span class="comment"> * @param stdClass $course course object</span>
<a name="l1235"><span class="linenum">1235</span></a>  <span class="comment"> * @param stdClass $cm course module object</span>
<a name="l1236"><span class="linenum">1236</span></a>  <span class="comment"> * @param stdClass $context context object</span>
<a name="l1237"><span class="linenum">1237</span></a>  <span class="comment"> * @param string $filearea file area</span>
<a name="l1238"><span class="linenum">1238</span></a>  <span class="comment"> * @param array $args extra arguments</span>
<a name="l1239"><span class="linenum">1239</span></a>  <span class="comment"> * @param bool $forcedownload whether or not force download</span>
<a name="l1240"><span class="linenum">1240</span></a>  <span class="comment"> * @param array $options additional options affecting the file serving</span>
<a name="l1241"><span class="linenum">1241</span></a>  <span class="comment"> * @return bool false if file not found, does not return if found - justsend the file</span>
<a name="l1242"><span class="linenum">1242</span></a>  <span class="comment"> */</span>
<a name="l1243"><span class="linenum">1243</span></a>  function <a class="function" onClick="logFunction('lesson_pluginfile')" href="../../_functions/lesson_pluginfile.html" onMouseOver="funcPopup(event,'lesson_pluginfile')">lesson_pluginfile</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('forcedownload')" href="../../_variables/forcedownload.html">$forcedownload</a>, array <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>=array()) {
<a name="l1244"><span class="linenum">1244</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1245"><span class="linenum">1245</span></a>  
<a name="l1246"><span class="linenum">1246</span></a>      if (<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l1247"><span class="linenum">1247</span></a>          return false;
<a name="l1248"><span class="linenum">1248</span></a>      }
<a name="l1249"><span class="linenum">1249</span></a>  
<a name="l1250"><span class="linenum">1250</span></a>      <a class="var it9842" onMouseOver="hilite(9842)" onMouseOut="lolite()" onClick="logVariable('fileareas')" href="../../_variables/fileareas.html">$fileareas</a> = <a class="function" onClick="logFunction('lesson_get_file_areas')" href="../../_functions/lesson_get_file_areas.html" onMouseOver="funcPopup(event,'lesson_get_file_areas')">lesson_get_file_areas</a>();
<a name="l1251"><span class="linenum">1251</span></a>      if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it9842" onMouseOver="hilite(9842)" onMouseOut="lolite()" onClick="logVariable('fileareas')" href="../../_variables/fileareas.html">$fileareas</a>)) {
<a name="l1252"><span class="linenum">1252</span></a>          return false;
<a name="l1253"><span class="linenum">1253</span></a>      }
<a name="l1254"><span class="linenum">1254</span></a>  
<a name="l1255"><span class="linenum">1255</span></a>      if (!<a class="var it1204" onMouseOver="hilite(1204)" onMouseOut="lolite()" onClick="logVariable('lesson')" href="../../_variables/lesson.html">$lesson</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson', array('id'=&gt;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>))) {
<a name="l1256"><span class="linenum">1256</span></a>          return false;
<a name="l1257"><span class="linenum">1257</span></a>      }
<a name="l1258"><span class="linenum">1258</span></a>  
<a name="l1259"><span class="linenum">1259</span></a>      <a class="function" onClick="logFunction('require_course_login')" href="../../_functions/require_course_login.html" onMouseOver="funcPopup(event,'require_course_login')">require_course_login</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, true, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1260"><span class="linenum">1260</span></a>  
<a name="l1261"><span class="linenum">1261</span></a>      if (<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'page_contents') {
<a name="l1262"><span class="linenum">1262</span></a>          <a class="var it987" onMouseOver="hilite(987)" onMouseOut="lolite()" onClick="logVariable('pageid')" href="../../_variables/pageid.html">$pageid</a> = (int)<a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1263"><span class="linenum">1263</span></a>          if (!<a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('page')" href="../../_variables/page.html">$page</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson_pages', array('id'=&gt;<a class="var it987" onMouseOver="hilite(987)" onMouseOut="lolite()" onClick="logVariable('pageid')" href="../../_variables/pageid.html">$pageid</a>))) {
<a name="l1264"><span class="linenum">1264</span></a>              return false;
<a name="l1265"><span class="linenum">1265</span></a>          }
<a name="l1266"><span class="linenum">1266</span></a>          <a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_lesson/<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/<a class="var it987" onMouseOver="hilite(987)" onMouseOut="lolite()" onClick="logVariable('pageid')" href="../../_variables/pageid.html">$pageid</a>/&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1267"><span class="linenum">1267</span></a>  
<a name="l1268"><span class="linenum">1268</span></a>      } else if (<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'page_answers' || <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'page_responses') {
<a name="l1269"><span class="linenum">1269</span></a>          <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = (int)<a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1270"><span class="linenum">1270</span></a>          if (!<a class="var it26023" onMouseOver="hilite(26023)" onMouseOut="lolite()" onClick="logVariable('pageanswers')" href="../../_variables/pageanswers.html">$pageanswers</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson_answers', array('id' =&gt; <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>))) {
<a name="l1271"><span class="linenum">1271</span></a>              return false;
<a name="l1272"><span class="linenum">1272</span></a>          }
<a name="l1273"><span class="linenum">1273</span></a>          <a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_lesson/<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>/&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1274"><span class="linenum">1274</span></a>  
<a name="l1275"><span class="linenum">1275</span></a>      } else if (<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'essay_responses') {
<a name="l1276"><span class="linenum">1276</span></a>          <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = (int)<a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1277"><span class="linenum">1277</span></a>          if (!<a class="var it550" onMouseOver="hilite(550)" onMouseOut="lolite()" onClick="logVariable('attempt')" href="../../_variables/attempt.html">$attempt</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('lesson_attempts', array('id' =&gt; <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>))) {
<a name="l1278"><span class="linenum">1278</span></a>              return false;
<a name="l1279"><span class="linenum">1279</span></a>          }
<a name="l1280"><span class="linenum">1280</span></a>          <a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_lesson/<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>/&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1281"><span class="linenum">1281</span></a>  
<a name="l1282"><span class="linenum">1282</span></a>      } else if (<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> === 'mediafile') {
<a name="l1283"><span class="linenum">1283</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>) &gt; 1) {
<a name="l1284"><span class="linenum">1284</span></a>  <span class="comment">            // Remove the itemid when it appears to be part of the arguments. If there is only one argument</span>
<a name="l1285"><span class="linenum">1285</span></a>  <span class="comment">            // then it is surely the file name. The itemid is sometimes used to prevent browser caching.</span>
<a name="l1286"><span class="linenum">1286</span></a>              <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1287"><span class="linenum">1287</span></a>          }
<a name="l1288"><span class="linenum">1288</span></a>          <a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_lesson/<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/0/&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l1289"><span class="linenum">1289</span></a>  
<a name="l1290"><span class="linenum">1290</span></a>      } else {
<a name="l1291"><span class="linenum">1291</span></a>          return false;
<a name="l1292"><span class="linenum">1292</span></a>      }
<a name="l1293"><span class="linenum">1293</span></a>  
<a name="l1294"><span class="linenum">1294</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l1295"><span class="linenum">1295</span></a>      if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file_by_hash')" href="../../_functions/get_file_by_hash.html" onMouseOver="funcPopup(event,'get_file_by_hash')">get_file_by_hash</a>(<a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a>)) or <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('is_directory')" href="../../_functions/is_directory.html" onMouseOver="funcPopup(event,'is_directory')">is_directory</a>()) {
<a name="l1296"><span class="linenum">1296</span></a>          return false;
<a name="l1297"><span class="linenum">1297</span></a>      }
<a name="l1298"><span class="linenum">1298</span></a>  
<a name="l1299"><span class="linenum">1299</span></a>  <span class="comment">    // finally send the file</span>
<a name="l1300"><span class="linenum">1300</span></a>      <a class="function" onClick="logFunction('send_stored_file')" href="../../_functions/send_stored_file.html" onMouseOver="funcPopup(event,'send_stored_file')">send_stored_file</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, 0, 0, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('forcedownload')" href="../../_variables/forcedownload.html">$forcedownload</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>); <span class="comment">// download MUST be forced - security!</span>
<a name="l1301"><span class="linenum">1301</span></a>  }
<a name="l1302"><span class="linenum">1302</span></a>  
<a name="l1303"><span class="linenum">1303</span></a>  <span class="comment">/**</span>
<a name="l1304"><span class="linenum">1304</span></a>  <span class="comment"> * Returns an array of file areas</span>
<a name="l1305"><span class="linenum">1305</span></a>  <span class="comment"> *</span>
<a name="l1306"><span class="linenum">1306</span></a>  <span class="comment"> * @package  mod_lesson</span>
<a name="l1307"><span class="linenum">1307</span></a>  <span class="comment"> * @category files</span>
<a name="l1308"><span class="linenum">1308</span></a>  <span class="comment"> * @return array a list of available file areas</span>
<a name="l1309"><span class="linenum">1309</span></a>  <span class="comment"> */</span>
<a name="l1310"><span class="linenum">1310</span></a>  function <a class="function" onClick="logFunction('lesson_get_file_areas')" href="../../_functions/lesson_get_file_areas.html" onMouseOver="funcPopup(event,'lesson_get_file_areas')">lesson_get_file_areas</a>() {
<a name="l1311"><span class="linenum">1311</span></a>      <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a> = array();
<a name="l1312"><span class="linenum">1312</span></a>      <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['page_contents'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pagecontents', 'mod_lesson');
<a name="l1313"><span class="linenum">1313</span></a>      <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['mediafile'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('mediafile', 'mod_lesson');
<a name="l1314"><span class="linenum">1314</span></a>      <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['page_answers'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pageanswers', 'mod_lesson');
<a name="l1315"><span class="linenum">1315</span></a>      <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['page_responses'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pageresponses', 'mod_lesson');
<a name="l1316"><span class="linenum">1316</span></a>      <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['essay_responses'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('essayresponses', 'mod_lesson');
<a name="l1317"><span class="linenum">1317</span></a>      return <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>;
<a name="l1318"><span class="linenum">1318</span></a>  }
<a name="l1319"><span class="linenum">1319</span></a>  
<a name="l1320"><span class="linenum">1320</span></a>  <span class="comment">/**</span>
<a name="l1321"><span class="linenum">1321</span></a>  <span class="comment"> * Returns a file_info_stored object for the file being requested here</span>
<a name="l1322"><span class="linenum">1322</span></a>  <span class="comment"> *</span>
<a name="l1323"><span class="linenum">1323</span></a>  <span class="comment"> * @package  mod_lesson</span>
<a name="l1324"><span class="linenum">1324</span></a>  <span class="comment"> * @category files</span>
<a name="l1325"><span class="linenum">1325</span></a>  <span class="comment"> * @global stdClass $CFG</span>
<a name="l1326"><span class="linenum">1326</span></a>  <span class="comment"> * @param file_browse $browser file browser instance</span>
<a name="l1327"><span class="linenum">1327</span></a>  <span class="comment"> * @param array $areas file areas</span>
<a name="l1328"><span class="linenum">1328</span></a>  <span class="comment"> * @param stdClass $course course object</span>
<a name="l1329"><span class="linenum">1329</span></a>  <span class="comment"> * @param stdClass $cm course module object</span>
<a name="l1330"><span class="linenum">1330</span></a>  <span class="comment"> * @param stdClass $context context object</span>
<a name="l1331"><span class="linenum">1331</span></a>  <span class="comment"> * @param string $filearea file area</span>
<a name="l1332"><span class="linenum">1332</span></a>  <span class="comment"> * @param int $itemid item ID</span>
<a name="l1333"><span class="linenum">1333</span></a>  <span class="comment"> * @param string $filepath file path</span>
<a name="l1334"><span class="linenum">1334</span></a>  <span class="comment"> * @param string $filename file name</span>
<a name="l1335"><span class="linenum">1335</span></a>  <span class="comment"> * @return file_info_stored</span>
<a name="l1336"><span class="linenum">1336</span></a>  <span class="comment"> */</span>
<a name="l1337"><span class="linenum">1337</span></a>  function <a class="function" onClick="logFunction('lesson_get_file_info')" href="../../_functions/lesson_get_file_info.html" onMouseOver="funcPopup(event,'lesson_get_file_info')">lesson_get_file_info</a>(<a class="var it1462" onMouseOver="hilite(1462)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) {
<a name="l1338"><span class="linenum">1338</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1339"><span class="linenum">1339</span></a>  
<a name="l1340"><span class="linenum">1340</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:managefiles', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1341"><span class="linenum">1341</span></a>  <span class="comment">        // No peaking here for students!</span>
<a name="l1342"><span class="linenum">1342</span></a>          return null;
<a name="l1343"><span class="linenum">1343</span></a>      }
<a name="l1344"><span class="linenum">1344</span></a>  
<a name="l1345"><span class="linenum">1345</span></a>  <span class="comment">    // Mediafile area does not have sub directories, so let's select the default itemid to prevent</span>
<a name="l1346"><span class="linenum">1346</span></a>  <span class="comment">    // the user from selecting a directory to access the mediafile content.</span>
<a name="l1347"><span class="linenum">1347</span></a>      if (<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> == 'mediafile' &amp;&amp; <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>)) {
<a name="l1348"><span class="linenum">1348</span></a>          <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = 0;
<a name="l1349"><span class="linenum">1349</span></a>      }
<a name="l1350"><span class="linenum">1350</span></a>  
<a name="l1351"><span class="linenum">1351</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>)) {
<a name="l1352"><span class="linenum">1352</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('mod_lesson_file_info')" href="../../_classes/mod_lesson_file_info.html" onMouseOver="classPopup(event,'mod_lesson_file_info')">mod_lesson_file_info</a>(<a class="var it1462" onMouseOver="hilite(1462)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>);
<a name="l1353"><span class="linenum">1353</span></a>      }
<a name="l1354"><span class="linenum">1354</span></a>  
<a name="l1355"><span class="linenum">1355</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l1356"><span class="linenum">1356</span></a>      <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>) ? '/' : <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>;
<a name="l1357"><span class="linenum">1357</span></a>      <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) ? '.' : <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>;
<a name="l1358"><span class="linenum">1358</span></a>      if (!<a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file')" href="../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_lesson', <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>)) {
<a name="l1359"><span class="linenum">1359</span></a>          return null;
<a name="l1360"><span class="linenum">1360</span></a>      }
<a name="l1361"><span class="linenum">1361</span></a>  
<a name="l1362"><span class="linenum">1362</span></a>      <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a> = <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>;
<a name="l1363"><span class="linenum">1363</span></a>      if (<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> == 'page_contents') {
<a name="l1364"><span class="linenum">1364</span></a>          <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('lesson_pages', 'title', array('lessonid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>, 'id' =&gt; <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>));
<a name="l1365"><span class="linenum">1365</span></a>          <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>, true, array('context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>));
<a name="l1366"><span class="linenum">1366</span></a>      } else {
<a name="l1367"><span class="linenum">1367</span></a>          <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a> = <a class="function" onClick="logFunction('lesson_get_file_areas')" href="../../_functions/lesson_get_file_areas.html" onMouseOver="funcPopup(event,'lesson_get_file_areas')">lesson_get_file_areas</a>();
<a name="l1368"><span class="linenum">1368</span></a>          if (isset(<a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>[<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>])) {
<a name="l1369"><span class="linenum">1369</span></a>              <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a> = <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>[<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>];
<a name="l1370"><span class="linenum">1370</span></a>          }
<a name="l1371"><span class="linenum">1371</span></a>      }
<a name="l1372"><span class="linenum">1372</span></a>  
<a name="l1373"><span class="linenum">1373</span></a>      <a class="var it2276" onMouseOver="hilite(2276)" onMouseOut="lolite()" onClick="logVariable('urlbase')" href="../../_variables/urlbase.html">$urlbase</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a> . '<a class="filename" href="../../pluginfile.php.html">/pluginfile.php</a>';
<a name="l1374"><span class="linenum">1374</span></a>      return <span class="keyword">new </span><a class="class" onClick="logClass('file_info_stored')" href="../../_classes/file_info_stored.html" onMouseOver="classPopup(event,'file_info_stored')">file_info_stored</a>(<a class="var it1462" onMouseOver="hilite(1462)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>, <a class="var it2276" onMouseOver="hilite(2276)" onMouseOut="lolite()" onClick="logVariable('urlbase')" href="../../_variables/urlbase.html">$urlbase</a>, <a class="var it979" onMouseOver="hilite(979)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, true, true, false);
<a name="l1375"><span class="linenum">1375</span></a>  }
<a name="l1376"><span class="linenum">1376</span></a>  
<a name="l1377"><span class="linenum">1377</span></a>  
<a name="l1378"><span class="linenum">1378</span></a>  <span class="comment">/**</span>
<a name="l1379"><span class="linenum">1379</span></a>  <span class="comment"> * Return a list of page types</span>
<a name="l1380"><span class="linenum">1380</span></a>  <span class="comment"> * @param string $pagetype current page type</span>
<a name="l1381"><span class="linenum">1381</span></a>  <span class="comment"> * @param stdClass $parentcontext Block's parent context</span>
<a name="l1382"><span class="linenum">1382</span></a>  <span class="comment"> * @param stdClass $currentcontext Current context of block</span>
<a name="l1383"><span class="linenum">1383</span></a>  <span class="comment"> */</span>
<a name="l1384"><span class="linenum">1384</span></a>  function <a class="function" onClick="logFunction('lesson_page_type_list')" href="../../_functions/lesson_page_type_list.html" onMouseOver="funcPopup(event,'lesson_page_type_list')">lesson_page_type_list</a>(<a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../../_variables/pagetype.html">$pagetype</a>, <a class="var it2279" onMouseOver="hilite(2279)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../../_variables/parentcontext.html">$parentcontext</a>, <a class="var it2280" onMouseOver="hilite(2280)" onMouseOut="lolite()" onClick="logVariable('currentcontext')" href="../../_variables/currentcontext.html">$currentcontext</a>) {
<a name="l1385"><span class="linenum">1385</span></a>      <a class="var it9844" onMouseOver="hilite(9844)" onMouseOut="lolite()" onClick="logVariable('module_pagetype')" href="../../_variables/module_pagetype.html">$module_pagetype</a> = array(
<a name="l1386"><span class="linenum">1386</span></a>          'mod-lesson-*'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-lesson-x', 'lesson'),
<a name="l1387"><span class="linenum">1387</span></a>          'mod-lesson-view'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-lesson-view', 'lesson'),
<a name="l1388"><span class="linenum">1388</span></a>          'mod-lesson-edit'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-lesson-edit', 'lesson'));
<a name="l1389"><span class="linenum">1389</span></a>      return <a class="var it9844" onMouseOver="hilite(9844)" onMouseOut="lolite()" onClick="logVariable('module_pagetype')" href="../../_variables/module_pagetype.html">$module_pagetype</a>;
<a name="l1390"><span class="linenum">1390</span></a>  }
<a name="l1391"><span class="linenum">1391</span></a>  
<a name="l1392"><span class="linenum">1392</span></a>  <span class="comment">/**</span>
<a name="l1393"><span class="linenum">1393</span></a>  <span class="comment"> * Update the lesson activity to include any file</span>
<a name="l1394"><span class="linenum">1394</span></a>  <span class="comment"> * that was uploaded, or if there is none, set the</span>
<a name="l1395"><span class="linenum">1395</span></a>  <span class="comment"> * mediafile field to blank.</span>
<a name="l1396"><span class="linenum">1396</span></a>  <span class="comment"> *</span>
<a name="l1397"><span class="linenum">1397</span></a>  <span class="comment"> * @param int $lessonid the lesson id</span>
<a name="l1398"><span class="linenum">1398</span></a>  <span class="comment"> * @param stdClass $context the context</span>
<a name="l1399"><span class="linenum">1399</span></a>  <span class="comment"> * @param int $draftitemid the draft item</span>
<a name="l1400"><span class="linenum">1400</span></a>  <span class="comment"> */</span>
<a name="l1401"><span class="linenum">1401</span></a>  function <a class="function" onClick="logFunction('lesson_update_media_file')" href="../../_functions/lesson_update_media_file.html" onMouseOver="funcPopup(event,'lesson_update_media_file')">lesson_update_media_file</a>(<a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>) {
<a name="l1402"><span class="linenum">1402</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1403"><span class="linenum">1403</span></a>  
<a name="l1404"><span class="linenum">1404</span></a>  <span class="comment">    // Set the filestorage object.</span>
<a name="l1405"><span class="linenum">1405</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l1406"><span class="linenum">1406</span></a>  <span class="comment">    // Save the file if it exists that is currently in the draft area.</span>
<a name="l1407"><span class="linenum">1407</span></a>      <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_lesson', 'mediafile', 0);
<a name="l1408"><span class="linenum">1408</span></a>  <span class="comment">    // Get the file if it exists.</span>
<a name="l1409"><span class="linenum">1409</span></a>      <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_lesson', 'mediafile', 0, 'itemid, filepath, filename', false);
<a name="l1410"><span class="linenum">1410</span></a>  <span class="comment">    // Check that there is a file to process.</span>
<a name="l1411"><span class="linenum">1411</span></a>      if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>) == 1) {
<a name="l1412"><span class="linenum">1412</span></a>  <span class="comment">        // Get the first (and only) file.</span>
<a name="l1413"><span class="linenum">1413</span></a>          <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>);
<a name="l1414"><span class="linenum">1414</span></a>  <span class="comment">        // Set the mediafile column in the lessons table.</span>
<a name="l1415"><span class="linenum">1415</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('lesson', 'mediafile', '/' . <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>(), array('id' =&gt; <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>));
<a name="l1416"><span class="linenum">1416</span></a>      } else {
<a name="l1417"><span class="linenum">1417</span></a>  <span class="comment">        // Set the mediafile column in the lessons table.</span>
<a name="l1418"><span class="linenum">1418</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('lesson', 'mediafile', '', array('id' =&gt; <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('lessonid')" href="../../_variables/lessonid.html">$lessonid</a>));
<a name="l1419"><span class="linenum">1419</span></a>      }
<a name="l1420"><span class="linenum">1420</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'box': ['box', 'Outputs a box. ', [['lib','outputrenderers.php',3089]], 288],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'lesson_pluginfile': ['lesson_pluginfile', 'Serves the lesson attachments. Implements needed access control ;-) ', [['mod/lesson','lib.php',1229]], 0],
'format_module_intro': ['format_module_intro', 'Formats activity intro text ', [['lib','weblib.php',1542]], 65],
'add_node': ['add_node', 'Add a node to this category. ', [['user/classes/output/myprofile','category.php',83],['lib','navigationlib.php',323],['user/classes/output/myprofile','tree.php',52]], 101],
'send_stored_file': ['send_stored_file', 'Handles the sending of file data to the user\'s browser, including support for byteranges etc. ', [['lib','filelib.php',2192]], 75],
'avg': ['avg', 'Average grade for the attempts selected by $this->whichattempts ', [['mod/quiz/report/statistics/classes','calculated.php',100]], 19],
'lesson_reset_userdata': ['lesson_reset_userdata', 'Actual implementation of the reset course functionality, delete all the lesson attempts for course $data->courseid. ', [['mod/lesson','lib.php',959]], 0],
'grade_get_grades': ['grade_get_grades', 'Returns grading information for given activity, optionally with user grades Manual, course or category items can not be queried. ', [['lib','gradelib.php',408]], 53],
'get_file': ['get_file', 'Downloads a repository file and saves to a path. ', [['repository/boxnet','lib.php',179],['repository/flickr_public','lib.php',453],['repository/dropbox','lib.php',410],['repository/skydrive','lib.php',130],['repository','lib.php',1647],['repository/s3','lib.php',227],['repository/equella','lib.php',166],['mod/data/field/picture','field.class.php',126],['mod/data/field/file','field.class.php',123],['repository/googledocs','lib.php',408],['lib/filestorage','file_storage.php',700],['repository/webdav','lib.php',73],['repository/filesystem','lib.php',398],['repository/flickr','lib.php',277],['lib','externallib.php',1076],['repository/dropbox','locallib.php',114],['lib','webdavlib.php',391]], 169],
'require_course_login': ['require_course_login', 'Weaker version of require_login() ', [['lib','moodlelib.php',2902]], 68],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'record_exists': ['record_exists', 'Check if a record exists by ID. ', [['competency/classes','persistent.php',842],['lib/dml','moodle_database.php',1817]], 901],
'get_area_files': ['get_area_files', 'Returns all area files (optionally limited by itemid) ', [['lib/filestorage','file_storage.php',782],['lib','externallib.php',1134]], 216],
'shift_course_mod_dates': ['shift_course_mod_dates', 'Change dates in module - used from course reset. ', [['lib','moodlelib.php',5026]], 10],
'execute': ['execute', 'Run langpack update ', [['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['backup/converter/imscc1','lib.php',84],['lib/classes/task','blog_cron_task.php',40],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/dml','pdo_moodle_database.php',227],['lib/classes/task','tag_cron_task.php',42],['enrol/imsenterprise/classes/task','cron_task.php',43],['lib/classes/task','completion_daily_task.php',42],['lib/google/src/Google/Http','Batch.php',61],['lib/dml','oci_native_moodle_database.php',1048],['lib/classes/task','context_cleanup_task.php',41],['backup/util/plan','backup_structure_step.class.php',50],['backup/util/ui','restore_ui.class.php',206],['webservice','lib.php',1319],['lib/classes/task','stats_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['lib/classes/task','legacy_plugin_cron_task.php',42],['backup/moodle2','restore_activity_task.class.php',189],['lib/classes/task','portfolio_cron_task.php',40],['lib/google/src/Google/Http','REST.php',27],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['backup/converter/imscc11','backuplib.php',42],['lib/classes/task','question_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',62],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/adodb/drivers','adodb-pdo.inc.php',559],['lib/editor/atto/classes/task','autosave_cleanup_task.php',42],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',43],['lib/classes/task','completion_regular_task.php',42],['lib/adodb/drivers','adodb-oci8po.inc.php',54],['lib/classes/task','events_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',47],['auth/cas/classes/task','sync_task.php',43],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',43],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['backup/util/helper','restore_decode_processor.class.php',73],['lib/behat','behat_base.php',840],['enrol/flatfile/classes/task','flatfile_sync_task.php',46],['lib/classes/task','registration_cron_task.php',40],['backup/moodle2','backup_section_task.class.php',97],['lib/classes/task','check_for_updates_task.php',40],['backup/util/plan/tests/fixtures','plan_fixtures.php',48],['backup/util/plan/tests/fixtures','plan_fixtures.php',56],['mod/forum/classes/task','cron_task.php',39],['lib/classes/task','send_failed_login_notifications_task.php',43],['enrol/lti/classes/task','sync_grades.php',45],['lib/dml','pgsql_native_moodle_database.php',665],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/classes/update','validator.php',117],['lib/google/src/Google','Client.php',574],['lib/dml','mssql_native_moodle_database.php',711],['mod/lti/service/profile/classes/local/resource','profile.php',76],['backup/util/plan','backup_plan.class.php',112],['lib/dml','mysqli_native_moodle_database.php',963],['backup/util/ui','backup_ui.class.php',122],['admin/tool/monitor/classes/task','clean_events.php',41],['backup/converter/moodle1','backuplib.php',10],['backup/converter/imscc11','lib.php',85],['lib/classes/task','grade_cron_task.php',40],['lib/classes/task','file_temp_cleanup_task.php',40],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['filter/tex','latex.php',70],['lib/adodb','adodb.inc.php',1088],['lib/classes/task','plagiarism_cron_task.php',40],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['backup/converter/moodle1','lib.php',142],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','search_index_task.php',44],['enrol/lti/classes/task','sync_members.php',55],['lib/classes/task','session_cleanup_task.php',40],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['lib/classes/task','backup_cleanup_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','badges_cron_task.php',40],['admin/tool/uploadcourse/classes','processor.php',174],['lib/classes/task','calendar_cron_task.php',40],['backup/util/plan','base_plan.class.php',158],['auth/ldap/classes/task','sync_task.php',43],['lib/adodb/drivers','adodb-oci8.inc.php',920],['backup/util/plan','restore_plan.class.php',159],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['lib/dml','sqlsrv_native_moodle_database.php',795],['lib/classes/task','create_contexts_task.php',40],['lib/classes/task','file_trash_cleanup_task.php',40],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',46],['lib/classes/task','complete_plans_task.php',52],['lib/classes/task','messaging_cleanup_task.php',40],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','cache_cleanup_task.php',40],['backup/moodle2','backup_activity_task.class.php',211],['filter/tex','texdebug.php',287],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','search_optimize_task.php',47],['mod/assign','adminlib.php',342],['lib/classes/task','delete_incomplete_users_task.php',40],['lib/classes/task','automated_backup_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','restore_execution_step.class.php',25],['lib/classes/task','sync_plans_from_template_cohorts_task.php',50],['admin/tool/monitor/classes','notification_task.php',39],['lib/dml/tests','dml_test.php',5543],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',60],['admin/tool/monitor/classes/task','check_subscriptions.php',60],['backup/util/interfaces','executable.class.php',32],['backup/util/plan','base_task.class.php',162]], 1058],
'box_end': ['box_end', 'Outputs the closing section of a box. ', [['lib','outputrenderers.php',3117]], 257],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'delete': ['delete', 'Deletes an item from the cache store. ', [['cache/stores/static','lib.php',374],['cache','disabledlib.php',102],['lib/google/src/Google/Service','AdSense.php',1258],['lib/google/src/Google/Service','AdSense.php',1730],['lib/grade','grade_item.php',396],['lib/google/src/Google/Service','Replicapool.php',378],['lib/google/src/Google/Service','Tasks.php',310],['lib/google/src/Google/Service','Tasks.php',428],['lib/google/src/Google/Service','AndroidPublisher.php',1230],['lib/google/src/Google/Service','AndroidPublisher.php',1310],['lib/google/src/Google/Service','AndroidPublisher.php',1668],['lib/google/src/Google/Service','AndroidPublisher.php',1763],['lib/google/src/Google/Service','AndroidPublisher.php',2083],['lib/google/src/Google/Service','YouTubeReporting.php',255],['lib/google/src/Google/Service','Reseller.php',441],['lib/google/src/Google/Cache','Memcache.php',144],['lib','filelib.php',3481],['lib/google/src/Google/Service','Computeaccounts.php',418],['lib/google/src/Google/Service','Computeaccounts.php',497],['lib/google/src/Google/Service','Computeaccounts.php',668],['lib/grade','grade_category.php',281],['lib/grade','grade_scale.php',136],['lib/adodb','adodb-active-record.inc.php',901],['lib/grade','grade_object.php',270],['lib/google/src/Google/Service','YouTubeAnalytics.php',352],['lib/google/src/Google/Service','YouTubeAnalytics.php',447],['lib/google/src/Google/Service','MapsEngine.php',1693],['lib/google/src/Google/Service','MapsEngine.php',1991],['lib/google/src/Google/Service','MapsEngine.php',2344],['lib/google/src/Google/Service','MapsEngine.php',2651],['lib/google/src/Google/Service','MapsEngine.php',2912],['completion','data_object.php',273],['lib/google/src/Google/Cache','File.php',115],['cache/classes','dummystore.php',198],['lib/google/src/Google/Service','Dns.php',378],['cache/classes','loaders.php',792],['cache/classes','loaders.php',1471],['cache/classes','loaders.php',1841],['lib/google/src/Google/Service','Appengine.php',352],['lib/google/src/Google/Service','Appengine.php',455],['tag/classes','collection.php',260],['lib/filebrowser','file_info.php',418],['lib/google/src/Google/Service','AdExchangeBuyer.php',938],['lib/google/src/Google/Service','AdExchangeBuyer.php',1137],['lib/google/src/Google/Service','AdExchangeBuyer.php',1561],['lib/filebrowser','virtual_root_file.php',69],['lib/google/src/Google/Service','Books.php',1946],['lib/grade','grade_grade.php',1024],['lib/grade','grade_outcome.php',97],['lib/google/src/Google/Service','Analytics.php',2165],['lib/google/src/Google/Service','Analytics.php',2534],['lib/google/src/Google/Service','Analytics.php',2655],['lib/google/src/Google/Service','Analytics.php',2872],['lib/google/src/Google/Service','Analytics.php',3001],['lib/google/src/Google/Service','Analytics.php',3092],['lib/google/src/Google/Service','Analytics.php',3406],['lib/google/src/Google/Service','Analytics.php',3631],['lib/google/src/Google/Service','DeploymentManager.php',452],['lib/google/src/Google/Service','Blogger.php',1065],['lib/google/src/Google/Service','Blogger.php',1227],['lib/google/src/Google/Service','Blogger.php',1451],['lib/filebrowser','file_info_stored.php',631],['competency/classes','persistent.php',510],['lib/google/src/Google/Service','CloudUserAccounts.php',528],['lib/google/src/Google/Service','CloudUserAccounts.php',628],['lib/google/src/Google/Service','CloudUserAccounts.php',893],['lib/google/src/Google/Service','Cloudresourcemanager.php',390],['lib/htmlpurifier/HTMLPurifier','Zipper.php',89],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',960],['lib/google/src/Google/Service','TagManager.php',1022],['lib/google/src/Google/Service','TagManager.php',1113],['lib/google/src/Google/Service','TagManager.php',1265],['lib/google/src/Google/Service','TagManager.php',1358],['lib/google/src/Google/Service','TagManager.php',1452],['lib/google/src/Google/Service','TagManager.php',1546],['lib/google/src/Google/Service','TagManager.php',1696],['mod/lesson','locallib.php',1037],['mod/lesson','locallib.php',2271],['repository','lib.php',427],['repository','lib.php',1962],['admin/tool/uploadcourse/classes','course.php',226],['lib','badgeslib.php',640],['lib/google/src/Google/Service','Bigquery.php',531],['lib/google/src/Google/Service','Bigquery.php',863],['lib/google/src/Google/Service','ShoppingContent.php',1050],['lib/google/src/Google/Service','ShoppingContent.php',1448],['lib/google/src/Google/Service','ShoppingContent.php',1970],['lib/google/src/Google/Service','Webmasters.php',355],['lib/google/src/Google/Service','Webmasters.php',449],['lib/google/src/Google/Service','Clouddebugger.php',384],['lib/filestorage','stored_file.php',323],['lib/google/src/Google/Service','Container.php',309],['lib/google/src/Google/Service','Storage.php',1042],['lib/google/src/Google/Service','Storage.php',1157],['lib/google/src/Google/Service','Storage.php',1332],['lib/google/src/Google/Service','Storage.php',1454],['lib/google/src/Google/Service','Storage.php',1681],['cache/stores/memcache','lib.php',401],['lib/google/src/Google/Service','Genomics.php',646],['lib/google/src/Google/Service','Genomics.php',735],['lib/google/src/Google/Service','Genomics.php',903],['lib/google/src/Google/Service','Genomics.php',971],['lib/google/src/Google/Service','Genomics.php',1326],['lib/google/src/Google/Service','Genomics.php',1443],['lib/google/src/Google/Service','Licensing.php',224],['lib/google/src/Google/Service','Fitness.php',400],['lib/google/src/Google/Service','Fitness.php',512],['lib/google/src/Google/Service','Fitness.php',647],['comment','lib.php',790],['lib/google/src/Google/Service','Gmail.php',763],['lib/google/src/Google/Service','Gmail.php',921],['lib/google/src/Google/Service','Gmail.php',1014],['lib/google/src/Google/Service','Gmail.php',1234],['lib/google/src/Google/Service','Taskqueue.php',293],['lib/adodb','adodb-active-recordx.inc.php',1016],['lib','accesslib.php',5580],['cache/classes','interfaces.php',161],['lib/google/src/Google/Service','Autoscaler.php',315],['lib/google/src/Google/Service','Autoscaler.php',429],['lib/google/src/Google/Service','Prediction.php',262],['lib/google/src/Google/Service','SiteVerification.php',139],['lib/google/src/Google/Service','Drive.php',1522],['lib/google/src/Google/Service','Drive.php',1603],['lib/google/src/Google/Service','Drive.php',1748],['lib/google/src/Google/Service','Drive.php',2040],['lib/google/src/Google/Service','Drive.php',2110],['lib/google/src/Google/Service','Drive.php',2240],['lib/google/src/Google/Service','Drive.php',2403],['lib/google/src/Google/Service','Drive.php',2523],['lib/google/src/Google/Service','Proximitybeacon.php',522],['lib/google/src/Google/Service','Directory.php',1683],['lib/google/src/Google/Service','Directory.php',1916],['lib/google/src/Google/Service','Directory.php',1989],['lib/google/src/Google/Service','Directory.php',2059],['lib/google/src/Google/Service','Directory.php',2169],['lib/google/src/Google/Service','Directory.php',2224],['lib/google/src/Google/Service','Directory.php',2351],['lib/google/src/Google/Service','Directory.php',2420],['lib/google/src/Google/Service','Directory.php',2517],['lib/google/src/Google/Service','Directory.php',2652],['lib/google/src/Google/Service','Directory.php',2731],['lib/google/src/Google/Service','Directory.php',2836],['lib/google/src/Google/Service','Directory.php',2938],['lib/google/src/Google/Service','Directory.php',2999],['lib/google/src/Google/Service','Directory.php',3199],['lib/google/src/Google/Service','Directory.php',3274],['lib/google/src/Google/Service','Fusiontables.php',645],['lib/google/src/Google/Service','Fusiontables.php',812],['lib/google/src/Google/Service','Fusiontables.php',937],['lib/google/src/Google/Service','Fusiontables.php',1126],['lib/google/src/Google/Service','Fusiontables.php',1188],['lib/google/src/Google/Service','AdSenseHost.php',734],['lib/google/src/Google/Service','AdSenseHost.php',1010],['lib/google/src/Google/Service','AdSenseHost.php',1168],['lib/google/src/Google/Service','Mirror.php',425],['lib/google/src/Google/Service','Mirror.php',593],['lib/google/src/Google/Service','Mirror.php',661],['lib/google/src/Google/Service','Mirror.php',772],['tag/classes','area.php',187],['lib/google/src/Google/Service','AndroidEnterprise.php',988],['lib/google/src/Google/Service','AndroidEnterprise.php',1092],['lib/google/src/Google/Service','AndroidEnterprise.php',1280],['lib/google/src/Google/Service','AndroidEnterprise.php',1415],['lib/google/src/Google/Service','AndroidEnterprise.php',1597],['course','lib.php',3263],['mnet','peer.php',118],['search/tests/fixtures','mock_search_engine.php',48],['lib/google/src/Google/Service','Calendar.php',903],['lib/google/src/Google/Service','Calendar.php',1071],['lib/google/src/Google/Service','Calendar.php',1269],['lib/google/src/Google/Service','Calendar.php',1412],['cache/stores/session','lib.php',417],['blog','locallib.php',322],['lib/google/src/Google/Service','Storagetransfer.php',381],['cache/stores/mongodb','lib.php',361],['lib/google/src/Google/Cache','Null.php',53],['lib/google/src/Google/Service','GamesConfiguration.php',251],['lib/google/src/Google/Service','GamesConfiguration.php',390],['cache/stores/file','lib.php',393],['badges/criteria','award_criteria.php',330],['cache/stores/memcached','lib.php',402],['lib/google/src/Google/Service','AppState.php',154],['lib/google/src/Google/Service','Resourceviews.php',423],['lib/portfolio','plugin.php',692],['calendar','lib.php',2423],['lib/google/src/Google/Service','Classroom.php',466],['lib/google/src/Google/Service','Classroom.php',615],['lib/google/src/Google/Service','Classroom.php',701],['lib/google/src/Google/Service','Classroom.php',806],['lib/google/src/Google/Service','Classroom.php',934],['lib/google/src/Google/Service','SQLAdmin.php',786],['lib/google/src/Google/Service','SQLAdmin.php',856],['lib/google/src/Google/Service','SQLAdmin.php',1023],['lib/google/src/Google/Service','SQLAdmin.php',1368],['lib/google/src/Google/Service','SQLAdmin.php',1483],['badges/criteria','award_criteria_manual.php',220],['search/engine/solr/classes','engine.php',1045],['lib/google/src/Google/Service','Compute.php',4021],['lib/google/src/Google/Service','Compute.php',4149],['lib/google/src/Google/Service','Compute.php',4284],['lib/google/src/Google/Service','Compute.php',4571],['lib/google/src/Google/Service','Compute.php',4671],['lib/google/src/Google/Service','Compute.php',4829],['lib/google/src/Google/Service','Compute.php',4942],['lib/google/src/Google/Service','Compute.php',5033],['lib/google/src/Google/Service','Compute.php',5174],['lib/google/src/Google/Service','Compute.php',5248],['lib/google/src/Google/Service','Compute.php',5378],['lib/google/src/Google/Service','Compute.php',5508],['lib/google/src/Google/Service','Compute.php',5683],['lib/google/src/Google/Service','Compute.php',5984],['lib/google/src/Google/Service','Compute.php',6156],['lib/google/src/Google/Service','Compute.php',6316],['lib/google/src/Google/Service','Compute.php',6717],['lib/google/src/Google/Service','Compute.php',6898],['lib/google/src/Google/Service','Compute.php',7037],['lib/google/src/Google/Service','Compute.php',7128],['lib/google/src/Google/Service','Compute.php',7208],['lib/google/src/Google/Service','Compute.php',7299],['lib/google/src/Google/Service','Compute.php',7409],['lib/google/src/Google/Service','Compute.php',7570],['lib/google/src/Google/Service','Compute.php',7734],['lib/google/src/Google/Service','Compute.php',7938],['lib/google/src/Google/Service','Compute.php',8035],['lib/google/src/Google/Service','Compute.php',8210],['lib/google/src/Google/Service','Compute.php',8305],['lib/google/src/Google/Service','Pubsub.php',240],['lib/google/src/Google/Service','Pubsub.php',379],['lib/google/src/Google/Service','YouTube.php',1810],['lib/google/src/Google/Service','YouTube.php',2061],['lib/google/src/Google/Service','YouTube.php',2459],['lib/google/src/Google/Service','YouTube.php',2889],['lib/google/src/Google/Service','YouTube.php',3187],['lib/google/src/Google/Service','YouTube.php',3419],['lib/google/src/Google/Service','YouTube.php',3559],['lib/google/src/Google/Service','YouTube.php',3928],['lib/google/src/Google/Service','YouTube.php',4158],['lib/google/src/Google/Cache','Apc.php',105],['lib/google/src/Google/Service','Dfareporting.php',5000],['lib/google/src/Google/Service','Dfareporting.php',5566],['lib/google/src/Google/Service','Dfareporting.php',5753],['lib/google/src/Google/Service','Dfareporting.php',5877],['lib/google/src/Google/Service','Dfareporting.php',6397],['lib/google/src/Google/Service','Dfareporting.php',6578],['lib/google/src/Google/Service','Dfareporting.php',6731],['lib/google/src/Google/Service','Dfareporting.php',6996],['lib/google/src/Google/Service','Dfareporting.php',7503],['lib/google/src/Google/Service','Dfareporting.php',8102],['lib/google/src/Google/Service','Dfareporting.php',8768],['lib/google/src/Google/Service','Manager.php',244],['lib/google/src/Google/Service','Manager.php',324],['lib/google/src/Google/Service','CloudMonitoring.php',274],['lib','webdavlib.php',691]], 317],
'lesson_reset_course_form_defaults': ['lesson_reset_course_form_defaults', 'Course reset form defaults. ', [['mod/lesson','lib.php',926]], 0],
'lesson_refresh_events': ['lesson_refresh_events', 'This standard function will check all instances of this module and make sure there are up-to-date events created for each of them. If courseid = 0, then every lesson event in the site is checked, else only lesson events belonging to the course specified are checked. This function is used, in its new format, by restore_refresh_events() ', [['mod/lesson','lib.php',229]], 0],
'lesson_get_view_actions': ['lesson_get_view_actions', 'List the actions that correspond to a view of this module. This is used by the participation report. ', [['mod/lesson','lib.php',816]], 0],
'lesson_page_type_list': ['lesson_page_type_list', 'Return a list of page types ', [['mod/lesson','lib.php',1378]], 0],
'container': ['container', 'Outputs a container. ', [['lib','outputrenderers.php',3126]], 195],
'lesson_reset_gradebook': ['lesson_reset_gradebook', 'Removes all grades from gradebook ', [['mod/lesson','lib.php',937]], 1],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'add': ['add', 'Add HashTable item ', [['lib/phpexcel/PHPExcel','HashTable.php',78],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',95],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',109],['lib/google/src/Google/Http','Batch.php',52],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',37],['lib','csslib.php',1508],['lib/horde/framework/Horde/Mail/Rfc822','List.php',116],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',33],['lib/horde/framework/Horde/Support','ConsistentHash.php',148],['lib/horde/framework/Horde','Variables.php',297],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',29],['lib','outputcomponents.php',2705],['lib','outputcomponents.php',3380],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',436],['lib','adminlib.php',735],['lib','adminlib.php',894],['lib','adminlib.php',1446],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',27],['lib/xhprof/xhprof_html/jquery','jquery-1.2.6.js',3450],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',80],['lib/google/src/Google/Service','Webmasters.php',436],['lib','navigationlib.php',304],['lib','navigationlib.php',761],['lib','navigationlib.php',3305],['lib','navigationlib.php',3583],['lib/horde/framework/Horde/Imap/Client','Ids.php',155],['backup/cc/cc_lib/gral_lib','cssparser.php',121],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',428],['lib/horde/framework/Horde','Stream.php',116],['comment','lib.php',679],['lib/mustache/src/Mustache','HelperCollection.php',56],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',207],['backup/cc/cc_lib','cc_utils.php',395],['backup/cc/cc_lib','cc_utils.php',454],['lib/lessphp/Output','Mapped.php',50],['lib','licenselib.php',32],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',50],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',74],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',14],['lib/horde/framework/Horde/Mail/Rfc822','GroupList.php',25],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',31],['tag/classes','tag.php',152],['blog','locallib.php',242],['lib/classes','notification.php',50],['lib/lessphp','Output.php',18],['tag/classes/output','tagfeed.php',61],['backup/cc','validator.php',51],['lib/horde/framework/Horde/Stream','TempString.php',118],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',11]], 6188],
'lesson_reset_course_form_definition': ['lesson_reset_course_form_definition', 'Implementation of the function for printing the form elements that control whether the course reset functionality affects the lesson. ', [['mod/lesson','lib.php',911]], 0],
'delete_records_select': ['delete_records_select', '', [['lib/dml','pdo_moodle_database.php',208],['lib/dml','oci_native_moodle_database.php',1495],['lib/dml','pgsql_native_moodle_database.php',1162],['lib/dml','mssql_native_moodle_database.php',1146],['lib/dml','mysqli_native_moodle_database.php',1477],['lib/dml','sqlsrv_native_moodle_database.php',1220],['lib/dml/tests','dml_test.php',5553]], 163],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'get_filename': ['get_filename', 'Returns file name ', [['lib/filebrowser','virtual_root_file.php',227],['lib/filestorage','stored_file.php',699],['lib','medialib.php',169]], 248],
'sum': ['sum', 'SUM ', [['lib/phpexcel/PHPExcel/Calculation','MathTrig.php',1152],['lib/evalmath','evalmath.class.php',530]], 91],
'get_record_sql': ['get_record_sql', 'Get a single database record as an object using a SQL statement. ', [['lib/dml','oci_native_moodle_database.php',1076],['lib/dml','moodle_database.php',1506]], 157],
'get_field_sql': ['get_field_sql', 'Get a single field value (first field) using a SQL statement. ', [['lib/dml','moodle_database.php',1588]], 138],
'lesson_update_media_file': ['lesson_update_media_file', 'Update the lesson activity to include any file that was uploaded, or if there is none, set the mediafile field to blank. ', [['mod/lesson','lib.php',1392]], 2],
'lesson_grade_item_update': ['lesson_grade_item_update', 'Create grade item for given lesson ', [['mod/lesson','lib.php',740]], 7],
'lesson_update_events': ['lesson_update_events', 'This function updates the events associated to the lesson. If $override is non-zero, then it updates only the events associated with the specified override. ', [['mod/lesson','lib.php',98]], 3],
'get_coursemodule_from_instance': ['get_coursemodule_from_instance', 'Given an instance number of a module, finds the coursemodule description ', [['lib','datalib.php',1300]], 441],
'get_children_key_list': ['get_children_key_list', 'Return a list of all the keys of all the child nodes. ', [['lib','navigationlib.php',361]], 3],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'is_directory': ['is_directory', 'Whether or not this is a directory ', [['lib/filebrowser','file_info_context_system.php',133],['mod/lesson/classes','file_info.php',94],['mod/imscp','locallib.php',328],['lib/filebrowser','file_info_context_coursecat.php',146],['mod/book','locallib.php',463],['lib/filebrowser','file_info_context_user.php',265],['lib/filebrowser','virtual_root_file.php',60],['mod/data','locallib.php',477],['lib/filebrowser','file_info_stored.php',267],['lib/filestorage','stored_file.php',310],['mod/workshop','fileinfolib.php',82],['mod/workshop','fileinfolib.php',241],['lib/filebrowser','file_info_context_module.php',249],['mod/glossary','locallib.php',525],['lib/filebrowser','file_info_context_course.php',372],['lib/filebrowser','file_info_context_course.php',657],['lib/filebrowser','file_info_context_course.php',803],['mod/forum','locallib.php',463]], 140],
'lesson_extend_settings_navigation': ['lesson_extend_settings_navigation', 'This function extends the settings navigation block for the site. ', [['mod/lesson','lib.php',1132]], 0],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'lesson_process_pre_save': ['lesson_process_pre_save', 'Runs any processes that must run before a lesson insert/update ', [['mod/lesson','lib.php',844]], 2],
'get_plugin_list': ['get_plugin_list', 'Use when listing real plugins of one type. ', [['lib','deprecatedlib.php',150],['lib/classes','component.php',796],['admin/tool/monitor/classes','eventlist.php',176]], 191],
'file_save_draft_area_files': ['file_save_draft_area_files', 'Saves files from a draft file area to a real one (merging the list of files). Can rewrite URLs in some content at the same time if desired. ', [['lib','filelib.php',778]], 61],
'lesson_cron': ['lesson_cron', 'Function to be run periodically according to the moodle cron This function searches for things that need to be done, such as sending out mail, toggling flags etc ... ', [['mod/lesson','lib.php',639]], 0],
'lesson_delete_instance': ['lesson_delete_instance', 'Given an ID of an instance of this module, this function will permanently delete the instance and any data that depends on it. ', [['mod/lesson','lib.php',259]], 0],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'lesson_process_post_save': ['lesson_process_post_save', 'Runs any processes that must be run after a lesson insert/update ', [['mod/lesson','lib.php',897]], 2],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'get_file_by_hash': ['get_file_by_hash', 'Fetch file using local file full pathname hash ', [['lib/filestorage','file_storage.php',679]], 73],
'lesson_get_import_export_formats': ['lesson_get_import_export_formats', 'Get list of available import or export formats ', [['mod/lesson','lib.php',1193]], 1],
'lesson_add_instance': ['lesson_add_instance', 'Given an object containing all the necessary data, (defined by the form in mod_form.php) this function will create a new instance and return the id number of the new instance. ', [['mod/lesson','lib.php',30]], 0],
'lesson_user_outline': ['lesson_user_outline', 'Return a small object with summary information about what a user has done with a given particular instance of this module Used for user activity reports. $return->time = the time they did it $return->info = a short text description ', [['mod/lesson','lib.php',277]], 0],
'addelement': ['addelement', 'Adds a custom element to your HTML definition ', [['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',124],['lib/htmlpurifier/HTMLPurifier','HTMLModule.php',130],['lib/pear/HTML','QuickForm.php',592]], 3302],
'load': ['load', 'Load the class from cache using `require_once`. ', [['lib/mustache/src/Mustache/Cache','FilesystemCache.php',39],['lib/phpexcel/PHPExcel/Reader','Excel2007.php',320],['lib/phpexcel/PHPExcel/Reader','OOCalc.php',284],['lib/pear/HTML/QuickForm','select.php',430],['lib/phpexcel/PHPExcel/Reader','Excel5.php',612],['lib/mustache/src/Mustache/Cache','NoopCache.php',20],['lib/adodb','adodb-active-record.inc.php',775],['backup/cc/cc_lib','xmlbase.php',92],['lib/mustache/src/Mustache/Loader','FilesystemLoader.php',69],['lib/simplepie/library/SimplePie/Cache','File.php',118],['lib/mustache/src/Mustache/Loader','CascadingLoader.php',48],['lib/phpexcel/PHPExcel','Autoloader.php',58],['lib/phpexcel/PHPExcel/Reader','IReader.php',38],['grade/grading','lib.php',227],['mod/lesson','locallib.php',1022],['mod/lesson','locallib.php',2240],['mod/lesson','locallib.php',3200],['lib/phpexcel/PHPExcel','IOFactory.php',180],['lib/mustache/src/Mustache','Cache.php',20],['lib','outputlib.php',432],['cache/classes','definition.php',335],['lib/phpexcel/PHPExcel/Reader/Excel5','Escher.php',87],['lib/adodb','adodb-active-recordx.inc.php',813],['lib/simplepie/library/SimplePie/Cache','Base.php',87],['lib/phpexcel/PHPExcel/Reader','HTML.php',143],['lib/simplepie/library/SimplePie/Cache','MySQL.php',286],['lib/mustache/src/Mustache/Loader','InlineLoader.php',87],['lib/mustache/src/Mustache','Loader.php',17],['lib/phpexcel/PHPExcel/Reader','CSV.php',203],['lib/simplepie/library/SimplePie/Cache','Memcache.php',123],['lib/mustache/src/Mustache/Loader','StringLoader.php',28],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',44],['lib/phpunit/classes','autoloader.php',46],['lib/phpexcel/PHPExcel/Reader','Excel2003XML.php',216],['lib/htmlpurifier/HTMLPurifier','Language.php',69],['lib/phpexcel/PHPExcel/Reader','SYLK.php',190],['calendar','lib.php',2666],['lib/phpexcel/PHPExcel/Reader','Gnumeric.php',189],['lib/mustache/src/Mustache/Loader','ArrayLoader.php',41],['cache/classes','config.php',128]], 190],
'lesson_user_complete': ['lesson_user_complete', 'Print a detailed representation of what a  user has done with a given particular instance of this module, for user activity reports. ', [['mod/lesson','lib.php',339]], 0],
'lesson_update_grades': ['lesson_update_grades', 'Update grades in central gradebook ', [['mod/lesson','lib.php',711]], 4],
'box_start': ['box_start', 'Outputs the opening section of a box. ', [['lib','outputrenderers.php',3102]], 259],
'lesson_get_post_actions': ['lesson_get_post_actions', 'List the actions that correspond to a post of this module. This is used by the participation report. ', [['mod/lesson','lib.php',830]], 0],
'lesson_get_extra_capabilities': ['lesson_get_extra_capabilities', 'Returns all other caps used in module ', [['mod/lesson','lib.php',1043]], 0],
'lesson_supports': ['lesson_supports', '', [['mod/lesson','lib.php',1061]], 0],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1379]], 880],
'table': ['table', 'Log a table in the firebug console ', [['lib/minify/lib','FirePHP.php',454],['lib/adodb','adodb-perf.inc.php',234],['lib','outputcomponents.php',1497]], 257],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'userdate': ['userdate', 'Returns a formatted string that represents a date in user time. ', [['lib','moodlelib.php',2155],['lib/adodb','adodb.inc.php',2842],['lib/adodb','adodb.inc.php',3569]], 525],
'provide_export': ['provide_export', '', [['question','format.php',66],['question/format/xml','format.php',53],['question/format/xhtml','format.php',39],['question/format/gift','format.php',68]], 2],
'lesson_get_completion_state': ['lesson_get_completion_state', 'Obtains the automatic completion state for this lesson based on any conditions in lesson settings. ', [['mod/lesson','lib.php',1086]], 0],
'lesson_get_user_grades': ['lesson_get_user_grades', 'Return grade for given user or all users. ', [['mod/lesson','lib.php',652]], 2],
'lesson_get_file_info': ['lesson_get_file_info', 'Returns a file_info_stored object for the file being requested here ', [['mod/lesson','lib.php',1320]], 0],
'get_all_instances_in_courses': ['get_all_instances_in_courses', 'Returns an array of all the active instances of a particular module in given courses, sorted in the order they are defined ', [['lib','datalib.php',1382]], 23],
'groups_get_group_name': ['groups_get_group_name', 'Gets the name of a group with a specified id ', [['lib','grouplib.php',55]], 14],
'delete_area_files': ['delete_area_files', 'Delete all area files (optionally limited by itemid). ', [['lib/filestorage','file_storage.php',992]], 123],
'lesson_print_overview': ['lesson_print_overview', 'Prints lesson summaries on MyMoodle Page ', [['mod/lesson','lib.php',461]], 0],
'provide_import': ['provide_import', '', [['question','format.php',61],['question/format/blackboard_six','formatbase.php',40],['question/format/aiken','format.php',56],['question/format/webct','format.php',172],['question/format/multianswer','format.php',38],['question/format/xml','format.php',49],['question/format/missingword','format.php',54],['mod/lesson','format.php',356],['question/format/gift','format.php',64],['question/format/examview','format.php',56]], 2],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',6144]], 546],
'get_records_select': ['get_records_select', 'Load a list of records based on a select query. ', [['competency/classes','persistent.php',751],['lib/dml','moodle_database.php',1332]], 166],
'count_records': ['count_records', 'Count a list of records. ', [['competency/classes','persistent.php',815],['mod/glossary/classes','entry_query_builder.php',152],['lib/dml','moodle_database.php',1766]], 1630],
'grade_update': ['grade_update', 'Submit new or update grade; update/create grade_item definition. Grade must have userid specified, rawgrade and feedback with format are optional. rawgrade NULL means \'Not graded\'. Missing property or key means does not change the existing value. ', [['lib','gradelib.php',40]], 27],
'join': ['join', 'Join a room. For internal use by the Games SDK only. Calling this method directly is unsupported. (rooms.join) ', [['lib/google/src/Google/Service','Games.php',1716],['lib/google/src/Google/Service','Games.php',2100]], 1030],
'lesson_update_instance': ['lesson_update_instance', 'Given an object containing all the necessary data, (defined by the form in mod_form.php) this function will update an existing instance with new data. ', [['mod/lesson','lib.php',63]], 0],
'lesson_get_file_areas': ['lesson_get_file_areas', 'Returns an array of file areas ', [['mod/lesson','lib.php',1303]], 2],
'instance_is_visible': ['instance_is_visible', 'Determine whether a module instance is visible within a course ', [['lib','datalib.php',1479]], 14],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'min': ['min', '', [], 898],
'array_search': ['array_search', '', [], 170],
'is_null': ['is_null', '', [], 2003],
'is_numeric': ['is_numeric', '', [], 672],
'file_exists': ['file_exists', '', [], 867],
'count': ['count', '', [], 4095],
'time': ['time', '', [], 1959],
'implode': ['implode', '', [], 1281],
'is_array': ['is_array', '', [], 1608],
'max': ['max', '', [], 1266],
'is_object': ['is_object', '', [], 544],
'link': ['link', '', [], 695],
'array_shift': ['array_shift', '', [], 700],
'function_exists': ['function_exists', '', [], 419],
'array_merge': ['array_merge', '', [], 2944],
'natcasesort': ['natcasesort', '', [], 4],
'defined': ['defined', '', [], 4731],
'reset': ['reset', '', [], 1213],
'array_key_exists': ['array_key_exists', '', [], 1445],
'sha1': ['sha1', '', [], 186],
'serialize': ['serialize', '', [], 282],
'str_replace': ['str_replace', '', [], 1648]};
CLASS_DATA={
'html_table': ['html_table', 'Holds all the information required to render a <table> by {@link core_renderer::table()} ', [['lib','outputcomponents.php',2011]], 225],
'calendar_event': ['calendar_event', 'Manage calendar events ', [['calendar','lib.php',1951]], 75],
'navigation_node': ['navigation_node', 'This class is used to represent a node in a navigation tree ', [['lib','navigationlib.php',34]], 348],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',238]], 3088],
'lesson': ['lesson', 'Class representation of a lesson ', [['mod/lesson','locallib.php',921]], 28],
'file_info_stored': ['file_info_stored', 'Represents an actual file or folder - a row in the file table in the tree navigated by {@link file_browser}. ', [['lib/filebrowser','file_info_stored.php',28]], 33],
'core_component': ['core_component', 'Collection of components related methods. ', [['lib/classes','component.php',41]], 511],
'html_writer': ['html_writer', 'Simple html output class ', [['lib','outputcomponents.php',1062]], 5120],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',7039]], 1106],
'mod_lesson_file_info': ['mod_lesson_file_info', 'File browsing support class. ', [['mod/lesson/classes','file_info.php',27]], 1]};
CONST_DATA={
'FEATURE_BACKUP_MOODLE2': ['FEATURE_BACKUP_MOODLE2', '', [['lib','moodlelib.php',434]], 35],
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 466],
'FEATURE_GRADE_OUTCOMES': ['FEATURE_GRADE_OUTCOMES', '', [['lib','moodlelib.php',396]], 23],
'FEATURE_COMPLETION_TRACKS_VIEWS': ['FEATURE_COMPLETION_TRACKS_VIEWS', '', [['lib','moodlelib.php',405]], 23],
'LESSON_MAX_EVENT_LENGTH': ['LESSON_MAX_EVENT_LENGTH', '', [['mod/lesson','locallib.php',59]], 2],
'FEATURE_GRADE_HAS_GRADE': ['FEATURE_GRADE_HAS_GRADE', '', [['lib','moodlelib.php',394]], 29],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'GRADE_TYPE_NONE': ['GRADE_TYPE_NONE', '', [['lib/grade','constants.php',80]], 47],
'COMPLETION_AND': ['COMPLETION_AND', '', [['lib','completionlib.php',131]], 9],
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 315],
'GRADE_TYPE_SCALE': ['GRADE_TYPE_SCALE', '', [['lib/grade','constants.php',90]], 70],
'FEATURE_MOD_INTRO': ['FEATURE_MOD_INTRO', '', [['lib','moodlelib.php',426]], 31],
'FEATURE_SHOW_DESCRIPTION': ['FEATURE_SHOW_DESCRIPTION', '', [['lib','moodlelib.php',437]], 22],
'GRADE_TYPE_VALUE': ['GRADE_TYPE_VALUE', '', [['lib/grade','constants.php',85]], 80],
'FEATURE_GROUPS': ['FEATURE_GROUPS', '', [['lib','moodlelib.php',414]], 25],
'LESSON_EOL': ['LESSON_EOL', '', [['mod/lesson','locallib.php',44]], 29],
'FEATURE_GROUPINGS': ['FEATURE_GROUPINGS', '', [['lib','moodlelib.php',416]], 23],
'IGNORE_MULTIPLE': ['IGNORE_MULTIPLE', '', [['lib','dmllib.php',50]], 43],
'FEATURE_COMPLETION_HAS_RULES': ['FEATURE_COMPLETION_HAS_RULES', '', [['lib','moodlelib.php',407]], 12],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'LESSON_PAGE_BRANCHTABLE': ['LESSON_PAGE_BRANCHTABLE', '', [['mod/lesson/pagetypes','branchtable.php',29]], 25]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
