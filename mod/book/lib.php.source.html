<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mod/book/lib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='mod/book';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mod/book/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Book module core interaction API</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    mod_book</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright  2004-2011 Petr Skoda {@link http://skodak.org}</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die;
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment">/**</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * Returns list of available numbering types</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * @return array</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> */</span>
<a name="l31"><span class="linenum">  31</span></a>  function <a class="function" onClick="logFunction('book_get_numbering_types')" href="../../_functions/book_get_numbering_types.html" onMouseOver="funcPopup(event,'book_get_numbering_types')">book_get_numbering_types</a>() {
<a name="l32"><span class="linenum">  32</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>; <span class="comment">// required for the include</span>
<a name="l33"><span class="linenum">  33</span></a>  
<a name="l34"><span class="linenum">  34</span></a>      <span class="keyword">require_once</span> <a class="filename" href="../../mod/workshop/locallib.php.html" onMouseOver="reqPopup(event, 'locallib.php', '../../mod/workshop/locallib.php')">(__DIR__.'/locallib.php')</a>;
<a name="l35"><span class="linenum">  35</span></a>  
<a name="l36"><span class="linenum">  36</span></a>      return array (
<a name="l37"><span class="linenum">  37</span></a>          <a class="constant" onClick="logConstant('BOOK_NUM_NONE')" href="../../_constants/BOOK_NUM_NONE.html" onMouseOver="constPopup(event,'BOOK_NUM_NONE')">BOOK_NUM_NONE</a>       =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('numbering0', 'mod_book'),
<a name="l38"><span class="linenum">  38</span></a>          <a class="constant" onClick="logConstant('BOOK_NUM_NUMBERS')" href="../../_constants/BOOK_NUM_NUMBERS.html" onMouseOver="constPopup(event,'BOOK_NUM_NUMBERS')">BOOK_NUM_NUMBERS</a>    =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('numbering1', 'mod_book'),
<a name="l39"><span class="linenum">  39</span></a>          <a class="constant" onClick="logConstant('BOOK_NUM_BULLETS')" href="../../_constants/BOOK_NUM_BULLETS.html" onMouseOver="constPopup(event,'BOOK_NUM_BULLETS')">BOOK_NUM_BULLETS</a>    =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('numbering2', 'mod_book'),
<a name="l40"><span class="linenum">  40</span></a>          <a class="constant" onClick="logConstant('BOOK_NUM_INDENTED')" href="../../_constants/BOOK_NUM_INDENTED.html" onMouseOver="constPopup(event,'BOOK_NUM_INDENTED')">BOOK_NUM_INDENTED</a>   =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('numbering3', 'mod_book')
<a name="l41"><span class="linenum">  41</span></a>      );
<a name="l42"><span class="linenum">  42</span></a>  }
<a name="l43"><span class="linenum">  43</span></a>  
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment">/**</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment"> * Returns list of available navigation link types.</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment"> * @return array</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment"> */</span>
<a name="l48"><span class="linenum">  48</span></a>  function <a class="function" onClick="logFunction('book_get_nav_types')" href="../../_functions/book_get_nav_types.html" onMouseOver="funcPopup(event,'book_get_nav_types')">book_get_nav_types</a>() {
<a name="l49"><span class="linenum">  49</span></a>      <span class="keyword">require_once</span> <a class="filename" href="../../mod/workshop/locallib.php.html" onMouseOver="reqPopup(event, 'locallib.php', '../../mod/workshop/locallib.php')">(__DIR__.'/locallib.php')</a>;
<a name="l50"><span class="linenum">  50</span></a>  
<a name="l51"><span class="linenum">  51</span></a>      return array (
<a name="l52"><span class="linenum">  52</span></a>          <a class="constant" onClick="logConstant('BOOK_LINK_TOCONLY')" href="../../_constants/BOOK_LINK_TOCONLY.html" onMouseOver="constPopup(event,'BOOK_LINK_TOCONLY')">BOOK_LINK_TOCONLY</a>   =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('navtoc', 'mod_book'),
<a name="l53"><span class="linenum">  53</span></a>          <a class="constant" onClick="logConstant('BOOK_LINK_IMAGE')" href="../../_constants/BOOK_LINK_IMAGE.html" onMouseOver="constPopup(event,'BOOK_LINK_IMAGE')">BOOK_LINK_IMAGE</a>     =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('navimages', 'mod_book'),
<a name="l54"><span class="linenum">  54</span></a>          <a class="constant" onClick="logConstant('BOOK_LINK_TEXT')" href="../../_constants/BOOK_LINK_TEXT.html" onMouseOver="constPopup(event,'BOOK_LINK_TEXT')">BOOK_LINK_TEXT</a>      =&gt; <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('navtext', 'mod_book'),
<a name="l55"><span class="linenum">  55</span></a>      );
<a name="l56"><span class="linenum">  56</span></a>  }
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment">/**</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment"> * Returns list of available navigation link CSS classes.</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment"> * @return array</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment"> */</span>
<a name="l62"><span class="linenum">  62</span></a>  function <a class="function" onClick="logFunction('book_get_nav_classes')" href="../../_functions/book_get_nav_classes.html" onMouseOver="funcPopup(event,'book_get_nav_classes')">book_get_nav_classes</a>() {
<a name="l63"><span class="linenum">  63</span></a>      return array ('navtoc', 'navimages', 'navtext');
<a name="l64"><span class="linenum">  64</span></a>  }
<a name="l65"><span class="linenum">  65</span></a>  
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment">/**</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment"> * Returns all other caps used in module</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment"> * @return array</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment"> */</span>
<a name="l70"><span class="linenum">  70</span></a>  function <a class="function" onClick="logFunction('book_get_extra_capabilities')" href="../../_functions/book_get_extra_capabilities.html" onMouseOver="funcPopup(event,'book_get_extra_capabilities')">book_get_extra_capabilities</a>() {
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment">    // used for group-members-only</span>
<a name="l72"><span class="linenum">  72</span></a>      return array('moodle/site:accessallgroups');
<a name="l73"><span class="linenum">  73</span></a>  }
<a name="l74"><span class="linenum">  74</span></a>  
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">/**</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment"> * Add book instance.</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment"> *</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment"> * @param stdClass $data</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment"> * @param stdClass $mform</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> * @return int new book instance id</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment"> */</span>
<a name="l82"><span class="linenum">  82</span></a>  function <a class="function" onClick="logFunction('book_add_instance')" href="../../_functions/book_add_instance.html" onMouseOver="funcPopup(event,'book_add_instance')">book_add_instance</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l83"><span class="linenum">  83</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l86"><span class="linenum">  86</span></a>      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>;
<a name="l87"><span class="linenum">  87</span></a>      if (!isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('customtitles')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/customtitles.html">customtitles</a>)) {
<a name="l88"><span class="linenum">  88</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('customtitles')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/customtitles.html">customtitles</a> = 0;
<a name="l89"><span class="linenum">  89</span></a>      }
<a name="l90"><span class="linenum">  90</span></a>  
<a name="l91"><span class="linenum">  91</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('book', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l92"><span class="linenum">  92</span></a>  }
<a name="l93"><span class="linenum">  93</span></a>  
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment">/**</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment"> * Update book instance.</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment"> *</span>
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment"> * @param stdClass $data</span>
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment"> * @param stdClass $mform</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment"> * @return bool true</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment"> */</span>
<a name="l101"><span class="linenum"> 101</span></a>  function <a class="function" onClick="logFunction('book_update_instance')" href="../../_functions/book_update_instance.html" onMouseOver="funcPopup(event,'book_update_instance')">book_update_instance</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../_variables/mform.html">$mform</a>) {
<a name="l102"><span class="linenum"> 102</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l105"><span class="linenum"> 105</span></a>      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('instance')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>;
<a name="l106"><span class="linenum"> 106</span></a>      if (!isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('customtitles')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/customtitles.html">customtitles</a>)) {
<a name="l107"><span class="linenum"> 107</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('customtitles')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/customtitles.html">customtitles</a> = 0;
<a name="l108"><span class="linenum"> 108</span></a>      }
<a name="l109"><span class="linenum"> 109</span></a>  
<a name="l110"><span class="linenum"> 110</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('book', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l111"><span class="linenum"> 111</span></a>  
<a name="l112"><span class="linenum"> 112</span></a>      <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('book', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l113"><span class="linenum"> 113</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('book', 'revision', <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('revision')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/revision.html">revision</a>+1, array('id'=&gt;<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('id')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l114"><span class="linenum"> 114</span></a>  
<a name="l115"><span class="linenum"> 115</span></a>      return true;
<a name="l116"><span class="linenum"> 116</span></a>  }
<a name="l117"><span class="linenum"> 117</span></a>  
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment">/**</span>
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment"> * Delete book instance by activity id</span>
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment"> *</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment"> * @param int $id</span>
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment"> * @return bool success</span>
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment"> */</span>
<a name="l124"><span class="linenum"> 124</span></a>  function <a class="function" onClick="logFunction('book_delete_instance')" href="../../_functions/book_delete_instance.html" onMouseOver="funcPopup(event,'book_delete_instance')">book_delete_instance</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l125"><span class="linenum"> 125</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l126"><span class="linenum"> 126</span></a>  
<a name="l127"><span class="linenum"> 127</span></a>      if (!<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('book', array('id'=&gt;<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>))) {
<a name="l128"><span class="linenum"> 128</span></a>          return false;
<a name="l129"><span class="linenum"> 129</span></a>      }
<a name="l130"><span class="linenum"> 130</span></a>  
<a name="l131"><span class="linenum"> 131</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('book_chapters', array('bookid'=&gt;<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('id')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l132"><span class="linenum"> 132</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('book', array('id'=&gt;<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('id')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l133"><span class="linenum"> 133</span></a>  
<a name="l134"><span class="linenum"> 134</span></a>      return true;
<a name="l135"><span class="linenum"> 135</span></a>  }
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment">/**</span>
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment"> * Given a course and a time, this module should find recent activity</span>
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment"> * that has occurred in book activities and print it out.</span>
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment"> *</span>
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment"> * @param stdClass $course</span>
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment"> * @param bool $viewfullnames</span>
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment"> * @param int $timestart</span>
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment"> * @return bool true if there was output, or false is there was none</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment"> */</span>
<a name="l146"><span class="linenum"> 146</span></a>  function <a class="function" onClick="logFunction('book_print_recent_activity')" href="../../_functions/book_print_recent_activity.html" onMouseOver="funcPopup(event,'book_print_recent_activity')">book_print_recent_activity</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it5397" onMouseOver="hilite(5397)" onMouseOut="lolite()" onClick="logVariable('viewfullnames')" href="../../_variables/viewfullnames.html">$viewfullnames</a>, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>) {
<a name="l147"><span class="linenum"> 147</span></a>      return false;  <span class="comment">//  True if anything was printed, otherwise false</span>
<a name="l148"><span class="linenum"> 148</span></a>  }
<a name="l149"><span class="linenum"> 149</span></a>  
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment">/**</span>
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment"> * This function is used by the reset_course_userdata function in moodlelib.</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment"> * @param $data the data submitted from the reset course.</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment"> * @return array status array</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment"> */</span>
<a name="l155"><span class="linenum"> 155</span></a>  function <a class="function" onClick="logFunction('book_reset_userdata')" href="../../_functions/book_reset_userdata.html" onMouseOver="funcPopup(event,'book_reset_userdata')">book_reset_userdata</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>) {
<a name="l156"><span class="linenum"> 156</span></a>      return array();
<a name="l157"><span class="linenum"> 157</span></a>  }
<a name="l158"><span class="linenum"> 158</span></a>  
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment">/**</span>
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment"> * No cron in book.</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment"> *</span>
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment"> * @return bool</span>
<a name="l163"><span class="linenum"> 163</span></a>  <span class="comment"> */</span>
<a name="l164"><span class="linenum"> 164</span></a>  function <a class="function" onClick="logFunction('book_cron')" href="../../_functions/book_cron.html" onMouseOver="funcPopup(event,'book_cron')">book_cron</a> () {
<a name="l165"><span class="linenum"> 165</span></a>      return true;
<a name="l166"><span class="linenum"> 166</span></a>  }
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>  <span class="comment">/**</span>
<a name="l169"><span class="linenum"> 169</span></a>  <span class="comment"> * No grading in book.</span>
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment"> *</span>
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment"> * @param int $bookid</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment"> * @return null</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment"> */</span>
<a name="l174"><span class="linenum"> 174</span></a>  function <a class="function" onClick="logFunction('book_grades')" href="../../_functions/book_grades.html" onMouseOver="funcPopup(event,'book_grades')">book_grades</a>(<a class="var it10051" onMouseOver="hilite(10051)" onMouseOut="lolite()" onClick="logVariable('bookid')" href="../../_variables/bookid.html">$bookid</a>) {
<a name="l175"><span class="linenum"> 175</span></a>      return null;
<a name="l176"><span class="linenum"> 176</span></a>  }
<a name="l177"><span class="linenum"> 177</span></a>  
<a name="l178"><span class="linenum"> 178</span></a>  <span class="comment">/**</span>
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment"> * This function returns if a scale is being used by one book</span>
<a name="l180"><span class="linenum"> 180</span></a>  <span class="comment"> * it it has support for grading and scales. Commented code should be</span>
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment"> * modified if necessary. See book, glossary or journal modules</span>
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment"> * as reference.</span>
<a name="l183"><span class="linenum"> 183</span></a>  <span class="comment"> *</span>
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment"> * @param int $bookid</span>
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment"> * @param int $scaleid</span>
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment"> * @return boolean True if the scale is used by any journal</span>
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment"> */</span>
<a name="l188"><span class="linenum"> 188</span></a>  function <a class="function" onClick="logFunction('book_scale_used')" href="../../_functions/book_scale_used.html" onMouseOver="funcPopup(event,'book_scale_used')">book_scale_used</a>(<a class="var it10051" onMouseOver="hilite(10051)" onMouseOut="lolite()" onClick="logVariable('bookid')" href="../../_variables/bookid.html">$bookid</a>, <a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>) {
<a name="l189"><span class="linenum"> 189</span></a>      return false;
<a name="l190"><span class="linenum"> 190</span></a>  }
<a name="l191"><span class="linenum"> 191</span></a>  
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment">/**</span>
<a name="l193"><span class="linenum"> 193</span></a>  <span class="comment"> * Checks if scale is being used by any instance of book</span>
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment"> *</span>
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment"> * This is used to find out if scale used anywhere</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment"> *</span>
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment"> * @param int $scaleid</span>
<a name="l198"><span class="linenum"> 198</span></a>  <span class="comment"> * @return bool true if the scale is used by any book</span>
<a name="l199"><span class="linenum"> 199</span></a>  <span class="comment"> */</span>
<a name="l200"><span class="linenum"> 200</span></a>  function <a class="function" onClick="logFunction('book_scale_used_anywhere')" href="../../_functions/book_scale_used_anywhere.html" onMouseOver="funcPopup(event,'book_scale_used_anywhere')">book_scale_used_anywhere</a>(<a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>) {
<a name="l201"><span class="linenum"> 201</span></a>      return false;
<a name="l202"><span class="linenum"> 202</span></a>  }
<a name="l203"><span class="linenum"> 203</span></a>  
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment">/**</span>
<a name="l205"><span class="linenum"> 205</span></a>  <span class="comment"> * Return read actions.</span>
<a name="l206"><span class="linenum"> 206</span></a>  <span class="comment"> *</span>
<a name="l207"><span class="linenum"> 207</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l208"><span class="linenum"> 208</span></a>  <span class="comment"> *       crud = 'r' and edulevel = LEVEL_PARTICIPATING will</span>
<a name="l209"><span class="linenum"> 209</span></a>  <span class="comment"> *       be considered as view action.</span>
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment"> *</span>
<a name="l211"><span class="linenum"> 211</span></a>  <span class="comment"> * @return array</span>
<a name="l212"><span class="linenum"> 212</span></a>  <span class="comment"> */</span>
<a name="l213"><span class="linenum"> 213</span></a>  function <a class="function" onClick="logFunction('book_get_view_actions')" href="../../_functions/book_get_view_actions.html" onMouseOver="funcPopup(event,'book_get_view_actions')">book_get_view_actions</a>() {
<a name="l214"><span class="linenum"> 214</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>; <span class="comment">// necessary for includes</span>
<a name="l215"><span class="linenum"> 215</span></a>  
<a name="l216"><span class="linenum"> 216</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = array('view', 'view all');
<a name="l217"><span class="linenum"> 217</span></a>  
<a name="l218"><span class="linenum"> 218</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../../_variables/plugins.html">$plugins</a> = <a class="class" onClick="logClass('core_component')" href="../../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_list')" href="../../_functions/get_plugin_list.html" onMouseOver="funcPopup(event,'get_plugin_list')">get_plugin_list</a>('booktool');
<a name="l219"><span class="linenum"> 219</span></a>      foreach (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../../_variables/plugins.html">$plugins</a> as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a> =&gt; <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>) {
<a name="l220"><span class="linenum"> 220</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>/lib.php&quot;)) {
<a name="l221"><span class="linenum"> 221</span></a>              require_once(&quot;<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>/lib.php&quot;);
<a name="l222"><span class="linenum"> 222</span></a>          }
<a name="l223"><span class="linenum"> 223</span></a>          <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../../_variables/function.html">$function</a> = 'booktool_'.<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>.'_get_view_actions';
<a name="l224"><span class="linenum"> 224</span></a>          if (<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../../_variables/function.html">$function</a>)) {
<a name="l225"><span class="linenum"> 225</span></a>              if (<a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('actions')" href="../../_variables/actions.html">$actions</a> = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../../_variables/function.html">$function</a>()) {
<a name="l226"><span class="linenum"> 226</span></a>                  <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>, <a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('actions')" href="../../_variables/actions.html">$actions</a>);
<a name="l227"><span class="linenum"> 227</span></a>              }
<a name="l228"><span class="linenum"> 228</span></a>          }
<a name="l229"><span class="linenum"> 229</span></a>      }
<a name="l230"><span class="linenum"> 230</span></a>  
<a name="l231"><span class="linenum"> 231</span></a>      return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l232"><span class="linenum"> 232</span></a>  }
<a name="l233"><span class="linenum"> 233</span></a>  
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment">/**</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment"> * Return write actions.</span>
<a name="l236"><span class="linenum"> 236</span></a>  <span class="comment"> *</span>
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment"> * Note: This is not used by new logging system. Event with</span>
<a name="l238"><span class="linenum"> 238</span></a>  <span class="comment"> *       crud = ('c' || 'u' || 'd') and edulevel = LEVEL_PARTICIPATING</span>
<a name="l239"><span class="linenum"> 239</span></a>  <span class="comment"> *       will be considered as post action.</span>
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment"> *</span>
<a name="l241"><span class="linenum"> 241</span></a>  <span class="comment"> * @return array</span>
<a name="l242"><span class="linenum"> 242</span></a>  <span class="comment"> */</span>
<a name="l243"><span class="linenum"> 243</span></a>  function <a class="function" onClick="logFunction('book_get_post_actions')" href="../../_functions/book_get_post_actions.html" onMouseOver="funcPopup(event,'book_get_post_actions')">book_get_post_actions</a>() {
<a name="l244"><span class="linenum"> 244</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>; <span class="comment">// necessary for includes</span>
<a name="l245"><span class="linenum"> 245</span></a>  
<a name="l246"><span class="linenum"> 246</span></a>      <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = array('update');
<a name="l247"><span class="linenum"> 247</span></a>  
<a name="l248"><span class="linenum"> 248</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../../_variables/plugins.html">$plugins</a> = <a class="class" onClick="logClass('core_component')" href="../../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_list')" href="../../_functions/get_plugin_list.html" onMouseOver="funcPopup(event,'get_plugin_list')">get_plugin_list</a>('booktool');
<a name="l249"><span class="linenum"> 249</span></a>      foreach (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../../_variables/plugins.html">$plugins</a> as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a> =&gt; <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>) {
<a name="l250"><span class="linenum"> 250</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>/lib.php&quot;)) {
<a name="l251"><span class="linenum"> 251</span></a>              require_once(&quot;<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>/lib.php&quot;);
<a name="l252"><span class="linenum"> 252</span></a>          }
<a name="l253"><span class="linenum"> 253</span></a>          <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../../_variables/function.html">$function</a> = 'booktool_'.<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>.'_get_post_actions';
<a name="l254"><span class="linenum"> 254</span></a>          if (<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../../_variables/function.html">$function</a>)) {
<a name="l255"><span class="linenum"> 255</span></a>              if (<a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('actions')" href="../../_variables/actions.html">$actions</a> = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../../_variables/function.html">$function</a>()) {
<a name="l256"><span class="linenum"> 256</span></a>                  <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>, <a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('actions')" href="../../_variables/actions.html">$actions</a>);
<a name="l257"><span class="linenum"> 257</span></a>              }
<a name="l258"><span class="linenum"> 258</span></a>          }
<a name="l259"><span class="linenum"> 259</span></a>      }
<a name="l260"><span class="linenum"> 260</span></a>  
<a name="l261"><span class="linenum"> 261</span></a>      return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l262"><span class="linenum"> 262</span></a>  }
<a name="l263"><span class="linenum"> 263</span></a>  
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">/**</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment"> * Supported features</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment"> *</span>
<a name="l267"><span class="linenum"> 267</span></a>  <span class="comment"> * @param string $feature FEATURE_xx constant for requested feature</span>
<a name="l268"><span class="linenum"> 268</span></a>  <span class="comment"> * @return mixed True if module supports feature, false if not, null if doesn't know</span>
<a name="l269"><span class="linenum"> 269</span></a>  <span class="comment"> */</span>
<a name="l270"><span class="linenum"> 270</span></a>  function <a class="function" onClick="logFunction('book_supports')" href="../../_functions/book_supports.html" onMouseOver="funcPopup(event,'book_supports')">book_supports</a>(<a class="var it2267" onMouseOver="hilite(2267)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l271"><span class="linenum"> 271</span></a>      switch(<a class="var it2267" onMouseOver="hilite(2267)" onMouseOut="lolite()" onClick="logVariable('feature')" href="../../_variables/feature.html">$feature</a>) {
<a name="l272"><span class="linenum"> 272</span></a>          case <a class="constant" onClick="logConstant('FEATURE_MOD_ARCHETYPE')" href="../../_constants/FEATURE_MOD_ARCHETYPE.html" onMouseOver="constPopup(event,'FEATURE_MOD_ARCHETYPE')">FEATURE_MOD_ARCHETYPE</a>:           return <a class="constant" onClick="logConstant('MOD_ARCHETYPE_RESOURCE')" href="../../_constants/MOD_ARCHETYPE_RESOURCE.html" onMouseOver="constPopup(event,'MOD_ARCHETYPE_RESOURCE')">MOD_ARCHETYPE_RESOURCE</a>;
<a name="l273"><span class="linenum"> 273</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPS')" href="../../_constants/FEATURE_GROUPS.html" onMouseOver="constPopup(event,'FEATURE_GROUPS')">FEATURE_GROUPS</a>:                  return false;
<a name="l274"><span class="linenum"> 274</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GROUPINGS')" href="../../_constants/FEATURE_GROUPINGS.html" onMouseOver="constPopup(event,'FEATURE_GROUPINGS')">FEATURE_GROUPINGS</a>:               return false;
<a name="l275"><span class="linenum"> 275</span></a>          case <a class="constant" onClick="logConstant('FEATURE_MOD_INTRO')" href="../../_constants/FEATURE_MOD_INTRO.html" onMouseOver="constPopup(event,'FEATURE_MOD_INTRO')">FEATURE_MOD_INTRO</a>:               return true;
<a name="l276"><span class="linenum"> 276</span></a>          case <a class="constant" onClick="logConstant('FEATURE_COMPLETION_TRACKS_VIEWS')" href="../../_constants/FEATURE_COMPLETION_TRACKS_VIEWS.html" onMouseOver="constPopup(event,'FEATURE_COMPLETION_TRACKS_VIEWS')">FEATURE_COMPLETION_TRACKS_VIEWS</a>: return true;
<a name="l277"><span class="linenum"> 277</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_HAS_GRADE')" href="../../_constants/FEATURE_GRADE_HAS_GRADE.html" onMouseOver="constPopup(event,'FEATURE_GRADE_HAS_GRADE')">FEATURE_GRADE_HAS_GRADE</a>:         return false;
<a name="l278"><span class="linenum"> 278</span></a>          case <a class="constant" onClick="logConstant('FEATURE_GRADE_OUTCOMES')" href="../../_constants/FEATURE_GRADE_OUTCOMES.html" onMouseOver="constPopup(event,'FEATURE_GRADE_OUTCOMES')">FEATURE_GRADE_OUTCOMES</a>:          return false;
<a name="l279"><span class="linenum"> 279</span></a>          case <a class="constant" onClick="logConstant('FEATURE_BACKUP_MOODLE2')" href="../../_constants/FEATURE_BACKUP_MOODLE2.html" onMouseOver="constPopup(event,'FEATURE_BACKUP_MOODLE2')">FEATURE_BACKUP_MOODLE2</a>:          return true;
<a name="l280"><span class="linenum"> 280</span></a>          case <a class="constant" onClick="logConstant('FEATURE_SHOW_DESCRIPTION')" href="../../_constants/FEATURE_SHOW_DESCRIPTION.html" onMouseOver="constPopup(event,'FEATURE_SHOW_DESCRIPTION')">FEATURE_SHOW_DESCRIPTION</a>:        return true;
<a name="l281"><span class="linenum"> 281</span></a>  
<a name="l282"><span class="linenum"> 282</span></a>          default: return null;
<a name="l283"><span class="linenum"> 283</span></a>      }
<a name="l284"><span class="linenum"> 284</span></a>  }
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>  <span class="comment">/**</span>
<a name="l287"><span class="linenum"> 287</span></a>  <span class="comment"> * Adds module specific settings to the settings block</span>
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment"> *</span>
<a name="l289"><span class="linenum"> 289</span></a>  <span class="comment"> * @param settings_navigation $settingsnav The settings navigation object</span>
<a name="l290"><span class="linenum"> 290</span></a>  <span class="comment"> * @param navigation_node $booknode The node to add module settings to</span>
<a name="l291"><span class="linenum"> 291</span></a>  <span class="comment"> * @return void</span>
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment"> */</span>
<a name="l293"><span class="linenum"> 293</span></a>  function <a class="function" onClick="logFunction('book_extend_settings_navigation')" href="../../_functions/book_extend_settings_navigation.html" onMouseOver="funcPopup(event,'book_extend_settings_navigation')">book_extend_settings_navigation</a>(settings_navigation <a class="var it5557" onMouseOver="hilite(5557)" onMouseOut="lolite()" onClick="logVariable('settingsnav')" href="../../_variables/settingsnav.html">$settingsnav</a>, navigation_node <a class="var it36268" onMouseOver="hilite(36268)" onMouseOut="lolite()" onClick="logVariable('booknode')" href="../../_variables/booknode.html">$booknode</a>) {
<a name="l294"><span class="linenum"> 294</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>;
<a name="l295"><span class="linenum"> 295</span></a>  
<a name="l296"><span class="linenum"> 296</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../../_variables/plugins.html">$plugins</a> = <a class="class" onClick="logClass('core_component')" href="../../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_list')" href="../../_functions/get_plugin_list.html" onMouseOver="funcPopup(event,'get_plugin_list')">get_plugin_list</a>('booktool');
<a name="l297"><span class="linenum"> 297</span></a>      foreach (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../../_variables/plugins.html">$plugins</a> as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a> =&gt; <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>) {
<a name="l298"><span class="linenum"> 298</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>/lib.php&quot;)) {
<a name="l299"><span class="linenum"> 299</span></a>              require_once(&quot;<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>/lib.php&quot;);
<a name="l300"><span class="linenum"> 300</span></a>          }
<a name="l301"><span class="linenum"> 301</span></a>          <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../../_variables/function.html">$function</a> = 'booktool_'.<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>.'_extend_settings_navigation';
<a name="l302"><span class="linenum"> 302</span></a>          if (<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../../_variables/function.html">$function</a>)) {
<a name="l303"><span class="linenum"> 303</span></a>              <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../../_variables/function.html">$function</a>(<a class="var it5557" onMouseOver="hilite(5557)" onMouseOut="lolite()" onClick="logVariable('settingsnav')" href="../../_variables/settingsnav.html">$settingsnav</a>, <a class="var it36268" onMouseOver="hilite(36268)" onMouseOut="lolite()" onClick="logVariable('booknode')" href="../../_variables/booknode.html">$booknode</a>);
<a name="l304"><span class="linenum"> 304</span></a>          }
<a name="l305"><span class="linenum"> 305</span></a>      }
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/url.html">url</a>-&gt;<a class="function" onClick="logFunction('params')" href="../../_functions/params.html" onMouseOver="funcPopup(event,'params')">params</a>();
<a name="l308"><span class="linenum"> 308</span></a>  
<a name="l309"><span class="linenum"> 309</span></a>      if (!empty(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['id']) and !empty(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['chapterid']) and <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/book:edit', <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('cm')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../../_variables/cm.html">cm</a>-&gt;context)) {
<a name="l310"><span class="linenum"> 310</span></a>          if (!empty(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('editing')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/editing.html">editing</a>)) {
<a name="l311"><span class="linenum"> 311</span></a>              <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;turneditingoff&quot;);
<a name="l312"><span class="linenum"> 312</span></a>              <a class="var it417" onMouseOver="hilite(417)" onMouseOut="lolite()" onClick="logVariable('edit')" href="../../_variables/edit.html">$edit</a> = '0';
<a name="l313"><span class="linenum"> 313</span></a>          } else {
<a name="l314"><span class="linenum"> 314</span></a>              <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;turneditingon&quot;);
<a name="l315"><span class="linenum"> 315</span></a>              <a class="var it417" onMouseOver="hilite(417)" onMouseOut="lolite()" onClick="logVariable('edit')" href="../../_variables/edit.html">$edit</a> = '1';
<a name="l316"><span class="linenum"> 316</span></a>          }
<a name="l317"><span class="linenum"> 317</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../mod/book/view.php.html">/mod/book/view.php</a>', array('id'=&gt;<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['id'], 'chapterid'=&gt;<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['chapterid'], 'edit'=&gt;<a class="var it417" onMouseOver="hilite(417)" onMouseOut="lolite()" onClick="logVariable('edit')" href="../../_variables/edit.html">$edit</a>, 'sesskey'=&gt;<a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>()));
<a name="l318"><span class="linenum"> 318</span></a>          <a class="var it36268" onMouseOver="hilite(36268)" onMouseOut="lolite()" onClick="logVariable('booknode')" href="../../_variables/booknode.html">$booknode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>, <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l319"><span class="linenum"> 319</span></a>      }
<a name="l320"><span class="linenum"> 320</span></a>  }
<a name="l321"><span class="linenum"> 321</span></a>  
<a name="l322"><span class="linenum"> 322</span></a>  
<a name="l323"><span class="linenum"> 323</span></a>  <span class="comment">/**</span>
<a name="l324"><span class="linenum"> 324</span></a>  <span class="comment"> * Lists all browsable file areas</span>
<a name="l325"><span class="linenum"> 325</span></a>  <span class="comment"> * @param object $course</span>
<a name="l326"><span class="linenum"> 326</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l327"><span class="linenum"> 327</span></a>  <span class="comment"> * @param object $context</span>
<a name="l328"><span class="linenum"> 328</span></a>  <span class="comment"> * @return array</span>
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment"> */</span>
<a name="l330"><span class="linenum"> 330</span></a>  function <a class="function" onClick="logFunction('book_get_file_areas')" href="../../_functions/book_get_file_areas.html" onMouseOver="funcPopup(event,'book_get_file_areas')">book_get_file_areas</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l331"><span class="linenum"> 331</span></a>      <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a> = array();
<a name="l332"><span class="linenum"> 332</span></a>      <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>['chapter'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('chapters', 'mod_book');
<a name="l333"><span class="linenum"> 333</span></a>      return <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>;
<a name="l334"><span class="linenum"> 334</span></a>  }
<a name="l335"><span class="linenum"> 335</span></a>  
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">/**</span>
<a name="l337"><span class="linenum"> 337</span></a>  <span class="comment"> * File browsing support for book module chapter area.</span>
<a name="l338"><span class="linenum"> 338</span></a>  <span class="comment"> * @param object $browser</span>
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment"> * @param object $areas</span>
<a name="l340"><span class="linenum"> 340</span></a>  <span class="comment"> * @param object $course</span>
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment"> * @param object $cm</span>
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment"> * @param object $context</span>
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment"> * @param string $filearea</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment"> * @param int $itemid</span>
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment"> * @param string $filepath</span>
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment"> * @param string $filename</span>
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment"> * @return object file_info instance or null if not found</span>
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment"> */</span>
<a name="l349"><span class="linenum"> 349</span></a>  function <a class="function" onClick="logFunction('book_get_file_info')" href="../../_functions/book_get_file_info.html" onMouseOver="funcPopup(event,'book_get_file_info')">book_get_file_info</a>(<a class="var it1462" onMouseOver="hilite(1462)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) {
<a name="l350"><span class="linenum"> 350</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l351"><span class="linenum"> 351</span></a>  
<a name="l352"><span class="linenum"> 352</span></a>  <span class="comment">    // note: 'intro' area is handled in file_browser automatically</span>
<a name="l353"><span class="linenum"> 353</span></a>  
<a name="l354"><span class="linenum"> 354</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/book:read', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l355"><span class="linenum"> 355</span></a>          return null;
<a name="l356"><span class="linenum"> 356</span></a>      }
<a name="l357"><span class="linenum"> 357</span></a>  
<a name="l358"><span class="linenum"> 358</span></a>      if (<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> !== 'chapter') {
<a name="l359"><span class="linenum"> 359</span></a>          return null;
<a name="l360"><span class="linenum"> 360</span></a>      }
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>      <span class="keyword">require_once</span> <a class="filename" href="../../mod/workshop/locallib.php.html" onMouseOver="reqPopup(event, 'locallib.php', '../../mod/workshop/locallib.php')">(__DIR__.'/locallib.php')</a>;
<a name="l363"><span class="linenum"> 363</span></a>  
<a name="l364"><span class="linenum"> 364</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>)) {
<a name="l365"><span class="linenum"> 365</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('book_file_info')" href="../../_classes/book_file_info.html" onMouseOver="classPopup(event,'book_file_info')">book_file_info</a>(<a class="var it1462" onMouseOver="hilite(1462)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2274" onMouseOver="hilite(2274)" onMouseOut="lolite()" onClick="logVariable('areas')" href="../../_variables/areas.html">$areas</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>);
<a name="l366"><span class="linenum"> 366</span></a>      }
<a name="l367"><span class="linenum"> 367</span></a>  
<a name="l368"><span class="linenum"> 368</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l369"><span class="linenum"> 369</span></a>      <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>) ? '/' : <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>;
<a name="l370"><span class="linenum"> 370</span></a>      <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) ? '.' : <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>;
<a name="l371"><span class="linenum"> 371</span></a>      if (!<a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file')" href="../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_book', <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>)) {
<a name="l372"><span class="linenum"> 372</span></a>          return null;
<a name="l373"><span class="linenum"> 373</span></a>      }
<a name="l374"><span class="linenum"> 374</span></a>  
<a name="l375"><span class="linenum"> 375</span></a>  <span class="comment">    // modifications may be tricky - may cause caching problems</span>
<a name="l376"><span class="linenum"> 376</span></a>      <a class="var it36269" onMouseOver="hilite(36269)" onMouseOut="lolite()" onClick="logVariable('canwrite')" href="../../_variables/canwrite.html">$canwrite</a> = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/book:edit', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l377"><span class="linenum"> 377</span></a>  
<a name="l378"><span class="linenum"> 378</span></a>      <a class="var it36270" onMouseOver="hilite(36270)" onMouseOut="lolite()" onClick="logVariable('chaptername')" href="../../_variables/chaptername.html">$chaptername</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('book_chapters', 'title', array('bookid'=&gt;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>, 'id'=&gt;<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>));
<a name="l379"><span class="linenum"> 379</span></a>      <a class="var it36270" onMouseOver="hilite(36270)" onMouseOut="lolite()" onClick="logVariable('chaptername')" href="../../_variables/chaptername.html">$chaptername</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it36270" onMouseOver="hilite(36270)" onMouseOut="lolite()" onClick="logVariable('chaptername')" href="../../_variables/chaptername.html">$chaptername</a>, true, array('context'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>));
<a name="l380"><span class="linenum"> 380</span></a>  
<a name="l381"><span class="linenum"> 381</span></a>      <a class="var it2276" onMouseOver="hilite(2276)" onMouseOut="lolite()" onClick="logVariable('urlbase')" href="../../_variables/urlbase.html">$urlbase</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'<a class="filename" href="../../pluginfile.php.html">/pluginfile.php</a>';
<a name="l382"><span class="linenum"> 382</span></a>      return <span class="keyword">new </span><a class="class" onClick="logClass('file_info_stored')" href="../../_classes/file_info_stored.html" onMouseOver="classPopup(event,'file_info_stored')">file_info_stored</a>(<a class="var it1462" onMouseOver="hilite(1462)" onMouseOut="lolite()" onClick="logVariable('browser')" href="../../_variables/browser.html">$browser</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>, <a class="var it2276" onMouseOver="hilite(2276)" onMouseOut="lolite()" onClick="logVariable('urlbase')" href="../../_variables/urlbase.html">$urlbase</a>, <a class="var it36270" onMouseOver="hilite(36270)" onMouseOut="lolite()" onClick="logVariable('chaptername')" href="../../_variables/chaptername.html">$chaptername</a>, true, true, <a class="var it36269" onMouseOver="hilite(36269)" onMouseOut="lolite()" onClick="logVariable('canwrite')" href="../../_variables/canwrite.html">$canwrite</a>, false);
<a name="l383"><span class="linenum"> 383</span></a>  }
<a name="l384"><span class="linenum"> 384</span></a>  
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment">/**</span>
<a name="l386"><span class="linenum"> 386</span></a>  <span class="comment"> * Serves the book attachments. Implements needed access control ;-)</span>
<a name="l387"><span class="linenum"> 387</span></a>  <span class="comment"> *</span>
<a name="l388"><span class="linenum"> 388</span></a>  <span class="comment"> * @param stdClass $course course object</span>
<a name="l389"><span class="linenum"> 389</span></a>  <span class="comment"> * @param cm_info $cm course module object</span>
<a name="l390"><span class="linenum"> 390</span></a>  <span class="comment"> * @param context $context context object</span>
<a name="l391"><span class="linenum"> 391</span></a>  <span class="comment"> * @param string $filearea file area</span>
<a name="l392"><span class="linenum"> 392</span></a>  <span class="comment"> * @param array $args extra arguments</span>
<a name="l393"><span class="linenum"> 393</span></a>  <span class="comment"> * @param bool $forcedownload whether or not force download</span>
<a name="l394"><span class="linenum"> 394</span></a>  <span class="comment"> * @param array $options additional options affecting the file serving</span>
<a name="l395"><span class="linenum"> 395</span></a>  <span class="comment"> * @return bool false if file not found, does not return if found - just send the file</span>
<a name="l396"><span class="linenum"> 396</span></a>  <span class="comment"> */</span>
<a name="l397"><span class="linenum"> 397</span></a>  function <a class="function" onClick="logFunction('book_pluginfile')" href="../../_functions/book_pluginfile.html" onMouseOver="funcPopup(event,'book_pluginfile')">book_pluginfile</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('forcedownload')" href="../../_variables/forcedownload.html">$forcedownload</a>, array <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>=array()) {
<a name="l398"><span class="linenum"> 398</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l399"><span class="linenum"> 399</span></a>  
<a name="l400"><span class="linenum"> 400</span></a>      if (<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l401"><span class="linenum"> 401</span></a>          return false;
<a name="l402"><span class="linenum"> 402</span></a>      }
<a name="l403"><span class="linenum"> 403</span></a>  
<a name="l404"><span class="linenum"> 404</span></a>      <a class="function" onClick="logFunction('require_course_login')" href="../../_functions/require_course_login.html" onMouseOver="funcPopup(event,'require_course_login')">require_course_login</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, true, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>      if (<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> !== 'chapter') {
<a name="l407"><span class="linenum"> 407</span></a>          return false;
<a name="l408"><span class="linenum"> 408</span></a>      }
<a name="l409"><span class="linenum"> 409</span></a>  
<a name="l410"><span class="linenum"> 410</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/book:read', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l411"><span class="linenum"> 411</span></a>          return false;
<a name="l412"><span class="linenum"> 412</span></a>      }
<a name="l413"><span class="linenum"> 413</span></a>  
<a name="l414"><span class="linenum"> 414</span></a>      <a class="var it9158" onMouseOver="hilite(9158)" onMouseOut="lolite()" onClick="logVariable('chid')" href="../../_variables/chid.html">$chid</a> = (int)<a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l415"><span class="linenum"> 415</span></a>  
<a name="l416"><span class="linenum"> 416</span></a>      if (!<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('book', array('id'=&gt;<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>))) {
<a name="l417"><span class="linenum"> 417</span></a>          return false;
<a name="l418"><span class="linenum"> 418</span></a>      }
<a name="l419"><span class="linenum"> 419</span></a>  
<a name="l420"><span class="linenum"> 420</span></a>      if (!<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('book_chapters', array('id'=&gt;<a class="var it9158" onMouseOver="hilite(9158)" onMouseOut="lolite()" onClick="logVariable('chid')" href="../../_variables/chid.html">$chid</a>, 'bookid'=&gt;<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('id')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l421"><span class="linenum"> 421</span></a>          return false;
<a name="l422"><span class="linenum"> 422</span></a>      }
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>      if (<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('hidden')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/hidden.html">hidden</a> and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('mod/book:viewhiddenchapters', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l425"><span class="linenum"> 425</span></a>          return false;
<a name="l426"><span class="linenum"> 426</span></a>      }
<a name="l427"><span class="linenum"> 427</span></a>  
<a name="l428"><span class="linenum"> 428</span></a>  <span class="comment">    // Download the contents of a chapter as an html file.</span>
<a name="l429"><span class="linenum"> 429</span></a>      if (<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>[0] == 'index.html') {
<a name="l430"><span class="linenum"> 430</span></a>          <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = &quot;index.html&quot;;
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>  <span class="comment">        // We need to rewrite the pluginfile URLs so the media filters can work.</span>
<a name="l433"><span class="linenum"> 433</span></a>          <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('file_rewrite_pluginfile_urls')" href="../../_functions/file_rewrite_pluginfile_urls.html" onMouseOver="funcPopup(event,'file_rewrite_pluginfile_urls')">file_rewrite_pluginfile_urls</a>(<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('content')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/content.html">content</a>, '<a class="filename" href="../../webservice/pluginfile.php.html">webservice/pluginfile.php</a>', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_book', 'chapter',
<a name="l434"><span class="linenum"> 434</span></a>                                                  <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l435"><span class="linenum"> 435</span></a>          <a class="var it8419" onMouseOver="hilite(8419)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a> = new stdClass;
<a name="l436"><span class="linenum"> 436</span></a>          <a class="var it8419" onMouseOver="hilite(8419)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>-&gt;<a onClick="logVariable('noclean')" class="var it43693" onMouseOver="hilite(43693)" onMouseOut="lolite()" href="../../_variables/noclean.html">noclean</a> = true;
<a name="l437"><span class="linenum"> 437</span></a>          <a class="var it8419" onMouseOver="hilite(8419)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>-&gt;<a onClick="logVariable('overflowdiv')" class="var it43693" onMouseOver="hilite(43693)" onMouseOut="lolite()" href="../../_variables/overflowdiv.html">overflowdiv</a> = true;
<a name="l438"><span class="linenum"> 438</span></a>          <a class="var it8419" onMouseOver="hilite(8419)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>-&gt;<a onClick="logVariable('context')" class="var it43693" onMouseOver="hilite(43693)" onMouseOut="lolite()" href="../../_variables/context.html">context</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>;
<a name="l439"><span class="linenum"> 439</span></a>  
<a name="l440"><span class="linenum"> 440</span></a>          <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('format_text')" href="../../_functions/format_text.html" onMouseOver="funcPopup(event,'format_text')">format_text</a>(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>, <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('contentformat')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/contentformat.html">contentformat</a>, <a class="var it8419" onMouseOver="hilite(8419)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>);
<a name="l441"><span class="linenum"> 441</span></a>  
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">        // Remove @@PLUGINFILE@@/.</span>
<a name="l443"><span class="linenum"> 443</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = array('reverse' =&gt; true);
<a name="l444"><span class="linenum"> 444</span></a>          <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('file_rewrite_pluginfile_urls')" href="../../_functions/file_rewrite_pluginfile_urls.html" onMouseOver="funcPopup(event,'file_rewrite_pluginfile_urls')">file_rewrite_pluginfile_urls</a>(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>, '<a class="filename" href="../../webservice/pluginfile.php.html">webservice/pluginfile.php</a>', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_book', 'chapter',
<a name="l445"><span class="linenum"> 445</span></a>                                                  <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>);
<a name="l446"><span class="linenum"> 446</span></a>          <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('@@PLUGINFILE@@/', '', <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l447"><span class="linenum"> 447</span></a>  
<a name="l448"><span class="linenum"> 448</span></a>          <a class="var it3309" onMouseOver="hilite(3309)" onMouseOut="lolite()" onClick="logVariable('titles')" href="../../_variables/titles.html">$titles</a> = &quot;&quot;;
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment">        // Format the chapter titles.</span>
<a name="l450"><span class="linenum"> 450</span></a>          if (!<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('customtitles')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/customtitles.html">customtitles</a>) {
<a name="l451"><span class="linenum"> 451</span></a>              <span class="keyword">require_once</span> <a class="filename" href="../../mod/workshop/locallib.php.html" onMouseOver="reqPopup(event, 'locallib.php', '../../mod/workshop/locallib.php')">(__DIR__.'/locallib.php')</a>;
<a name="l452"><span class="linenum"> 452</span></a>              <a class="var it6253" onMouseOver="hilite(6253)" onMouseOut="lolite()" onClick="logVariable('chapters')" href="../../_variables/chapters.html">$chapters</a> = <a class="function" onClick="logFunction('book_preload_chapters')" href="../../_functions/book_preload_chapters.html" onMouseOver="funcPopup(event,'book_preload_chapters')">book_preload_chapters</a>(<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>);
<a name="l453"><span class="linenum"> 453</span></a>  
<a name="l454"><span class="linenum"> 454</span></a>              if (!<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('subchapter')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/subchapter.html">subchapter</a>) {
<a name="l455"><span class="linenum"> 455</span></a>                  <a class="var it26419" onMouseOver="hilite(26419)" onMouseOut="lolite()" onClick="logVariable('currtitle')" href="../../_variables/currtitle.html">$currtitle</a> = <a class="function" onClick="logFunction('book_get_chapter_title')" href="../../_functions/book_get_chapter_title.html" onMouseOver="funcPopup(event,'book_get_chapter_title')">book_get_chapter_title</a>(<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it6253" onMouseOver="hilite(6253)" onMouseOut="lolite()" onClick="logVariable('chapters')" href="../../_variables/chapters.html">$chapters</a>, <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l456"><span class="linenum"> 456</span></a>  <span class="comment">                // Note that we can't use the $OUTPUT-&gt;heading() in WS_SERVER mode.</span>
<a name="l457"><span class="linenum"> 457</span></a>                  <a class="var it3309" onMouseOver="hilite(3309)" onMouseOut="lolite()" onClick="logVariable('titles')" href="../../_variables/titles.html">$titles</a> = &quot;&lt;h3&gt;<a class="var it26419" onMouseOver="hilite(26419)" onMouseOut="lolite()" onClick="logVariable('currtitle')" href="../../_variables/currtitle.html">$currtitle</a>&lt;/h3&gt;&quot;;
<a name="l458"><span class="linenum"> 458</span></a>              } else {
<a name="l459"><span class="linenum"> 459</span></a>                  <a class="var it26419" onMouseOver="hilite(26419)" onMouseOut="lolite()" onClick="logVariable('currtitle')" href="../../_variables/currtitle.html">$currtitle</a> = <a class="function" onClick="logFunction('book_get_chapter_title')" href="../../_functions/book_get_chapter_title.html" onMouseOver="funcPopup(event,'book_get_chapter_title')">book_get_chapter_title</a>(<a class="var it6253" onMouseOver="hilite(6253)" onMouseOut="lolite()" onClick="logVariable('chapters')" href="../../_variables/chapters.html">$chapters</a>[<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;parent, <a class="var it6253" onMouseOver="hilite(6253)" onMouseOut="lolite()" onClick="logVariable('chapters')" href="../../_variables/chapters.html">$chapters</a>, <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l460"><span class="linenum"> 460</span></a>                  <a class="var it26420" onMouseOver="hilite(26420)" onMouseOut="lolite()" onClick="logVariable('currsubtitle')" href="../../_variables/currsubtitle.html">$currsubtitle</a> = <a class="function" onClick="logFunction('book_get_chapter_title')" href="../../_functions/book_get_chapter_title.html" onMouseOver="funcPopup(event,'book_get_chapter_title')">book_get_chapter_title</a>(<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it6253" onMouseOver="hilite(6253)" onMouseOut="lolite()" onClick="logVariable('chapters')" href="../../_variables/chapters.html">$chapters</a>, <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">                // Note that we can't use the $OUTPUT-&gt;heading() in WS_SERVER mode.</span>
<a name="l462"><span class="linenum"> 462</span></a>                  <a class="var it3309" onMouseOver="hilite(3309)" onMouseOut="lolite()" onClick="logVariable('titles')" href="../../_variables/titles.html">$titles</a> = &quot;&lt;h3&gt;<a class="var it26419" onMouseOver="hilite(26419)" onMouseOut="lolite()" onClick="logVariable('currtitle')" href="../../_variables/currtitle.html">$currtitle</a>&lt;/h3&gt;&quot;;
<a name="l463"><span class="linenum"> 463</span></a>                  <a class="var it3309" onMouseOver="hilite(3309)" onMouseOut="lolite()" onClick="logVariable('titles')" href="../../_variables/titles.html">$titles</a> .= &quot;&lt;h4&gt;<a class="var it26420" onMouseOver="hilite(26420)" onMouseOut="lolite()" onClick="logVariable('currsubtitle')" href="../../_variables/currsubtitle.html">$currsubtitle</a>&lt;/h4&gt;&quot;;
<a name="l464"><span class="linenum"> 464</span></a>              }
<a name="l465"><span class="linenum"> 465</span></a>          }
<a name="l466"><span class="linenum"> 466</span></a>  
<a name="l467"><span class="linenum"> 467</span></a>          <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="var it3309" onMouseOver="hilite(3309)" onMouseOut="lolite()" onClick="logVariable('titles')" href="../../_variables/titles.html">$titles</a> . <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>;
<a name="l468"><span class="linenum"> 468</span></a>  
<a name="l469"><span class="linenum"> 469</span></a>          <a class="function" onClick="logFunction('send_file')" href="../../_functions/send_file.html" onMouseOver="funcPopup(event,'send_file')">send_file</a>(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>, 0, 0, true, true);
<a name="l470"><span class="linenum"> 470</span></a>      } else {
<a name="l471"><span class="linenum"> 471</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l472"><span class="linenum"> 472</span></a>          <a class="var it2277" onMouseOver="hilite(2277)" onMouseOut="lolite()" onClick="logVariable('relativepath')" href="../../_variables/relativepath.html">$relativepath</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('args')" href="../../_variables/args.html">$args</a>);
<a name="l473"><span class="linenum"> 473</span></a>          <a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a> = &quot;/<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>/mod_book/chapter/<a class="var it9158" onMouseOver="hilite(9158)" onMouseOut="lolite()" onClick="logVariable('chid')" href="../../_variables/chid.html">$chid</a>/<a class="var it2277" onMouseOver="hilite(2277)" onMouseOut="lolite()" onClick="logVariable('relativepath')" href="../../_variables/relativepath.html">$relativepath</a>&quot;;
<a name="l474"><span class="linenum"> 474</span></a>          if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file_by_hash')" href="../../_functions/get_file_by_hash.html" onMouseOver="funcPopup(event,'get_file_by_hash')">get_file_by_hash</a>(<a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('fullpath')" href="../../_variables/fullpath.html">$fullpath</a>)) or <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('is_directory')" href="../../_functions/is_directory.html" onMouseOver="funcPopup(event,'is_directory')">is_directory</a>()) {
<a name="l475"><span class="linenum"> 475</span></a>              return false;
<a name="l476"><span class="linenum"> 476</span></a>          }
<a name="l477"><span class="linenum"> 477</span></a>  
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">        // Nasty hack because we do not have file revisions in book yet.</span>
<a name="l479"><span class="linenum"> 479</span></a>          <a class="var it3341" onMouseOver="hilite(3341)" onMouseOut="lolite()" onClick="logVariable('lifetime')" href="../../_variables/lifetime.html">$lifetime</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('filelifetime')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/filelifetime.html">filelifetime</a>;
<a name="l480"><span class="linenum"> 480</span></a>          if (<a class="var it3341" onMouseOver="hilite(3341)" onMouseOut="lolite()" onClick="logVariable('lifetime')" href="../../_variables/lifetime.html">$lifetime</a> &gt; 60 * 10) {
<a name="l481"><span class="linenum"> 481</span></a>              <a class="var it3341" onMouseOver="hilite(3341)" onMouseOut="lolite()" onClick="logVariable('lifetime')" href="../../_variables/lifetime.html">$lifetime</a> = 60 * 10;
<a name="l482"><span class="linenum"> 482</span></a>          }
<a name="l483"><span class="linenum"> 483</span></a>  
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment">        // Finally send the file.</span>
<a name="l485"><span class="linenum"> 485</span></a>          <a class="function" onClick="logFunction('send_stored_file')" href="../../_functions/send_stored_file.html" onMouseOver="funcPopup(event,'send_stored_file')">send_stored_file</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, <a class="var it3341" onMouseOver="hilite(3341)" onMouseOut="lolite()" onClick="logVariable('lifetime')" href="../../_variables/lifetime.html">$lifetime</a>, 0, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('forcedownload')" href="../../_variables/forcedownload.html">$forcedownload</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>);
<a name="l486"><span class="linenum"> 486</span></a>      }
<a name="l487"><span class="linenum"> 487</span></a>  }
<a name="l488"><span class="linenum"> 488</span></a>  
<a name="l489"><span class="linenum"> 489</span></a>  <span class="comment">/**</span>
<a name="l490"><span class="linenum"> 490</span></a>  <span class="comment"> * Return a list of page types</span>
<a name="l491"><span class="linenum"> 491</span></a>  <span class="comment"> *</span>
<a name="l492"><span class="linenum"> 492</span></a>  <span class="comment"> * @param string $pagetype current page type</span>
<a name="l493"><span class="linenum"> 493</span></a>  <span class="comment"> * @param stdClass $parentcontext Block's parent context</span>
<a name="l494"><span class="linenum"> 494</span></a>  <span class="comment"> * @param stdClass $currentcontext Current context of block</span>
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment"> * @return array</span>
<a name="l496"><span class="linenum"> 496</span></a>  <span class="comment"> */</span>
<a name="l497"><span class="linenum"> 497</span></a>  function <a class="function" onClick="logFunction('book_page_type_list')" href="../../_functions/book_page_type_list.html" onMouseOver="funcPopup(event,'book_page_type_list')">book_page_type_list</a>(<a class="var it2278" onMouseOver="hilite(2278)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../../_variables/pagetype.html">$pagetype</a>, <a class="var it2279" onMouseOver="hilite(2279)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../../_variables/parentcontext.html">$parentcontext</a>, <a class="var it2280" onMouseOver="hilite(2280)" onMouseOut="lolite()" onClick="logVariable('currentcontext')" href="../../_variables/currentcontext.html">$currentcontext</a>) {
<a name="l498"><span class="linenum"> 498</span></a>      <a class="var it9844" onMouseOver="hilite(9844)" onMouseOut="lolite()" onClick="logVariable('module_pagetype')" href="../../_variables/module_pagetype.html">$module_pagetype</a> = array('mod-book-*'=&gt;<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-mod-book-x', 'mod_book'));
<a name="l499"><span class="linenum"> 499</span></a>      return <a class="var it9844" onMouseOver="hilite(9844)" onMouseOut="lolite()" onClick="logVariable('module_pagetype')" href="../../_variables/module_pagetype.html">$module_pagetype</a>;
<a name="l500"><span class="linenum"> 500</span></a>  }
<a name="l501"><span class="linenum"> 501</span></a>  
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment">/**</span>
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment"> * Export book resource contents</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment"> *</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment"> * @param  stdClass $cm     Course module object</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment"> * @param  string $baseurl  Base URL for file downloads</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment"> * @return array of file content</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment"> */</span>
<a name="l509"><span class="linenum"> 509</span></a>  function <a class="function" onClick="logFunction('book_export_contents')" href="../../_functions/book_export_contents.html" onMouseOver="funcPopup(event,'book_export_contents')">book_export_contents</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it424" onMouseOver="hilite(424)" onMouseOut="lolite()" onClick="logVariable('baseurl')" href="../../_variables/baseurl.html">$baseurl</a>) {
<a name="l510"><span class="linenum"> 510</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l511"><span class="linenum"> 511</span></a>  
<a name="l512"><span class="linenum"> 512</span></a>      <a class="var it271" onMouseOver="hilite(271)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a> = array();
<a name="l513"><span class="linenum"> 513</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l514"><span class="linenum"> 514</span></a>  
<a name="l515"><span class="linenum"> 515</span></a>      <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('book', array('id' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/instance.html">instance</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l516"><span class="linenum"> 516</span></a>  
<a name="l517"><span class="linenum"> 517</span></a>      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l518"><span class="linenum"> 518</span></a>  
<a name="l519"><span class="linenum"> 519</span></a>      <a class="var it6253" onMouseOver="hilite(6253)" onMouseOut="lolite()" onClick="logVariable('chapters')" href="../../_variables/chapters.html">$chapters</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('book_chapters', array('bookid' =&gt; <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('id')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), 'pagenum');
<a name="l520"><span class="linenum"> 520</span></a>  
<a name="l521"><span class="linenum"> 521</span></a>      <a class="var it273" onMouseOver="hilite(273)" onMouseOut="lolite()" onClick="logVariable('structure')" href="../../_variables/structure.html">$structure</a> = array();
<a name="l522"><span class="linenum"> 522</span></a>      <a class="var it36271" onMouseOver="hilite(36271)" onMouseOut="lolite()" onClick="logVariable('currentchapter')" href="../../_variables/currentchapter.html">$currentchapter</a> = 0;
<a name="l523"><span class="linenum"> 523</span></a>  
<a name="l524"><span class="linenum"> 524</span></a>      foreach (<a class="var it6253" onMouseOver="hilite(6253)" onMouseOut="lolite()" onClick="logVariable('chapters')" href="../../_variables/chapters.html">$chapters</a> as <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>) {
<a name="l525"><span class="linenum"> 525</span></a>          if (<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('hidden')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/hidden.html">hidden</a>) {
<a name="l526"><span class="linenum"> 526</span></a>              continue;
<a name="l527"><span class="linenum"> 527</span></a>          }
<a name="l528"><span class="linenum"> 528</span></a>  
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment">        // Generate the book structure.</span>
<a name="l530"><span class="linenum"> 530</span></a>          <a class="var it36272" onMouseOver="hilite(36272)" onMouseOut="lolite()" onClick="logVariable('thischapter')" href="../../_variables/thischapter.html">$thischapter</a> = array(
<a name="l531"><span class="linenum"> 531</span></a>              &quot;title&quot;     =&gt; <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('title')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/title.html">title</a>, true, array('context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)),
<a name="l532"><span class="linenum"> 532</span></a>              &quot;href&quot;      =&gt; <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> . &quot;/index.html&quot;,
<a name="l533"><span class="linenum"> 533</span></a>              &quot;level&quot;     =&gt; 0,
<a name="l534"><span class="linenum"> 534</span></a>              &quot;subitems&quot;  =&gt; array()
<a name="l535"><span class="linenum"> 535</span></a>          );
<a name="l536"><span class="linenum"> 536</span></a>  
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment">        // Main chapter.</span>
<a name="l538"><span class="linenum"> 538</span></a>          if (!<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('subchapter')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/subchapter.html">subchapter</a>) {
<a name="l539"><span class="linenum"> 539</span></a>              <a class="var it36271" onMouseOver="hilite(36271)" onMouseOut="lolite()" onClick="logVariable('currentchapter')" href="../../_variables/currentchapter.html">$currentchapter</a> = <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('pagenum')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/pagenum.html">pagenum</a>;
<a name="l540"><span class="linenum"> 540</span></a>              <a class="var it273" onMouseOver="hilite(273)" onMouseOut="lolite()" onClick="logVariable('structure')" href="../../_variables/structure.html">$structure</a>[<a class="var it36271" onMouseOver="hilite(36271)" onMouseOut="lolite()" onClick="logVariable('currentchapter')" href="../../_variables/currentchapter.html">$currentchapter</a>] = <a class="var it36272" onMouseOver="hilite(36272)" onMouseOut="lolite()" onClick="logVariable('thischapter')" href="../../_variables/thischapter.html">$thischapter</a>;
<a name="l541"><span class="linenum"> 541</span></a>          } else {
<a name="l542"><span class="linenum"> 542</span></a>  <span class="comment">            // Subchapter.</span>
<a name="l543"><span class="linenum"> 543</span></a>              <a class="var it36272" onMouseOver="hilite(36272)" onMouseOut="lolite()" onClick="logVariable('thischapter')" href="../../_variables/thischapter.html">$thischapter</a>['level'] = 1;
<a name="l544"><span class="linenum"> 544</span></a>              <a class="var it273" onMouseOver="hilite(273)" onMouseOut="lolite()" onClick="logVariable('structure')" href="../../_variables/structure.html">$structure</a>[<a class="var it36271" onMouseOver="hilite(36271)" onMouseOut="lolite()" onClick="logVariable('currentchapter')" href="../../_variables/currentchapter.html">$currentchapter</a>][&quot;subitems&quot;][] = <a class="var it36272" onMouseOver="hilite(36272)" onMouseOut="lolite()" onClick="logVariable('thischapter')" href="../../_variables/thischapter.html">$thischapter</a>;
<a name="l545"><span class="linenum"> 545</span></a>          }
<a name="l546"><span class="linenum"> 546</span></a>  
<a name="l547"><span class="linenum"> 547</span></a>  <span class="comment">        // Export the chapter contents.</span>
<a name="l548"><span class="linenum"> 548</span></a>  
<a name="l549"><span class="linenum"> 549</span></a>  <span class="comment">        // Main content (html).</span>
<a name="l550"><span class="linenum"> 550</span></a>          <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = 'index.html';
<a name="l551"><span class="linenum"> 551</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a> = array();
<a name="l552"><span class="linenum"> 552</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['type']         = 'file';
<a name="l553"><span class="linenum"> 553</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['filename']     = <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>;
<a name="l554"><span class="linenum"> 554</span></a>  <span class="comment">        // Each chapter in a subdirectory.</span>
<a name="l555"><span class="linenum"> 555</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['filepath']     = &quot;/{<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>}/&quot;;
<a name="l556"><span class="linenum"> 556</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['filesize']     = 0;
<a name="l557"><span class="linenum"> 557</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['fileurl']      = <a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>::<a class="function" onClick="logFunction('make_webservice_pluginfile_url')" href="../../_functions/make_webservice_pluginfile_url.html" onMouseOver="funcPopup(event,'make_webservice_pluginfile_url')">make_webservice_pluginfile_url</a>(
<a name="l558"><span class="linenum"> 558</span></a>                      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_book', 'chapter', <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, '/', 'index.html')-&gt;<a class="function" onClick="logFunction('out')" href="../../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>(false);
<a name="l559"><span class="linenum"> 559</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['timecreated']  = <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>;
<a name="l560"><span class="linenum"> 560</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['timemodified'] = <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>;
<a name="l561"><span class="linenum"> 561</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['content']      = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('title')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/title.html">title</a>, true, array('context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>));
<a name="l562"><span class="linenum"> 562</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['sortorder']    = 0;
<a name="l563"><span class="linenum"> 563</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['userid']       = null;
<a name="l564"><span class="linenum"> 564</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['author']       = null;
<a name="l565"><span class="linenum"> 565</span></a>          <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>['license']      = null;
<a name="l566"><span class="linenum"> 566</span></a>          <a class="var it271" onMouseOver="hilite(271)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a>[] = <a class="var it36273" onMouseOver="hilite(36273)" onMouseOut="lolite()" onClick="logVariable('chapterindexfile')" href="../../_variables/chapterindexfile.html">$chapterindexfile</a>;
<a name="l567"><span class="linenum"> 567</span></a>  
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment">        // Chapter files (images usually).</span>
<a name="l569"><span class="linenum"> 569</span></a>          <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_book', 'chapter', <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'sortorder DESC, id ASC', false);
<a name="l570"><span class="linenum"> 570</span></a>          foreach (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> as <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>) {
<a name="l571"><span class="linenum"> 571</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = array();
<a name="l572"><span class="linenum"> 572</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['type']         = 'file';
<a name="l573"><span class="linenum"> 573</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['filename']     = <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>();
<a name="l574"><span class="linenum"> 574</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['filepath']     = &quot;/{<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>}&quot; . <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_filepath')" href="../../_functions/get_filepath.html" onMouseOver="funcPopup(event,'get_filepath')">get_filepath</a>();
<a name="l575"><span class="linenum"> 575</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['filesize']     = <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_filesize')" href="../../_functions/get_filesize.html" onMouseOver="funcPopup(event,'get_filesize')">get_filesize</a>();
<a name="l576"><span class="linenum"> 576</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['fileurl']      = <a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>::<a class="function" onClick="logFunction('make_webservice_pluginfile_url')" href="../../_functions/make_webservice_pluginfile_url.html" onMouseOver="funcPopup(event,'make_webservice_pluginfile_url')">make_webservice_pluginfile_url</a>(
<a name="l577"><span class="linenum"> 577</span></a>                                          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'mod_book', 'chapter', <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>-&gt;<a onClick="logVariable('id')" class="var it43329" onMouseOver="hilite(43329)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l578"><span class="linenum"> 578</span></a>                                          <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_filepath')" href="../../_functions/get_filepath.html" onMouseOver="funcPopup(event,'get_filepath')">get_filepath</a>(), <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>())-&gt;<a class="function" onClick="logFunction('out')" href="../../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>(false);
<a name="l579"><span class="linenum"> 579</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['timecreated']  = <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_timecreated')" href="../../_functions/get_timecreated.html" onMouseOver="funcPopup(event,'get_timecreated')">get_timecreated</a>();
<a name="l580"><span class="linenum"> 580</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['timemodified'] = <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_timemodified')" href="../../_functions/get_timemodified.html" onMouseOver="funcPopup(event,'get_timemodified')">get_timemodified</a>();
<a name="l581"><span class="linenum"> 581</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['sortorder']    = <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>();
<a name="l582"><span class="linenum"> 582</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['userid']       = <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>();
<a name="l583"><span class="linenum"> 583</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['author']       = <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_author')" href="../../_functions/get_author.html" onMouseOver="funcPopup(event,'get_author')">get_author</a>();
<a name="l584"><span class="linenum"> 584</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>['license']      = <a class="var it806" onMouseOver="hilite(806)" onMouseOut="lolite()" onClick="logVariable('fileinfo')" href="../../_variables/fileinfo.html">$fileinfo</a>-&gt;<a class="function" onClick="logFunction('get_license')" href="../../_functions/get_license.html" onMouseOver="funcPopup(event,'get_license')">get_license</a>();
<a name="l585"><span class="linenum"> 585</span></a>              <a class="var it271" onMouseOver="hilite(271)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a>[] = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>;
<a name="l586"><span class="linenum"> 586</span></a>          }
<a name="l587"><span class="linenum"> 587</span></a>      }
<a name="l588"><span class="linenum"> 588</span></a>  
<a name="l589"><span class="linenum"> 589</span></a>  <span class="comment">    // First content is the structure in encoded JSON format.</span>
<a name="l590"><span class="linenum"> 590</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a> = array();
<a name="l591"><span class="linenum"> 591</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['type']         = 'content';
<a name="l592"><span class="linenum"> 592</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['filename']     = 'structure';
<a name="l593"><span class="linenum"> 593</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['filepath']     = &quot;/&quot;;
<a name="l594"><span class="linenum"> 594</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['filesize']     = 0;
<a name="l595"><span class="linenum"> 595</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['fileurl']      = null;
<a name="l596"><span class="linenum"> 596</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['timecreated']  = <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>;
<a name="l597"><span class="linenum"> 597</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['timemodified'] = <a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43002" onMouseOver="hilite(43002)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>;
<a name="l598"><span class="linenum"> 598</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['content']      = <a class="function" onClick="logFunction('json_encode')" href="../../_functions/json_encode.html" onMouseOver="funcPopup(event,'json_encode')">json_encode</a>(<a class="phpfunction" onClick="logFunction('array_values')" href="../../_functions/array_values.html" onMouseOver="phpfuncPopup(event,'array_values')">array_values</a>(<a class="var it273" onMouseOver="hilite(273)" onMouseOut="lolite()" onClick="logVariable('structure')" href="../../_variables/structure.html">$structure</a>));
<a name="l599"><span class="linenum"> 599</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['sortorder']    = 0;
<a name="l600"><span class="linenum"> 600</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['userid']       = null;
<a name="l601"><span class="linenum"> 601</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['author']       = null;
<a name="l602"><span class="linenum"> 602</span></a>      <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>['license']      = null;
<a name="l603"><span class="linenum"> 603</span></a>  
<a name="l604"><span class="linenum"> 604</span></a>  <span class="comment">    // Add it as first element.</span>
<a name="l605"><span class="linenum"> 605</span></a>      <a class="phpfunction" onClick="logFunction('array_unshift')" href="../../_functions/array_unshift.html" onMouseOver="phpfuncPopup(event,'array_unshift')">array_unshift</a>(<a class="var it271" onMouseOver="hilite(271)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a>, <a class="var it36274" onMouseOver="hilite(36274)" onMouseOut="lolite()" onClick="logVariable('structurefile')" href="../../_variables/structurefile.html">$structurefile</a>);
<a name="l606"><span class="linenum"> 606</span></a>  
<a name="l607"><span class="linenum"> 607</span></a>      return <a class="var it271" onMouseOver="hilite(271)" onMouseOut="lolite()" onClick="logVariable('contents')" href="../../_variables/contents.html">$contents</a>;
<a name="l608"><span class="linenum"> 608</span></a>  }
<a name="l609"><span class="linenum"> 609</span></a>  
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment">/**</span>
<a name="l611"><span class="linenum"> 611</span></a>  <span class="comment"> * Mark the activity completed (if required) and trigger the course_module_viewed event.</span>
<a name="l612"><span class="linenum"> 612</span></a>  <span class="comment"> *</span>
<a name="l613"><span class="linenum"> 613</span></a>  <span class="comment"> * @param  stdClass $book       book object</span>
<a name="l614"><span class="linenum"> 614</span></a>  <span class="comment"> * @param  stdClass $chapter    chapter object</span>
<a name="l615"><span class="linenum"> 615</span></a>  <span class="comment"> * @param  bool $islaschapter   is the las chapter of the book?</span>
<a name="l616"><span class="linenum"> 616</span></a>  <span class="comment"> * @param  stdClass $course     course object</span>
<a name="l617"><span class="linenum"> 617</span></a>  <span class="comment"> * @param  stdClass $cm         course module object</span>
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment"> * @param  stdClass $context    context object</span>
<a name="l619"><span class="linenum"> 619</span></a>  <span class="comment"> * @since Moodle 3.0</span>
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment"> */</span>
<a name="l621"><span class="linenum"> 621</span></a>  function <a class="function" onClick="logFunction('book_view')" href="../../_functions/book_view.html" onMouseOver="funcPopup(event,'book_view')">book_view</a>(<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>, <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>, <a class="var it25456" onMouseOver="hilite(25456)" onMouseOut="lolite()" onClick="logVariable('islastchapter')" href="../../_variables/islastchapter.html">$islastchapter</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l622"><span class="linenum"> 622</span></a>  
<a name="l623"><span class="linenum"> 623</span></a>  <span class="comment">    // First case, we are just opening the book.</span>
<a name="l624"><span class="linenum"> 624</span></a>      if (empty(<a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>)) {
<a name="l625"><span class="linenum"> 625</span></a>          \mod_book\event\<a class="class" onClick="logClass('course_module_viewed')" href="../../_classes/course_module_viewed.html" onMouseOver="classPopup(event,'course_module_viewed')">course_module_viewed</a>::<a class="function" onClick="logFunction('create_from_book')" href="../../_functions/create_from_book.html" onMouseOver="funcPopup(event,'create_from_book')">create_from_book</a>(<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l626"><span class="linenum"> 626</span></a>  
<a name="l627"><span class="linenum"> 627</span></a>      } else {
<a name="l628"><span class="linenum"> 628</span></a>          \mod_book\event\<a class="class" onClick="logClass('chapter_viewed')" href="../../_classes/chapter_viewed.html" onMouseOver="classPopup(event,'chapter_viewed')">chapter_viewed</a>::<a class="function" onClick="logFunction('create_from_chapter')" href="../../_functions/create_from_chapter.html" onMouseOver="funcPopup(event,'create_from_chapter')">create_from_chapter</a>(<a class="var it2181" onMouseOver="hilite(2181)" onMouseOut="lolite()" onClick="logVariable('book')" href="../../_variables/book.html">$book</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it2183" onMouseOver="hilite(2183)" onMouseOut="lolite()" onClick="logVariable('chapter')" href="../../_variables/chapter.html">$chapter</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l629"><span class="linenum"> 629</span></a>  
<a name="l630"><span class="linenum"> 630</span></a>          if (<a class="var it25456" onMouseOver="hilite(25456)" onMouseOut="lolite()" onClick="logVariable('islastchapter')" href="../../_variables/islastchapter.html">$islastchapter</a>) {
<a name="l631"><span class="linenum"> 631</span></a>  <span class="comment">            // We cheat a bit here in assuming that viewing the last page means the user viewed the whole book.</span>
<a name="l632"><span class="linenum"> 632</span></a>              <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a> = <span class="keyword">new </span><a class="class" onClick="logClass('completion_info')" href="../../_classes/completion_info.html" onMouseOver="classPopup(event,'completion_info')">completion_info</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l633"><span class="linenum"> 633</span></a>              <a class="var it555" onMouseOver="hilite(555)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('set_module_viewed')" href="../../_functions/set_module_viewed.html" onMouseOver="funcPopup(event,'set_module_viewed')">set_module_viewed</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l634"><span class="linenum"> 634</span></a>          }
<a name="l635"><span class="linenum"> 635</span></a>      }
<a name="l636"><span class="linenum"> 636</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'send_stored_file': ['send_stored_file', 'Handles the sending of file data to the user\'s browser, including support for byteranges etc. ', [['lib','filelib.php',2192]], 75],
'set_module_viewed': ['set_module_viewed', 'Update the module completion status (set it viewed). ', [['mod/assign','locallib.php',8075],['lib','completionlib.php',657]], 29],
'out': ['out', 'Returns the selector for use in a CSS rule ', [['lib','csslib.php',1540],['lib','csslib.php',1698],['lib','csslib.php',2078],['lib','csslib.php',2162],['lib','csslib.php',2306],['lib','csslib.php',2495],['lib','csslib.php',3240],['mod/feedback/classes','responses_table.php',332],['lib','moodlelib.php',9729],['lib','weblib.php',545],['lib','tablelib.php',1594],['report/loglive/classes','table_log_ajax.php',37]], 626],
'get_author': ['get_author', 'Get an author for the feed ', [['lib/simplepie/library','SimplePie.php',2098],['lib/simplepie/library/SimplePie','Source.php',210],['lib/filebrowser','file_info.php',312],['lib/filebrowser','virtual_root_file.php',326],['lib/filebrowser','file_info_stored.php',285],['lib/simplepie/library/SimplePie','Item.php',495],['lib/filestorage','stored_file.php',834]], 20],
'create_from_book': ['create_from_book', 'Create instance of event. ', [['mod/book/tool/print/classes/event','book_printed.php',37],['mod/book/tool/exportimscp/classes/event','book_exported.php',37],['mod/book/classes/event','course_module_viewed.php',37]], 7],
'book_get_nav_classes': ['book_get_nav_classes', 'Returns list of available navigation link CSS classes. ', [['mod/book','lib.php',58]], 1],
'book_get_post_actions': ['book_get_post_actions', 'Return write actions. ', [['mod/book','lib.php',234]], 0],
'get_area_files': ['get_area_files', 'Returns all area files (optionally limited by itemid) ', [['lib/filestorage','file_storage.php',782],['lib','externallib.php',1134]], 216],
'book_update_instance': ['book_update_instance', 'Update book instance. ', [['mod/book','lib.php',94]], 0],
'book_get_extra_capabilities': ['book_get_extra_capabilities', 'Returns all other caps used in module ', [['mod/book','lib.php',66]], 0],
'book_get_nav_types': ['book_get_nav_types', 'Returns list of available navigation link types. ', [['mod/book','lib.php',44]], 2],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'book_pluginfile': ['book_pluginfile', 'Serves the book attachments. Implements needed access control ;-) ', [['mod/book','lib.php',385]], 0],
'book_reset_userdata': ['book_reset_userdata', 'This function is used by the reset_course_userdata function in moodlelib. ', [['mod/book','lib.php',150]], 0],
'book_grades': ['book_grades', 'No grading in book. ', [['mod/book','lib.php',168]], 0],
'get_timecreated': ['get_timecreated', 'Returns time created unix timestamp if known ', [['lib/filebrowser','file_info.php',286],['lib/filebrowser','virtual_root_file.php',263],['lib/filebrowser','file_info_stored.php',249],['lib/filestorage','stored_file.php',747],['question/engine','questionattemptstep.php',176],['question/engine','questionattemptstep.php',686]], 54],
'get_plugin_list': ['get_plugin_list', 'Use when listing real plugins of one type. ', [['lib','deprecatedlib.php',150],['lib/classes','component.php',796],['admin/tool/monitor/classes','eventlist.php',176]], 191],
'book_get_numbering_types': ['book_get_numbering_types', 'Returns list of available numbering types ', [['mod/book','lib.php',27]], 2],
'book_view': ['book_view', 'Mark the activity completed (if required) and trigger the course_module_viewed event. ', [['mod/book','lib.php',610]], 6],
'get_file_by_hash': ['get_file_by_hash', 'Fetch file using local file full pathname hash ', [['lib/filestorage','file_storage.php',679]], 73],
'book_extend_settings_navigation': ['book_extend_settings_navigation', 'Adds module specific settings to the settings block ', [['mod/book','lib.php',286]], 0],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'json_encode': ['json_encode', 'encodes an arbitrary variable into JSON format ', [['lib/minify/lib','FirePHP.php',1124]], 307],
'make_webservice_pluginfile_url': ['make_webservice_pluginfile_url', 'Factory method for creation of url pointing to plugin file. This method is the same that make_pluginfile_url but pointing to the webservice pluginfile.php script. It should be used only in external functions. ', [['lib','weblib.php',794]], 12],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'get_timemodified': ['get_timemodified', 'Returns time modified unix timestamp if known ', [['lib/filebrowser','file_info.php',295],['lib/filebrowser','virtual_root_file.php',272],['lib/filebrowser','file_info_stored.php',258],['lib/filestorage','stored_file.php',756]], 63],
'file_rewrite_pluginfile_urls': ['file_rewrite_pluginfile_urls', 'Convert encoded URLs in $text from the @@PLUGINFILE@@/... form to an actual URL. Passing a new option reverse = true in the $options var will make the function to convert actual URLs in $text to encoded URLs in the @@PLUGINFILE@@ form. ', [['lib','filelib.php',446]], 96],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'format_text': ['format_text', 'Formats a text string coming from the search engine. ', [['search/classes','document.php',606],['lib/classes','grading_external.php',182],['search/engine/solr/classes','document.php',129],['lib','weblib.php',1158],['lib','tablelib.php',860],['lib','tablelib.php',1667],['question/type','questionbase.php',345]], 322],
'book_scale_used_anywhere': ['book_scale_used_anywhere', 'Checks if scale is being used by any instance of book ', [['mod/book','lib.php',192]], 0],
'book_export_contents': ['book_export_contents', 'Export book resource contents ', [['mod/book','lib.php',502]], 2],
'is_directory': ['is_directory', 'Whether or not this is a directory ', [['lib/filebrowser','file_info_context_system.php',133],['mod/lesson/classes','file_info.php',94],['mod/imscp','locallib.php',328],['lib/filebrowser','file_info_context_coursecat.php',146],['mod/book','locallib.php',463],['lib/filebrowser','file_info_context_user.php',265],['lib/filebrowser','virtual_root_file.php',60],['mod/data','locallib.php',477],['lib/filebrowser','file_info_stored.php',267],['lib/filestorage','stored_file.php',310],['mod/workshop','fileinfolib.php',82],['mod/workshop','fileinfolib.php',241],['lib/filebrowser','file_info_context_module.php',249],['mod/glossary','locallib.php',525],['lib/filebrowser','file_info_context_course.php',372],['lib/filebrowser','file_info_context_course.php',657],['lib/filebrowser','file_info_context_course.php',803],['mod/forum','locallib.php',463]], 140],
'sesskey': ['sesskey', 'Makes sure that $USER->sesskey exists, if $USER itself exists. It sets a new sesskey if one does not already exist, but does not overwrite existing sesskeys. Returns the sesskey string if $USER exists, or boolean false if not. ', [['lib','sessionlib.php',28]], 641],
'book_get_file_areas': ['book_get_file_areas', 'Lists all browsable file areas ', [['mod/book','lib.php',323]], 0],
'book_print_recent_activity': ['book_print_recent_activity', 'Given a course and a time, this module should find recent activity that has occurred in book activities and print it out. ', [['mod/book','lib.php',137]], 0],
'get_userid': ['get_userid', 'Returns user ID ', [['lib/filebrowser','virtual_root_file.php',236],['mod/quiz','attemptlib.php',804],['lib/filestorage','stored_file.php',708],['mod/data','lib.php',2585],['backup/util/plan','restore_task.class.php',54],['backup/util/plan','restore_plan.class.php',115],['backup/controller','backup_controller.class.php',283],['backup/controller','restore_controller.class.php',285]], 220],
'book_get_view_actions': ['book_get_view_actions', 'Return read actions. ', [['mod/book','lib.php',204]], 0],
'create_from_chapter': ['create_from_chapter', 'Create instance of event. ', [['mod/book/classes/event','chapter_created.php',37],['mod/book/classes/event','chapter_updated.php',37],['mod/book/tool/print/classes/event','chapter_printed.php',37],['mod/book/classes/event','chapter_deleted.php',37],['mod/book/classes/event','chapter_viewed.php',37]], 18],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1379]], 880],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'book_supports': ['book_supports', 'Supported features ', [['mod/book','lib.php',264]], 0],
'params': ['params', 'Add an array of params to the params for this url. ', [['lib','weblib.php',392],['question/classes/bank/search','condition.php',43],['question/classes/bank/search','category_condition.php',100]], 93],
'book_delete_instance': ['book_delete_instance', 'Delete book instance by activity id ', [['mod/book','lib.php',118]], 0],
'send_file': ['send_file', 'Repository method to serve the referenced file ', [['repository/boxnet','lib.php',482],['lib','filelib.php',2073],['repository/dropbox','lib.php',670],['repository','lib.php',1200],['repository/equella','lib.php',243],['lib/filestorage','stored_file.php',999],['lib','googleapi.php',142],['lib','googleapi.php',253],['repository/filesystem','lib.php',601],['lib/portfolio','plugin.php',811]], 26],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'get_filename': ['get_filename', 'Returns file name ', [['lib/filebrowser','virtual_root_file.php',227],['lib/filestorage','stored_file.php',699],['lib','medialib.php',169]], 248],
'book_cron': ['book_cron', 'No cron in book. ', [['mod/book','lib.php',159]], 0],
'book_page_type_list': ['book_page_type_list', 'Return a list of page types ', [['mod/book','lib.php',489]], 0],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'book_get_chapter_title': ['book_get_chapter_title', 'Returns the title for a given chapter ', [['mod/book','locallib.php',134]], 12],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',6144]], 546],
'get_license': ['get_license', 'Returns the license type of the file ', [['lib/filebrowser','file_info.php',304],['lib/filebrowser','virtual_root_file.php',317],['lib/filebrowser','file_info_stored.php',276],['lib/filestorage','stored_file.php',814]], 19],
'book_preload_chapters': ['book_preload_chapters', 'Preload book chapters and fix toc structure if necessary. ', [['mod/book','locallib.php',52]], 9],
'get_file': ['get_file', 'Downloads a repository file and saves to a path. ', [['repository/boxnet','lib.php',179],['repository/flickr_public','lib.php',453],['repository/dropbox','lib.php',410],['repository/skydrive','lib.php',130],['repository','lib.php',1647],['repository/s3','lib.php',227],['repository/equella','lib.php',166],['mod/data/field/picture','field.class.php',126],['mod/data/field/file','field.class.php',123],['repository/googledocs','lib.php',408],['lib/filestorage','file_storage.php',700],['repository/webdav','lib.php',73],['repository/filesystem','lib.php',398],['repository/flickr','lib.php',277],['lib','externallib.php',1076],['repository/dropbox','locallib.php',114],['lib','webdavlib.php',391]], 169],
'require_course_login': ['require_course_login', 'Weaker version of require_login() ', [['lib','moodlelib.php',2902]], 68],
'add': ['add', 'Add HashTable item ', [['lib/phpexcel/PHPExcel','HashTable.php',78],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',95],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',109],['lib/google/src/Google/Http','Batch.php',52],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',37],['lib','csslib.php',1508],['lib/horde/framework/Horde/Mail/Rfc822','List.php',116],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',33],['lib/horde/framework/Horde/Support','ConsistentHash.php',148],['lib/horde/framework/Horde','Variables.php',297],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',29],['lib','outputcomponents.php',2705],['lib','outputcomponents.php',3380],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',436],['lib','adminlib.php',735],['lib','adminlib.php',894],['lib','adminlib.php',1446],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',27],['lib/xhprof/xhprof_html/jquery','jquery-1.2.6.js',3450],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',80],['lib/google/src/Google/Service','Webmasters.php',436],['lib','navigationlib.php',304],['lib','navigationlib.php',761],['lib','navigationlib.php',3305],['lib','navigationlib.php',3583],['lib/horde/framework/Horde/Imap/Client','Ids.php',155],['backup/cc/cc_lib/gral_lib','cssparser.php',121],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',428],['lib/horde/framework/Horde','Stream.php',116],['comment','lib.php',679],['lib/mustache/src/Mustache','HelperCollection.php',56],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',207],['backup/cc/cc_lib','cc_utils.php',395],['backup/cc/cc_lib','cc_utils.php',454],['lib/lessphp/Output','Mapped.php',50],['lib','licenselib.php',32],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',50],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',74],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',14],['lib/horde/framework/Horde/Mail/Rfc822','GroupList.php',25],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',31],['tag/classes','tag.php',152],['blog','locallib.php',242],['lib/classes','notification.php',50],['lib/lessphp','Output.php',18],['tag/classes/output','tagfeed.php',61],['backup/cc','validator.php',51],['lib/horde/framework/Horde/Stream','TempString.php',118],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',11]], 6188],
'book_scale_used': ['book_scale_used', 'This function returns if a scale is being used by one book it it has support for grading and scales. Commented code should be modified if necessary. See book, glossary or journal modules as reference. ', [['mod/book','lib.php',178]], 0],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'book_add_instance': ['book_add_instance', 'Add book instance. ', [['mod/book','lib.php',75]], 0],
'book_get_file_info': ['book_get_file_info', 'File browsing support for book module chapter area. ', [['mod/book','lib.php',336]], 0],
'get_filesize': ['get_filesize', 'Returns file size in bytes, null for directories ', [['lib/filebrowser','file_info.php',268],['lib/filebrowser','virtual_root_file.php',245],['lib/filebrowser','file_info_stored.php',221],['lib/filestorage','stored_file.php',717]], 83],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'get_sortorder': ['get_sortorder', 'Returns the sortorder of this grade_item. This method is also available in grade_category, for cases where the object type is not know. ', [['lib/grade','grade_item.php',1286],['lib/grade','grade_category.php',2392],['lib/filebrowser','file_info.php',330],['lib/filebrowser','virtual_root_file.php',344],['lib/filebrowser','file_info_stored.php',303],['repository','lib.php',197],['lib/filestorage','stored_file.php',875]], 127],
'get_filepath': ['get_filepath', 'Returns file path ', [['lib/filebrowser','virtual_root_file.php',218],['lib/filestorage','stored_file.php',690],['backup/util/ui','restore_ui_stage.class.php',547]], 147],
'str_replace': ['str_replace', '', [], 1648],
'sha1': ['sha1', '', [], 186],
'array_unshift': ['array_unshift', '', [], 115],
'array_merge': ['array_merge', '', [], 2944],
'defined': ['defined', '', [], 4731],
'function_exists': ['function_exists', '', [], 419],
'array_shift': ['array_shift', '', [], 700],
'array_values': ['array_values', '', [], 342],
'time': ['time', '', [], 1959],
'file_exists': ['file_exists', '', [], 867],
'implode': ['implode', '', [], 1281],
'is_null': ['is_null', '', [], 2003]};
CLASS_DATA={
'book_file_info': ['book_file_info', 'File browsing support class ', [['mod/book','locallib.php',398]], 1],
'core_component': ['core_component', 'Collection of components related methods. ', [['lib/classes','component.php',41]], 511],
'completion_info': ['completion_info', 'Class represents completion information for a course. ', [['lib','completionlib.php',210]], 141],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',238]], 3088],
'navigation_node': ['navigation_node', 'This class is used to represent a node in a navigation tree ', [['lib','navigationlib.php',34]], 348],
'chapter_viewed': ['chapter_viewed', 'The mod_book chapter viewed event class. ', [['mod/book/classes/event','chapter_viewed.php',28]], 5],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',7039]], 1106],
'file_info_stored': ['file_info_stored', 'Represents an actual file or folder - a row in the file table in the tree navigated by {@link file_browser}. ', [['lib/filebrowser','file_info_stored.php',28]], 33],
'course_module_viewed': ['course_module_viewed', 'The mod_page course module viewed event class. ', [['mod/page/classes/event','course_module_viewed.php',28],['mod/chat/classes/event','course_module_viewed.php',29],['mod/quiz/classes/event','course_module_viewed.php',29],['mod/data/classes/event','course_module_viewed.php',30],['mod/choice/classes/event','course_module_viewed.php',28],['mod/forum/classes/event','course_module_viewed.php',29],['mod/resource/classes/event','course_module_viewed.php',29],['mod/book/classes/event','course_module_viewed.php',28],['mod/imscp/classes/event','course_module_viewed.php',30],['mod/lti/classes/event','course_module_viewed.php',29],['mod/feedback/classes/event','course_module_viewed.php',28],['mod/survey/classes/event','course_module_viewed.php',29],['mod/folder/classes/event','course_module_viewed.php',29],['mod/glossary/classes/event','course_module_viewed.php',28],['mod/scorm/classes/event','course_module_viewed.php',28],['mod/url/classes/event','course_module_viewed.php',29],['mod/wiki/classes/event','course_module_viewed.php',28],['lib/tests/fixtures','event_fixtures.php',232],['mod/lesson/classes/event','course_module_viewed.php',30],['mod/workshop/classes/event','course_module_viewed.php',32]], 37]};
CONST_DATA={
'FEATURE_GROUPS': ['FEATURE_GROUPS', '', [['lib','moodlelib.php',414]], 25],
'MOD_ARCHETYPE_RESOURCE': ['MOD_ARCHETYPE_RESOURCE', '', [['lib','moodlelib.php',445]], 13],
'BOOK_LINK_TOCONLY': ['BOOK_LINK_TOCONLY', '', [['mod/book','locallib.php',48]], 2],
'BOOK_LINK_TEXT': ['BOOK_LINK_TEXT', '', [['mod/book','locallib.php',50]], 2],
'BOOK_NUM_INDENTED': ['BOOK_NUM_INDENTED', '', [['mod/book','locallib.php',40]], 4],
'FEATURE_GROUPINGS': ['FEATURE_GROUPINGS', '', [['lib','moodlelib.php',416]], 23],
'BOOK_LINK_IMAGE': ['BOOK_LINK_IMAGE', '', [['mod/book','locallib.php',49]], 3],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'FEATURE_GRADE_OUTCOMES': ['FEATURE_GRADE_OUTCOMES', '', [['lib','moodlelib.php',396]], 23],
'FEATURE_COMPLETION_TRACKS_VIEWS': ['FEATURE_COMPLETION_TRACKS_VIEWS', '', [['lib','moodlelib.php',405]], 23],
'FEATURE_GRADE_HAS_GRADE': ['FEATURE_GRADE_HAS_GRADE', '', [['lib','moodlelib.php',394]], 29],
'FEATURE_BACKUP_MOODLE2': ['FEATURE_BACKUP_MOODLE2', '', [['lib','moodlelib.php',434]], 35],
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 466],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'BOOK_NUM_NUMBERS': ['BOOK_NUM_NUMBERS', '', [['mod/book','locallib.php',38]], 15],
'BOOK_NUM_NONE': ['BOOK_NUM_NONE', '', [['mod/book','locallib.php',37]], 4],
'FEATURE_SHOW_DESCRIPTION': ['FEATURE_SHOW_DESCRIPTION', '', [['lib','moodlelib.php',437]], 22],
'FEATURE_MOD_ARCHETYPE': ['FEATURE_MOD_ARCHETYPE', '', [['lib','moodlelib.php',424]], 13],
'BOOK_NUM_BULLETS': ['BOOK_NUM_BULLETS', '', [['mod/book','locallib.php',39]], 4],
'FEATURE_MOD_INTRO': ['FEATURE_MOD_INTRO', '', [['lib','moodlelib.php',426]], 31]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
