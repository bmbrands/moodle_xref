<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /filter/tex/filter.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='filter/tex';
filename='filter.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/filter/tex/</a> -> <a href="filter.php.html">filter.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="filter.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="filter.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Moodle - Filter for converting TeX expressions to cached gif images</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * This Moodle text filter converts TeX expressions delimited</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * by either $$...$$ or by &lt;tex...&gt;...&lt;/tex&gt; tags to gif images using</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * mimetex.cgi obtained from http: *www.forkosh.com/mimetex.html authored by</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * John Forkosh john@forkosh.com.  Several binaries of this areincluded with</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * this distribution.</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * Note that there may be patent restrictions on the production of gif images</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * in Canada and some parts of Western Europe and Japan until July 2004.</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> *</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * @package    filter</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * @subpackage tex</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @copyright  2004 Zbigniew Fiedorowicz fiedorow@math.ohio-state.edu</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> *             Originally based on code provided by Bruno Vernier bruno@vsbeducation.ca</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> */</span>
<a name="l34"><span class="linenum">  34</span></a>  
<a name="l35"><span class="linenum">  35</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die;
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a> . '/classes/useragent.php');
<a name="l38"><span class="linenum">  38</span></a>  
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">/**</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> * Create TeX image link.</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment"> *</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment"> * @param string $imagefile name of file</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> * @param string $tex TeX notation (html entities already decoded)</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> * @param int $height O means automatic</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment"> * @param int $width O means automatic</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment"> * @param string $align</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment"> * @param string $alt</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment"> * @return string HTML markup</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment"> */</span>
<a name="l50"><span class="linenum">  50</span></a>  function <a class="function" onClick="logFunction('filter_text_image')" href="../../_functions/filter_text_image.html" onMouseOver="funcPopup(event,'filter_text_image')">filter_text_image</a>(<a class="var it3323" onMouseOver="hilite(3323)" onMouseOut="lolite()" onClick="logVariable('imagefile')" href="../../_variables/imagefile.html">$imagefile</a>, <a class="var it12944" onMouseOver="hilite(12944)" onMouseOut="lolite()" onClick="logVariable('tex')" href="../../_variables/tex.html">$tex</a>, <a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>, <a class="var it1850" onMouseOver="hilite(1850)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../_variables/align.html">$align</a>, <a class="var it2582" onMouseOver="hilite(2582)" onMouseOut="lolite()" onClick="logVariable('alt')" href="../../_variables/alt.html">$alt</a>) {
<a name="l51"><span class="linenum">  51</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>      if (!<a class="var it3323" onMouseOver="hilite(3323)" onMouseOut="lolite()" onClick="logVariable('imagefile')" href="../../_variables/imagefile.html">$imagefile</a>) {
<a name="l54"><span class="linenum">  54</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('image file argument empty in <a class="function" onClick="logFunction('filter_text_image')" href="../../_functions/filter_text_image.html" onMouseOver="funcPopup(event,'filter_text_image')">filter_text_image</a>()');
<a name="l55"><span class="linenum">  55</span></a>      }
<a name="l56"><span class="linenum">  56</span></a>  
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">    // Work out any necessary inline style.</span>
<a name="l58"><span class="linenum">  58</span></a>      <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../../_variables/rules.html">$rules</a> = array();
<a name="l59"><span class="linenum">  59</span></a>      if (<a class="var it1850" onMouseOver="hilite(1850)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../_variables/align.html">$align</a> !== 'middle') {
<a name="l60"><span class="linenum">  60</span></a>          <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../../_variables/rules.html">$rules</a>[] = 'vertical-align:' . <a class="var it1850" onMouseOver="hilite(1850)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../_variables/align.html">$align</a> . ';';
<a name="l61"><span class="linenum">  61</span></a>      }
<a name="l62"><span class="linenum">  62</span></a>      if (<a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>) {
<a name="l63"><span class="linenum">  63</span></a>          <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../../_variables/rules.html">$rules</a>[] = 'height:' . <a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a> . 'px;';
<a name="l64"><span class="linenum">  64</span></a>      }
<a name="l65"><span class="linenum">  65</span></a>      if (<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>) {
<a name="l66"><span class="linenum">  66</span></a>          <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../../_variables/rules.html">$rules</a>[] = 'width:' . <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a> . 'px;';
<a name="l67"><span class="linenum">  67</span></a>      }
<a name="l68"><span class="linenum">  68</span></a>      if (!empty(<a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../../_variables/rules.html">$rules</a>)) {
<a name="l69"><span class="linenum">  69</span></a>          <a class="var it1577" onMouseOver="hilite(1577)" onMouseOut="lolite()" onClick="logVariable('style')" href="../../_variables/style.html">$style</a> = ' style=&quot;' . <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('', <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../../_variables/rules.html">$rules</a>) . '&quot; ';
<a name="l70"><span class="linenum">  70</span></a>      } else {
<a name="l71"><span class="linenum">  71</span></a>          <a class="var it1577" onMouseOver="hilite(1577)" onMouseOut="lolite()" onClick="logVariable('style')" href="../../_variables/style.html">$style</a> = '';
<a name="l72"><span class="linenum">  72</span></a>      }
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">    // Prepare the title attribute.</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">    // Note that we retain the title tag as TeX format rather than using</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">    // the alt text, even if supplied. The alt text is intended for blind</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">    // users (to provide a text equivalent to the equation) while the title</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">    // is there as a convenience for sighted users who want to see the TeX</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">    // code.</span>
<a name="l80"><span class="linenum">  80</span></a>      <a class="var it229" onMouseOver="hilite(229)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../_variables/title.html">$title</a> = 'title=&quot;'.<a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="var it12944" onMouseOver="hilite(12944)" onMouseOut="lolite()" onClick="logVariable('tex')" href="../../_variables/tex.html">$tex</a>).'&quot;';
<a name="l81"><span class="linenum">  81</span></a>  
<a name="l82"><span class="linenum">  82</span></a>      if (<a class="var it2582" onMouseOver="hilite(2582)" onMouseOut="lolite()" onClick="logVariable('alt')" href="../../_variables/alt.html">$alt</a> === '') {
<a name="l83"><span class="linenum">  83</span></a>          <a class="var it2582" onMouseOver="hilite(2582)" onMouseOut="lolite()" onClick="logVariable('alt')" href="../../_variables/alt.html">$alt</a> = <a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="var it12944" onMouseOver="hilite(12944)" onMouseOut="lolite()" onClick="logVariable('tex')" href="../../_variables/tex.html">$tex</a>);
<a name="l84"><span class="linenum">  84</span></a>      } else {
<a name="l85"><span class="linenum">  85</span></a>          <a class="var it2582" onMouseOver="hilite(2582)" onMouseOut="lolite()" onClick="logVariable('alt')" href="../../_variables/alt.html">$alt</a> = <a class="function" onClick="logFunction('s')" href="../../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="phpfunction" onClick="logFunction('html_entity_decode')" href="../../_functions/html_entity_decode.html" onMouseOver="phpfuncPopup(event,'html_entity_decode')">html_entity_decode</a>(<a class="var it12944" onMouseOver="hilite(12944)" onMouseOut="lolite()" onClick="logVariable('tex')" href="../../_variables/tex.html">$tex</a>, ENT_QUOTES, 'UTF-8'));
<a name="l86"><span class="linenum">  86</span></a>      }
<a name="l87"><span class="linenum">  87</span></a>  
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">    // Build the output.</span>
<a name="l89"><span class="linenum">  89</span></a>      <a class="var it12945" onMouseOver="hilite(12945)" onMouseOut="lolite()" onClick="logVariable('anchorcontents')" href="../../_variables/anchorcontents.html">$anchorcontents</a> = &quot;&lt;img class=\&quot;texrender\&quot; <a class="var it229" onMouseOver="hilite(229)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../_variables/title.html">$title</a> alt=\&quot;<a class="var it2582" onMouseOver="hilite(2582)" onMouseOut="lolite()" onClick="logVariable('alt')" href="../../_variables/alt.html">$alt</a>\&quot; src=\&quot;&quot;;
<a name="l90"><span class="linenum">  90</span></a>      if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('slasharguments')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/slasharguments.html">slasharguments</a>) {        // Use this method if possible for better caching
<a name="l91"><span class="linenum">  91</span></a>          <a class="var it12945" onMouseOver="hilite(12945)" onMouseOut="lolite()" onClick="logVariable('anchorcontents')" href="../../_variables/anchorcontents.html">$anchorcontents</a> .= &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/filter/tex/pix.php/<a class="var it3323" onMouseOver="hilite(3323)" onMouseOut="lolite()" onClick="logVariable('imagefile')" href="../../_variables/imagefile.html">$imagefile</a>&quot;;
<a name="l92"><span class="linenum">  92</span></a>      } else {
<a name="l93"><span class="linenum">  93</span></a>          <a class="var it12945" onMouseOver="hilite(12945)" onMouseOut="lolite()" onClick="logVariable('anchorcontents')" href="../../_variables/anchorcontents.html">$anchorcontents</a> .= &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/filter/tex/pix.php?file=<a class="var it3323" onMouseOver="hilite(3323)" onMouseOut="lolite()" onClick="logVariable('imagefile')" href="../../_variables/imagefile.html">$imagefile</a>&quot;;
<a name="l94"><span class="linenum">  94</span></a>      }
<a name="l95"><span class="linenum">  95</span></a>      <a class="var it12945" onMouseOver="hilite(12945)" onMouseOut="lolite()" onClick="logVariable('anchorcontents')" href="../../_variables/anchorcontents.html">$anchorcontents</a> .= &quot;\&quot; <a class="var it1577" onMouseOver="hilite(1577)" onMouseOut="lolite()" onClick="logVariable('style')" href="../../_variables/style.html">$style</a>/&gt;&quot;;
<a name="l96"><span class="linenum">  96</span></a>  
<a name="l97"><span class="linenum">  97</span></a>      if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dataroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dataroot.html">dataroot</a>/filter/tex/<a class="var it3323" onMouseOver="hilite(3323)" onMouseOut="lolite()" onClick="logVariable('imagefile')" href="../../_variables/imagefile.html">$imagefile</a>&quot;) &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:config', <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>())) {
<a name="l98"><span class="linenum">  98</span></a>          <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = '<a class="filename" href="../../filter/tex/texdebug.php.html">/filter/tex/texdebug.php</a>';
<a name="l99"><span class="linenum">  99</span></a>          <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = null;
<a name="l100"><span class="linenum"> 100</span></a>      } else {
<a name="l101"><span class="linenum"> 101</span></a>          <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../filter/tex/displaytex.php.html">/filter/tex/displaytex.php</a>', array('texexp'=&gt;<a class="var it12944" onMouseOver="hilite(12944)" onMouseOut="lolite()" onClick="logVariable('tex')" href="../../_variables/tex.html">$tex</a>));
<a name="l102"><span class="linenum"> 102</span></a>          <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <span class="keyword">new </span><a class="class" onClick="logClass('popup_action')" href="../../_classes/popup_action.html" onMouseOver="classPopup(event,'popup_action')">popup_action</a>('click', <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>, 'popup', array('width'=&gt;320,'height'=&gt;240));
<a name="l103"><span class="linenum"> 103</span></a>      }
<a name="l104"><span class="linenum"> 104</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('action_link')" href="../../_functions/action_link.html" onMouseOver="funcPopup(event,'action_link')">action_link</a>(<a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>, <a class="var it12945" onMouseOver="hilite(12945)" onMouseOut="lolite()" onClick="logVariable('anchorcontents')" href="../../_variables/anchorcontents.html">$anchorcontents</a>, <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>, array('title'=&gt;'TeX')); <span class="comment">//TODO: the popups do not work when text caching is enabled!!</span>
<a name="l105"><span class="linenum"> 105</span></a>      <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = &quot;&lt;span class=\&quot;MathJax_Preview\&quot;&gt;<a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>&lt;/span&gt;&lt;script type=\&quot;math/tex\&quot;&gt;<a class="var it12944" onMouseOver="hilite(12944)" onMouseOut="lolite()" onClick="logVariable('tex')" href="../../_variables/tex.html">$tex</a>&lt;/script&gt;&quot;;
<a name="l106"><span class="linenum"> 106</span></a>  
<a name="l107"><span class="linenum"> 107</span></a>      return <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>;
<a name="l108"><span class="linenum"> 108</span></a>  }
<a name="l109"><span class="linenum"> 109</span></a>  
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment">/**</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment"> * TeX filtering class.</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment"> */</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('filter_tex')" href="../../_classes/filter_tex.html" onMouseOver="classPopup(event,'filter_tex')">filter_tex</a> extends moodle_text_filter {
<a name="l115"><span class="linenum"> 115</span></a>      function <a class="function" onClick="logFunction('filter')" href="../../_functions/filter.html" onMouseOver="funcPopup(event,'filter')">filter</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, array <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = array()) {
<a name="l116"><span class="linenum"> 116</span></a>  
<a name="l117"><span class="linenum"> 117</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l118"><span class="linenum"> 118</span></a>  
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment">        /// Do a quick check using stripos to avoid unnecessary work</span>
<a name="l120"><span class="linenum"> 120</span></a>          if ((!<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/&lt;tex/i', <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>)) &amp;&amp;
<a name="l121"><span class="linenum"> 121</span></a>                  (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>,'$$') === false) &amp;&amp;
<a name="l122"><span class="linenum"> 122</span></a>                  (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>,'\\[') === false) &amp;&amp;
<a name="l123"><span class="linenum"> 123</span></a>                  (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, '\\(') === false) &amp;&amp;
<a name="l124"><span class="linenum"> 124</span></a>                  (!<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/\[tex/i',<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>))) {
<a name="l125"><span class="linenum"> 125</span></a>              return <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>;
<a name="l126"><span class="linenum"> 126</span></a>          }
<a name="l127"><span class="linenum"> 127</span></a>  
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">#    //restrict filtering to forum 130 (Maths Tools on moodle.org)</span>
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">#    $scriptname = $_SERVER['SCRIPT_NAME'];</span>
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">#    if (!strstr($scriptname,'/forum/')) {</span>
<a name="l131"><span class="linenum"> 131</span></a>  <span class="comment">#        return $text;</span>
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">#    }</span>
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">#    if (strstr($scriptname,'post.php')) {</span>
<a name="l134"><span class="linenum"> 134</span></a>  <span class="comment">#        $parent = forum_get_post_full($_GET['reply']);</span>
<a name="l135"><span class="linenum"> 135</span></a>  <span class="comment">#        $discussion = $DB-&gt;get_record(&quot;forum_discussions&quot;, array(&quot;id&quot;=&gt;$parent-&gt;discussion));</span>
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">#    } else if (strstr($scriptname,'discuss.php')) {</span>
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment">#        $discussion = $DB-&gt;get_record(&quot;forum_discussions&quot;, array(&quot;id&quot;=&gt;$_GET['d']));</span>
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment">#    } else {</span>
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment">#        return $text;</span>
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">#    }</span>
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment">#    if ($discussion-&gt;forum != 130) {</span>
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment">#        return $text;</span>
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">#    }</span>
<a name="l144"><span class="linenum"> 144</span></a>          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> .= ' ';
<a name="l145"><span class="linenum"> 145</span></a>          <a class="phpfunction" onClick="logFunction('preg_match_all')" href="../../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>('/\$(\$\$+?)([^\$])/s',<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>,<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l146"><span class="linenum"> 146</span></a>          for (<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>=0; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>&lt;<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[0]); <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++) {
<a name="l147"><span class="linenum"> 147</span></a>              <a class="var it21" onMouseOver="hilite(21)" onMouseOut="lolite()" onClick="logVariable('replacement')" href="../../_variables/replacement.html">$replacement</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('$','&amp;#x00024;', <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1][<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>]).<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2][<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>];
<a name="l148"><span class="linenum"> 148</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[0][<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>], <a class="var it21" onMouseOver="hilite(21)" onMouseOut="lolite()" onClick="logVariable('replacement')" href="../../_variables/replacement.html">$replacement</a>, <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>);
<a name="l149"><span class="linenum"> 149</span></a>          }
<a name="l150"><span class="linenum"> 150</span></a>  
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment">        // &lt;tex&gt; TeX expression &lt;/tex&gt;</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment">        // or &lt;tex alt=&quot;My alternative text to be used instead of the TeX form&quot;&gt; TeX expression &lt;/tex&gt;</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment">        // or $$ TeX expression $$</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">        // or \[ TeX expression \]          // original tag of MathType and TeXaide (dlnsk)</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">        // or [tex] TeX expression [/tex]   // somtime it's more comfortable than &lt;tex&gt; (dlnsk)</span>
<a name="l156"><span class="linenum"> 156</span></a>          <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../../_variables/rules.html">$rules</a> = array(
<a name="l157"><span class="linenum"> 157</span></a>              '&lt;tex(?:\s+alt=[&quot;\'](.*?)[&quot;\'])?&gt;(.+?)&lt;\/tex&gt;',
<a name="l158"><span class="linenum"> 158</span></a>              '\$\$(.+?)\$\$',
<a name="l159"><span class="linenum"> 159</span></a>              '\\\\\[(.+?)\\\\\]',
<a name="l160"><span class="linenum"> 160</span></a>              '\\\\\((.+?)\\\\\)',
<a name="l161"><span class="linenum"> 161</span></a>              '\\[tex\\](.+?)\\[\/tex\\]'
<a name="l162"><span class="linenum"> 162</span></a>          );
<a name="l163"><span class="linenum"> 163</span></a>          <a class="var it28616" onMouseOver="hilite(28616)" onMouseOut="lolite()" onClick="logVariable('megarule')" href="../../_variables/megarule.html">$megarule</a> = '/' . <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(<a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../../_variables/rules.html">$rules</a>, '|') . '/is';
<a name="l164"><span class="linenum"> 164</span></a>          <a class="phpfunction" onClick="logFunction('preg_match_all')" href="../../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>(<a class="var it28616" onMouseOver="hilite(28616)" onMouseOut="lolite()" onClick="logVariable('megarule')" href="../../_variables/megarule.html">$megarule</a>, <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l165"><span class="linenum"> 165</span></a>          for (<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>=0; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>&lt;<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[0]); <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++) {
<a name="l166"><span class="linenum"> 166</span></a>              <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> = '';
<a name="l167"><span class="linenum"> 167</span></a>              for (<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('j')" href="../../_variables/j.html">$j</a> = 0; <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('j')" href="../../_variables/j.html">$j</a> &lt; <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../../_variables/rules.html">$rules</a>); <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('j')" href="../../_variables/j.html">$j</a>++) {
<a name="l168"><span class="linenum"> 168</span></a>                  <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> .= <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('j')" href="../../_variables/j.html">$j</a> + 2][<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>];
<a name="l169"><span class="linenum"> 169</span></a>              }
<a name="l170"><span class="linenum"> 170</span></a>              <a class="var it2582" onMouseOver="hilite(2582)" onMouseOut="lolite()" onClick="logVariable('alt')" href="../../_variables/alt.html">$alt</a> = <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1][<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>];
<a name="l171"><span class="linenum"> 171</span></a>              <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('&lt;nolink&gt;','',<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>);
<a name="l172"><span class="linenum"> 172</span></a>              <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('&lt;/nolink&gt;','',<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>);
<a name="l173"><span class="linenum"> 173</span></a>              <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('&lt;span class=&quot;nolink&quot;&gt;','',<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>);
<a name="l174"><span class="linenum"> 174</span></a>              <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('&lt;/span&gt;','',<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>);
<a name="l175"><span class="linenum"> 175</span></a>              <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>(&quot;/&lt;br[[:space:]]*\/?&gt;/i&quot;, '', <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>);  <span class="comment">//dlnsk</span>
<a name="l176"><span class="linenum"> 176</span></a>              <a class="var it1850" onMouseOver="hilite(1850)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../_variables/align.html">$align</a> = &quot;middle&quot;;
<a name="l177"><span class="linenum"> 177</span></a>              if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/^align=bottom /',<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>)) {
<a name="l178"><span class="linenum"> 178</span></a>                <a class="var it1850" onMouseOver="hilite(1850)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../_variables/align.html">$align</a> = &quot;text-bottom&quot;;
<a name="l179"><span class="linenum"> 179</span></a>                <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/^align=bottom /','',<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>);
<a name="l180"><span class="linenum"> 180</span></a>              } else if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/^align=top /',<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>)) {
<a name="l181"><span class="linenum"> 181</span></a>                <a class="var it1850" onMouseOver="hilite(1850)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../_variables/align.html">$align</a> = &quot;text-top&quot;;
<a name="l182"><span class="linenum"> 182</span></a>                <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/^align=top /','',<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>);
<a name="l183"><span class="linenum"> 183</span></a>              }
<a name="l184"><span class="linenum"> 184</span></a>  
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment">            // decode entities encoded by editor, luckily there is very little chance of double decoding</span>
<a name="l186"><span class="linenum"> 186</span></a>              <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> = <a class="phpfunction" onClick="logFunction('html_entity_decode')" href="../../_functions/html_entity_decode.html" onMouseOver="phpfuncPopup(event,'html_entity_decode')">html_entity_decode</a>(<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>, ENT_QUOTES, 'UTF-8');
<a name="l187"><span class="linenum"> 187</span></a>  
<a name="l188"><span class="linenum"> 188</span></a>              if (<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a> === '') {
<a name="l189"><span class="linenum"> 189</span></a>                  continue;
<a name="l190"><span class="linenum"> 190</span></a>              }
<a name="l191"><span class="linenum"> 191</span></a>  
<a name="l192"><span class="linenum"> 192</span></a>              <a class="var it3167" onMouseOver="hilite(3167)" onMouseOut="lolite()" onClick="logVariable('md5')" href="../../_variables/md5.html">$md5</a> = md5(<a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>);
<a name="l193"><span class="linenum"> 193</span></a>              if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>(&quot;cache_filters&quot;, array(&quot;filter&quot;=&gt;&quot;tex&quot;, &quot;md5key&quot;=&gt;<a class="var it3167" onMouseOver="hilite(3167)" onMouseOut="lolite()" onClick="logVariable('md5')" href="../../_variables/md5.html">$md5</a>))) {
<a name="l194"><span class="linenum"> 194</span></a>                  <a class="var it12948" onMouseOver="hilite(12948)" onMouseOut="lolite()" onClick="logVariable('texcache')" href="../../_variables/texcache.html">$texcache</a> = new stdClass();
<a name="l195"><span class="linenum"> 195</span></a>                  <a class="var it12948" onMouseOver="hilite(12948)" onMouseOut="lolite()" onClick="logVariable('texcache')" href="../../_variables/texcache.html">$texcache</a>-&gt;<a onClick="logVariable('filter')" class="var it44573" onMouseOver="hilite(44573)" onMouseOut="lolite()" href="../../_variables/filter.html">filter</a> = 'tex';
<a name="l196"><span class="linenum"> 196</span></a>                  <a class="var it12948" onMouseOver="hilite(12948)" onMouseOut="lolite()" onClick="logVariable('texcache')" href="../../_variables/texcache.html">$texcache</a>-&gt;<a onClick="logVariable('version')" class="var it44573" onMouseOver="hilite(44573)" onMouseOut="lolite()" href="../../_variables/version.html">version</a> = 1;
<a name="l197"><span class="linenum"> 197</span></a>                  <a class="var it12948" onMouseOver="hilite(12948)" onMouseOut="lolite()" onClick="logVariable('texcache')" href="../../_variables/texcache.html">$texcache</a>-&gt;<a onClick="logVariable('md5key')" class="var it44573" onMouseOver="hilite(44573)" onMouseOut="lolite()" href="../../_variables/md5key.html">md5key</a> = <a class="var it3167" onMouseOver="hilite(3167)" onMouseOut="lolite()" onClick="logVariable('md5')" href="../../_variables/md5.html">$md5</a>;
<a name="l198"><span class="linenum"> 198</span></a>                  <a class="var it12948" onMouseOver="hilite(12948)" onMouseOut="lolite()" onClick="logVariable('texcache')" href="../../_variables/texcache.html">$texcache</a>-&gt;<a onClick="logVariable('rawtext')" class="var it44573" onMouseOver="hilite(44573)" onMouseOut="lolite()" href="../../_variables/rawtext.html">rawtext</a> = <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>;
<a name="l199"><span class="linenum"> 199</span></a>                  <a class="var it12948" onMouseOver="hilite(12948)" onMouseOut="lolite()" onClick="logVariable('texcache')" href="../../_variables/texcache.html">$texcache</a>-&gt;<a onClick="logVariable('timemodified')" class="var it44573" onMouseOver="hilite(44573)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l200"><span class="linenum"> 200</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(&quot;cache_filters&quot;, <a class="var it12948" onMouseOver="hilite(12948)" onMouseOut="lolite()" onClick="logVariable('texcache')" href="../../_variables/texcache.html">$texcache</a>, false);
<a name="l201"><span class="linenum"> 201</span></a>              }
<a name="l202"><span class="linenum"> 202</span></a>              <a class="var it26701" onMouseOver="hilite(26701)" onMouseOut="lolite()" onClick="logVariable('convertformat')" href="../../_variables/convertformat.html">$convertformat</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('filter_tex', 'convertformat');
<a name="l203"><span class="linenum"> 203</span></a>              if (<a class="var it26701" onMouseOver="hilite(26701)" onMouseOut="lolite()" onClick="logVariable('convertformat')" href="../../_variables/convertformat.html">$convertformat</a> == 'svg' &amp;&amp; !<a class="class" onClick="logClass('core_useragent')" href="../../_classes/core_useragent.html" onMouseOver="classPopup(event,'core_useragent')">core_useragent</a>::<a class="function" onClick="logFunction('supports_svg')" href="../../_functions/supports_svg.html" onMouseOver="funcPopup(event,'supports_svg')">supports_svg</a>()) {
<a name="l204"><span class="linenum"> 204</span></a>                  <a class="var it26701" onMouseOver="hilite(26701)" onMouseOut="lolite()" onClick="logVariable('convertformat')" href="../../_variables/convertformat.html">$convertformat</a> = 'png';
<a name="l205"><span class="linenum"> 205</span></a>              }
<a name="l206"><span class="linenum"> 206</span></a>              <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="var it3167" onMouseOver="hilite(3167)" onMouseOut="lolite()" onClick="logVariable('md5')" href="../../_variables/md5.html">$md5</a>.&quot;.{<a class="var it26701" onMouseOver="hilite(26701)" onMouseOut="lolite()" onClick="logVariable('convertformat')" href="../../_variables/convertformat.html">$convertformat</a>}&quot;;
<a name="l207"><span class="linenum"> 207</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[0][<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>], <a class="function" onClick="logFunction('filter_text_image')" href="../../_functions/filter_text_image.html" onMouseOver="funcPopup(event,'filter_text_image')">filter_text_image</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>, <a class="var it12121" onMouseOver="hilite(12121)" onMouseOut="lolite()" onClick="logVariable('texexp')" href="../../_variables/texexp.html">$texexp</a>, 0, 0, <a class="var it1850" onMouseOver="hilite(1850)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../_variables/align.html">$align</a>, <a class="var it2582" onMouseOver="hilite(2582)" onMouseOut="lolite()" onClick="logVariable('alt')" href="../../_variables/alt.html">$alt</a>), <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>);
<a name="l208"><span class="linenum"> 208</span></a>          }
<a name="l209"><span class="linenum"> 209</span></a>          return <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>;
<a name="l210"><span class="linenum"> 210</span></a>      }
<a name="l211"><span class="linenum"> 211</span></a>  }
<a name="l212"><span class="linenum"> 212</span></a>  
<a name="l213"><span class="linenum"> 213</span></a>  
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'action_link': ['action_link', 'Renders a special html link with attached action ', [['lib','outputrenderers.php',1623],['report/loglive/classes','table_log.php',285],['report/log/classes','table_log.php',332]], 75],
'supports_svg': ['supports_svg', 'Returns true if the user agent supports the display of SVG images. ', [['lib/classes','useragent.php',935]], 4],
's': ['s', 'Count of attempts selected by $this->whichattempts ', [['mod/quiz/report/statistics/classes','calculated.php',91],['lib','weblib.php',84]], 1072],
'filter_text_image': ['filter_text_image', 'Create TeX image link. ', [['filter/tex','filter.php',39]], 2],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'record_exists': ['record_exists', 'Check if a record exists by ID. ', [['competency/classes','persistent.php',842],['lib/dml','moodle_database.php',1817]], 901],
'filter': ['filter', 'Template method for removing certain tokens based on arbitrary criteria. ', [['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Nmtokens.php',55],['lib/htmlpurifier/HTMLPurifier/URIFilter','HostBlacklist.php',35],['filter/emoticon','filter.php',35],['filter/multilang','filter.php',43],['filter/algebra','filter.php',92],['lib/htmlpurifier/HTMLPurifier/URIFilter','DisableExternal.php',33],['lib/horde/framework/Horde/Stream/Filter','Null.php',56],['lib/horde/framework/Horde','Variables.php',315],['lib/horde/framework/Horde/Stream/Filter','Crc32.php',41],['filter/emailprotect','filter.php',34],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Class.php',31],['repository','lib.php',2099],['grade/report/singleview/classes/local/screen','filterable_items.php',38],['lib/horde/framework/Horde/Stream/Filter','Bin2hex.php',25],['filter/activitynames','filter.php',39],['lib/htmlpurifier/HTMLPurifier/URIFilter','DisableExternalResources.php',16],['filter/glossary','filter.php',53],['lib/horde/framework/Horde/Imap/Client/Data/Format/Filter','Quote.php',28],['lib/horde/framework/Horde/Imap/Client/Data/Format/Filter','String.php',42],['filter/tex','filter.php',115],['filter/tidy','filter.php',41],['lib/htmlpurifier/HTMLPurifier/URIFilter','SafeIframe.php',45],['lib/htmlpurifier/HTMLPurifier/URIFilter','DisableResources.php',16],['filter/censor','filter.php',55],['filter/data','filter.php',34],['filter/mathjaxloader','filter.php',133],['lib/horde/framework/Horde/Stream/Filter','Eol.php',85],['filter/urltolink','filter.php',39],['lib/phpexcel/PHPExcel/Calculation','Database.php',70],['filter/mediaplugin','filter.php',50],['grade/report/singleview/classes/local/screen','grade.php',65],['lib/htmlpurifier/HTMLPurifier/URIFilter','Munge.php',62],['lib/htmlpurifier/HTMLPurifier','URIDefinition.php',92],['lib/htmlpurifier/HTMLPurifier/URIFilter','MakeAbsolute.php',52],['lib/horde/framework/Horde/Stream/Filter','Htmlspecialchars.php',30]], 280],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'preg_match': ['preg_match', '', [], 1286],
'html_entity_decode': ['html_entity_decode', '', [], 35],
'str_replace': ['str_replace', '', [], 1648],
'preg_replace': ['preg_replace', '', [], 917],
'preg_match_all': ['preg_match_all', '', [], 161],
'defined': ['defined', '', [], 4731],
'count': ['count', '', [], 4095],
'file_exists': ['file_exists', '', [], 867],
'time': ['time', '', [], 1959],
'implode': ['implode', '', [], 1281],
'strpos': ['strpos', '', [], 1604]};
CLASS_DATA={
'core_useragent': ['core_useragent', 'The user agent class. ', [['lib/classes','useragent.php',25]], 159],
'filter_tex': ['filter_tex', 'TeX filtering class. ', [['filter/tex','filter.php',111]], 1],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'popup_action': ['popup_action', 'Component action for a popup window. ', [['lib','outputactions.php',114]], 31],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',239]], 1200],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',238]], 3088]};
CONST_DATA={
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
