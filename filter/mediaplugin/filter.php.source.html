<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /filter/mediaplugin/filter.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='filter/mediaplugin';
filename='filter.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/filter/mediaplugin/</a> -> <a href="filter.php.html">filter.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="filter.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="filter.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> *  Media plugin filtering</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *  This filter will replace any links to a media file with</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> *  a media plugin that plays that media inline</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> *</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @package    filter</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @subpackage mediaplugin</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @copyright  2004 onwards Martin Dougiamas  {@link http://moodle.com}</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> */</span>
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment">/**</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * Automatic media embedding filter class.</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> *</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * It is highly recommended to configure servers to be compatible with our slasharguments,</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * otherwise the &quot;?d=600x400&quot; may not work.</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> *</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @package    filter</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> * @subpackage mediaplugin</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * @copyright  2004 onwards Martin Dougiamas  {@link http://moodle.com}</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment"> */</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('filter_mediaplugin')" href="../../_classes/filter_mediaplugin.html" onMouseOver="classPopup(event,'filter_mediaplugin')">filter_mediaplugin</a> extends moodle_text_filter {
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">    /** @var bool True if currently filtering trusted text */</span>
<a name="l44"><span class="linenum">  44</span></a>      private <a class="var it7894" onMouseOver="hilite(7894)" onMouseOut="lolite()" onClick="logVariable('trusted')" href="../../_variables/trusted.html">$trusted</a>;
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">    /** @var core_media_renderer Media renderer */</span>
<a name="l46"><span class="linenum">  46</span></a>      private <a class="var it4384" onMouseOver="hilite(4384)" onMouseOut="lolite()" onClick="logVariable('mediarenderer')" href="../../_variables/mediarenderer.html">$mediarenderer</a>;
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment">    /** @var string Partial regex pattern indicating possible embeddable content */</span>
<a name="l48"><span class="linenum">  48</span></a>      private <a class="var it35444" onMouseOver="hilite(35444)" onMouseOut="lolite()" onClick="logVariable('embedmarkers')" href="../../_variables/embedmarkers.html">$embedmarkers</a>;
<a name="l49"><span class="linenum">  49</span></a>  
<a name="l50"><span class="linenum">  50</span></a>      public function <a class="function" onClick="logFunction('filter')" href="../../_functions/filter.html" onMouseOver="funcPopup(event,'filter')">filter</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, array <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = array()) {
<a name="l51"><span class="linenum">  51</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>;
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_string')" href="../../_functions/is_string.html" onMouseOver="phpfuncPopup(event,'is_string')">is_string</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>) or empty(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>)) {
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">            // non string data can not be filtered anyway</span>
<a name="l55"><span class="linenum">  55</span></a>              return <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>;
<a name="l56"><span class="linenum">  56</span></a>          }
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>          if (<a class="phpfunction" onClick="logFunction('stripos')" href="../../_functions/stripos.html" onMouseOver="phpfuncPopup(event,'stripos')">stripos</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, '&lt;/a&gt;') === false) {
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment">            // Performance shortcut - if not &lt;/a&gt; tag, nothing can match.</span>
<a name="l60"><span class="linenum">  60</span></a>              return <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>;
<a name="l61"><span class="linenum">  61</span></a>          }
<a name="l62"><span class="linenum">  62</span></a>  
<a name="l63"><span class="linenum">  63</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('mediarenderer')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/mediarenderer.html">mediarenderer</a>) {
<a name="l64"><span class="linenum">  64</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('mediarenderer')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/mediarenderer.html">mediarenderer</a> = <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('core', 'media');
<a name="l65"><span class="linenum">  65</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('embedmarkers')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/embedmarkers.html">embedmarkers</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('mediarenderer')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/mediarenderer.html">mediarenderer</a>-&gt;<a class="function" onClick="logFunction('get_embeddable_markers')" href="../../_functions/get_embeddable_markers.html" onMouseOver="funcPopup(event,'get_embeddable_markers')">get_embeddable_markers</a>();
<a name="l66"><span class="linenum">  66</span></a>          }
<a name="l67"><span class="linenum">  67</span></a>  
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">        // Check SWF permissions.</span>
<a name="l69"><span class="linenum">  69</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('trusted')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/trusted.html">trusted</a> = !empty(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['noclean']) or !empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('allowobjectembed')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/allowobjectembed.html">allowobjectembed</a>);
<a name="l70"><span class="linenum">  70</span></a>  
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment">        // Looking for tags.</span>
<a name="l72"><span class="linenum">  72</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = <a class="phpfunction" onClick="logFunction('preg_split')" href="../../_functions/preg_split.html" onMouseOver="phpfuncPopup(event,'preg_split')">preg_split</a>('/(&lt;[^&gt;]*&gt;)/i', <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>          if (!<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) {
<a name="l75"><span class="linenum">  75</span></a>              return <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../_variables/text.html">$text</a>;
<a name="l76"><span class="linenum">  76</span></a>          }
<a name="l77"><span class="linenum">  77</span></a>  
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">        // Regex to find media extensions in an &lt;a&gt; tag.</span>
<a name="l79"><span class="linenum">  79</span></a>          <a class="var it4993" onMouseOver="hilite(4993)" onMouseOut="lolite()" onClick="logVariable('re')" href="../../_variables/re.html">$re</a> = '~&lt;a\s[^&gt;]*href=&quot;([^&quot;]*(?:' .  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('embedmarkers')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/embedmarkers.html">embedmarkers</a> . ')[^&quot;]*)&quot;[^&gt;]*&gt;([^&gt;]*)&lt;/a&gt;~is';
<a name="l80"><span class="linenum">  80</span></a>  
<a name="l81"><span class="linenum">  81</span></a>          <a class="var it28658" onMouseOver="hilite(28658)" onMouseOut="lolite()" onClick="logVariable('newtext')" href="../../_variables/newtext.html">$newtext</a> = '';
<a name="l82"><span class="linenum">  82</span></a>          <a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a> = '';
<a name="l83"><span class="linenum">  83</span></a>          <a class="var it35446" onMouseOver="hilite(35446)" onMouseOut="lolite()" onClick="logVariable('sizeofmatches')" href="../../_variables/sizeofmatches.html">$sizeofmatches</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment">        // We iterate through the given string to find valid &lt;a&gt; tags</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="comment">        // and build them so that the callback function can check it for</span>
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment">        // embedded content. Then we rebuild the string.</span>
<a name="l88"><span class="linenum">  88</span></a>          foreach (<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> as <a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../_variables/idx.html">$idx</a> =&gt; <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>) {
<a name="l89"><span class="linenum">  89</span></a>              if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('|&lt;/a&gt;|', <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>) &amp;&amp; !empty(<a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a>)) {
<a name="l90"><span class="linenum">  90</span></a>                  <a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a> .= <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>;
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">                // Given we now have a valid &lt;a&gt; tag to process it's time for</span>
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">                // ReDoS protection. Stop processing if a word is too large.</span>
<a name="l94"><span class="linenum">  94</span></a>                  if (<a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a>) &lt; 4096) {
<a name="l95"><span class="linenum">  95</span></a>                      <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a> = <a class="phpfunction" onClick="logFunction('preg_replace_callback')" href="../../_functions/preg_replace_callback.html" onMouseOver="phpfuncPopup(event,'preg_replace_callback')">preg_replace_callback</a>(<a class="var it4993" onMouseOver="hilite(4993)" onMouseOut="lolite()" onClick="logVariable('re')" href="../../_variables/re.html">$re</a>, array(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>, 'callback'), <a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a>);
<a name="l96"><span class="linenum">  96</span></a>                  }
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">                // Rebuilding the string with our new processed text.</span>
<a name="l98"><span class="linenum">  98</span></a>                  <a class="var it28658" onMouseOver="hilite(28658)" onMouseOut="lolite()" onClick="logVariable('newtext')" href="../../_variables/newtext.html">$newtext</a> .= !empty(<a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a>) ? <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a> : <a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a>;
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment">                // Wipe it so we can catch any more instances to filter.</span>
<a name="l100"><span class="linenum"> 100</span></a>                  <a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a> = '';
<a name="l101"><span class="linenum"> 101</span></a>                  <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a> = '';
<a name="l102"><span class="linenum"> 102</span></a>              } else if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/&lt;a\s[^&gt;]*/', <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>) &amp;&amp; <a class="var it35446" onMouseOver="hilite(35446)" onMouseOut="lolite()" onClick="logVariable('sizeofmatches')" href="../../_variables/sizeofmatches.html">$sizeofmatches</a> &gt; 1) {
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">                // Looking for a starting &lt;a&gt; tag.</span>
<a name="l104"><span class="linenum"> 104</span></a>                  <a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a> = <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>;
<a name="l105"><span class="linenum"> 105</span></a>              } else {
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment">                // If we have a validtag add to that to process later,</span>
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment">                // else add straight onto our newtext string.</span>
<a name="l108"><span class="linenum"> 108</span></a>                  if (!empty(<a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a>)) {
<a name="l109"><span class="linenum"> 109</span></a>                      <a class="var it35445" onMouseOver="hilite(35445)" onMouseOut="lolite()" onClick="logVariable('validtag')" href="../../_variables/validtag.html">$validtag</a> .= <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>;
<a name="l110"><span class="linenum"> 110</span></a>                  } else {
<a name="l111"><span class="linenum"> 111</span></a>                      <a class="var it28658" onMouseOver="hilite(28658)" onMouseOut="lolite()" onClick="logVariable('newtext')" href="../../_variables/newtext.html">$newtext</a> .= <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../../_variables/tag.html">$tag</a>;
<a name="l112"><span class="linenum"> 112</span></a>                  }
<a name="l113"><span class="linenum"> 113</span></a>              }
<a name="l114"><span class="linenum"> 114</span></a>          }
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>  <span class="comment">        // Return the same string except processed by the above.</span>
<a name="l117"><span class="linenum"> 117</span></a>          return <a class="var it28658" onMouseOver="hilite(28658)" onMouseOut="lolite()" onClick="logVariable('newtext')" href="../../_variables/newtext.html">$newtext</a>;
<a name="l118"><span class="linenum"> 118</span></a>      }
<a name="l119"><span class="linenum"> 119</span></a>  
<a name="l120"><span class="linenum"> 120</span></a>      <span class="comment">/**</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">     * Replace link with embedded content, if supported.</span>
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment">     *</span>
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment">     * @param array $matches</span>
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">     * @return string</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">     */</span>
<a name="l126"><span class="linenum"> 126</span></a>      private function <a class="function" onClick="logFunction('callback')" href="../../_functions/callback.html" onMouseOver="funcPopup(event,'callback')">callback</a>(array <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) {
<a name="l127"><span class="linenum"> 127</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>;
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">        // Check if we ignore it.</span>
<a name="l129"><span class="linenum"> 129</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/class=&quot;[^&quot;]*nomediaplugin/i', <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[0])) {
<a name="l130"><span class="linenum"> 130</span></a>              return <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[0];
<a name="l131"><span class="linenum"> 131</span></a>          }
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">        // Get name.</span>
<a name="l134"><span class="linenum"> 134</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2]);
<a name="l135"><span class="linenum"> 135</span></a>          if (empty(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>) or <a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>, 'http') === 0) {
<a name="l136"><span class="linenum"> 136</span></a>              <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a> = ''; <span class="comment">// Use default name.</span>
<a name="l137"><span class="linenum"> 137</span></a>          }
<a name="l138"><span class="linenum"> 138</span></a>  
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment">        // Split provided URL into alternatives.</span>
<a name="l140"><span class="linenum"> 140</span></a>          <a class="var it8204" onMouseOver="hilite(8204)" onMouseOut="lolite()" onClick="logVariable('urls')" href="../../_variables/urls.html">$urls</a> = core_media::<a class="function" onClick="logFunction('split_alternatives')" href="../../_functions/split_alternatives.html" onMouseOver="funcPopup(event,'split_alternatives')">split_alternatives</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1], <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>, <a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>);
<a name="l141"><span class="linenum"> 141</span></a>  
<a name="l142"><span class="linenum"> 142</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = array();
<a name="l143"><span class="linenum"> 143</span></a>  
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">        // Allow SWF (or not).</span>
<a name="l145"><span class="linenum"> 145</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('trusted')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/trusted.html">trusted</a>) {
<a name="l146"><span class="linenum"> 146</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>[core_media::OPTION_TRUSTED] = true;
<a name="l147"><span class="linenum"> 147</span></a>          }
<a name="l148"><span class="linenum"> 148</span></a>  
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment">        // We could test whether embed is possible using can_embed, but to save</span>
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment">        // time, let's just embed it with the 'fallback to blank' option which</span>
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment">        // does most of the same stuff anyhow.</span>
<a name="l152"><span class="linenum"> 152</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>[core_media::OPTION_FALLBACK_TO_BLANK] = true;
<a name="l153"><span class="linenum"> 153</span></a>  
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">        // NOTE: Options are not passed through from filter because the 'embed'</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">        // code does not recognise filter options (it's a different kind of</span>
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">        // option-space) as it can be used in non-filter situations.</span>
<a name="l157"><span class="linenum"> 157</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('mediarenderer')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/mediarenderer.html">mediarenderer</a>-&gt;<a class="function" onClick="logFunction('embed_alternatives')" href="../../_functions/embed_alternatives.html" onMouseOver="funcPopup(event,'embed_alternatives')">embed_alternatives</a>(<a class="var it8204" onMouseOver="hilite(8204)" onMouseOut="lolite()" onClick="logVariable('urls')" href="../../_variables/urls.html">$urls</a>, <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>, <a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>);
<a name="l158"><span class="linenum"> 158</span></a>  
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment">        // If something was embedded, return it, otherwise return original.</span>
<a name="l160"><span class="linenum"> 160</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> !== '') {
<a name="l161"><span class="linenum"> 161</span></a>              return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l162"><span class="linenum"> 162</span></a>          } else {
<a name="l163"><span class="linenum"> 163</span></a>              return <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[0];
<a name="l164"><span class="linenum"> 164</span></a>          }
<a name="l165"><span class="linenum"> 165</span></a>      }
<a name="l166"><span class="linenum"> 166</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'callback': ['callback', 'Catch the request token. ', [['repository/boxnet','lib.php',304],['repository/dropbox','lib.php',148],['repository','lib.php',2341],['repository/googledocs','lib.php',113],['filter/mediaplugin','filter.php',120]], 86],
'get_renderer': ['get_renderer', 'Returns instance of page renderer used by this plugin ', [['course/format','lib.php',905],['question/type/multichoice','question.php',156],['question/type/multichoice','question.php',278],['question/behaviour','behaviourbase.php',135],['question/type','questionbase.php',275],['lib','pagelib.php',802],['lib','outputlib.php',1828],['lib','outputfactories.php',70],['lib','outputfactories.php',292],['lib','outputfactories.php',377],['mod/assign','locallib.php',2987],['grade/grading/form/rubric','lib.php',486],['lib/tests/fixtures','test_renderer_factory.php',49],['grade/grading/form/guide','lib.php',492]], 452],
'get_embeddable_markers': ['get_embeddable_markers', 'Obtains a list of markers that can be used in a regular expression when searching for URLs that can be embedded by any player type. ', [['lib','outputrenderers.php',4788],['lib','medialib.php',268],['lib','medialib.php',517],['lib','medialib.php',622],['lib','medialib.php',674]], 2],
'strlen': ['strlen', 'Counts the number of characters. Unit-tested by Kasper (single byte charsets only) ', [['lib/typo3','class.t3lib_cs.php',1520],['lib/classes','text.php',305]], 1649],
'split_alternatives': ['split_alternatives', 'Given a string containing multiple URLs separated by #, this will split it into an array of moodle_url objects suitable for using when calling embed_alternatives. ', [['lib','medialib.php',101]], 5],
'filter': ['filter', 'Template method for removing certain tokens based on arbitrary criteria. ', [['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Nmtokens.php',55],['lib/htmlpurifier/HTMLPurifier/URIFilter','HostBlacklist.php',35],['filter/emoticon','filter.php',35],['filter/multilang','filter.php',43],['filter/algebra','filter.php',92],['lib/htmlpurifier/HTMLPurifier/URIFilter','DisableExternal.php',33],['lib/horde/framework/Horde/Stream/Filter','Null.php',56],['lib/horde/framework/Horde','Variables.php',315],['lib/horde/framework/Horde/Stream/Filter','Crc32.php',41],['filter/emailprotect','filter.php',34],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Class.php',31],['repository','lib.php',2099],['grade/report/singleview/classes/local/screen','filterable_items.php',38],['lib/horde/framework/Horde/Stream/Filter','Bin2hex.php',25],['filter/activitynames','filter.php',39],['lib/htmlpurifier/HTMLPurifier/URIFilter','DisableExternalResources.php',16],['filter/glossary','filter.php',53],['lib/horde/framework/Horde/Imap/Client/Data/Format/Filter','Quote.php',28],['lib/horde/framework/Horde/Imap/Client/Data/Format/Filter','String.php',42],['filter/tex','filter.php',115],['filter/tidy','filter.php',41],['lib/htmlpurifier/HTMLPurifier/URIFilter','SafeIframe.php',45],['lib/htmlpurifier/HTMLPurifier/URIFilter','DisableResources.php',16],['filter/censor','filter.php',55],['filter/data','filter.php',34],['filter/mathjaxloader','filter.php',133],['lib/horde/framework/Horde/Stream/Filter','Eol.php',85],['filter/urltolink','filter.php',39],['lib/phpexcel/PHPExcel/Calculation','Database.php',70],['filter/mediaplugin','filter.php',50],['grade/report/singleview/classes/local/screen','grade.php',65],['lib/htmlpurifier/HTMLPurifier/URIFilter','Munge.php',62],['lib/htmlpurifier/HTMLPurifier','URIDefinition.php',92],['lib/htmlpurifier/HTMLPurifier/URIFilter','MakeAbsolute.php',52],['lib/horde/framework/Horde/Stream/Filter','Htmlspecialchars.php',30]], 280],
'embed_alternatives': ['embed_alternatives', 'Renders media files (audio or video) using suitable embedded player. The list of URLs should be alternative versions of the same content in multiple formats. If there is only one format it should have a single entry. ', [['lib','outputrenderers.php',4683]], 4],
'preg_match': ['preg_match', '', [], 1286],
'defined': ['defined', '', [], 4731],
'preg_replace_callback': ['preg_replace_callback', '', [], 136],
'is_string': ['is_string', '', [], 536],
'count': ['count', '', [], 4095],
'trim': ['trim', '', [], 1948],
'stripos': ['stripos', '', [], 88],
'preg_split': ['preg_split', '', [], 146],
'strpos': ['strpos', '', [], 1604]};
CLASS_DATA={
'filter_mediaplugin': ['filter_mediaplugin', 'Automatic media embedding filter class. ', [['filter/mediaplugin','filter.php',31]], 2]};
CONST_DATA={
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
