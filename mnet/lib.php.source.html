<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /mnet/lib.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='mnet';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/mnet/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * Library functions for mnet</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> *</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> * @author  Donal McMullan  donal@catalyst.net.nz</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * @version 0.0.1</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> * @license http://www.gnu.org/copyleft/gpl.html GNU Public License</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> * @package mnet</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> */</span>
<a name="l10"><span class="linenum">  10</span></a>  require_once <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../mnet/xmlrpc/xmlparser.php.html">/mnet/xmlrpc/xmlparser.php</a>';
<a name="l11"><span class="linenum">  11</span></a>  require_once <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../mnet/peer.php.html">/mnet/peer.php</a>';
<a name="l12"><span class="linenum">  12</span></a>  require_once <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../mnet/environment.php.html">/mnet/environment.php</a>';
<a name="l13"><span class="linenum">  13</span></a>  
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">/// CONSTANTS ///////////////////////////////////////////////////////////</span>
<a name="l15"><span class="linenum">  15</span></a>  
<a name="l16"><span class="linenum">  16</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RPC_OK')" href="../_constants/RPC_OK.html" onMouseOver="constPopup(event,'RPC_OK')">RPC_OK</a>',                0);
<a name="l17"><span class="linenum">  17</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RPC_NOSUCHFILE')" href="../_constants/RPC_NOSUCHFILE.html" onMouseOver="constPopup(event,'RPC_NOSUCHFILE')">RPC_NOSUCHFILE</a>',        1);
<a name="l18"><span class="linenum">  18</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RPC_NOSUCHCLASS')" href="../_constants/RPC_NOSUCHCLASS.html" onMouseOver="constPopup(event,'RPC_NOSUCHCLASS')">RPC_NOSUCHCLASS</a>',       2);
<a name="l19"><span class="linenum">  19</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RPC_NOSUCHFUNCTION')" href="../_constants/RPC_NOSUCHFUNCTION.html" onMouseOver="constPopup(event,'RPC_NOSUCHFUNCTION')">RPC_NOSUCHFUNCTION</a>',    3);
<a name="l20"><span class="linenum">  20</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RPC_FORBIDDENFUNCTION')" href="../_constants/RPC_FORBIDDENFUNCTION.html" onMouseOver="constPopup(event,'RPC_FORBIDDENFUNCTION')">RPC_FORBIDDENFUNCTION</a>', 4);
<a name="l21"><span class="linenum">  21</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RPC_NOSUCHMETHOD')" href="../_constants/RPC_NOSUCHMETHOD.html" onMouseOver="constPopup(event,'RPC_NOSUCHMETHOD')">RPC_NOSUCHMETHOD</a>',      5);
<a name="l22"><span class="linenum">  22</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RPC_FORBIDDENMETHOD')" href="../_constants/RPC_FORBIDDENMETHOD.html" onMouseOver="constPopup(event,'RPC_FORBIDDENMETHOD')">RPC_FORBIDDENMETHOD</a>',   6);
<a name="l23"><span class="linenum">  23</span></a>  
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment">/**</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * Strip extraneous detail from a URL or URI and return the hostname</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> *</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * @param  string  $uri  The URI of a file on the remote computer, optionally</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> *                       including its http:// prefix like</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> *                       http://www.example.com/index.html</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @return string        Just the hostname</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> */</span>
<a name="l32"><span class="linenum">  32</span></a>  function <a class="function" onClick="logFunction('mnet_get_hostname_from_uri')" href="../_functions/mnet_get_hostname_from_uri.html" onMouseOver="funcPopup(event,'mnet_get_hostname_from_uri')">mnet_get_hostname_from_uri</a>(<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a> = null) {
<a name="l33"><span class="linenum">  33</span></a>      <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> = <a class="phpfunction" onClick="logFunction('preg_match')" href="../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(&quot;@^(?:http[s]?://)?([A-Z0-9\-\.]+).*@i&quot;, <a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../_variables/matches.html">$matches</a>);
<a name="l34"><span class="linenum">  34</span></a>      if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> &gt; 0) return <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../_variables/matches.html">$matches</a>[1];
<a name="l35"><span class="linenum">  35</span></a>      return false;
<a name="l36"><span class="linenum">  36</span></a>  }
<a name="l37"><span class="linenum">  37</span></a>  
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">/**</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * Get the remote machine's SSL Cert</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> *</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment"> * @param  string  $uri     The URI of a file on the remote computer, including</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment"> *                          its http:// or https:// prefix</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> * @return string           A PEM formatted SSL Certificate.</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> */</span>
<a name="l45"><span class="linenum">  45</span></a>  function <a class="function" onClick="logFunction('mnet_get_public_key')" href="../_functions/mnet_get_public_key.html" onMouseOver="funcPopup(event,'mnet_get_public_key')">mnet_get_public_key</a>(<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>, <a class="var it1401" onMouseOver="hilite(1401)" onMouseOut="lolite()" onClick="logVariable('application')" href="../_variables/application.html">$application</a>=null) {
<a name="l46"><span class="linenum">  46</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l47"><span class="linenum">  47</span></a>      <a class="var it1357" onMouseOver="hilite(1357)" onMouseOut="lolite()" onClick="logVariable('mnet')" href="../_variables/mnet.html">$mnet</a> = <a class="function" onClick="logFunction('get_mnet_environment')" href="../_functions/get_mnet_environment.html" onMouseOver="funcPopup(event,'get_mnet_environment')">get_mnet_environment</a>();
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">    // The key may be cached in the mnet_set_public_key function...</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">    // check this first</span>
<a name="l50"><span class="linenum">  50</span></a>      <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> = <a class="function" onClick="logFunction('mnet_set_public_key')" href="../_functions/mnet_set_public_key.html" onMouseOver="funcPopup(event,'mnet_set_public_key')">mnet_set_public_key</a>(<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>);
<a name="l51"><span class="linenum">  51</span></a>      if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> != false) {
<a name="l52"><span class="linenum">  52</span></a>          return <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>;
<a name="l53"><span class="linenum">  53</span></a>      }
<a name="l54"><span class="linenum">  54</span></a>  
<a name="l55"><span class="linenum">  55</span></a>      if (empty(<a class="var it1401" onMouseOver="hilite(1401)" onMouseOut="lolite()" onClick="logVariable('application')" href="../_variables/application.html">$application</a>)) {
<a name="l56"><span class="linenum">  56</span></a>          <a class="var it1401" onMouseOver="hilite(1401)" onMouseOut="lolite()" onClick="logVariable('application')" href="../_variables/application.html">$application</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('mnet_application', array('name'=&gt;'moodle'));
<a name="l57"><span class="linenum">  57</span></a>      }
<a name="l58"><span class="linenum">  58</span></a>  
<a name="l59"><span class="linenum">  59</span></a>      <a class="var it34125" onMouseOver="hilite(34125)" onMouseOut="lolite()" onClick="logVariable('rq')" href="../_variables/rq.html">$rq</a> = <a class="phpfunction" onClick="logFunction('xmlrpc_encode_request')" href="../_functions/xmlrpc_encode_request.html" onMouseOver="phpfuncPopup(event,'xmlrpc_encode_request')">xmlrpc_encode_request</a>('system/keyswap', array(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>, <a class="var it1357" onMouseOver="hilite(1357)" onMouseOut="lolite()" onClick="logVariable('mnet')" href="../_variables/mnet.html">$mnet</a>-&gt;<a onClick="logVariable('public_key')" class="var it45251" onMouseOver="hilite(45251)" onMouseOut="lolite()" href="../_variables/public_key.html">public_key</a>, <a class="var it1401" onMouseOver="hilite(1401)" onMouseOut="lolite()" onClick="logVariable('application')" href="../_variables/application.html">$application</a>-&gt;<a onClick="logVariable('name')" class="var it45528" onMouseOver="hilite(45528)" onMouseOut="lolite()" href="../_variables/name.html">name</a>), array(&quot;encoding&quot; =&gt; &quot;utf-8&quot;));
<a name="l60"><span class="linenum">  60</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a> = <a class="phpfunction" onClick="logFunction('curl_init')" href="../_functions/curl_init.html" onMouseOver="phpfuncPopup(event,'curl_init')">curl_init</a>(<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a> . <a class="var it1401" onMouseOver="hilite(1401)" onMouseOut="lolite()" onClick="logVariable('application')" href="../_variables/application.html">$application</a>-&gt;<a onClick="logVariable('xmlrpc_server_url')" class="var it45528" onMouseOver="hilite(45528)" onMouseOut="lolite()" href="../_variables/xmlrpc_server_url.html">xmlrpc_server_url</a>);
<a name="l61"><span class="linenum">  61</span></a>  
<a name="l62"><span class="linenum">  62</span></a>      <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_TIMEOUT, 60);
<a name="l63"><span class="linenum">  63</span></a>      <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_RETURNTRANSFER, true);
<a name="l64"><span class="linenum">  64</span></a>      <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_POST, true);
<a name="l65"><span class="linenum">  65</span></a>      <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_USERAGENT, 'Moodle');
<a name="l66"><span class="linenum">  66</span></a>      <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_POSTFIELDS, <a class="var it34125" onMouseOver="hilite(34125)" onMouseOut="lolite()" onClick="logVariable('rq')" href="../_variables/rq.html">$rq</a>);
<a name="l67"><span class="linenum">  67</span></a>      <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_HTTPHEADER, array(&quot;Content-Type: text/xml charset=UTF-8&quot;));
<a name="l68"><span class="linenum">  68</span></a>      <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_SSL_VERIFYPEER, false);
<a name="l69"><span class="linenum">  69</span></a>      <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_SSL_VERIFYHOST, 0);
<a name="l70"><span class="linenum">  70</span></a>  
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment">    // check for proxy</span>
<a name="l72"><span class="linenum">  72</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxyhost')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxyhost.html">proxyhost</a>) and !<a class="function" onClick="logFunction('is_proxybypass')" href="../_functions/is_proxybypass.html" onMouseOver="funcPopup(event,'is_proxybypass')">is_proxybypass</a>(<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>)) {
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment">        // SOCKS supported in PHP5 only</span>
<a name="l74"><span class="linenum">  74</span></a>          if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxytype')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxytype.html">proxytype</a>) and (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxytype')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxytype.html">proxytype</a> == 'SOCKS5')) {
<a name="l75"><span class="linenum">  75</span></a>              if (<a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('CURLPROXY_SOCKS5')) {
<a name="l76"><span class="linenum">  76</span></a>                  <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_PROXYTYPE, CURLPROXY_SOCKS5);
<a name="l77"><span class="linenum">  77</span></a>              } else {
<a name="l78"><span class="linenum">  78</span></a>                  <a class="phpfunction" onClick="logFunction('curl_close')" href="../_functions/curl_close.html" onMouseOver="phpfuncPopup(event,'curl_close')">curl_close</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>);
<a name="l79"><span class="linenum">  79</span></a>                  <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>( 'socksnotsupported','mnet' );
<a name="l80"><span class="linenum">  80</span></a>              }
<a name="l81"><span class="linenum">  81</span></a>          }
<a name="l82"><span class="linenum">  82</span></a>  
<a name="l83"><span class="linenum">  83</span></a>          <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_HTTPPROXYTUNNEL, false);
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>          if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxyport')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxyport.html">proxyport</a>)) {
<a name="l86"><span class="linenum">  86</span></a>              <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_PROXY, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxyhost')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxyhost.html">proxyhost</a>);
<a name="l87"><span class="linenum">  87</span></a>          } else {
<a name="l88"><span class="linenum">  88</span></a>              <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_PROXY, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxyhost')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxyhost.html">proxyhost</a>.':'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxyport')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxyport.html">proxyport</a>);
<a name="l89"><span class="linenum">  89</span></a>          }
<a name="l90"><span class="linenum">  90</span></a>  
<a name="l91"><span class="linenum">  91</span></a>          if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxyuser')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxyuser.html">proxyuser</a>) and !empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxypassword')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxypassword.html">proxypassword</a>)) {
<a name="l92"><span class="linenum">  92</span></a>              <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_PROXYUSERPWD, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxyuser')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxyuser.html">proxyuser</a>.':'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('proxypassword')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/proxypassword.html">proxypassword</a>);
<a name="l93"><span class="linenum">  93</span></a>              if (<a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('CURLOPT_PROXYAUTH')) {
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment">                // any proxy authentication if PHP 5.1</span>
<a name="l95"><span class="linenum">  95</span></a>                  <a class="phpfunction" onClick="logFunction('curl_setopt')" href="../_functions/curl_setopt.html" onMouseOver="phpfuncPopup(event,'curl_setopt')">curl_setopt</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>, CURLOPT_PROXYAUTH, CURLAUTH_BASIC | CURLAUTH_NTLM);
<a name="l96"><span class="linenum">  96</span></a>              }
<a name="l97"><span class="linenum">  97</span></a>          }
<a name="l98"><span class="linenum">  98</span></a>      }
<a name="l99"><span class="linenum">  99</span></a>  
<a name="l100"><span class="linenum"> 100</span></a>      <a class="var it799" onMouseOver="hilite(799)" onMouseOut="lolite()" onClick="logVariable('res')" href="../_variables/res.html">$res</a> = <a class="phpfunction" onClick="logFunction('xmlrpc_decode')" href="../_functions/xmlrpc_decode.html" onMouseOver="phpfuncPopup(event,'xmlrpc_decode')">xmlrpc_decode</a>(<a class="phpfunction" onClick="logFunction('curl_exec')" href="../_functions/curl_exec.html" onMouseOver="phpfuncPopup(event,'curl_exec')">curl_exec</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>));
<a name="l101"><span class="linenum"> 101</span></a>  
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">    // check for curl errors</span>
<a name="l103"><span class="linenum"> 103</span></a>      <a class="var it14740" onMouseOver="hilite(14740)" onMouseOut="lolite()" onClick="logVariable('curlerrno')" href="../_variables/curlerrno.html">$curlerrno</a> = <a class="phpfunction" onClick="logFunction('curl_errno')" href="../_functions/curl_errno.html" onMouseOver="phpfuncPopup(event,'curl_errno')">curl_errno</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>);
<a name="l104"><span class="linenum"> 104</span></a>      if (<a class="var it14740" onMouseOver="hilite(14740)" onMouseOut="lolite()" onClick="logVariable('curlerrno')" href="../_variables/curlerrno.html">$curlerrno</a>!=0) {
<a name="l105"><span class="linenum"> 105</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Request for <a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a> failed with curl error <a class="var it14740" onMouseOver="hilite(14740)" onMouseOut="lolite()" onClick="logVariable('curlerrno')" href="../_variables/curlerrno.html">$curlerrno</a>&quot;);
<a name="l106"><span class="linenum"> 106</span></a>      }
<a name="l107"><span class="linenum"> 107</span></a>  
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment">    // check HTTP error code</span>
<a name="l109"><span class="linenum"> 109</span></a>      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a> =  <a class="phpfunction" onClick="logFunction('curl_getinfo')" href="../_functions/curl_getinfo.html" onMouseOver="phpfuncPopup(event,'curl_getinfo')">curl_getinfo</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>);
<a name="l110"><span class="linenum"> 110</span></a>      if (!empty(<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>['http_code']) and (<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>['http_code'] != 200)) {
<a name="l111"><span class="linenum"> 111</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Request for <a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a> failed with HTTP code &quot;.<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>['http_code']);
<a name="l112"><span class="linenum"> 112</span></a>      }
<a name="l113"><span class="linenum"> 113</span></a>  
<a name="l114"><span class="linenum"> 114</span></a>      <a class="phpfunction" onClick="logFunction('curl_close')" href="../_functions/curl_close.html" onMouseOver="phpfuncPopup(event,'curl_close')">curl_close</a>(<a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('ch')" href="../_variables/ch.html">$ch</a>);
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it799" onMouseOver="hilite(799)" onMouseOut="lolite()" onClick="logVariable('res')" href="../_variables/res.html">$res</a>)) { // ! error
<a name="l117"><span class="linenum"> 117</span></a>          <a class="var it34126" onMouseOver="hilite(34126)" onMouseOut="lolite()" onClick="logVariable('public_certificate')" href="../_variables/public_certificate.html">$public_certificate</a> = <a class="var it799" onMouseOver="hilite(799)" onMouseOut="lolite()" onClick="logVariable('res')" href="../_variables/res.html">$res</a>;
<a name="l118"><span class="linenum"> 118</span></a>          <a class="var it7973" onMouseOver="hilite(7973)" onMouseOut="lolite()" onClick="logVariable('credentials')" href="../_variables/credentials.html">$credentials</a>=array();
<a name="l119"><span class="linenum"> 119</span></a>          if (<a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it34126" onMouseOver="hilite(34126)" onMouseOut="lolite()" onClick="logVariable('public_certificate')" href="../_variables/public_certificate.html">$public_certificate</a>))) {
<a name="l120"><span class="linenum"> 120</span></a>              <a class="var it7973" onMouseOver="hilite(7973)" onMouseOut="lolite()" onClick="logVariable('credentials')" href="../_variables/credentials.html">$credentials</a> = <a class="phpfunction" onClick="logFunction('openssl_x509_parse')" href="../_functions/openssl_x509_parse.html" onMouseOver="phpfuncPopup(event,'openssl_x509_parse')">openssl_x509_parse</a>(<a class="var it34126" onMouseOver="hilite(34126)" onMouseOut="lolite()" onClick="logVariable('public_certificate')" href="../_variables/public_certificate.html">$public_certificate</a>);
<a name="l121"><span class="linenum"> 121</span></a>              <a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a> = <a class="var it7973" onMouseOver="hilite(7973)" onMouseOut="lolite()" onClick="logVariable('credentials')" href="../_variables/credentials.html">$credentials</a>['subject']['CN'];
<a name="l122"><span class="linenum"> 122</span></a>              if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>( 'subjectAltName', <a class="var it7973" onMouseOver="hilite(7973)" onMouseOut="lolite()" onClick="logVariable('credentials')" href="../_variables/credentials.html">$credentials</a>['subject'])) {
<a name="l123"><span class="linenum"> 123</span></a>                  <a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a> = <a class="var it7973" onMouseOver="hilite(7973)" onMouseOut="lolite()" onClick="logVariable('credentials')" href="../_variables/credentials.html">$credentials</a>['subject']['subjectAltName'];
<a name="l124"><span class="linenum"> 124</span></a>              }
<a name="l125"><span class="linenum"> 125</span></a>              if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>, <a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a>) !== false) {
<a name="l126"><span class="linenum"> 126</span></a>                  <a class="function" onClick="logFunction('mnet_set_public_key')" href="../_functions/mnet_set_public_key.html" onMouseOver="funcPopup(event,'mnet_set_public_key')">mnet_set_public_key</a>(<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>, <a class="var it34126" onMouseOver="hilite(34126)" onMouseOut="lolite()" onClick="logVariable('public_certificate')" href="../_variables/public_certificate.html">$public_certificate</a>);
<a name="l127"><span class="linenum"> 127</span></a>                  return <a class="var it34126" onMouseOver="hilite(34126)" onMouseOut="lolite()" onClick="logVariable('public_certificate')" href="../_variables/public_certificate.html">$public_certificate</a>;
<a name="l128"><span class="linenum"> 128</span></a>              }
<a name="l129"><span class="linenum"> 129</span></a>              else {
<a name="l130"><span class="linenum"> 130</span></a>                  <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Request for <a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a> returned public key for different URI - <a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a>&quot;);
<a name="l131"><span class="linenum"> 131</span></a>              }
<a name="l132"><span class="linenum"> 132</span></a>          }
<a name="l133"><span class="linenum"> 133</span></a>          else {
<a name="l134"><span class="linenum"> 134</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Request for <a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a> returned empty response&quot;);
<a name="l135"><span class="linenum"> 135</span></a>          }
<a name="l136"><span class="linenum"> 136</span></a>      }
<a name="l137"><span class="linenum"> 137</span></a>      else {
<a name="l138"><span class="linenum"> 138</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>( &quot;Request for <a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a> returned unexpected result&quot;);
<a name="l139"><span class="linenum"> 139</span></a>      }
<a name="l140"><span class="linenum"> 140</span></a>      return false;
<a name="l141"><span class="linenum"> 141</span></a>  }
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">/**</span>
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment"> * Store a URI's public key in a static variable, or retrieve the key for a URI</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment"> *</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment"> * @param  string  $uri  The URI of a file on the remote computer, including its</span>
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment"> *                       https:// prefix</span>
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment"> * @param  mixed   $key  A public key to store in the array OR null. If the key</span>
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment"> *                       is null, the function will return the previously stored</span>
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment"> *                       key for the supplied URI, should it exist.</span>
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment"> * @return mixed         A public key OR true/false.</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment"> */</span>
<a name="l153"><span class="linenum"> 153</span></a>  function <a class="function" onClick="logFunction('mnet_set_public_key')" href="../_functions/mnet_set_public_key.html" onMouseOver="funcPopup(event,'mnet_set_public_key')">mnet_set_public_key</a>(<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>, <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> = null) {
<a name="l154"><span class="linenum"> 154</span></a>      static <a class="var it34127" onMouseOver="hilite(34127)" onMouseOut="lolite()" onClick="logVariable('keyarray')" href="../_variables/keyarray.html">$keyarray</a> = array();
<a name="l155"><span class="linenum"> 155</span></a>      if (isset(<a class="var it34127" onMouseOver="hilite(34127)" onMouseOut="lolite()" onClick="logVariable('keyarray')" href="../_variables/keyarray.html">$keyarray</a>[<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>]) &amp;&amp; empty(<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>)) {
<a name="l156"><span class="linenum"> 156</span></a>          return <a class="var it34127" onMouseOver="hilite(34127)" onMouseOut="lolite()" onClick="logVariable('keyarray')" href="../_variables/keyarray.html">$keyarray</a>[<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>];
<a name="l157"><span class="linenum"> 157</span></a>      } elseif (!empty(<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>)) {
<a name="l158"><span class="linenum"> 158</span></a>          <a class="var it34127" onMouseOver="hilite(34127)" onMouseOut="lolite()" onClick="logVariable('keyarray')" href="../_variables/keyarray.html">$keyarray</a>[<a class="var it1400" onMouseOver="hilite(1400)" onMouseOut="lolite()" onClick="logVariable('uri')" href="../_variables/uri.html">$uri</a>] = <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>;
<a name="l159"><span class="linenum"> 159</span></a>          return true;
<a name="l160"><span class="linenum"> 160</span></a>      }
<a name="l161"><span class="linenum"> 161</span></a>      return false;
<a name="l162"><span class="linenum"> 162</span></a>  }
<a name="l163"><span class="linenum"> 163</span></a>  
<a name="l164"><span class="linenum"> 164</span></a>  <span class="comment">/**</span>
<a name="l165"><span class="linenum"> 165</span></a>  <span class="comment"> * Sign a message and return it in an XML-Signature document</span>
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment"> *</span>
<a name="l167"><span class="linenum"> 167</span></a>  <span class="comment"> * This function can sign any content, but it was written to provide a system of</span>
<a name="l168"><span class="linenum"> 168</span></a>  <span class="comment"> * signing XML-RPC request and response messages. The message will be base64</span>
<a name="l169"><span class="linenum"> 169</span></a>  <span class="comment"> * encoded, so it does not need to be text.</span>
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment"> *</span>
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment"> * We compute the SHA1 digest of the message.</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment"> * We compute a signature on that digest with our private key.</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment"> * We link to the public key that can be used to verify our signature.</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment"> * We base64 the message data.</span>
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment"> * We identify our wwwroot - this must match our certificate's CN</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment"> *</span>
<a name="l177"><span class="linenum"> 177</span></a>  <span class="comment"> * The XML-RPC document will be parceled inside an XML-SIG document, which holds</span>
<a name="l178"><span class="linenum"> 178</span></a>  <span class="comment"> * the base64_encoded XML as an object, the SHA1 digest of that document, and a</span>
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment"> * signature of that document using the local private key. This signature will</span>
<a name="l180"><span class="linenum"> 180</span></a>  <span class="comment"> * uniquely identify the RPC document as having come from this server.</span>
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment"> *</span>
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment"> * See the {@Link http://www.w3.org/TR/xmldsig-core/ XML-DSig spec} at the W3c</span>
<a name="l183"><span class="linenum"> 183</span></a>  <span class="comment"> * site</span>
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment"> *</span>
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment"> * @param  string   $message              The data you want to sign</span>
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment"> * @param  resource $privatekey           The private key to sign the response with</span>
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment"> * @return string                         An XML-DSig document</span>
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment"> */</span>
<a name="l189"><span class="linenum"> 189</span></a>  function <a class="function" onClick="logFunction('mnet_sign_message')" href="../_functions/mnet_sign_message.html" onMouseOver="funcPopup(event,'mnet_sign_message')">mnet_sign_message</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it30060" onMouseOver="hilite(30060)" onMouseOut="lolite()" onClick="logVariable('privatekey')" href="../_variables/privatekey.html">$privatekey</a> = null) {
<a name="l190"><span class="linenum"> 190</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l191"><span class="linenum"> 191</span></a>      <a class="var it23832" onMouseOver="hilite(23832)" onMouseOut="lolite()" onClick="logVariable('digest')" href="../_variables/digest.html">$digest</a> = <a class="phpfunction" onClick="logFunction('sha1')" href="../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>);
<a name="l192"><span class="linenum"> 192</span></a>  
<a name="l193"><span class="linenum"> 193</span></a>      <a class="var it1357" onMouseOver="hilite(1357)" onMouseOut="lolite()" onClick="logVariable('mnet')" href="../_variables/mnet.html">$mnet</a> = <a class="function" onClick="logFunction('get_mnet_environment')" href="../_functions/get_mnet_environment.html" onMouseOver="funcPopup(event,'get_mnet_environment')">get_mnet_environment</a>();
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment">    // If the user hasn't supplied a private key (for example, one of our older,</span>
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">    //  expired private keys, we get the current default private key and use that.</span>
<a name="l196"><span class="linenum"> 196</span></a>      if (<a class="var it30060" onMouseOver="hilite(30060)" onMouseOut="lolite()" onClick="logVariable('privatekey')" href="../_variables/privatekey.html">$privatekey</a> == null) {
<a name="l197"><span class="linenum"> 197</span></a>          <a class="var it30060" onMouseOver="hilite(30060)" onMouseOut="lolite()" onClick="logVariable('privatekey')" href="../_variables/privatekey.html">$privatekey</a> = <a class="var it1357" onMouseOver="hilite(1357)" onMouseOut="lolite()" onClick="logVariable('mnet')" href="../_variables/mnet.html">$mnet</a>-&gt;<a class="function" onClick="logFunction('get_private_key')" href="../_functions/get_private_key.html" onMouseOver="funcPopup(event,'get_private_key')">get_private_key</a>();
<a name="l198"><span class="linenum"> 198</span></a>      }
<a name="l199"><span class="linenum"> 199</span></a>  
<a name="l200"><span class="linenum"> 200</span></a>  <span class="comment">    // The '$sig' value below is returned by reference.</span>
<a name="l201"><span class="linenum"> 201</span></a>  <span class="comment">    // We initialize it first to stop my IDE from complaining.</span>
<a name="l202"><span class="linenum"> 202</span></a>      <a class="var it12063" onMouseOver="hilite(12063)" onMouseOut="lolite()" onClick="logVariable('sig')" href="../_variables/sig.html">$sig</a>  = '';
<a name="l203"><span class="linenum"> 203</span></a>      <a class="var it7116" onMouseOver="hilite(7116)" onMouseOut="lolite()" onClick="logVariable('bool')" href="../_variables/bool.html">$bool</a> = <a class="phpfunction" onClick="logFunction('openssl_sign')" href="../_functions/openssl_sign.html" onMouseOver="phpfuncPopup(event,'openssl_sign')">openssl_sign</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it12063" onMouseOver="hilite(12063)" onMouseOut="lolite()" onClick="logVariable('sig')" href="../_variables/sig.html">$sig</a>, <a class="var it30060" onMouseOver="hilite(30060)" onMouseOut="lolite()" onClick="logVariable('privatekey')" href="../_variables/privatekey.html">$privatekey</a>); <span class="comment">// TODO: On failure?</span>
<a name="l204"><span class="linenum"> 204</span></a>  
<a name="l205"><span class="linenum"> 205</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;
<a name="l206"><span class="linenum"> 206</span></a>      &lt;signedMessage&gt;
<a name="l207"><span class="linenum"> 207</span></a>          &lt;Signature Id=&quot;MoodleSignature&quot; xmlns=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;
<a name="l208"><span class="linenum"> 208</span></a>              &lt;SignedInfo&gt;
<a name="l209"><span class="linenum"> 209</span></a>                  &lt;CanonicalizationMethod Algorithm=&quot;http://www.w3.org/TR/2001/REC-xml-c14n-20010315&quot;/&gt;
<a name="l210"><span class="linenum"> 210</span></a>                  &lt;SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot;/&gt;
<a name="l211"><span class="linenum"> 211</span></a>                  &lt;Reference URI=&quot;#XMLRPC-MSG&quot;&gt;
<a name="l212"><span class="linenum"> 212</span></a>                      &lt;DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;/&gt;
<a name="l213"><span class="linenum"> 213</span></a>                      &lt;DigestValue&gt;'.<a class="var it23832" onMouseOver="hilite(23832)" onMouseOut="lolite()" onClick="logVariable('digest')" href="../_variables/digest.html">$digest</a>.'&lt;/DigestValue&gt;
<a name="l214"><span class="linenum"> 214</span></a>                  &lt;/Reference&gt;
<a name="l215"><span class="linenum"> 215</span></a>              &lt;/SignedInfo&gt;
<a name="l216"><span class="linenum"> 216</span></a>              &lt;SignatureValue&gt;'.<a class="phpfunction" onClick="logFunction('base64_encode')" href="../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="var it12063" onMouseOver="hilite(12063)" onMouseOut="lolite()" onClick="logVariable('sig')" href="../_variables/sig.html">$sig</a>).'&lt;/SignatureValue&gt;
<a name="l217"><span class="linenum"> 217</span></a>              &lt;KeyInfo&gt;
<a name="l218"><span class="linenum"> 218</span></a>                  &lt;RetrievalMethod URI=&quot;'.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>.'/mnet/publickey.php&quot;/&gt;
<a name="l219"><span class="linenum"> 219</span></a>              &lt;/KeyInfo&gt;
<a name="l220"><span class="linenum"> 220</span></a>          &lt;/Signature&gt;
<a name="l221"><span class="linenum"> 221</span></a>          &lt;object ID=&quot;XMLRPC-MSG&quot;&gt;'.<a class="phpfunction" onClick="logFunction('base64_encode')" href="../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>).'&lt;/object&gt;
<a name="l222"><span class="linenum"> 222</span></a>          &lt;wwwroot&gt;'.<a class="var it1357" onMouseOver="hilite(1357)" onMouseOut="lolite()" onClick="logVariable('mnet')" href="../_variables/mnet.html">$mnet</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it45251" onMouseOver="hilite(45251)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>.'&lt;/wwwroot&gt;
<a name="l223"><span class="linenum"> 223</span></a>          &lt;timestamp&gt;'.<a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>().'&lt;/timestamp&gt;
<a name="l224"><span class="linenum"> 224</span></a>      &lt;/signedMessage&gt;';
<a name="l225"><span class="linenum"> 225</span></a>      return <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>;
<a name="l226"><span class="linenum"> 226</span></a>  }
<a name="l227"><span class="linenum"> 227</span></a>  
<a name="l228"><span class="linenum"> 228</span></a>  <span class="comment">/**</span>
<a name="l229"><span class="linenum"> 229</span></a>  <span class="comment"> * Encrypt a message and return it in an XML-Encrypted document</span>
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment"> *</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment"> * This function can encrypt any content, but it was written to provide a system</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment"> * of encrypting XML-RPC request and response messages. The message will be</span>
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment"> * base64 encoded, so it does not need to be text - binary data should work.</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment"> *</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment"> * We compute the SHA1 digest of the message.</span>
<a name="l236"><span class="linenum"> 236</span></a>  <span class="comment"> * We compute a signature on that digest with our private key.</span>
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment"> * We link to the public key that can be used to verify our signature.</span>
<a name="l238"><span class="linenum"> 238</span></a>  <span class="comment"> * We base64 the message data.</span>
<a name="l239"><span class="linenum"> 239</span></a>  <span class="comment"> * We identify our wwwroot - this must match our certificate's CN</span>
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment"> *</span>
<a name="l241"><span class="linenum"> 241</span></a>  <span class="comment"> * The XML-RPC document will be parceled inside an XML-SIG document, which holds</span>
<a name="l242"><span class="linenum"> 242</span></a>  <span class="comment"> * the base64_encoded XML as an object, the SHA1 digest of that document, and a</span>
<a name="l243"><span class="linenum"> 243</span></a>  <span class="comment"> * signature of that document using the local private key. This signature will</span>
<a name="l244"><span class="linenum"> 244</span></a>  <span class="comment"> * uniquely identify the RPC document as having come from this server.</span>
<a name="l245"><span class="linenum"> 245</span></a>  <span class="comment"> *</span>
<a name="l246"><span class="linenum"> 246</span></a>  <span class="comment"> * See the {@Link http://www.w3.org/TR/xmlenc-core/ XML-ENC spec} at the W3c</span>
<a name="l247"><span class="linenum"> 247</span></a>  <span class="comment"> * site</span>
<a name="l248"><span class="linenum"> 248</span></a>  <span class="comment"> *</span>
<a name="l249"><span class="linenum"> 249</span></a>  <span class="comment"> * @param  string   $message              The data you want to sign</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment"> * @param  string   $remote_certificate   Peer's certificate in PEM format</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment"> * @return string                         An XML-ENC document</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment"> */</span>
<a name="l253"><span class="linenum"> 253</span></a>  function <a class="function" onClick="logFunction('mnet_encrypt_message')" href="../_functions/mnet_encrypt_message.html" onMouseOver="funcPopup(event,'mnet_encrypt_message')">mnet_encrypt_message</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it34128" onMouseOver="hilite(34128)" onMouseOut="lolite()" onClick="logVariable('remote_certificate')" href="../_variables/remote_certificate.html">$remote_certificate</a>) {
<a name="l254"><span class="linenum"> 254</span></a>      <a class="var it1357" onMouseOver="hilite(1357)" onMouseOut="lolite()" onClick="logVariable('mnet')" href="../_variables/mnet.html">$mnet</a> = <a class="function" onClick="logFunction('get_mnet_environment')" href="../_functions/get_mnet_environment.html" onMouseOver="funcPopup(event,'get_mnet_environment')">get_mnet_environment</a>();
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment">    // Generate a key resource from the remote_certificate text string</span>
<a name="l257"><span class="linenum"> 257</span></a>      <a class="var it34129" onMouseOver="hilite(34129)" onMouseOut="lolite()" onClick="logVariable('publickey')" href="../_variables/publickey.html">$publickey</a> = openssl_get_publickey(<a class="var it34128" onMouseOver="hilite(34128)" onMouseOut="lolite()" onClick="logVariable('remote_certificate')" href="../_variables/remote_certificate.html">$remote_certificate</a>);
<a name="l258"><span class="linenum"> 258</span></a>  
<a name="l259"><span class="linenum"> 259</span></a>      if ( <a class="phpfunction" onClick="logFunction('gettype')" href="../_functions/gettype.html" onMouseOver="phpfuncPopup(event,'gettype')">gettype</a>(<a class="var it34129" onMouseOver="hilite(34129)" onMouseOut="lolite()" onClick="logVariable('publickey')" href="../_variables/publickey.html">$publickey</a>) != 'resource' ) {
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment">        // Remote certificate is faulty.</span>
<a name="l261"><span class="linenum"> 261</span></a>          return false;
<a name="l262"><span class="linenum"> 262</span></a>      }
<a name="l263"><span class="linenum"> 263</span></a>  
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">    // Initialize vars</span>
<a name="l265"><span class="linenum"> 265</span></a>      <a class="var it34130" onMouseOver="hilite(34130)" onMouseOut="lolite()" onClick="logVariable('encryptedstring')" href="../_variables/encryptedstring.html">$encryptedstring</a> = '';
<a name="l266"><span class="linenum"> 266</span></a>      <a class="var it34131" onMouseOver="hilite(34131)" onMouseOut="lolite()" onClick="logVariable('symmetric_keys')" href="../_variables/symmetric_keys.html">$symmetric_keys</a> = array();
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>  <span class="comment">    //        passed by ref -&gt;     &amp;$encryptedstring &amp;$symmetric_keys</span>
<a name="l269"><span class="linenum"> 269</span></a>      <a class="var it7116" onMouseOver="hilite(7116)" onMouseOut="lolite()" onClick="logVariable('bool')" href="../_variables/bool.html">$bool</a> = <a class="phpfunction" onClick="logFunction('openssl_seal')" href="../_functions/openssl_seal.html" onMouseOver="phpfuncPopup(event,'openssl_seal')">openssl_seal</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it34130" onMouseOver="hilite(34130)" onMouseOut="lolite()" onClick="logVariable('encryptedstring')" href="../_variables/encryptedstring.html">$encryptedstring</a>, <a class="var it34131" onMouseOver="hilite(34131)" onMouseOut="lolite()" onClick="logVariable('symmetric_keys')" href="../_variables/symmetric_keys.html">$symmetric_keys</a>, array(<a class="var it34129" onMouseOver="hilite(34129)" onMouseOut="lolite()" onClick="logVariable('publickey')" href="../_variables/publickey.html">$publickey</a>));
<a name="l270"><span class="linenum"> 270</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="var it34130" onMouseOver="hilite(34130)" onMouseOut="lolite()" onClick="logVariable('encryptedstring')" href="../_variables/encryptedstring.html">$encryptedstring</a>;
<a name="l271"><span class="linenum"> 271</span></a>      <a class="var it34132" onMouseOver="hilite(34132)" onMouseOut="lolite()" onClick="logVariable('symmetrickey')" href="../_variables/symmetrickey.html">$symmetrickey</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it34131" onMouseOver="hilite(34131)" onMouseOut="lolite()" onClick="logVariable('symmetric_keys')" href="../_variables/symmetric_keys.html">$symmetric_keys</a>);
<a name="l272"><span class="linenum"> 272</span></a>  
<a name="l273"><span class="linenum"> 273</span></a>      <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;
<a name="l274"><span class="linenum"> 274</span></a>      &lt;encryptedMessage&gt;
<a name="l275"><span class="linenum"> 275</span></a>          &lt;EncryptedData Id=&quot;ED&quot; xmlns=&quot;http://www.w3.org/2001/04/xmlenc#&quot;&gt;
<a name="l276"><span class="linenum"> 276</span></a>              &lt;EncryptionMethod Algorithm=&quot;http://www.w3.org/2001/04/xmlenc#arcfour&quot;/&gt;
<a name="l277"><span class="linenum"> 277</span></a>              &lt;ds:KeyInfo xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;
<a name="l278"><span class="linenum"> 278</span></a>                  &lt;ds:RetrievalMethod URI=&quot;#EK&quot; Type=&quot;http://www.w3.org/2001/04/xmlenc#EncryptedKey&quot;/&gt;
<a name="l279"><span class="linenum"> 279</span></a>                  &lt;ds:KeyName&gt;XMLENC&lt;/ds:KeyName&gt;
<a name="l280"><span class="linenum"> 280</span></a>              &lt;/ds:KeyInfo&gt;
<a name="l281"><span class="linenum"> 281</span></a>              &lt;CipherData&gt;
<a name="l282"><span class="linenum"> 282</span></a>                  &lt;CipherValue&gt;'.<a class="phpfunction" onClick="logFunction('base64_encode')" href="../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>).'&lt;/CipherValue&gt;
<a name="l283"><span class="linenum"> 283</span></a>              &lt;/CipherData&gt;
<a name="l284"><span class="linenum"> 284</span></a>          &lt;/EncryptedData&gt;
<a name="l285"><span class="linenum"> 285</span></a>          &lt;EncryptedKey Id=&quot;EK&quot; xmlns=&quot;http://www.w3.org/2001/04/xmlenc#&quot;&gt;
<a name="l286"><span class="linenum"> 286</span></a>              &lt;EncryptionMethod Algorithm=&quot;http://www.w3.org/2001/04/xmlenc#rsa-1_5&quot;/&gt;
<a name="l287"><span class="linenum"> 287</span></a>              &lt;ds:KeyInfo xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;
<a name="l288"><span class="linenum"> 288</span></a>                  &lt;ds:KeyName&gt;SSLKEY&lt;/ds:KeyName&gt;
<a name="l289"><span class="linenum"> 289</span></a>              &lt;/ds:KeyInfo&gt;
<a name="l290"><span class="linenum"> 290</span></a>              &lt;CipherData&gt;
<a name="l291"><span class="linenum"> 291</span></a>                  &lt;CipherValue&gt;'.<a class="phpfunction" onClick="logFunction('base64_encode')" href="../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="var it34132" onMouseOver="hilite(34132)" onMouseOut="lolite()" onClick="logVariable('symmetrickey')" href="../_variables/symmetrickey.html">$symmetrickey</a>).'&lt;/CipherValue&gt;
<a name="l292"><span class="linenum"> 292</span></a>              &lt;/CipherData&gt;
<a name="l293"><span class="linenum"> 293</span></a>              &lt;ReferenceList&gt;
<a name="l294"><span class="linenum"> 294</span></a>                  &lt;DataReference URI=&quot;#ED&quot;/&gt;
<a name="l295"><span class="linenum"> 295</span></a>              &lt;/ReferenceList&gt;
<a name="l296"><span class="linenum"> 296</span></a>              &lt;CarriedKeyName&gt;XMLENC&lt;/CarriedKeyName&gt;
<a name="l297"><span class="linenum"> 297</span></a>          &lt;/EncryptedKey&gt;
<a name="l298"><span class="linenum"> 298</span></a>          &lt;wwwroot&gt;'.<a class="var it1357" onMouseOver="hilite(1357)" onMouseOut="lolite()" onClick="logVariable('mnet')" href="../_variables/mnet.html">$mnet</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it45251" onMouseOver="hilite(45251)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>.'&lt;/wwwroot&gt;
<a name="l299"><span class="linenum"> 299</span></a>      &lt;/encryptedMessage&gt;';
<a name="l300"><span class="linenum"> 300</span></a>      return <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>;
<a name="l301"><span class="linenum"> 301</span></a>  }
<a name="l302"><span class="linenum"> 302</span></a>  
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment">/**</span>
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment"> * Get your SSL keys from the database, or create them (if they don't exist yet)</span>
<a name="l305"><span class="linenum"> 305</span></a>  <span class="comment"> *</span>
<a name="l306"><span class="linenum"> 306</span></a>  <span class="comment"> * Get your SSL keys from the database, or (if they don't exist yet) call</span>
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment"> * mnet_generate_keypair to create them</span>
<a name="l308"><span class="linenum"> 308</span></a>  <span class="comment"> *</span>
<a name="l309"><span class="linenum"> 309</span></a>  <span class="comment"> * @param   string  $string     The text you want to sign</span>
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment"> * @return  string              The signature over that text</span>
<a name="l311"><span class="linenum"> 311</span></a>  <span class="comment"> */</span>
<a name="l312"><span class="linenum"> 312</span></a>  function <a class="function" onClick="logFunction('mnet_get_keypair')" href="../_functions/mnet_get_keypair.html" onMouseOver="funcPopup(event,'mnet_get_keypair')">mnet_get_keypair</a>() {
<a name="l313"><span class="linenum"> 313</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l314"><span class="linenum"> 314</span></a>      static <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a> = null;
<a name="l315"><span class="linenum"> 315</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>)) return <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>;
<a name="l316"><span class="linenum"> 316</span></a>      if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('mnet', 'openssl')) {
<a name="l317"><span class="linenum"> 317</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>['certificate'], <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>['keypair_PEM']) = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('@@@@@@@@', <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>);
<a name="l318"><span class="linenum"> 318</span></a>          <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>['privatekey'] = <a class="phpfunction" onClick="logFunction('openssl_pkey_get_private')" href="../_functions/openssl_pkey_get_private.html" onMouseOver="phpfuncPopup(event,'openssl_pkey_get_private')">openssl_pkey_get_private</a>(<a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>['keypair_PEM']);
<a name="l319"><span class="linenum"> 319</span></a>          <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>['publickey']  = <a class="phpfunction" onClick="logFunction('openssl_pkey_get_public')" href="../_functions/openssl_pkey_get_public.html" onMouseOver="phpfuncPopup(event,'openssl_pkey_get_public')">openssl_pkey_get_public</a>(<a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>['certificate']);
<a name="l320"><span class="linenum"> 320</span></a>          return <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>;
<a name="l321"><span class="linenum"> 321</span></a>      } else {
<a name="l322"><span class="linenum"> 322</span></a>          <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a> = <a class="function" onClick="logFunction('mnet_generate_keypair')" href="../_functions/mnet_generate_keypair.html" onMouseOver="funcPopup(event,'mnet_generate_keypair')">mnet_generate_keypair</a>();
<a name="l323"><span class="linenum"> 323</span></a>          return <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>;
<a name="l324"><span class="linenum"> 324</span></a>      }
<a name="l325"><span class="linenum"> 325</span></a>  }
<a name="l326"><span class="linenum"> 326</span></a>  
<a name="l327"><span class="linenum"> 327</span></a>  <span class="comment">/**</span>
<a name="l328"><span class="linenum"> 328</span></a>  <span class="comment"> * Generate public/private keys and store in the config table</span>
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment"> *</span>
<a name="l330"><span class="linenum"> 330</span></a>  <span class="comment"> * Use the distinguished name provided to create a CSR, and then sign that CSR</span>
<a name="l331"><span class="linenum"> 331</span></a>  <span class="comment"> * with the same credentials. Store the keypair you create in the config table.</span>
<a name="l332"><span class="linenum"> 332</span></a>  <span class="comment"> * If a distinguished name is not provided, create one using the fullname of</span>
<a name="l333"><span class="linenum"> 333</span></a>  <span class="comment"> * 'the course with ID 1' as your organization name, and your hostname (as</span>
<a name="l334"><span class="linenum"> 334</span></a>  <span class="comment"> * detailed in $CFG-&gt;wwwroot).</span>
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment"> *</span>
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment"> * @param   array  $dn  The distinguished name of the server</span>
<a name="l337"><span class="linenum"> 337</span></a>  <span class="comment"> * @return  string      The signature over that text</span>
<a name="l338"><span class="linenum"> 338</span></a>  <span class="comment"> */</span>
<a name="l339"><span class="linenum"> 339</span></a>  function <a class="function" onClick="logFunction('mnet_generate_keypair')" href="../_functions/mnet_generate_keypair.html" onMouseOver="funcPopup(event,'mnet_generate_keypair')">mnet_generate_keypair</a>(<a class="var it2742" onMouseOver="hilite(2742)" onMouseOut="lolite()" onClick="logVariable('dn')" href="../_variables/dn.html">$dn</a> = null, <a class="var it1754" onMouseOver="hilite(1754)" onMouseOut="lolite()" onClick="logVariable('days')" href="../_variables/days.html">$days</a>=28) {
<a name="l340"><span class="linenum"> 340</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l341"><span class="linenum"> 341</span></a>  
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment">    // check if lifetime has been overriden</span>
<a name="l343"><span class="linenum"> 343</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnetkeylifetime')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/mnetkeylifetime.html">mnetkeylifetime</a>)) {
<a name="l344"><span class="linenum"> 344</span></a>          <a class="var it1754" onMouseOver="hilite(1754)" onMouseOut="lolite()" onClick="logVariable('days')" href="../_variables/days.html">$days</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnetkeylifetime')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/mnetkeylifetime.html">mnetkeylifetime</a>;
<a name="l345"><span class="linenum"> 345</span></a>      }
<a name="l346"><span class="linenum"> 346</span></a>  
<a name="l347"><span class="linenum"> 347</span></a>      <a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a> = <a class="phpfunction" onClick="logFunction('strtolower')" href="../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>);
<a name="l348"><span class="linenum"> 348</span></a>      <a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>(&quot;~^http(s)?://~&quot;,'',<a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a>);
<a name="l349"><span class="linenum"> 349</span></a>      <a class="var it144" onMouseOver="hilite(144)" onMouseOut="lolite()" onClick="logVariable('break')" href="../_variables/break.html">$break</a> = <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a>.'/' , '/');
<a name="l350"><span class="linenum"> 350</span></a>      <a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a>   = <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a>, 0, <a class="var it144" onMouseOver="hilite(144)" onMouseOut="lolite()" onClick="logVariable('break')" href="../_variables/break.html">$break</a>);
<a name="l351"><span class="linenum"> 351</span></a>  
<a name="l352"><span class="linenum"> 352</span></a>      <a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../_variables/site.html">$site</a> = <a class="function" onClick="logFunction('get_site')" href="../_functions/get_site.html" onMouseOver="funcPopup(event,'get_site')">get_site</a>();
<a name="l353"><span class="linenum"> 353</span></a>      <a class="var it7989" onMouseOver="hilite(7989)" onMouseOut="lolite()" onClick="logVariable('organization')" href="../_variables/organization.html">$organization</a> = <a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('fullname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>;
<a name="l354"><span class="linenum"> 354</span></a>  
<a name="l355"><span class="linenum"> 355</span></a>      <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a> = array();
<a name="l356"><span class="linenum"> 356</span></a>  
<a name="l357"><span class="linenum"> 357</span></a>      <a class="var it2002" onMouseOver="hilite(2002)" onMouseOut="lolite()" onClick="logVariable('country')" href="../_variables/country.html">$country</a>  = 'NZ';
<a name="l358"><span class="linenum"> 358</span></a>      <a class="var it34134" onMouseOver="hilite(34134)" onMouseOut="lolite()" onClick="logVariable('province')" href="../_variables/province.html">$province</a> = 'Wellington';
<a name="l359"><span class="linenum"> 359</span></a>      <a class="var it8237" onMouseOver="hilite(8237)" onMouseOut="lolite()" onClick="logVariable('locality')" href="../_variables/locality.html">$locality</a> = 'Wellington';
<a name="l360"><span class="linenum"> 360</span></a>      <a class="var it374" onMouseOver="hilite(374)" onMouseOut="lolite()" onClick="logVariable('email')" href="../_variables/email.html">$email</a>    = !empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('noreplyaddress')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/noreplyaddress.html">noreplyaddress</a>) ? <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('noreplyaddress')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/noreplyaddress.html">noreplyaddress</a> : 'noreply@'.<a class="var it836" onMouseOver="hilite(836)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../_variables/_SERVER.html">$_SERVER</a>['HTTP_HOST'];
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>      if(!empty(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('country')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/country.html">country</a>)) {
<a name="l363"><span class="linenum"> 363</span></a>          <a class="var it2002" onMouseOver="hilite(2002)" onMouseOut="lolite()" onClick="logVariable('country')" href="../_variables/country.html">$country</a>  = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('country')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/country.html">country</a>;
<a name="l364"><span class="linenum"> 364</span></a>      }
<a name="l365"><span class="linenum"> 365</span></a>      if(!empty(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('city')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/city.html">city</a>)) {
<a name="l366"><span class="linenum"> 366</span></a>          <a class="var it34134" onMouseOver="hilite(34134)" onMouseOut="lolite()" onClick="logVariable('province')" href="../_variables/province.html">$province</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('city')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/city.html">city</a>;
<a name="l367"><span class="linenum"> 367</span></a>          <a class="var it8237" onMouseOver="hilite(8237)" onMouseOut="lolite()" onClick="logVariable('locality')" href="../_variables/locality.html">$locality</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('city')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/city.html">city</a>;
<a name="l368"><span class="linenum"> 368</span></a>      }
<a name="l369"><span class="linenum"> 369</span></a>      if(!empty(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('email')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/email.html">email</a>)) {
<a name="l370"><span class="linenum"> 370</span></a>          <a class="var it374" onMouseOver="hilite(374)" onMouseOut="lolite()" onClick="logVariable('email')" href="../_variables/email.html">$email</a>    = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('email')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/email.html">email</a>;
<a name="l371"><span class="linenum"> 371</span></a>      }
<a name="l372"><span class="linenum"> 372</span></a>  
<a name="l373"><span class="linenum"> 373</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it2742" onMouseOver="hilite(2742)" onMouseOut="lolite()" onClick="logVariable('dn')" href="../_variables/dn.html">$dn</a>)) {
<a name="l374"><span class="linenum"> 374</span></a>          <a class="var it2742" onMouseOver="hilite(2742)" onMouseOut="lolite()" onClick="logVariable('dn')" href="../_variables/dn.html">$dn</a> = array(
<a name="l375"><span class="linenum"> 375</span></a>             &quot;countryName&quot; =&gt; <a class="var it2002" onMouseOver="hilite(2002)" onMouseOut="lolite()" onClick="logVariable('country')" href="../_variables/country.html">$country</a>,
<a name="l376"><span class="linenum"> 376</span></a>             &quot;stateOrProvinceName&quot; =&gt; <a class="var it34134" onMouseOver="hilite(34134)" onMouseOut="lolite()" onClick="logVariable('province')" href="../_variables/province.html">$province</a>,
<a name="l377"><span class="linenum"> 377</span></a>             &quot;localityName&quot; =&gt; <a class="var it8237" onMouseOver="hilite(8237)" onMouseOut="lolite()" onClick="logVariable('locality')" href="../_variables/locality.html">$locality</a>,
<a name="l378"><span class="linenum"> 378</span></a>             &quot;organizationName&quot; =&gt; <a class="var it7989" onMouseOver="hilite(7989)" onMouseOut="lolite()" onClick="logVariable('organization')" href="../_variables/organization.html">$organization</a>,
<a name="l379"><span class="linenum"> 379</span></a>             &quot;organizationalUnitName&quot; =&gt; 'Moodle',
<a name="l380"><span class="linenum"> 380</span></a>             &quot;commonName&quot; =&gt; <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>, 0, 64),
<a name="l381"><span class="linenum"> 381</span></a>             &quot;subjectAltName&quot; =&gt; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>,
<a name="l382"><span class="linenum"> 382</span></a>             &quot;emailAddress&quot; =&gt; <a class="var it374" onMouseOver="hilite(374)" onMouseOut="lolite()" onClick="logVariable('email')" href="../_variables/email.html">$email</a>
<a name="l383"><span class="linenum"> 383</span></a>          );
<a name="l384"><span class="linenum"> 384</span></a>      }
<a name="l385"><span class="linenum"> 385</span></a>  
<a name="l386"><span class="linenum"> 386</span></a>      <a class="var it34135" onMouseOver="hilite(34135)" onMouseOut="lolite()" onClick="logVariable('dnlimits')" href="../_variables/dnlimits.html">$dnlimits</a> = array(
<a name="l387"><span class="linenum"> 387</span></a>             'countryName'            =&gt; 2,
<a name="l388"><span class="linenum"> 388</span></a>             'stateOrProvinceName'    =&gt; 128,
<a name="l389"><span class="linenum"> 389</span></a>             'localityName'           =&gt; 128,
<a name="l390"><span class="linenum"> 390</span></a>             'organizationName'       =&gt; 64,
<a name="l391"><span class="linenum"> 391</span></a>             'organizationalUnitName' =&gt; 64,
<a name="l392"><span class="linenum"> 392</span></a>             'commonName'             =&gt; 64,
<a name="l393"><span class="linenum"> 393</span></a>             'emailAddress'           =&gt; 128
<a name="l394"><span class="linenum"> 394</span></a>      );
<a name="l395"><span class="linenum"> 395</span></a>  
<a name="l396"><span class="linenum"> 396</span></a>      foreach (<a class="var it34135" onMouseOver="hilite(34135)" onMouseOut="lolite()" onClick="logVariable('dnlimits')" href="../_variables/dnlimits.html">$dnlimits</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> =&gt; <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('length')" href="../_variables/length.html">$length</a>) {
<a name="l397"><span class="linenum"> 397</span></a>          <a class="var it2742" onMouseOver="hilite(2742)" onMouseOut="lolite()" onClick="logVariable('dn')" href="../_variables/dn.html">$dn</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>] = <a class="class" onClick="logClass('core_text')" href="../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it2742" onMouseOver="hilite(2742)" onMouseOut="lolite()" onClick="logVariable('dn')" href="../_variables/dn.html">$dn</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>], 0, <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('length')" href="../_variables/length.html">$length</a>);
<a name="l398"><span class="linenum"> 398</span></a>      }
<a name="l399"><span class="linenum"> 399</span></a>  
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment">    // ensure we remove trailing slashes</span>
<a name="l401"><span class="linenum"> 401</span></a>      <a class="var it2742" onMouseOver="hilite(2742)" onMouseOut="lolite()" onClick="logVariable('dn')" href="../_variables/dn.html">$dn</a>[&quot;commonName&quot;] = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>(':/$:', '', <a class="var it2742" onMouseOver="hilite(2742)" onMouseOut="lolite()" onClick="logVariable('dn')" href="../_variables/dn.html">$dn</a>[&quot;commonName&quot;]);
<a name="l402"><span class="linenum"> 402</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('opensslcnf')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/opensslcnf.html">opensslcnf</a>)) { //allow specification of openssl.cnf especially for Windows installs
<a name="l403"><span class="linenum"> 403</span></a>          <a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a> = <a class="phpfunction" onClick="logFunction('openssl_pkey_new')" href="../_functions/openssl_pkey_new.html" onMouseOver="phpfuncPopup(event,'openssl_pkey_new')">openssl_pkey_new</a>(array(&quot;config&quot; =&gt; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('opensslcnf')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/opensslcnf.html">opensslcnf</a>));
<a name="l404"><span class="linenum"> 404</span></a>      } else {
<a name="l405"><span class="linenum"> 405</span></a>          <a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a> = <a class="phpfunction" onClick="logFunction('openssl_pkey_new')" href="../_functions/openssl_pkey_new.html" onMouseOver="phpfuncPopup(event,'openssl_pkey_new')">openssl_pkey_new</a>();
<a name="l406"><span class="linenum"> 406</span></a>      }
<a name="l407"><span class="linenum"> 407</span></a>      if (<a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a> === false) {
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment">        // can not generate keys - missing openssl.cnf??</span>
<a name="l409"><span class="linenum"> 409</span></a>          return null;
<a name="l410"><span class="linenum"> 410</span></a>      }
<a name="l411"><span class="linenum"> 411</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('opensslcnf')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/opensslcnf.html">opensslcnf</a>)) { //allow specification of openssl.cnf especially for Windows installs
<a name="l412"><span class="linenum"> 412</span></a>          <a class="var it34137" onMouseOver="hilite(34137)" onMouseOut="lolite()" onClick="logVariable('csr_rsc')" href="../_variables/csr_rsc.html">$csr_rsc</a> = <a class="phpfunction" onClick="logFunction('openssl_csr_new')" href="../_functions/openssl_csr_new.html" onMouseOver="phpfuncPopup(event,'openssl_csr_new')">openssl_csr_new</a>(<a class="var it2742" onMouseOver="hilite(2742)" onMouseOut="lolite()" onClick="logVariable('dn')" href="../_variables/dn.html">$dn</a>, <a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a>, array(&quot;config&quot; =&gt; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('opensslcnf')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/opensslcnf.html">opensslcnf</a>));
<a name="l413"><span class="linenum"> 413</span></a>          <a class="var it34138" onMouseOver="hilite(34138)" onMouseOut="lolite()" onClick="logVariable('selfSignedCert')" href="../_variables/selfSignedCert.html">$selfSignedCert</a> = <a class="phpfunction" onClick="logFunction('openssl_csr_sign')" href="../_functions/openssl_csr_sign.html" onMouseOver="phpfuncPopup(event,'openssl_csr_sign')">openssl_csr_sign</a>(<a class="var it34137" onMouseOver="hilite(34137)" onMouseOut="lolite()" onClick="logVariable('csr_rsc')" href="../_variables/csr_rsc.html">$csr_rsc</a>, null, <a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a>, <a class="var it1754" onMouseOver="hilite(1754)" onMouseOut="lolite()" onClick="logVariable('days')" href="../_variables/days.html">$days</a>, array(&quot;config&quot; =&gt; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('opensslcnf')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/opensslcnf.html">opensslcnf</a>));
<a name="l414"><span class="linenum"> 414</span></a>      } else {
<a name="l415"><span class="linenum"> 415</span></a>          <a class="var it34137" onMouseOver="hilite(34137)" onMouseOut="lolite()" onClick="logVariable('csr_rsc')" href="../_variables/csr_rsc.html">$csr_rsc</a> = <a class="phpfunction" onClick="logFunction('openssl_csr_new')" href="../_functions/openssl_csr_new.html" onMouseOver="phpfuncPopup(event,'openssl_csr_new')">openssl_csr_new</a>(<a class="var it2742" onMouseOver="hilite(2742)" onMouseOut="lolite()" onClick="logVariable('dn')" href="../_variables/dn.html">$dn</a>, <a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a>, array('private_key_bits',2048));
<a name="l416"><span class="linenum"> 416</span></a>          <a class="var it34138" onMouseOver="hilite(34138)" onMouseOut="lolite()" onClick="logVariable('selfSignedCert')" href="../_variables/selfSignedCert.html">$selfSignedCert</a> = <a class="phpfunction" onClick="logFunction('openssl_csr_sign')" href="../_functions/openssl_csr_sign.html" onMouseOver="phpfuncPopup(event,'openssl_csr_sign')">openssl_csr_sign</a>(<a class="var it34137" onMouseOver="hilite(34137)" onMouseOut="lolite()" onClick="logVariable('csr_rsc')" href="../_variables/csr_rsc.html">$csr_rsc</a>, null, <a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a>, <a class="var it1754" onMouseOver="hilite(1754)" onMouseOut="lolite()" onClick="logVariable('days')" href="../_variables/days.html">$days</a>);
<a name="l417"><span class="linenum"> 417</span></a>      }
<a name="l418"><span class="linenum"> 418</span></a>      unset(<a class="var it34137" onMouseOver="hilite(34137)" onMouseOut="lolite()" onClick="logVariable('csr_rsc')" href="../_variables/csr_rsc.html">$csr_rsc</a>); <span class="comment">// Free up the resource</span>
<a name="l419"><span class="linenum"> 419</span></a>  
<a name="l420"><span class="linenum"> 420</span></a>  <span class="comment">    // We export our self-signed certificate to a string.</span>
<a name="l421"><span class="linenum"> 421</span></a>      <a class="phpfunction" onClick="logFunction('openssl_x509_export')" href="../_functions/openssl_x509_export.html" onMouseOver="phpfuncPopup(event,'openssl_x509_export')">openssl_x509_export</a>(<a class="var it34138" onMouseOver="hilite(34138)" onMouseOut="lolite()" onClick="logVariable('selfSignedCert')" href="../_variables/selfSignedCert.html">$selfSignedCert</a>, <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>['certificate']);
<a name="l422"><span class="linenum"> 422</span></a>      <a class="phpfunction" onClick="logFunction('openssl_x509_free')" href="../_functions/openssl_x509_free.html" onMouseOver="phpfuncPopup(event,'openssl_x509_free')">openssl_x509_free</a>(<a class="var it34138" onMouseOver="hilite(34138)" onMouseOut="lolite()" onClick="logVariable('selfSignedCert')" href="../_variables/selfSignedCert.html">$selfSignedCert</a>);
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>  <span class="comment">    // Export your public/private key pair as a PEM encoded string. You</span>
<a name="l425"><span class="linenum"> 425</span></a>  <span class="comment">    // can protect it with an optional passphrase if you wish.</span>
<a name="l426"><span class="linenum"> 426</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('opensslcnf')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/opensslcnf.html">opensslcnf</a>)) { //allow specification of openssl.cnf especially for Windows installs
<a name="l427"><span class="linenum"> 427</span></a>          <a class="var it4296" onMouseOver="hilite(4296)" onMouseOut="lolite()" onClick="logVariable('export')" href="../_variables/export.html">$export</a> = <a class="phpfunction" onClick="logFunction('openssl_pkey_export')" href="../_functions/openssl_pkey_export.html" onMouseOver="phpfuncPopup(event,'openssl_pkey_export')">openssl_pkey_export</a>(<a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a>, <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>['keypair_PEM'], null, array(&quot;config&quot; =&gt; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('opensslcnf')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/opensslcnf.html">opensslcnf</a>));
<a name="l428"><span class="linenum"> 428</span></a>      } else {
<a name="l429"><span class="linenum"> 429</span></a>          <a class="var it4296" onMouseOver="hilite(4296)" onMouseOut="lolite()" onClick="logVariable('export')" href="../_variables/export.html">$export</a> = <a class="phpfunction" onClick="logFunction('openssl_pkey_export')" href="../_functions/openssl_pkey_export.html" onMouseOver="phpfuncPopup(event,'openssl_pkey_export')">openssl_pkey_export</a>(<a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a>, <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>['keypair_PEM'] <span class="comment">/* , $passphrase */</span>);
<a name="l430"><span class="linenum"> 430</span></a>      }
<a name="l431"><span class="linenum"> 431</span></a>      <a class="phpfunction" onClick="logFunction('openssl_pkey_free')" href="../_functions/openssl_pkey_free.html" onMouseOver="phpfuncPopup(event,'openssl_pkey_free')">openssl_pkey_free</a>(<a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a>);
<a name="l432"><span class="linenum"> 432</span></a>      unset(<a class="var it2451" onMouseOver="hilite(2451)" onMouseOut="lolite()" onClick="logVariable('new_key')" href="../_variables/new_key.html">$new_key</a>); <span class="comment">// Free up the resource</span>
<a name="l433"><span class="linenum"> 433</span></a>  
<a name="l434"><span class="linenum"> 434</span></a>      return <a class="var it2366" onMouseOver="hilite(2366)" onMouseOut="lolite()" onClick="logVariable('keypair')" href="../_variables/keypair.html">$keypair</a>;
<a name="l435"><span class="linenum"> 435</span></a>  }
<a name="l436"><span class="linenum"> 436</span></a>  
<a name="l437"><span class="linenum"> 437</span></a>  
<a name="l438"><span class="linenum"> 438</span></a>  function <a class="function" onClick="logFunction('mnet_update_sso_access_control')" href="../_functions/mnet_update_sso_access_control.html" onMouseOver="funcPopup(event,'mnet_update_sso_access_control')">mnet_update_sso_access_control</a>(<a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a>, <a class="var it2361" onMouseOver="hilite(2361)" onMouseOut="lolite()" onClick="logVariable('mnet_host_id')" href="../_variables/mnet_host_id.html">$mnet_host_id</a>, <a class="var it2362" onMouseOver="hilite(2362)" onMouseOut="lolite()" onClick="logVariable('accessctrl')" href="../_variables/accessctrl.html">$accessctrl</a>) {
<a name="l439"><span class="linenum"> 439</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l440"><span class="linenum"> 440</span></a>  
<a name="l441"><span class="linenum"> 441</span></a>      <a class="var it2359" onMouseOver="hilite(2359)" onMouseOut="lolite()" onClick="logVariable('mnethost')" href="../_variables/mnethost.html">$mnethost</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('mnet_host', array('id'=&gt;<a class="var it2361" onMouseOver="hilite(2361)" onMouseOut="lolite()" onClick="logVariable('mnet_host_id')" href="../_variables/mnet_host_id.html">$mnet_host_id</a>));
<a name="l442"><span class="linenum"> 442</span></a>      if (<a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('mnet_sso_access_control', array('username'=&gt;<a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a>, 'mnet_host_id'=&gt;<a class="var it2361" onMouseOver="hilite(2361)" onMouseOut="lolite()" onClick="logVariable('mnet_host_id')" href="../_variables/mnet_host_id.html">$mnet_host_id</a>))) {
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">        // Update.</span>
<a name="l444"><span class="linenum"> 444</span></a>          <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a>-&gt;<a onClick="logVariable('accessctrl')" class="var it43260" onMouseOver="hilite(43260)" onMouseOut="lolite()" href="../_variables/accessctrl.html">accessctrl</a> = <a class="var it2362" onMouseOver="hilite(2362)" onMouseOut="lolite()" onClick="logVariable('accessctrl')" href="../_variables/accessctrl.html">$accessctrl</a>;
<a name="l445"><span class="linenum"> 445</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('mnet_sso_access_control', <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a>);
<a name="l446"><span class="linenum"> 446</span></a>  
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">        // Trigger access control updated event.</span>
<a name="l448"><span class="linenum"> 448</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(
<a name="l449"><span class="linenum"> 449</span></a>              'objectid' =&gt; <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a>-&gt;<a onClick="logVariable('id')" class="var it43260" onMouseOver="hilite(43260)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l450"><span class="linenum"> 450</span></a>              'context' =&gt; <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(),
<a name="l451"><span class="linenum"> 451</span></a>              'other' =&gt; array(
<a name="l452"><span class="linenum"> 452</span></a>                  'username' =&gt; <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a>,
<a name="l453"><span class="linenum"> 453</span></a>                  'hostname' =&gt; <a class="var it2359" onMouseOver="hilite(2359)" onMouseOut="lolite()" onClick="logVariable('mnethost')" href="../_variables/mnethost.html">$mnethost</a>-&gt;<a onClick="logVariable('name')" class="var it43837" onMouseOver="hilite(43837)" onMouseOut="lolite()" href="../_variables/name.html">name</a>,
<a name="l454"><span class="linenum"> 454</span></a>                  'accessctrl' =&gt; <a class="var it2362" onMouseOver="hilite(2362)" onMouseOut="lolite()" onClick="logVariable('accessctrl')" href="../_variables/accessctrl.html">$accessctrl</a>
<a name="l455"><span class="linenum"> 455</span></a>              )
<a name="l456"><span class="linenum"> 456</span></a>          );
<a name="l457"><span class="linenum"> 457</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('mnet_access_control_updated')" href="../_classes/mnet_access_control_updated.html" onMouseOver="classPopup(event,'mnet_access_control_updated')">mnet_access_control_updated</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l458"><span class="linenum"> 458</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('mnet_host', <a class="var it2359" onMouseOver="hilite(2359)" onMouseOut="lolite()" onClick="logVariable('mnethost')" href="../_variables/mnethost.html">$mnethost</a>);
<a name="l459"><span class="linenum"> 459</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l460"><span class="linenum"> 460</span></a>      } else {
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">        // Insert.</span>
<a name="l462"><span class="linenum"> 462</span></a>          <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a> = new stdClass();
<a name="l463"><span class="linenum"> 463</span></a>          <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a>-&gt;<a onClick="logVariable('username')" class="var it43260" onMouseOver="hilite(43260)" onMouseOut="lolite()" href="../_variables/username.html">username</a> = <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a>;
<a name="l464"><span class="linenum"> 464</span></a>          <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a>-&gt;<a onClick="logVariable('accessctrl')" class="var it43260" onMouseOver="hilite(43260)" onMouseOut="lolite()" href="../_variables/accessctrl.html">accessctrl</a> = <a class="var it2362" onMouseOver="hilite(2362)" onMouseOut="lolite()" onClick="logVariable('accessctrl')" href="../_variables/accessctrl.html">$accessctrl</a>;
<a name="l465"><span class="linenum"> 465</span></a>          <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a>-&gt;<a onClick="logVariable('mnet_host_id')" class="var it43260" onMouseOver="hilite(43260)" onMouseOut="lolite()" href="../_variables/mnet_host_id.html">mnet_host_id</a> = <a class="var it2361" onMouseOver="hilite(2361)" onMouseOut="lolite()" onClick="logVariable('mnet_host_id')" href="../_variables/mnet_host_id.html">$mnet_host_id</a>;
<a name="l466"><span class="linenum"> 466</span></a>          <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a>-&gt;<a onClick="logVariable('id')" class="var it43260" onMouseOver="hilite(43260)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('mnet_sso_access_control', <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a>);
<a name="l467"><span class="linenum"> 467</span></a>  
<a name="l468"><span class="linenum"> 468</span></a>  <span class="comment">        // Trigger access control created event.</span>
<a name="l469"><span class="linenum"> 469</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(
<a name="l470"><span class="linenum"> 470</span></a>              'objectid' =&gt; <a class="var it19960" onMouseOver="hilite(19960)" onMouseOut="lolite()" onClick="logVariable('aclrecord')" href="../_variables/aclrecord.html">$aclrecord</a>-&gt;<a onClick="logVariable('id')" class="var it43260" onMouseOver="hilite(43260)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l471"><span class="linenum"> 471</span></a>              'context' =&gt; <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(),
<a name="l472"><span class="linenum"> 472</span></a>              'other' =&gt; array(
<a name="l473"><span class="linenum"> 473</span></a>                  'username' =&gt; <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a>,
<a name="l474"><span class="linenum"> 474</span></a>                  'hostname' =&gt; <a class="var it2359" onMouseOver="hilite(2359)" onMouseOut="lolite()" onClick="logVariable('mnethost')" href="../_variables/mnethost.html">$mnethost</a>-&gt;<a onClick="logVariable('name')" class="var it43837" onMouseOver="hilite(43837)" onMouseOut="lolite()" href="../_variables/name.html">name</a>,
<a name="l475"><span class="linenum"> 475</span></a>                  'accessctrl' =&gt; <a class="var it2362" onMouseOver="hilite(2362)" onMouseOut="lolite()" onClick="logVariable('accessctrl')" href="../_variables/accessctrl.html">$accessctrl</a>
<a name="l476"><span class="linenum"> 476</span></a>              )
<a name="l477"><span class="linenum"> 477</span></a>          );
<a name="l478"><span class="linenum"> 478</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('mnet_access_control_created')" href="../_classes/mnet_access_control_created.html" onMouseOver="classPopup(event,'mnet_access_control_created')">mnet_access_control_created</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l479"><span class="linenum"> 479</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('mnet_host', <a class="var it2359" onMouseOver="hilite(2359)" onMouseOut="lolite()" onClick="logVariable('mnethost')" href="../_variables/mnethost.html">$mnethost</a>);
<a name="l480"><span class="linenum"> 480</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l481"><span class="linenum"> 481</span></a>      }
<a name="l482"><span class="linenum"> 482</span></a>      return true;
<a name="l483"><span class="linenum"> 483</span></a>  }
<a name="l484"><span class="linenum"> 484</span></a>  
<a name="l485"><span class="linenum"> 485</span></a>  function <a class="function" onClick="logFunction('mnet_get_peer_host')" href="../_functions/mnet_get_peer_host.html" onMouseOver="funcPopup(event,'mnet_get_peer_host')">mnet_get_peer_host</a> (<a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('mnethostid')" href="../_variables/mnethostid.html">$mnethostid</a>) {
<a name="l486"><span class="linenum"> 486</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l487"><span class="linenum"> 487</span></a>      static <a class="var it899" onMouseOver="hilite(899)" onMouseOut="lolite()" onClick="logVariable('hosts')" href="../_variables/hosts.html">$hosts</a>;
<a name="l488"><span class="linenum"> 488</span></a>      if (!isset(<a class="var it899" onMouseOver="hilite(899)" onMouseOut="lolite()" onClick="logVariable('hosts')" href="../_variables/hosts.html">$hosts</a>[<a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('mnethostid')" href="../_variables/mnethostid.html">$mnethostid</a>])) {
<a name="l489"><span class="linenum"> 489</span></a>          <a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('mnet_host', array('id' =&gt; <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('mnethostid')" href="../_variables/mnethostid.html">$mnethostid</a>));
<a name="l490"><span class="linenum"> 490</span></a>          <a class="var it899" onMouseOver="hilite(899)" onMouseOut="lolite()" onClick="logVariable('hosts')" href="../_variables/hosts.html">$hosts</a>[<a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('mnethostid')" href="../_variables/mnethostid.html">$mnethostid</a>] = <a class="var it213" onMouseOver="hilite(213)" onMouseOut="lolite()" onClick="logVariable('host')" href="../_variables/host.html">$host</a>;
<a name="l491"><span class="linenum"> 491</span></a>      }
<a name="l492"><span class="linenum"> 492</span></a>      return <a class="var it899" onMouseOver="hilite(899)" onMouseOut="lolite()" onClick="logVariable('hosts')" href="../_variables/hosts.html">$hosts</a>[<a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('mnethostid')" href="../_variables/mnethostid.html">$mnethostid</a>];
<a name="l493"><span class="linenum"> 493</span></a>  }
<a name="l494"><span class="linenum"> 494</span></a>  
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment">/**</span>
<a name="l496"><span class="linenum"> 496</span></a>  <span class="comment"> * Inline function to modify a url string so that mnet users are requested to</span>
<a name="l497"><span class="linenum"> 497</span></a>  <span class="comment"> * log in at their mnet identity provider (if they are not already logged in)</span>
<a name="l498"><span class="linenum"> 498</span></a>  <span class="comment"> * before ultimately being directed to the original url.</span>
<a name="l499"><span class="linenum"> 499</span></a>  <span class="comment"> *</span>
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment"> * @param string $jumpurl the url which user should initially be directed to.</span>
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment"> *     This is a URL associated with a moodle networking peer when it</span>
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment"> *     is fulfiling a role as an identity provider (IDP). Different urls for</span>
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment"> *     different peers, the jumpurl is formed partly from the IDP's webroot, and</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment"> *     partly from a predefined local path within that webwroot.</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment"> *     The result of the user hitting this jump url is that they will be asked</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment"> *     to login (at their identity provider (if they aren't already)), mnet</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment"> *     will prepare the necessary authentication information, then redirect</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment"> *     them back to somewhere at the content provider(CP) moodle (this moodle)</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment"> * @param array $url array with 2 elements</span>
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment"> *     0 - context the url was taken from, possibly just the url, possibly href=&quot;url&quot;</span>
<a name="l511"><span class="linenum"> 511</span></a>  <span class="comment"> *     1 - the destination url</span>
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment"> * @return string the url the remote user should be supplied with.</span>
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment"> */</span>
<a name="l514"><span class="linenum"> 514</span></a>  function <a class="function" onClick="logFunction('mnet_sso_apply_indirection')" href="../_functions/mnet_sso_apply_indirection.html" onMouseOver="funcPopup(event,'mnet_sso_apply_indirection')">mnet_sso_apply_indirection</a> (<a class="var it13957" onMouseOver="hilite(13957)" onMouseOut="lolite()" onClick="logVariable('jumpurl')" href="../_variables/jumpurl.html">$jumpurl</a>, <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>) {
<a name="l515"><span class="linenum"> 515</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l516"><span class="linenum"> 516</span></a>  
<a name="l517"><span class="linenum"> 517</span></a>      <a class="var it13773" onMouseOver="hilite(13773)" onMouseOut="lolite()" onClick="logVariable('localpart')" href="../_variables/localpart.html">$localpart</a>='';
<a name="l518"><span class="linenum"> 518</span></a>      <a class="var it25179" onMouseOver="hilite(25179)" onMouseOut="lolite()" onClick="logVariable('urlparts')" href="../_variables/urlparts.html">$urlparts</a> = <a class="phpfunction" onClick="logFunction('parse_url')" href="../_functions/parse_url.html" onMouseOver="phpfuncPopup(event,'parse_url')">parse_url</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>[1]);
<a name="l519"><span class="linenum"> 519</span></a>      if(<a class="var it25179" onMouseOver="hilite(25179)" onMouseOut="lolite()" onClick="logVariable('urlparts')" href="../_variables/urlparts.html">$urlparts</a>) {
<a name="l520"><span class="linenum"> 520</span></a>          if (isset(<a class="var it25179" onMouseOver="hilite(25179)" onMouseOut="lolite()" onClick="logVariable('urlparts')" href="../_variables/urlparts.html">$urlparts</a>['path'])) {
<a name="l521"><span class="linenum"> 521</span></a>              <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> = <a class="var it25179" onMouseOver="hilite(25179)" onMouseOut="lolite()" onClick="logVariable('urlparts')" href="../_variables/urlparts.html">$urlparts</a>['path'];
<a name="l522"><span class="linenum"> 522</span></a>  <span class="comment">            // if our wwwroot has a path component, need to strip that path from beginning of the</span>
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">            // 'localpart' to make it relative to moodle's wwwroot</span>
<a name="l524"><span class="linenum"> 524</span></a>              <a class="var it34139" onMouseOver="hilite(34139)" onMouseOut="lolite()" onClick="logVariable('wwwrootpath')" href="../_variables/wwwrootpath.html">$wwwrootpath</a> = <a class="phpfunction" onClick="logFunction('parse_url')" href="../_functions/parse_url.html" onMouseOver="phpfuncPopup(event,'parse_url')">parse_url</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>, PHP_URL_PATH);
<a name="l525"><span class="linenum"> 525</span></a>              if (!empty(<a class="var it34139" onMouseOver="hilite(34139)" onMouseOut="lolite()" onClick="logVariable('wwwrootpath')" href="../_variables/wwwrootpath.html">$wwwrootpath</a>) and <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>, <a class="var it34139" onMouseOver="hilite(34139)" onMouseOut="lolite()" onClick="logVariable('wwwrootpath')" href="../_variables/wwwrootpath.html">$wwwrootpath</a>) === 0) {
<a name="l526"><span class="linenum"> 526</span></a>                  <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>, <a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it34139" onMouseOver="hilite(34139)" onMouseOut="lolite()" onClick="logVariable('wwwrootpath')" href="../_variables/wwwrootpath.html">$wwwrootpath</a>));
<a name="l527"><span class="linenum"> 527</span></a>              }
<a name="l528"><span class="linenum"> 528</span></a>              <a class="var it13773" onMouseOver="hilite(13773)" onMouseOut="lolite()" onClick="logVariable('localpart')" href="../_variables/localpart.html">$localpart</a> .= <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>;
<a name="l529"><span class="linenum"> 529</span></a>          }
<a name="l530"><span class="linenum"> 530</span></a>          if (isset(<a class="var it25179" onMouseOver="hilite(25179)" onMouseOut="lolite()" onClick="logVariable('urlparts')" href="../_variables/urlparts.html">$urlparts</a>['query'])) {
<a name="l531"><span class="linenum"> 531</span></a>              <a class="var it13773" onMouseOver="hilite(13773)" onMouseOut="lolite()" onClick="logVariable('localpart')" href="../_variables/localpart.html">$localpart</a> .= '?'.<a class="var it25179" onMouseOver="hilite(25179)" onMouseOut="lolite()" onClick="logVariable('urlparts')" href="../_variables/urlparts.html">$urlparts</a>['query'];
<a name="l532"><span class="linenum"> 532</span></a>          }
<a name="l533"><span class="linenum"> 533</span></a>          if (isset(<a class="var it25179" onMouseOver="hilite(25179)" onMouseOut="lolite()" onClick="logVariable('urlparts')" href="../_variables/urlparts.html">$urlparts</a>['fragment'])) {
<a name="l534"><span class="linenum"> 534</span></a>              <a class="var it13773" onMouseOver="hilite(13773)" onMouseOut="lolite()" onClick="logVariable('localpart')" href="../_variables/localpart.html">$localpart</a> .= '#'.<a class="var it25179" onMouseOver="hilite(25179)" onMouseOut="lolite()" onClick="logVariable('urlparts')" href="../_variables/urlparts.html">$urlparts</a>['fragment'];
<a name="l535"><span class="linenum"> 535</span></a>          }
<a name="l536"><span class="linenum"> 536</span></a>      }
<a name="l537"><span class="linenum"> 537</span></a>      <a class="var it34140" onMouseOver="hilite(34140)" onMouseOut="lolite()" onClick="logVariable('indirecturl')" href="../_variables/indirecturl.html">$indirecturl</a> = <a class="var it13957" onMouseOver="hilite(13957)" onMouseOut="lolite()" onClick="logVariable('jumpurl')" href="../_variables/jumpurl.html">$jumpurl</a> . <a class="phpfunction" onClick="logFunction('urlencode')" href="../_functions/urlencode.html" onMouseOver="phpfuncPopup(event,'urlencode')">urlencode</a>(<a class="var it13773" onMouseOver="hilite(13773)" onMouseOut="lolite()" onClick="logVariable('localpart')" href="../_variables/localpart.html">$localpart</a>);
<a name="l538"><span class="linenum"> 538</span></a>  <span class="comment">    //If we matched on more than just a url (ie an html link), return the url to an href format</span>
<a name="l539"><span class="linenum"> 539</span></a>      if (<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>[0] != <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>[1]) {
<a name="l540"><span class="linenum"> 540</span></a>          <a class="var it34140" onMouseOver="hilite(34140)" onMouseOut="lolite()" onClick="logVariable('indirecturl')" href="../_variables/indirecturl.html">$indirecturl</a> = 'href=&quot;'.<a class="var it34140" onMouseOver="hilite(34140)" onMouseOut="lolite()" onClick="logVariable('indirecturl')" href="../_variables/indirecturl.html">$indirecturl</a>.'&quot;';
<a name="l541"><span class="linenum"> 541</span></a>      }
<a name="l542"><span class="linenum"> 542</span></a>      return <a class="var it34140" onMouseOver="hilite(34140)" onMouseOut="lolite()" onClick="logVariable('indirecturl')" href="../_variables/indirecturl.html">$indirecturl</a>;
<a name="l543"><span class="linenum"> 543</span></a>  }
<a name="l544"><span class="linenum"> 544</span></a>  
<a name="l545"><span class="linenum"> 545</span></a>  function <a class="function" onClick="logFunction('mnet_get_app_jumppath')" href="../_functions/mnet_get_app_jumppath.html" onMouseOver="funcPopup(event,'mnet_get_app_jumppath')">mnet_get_app_jumppath</a> (<a class="var it7969" onMouseOver="hilite(7969)" onMouseOut="lolite()" onClick="logVariable('applicationid')" href="../_variables/applicationid.html">$applicationid</a>) {
<a name="l546"><span class="linenum"> 546</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l547"><span class="linenum"> 547</span></a>      static <a class="var it34141" onMouseOver="hilite(34141)" onMouseOut="lolite()" onClick="logVariable('appjumppaths')" href="../_variables/appjumppaths.html">$appjumppaths</a>;
<a name="l548"><span class="linenum"> 548</span></a>      if (!isset(<a class="var it34141" onMouseOver="hilite(34141)" onMouseOut="lolite()" onClick="logVariable('appjumppaths')" href="../_variables/appjumppaths.html">$appjumppaths</a>[<a class="var it7969" onMouseOver="hilite(7969)" onMouseOut="lolite()" onClick="logVariable('applicationid')" href="../_variables/applicationid.html">$applicationid</a>])) {
<a name="l549"><span class="linenum"> 549</span></a>          <a class="var it34142" onMouseOver="hilite(34142)" onMouseOut="lolite()" onClick="logVariable('ssojumpurl')" href="../_variables/ssojumpurl.html">$ssojumpurl</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('mnet_application', 'sso_jump_url', array('id' =&gt; <a class="var it7969" onMouseOver="hilite(7969)" onMouseOut="lolite()" onClick="logVariable('applicationid')" href="../_variables/applicationid.html">$applicationid</a>));
<a name="l550"><span class="linenum"> 550</span></a>          <a class="var it34141" onMouseOver="hilite(34141)" onMouseOut="lolite()" onClick="logVariable('appjumppaths')" href="../_variables/appjumppaths.html">$appjumppaths</a>[<a class="var it7969" onMouseOver="hilite(7969)" onMouseOut="lolite()" onClick="logVariable('applicationid')" href="../_variables/applicationid.html">$applicationid</a>] = <a class="var it34142" onMouseOver="hilite(34142)" onMouseOut="lolite()" onClick="logVariable('ssojumpurl')" href="../_variables/ssojumpurl.html">$ssojumpurl</a>;
<a name="l551"><span class="linenum"> 551</span></a>      }
<a name="l552"><span class="linenum"> 552</span></a>      return <a class="var it34141" onMouseOver="hilite(34141)" onMouseOut="lolite()" onClick="logVariable('appjumppaths')" href="../_variables/appjumppaths.html">$appjumppaths</a>[<a class="var it7969" onMouseOver="hilite(7969)" onMouseOut="lolite()" onClick="logVariable('applicationid')" href="../_variables/applicationid.html">$applicationid</a>];
<a name="l553"><span class="linenum"> 553</span></a>  }
<a name="l554"><span class="linenum"> 554</span></a>  
<a name="l555"><span class="linenum"> 555</span></a>  
<a name="l556"><span class="linenum"> 556</span></a>  <span class="comment">/**</span>
<a name="l557"><span class="linenum"> 557</span></a>  <span class="comment"> * Output debug information about mnet.  this will go to the &lt;b&gt;error_log&lt;/b&gt;.</span>
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment"> *</span>
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment"> * @param mixed $debugdata this can be a string, or array or object.</span>
<a name="l560"><span class="linenum"> 560</span></a>  <span class="comment"> * @param int   $debuglevel optional , defaults to 1. bump up for very noisy debug info</span>
<a name="l561"><span class="linenum"> 561</span></a>  <span class="comment"> */</span>
<a name="l562"><span class="linenum"> 562</span></a>  function <a class="function" onClick="logFunction('mnet_debug')" href="../_functions/mnet_debug.html" onMouseOver="funcPopup(event,'mnet_debug')">mnet_debug</a>(<a class="var it34143" onMouseOver="hilite(34143)" onMouseOut="lolite()" onClick="logVariable('debugdata')" href="../_variables/debugdata.html">$debugdata</a>, <a class="var it9538" onMouseOver="hilite(9538)" onMouseOut="lolite()" onClick="logVariable('debuglevel')" href="../_variables/debuglevel.html">$debuglevel</a>=1) {
<a name="l563"><span class="linenum"> 563</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l564"><span class="linenum"> 564</span></a>      <a class="var it34144" onMouseOver="hilite(34144)" onMouseOut="lolite()" onClick="logVariable('setlevel')" href="../_variables/setlevel.html">$setlevel</a> = <a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('', 'mnet_rpcdebug');
<a name="l565"><span class="linenum"> 565</span></a>      if (empty(<a class="var it34144" onMouseOver="hilite(34144)" onMouseOut="lolite()" onClick="logVariable('setlevel')" href="../_variables/setlevel.html">$setlevel</a>) || <a class="var it34144" onMouseOver="hilite(34144)" onMouseOut="lolite()" onClick="logVariable('setlevel')" href="../_variables/setlevel.html">$setlevel</a> &lt; <a class="var it9538" onMouseOver="hilite(9538)" onMouseOut="lolite()" onClick="logVariable('debuglevel')" href="../_variables/debuglevel.html">$debuglevel</a>) {
<a name="l566"><span class="linenum"> 566</span></a>          return;
<a name="l567"><span class="linenum"> 567</span></a>      }
<a name="l568"><span class="linenum"> 568</span></a>      if (<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it34143" onMouseOver="hilite(34143)" onMouseOut="lolite()" onClick="logVariable('debugdata')" href="../_variables/debugdata.html">$debugdata</a>)) {
<a name="l569"><span class="linenum"> 569</span></a>          <a class="var it34143" onMouseOver="hilite(34143)" onMouseOut="lolite()" onClick="logVariable('debugdata')" href="../_variables/debugdata.html">$debugdata</a> = (array)<a class="var it34143" onMouseOver="hilite(34143)" onMouseOut="lolite()" onClick="logVariable('debugdata')" href="../_variables/debugdata.html">$debugdata</a>;
<a name="l570"><span class="linenum"> 570</span></a>      }
<a name="l571"><span class="linenum"> 571</span></a>      if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it34143" onMouseOver="hilite(34143)" onMouseOut="lolite()" onClick="logVariable('debugdata')" href="../_variables/debugdata.html">$debugdata</a>)) {
<a name="l572"><span class="linenum"> 572</span></a>          <a class="function" onClick="logFunction('mnet_debug')" href="../_functions/mnet_debug.html" onMouseOver="funcPopup(event,'mnet_debug')">mnet_debug</a>('DUMPING ARRAY');
<a name="l573"><span class="linenum"> 573</span></a>          foreach (<a class="var it34143" onMouseOver="hilite(34143)" onMouseOut="lolite()" onClick="logVariable('debugdata')" href="../_variables/debugdata.html">$debugdata</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> =&gt; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>) {
<a name="l574"><span class="linenum"> 574</span></a>              <a class="function" onClick="logFunction('mnet_debug')" href="../_functions/mnet_debug.html" onMouseOver="funcPopup(event,'mnet_debug')">mnet_debug</a>(&quot;<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>: <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>&quot;);
<a name="l575"><span class="linenum"> 575</span></a>          }
<a name="l576"><span class="linenum"> 576</span></a>          <a class="function" onClick="logFunction('mnet_debug')" href="../_functions/mnet_debug.html" onMouseOver="funcPopup(event,'mnet_debug')">mnet_debug</a>('END DUMPING ARRAY');
<a name="l577"><span class="linenum"> 577</span></a>          return;
<a name="l578"><span class="linenum"> 578</span></a>      }
<a name="l579"><span class="linenum"> 579</span></a>      <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a> = 'MNET DEBUG ';
<a name="l580"><span class="linenum"> 580</span></a>      if (<a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MNET_SERVER')" href="../_constants/MNET_SERVER.html" onMouseOver="constPopup(event,'MNET_SERVER')">MNET_SERVER</a>')) {
<a name="l581"><span class="linenum"> 581</span></a>          <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a> .= &quot; (server <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>&quot;;
<a name="l582"><span class="linenum"> 582</span></a>          if (<a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a> = <a class="function" onClick="logFunction('get_mnet_remote_client')" href="../_functions/get_mnet_remote_client.html" onMouseOver="funcPopup(event,'get_mnet_remote_client')">get_mnet_remote_client</a>() &amp;&amp; !empty(<a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it43657" onMouseOver="hilite(43657)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>)) {
<a name="l583"><span class="linenum"> 583</span></a>              <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a> .= &quot;, remote peer &quot; . <a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it43657" onMouseOver="hilite(43657)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>;
<a name="l584"><span class="linenum"> 584</span></a>          }
<a name="l585"><span class="linenum"> 585</span></a>          <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a> .= ')';
<a name="l586"><span class="linenum"> 586</span></a>      } else {
<a name="l587"><span class="linenum"> 587</span></a>          <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a> .= &quot; (client <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>) &quot;;
<a name="l588"><span class="linenum"> 588</span></a>      }
<a name="l589"><span class="linenum"> 589</span></a>      <a class="phpfunction" onClick="logFunction('error_log')" href="../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(&quot;<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a> <a class="var it34143" onMouseOver="hilite(34143)" onMouseOut="lolite()" onClick="logVariable('debugdata')" href="../_variables/debugdata.html">$debugdata</a>&quot;);
<a name="l590"><span class="linenum"> 590</span></a>  }
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">/**</span>
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment"> * Return an array of information about all moodle's profile fields</span>
<a name="l594"><span class="linenum"> 594</span></a>  <span class="comment"> * which ones are optional, which ones are forced.</span>
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment"> * This is used as the basis of providing lists of profile fields to the administrator</span>
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment"> * to pick which fields to import/export over MNET</span>
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment"> *</span>
<a name="l598"><span class="linenum"> 598</span></a>  <span class="comment"> * @return array(forced =&gt; array, optional =&gt; array)</span>
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment"> */</span>
<a name="l600"><span class="linenum"> 600</span></a>  function <a class="function" onClick="logFunction('mnet_profile_field_options')" href="../_functions/mnet_profile_field_options.html" onMouseOver="funcPopup(event,'mnet_profile_field_options')">mnet_profile_field_options</a>() {
<a name="l601"><span class="linenum"> 601</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l602"><span class="linenum"> 602</span></a>      static <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>;
<a name="l603"><span class="linenum"> 603</span></a>      if (!empty(<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>)) {
<a name="l604"><span class="linenum"> 604</span></a>          return <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>;
<a name="l605"><span class="linenum"> 605</span></a>      }
<a name="l606"><span class="linenum"> 606</span></a>  
<a name="l607"><span class="linenum"> 607</span></a>      <a class="var it10040" onMouseOver="hilite(10040)" onMouseOut="lolite()" onClick="logVariable('excludes')" href="../_variables/excludes.html">$excludes</a> = array(
<a name="l608"><span class="linenum"> 608</span></a>          'id',              // makes no sense
<a name="l609"><span class="linenum"> 609</span></a>          'mnethostid',      // makes no sense
<a name="l610"><span class="linenum"> 610</span></a>          'timecreated',     // will be set to relative to the host anyway
<a name="l611"><span class="linenum"> 611</span></a>          'timemodified',    // will be set to relative to the host anyway
<a name="l612"><span class="linenum"> 612</span></a>          'auth',            // going to be set to 'mnet'
<a name="l613"><span class="linenum"> 613</span></a>          'deleted',         // we should never get deleted users sent over, but don't send this anyway
<a name="l614"><span class="linenum"> 614</span></a>          'confirmed',       // unconfirmed users can't log in to their home site, all remote users considered confirmed
<a name="l615"><span class="linenum"> 615</span></a>          'password',        // no password for mnet users
<a name="l616"><span class="linenum"> 616</span></a>          'theme',           // handled separately
<a name="l617"><span class="linenum"> 617</span></a>          'lastip',          // will be set to relative to the host anyway
<a name="l618"><span class="linenum"> 618</span></a>      );
<a name="l619"><span class="linenum"> 619</span></a>  
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment">    // these are the ones that user_not_fully_set_up will complain about</span>
<a name="l621"><span class="linenum"> 621</span></a>  <span class="comment">    // and also special case ones</span>
<a name="l622"><span class="linenum"> 622</span></a>      <a class="var it6487" onMouseOver="hilite(6487)" onMouseOut="lolite()" onClick="logVariable('forced')" href="../_variables/forced.html">$forced</a> = array(
<a name="l623"><span class="linenum"> 623</span></a>          'username',
<a name="l624"><span class="linenum"> 624</span></a>          'email',
<a name="l625"><span class="linenum"> 625</span></a>          'firstname',
<a name="l626"><span class="linenum"> 626</span></a>          'lastname',
<a name="l627"><span class="linenum"> 627</span></a>          'auth',
<a name="l628"><span class="linenum"> 628</span></a>          'wwwroot',
<a name="l629"><span class="linenum"> 629</span></a>          'session.gc_lifetime',
<a name="l630"><span class="linenum"> 630</span></a>          '_mnet_userpicture_timemodified',
<a name="l631"><span class="linenum"> 631</span></a>          '_mnet_userpicture_mimetype',
<a name="l632"><span class="linenum"> 632</span></a>      );
<a name="l633"><span class="linenum"> 633</span></a>  
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment">    // these are the ones we used to send/receive (pre 2.0)</span>
<a name="l635"><span class="linenum"> 635</span></a>      <a class="var it19264" onMouseOver="hilite(19264)" onMouseOut="lolite()" onClick="logVariable('legacy')" href="../_variables/legacy.html">$legacy</a> = array(
<a name="l636"><span class="linenum"> 636</span></a>          'username',
<a name="l637"><span class="linenum"> 637</span></a>          'email',
<a name="l638"><span class="linenum"> 638</span></a>          'auth',
<a name="l639"><span class="linenum"> 639</span></a>          'deleted',
<a name="l640"><span class="linenum"> 640</span></a>          'firstname',
<a name="l641"><span class="linenum"> 641</span></a>          'lastname',
<a name="l642"><span class="linenum"> 642</span></a>          'city',
<a name="l643"><span class="linenum"> 643</span></a>          'country',
<a name="l644"><span class="linenum"> 644</span></a>          'lang',
<a name="l645"><span class="linenum"> 645</span></a>          'timezone',
<a name="l646"><span class="linenum"> 646</span></a>          'description',
<a name="l647"><span class="linenum"> 647</span></a>          'mailformat',
<a name="l648"><span class="linenum"> 648</span></a>          'maildigest',
<a name="l649"><span class="linenum"> 649</span></a>          'maildisplay',
<a name="l650"><span class="linenum"> 650</span></a>          'htmleditor',
<a name="l651"><span class="linenum"> 651</span></a>          'wwwroot',
<a name="l652"><span class="linenum"> 652</span></a>          'picture',
<a name="l653"><span class="linenum"> 653</span></a>      );
<a name="l654"><span class="linenum"> 654</span></a>  
<a name="l655"><span class="linenum"> 655</span></a>  <span class="comment">    // get a random user record from the database to pull the fields off</span>
<a name="l656"><span class="linenum"> 656</span></a>      <a class="var it34145" onMouseOver="hilite(34145)" onMouseOut="lolite()" onClick="logVariable('randomuser')" href="../_variables/randomuser.html">$randomuser</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array(), '*', <a class="constant" onClick="logConstant('IGNORE_MULTIPLE')" href="../_constants/IGNORE_MULTIPLE.html" onMouseOver="constPopup(event,'IGNORE_MULTIPLE')">IGNORE_MULTIPLE</a>);
<a name="l657"><span class="linenum"> 657</span></a>      foreach (<a class="var it34145" onMouseOver="hilite(34145)" onMouseOut="lolite()" onClick="logVariable('randomuser')" href="../_variables/randomuser.html">$randomuser</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> =&gt; <a class="var it237" onMouseOver="hilite(237)" onMouseOut="lolite()" onClick="logVariable('discard')" href="../_variables/discard.html">$discard</a>) {
<a name="l658"><span class="linenum"> 658</span></a>          if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>, <a class="var it10040" onMouseOver="hilite(10040)" onMouseOut="lolite()" onClick="logVariable('excludes')" href="../_variables/excludes.html">$excludes</a>) || <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>, <a class="var it6487" onMouseOver="hilite(6487)" onMouseOut="lolite()" onClick="logVariable('forced')" href="../_variables/forced.html">$forced</a>)) {
<a name="l659"><span class="linenum"> 659</span></a>              continue;
<a name="l660"><span class="linenum"> 660</span></a>          }
<a name="l661"><span class="linenum"> 661</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>] = <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>;
<a name="l662"><span class="linenum"> 662</span></a>      }
<a name="l663"><span class="linenum"> 663</span></a>      <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a> = array(
<a name="l664"><span class="linenum"> 664</span></a>          'forced'   =&gt; <a class="var it6487" onMouseOver="hilite(6487)" onMouseOut="lolite()" onClick="logVariable('forced')" href="../_variables/forced.html">$forced</a>,
<a name="l665"><span class="linenum"> 665</span></a>          'optional' =&gt; <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>,
<a name="l666"><span class="linenum"> 666</span></a>          'legacy'   =&gt; <a class="var it19264" onMouseOver="hilite(19264)" onMouseOut="lolite()" onClick="logVariable('legacy')" href="../_variables/legacy.html">$legacy</a>,
<a name="l667"><span class="linenum"> 667</span></a>      );
<a name="l668"><span class="linenum"> 668</span></a>      return <a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>;
<a name="l669"><span class="linenum"> 669</span></a>  }
<a name="l670"><span class="linenum"> 670</span></a>  
<a name="l671"><span class="linenum"> 671</span></a>  
<a name="l672"><span class="linenum"> 672</span></a>  <span class="comment">/**</span>
<a name="l673"><span class="linenum"> 673</span></a>  <span class="comment"> * Returns information about MNet peers</span>
<a name="l674"><span class="linenum"> 674</span></a>  <span class="comment"> *</span>
<a name="l675"><span class="linenum"> 675</span></a>  <span class="comment"> * @param bool $withdeleted should the deleted peers be returned too</span>
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment"> * @return array</span>
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment"> */</span>
<a name="l678"><span class="linenum"> 678</span></a>  function <a class="function" onClick="logFunction('mnet_get_hosts')" href="../_functions/mnet_get_hosts.html" onMouseOver="funcPopup(event,'mnet_get_hosts')">mnet_get_hosts</a>(<a class="var it34146" onMouseOver="hilite(34146)" onMouseOut="lolite()" onClick="logVariable('withdeleted')" href="../_variables/withdeleted.html">$withdeleted</a> = false) {
<a name="l679"><span class="linenum"> 679</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l680"><span class="linenum"> 680</span></a>  
<a name="l681"><span class="linenum"> 681</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT h.id, h.deleted, h.wwwroot, h.ip_address, h.name, h.public_key, h.public_key_expires,
<a name="l682"><span class="linenum"> 682</span></a>                     h.transport, h.portno, h.last_connect_time, h.last_log_id, h.applicationid,
<a name="l683"><span class="linenum"> 683</span></a>                     a.name as app_name, a.display_name as app_display_name, a.xmlrpc_server_url
<a name="l684"><span class="linenum"> 684</span></a>                FROM {mnet_host} h
<a name="l685"><span class="linenum"> 685</span></a>                JOIN {mnet_application} a ON h.applicationid = a.id
<a name="l686"><span class="linenum"> 686</span></a>               WHERE h.id &lt;&gt; ?&quot;;
<a name="l687"><span class="linenum"> 687</span></a>  
<a name="l688"><span class="linenum"> 688</span></a>      if (!<a class="var it34146" onMouseOver="hilite(34146)" onMouseOut="lolite()" onClick="logVariable('withdeleted')" href="../_variables/withdeleted.html">$withdeleted</a>) {
<a name="l689"><span class="linenum"> 689</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> .= &quot;  AND h.deleted = 0&quot;;
<a name="l690"><span class="linenum"> 690</span></a>      }
<a name="l691"><span class="linenum"> 691</span></a>  
<a name="l692"><span class="linenum"> 692</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> .= &quot; ORDER BY h.deleted, h.name, h.id&quot;;
<a name="l693"><span class="linenum"> 693</span></a>  
<a name="l694"><span class="linenum"> 694</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/mnet_localhost_id.html">mnet_localhost_id</a>));
<a name="l695"><span class="linenum"> 695</span></a>  }
<a name="l696"><span class="linenum"> 696</span></a>  
<a name="l697"><span class="linenum"> 697</span></a>  
<a name="l698"><span class="linenum"> 698</span></a>  <span class="comment">/**</span>
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment"> * return an array information about services enabled for the given peer.</span>
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment"> * in two modes, fulldata or very basic data.</span>
<a name="l701"><span class="linenum"> 701</span></a>  <span class="comment"> *</span>
<a name="l702"><span class="linenum"> 702</span></a>  <span class="comment"> * @param mnet_peer $mnet_peer the peer to get information abut</span>
<a name="l703"><span class="linenum"> 703</span></a>  <span class="comment"> * @param boolean   $fulldata whether to just return which services are published/subscribed, or more information (defaults to full)</span>
<a name="l704"><span class="linenum"> 704</span></a>  <span class="comment"> *</span>
<a name="l705"><span class="linenum"> 705</span></a>  <span class="comment"> * @return array  If $fulldata is false, an array is returned like:</span>
<a name="l706"><span class="linenum"> 706</span></a>  <span class="comment"> *                publish =&gt; array(</span>
<a name="l707"><span class="linenum"> 707</span></a>  <span class="comment"> *                    serviceid =&gt; boolean,</span>
<a name="l708"><span class="linenum"> 708</span></a>  <span class="comment"> *                    serviceid =&gt; boolean,</span>
<a name="l709"><span class="linenum"> 709</span></a>  <span class="comment"> *                ),</span>
<a name="l710"><span class="linenum"> 710</span></a>  <span class="comment"> *                subscribe =&gt; array(</span>
<a name="l711"><span class="linenum"> 711</span></a>  <span class="comment"> *                    serviceid =&gt; boolean,</span>
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment"> *                    serviceid =&gt; boolean,</span>
<a name="l713"><span class="linenum"> 713</span></a>  <span class="comment"> *                )</span>
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment"> *                If $fulldata is true, an array is returned like:</span>
<a name="l715"><span class="linenum"> 715</span></a>  <span class="comment"> *                servicename =&gt; array(</span>
<a name="l716"><span class="linenum"> 716</span></a>  <span class="comment"> *                   apiversion =&gt; array(</span>
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment"> *                        name           =&gt; string</span>
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment"> *                        offer          =&gt; boolean</span>
<a name="l719"><span class="linenum"> 719</span></a>  <span class="comment"> *                        apiversion     =&gt; int</span>
<a name="l720"><span class="linenum"> 720</span></a>  <span class="comment"> *                        plugintype     =&gt; string</span>
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment"> *                        pluginname     =&gt; string</span>
<a name="l722"><span class="linenum"> 722</span></a>  <span class="comment"> *                        hostsubscribes =&gt; boolean</span>
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment"> *                        hostpublishes  =&gt; boolean</span>
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment"> *                   ),</span>
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment"> *               )</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment"> */</span>
<a name="l727"><span class="linenum"> 727</span></a>  function <a class="function" onClick="logFunction('mnet_get_service_info')" href="../_functions/mnet_get_service_info.html" onMouseOver="funcPopup(event,'mnet_get_service_info')">mnet_get_service_info</a>(mnet_peer <a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>, <a class="var it31022" onMouseOver="hilite(31022)" onMouseOut="lolite()" onClick="logVariable('fulldata')" href="../_variables/fulldata.html">$fulldata</a>=true) {
<a name="l728"><span class="linenum"> 728</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l729"><span class="linenum"> 729</span></a>  
<a name="l730"><span class="linenum"> 730</span></a>      <a class="var it34147" onMouseOver="hilite(34147)" onMouseOut="lolite()" onClick="logVariable('requestkey')" href="../_variables/requestkey.html">$requestkey</a> = (!empty(<a class="var it31022" onMouseOver="hilite(31022)" onMouseOut="lolite()" onClick="logVariable('fulldata')" href="../_variables/fulldata.html">$fulldata</a>) ? 'fulldata' : 'mydata');
<a name="l731"><span class="linenum"> 731</span></a>  
<a name="l732"><span class="linenum"> 732</span></a>      static <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a> = array();
<a name="l733"><span class="linenum"> 733</span></a>      if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>-&gt;<a onClick="logVariable('id')" class="var it44374" onMouseOver="hilite(44374)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a>)) {
<a name="l734"><span class="linenum"> 734</span></a>          return <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a>[<a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>-&gt;<a onClick="logVariable('id')" class="var it44374" onMouseOver="hilite(44374)" onMouseOut="lolite()" href="../_variables/id.html">id</a>][<a class="var it34147" onMouseOver="hilite(34147)" onMouseOut="lolite()" onClick="logVariable('requestkey')" href="../_variables/requestkey.html">$requestkey</a>];
<a name="l735"><span class="linenum"> 735</span></a>      }
<a name="l736"><span class="linenum"> 736</span></a>  
<a name="l737"><span class="linenum"> 737</span></a>      <a class="var it30066" onMouseOver="hilite(30066)" onMouseOut="lolite()" onClick="logVariable('id_list')" href="../_variables/id_list.html">$id_list</a> = <a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>-&gt;<a onClick="logVariable('id')" class="var it44374" onMouseOver="hilite(44374)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l738"><span class="linenum"> 738</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_all_hosts_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/mnet_all_hosts_id.html">mnet_all_hosts_id</a>)) {
<a name="l739"><span class="linenum"> 739</span></a>          <a class="var it30066" onMouseOver="hilite(30066)" onMouseOut="lolite()" onClick="logVariable('id_list')" href="../_variables/id_list.html">$id_list</a> .= ', '.<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_all_hosts_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/mnet_all_hosts_id.html">mnet_all_hosts_id</a>;
<a name="l740"><span class="linenum"> 740</span></a>      }
<a name="l741"><span class="linenum"> 741</span></a>  
<a name="l742"><span class="linenum"> 742</span></a>      <a class="var it12605" onMouseOver="hilite(12605)" onMouseOut="lolite()" onClick="logVariable('concat')" href="../_variables/concat.html">$concat</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('COALESCE(h2s.id,0) ', ' \'-\' ', ' svc.id', '\'-\'', 'r.plugintype', '\'-\'', 'r.pluginname');
<a name="l743"><span class="linenum"> 743</span></a>  
<a name="l744"><span class="linenum"> 744</span></a>      <a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../_variables/query.html">$query</a> = &quot;
<a name="l745"><span class="linenum"> 745</span></a>          SELECT DISTINCT
<a name="l746"><span class="linenum"> 746</span></a>              <a class="var it12605" onMouseOver="hilite(12605)" onMouseOut="lolite()" onClick="logVariable('concat')" href="../_variables/concat.html">$concat</a> as id,
<a name="l747"><span class="linenum"> 747</span></a>              svc.id as serviceid,
<a name="l748"><span class="linenum"> 748</span></a>              svc.name,
<a name="l749"><span class="linenum"> 749</span></a>              svc.offer,
<a name="l750"><span class="linenum"> 750</span></a>              svc.apiversion,
<a name="l751"><span class="linenum"> 751</span></a>              r.plugintype,
<a name="l752"><span class="linenum"> 752</span></a>              r.pluginname,
<a name="l753"><span class="linenum"> 753</span></a>              h2s.hostid,
<a name="l754"><span class="linenum"> 754</span></a>              h2s.publish,
<a name="l755"><span class="linenum"> 755</span></a>              h2s.subscribe
<a name="l756"><span class="linenum"> 756</span></a>          FROM
<a name="l757"><span class="linenum"> 757</span></a>              {mnet_service2rpc} s2r,
<a name="l758"><span class="linenum"> 758</span></a>              {mnet_rpc} r,
<a name="l759"><span class="linenum"> 759</span></a>              {mnet_service} svc
<a name="l760"><span class="linenum"> 760</span></a>          LEFT JOIN
<a name="l761"><span class="linenum"> 761</span></a>              {mnet_host2service} h2s
<a name="l762"><span class="linenum"> 762</span></a>          ON
<a name="l763"><span class="linenum"> 763</span></a>              h2s.hostid in (<a class="var it30066" onMouseOver="hilite(30066)" onMouseOut="lolite()" onClick="logVariable('id_list')" href="../_variables/id_list.html">$id_list</a>) AND
<a name="l764"><span class="linenum"> 764</span></a>              h2s.serviceid = svc.id
<a name="l765"><span class="linenum"> 765</span></a>          WHERE
<a name="l766"><span class="linenum"> 766</span></a>              svc.offer = '1' AND
<a name="l767"><span class="linenum"> 767</span></a>              s2r.serviceid = svc.id AND
<a name="l768"><span class="linenum"> 768</span></a>              s2r.rpcid = r.id
<a name="l769"><span class="linenum"> 769</span></a>          ORDER BY
<a name="l770"><span class="linenum"> 770</span></a>              svc.name ASC&quot;;
<a name="l771"><span class="linenum"> 771</span></a>  
<a name="l772"><span class="linenum"> 772</span></a>      <a class="var it21700" onMouseOver="hilite(21700)" onMouseOut="lolite()" onClick="logVariable('resultset')" href="../_variables/resultset.html">$resultset</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../_variables/query.html">$query</a>);
<a name="l773"><span class="linenum"> 773</span></a>  
<a name="l774"><span class="linenum"> 774</span></a>      if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it21700" onMouseOver="hilite(21700)" onMouseOut="lolite()" onClick="logVariable('resultset')" href="../_variables/resultset.html">$resultset</a>)) {
<a name="l775"><span class="linenum"> 775</span></a>          <a class="var it21700" onMouseOver="hilite(21700)" onMouseOut="lolite()" onClick="logVariable('resultset')" href="../_variables/resultset.html">$resultset</a> = <a class="phpfunction" onClick="logFunction('array_values')" href="../_functions/array_values.html" onMouseOver="phpfuncPopup(event,'array_values')">array_values</a>(<a class="var it21700" onMouseOver="hilite(21700)" onMouseOut="lolite()" onClick="logVariable('resultset')" href="../_variables/resultset.html">$resultset</a>);
<a name="l776"><span class="linenum"> 776</span></a>      } else {
<a name="l777"><span class="linenum"> 777</span></a>          <a class="var it21700" onMouseOver="hilite(21700)" onMouseOut="lolite()" onClick="logVariable('resultset')" href="../_variables/resultset.html">$resultset</a> = array();
<a name="l778"><span class="linenum"> 778</span></a>      }
<a name="l779"><span class="linenum"> 779</span></a>  
<a name="l780"><span class="linenum"> 780</span></a>      require_once <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../mnet/xmlrpc/client.php.html">/mnet/xmlrpc/client.php</a>';
<a name="l781"><span class="linenum"> 781</span></a>  
<a name="l782"><span class="linenum"> 782</span></a>      <a class="var it34148" onMouseOver="hilite(34148)" onMouseOut="lolite()" onClick="logVariable('remoteservices')" href="../_variables/remoteservices.html">$remoteservices</a> = array();
<a name="l783"><span class="linenum"> 783</span></a>      if (<a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>-&gt;<a onClick="logVariable('id')" class="var it44374" onMouseOver="hilite(44374)" onMouseOut="lolite()" href="../_variables/id.html">id</a> != <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_all_hosts_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/mnet_all_hosts_id.html">mnet_all_hosts_id</a>) {
<a name="l784"><span class="linenum"> 784</span></a>  <span class="comment">        // Create a new request object</span>
<a name="l785"><span class="linenum"> 785</span></a>          <a class="var it21710" onMouseOver="hilite(21710)" onMouseOut="lolite()" onClick="logVariable('mnet_request')" href="../_variables/mnet_request.html">$mnet_request</a> = <span class="keyword">new </span><a class="class" onClick="logClass('mnet_xmlrpc_client')" href="../_classes/mnet_xmlrpc_client.html" onMouseOver="classPopup(event,'mnet_xmlrpc_client')">mnet_xmlrpc_client</a>();
<a name="l786"><span class="linenum"> 786</span></a>  
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment">        // Tell it the path to the method that we want to execute</span>
<a name="l788"><span class="linenum"> 788</span></a>          <a class="var it21710" onMouseOver="hilite(21710)" onMouseOut="lolite()" onClick="logVariable('mnet_request')" href="../_variables/mnet_request.html">$mnet_request</a>-&gt;<a class="function" onClick="logFunction('set_method')" href="../_functions/set_method.html" onMouseOver="funcPopup(event,'set_method')">set_method</a>('system/listServices');
<a name="l789"><span class="linenum"> 789</span></a>          <a class="var it21710" onMouseOver="hilite(21710)" onMouseOut="lolite()" onClick="logVariable('mnet_request')" href="../_variables/mnet_request.html">$mnet_request</a>-&gt;<a class="function" onClick="logFunction('send')" href="../_functions/send.html" onMouseOver="funcPopup(event,'send')">send</a>(<a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>);
<a name="l790"><span class="linenum"> 790</span></a>          if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it21710" onMouseOver="hilite(21710)" onMouseOut="lolite()" onClick="logVariable('mnet_request')" href="../_variables/mnet_request.html">$mnet_request</a>-&gt;<a onClick="logVariable('response')" class="var it44385" onMouseOver="hilite(44385)" onMouseOut="lolite()" href="../_variables/response.html">response</a>)) {
<a name="l791"><span class="linenum"> 791</span></a>              foreach(<a class="var it21710" onMouseOver="hilite(21710)" onMouseOut="lolite()" onClick="logVariable('mnet_request')" href="../_variables/mnet_request.html">$mnet_request</a>-&gt;<a onClick="logVariable('response')" class="var it44385" onMouseOver="hilite(44385)" onMouseOut="lolite()" href="../_variables/response.html">response</a> as <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l792"><span class="linenum"> 792</span></a>                  <a class="var it34148" onMouseOver="hilite(34148)" onMouseOut="lolite()" onClick="logVariable('remoteservices')" href="../_variables/remoteservices.html">$remoteservices</a>[<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>['name']][<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>['apiversion']] = <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>;
<a name="l793"><span class="linenum"> 793</span></a>              }
<a name="l794"><span class="linenum"> 794</span></a>          }
<a name="l795"><span class="linenum"> 795</span></a>      }
<a name="l796"><span class="linenum"> 796</span></a>  
<a name="l797"><span class="linenum"> 797</span></a>      <a class="var it34149" onMouseOver="hilite(34149)" onMouseOut="lolite()" onClick="logVariable('myservices')" href="../_variables/myservices.html">$myservices</a> = array();
<a name="l798"><span class="linenum"> 798</span></a>      <a class="var it34150" onMouseOver="hilite(34150)" onMouseOut="lolite()" onClick="logVariable('mydata')" href="../_variables/mydata.html">$mydata</a> = array();
<a name="l799"><span class="linenum"> 799</span></a>      foreach(<a class="var it21700" onMouseOver="hilite(21700)" onMouseOut="lolite()" onClick="logVariable('resultset')" href="../_variables/resultset.html">$resultset</a> as <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>) {
<a name="l800"><span class="linenum"> 800</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('hostpublishes')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/hostpublishes.html">hostpublishes</a>  = false;
<a name="l801"><span class="linenum"> 801</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('hostsubscribes')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/hostsubscribes.html">hostsubscribes</a> = false;
<a name="l802"><span class="linenum"> 802</span></a>          if (isset(<a class="var it34148" onMouseOver="hilite(34148)" onMouseOut="lolite()" onClick="logVariable('remoteservices')" href="../_variables/remoteservices.html">$remoteservices</a>[<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>])) {
<a name="l803"><span class="linenum"> 803</span></a>              if (<a class="var it34148" onMouseOver="hilite(34148)" onMouseOut="lolite()" onClick="logVariable('remoteservices')" href="../_variables/remoteservices.html">$remoteservices</a>[<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>]['publish'] == 1) {
<a name="l804"><span class="linenum"> 804</span></a>                  <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('hostpublishes')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/hostpublishes.html">hostpublishes</a>  = true;
<a name="l805"><span class="linenum"> 805</span></a>              }
<a name="l806"><span class="linenum"> 806</span></a>              if (<a class="var it34148" onMouseOver="hilite(34148)" onMouseOut="lolite()" onClick="logVariable('remoteservices')" href="../_variables/remoteservices.html">$remoteservices</a>[<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>]['subscribe'] == 1) {
<a name="l807"><span class="linenum"> 807</span></a>                  <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('hostsubscribes')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/hostsubscribes.html">hostsubscribes</a>  = true;
<a name="l808"><span class="linenum"> 808</span></a>              }
<a name="l809"><span class="linenum"> 809</span></a>          }
<a name="l810"><span class="linenum"> 810</span></a>  
<a name="l811"><span class="linenum"> 811</span></a>          if (empty(<a class="var it34149" onMouseOver="hilite(34149)" onMouseOut="lolite()" onClick="logVariable('myservices')" href="../_variables/myservices.html">$myservices</a>[<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>])) {
<a name="l812"><span class="linenum"> 812</span></a>              <a class="var it34149" onMouseOver="hilite(34149)" onMouseOut="lolite()" onClick="logVariable('myservices')" href="../_variables/myservices.html">$myservices</a>[<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>] = array('serviceid' =&gt; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('serviceid')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/serviceid.html">serviceid</a>,
<a name="l813"><span class="linenum"> 813</span></a>                                                                      'name' =&gt; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>,
<a name="l814"><span class="linenum"> 814</span></a>                                                                      'offer' =&gt; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('offer')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/offer.html">offer</a>,
<a name="l815"><span class="linenum"> 815</span></a>                                                                      'apiversion' =&gt; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>,
<a name="l816"><span class="linenum"> 816</span></a>                                                                      'plugintype' =&gt; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('plugintype')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/plugintype.html">plugintype</a>,
<a name="l817"><span class="linenum"> 817</span></a>                                                                      'pluginname' =&gt; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('pluginname')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/pluginname.html">pluginname</a>,
<a name="l818"><span class="linenum"> 818</span></a>                                                                      'hostsubscribes' =&gt; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('hostsubscribes')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/hostsubscribes.html">hostsubscribes</a>,
<a name="l819"><span class="linenum"> 819</span></a>                                                                      'hostpublishes' =&gt; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;hostpublishes
<a name="l820"><span class="linenum"> 820</span></a>                                                                      );
<a name="l821"><span class="linenum"> 821</span></a>          }
<a name="l822"><span class="linenum"> 822</span></a>  
<a name="l823"><span class="linenum"> 823</span></a>  <span class="comment">        // allhosts_publish allows us to tell the admin that even though he</span>
<a name="l824"><span class="linenum"> 824</span></a>  <span class="comment">        // is disabling a service, it's still available to the host because</span>
<a name="l825"><span class="linenum"> 825</span></a>  <span class="comment">        // he's also publishing it to 'all hosts'</span>
<a name="l826"><span class="linenum"> 826</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('hostid')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/hostid.html">hostid</a> == <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_all_hosts_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/mnet_all_hosts_id.html">mnet_all_hosts_id</a> &amp;&amp; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_all_hosts_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/mnet_all_hosts_id.html">mnet_all_hosts_id</a> != <a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>-&gt;<a onClick="logVariable('id')" class="var it44374" onMouseOver="hilite(44374)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l827"><span class="linenum"> 827</span></a>              <a class="var it34149" onMouseOver="hilite(34149)" onMouseOut="lolite()" onClick="logVariable('myservices')" href="../_variables/myservices.html">$myservices</a>[<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>]['allhosts_publish'] = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('publish')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/publish.html">publish</a>;
<a name="l828"><span class="linenum"> 828</span></a>              <a class="var it34149" onMouseOver="hilite(34149)" onMouseOut="lolite()" onClick="logVariable('myservices')" href="../_variables/myservices.html">$myservices</a>[<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>]['allhosts_subscribe'] = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('subscribe')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/subscribe.html">subscribe</a>;
<a name="l829"><span class="linenum"> 829</span></a>          } elseif (!empty(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('hostid')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/hostid.html">hostid</a>)) {
<a name="l830"><span class="linenum"> 830</span></a>              <a class="var it34149" onMouseOver="hilite(34149)" onMouseOut="lolite()" onClick="logVariable('myservices')" href="../_variables/myservices.html">$myservices</a>[<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>]['I_publish'] = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('publish')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/publish.html">publish</a>;
<a name="l831"><span class="linenum"> 831</span></a>              <a class="var it34149" onMouseOver="hilite(34149)" onMouseOut="lolite()" onClick="logVariable('myservices')" href="../_variables/myservices.html">$myservices</a>[<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('name')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('apiversion')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/apiversion.html">apiversion</a>]['I_subscribe'] = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('subscribe')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/subscribe.html">subscribe</a>;
<a name="l832"><span class="linenum"> 832</span></a>          }
<a name="l833"><span class="linenum"> 833</span></a>          <a class="var it34150" onMouseOver="hilite(34150)" onMouseOut="lolite()" onClick="logVariable('mydata')" href="../_variables/mydata.html">$mydata</a>['publish'][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('serviceid')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/serviceid.html">serviceid</a>] = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('publish')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/publish.html">publish</a>;
<a name="l834"><span class="linenum"> 834</span></a>          <a class="var it34150" onMouseOver="hilite(34150)" onMouseOut="lolite()" onClick="logVariable('mydata')" href="../_variables/mydata.html">$mydata</a>['subscribe'][<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('serviceid')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/serviceid.html">serviceid</a>] = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('subscribe')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../_variables/subscribe.html">subscribe</a>;
<a name="l835"><span class="linenum"> 835</span></a>  
<a name="l836"><span class="linenum"> 836</span></a>      }
<a name="l837"><span class="linenum"> 837</span></a>  
<a name="l838"><span class="linenum"> 838</span></a>      <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a>[<a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>-&gt;<a onClick="logVariable('id')" class="var it44374" onMouseOver="hilite(44374)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]['fulldata'] = <a class="var it34149" onMouseOver="hilite(34149)" onMouseOut="lolite()" onClick="logVariable('myservices')" href="../_variables/myservices.html">$myservices</a>;
<a name="l839"><span class="linenum"> 839</span></a>      <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a>[<a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>-&gt;<a onClick="logVariable('id')" class="var it44374" onMouseOver="hilite(44374)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]['mydata'] = <a class="var it34150" onMouseOver="hilite(34150)" onMouseOut="lolite()" onClick="logVariable('mydata')" href="../_variables/mydata.html">$mydata</a>;
<a name="l840"><span class="linenum"> 840</span></a>  
<a name="l841"><span class="linenum"> 841</span></a>      return <a class="var it415" onMouseOver="hilite(415)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a>[<a class="var it1361" onMouseOver="hilite(1361)" onMouseOut="lolite()" onClick="logVariable('mnet_peer')" href="../_variables/mnet_peer.html">$mnet_peer</a>-&gt;<a onClick="logVariable('id')" class="var it44374" onMouseOver="hilite(44374)" onMouseOut="lolite()" href="../_variables/id.html">id</a>][<a class="var it34147" onMouseOver="hilite(34147)" onMouseOut="lolite()" onClick="logVariable('requestkey')" href="../_variables/requestkey.html">$requestkey</a>];
<a name="l842"><span class="linenum"> 842</span></a>  }
<a name="l843"><span class="linenum"> 843</span></a>  
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">/**</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment"> * return an array of the profile fields to send</span>
<a name="l846"><span class="linenum"> 846</span></a>  <span class="comment"> * with user information to the given mnet host.</span>
<a name="l847"><span class="linenum"> 847</span></a>  <span class="comment"> *</span>
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment"> * @param mnet_peer $peer the peer to send the information to</span>
<a name="l849"><span class="linenum"> 849</span></a>  <span class="comment"> *</span>
<a name="l850"><span class="linenum"> 850</span></a>  <span class="comment"> * @return array (like 'username', 'firstname', etc)</span>
<a name="l851"><span class="linenum"> 851</span></a>  <span class="comment"> */</span>
<a name="l852"><span class="linenum"> 852</span></a>  function <a class="function" onClick="logFunction('mnet_fields_to_send')" href="../_functions/mnet_fields_to_send.html" onMouseOver="funcPopup(event,'mnet_fields_to_send')">mnet_fields_to_send</a>(mnet_peer <a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a>) {
<a name="l853"><span class="linenum"> 853</span></a>      return <a class="function" onClick="logFunction('_mnet_field_helper')" href="../_functions/_mnet_field_helper.html" onMouseOver="funcPopup(event,'_mnet_field_helper')">_mnet_field_helper</a>(<a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a>, 'export');
<a name="l854"><span class="linenum"> 854</span></a>  }
<a name="l855"><span class="linenum"> 855</span></a>  
<a name="l856"><span class="linenum"> 856</span></a>  <span class="comment">/**</span>
<a name="l857"><span class="linenum"> 857</span></a>  <span class="comment"> * return an array of the profile fields to import</span>
<a name="l858"><span class="linenum"> 858</span></a>  <span class="comment"> * from the given host, when creating/updating user accounts</span>
<a name="l859"><span class="linenum"> 859</span></a>  <span class="comment"> *</span>
<a name="l860"><span class="linenum"> 860</span></a>  <span class="comment"> * @param mnet_peer $peer the peer we're getting the information from</span>
<a name="l861"><span class="linenum"> 861</span></a>  <span class="comment"> *</span>
<a name="l862"><span class="linenum"> 862</span></a>  <span class="comment"> * @return array (like 'username', 'firstname', etc)</span>
<a name="l863"><span class="linenum"> 863</span></a>  <span class="comment"> */</span>
<a name="l864"><span class="linenum"> 864</span></a>  function <a class="function" onClick="logFunction('mnet_fields_to_import')" href="../_functions/mnet_fields_to_import.html" onMouseOver="funcPopup(event,'mnet_fields_to_import')">mnet_fields_to_import</a>(mnet_peer <a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a>) {
<a name="l865"><span class="linenum"> 865</span></a>      return <a class="function" onClick="logFunction('_mnet_field_helper')" href="../_functions/_mnet_field_helper.html" onMouseOver="funcPopup(event,'_mnet_field_helper')">_mnet_field_helper</a>(<a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a>, 'import');
<a name="l866"><span class="linenum"> 866</span></a>  }
<a name="l867"><span class="linenum"> 867</span></a>  
<a name="l868"><span class="linenum"> 868</span></a>  <span class="comment">/**</span>
<a name="l869"><span class="linenum"> 869</span></a>  <span class="comment"> * helper for {@see mnet_fields_to_import} and {@mnet_fields_to_send}</span>
<a name="l870"><span class="linenum"> 870</span></a>  <span class="comment"> *</span>
<a name="l871"><span class="linenum"> 871</span></a>  <span class="comment"> * @access private</span>
<a name="l872"><span class="linenum"> 872</span></a>  <span class="comment"> *</span>
<a name="l873"><span class="linenum"> 873</span></a>  <span class="comment"> * @param mnet_peer $peer the peer object</span>
<a name="l874"><span class="linenum"> 874</span></a>  <span class="comment"> * @param string    $key 'import' or 'export'</span>
<a name="l875"><span class="linenum"> 875</span></a>  <span class="comment"> *</span>
<a name="l876"><span class="linenum"> 876</span></a>  <span class="comment"> * @return array (like 'username', 'firstname', etc)</span>
<a name="l877"><span class="linenum"> 877</span></a>  <span class="comment"> */</span>
<a name="l878"><span class="linenum"> 878</span></a>  function <a class="function" onClick="logFunction('_mnet_field_helper')" href="../_functions/_mnet_field_helper.html" onMouseOver="funcPopup(event,'_mnet_field_helper')">_mnet_field_helper</a>(mnet_peer <a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a>, <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>) {
<a name="l879"><span class="linenum"> 879</span></a>      <a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../_variables/tmp.html">$tmp</a> = <a class="function" onClick="logFunction('mnet_profile_field_options')" href="../_functions/mnet_profile_field_options.html" onMouseOver="funcPopup(event,'mnet_profile_field_options')">mnet_profile_field_options</a>();
<a name="l880"><span class="linenum"> 880</span></a>      <a class="var it722" onMouseOver="hilite(722)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('moodle', 'mnetprofile' . <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> . 'fields'));
<a name="l881"><span class="linenum"> 881</span></a>      if ('1' === <a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('mnet', 'host' . <a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a>-&gt;<a onClick="logVariable('id')" class="var it43657" onMouseOver="hilite(43657)" onMouseOut="lolite()" href="../_variables/id.html">id</a> . <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> . 'default')) {
<a name="l882"><span class="linenum"> 882</span></a>          return <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../_variables/tmp.html">$tmp</a>['forced'], <a class="var it722" onMouseOver="hilite(722)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a>);
<a name="l883"><span class="linenum"> 883</span></a>      }
<a name="l884"><span class="linenum"> 884</span></a>      <a class="var it34153" onMouseOver="hilite(34153)" onMouseOut="lolite()" onClick="logVariable('hostsettings')" href="../_variables/hostsettings.html">$hostsettings</a> = <a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('mnet', 'host' . <a class="var it11120" onMouseOver="hilite(11120)" onMouseOut="lolite()" onClick="logVariable('peer')" href="../_variables/peer.html">$peer</a>-&gt;<a onClick="logVariable('id')" class="var it43657" onMouseOver="hilite(43657)" onMouseOut="lolite()" href="../_variables/id.html">id</a> . <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> . 'fields');
<a name="l885"><span class="linenum"> 885</span></a>      if (false === <a class="var it34153" onMouseOver="hilite(34153)" onMouseOut="lolite()" onClick="logVariable('hostsettings')" href="../_variables/hostsettings.html">$hostsettings</a>) {
<a name="l886"><span class="linenum"> 886</span></a>          return <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../_variables/tmp.html">$tmp</a>['forced'], <a class="var it722" onMouseOver="hilite(722)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a>);
<a name="l887"><span class="linenum"> 887</span></a>      }
<a name="l888"><span class="linenum"> 888</span></a>      return <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../_variables/tmp.html">$tmp</a>['forced'], <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it34153" onMouseOver="hilite(34153)" onMouseOut="lolite()" onClick="logVariable('hostsettings')" href="../_variables/hostsettings.html">$hostsettings</a>));
<a name="l889"><span class="linenum"> 889</span></a>  }
<a name="l890"><span class="linenum"> 890</span></a>  
<a name="l891"><span class="linenum"> 891</span></a>  
<a name="l892"><span class="linenum"> 892</span></a>  <span class="comment">/**</span>
<a name="l893"><span class="linenum"> 893</span></a>  <span class="comment"> * given a user object (or array) and a list of allowed fields,</span>
<a name="l894"><span class="linenum"> 894</span></a>  <span class="comment"> * strip out all the fields that should not be included.</span>
<a name="l895"><span class="linenum"> 895</span></a>  <span class="comment"> * This can be used both for outgoing data and incoming data.</span>
<a name="l896"><span class="linenum"> 896</span></a>  <span class="comment"> *</span>
<a name="l897"><span class="linenum"> 897</span></a>  <span class="comment"> * @param mixed $user array or object representing a database record</span>
<a name="l898"><span class="linenum"> 898</span></a>  <span class="comment"> * @param array $fields an array of allowed fields (usually from mnet_fields_to_{send,import}</span>
<a name="l899"><span class="linenum"> 899</span></a>  <span class="comment"> *</span>
<a name="l900"><span class="linenum"> 900</span></a>  <span class="comment"> * @return mixed array or object, depending what type of $user object was passed (datatype is respected)</span>
<a name="l901"><span class="linenum"> 901</span></a>  <span class="comment"> */</span>
<a name="l902"><span class="linenum"> 902</span></a>  function <a class="function" onClick="logFunction('mnet_strip_user')" href="../_functions/mnet_strip_user.html" onMouseOver="funcPopup(event,'mnet_strip_user')">mnet_strip_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>) {
<a name="l903"><span class="linenum"> 903</span></a>      if (<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l904"><span class="linenum"> 904</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = (array)<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l905"><span class="linenum"> 905</span></a>          <a class="var it21422" onMouseOver="hilite(21422)" onMouseOut="lolite()" onClick="logVariable('wasobject')" href="../_variables/wasobject.html">$wasobject</a> = true; <span class="comment">// so we can cast back before we return</span>
<a name="l906"><span class="linenum"> 906</span></a>      }
<a name="l907"><span class="linenum"> 907</span></a>  
<a name="l908"><span class="linenum"> 908</span></a>      foreach (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> =&gt; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>) {
<a name="l909"><span class="linenum"> 909</span></a>          if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l910"><span class="linenum"> 910</span></a>              unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>]);
<a name="l911"><span class="linenum"> 911</span></a>          }
<a name="l912"><span class="linenum"> 912</span></a>      }
<a name="l913"><span class="linenum"> 913</span></a>      if (!empty(<a class="var it21422" onMouseOver="hilite(21422)" onMouseOut="lolite()" onClick="logVariable('wasobject')" href="../_variables/wasobject.html">$wasobject</a>)) {
<a name="l914"><span class="linenum"> 914</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = (object)<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l915"><span class="linenum"> 915</span></a>      }
<a name="l916"><span class="linenum"> 916</span></a>      return <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l917"><span class="linenum"> 917</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'get_site': ['get_site', 'Returns $course object of the top-level site. ', [['lib','datalib.php',547]], 77],
'get_mnet_environment': ['get_mnet_environment', 'helper function to load up and initialise the mnet environment this must be called before you use mnet functions. ', [['lib','moodlelib.php',9446]], 14],
'mnet_profile_field_options': ['mnet_profile_field_options', 'Return an array of information about all moodle\'s profile fields which ones are optional, which ones are forced. This is used as the basis of providing lists of profile fields to the administrator to pick which fields to import/export over MNET ', [['mnet','lib.php',592]], 3],
'mnet_fields_to_import': ['mnet_fields_to_import', 'return an array of the profile fields to import from the given host, when creating/updating user accounts ', [['mnet','lib.php',856]], 2],
'mnet_get_app_jumppath': ['mnet_get_app_jumppath', '', [['mnet','lib.php',545]], 1],
'mnet_debug': ['mnet_debug', 'Output debug information about mnet.  this will go to the <b>error_log</b>. ', [['mnet','lib.php',556]], 24],
'strlen': ['strlen', 'Counts the number of characters. Unit-tested by Kasper (single byte charsets only) ', [['lib/typo3','class.t3lib_cs.php',1520],['lib/classes','text.php',305]], 1649],
'mnet_sso_apply_indirection': ['mnet_sso_apply_indirection', 'Inline function to modify a url string so that mnet users are requested to log in at their mnet identity provider (if they are not already logged in) before ultimately being directed to the original url. ', [['mnet','lib.php',495]], 0],
'mnet_fields_to_send': ['mnet_fields_to_send', 'return an array of the profile fields to send with user information to the given mnet host. ', [['mnet','lib.php',844]], 2],
'mnet_get_hosts': ['mnet_get_hosts', 'Returns information about MNet peers ', [['mnet','lib.php',672]], 2],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'mnet_get_hostname_from_uri': ['mnet_get_hostname_from_uri', 'Strip extraneous detail from a URL or URI and return the hostname ', [['mnet','lib.php',24]], 2],
'mnet_generate_keypair': ['mnet_generate_keypair', 'Generate public/private keys and store in the config table ', [['mnet','lib.php',327]], 2],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',481]], 1488],
'set_method': ['set_method', 'Set the path to the method or function we want to execute on the remote machine. Examples: mod/scorm/functionname auth/mnet/methodname In the case of auth and enrolment plugins, an object will be created and the method on that object will be called ', [['mnet/xmlrpc','client.php',60]], 18],
'mnet_get_peer_host': ['mnet_get_peer_host', '', [['mnet','lib.php',485]], 1],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'mnet_update_sso_access_control': ['mnet_update_sso_access_control', '', [['mnet','lib.php',438]], 4],
'mnet_get_service_info': ['mnet_get_service_info', 'return an array information about services enabled for the given peer. in two modes, fulldata or very basic data. ', [['mnet','lib.php',698]], 2],
'is_proxybypass': ['is_proxybypass', 'Check if $url matches anything in proxybypass list ', [['lib','moodlelib.php',9216]], 3],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'mnet_set_public_key': ['mnet_set_public_key', 'Store a URI\'s public key in a static variable, or retrieve the key for a URI ', [['mnet','lib.php',143]], 2],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'sql_concat': ['sql_concat', '', [['lib/dml','pdo_moodle_database.php',537],['lib/dml','oci_native_moodle_database.php',1602],['lib/dml','sqlite3_pdo_moodle_database.php',361],['lib/dml','pgsql_native_moodle_database.php',1225],['lib/dml','mssql_native_moodle_database.php',1258],['lib/dml','mysqli_native_moodle_database.php',1556],['lib/dml','sqlsrv_native_moodle_database.php',1324],['lib/dml/tests','dml_test.php',5554]], 74],
'get_mnet_remote_client': ['get_mnet_remote_client', 'during xmlrpc server code execution, any code wishing to access information about the remote peer must use this to get it. ', [['lib','moodlelib.php',9463]], 19],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'mnet_sign_message': ['mnet_sign_message', 'Sign a message and return it in an XML-Signature document ', [['mnet','lib.php',164]], 2],
'mnet_encrypt_message': ['mnet_encrypt_message', 'Encrypt a message and return it in an XML-Encrypted document ', [['mnet','lib.php',228]], 2],
'mnet_get_keypair': ['mnet_get_keypair', 'Get your SSL keys from the database, or create them (if they don\'t exist yet) ', [['mnet','lib.php',303]], 1],
'mnet_strip_user': ['mnet_strip_user', 'given a user object (or array) and a list of allowed fields, strip out all the fields that should not be included. This can be used both for outgoing data and incoming data. ', [['mnet','lib.php',892]], 4],
'_mnet_field_helper': ['_mnet_field_helper', 'helper for {@see mnet_fields_to_import} and {@mnet_fields_to_send} ', [['mnet','lib.php',868]], 2],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'get_private_key': ['get_private_key', '', [['mnet','environment.php',151]], 5],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'mnet_get_public_key': ['mnet_get_public_key', 'Get the remote machine\'s SSL Cert ', [['mnet','lib.php',38]], 3],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',3012]], 1007],
'send': ['send', 'Send the request to the server - decode and return the response ', [['mnet/xmlrpc','client.php',128],['auth/cas/CAS/CAS/ProxiedService/Http','Abstract.php',126],['lib/horde/framework/Horde/Mail/Transport','Smtphorde.php',116],['auth/cas/CAS/CAS/Request','RequestInterface.php',136],['lib/horde/framework/Horde/Mail/Transport','Mock.php',91],['auth/cas/CAS/CAS/Request','MultiRequestInterface.php',75],['lib/horde/framework/Horde/Mail/Transport','Smtpmx.php',179],['lib/horde/framework/Horde/Mime','Part.php',1679],['auth/cas/CAS/CAS/Request','AbstractRequest.php',223],['lib/htmlpurifier/HTMLPurifier','ErrorCollector.php',65],['backup/util/xml/output','file_xml_output.class.php',66],['lib/jabber/XMPP','BOSH.php',150],['lib/horde/framework/Horde/Mail/Transport','Null.php',54],['lib','excellib.class.php',132],['lib/horde/framework/Horde/Mail/Transport','Smtp.php',158],['auth/cas/CAS/CAS/ProxiedService','Http.php',62],['lib/google/src/Google/Service','Gmail.php',816],['lib/google/src/Google/Service','Gmail.php',1145],['lib','odslib.class.php',84],['auth/cas/CAS/CAS/Request','CurlMultiRequest.php',99],['lib/horde/framework/Horde/Mime','Mail.php',372],['mod/lti/classes/local/ltiservice','response.php',205],['lib/horde/framework/Horde/Mail/Transport','Mail.php',60],['lib/phpmailer','class.phpmailer.php',1168],['backup/util/xml/output','memory_xml_output.class.php',59],['lib/jabber/XMPP','XMLStream.php',677],['lib/pear/Auth','RADIUS.php',380],['lib/horde/framework/Horde/Mail/Transport','Sendmail.php',89]], 193],
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',840]], 332],
'preg_match': ['preg_match', '', [], 1286],
'curl_setopt': ['curl_setopt', '', [], 143],
'xmlrpc_encode_request': ['xmlrpc_encode_request', '', [], 5],
'curl_exec': ['curl_exec', '', [], 19],
'curl_errno': ['curl_errno', '', [], 14],
'openssl_seal': ['openssl_seal', '', [], 1],
'openssl_x509_export': ['openssl_x509_export', '', [], 1],
'sha1': ['sha1', '', [], 186],
'array_key_exists': ['array_key_exists', '', [], 1445],
'openssl_csr_sign': ['openssl_csr_sign', '', [], 2],
'openssl_pkey_get_private': ['openssl_pkey_get_private', '', [], 10],
'preg_replace': ['preg_replace', '', [], 917],
'openssl_pkey_new': ['openssl_pkey_new', '', [], 2],
'array_merge': ['array_merge', '', [], 2944],
'urlencode': ['urlencode', '', [], 200],
'defined': ['defined', '', [], 4731],
'openssl_pkey_export': ['openssl_pkey_export', '', [], 2],
'gettype': ['gettype', '', [], 266],
'xmlrpc_decode': ['xmlrpc_decode', '', [], 6],
'curl_init': ['curl_init', '', [], 18],
'is_object': ['is_object', '', [], 544],
'parse_url': ['parse_url', '', [], 55],
'curl_getinfo': ['curl_getinfo', '', [], 11],
'in_array': ['in_array', '', [], 1234],
'substr': ['substr', '', [], 2823],
'openssl_pkey_get_public': ['openssl_pkey_get_public', '', [], 4],
'openssl_csr_new': ['openssl_csr_new', '', [], 2],
'explode': ['explode', '', [], 1572],
'openssl_sign': ['openssl_sign', '', [], 6],
'strtolower': ['strtolower', '', [], 817],
'openssl_x509_free': ['openssl_x509_free', '', [], 2],
'time': ['time', '', [], 1959],
'openssl_pkey_free': ['openssl_pkey_free', '', [], 2],
'define': ['define', '', [], 2373],
'array_values': ['array_values', '', [], 342],
'trim': ['trim', '', [], 1948],
'openssl_x509_parse': ['openssl_x509_parse', '', [], 4],
'is_array': ['is_array', '', [], 1608],
'array_pop': ['array_pop', '', [], 483],
'strpos': ['strpos', '', [], 1604],
'error_log': ['error_log', '', [], 90],
'curl_close': ['curl_close', '', [], 18],
'base64_encode': ['base64_encode', '', [], 134],
'is_null': ['is_null', '', [], 2003]};
CLASS_DATA={
'mnet_access_control_updated': ['mnet_access_control_updated', 'Mnet access control updated event class. ', [['lib/classes/event','mnet_access_control_updated.php',30]], 1],
'core_text': ['core_text', 'defines string api\'s for manipulating strings ', [['lib/classes','text.php',27]], 566],
'mnet_xmlrpc_client': ['mnet_xmlrpc_client', 'Class representing an XMLRPC request against a remote machine ', [['mnet/xmlrpc','client.php',13]], 17],
'mnet_access_control_created': ['mnet_access_control_created', 'Mnet access control created event class. ', [['lib/classes/event','mnet_access_control_created.php',30]], 1],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147]};
CONST_DATA={
'MNET_SERVER': ['MNET_SERVER', '', [['mnet/xmlrpc','server.php',18]], 5],
'RPC_NOSUCHCLASS': ['RPC_NOSUCHCLASS', '', [['mnet','lib.php',18]], 1],
'RPC_OK': ['RPC_OK', '', [['mnet','lib.php',16]], 1],
'RPC_FORBIDDENFUNCTION': ['RPC_FORBIDDENFUNCTION', '', [['mnet','lib.php',20]], 1],
'RPC_FORBIDDENMETHOD': ['RPC_FORBIDDENMETHOD', '', [['mnet','lib.php',22]], 1],
'RPC_NOSUCHMETHOD': ['RPC_NOSUCHMETHOD', '', [['mnet','lib.php',21]], 1],
'RPC_NOSUCHFUNCTION': ['RPC_NOSUCHFUNCTION', '', [['mnet','lib.php',19]], 1],
'IGNORE_MULTIPLE': ['IGNORE_MULTIPLE', '', [['lib','dmllib.php',50]], 43],
'RPC_NOSUCHFILE': ['RPC_NOSUCHFILE', '', [['mnet','lib.php',17]], 1]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
