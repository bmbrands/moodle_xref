<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : Detail view of lib.php</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='repository';
filename='lib.php.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="details-heading"><a href="./index.html">/repository/</a> -> <a href="lib.php.source.html">lib.php</a> (summary)</h2>
<div class="details-summary">
<p class="viewlinks">[<a href="lib.php.source.html">Source view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="../_stats.html">Project Stats</a>]</p>
<p><b>This file contains classes used to manage the repository plugins in Moodle</b></p>
<table>
<tr><td align="right">Copyright: </td><td>2009 Dongsheng Cai {@link http://dongsheng.org}</td></tr>
<tr><td align="right">License: </td><td><a href="http://www.gnu.org/copyleft/gpl.html" target="_blank">http://www.gnu.org/copyleft/gpl.html</a> GNU GPL v3 or later</td></tr>
<tr><td align="right">File Size: </td><td>3183 lines (125 kb)</td></tr>
<tr><td align="right">Included or required: </td><td><a href="lib.php.xref.html">2 times</a></td></tr>
<tr><td align="right" valign="top">Referenced: </td><td>25 times</td></tr>
<tr><td align="right" valign="top">Includes or requires: </td><td>0 files</td></tr>
</table>
<h3>Defines 2 classes</h3>
<div class="inset">
<p><b>repository_type::</b> (94 methods):<br>
&nbsp;&nbsp;<a href="#get_contextvisibility">get_contextvisibility</a>()<br>
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#get_typename">get_typename</a>()<br>
&nbsp;&nbsp;<a href="#get_readablename">get_readablename</a>()<br>
&nbsp;&nbsp;<a href="#get_options">get_options</a>()<br>
&nbsp;&nbsp;<a href="#get_visible">get_visible</a>()<br>
&nbsp;&nbsp;<a href="#get_sortorder">get_sortorder</a>()<br>
&nbsp;&nbsp;<a href="#create">create</a>()<br>
&nbsp;&nbsp;<a href="#update_options">update_options</a>()<br>
&nbsp;&nbsp;<a href="#update_visible">update_visible</a>()<br>
&nbsp;&nbsp;<a href="#update_sortorder">update_sortorder</a>()<br>
&nbsp;&nbsp;<a href="#move_order">move_order</a>()<br>
&nbsp;&nbsp;<a href="#update_visibility">update_visibility</a>()<br>
&nbsp;&nbsp;<a href="#delete">delete</a>()<br>
&nbsp;&nbsp;<a href="#prepare_to_cache">prepare_to_cache</a>()<br>
&nbsp;&nbsp;<a href="#wake_from_cache">wake_from_cache</a>()<br>
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#get_repository_by_id">get_repository_by_id</a>()<br>
&nbsp;&nbsp;<a href="#get_typename">get_typename</a>()<br>
&nbsp;&nbsp;<a href="#get_type_by_typename">get_type_by_typename</a>()<br>
&nbsp;&nbsp;<a href="#get_type_by_id">get_type_by_id</a>()<br>
&nbsp;&nbsp;<a href="#get_types">get_types</a>()<br>
&nbsp;&nbsp;<a href="#check_capability">check_capability</a>()<br>
&nbsp;&nbsp;<a href="#draftfile_exists">draftfile_exists</a>()<br>
&nbsp;&nbsp;<a href="#get_moodle_file">get_moodle_file</a>()<br>
&nbsp;&nbsp;<a href="#file_is_accessible">file_is_accessible</a>()<br>
&nbsp;&nbsp;<a href="#copy_to_area">copy_to_area</a>()<br>
&nbsp;&nbsp;<a href="#get_unused_filename">get_unused_filename</a>()<br>
&nbsp;&nbsp;<a href="#append_suffix">append_suffix</a>()<br>
&nbsp;&nbsp;<a href="#get_editable_types">get_editable_types</a>()<br>
&nbsp;&nbsp;<a href="#get_instances">get_instances</a>()<br>
&nbsp;&nbsp;<a href="#get_instance">get_instance</a>()<br>
&nbsp;&nbsp;<a href="#static_function">static_function</a>()<br>
&nbsp;&nbsp;<a href="#antivir_scan_file">antivir_scan_file</a>()<br>
&nbsp;&nbsp;<a href="#send_file">send_file</a>()<br>
&nbsp;&nbsp;<a href="#get_reference_details">get_reference_details</a>()<br>
&nbsp;&nbsp;<a href="#cache_file_by_reference">cache_file_by_reference</a>()<br>
&nbsp;&nbsp;<a href="#get_file_source_info">get_file_source_info</a>()<br>
&nbsp;&nbsp;<a href="#move_to_filepool">move_to_filepool</a>()<br>
&nbsp;&nbsp;<a href="#build_tree">build_tree</a>()<br>
&nbsp;&nbsp;<a href="#display_instances_list">display_instances_list</a>()<br>
&nbsp;&nbsp;<a href="#get_file_reference">get_file_reference</a>()<br>
&nbsp;&nbsp;<a href="#prepare_file">prepare_file</a>()<br>
&nbsp;&nbsp;<a href="#has_moodle_files">has_moodle_files</a>()<br>
&nbsp;&nbsp;<a href="#get_link">get_link</a>()<br>
&nbsp;&nbsp;<a href="#get_file">get_file</a>()<br>
&nbsp;&nbsp;<a href="#import_external_file_contents">import_external_file_contents</a>()<br>
&nbsp;&nbsp;<a href="#get_file_size">get_file_size</a>()<br>
&nbsp;&nbsp;<a href="#is_visible">is_visible</a>()<br>
&nbsp;&nbsp;<a href="#can_be_edited_by_user">can_be_edited_by_user</a>()<br>
&nbsp;&nbsp;<a href="#get_name">get_name</a>()<br>
&nbsp;&nbsp;<a href="#contains_private_data">contains_private_data</a>()<br>
&nbsp;&nbsp;<a href="#supported_filetypes">supported_filetypes</a>()<br>
&nbsp;&nbsp;<a href="#supported_returntypes">supported_returntypes</a>()<br>
&nbsp;&nbsp;<a href="#get_meta">get_meta</a>()<br>
&nbsp;&nbsp;<a href="#create">create</a>()<br>
&nbsp;&nbsp;<a href="#delete">delete</a>()<br>
&nbsp;&nbsp;<a href="#delete_all_for_context">delete_all_for_context</a>()<br>
&nbsp;&nbsp;<a href="#hide">hide</a>()<br>
&nbsp;&nbsp;<a href="#set_option">set_option</a>()<br>
&nbsp;&nbsp;<a href="#get_option">get_option</a>()<br>
&nbsp;&nbsp;<a href="#filter">filter</a>()<br>
&nbsp;&nbsp;<a href="#get_listing">get_listing</a>()<br>
&nbsp;&nbsp;<a href="#prepare_breadcrumb">prepare_breadcrumb</a>()<br>
&nbsp;&nbsp;<a href="#prepare_list">prepare_list</a>()<br>
&nbsp;&nbsp;<a href="#prepare_listing">prepare_listing</a>()<br>
&nbsp;&nbsp;<a href="#search">search</a>()<br>
&nbsp;&nbsp;<a href="#logout">logout</a>()<br>
&nbsp;&nbsp;<a href="#check_login">check_login</a>()<br>
&nbsp;&nbsp;<a href="#print_login">print_login</a>()<br>
&nbsp;&nbsp;<a href="#print_search">print_search</a>()<br>
&nbsp;&nbsp;<a href="#callback">callback</a>()<br>
&nbsp;&nbsp;<a href="#global_search">global_search</a>()<br>
&nbsp;&nbsp;<a href="#cron">cron</a>()<br>
&nbsp;&nbsp;<a href="#plugin_init">plugin_init</a>()<br>
&nbsp;&nbsp;<a href="#type_config_form">type_config_form</a>()<br>
&nbsp;&nbsp;<a href="#type_form_validation">type_form_validation</a>()<br>
&nbsp;&nbsp;<a href="#instance_config_form">instance_config_form</a>()<br>
&nbsp;&nbsp;<a href="#get_type_option_names">get_type_option_names</a>()<br>
&nbsp;&nbsp;<a href="#get_instance_option_names">get_instance_option_names</a>()<br>
&nbsp;&nbsp;<a href="#instance_form_validation">instance_form_validation</a>()<br>
&nbsp;&nbsp;<a href="#get_short_filename">get_short_filename</a>()<br>
&nbsp;&nbsp;<a href="#overwrite_existing_draftfile">overwrite_existing_draftfile</a>()<br>
&nbsp;&nbsp;<a href="#update_draftfile">update_draftfile</a>()<br>
&nbsp;&nbsp;<a href="#delete_tempfile_from_draft">delete_tempfile_from_draft</a>()<br>
&nbsp;&nbsp;<a href="#convert_references_to_local">convert_references_to_local</a>()<br>
&nbsp;&nbsp;<a href="#reset_caches">reset_caches</a>()<br>
&nbsp;&nbsp;<a href="#sync_external_file">sync_external_file</a>()<br>
&nbsp;&nbsp;<a href="#sync_reference">sync_reference</a>()<br>
&nbsp;&nbsp;<a href="#build_source_field">build_source_field</a>()<br>
&nbsp;&nbsp;<a href="#prepare_to_cache">prepare_to_cache</a>()<br>
&nbsp;&nbsp;<a href="#wake_from_cache">wake_from_cache</a>()<br>
&nbsp;&nbsp;<a href="#send_relative_file">send_relative_file</a>()<br>
&nbsp;&nbsp;<a href="#supports_relative_file">supports_relative_file</a>()<br>
</p>
<p><b>repository_exception::</b> (6 methods):<br>
&nbsp;&nbsp;<a href="#add_defaults">add_defaults</a>()<br>
&nbsp;&nbsp;<a href="#definition">definition</a>()<br>
&nbsp;&nbsp;<a href="#validation">validation</a>()<br>
&nbsp;&nbsp;<a href="#definition">definition</a>()<br>
&nbsp;&nbsp;<a href="#validation">validation</a>()<br>
&nbsp;&nbsp;<a href="#initialise_filepicker">initialise_filepicker</a>()<br>
</p>
</div>
</div>
<br><div class="details-funclist">
<div class="details-classinfo">
<p class="details-classtitle">Class: <a name="repository_type"><b>repository_type</b></a>&nbsp;&nbsp;- <a href="../_classes/repository_type.html"><small>X-Ref</small></a>
</p>
<b>This class is used to manage repository plugins<BR>
</b><br>
A repository_type is a repository plug-in. It can be Box.net, Flick-r, ...<BR>
A repository type can be edited, sorted and hidden. It is mandatory for an<BR>
administrator to create a repository type in order to be able to create<BR>
some instances of this type.<BR>
Coding note:<BR>
- a repository_type object is mapped to the &quot;repository&quot; database table<BR>
- &quot;typename&quot; attibut maps the &quot;type&quot; database field. It is unique.<BR>
- general &quot;options&quot; for a repository type are saved in the config_plugin table<BR>
- when you delete a repository, all instances are deleted, and general<BR>
options are also deleted from database<BR>
- When you create a type for a plugin that can't have multiple instances, a<BR>
instance is automatically created.<BR>
<BR>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_contextvisibility" onClick="logFunction('get_contextvisibility', 'lib.php.source.html#l91')" href="lib.php.source.html#l91">get_contextvisibility</a>(<a href="../_variables/context.html">$context</a>)&nbsp;&nbsp;
<a href="../_functions/get_contextvisibility.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return if the instance is visible in a context<BR>
</b><BR><b>param:</b> stdClass $context context<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'lib.php.source.html#l116')" href="lib.php.source.html#l116">__construct</a>(<a href="../_variables/typename.html">$typename</a> = '', <a href="../_variables/typeoptions.html">$typeoptions</a> = array()&nbsp;&nbsp;
<a href="../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>repository_type constructor<BR>
</b><BR><b>param:</b> int $typename<br>
<b>param:</b> array $typeoptions<br>
<b>param:</b> bool $visible<br>
<b>param:</b> int $sortorder (don't really need set, it will be during create() call)<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_typename" onClick="logFunction('get_typename', 'lib.php.source.html#l160')" href="lib.php.source.html#l160">get_typename</a>()&nbsp;&nbsp;
<a href="../_functions/get_typename.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get the type name (no whitespace)<BR>
For a human readable name, use get_readablename()<BR>
</b><BR><b>return:</b> string the type name<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_readablename" onClick="logFunction('get_readablename', 'lib.php.source.html#l170')" href="lib.php.source.html#l170">get_readablename</a>()&nbsp;&nbsp;
<a href="../_functions/get_readablename.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return a human readable and user-friendly type name<BR>
</b><BR><b>return:</b> string user-friendly type name<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_options" onClick="logFunction('get_options', 'lib.php.source.html#l179')" href="lib.php.source.html#l179">get_options</a>()&nbsp;&nbsp;
<a href="../_functions/get_options.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return general options<BR>
</b><BR><b>return:</b> array the general options<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_visible" onClick="logFunction('get_visible', 'lib.php.source.html#l188')" href="lib.php.source.html#l188">get_visible</a>()&nbsp;&nbsp;
<a href="../_functions/get_visible.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return visibility<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_sortorder" onClick="logFunction('get_sortorder', 'lib.php.source.html#l197')" href="lib.php.source.html#l197">get_sortorder</a>()&nbsp;&nbsp;
<a href="../_functions/get_sortorder.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return order / position of display in the file picker<BR>
</b><BR><b>return:</b> int<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="create" onClick="logFunction('create', 'lib.php.source.html#l206')" href="lib.php.source.html#l206">create</a>(<a href="../_variables/silent.html">$silent</a> = false)&nbsp;&nbsp;
<a href="../_functions/create.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Create a repository type (the type name must not already exist)<BR>
</b><BR><b>param:</b> bool $silent throw exception?<br>
<b>return:</b> mixed return int if create successfully, return false if<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_options" onClick="logFunction('update_options', 'lib.php.source.html#l282')" href="lib.php.source.html#l282">update_options</a>(<a href="../_variables/options.html">$options</a> = null)&nbsp;&nbsp;
<a href="../_functions/update_options.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Update plugin options into the config_plugin table<BR>
</b><BR><b>param:</b> array $options<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_visible" onClick="logFunction('update_visible', 'lib.php.source.html#l316')" href="lib.php.source.html#l316">update_visible</a>(<a href="../_variables/visible.html">$visible</a> = null)&nbsp;&nbsp;
<a href="../_functions/update_visible.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Update visible database field with the value given as parameter<BR>
or with the visible value of this object<BR>
This function is private.<BR>
For public access, have a look to switch_and_update_visibility()<BR>
</b><BR><b>param:</b> bool $visible<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_sortorder" onClick="logFunction('update_sortorder', 'lib.php.source.html#l339')" href="lib.php.source.html#l339">update_sortorder</a>(<a href="../_variables/sortorder.html">$sortorder</a> = null)&nbsp;&nbsp;
<a href="../_functions/update_sortorder.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Update database sortorder field with the value given as parameter<BR>
or with the sortorder value of this object<BR>
This function is private.<BR>
For public access, have a look to move_order()<BR>
</b><BR><b>param:</b> int $sortorder<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="move_order" onClick="logFunction('move_order', 'lib.php.source.html#l364')" href="lib.php.source.html#l364">move_order</a>(<a href="../_variables/move.html">$move</a>)&nbsp;&nbsp;
<a href="../_functions/move_order.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Change order of the type with its adjacent upper or downer type<BR>
(database fields are updated)<BR>
Algorithm details:<BR>
1. retrieve all types in an array. This array is sorted by sortorder,<BR>
and the array keys start from 0 to X (incremented by 1)<BR>
2. switch sortorder values of this type and its adjacent type<BR>
</b><BR><b>param:</b> string $move &quot;up&quot; or &quot;down&quot;<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_visibility" onClick="logFunction('update_visibility', 'lib.php.source.html#l410')" href="lib.php.source.html#l410">update_visibility</a>(<a href="../_variables/visible.html">$visible</a> = null)&nbsp;&nbsp;
<a href="../_functions/update_visibility.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>1. Change visibility to the value chosen<BR>
2. Update the type<BR>
</b><BR><b>param:</b> bool $visible<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="delete" onClick="logFunction('delete', 'lib.php.source.html#l427')" href="lib.php.source.html#l427">delete</a>(<a href="../_variables/downloadcontents.html">$downloadcontents</a> = false)&nbsp;&nbsp;
<a href="../_functions/delete.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Delete a repository_type (general options are removed from config_plugin<BR>
table, and all instances are deleted)<BR>
</b><BR><b>param:</b> bool $downloadcontents download external contents if exist<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="prepare_to_cache" onClick="logFunction('prepare_to_cache', 'lib.php.source.html#l461')" href="lib.php.source.html#l461">prepare_to_cache</a>()&nbsp;&nbsp;
<a href="../_functions/prepare_to_cache.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Prepares the repository type to be cached. Implements method from cacheable_object interface.<BR>
</b><BR><b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="wake_from_cache" onClick="logFunction('wake_from_cache', 'lib.php.source.html#l475')" href="lib.php.source.html#l475">wake_from_cache</a>(<a href="../_variables/data.html">$data</a>)&nbsp;&nbsp;
<a href="../_functions/wake_from_cache.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Restores repository type from cache. Implements method from cacheable_object interface.<BR>
</b><BR><b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'lib.php.source.html#l533')" href="lib.php.source.html#l533">__construct</a>(<a href="../_variables/repositoryid.html">$repositoryid</a>, <a href="../_variables/context.html">$context</a> = SYSCONTEXTID, <a href="../_variables/options.html">$options</a> = array()&nbsp;&nbsp;
<a href="../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Constructor<BR>
</b><BR><b>param:</b> int $repositoryid repository instance id<br>
<b>param:</b> int|stdClass $context a context id or context object<br>
<b>param:</b> array $options repository options<br>
<b>param:</b> int $readonly indicate this repo is readonly or not<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_repository_by_id" onClick="logFunction('get_repository_by_id', 'lib.php.source.html#l573')" href="lib.php.source.html#l573">get_repository_by_id</a>(<a href="../_variables/repositoryid.html">$repositoryid</a>, <a href="../_variables/context.html">$context</a>, <a href="../_variables/options.html">$options</a> = array()&nbsp;&nbsp;
<a href="../_functions/get_repository_by_id.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get repository instance using repository id<BR>
</b><BR>Note that this function does not check permission to access repository contents<BR>
<BR>
<b>param:</b> int $repositoryid repository instance ID<br>
<b>param:</b> context|int $context context instance or context ID where this repository will be used<br>
<b>param:</b> array $options additional repository options<br>
<b>return:</b> repository<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_typename" onClick="logFunction('get_typename', 'lib.php.source.html#l629')" href="lib.php.source.html#l629">get_typename</a>()&nbsp;&nbsp;
<a href="../_functions/get_typename.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns the type name of the repository.<BR>
</b><BR><b>return:</b> string type name of the repository.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_type_by_typename" onClick="logFunction('get_type_by_typename', 'lib.php.source.html#l647')" href="lib.php.source.html#l647">get_type_by_typename</a>(<a href="../_variables/typename.html">$typename</a>)&nbsp;&nbsp;
<a href="../_functions/get_type_by_typename.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get a repository type object by a given type name.<BR>
</b><BR><b>param:</b> string $typename the repository type name<br>
<b>return:</b> repository_type|bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_type_by_id" onClick="logFunction('get_type_by_id', 'lib.php.source.html#l668')" href="lib.php.source.html#l668">get_type_by_id</a>(<a href="../_variables/id.html">$id</a>)&nbsp;&nbsp;
<a href="../_functions/get_type_by_id.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get the repository type by a given repository type id.<BR>
</b><BR><b>param:</b> int $id the type id<br>
<b>return:</b> object<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_types" onClick="logFunction('get_types', 'lib.php.source.html#l689')" href="lib.php.source.html#l689">get_types</a>(<a href="../_variables/visible.html">$visible</a>=null)&nbsp;&nbsp;
<a href="../_functions/get_types.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return all repository types ordered by sortorder field<BR>
first repository type in returnedarray[0], second repository type in returnedarray[1], ...<BR>
</b><BR><b>param:</b> bool $visible can return types by visiblity, return all types if null<br>
<b>return:</b> array Repository types<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="check_capability" onClick="logFunction('check_capability', 'lib.php.source.html#l738')" href="lib.php.source.html#l738">check_capability</a>()&nbsp;&nbsp;
<a href="../_functions/check_capability.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Checks if user has a capability to view the current repository.<BR>
</b><BR><b>return:</b> bool true when the user can, otherwise throws an exception.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="draftfile_exists" onClick="logFunction('draftfile_exists', 'lib.php.source.html#l796')" href="lib.php.source.html#l796">draftfile_exists</a>(<a href="../_variables/itemid.html">$itemid</a>, <a href="../_variables/filepath.html">$filepath</a>, <a href="../_variables/filename.html">$filename</a>)&nbsp;&nbsp;
<a href="../_functions/draftfile_exists.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Check if file already exists in draft area.<BR>
</b><BR><b>param:</b> int $itemid of the draft area.<br>
<b>param:</b> string $filepath path to the file.<br>
<b>param:</b> string $filename file name.<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_moodle_file" onClick="logFunction('get_moodle_file', 'lib.php.source.html#l812')" href="lib.php.source.html#l812">get_moodle_file</a>(<a href="../_variables/reference.html">$reference</a>)&nbsp;&nbsp;
<a href="../_functions/get_moodle_file.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Parses the moodle file reference and returns an instance of stored_file<BR>
</b><BR><b>param:</b> string $reference reference to the moodle internal file as retruned by<br>
<b>return:</b> stored_file|null<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="file_is_accessible" onClick="logFunction('file_is_accessible', 'lib.php.source.html#l826')" href="lib.php.source.html#l826">file_is_accessible</a>(<a href="../_variables/source.html">$source</a>)&nbsp;&nbsp;
<a href="../_functions/file_is_accessible.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Repository method to make sure that user can access particular file.<BR>
</b><BR>This is checked when user tries to pick the file from repository to deal with<BR>
potential parameter substitutions is request<BR>
<BR>
<b>param:</b> string $source source of the file, returned by repository as 'source' and received back from user (not cleaned)<br>
<b>return:</b> bool whether the file is accessible by current user<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="copy_to_area" onClick="logFunction('copy_to_area', 'lib.php.source.html#l852')" href="lib.php.source.html#l852">copy_to_area</a>(<a href="../_variables/source.html">$source</a>, <a href="../_variables/filerecord.html">$filerecord</a>, <a href="../_variables/maxbytes.html">$maxbytes</a> = -1, <a href="../_variables/areamaxbytes.html">$areamaxbytes</a> = FILE_AREA_MAX_BYTES_UNLIMITED)&nbsp;&nbsp;
<a href="../_functions/copy_to_area.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>This function is used to copy a moodle file to draft area.<BR>
</b><BR>It DOES NOT check if the user is allowed to access this file because the actual file<BR>
can be located in the area where user does not have access to but there is an alias<BR>
to this file in the area where user CAN access it.<BR>
{@link file_is_accessible} should be called for alias location before calling this function.<BR>
<BR>
<b>param:</b> string $source The metainfo of file, it is base64 encoded php serialized data<br>
<b>param:</b> stdClass|array $filerecord contains itemid, filepath, filename and optionally other<br>
<b>param:</b> int $maxbytes maximum allowed size of file, -1 if unlimited. If size of file exceeds<br>
<b>param:</b> int $areamaxbytes the maximum size of the area. A file_exception is thrown if the<br>
<b>return:</b> array The information about the created file<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_unused_filename" onClick="logFunction('get_unused_filename', 'lib.php.source.html#l927')" href="lib.php.source.html#l927">get_unused_filename</a>(<a href="../_variables/itemid.html">$itemid</a>, <a href="../_variables/filepath.html">$filepath</a>, <a href="../_variables/filename.html">$filename</a>)&nbsp;&nbsp;
<a href="../_functions/get_unused_filename.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get an unused filename from the current draft area.<BR>
</b><BR>Will check if the file ends with ([0-9]) and increase the number.<BR>
<BR>
<b>param:</b> int $itemid draft item ID.<br>
<b>param:</b> string $filepath path to the file.<br>
<b>param:</b> string $filename name of the file.<br>
<b>return:</b> string an unused file name.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="append_suffix" onClick="logFunction('append_suffix', 'lib.php.source.html#l945')" href="lib.php.source.html#l945">append_suffix</a>(<a href="../_variables/filename.html">$filename</a>)&nbsp;&nbsp;
<a href="../_functions/append_suffix.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Append a suffix to filename.<BR>
</b><BR><b>param:</b> string $filename<br>
<b>return:</b> string<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_editable_types" onClick="logFunction('get_editable_types', 'lib.php.source.html#l964')" href="lib.php.source.html#l964">get_editable_types</a>(<a href="../_variables/context.html">$context</a> = null)&nbsp;&nbsp;
<a href="../_functions/get_editable_types.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return all types that you a user can create/edit and which are also visible<BR>
Note: Mostly used in order to know if at least one editable type can be set<BR>
</b><BR><b>param:</b> stdClass $context the context for which we want the editable types<br>
<b>return:</b> array types<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_instances" onClick="logFunction('get_instances', 'lib.php.source.html#l991')" href="lib.php.source.html#l991">get_instances</a>(<a href="../_variables/args.html">$args</a> = array()&nbsp;&nbsp;
<a href="../_functions/get_instances.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return repository instances<BR>
</b><BR><b>param:</b> array $args Array containing the following keys:<br>
<b>return:</b> array repository instances<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_instance" onClick="logFunction('get_instance', 'lib.php.source.html#l1135')" href="lib.php.source.html#l1135">get_instance</a>(<a href="../_variables/id.html">$id</a>)&nbsp;&nbsp;
<a href="../_functions/get_instance.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get single repository instance for administrative actions<BR>
</b><BR>Do not use this function to access repository contents, because it<BR>
does not set the current context<BR>
<BR>
<b>param:</b> integer $id repository instance id<br>
<b>return:</b> repository<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="static_function" onClick="logFunction('static_function', 'lib.php.source.html#l1151')" href="lib.php.source.html#l1151">static_function</a>(<a href="../_variables/plugin.html">$plugin</a>, <a href="../_variables/function.html">$function</a>)&nbsp;&nbsp;
<a href="../_functions/static_function.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Call a static function. Any additional arguments than plugin and function will be passed through.<BR>
</b><BR><b>param:</b> string $plugin repository plugin name<br>
<b>param:</b> string $function function name<br>
<b>return:</b> mixed<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="antivir_scan_file" onClick="logFunction('antivir_scan_file', 'lib.php.source.html#l1181')" href="lib.php.source.html#l1181">antivir_scan_file</a>(<a href="../_variables/thefile.html">$thefile</a>, <a href="../_variables/filename.html">$filename</a>, <a href="../_variables/deleteinfected.html">$deleteinfected</a>)&nbsp;&nbsp;
<a href="../_functions/antivir_scan_file.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Scan file, throws exception in case of infected file.<BR>
</b><BR>Please note that the scanning engine must be able to access the file,<BR>
permissions of the file are not modified here!<BR>
<BR>
<b>param:</b> string $thefile<br>
<b>param:</b> string $filename name of the file<br>
<b>param:</b> bool $deleteinfected<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="send_file" onClick="logFunction('send_file', 'lib.php.source.html#l1256')" href="lib.php.source.html#l1256">send_file</a>(<a href="../_variables/storedfile.html">$storedfile</a>, <a href="../_variables/lifetime.html">$lifetime</a>=null , <a href="../_variables/filter.html">$filter</a>=0, <a href="../_variables/forcedownload.html">$forcedownload</a>=false, array <a href="../_variables/options.html">$options</a> = null)&nbsp;&nbsp;
<a href="../_functions/send_file.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Repository method to serve the referenced file<BR>
</b><BR><b>param:</b> stored_file $storedfile the file that contains the reference<br>
<b>param:</b> int $lifetime Number of seconds before the file should expire from caches (null means $CFG-&gt;filelifetime)<br>
<b>param:</b> int $filter 0 (default)=no filtering, 1=all files, 2=html files only<br>
<b>param:</b> bool $forcedownload If true (default false), forces download of file rather than view in browser/plugin<br>
<b>param:</b> array $options additional options affecting the file serving<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_reference_details" onClick="logFunction('get_reference_details', 'lib.php.source.html#l1292')" href="lib.php.source.html#l1292">get_reference_details</a>(<a href="../_variables/reference.html">$reference</a>, <a href="../_variables/filestatus.html">$filestatus</a> = 0)&nbsp;&nbsp;
<a href="../_functions/get_reference_details.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return human readable reference information<BR>
</b><BR><b>param:</b> string $reference value of DB field files_reference.reference<br>
<b>param:</b> int $filestatus status of the file, 0 - ok, 666 - source missing<br>
<b>return:</b> string<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="cache_file_by_reference" onClick="logFunction('cache_file_by_reference', 'lib.php.source.html#l1327')" href="lib.php.source.html#l1327">cache_file_by_reference</a>(<a href="../_variables/reference.html">$reference</a>, <a href="../_variables/storedfile.html">$storedfile</a>)&nbsp;&nbsp;
<a href="../_functions/cache_file_by_reference.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Cache file from external repository by reference<BR>
{@link repository::get_file_reference()}<BR>
{@link repository::get_file()}<BR>
Invoked at MOODLE/repository/repository_ajax.php<BR>
</b><BR><b>param:</b> string $reference this reference is generated by<br>
<b>param:</b> stored_file $storedfile created file reference<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_file_source_info" onClick="logFunction('get_file_source_info', 'lib.php.source.html#l1340')" href="lib.php.source.html#l1340">get_file_source_info</a>(<a href="../_variables/source.html">$source</a>)&nbsp;&nbsp;
<a href="../_functions/get_file_source_info.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return the source information<BR>
</b><BR>The result of the function is stored in files.source field. It may be analysed<BR>
when the source file is lost or repository may use it to display human-readable<BR>
location of reference original.<BR>
<BR>
This method is called when file is picked for the first time only. When file<BR>
(either copy or a reference) is already in moodle and it is being picked<BR>
again to another file area (also as a copy or as a reference), the value of<BR>
files.source is copied.<BR>
<BR>
<b>param:</b> string $source source of the file, returned by repository as 'source' and received back from user (not cleaned)<br>
<b>return:</b> string|null<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="move_to_filepool" onClick="logFunction('move_to_filepool', 'lib.php.source.html#l1363')" href="lib.php.source.html#l1363">move_to_filepool</a>(<a href="../_variables/thefile.html">$thefile</a>, <a href="../_variables/record.html">$record</a>)&nbsp;&nbsp;
<a href="../_functions/move_to_filepool.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Move file from download folder to file pool using FILE API<BR>
</b><BR><b>param:</b> string $thefile file path in download folder<br>
<b>param:</b> stdClass $record<br>
<b>return:</b> array containing the following keys:<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="build_tree" onClick="logFunction('build_tree', 'lib.php.source.html#l1420')" href="lib.php.source.html#l1420">build_tree</a>(<a href="../_variables/fileinfo.html">$fileinfo</a>, <a href="../_variables/search.html">$search</a>, <a href="../_variables/dynamicmode.html">$dynamicmode</a>, &amp;<a href="../_variables/list.html">$list</a>)&nbsp;&nbsp;
<a href="../_functions/build_tree.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Builds a tree of files This function is then called recursively.<BR>
</b><BR><b>param:</b> file_info $fileinfo an object returned by file_browser::get_file_info()<br>
<b>param:</b> string $search searched string<br>
<b>param:</b> bool $dynamicmode no recursive call is done when in dynamic mode<br>
<b>param:</b> array $list the array containing the files under the passed $fileinfo<br>
<b>return:</b> int the number of files found<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="display_instances_list" onClick="logFunction('display_instances_list', 'lib.php.source.html#l1506')" href="lib.php.source.html#l1506">display_instances_list</a>(<a href="../_variables/context.html">$context</a>, <a href="../_variables/typename.html">$typename</a> = null)&nbsp;&nbsp;
<a href="../_functions/display_instances_list.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Display a repository instance list (with edit/delete/create links)<BR>
</b><BR><b>param:</b> stdClass $context the context for which we display the instance<br>
<b>param:</b> string $typename if set, we display only one type of instance<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_file_reference" onClick="logFunction('get_file_reference', 'lib.php.source.html#l1636')" href="lib.php.source.html#l1636">get_file_reference</a>(<a href="../_variables/source.html">$source</a>)&nbsp;&nbsp;
<a href="../_functions/get_file_reference.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Prepare file reference information<BR>
</b><BR><b>param:</b> string $source source of the file, returned by repository as 'source' and received back from user (not cleaned)<br>
<b>return:</b> string file reference, ready to be stored<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="prepare_file" onClick="logFunction('prepare_file', 'lib.php.source.html#l1665')" href="lib.php.source.html#l1665">prepare_file</a>(<a href="../_variables/filename.html">$filename</a>)&nbsp;&nbsp;
<a href="../_functions/prepare_file.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Decide where to save the file, can be overwriten by subclass<BR>
</b><BR><b>param:</b> string $filename file name<br>
<b>return:</b> file path<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="has_moodle_files" onClick="logFunction('has_moodle_files', 'lib.php.source.html#l1680')" href="lib.php.source.html#l1680">has_moodle_files</a>()&nbsp;&nbsp;
<a href="../_functions/has_moodle_files.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Does this repository used to browse moodle files?<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_link" onClick="logFunction('get_link', 'lib.php.source.html#l1689')" href="lib.php.source.html#l1689">get_link</a>(<a href="../_variables/url.html">$url</a>)&nbsp;&nbsp;
<a href="../_functions/get_link.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return file URL, for most plugins, the parameter is the original<BR>
url, but some plugins use a file id, so we need this function to<BR>
convert file id to original url.<BR>
</b><BR><b>param:</b> string $url the url of file<br>
<b>return:</b> string<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_file" onClick="logFunction('get_file', 'lib.php.source.html#l1701')" href="lib.php.source.html#l1701">get_file</a>(<a href="../_variables/url.html">$url</a>, <a href="../_variables/filename.html">$filename</a> = '')&nbsp;&nbsp;
<a href="../_functions/get_file.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Downloads a file from external repository and saves it in temp dir<BR>
</b><BR>Function get_file() must be implemented by repositories that support returntypes<BR>
FILE_INTERNAL or FILE_REFERENCE. It is invoked to pick up the file and copy it<BR>
to moodle. This function is not called for moodle repositories, the function<BR>
{@link repository::copy_to_area()} is used instead.<BR>
<BR>
This function can be overridden by subclass if the files.reference field contains<BR>
not just URL or if request should be done differently.<BR>
<BR>
<b>param:</b> string $url the content of files.reference field, in this implementaion<br>
<b>param:</b> string $filename filename (without path) to save the downloaded file in the<br>
<b>return:</b> array with elements:<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="import_external_file_contents" onClick="logFunction('import_external_file_contents', 'lib.php.source.html#l1736')" href="lib.php.source.html#l1736">import_external_file_contents</a>(stored_file <a href="../_variables/file.html">$file</a>, <a href="../_variables/maxbytes.html">$maxbytes</a> = 0)&nbsp;&nbsp;
<a href="../_functions/import_external_file_contents.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Downloads the file from external repository and saves it in moodle filepool.<BR>
This function is different from {@link repository::sync_reference()} because it has<BR>
bigger request timeout and always downloads the content.<BR>
</b><BR>This function is invoked when we try to unlink the file from the source and convert<BR>
a reference into a true copy.<BR>
<BR>
<b>param:</b> stored_file $file<br>
<b>param:</b> int $maxbytes throw an exception if file size is bigger than $maxbytes (0 means no limit)<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_file_size" onClick="logFunction('get_file_size', 'lib.php.source.html#l1803')" href="lib.php.source.html#l1803">get_file_size</a>(<a href="../_variables/source.html">$source</a>)&nbsp;&nbsp;
<a href="../_functions/get_file_size.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return size of a file in bytes.<BR>
</b><BR><b>param:</b> string $source encoded and serialized data of file<br>
<b>return:</b> int file size in bytes<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="is_visible" onClick="logFunction('is_visible', 'lib.php.source.html#l1829')" href="lib.php.source.html#l1829">is_visible</a>()&nbsp;&nbsp;
<a href="../_functions/is_visible.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return is the instance is visible<BR>
(is the type visible ? is the context enable ?)<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="can_be_edited_by_user" onClick="logFunction('can_be_edited_by_user', 'lib.php.source.html#l1849')" href="lib.php.source.html#l1849">can_be_edited_by_user</a>()&nbsp;&nbsp;
<a href="../_functions/can_be_edited_by_user.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Can the instance be edited by the current user?<BR>
</b><BR>The property $readonly must not be used within this method because<BR>
it only controls if the options from self::get_instance_option_names()<BR>
can be edited.<BR>
<BR>
<b>return:</b> bool true if the user can edit the instance.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_name" onClick="logFunction('get_name', 'lib.php.source.html#l1884')" href="lib.php.source.html#l1884">get_name</a>()&nbsp;&nbsp;
<a href="../_functions/get_name.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return the name of this instance, can be overridden.<BR>
</b><BR><b>return:</b> string<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="contains_private_data" onClick="logFunction('contains_private_data', 'lib.php.source.html#l1897')" href="lib.php.source.html#l1897">contains_private_data</a>()&nbsp;&nbsp;
<a href="../_functions/contains_private_data.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Is this repository accessing private data?<BR>
</b><BR>This function should return true for the repositories which access external private<BR>
data from a user. This is the case for repositories such as Dropbox, Google Docs or Box.net<BR>
which authenticate the user and then store the auth token.<BR>
<BR>
Of course, many repositories store 'private data', but we only want to set<BR>
contains_private_data() to repositories which are external to Moodle and shouldn't be accessed<BR>
to by the users having the capability to 'login as' someone else. For instance, the repository<BR>
'Private files' is not considered as private because it's part of Moodle.<BR>
<BR>
You should not set contains_private_data() to true on repositories which allow different types<BR>
of instances as the levels other than 'user' are, by definition, not private. Also<BR>
the user instances will be protected when they need to.<BR>
<BR>
<b>return:</b> boolean True when the repository accesses private external data.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="supported_filetypes" onClick="logFunction('supported_filetypes', 'lib.php.source.html#l1920')" href="lib.php.source.html#l1920">supported_filetypes</a>()&nbsp;&nbsp;
<a href="../_functions/supported_filetypes.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>What kind of files will be in this repository?<BR>
</b><BR><b>return:</b> array return '*' means this repository support any files, otherwise<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="supported_returntypes" onClick="logFunction('supported_returntypes', 'lib.php.source.html#l1931')" href="lib.php.source.html#l1931">supported_returntypes</a>()&nbsp;&nbsp;
<a href="../_functions/supported_returntypes.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Tells how the file can be picked from this repository<BR>
</b><BR>Maximum value is FILE_INTERNAL | FILE_EXTERNAL | FILE_REFERENCE<BR>
<BR>
<b>return:</b> int<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_meta" onClick="logFunction('get_meta', 'lib.php.source.html#l1942')" href="lib.php.source.html#l1942">get_meta</a>()&nbsp;&nbsp;
<a href="../_functions/get_meta.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Provide repository instance information for Ajax<BR>
</b><BR><b>return:</b> stdClass<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="create" onClick="logFunction('create', 'lib.php.source.html#l1960')" href="lib.php.source.html#l1960">create</a>(<a href="../_variables/type.html">$type</a>, <a href="../_variables/userid.html">$userid</a>, <a href="../_variables/context.html">$context</a>, <a href="../_variables/params.html">$params</a>, <a href="../_variables/readonly.html">$readonly</a>=0)&nbsp;&nbsp;
<a href="../_functions/create.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Create an instance for this plug-in<BR>
</b><BR><b>param:</b> string $type the type of the repository<br>
<b>param:</b> int $userid the user id<br>
<b>param:</b> stdClass $context the context<br>
<b>param:</b> array $params the options for this instance<br>
<b>param:</b> int $readonly whether to create it readonly or not (defaults to not)<br>
<b>return:</b> mixed<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="delete" onClick="logFunction('delete', 'lib.php.source.html#l2012')" href="lib.php.source.html#l2012">delete</a>(<a href="../_variables/downloadcontents.html">$downloadcontents</a> = false)&nbsp;&nbsp;
<a href="../_functions/delete.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>delete a repository instance<BR>
</b><BR><b>param:</b> bool $downloadcontents<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="delete_all_for_context" onClick="logFunction('delete_all_for_context', 'lib.php.source.html#l2033')" href="lib.php.source.html#l2033">delete_all_for_context</a>(<a href="../_variables/contextid.html">$contextid</a>, <a href="../_variables/downloadcontents.html">$downloadcontents</a> = true)&nbsp;&nbsp;
<a href="../_functions/delete_all_for_context.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Delete all the instances associated to a context.<BR>
</b><BR>This method is intended to be a callback when deleting<BR>
a course or a user to delete all the instances associated<BR>
to their context. The usual way to delete a single instance<BR>
is to use {@link self::delete()}.<BR>
<BR>
<b>param:</b> int $contextid context ID.<br>
<b>param:</b> boolean $downloadcontents true to convert references to hard copies.<br>
<b>return:</b> void<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="hide" onClick="logFunction('hide', 'lib.php.source.html#l2059')" href="lib.php.source.html#l2059">hide</a>(<a href="../_variables/hide.html">$hide</a> = 'toggle')&nbsp;&nbsp;
<a href="../_functions/hide.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Hide/Show a repository<BR>
</b><BR><b>param:</b> string $hide<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="set_option" onClick="logFunction('set_option', 'lib.php.source.html#l2086')" href="lib.php.source.html#l2086">set_option</a>(<a href="../_variables/options.html">$options</a> = array()&nbsp;&nbsp;
<a href="../_functions/set_option.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Save settings for repository instance<BR>
$repo-&gt;set_option(array('api_key'=&gt;'f2188bde132', 'name'=&gt;'dongsheng'));<BR>
</b><BR><b>param:</b> array $options settings<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_option" onClick="logFunction('get_option', 'lib.php.source.html#l2118')" href="lib.php.source.html#l2118">get_option</a>(<a href="../_variables/config.html">$config</a> = '')&nbsp;&nbsp;
<a href="../_functions/get_option.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get settings for repository instance.<BR>
</b><BR><b>param:</b> string $config a specific option to get.<br>
<b>return:</b> mixed returns an array of options. If $config is not empty, then it returns that option,<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="filter" onClick="logFunction('filter', 'lib.php.source.html#l2149')" href="lib.php.source.html#l2149">filter</a>(&amp;<a href="../_variables/value.html">$value</a>)&nbsp;&nbsp;
<a href="../_functions/filter.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Filter file listing to display specific types<BR>
</b><BR><b>param:</b> array $value<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_listing" onClick="logFunction('get_listing', 'lib.php.source.html#l2177')" href="lib.php.source.html#l2177">get_listing</a>(<a href="../_variables/path.html">$path</a> = '', <a href="../_variables/page.html">$page</a> = '')&nbsp;&nbsp;
<a href="../_functions/get_listing.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Given a path, and perhaps a search, get a list of files.<BR>
</b><BR>See details on {@link http://docs.moodle.org/dev/Repository_plugins}<BR>
<BR>
<b>param:</b> string $path this parameter can a folder name, or a identification of folder<br>
<b>param:</b> string $page the page number of file list<br>
<b>return:</b> array the list of files, including meta infomation, containing the following keys<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="prepare_breadcrumb" onClick="logFunction('prepare_breadcrumb', 'lib.php.source.html#l2203')" href="lib.php.source.html#l2203">prepare_breadcrumb</a>(<a href="../_variables/breadcrumb.html">$breadcrumb</a>)&nbsp;&nbsp;
<a href="../_functions/prepare_breadcrumb.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Prepare the breadcrumb.<BR>
</b><BR><b>param:</b> array $breadcrumb contains each element of the breadcrumb.<br>
<b>return:</b> array of breadcrumb elements.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="prepare_list" onClick="logFunction('prepare_list', 'lib.php.source.html#l2224')" href="lib.php.source.html#l2224">prepare_list</a>(<a href="../_variables/list.html">$list</a>)&nbsp;&nbsp;
<a href="../_functions/prepare_list.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Prepare the file/folder listing.<BR>
</b><BR><b>param:</b> array $list of files and folders.<br>
<b>return:</b> array of files and folders.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="prepare_listing" onClick="logFunction('prepare_listing', 'lib.php.source.html#l2305')" href="lib.php.source.html#l2305">prepare_listing</a>(<a href="../_variables/listing.html">$listing</a>)&nbsp;&nbsp;
<a href="../_functions/prepare_listing.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Prepares list of files before passing it to AJAX, makes sure data is in the correct<BR>
format and stores formatted values.<BR>
</b><BR><b>param:</b> array|stdClass $listing result of get_listing() or search() or file_get_drafarea_files()<br>
<b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="search" onClick="logFunction('search', 'lib.php.source.html#l2336')" href="lib.php.source.html#l2336">search</a>(<a href="../_variables/search_text.html">$search_text</a>, <a href="../_variables/page.html">$page</a> = 0)&nbsp;&nbsp;
<a href="../_functions/search.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Search files in repository<BR>
When doing global search, $search_text will be used as<BR>
keyword.<BR>
</b><BR><b>param:</b> string $search_text search key word<br>
<b>param:</b> int $page page<br>
<b>return:</b> mixed see {@link repository::get_listing()}<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="logout" onClick="logFunction('logout', 'lib.php.source.html#l2351')" href="lib.php.source.html#l2351">logout</a>()&nbsp;&nbsp;
<a href="../_functions/logout.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Logout from repository instance<BR>
By default, this function will return a login form<BR>
</b><BR><b>return:</b> string<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="check_login" onClick="logFunction('check_login', 'lib.php.source.html#l2361')" href="lib.php.source.html#l2361">check_login</a>()&nbsp;&nbsp;
<a href="../_functions/check_login.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>To check whether the user is logged in.<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="print_login" onClick="logFunction('print_login', 'lib.php.source.html#l2371')" href="lib.php.source.html#l2371">print_login</a>()&nbsp;&nbsp;
<a href="../_functions/print_login.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Show the login screen, if required<BR>
</b><BR><b>return:</b> string<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="print_search" onClick="logFunction('print_search', 'lib.php.source.html#l2380')" href="lib.php.source.html#l2380">print_search</a>()&nbsp;&nbsp;
<a href="../_functions/print_search.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Show the search screen, if required<BR>
</b><BR><b>return:</b> string<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="callback" onClick="logFunction('callback', 'lib.php.source.html#l2391')" href="lib.php.source.html#l2391">callback</a>()&nbsp;&nbsp;
<a href="../_functions/callback.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>For oauth like external authentication, when external repository direct user back to moodle,<BR>
this function will be called to set up token and token_secret<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="global_search" onClick="logFunction('global_search', 'lib.php.source.html#l2398')" href="lib.php.source.html#l2398">global_search</a>()&nbsp;&nbsp;
<a href="../_functions/global_search.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>is it possible to do glboal search?<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="cron" onClick="logFunction('cron', 'lib.php.source.html#l2407')" href="lib.php.source.html#l2407">cron</a>()&nbsp;&nbsp;
<a href="../_functions/cron.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Defines operations that happen occasionally on cron<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="plugin_init" onClick="logFunction('plugin_init', 'lib.php.source.html#l2416')" href="lib.php.source.html#l2416">plugin_init</a>()&nbsp;&nbsp;
<a href="../_functions/plugin_init.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>function which is run when the type is created (moodle administrator add the plugin)<BR>
</b><BR><b>return:</b> bool success or fail?<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="type_config_form" onClick="logFunction('type_config_form', 'lib.php.source.html#l2425')" href="lib.php.source.html#l2425">type_config_form</a>(<a href="../_variables/mform.html">$mform</a>, <a href="../_variables/classname.html">$classname</a> = 'repository')&nbsp;&nbsp;
<a href="../_functions/type_config_form.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Edit/Create Admin Settings Moodle form<BR>
</b><BR><b>param:</b> moodleform $mform Moodle form (passed by reference)<br>
<b>param:</b> string $classname repository class name<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="type_form_validation" onClick="logFunction('type_form_validation', 'lib.php.source.html#l2443')" href="lib.php.source.html#l2443">type_form_validation</a>(<a href="../_variables/mform.html">$mform</a>, <a href="../_variables/data.html">$data</a>, <a href="../_variables/errors.html">$errors</a>)&nbsp;&nbsp;
<a href="../_functions/type_form_validation.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Validate Admin Settings Moodle form<BR>
</b><BR><b>param:</b> moodleform $mform Moodle form (passed by reference)<br>
<b>param:</b> array $data array of (&quot;fieldname&quot;=&gt;value) of submitted data<br>
<b>param:</b> array $errors array of (&quot;fieldname&quot;=&gt;errormessage) of errors<br>
<b>return:</b> array array of errors<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="instance_config_form" onClick="logFunction('instance_config_form', 'lib.php.source.html#l2457')" href="lib.php.source.html#l2457">instance_config_form</a>(<a href="../_variables/mform.html">$mform</a>)&nbsp;&nbsp;
<a href="../_functions/instance_config_form.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Edit/Create Instance Settings Moodle form<BR>
</b><BR><b>param:</b> moodleform $mform Moodle form (passed by reference)<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_type_option_names" onClick="logFunction('get_type_option_names', 'lib.php.source.html#l2465')" href="lib.php.source.html#l2465">get_type_option_names</a>()&nbsp;&nbsp;
<a href="../_functions/get_type_option_names.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return names of the general options.<BR>
By default: no general option name<BR>
</b><BR><b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_instance_option_names" onClick="logFunction('get_instance_option_names', 'lib.php.source.html#l2475')" href="lib.php.source.html#l2475">get_instance_option_names</a>()&nbsp;&nbsp;
<a href="../_functions/get_instance_option_names.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return names of the instance options.<BR>
By default: no instance option name<BR>
</b><BR><b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="instance_form_validation" onClick="logFunction('instance_form_validation', 'lib.php.source.html#l2485')" href="lib.php.source.html#l2485">instance_form_validation</a>(<a href="../_variables/mform.html">$mform</a>, <a href="../_variables/data.html">$data</a>, <a href="../_variables/errors.html">$errors</a>)&nbsp;&nbsp;
<a href="../_functions/instance_form_validation.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Validate repository plugin instance form<BR>
</b><BR><b>param:</b> moodleform $mform moodle form<br>
<b>param:</b> array $data form data<br>
<b>param:</b> array $errors errors<br>
<b>return:</b> array errors<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_short_filename" onClick="logFunction('get_short_filename', 'lib.php.source.html#l2497')" href="lib.php.source.html#l2497">get_short_filename</a>(<a href="../_variables/str.html">$str</a>, <a href="../_variables/maxlength.html">$maxlength</a>)&nbsp;&nbsp;
<a href="../_functions/get_short_filename.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Create a shorten filename<BR>
</b><BR><b>param:</b> string $str filename<br>
<b>param:</b> int $maxlength max file name length<br>
<b>return:</b> string short filename<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="overwrite_existing_draftfile" onClick="logFunction('overwrite_existing_draftfile', 'lib.php.source.html#l2512')" href="lib.php.source.html#l2512">overwrite_existing_draftfile</a>(<a href="../_variables/itemid.html">$itemid</a>, <a href="../_variables/filepath.html">$filepath</a>, <a href="../_variables/filename.html">$filename</a>, <a href="../_variables/newfilepath.html">$newfilepath</a>, <a href="../_variables/newfilename.html">$newfilename</a>)&nbsp;&nbsp;
<a href="../_functions/overwrite_existing_draftfile.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Overwrite an existing file<BR>
</b><BR><b>param:</b> int $itemid<br>
<b>param:</b> string $filepath<br>
<b>param:</b> string $filename<br>
<b>param:</b> string $newfilepath<br>
<b>param:</b> string $newfilename<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_draftfile" onClick="logFunction('update_draftfile', 'lib.php.source.html#l2559')" href="lib.php.source.html#l2559">update_draftfile</a>(<a href="../_variables/draftid.html">$draftid</a>, <a href="../_variables/filepath.html">$filepath</a>, <a href="../_variables/filename.html">$filename</a>, <a href="../_variables/updatedata.html">$updatedata</a>)&nbsp;&nbsp;
<a href="../_functions/update_draftfile.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Updates a file in draft filearea.<BR>
</b><BR>This function can only update fields filepath, filename, author, license.<BR>
If anything (except filepath) is updated, timemodified is set to current time.<BR>
If filename or filepath is updated the file unconnects from it's origin<BR>
and therefore all references to it will be converted to copies when<BR>
filearea is saved.<BR>
<BR>
<b>param:</b> int $draftid<br>
<b>param:</b> string $filepath path to the directory containing the file, or full path in case of directory<br>
<b>param:</b> string $filename name of the file, or '.' in case of directory<br>
<b>param:</b> array $updatedata array of fields to change (only filename, filepath, license and/or author can be updated)<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="delete_tempfile_from_draft" onClick="logFunction('delete_tempfile_from_draft', 'lib.php.source.html#l2655')" href="lib.php.source.html#l2655">delete_tempfile_from_draft</a>(<a href="../_variables/draftitemid.html">$draftitemid</a>, <a href="../_variables/filepath.html">$filepath</a>, <a href="../_variables/filename.html">$filename</a>)&nbsp;&nbsp;
<a href="../_functions/delete_tempfile_from_draft.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Delete a temp file from draft area<BR>
</b><BR><b>param:</b> int $draftitemid<br>
<b>param:</b> string $filepath<br>
<b>param:</b> string $filename<br>
<b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="convert_references_to_local" onClick="logFunction('convert_references_to_local', 'lib.php.source.html#l2675')" href="lib.php.source.html#l2675">convert_references_to_local</a>()&nbsp;&nbsp;
<a href="../_functions/convert_references_to_local.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Find all external files in this repo and import them<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="reset_caches" onClick="logFunction('reset_caches', 'lib.php.source.html#l2686')" href="lib.php.source.html#l2686">reset_caches</a>()&nbsp;&nbsp;
<a href="../_functions/reset_caches.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Function repository::reset_caches() is deprecated, cache is handled by MUC now.<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="sync_external_file" onClick="logFunction('sync_external_file', 'lib.php.source.html#l2694')" href="lib.php.source.html#l2694">sync_external_file</a>(<a href="../_variables/file.html">$file</a>, <a href="../_variables/resetsynchistory.html">$resetsynchistory</a> = false)&nbsp;&nbsp;
<a href="../_functions/sync_external_file.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Function repository::sync_external_file() is deprecated. Use repository::sync_reference instead<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="sync_reference" onClick="logFunction('sync_reference', 'lib.php.source.html#l2705')" href="lib.php.source.html#l2705">sync_reference</a>(stored_file <a href="../_variables/file.html">$file</a>)&nbsp;&nbsp;
<a href="../_functions/sync_reference.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Performs synchronisation of an external file if the previous one has expired.<BR>
</b><BR>This function must be implemented for external repositories supporting<BR>
FILE_REFERENCE, it is called for existing aliases when their filesize,<BR>
contenthash or timemodified are requested. It is not called for internal<BR>
repositories (see {@link repository::has_moodle_files()}), references to<BR>
internal files are updated immediately when source is modified.<BR>
<BR>
Referenced files may optionally keep their content in Moodle filepool (for<BR>
thumbnail generation or to be able to serve cached copy). In this<BR>
case both contenthash and filesize need to be synchronized. Otherwise repositories<BR>
should use contenthash of empty file and correct filesize in bytes.<BR>
<BR>
Note that this function may be run for EACH file that needs to be synchronised at the<BR>
moment. If anything is being downloaded or requested from external sources there<BR>
should be a small timeout. The synchronisation is performed to update the size of<BR>
the file and/or to update image and re-generated image preview. There is nothing<BR>
fatal if syncronisation fails but it is fatal if syncronisation takes too long<BR>
and hangs the script generating a page.<BR>
<BR>
Note: If you wish to call $file-&gt;get_filesize(), $file-&gt;get_contenthash() or<BR>
$file-&gt;get_timemodified() make sure that recursion does not happen.<BR>
<BR>
Called from {@link stored_file::sync_external_file()}<BR>
<BR>
<b>param:</b> stored_file $file<br>
<b>return:</b> bool false when file does not need synchronisation, true if it was synchronised<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="build_source_field" onClick="logFunction('build_source_field', 'lib.php.source.html#l2763')" href="lib.php.source.html#l2763">build_source_field</a>(<a href="../_variables/source.html">$source</a>)&nbsp;&nbsp;
<a href="../_functions/build_source_field.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Build draft file's source field<BR>
</b><BR>{@link file_restore_source_field_from_draft_file()}<BR>
XXX: This is a hack for file manager (MDL-28666)<BR>
For newly created&nbsp;&nbsp;draft files we have to construct<BR>
source filed in php serialized data format.<BR>
File manager needs to know the original file information before copying<BR>
to draft area, so we append these information in mdl_files.source field<BR>
<BR>
<b>param:</b> string $source<br>
<b>return:</b> string serialised source field<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="prepare_to_cache" onClick="logFunction('prepare_to_cache', 'lib.php.source.html#l2782')" href="lib.php.source.html#l2782">prepare_to_cache</a>()&nbsp;&nbsp;
<a href="../_functions/prepare_to_cache.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Prepares the repository to be cached. Implements method from cacheable_object interface.<BR>
</b><BR><b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="wake_from_cache" onClick="logFunction('wake_from_cache', 'lib.php.source.html#l2797')" href="lib.php.source.html#l2797">wake_from_cache</a>(<a href="../_variables/data.html">$data</a>)&nbsp;&nbsp;
<a href="../_functions/wake_from_cache.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Restores the repository from cache. Implements method from cacheable_object interface.<BR>
</b><BR><b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="send_relative_file" onClick="logFunction('send_relative_file', 'lib.php.source.html#l2807')" href="lib.php.source.html#l2807">send_relative_file</a>(stored_file <a href="../_variables/mainfile.html">$mainfile</a>, <a href="../_variables/relativepath.html">$relativepath</a>)&nbsp;&nbsp;
<a href="../_functions/send_relative_file.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Gets a file relative to this file in the repository and sends it to the browser.<BR>
Used to allow relative file linking within a repository without creating file records<BR>
for linked files<BR>
</b><BR>Repositories that overwrite this must be very careful - see filesystem repository for example.<BR>
<BR>
<b>param:</b> stored_file $mainfile The main file we are trying to access relative files for.<br>
<b>param:</b> string $relativepath the relative path to the file we are trying to access.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="supports_relative_file" onClick="logFunction('supports_relative_file', 'lib.php.source.html#l2823')" href="lib.php.source.html#l2823">supports_relative_file</a>()&nbsp;&nbsp;
<a href="../_functions/supports_relative_file.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>helper function to check if the repository supports send_relative_file.<BR>
</b><BR><b>return:</b> true|false<br>
</td></tr></table>

<br>
</div>
</div>
<div class="details-classinfo">
<p class="details-classtitle">Class: <a name="repository_exception"><b>repository_exception</b></a>&nbsp;&nbsp;- <a href="../_classes/repository_exception.html"><small>X-Ref</small></a>
</p>
<b>Exception class for repository api<BR>
</b><br>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="add_defaults" onClick="logFunction('add_defaults', 'lib.php.source.html#l2858')" href="lib.php.source.html#l2858">add_defaults</a>()&nbsp;&nbsp;
<a href="../_functions/add_defaults.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Added defaults to moodle form<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="definition" onClick="logFunction('definition', 'lib.php.source.html#l2881')" href="lib.php.source.html#l2881">definition</a>()&nbsp;&nbsp;
<a href="../_functions/definition.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Define moodle form elements<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="validation" onClick="logFunction('validation', 'lib.php.source.html#l2927')" href="lib.php.source.html#l2927">validation</a>(<a href="../_variables/data.html">$data</a>, <a href="../_variables/files.html">$files</a>)&nbsp;&nbsp;
<a href="../_functions/validation.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Validate moodle form data<BR>
</b><BR><b>param:</b> array $data form data<br>
<b>param:</b> array $files files in form<br>
<b>return:</b> array errors<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="definition" onClick="logFunction('definition', 'lib.php.source.html#l2980')" href="lib.php.source.html#l2980">definition</a>()&nbsp;&nbsp;
<a href="../_functions/definition.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Definition of the moodleform<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="validation" onClick="logFunction('validation', 'lib.php.source.html#l3053')" href="lib.php.source.html#l3053">validation</a>(<a href="../_variables/data.html">$data</a>, <a href="../_variables/files.html">$files</a>)&nbsp;&nbsp;
<a href="../_functions/validation.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Validate moodle form data<BR>
</b><BR><b>param:</b> array $data moodle form data<br>
<b>param:</b> array $files<br>
<b>return:</b> array errors<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="initialise_filepicker" onClick="logFunction('initialise_filepicker', 'lib.php.source.html#l3076')" href="lib.php.source.html#l3076">initialise_filepicker</a>(<a href="../_variables/args.html">$args</a>)&nbsp;&nbsp;
<a href="../_functions/initialise_filepicker.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Generate all options needed by filepicker<BR>
</b><BR><b>param:</b> array $args including following keys<br>
<b>return:</b> array the list of repository instances, including meta infomation, containing the following keys<br>
</td></tr></table>

<br>
</div>
</div>

</div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
