<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /user/lib.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='user';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/user/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * External user API</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package   core_user</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright 2009 Moodle Pty Ltd (http://moodle.com)</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment">/**</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * Creates a user</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> *</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * @throws moodle_exception</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @param stdClass $user user to create</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * @param bool $updatepassword if true, authentication plugin will update password.</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * @param bool $triggerevent set false if user_created event should not be triggred.</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> *             This will not affect user_password_updated event triggering.</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * @return int id of the newly created user</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> */</span>
<a name="l36"><span class="linenum">  36</span></a>  function <a class="function" onClick="logFunction('user_create_user')" href="../_functions/user_create_user.html" onMouseOver="funcPopup(event,'user_create_user')">user_create_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it11608" onMouseOver="hilite(11608)" onMouseOut="lolite()" onClick="logVariable('updatepassword')" href="../_variables/updatepassword.html">$updatepassword</a> = true, <a class="var it10743" onMouseOver="hilite(10743)" onMouseOut="lolite()" onClick="logVariable('triggerevent')" href="../_variables/triggerevent.html">$triggerevent</a> = true) {
<a name="l37"><span class="linenum">  37</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l38"><span class="linenum">  38</span></a>  
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">    // Set the timecreate field to the current time.</span>
<a name="l40"><span class="linenum">  40</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l41"><span class="linenum">  41</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = (object) <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l42"><span class="linenum">  42</span></a>      }
<a name="l43"><span class="linenum">  43</span></a>  
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment">    // Check username.</span>
<a name="l45"><span class="linenum">  45</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a> !== <a class="class" onClick="logClass('core_text')" href="../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>)) {
<a name="l46"><span class="linenum">  46</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('usernamelowercase');
<a name="l47"><span class="linenum">  47</span></a>      } else {
<a name="l48"><span class="linenum">  48</span></a>          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a> !== <a class="function" onClick="logFunction('clean_param')" href="../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>, <a class="constant" onClick="logConstant('PARAM_USERNAME')" href="../_constants/PARAM_USERNAME.html" onMouseOver="constPopup(event,'PARAM_USERNAME')">PARAM_USERNAME</a>)) {
<a name="l49"><span class="linenum">  49</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invalidusername');
<a name="l50"><span class="linenum">  50</span></a>          }
<a name="l51"><span class="linenum">  51</span></a>      }
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">    // Save the password in a temp value for later.</span>
<a name="l54"><span class="linenum">  54</span></a>      if (<a class="var it11608" onMouseOver="hilite(11608)" onMouseOut="lolite()" onClick="logVariable('updatepassword')" href="../_variables/updatepassword.html">$updatepassword</a> &amp;&amp; isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/password.html">password</a>)) {
<a name="l55"><span class="linenum">  55</span></a>  
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">        // Check password toward the password policy.</span>
<a name="l57"><span class="linenum">  57</span></a>          if (!<a class="function" onClick="logFunction('check_password_policy')" href="../_functions/check_password_policy.html" onMouseOver="funcPopup(event,'check_password_policy')">check_password_policy</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/password.html">password</a>, <a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('errmsg')" href="../_variables/errmsg.html">$errmsg</a>)) {
<a name="l58"><span class="linenum">  58</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>(<a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('errmsg')" href="../_variables/errmsg.html">$errmsg</a>);
<a name="l59"><span class="linenum">  59</span></a>          }
<a name="l60"><span class="linenum">  60</span></a>  
<a name="l61"><span class="linenum">  61</span></a>          <a class="var it2549" onMouseOver="hilite(2549)" onMouseOut="lolite()" onClick="logVariable('userpassword')" href="../_variables/userpassword.html">$userpassword</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/password.html">password</a>;
<a name="l62"><span class="linenum">  62</span></a>          unset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/password.html">password</a>);
<a name="l63"><span class="linenum">  63</span></a>      }
<a name="l64"><span class="linenum">  64</span></a>  
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment">    // Make sure calendartype, if set, is valid.</span>
<a name="l66"><span class="linenum">  66</span></a>      if (!empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a>)) {
<a name="l67"><span class="linenum">  67</span></a>          <a class="var it11609" onMouseOver="hilite(11609)" onMouseOut="lolite()" onClick="logVariable('availablecalendartypes')" href="../_variables/availablecalendartypes.html">$availablecalendartypes</a> = \core_calendar\<a class="class" onClick="logClass('type_factory')" href="../_classes/type_factory.html" onMouseOver="classPopup(event,'type_factory')">type_factory</a>::<a class="function" onClick="logFunction('get_list_of_calendar_types')" href="../_functions/get_list_of_calendar_types.html" onMouseOver="funcPopup(event,'get_list_of_calendar_types')">get_list_of_calendar_types</a>();
<a name="l68"><span class="linenum">  68</span></a>          if (empty(<a class="var it11609" onMouseOver="hilite(11609)" onMouseOut="lolite()" onClick="logVariable('availablecalendartypes')" href="../_variables/availablecalendartypes.html">$availablecalendartypes</a>[<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a>])) {
<a name="l69"><span class="linenum">  69</span></a>              <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a>;
<a name="l70"><span class="linenum">  70</span></a>          }
<a name="l71"><span class="linenum">  71</span></a>      } else {
<a name="l72"><span class="linenum">  72</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a>;
<a name="l73"><span class="linenum">  73</span></a>      }
<a name="l74"><span class="linenum">  74</span></a>  
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">    // Apply default values for user preferences that are stored in users table.</span>
<a name="l76"><span class="linenum">  76</span></a>      if (!isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('maildisplay')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/maildisplay.html">maildisplay</a>)) {
<a name="l77"><span class="linenum">  77</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('maildisplay')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/maildisplay.html">maildisplay</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultpreference_maildisplay')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultpreference_maildisplay.html">defaultpreference_maildisplay</a>;
<a name="l78"><span class="linenum">  78</span></a>      }
<a name="l79"><span class="linenum">  79</span></a>      if (!isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mailformat')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/mailformat.html">mailformat</a>)) {
<a name="l80"><span class="linenum">  80</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mailformat')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/mailformat.html">mailformat</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultpreference_mailformat')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultpreference_mailformat.html">defaultpreference_mailformat</a>;
<a name="l81"><span class="linenum">  81</span></a>      }
<a name="l82"><span class="linenum">  82</span></a>      if (!isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('maildigest')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/maildigest.html">maildigest</a>)) {
<a name="l83"><span class="linenum">  83</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('maildigest')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/maildigest.html">maildigest</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultpreference_maildigest')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultpreference_maildigest.html">defaultpreference_maildigest</a>;
<a name="l84"><span class="linenum">  84</span></a>      }
<a name="l85"><span class="linenum">  85</span></a>      if (!isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('autosubscribe')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/autosubscribe.html">autosubscribe</a>)) {
<a name="l86"><span class="linenum">  86</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('autosubscribe')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/autosubscribe.html">autosubscribe</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultpreference_autosubscribe')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultpreference_autosubscribe.html">defaultpreference_autosubscribe</a>;
<a name="l87"><span class="linenum">  87</span></a>      }
<a name="l88"><span class="linenum">  88</span></a>      if (!isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('trackforums')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/trackforums.html">trackforums</a>)) {
<a name="l89"><span class="linenum">  89</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('trackforums')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/trackforums.html">trackforums</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultpreference_trackforums')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultpreference_trackforums.html">defaultpreference_trackforums</a>;
<a name="l90"><span class="linenum">  90</span></a>      }
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>      <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l93"><span class="linenum">  93</span></a>      <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>;
<a name="l94"><span class="linenum">  94</span></a>  
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">    // Insert the user into the database.</span>
<a name="l96"><span class="linenum">  96</span></a>      <a class="var it11614" onMouseOver="hilite(11614)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../_variables/newuserid.html">$newuserid</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('user', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l97"><span class="linenum">  97</span></a>  
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">    // Create USER context for this user.</span>
<a name="l99"><span class="linenum">  99</span></a>      <a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a> = <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it11614" onMouseOver="hilite(11614)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../_variables/newuserid.html">$newuserid</a>);
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">    // Update user password if necessary.</span>
<a name="l102"><span class="linenum"> 102</span></a>      if (isset(<a class="var it2549" onMouseOver="hilite(2549)" onMouseOut="lolite()" onClick="logVariable('userpassword')" href="../_variables/userpassword.html">$userpassword</a>)) {
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">        // Get full database user row, in case auth is default.</span>
<a name="l104"><span class="linenum"> 104</span></a>          <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../_variables/newuser.html">$newuser</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it11614" onMouseOver="hilite(11614)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../_variables/newuserid.html">$newuserid</a>));
<a name="l105"><span class="linenum"> 105</span></a>          <a class="var it4020" onMouseOver="hilite(4020)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../_variables/authplugin.html">$authplugin</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../_variables/newuser.html">$newuser</a>-&gt;<a onClick="logVariable('auth')" class="var it39669" onMouseOver="hilite(39669)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>);
<a name="l106"><span class="linenum"> 106</span></a>          <a class="var it4020" onMouseOver="hilite(4020)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../_variables/authplugin.html">$authplugin</a>-&gt;<a class="function" onClick="logFunction('user_update_password')" href="../_functions/user_update_password.html" onMouseOver="funcPopup(event,'user_update_password')">user_update_password</a>(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../_variables/newuser.html">$newuser</a>, <a class="var it2549" onMouseOver="hilite(2549)" onMouseOut="lolite()" onClick="logVariable('userpassword')" href="../_variables/userpassword.html">$userpassword</a>);
<a name="l107"><span class="linenum"> 107</span></a>      }
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">    // Trigger event If required.</span>
<a name="l110"><span class="linenum"> 110</span></a>      if (<a class="var it10743" onMouseOver="hilite(10743)" onMouseOut="lolite()" onClick="logVariable('triggerevent')" href="../_variables/triggerevent.html">$triggerevent</a>) {
<a name="l111"><span class="linenum"> 111</span></a>          \core\event\<a class="class" onClick="logClass('user_created')" href="../_classes/user_created.html" onMouseOver="classPopup(event,'user_created')">user_created</a>::<a class="function" onClick="logFunction('create_from_userid')" href="../_functions/create_from_userid.html" onMouseOver="funcPopup(event,'create_from_userid')">create_from_userid</a>(<a class="var it11614" onMouseOver="hilite(11614)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../_variables/newuserid.html">$newuserid</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l112"><span class="linenum"> 112</span></a>      }
<a name="l113"><span class="linenum"> 113</span></a>  
<a name="l114"><span class="linenum"> 114</span></a>      return <a class="var it11614" onMouseOver="hilite(11614)" onMouseOut="lolite()" onClick="logVariable('newuserid')" href="../_variables/newuserid.html">$newuserid</a>;
<a name="l115"><span class="linenum"> 115</span></a>  }
<a name="l116"><span class="linenum"> 116</span></a>  
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">/**</span>
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment"> * Update a user with a user object (will compare against the ID)</span>
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment"> *</span>
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment"> * @throws moodle_exception</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment"> * @param stdClass $user the user to update</span>
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment"> * @param bool $updatepassword if true, authentication plugin will update password.</span>
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment"> * @param bool $triggerevent set false if user_updated event should not be triggred.</span>
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment"> *             This will not affect user_password_updated event triggering.</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment"> */</span>
<a name="l126"><span class="linenum"> 126</span></a>  function <a class="function" onClick="logFunction('user_update_user')" href="../_functions/user_update_user.html" onMouseOver="funcPopup(event,'user_update_user')">user_update_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it11608" onMouseOver="hilite(11608)" onMouseOut="lolite()" onClick="logVariable('updatepassword')" href="../_variables/updatepassword.html">$updatepassword</a> = true, <a class="var it10743" onMouseOver="hilite(10743)" onMouseOut="lolite()" onClick="logVariable('triggerevent')" href="../_variables/triggerevent.html">$triggerevent</a> = true) {
<a name="l127"><span class="linenum"> 127</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l128"><span class="linenum"> 128</span></a>  
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">    // Set the timecreate field to the current time.</span>
<a name="l130"><span class="linenum"> 130</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l131"><span class="linenum"> 131</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = (object) <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l132"><span class="linenum"> 132</span></a>      }
<a name="l133"><span class="linenum"> 133</span></a>  
<a name="l134"><span class="linenum"> 134</span></a>  <span class="comment">    // Check username.</span>
<a name="l135"><span class="linenum"> 135</span></a>      if (isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>)) {
<a name="l136"><span class="linenum"> 136</span></a>          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a> !== <a class="class" onClick="logClass('core_text')" href="../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>)) {
<a name="l137"><span class="linenum"> 137</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('usernamelowercase');
<a name="l138"><span class="linenum"> 138</span></a>          } else {
<a name="l139"><span class="linenum"> 139</span></a>              if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a> !== <a class="function" onClick="logFunction('clean_param')" href="../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>, <a class="constant" onClick="logConstant('PARAM_USERNAME')" href="../_constants/PARAM_USERNAME.html" onMouseOver="constPopup(event,'PARAM_USERNAME')">PARAM_USERNAME</a>)) {
<a name="l140"><span class="linenum"> 140</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invalidusername');
<a name="l141"><span class="linenum"> 141</span></a>              }
<a name="l142"><span class="linenum"> 142</span></a>          }
<a name="l143"><span class="linenum"> 143</span></a>      }
<a name="l144"><span class="linenum"> 144</span></a>  
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">    // Unset password here, for updating later, if password update is required.</span>
<a name="l146"><span class="linenum"> 146</span></a>      if (<a class="var it11608" onMouseOver="hilite(11608)" onMouseOut="lolite()" onClick="logVariable('updatepassword')" href="../_variables/updatepassword.html">$updatepassword</a> &amp;&amp; isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/password.html">password</a>)) {
<a name="l147"><span class="linenum"> 147</span></a>  
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">        // Check password toward the password policy.</span>
<a name="l149"><span class="linenum"> 149</span></a>          if (!<a class="function" onClick="logFunction('check_password_policy')" href="../_functions/check_password_policy.html" onMouseOver="funcPopup(event,'check_password_policy')">check_password_policy</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/password.html">password</a>, <a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('errmsg')" href="../_variables/errmsg.html">$errmsg</a>)) {
<a name="l150"><span class="linenum"> 150</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>(<a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('errmsg')" href="../_variables/errmsg.html">$errmsg</a>);
<a name="l151"><span class="linenum"> 151</span></a>          }
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>          <a class="var it8388" onMouseOver="hilite(8388)" onMouseOut="lolite()" onClick="logVariable('passwd')" href="../_variables/passwd.html">$passwd</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/password.html">password</a>;
<a name="l154"><span class="linenum"> 154</span></a>          unset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/password.html">password</a>);
<a name="l155"><span class="linenum"> 155</span></a>      }
<a name="l156"><span class="linenum"> 156</span></a>  
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment">    // Make sure calendartype, if set, is valid.</span>
<a name="l158"><span class="linenum"> 158</span></a>      if (!empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a>)) {
<a name="l159"><span class="linenum"> 159</span></a>          <a class="var it11609" onMouseOver="hilite(11609)" onMouseOut="lolite()" onClick="logVariable('availablecalendartypes')" href="../_variables/availablecalendartypes.html">$availablecalendartypes</a> = \core_calendar\<a class="class" onClick="logClass('type_factory')" href="../_classes/type_factory.html" onMouseOver="classPopup(event,'type_factory')">type_factory</a>::<a class="function" onClick="logFunction('get_list_of_calendar_types')" href="../_functions/get_list_of_calendar_types.html" onMouseOver="funcPopup(event,'get_list_of_calendar_types')">get_list_of_calendar_types</a>();
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment">        // If it doesn't exist, then unset this value, we do not want to update the user's value.</span>
<a name="l161"><span class="linenum"> 161</span></a>          if (empty(<a class="var it11609" onMouseOver="hilite(11609)" onMouseOut="lolite()" onClick="logVariable('availablecalendartypes')" href="../_variables/availablecalendartypes.html">$availablecalendartypes</a>[<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a>])) {
<a name="l162"><span class="linenum"> 162</span></a>              unset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a>);
<a name="l163"><span class="linenum"> 163</span></a>          }
<a name="l164"><span class="linenum"> 164</span></a>      } else {
<a name="l165"><span class="linenum"> 165</span></a>  <span class="comment">        // Unset this variable, must be an empty string, which we do not want to update the calendartype to.</span>
<a name="l166"><span class="linenum"> 166</span></a>          unset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/calendartype.html">calendartype</a>);
<a name="l167"><span class="linenum"> 167</span></a>      }
<a name="l168"><span class="linenum"> 168</span></a>  
<a name="l169"><span class="linenum"> 169</span></a>      <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l170"><span class="linenum"> 170</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('user', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l171"><span class="linenum"> 171</span></a>  
<a name="l172"><span class="linenum"> 172</span></a>      if (<a class="var it11608" onMouseOver="hilite(11608)" onMouseOut="lolite()" onClick="logVariable('updatepassword')" href="../_variables/updatepassword.html">$updatepassword</a>) {
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">        // Get full user record.</span>
<a name="l174"><span class="linenum"> 174</span></a>          <a class="var it11615" onMouseOver="hilite(11615)" onMouseOut="lolite()" onClick="logVariable('updateduser')" href="../_variables/updateduser.html">$updateduser</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l175"><span class="linenum"> 175</span></a>  
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">        // If password was set, then update its hash.</span>
<a name="l177"><span class="linenum"> 177</span></a>          if (isset(<a class="var it8388" onMouseOver="hilite(8388)" onMouseOut="lolite()" onClick="logVariable('passwd')" href="../_variables/passwd.html">$passwd</a>)) {
<a name="l178"><span class="linenum"> 178</span></a>              <a class="var it4020" onMouseOver="hilite(4020)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../_variables/authplugin.html">$authplugin</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it11615" onMouseOver="hilite(11615)" onMouseOut="lolite()" onClick="logVariable('updateduser')" href="../_variables/updateduser.html">$updateduser</a>-&gt;<a onClick="logVariable('auth')" class="var it39670" onMouseOver="hilite(39670)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>);
<a name="l179"><span class="linenum"> 179</span></a>              if (<a class="var it4020" onMouseOver="hilite(4020)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../_variables/authplugin.html">$authplugin</a>-&gt;<a class="function" onClick="logFunction('can_change_password')" href="../_functions/can_change_password.html" onMouseOver="funcPopup(event,'can_change_password')">can_change_password</a>()) {
<a name="l180"><span class="linenum"> 180</span></a>                  <a class="var it4020" onMouseOver="hilite(4020)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../_variables/authplugin.html">$authplugin</a>-&gt;<a class="function" onClick="logFunction('user_update_password')" href="../_functions/user_update_password.html" onMouseOver="funcPopup(event,'user_update_password')">user_update_password</a>(<a class="var it11615" onMouseOver="hilite(11615)" onMouseOut="lolite()" onClick="logVariable('updateduser')" href="../_variables/updateduser.html">$updateduser</a>, <a class="var it8388" onMouseOver="hilite(8388)" onMouseOut="lolite()" onClick="logVariable('passwd')" href="../_variables/passwd.html">$passwd</a>);
<a name="l181"><span class="linenum"> 181</span></a>              }
<a name="l182"><span class="linenum"> 182</span></a>          }
<a name="l183"><span class="linenum"> 183</span></a>      }
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">    // Trigger event if required.</span>
<a name="l185"><span class="linenum"> 185</span></a>      if (<a class="var it10743" onMouseOver="hilite(10743)" onMouseOut="lolite()" onClick="logVariable('triggerevent')" href="../_variables/triggerevent.html">$triggerevent</a>) {
<a name="l186"><span class="linenum"> 186</span></a>          \core\event\<a class="class" onClick="logClass('user_updated')" href="../_classes/user_updated.html" onMouseOver="classPopup(event,'user_updated')">user_updated</a>::<a class="function" onClick="logFunction('create_from_userid')" href="../_functions/create_from_userid.html" onMouseOver="funcPopup(event,'create_from_userid')">create_from_userid</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l187"><span class="linenum"> 187</span></a>      }
<a name="l188"><span class="linenum"> 188</span></a>  }
<a name="l189"><span class="linenum"> 189</span></a>  
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment">/**</span>
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment"> * Marks user deleted in internal user database and notifies the auth plugin.</span>
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment"> * Also unenrols user from all roles and does other cleanup.</span>
<a name="l193"><span class="linenum"> 193</span></a>  <span class="comment"> *</span>
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment"> * @todo Decide if this transaction is really needed (look for internal TODO:)</span>
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment"> * @param object $user Userobject before delete    (without system magic quotes)</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment"> * @return boolean success</span>
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment"> */</span>
<a name="l198"><span class="linenum"> 198</span></a>  function <a class="function" onClick="logFunction('user_delete_user')" href="../_functions/user_delete_user.html" onMouseOver="funcPopup(event,'user_delete_user')">user_delete_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l199"><span class="linenum"> 199</span></a>      return <a class="function" onClick="logFunction('delete_user')" href="../_functions/delete_user.html" onMouseOver="funcPopup(event,'delete_user')">delete_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l200"><span class="linenum"> 200</span></a>  }
<a name="l201"><span class="linenum"> 201</span></a>  
<a name="l202"><span class="linenum"> 202</span></a>  <span class="comment">/**</span>
<a name="l203"><span class="linenum"> 203</span></a>  <span class="comment"> * Get users by id</span>
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment"> *</span>
<a name="l205"><span class="linenum"> 205</span></a>  <span class="comment"> * @param array $userids id of users to retrieve</span>
<a name="l206"><span class="linenum"> 206</span></a>  <span class="comment"> * @return array</span>
<a name="l207"><span class="linenum"> 207</span></a>  <span class="comment"> */</span>
<a name="l208"><span class="linenum"> 208</span></a>  function <a class="function" onClick="logFunction('user_get_users_by_id')" href="../_functions/user_get_users_by_id.html" onMouseOver="funcPopup(event,'user_get_users_by_id')">user_get_users_by_id</a>(<a class="var it2955" onMouseOver="hilite(2955)" onMouseOut="lolite()" onClick="logVariable('userids')" href="../_variables/userids.html">$userids</a>) {
<a name="l209"><span class="linenum"> 209</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l210"><span class="linenum"> 210</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_list')" href="../_functions/get_records_list.html" onMouseOver="funcPopup(event,'get_records_list')">get_records_list</a>('user', 'id', <a class="var it2955" onMouseOver="hilite(2955)" onMouseOut="lolite()" onClick="logVariable('userids')" href="../_variables/userids.html">$userids</a>);
<a name="l211"><span class="linenum"> 211</span></a>  }
<a name="l212"><span class="linenum"> 212</span></a>  
<a name="l213"><span class="linenum"> 213</span></a>  <span class="comment">/**</span>
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment"> * Returns the list of default 'displayable' fields</span>
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment"> *</span>
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment"> * Contains database field names but also names used to generate information, such as enrolledcourses</span>
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment"> *</span>
<a name="l218"><span class="linenum"> 218</span></a>  <span class="comment"> * @return array of user fields</span>
<a name="l219"><span class="linenum"> 219</span></a>  <span class="comment"> */</span>
<a name="l220"><span class="linenum"> 220</span></a>  function <a class="function" onClick="logFunction('user_get_default_fields')" href="../_functions/user_get_default_fields.html" onMouseOver="funcPopup(event,'user_get_default_fields')">user_get_default_fields</a>() {
<a name="l221"><span class="linenum"> 221</span></a>      return array( 'id', 'username', 'fullname', 'firstname', 'lastname', 'email',
<a name="l222"><span class="linenum"> 222</span></a>          'address', 'phone1', 'phone2', 'icq', 'skype', 'yahoo', 'aim', 'msn', 'department',
<a name="l223"><span class="linenum"> 223</span></a>          'institution', 'interests', 'firstaccess', 'lastaccess', 'auth', 'confirmed',
<a name="l224"><span class="linenum"> 224</span></a>          'idnumber', 'lang', 'theme', 'timezone', 'mailformat', 'description', 'descriptionformat',
<a name="l225"><span class="linenum"> 225</span></a>          'city', 'url', 'country', 'profileimageurlsmall', 'profileimageurl', 'customfields',
<a name="l226"><span class="linenum"> 226</span></a>          'groups', 'roles', 'preferences', 'enrolledcourses'
<a name="l227"><span class="linenum"> 227</span></a>      );
<a name="l228"><span class="linenum"> 228</span></a>  }
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment">/**</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment"> *</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment"> * Give user record from mdl_user, build an array contains all user details.</span>
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment"> *</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment"> * Warning: description file urls are 'webservice/pluginfile.php' is use.</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment"> *          it can be changed with $CFG-&gt;moodlewstextformatlinkstoimagesfile</span>
<a name="l236"><span class="linenum"> 236</span></a>  <span class="comment"> *</span>
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment"> * @throws moodle_exception</span>
<a name="l238"><span class="linenum"> 238</span></a>  <span class="comment"> * @param stdClass $user user record from mdl_user</span>
<a name="l239"><span class="linenum"> 239</span></a>  <span class="comment"> * @param stdClass $course moodle course</span>
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment"> * @param array $userfields required fields</span>
<a name="l241"><span class="linenum"> 241</span></a>  <span class="comment"> * @return array|null</span>
<a name="l242"><span class="linenum"> 242</span></a>  <span class="comment"> */</span>
<a name="l243"><span class="linenum"> 243</span></a>  function <a class="function" onClick="logFunction('user_get_user_details')" href="../_functions/user_get_user_details.html" onMouseOver="funcPopup(event,'user_get_user_details')">user_get_user_details</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = null, array <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> = array()) {
<a name="l244"><span class="linenum"> 244</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l245"><span class="linenum"> 245</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a> . "<a class="filename" href="../user/profile/lib.php.html">/user/profile/lib.php</a>"); <span class="comment">// Custom field library.</span>
<a name="l246"><span class="linenum"> 246</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a> . "<a class="filename" href="../lib/filelib.php.html">/lib/filelib.php</a>");      <span class="comment">// File handling on description and friends.</span>
<a name="l247"><span class="linenum"> 247</span></a>  
<a name="l248"><span class="linenum"> 248</span></a>      <a class="var it11616" onMouseOver="hilite(11616)" onMouseOut="lolite()" onClick="logVariable('defaultfields')" href="../_variables/defaultfields.html">$defaultfields</a> = <a class="function" onClick="logFunction('user_get_default_fields')" href="../_functions/user_get_default_fields.html" onMouseOver="funcPopup(event,'user_get_default_fields')">user_get_default_fields</a>();
<a name="l249"><span class="linenum"> 249</span></a>  
<a name="l250"><span class="linenum"> 250</span></a>      if (empty(<a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l251"><span class="linenum"> 251</span></a>          <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> = <a class="var it11616" onMouseOver="hilite(11616)" onMouseOut="lolite()" onClick="logVariable('defaultfields')" href="../_variables/defaultfields.html">$defaultfields</a>;
<a name="l252"><span class="linenum"> 252</span></a>      }
<a name="l253"><span class="linenum"> 253</span></a>  
<a name="l254"><span class="linenum"> 254</span></a>      foreach (<a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> as <a class="var it11617" onMouseOver="hilite(11617)" onMouseOut="lolite()" onClick="logVariable('thefield')" href="../_variables/thefield.html">$thefield</a>) {
<a name="l255"><span class="linenum"> 255</span></a>          if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it11617" onMouseOver="hilite(11617)" onMouseOut="lolite()" onClick="logVariable('thefield')" href="../_variables/thefield.html">$thefield</a>, <a class="var it11616" onMouseOver="hilite(11616)" onMouseOut="lolite()" onClick="logVariable('defaultfields')" href="../_variables/defaultfields.html">$defaultfields</a>)) {
<a name="l256"><span class="linenum"> 256</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invaliduserfield', 'error', '', <a class="var it11617" onMouseOver="hilite(11617)" onMouseOut="lolite()" onClick="logVariable('thefield')" href="../_variables/thefield.html">$thefield</a>);
<a name="l257"><span class="linenum"> 257</span></a>          }
<a name="l258"><span class="linenum"> 258</span></a>      }
<a name="l259"><span class="linenum"> 259</span></a>  
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment">    // Make sure id and fullname are included.</span>
<a name="l261"><span class="linenum"> 261</span></a>      if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('id', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l262"><span class="linenum"> 262</span></a>          <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>[] = 'id';
<a name="l263"><span class="linenum"> 263</span></a>      }
<a name="l264"><span class="linenum"> 264</span></a>  
<a name="l265"><span class="linenum"> 265</span></a>      if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('fullname', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l266"><span class="linenum"> 266</span></a>          <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>[] = 'fullname';
<a name="l267"><span class="linenum"> 267</span></a>      }
<a name="l268"><span class="linenum"> 268</span></a>  
<a name="l269"><span class="linenum"> 269</span></a>      if (!empty(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>)) {
<a name="l270"><span class="linenum"> 270</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l271"><span class="linenum"> 271</span></a>          <a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a> = <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l272"><span class="linenum"> 272</span></a>          <a class="var it11618" onMouseOver="hilite(11618)" onMouseOut="lolite()" onClick="logVariable('canviewdetailscap')" href="../_variables/canviewdetailscap.html">$canviewdetailscap</a> = (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/user:viewdetails', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) || <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/user:viewdetails', <a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a>));
<a name="l273"><span class="linenum"> 273</span></a>      } else {
<a name="l274"><span class="linenum"> 274</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l275"><span class="linenum"> 275</span></a>          <a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l276"><span class="linenum"> 276</span></a>          <a class="var it11618" onMouseOver="hilite(11618)" onMouseOut="lolite()" onClick="logVariable('canviewdetailscap')" href="../_variables/canviewdetailscap.html">$canviewdetailscap</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/user:viewdetails', <a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a>);
<a name="l277"><span class="linenum"> 277</span></a>      }
<a name="l278"><span class="linenum"> 278</span></a>  
<a name="l279"><span class="linenum"> 279</span></a>      <a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a> = (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l280"><span class="linenum"> 280</span></a>      <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a> = <a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>);
<a name="l281"><span class="linenum"> 281</span></a>  
<a name="l282"><span class="linenum"> 282</span></a>      <a class="var it11620" onMouseOver="hilite(11620)" onMouseOut="lolite()" onClick="logVariable('showuseridentityfields')" href="../_variables/showuseridentityfields.html">$showuseridentityfields</a> = <a class="function" onClick="logFunction('get_extra_user_fields')" href="../_functions/get_extra_user_fields.html" onMouseOver="funcPopup(event,'get_extra_user_fields')">get_extra_user_fields</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l283"><span class="linenum"> 283</span></a>  
<a name="l284"><span class="linenum"> 284</span></a>      if (!empty(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>)) {
<a name="l285"><span class="linenum"> 285</span></a>          <a class="var it11621" onMouseOver="hilite(11621)" onMouseOut="lolite()" onClick="logVariable('canviewhiddenuserfields')" href="../_variables/canviewhiddenuserfields.html">$canviewhiddenuserfields</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewhiddenuserfields', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l286"><span class="linenum"> 286</span></a>      } else {
<a name="l287"><span class="linenum"> 287</span></a>          <a class="var it11621" onMouseOver="hilite(11621)" onMouseOut="lolite()" onClick="logVariable('canviewhiddenuserfields')" href="../_variables/canviewhiddenuserfields.html">$canviewhiddenuserfields</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/user:viewhiddendetails', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l288"><span class="linenum"> 288</span></a>      }
<a name="l289"><span class="linenum"> 289</span></a>      <a class="var it11622" onMouseOver="hilite(11622)" onMouseOut="lolite()" onClick="logVariable('canviewfullnames')" href="../_variables/canviewfullnames.html">$canviewfullnames</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l290"><span class="linenum"> 290</span></a>      if (!empty(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>)) {
<a name="l291"><span class="linenum"> 291</span></a>          <a class="var it11623" onMouseOver="hilite(11623)" onMouseOut="lolite()" onClick="logVariable('canviewuseremail')" href="../_variables/canviewuseremail.html">$canviewuseremail</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:useremail', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l292"><span class="linenum"> 292</span></a>      } else {
<a name="l293"><span class="linenum"> 293</span></a>          <a class="var it11623" onMouseOver="hilite(11623)" onMouseOut="lolite()" onClick="logVariable('canviewuseremail')" href="../_variables/canviewuseremail.html">$canviewuseremail</a> = false;
<a name="l294"><span class="linenum"> 294</span></a>      }
<a name="l295"><span class="linenum"> 295</span></a>      <a class="var it11624" onMouseOver="hilite(11624)" onMouseOut="lolite()" onClick="logVariable('cannotviewdescription')" href="../_variables/cannotviewdescription.html">$cannotviewdescription</a>   = !empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('profilesforenrolledusersonly')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/profilesforenrolledusersonly.html">profilesforenrolledusersonly</a>) &amp;&amp; !<a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a> &amp;&amp; !<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('role_assignments', array('userid' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l296"><span class="linenum"> 296</span></a>      if (!empty(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>)) {
<a name="l297"><span class="linenum"> 297</span></a>          <a class="var it11626" onMouseOver="hilite(11626)" onMouseOut="lolite()" onClick="logVariable('canaccessallgroups')" href="../_variables/canaccessallgroups.html">$canaccessallgroups</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:accessallgroups', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l298"><span class="linenum"> 298</span></a>      } else {
<a name="l299"><span class="linenum"> 299</span></a>          <a class="var it11626" onMouseOver="hilite(11626)" onMouseOut="lolite()" onClick="logVariable('canaccessallgroups')" href="../_variables/canaccessallgroups.html">$canaccessallgroups</a> = false;
<a name="l300"><span class="linenum"> 300</span></a>      }
<a name="l301"><span class="linenum"> 301</span></a>  
<a name="l302"><span class="linenum"> 302</span></a>      if (!<a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a> &amp;&amp; !<a class="var it11618" onMouseOver="hilite(11618)" onMouseOut="lolite()" onClick="logVariable('canviewdetailscap')" href="../_variables/canviewdetailscap.html">$canviewdetailscap</a> &amp;&amp; !<a class="function" onClick="logFunction('has_coursecontact_role')" href="../_functions/has_coursecontact_role.html" onMouseOver="funcPopup(event,'has_coursecontact_role')">has_coursecontact_role</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment">        // Skip this user details.</span>
<a name="l304"><span class="linenum"> 304</span></a>          return null;
<a name="l305"><span class="linenum"> 305</span></a>      }
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>      <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a> = array();
<a name="l308"><span class="linenum"> 308</span></a>      <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['id'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l309"><span class="linenum"> 309</span></a>  
<a name="l310"><span class="linenum"> 310</span></a>      if ((<a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a> or <a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a>) and <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('username', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l311"><span class="linenum"> 311</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['username'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l312"><span class="linenum"> 312</span></a>      }
<a name="l313"><span class="linenum"> 313</span></a>      if (<a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a> or <a class="var it11622" onMouseOver="hilite(11622)" onMouseOut="lolite()" onClick="logVariable('canviewfullnames')" href="../_variables/canviewfullnames.html">$canviewfullnames</a>) {
<a name="l314"><span class="linenum"> 314</span></a>          if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('firstname', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l315"><span class="linenum"> 315</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['firstname'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstname')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/firstname.html">firstname</a>;
<a name="l316"><span class="linenum"> 316</span></a>          }
<a name="l317"><span class="linenum"> 317</span></a>          if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('lastname', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l318"><span class="linenum"> 318</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['lastname'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lastname')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/lastname.html">lastname</a>;
<a name="l319"><span class="linenum"> 319</span></a>          }
<a name="l320"><span class="linenum"> 320</span></a>      }
<a name="l321"><span class="linenum"> 321</span></a>      <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['fullname'] = <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l322"><span class="linenum"> 322</span></a>  
<a name="l323"><span class="linenum"> 323</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('customfields', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l324"><span class="linenum"> 324</span></a>          <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(&quot;SELECT f.*
<a name="l325"><span class="linenum"> 325</span></a>                                              FROM {user_info_field} f
<a name="l326"><span class="linenum"> 326</span></a>                                              JOIN {user_info_category} c
<a name="l327"><span class="linenum"> 327</span></a>                                                   ON f.categoryid=c.id
<a name="l328"><span class="linenum"> 328</span></a>                                          ORDER BY c.sortorder ASC, f.sortorder ASC&quot;);
<a name="l329"><span class="linenum"> 329</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['customfields'] = array();
<a name="l330"><span class="linenum"> 330</span></a>          foreach (<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> as <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>) {
<a name="l331"><span class="linenum"> 331</span></a>              require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'/user/profile/field/'.<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>-&gt;<a onClick="logVariable('datatype')" class="var it39671" onMouseOver="hilite(39671)" onMouseOut="lolite()" href="../_variables/datatype.html">datatype</a>.'/field.class.php');
<a name="l332"><span class="linenum"> 332</span></a>              <a class="var it4764" onMouseOver="hilite(4764)" onMouseOut="lolite()" onClick="logVariable('newfield')" href="../_variables/newfield.html">$newfield</a> = 'profile_field_'.<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>-&gt;<a onClick="logVariable('datatype')" class="var it39671" onMouseOver="hilite(39671)" onMouseOut="lolite()" href="../_variables/datatype.html">datatype</a>;
<a name="l333"><span class="linenum"> 333</span></a>              <a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a> = new <a class="var it4764" onMouseOver="hilite(4764)" onMouseOut="lolite()" onClick="logVariable('newfield')" href="../_variables/newfield.html">$newfield</a>(<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>-&gt;<a onClick="logVariable('id')" class="var it39671" onMouseOver="hilite(39671)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l334"><span class="linenum"> 334</span></a>              if (<a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a>-&gt;<a class="function" onClick="logFunction('is_visible')" href="../_functions/is_visible.html" onMouseOver="funcPopup(event,'is_visible')">is_visible</a>() and !<a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a>-&gt;<a class="function" onClick="logFunction('is_empty')" href="../_functions/is_empty.html" onMouseOver="funcPopup(event,'is_empty')">is_empty</a>()) {
<a name="l335"><span class="linenum"> 335</span></a>                  <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['customfields'][] =
<a name="l336"><span class="linenum"> 336</span></a>                      array('name' =&gt; <a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a>-&gt;<a onClick="logVariable('field')" class="var it39672" onMouseOver="hilite(39672)" onMouseOut="lolite()" href="../_variables/field.html">field</a>-&gt;name, 'value' =&gt; <a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a>-&gt;<a onClick="logVariable('data')" class="var it39672" onMouseOver="hilite(39672)" onMouseOut="lolite()" href="../_variables/data.html">data</a>,
<a name="l337"><span class="linenum"> 337</span></a>                          'type' =&gt; <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>-&gt;<a onClick="logVariable('datatype')" class="var it39671" onMouseOver="hilite(39671)" onMouseOut="lolite()" href="../_variables/datatype.html">datatype</a>, 'shortname' =&gt; <a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a>-&gt;<a onClick="logVariable('field')" class="var it39672" onMouseOver="hilite(39672)" onMouseOut="lolite()" href="../_variables/field.html">field</a>-&gt;shortname);
<a name="l338"><span class="linenum"> 338</span></a>              }
<a name="l339"><span class="linenum"> 339</span></a>          }
<a name="l340"><span class="linenum"> 340</span></a>          <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment">        // Unset customfields if it's empty.</span>
<a name="l342"><span class="linenum"> 342</span></a>          if (empty(<a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['customfields'])) {
<a name="l343"><span class="linenum"> 343</span></a>              unset(<a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['customfields']);
<a name="l344"><span class="linenum"> 344</span></a>          }
<a name="l345"><span class="linenum"> 345</span></a>      }
<a name="l346"><span class="linenum"> 346</span></a>  
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment">    // Profile image.</span>
<a name="l348"><span class="linenum"> 348</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('profileimageurl', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l349"><span class="linenum"> 349</span></a>          <a class="var it11628" onMouseOver="hilite(11628)" onMouseOut="lolite()" onClick="logVariable('profileimageurl')" href="../_variables/profileimageurl.html">$profileimageurl</a> = <a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>::<a class="function" onClick="logFunction('make_pluginfile_url')" href="../_functions/make_pluginfile_url.html" onMouseOver="funcPopup(event,'make_pluginfile_url')">make_pluginfile_url</a>(<a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a>-&gt;<a onClick="logVariable('id')" class="var it39494" onMouseOver="hilite(39494)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'user', 'icon', null, '/', 'f1');
<a name="l350"><span class="linenum"> 350</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['profileimageurl'] = <a class="var it11628" onMouseOver="hilite(11628)" onMouseOut="lolite()" onClick="logVariable('profileimageurl')" href="../_variables/profileimageurl.html">$profileimageurl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>(false);
<a name="l351"><span class="linenum"> 351</span></a>      }
<a name="l352"><span class="linenum"> 352</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('profileimageurlsmall', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l353"><span class="linenum"> 353</span></a>          <a class="var it11629" onMouseOver="hilite(11629)" onMouseOut="lolite()" onClick="logVariable('profileimageurlsmall')" href="../_variables/profileimageurlsmall.html">$profileimageurlsmall</a> = <a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>::<a class="function" onClick="logFunction('make_pluginfile_url')" href="../_functions/make_pluginfile_url.html" onMouseOver="funcPopup(event,'make_pluginfile_url')">make_pluginfile_url</a>(<a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a>-&gt;<a onClick="logVariable('id')" class="var it39494" onMouseOver="hilite(39494)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'user', 'icon', null, '/', 'f2');
<a name="l354"><span class="linenum"> 354</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['profileimageurlsmall'] = <a class="var it11629" onMouseOver="hilite(11629)" onMouseOut="lolite()" onClick="logVariable('profileimageurlsmall')" href="../_variables/profileimageurlsmall.html">$profileimageurlsmall</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>(false);
<a name="l355"><span class="linenum"> 355</span></a>      }
<a name="l356"><span class="linenum"> 356</span></a>  
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment">    // Hidden user field.</span>
<a name="l358"><span class="linenum"> 358</span></a>      if (<a class="var it11621" onMouseOver="hilite(11621)" onMouseOut="lolite()" onClick="logVariable('canviewhiddenuserfields')" href="../_variables/canviewhiddenuserfields.html">$canviewhiddenuserfields</a>) {
<a name="l359"><span class="linenum"> 359</span></a>          <a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a> = array();
<a name="l360"><span class="linenum"> 360</span></a>  <span class="comment">        // Address, phone1 and phone2 not appears in hidden fields list but require viewhiddenfields capability</span>
<a name="l361"><span class="linenum"> 361</span></a>  <span class="comment">        // according to user/profile.php.</span>
<a name="l362"><span class="linenum"> 362</span></a>          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('address')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/address.html">address</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('address', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l363"><span class="linenum"> 363</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['address'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('address')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/address.html">address</a>;
<a name="l364"><span class="linenum"> 364</span></a>          }
<a name="l365"><span class="linenum"> 365</span></a>      } else {
<a name="l366"><span class="linenum"> 366</span></a>          <a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a> = <a class="phpfunction" onClick="logFunction('array_flip')" href="../_functions/array_flip.html" onMouseOver="phpfuncPopup(event,'array_flip')">array_flip</a>(<a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('hiddenuserfields')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/hiddenuserfields.html">hiddenuserfields</a>));
<a name="l367"><span class="linenum"> 367</span></a>      }
<a name="l368"><span class="linenum"> 368</span></a>  
<a name="l369"><span class="linenum"> 369</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('phone1')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/phone1.html">phone1</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('phone1', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp;
<a name="l370"><span class="linenum"> 370</span></a>              (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('phone1', <a class="var it11620" onMouseOver="hilite(11620)" onMouseOut="lolite()" onClick="logVariable('showuseridentityfields')" href="../_variables/showuseridentityfields.html">$showuseridentityfields</a>) or <a class="var it11621" onMouseOver="hilite(11621)" onMouseOut="lolite()" onClick="logVariable('canviewhiddenuserfields')" href="../_variables/canviewhiddenuserfields.html">$canviewhiddenuserfields</a>)) {
<a name="l371"><span class="linenum"> 371</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['phone1'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('phone1')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/phone1.html">phone1</a>;
<a name="l372"><span class="linenum"> 372</span></a>      }
<a name="l373"><span class="linenum"> 373</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('phone2')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/phone2.html">phone2</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('phone2', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp;
<a name="l374"><span class="linenum"> 374</span></a>              (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('phone2', <a class="var it11620" onMouseOver="hilite(11620)" onMouseOut="lolite()" onClick="logVariable('showuseridentityfields')" href="../_variables/showuseridentityfields.html">$showuseridentityfields</a>) or <a class="var it11621" onMouseOver="hilite(11621)" onMouseOut="lolite()" onClick="logVariable('canviewhiddenuserfields')" href="../_variables/canviewhiddenuserfields.html">$canviewhiddenuserfields</a>)) {
<a name="l375"><span class="linenum"> 375</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['phone2'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('phone2')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/phone2.html">phone2</a>;
<a name="l376"><span class="linenum"> 376</span></a>      }
<a name="l377"><span class="linenum"> 377</span></a>  
<a name="l378"><span class="linenum"> 378</span></a>      if (isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('description')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/description.html">description</a>) &amp;&amp;
<a name="l379"><span class="linenum"> 379</span></a>          ((!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['description']) &amp;&amp; !<a class="var it11624" onMouseOver="hilite(11624)" onMouseOut="lolite()" onClick="logVariable('cannotviewdescription')" href="../_variables/cannotviewdescription.html">$cannotviewdescription</a>) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>)) {
<a name="l380"><span class="linenum"> 380</span></a>          if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('description', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>)) {
<a name="l381"><span class="linenum"> 381</span></a>  <span class="comment">            // Always return the descriptionformat if description is requested.</span>
<a name="l382"><span class="linenum"> 382</span></a>              <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['description'], <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['descriptionformat']) =
<a name="l383"><span class="linenum"> 383</span></a>                      <a class="function" onClick="logFunction('external_format_text')" href="../_functions/external_format_text.html" onMouseOver="funcPopup(event,'external_format_text')">external_format_text</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('description')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/description.html">description</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('descriptionformat')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/descriptionformat.html">descriptionformat</a>,
<a name="l384"><span class="linenum"> 384</span></a>                              <a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a>-&gt;<a onClick="logVariable('id')" class="var it39494" onMouseOver="hilite(39494)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'user', 'profile', null);
<a name="l385"><span class="linenum"> 385</span></a>          }
<a name="l386"><span class="linenum"> 386</span></a>      }
<a name="l387"><span class="linenum"> 387</span></a>  
<a name="l388"><span class="linenum"> 388</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('country', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['country']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('country')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/country.html">country</a>) {
<a name="l389"><span class="linenum"> 389</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['country'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('country')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/country.html">country</a>;
<a name="l390"><span class="linenum"> 390</span></a>      }
<a name="l391"><span class="linenum"> 391</span></a>  
<a name="l392"><span class="linenum"> 392</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('city', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['city']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('city')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/city.html">city</a>) {
<a name="l393"><span class="linenum"> 393</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['city'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('city')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/city.html">city</a>;
<a name="l394"><span class="linenum"> 394</span></a>      }
<a name="l395"><span class="linenum"> 395</span></a>  
<a name="l396"><span class="linenum"> 396</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('url', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('url')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/url.html">url</a> &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['webpage']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>)) {
<a name="l397"><span class="linenum"> 397</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('url')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/url.html">url</a>;
<a name="l398"><span class="linenum"> 398</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('url')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/url.html">url</a>, '://') === false) {
<a name="l399"><span class="linenum"> 399</span></a>              <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = 'http://'. <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>;
<a name="l400"><span class="linenum"> 400</span></a>          }
<a name="l401"><span class="linenum"> 401</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('url')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/url.html">url</a> = <a class="function" onClick="logFunction('clean_param')" href="../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('url')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/url.html">url</a>, <a class="constant" onClick="logConstant('PARAM_URL')" href="../_constants/PARAM_URL.html" onMouseOver="constPopup(event,'PARAM_URL')">PARAM_URL</a>);
<a name="l402"><span class="linenum"> 402</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['url'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('url')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/url.html">url</a>;
<a name="l403"><span class="linenum"> 403</span></a>      }
<a name="l404"><span class="linenum"> 404</span></a>  
<a name="l405"><span class="linenum"> 405</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('icq', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('icq')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/icq.html">icq</a> &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['icqnumber']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>)) {
<a name="l406"><span class="linenum"> 406</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['icq'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('icq')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/icq.html">icq</a>;
<a name="l407"><span class="linenum"> 407</span></a>      }
<a name="l408"><span class="linenum"> 408</span></a>  
<a name="l409"><span class="linenum"> 409</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('skype', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('skype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/skype.html">skype</a> &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['skypeid']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>)) {
<a name="l410"><span class="linenum"> 410</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['skype'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('skype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/skype.html">skype</a>;
<a name="l411"><span class="linenum"> 411</span></a>      }
<a name="l412"><span class="linenum"> 412</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('yahoo', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('yahoo')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/yahoo.html">yahoo</a> &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['yahooid']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>)) {
<a name="l413"><span class="linenum"> 413</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['yahoo'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('yahoo')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/yahoo.html">yahoo</a>;
<a name="l414"><span class="linenum"> 414</span></a>      }
<a name="l415"><span class="linenum"> 415</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('aim', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('aim')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/aim.html">aim</a> &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['aimid']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>)) {
<a name="l416"><span class="linenum"> 416</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['aim'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('aim')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/aim.html">aim</a>;
<a name="l417"><span class="linenum"> 417</span></a>      }
<a name="l418"><span class="linenum"> 418</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('msn', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('msn')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/msn.html">msn</a> &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['msnid']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>)) {
<a name="l419"><span class="linenum"> 419</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['msn'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('msn')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/msn.html">msn</a>;
<a name="l420"><span class="linenum"> 420</span></a>      }
<a name="l421"><span class="linenum"> 421</span></a>  
<a name="l422"><span class="linenum"> 422</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('firstaccess', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['firstaccess']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>)) {
<a name="l423"><span class="linenum"> 423</span></a>          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstaccess')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/firstaccess.html">firstaccess</a>) {
<a name="l424"><span class="linenum"> 424</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['firstaccess'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstaccess')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/firstaccess.html">firstaccess</a>;
<a name="l425"><span class="linenum"> 425</span></a>          } else {
<a name="l426"><span class="linenum"> 426</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['firstaccess'] = 0;
<a name="l427"><span class="linenum"> 427</span></a>          }
<a name="l428"><span class="linenum"> 428</span></a>      }
<a name="l429"><span class="linenum"> 429</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('lastaccess', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; (!isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['lastaccess']) or <a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a>)) {
<a name="l430"><span class="linenum"> 430</span></a>          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lastaccess')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/lastaccess.html">lastaccess</a>) {
<a name="l431"><span class="linenum"> 431</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['lastaccess'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lastaccess')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/lastaccess.html">lastaccess</a>;
<a name="l432"><span class="linenum"> 432</span></a>          } else {
<a name="l433"><span class="linenum"> 433</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['lastaccess'] = 0;
<a name="l434"><span class="linenum"> 434</span></a>          }
<a name="l435"><span class="linenum"> 435</span></a>      }
<a name="l436"><span class="linenum"> 436</span></a>  
<a name="l437"><span class="linenum"> 437</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('email', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; (<a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a> // The admin is allowed the users email.
<a name="l438"><span class="linenum"> 438</span></a>        or <a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a> // Of course the current user is as well.
<a name="l439"><span class="linenum"> 439</span></a>        or <a class="var it11623" onMouseOver="hilite(11623)" onMouseOut="lolite()" onClick="logVariable('canviewuseremail')" href="../_variables/canviewuseremail.html">$canviewuseremail</a>  // This is a capability in course context, it will be false in usercontext.
<a name="l440"><span class="linenum"> 440</span></a>        or <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('email', <a class="var it11620" onMouseOver="hilite(11620)" onMouseOut="lolite()" onClick="logVariable('showuseridentityfields')" href="../_variables/showuseridentityfields.html">$showuseridentityfields</a>)
<a name="l441"><span class="linenum"> 441</span></a>        or <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('maildisplay')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/maildisplay.html">maildisplay</a> == 1
<a name="l442"><span class="linenum"> 442</span></a>        <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('maildisplay')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/maildisplay.html">maildisplay</a> == 2 and <a class="function" onClick="logFunction('enrol_sharing_course')" href="../_functions/enrol_sharing_course.html" onMouseOver="funcPopup(event,'enrol_sharing_course')">enrol_sharing_course</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>)))) {
<a name="l443"><span class="linenum"> 443</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['email'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/email.html">email</a>;
<a name="l444"><span class="linenum"> 444</span></a>      }
<a name="l445"><span class="linenum"> 445</span></a>  
<a name="l446"><span class="linenum"> 446</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('interests', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; !empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('usetags')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/usetags.html">usetags</a>)) {
<a name="l447"><span class="linenum"> 447</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../tag/lib.php.html">/tag/lib.php</a>');
<a name="l448"><span class="linenum"> 448</span></a>          if (<a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('interests')" href="../_variables/interests.html">$interests</a> = <a class="function" onClick="logFunction('tag_get_tags_csv')" href="../_functions/tag_get_tags_csv.html" onMouseOver="funcPopup(event,'tag_get_tags_csv')">tag_get_tags_csv</a>('user', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="constant" onClick="logConstant('TAG_RETURN_TEXT')" href="../_constants/TAG_RETURN_TEXT.html" onMouseOver="constPopup(event,'TAG_RETURN_TEXT')">TAG_RETURN_TEXT</a>) ) {
<a name="l449"><span class="linenum"> 449</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['interests'] = <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('interests')" href="../_variables/interests.html">$interests</a>;
<a name="l450"><span class="linenum"> 450</span></a>          }
<a name="l451"><span class="linenum"> 451</span></a>      }
<a name="l452"><span class="linenum"> 452</span></a>  
<a name="l453"><span class="linenum"> 453</span></a>  <span class="comment">    // Departement/Institution/Idnumber are not displayed on any profile, however you can get them from editing profile.</span>
<a name="l454"><span class="linenum"> 454</span></a>      if (<a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a> or <a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a> or <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('idnumber', <a class="var it11620" onMouseOver="hilite(11620)" onMouseOut="lolite()" onClick="logVariable('showuseridentityfields')" href="../_variables/showuseridentityfields.html">$showuseridentityfields</a>)) {
<a name="l455"><span class="linenum"> 455</span></a>          if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('idnumber', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/idnumber.html">idnumber</a>) {
<a name="l456"><span class="linenum"> 456</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['idnumber'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/idnumber.html">idnumber</a>;
<a name="l457"><span class="linenum"> 457</span></a>          }
<a name="l458"><span class="linenum"> 458</span></a>      }
<a name="l459"><span class="linenum"> 459</span></a>      if (<a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a> or <a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a> or <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('institution', <a class="var it11620" onMouseOver="hilite(11620)" onMouseOut="lolite()" onClick="logVariable('showuseridentityfields')" href="../_variables/showuseridentityfields.html">$showuseridentityfields</a>)) {
<a name="l460"><span class="linenum"> 460</span></a>          if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('institution', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('institution')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/institution.html">institution</a>) {
<a name="l461"><span class="linenum"> 461</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['institution'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('institution')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/institution.html">institution</a>;
<a name="l462"><span class="linenum"> 462</span></a>          }
<a name="l463"><span class="linenum"> 463</span></a>      }
<a name="l464"><span class="linenum"> 464</span></a>      if (<a class="var it11619" onMouseOver="hilite(11619)" onMouseOut="lolite()" onClick="logVariable('isadmin')" href="../_variables/isadmin.html">$isadmin</a> or <a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a> or <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('department', <a class="var it11620" onMouseOver="hilite(11620)" onMouseOut="lolite()" onClick="logVariable('showuseridentityfields')" href="../_variables/showuseridentityfields.html">$showuseridentityfields</a>)) {
<a name="l465"><span class="linenum"> 465</span></a>          if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('department', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; isset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('department')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/department.html">department</a>)) { // Isset because it's ok to have department 0.
<a name="l466"><span class="linenum"> 466</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['department'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('department')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/department.html">department</a>;
<a name="l467"><span class="linenum"> 467</span></a>          }
<a name="l468"><span class="linenum"> 468</span></a>      }
<a name="l469"><span class="linenum"> 469</span></a>  
<a name="l470"><span class="linenum"> 470</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('roles', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; !empty(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>)) {
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment">        // Not a big secret.</span>
<a name="l472"><span class="linenum"> 472</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="function" onClick="logFunction('get_user_roles')" href="../_functions/get_user_roles.html" onMouseOver="funcPopup(event,'get_user_roles')">get_user_roles</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, false);
<a name="l473"><span class="linenum"> 473</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['roles'] = array();
<a name="l474"><span class="linenum"> 474</span></a>          foreach (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> as <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l475"><span class="linenum"> 475</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['roles'][] = array(
<a name="l476"><span class="linenum"> 476</span></a>                  'roleid'       =&gt; <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('roleid')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>,
<a name="l477"><span class="linenum"> 477</span></a>                  'name'         =&gt; <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('name')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/name.html">name</a>,
<a name="l478"><span class="linenum"> 478</span></a>                  'shortname'    =&gt; <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>,
<a name="l479"><span class="linenum"> 479</span></a>                  'sortorder'    =&gt; <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;sortorder
<a name="l480"><span class="linenum"> 480</span></a>              );
<a name="l481"><span class="linenum"> 481</span></a>          }
<a name="l482"><span class="linenum"> 482</span></a>      }
<a name="l483"><span class="linenum"> 483</span></a>  
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment">    // If groups are in use and enforced throughout the course, then make sure we can meet in at least one course level group.</span>
<a name="l485"><span class="linenum"> 485</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('groups', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; !empty(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) &amp;&amp; <a class="var it11626" onMouseOver="hilite(11626)" onMouseOut="lolite()" onClick="logVariable('canaccessallgroups')" href="../_variables/canaccessallgroups.html">$canaccessallgroups</a>) {
<a name="l486"><span class="linenum"> 486</span></a>          <a class="var it11639" onMouseOver="hilite(11639)" onMouseOut="lolite()" onClick="logVariable('usergroups')" href="../_variables/usergroups.html">$usergroups</a> = <a class="function" onClick="logFunction('groups_get_all_groups')" href="../_functions/groups_get_all_groups.html" onMouseOver="funcPopup(event,'groups_get_all_groups')">groups_get_all_groups</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('defaultgroupingid')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/defaultgroupingid.html">defaultgroupingid</a>,
<a name="l487"><span class="linenum"> 487</span></a>                  'g.id, g.name,g.description,g.descriptionformat');
<a name="l488"><span class="linenum"> 488</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['groups'] = array();
<a name="l489"><span class="linenum"> 489</span></a>          foreach (<a class="var it11639" onMouseOver="hilite(11639)" onMouseOut="lolite()" onClick="logVariable('usergroups')" href="../_variables/usergroups.html">$usergroups</a> as <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>) {
<a name="l490"><span class="linenum"> 490</span></a>              <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('description')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../_variables/description.html">description</a>, <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('descriptionformat')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../_variables/descriptionformat.html">descriptionformat</a>) =
<a name="l491"><span class="linenum"> 491</span></a>                  <a class="function" onClick="logFunction('external_format_text')" href="../_functions/external_format_text.html" onMouseOver="funcPopup(event,'external_format_text')">external_format_text</a>(<a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('description')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../_variables/description.html">description</a>, <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('descriptionformat')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../_variables/descriptionformat.html">descriptionformat</a>,
<a name="l492"><span class="linenum"> 492</span></a>                          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'group', 'description', <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('id')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l493"><span class="linenum"> 493</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['groups'][] = array('id' =&gt; <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('id')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'name' =&gt; <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('name')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../_variables/name.html">name</a>,
<a name="l494"><span class="linenum"> 494</span></a>                  'description' =&gt; <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('description')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../_variables/description.html">description</a>, 'descriptionformat' =&gt; <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('descriptionformat')" class="var it39663" onMouseOver="hilite(39663)" onMouseOut="lolite()" href="../_variables/descriptionformat.html">descriptionformat</a>);
<a name="l495"><span class="linenum"> 495</span></a>          }
<a name="l496"><span class="linenum"> 496</span></a>      }
<a name="l497"><span class="linenum"> 497</span></a>  <span class="comment">    // List of courses where the user is enrolled.</span>
<a name="l498"><span class="linenum"> 498</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('enrolledcourses', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; !isset(<a class="var it11630" onMouseOver="hilite(11630)" onMouseOut="lolite()" onClick="logVariable('hiddenfields')" href="../_variables/hiddenfields.html">$hiddenfields</a>['mycourses'])) {
<a name="l499"><span class="linenum"> 499</span></a>          <a class="var it11640" onMouseOver="hilite(11640)" onMouseOut="lolite()" onClick="logVariable('enrolledcourses')" href="../_variables/enrolledcourses.html">$enrolledcourses</a> = array();
<a name="l500"><span class="linenum"> 500</span></a>          if (<a class="var it3111" onMouseOver="hilite(3111)" onMouseOut="lolite()" onClick="logVariable('mycourses')" href="../_variables/mycourses.html">$mycourses</a> = <a class="function" onClick="logFunction('enrol_get_users_courses')" href="../_functions/enrol_get_users_courses.html" onMouseOver="funcPopup(event,'enrol_get_users_courses')">enrol_get_users_courses</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true)) {
<a name="l501"><span class="linenum"> 501</span></a>              foreach (<a class="var it3111" onMouseOver="hilite(3111)" onMouseOut="lolite()" onClick="logVariable('mycourses')" href="../_variables/mycourses.html">$mycourses</a> as <a class="var it3112" onMouseOver="hilite(3112)" onMouseOut="lolite()" onClick="logVariable('mycourse')" href="../_variables/mycourse.html">$mycourse</a>) {
<a name="l502"><span class="linenum"> 502</span></a>                  if (<a class="var it3112" onMouseOver="hilite(3112)" onMouseOut="lolite()" onClick="logVariable('mycourse')" href="../_variables/mycourse.html">$mycourse</a>-&gt;<a onClick="logVariable('category')" class="var it39661" onMouseOver="hilite(39661)" onMouseOut="lolite()" href="../_variables/category.html">category</a>) {
<a name="l503"><span class="linenum"> 503</span></a>                      <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it3112" onMouseOver="hilite(3112)" onMouseOut="lolite()" onClick="logVariable('mycourse')" href="../_variables/mycourse.html">$mycourse</a>-&gt;<a onClick="logVariable('id')" class="var it39661" onMouseOver="hilite(39661)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l504"><span class="linenum"> 504</span></a>                      <a class="var it11641" onMouseOver="hilite(11641)" onMouseOut="lolite()" onClick="logVariable('enrolledcourse')" href="../_variables/enrolledcourse.html">$enrolledcourse</a> = array();
<a name="l505"><span class="linenum"> 505</span></a>                      <a class="var it11641" onMouseOver="hilite(11641)" onMouseOut="lolite()" onClick="logVariable('enrolledcourse')" href="../_variables/enrolledcourse.html">$enrolledcourse</a>['id'] = <a class="var it3112" onMouseOver="hilite(3112)" onMouseOut="lolite()" onClick="logVariable('mycourse')" href="../_variables/mycourse.html">$mycourse</a>-&gt;<a onClick="logVariable('id')" class="var it39661" onMouseOver="hilite(39661)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l506"><span class="linenum"> 506</span></a>                      <a class="var it11641" onMouseOver="hilite(11641)" onMouseOut="lolite()" onClick="logVariable('enrolledcourse')" href="../_variables/enrolledcourse.html">$enrolledcourse</a>['fullname'] = <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it3112" onMouseOver="hilite(3112)" onMouseOut="lolite()" onClick="logVariable('mycourse')" href="../_variables/mycourse.html">$mycourse</a>-&gt;<a onClick="logVariable('fullname')" class="var it39661" onMouseOver="hilite(39661)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>, true, array('context' =&gt; <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>));
<a name="l507"><span class="linenum"> 507</span></a>                      <a class="var it11641" onMouseOver="hilite(11641)" onMouseOut="lolite()" onClick="logVariable('enrolledcourse')" href="../_variables/enrolledcourse.html">$enrolledcourse</a>['shortname'] = <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it3112" onMouseOver="hilite(3112)" onMouseOut="lolite()" onClick="logVariable('mycourse')" href="../_variables/mycourse.html">$mycourse</a>-&gt;<a onClick="logVariable('shortname')" class="var it39661" onMouseOver="hilite(39661)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>));
<a name="l508"><span class="linenum"> 508</span></a>                      <a class="var it11640" onMouseOver="hilite(11640)" onMouseOut="lolite()" onClick="logVariable('enrolledcourses')" href="../_variables/enrolledcourses.html">$enrolledcourses</a>[] = <a class="var it11641" onMouseOver="hilite(11641)" onMouseOut="lolite()" onClick="logVariable('enrolledcourse')" href="../_variables/enrolledcourse.html">$enrolledcourse</a>;
<a name="l509"><span class="linenum"> 509</span></a>                  }
<a name="l510"><span class="linenum"> 510</span></a>              }
<a name="l511"><span class="linenum"> 511</span></a>              <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['enrolledcourses'] = <a class="var it11640" onMouseOver="hilite(11640)" onMouseOut="lolite()" onClick="logVariable('enrolledcourses')" href="../_variables/enrolledcourses.html">$enrolledcourses</a>;
<a name="l512"><span class="linenum"> 512</span></a>          }
<a name="l513"><span class="linenum"> 513</span></a>      }
<a name="l514"><span class="linenum"> 514</span></a>  
<a name="l515"><span class="linenum"> 515</span></a>  <span class="comment">    // User preferences.</span>
<a name="l516"><span class="linenum"> 516</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('preferences', <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>) &amp;&amp; <a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a>) {
<a name="l517"><span class="linenum"> 517</span></a>          <a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('preferences')" href="../_variables/preferences.html">$preferences</a> = array();
<a name="l518"><span class="linenum"> 518</span></a>          <a class="var it1517" onMouseOver="hilite(1517)" onMouseOut="lolite()" onClick="logVariable('userpreferences')" href="../_variables/userpreferences.html">$userpreferences</a> = <a class="function" onClick="logFunction('get_user_preferences')" href="../_functions/get_user_preferences.html" onMouseOver="funcPopup(event,'get_user_preferences')">get_user_preferences</a>();
<a name="l519"><span class="linenum"> 519</span></a>          foreach (<a class="var it1517" onMouseOver="hilite(1517)" onMouseOut="lolite()" onClick="logVariable('userpreferences')" href="../_variables/userpreferences.html">$userpreferences</a> as <a class="var it11642" onMouseOver="hilite(11642)" onMouseOut="lolite()" onClick="logVariable('prefname')" href="../_variables/prefname.html">$prefname</a> =&gt; <a class="var it11643" onMouseOver="hilite(11643)" onMouseOut="lolite()" onClick="logVariable('prefvalue')" href="../_variables/prefvalue.html">$prefvalue</a>) {
<a name="l520"><span class="linenum"> 520</span></a>              <a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('preferences')" href="../_variables/preferences.html">$preferences</a>[] = array('name' =&gt; <a class="var it11642" onMouseOver="hilite(11642)" onMouseOut="lolite()" onClick="logVariable('prefname')" href="../_variables/prefname.html">$prefname</a>, 'value' =&gt; <a class="var it11643" onMouseOver="hilite(11643)" onMouseOut="lolite()" onClick="logVariable('prefvalue')" href="../_variables/prefvalue.html">$prefvalue</a>);
<a name="l521"><span class="linenum"> 521</span></a>          }
<a name="l522"><span class="linenum"> 522</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>['preferences'] = <a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('preferences')" href="../_variables/preferences.html">$preferences</a>;
<a name="l523"><span class="linenum"> 523</span></a>      }
<a name="l524"><span class="linenum"> 524</span></a>  
<a name="l525"><span class="linenum"> 525</span></a>      return <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>;
<a name="l526"><span class="linenum"> 526</span></a>  }
<a name="l527"><span class="linenum"> 527</span></a>  
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment">/**</span>
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment"> * Tries to obtain user details, either recurring directly to the user's system profile</span>
<a name="l530"><span class="linenum"> 530</span></a>  <span class="comment"> * or through one of the user's course enrollments (course profile).</span>
<a name="l531"><span class="linenum"> 531</span></a>  <span class="comment"> *</span>
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment"> * @param stdClass $user The user.</span>
<a name="l533"><span class="linenum"> 533</span></a>  <span class="comment"> * @return array if unsuccessful or the allowed user details.</span>
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment"> */</span>
<a name="l535"><span class="linenum"> 535</span></a>  function <a class="function" onClick="logFunction('user_get_user_details_courses')" href="../_functions/user_get_user_details_courses.html" onMouseOver="funcPopup(event,'user_get_user_details_courses')">user_get_user_details_courses</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l536"><span class="linenum"> 536</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l537"><span class="linenum"> 537</span></a>      <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a> = null;
<a name="l538"><span class="linenum"> 538</span></a>  
<a name="l539"><span class="linenum"> 539</span></a>  <span class="comment">    // Get the courses that the user is enrolled in (only active).</span>
<a name="l540"><span class="linenum"> 540</span></a>      <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> = <a class="function" onClick="logFunction('enrol_get_users_courses')" href="../_functions/enrol_get_users_courses.html" onMouseOver="funcPopup(event,'enrol_get_users_courses')">enrol_get_users_courses</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true);
<a name="l541"><span class="linenum"> 541</span></a>  
<a name="l542"><span class="linenum"> 542</span></a>      <a class="var it11644" onMouseOver="hilite(11644)" onMouseOut="lolite()" onClick="logVariable('systemprofile')" href="../_variables/systemprofile.html">$systemprofile</a> = false;
<a name="l543"><span class="linenum"> 543</span></a>      if (<a class="function" onClick="logFunction('can_view_user_details_cap')" href="../_functions/can_view_user_details_cap.html" onMouseOver="funcPopup(event,'can_view_user_details_cap')">can_view_user_details_cap</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) || (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) || <a class="function" onClick="logFunction('has_coursecontact_role')" href="../_functions/has_coursecontact_role.html" onMouseOver="funcPopup(event,'has_coursecontact_role')">has_coursecontact_role</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l544"><span class="linenum"> 544</span></a>          <a class="var it11644" onMouseOver="hilite(11644)" onMouseOut="lolite()" onClick="logVariable('systemprofile')" href="../_variables/systemprofile.html">$systemprofile</a> = true;
<a name="l545"><span class="linenum"> 545</span></a>      }
<a name="l546"><span class="linenum"> 546</span></a>  
<a name="l547"><span class="linenum"> 547</span></a>  <span class="comment">    // Try using system profile.</span>
<a name="l548"><span class="linenum"> 548</span></a>      if (<a class="var it11644" onMouseOver="hilite(11644)" onMouseOut="lolite()" onClick="logVariable('systemprofile')" href="../_variables/systemprofile.html">$systemprofile</a>) {
<a name="l549"><span class="linenum"> 549</span></a>          <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a> = <a class="function" onClick="logFunction('user_get_user_details')" href="../_functions/user_get_user_details.html" onMouseOver="funcPopup(event,'user_get_user_details')">user_get_user_details</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, null);
<a name="l550"><span class="linenum"> 550</span></a>      } else {
<a name="l551"><span class="linenum"> 551</span></a>  <span class="comment">        // Try through course profile.</span>
<a name="l552"><span class="linenum"> 552</span></a>          foreach (<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> as <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l553"><span class="linenum"> 553</span></a>              if (<a class="function" onClick="logFunction('can_view_user_details_cap')" href="../_functions/can_view_user_details_cap.html" onMouseOver="funcPopup(event,'can_view_user_details_cap')">can_view_user_details_cap</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) || (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) || <a class="function" onClick="logFunction('has_coursecontact_role')" href="../_functions/has_coursecontact_role.html" onMouseOver="funcPopup(event,'has_coursecontact_role')">has_coursecontact_role</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l554"><span class="linenum"> 554</span></a>                  <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a> = <a class="function" onClick="logFunction('user_get_user_details')" href="../_functions/user_get_user_details.html" onMouseOver="funcPopup(event,'user_get_user_details')">user_get_user_details</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l555"><span class="linenum"> 555</span></a>              }
<a name="l556"><span class="linenum"> 556</span></a>          }
<a name="l557"><span class="linenum"> 557</span></a>      }
<a name="l558"><span class="linenum"> 558</span></a>  
<a name="l559"><span class="linenum"> 559</span></a>      return <a class="var it2961" onMouseOver="hilite(2961)" onMouseOut="lolite()" onClick="logVariable('userdetails')" href="../_variables/userdetails.html">$userdetails</a>;
<a name="l560"><span class="linenum"> 560</span></a>  }
<a name="l561"><span class="linenum"> 561</span></a>  
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment">/**</span>
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment"> * Check if $USER have the necessary capabilities to obtain user details.</span>
<a name="l564"><span class="linenum"> 564</span></a>  <span class="comment"> *</span>
<a name="l565"><span class="linenum"> 565</span></a>  <span class="comment"> * @param stdClass $user</span>
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment"> * @param stdClass $course if null then only consider system profile otherwise also consider the course's profile.</span>
<a name="l567"><span class="linenum"> 567</span></a>  <span class="comment"> * @return bool true if $USER can view user details.</span>
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment"> */</span>
<a name="l569"><span class="linenum"> 569</span></a>  function <a class="function" onClick="logFunction('can_view_user_details_cap')" href="../_functions/can_view_user_details_cap.html" onMouseOver="funcPopup(event,'can_view_user_details_cap')">can_view_user_details_cap</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = null) {
<a name="l570"><span class="linenum"> 570</span></a>  <span class="comment">    // Check $USER has the capability to view the user details at user context.</span>
<a name="l571"><span class="linenum"> 571</span></a>      <a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a> = <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l572"><span class="linenum"> 572</span></a>      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/user:viewdetails', <a class="var it1419" onMouseOver="hilite(1419)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../_variables/usercontext.html">$usercontext</a>);
<a name="l573"><span class="linenum"> 573</span></a>  <span class="comment">    // Otherwise can $USER see them at course context.</span>
<a name="l574"><span class="linenum"> 574</span></a>      if (!<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> &amp;&amp; !empty(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>)) {
<a name="l575"><span class="linenum"> 575</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l576"><span class="linenum"> 576</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/user:viewdetails', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l577"><span class="linenum"> 577</span></a>      }
<a name="l578"><span class="linenum"> 578</span></a>      return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>;
<a name="l579"><span class="linenum"> 579</span></a>  }
<a name="l580"><span class="linenum"> 580</span></a>  
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment">/**</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment"> * Return a list of page types</span>
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment"> * @param string $pagetype current page type</span>
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment"> * @param stdClass $parentcontext Block's parent context</span>
<a name="l585"><span class="linenum"> 585</span></a>  <span class="comment"> * @param stdClass $currentcontext Current context of block</span>
<a name="l586"><span class="linenum"> 586</span></a>  <span class="comment"> * @return array</span>
<a name="l587"><span class="linenum"> 587</span></a>  <span class="comment"> */</span>
<a name="l588"><span class="linenum"> 588</span></a>  function <a class="function" onClick="logFunction('user_page_type_list')" href="../_functions/user_page_type_list.html" onMouseOver="funcPopup(event,'user_page_type_list')">user_page_type_list</a>(<a class="var it3667" onMouseOver="hilite(3667)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../_variables/pagetype.html">$pagetype</a>, <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a>, <a class="var it5093" onMouseOver="hilite(5093)" onMouseOut="lolite()" onClick="logVariable('currentcontext')" href="../_variables/currentcontext.html">$currentcontext</a>) {
<a name="l589"><span class="linenum"> 589</span></a>      return array('user-profile' =&gt; <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-user-profile', 'pagetype'));
<a name="l590"><span class="linenum"> 590</span></a>  }
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">/**</span>
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment"> * Count the number of failed login attempts for the given user, since last successful login.</span>
<a name="l594"><span class="linenum"> 594</span></a>  <span class="comment"> *</span>
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment"> * @param int|stdclass $user user id or object.</span>
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment"> * @param bool $reset Resets failed login count, if set to true.</span>
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment"> *</span>
<a name="l598"><span class="linenum"> 598</span></a>  <span class="comment"> * @return int number of failed login attempts since the last successful login.</span>
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment"> */</span>
<a name="l600"><span class="linenum"> 600</span></a>  function <a class="function" onClick="logFunction('user_count_login_failures')" href="../_functions/user_count_login_failures.html" onMouseOver="funcPopup(event,'user_count_login_failures')">user_count_login_failures</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it1022" onMouseOver="hilite(1022)" onMouseOut="lolite()" onClick="logVariable('reset')" href="../_variables/reset.html">$reset</a> = true) {
<a name="l601"><span class="linenum"> 601</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l602"><span class="linenum"> 602</span></a>  
<a name="l603"><span class="linenum"> 603</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l604"><span class="linenum"> 604</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l605"><span class="linenum"> 605</span></a>      }
<a name="l606"><span class="linenum"> 606</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('deleted')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/deleted.html">deleted</a>) {
<a name="l607"><span class="linenum"> 607</span></a>  <span class="comment">        // Deleted user, nothing to do.</span>
<a name="l608"><span class="linenum"> 608</span></a>          return 0;
<a name="l609"><span class="linenum"> 609</span></a>      }
<a name="l610"><span class="linenum"> 610</span></a>      <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> = <a class="function" onClick="logFunction('get_user_preferences')" href="../_functions/get_user_preferences.html" onMouseOver="funcPopup(event,'get_user_preferences')">get_user_preferences</a>('login_failed_count_since_success', 0, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l611"><span class="linenum"> 611</span></a>      if (<a class="var it1022" onMouseOver="hilite(1022)" onMouseOut="lolite()" onClick="logVariable('reset')" href="../_variables/reset.html">$reset</a>) {
<a name="l612"><span class="linenum"> 612</span></a>          <a class="function" onClick="logFunction('set_user_preference')" href="../_functions/set_user_preference.html" onMouseOver="funcPopup(event,'set_user_preference')">set_user_preference</a>('login_failed_count_since_success', 0, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l613"><span class="linenum"> 613</span></a>      }
<a name="l614"><span class="linenum"> 614</span></a>      return <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a>;
<a name="l615"><span class="linenum"> 615</span></a>  }
<a name="l616"><span class="linenum"> 616</span></a>  
<a name="l617"><span class="linenum"> 617</span></a>  <span class="comment">/**</span>
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment"> * Converts a string into a flat array of menu items, where each menu items is a</span>
<a name="l619"><span class="linenum"> 619</span></a>  <span class="comment"> * stdClass with fields type, url, title, pix, and imgsrc.</span>
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment"> *</span>
<a name="l621"><span class="linenum"> 621</span></a>  <span class="comment"> * @param string $text the menu items definition</span>
<a name="l622"><span class="linenum"> 622</span></a>  <span class="comment"> * @param moodle_page $page the current page</span>
<a name="l623"><span class="linenum"> 623</span></a>  <span class="comment"> * @return array</span>
<a name="l624"><span class="linenum"> 624</span></a>  <span class="comment"> */</span>
<a name="l625"><span class="linenum"> 625</span></a>  function <a class="function" onClick="logFunction('user_convert_text_to_menu_items')" href="../_functions/user_convert_text_to_menu_items.html" onMouseOver="funcPopup(event,'user_convert_text_to_menu_items')">user_convert_text_to_menu_items</a>(<a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>) {
<a name="l626"><span class="linenum"> 626</span></a>      global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l627"><span class="linenum"> 627</span></a>  
<a name="l628"><span class="linenum"> 628</span></a>      <a class="var it4083" onMouseOver="hilite(4083)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../_variables/lines.html">$lines</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(&quot;\n&quot;, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>);
<a name="l629"><span class="linenum"> 629</span></a>      <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a> = array();
<a name="l630"><span class="linenum"> 630</span></a>      <a class="var it11645" onMouseOver="hilite(11645)" onMouseOut="lolite()" onClick="logVariable('lastchild')" href="../_variables/lastchild.html">$lastchild</a> = null;
<a name="l631"><span class="linenum"> 631</span></a>      <a class="var it11646" onMouseOver="hilite(11646)" onMouseOut="lolite()" onClick="logVariable('lastdepth')" href="../_variables/lastdepth.html">$lastdepth</a> = null;
<a name="l632"><span class="linenum"> 632</span></a>      <a class="var it11647" onMouseOver="hilite(11647)" onMouseOut="lolite()" onClick="logVariable('lastsort')" href="../_variables/lastsort.html">$lastsort</a> = 0;
<a name="l633"><span class="linenum"> 633</span></a>      <a class="var it1701" onMouseOver="hilite(1701)" onMouseOut="lolite()" onClick="logVariable('children')" href="../_variables/children.html">$children</a> = array();
<a name="l634"><span class="linenum"> 634</span></a>      foreach (<a class="var it4083" onMouseOver="hilite(4083)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../_variables/lines.html">$lines</a> as <a class="var it3038" onMouseOver="hilite(3038)" onMouseOut="lolite()" onClick="logVariable('line')" href="../_variables/line.html">$line</a>) {
<a name="l635"><span class="linenum"> 635</span></a>          <a class="var it3038" onMouseOver="hilite(3038)" onMouseOut="lolite()" onClick="logVariable('line')" href="../_variables/line.html">$line</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it3038" onMouseOver="hilite(3038)" onMouseOut="lolite()" onClick="logVariable('line')" href="../_variables/line.html">$line</a>);
<a name="l636"><span class="linenum"> 636</span></a>          <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('|', <a class="var it3038" onMouseOver="hilite(3038)" onMouseOut="lolite()" onClick="logVariable('line')" href="../_variables/line.html">$line</a>, 3);
<a name="l637"><span class="linenum"> 637</span></a>          <a class="var it5769" onMouseOver="hilite(5769)" onMouseOut="lolite()" onClick="logVariable('itemtype')" href="../_variables/itemtype.html">$itemtype</a> = 'link';
<a name="l638"><span class="linenum"> 638</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(&quot;/^#+$/&quot;, <a class="var it3038" onMouseOver="hilite(3038)" onMouseOut="lolite()" onClick="logVariable('line')" href="../_variables/line.html">$line</a>)) {
<a name="l639"><span class="linenum"> 639</span></a>              <a class="var it5769" onMouseOver="hilite(5769)" onMouseOut="lolite()" onClick="logVariable('itemtype')" href="../_variables/itemtype.html">$itemtype</a> = 'divider';
<a name="l640"><span class="linenum"> 640</span></a>          } else if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(0, <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>) or empty(<a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[0])) {
<a name="l641"><span class="linenum"> 641</span></a>  <span class="comment">            // Every item must have a name to be valid.</span>
<a name="l642"><span class="linenum"> 642</span></a>              continue;
<a name="l643"><span class="linenum"> 643</span></a>          } else {
<a name="l644"><span class="linenum"> 644</span></a>              <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[0] = <a class="phpfunction" onClick="logFunction('ltrim')" href="../_functions/ltrim.html" onMouseOver="phpfuncPopup(event,'ltrim')">ltrim</a>(<a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[0], '-');
<a name="l645"><span class="linenum"> 645</span></a>          }
<a name="l646"><span class="linenum"> 646</span></a>  
<a name="l647"><span class="linenum"> 647</span></a>  <span class="comment">        // Create the child.</span>
<a name="l648"><span class="linenum"> 648</span></a>          <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a> = new stdClass();
<a name="l649"><span class="linenum"> 649</span></a>          <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/itemtype.html">itemtype</a> = <a class="var it5769" onMouseOver="hilite(5769)" onMouseOut="lolite()" onClick="logVariable('itemtype')" href="../_variables/itemtype.html">$itemtype</a>;
<a name="l650"><span class="linenum"> 650</span></a>          if (<a class="var it5769" onMouseOver="hilite(5769)" onMouseOut="lolite()" onClick="logVariable('itemtype')" href="../_variables/itemtype.html">$itemtype</a> === 'divider') {
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">            // Add the divider to the list of children and skip link</span>
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">            // processing.</span>
<a name="l653"><span class="linenum"> 653</span></a>              <a class="var it1701" onMouseOver="hilite(1701)" onMouseOut="lolite()" onClick="logVariable('children')" href="../_variables/children.html">$children</a>[] = <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>;
<a name="l654"><span class="linenum"> 654</span></a>              continue;
<a name="l655"><span class="linenum"> 655</span></a>          }
<a name="l656"><span class="linenum"> 656</span></a>  
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment">        // Name processing.</span>
<a name="l658"><span class="linenum"> 658</span></a>          <a class="var it11648" onMouseOver="hilite(11648)" onMouseOut="lolite()" onClick="logVariable('namebits')" href="../_variables/namebits.html">$namebits</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[0], 2);
<a name="l659"><span class="linenum"> 659</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it11648" onMouseOver="hilite(11648)" onMouseOut="lolite()" onClick="logVariable('namebits')" href="../_variables/namebits.html">$namebits</a>) == 2) {
<a name="l660"><span class="linenum"> 660</span></a>  <span class="comment">            // Check the validity of the identifier part of the string.</span>
<a name="l661"><span class="linenum"> 661</span></a>              if (<a class="function" onClick="logFunction('clean_param')" href="../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it11648" onMouseOver="hilite(11648)" onMouseOut="lolite()" onClick="logVariable('namebits')" href="../_variables/namebits.html">$namebits</a>[0], <a class="constant" onClick="logConstant('PARAM_STRINGID')" href="../_constants/PARAM_STRINGID.html" onMouseOver="constPopup(event,'PARAM_STRINGID')">PARAM_STRINGID</a>) !== '') {
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment">                // Treat this as a language string.</span>
<a name="l663"><span class="linenum"> 663</span></a>                  <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('title')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/title.html">title</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it11648" onMouseOver="hilite(11648)" onMouseOut="lolite()" onClick="logVariable('namebits')" href="../_variables/namebits.html">$namebits</a>[0], <a class="var it11648" onMouseOver="hilite(11648)" onMouseOut="lolite()" onClick="logVariable('namebits')" href="../_variables/namebits.html">$namebits</a>[1]);
<a name="l664"><span class="linenum"> 664</span></a>              }
<a name="l665"><span class="linenum"> 665</span></a>          }
<a name="l666"><span class="linenum"> 666</span></a>          if (empty(<a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('title')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/title.html">title</a>)) {
<a name="l667"><span class="linenum"> 667</span></a>  <span class="comment">            // Use it as is, don't even clean it.</span>
<a name="l668"><span class="linenum"> 668</span></a>              <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('title')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/title.html">title</a> = <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[0];
<a name="l669"><span class="linenum"> 669</span></a>          }
<a name="l670"><span class="linenum"> 670</span></a>  
<a name="l671"><span class="linenum"> 671</span></a>  <span class="comment">        // URL processing.</span>
<a name="l672"><span class="linenum"> 672</span></a>          if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(1, <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>) or empty(<a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[1])) {
<a name="l673"><span class="linenum"> 673</span></a>  <span class="comment">            // Set the url to null, and set the itemtype to invalid.</span>
<a name="l674"><span class="linenum"> 674</span></a>              <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[1] = null;
<a name="l675"><span class="linenum"> 675</span></a>              <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/itemtype.html">itemtype</a> = &quot;invalid&quot;;
<a name="l676"><span class="linenum"> 676</span></a>          } else {
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment">            // Nasty hack to replace the grades with the direct url.</span>
<a name="l678"><span class="linenum"> 678</span></a>              if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[1], '<a class="filename" href="../grade/report/mygrades.php.html">/grade/report/mygrades.php</a>') !== false) {
<a name="l679"><span class="linenum"> 679</span></a>                  <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[1] = <a class="function" onClick="logFunction('user_mygrades_url')" href="../_functions/user_mygrades_url.html" onMouseOver="funcPopup(event,'user_mygrades_url')">user_mygrades_url</a>();
<a name="l680"><span class="linenum"> 680</span></a>              }
<a name="l681"><span class="linenum"> 681</span></a>  
<a name="l682"><span class="linenum"> 682</span></a>  <span class="comment">            // Make sure the url is a moodle url.</span>
<a name="l683"><span class="linenum"> 683</span></a>              <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[1] = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[1]));
<a name="l684"><span class="linenum"> 684</span></a>          }
<a name="l685"><span class="linenum"> 685</span></a>          <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('url')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/url.html">url</a> = <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[1];
<a name="l686"><span class="linenum"> 686</span></a>  
<a name="l687"><span class="linenum"> 687</span></a>  <span class="comment">        // PIX processing.</span>
<a name="l688"><span class="linenum"> 688</span></a>          <a class="var it11649" onMouseOver="hilite(11649)" onMouseOut="lolite()" onClick="logVariable('pixpath')" href="../_variables/pixpath.html">$pixpath</a> = &quot;t/edit&quot;;
<a name="l689"><span class="linenum"> 689</span></a>          if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(2, <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>) or empty(<a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[2])) {
<a name="l690"><span class="linenum"> 690</span></a>  <span class="comment">            // Use the default.</span>
<a name="l691"><span class="linenum"> 691</span></a>              <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('pix')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/pix.html">pix</a> = <a class="var it11649" onMouseOver="hilite(11649)" onMouseOut="lolite()" onClick="logVariable('pixpath')" href="../_variables/pixpath.html">$pixpath</a>;
<a name="l692"><span class="linenum"> 692</span></a>          } else {
<a name="l693"><span class="linenum"> 693</span></a>  <span class="comment">            // Check for the specified image existing.</span>
<a name="l694"><span class="linenum"> 694</span></a>              <a class="var it11649" onMouseOver="hilite(11649)" onMouseOut="lolite()" onClick="logVariable('pixpath')" href="../_variables/pixpath.html">$pixpath</a> = &quot;t/&quot; . <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[2];
<a name="l695"><span class="linenum"> 695</span></a>              if (<a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('theme')" class="var it39576" onMouseOver="hilite(39576)" onMouseOut="lolite()" href="../_variables/theme.html">theme</a>-&gt;<a class="function" onClick="logFunction('resolve_image_location')" href="../_functions/resolve_image_location.html" onMouseOver="funcPopup(event,'resolve_image_location')">resolve_image_location</a>(<a class="var it11649" onMouseOver="hilite(11649)" onMouseOut="lolite()" onClick="logVariable('pixpath')" href="../_variables/pixpath.html">$pixpath</a>, 'moodle', true)) {
<a name="l696"><span class="linenum"> 696</span></a>  <span class="comment">                // Use the image.</span>
<a name="l697"><span class="linenum"> 697</span></a>                  <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('pix')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/pix.html">pix</a> = <a class="var it11649" onMouseOver="hilite(11649)" onMouseOut="lolite()" onClick="logVariable('pixpath')" href="../_variables/pixpath.html">$pixpath</a>;
<a name="l698"><span class="linenum"> 698</span></a>              } else {
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment">                // Treat it like a URL.</span>
<a name="l700"><span class="linenum"> 700</span></a>                  <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('pix')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/pix.html">pix</a> = null;
<a name="l701"><span class="linenum"> 701</span></a>                  <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>-&gt;<a onClick="logVariable('imgsrc')" class="var it39612" onMouseOver="hilite(39612)" onMouseOut="lolite()" href="../_variables/imgsrc.html">imgsrc</a> = <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('bits')" href="../_variables/bits.html">$bits</a>[2];
<a name="l702"><span class="linenum"> 702</span></a>              }
<a name="l703"><span class="linenum"> 703</span></a>          }
<a name="l704"><span class="linenum"> 704</span></a>  
<a name="l705"><span class="linenum"> 705</span></a>  <span class="comment">        // Add this child to the list of children.</span>
<a name="l706"><span class="linenum"> 706</span></a>          <a class="var it1701" onMouseOver="hilite(1701)" onMouseOut="lolite()" onClick="logVariable('children')" href="../_variables/children.html">$children</a>[] = <a class="var it579" onMouseOver="hilite(579)" onMouseOut="lolite()" onClick="logVariable('child')" href="../_variables/child.html">$child</a>;
<a name="l707"><span class="linenum"> 707</span></a>      }
<a name="l708"><span class="linenum"> 708</span></a>      return <a class="var it1701" onMouseOver="hilite(1701)" onMouseOut="lolite()" onClick="logVariable('children')" href="../_variables/children.html">$children</a>;
<a name="l709"><span class="linenum"> 709</span></a>  }
<a name="l710"><span class="linenum"> 710</span></a>  
<a name="l711"><span class="linenum"> 711</span></a>  <span class="comment">/**</span>
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment"> * Get a list of essential user navigation items.</span>
<a name="l713"><span class="linenum"> 713</span></a>  <span class="comment"> *</span>
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment"> * @param stdclass $user user object.</span>
<a name="l715"><span class="linenum"> 715</span></a>  <span class="comment"> * @param moodle_page $page page object.</span>
<a name="l716"><span class="linenum"> 716</span></a>  <span class="comment"> * @return stdClass $returnobj navigation information object, where:</span>
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment"> *</span>
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment"> *      $returnobj-&gt;navitems    array    array of links where each link is a</span>
<a name="l719"><span class="linenum"> 719</span></a>  <span class="comment"> *                                       stdClass with fields url, title, and</span>
<a name="l720"><span class="linenum"> 720</span></a>  <span class="comment"> *                                       pix</span>
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment"> *      $returnobj-&gt;metadata    array    array of useful user metadata to be</span>
<a name="l722"><span class="linenum"> 722</span></a>  <span class="comment"> *                                       used when constructing navigation;</span>
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment"> *                                       fields include:</span>
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment"> *</span>
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment"> *          ROLE FIELDS</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment"> *          asotherrole    bool    whether viewing as another role</span>
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment"> *          rolename       string  name of the role</span>
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment"> *</span>
<a name="l729"><span class="linenum"> 729</span></a>  <span class="comment"> *          USER FIELDS</span>
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment"> *          These fields are for the currently-logged in user, or for</span>
<a name="l731"><span class="linenum"> 731</span></a>  <span class="comment"> *          the user that the real user is currently logged in as.</span>
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment"> *</span>
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment"> *          userid         int        the id of the user in question</span>
<a name="l734"><span class="linenum"> 734</span></a>  <span class="comment"> *          userfullname   string     the user's full name</span>
<a name="l735"><span class="linenum"> 735</span></a>  <span class="comment"> *          userprofileurl moodle_url the url of the user's profile</span>
<a name="l736"><span class="linenum"> 736</span></a>  <span class="comment"> *          useravatar     string     a HTML fragment - the rendered</span>
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment"> *                                    user_picture for this user</span>
<a name="l738"><span class="linenum"> 738</span></a>  <span class="comment"> *          userloginfail  string     an error string denoting the number</span>
<a name="l739"><span class="linenum"> 739</span></a>  <span class="comment"> *                                    of login failures since last login</span>
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment"> *</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment"> *          &quot;REAL USER&quot; FIELDS</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment"> *          These fields are for when asotheruser is true, and</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="comment"> *          correspond to the underlying &quot;real user&quot;.</span>
<a name="l744"><span class="linenum"> 744</span></a>  <span class="comment"> *</span>
<a name="l745"><span class="linenum"> 745</span></a>  <span class="comment"> *          asotheruser        bool    whether viewing as another user</span>
<a name="l746"><span class="linenum"> 746</span></a>  <span class="comment"> *          realuserid         int        the id of the user in question</span>
<a name="l747"><span class="linenum"> 747</span></a>  <span class="comment"> *          realuserfullname   string     the user's full name</span>
<a name="l748"><span class="linenum"> 748</span></a>  <span class="comment"> *          realuserprofileurl moodle_url the url of the user's profile</span>
<a name="l749"><span class="linenum"> 749</span></a>  <span class="comment"> *          realuseravatar     string     a HTML fragment - the rendered</span>
<a name="l750"><span class="linenum"> 750</span></a>  <span class="comment"> *                                        user_picture for this user</span>
<a name="l751"><span class="linenum"> 751</span></a>  <span class="comment"> *</span>
<a name="l752"><span class="linenum"> 752</span></a>  <span class="comment"> *          MNET PROVIDER FIELDS</span>
<a name="l753"><span class="linenum"> 753</span></a>  <span class="comment"> *          asmnetuser            bool   whether viewing as a user from an</span>
<a name="l754"><span class="linenum"> 754</span></a>  <span class="comment"> *                                       MNet provider</span>
<a name="l755"><span class="linenum"> 755</span></a>  <span class="comment"> *          mnetidprovidername    string name of the MNet provider</span>
<a name="l756"><span class="linenum"> 756</span></a>  <span class="comment"> *          mnetidproviderwwwroot string URL of the MNet provider</span>
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment"> */</span>
<a name="l758"><span class="linenum"> 758</span></a>  function <a class="function" onClick="logFunction('user_get_user_navigation_info')" href="../_functions/user_get_user_navigation_info.html" onMouseOver="funcPopup(event,'user_get_user_navigation_info')">user_get_user_navigation_info</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>) {
<a name="l759"><span class="linenum"> 759</span></a>      global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l760"><span class="linenum"> 760</span></a>  
<a name="l761"><span class="linenum"> 761</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a> = new stdClass();
<a name="l762"><span class="linenum"> 762</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('navitems')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/navitems.html">navitems</a> = array();
<a name="l763"><span class="linenum"> 763</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a> = array();
<a name="l764"><span class="linenum"> 764</span></a>  
<a name="l765"><span class="linenum"> 765</span></a>      <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('course')" class="var it39576" onMouseOver="hilite(39576)" onMouseOut="lolite()" href="../_variables/course.html">course</a>;
<a name="l766"><span class="linenum"> 766</span></a>  
<a name="l767"><span class="linenum"> 767</span></a>  <span class="comment">    // Query the environment.</span>
<a name="l768"><span class="linenum"> 768</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l769"><span class="linenum"> 769</span></a>  
<a name="l770"><span class="linenum"> 770</span></a>  <span class="comment">    // Get basic user metadata.</span>
<a name="l771"><span class="linenum"> 771</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['userid'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l772"><span class="linenum"> 772</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['userfullname'] = <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, true);
<a name="l773"><span class="linenum"> 773</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['userprofileurl'] = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../user/profile.php.html">/user/profile.php</a>', array(
<a name="l774"><span class="linenum"> 774</span></a>          'id' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;id
<a name="l775"><span class="linenum"> 775</span></a>      ));
<a name="l776"><span class="linenum"> 776</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['useravatar'] = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a onClick="logVariable('user_picture')" class="var it39674" onMouseOver="hilite(39674)" onMouseOut="lolite()" href="../_variables/user_picture.html">user_picture</a> (
<a name="l777"><span class="linenum"> 777</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>,
<a name="l778"><span class="linenum"> 778</span></a>          array(
<a name="l779"><span class="linenum"> 779</span></a>              'link' =&gt; false,
<a name="l780"><span class="linenum"> 780</span></a>              'visibletoscreenreaders' =&gt; false
<a name="l781"><span class="linenum"> 781</span></a>          )
<a name="l782"><span class="linenum"> 782</span></a>      );
<a name="l783"><span class="linenum"> 783</span></a>  <span class="comment">    // Build a list of items for a regular user.</span>
<a name="l784"><span class="linenum"> 784</span></a>  
<a name="l785"><span class="linenum"> 785</span></a>  <span class="comment">    // Query MNet status.</span>
<a name="l786"><span class="linenum"> 786</span></a>      if (<a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['asmnetuser'] = <a class="function" onClick="logFunction('is_mnet_remote_user')" href="../_functions/is_mnet_remote_user.html" onMouseOver="funcPopup(event,'is_mnet_remote_user')">is_mnet_remote_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l787"><span class="linenum"> 787</span></a>          <a class="var it11655" onMouseOver="hilite(11655)" onMouseOut="lolite()" onClick="logVariable('mnetidprovider')" href="../_variables/mnetidprovider.html">$mnetidprovider</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('mnet_host', array('id' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/mnethostid.html">mnethostid</a>));
<a name="l788"><span class="linenum"> 788</span></a>          <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['mnetidprovidername'] = <a class="var it11655" onMouseOver="hilite(11655)" onMouseOut="lolite()" onClick="logVariable('mnetidprovider')" href="../_variables/mnetidprovider.html">$mnetidprovider</a>-&gt;<a onClick="logVariable('name')" class="var it39675" onMouseOver="hilite(39675)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l789"><span class="linenum"> 789</span></a>          <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['mnetidproviderwwwroot'] = <a class="var it11655" onMouseOver="hilite(11655)" onMouseOut="lolite()" onClick="logVariable('mnetidprovider')" href="../_variables/mnetidprovider.html">$mnetidprovider</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39675" onMouseOver="hilite(39675)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>;
<a name="l790"><span class="linenum"> 790</span></a>      }
<a name="l791"><span class="linenum"> 791</span></a>  
<a name="l792"><span class="linenum"> 792</span></a>  <span class="comment">    // Did the user just log in?</span>
<a name="l793"><span class="linenum"> 793</span></a>      if (isset(<a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('justloggedin')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../_variables/justloggedin.html">justloggedin</a>)) {
<a name="l794"><span class="linenum"> 794</span></a>  <span class="comment">        // Don't unset this flag as login_info still needs it.</span>
<a name="l795"><span class="linenum"> 795</span></a>          if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('displayloginfailures')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/displayloginfailures.html">displayloginfailures</a>)) {
<a name="l796"><span class="linenum"> 796</span></a>  <span class="comment">            // We're already in /user/lib.php, so we don't need to include.</span>
<a name="l797"><span class="linenum"> 797</span></a>              if (<a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> = <a class="function" onClick="logFunction('user_count_login_failures')" href="../_functions/user_count_login_failures.html" onMouseOver="funcPopup(event,'user_count_login_failures')">user_count_login_failures</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l798"><span class="linenum"> 798</span></a>  
<a name="l799"><span class="linenum"> 799</span></a>  <span class="comment">                // Get login failures string.</span>
<a name="l800"><span class="linenum"> 800</span></a>                  <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a> = new stdClass();
<a name="l801"><span class="linenum"> 801</span></a>                  <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('attempts')" class="var it39489" onMouseOver="hilite(39489)" onMouseOut="lolite()" href="../_variables/attempts.html">attempts</a> = <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('span', <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a>, array('class' =&gt; 'value'));
<a name="l802"><span class="linenum"> 802</span></a>                  <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['userloginfail'] =
<a name="l803"><span class="linenum"> 803</span></a>                      <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('failedloginattempts', '', <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>);
<a name="l804"><span class="linenum"> 804</span></a>  
<a name="l805"><span class="linenum"> 805</span></a>              }
<a name="l806"><span class="linenum"> 806</span></a>          }
<a name="l807"><span class="linenum"> 807</span></a>      }
<a name="l808"><span class="linenum"> 808</span></a>  
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment">    // Links: Dashboard.</span>
<a name="l810"><span class="linenum"> 810</span></a>      <a class="var it11658" onMouseOver="hilite(11658)" onMouseOut="lolite()" onClick="logVariable('myhome')" href="../_variables/myhome.html">$myhome</a> = new stdClass();
<a name="l811"><span class="linenum"> 811</span></a>      <a class="var it11658" onMouseOver="hilite(11658)" onMouseOut="lolite()" onClick="logVariable('myhome')" href="../_variables/myhome.html">$myhome</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39676" onMouseOver="hilite(39676)" onMouseOut="lolite()" href="../_variables/itemtype.html">itemtype</a> = 'link';
<a name="l812"><span class="linenum"> 812</span></a>      <a class="var it11658" onMouseOver="hilite(11658)" onMouseOut="lolite()" onClick="logVariable('myhome')" href="../_variables/myhome.html">$myhome</a>-&gt;<a onClick="logVariable('url')" class="var it39676" onMouseOver="hilite(39676)" onMouseOut="lolite()" href="../_variables/url.html">url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/my/');
<a name="l813"><span class="linenum"> 813</span></a>      <a class="var it11658" onMouseOver="hilite(11658)" onMouseOut="lolite()" onClick="logVariable('myhome')" href="../_variables/myhome.html">$myhome</a>-&gt;<a onClick="logVariable('title')" class="var it39676" onMouseOver="hilite(39676)" onMouseOut="lolite()" href="../_variables/title.html">title</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('mymoodle', 'admin');
<a name="l814"><span class="linenum"> 814</span></a>      <a class="var it11658" onMouseOver="hilite(11658)" onMouseOut="lolite()" onClick="logVariable('myhome')" href="../_variables/myhome.html">$myhome</a>-&gt;<a onClick="logVariable('pix')" class="var it39676" onMouseOver="hilite(39676)" onMouseOut="lolite()" href="../_variables/pix.html">pix</a> = &quot;i/course&quot;;
<a name="l815"><span class="linenum"> 815</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('navitems')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/navitems.html">navitems</a>[] = <a class="var it11658" onMouseOver="hilite(11658)" onMouseOut="lolite()" onClick="logVariable('myhome')" href="../_variables/myhome.html">$myhome</a>;
<a name="l816"><span class="linenum"> 816</span></a>  
<a name="l817"><span class="linenum"> 817</span></a>  <span class="comment">    // Links: My Profile.</span>
<a name="l818"><span class="linenum"> 818</span></a>      <a class="var it11659" onMouseOver="hilite(11659)" onMouseOut="lolite()" onClick="logVariable('myprofile')" href="../_variables/myprofile.html">$myprofile</a> = new stdClass();
<a name="l819"><span class="linenum"> 819</span></a>      <a class="var it11659" onMouseOver="hilite(11659)" onMouseOut="lolite()" onClick="logVariable('myprofile')" href="../_variables/myprofile.html">$myprofile</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39677" onMouseOver="hilite(39677)" onMouseOut="lolite()" href="../_variables/itemtype.html">itemtype</a> = 'link';
<a name="l820"><span class="linenum"> 820</span></a>      <a class="var it11659" onMouseOver="hilite(11659)" onMouseOut="lolite()" onClick="logVariable('myprofile')" href="../_variables/myprofile.html">$myprofile</a>-&gt;<a onClick="logVariable('url')" class="var it39677" onMouseOver="hilite(39677)" onMouseOut="lolite()" href="../_variables/url.html">url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../user/profile.php.html">/user/profile.php</a>', array('id' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l821"><span class="linenum"> 821</span></a>      <a class="var it11659" onMouseOver="hilite(11659)" onMouseOut="lolite()" onClick="logVariable('myprofile')" href="../_variables/myprofile.html">$myprofile</a>-&gt;<a onClick="logVariable('title')" class="var it39677" onMouseOver="hilite(39677)" onMouseOut="lolite()" href="../_variables/title.html">title</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('profile');
<a name="l822"><span class="linenum"> 822</span></a>      <a class="var it11659" onMouseOver="hilite(11659)" onMouseOut="lolite()" onClick="logVariable('myprofile')" href="../_variables/myprofile.html">$myprofile</a>-&gt;<a onClick="logVariable('pix')" class="var it39677" onMouseOver="hilite(39677)" onMouseOut="lolite()" href="../_variables/pix.html">pix</a> = &quot;i/user&quot;;
<a name="l823"><span class="linenum"> 823</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('navitems')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/navitems.html">navitems</a>[] = <a class="var it11659" onMouseOver="hilite(11659)" onMouseOut="lolite()" onClick="logVariable('myprofile')" href="../_variables/myprofile.html">$myprofile</a>;
<a name="l824"><span class="linenum"> 824</span></a>  
<a name="l825"><span class="linenum"> 825</span></a>  <span class="comment">    // Links: Role-return or logout link.</span>
<a name="l826"><span class="linenum"> 826</span></a>      <a class="var it11660" onMouseOver="hilite(11660)" onMouseOut="lolite()" onClick="logVariable('lastobj')" href="../_variables/lastobj.html">$lastobj</a> = null;
<a name="l827"><span class="linenum"> 827</span></a>      <a class="var it11661" onMouseOver="hilite(11661)" onMouseOut="lolite()" onClick="logVariable('buildlogout')" href="../_variables/buildlogout.html">$buildlogout</a> = true;
<a name="l828"><span class="linenum"> 828</span></a>      <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['asotherrole'] = false;
<a name="l829"><span class="linenum"> 829</span></a>      if (<a class="function" onClick="logFunction('is_role_switched')" href="../_functions/is_role_switched.html" onMouseOver="funcPopup(event,'is_role_switched')">is_role_switched</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l830"><span class="linenum"> 830</span></a>          if (<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('role', array('id' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('access')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rsw'][<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>]))) {
<a name="l831"><span class="linenum"> 831</span></a>  <span class="comment">            // Build role-return link instead of logout link.</span>
<a name="l832"><span class="linenum"> 832</span></a>              <a class="var it11662" onMouseOver="hilite(11662)" onMouseOut="lolite()" onClick="logVariable('rolereturn')" href="../_variables/rolereturn.html">$rolereturn</a> = new stdClass();
<a name="l833"><span class="linenum"> 833</span></a>              <a class="var it11662" onMouseOver="hilite(11662)" onMouseOut="lolite()" onClick="logVariable('rolereturn')" href="../_variables/rolereturn.html">$rolereturn</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39678" onMouseOver="hilite(39678)" onMouseOut="lolite()" href="../_variables/itemtype.html">itemtype</a> = 'link';
<a name="l834"><span class="linenum"> 834</span></a>              <a class="var it11662" onMouseOver="hilite(11662)" onMouseOut="lolite()" onClick="logVariable('rolereturn')" href="../_variables/rolereturn.html">$rolereturn</a>-&gt;<a onClick="logVariable('url')" class="var it39678" onMouseOver="hilite(39678)" onMouseOut="lolite()" href="../_variables/url.html">url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../course/switchrole.php.html">/course/switchrole.php</a>', array(
<a name="l835"><span class="linenum"> 835</span></a>                  'id' =&gt; <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l836"><span class="linenum"> 836</span></a>                  'sesskey' =&gt; <a class="function" onClick="logFunction('sesskey')" href="../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>(),
<a name="l837"><span class="linenum"> 837</span></a>                  'switchrole' =&gt; 0,
<a name="l838"><span class="linenum"> 838</span></a>                  'returnurl' =&gt; <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>-&gt;<a onClick="logVariable('url')" class="var it39576" onMouseOver="hilite(39576)" onMouseOut="lolite()" href="../_variables/url.html">url</a>-&gt;<a class="function" onClick="logFunction('out_as_local_url')" href="../_functions/out_as_local_url.html" onMouseOver="funcPopup(event,'out_as_local_url')">out_as_local_url</a>(false)
<a name="l839"><span class="linenum"> 839</span></a>              ));
<a name="l840"><span class="linenum"> 840</span></a>              <a class="var it11662" onMouseOver="hilite(11662)" onMouseOut="lolite()" onClick="logVariable('rolereturn')" href="../_variables/rolereturn.html">$rolereturn</a>-&gt;<a onClick="logVariable('pix')" class="var it39678" onMouseOver="hilite(39678)" onMouseOut="lolite()" href="../_variables/pix.html">pix</a> = &quot;a/logout&quot;;
<a name="l841"><span class="linenum"> 841</span></a>              <a class="var it11662" onMouseOver="hilite(11662)" onMouseOut="lolite()" onClick="logVariable('rolereturn')" href="../_variables/rolereturn.html">$rolereturn</a>-&gt;<a onClick="logVariable('title')" class="var it39678" onMouseOver="hilite(39678)" onMouseOut="lolite()" href="../_variables/title.html">title</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('switchrolereturn');
<a name="l842"><span class="linenum"> 842</span></a>              <a class="var it11660" onMouseOver="hilite(11660)" onMouseOut="lolite()" onClick="logVariable('lastobj')" href="../_variables/lastobj.html">$lastobj</a> = <a class="var it11662" onMouseOver="hilite(11662)" onMouseOut="lolite()" onClick="logVariable('rolereturn')" href="../_variables/rolereturn.html">$rolereturn</a>;
<a name="l843"><span class="linenum"> 843</span></a>  
<a name="l844"><span class="linenum"> 844</span></a>              <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['asotherrole'] = true;
<a name="l845"><span class="linenum"> 845</span></a>              <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['rolename'] = <a class="function" onClick="logFunction('role_get_name')" href="../_functions/role_get_name.html" onMouseOver="funcPopup(event,'role_get_name')">role_get_name</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l846"><span class="linenum"> 846</span></a>  
<a name="l847"><span class="linenum"> 847</span></a>              <a class="var it11661" onMouseOver="hilite(11661)" onMouseOut="lolite()" onClick="logVariable('buildlogout')" href="../_variables/buildlogout.html">$buildlogout</a> = false;
<a name="l848"><span class="linenum"> 848</span></a>          }
<a name="l849"><span class="linenum"> 849</span></a>      }
<a name="l850"><span class="linenum"> 850</span></a>  
<a name="l851"><span class="linenum"> 851</span></a>      if (<a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['asotheruser'] = \core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('is_loggedinas')" href="../_functions/is_loggedinas.html" onMouseOver="funcPopup(event,'is_loggedinas')">is_loggedinas</a>()) {
<a name="l852"><span class="linenum"> 852</span></a>          <a class="var it11663" onMouseOver="hilite(11663)" onMouseOut="lolite()" onClick="logVariable('realuser')" href="../_variables/realuser.html">$realuser</a> = \core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('get_realuser')" href="../_functions/get_realuser.html" onMouseOver="funcPopup(event,'get_realuser')">get_realuser</a>();
<a name="l853"><span class="linenum"> 853</span></a>  
<a name="l854"><span class="linenum"> 854</span></a>  <span class="comment">        // Save values for the real user, as $user will be full of data for the</span>
<a name="l855"><span class="linenum"> 855</span></a>  <span class="comment">        // user the user is disguised as.</span>
<a name="l856"><span class="linenum"> 856</span></a>          <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['realuserid'] = <a class="var it11663" onMouseOver="hilite(11663)" onMouseOut="lolite()" onClick="logVariable('realuser')" href="../_variables/realuser.html">$realuser</a>-&gt;<a onClick="logVariable('id')" class="var it39679" onMouseOver="hilite(39679)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l857"><span class="linenum"> 857</span></a>          <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['realuserfullname'] = <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it11663" onMouseOver="hilite(11663)" onMouseOut="lolite()" onClick="logVariable('realuser')" href="../_variables/realuser.html">$realuser</a>, true);
<a name="l858"><span class="linenum"> 858</span></a>          <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['realuserprofileurl'] = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../user/profile.php.html">/user/profile.php</a>', array(
<a name="l859"><span class="linenum"> 859</span></a>              'id' =&gt; <a class="var it11663" onMouseOver="hilite(11663)" onMouseOut="lolite()" onClick="logVariable('realuser')" href="../_variables/realuser.html">$realuser</a>-&gt;id
<a name="l860"><span class="linenum"> 860</span></a>          ));
<a name="l861"><span class="linenum"> 861</span></a>          <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('metadata')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/metadata.html">metadata</a>['realuseravatar'] = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a onClick="logVariable('user_picture')" class="var it39674" onMouseOver="hilite(39674)" onMouseOut="lolite()" href="../_variables/user_picture.html">user_picture</a> (
<a name="l862"><span class="linenum"> 862</span></a>              <a class="var it11663" onMouseOver="hilite(11663)" onMouseOut="lolite()" onClick="logVariable('realuser')" href="../_variables/realuser.html">$realuser</a>,
<a name="l863"><span class="linenum"> 863</span></a>              array(
<a name="l864"><span class="linenum"> 864</span></a>                  'link' =&gt; false,
<a name="l865"><span class="linenum"> 865</span></a>                  'visibletoscreenreaders' =&gt; false
<a name="l866"><span class="linenum"> 866</span></a>              )
<a name="l867"><span class="linenum"> 867</span></a>          );
<a name="l868"><span class="linenum"> 868</span></a>  
<a name="l869"><span class="linenum"> 869</span></a>  <span class="comment">        // Build a user-revert link.</span>
<a name="l870"><span class="linenum"> 870</span></a>          <a class="var it11664" onMouseOver="hilite(11664)" onMouseOut="lolite()" onClick="logVariable('userrevert')" href="../_variables/userrevert.html">$userrevert</a> = new stdClass();
<a name="l871"><span class="linenum"> 871</span></a>          <a class="var it11664" onMouseOver="hilite(11664)" onMouseOut="lolite()" onClick="logVariable('userrevert')" href="../_variables/userrevert.html">$userrevert</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39680" onMouseOver="hilite(39680)" onMouseOut="lolite()" href="../_variables/itemtype.html">itemtype</a> = 'link';
<a name="l872"><span class="linenum"> 872</span></a>          <a class="var it11664" onMouseOver="hilite(11664)" onMouseOut="lolite()" onClick="logVariable('userrevert')" href="../_variables/userrevert.html">$userrevert</a>-&gt;<a onClick="logVariable('url')" class="var it39680" onMouseOver="hilite(39680)" onMouseOut="lolite()" href="../_variables/url.html">url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../course/loginas.php.html">/course/loginas.php</a>', array(
<a name="l873"><span class="linenum"> 873</span></a>              'id' =&gt; <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l874"><span class="linenum"> 874</span></a>              'sesskey' =&gt; <a class="function" onClick="logFunction('sesskey')" href="../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>()
<a name="l875"><span class="linenum"> 875</span></a>          ));
<a name="l876"><span class="linenum"> 876</span></a>          <a class="var it11664" onMouseOver="hilite(11664)" onMouseOut="lolite()" onClick="logVariable('userrevert')" href="../_variables/userrevert.html">$userrevert</a>-&gt;<a onClick="logVariable('pix')" class="var it39680" onMouseOver="hilite(39680)" onMouseOut="lolite()" href="../_variables/pix.html">pix</a> = &quot;a/logout&quot;;
<a name="l877"><span class="linenum"> 877</span></a>          <a class="var it11664" onMouseOver="hilite(11664)" onMouseOut="lolite()" onClick="logVariable('userrevert')" href="../_variables/userrevert.html">$userrevert</a>-&gt;<a onClick="logVariable('title')" class="var it39680" onMouseOver="hilite(39680)" onMouseOut="lolite()" href="../_variables/title.html">title</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('logout');
<a name="l878"><span class="linenum"> 878</span></a>          <a class="var it11660" onMouseOver="hilite(11660)" onMouseOut="lolite()" onClick="logVariable('lastobj')" href="../_variables/lastobj.html">$lastobj</a> = <a class="var it11664" onMouseOver="hilite(11664)" onMouseOut="lolite()" onClick="logVariable('userrevert')" href="../_variables/userrevert.html">$userrevert</a>;
<a name="l879"><span class="linenum"> 879</span></a>  
<a name="l880"><span class="linenum"> 880</span></a>          <a class="var it11661" onMouseOver="hilite(11661)" onMouseOut="lolite()" onClick="logVariable('buildlogout')" href="../_variables/buildlogout.html">$buildlogout</a> = false;
<a name="l881"><span class="linenum"> 881</span></a>      }
<a name="l882"><span class="linenum"> 882</span></a>  
<a name="l883"><span class="linenum"> 883</span></a>      if (<a class="var it11661" onMouseOver="hilite(11661)" onMouseOut="lolite()" onClick="logVariable('buildlogout')" href="../_variables/buildlogout.html">$buildlogout</a>) {
<a name="l884"><span class="linenum"> 884</span></a>  <span class="comment">        // Build a logout link.</span>
<a name="l885"><span class="linenum"> 885</span></a>          <a class="var it4826" onMouseOver="hilite(4826)" onMouseOut="lolite()" onClick="logVariable('logout')" href="../_variables/logout.html">$logout</a> = new stdClass();
<a name="l886"><span class="linenum"> 886</span></a>          <a class="var it4826" onMouseOver="hilite(4826)" onMouseOut="lolite()" onClick="logVariable('logout')" href="../_variables/logout.html">$logout</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39681" onMouseOver="hilite(39681)" onMouseOut="lolite()" href="../_variables/itemtype.html">itemtype</a> = 'link';
<a name="l887"><span class="linenum"> 887</span></a>          <a class="var it4826" onMouseOver="hilite(4826)" onMouseOut="lolite()" onClick="logVariable('logout')" href="../_variables/logout.html">$logout</a>-&gt;<a onClick="logVariable('url')" class="var it39681" onMouseOver="hilite(39681)" onMouseOut="lolite()" href="../_variables/url.html">url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../login/logout.php.html">/login/logout.php</a>', array('sesskey' =&gt; <a class="function" onClick="logFunction('sesskey')" href="../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>()));
<a name="l888"><span class="linenum"> 888</span></a>          <a class="var it4826" onMouseOver="hilite(4826)" onMouseOut="lolite()" onClick="logVariable('logout')" href="../_variables/logout.html">$logout</a>-&gt;<a onClick="logVariable('pix')" class="var it39681" onMouseOver="hilite(39681)" onMouseOut="lolite()" href="../_variables/pix.html">pix</a> = &quot;a/logout&quot;;
<a name="l889"><span class="linenum"> 889</span></a>          <a class="var it4826" onMouseOver="hilite(4826)" onMouseOut="lolite()" onClick="logVariable('logout')" href="../_variables/logout.html">$logout</a>-&gt;<a onClick="logVariable('title')" class="var it39681" onMouseOver="hilite(39681)" onMouseOut="lolite()" href="../_variables/title.html">title</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('logout');
<a name="l890"><span class="linenum"> 890</span></a>          <a class="var it11660" onMouseOver="hilite(11660)" onMouseOut="lolite()" onClick="logVariable('lastobj')" href="../_variables/lastobj.html">$lastobj</a> = <a class="var it4826" onMouseOver="hilite(4826)" onMouseOut="lolite()" onClick="logVariable('logout')" href="../_variables/logout.html">$logout</a>;
<a name="l891"><span class="linenum"> 891</span></a>      }
<a name="l892"><span class="linenum"> 892</span></a>  
<a name="l893"><span class="linenum"> 893</span></a>  <span class="comment">    // Before we add the last item (usually a logout link), add any</span>
<a name="l894"><span class="linenum"> 894</span></a>  <span class="comment">    // custom-defined items.</span>
<a name="l895"><span class="linenum"> 895</span></a>      <a class="var it11665" onMouseOver="hilite(11665)" onMouseOut="lolite()" onClick="logVariable('customitems')" href="../_variables/customitems.html">$customitems</a> = <a class="function" onClick="logFunction('user_convert_text_to_menu_items')" href="../_functions/user_convert_text_to_menu_items.html" onMouseOver="funcPopup(event,'user_convert_text_to_menu_items')">user_convert_text_to_menu_items</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('customusermenuitems')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/customusermenuitems.html">customusermenuitems</a>, <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>);
<a name="l896"><span class="linenum"> 896</span></a>      foreach (<a class="var it11665" onMouseOver="hilite(11665)" onMouseOut="lolite()" onClick="logVariable('customitems')" href="../_variables/customitems.html">$customitems</a> as <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../_variables/item.html">$item</a>) {
<a name="l897"><span class="linenum"> 897</span></a>          <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('navitems')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/navitems.html">navitems</a>[] = <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../_variables/item.html">$item</a>;
<a name="l898"><span class="linenum"> 898</span></a>      }
<a name="l899"><span class="linenum"> 899</span></a>  
<a name="l900"><span class="linenum"> 900</span></a>  <span class="comment">    // Add the last item to the list.</span>
<a name="l901"><span class="linenum"> 901</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it11660" onMouseOver="hilite(11660)" onMouseOut="lolite()" onClick="logVariable('lastobj')" href="../_variables/lastobj.html">$lastobj</a>)) {
<a name="l902"><span class="linenum"> 902</span></a>          <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>-&gt;<a onClick="logVariable('navitems')" class="var it39673" onMouseOver="hilite(39673)" onMouseOut="lolite()" href="../_variables/navitems.html">navitems</a>[] = <a class="var it11660" onMouseOver="hilite(11660)" onMouseOut="lolite()" onClick="logVariable('lastobj')" href="../_variables/lastobj.html">$lastobj</a>;
<a name="l903"><span class="linenum"> 903</span></a>      }
<a name="l904"><span class="linenum"> 904</span></a>  
<a name="l905"><span class="linenum"> 905</span></a>      return <a class="var it11652" onMouseOver="hilite(11652)" onMouseOut="lolite()" onClick="logVariable('returnobject')" href="../_variables/returnobject.html">$returnobject</a>;
<a name="l906"><span class="linenum"> 906</span></a>  }
<a name="l907"><span class="linenum"> 907</span></a>  
<a name="l908"><span class="linenum"> 908</span></a>  <span class="comment">/**</span>
<a name="l909"><span class="linenum"> 909</span></a>  <span class="comment"> * Add password to the list of used hashes for this user.</span>
<a name="l910"><span class="linenum"> 910</span></a>  <span class="comment"> *</span>
<a name="l911"><span class="linenum"> 911</span></a>  <span class="comment"> * This is supposed to be used from:</span>
<a name="l912"><span class="linenum"> 912</span></a>  <span class="comment"> *  1/ change own password form</span>
<a name="l913"><span class="linenum"> 913</span></a>  <span class="comment"> *  2/ password reset process</span>
<a name="l914"><span class="linenum"> 914</span></a>  <span class="comment"> *  3/ user signup in auth plugins if password changing supported</span>
<a name="l915"><span class="linenum"> 915</span></a>  <span class="comment"> *</span>
<a name="l916"><span class="linenum"> 916</span></a>  <span class="comment"> * @param int $userid user id</span>
<a name="l917"><span class="linenum"> 917</span></a>  <span class="comment"> * @param string $password plaintext password</span>
<a name="l918"><span class="linenum"> 918</span></a>  <span class="comment"> * @return void</span>
<a name="l919"><span class="linenum"> 919</span></a>  <span class="comment"> */</span>
<a name="l920"><span class="linenum"> 920</span></a>  function <a class="function" onClick="logFunction('user_add_password_history')" href="../_functions/user_add_password_history.html" onMouseOver="funcPopup(event,'user_add_password_history')">user_add_password_history</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('password')" href="../_variables/password.html">$password</a>) {
<a name="l921"><span class="linenum"> 921</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l922"><span class="linenum"> 922</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>.'/password_compat/lib/password.php');
<a name="l923"><span class="linenum"> 923</span></a>  
<a name="l924"><span class="linenum"> 924</span></a>      if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('passwordreuselimit')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/passwordreuselimit.html">passwordreuselimit</a>) or <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('passwordreuselimit')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/passwordreuselimit.html">passwordreuselimit</a> &lt; 0) {
<a name="l925"><span class="linenum"> 925</span></a>          return;
<a name="l926"><span class="linenum"> 926</span></a>      }
<a name="l927"><span class="linenum"> 927</span></a>  
<a name="l928"><span class="linenum"> 928</span></a>  <span class="comment">    // Note: this is using separate code form normal password hashing because</span>
<a name="l929"><span class="linenum"> 929</span></a>  <span class="comment">    //       we need to have this under control in the future. Also the auth</span>
<a name="l930"><span class="linenum"> 930</span></a>  <span class="comment">    //       plugin might not store the passwords locally at all.</span>
<a name="l931"><span class="linenum"> 931</span></a>  
<a name="l932"><span class="linenum"> 932</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = new stdClass();
<a name="l933"><span class="linenum"> 933</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('userid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l934"><span class="linenum"> 934</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('hash')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/hash.html">hash</a> = <a class="function" onClick="logFunction('password_hash')" href="../_functions/password_hash.html" onMouseOver="funcPopup(event,'password_hash')">password_hash</a>(<a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('password')" href="../_variables/password.html">$password</a>, <a class="constant" onClick="logConstant('PASSWORD_DEFAULT')" href="../_constants/PASSWORD_DEFAULT.html" onMouseOver="constPopup(event,'PASSWORD_DEFAULT')">PASSWORD_DEFAULT</a>);
<a name="l935"><span class="linenum"> 935</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l936"><span class="linenum"> 936</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('user_password_history', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l937"><span class="linenum"> 937</span></a>  
<a name="l938"><span class="linenum"> 938</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> = 0;
<a name="l939"><span class="linenum"> 939</span></a>      <a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('user_password_history', array('userid' =&gt; <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>), 'timecreated DESC, id DESC');
<a name="l940"><span class="linenum"> 940</span></a>      foreach (<a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l941"><span class="linenum"> 941</span></a>          <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>++;
<a name="l942"><span class="linenum"> 942</span></a>          if (<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> &gt; <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('passwordreuselimit')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/passwordreuselimit.html">passwordreuselimit</a>) {
<a name="l943"><span class="linenum"> 943</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_password_history', array('id' =&gt; <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l944"><span class="linenum"> 944</span></a>          }
<a name="l945"><span class="linenum"> 945</span></a>      }
<a name="l946"><span class="linenum"> 946</span></a>  }
<a name="l947"><span class="linenum"> 947</span></a>  
<a name="l948"><span class="linenum"> 948</span></a>  <span class="comment">/**</span>
<a name="l949"><span class="linenum"> 949</span></a>  <span class="comment"> * Was this password used before on change or reset password page?</span>
<a name="l950"><span class="linenum"> 950</span></a>  <span class="comment"> *</span>
<a name="l951"><span class="linenum"> 951</span></a>  <span class="comment"> * The $CFG-&gt;passwordreuselimit setting determines</span>
<a name="l952"><span class="linenum"> 952</span></a>  <span class="comment"> * how many times different password needs to be used</span>
<a name="l953"><span class="linenum"> 953</span></a>  <span class="comment"> * before allowing previously used password again.</span>
<a name="l954"><span class="linenum"> 954</span></a>  <span class="comment"> *</span>
<a name="l955"><span class="linenum"> 955</span></a>  <span class="comment"> * @param int $userid user id</span>
<a name="l956"><span class="linenum"> 956</span></a>  <span class="comment"> * @param string $password plaintext password</span>
<a name="l957"><span class="linenum"> 957</span></a>  <span class="comment"> * @return bool true if password reused</span>
<a name="l958"><span class="linenum"> 958</span></a>  <span class="comment"> */</span>
<a name="l959"><span class="linenum"> 959</span></a>  function <a class="function" onClick="logFunction('user_is_previously_used_password')" href="../_functions/user_is_previously_used_password.html" onMouseOver="funcPopup(event,'user_is_previously_used_password')">user_is_previously_used_password</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('password')" href="../_variables/password.html">$password</a>) {
<a name="l960"><span class="linenum"> 960</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l961"><span class="linenum"> 961</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>.'/password_compat/lib/password.php');
<a name="l962"><span class="linenum"> 962</span></a>  
<a name="l963"><span class="linenum"> 963</span></a>      if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('passwordreuselimit')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/passwordreuselimit.html">passwordreuselimit</a>) or <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('passwordreuselimit')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/passwordreuselimit.html">passwordreuselimit</a> &lt; 0) {
<a name="l964"><span class="linenum"> 964</span></a>          return false;
<a name="l965"><span class="linenum"> 965</span></a>      }
<a name="l966"><span class="linenum"> 966</span></a>  
<a name="l967"><span class="linenum"> 967</span></a>      <a class="var it11667" onMouseOver="hilite(11667)" onMouseOut="lolite()" onClick="logVariable('reused')" href="../_variables/reused.html">$reused</a> = false;
<a name="l968"><span class="linenum"> 968</span></a>  
<a name="l969"><span class="linenum"> 969</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> = 0;
<a name="l970"><span class="linenum"> 970</span></a>      <a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('user_password_history', array('userid' =&gt; <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>), 'timecreated DESC, id DESC');
<a name="l971"><span class="linenum"> 971</span></a>      foreach (<a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l972"><span class="linenum"> 972</span></a>          <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>++;
<a name="l973"><span class="linenum"> 973</span></a>          if (<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> &gt; <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('passwordreuselimit')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/passwordreuselimit.html">passwordreuselimit</a>) {
<a name="l974"><span class="linenum"> 974</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_password_history', array('id' =&gt; <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l975"><span class="linenum"> 975</span></a>              continue;
<a name="l976"><span class="linenum"> 976</span></a>          }
<a name="l977"><span class="linenum"> 977</span></a>  <span class="comment">        // NOTE: this is slow but we cannot compare the hashes directly any more.</span>
<a name="l978"><span class="linenum"> 978</span></a>          if (<a class="function" onClick="logFunction('password_verify')" href="../_functions/password_verify.html" onMouseOver="funcPopup(event,'password_verify')">password_verify</a>(<a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('password')" href="../_variables/password.html">$password</a>, <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('hash')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/hash.html">hash</a>)) {
<a name="l979"><span class="linenum"> 979</span></a>              <a class="var it11667" onMouseOver="hilite(11667)" onMouseOut="lolite()" onClick="logVariable('reused')" href="../_variables/reused.html">$reused</a> = true;
<a name="l980"><span class="linenum"> 980</span></a>          }
<a name="l981"><span class="linenum"> 981</span></a>      }
<a name="l982"><span class="linenum"> 982</span></a>  
<a name="l983"><span class="linenum"> 983</span></a>      return <a class="var it11667" onMouseOver="hilite(11667)" onMouseOut="lolite()" onClick="logVariable('reused')" href="../_variables/reused.html">$reused</a>;
<a name="l984"><span class="linenum"> 984</span></a>  }
<a name="l985"><span class="linenum"> 985</span></a>  
<a name="l986"><span class="linenum"> 986</span></a>  <span class="comment">/**</span>
<a name="l987"><span class="linenum"> 987</span></a>  <span class="comment"> * Remove a user device from the Moodle database (for PUSH notifications usually).</span>
<a name="l988"><span class="linenum"> 988</span></a>  <span class="comment"> *</span>
<a name="l989"><span class="linenum"> 989</span></a>  <span class="comment"> * @param string $uuid The device UUID.</span>
<a name="l990"><span class="linenum"> 990</span></a>  <span class="comment"> * @param string $appid The app id. If empty all the devices matching the UUID for the user will be removed.</span>
<a name="l991"><span class="linenum"> 991</span></a>  <span class="comment"> * @return bool true if removed, false if the device didn't exists in the database</span>
<a name="l992"><span class="linenum"> 992</span></a>  <span class="comment"> * @since Moodle 2.9</span>
<a name="l993"><span class="linenum"> 993</span></a>  <span class="comment"> */</span>
<a name="l994"><span class="linenum"> 994</span></a>  function <a class="function" onClick="logFunction('user_remove_user_device')" href="../_functions/user_remove_user_device.html" onMouseOver="funcPopup(event,'user_remove_user_device')">user_remove_user_device</a>(<a class="var it2990" onMouseOver="hilite(2990)" onMouseOut="lolite()" onClick="logVariable('uuid')" href="../_variables/uuid.html">$uuid</a>, <a class="var it2986" onMouseOver="hilite(2986)" onMouseOut="lolite()" onClick="logVariable('appid')" href="../_variables/appid.html">$appid</a> = &quot;&quot;) {
<a name="l995"><span class="linenum"> 995</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l996"><span class="linenum"> 996</span></a>  
<a name="l997"><span class="linenum"> 997</span></a>      <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../_variables/conditions.html">$conditions</a> = array('uuid' =&gt; <a class="var it2990" onMouseOver="hilite(2990)" onMouseOut="lolite()" onClick="logVariable('uuid')" href="../_variables/uuid.html">$uuid</a>, 'userid' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l998"><span class="linenum"> 998</span></a>      if (!empty(<a class="var it2986" onMouseOver="hilite(2986)" onMouseOut="lolite()" onClick="logVariable('appid')" href="../_variables/appid.html">$appid</a>)) {
<a name="l999"><span class="linenum"> 999</span></a>          <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../_variables/conditions.html">$conditions</a>['appid'] = <a class="var it2986" onMouseOver="hilite(2986)" onMouseOut="lolite()" onClick="logVariable('appid')" href="../_variables/appid.html">$appid</a>;
<a name="l1000"><span class="linenum">1000</span></a>      }
<a name="l1001"><span class="linenum">1001</span></a>  
<a name="l1002"><span class="linenum">1002</span></a>      if (!<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('user_devices', <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../_variables/conditions.html">$conditions</a>)) {
<a name="l1003"><span class="linenum">1003</span></a>          return false;
<a name="l1004"><span class="linenum">1004</span></a>      }
<a name="l1005"><span class="linenum">1005</span></a>  
<a name="l1006"><span class="linenum">1006</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_devices', <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../_variables/conditions.html">$conditions</a>);
<a name="l1007"><span class="linenum">1007</span></a>  
<a name="l1008"><span class="linenum">1008</span></a>      return true;
<a name="l1009"><span class="linenum">1009</span></a>  }
<a name="l1010"><span class="linenum">1010</span></a>  
<a name="l1011"><span class="linenum">1011</span></a>  <span class="comment">/**</span>
<a name="l1012"><span class="linenum">1012</span></a>  <span class="comment"> * Trigger user_list_viewed event.</span>
<a name="l1013"><span class="linenum">1013</span></a>  <span class="comment"> *</span>
<a name="l1014"><span class="linenum">1014</span></a>  <span class="comment"> * @param stdClass  $course course  object</span>
<a name="l1015"><span class="linenum">1015</span></a>  <span class="comment"> * @param stdClass  $context course context object</span>
<a name="l1016"><span class="linenum">1016</span></a>  <span class="comment"> * @since Moodle 2.9</span>
<a name="l1017"><span class="linenum">1017</span></a>  <span class="comment"> */</span>
<a name="l1018"><span class="linenum">1018</span></a>  function <a class="function" onClick="logFunction('user_list_view')" href="../_functions/user_list_view.html" onMouseOver="funcPopup(event,'user_list_view')">user_list_view</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l1019"><span class="linenum">1019</span></a>  
<a name="l1020"><span class="linenum">1020</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('user_list_viewed')" href="../_classes/user_list_viewed.html" onMouseOver="classPopup(event,'user_list_viewed')">user_list_viewed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(array(
<a name="l1021"><span class="linenum">1021</span></a>          'objectid' =&gt; <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1022"><span class="linenum">1022</span></a>          'courseid' =&gt; <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1023"><span class="linenum">1023</span></a>          'context' =&gt; <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>,
<a name="l1024"><span class="linenum">1024</span></a>          'other' =&gt; array(
<a name="l1025"><span class="linenum">1025</span></a>              'courseshortname' =&gt; <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>,
<a name="l1026"><span class="linenum">1026</span></a>              'coursefullname' =&gt; <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;fullname
<a name="l1027"><span class="linenum">1027</span></a>          )
<a name="l1028"><span class="linenum">1028</span></a>      ));
<a name="l1029"><span class="linenum">1029</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1030"><span class="linenum">1030</span></a>  }
<a name="l1031"><span class="linenum">1031</span></a>  
<a name="l1032"><span class="linenum">1032</span></a>  <span class="comment">/**</span>
<a name="l1033"><span class="linenum">1033</span></a>  <span class="comment"> * Returns the url to use for the &quot;Grades&quot; link in the user navigation.</span>
<a name="l1034"><span class="linenum">1034</span></a>  <span class="comment"> *</span>
<a name="l1035"><span class="linenum">1035</span></a>  <span class="comment"> * @param int $userid The user's ID.</span>
<a name="l1036"><span class="linenum">1036</span></a>  <span class="comment"> * @param int $courseid The course ID if available.</span>
<a name="l1037"><span class="linenum">1037</span></a>  <span class="comment"> * @return mixed A URL to be directed to for &quot;Grades&quot;.</span>
<a name="l1038"><span class="linenum">1038</span></a>  <span class="comment"> */</span>
<a name="l1039"><span class="linenum">1039</span></a>  function <a class="function" onClick="logFunction('user_mygrades_url')" href="../_functions/user_mygrades_url.html" onMouseOver="funcPopup(event,'user_mygrades_url')">user_mygrades_url</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = null, <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> = <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l1040"><span class="linenum">1040</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1041"><span class="linenum">1041</span></a>      <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = null;
<a name="l1042"><span class="linenum">1042</span></a>      if (isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_mygrades_report')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/grade_mygrades_report.html">grade_mygrades_report</a>) &amp;&amp; <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_mygrades_report')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/grade_mygrades_report.html">grade_mygrades_report</a> != 'external') {
<a name="l1043"><span class="linenum">1043</span></a>          if (isset(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) &amp;&amp; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> != <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l1044"><span class="linenum">1044</span></a>  <span class="comment">            // Send to the gradebook report.</span>
<a name="l1045"><span class="linenum">1045</span></a>              <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/grade/report/' . <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_mygrades_report')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/grade_mygrades_report.html">grade_mygrades_report</a> . '<a class="filename" href="../index.php.html">/index.php</a>',
<a name="l1046"><span class="linenum">1046</span></a>                      array('id' =&gt; <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, 'userid' =&gt; <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>));
<a name="l1047"><span class="linenum">1047</span></a>          } else {
<a name="l1048"><span class="linenum">1048</span></a>              <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/grade/report/' . <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_mygrades_report')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/grade_mygrades_report.html">grade_mygrades_report</a> . '<a class="filename" href="../index.php.html">/index.php</a>');
<a name="l1049"><span class="linenum">1049</span></a>          }
<a name="l1050"><span class="linenum">1050</span></a>      } else if (isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_mygrades_report')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/grade_mygrades_report.html">grade_mygrades_report</a>) &amp;&amp; <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_mygrades_report')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/grade_mygrades_report.html">grade_mygrades_report</a> == 'external'
<a name="l1051"><span class="linenum">1051</span></a>              &amp;&amp; !empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('gradereport_mygradeurl')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/gradereport_mygradeurl.html">gradereport_mygradeurl</a>)) {
<a name="l1052"><span class="linenum">1052</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('gradereport_mygradeurl')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/gradereport_mygradeurl.html">gradereport_mygradeurl</a>;
<a name="l1053"><span class="linenum">1053</span></a>      } else {
<a name="l1054"><span class="linenum">1054</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>;
<a name="l1055"><span class="linenum">1055</span></a>      }
<a name="l1056"><span class="linenum">1056</span></a>      return <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>;
<a name="l1057"><span class="linenum">1057</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'user_create_user': ['user_create_user', 'Creates a user ', [['user','lib.php',26]], 10],
'user_get_user_details': ['user_get_user_details', 'Give user record from mdl_user, build an array contains all user details. ', [['user','lib.php',230]], 6],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1318]], 854],
'password_hash': ['password_hash', 'Hash the password using the specified algorithm ', [['lib/password_compat/lib','password.php',26]], 23],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',438],['lib/classes/event','base.php',682]], 778],
'user_get_default_fields': ['user_get_default_fields', 'Returns the list of default \'displayable\' fields ', [['user','lib.php',213]], 2],
'user_mygrades_url': ['user_mygrades_url', 'Returns the url to use for the "Grades" link in the user navigation. ', [['user','lib.php',1032]], 5],
'resolve_image_location': ['resolve_image_location', 'Resolves the real image location. ', [['lib','outputlib.php',1511]], 18],
'get_list_of_calendar_types': ['get_list_of_calendar_types', 'Returns a list of calendar typess available for use. ', [['calendar/classes','type_factory.php',53]], 5],
'enrol_get_users_courses': ['enrol_get_users_courses', 'Returns list of courses user is enrolled into. (Note: use enrol_get_all_users_courses if you want to use the list wihtout any cap checks ) ', [['lib','enrollib.php',679]], 18],
'create_from_userid': ['create_from_userid', 'Create instance of event. ', [['lib/classes/event','user_created.php',117],['lib/classes/event','user_updated.php',117]], 17],
'count_records': ['count_records', 'Count the records in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1717]], 1399],
'fullname': ['fullname', 'Returns a persons full name ', [['lib','moodlelib.php',3234],['mod/assign','locallib.php',3440]], 532],
'user_list_view': ['user_list_view', 'Trigger user_list_viewed event. ', [['user','lib.php',1011]], 3],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required. ', [['lib/dml','pgsql_native_moodle_database.php',883],['lib/dml','oci_native_moodle_database.php',1249],['lib/dml','sqlsrv_native_moodle_database.php',978],['lib/dml','mssql_native_moodle_database.php',898],['lib/dml','mysqli_native_moodle_database.php',1177],['lib/dml/tests','dml_test.php',5427],['lib/dml','pdo_moodle_database.php',386],['question/engine/upgrade','upgradelib.php',121]], 1512],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',884],['lib','accesslib.php',346]], 1929],
'get_string': ['get_string', 'Return a core get_string() call ', [['lib/external','externallib.php',112],['lib','moodlelib.php',6538],['lib','moodlelib.php',9417],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38],['lib/classes','string_manager_install.php',95],['question/behaviour','behaviourbase.php',756]], 19235],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as a moodle_recordset using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','oci_native_moodle_database.php',1065],['lib/dml','sqlsrv_native_moodle_database.php',761],['lib/dml','mssql_native_moodle_database.php',687],['lib/dml','mysqli_native_moodle_database.php',985],['lib/dml/tests','dml_test.php',5423],['lib/dml','pdo_moodle_database.php',251]], 279],
'check_password_policy': ['check_password_policy', 'Validate a password against the configured password policy ', [['lib','moodlelib.php',4580]], 13],
'get_records': ['get_records', 'Get a number of records as an array of objects where all the given conditions met. ', [['lib/dml','moodle_database.php',1236],['lib','coursecatlib.php',654],['question','category_class.php',63]], 860],
'get_records_list': ['get_records_list', 'Get a number of records as an array of objects where one field match one list of values. ', [['lib/dml','moodle_database.php',1261]], 32],
'get_realuser': ['get_realuser', 'Returns the $USER object ignoring current login-as session ', [['lib/classes/session','manager.php',794]], 10],
'password_verify': ['password_verify', 'Verify a password against a hash using a timing attack resistant approach ', [['lib/password_compat/lib','password.php',222]], 10],
'tag_get_tags_csv': ['tag_get_tags_csv', 'Get a comma-separated string of tags associated to a record.  Use {@see tag_get_tags()} to get the same information in an array. ', [['tag','lib.php',402]], 4],
'make_pluginfile_url': ['make_pluginfile_url', 'Factory method for creation of url pointing to plugin file. ', [['lib','weblib.php',725]], 29],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'enrol_sharing_course': ['enrol_sharing_course', 'Do these two students share any course? ', [['lib','enrollib.php',223]], 2],
'record_exists': ['record_exists', 'Test whether a record exists in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1768]], 735],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 552],
'is_empty': ['is_empty', 'Returns true or false, depending on whether this block has any content to display and whether the user has permission to view the block ', [['blocks','moodleblock.class.php',181],['blocks','moodleblock.class.php',706],['mod/assign','assignmentplugin.php',540],['mod/assign/submission/file','locallib.php',474],['mod/assign/submission/onlinetext','locallib.php',551],['mod/assign/submission/comments','locallib.php',78],['user/profile','lib.php',336],['mod/assign/feedback/editpdf','locallib.php',247],['mod/wiki/diff','difflib.php',354],['mod/assign/feedback/file','locallib.php',270],['mod/assign/feedback/comments','locallib.php',471],['mod/assign/feedback/offline','locallib.php',62],['availability/classes','tree.php',624]], 17],
'get_user_roles': ['get_user_roles', 'Gets the roles assigned to this user that are applicable for this course. ', [['enrol','locallib.php',799],['lib','accesslib.php',3242]], 7],
'has_coursecontact_role': ['has_coursecontact_role', 'Returns true if user has at least one role assign of \'coursecontact\' role (is potentially listed in some course descriptions). ', [['lib','accesslib.php',648]], 13],
'sesskey': ['sesskey', 'Makes sure that $USER->sesskey exists, if $USER itself exists. It sets a new sesskey if one does not already exist, but does not overwrite existing sesskeys. Returns the sesskey string if $USER exists, or boolean false if not. ', [['lib','sessionlib.php',28]], 631],
'user_is_previously_used_password': ['user_is_previously_used_password', 'Was this password used before on change or reset password page? ', [['user','lib.php',948]], 31],
'user_remove_user_device': ['user_remove_user_device', 'Remove a user device from the Moodle database (for PUSH notifications usually). ', [['user','lib.php',986]], 1],
'tag': ['tag', 'Outputs a tag with attributes and contents ', [['lib','outputcomponents.php',1063],['lib/zend/Zend/Service','Technorati.php',228]], 1254],
'get_auth_plugin': ['get_auth_plugin', 'Returns an authentication plugin instance. ', [['lib','moodlelib.php',3596]], 76],
'set_user_preference': ['set_user_preference', 'Sets a preference for the specified user. ', [['lib','moodlelib.php',1822]], 163],
'user_get_user_navigation_info': ['user_get_user_navigation_info', 'Get a list of essential user navigation items. ', [['user','lib.php',711]], 1],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 1891],
'out': ['out', 'Returns the string ', [['lib','moodlelib.php',9451],['lib','weblib.php',547],['lib','tablelib.php',1526],['lib','csslib.php',1540],['lib','csslib.php',1698],['lib','csslib.php',2078],['lib','csslib.php',2162],['lib','csslib.php',2306],['lib','csslib.php',2495],['lib','csslib.php',3240],['report/loglive/classes','table_log_ajax.php',37]], 549],
'out_as_local_url': ['out_as_local_url', 'Returns URL a relative path from $CFG->wwwroot ', [['lib','weblib.php',809]], 41],
'user_convert_text_to_menu_items': ['user_convert_text_to_menu_items', 'Converts a string into a flat array of menu items, where each menu items is a stdClass with fields type, url, title, pix, and imgsrc. ', [['user','lib.php',617]], 1],
'create': ['create', 'Creates a new 2048 bit RSA key pair and returns a unique ID that can be used to reference this key pair when launching new instances. ', [['lib/zend/Zend/Service/Amazon/Ec2','Keypair.php',39],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',271],['repository/filesystem','lib.php',283],['lib/zend/Zend/Service/Amazon/Ec2','Securitygroups.php',39],['lib/google/src/Google/Service','Gmail.php',670],['lib/google/src/Google/Service','Gmail.php',827],['course','lib.php',2874],['lib/classes/event','base.php',139],['lib/google/src/Google/Service','Genomics.php',618],['lib/google/src/Google/Service','Genomics.php',717],['lib/google/src/Google/Service','Genomics.php',850],['lib/google/src/Google/Service','Genomics.php',1313],['lib','modinfolib.php',1747],['calendar','lib.php',2651],['lib/zend/Zend/Service/Amazon','Sqs.php',82],['lib','weblib.php',3048],['mod/lesson','locallib.php',1013],['mod/lesson','locallib.php',2166],['mod/lesson','locallib.php',3203],['lib/google/src/Google/Service','Fitness.php',340],['lib/google/src/Google/Service','TagManager.php',1034],['lib/google/src/Google/Service','TagManager.php',1124],['lib/google/src/Google/Service','TagManager.php',1217],['lib/google/src/Google/Service','TagManager.php',1310],['lib/google/src/Google/Service','TagManager.php',1403],['lib/google/src/Google/Service','TagManager.php',1497],['lib/google/src/Google/Service','TagManager.php',1591],['lib/google/src/Google/Service','TagManager.php',1742],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Container.php',314],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['repository','lib.php',206],['repository','lib.php',1960],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',555],['lib/google/src/Google/Service','Games.php',1648],['lib/google/src/Google/Service','Games.php',2012],['lib/google/src/Google/Service','MapsEngine.php',1676],['lib/google/src/Google/Service','MapsEngine.php',1976],['lib/google/src/Google/Service','MapsEngine.php',2252],['lib/google/src/Google/Service','MapsEngine.php',2329],['lib/google/src/Google/Service','MapsEngine.php',2897],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Pubsub.php',219],['lib/google/src/Google/Service','Pubsub.php',364],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/simplepie/library/SimplePie','Registry.php',153],['lib','navigationlib.php',266],['lib/google/src/Google/Service','Dns.php',282],['lib/google/src/Google/Service','Dns.php',355],['lib','coursecatlib.php',328],['mod/quiz/classes','structure.php',65]], 3074],
'user_update_user': ['user_update_user', 'Update a user with a user object (will compare against the ID) ', [['user','lib.php',117]], 27],
'user_update_password': ['user_update_password', 'Updates the user\'s password. ', [['lib','authlib.php',234],['auth/db','auth.php',231],['auth/email','auth.php',58],['auth/none','auth.php',58],['auth/nologin','auth.php',50],['auth/manual','auth.php',81],['auth/webservice','auth.php',72],['auth/ldap','auth.php',1315]], 14],
'is_siteadmin': ['is_siteadmin', 'Check if the user is an admin at the site level. ', [['lib','accesslib.php',604]], 92],
'clean_param': ['clean_param', 'Used by {@link optional_param()} and {@link required_param()} to clean the variables and/or cast to specific types, based on an options field. <code> $course->format = clean_param($course->format, PARAM_ALPHA); $selectedgradeitem = clean_param($selectedgradeitem, PARAM_INT); </code> ', [['lib','moodlelib.php',768]], 607],
'user_page_type_list': ['user_page_type_list', 'Return a list of page types ', [['user','lib.php',581]], 0],
'can_change_password': ['can_change_password', 'Returns true if this authentication plugin can change the user\'s password. ', [['auth/radius','auth.php',151],['lib','authlib.php',151],['auth/pam','auth.php',101],['auth/db','auth.php',675],['auth/email','auth.php',173],['auth/shibboleth','auth.php',170],['auth/none','auth.php',89],['auth/nologin','auth.php',72],['auth/cas','auth.php',76],['auth/mnet','auth.php',588],['auth/pop3','auth.php',106],['auth/nntp','auth.php',89],['auth/manual','auth.php',112],['auth/fc','auth.php',170],['auth/imap','auth.php',110],['auth/webservice','auth.php',101],['auth/ldap','auth.php',1599]], 13],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'user_get_users_by_id': ['user_get_users_by_id', 'Get users by id ', [['user','lib.php',202]], 0],
'is_role_switched': ['is_role_switched', 'Checks if the user has switched roles within the given course. ', [['lib','accesslib.php',4385]], 11],
'user_delete_user': ['user_delete_user', 'Marks user deleted in internal user database and notifies the auth plugin. Also unenrols user from all roles and does other cleanup. ', [['user','lib.php',190]], 1],
'get_extra_user_fields': ['get_extra_user_fields', 'Checks if current user is shown any extra fields when listing users. ', [['lib','moodlelib.php',3465]], 41],
'get_user_preferences': ['get_user_preferences', 'Used to fetch user preference(s) ', [['lib','moodlelib.php',1969]], 177],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pgsql_native_moodle_database.php',1137],['lib/dml','oci_native_moodle_database.php',1355],['lib/dml','sqlsrv_native_moodle_database.php',1081],['lib/dml','mssql_native_moodle_database.php',1003],['lib/dml','mysqli_native_moodle_database.php',1397],['lib/dml/tests','dml_test.php',5430],['lib/dml','pdo_moodle_database.php',460]], 565],
'close': ['close', 'Close the connection to the server ', [['lib/zend/Zend/Http/Client/Adapter','Socket.php',486],['lib/tests','completionlib_test.php',888],['lib/adodb','adodb.inc.php',2164],['lib/adodb','adodb.inc.php',2844],['lib/adodb','adodb.inc.php',3536],['lib','webdavlib.php',176],['admin/tool/uploaduser','locallib.php',149],['lib/dml','oci_native_moodle_recordset.php',80],['lib/tcpdf','tcpdf.php',2943],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['lib','excellib.class.php',93],['lib/zend/Zend/Http/Client/Adapter','Test.php',187],['lib/classes/dml','recordset_walk.php',153],['mod/assign/feedback/offline','importgradeslib.php',178],['lib/pear/Net','GeoIP.php',556],['backup/util/helper','backup_array_iterator.class.php',63],['lib/zend/Zend/Gdata/App','LoggingHttpClientAdapterSocket.php',109],['lib/zend/Zend/Http/Client/Adapter','Proxy.php',266],['lib/dml','mssql_native_moodle_recordset.php',87],['lib/pear/Auth','RADIUS.php',542],['lib/pear/Auth','RADIUS.php',703],['lib/pear/Auth','RADIUS.php',824],['lib/phpmailer','class.smtp.php',507],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',80],['lib/phpunit/classes','event_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Interface.php',73],['lib/dml','pgsql_native_moodle_recordset.php',104],['auth/fc','fcFPP.php',72],['lib/filestorage','zip_archive.php',183],['lib','odslib.class.php',71],['lib/horde/framework/Horde/Socket','Client.php',135],['question/engine/tests','helpers.php',1225],['grade','lib.php',323],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib','csvlib.class.php',256],['lib/google/src/Google/Logger','File.php',130],['lib/horde/framework/Horde','Stream.php',585],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpunit/classes','message_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Curl.php',460],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',109],['backup/util/helper','backup_null_iterator.class.php',53],['grade/export','lib.php',662],['lib/dml','pdo_moodle_recordset.php',79]], 1036],
'user_add_password_history': ['user_add_password_history', 'Add password to the list of used hashes for this user. ', [['user','lib.php',908]], 28],
'role_get_name': ['role_get_name', 'Get localised role name or alias if exists and format the text. ', [['lib','accesslib.php',4497]], 46],
'groups_get_all_groups': ['groups_get_all_groups', 'Gets array of all groups in a specified course. ', [['lib','grouplib.php',189]], 104],
'delete_user': ['delete_user', 'Marks user deleted in internal user database and notifies the auth plugin. Also unenrols user from all roles and does other cleanup. ', [['lib','moodlelib.php',3879]], 29],
'external_format_text': ['external_format_text', 'Format the text to be returned properly as requested by the either the web service server, either by an internally call. The caller can change the format (raw, filter, file, fileurl) with the external_settings singleton All web service servers must set this singleton when parsing the $_GET and $_POST. ', [['lib','externallib.php',721]], 31],
'user_count_login_failures': ['user_count_login_failures', 'Count the number of failed login attempts for the given user, since last successful login. ', [['user','lib.php',592]], 5],
'user_get_user_details_courses': ['user_get_user_details_courses', 'Tries to obtain user details, either recurring directly to the user\'s system profile or through one of the user\'s course enrollments (course profile). ', [['user','lib.php',528]], 2],
'can_view_user_details_cap': ['can_view_user_details_cap', 'Check if $USER have the necessary capabilities to obtain user details. ', [['user','lib.php',562]], 2],
'is_visible': ['is_visible', 'Is this plugin enaled? ', [['mod/assign','assignmentplugin.php',287],['repository/coursefiles','lib.php',167],['user/profile','lib.php',312],['repository','lib.php',1829],['backup/cc/cc_lib','cc_converters.php',113]], 56],
'is_mnet_remote_user': ['is_mnet_remote_user', 'Returns whether or not the user object is a remote MNET user. This function is in moodlelib because it does not rely on loading any of the MNET code. ', [['lib','moodlelib.php',8869]], 20],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','moodle_database.php',1815],['lib/dml','sqlite3_pdo_moodle_database.php',337]], 778],
'is_loggedinas': ['is_loggedinas', 'Is current $USER logged-in-as somebody else? ', [['lib/classes/session','manager.php',786]], 32],
'array_key_exists': ['array_key_exists', '', [], 1539],
'explode': ['explode', '', [], 1599],
'strtolower': ['strtolower', '', [], 922],
'strpos': ['strpos', '', [], 1623],
'ltrim': ['ltrim', '', [], 83],
'count': ['count', '', [], 3984],
'trim': ['trim', '', [], 1889],
'preg_match': ['preg_match', '', [], 1317],
'in_array': ['in_array', '', [], 1173],
'is_null': ['is_null', '', [], 1992],
'time': ['time', '', [], 1768],
'is_object': ['is_object', '', [], 508],
'array_flip': ['array_flip', '', [], 118]};
CLASS_DATA={
'type_factory': ['type_factory', 'Class \core_calendar\type_factory. ', [['calendar/classes','type_factory.php',19]], 42],
'user_updated': ['user_updated', 'Event when user profile is updated. ', [['lib/classes/event','user_updated.php',29]], 9],
'manager': ['manager', 'Defines MAnager class for myprofile navigation tree. ', [['user/classes/output/myprofile','manager.php',28],['lib/classes/log','manager.php',29],['admin/tool/messageinbound/classes','manager.php',29],['lib/classes/message','manager.php',31],['lib/classes/message/inbound','manager.php',29],['admin/tool/log/classes/log','manager.php',29],['lib/classes/session','manager.php',29],['lib/classes/task','manager.php',28],['lib/classes/event','manager.php',30]], 346],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',240]], 2887],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6766]], 1197],
'context_user': ['context_user', 'User context class ', [['lib','accesslib.php',6347]], 288],
'core_text': ['core_text', 'defines string api\'s for manipulating strings ', [['lib/classes','text.php',27]], 512],
'html_writer': ['html_writer', 'Simple html output class ', [['lib','outputcomponents.php',1052]], 4832],
'user_list_viewed': ['user_list_viewed', 'Defines the user list viewed event. ', [['lib/classes/event','user_list_viewed.php',29]], 1],
'moodle_exception': ['moodle_exception', 'Base Moodle Exception class ', [['lib','setuplib.php',68]], 478],
'user_created': ['user_created', 'Event when new user profile is created. ', [['lib/classes/event','user_created.php',29]], 8]};
CONST_DATA={
'PARAM_URL': ['PARAM_URL', '', [['lib','moodlelib.php',239]], 121],
'PASSWORD_DEFAULT': ['PASSWORD_DEFAULT', '', [['lib/password_compat/lib','password.php',20]], 4],
'TAG_RETURN_TEXT': ['TAG_RETURN_TEXT', '', [['tag','lib.php',66]], 9],
'SITEID': ['SITEID', '', [['admin/cli','install.php',217],['','install.php',244],['lib/db','install.php',87],['lib','setup.php',748]], 612],
'PARAM_USERNAME': ['PARAM_USERNAME', '', [['lib','moodlelib.php',245]], 55],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1252],
'PARAM_STRINGID': ['PARAM_STRINGID', '', [['lib','moodlelib.php',250]], 27]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
