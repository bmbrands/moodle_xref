<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /auth/ldap/auth.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='auth/ldap';
filename='auth.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/auth/ldap/</a> -> <a href="auth.php.html">auth.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="auth.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="auth.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Authentication Plugin: LDAP Authentication</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Authentication using LDAP (Lightweight Directory Access Protocol).</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package auth_ldap</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @author Martin Dougiamas</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @author IÃ±aki Arenaza</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @license http://www.gnu.org/copyleft/gpl.html GNU Public License</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> */</span>
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment">// See http://support.microsoft.com/kb/305144 to interprete these values.</span>
<a name="l30"><span class="linenum">  30</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_AD_ACCOUNTDISABLE')" href="../../_constants/AUTH_AD_ACCOUNTDISABLE.html" onMouseOver="constPopup(event,'AUTH_AD_ACCOUNTDISABLE')">AUTH_AD_ACCOUNTDISABLE</a>')) {
<a name="l31"><span class="linenum">  31</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_AD_ACCOUNTDISABLE')" href="../../_constants/AUTH_AD_ACCOUNTDISABLE.html" onMouseOver="constPopup(event,'AUTH_AD_ACCOUNTDISABLE')">AUTH_AD_ACCOUNTDISABLE</a>', 0x0002);
<a name="l32"><span class="linenum">  32</span></a>  }
<a name="l33"><span class="linenum">  33</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_AD_NORMAL_ACCOUNT')" href="../../_constants/AUTH_AD_NORMAL_ACCOUNT.html" onMouseOver="constPopup(event,'AUTH_AD_NORMAL_ACCOUNT')">AUTH_AD_NORMAL_ACCOUNT</a>')) {
<a name="l34"><span class="linenum">  34</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_AD_NORMAL_ACCOUNT')" href="../../_constants/AUTH_AD_NORMAL_ACCOUNT.html" onMouseOver="constPopup(event,'AUTH_AD_NORMAL_ACCOUNT')">AUTH_AD_NORMAL_ACCOUNT</a>', 0x0200);
<a name="l35"><span class="linenum">  35</span></a>  }
<a name="l36"><span class="linenum">  36</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_NTLMTIMEOUT')" href="../../_constants/AUTH_NTLMTIMEOUT.html" onMouseOver="constPopup(event,'AUTH_NTLMTIMEOUT')">AUTH_NTLMTIMEOUT</a>')) {  // timewindow for the NTLM SSO process, in secs...
<a name="l37"><span class="linenum">  37</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_NTLMTIMEOUT')" href="../../_constants/AUTH_NTLMTIMEOUT.html" onMouseOver="constPopup(event,'AUTH_NTLMTIMEOUT')">AUTH_NTLMTIMEOUT</a>', 10);
<a name="l38"><span class="linenum">  38</span></a>  }
<a name="l39"><span class="linenum">  39</span></a>  
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">// UF_DONT_EXPIRE_PASSWD value taken from MSDN directly</span>
<a name="l41"><span class="linenum">  41</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('UF_DONT_EXPIRE_PASSWD')" href="../../_constants/UF_DONT_EXPIRE_PASSWD.html" onMouseOver="constPopup(event,'UF_DONT_EXPIRE_PASSWD')">UF_DONT_EXPIRE_PASSWD</a>')) {
<a name="l42"><span class="linenum">  42</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a> ('<a class="constant" onClick="logConstant('UF_DONT_EXPIRE_PASSWD')" href="../../_constants/UF_DONT_EXPIRE_PASSWD.html" onMouseOver="constPopup(event,'UF_DONT_EXPIRE_PASSWD')">UF_DONT_EXPIRE_PASSWD</a>', 0x00010000);
<a name="l43"><span class="linenum">  43</span></a>  }
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">// The Posix uid and gid of the 'nobody' account and 'nogroup' group.</span>
<a name="l46"><span class="linenum">  46</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_UID_NOBODY')" href="../../_constants/AUTH_UID_NOBODY.html" onMouseOver="constPopup(event,'AUTH_UID_NOBODY')">AUTH_UID_NOBODY</a>')) {
<a name="l47"><span class="linenum">  47</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_UID_NOBODY')" href="../../_constants/AUTH_UID_NOBODY.html" onMouseOver="constPopup(event,'AUTH_UID_NOBODY')">AUTH_UID_NOBODY</a>', -2);
<a name="l48"><span class="linenum">  48</span></a>  }
<a name="l49"><span class="linenum">  49</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_GID_NOGROUP')" href="../../_constants/AUTH_GID_NOGROUP.html" onMouseOver="constPopup(event,'AUTH_GID_NOGROUP')">AUTH_GID_NOGROUP</a>')) {
<a name="l50"><span class="linenum">  50</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_GID_NOGROUP')" href="../../_constants/AUTH_GID_NOGROUP.html" onMouseOver="constPopup(event,'AUTH_GID_NOGROUP')">AUTH_GID_NOGROUP</a>', -2);
<a name="l51"><span class="linenum">  51</span></a>  }
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">// Regular expressions for a valid NTLM username and domain name.</span>
<a name="l54"><span class="linenum">  54</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_VALID_USERNAME')" href="../../_constants/AUTH_NTLM_VALID_USERNAME.html" onMouseOver="constPopup(event,'AUTH_NTLM_VALID_USERNAME')">AUTH_NTLM_VALID_USERNAME</a>')) {
<a name="l55"><span class="linenum">  55</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_VALID_USERNAME')" href="../../_constants/AUTH_NTLM_VALID_USERNAME.html" onMouseOver="constPopup(event,'AUTH_NTLM_VALID_USERNAME')">AUTH_NTLM_VALID_USERNAME</a>', '[^/\\\\\\\\\[\]:;|=,+*?&lt;&gt;@&quot;]+');
<a name="l56"><span class="linenum">  56</span></a>  }
<a name="l57"><span class="linenum">  57</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_VALID_DOMAINNAME')" href="../../_constants/AUTH_NTLM_VALID_DOMAINNAME.html" onMouseOver="constPopup(event,'AUTH_NTLM_VALID_DOMAINNAME')">AUTH_NTLM_VALID_DOMAINNAME</a>')) {
<a name="l58"><span class="linenum">  58</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_VALID_DOMAINNAME')" href="../../_constants/AUTH_NTLM_VALID_DOMAINNAME.html" onMouseOver="constPopup(event,'AUTH_NTLM_VALID_DOMAINNAME')">AUTH_NTLM_VALID_DOMAINNAME</a>', '[^\\\\\\\\\/:*?&quot;&lt;&gt;|]+');
<a name="l59"><span class="linenum">  59</span></a>  }
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">// Default format for remote users if using NTLM SSO</span>
<a name="l61"><span class="linenum">  61</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_DEFAULT_FORMAT')" href="../../_constants/AUTH_NTLM_DEFAULT_FORMAT.html" onMouseOver="constPopup(event,'AUTH_NTLM_DEFAULT_FORMAT')">AUTH_NTLM_DEFAULT_FORMAT</a>')) {
<a name="l62"><span class="linenum">  62</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_DEFAULT_FORMAT')" href="../../_constants/AUTH_NTLM_DEFAULT_FORMAT.html" onMouseOver="constPopup(event,'AUTH_NTLM_DEFAULT_FORMAT')">AUTH_NTLM_DEFAULT_FORMAT</a>', '%domain%\\%username%');
<a name="l63"><span class="linenum">  63</span></a>  }
<a name="l64"><span class="linenum">  64</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_FASTPATH_ATTEMPT')" href="../../_constants/AUTH_NTLM_FASTPATH_ATTEMPT.html" onMouseOver="constPopup(event,'AUTH_NTLM_FASTPATH_ATTEMPT')">AUTH_NTLM_FASTPATH_ATTEMPT</a>')) {
<a name="l65"><span class="linenum">  65</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_FASTPATH_ATTEMPT')" href="../../_constants/AUTH_NTLM_FASTPATH_ATTEMPT.html" onMouseOver="constPopup(event,'AUTH_NTLM_FASTPATH_ATTEMPT')">AUTH_NTLM_FASTPATH_ATTEMPT</a>', 0);
<a name="l66"><span class="linenum">  66</span></a>  }
<a name="l67"><span class="linenum">  67</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_FASTPATH_YESFORM')" href="../../_constants/AUTH_NTLM_FASTPATH_YESFORM.html" onMouseOver="constPopup(event,'AUTH_NTLM_FASTPATH_YESFORM')">AUTH_NTLM_FASTPATH_YESFORM</a>')) {
<a name="l68"><span class="linenum">  68</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_FASTPATH_YESFORM')" href="../../_constants/AUTH_NTLM_FASTPATH_YESFORM.html" onMouseOver="constPopup(event,'AUTH_NTLM_FASTPATH_YESFORM')">AUTH_NTLM_FASTPATH_YESFORM</a>', 1);
<a name="l69"><span class="linenum">  69</span></a>  }
<a name="l70"><span class="linenum">  70</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_FASTPATH_YESATTEMPT')" href="../../_constants/AUTH_NTLM_FASTPATH_YESATTEMPT.html" onMouseOver="constPopup(event,'AUTH_NTLM_FASTPATH_YESATTEMPT')">AUTH_NTLM_FASTPATH_YESATTEMPT</a>')) {
<a name="l71"><span class="linenum">  71</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AUTH_NTLM_FASTPATH_YESATTEMPT')" href="../../_constants/AUTH_NTLM_FASTPATH_YESATTEMPT.html" onMouseOver="constPopup(event,'AUTH_NTLM_FASTPATH_YESATTEMPT')">AUTH_NTLM_FASTPATH_YESATTEMPT</a>', 2);
<a name="l72"><span class="linenum">  72</span></a>  }
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">// Allows us to retrieve a diagnostic message in case of LDAP operation error</span>
<a name="l75"><span class="linenum">  75</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('LDAP_OPT_DIAGNOSTIC_MESSAGE')" href="../../_constants/LDAP_OPT_DIAGNOSTIC_MESSAGE.html" onMouseOver="constPopup(event,'LDAP_OPT_DIAGNOSTIC_MESSAGE')">LDAP_OPT_DIAGNOSTIC_MESSAGE</a>')) {
<a name="l76"><span class="linenum">  76</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('LDAP_OPT_DIAGNOSTIC_MESSAGE')" href="../../_constants/LDAP_OPT_DIAGNOSTIC_MESSAGE.html" onMouseOver="constPopup(event,'LDAP_OPT_DIAGNOSTIC_MESSAGE')">LDAP_OPT_DIAGNOSTIC_MESSAGE</a>', 0x0032);
<a name="l77"><span class="linenum">  77</span></a>  }
<a name="l78"><span class="linenum">  78</span></a>  
<a name="l79"><span class="linenum">  79</span></a>  require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/authlib.php');
<a name="l80"><span class="linenum">  80</span></a>  require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/ldaplib.php');
<a name="l81"><span class="linenum">  81</span></a>  require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../user/lib.php.html">/user/lib.php</a>');
<a name="l82"><span class="linenum">  82</span></a>  
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">/**</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment"> * LDAP authentication plugin.</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment"> */</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('auth_plugin_ldap')" href="../../_classes/auth_plugin_ldap.html" onMouseOver="classPopup(event,'auth_plugin_ldap')">auth_plugin_ldap</a> <span class="keyword">extends</span> <a class="class" onClick="logClass('auth_plugin_base')" href="../../_classes/auth_plugin_base.html" onMouseOver="classPopup(event,'auth_plugin_base')">auth_plugin_base</a> {
<a name="l87"><span class="linenum">  87</span></a>  
<a name="l88"><span class="linenum">  88</span></a>      <span class="comment">/**</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">     * Init plugin config from database settings depending on the plugin auth type.</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">     */</span>
<a name="l91"><span class="linenum">  91</span></a>      function <a class="function" onClick="logFunction('init_plugin')" href="../../_functions/init_plugin.html" onMouseOver="funcPopup(event,'init_plugin')">init_plugin</a>(<a class="var it7567" onMouseOver="hilite(7567)" onMouseOut="lolite()" onClick="logVariable('authtype')" href="../../_variables/authtype.html">$authtype</a>) {
<a name="l92"><span class="linenum">  92</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a> = 'auth/'.<a class="var it7567" onMouseOver="hilite(7567)" onMouseOut="lolite()" onClick="logVariable('authtype')" href="../../_variables/authtype.html">$authtype</a>;
<a name="l93"><span class="linenum">  93</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l94"><span class="linenum">  94</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding)) {
<a name="l95"><span class="linenum">  95</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding = 'utf-8';
<a name="l96"><span class="linenum">  96</span></a>          }
<a name="l97"><span class="linenum">  97</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type)) {
<a name="l98"><span class="linenum">  98</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type = 'default';
<a name="l99"><span class="linenum">  99</span></a>          }
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>          <a class="var it19534" onMouseOver="hilite(19534)" onMouseOut="lolite()" onClick="logVariable('ldap_usertypes')" href="../../_variables/ldap_usertypes.html">$ldap_usertypes</a> = <a class="function" onClick="logFunction('ldap_supported_usertypes')" href="../../_functions/ldap_supported_usertypes.html" onMouseOver="funcPopup(event,'ldap_supported_usertypes')">ldap_supported_usertypes</a>();
<a name="l102"><span class="linenum"> 102</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type_name = <a class="var it19534" onMouseOver="hilite(19534)" onMouseOut="lolite()" onClick="logVariable('ldap_usertypes')" href="../../_variables/ldap_usertypes.html">$ldap_usertypes</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type];
<a name="l103"><span class="linenum"> 103</span></a>          unset(<a class="var it19534" onMouseOver="hilite(19534)" onMouseOut="lolite()" onClick="logVariable('ldap_usertypes')" href="../../_variables/ldap_usertypes.html">$ldap_usertypes</a>);
<a name="l104"><span class="linenum"> 104</span></a>  
<a name="l105"><span class="linenum"> 105</span></a>          <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a> = <a class="function" onClick="logFunction('ldap_getdefaults')" href="../../_functions/ldap_getdefaults.html" onMouseOver="funcPopup(event,'ldap_getdefaults')">ldap_getdefaults</a>();
<a name="l106"><span class="linenum"> 106</span></a>  
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment">        // Use defaults if values not given</span>
<a name="l108"><span class="linenum"> 108</span></a>          foreach (<a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">            // watch out - 0, false are correct values too</span>
<a name="l110"><span class="linenum"> 110</span></a>              if (!isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>}) or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>} == '') {
<a name="l111"><span class="linenum"> 111</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>} = <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type];
<a name="l112"><span class="linenum"> 112</span></a>              }
<a name="l113"><span class="linenum"> 113</span></a>          }
<a name="l114"><span class="linenum"> 114</span></a>  
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment">        // Hack prefix to objectclass</span>
<a name="l116"><span class="linenum"> 116</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass)) {
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">            // Can't send empty filter</span>
<a name="l118"><span class="linenum"> 118</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass = '(objectClass=*)';
<a name="l119"><span class="linenum"> 119</span></a>          } else if (<a class="phpfunction" onClick="logFunction('stripos')" href="../../_functions/stripos.html" onMouseOver="phpfuncPopup(event,'stripos')">stripos</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass, 'objectClass=') === 0) {
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment">            // Value is 'objectClass=some-string-here', so just add ()</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">            // around the value (filter _must_ have them).</span>
<a name="l122"><span class="linenum"> 122</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass = '('.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass.')';
<a name="l123"><span class="linenum"> 123</span></a>          } else if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass, '(') !== 0) {
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">            // Value is 'some-string-not-starting-with-left-parentheses',</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">            // which is assumed to be the objectClass matching value.</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">            // So build a valid filter with it.</span>
<a name="l127"><span class="linenum"> 127</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass = '(objectClass='.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass.')';
<a name="l128"><span class="linenum"> 128</span></a>          } else {
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">            // There is an additional possible value</span>
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">            // '(some-string-here)', that can be used to specify any</span>
<a name="l131"><span class="linenum"> 131</span></a>  <span class="comment">            // valid filter string, to select subsets of users based</span>
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">            // on any criteria. For example, we could select the users</span>
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">            // whose objectClass is 'user' and have the</span>
<a name="l134"><span class="linenum"> 134</span></a>  <span class="comment">            // 'enabledMoodleUser' attribute, with something like:</span>
<a name="l135"><span class="linenum"> 135</span></a>  <span class="comment">            //</span>
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">            //   (&amp;(objectClass=user)(enabledMoodleUser=1))</span>
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment">            //</span>
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment">            // In this particular case we don't need to do anything,</span>
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment">            // so leave $this-&gt;config-&gt;objectclass as is.</span>
<a name="l140"><span class="linenum"> 140</span></a>          }
<a name="l141"><span class="linenum"> 141</span></a>      }
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>      <span class="comment">/**</span>
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">     * Constructor with initialisation.</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">     */</span>
<a name="l146"><span class="linenum"> 146</span></a>      function <a class="function" onClick="logFunction('auth_plugin_ldap')" href="../../_functions/auth_plugin_ldap.html" onMouseOver="funcPopup(event,'auth_plugin_ldap')">auth_plugin_ldap</a>() {
<a name="l147"><span class="linenum"> 147</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a> = 'ldap';
<a name="l148"><span class="linenum"> 148</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('roleauth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/roleauth.html">roleauth</a> = 'auth_ldap';
<a name="l149"><span class="linenum"> 149</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a> = '[AUTH LDAP] ';
<a name="l150"><span class="linenum"> 150</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('init_plugin')" href="../../_functions/init_plugin.html" onMouseOver="funcPopup(event,'init_plugin')">init_plugin</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a>);
<a name="l151"><span class="linenum"> 151</span></a>      }
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>      <span class="comment">/**</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">     * Returns true if the username and password work and false if they are</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">     * wrong or don't exist.</span>
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">     *</span>
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment">     * @param string $username The username (without system magic quotes)</span>
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">     * @param string $password The password (without system magic quotes)</span>
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment">     *</span>
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment">     * @return bool Authentication success or failure.</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment">     */</span>
<a name="l162"><span class="linenum"> 162</span></a>      function <a class="function" onClick="logFunction('user_login')" href="../../_functions/user_login.html" onMouseOver="funcPopup(event,'user_login')">user_login</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, <a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('password')" href="../../_variables/password.html">$password</a>) {
<a name="l163"><span class="linenum"> 163</span></a>          if (! <a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('ldap_bind')) {
<a name="l164"><span class="linenum"> 164</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldapnotinstalled', 'auth_ldap');
<a name="l165"><span class="linenum"> 165</span></a>              return false;
<a name="l166"><span class="linenum"> 166</span></a>          }
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>          if (!<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a> or !<a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('password')" href="../../_variables/password.html">$password</a>) {    // Don't allow blank usernames or passwords
<a name="l169"><span class="linenum"> 169</span></a>              return false;
<a name="l170"><span class="linenum"> 170</span></a>          }
<a name="l171"><span class="linenum"> 171</span></a>  
<a name="l172"><span class="linenum"> 172</span></a>          <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l173"><span class="linenum"> 173</span></a>          <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('password')" href="../../_variables/password.html">$password</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l174"><span class="linenum"> 174</span></a>  
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">        // Before we connect to LDAP, check if this is an AD SSO login</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">        // if we succeed in this block, we'll return success early.</span>
<a name="l177"><span class="linenum"> 177</span></a>  <span class="comment">        //</span>
<a name="l178"><span class="linenum"> 178</span></a>          <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>();
<a name="l179"><span class="linenum"> 179</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_enabled) &amp;&amp; <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> === <a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('password')" href="../../_variables/password.html">$password</a>) {
<a name="l180"><span class="linenum"> 180</span></a>              <a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('cf')" href="../../_variables/cf.html">$cf</a> = <a class="function" onClick="logFunction('get_cache_flags')" href="../../_functions/get_cache_flags.html" onMouseOver="funcPopup(event,'get_cache_flags')">get_cache_flags</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>.'/ntlmsess');
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">            // We only get the cache flag if we retrieve it before</span>
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment">            // it expires (AUTH_NTLMTIMEOUT seconds).</span>
<a name="l183"><span class="linenum"> 183</span></a>              if (!isset(<a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('cf')" href="../../_variables/cf.html">$cf</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>]) || <a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('cf')" href="../../_variables/cf.html">$cf</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>] === '') {
<a name="l184"><span class="linenum"> 184</span></a>                  return false;
<a name="l185"><span class="linenum"> 185</span></a>              }
<a name="l186"><span class="linenum"> 186</span></a>  
<a name="l187"><span class="linenum"> 187</span></a>              <a class="var it37716" onMouseOver="hilite(37716)" onMouseOut="lolite()" onClick="logVariable('sessusername')" href="../../_variables/sessusername.html">$sessusername</a> = <a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('cf')" href="../../_variables/cf.html">$cf</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>];
<a name="l188"><span class="linenum"> 188</span></a>              if (<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a> === <a class="var it37716" onMouseOver="hilite(37716)" onMouseOut="lolite()" onClick="logVariable('sessusername')" href="../../_variables/sessusername.html">$sessusername</a>) {
<a name="l189"><span class="linenum"> 189</span></a>                  unset(<a class="var it37716" onMouseOver="hilite(37716)" onMouseOut="lolite()" onClick="logVariable('sessusername')" href="../../_variables/sessusername.html">$sessusername</a>);
<a name="l190"><span class="linenum"> 190</span></a>                  unset(<a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('cf')" href="../../_variables/cf.html">$cf</a>);
<a name="l191"><span class="linenum"> 191</span></a>  
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment">                // Check that the user is inside one of the configured LDAP contexts</span>
<a name="l193"><span class="linenum"> 193</span></a>                  <a class="var it2967" onMouseOver="hilite(2967)" onMouseOut="lolite()" onClick="logVariable('validuser')" href="../../_variables/validuser.html">$validuser</a> = false;
<a name="l194"><span class="linenum"> 194</span></a>                  <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">                // if the user is not inside the configured contexts,</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">                // ldap_find_userdn returns false.</span>
<a name="l197"><span class="linenum"> 197</span></a>                  if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>)) {
<a name="l198"><span class="linenum"> 198</span></a>                      <a class="var it2967" onMouseOver="hilite(2967)" onMouseOut="lolite()" onClick="logVariable('validuser')" href="../../_variables/validuser.html">$validuser</a> = true;
<a name="l199"><span class="linenum"> 199</span></a>                  }
<a name="l200"><span class="linenum"> 200</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l201"><span class="linenum"> 201</span></a>  
<a name="l202"><span class="linenum"> 202</span></a>  <span class="comment">                // Shortcut here - SSO confirmed</span>
<a name="l203"><span class="linenum"> 203</span></a>                  return <a class="var it2967" onMouseOver="hilite(2967)" onMouseOut="lolite()" onClick="logVariable('validuser')" href="../../_variables/validuser.html">$validuser</a>;
<a name="l204"><span class="linenum"> 204</span></a>              }
<a name="l205"><span class="linenum"> 205</span></a>          } <span class="comment">// End SSO processing</span>
<a name="l206"><span class="linenum"> 206</span></a>          unset(<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l207"><span class="linenum"> 207</span></a>  
<a name="l208"><span class="linenum"> 208</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l209"><span class="linenum"> 209</span></a>          <a class="var it32479" onMouseOver="hilite(32479)" onMouseOut="lolite()" onClick="logVariable('ldap_user_dn')" href="../../_variables/ldap_user_dn.html">$ldap_user_dn</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>);
<a name="l210"><span class="linenum"> 210</span></a>  
<a name="l211"><span class="linenum"> 211</span></a>  <span class="comment">        // If ldap_user_dn is empty, user does not exist</span>
<a name="l212"><span class="linenum"> 212</span></a>          if (!<a class="var it32479" onMouseOver="hilite(32479)" onMouseOut="lolite()" onClick="logVariable('ldap_user_dn')" href="../../_variables/ldap_user_dn.html">$ldap_user_dn</a>) {
<a name="l213"><span class="linenum"> 213</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l214"><span class="linenum"> 214</span></a>              return false;
<a name="l215"><span class="linenum"> 215</span></a>          }
<a name="l216"><span class="linenum"> 216</span></a>  
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment">        // Try to bind with current username and password</span>
<a name="l218"><span class="linenum"> 218</span></a>          <a class="var it37717" onMouseOver="hilite(37717)" onMouseOut="lolite()" onClick="logVariable('ldap_login')" href="../../_variables/ldap_login.html">$ldap_login</a> = @<a class="phpfunction" onClick="logFunction('ldap_bind')" href="../../_functions/ldap_bind.html" onMouseOver="phpfuncPopup(event,'ldap_bind')">ldap_bind</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it32479" onMouseOver="hilite(32479)" onMouseOut="lolite()" onClick="logVariable('ldap_user_dn')" href="../../_variables/ldap_user_dn.html">$ldap_user_dn</a>, <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>);
<a name="l219"><span class="linenum"> 219</span></a>  
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment">        // If login fails and we are using MS Active Directory, retrieve the diagnostic</span>
<a name="l221"><span class="linenum"> 221</span></a>  <span class="comment">        // message to see if this is due to an expired password, or that the user is forced to</span>
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment">        // change the password on first login. If it is, only proceed if we can change</span>
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment">        // password from Moodle (otherwise we'll get stuck later in the login process).</span>
<a name="l224"><span class="linenum"> 224</span></a>          if (!<a class="var it37717" onMouseOver="hilite(37717)" onMouseOut="lolite()" onClick="logVariable('ldap_login')" href="../../_variables/ldap_login.html">$ldap_login</a> &amp;&amp; (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type == 'ad')
<a name="l225"><span class="linenum"> 225</span></a>              &amp;&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('can_change_password')" href="../../_functions/can_change_password.html" onMouseOver="funcPopup(event,'can_change_password')">can_change_password</a>()
<a name="l226"><span class="linenum"> 226</span></a>              &amp;&amp; (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;expiration) and (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;expiration == 1))) {
<a name="l227"><span class="linenum"> 227</span></a>  
<a name="l228"><span class="linenum"> 228</span></a>  <span class="comment">            // We need to get the diagnostic message right after the call to ldap_bind(),</span>
<a name="l229"><span class="linenum"> 229</span></a>  <span class="comment">            // before any other LDAP operation.</span>
<a name="l230"><span class="linenum"> 230</span></a>              <a class="phpfunction" onClick="logFunction('ldap_get_option')" href="../../_functions/ldap_get_option.html" onMouseOver="phpfuncPopup(event,'ldap_get_option')">ldap_get_option</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="constant" onClick="logConstant('LDAP_OPT_DIAGNOSTIC_MESSAGE')" href="../../_constants/LDAP_OPT_DIAGNOSTIC_MESSAGE.html" onMouseOver="constPopup(event,'LDAP_OPT_DIAGNOSTIC_MESSAGE')">LDAP_OPT_DIAGNOSTIC_MESSAGE</a>, <a class="var it37718" onMouseOver="hilite(37718)" onMouseOut="lolite()" onClick="logVariable('diagmsg')" href="../../_variables/diagmsg.html">$diagmsg</a>);
<a name="l231"><span class="linenum"> 231</span></a>  
<a name="l232"><span class="linenum"> 232</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_ad_pwdexpired_from_diagmsg')" href="../../_functions/ldap_ad_pwdexpired_from_diagmsg.html" onMouseOver="funcPopup(event,'ldap_ad_pwdexpired_from_diagmsg')">ldap_ad_pwdexpired_from_diagmsg</a>(<a class="var it37718" onMouseOver="hilite(37718)" onMouseOut="lolite()" onClick="logVariable('diagmsg')" href="../../_variables/diagmsg.html">$diagmsg</a>)) {
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment">                // If login failed because user must change the password now or the</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment">                // password has expired, let the user in. We'll catch this later in the</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment">                // login process when we explicitly check for expired passwords.</span>
<a name="l236"><span class="linenum"> 236</span></a>                  <a class="var it37717" onMouseOver="hilite(37717)" onMouseOut="lolite()" onClick="logVariable('ldap_login')" href="../../_variables/ldap_login.html">$ldap_login</a> = true;
<a name="l237"><span class="linenum"> 237</span></a>              }
<a name="l238"><span class="linenum"> 238</span></a>          }
<a name="l239"><span class="linenum"> 239</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l240"><span class="linenum"> 240</span></a>          return <a class="var it37717" onMouseOver="hilite(37717)" onMouseOut="lolite()" onClick="logVariable('ldap_login')" href="../../_variables/ldap_login.html">$ldap_login</a>;
<a name="l241"><span class="linenum"> 241</span></a>      }
<a name="l242"><span class="linenum"> 242</span></a>  
<a name="l243"><span class="linenum"> 243</span></a>      <span class="comment">/**</span>
<a name="l244"><span class="linenum"> 244</span></a>  <span class="comment">     * Reads user information from ldap and returns it in array()</span>
<a name="l245"><span class="linenum"> 245</span></a>  <span class="comment">     *</span>
<a name="l246"><span class="linenum"> 246</span></a>  <span class="comment">     * Function should return all information available. If you are saving</span>
<a name="l247"><span class="linenum"> 247</span></a>  <span class="comment">     * this information to moodle user-table you should honor syncronization flags</span>
<a name="l248"><span class="linenum"> 248</span></a>  <span class="comment">     *</span>
<a name="l249"><span class="linenum"> 249</span></a>  <span class="comment">     * @param string $username username</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">     *</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment">     * @return mixed array with no magic quotes or false on error</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment">     */</span>
<a name="l253"><span class="linenum"> 253</span></a>      function <a class="function" onClick="logFunction('get_userinfo')" href="../../_functions/get_userinfo.html" onMouseOver="funcPopup(event,'get_userinfo')">get_userinfo</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>) {
<a name="l254"><span class="linenum"> 254</span></a>          <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l257"><span class="linenum"> 257</span></a>          if(!(<a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>))) {
<a name="l258"><span class="linenum"> 258</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l259"><span class="linenum"> 259</span></a>              return false;
<a name="l260"><span class="linenum"> 260</span></a>          }
<a name="l261"><span class="linenum"> 261</span></a>  
<a name="l262"><span class="linenum"> 262</span></a>          <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a> = array();
<a name="l263"><span class="linenum"> 263</span></a>          <a class="var it17976" onMouseOver="hilite(17976)" onMouseOut="lolite()" onClick="logVariable('attrmap')" href="../../_variables/attrmap.html">$attrmap</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_attributes')" href="../../_functions/ldap_attributes.html" onMouseOver="funcPopup(event,'ldap_attributes')">ldap_attributes</a>();
<a name="l264"><span class="linenum"> 264</span></a>          foreach (<a class="var it17976" onMouseOver="hilite(17976)" onMouseOut="lolite()" onClick="logVariable('attrmap')" href="../../_variables/attrmap.html">$attrmap</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>) {
<a name="l265"><span class="linenum"> 265</span></a>              if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>)) {
<a name="l266"><span class="linenum"> 266</span></a>                  <a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a> = array(<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>);
<a name="l267"><span class="linenum"> 267</span></a>              }
<a name="l268"><span class="linenum"> 268</span></a>              foreach (<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a> as <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l269"><span class="linenum"> 269</span></a>                  if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a>)) {
<a name="l270"><span class="linenum"> 270</span></a>                      <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a>, <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>);
<a name="l271"><span class="linenum"> 271</span></a>                  }
<a name="l272"><span class="linenum"> 272</span></a>              }
<a name="l273"><span class="linenum"> 273</span></a>          }
<a name="l274"><span class="linenum"> 274</span></a>  
<a name="l275"><span class="linenum"> 275</span></a>          if (!<a class="var it37720" onMouseOver="hilite(37720)" onMouseOut="lolite()" onClick="logVariable('user_info_result')" href="../../_variables/user_info_result.html">$user_info_result</a> = <a class="phpfunction" onClick="logFunction('ldap_read')" href="../../_functions/ldap_read.html" onMouseOver="phpfuncPopup(event,'ldap_read')">ldap_read</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, '(objectClass=*)', <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a>)) {
<a name="l276"><span class="linenum"> 276</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l277"><span class="linenum"> 277</span></a>              return false; <span class="comment">// error!</span>
<a name="l278"><span class="linenum"> 278</span></a>          }
<a name="l279"><span class="linenum"> 279</span></a>  
<a name="l280"><span class="linenum"> 280</span></a>          <a class="var it37721" onMouseOver="hilite(37721)" onMouseOut="lolite()" onClick="logVariable('user_entry')" href="../../_variables/user_entry.html">$user_entry</a> = <a class="function" onClick="logFunction('ldap_get_entries_moodle')" href="../../_functions/ldap_get_entries_moodle.html" onMouseOver="funcPopup(event,'ldap_get_entries_moodle')">ldap_get_entries_moodle</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37720" onMouseOver="hilite(37720)" onMouseOut="lolite()" onClick="logVariable('user_info_result')" href="../../_variables/user_info_result.html">$user_info_result</a>);
<a name="l281"><span class="linenum"> 281</span></a>          if (empty(<a class="var it37721" onMouseOver="hilite(37721)" onMouseOut="lolite()" onClick="logVariable('user_entry')" href="../../_variables/user_entry.html">$user_entry</a>)) {
<a name="l282"><span class="linenum"> 282</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l283"><span class="linenum"> 283</span></a>              return false; <span class="comment">// entry not found</span>
<a name="l284"><span class="linenum"> 284</span></a>          }
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l287"><span class="linenum"> 287</span></a>          foreach (<a class="var it17976" onMouseOver="hilite(17976)" onMouseOut="lolite()" onClick="logVariable('attrmap')" href="../../_variables/attrmap.html">$attrmap</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>) {
<a name="l288"><span class="linenum"> 288</span></a>              if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>)) {
<a name="l289"><span class="linenum"> 289</span></a>                  <a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a> = array(<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>);
<a name="l290"><span class="linenum"> 290</span></a>              }
<a name="l291"><span class="linenum"> 291</span></a>              <a class="var it37722" onMouseOver="hilite(37722)" onMouseOut="lolite()" onClick="logVariable('ldapval')" href="../../_variables/ldapval.html">$ldapval</a> = NULL;
<a name="l292"><span class="linenum"> 292</span></a>              foreach (<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a> as <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l293"><span class="linenum"> 293</span></a>                  <a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a> = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>(<a class="var it37721" onMouseOver="hilite(37721)" onMouseOut="lolite()" onClick="logVariable('user_entry')" href="../../_variables/user_entry.html">$user_entry</a>[0], CASE_LOWER);
<a name="l294"><span class="linenum"> 294</span></a>                  if ((<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> == 'dn') || (<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> == 'distinguishedname')) {
<a name="l295"><span class="linenum"> 295</span></a>                      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>] = <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>;
<a name="l296"><span class="linenum"> 296</span></a>                      continue;
<a name="l297"><span class="linenum"> 297</span></a>                  }
<a name="l298"><span class="linenum"> 298</span></a>                  if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>)) {
<a name="l299"><span class="linenum"> 299</span></a>                      continue; <span class="comment">// wrong data mapping!</span>
<a name="l300"><span class="linenum"> 300</span></a>                  }
<a name="l301"><span class="linenum"> 301</span></a>                  if (<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>[<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>])) {
<a name="l302"><span class="linenum"> 302</span></a>                      <a class="var it37723" onMouseOver="hilite(37723)" onMouseOut="lolite()" onClick="logVariable('newval')" href="../../_variables/newval.html">$newval</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>[<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>][0], <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding, 'utf-8');
<a name="l303"><span class="linenum"> 303</span></a>                  } else {
<a name="l304"><span class="linenum"> 304</span></a>                      <a class="var it37723" onMouseOver="hilite(37723)" onMouseOut="lolite()" onClick="logVariable('newval')" href="../../_variables/newval.html">$newval</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>[<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>], <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding, 'utf-8');
<a name="l305"><span class="linenum"> 305</span></a>                  }
<a name="l306"><span class="linenum"> 306</span></a>                  if (!empty(<a class="var it37723" onMouseOver="hilite(37723)" onMouseOut="lolite()" onClick="logVariable('newval')" href="../../_variables/newval.html">$newval</a>)) { // favour ldap entries that are set
<a name="l307"><span class="linenum"> 307</span></a>                      <a class="var it37722" onMouseOver="hilite(37722)" onMouseOut="lolite()" onClick="logVariable('ldapval')" href="../../_variables/ldapval.html">$ldapval</a> = <a class="var it37723" onMouseOver="hilite(37723)" onMouseOut="lolite()" onClick="logVariable('newval')" href="../../_variables/newval.html">$newval</a>;
<a name="l308"><span class="linenum"> 308</span></a>                  }
<a name="l309"><span class="linenum"> 309</span></a>              }
<a name="l310"><span class="linenum"> 310</span></a>              if (!<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it37722" onMouseOver="hilite(37722)" onMouseOut="lolite()" onClick="logVariable('ldapval')" href="../../_variables/ldapval.html">$ldapval</a>)) {
<a name="l311"><span class="linenum"> 311</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>] = <a class="var it37722" onMouseOver="hilite(37722)" onMouseOut="lolite()" onClick="logVariable('ldapval')" href="../../_variables/ldapval.html">$ldapval</a>;
<a name="l312"><span class="linenum"> 312</span></a>              }
<a name="l313"><span class="linenum"> 313</span></a>          }
<a name="l314"><span class="linenum"> 314</span></a>  
<a name="l315"><span class="linenum"> 315</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l316"><span class="linenum"> 316</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l317"><span class="linenum"> 317</span></a>      }
<a name="l318"><span class="linenum"> 318</span></a>  
<a name="l319"><span class="linenum"> 319</span></a>      <span class="comment">/**</span>
<a name="l320"><span class="linenum"> 320</span></a>  <span class="comment">     * Reads user information from ldap and returns it in an object</span>
<a name="l321"><span class="linenum"> 321</span></a>  <span class="comment">     *</span>
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment">     * @param string $username username (with system magic quotes)</span>
<a name="l323"><span class="linenum"> 323</span></a>  <span class="comment">     * @return mixed object or false on error</span>
<a name="l324"><span class="linenum"> 324</span></a>  <span class="comment">     */</span>
<a name="l325"><span class="linenum"> 325</span></a>      function <a class="function" onClick="logFunction('get_userinfo_asobj')" href="../../_functions/get_userinfo_asobj.html" onMouseOver="funcPopup(event,'get_userinfo_asobj')">get_userinfo_asobj</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>) {
<a name="l326"><span class="linenum"> 326</span></a>          <a class="var it10998" onMouseOver="hilite(10998)" onMouseOut="lolite()" onClick="logVariable('user_array')" href="../../_variables/user_array.html">$user_array</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_userinfo')" href="../../_functions/get_userinfo.html" onMouseOver="funcPopup(event,'get_userinfo')">get_userinfo</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>);
<a name="l327"><span class="linenum"> 327</span></a>          if (<a class="var it10998" onMouseOver="hilite(10998)" onMouseOut="lolite()" onClick="logVariable('user_array')" href="../../_variables/user_array.html">$user_array</a> == false) {
<a name="l328"><span class="linenum"> 328</span></a>              return false; <span class="comment">//error or not found</span>
<a name="l329"><span class="linenum"> 329</span></a>          }
<a name="l330"><span class="linenum"> 330</span></a>          <a class="var it10998" onMouseOver="hilite(10998)" onMouseOut="lolite()" onClick="logVariable('user_array')" href="../../_variables/user_array.html">$user_array</a> = <a class="function" onClick="logFunction('truncate_userinfo')" href="../../_functions/truncate_userinfo.html" onMouseOver="funcPopup(event,'truncate_userinfo')">truncate_userinfo</a>(<a class="var it10998" onMouseOver="hilite(10998)" onMouseOut="lolite()" onClick="logVariable('user_array')" href="../../_variables/user_array.html">$user_array</a>);
<a name="l331"><span class="linenum"> 331</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = new stdClass();
<a name="l332"><span class="linenum"> 332</span></a>          foreach (<a class="var it10998" onMouseOver="hilite(10998)" onMouseOut="lolite()" onClick="logVariable('user_array')" href="../../_variables/user_array.html">$user_array</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>=&gt;<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l333"><span class="linenum"> 333</span></a>              <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;{<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>} = <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l334"><span class="linenum"> 334</span></a>          }
<a name="l335"><span class="linenum"> 335</span></a>          return <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>;
<a name="l336"><span class="linenum"> 336</span></a>      }
<a name="l337"><span class="linenum"> 337</span></a>  
<a name="l338"><span class="linenum"> 338</span></a>      <span class="comment">/**</span>
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment">     * Returns all usernames from LDAP</span>
<a name="l340"><span class="linenum"> 340</span></a>  <span class="comment">     *</span>
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment">     * get_userlist returns all usernames from LDAP</span>
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment">     *</span>
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment">     * @return array</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment">     */</span>
<a name="l345"><span class="linenum"> 345</span></a>      function <a class="function" onClick="logFunction('get_userlist')" href="../../_functions/get_userlist.html" onMouseOver="funcPopup(event,'get_userlist')">get_userlist</a>() {
<a name="l346"><span class="linenum"> 346</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_get_userlist')" href="../../_functions/ldap_get_userlist.html" onMouseOver="funcPopup(event,'ldap_get_userlist')">ldap_get_userlist</a>(&quot;({<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute}=*)&quot;);
<a name="l347"><span class="linenum"> 347</span></a>      }
<a name="l348"><span class="linenum"> 348</span></a>  
<a name="l349"><span class="linenum"> 349</span></a>      <span class="comment">/**</span>
<a name="l350"><span class="linenum"> 350</span></a>  <span class="comment">     * Checks if user exists on LDAP</span>
<a name="l351"><span class="linenum"> 351</span></a>  <span class="comment">     *</span>
<a name="l352"><span class="linenum"> 352</span></a>  <span class="comment">     * @param string $username</span>
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment">     */</span>
<a name="l354"><span class="linenum"> 354</span></a>      function <a class="function" onClick="logFunction('user_exists')" href="../../_functions/user_exists.html" onMouseOver="funcPopup(event,'user_exists')">user_exists</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>) {
<a name="l355"><span class="linenum"> 355</span></a>          <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l356"><span class="linenum"> 356</span></a>  
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment">        // Returns true if given username exists on ldap</span>
<a name="l358"><span class="linenum"> 358</span></a>          <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_get_userlist')" href="../../_functions/ldap_get_userlist.html" onMouseOver="funcPopup(event,'ldap_get_userlist')">ldap_get_userlist</a>('('.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute.'='.<a class="function" onClick="logFunction('ldap_filter_addslashes')" href="../../_functions/ldap_filter_addslashes.html" onMouseOver="funcPopup(event,'ldap_filter_addslashes')">ldap_filter_addslashes</a>(<a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>).')');
<a name="l359"><span class="linenum"> 359</span></a>          return <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>);
<a name="l360"><span class="linenum"> 360</span></a>      }
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>      <span class="comment">/**</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment">     * Creates a new user on LDAP.</span>
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment">     * By using information in userobject</span>
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment">     * Use user_exists to prevent duplicate usernames</span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment">     *</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment">     * @param mixed $userobject  Moodle userobject</span>
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment">     * @param mixed $plainpass   Plaintext password</span>
<a name="l369"><span class="linenum"> 369</span></a>  <span class="comment">     */</span>
<a name="l370"><span class="linenum"> 370</span></a>      function <a class="function" onClick="logFunction('user_create')" href="../../_functions/user_create.html" onMouseOver="funcPopup(event,'user_create')">user_create</a>(<a class="var it19876" onMouseOver="hilite(19876)" onMouseOut="lolite()" onClick="logVariable('userobject')" href="../../_variables/userobject.html">$userobject</a>, <a class="var it37724" onMouseOver="hilite(37724)" onMouseOut="lolite()" onClick="logVariable('plainpass')" href="../../_variables/plainpass.html">$plainpass</a>) {
<a name="l371"><span class="linenum"> 371</span></a>          <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it19876" onMouseOver="hilite(19876)" onMouseOut="lolite()" onClick="logVariable('userobject')" href="../../_variables/userobject.html">$userobject</a>-&gt;<a onClick="logVariable('username')" class="var it41139" onMouseOver="hilite(41139)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l372"><span class="linenum"> 372</span></a>          <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it37724" onMouseOver="hilite(37724)" onMouseOut="lolite()" onClick="logVariable('plainpass')" href="../../_variables/plainpass.html">$plainpass</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l373"><span class="linenum"> 373</span></a>  
<a name="l374"><span class="linenum"> 374</span></a>          switch (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;passtype) {
<a name="l375"><span class="linenum"> 375</span></a>              case 'md5':
<a name="l376"><span class="linenum"> 376</span></a>                  <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a> = '{MD5}' . <a class="phpfunction" onClick="logFunction('base64_encode')" href="../../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="phpfunction" onClick="logFunction('pack')" href="../../_functions/pack.html" onMouseOver="phpfuncPopup(event,'pack')">pack</a>('H*', md5(<a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>)));
<a name="l377"><span class="linenum"> 377</span></a>                  break;
<a name="l378"><span class="linenum"> 378</span></a>              case 'sha1':
<a name="l379"><span class="linenum"> 379</span></a>                  <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a> = '{SHA}' . <a class="phpfunction" onClick="logFunction('base64_encode')" href="../../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="phpfunction" onClick="logFunction('pack')" href="../../_functions/pack.html" onMouseOver="phpfuncPopup(event,'pack')">pack</a>('H*', <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>)));
<a name="l380"><span class="linenum"> 380</span></a>                  break;
<a name="l381"><span class="linenum"> 381</span></a>              case 'plaintext':
<a name="l382"><span class="linenum"> 382</span></a>              default:
<a name="l383"><span class="linenum"> 383</span></a>                  break; <span class="comment">// plaintext</span>
<a name="l384"><span class="linenum"> 384</span></a>          }
<a name="l385"><span class="linenum"> 385</span></a>  
<a name="l386"><span class="linenum"> 386</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l387"><span class="linenum"> 387</span></a>          <a class="var it17976" onMouseOver="hilite(17976)" onMouseOut="lolite()" onClick="logVariable('attrmap')" href="../../_variables/attrmap.html">$attrmap</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_attributes')" href="../../_functions/ldap_attributes.html" onMouseOver="funcPopup(event,'ldap_attributes')">ldap_attributes</a>();
<a name="l388"><span class="linenum"> 388</span></a>  
<a name="l389"><span class="linenum"> 389</span></a>          <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a> = array();
<a name="l390"><span class="linenum"> 390</span></a>  
<a name="l391"><span class="linenum"> 391</span></a>          foreach (<a class="var it17976" onMouseOver="hilite(17976)" onMouseOut="lolite()" onClick="logVariable('attrmap')" href="../../_variables/attrmap.html">$attrmap</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>) {
<a name="l392"><span class="linenum"> 392</span></a>              if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>)) {
<a name="l393"><span class="linenum"> 393</span></a>                  <a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a> = array(<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>);
<a name="l394"><span class="linenum"> 394</span></a>              }
<a name="l395"><span class="linenum"> 395</span></a>              foreach (<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a> as <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l396"><span class="linenum"> 396</span></a>                  if (!empty(<a class="var it19876" onMouseOver="hilite(19876)" onMouseOut="lolite()" onClick="logVariable('userobject')" href="../../_variables/userobject.html">$userobject</a>-&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>) ) {
<a name="l397"><span class="linenum"> 397</span></a>                      <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>[<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>] = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it19876" onMouseOver="hilite(19876)" onMouseOut="lolite()" onClick="logVariable('userobject')" href="../../_variables/userobject.html">$userobject</a>-&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l398"><span class="linenum"> 398</span></a>                  }
<a name="l399"><span class="linenum"> 399</span></a>              }
<a name="l400"><span class="linenum"> 400</span></a>          }
<a name="l401"><span class="linenum"> 401</span></a>  
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">        //Following sets all mandatory and other forced attribute values</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment">        //User should be creted as login disabled untill email confirmation is processed</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment">        //Feel free to add your user type and send patches to paca@sci.fi to add them</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment">        //Moodle distribution</span>
<a name="l406"><span class="linenum"> 406</span></a>  
<a name="l407"><span class="linenum"> 407</span></a>          switch (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type)  {
<a name="l408"><span class="linenum"> 408</span></a>              case 'edir':
<a name="l409"><span class="linenum"> 409</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['objectClass']   = array('inetOrgPerson', 'organizationalPerson', 'person', 'top');
<a name="l410"><span class="linenum"> 410</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['uniqueId']      = <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>;
<a name="l411"><span class="linenum"> 411</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['logindisabled'] = 'TRUE';
<a name="l412"><span class="linenum"> 412</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['userpassword']  = <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>;
<a name="l413"><span class="linenum"> 413</span></a>                  <a class="var it37725" onMouseOver="hilite(37725)" onMouseOut="lolite()" onClick="logVariable('uadd')" href="../../_variables/uadd.html">$uadd</a> = <a class="phpfunction" onClick="logFunction('ldap_add')" href="../../_functions/ldap_add.html" onMouseOver="phpfuncPopup(event,'ldap_add')">ldap_add</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute.'='.<a class="function" onClick="logFunction('ldap_addslashes')" href="../../_functions/ldap_addslashes.html" onMouseOver="funcPopup(event,'ldap_addslashes')">ldap_addslashes</a>(<a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>).','.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context, <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>);
<a name="l414"><span class="linenum"> 414</span></a>                  break;
<a name="l415"><span class="linenum"> 415</span></a>              case 'rfc2307':
<a name="l416"><span class="linenum"> 416</span></a>              case 'rfc2307bis':
<a name="l417"><span class="linenum"> 417</span></a>  <span class="comment">                // posixAccount object class forces us to specify a uidNumber</span>
<a name="l418"><span class="linenum"> 418</span></a>  <span class="comment">                // and a gidNumber. That is quite complicated to generate from</span>
<a name="l419"><span class="linenum"> 419</span></a>  <span class="comment">                // Moodle without colliding with existing numbers and without</span>
<a name="l420"><span class="linenum"> 420</span></a>  <span class="comment">                // race conditions. As this user is supposed to be only used</span>
<a name="l421"><span class="linenum"> 421</span></a>  <span class="comment">                // with Moodle (otherwise the user would exist beforehand) and</span>
<a name="l422"><span class="linenum"> 422</span></a>  <span class="comment">                // doesn't need to login into a operating system, we assign the</span>
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment">                // user the uid of user 'nobody' and gid of group 'nogroup'. In</span>
<a name="l424"><span class="linenum"> 424</span></a>  <span class="comment">                // addition to that, we need to specify a home directory. We</span>
<a name="l425"><span class="linenum"> 425</span></a>  <span class="comment">                // use the root directory ('/') as the home directory, as this</span>
<a name="l426"><span class="linenum"> 426</span></a>  <span class="comment">                // is the only one can always be sure exists. Finally, even if</span>
<a name="l427"><span class="linenum"> 427</span></a>  <span class="comment">                // it's not mandatory, we specify '/bin/false' as the login</span>
<a name="l428"><span class="linenum"> 428</span></a>  <span class="comment">                // shell, to prevent the user from login in at the operating</span>
<a name="l429"><span class="linenum"> 429</span></a>  <span class="comment">                // system level (Moodle ignores this).</span>
<a name="l430"><span class="linenum"> 430</span></a>  
<a name="l431"><span class="linenum"> 431</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['objectClass']   = array('posixAccount', 'inetOrgPerson', 'organizationalPerson', 'person', 'top');
<a name="l432"><span class="linenum"> 432</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['cn']            = <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>;
<a name="l433"><span class="linenum"> 433</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['uid']           = <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>;
<a name="l434"><span class="linenum"> 434</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['uidNumber']     = <a class="constant" onClick="logConstant('AUTH_UID_NOBODY')" href="../../_constants/AUTH_UID_NOBODY.html" onMouseOver="constPopup(event,'AUTH_UID_NOBODY')">AUTH_UID_NOBODY</a>;
<a name="l435"><span class="linenum"> 435</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['gidNumber']     = <a class="constant" onClick="logConstant('AUTH_GID_NOGROUP')" href="../../_constants/AUTH_GID_NOGROUP.html" onMouseOver="constPopup(event,'AUTH_GID_NOGROUP')">AUTH_GID_NOGROUP</a>;
<a name="l436"><span class="linenum"> 436</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['homeDirectory'] = '/';
<a name="l437"><span class="linenum"> 437</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['loginShell']    = '/bin/false';
<a name="l438"><span class="linenum"> 438</span></a>  
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">                // IMPORTANT:</span>
<a name="l440"><span class="linenum"> 440</span></a>  <span class="comment">                // We have to create the account locked, but posixAccount has</span>
<a name="l441"><span class="linenum"> 441</span></a>  <span class="comment">                // no attribute to achive this reliably. So we are going to</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">                // modify the password in a reversable way that we can later</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">                // revert in user_activate().</span>
<a name="l444"><span class="linenum"> 444</span></a>  <span class="comment">                //</span>
<a name="l445"><span class="linenum"> 445</span></a>  <span class="comment">                // Beware that this can be defeated by the user if we are not</span>
<a name="l446"><span class="linenum"> 446</span></a>  <span class="comment">                // using MD5 or SHA-1 passwords. After all, the source code of</span>
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">                // Moodle is available, and the user can see the kind of</span>
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment">                // modification we are doing and 'undo' it by hand (but only</span>
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment">                // if we are using plain text passwords).</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment">                //</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">                // Also bear in mind that you need to use a binding user that</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">                // can create accounts and has read/write privileges on the</span>
<a name="l453"><span class="linenum"> 453</span></a>  <span class="comment">                // 'userPassword' attribute for this to work.</span>
<a name="l454"><span class="linenum"> 454</span></a>  
<a name="l455"><span class="linenum"> 455</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['userPassword']  = '*'.<a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>;
<a name="l456"><span class="linenum"> 456</span></a>                  <a class="var it37725" onMouseOver="hilite(37725)" onMouseOut="lolite()" onClick="logVariable('uadd')" href="../../_variables/uadd.html">$uadd</a> = <a class="phpfunction" onClick="logFunction('ldap_add')" href="../../_functions/ldap_add.html" onMouseOver="phpfuncPopup(event,'ldap_add')">ldap_add</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute.'='.<a class="function" onClick="logFunction('ldap_addslashes')" href="../../_functions/ldap_addslashes.html" onMouseOver="funcPopup(event,'ldap_addslashes')">ldap_addslashes</a>(<a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>).','.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context, <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>);
<a name="l457"><span class="linenum"> 457</span></a>                  break;
<a name="l458"><span class="linenum"> 458</span></a>              case 'ad':
<a name="l459"><span class="linenum"> 459</span></a>  <span class="comment">                // User account creation is a two step process with AD. First you</span>
<a name="l460"><span class="linenum"> 460</span></a>  <span class="comment">                // create the user object, then you set the password. If you try</span>
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">                // to set the password while creating the user, the operation</span>
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment">                // fails.</span>
<a name="l463"><span class="linenum"> 463</span></a>  
<a name="l464"><span class="linenum"> 464</span></a>  <span class="comment">                // Passwords in Active Directory must be encoded as Unicode</span>
<a name="l465"><span class="linenum"> 465</span></a>  <span class="comment">                // strings (UCS-2 Little Endian format) and surrounded with</span>
<a name="l466"><span class="linenum"> 466</span></a>  <span class="comment">                // double quotes. See http://support.microsoft.com/?kbid=269190</span>
<a name="l467"><span class="linenum"> 467</span></a>                  if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('mb_convert_encoding')) {
<a name="l468"><span class="linenum"> 468</span></a>                      <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldap_no_mbstring', 'auth_ldap');
<a name="l469"><span class="linenum"> 469</span></a>                  }
<a name="l470"><span class="linenum"> 470</span></a>  
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment">                // Check for invalid sAMAccountName characters.</span>
<a name="l472"><span class="linenum"> 472</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('#[/\\[\]:;|=,+*?&lt;&gt;@&quot;]#', <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>)) {
<a name="l473"><span class="linenum"> 473</span></a>                      <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a> ('auth_ldap_ad_invalidchars', 'auth_ldap');
<a name="l474"><span class="linenum"> 474</span></a>                  }
<a name="l475"><span class="linenum"> 475</span></a>  
<a name="l476"><span class="linenum"> 476</span></a>  <span class="comment">                // First create the user account, and mark it as disabled.</span>
<a name="l477"><span class="linenum"> 477</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['objectClass'] = array('top', 'person', 'user', 'organizationalPerson');
<a name="l478"><span class="linenum"> 478</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['sAMAccountName'] = <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>;
<a name="l479"><span class="linenum"> 479</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['userAccountControl'] = <a class="constant" onClick="logConstant('AUTH_AD_NORMAL_ACCOUNT')" href="../../_constants/AUTH_AD_NORMAL_ACCOUNT.html" onMouseOver="constPopup(event,'AUTH_AD_NORMAL_ACCOUNT')">AUTH_AD_NORMAL_ACCOUNT</a> |
<a name="l480"><span class="linenum"> 480</span></a>                                                   <a class="constant" onClick="logConstant('AUTH_AD_ACCOUNTDISABLE')" href="../../_constants/AUTH_AD_ACCOUNTDISABLE.html" onMouseOver="constPopup(event,'AUTH_AD_ACCOUNTDISABLE')">AUTH_AD_ACCOUNTDISABLE</a>;
<a name="l481"><span class="linenum"> 481</span></a>                  <a class="var it27828" onMouseOver="hilite(27828)" onMouseOut="lolite()" onClick="logVariable('userdn')" href="../../_variables/userdn.html">$userdn</a> = 'cn='.<a class="function" onClick="logFunction('ldap_addslashes')" href="../../_functions/ldap_addslashes.html" onMouseOver="funcPopup(event,'ldap_addslashes')">ldap_addslashes</a>(<a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>).','.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context;
<a name="l482"><span class="linenum"> 482</span></a>                  if (!<a class="phpfunction" onClick="logFunction('ldap_add')" href="../../_functions/ldap_add.html" onMouseOver="phpfuncPopup(event,'ldap_add')">ldap_add</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it27828" onMouseOver="hilite(27828)" onMouseOut="lolite()" onClick="logVariable('userdn')" href="../../_variables/userdn.html">$userdn</a>, <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>)) {
<a name="l483"><span class="linenum"> 483</span></a>                      <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldap_ad_create_req', 'auth_ldap');
<a name="l484"><span class="linenum"> 484</span></a>                  }
<a name="l485"><span class="linenum"> 485</span></a>  
<a name="l486"><span class="linenum"> 486</span></a>  <span class="comment">                // Now set the password</span>
<a name="l487"><span class="linenum"> 487</span></a>                  unset(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>);
<a name="l488"><span class="linenum"> 488</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>['unicodePwd'] = <a class="phpfunction" onClick="logFunction('mb_convert_encoding')" href="../../_functions/mb_convert_encoding.html" onMouseOver="phpfuncPopup(event,'mb_convert_encoding')">mb_convert_encoding</a>('&quot;' . <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a> . '&quot;',
<a name="l489"><span class="linenum"> 489</span></a>                                                               'UCS-2LE', 'UTF-8');
<a name="l490"><span class="linenum"> 490</span></a>                  if(!ldap_modify(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it27828" onMouseOver="hilite(27828)" onMouseOut="lolite()" onClick="logVariable('userdn')" href="../../_variables/userdn.html">$userdn</a>, <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>)) {
<a name="l491"><span class="linenum"> 491</span></a>  <span class="comment">                    // Something went wrong: delete the user account and error out</span>
<a name="l492"><span class="linenum"> 492</span></a>                      <a class="phpfunction" onClick="logFunction('ldap_delete')" href="../../_functions/ldap_delete.html" onMouseOver="phpfuncPopup(event,'ldap_delete')">ldap_delete</a> (<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it27828" onMouseOver="hilite(27828)" onMouseOut="lolite()" onClick="logVariable('userdn')" href="../../_variables/userdn.html">$userdn</a>);
<a name="l493"><span class="linenum"> 493</span></a>                      <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldap_ad_create_req', 'auth_ldap');
<a name="l494"><span class="linenum"> 494</span></a>                  }
<a name="l495"><span class="linenum"> 495</span></a>                  <a class="var it37725" onMouseOver="hilite(37725)" onMouseOut="lolite()" onClick="logVariable('uadd')" href="../../_variables/uadd.html">$uadd</a> = true;
<a name="l496"><span class="linenum"> 496</span></a>                  break;
<a name="l497"><span class="linenum"> 497</span></a>              default:
<a name="l498"><span class="linenum"> 498</span></a>                 <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldap_unsupportedusertype', 'auth_ldap', '', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type_name);
<a name="l499"><span class="linenum"> 499</span></a>          }
<a name="l500"><span class="linenum"> 500</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l501"><span class="linenum"> 501</span></a>          return <a class="var it37725" onMouseOver="hilite(37725)" onMouseOut="lolite()" onClick="logVariable('uadd')" href="../../_variables/uadd.html">$uadd</a>;
<a name="l502"><span class="linenum"> 502</span></a>      }
<a name="l503"><span class="linenum"> 503</span></a>  
<a name="l504"><span class="linenum"> 504</span></a>      <span class="comment">/**</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment">     * Returns true if plugin allows resetting of password from moodle.</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment">     *</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment">     * @return bool</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment">     */</span>
<a name="l509"><span class="linenum"> 509</span></a>      function <a class="function" onClick="logFunction('can_reset_password')" href="../../_functions/can_reset_password.html" onMouseOver="funcPopup(event,'can_reset_password')">can_reset_password</a>() {
<a name="l510"><span class="linenum"> 510</span></a>          return !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;stdchangepassword);
<a name="l511"><span class="linenum"> 511</span></a>      }
<a name="l512"><span class="linenum"> 512</span></a>  
<a name="l513"><span class="linenum"> 513</span></a>      <span class="comment">/**</span>
<a name="l514"><span class="linenum"> 514</span></a>  <span class="comment">     * Returns true if plugin can be manually set.</span>
<a name="l515"><span class="linenum"> 515</span></a>  <span class="comment">     *</span>
<a name="l516"><span class="linenum"> 516</span></a>  <span class="comment">     * @return bool</span>
<a name="l517"><span class="linenum"> 517</span></a>  <span class="comment">     */</span>
<a name="l518"><span class="linenum"> 518</span></a>      function <a class="function" onClick="logFunction('can_be_manually_set')" href="../../_functions/can_be_manually_set.html" onMouseOver="funcPopup(event,'can_be_manually_set')">can_be_manually_set</a>() {
<a name="l519"><span class="linenum"> 519</span></a>          return true;
<a name="l520"><span class="linenum"> 520</span></a>      }
<a name="l521"><span class="linenum"> 521</span></a>  
<a name="l522"><span class="linenum"> 522</span></a>      <span class="comment">/**</span>
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">     * Returns true if plugin allows signup and user creation.</span>
<a name="l524"><span class="linenum"> 524</span></a>  <span class="comment">     *</span>
<a name="l525"><span class="linenum"> 525</span></a>  <span class="comment">     * @return bool</span>
<a name="l526"><span class="linenum"> 526</span></a>  <span class="comment">     */</span>
<a name="l527"><span class="linenum"> 527</span></a>      function <a class="function" onClick="logFunction('can_signup')" href="../../_functions/can_signup.html" onMouseOver="funcPopup(event,'can_signup')">can_signup</a>() {
<a name="l528"><span class="linenum"> 528</span></a>          return (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;auth_user_create) and !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context));
<a name="l529"><span class="linenum"> 529</span></a>      }
<a name="l530"><span class="linenum"> 530</span></a>  
<a name="l531"><span class="linenum"> 531</span></a>      <span class="comment">/**</span>
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment">     * Sign up a new user ready for confirmation.</span>
<a name="l533"><span class="linenum"> 533</span></a>  <span class="comment">     * Password is passed in plaintext.</span>
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment">     *</span>
<a name="l535"><span class="linenum"> 535</span></a>  <span class="comment">     * @param object $user new user object</span>
<a name="l536"><span class="linenum"> 536</span></a>  <span class="comment">     * @param boolean $notify print notice with link and terminate</span>
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment">     */</span>
<a name="l538"><span class="linenum"> 538</span></a>      function <a class="function" onClick="logFunction('user_signup')" href="../../_functions/user_signup.html" onMouseOver="funcPopup(event,'user_signup')">user_signup</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it8635" onMouseOver="hilite(8635)" onMouseOut="lolite()" onClick="logVariable('notify')" href="../../_variables/notify.html">$notify</a>=true) {
<a name="l539"><span class="linenum"> 539</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l540"><span class="linenum"> 540</span></a>  
<a name="l541"><span class="linenum"> 541</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../user/profile/lib.php.html">/user/profile/lib.php</a>');
<a name="l542"><span class="linenum"> 542</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../user/lib.php.html">/user/lib.php</a>');
<a name="l543"><span class="linenum"> 543</span></a>  
<a name="l544"><span class="linenum"> 544</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('user_exists')" href="../../_functions/user_exists.html" onMouseOver="funcPopup(event,'user_exists')">user_exists</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>)) {
<a name="l545"><span class="linenum"> 545</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldap_user_exists', 'auth_ldap');
<a name="l546"><span class="linenum"> 546</span></a>          }
<a name="l547"><span class="linenum"> 547</span></a>  
<a name="l548"><span class="linenum"> 548</span></a>          <a class="var it37726" onMouseOver="hilite(37726)" onMouseOut="lolite()" onClick="logVariable('plainslashedpassword')" href="../../_variables/plainslashedpassword.html">$plainslashedpassword</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/password.html">password</a>;
<a name="l549"><span class="linenum"> 549</span></a>          unset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('password')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/password.html">password</a>);
<a name="l550"><span class="linenum"> 550</span></a>  
<a name="l551"><span class="linenum"> 551</span></a>          if (! <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('user_create')" href="../../_functions/user_create.html" onMouseOver="funcPopup(event,'user_create')">user_create</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it37726" onMouseOver="hilite(37726)" onMouseOut="lolite()" onClick="logVariable('plainslashedpassword')" href="../../_variables/plainslashedpassword.html">$plainslashedpassword</a>)) {
<a name="l552"><span class="linenum"> 552</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldap_create_error', 'auth_ldap');
<a name="l553"><span class="linenum"> 553</span></a>          }
<a name="l554"><span class="linenum"> 554</span></a>  
<a name="l555"><span class="linenum"> 555</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="function" onClick="logFunction('user_create_user')" href="../../_functions/user_create_user.html" onMouseOver="funcPopup(event,'user_create_user')">user_create_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, false, false);
<a name="l556"><span class="linenum"> 556</span></a>  
<a name="l557"><span class="linenum"> 557</span></a>          <a class="function" onClick="logFunction('user_add_password_history')" href="../../_functions/user_add_password_history.html" onMouseOver="funcPopup(event,'user_add_password_history')">user_add_password_history</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it37726" onMouseOver="hilite(37726)" onMouseOut="lolite()" onClick="logVariable('plainslashedpassword')" href="../../_variables/plainslashedpassword.html">$plainslashedpassword</a>);
<a name="l558"><span class="linenum"> 558</span></a>  
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">        // Save any custom profile field information</span>
<a name="l560"><span class="linenum"> 560</span></a>          <a class="function" onClick="logFunction('profile_save_data')" href="../../_functions/profile_save_data.html" onMouseOver="funcPopup(event,'profile_save_data')">profile_save_data</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l561"><span class="linenum"> 561</span></a>  
<a name="l562"><span class="linenum"> 562</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_user_record')" href="../../_functions/update_user_record.html" onMouseOver="funcPopup(event,'update_user_record')">update_user_record</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>);
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment">        // This will also update the stored hash to the latest algorithm</span>
<a name="l564"><span class="linenum"> 564</span></a>  <span class="comment">        // if the existing hash is using an out-of-date algorithm (or the</span>
<a name="l565"><span class="linenum"> 565</span></a>  <span class="comment">        // legacy md5 algorithm).</span>
<a name="l566"><span class="linenum"> 566</span></a>          <a class="function" onClick="logFunction('update_internal_user_password')" href="../../_functions/update_internal_user_password.html" onMouseOver="funcPopup(event,'update_internal_user_password')">update_internal_user_password</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it37726" onMouseOver="hilite(37726)" onMouseOut="lolite()" onClick="logVariable('plainslashedpassword')" href="../../_variables/plainslashedpassword.html">$plainslashedpassword</a>);
<a name="l567"><span class="linenum"> 567</span></a>  
<a name="l568"><span class="linenum"> 568</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l569"><span class="linenum"> 569</span></a>  
<a name="l570"><span class="linenum"> 570</span></a>          \core\event\<a class="class" onClick="logClass('user_created')" href="../../_classes/user_created.html" onMouseOver="classPopup(event,'user_created')">user_created</a>::<a class="function" onClick="logFunction('create_from_userid')" href="../../_functions/create_from_userid.html" onMouseOver="funcPopup(event,'create_from_userid')">create_from_userid</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l571"><span class="linenum"> 571</span></a>  
<a name="l572"><span class="linenum"> 572</span></a>          if (! <a class="function" onClick="logFunction('send_confirmation_email')" href="../../_functions/send_confirmation_email.html" onMouseOver="funcPopup(event,'send_confirmation_email')">send_confirmation_email</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l573"><span class="linenum"> 573</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('noemail', 'auth_ldap');
<a name="l574"><span class="linenum"> 574</span></a>          }
<a name="l575"><span class="linenum"> 575</span></a>  
<a name="l576"><span class="linenum"> 576</span></a>          if (<a class="var it8635" onMouseOver="hilite(8635)" onMouseOut="lolite()" onClick="logVariable('notify')" href="../../_variables/notify.html">$notify</a>) {
<a name="l577"><span class="linenum"> 577</span></a>              <a class="var it16901" onMouseOver="hilite(16901)" onMouseOut="lolite()" onClick="logVariable('emailconfirm')" href="../../_variables/emailconfirm.html">$emailconfirm</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('emailconfirm');
<a name="l578"><span class="linenum"> 578</span></a>              <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_url')" href="../../_functions/set_url.html" onMouseOver="funcPopup(event,'set_url')">set_url</a>('<a class="filename" href="../../auth/ldap/auth.php.html">/auth/ldap/auth.php</a>');
<a name="l579"><span class="linenum"> 579</span></a>              <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('navbar')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../../_variables/navbar.html">navbar</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="var it16901" onMouseOver="hilite(16901)" onMouseOut="lolite()" onClick="logVariable('emailconfirm')" href="../../_variables/emailconfirm.html">$emailconfirm</a>);
<a name="l580"><span class="linenum"> 580</span></a>              <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_title')" href="../../_functions/set_title.html" onMouseOver="funcPopup(event,'set_title')">set_title</a>(<a class="var it16901" onMouseOver="hilite(16901)" onMouseOut="lolite()" onClick="logVariable('emailconfirm')" href="../../_variables/emailconfirm.html">$emailconfirm</a>);
<a name="l581"><span class="linenum"> 581</span></a>              <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_heading')" href="../../_functions/set_heading.html" onMouseOver="funcPopup(event,'set_heading')">set_heading</a>(<a class="var it16901" onMouseOver="hilite(16901)" onMouseOut="lolite()" onClick="logVariable('emailconfirm')" href="../../_variables/emailconfirm.html">$emailconfirm</a>);
<a name="l582"><span class="linenum"> 582</span></a>              echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="phpfunction" onClick="logFunction('header')" href="../../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>();
<a name="l583"><span class="linenum"> 583</span></a>              <a class="function" onClick="logFunction('notice')" href="../../_functions/notice.html" onMouseOver="funcPopup(event,'notice')">notice</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('emailconfirmsent', '', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/email.html">email</a>), &quot;{<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>}/index.php&quot;);
<a name="l584"><span class="linenum"> 584</span></a>          } else {
<a name="l585"><span class="linenum"> 585</span></a>              return true;
<a name="l586"><span class="linenum"> 586</span></a>          }
<a name="l587"><span class="linenum"> 587</span></a>      }
<a name="l588"><span class="linenum"> 588</span></a>  
<a name="l589"><span class="linenum"> 589</span></a>      <span class="comment">/**</span>
<a name="l590"><span class="linenum"> 590</span></a>  <span class="comment">     * Returns true if plugin allows confirming of new users.</span>
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment">     *</span>
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">     * @return bool</span>
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment">     */</span>
<a name="l594"><span class="linenum"> 594</span></a>      function <a class="function" onClick="logFunction('can_confirm')" href="../../_functions/can_confirm.html" onMouseOver="funcPopup(event,'can_confirm')">can_confirm</a>() {
<a name="l595"><span class="linenum"> 595</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('can_signup')" href="../../_functions/can_signup.html" onMouseOver="funcPopup(event,'can_signup')">can_signup</a>();
<a name="l596"><span class="linenum"> 596</span></a>      }
<a name="l597"><span class="linenum"> 597</span></a>  
<a name="l598"><span class="linenum"> 598</span></a>      <span class="comment">/**</span>
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment">     * Confirm the new user as registered.</span>
<a name="l600"><span class="linenum"> 600</span></a>  <span class="comment">     *</span>
<a name="l601"><span class="linenum"> 601</span></a>  <span class="comment">     * @param string $username</span>
<a name="l602"><span class="linenum"> 602</span></a>  <span class="comment">     * @param string $confirmsecret</span>
<a name="l603"><span class="linenum"> 603</span></a>  <span class="comment">     */</span>
<a name="l604"><span class="linenum"> 604</span></a>      function <a class="function" onClick="logFunction('user_confirm')" href="../../_functions/user_confirm.html" onMouseOver="funcPopup(event,'user_confirm')">user_confirm</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, <a class="var it8636" onMouseOver="hilite(8636)" onMouseOut="lolite()" onClick="logVariable('confirmsecret')" href="../../_variables/confirmsecret.html">$confirmsecret</a>) {
<a name="l605"><span class="linenum"> 605</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l606"><span class="linenum"> 606</span></a>  
<a name="l607"><span class="linenum"> 607</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="function" onClick="logFunction('get_complete_user_data')" href="../../_functions/get_complete_user_data.html" onMouseOver="funcPopup(event,'get_complete_user_data')">get_complete_user_data</a>('username', <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>);
<a name="l608"><span class="linenum"> 608</span></a>  
<a name="l609"><span class="linenum"> 609</span></a>          if (!empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l610"><span class="linenum"> 610</span></a>              if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a> != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a>) {
<a name="l611"><span class="linenum"> 611</span></a>                  return <a class="constant" onClick="logConstant('AUTH_CONFIRM_ERROR')" href="../../_constants/AUTH_CONFIRM_ERROR.html" onMouseOver="constPopup(event,'AUTH_CONFIRM_ERROR')">AUTH_CONFIRM_ERROR</a>;
<a name="l612"><span class="linenum"> 612</span></a>  
<a name="l613"><span class="linenum"> 613</span></a>              } else if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('secret')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/secret.html">secret</a> == <a class="var it8636" onMouseOver="hilite(8636)" onMouseOut="lolite()" onClick="logVariable('confirmsecret')" href="../../_variables/confirmsecret.html">$confirmsecret</a> &amp;&amp; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('confirmed')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/confirmed.html">confirmed</a>) {
<a name="l614"><span class="linenum"> 614</span></a>                  return <a class="constant" onClick="logConstant('AUTH_CONFIRM_ALREADY')" href="../../_constants/AUTH_CONFIRM_ALREADY.html" onMouseOver="constPopup(event,'AUTH_CONFIRM_ALREADY')">AUTH_CONFIRM_ALREADY</a>;
<a name="l615"><span class="linenum"> 615</span></a>  
<a name="l616"><span class="linenum"> 616</span></a>              } else if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('secret')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/secret.html">secret</a> == <a class="var it8636" onMouseOver="hilite(8636)" onMouseOut="lolite()" onClick="logVariable('confirmsecret')" href="../../_variables/confirmsecret.html">$confirmsecret</a>) {   // They have provided the secret key to get in
<a name="l617"><span class="linenum"> 617</span></a>                  if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('user_activate')" href="../../_functions/user_activate.html" onMouseOver="funcPopup(event,'user_activate')">user_activate</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>)) {
<a name="l618"><span class="linenum"> 618</span></a>                      return <a class="constant" onClick="logConstant('AUTH_CONFIRM_FAIL')" href="../../_constants/AUTH_CONFIRM_FAIL.html" onMouseOver="constPopup(event,'AUTH_CONFIRM_FAIL')">AUTH_CONFIRM_FAIL</a>;
<a name="l619"><span class="linenum"> 619</span></a>                  }
<a name="l620"><span class="linenum"> 620</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('confirmed')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/confirmed.html">confirmed</a> = 1;
<a name="l621"><span class="linenum"> 621</span></a>                  <a class="function" onClick="logFunction('user_update_user')" href="../../_functions/user_update_user.html" onMouseOver="funcPopup(event,'user_update_user')">user_update_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, false);
<a name="l622"><span class="linenum"> 622</span></a>                  return <a class="constant" onClick="logConstant('AUTH_CONFIRM_OK')" href="../../_constants/AUTH_CONFIRM_OK.html" onMouseOver="constPopup(event,'AUTH_CONFIRM_OK')">AUTH_CONFIRM_OK</a>;
<a name="l623"><span class="linenum"> 623</span></a>              }
<a name="l624"><span class="linenum"> 624</span></a>          } else {
<a name="l625"><span class="linenum"> 625</span></a>              return <a class="constant" onClick="logConstant('AUTH_CONFIRM_ERROR')" href="../../_constants/AUTH_CONFIRM_ERROR.html" onMouseOver="constPopup(event,'AUTH_CONFIRM_ERROR')">AUTH_CONFIRM_ERROR</a>;
<a name="l626"><span class="linenum"> 626</span></a>          }
<a name="l627"><span class="linenum"> 627</span></a>      }
<a name="l628"><span class="linenum"> 628</span></a>  
<a name="l629"><span class="linenum"> 629</span></a>      <span class="comment">/**</span>
<a name="l630"><span class="linenum"> 630</span></a>  <span class="comment">     * Return number of days to user password expires</span>
<a name="l631"><span class="linenum"> 631</span></a>  <span class="comment">     *</span>
<a name="l632"><span class="linenum"> 632</span></a>  <span class="comment">     * If userpassword does not expire it should return 0. If password is already expired</span>
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment">     * it should return negative value.</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment">     *</span>
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment">     * @param mixed $username username</span>
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">     * @return integer</span>
<a name="l637"><span class="linenum"> 637</span></a>  <span class="comment">     */</span>
<a name="l638"><span class="linenum"> 638</span></a>      function <a class="function" onClick="logFunction('password_expire')" href="../../_functions/password_expire.html" onMouseOver="funcPopup(event,'password_expire')">password_expire</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>) {
<a name="l639"><span class="linenum"> 639</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = 0;
<a name="l640"><span class="linenum"> 640</span></a>  
<a name="l641"><span class="linenum"> 641</span></a>          <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l642"><span class="linenum"> 642</span></a>  
<a name="l643"><span class="linenum"> 643</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l644"><span class="linenum"> 644</span></a>          <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>);
<a name="l645"><span class="linenum"> 645</span></a>          <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a> = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;expireattr);
<a name="l646"><span class="linenum"> 646</span></a>          <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a> = <a class="phpfunction" onClick="logFunction('ldap_read')" href="../../_functions/ldap_read.html" onMouseOver="phpfuncPopup(event,'ldap_read')">ldap_read</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, '(objectClass=*)', <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a>);
<a name="l647"><span class="linenum"> 647</span></a>          if (<a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>)  {
<a name="l648"><span class="linenum"> 648</span></a>              <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = <a class="function" onClick="logFunction('ldap_get_entries_moodle')" href="../../_functions/ldap_get_entries_moodle.html" onMouseOver="funcPopup(event,'ldap_get_entries_moodle')">ldap_get_entries_moodle</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>);
<a name="l649"><span class="linenum"> 649</span></a>              if (!empty (<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>)) {
<a name="l650"><span class="linenum"> 650</span></a>                  <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>(<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[0], CASE_LOWER);
<a name="l651"><span class="linenum"> 651</span></a>                  if (isset(<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;expireattr][0])) {
<a name="l652"><span class="linenum"> 652</span></a>                      <a class="var it20282" onMouseOver="hilite(20282)" onMouseOut="lolite()" onClick="logVariable('expiretime')" href="../../_variables/expiretime.html">$expiretime</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_expirationtime2unix')" href="../../_functions/ldap_expirationtime2unix.html" onMouseOver="funcPopup(event,'ldap_expirationtime2unix')">ldap_expirationtime2unix</a>(<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;expireattr][0], <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>);
<a name="l653"><span class="linenum"> 653</span></a>                      if (<a class="var it20282" onMouseOver="hilite(20282)" onMouseOut="lolite()" onClick="logVariable('expiretime')" href="../../_variables/expiretime.html">$expiretime</a> != 0) {
<a name="l654"><span class="linenum"> 654</span></a>                          <a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l655"><span class="linenum"> 655</span></a>                          if (<a class="var it20282" onMouseOver="hilite(20282)" onMouseOut="lolite()" onClick="logVariable('expiretime')" href="../../_variables/expiretime.html">$expiretime</a> &gt; <a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>) {
<a name="l656"><span class="linenum"> 656</span></a>                              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="phpfunction" onClick="logFunction('ceil')" href="../../_functions/ceil.html" onMouseOver="phpfuncPopup(event,'ceil')">ceil</a>((<a class="var it20282" onMouseOver="hilite(20282)" onMouseOut="lolite()" onClick="logVariable('expiretime')" href="../../_variables/expiretime.html">$expiretime</a> - <a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>) / <a class="constant" onClick="logConstant('DAYSECS')" href="../../_constants/DAYSECS.html" onMouseOver="constPopup(event,'DAYSECS')">DAYSECS</a>);
<a name="l657"><span class="linenum"> 657</span></a>                          } else {
<a name="l658"><span class="linenum"> 658</span></a>                              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="phpfunction" onClick="logFunction('floor')" href="../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>((<a class="var it20282" onMouseOver="hilite(20282)" onMouseOut="lolite()" onClick="logVariable('expiretime')" href="../../_variables/expiretime.html">$expiretime</a> - <a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>) / <a class="constant" onClick="logConstant('DAYSECS')" href="../../_constants/DAYSECS.html" onMouseOver="constPopup(event,'DAYSECS')">DAYSECS</a>);
<a name="l659"><span class="linenum"> 659</span></a>                          }
<a name="l660"><span class="linenum"> 660</span></a>                      }
<a name="l661"><span class="linenum"> 661</span></a>                  }
<a name="l662"><span class="linenum"> 662</span></a>              }
<a name="l663"><span class="linenum"> 663</span></a>          } else {
<a name="l664"><span class="linenum"> 664</span></a>              <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('didtfindexpiretime', 'auth_ldap'));
<a name="l665"><span class="linenum"> 665</span></a>          }
<a name="l666"><span class="linenum"> 666</span></a>  
<a name="l667"><span class="linenum"> 667</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l668"><span class="linenum"> 668</span></a>      }
<a name="l669"><span class="linenum"> 669</span></a>  
<a name="l670"><span class="linenum"> 670</span></a>      <span class="comment">/**</span>
<a name="l671"><span class="linenum"> 671</span></a>  <span class="comment">     * Syncronizes user fron external LDAP server to moodle user table</span>
<a name="l672"><span class="linenum"> 672</span></a>  <span class="comment">     *</span>
<a name="l673"><span class="linenum"> 673</span></a>  <span class="comment">     * Sync is now using username attribute.</span>
<a name="l674"><span class="linenum"> 674</span></a>  <span class="comment">     *</span>
<a name="l675"><span class="linenum"> 675</span></a>  <span class="comment">     * Syncing users removes or suspends users that dont exists anymore in external LDAP.</span>
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment">     * Creates new users and updates coursecreator status of users.</span>
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment">     *</span>
<a name="l678"><span class="linenum"> 678</span></a>  <span class="comment">     * @param bool $do_updates will do pull in data updates from LDAP if relevant</span>
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment">     */</span>
<a name="l680"><span class="linenum"> 680</span></a>      function <a class="function" onClick="logFunction('sync_users')" href="../../_functions/sync_users.html" onMouseOver="funcPopup(event,'sync_users')">sync_users</a>(<a class="var it10988" onMouseOver="hilite(10988)" onMouseOut="lolite()" onClick="logVariable('do_updates')" href="../../_variables/do_updates.html">$do_updates</a>=true) {
<a name="l681"><span class="linenum"> 681</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l682"><span class="linenum"> 682</span></a>  
<a name="l683"><span class="linenum"> 683</span></a>          <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('connectingldap', 'auth_ldap');
<a name="l684"><span class="linenum"> 684</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l685"><span class="linenum"> 685</span></a>  
<a name="l686"><span class="linenum"> 686</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_manager')" href="../../_functions/get_manager.html" onMouseOver="funcPopup(event,'get_manager')">get_manager</a>();
<a name="l687"><span class="linenum"> 687</span></a>  
<a name="l688"><span class="linenum"> 688</span></a>  <span class="comment">    /// Define table user to be created</span>
<a name="l689"><span class="linenum"> 689</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('tmp_extuser');
<a name="l690"><span class="linenum"> 690</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', <a class="constant" onClick="logConstant('XMLDB_UNSIGNED')" href="../../_constants/XMLDB_UNSIGNED.html" onMouseOver="constPopup(event,'XMLDB_UNSIGNED')">XMLDB_UNSIGNED</a>, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l691"><span class="linenum"> 691</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('username', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l692"><span class="linenum"> 692</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('mnethostid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', <a class="constant" onClick="logConstant('XMLDB_UNSIGNED')" href="../../_constants/XMLDB_UNSIGNED.html" onMouseOver="constPopup(event,'XMLDB_UNSIGNED')">XMLDB_UNSIGNED</a>, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l693"><span class="linenum"> 693</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l694"><span class="linenum"> 694</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('username', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('mnethostid', 'username'));
<a name="l695"><span class="linenum"> 695</span></a>  
<a name="l696"><span class="linenum"> 696</span></a>          <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('creatingtemptable', 'auth_ldap', 'tmp_extuser');
<a name="l697"><span class="linenum"> 697</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_temp_table')" href="../../_functions/create_temp_table.html" onMouseOver="funcPopup(event,'create_temp_table')">create_temp_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l698"><span class="linenum"> 698</span></a>  
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment">        ////</span>
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment">        //// get user's list from ldap to sql in a scalable fashion</span>
<a name="l701"><span class="linenum"> 701</span></a>  <span class="comment">        ////</span>
<a name="l702"><span class="linenum"> 702</span></a>  <span class="comment">        // prepare some data we'll need</span>
<a name="l703"><span class="linenum"> 703</span></a>          <a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a> = '(&amp;('.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute.'=*)'.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass.')';
<a name="l704"><span class="linenum"> 704</span></a>  
<a name="l705"><span class="linenum"> 705</span></a>          <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(';', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;contexts);
<a name="l706"><span class="linenum"> 706</span></a>  
<a name="l707"><span class="linenum"> 707</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context)) {
<a name="l708"><span class="linenum"> 708</span></a>              <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context);
<a name="l709"><span class="linenum"> 709</span></a>          }
<a name="l710"><span class="linenum"> 710</span></a>  
<a name="l711"><span class="linenum"> 711</span></a>          <a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a> = <a class="function" onClick="logFunction('ldap_paged_results_supported')" href="../../_functions/ldap_paged_results_supported.html" onMouseOver="funcPopup(event,'ldap_paged_results_supported')">ldap_paged_results_supported</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldap_version);
<a name="l712"><span class="linenum"> 712</span></a>          <a class="var it19543" onMouseOver="hilite(19543)" onMouseOut="lolite()" onClick="logVariable('ldap_cookie')" href="../../_variables/ldap_cookie.html">$ldap_cookie</a> = '';
<a name="l713"><span class="linenum"> 713</span></a>          foreach (<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> as <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l714"><span class="linenum"> 714</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l715"><span class="linenum"> 715</span></a>              if (empty(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l716"><span class="linenum"> 716</span></a>                  continue;
<a name="l717"><span class="linenum"> 717</span></a>              }
<a name="l718"><span class="linenum"> 718</span></a>  
<a name="l719"><span class="linenum"> 719</span></a>              do {
<a name="l720"><span class="linenum"> 720</span></a>                  if (<a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a>) {
<a name="l721"><span class="linenum"> 721</span></a>                      ldap_control_paged_result(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;pagesize, true, <a class="var it19543" onMouseOver="hilite(19543)" onMouseOut="lolite()" onClick="logVariable('ldap_cookie')" href="../../_variables/ldap_cookie.html">$ldap_cookie</a>);
<a name="l722"><span class="linenum"> 722</span></a>                  }
<a name="l723"><span class="linenum"> 723</span></a>                  if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;search_sub) {
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment">                    // Use ldap_search to find first user from subtree.</span>
<a name="l725"><span class="linenum"> 725</span></a>                      <a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a> = <a class="phpfunction" onClick="logFunction('ldap_search')" href="../../_functions/ldap_search.html" onMouseOver="phpfuncPopup(event,'ldap_search')">ldap_search</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute));
<a name="l726"><span class="linenum"> 726</span></a>                  } else {
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment">                    // Search only in this context.</span>
<a name="l728"><span class="linenum"> 728</span></a>                      <a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a> = <a class="phpfunction" onClick="logFunction('ldap_list')" href="../../_functions/ldap_list.html" onMouseOver="phpfuncPopup(event,'ldap_list')">ldap_list</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute));
<a name="l729"><span class="linenum"> 729</span></a>                  }
<a name="l730"><span class="linenum"> 730</span></a>                  if(!<a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a>) {
<a name="l731"><span class="linenum"> 731</span></a>                      continue;
<a name="l732"><span class="linenum"> 732</span></a>                  }
<a name="l733"><span class="linenum"> 733</span></a>                  if (<a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a>) {
<a name="l734"><span class="linenum"> 734</span></a>                      ldap_control_paged_result_response(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a>, <a class="var it19543" onMouseOver="hilite(19543)" onMouseOut="lolite()" onClick="logVariable('ldap_cookie')" href="../../_variables/ldap_cookie.html">$ldap_cookie</a>);
<a name="l735"><span class="linenum"> 735</span></a>                  }
<a name="l736"><span class="linenum"> 736</span></a>                  if (<a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a> = @<a class="phpfunction" onClick="logFunction('ldap_first_entry')" href="../../_functions/ldap_first_entry.html" onMouseOver="phpfuncPopup(event,'ldap_first_entry')">ldap_first_entry</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a>)) {
<a name="l737"><span class="linenum"> 737</span></a>                      do {
<a name="l738"><span class="linenum"> 738</span></a>                          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="phpfunction" onClick="logFunction('ldap_get_values_len')" href="../../_functions/ldap_get_values_len.html" onMouseOver="phpfuncPopup(event,'ldap_get_values_len')">ldap_get_values_len</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute);
<a name="l739"><span class="linenum"> 739</span></a>                          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>[0], <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding, 'utf-8');
<a name="l740"><span class="linenum"> 740</span></a>                          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>);
<a name="l741"><span class="linenum"> 741</span></a>                          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_bulk_insert')" href="../../_functions/ldap_bulk_insert.html" onMouseOver="funcPopup(event,'ldap_bulk_insert')">ldap_bulk_insert</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>);
<a name="l742"><span class="linenum"> 742</span></a>                      } while (<a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a> = <a class="phpfunction" onClick="logFunction('ldap_next_entry')" href="../../_functions/ldap_next_entry.html" onMouseOver="phpfuncPopup(event,'ldap_next_entry')">ldap_next_entry</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>));
<a name="l743"><span class="linenum"> 743</span></a>                  }
<a name="l744"><span class="linenum"> 744</span></a>                  unset(<a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a>); <span class="comment">// Free mem.</span>
<a name="l745"><span class="linenum"> 745</span></a>              } while (<a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a> &amp;&amp; <a class="var it19543" onMouseOver="hilite(19543)" onMouseOut="lolite()" onClick="logVariable('ldap_cookie')" href="../../_variables/ldap_cookie.html">$ldap_cookie</a> !== null &amp;&amp; <a class="var it19543" onMouseOver="hilite(19543)" onMouseOut="lolite()" onClick="logVariable('ldap_cookie')" href="../../_variables/ldap_cookie.html">$ldap_cookie</a> != '');
<a name="l746"><span class="linenum"> 746</span></a>          }
<a name="l747"><span class="linenum"> 747</span></a>  
<a name="l748"><span class="linenum"> 748</span></a>  <span class="comment">        // If LDAP paged results were used, the current connection must be completely</span>
<a name="l749"><span class="linenum"> 749</span></a>  <span class="comment">        // closed and a new one created, to work without paged results from here on.</span>
<a name="l750"><span class="linenum"> 750</span></a>          if (<a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a>) {
<a name="l751"><span class="linenum"> 751</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>(true);
<a name="l752"><span class="linenum"> 752</span></a>              <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l753"><span class="linenum"> 753</span></a>          }
<a name="l754"><span class="linenum"> 754</span></a>  
<a name="l755"><span class="linenum"> 755</span></a>  <span class="comment">        /// preserve our user database</span>
<a name="l756"><span class="linenum"> 756</span></a>  <span class="comment">        /// if the temp table is empty, it probably means that something went wrong, exit</span>
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment">        /// so as to avoid mass deletion of users; which is hard to undo</span>
<a name="l758"><span class="linenum"> 758</span></a>          <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>('SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(username) AS count, 1 FROM {tmp_extuser}');
<a name="l759"><span class="linenum"> 759</span></a>          if (<a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> &lt; 1) {
<a name="l760"><span class="linenum"> 760</span></a>              <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('didntgetusersfromldap', 'auth_ldap');
<a name="l761"><span class="linenum"> 761</span></a>              exit;
<a name="l762"><span class="linenum"> 762</span></a>          } else {
<a name="l763"><span class="linenum"> 763</span></a>              <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('gotcountrecordsfromldap', 'auth_ldap', <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>);
<a name="l764"><span class="linenum"> 764</span></a>          }
<a name="l765"><span class="linenum"> 765</span></a>  
<a name="l766"><span class="linenum"> 766</span></a>  
<a name="l767"><span class="linenum"> 767</span></a>  <span class="comment">/// User removal</span>
<a name="l768"><span class="linenum"> 768</span></a>  <span class="comment">        // Find users in DB that aren't in ldap -- to be removed!</span>
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment">        // this is still not as scalable (but how often do we mass delete?)</span>
<a name="l770"><span class="linenum"> 770</span></a>  
<a name="l771"><span class="linenum"> 771</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;removeuser == <a class="constant" onClick="logConstant('AUTH_REMOVEUSER_FULLDELETE')" href="../../_constants/AUTH_REMOVEUSER_FULLDELETE.html" onMouseOver="constPopup(event,'AUTH_REMOVEUSER_FULLDELETE')">AUTH_REMOVEUSER_FULLDELETE</a>) {
<a name="l772"><span class="linenum"> 772</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT u.*
<a name="l773"><span class="linenum"> 773</span></a>                        FROM {user} u
<a name="l774"><span class="linenum"> 774</span></a>                   LEFT JOIN {tmp_extuser} e <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (u.username = e.username AND u.mnethostid = e.mnethostid)
<a name="l775"><span class="linenum"> 775</span></a>                       WHERE u.auth = :auth
<a name="l776"><span class="linenum"> 776</span></a>                             AND u.deleted = 0
<a name="l777"><span class="linenum"> 777</span></a>                             AND e.username IS NULL&quot;;
<a name="l778"><span class="linenum"> 778</span></a>              <a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('auth'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a>));
<a name="l779"><span class="linenum"> 779</span></a>  
<a name="l780"><span class="linenum"> 780</span></a>              if (!empty(<a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a>)) {
<a name="l781"><span class="linenum"> 781</span></a>                  <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('userentriestoremove', 'auth_ldap', <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a>));
<a name="l782"><span class="linenum"> 782</span></a>                  foreach (<a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a> as <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l783"><span class="linenum"> 783</span></a>                      if (<a class="function" onClick="logFunction('delete_user')" href="../../_functions/delete_user.html" onMouseOver="funcPopup(event,'delete_user')">delete_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l784"><span class="linenum"> 784</span></a>                          echo &quot;\t&quot;; <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('auth_dbdeleteuser', 'auth_db', array('name'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, 'id'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)); echo &quot;\n&quot;;
<a name="l785"><span class="linenum"> 785</span></a>                      } else {
<a name="l786"><span class="linenum"> 786</span></a>                          echo &quot;\t&quot;; <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('auth_dbdeleteusererror', 'auth_db', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>); echo &quot;\n&quot;;
<a name="l787"><span class="linenum"> 787</span></a>                      }
<a name="l788"><span class="linenum"> 788</span></a>                  }
<a name="l789"><span class="linenum"> 789</span></a>              } else {
<a name="l790"><span class="linenum"> 790</span></a>                  <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('nouserentriestoremove', 'auth_ldap');
<a name="l791"><span class="linenum"> 791</span></a>              }
<a name="l792"><span class="linenum"> 792</span></a>              unset(<a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a>); <span class="comment">// Free mem!</span>
<a name="l793"><span class="linenum"> 793</span></a>  
<a name="l794"><span class="linenum"> 794</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;removeuser == <a class="constant" onClick="logConstant('AUTH_REMOVEUSER_SUSPEND')" href="../../_constants/AUTH_REMOVEUSER_SUSPEND.html" onMouseOver="constPopup(event,'AUTH_REMOVEUSER_SUSPEND')">AUTH_REMOVEUSER_SUSPEND</a>) {
<a name="l795"><span class="linenum"> 795</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT u.*
<a name="l796"><span class="linenum"> 796</span></a>                        FROM {user} u
<a name="l797"><span class="linenum"> 797</span></a>                   LEFT JOIN {tmp_extuser} e <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (u.username = e.username AND u.mnethostid = e.mnethostid)
<a name="l798"><span class="linenum"> 798</span></a>                       WHERE u.auth = :auth
<a name="l799"><span class="linenum"> 799</span></a>                             AND u.deleted = 0
<a name="l800"><span class="linenum"> 800</span></a>                             AND u.suspended = 0
<a name="l801"><span class="linenum"> 801</span></a>                             AND e.username IS NULL&quot;;
<a name="l802"><span class="linenum"> 802</span></a>              <a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('auth'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a>));
<a name="l803"><span class="linenum"> 803</span></a>  
<a name="l804"><span class="linenum"> 804</span></a>              if (!empty(<a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a>)) {
<a name="l805"><span class="linenum"> 805</span></a>                  <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('userentriestoremove', 'auth_ldap', <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a>));
<a name="l806"><span class="linenum"> 806</span></a>  
<a name="l807"><span class="linenum"> 807</span></a>                  foreach (<a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a> as <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l808"><span class="linenum"> 808</span></a>                      <a class="var it10992" onMouseOver="hilite(10992)" onMouseOut="lolite()" onClick="logVariable('updateuser')" href="../../_variables/updateuser.html">$updateuser</a> = new stdClass();
<a name="l809"><span class="linenum"> 809</span></a>                      <a class="var it10992" onMouseOver="hilite(10992)" onMouseOut="lolite()" onClick="logVariable('updateuser')" href="../../_variables/updateuser.html">$updateuser</a>-&gt;<a onClick="logVariable('id')" class="var it41071" onMouseOver="hilite(41071)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l810"><span class="linenum"> 810</span></a>                      <a class="var it10992" onMouseOver="hilite(10992)" onMouseOut="lolite()" onClick="logVariable('updateuser')" href="../../_variables/updateuser.html">$updateuser</a>-&gt;<a onClick="logVariable('suspended')" class="var it41071" onMouseOver="hilite(41071)" onMouseOut="lolite()" href="../../_variables/suspended.html">suspended</a> = 1;
<a name="l811"><span class="linenum"> 811</span></a>                      <a class="function" onClick="logFunction('user_update_user')" href="../../_functions/user_update_user.html" onMouseOver="funcPopup(event,'user_update_user')">user_update_user</a>(<a class="var it10992" onMouseOver="hilite(10992)" onMouseOut="lolite()" onClick="logVariable('updateuser')" href="../../_variables/updateuser.html">$updateuser</a>, false);
<a name="l812"><span class="linenum"> 812</span></a>                      echo &quot;\t&quot;; <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('auth_dbsuspenduser', 'auth_db', array('name'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, 'id'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)); echo &quot;\n&quot;;
<a name="l813"><span class="linenum"> 813</span></a>                      \core\session\<a class="class" onClick="logClass('manager')" href="../../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('kill_user_sessions')" href="../../_functions/kill_user_sessions.html" onMouseOver="funcPopup(event,'kill_user_sessions')">kill_user_sessions</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l814"><span class="linenum"> 814</span></a>                  }
<a name="l815"><span class="linenum"> 815</span></a>              } else {
<a name="l816"><span class="linenum"> 816</span></a>                  <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('nouserentriestoremove', 'auth_ldap');
<a name="l817"><span class="linenum"> 817</span></a>              }
<a name="l818"><span class="linenum"> 818</span></a>              unset(<a class="var it10991" onMouseOver="hilite(10991)" onMouseOut="lolite()" onClick="logVariable('remove_users')" href="../../_variables/remove_users.html">$remove_users</a>); <span class="comment">// Free mem!</span>
<a name="l819"><span class="linenum"> 819</span></a>          }
<a name="l820"><span class="linenum"> 820</span></a>  
<a name="l821"><span class="linenum"> 821</span></a>  <span class="comment">/// Revive suspended users</span>
<a name="l822"><span class="linenum"> 822</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;removeuser) and <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;removeuser == <a class="constant" onClick="logConstant('AUTH_REMOVEUSER_SUSPEND')" href="../../_constants/AUTH_REMOVEUSER_SUSPEND.html" onMouseOver="constPopup(event,'AUTH_REMOVEUSER_SUSPEND')">AUTH_REMOVEUSER_SUSPEND</a>) {
<a name="l823"><span class="linenum"> 823</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT u.id, u.username
<a name="l824"><span class="linenum"> 824</span></a>                        FROM {user} u
<a name="l825"><span class="linenum"> 825</span></a>                        JOIN {tmp_extuser} e <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (u.username = e.username AND u.mnethostid = e.mnethostid)
<a name="l826"><span class="linenum"> 826</span></a>                       <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (u.auth = 'nologin' <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (u.auth = ? AND u.suspended = 1)) AND u.deleted = 0&quot;;
<a name="l827"><span class="linenum"> 827</span></a>  <span class="comment">            // Note: 'nologin' is there for backwards compatibility.</span>
<a name="l828"><span class="linenum"> 828</span></a>              <a class="var it37727" onMouseOver="hilite(37727)" onMouseOut="lolite()" onClick="logVariable('revive_users')" href="../../_variables/revive_users.html">$revive_users</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a>));
<a name="l829"><span class="linenum"> 829</span></a>  
<a name="l830"><span class="linenum"> 830</span></a>              if (!empty(<a class="var it37727" onMouseOver="hilite(37727)" onMouseOut="lolite()" onClick="logVariable('revive_users')" href="../../_variables/revive_users.html">$revive_users</a>)) {
<a name="l831"><span class="linenum"> 831</span></a>                  <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('userentriestorevive', 'auth_ldap', <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it37727" onMouseOver="hilite(37727)" onMouseOut="lolite()" onClick="logVariable('revive_users')" href="../../_variables/revive_users.html">$revive_users</a>));
<a name="l832"><span class="linenum"> 832</span></a>  
<a name="l833"><span class="linenum"> 833</span></a>                  foreach (<a class="var it37727" onMouseOver="hilite(37727)" onMouseOut="lolite()" onClick="logVariable('revive_users')" href="../../_variables/revive_users.html">$revive_users</a> as <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l834"><span class="linenum"> 834</span></a>                      <a class="var it10992" onMouseOver="hilite(10992)" onMouseOut="lolite()" onClick="logVariable('updateuser')" href="../../_variables/updateuser.html">$updateuser</a> = new stdClass();
<a name="l835"><span class="linenum"> 835</span></a>                      <a class="var it10992" onMouseOver="hilite(10992)" onMouseOut="lolite()" onClick="logVariable('updateuser')" href="../../_variables/updateuser.html">$updateuser</a>-&gt;<a onClick="logVariable('id')" class="var it41071" onMouseOver="hilite(41071)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l836"><span class="linenum"> 836</span></a>                      <a class="var it10992" onMouseOver="hilite(10992)" onMouseOut="lolite()" onClick="logVariable('updateuser')" href="../../_variables/updateuser.html">$updateuser</a>-&gt;<a onClick="logVariable('auth')" class="var it41071" onMouseOver="hilite(41071)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a>;
<a name="l837"><span class="linenum"> 837</span></a>                      <a class="var it10992" onMouseOver="hilite(10992)" onMouseOut="lolite()" onClick="logVariable('updateuser')" href="../../_variables/updateuser.html">$updateuser</a>-&gt;<a onClick="logVariable('suspended')" class="var it41071" onMouseOver="hilite(41071)" onMouseOut="lolite()" href="../../_variables/suspended.html">suspended</a> = 0;
<a name="l838"><span class="linenum"> 838</span></a>                      <a class="function" onClick="logFunction('user_update_user')" href="../../_functions/user_update_user.html" onMouseOver="funcPopup(event,'user_update_user')">user_update_user</a>(<a class="var it10992" onMouseOver="hilite(10992)" onMouseOut="lolite()" onClick="logVariable('updateuser')" href="../../_variables/updateuser.html">$updateuser</a>, false);
<a name="l839"><span class="linenum"> 839</span></a>                      echo &quot;\t&quot;; <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('auth_dbreviveduser', 'auth_db', array('name'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, 'id'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)); echo &quot;\n&quot;;
<a name="l840"><span class="linenum"> 840</span></a>                  }
<a name="l841"><span class="linenum"> 841</span></a>              } else {
<a name="l842"><span class="linenum"> 842</span></a>                  <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('nouserentriestorevive', 'auth_ldap');
<a name="l843"><span class="linenum"> 843</span></a>              }
<a name="l844"><span class="linenum"> 844</span></a>  
<a name="l845"><span class="linenum"> 845</span></a>              unset(<a class="var it37727" onMouseOver="hilite(37727)" onMouseOut="lolite()" onClick="logVariable('revive_users')" href="../../_variables/revive_users.html">$revive_users</a>);
<a name="l846"><span class="linenum"> 846</span></a>          }
<a name="l847"><span class="linenum"> 847</span></a>  
<a name="l848"><span class="linenum"> 848</span></a>  
<a name="l849"><span class="linenum"> 849</span></a>  <span class="comment">/// User Updates - time-consuming (optional)</span>
<a name="l850"><span class="linenum"> 850</span></a>          if (<a class="var it10988" onMouseOver="hilite(10988)" onMouseOut="lolite()" onClick="logVariable('do_updates')" href="../../_variables/do_updates.html">$do_updates</a>) {
<a name="l851"><span class="linenum"> 851</span></a>  <span class="comment">            // Narrow down what fields we need to update</span>
<a name="l852"><span class="linenum"> 852</span></a>              <a class="var it10993" onMouseOver="hilite(10993)" onMouseOut="lolite()" onClick="logVariable('all_keys')" href="../../_variables/all_keys.html">$all_keys</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="phpfunction" onClick="logFunction('get_object_vars')" href="../../_functions/get_object_vars.html" onMouseOver="phpfuncPopup(event,'get_object_vars')">get_object_vars</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>));
<a name="l853"><span class="linenum"> 853</span></a>              <a class="var it10994" onMouseOver="hilite(10994)" onMouseOut="lolite()" onClick="logVariable('updatekeys')" href="../../_variables/updatekeys.html">$updatekeys</a> = array();
<a name="l854"><span class="linenum"> 854</span></a>              foreach (<a class="var it10993" onMouseOver="hilite(10993)" onMouseOut="lolite()" onClick="logVariable('all_keys')" href="../../_variables/all_keys.html">$all_keys</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>) {
<a name="l855"><span class="linenum"> 855</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/^field_updatelocal_(.+)$/', <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>, <a class="var it745" onMouseOver="hilite(745)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../_variables/match.html">$match</a>)) {
<a name="l856"><span class="linenum"> 856</span></a>  <span class="comment">                    // If we have a field to update it from</span>
<a name="l857"><span class="linenum"> 857</span></a>  <span class="comment">                    // and it must be updated 'onlogin' we</span>
<a name="l858"><span class="linenum"> 858</span></a>  <span class="comment">                    // update it on cron</span>
<a name="l859"><span class="linenum"> 859</span></a>                      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{'field_map_'.<a class="var it745" onMouseOver="hilite(745)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../_variables/match.html">$match</a>[1]})
<a name="l860"><span class="linenum"> 860</span></a>                           and <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{<a class="var it745" onMouseOver="hilite(745)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../_variables/match.html">$match</a>[0]} === 'onlogin') {
<a name="l861"><span class="linenum"> 861</span></a>                          <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it10994" onMouseOver="hilite(10994)" onMouseOut="lolite()" onClick="logVariable('updatekeys')" href="../../_variables/updatekeys.html">$updatekeys</a>, <a class="var it745" onMouseOver="hilite(745)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../_variables/match.html">$match</a>[1]); <span class="comment">// the actual key name</span>
<a name="l862"><span class="linenum"> 862</span></a>                      }
<a name="l863"><span class="linenum"> 863</span></a>                  }
<a name="l864"><span class="linenum"> 864</span></a>              }
<a name="l865"><span class="linenum"> 865</span></a>              unset(<a class="var it10993" onMouseOver="hilite(10993)" onMouseOut="lolite()" onClick="logVariable('all_keys')" href="../../_variables/all_keys.html">$all_keys</a>); unset(<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l866"><span class="linenum"> 866</span></a>  
<a name="l867"><span class="linenum"> 867</span></a>          } else {
<a name="l868"><span class="linenum"> 868</span></a>              <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('noupdatestobedone', 'auth_ldap');
<a name="l869"><span class="linenum"> 869</span></a>          }
<a name="l870"><span class="linenum"> 870</span></a>          if (<a class="var it10988" onMouseOver="hilite(10988)" onMouseOut="lolite()" onClick="logVariable('do_updates')" href="../../_variables/do_updates.html">$do_updates</a> and !empty(<a class="var it10994" onMouseOver="hilite(10994)" onMouseOut="lolite()" onClick="logVariable('updatekeys')" href="../../_variables/updatekeys.html">$updatekeys</a>)) { // run updates only if relevant
<a name="l871"><span class="linenum"> 871</span></a>              <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>('SELECT u.username, u.id
<a name="l872"><span class="linenum"> 872</span></a>                                               FROM {user} u
<a name="l873"><span class="linenum"> 873</span></a>                                              WHERE u.deleted = 0 AND u.auth = ? AND u.mnethostid = ?',
<a name="l874"><span class="linenum"> 874</span></a>                                            array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>));
<a name="l875"><span class="linenum"> 875</span></a>              if (!empty(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>)) {
<a name="l876"><span class="linenum"> 876</span></a>                  <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('userentriestoupdate', 'auth_ldap', <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>));
<a name="l877"><span class="linenum"> 877</span></a>  
<a name="l878"><span class="linenum"> 878</span></a>                  <a class="var it5848" onMouseOver="hilite(5848)" onMouseOut="lolite()" onClick="logVariable('sitecontext')" href="../../_variables/sitecontext.html">$sitecontext</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l879"><span class="linenum"> 879</span></a>                  if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;creators) and !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;memberattribute)
<a name="l880"><span class="linenum"> 880</span></a>                    and <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a> = <a class="function" onClick="logFunction('get_archetype_roles')" href="../../_functions/get_archetype_roles.html" onMouseOver="funcPopup(event,'get_archetype_roles')">get_archetype_roles</a>('coursecreator')) {
<a name="l881"><span class="linenum"> 881</span></a>                      <a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a>);      <span class="comment">// We can only use one, let's use the first one</span>
<a name="l882"><span class="linenum"> 882</span></a>                  } else {
<a name="l883"><span class="linenum"> 883</span></a>                      <a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a> = false;
<a name="l884"><span class="linenum"> 884</span></a>                  }
<a name="l885"><span class="linenum"> 885</span></a>  
<a name="l886"><span class="linenum"> 886</span></a>                  <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l887"><span class="linenum"> 887</span></a>                  <a class="var it37728" onMouseOver="hilite(37728)" onMouseOut="lolite()" onClick="logVariable('xcount')" href="../../_variables/xcount.html">$xcount</a> = 0;
<a name="l888"><span class="linenum"> 888</span></a>                  <a class="var it37729" onMouseOver="hilite(37729)" onMouseOut="lolite()" onClick="logVariable('maxxcount')" href="../../_variables/maxxcount.html">$maxxcount</a> = 100;
<a name="l889"><span class="linenum"> 889</span></a>  
<a name="l890"><span class="linenum"> 890</span></a>                  foreach (<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> as <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l891"><span class="linenum"> 891</span></a>                      echo &quot;\t&quot;; <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('auth_dbupdatinguser', 'auth_db', array('name'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, 'id'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l892"><span class="linenum"> 892</span></a>                      if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_user_record')" href="../../_functions/update_user_record.html" onMouseOver="funcPopup(event,'update_user_record')">update_user_record</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, <a class="var it10994" onMouseOver="hilite(10994)" onMouseOut="lolite()" onClick="logVariable('updatekeys')" href="../../_variables/updatekeys.html">$updatekeys</a>)) {
<a name="l893"><span class="linenum"> 893</span></a>                          echo ' - '.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('skipped');
<a name="l894"><span class="linenum"> 894</span></a>                      }
<a name="l895"><span class="linenum"> 895</span></a>                      echo &quot;\n&quot;;
<a name="l896"><span class="linenum"> 896</span></a>                      <a class="var it37728" onMouseOver="hilite(37728)" onMouseOut="lolite()" onClick="logVariable('xcount')" href="../../_variables/xcount.html">$xcount</a>++;
<a name="l897"><span class="linenum"> 897</span></a>  
<a name="l898"><span class="linenum"> 898</span></a>  <span class="comment">                    // Update course creators if needed</span>
<a name="l899"><span class="linenum"> 899</span></a>                      if (<a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a> !== false) {
<a name="l900"><span class="linenum"> 900</span></a>                          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('iscreator')" href="../../_functions/iscreator.html" onMouseOver="funcPopup(event,'iscreator')">iscreator</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>)) {
<a name="l901"><span class="linenum"> 901</span></a>                              <a class="function" onClick="logFunction('role_assign')" href="../../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a>-&gt;<a onClick="logVariable('id')" class="var it40805" onMouseOver="hilite(40805)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it5848" onMouseOver="hilite(5848)" onMouseOut="lolite()" onClick="logVariable('sitecontext')" href="../../_variables/sitecontext.html">$sitecontext</a>-&gt;<a onClick="logVariable('id')" class="var it40279" onMouseOver="hilite(40279)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('roleauth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/roleauth.html">roleauth</a>);
<a name="l902"><span class="linenum"> 902</span></a>                          } else {
<a name="l903"><span class="linenum"> 903</span></a>                              <a class="function" onClick="logFunction('role_unassign')" href="../../_functions/role_unassign.html" onMouseOver="funcPopup(event,'role_unassign')">role_unassign</a>(<a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a>-&gt;<a onClick="logVariable('id')" class="var it40805" onMouseOver="hilite(40805)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it5848" onMouseOver="hilite(5848)" onMouseOut="lolite()" onClick="logVariable('sitecontext')" href="../../_variables/sitecontext.html">$sitecontext</a>-&gt;<a onClick="logVariable('id')" class="var it40279" onMouseOver="hilite(40279)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('roleauth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/roleauth.html">roleauth</a>);
<a name="l904"><span class="linenum"> 904</span></a>                          }
<a name="l905"><span class="linenum"> 905</span></a>                      }
<a name="l906"><span class="linenum"> 906</span></a>                  }
<a name="l907"><span class="linenum"> 907</span></a>                  <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l908"><span class="linenum"> 908</span></a>                  unset(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>); <span class="comment">// free mem</span>
<a name="l909"><span class="linenum"> 909</span></a>              }
<a name="l910"><span class="linenum"> 910</span></a>          } else { // end do updates
<a name="l911"><span class="linenum"> 911</span></a>              <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('noupdatestobedone', 'auth_ldap');
<a name="l912"><span class="linenum"> 912</span></a>          }
<a name="l913"><span class="linenum"> 913</span></a>  
<a name="l914"><span class="linenum"> 914</span></a>  <span class="comment">/// User Additions</span>
<a name="l915"><span class="linenum"> 915</span></a>  <span class="comment">        // Find users missing in DB that are in LDAP</span>
<a name="l916"><span class="linenum"> 916</span></a>  <span class="comment">        // and gives me a nifty object I don't want.</span>
<a name="l917"><span class="linenum"> 917</span></a>  <span class="comment">        // note: we do not care about deleted accounts anymore, this feature was replaced by suspending to nologin auth plugin</span>
<a name="l918"><span class="linenum"> 918</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT e.id, e.username
<a name="l919"><span class="linenum"> 919</span></a>                    FROM {tmp_extuser} e
<a name="l920"><span class="linenum"> 920</span></a>                    LEFT JOIN {user} u <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (e.username = u.username AND e.mnethostid = u.mnethostid)
<a name="l921"><span class="linenum"> 921</span></a>                   WHERE u.id IS NULL';
<a name="l922"><span class="linenum"> 922</span></a>          <a class="var it10997" onMouseOver="hilite(10997)" onMouseOut="lolite()" onClick="logVariable('add_users')" href="../../_variables/add_users.html">$add_users</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l923"><span class="linenum"> 923</span></a>  
<a name="l924"><span class="linenum"> 924</span></a>          if (!empty(<a class="var it10997" onMouseOver="hilite(10997)" onMouseOut="lolite()" onClick="logVariable('add_users')" href="../../_variables/add_users.html">$add_users</a>)) {
<a name="l925"><span class="linenum"> 925</span></a>              <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('userentriestoadd', 'auth_ldap', <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it10997" onMouseOver="hilite(10997)" onMouseOut="lolite()" onClick="logVariable('add_users')" href="../../_variables/add_users.html">$add_users</a>));
<a name="l926"><span class="linenum"> 926</span></a>  
<a name="l927"><span class="linenum"> 927</span></a>              <a class="var it5848" onMouseOver="hilite(5848)" onMouseOut="lolite()" onClick="logVariable('sitecontext')" href="../../_variables/sitecontext.html">$sitecontext</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l928"><span class="linenum"> 928</span></a>              if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;creators) and !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;memberattribute)
<a name="l929"><span class="linenum"> 929</span></a>                and <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a> = <a class="function" onClick="logFunction('get_archetype_roles')" href="../../_functions/get_archetype_roles.html" onMouseOver="funcPopup(event,'get_archetype_roles')">get_archetype_roles</a>('coursecreator')) {
<a name="l930"><span class="linenum"> 930</span></a>                  <a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a>);      <span class="comment">// We can only use one, let's use the first one</span>
<a name="l931"><span class="linenum"> 931</span></a>              } else {
<a name="l932"><span class="linenum"> 932</span></a>                  <a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a> = false;
<a name="l933"><span class="linenum"> 933</span></a>              }
<a name="l934"><span class="linenum"> 934</span></a>  
<a name="l935"><span class="linenum"> 935</span></a>              <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l936"><span class="linenum"> 936</span></a>              foreach (<a class="var it10997" onMouseOver="hilite(10997)" onMouseOut="lolite()" onClick="logVariable('add_users')" href="../../_variables/add_users.html">$add_users</a> as <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l937"><span class="linenum"> 937</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_userinfo_asobj')" href="../../_functions/get_userinfo_asobj.html" onMouseOver="funcPopup(event,'get_userinfo_asobj')">get_userinfo_asobj</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>);
<a name="l938"><span class="linenum"> 938</span></a>  
<a name="l939"><span class="linenum"> 939</span></a>  <span class="comment">                // Prep a few params</span>
<a name="l940"><span class="linenum"> 940</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('modified')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/modified.html">modified</a>   = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l941"><span class="linenum"> 941</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('confirmed')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/confirmed.html">confirmed</a>  = 1;
<a name="l942"><span class="linenum"> 942</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a>       = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a>;
<a name="l943"><span class="linenum"> 943</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/mnethostid.html">mnethostid</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>;
<a name="l944"><span class="linenum"> 944</span></a>  <span class="comment">                // get_userinfo_asobj() might have replaced $user-&gt;username with the value</span>
<a name="l945"><span class="linenum"> 945</span></a>  <span class="comment">                // from the LDAP server (which can be mixed-case). Make sure it's lowercase</span>
<a name="l946"><span class="linenum"> 946</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>));
<a name="l947"><span class="linenum"> 947</span></a>                  if (empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lang')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a>)) {
<a name="l948"><span class="linenum"> 948</span></a>                      <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lang')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('lang')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a>;
<a name="l949"><span class="linenum"> 949</span></a>                  }
<a name="l950"><span class="linenum"> 950</span></a>                  if (empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/calendartype.html">calendartype</a>)) {
<a name="l951"><span class="linenum"> 951</span></a>                      <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/calendartype.html">calendartype</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('calendartype')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/calendartype.html">calendartype</a>;
<a name="l952"><span class="linenum"> 952</span></a>                  }
<a name="l953"><span class="linenum"> 953</span></a>  
<a name="l954"><span class="linenum"> 954</span></a>                  <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> = <a class="function" onClick="logFunction('user_create_user')" href="../../_functions/user_create_user.html" onMouseOver="funcPopup(event,'user_create_user')">user_create_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, false);
<a name="l955"><span class="linenum"> 955</span></a>                  echo &quot;\t&quot;; <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('auth_dbinsertuser', 'auth_db', array('name'=&gt;<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, 'id'=&gt;<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>)); echo &quot;\n&quot;;
<a name="l956"><span class="linenum"> 956</span></a>                  <a class="var it25590" onMouseOver="hilite(25590)" onMouseOut="lolite()" onClick="logVariable('euser')" href="../../_variables/euser.html">$euser</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>));
<a name="l957"><span class="linenum"> 957</span></a>  
<a name="l958"><span class="linenum"> 958</span></a>                  if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;forcechangepassword)) {
<a name="l959"><span class="linenum"> 959</span></a>                      <a class="function" onClick="logFunction('set_user_preference')" href="../../_functions/set_user_preference.html" onMouseOver="funcPopup(event,'set_user_preference')">set_user_preference</a>('auth_forcepasswordchange', 1, <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l960"><span class="linenum"> 960</span></a>                  }
<a name="l961"><span class="linenum"> 961</span></a>  
<a name="l962"><span class="linenum"> 962</span></a>  <span class="comment">                // Add course creators if needed</span>
<a name="l963"><span class="linenum"> 963</span></a>                  if (<a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a> !== false and <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('iscreator')" href="../../_functions/iscreator.html" onMouseOver="funcPopup(event,'iscreator')">iscreator</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>)) {
<a name="l964"><span class="linenum"> 964</span></a>                      <a class="function" onClick="logFunction('role_assign')" href="../../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a>-&gt;<a onClick="logVariable('id')" class="var it40805" onMouseOver="hilite(40805)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>, <a class="var it5848" onMouseOver="hilite(5848)" onMouseOut="lolite()" onClick="logVariable('sitecontext')" href="../../_variables/sitecontext.html">$sitecontext</a>-&gt;<a onClick="logVariable('id')" class="var it40279" onMouseOver="hilite(40279)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('roleauth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/roleauth.html">roleauth</a>);
<a name="l965"><span class="linenum"> 965</span></a>                  }
<a name="l966"><span class="linenum"> 966</span></a>  
<a name="l967"><span class="linenum"> 967</span></a>              }
<a name="l968"><span class="linenum"> 968</span></a>              <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l969"><span class="linenum"> 969</span></a>              unset(<a class="var it10997" onMouseOver="hilite(10997)" onMouseOut="lolite()" onClick="logVariable('add_users')" href="../../_variables/add_users.html">$add_users</a>); <span class="comment">// free mem</span>
<a name="l970"><span class="linenum"> 970</span></a>          } else {
<a name="l971"><span class="linenum"> 971</span></a>              <a class="function" onClick="logFunction('print_string')" href="../../_functions/print_string.html" onMouseOver="funcPopup(event,'print_string')">print_string</a>('nouserstobeadded', 'auth_ldap');
<a name="l972"><span class="linenum"> 972</span></a>          }
<a name="l973"><span class="linenum"> 973</span></a>  
<a name="l974"><span class="linenum"> 974</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l975"><span class="linenum"> 975</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l976"><span class="linenum"> 976</span></a>  
<a name="l977"><span class="linenum"> 977</span></a>          return true;
<a name="l978"><span class="linenum"> 978</span></a>      }
<a name="l979"><span class="linenum"> 979</span></a>  
<a name="l980"><span class="linenum"> 980</span></a>      <span class="comment">/**</span>
<a name="l981"><span class="linenum"> 981</span></a>  <span class="comment">     * Update a local user record from an external source.</span>
<a name="l982"><span class="linenum"> 982</span></a>  <span class="comment">     * This is a lighter version of the one in moodlelib -- won't do</span>
<a name="l983"><span class="linenum"> 983</span></a>  <span class="comment">     * expensive ops such as enrolment.</span>
<a name="l984"><span class="linenum"> 984</span></a>  <span class="comment">     *</span>
<a name="l985"><span class="linenum"> 985</span></a>  <span class="comment">     * If you don't pass $updatekeys, there is a performance hit and</span>
<a name="l986"><span class="linenum"> 986</span></a>  <span class="comment">     * values removed from LDAP won't be removed from moodle.</span>
<a name="l987"><span class="linenum"> 987</span></a>  <span class="comment">     *</span>
<a name="l988"><span class="linenum"> 988</span></a>  <span class="comment">     * @param string $username username</span>
<a name="l989"><span class="linenum"> 989</span></a>  <span class="comment">     * @param boolean $updatekeys true to update the local record with the external LDAP values.</span>
<a name="l990"><span class="linenum"> 990</span></a>  <span class="comment">     */</span>
<a name="l991"><span class="linenum"> 991</span></a>      function <a class="function" onClick="logFunction('update_user_record')" href="../../_functions/update_user_record.html" onMouseOver="funcPopup(event,'update_user_record')">update_user_record</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, <a class="var it10994" onMouseOver="hilite(10994)" onMouseOut="lolite()" onClick="logVariable('updatekeys')" href="../../_variables/updatekeys.html">$updatekeys</a> = false) {
<a name="l992"><span class="linenum"> 992</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l993"><span class="linenum"> 993</span></a>  
<a name="l994"><span class="linenum"> 994</span></a>  <span class="comment">        // Just in case check text case</span>
<a name="l995"><span class="linenum"> 995</span></a>          <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>));
<a name="l996"><span class="linenum"> 996</span></a>  
<a name="l997"><span class="linenum"> 997</span></a>  <span class="comment">        // Get the current user record</span>
<a name="l998"><span class="linenum"> 998</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('username'=&gt;<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, 'mnethostid'=&gt;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>));
<a name="l999"><span class="linenum"> 999</span></a>          if (empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) { // trouble
<a name="l1000"><span class="linenum">1000</span></a>              <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('auth_dbusernotexist', 'auth_db', '', <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>));
<a name="l1001"><span class="linenum">1001</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_dbusernotexist', 'auth_db', '', <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>);
<a name="l1002"><span class="linenum">1002</span></a>              die;
<a name="l1003"><span class="linenum">1003</span></a>          }
<a name="l1004"><span class="linenum">1004</span></a>  
<a name="l1005"><span class="linenum">1005</span></a>  <span class="comment">        // Protect the userid from being overwritten</span>
<a name="l1006"><span class="linenum">1006</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1007"><span class="linenum">1007</span></a>  
<a name="l1008"><span class="linenum">1008</span></a>          if (<a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_userinfo')" href="../../_functions/get_userinfo.html" onMouseOver="funcPopup(event,'get_userinfo')">get_userinfo</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>)) {
<a name="l1009"><span class="linenum">1009</span></a>              <a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a> = <a class="function" onClick="logFunction('truncate_userinfo')" href="../../_functions/truncate_userinfo.html" onMouseOver="funcPopup(event,'truncate_userinfo')">truncate_userinfo</a>(<a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a>);
<a name="l1010"><span class="linenum">1010</span></a>  
<a name="l1011"><span class="linenum">1011</span></a>              if (empty(<a class="var it10994" onMouseOver="hilite(10994)" onMouseOut="lolite()" onClick="logVariable('updatekeys')" href="../../_variables/updatekeys.html">$updatekeys</a>)) { // all keys? this does not support removing values
<a name="l1012"><span class="linenum">1012</span></a>                  <a class="var it10994" onMouseOver="hilite(10994)" onMouseOut="lolite()" onClick="logVariable('updatekeys')" href="../../_variables/updatekeys.html">$updatekeys</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a>);
<a name="l1013"><span class="linenum">1013</span></a>              }
<a name="l1014"><span class="linenum">1014</span></a>  
<a name="l1015"><span class="linenum">1015</span></a>              if (!empty(<a class="var it10994" onMouseOver="hilite(10994)" onMouseOut="lolite()" onClick="logVariable('updatekeys')" href="../../_variables/updatekeys.html">$updatekeys</a>)) {
<a name="l1016"><span class="linenum">1016</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a> = new stdClass();
<a name="l1017"><span class="linenum">1017</span></a>                  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>-&gt;<a onClick="logVariable('id')" class="var it39669" onMouseOver="hilite(39669)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l1018"><span class="linenum">1018</span></a>  
<a name="l1019"><span class="linenum">1019</span></a>                  foreach (<a class="var it10994" onMouseOver="hilite(10994)" onMouseOut="lolite()" onClick="logVariable('updatekeys')" href="../../_variables/updatekeys.html">$updatekeys</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>) {
<a name="l1020"><span class="linenum">1020</span></a>                      if (isset(<a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>])) {
<a name="l1021"><span class="linenum">1021</span></a>                          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>];
<a name="l1022"><span class="linenum">1022</span></a>                      } else {
<a name="l1023"><span class="linenum">1023</span></a>                          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = '';
<a name="l1024"><span class="linenum">1024</span></a>                      }
<a name="l1025"><span class="linenum">1025</span></a>  
<a name="l1026"><span class="linenum">1026</span></a>                      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{'field_updatelocal_' . <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>})) {
<a name="l1027"><span class="linenum">1027</span></a>  <span class="comment">                        // Only update if it's changed.</span>
<a name="l1028"><span class="linenum">1028</span></a>                          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;{<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>} != <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l1029"><span class="linenum">1029</span></a>                              <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>-&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l1030"><span class="linenum">1030</span></a>                          }
<a name="l1031"><span class="linenum">1031</span></a>                      }
<a name="l1032"><span class="linenum">1032</span></a>                  }
<a name="l1033"><span class="linenum">1033</span></a>                  <a class="function" onClick="logFunction('user_update_user')" href="../../_functions/user_update_user.html" onMouseOver="funcPopup(event,'user_update_user')">user_update_user</a>(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>, false, false);
<a name="l1034"><span class="linenum">1034</span></a>              }
<a name="l1035"><span class="linenum">1035</span></a>          } else {
<a name="l1036"><span class="linenum">1036</span></a>              return false;
<a name="l1037"><span class="linenum">1037</span></a>          }
<a name="l1038"><span class="linenum">1038</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'deleted'=&gt;0));
<a name="l1039"><span class="linenum">1039</span></a>      }
<a name="l1040"><span class="linenum">1040</span></a>  
<a name="l1041"><span class="linenum">1041</span></a>      <span class="comment">/**</span>
<a name="l1042"><span class="linenum">1042</span></a>  <span class="comment">     * Bulk insert in SQL's temp table</span>
<a name="l1043"><span class="linenum">1043</span></a>  <span class="comment">     */</span>
<a name="l1044"><span class="linenum">1044</span></a>      function <a class="function" onClick="logFunction('ldap_bulk_insert')" href="../../_functions/ldap_bulk_insert.html" onMouseOver="funcPopup(event,'ldap_bulk_insert')">ldap_bulk_insert</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>) {
<a name="l1045"><span class="linenum">1045</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1046"><span class="linenum">1046</span></a>  
<a name="l1047"><span class="linenum">1047</span></a>          <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>); <span class="comment">// usernames are __always__ lowercase.</span>
<a name="l1048"><span class="linenum">1048</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record_raw')" href="../../_functions/insert_record_raw.html" onMouseOver="funcPopup(event,'insert_record_raw')">insert_record_raw</a>('tmp_extuser', array('username'=&gt;<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>,
<a name="l1049"><span class="linenum">1049</span></a>                                                      'mnethostid'=&gt;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>), false, true);
<a name="l1050"><span class="linenum">1050</span></a>          echo '.';
<a name="l1051"><span class="linenum">1051</span></a>      }
<a name="l1052"><span class="linenum">1052</span></a>  
<a name="l1053"><span class="linenum">1053</span></a>      <span class="comment">/**</span>
<a name="l1054"><span class="linenum">1054</span></a>  <span class="comment">     * Activates (enables) user in external LDAP so user can login</span>
<a name="l1055"><span class="linenum">1055</span></a>  <span class="comment">     *</span>
<a name="l1056"><span class="linenum">1056</span></a>  <span class="comment">     * @param mixed $username</span>
<a name="l1057"><span class="linenum">1057</span></a>  <span class="comment">     * @return boolean result</span>
<a name="l1058"><span class="linenum">1058</span></a>  <span class="comment">     */</span>
<a name="l1059"><span class="linenum">1059</span></a>      function <a class="function" onClick="logFunction('user_activate')" href="../../_functions/user_activate.html" onMouseOver="funcPopup(event,'user_activate')">user_activate</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>) {
<a name="l1060"><span class="linenum">1060</span></a>          <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l1063"><span class="linenum">1063</span></a>  
<a name="l1064"><span class="linenum">1064</span></a>          <a class="var it27828" onMouseOver="hilite(27828)" onMouseOut="lolite()" onClick="logVariable('userdn')" href="../../_variables/userdn.html">$userdn</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>);
<a name="l1065"><span class="linenum">1065</span></a>          switch (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type)  {
<a name="l1066"><span class="linenum">1066</span></a>              case 'edir':
<a name="l1067"><span class="linenum">1067</span></a>                  <a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a>['loginDisabled'] = 'FALSE';
<a name="l1068"><span class="linenum">1068</span></a>                  break;
<a name="l1069"><span class="linenum">1069</span></a>              case 'rfc2307':
<a name="l1070"><span class="linenum">1070</span></a>              case 'rfc2307bis':
<a name="l1071"><span class="linenum">1071</span></a>  <span class="comment">                // Remember that we add a '*' character in front of the</span>
<a name="l1072"><span class="linenum">1072</span></a>  <span class="comment">                // external password string to 'disable' the account. We just</span>
<a name="l1073"><span class="linenum">1073</span></a>  <span class="comment">                // need to remove it.</span>
<a name="l1074"><span class="linenum">1074</span></a>                  <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a> = <a class="phpfunction" onClick="logFunction('ldap_read')" href="../../_functions/ldap_read.html" onMouseOver="phpfuncPopup(event,'ldap_read')">ldap_read</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it27828" onMouseOver="hilite(27828)" onMouseOut="lolite()" onClick="logVariable('userdn')" href="../../_variables/userdn.html">$userdn</a>, '(objectClass=*)',
<a name="l1075"><span class="linenum">1075</span></a>                                  array('userPassword'));
<a name="l1076"><span class="linenum">1076</span></a>                  <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = <a class="phpfunction" onClick="logFunction('ldap_get_entries')" href="../../_functions/ldap_get_entries.html" onMouseOver="phpfuncPopup(event,'ldap_get_entries')">ldap_get_entries</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>);
<a name="l1077"><span class="linenum">1077</span></a>                  <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[0] = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>(<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[0], CASE_LOWER);
<a name="l1078"><span class="linenum">1078</span></a>                  <a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a>['userPassword'] = <a class="phpfunction" onClick="logFunction('ltrim')" href="../../_functions/ltrim.html" onMouseOver="phpfuncPopup(event,'ltrim')">ltrim</a>(<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[0]['userpassword'][0], '*');
<a name="l1079"><span class="linenum">1079</span></a>                  break;
<a name="l1080"><span class="linenum">1080</span></a>              case 'ad':
<a name="l1081"><span class="linenum">1081</span></a>  <span class="comment">                // We need to unset the ACCOUNTDISABLE bit in the</span>
<a name="l1082"><span class="linenum">1082</span></a>  <span class="comment">                // userAccountControl attribute ( see</span>
<a name="l1083"><span class="linenum">1083</span></a>  <span class="comment">                // http://support.microsoft.com/kb/305144 )</span>
<a name="l1084"><span class="linenum">1084</span></a>                  <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a> = <a class="phpfunction" onClick="logFunction('ldap_read')" href="../../_functions/ldap_read.html" onMouseOver="phpfuncPopup(event,'ldap_read')">ldap_read</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it27828" onMouseOver="hilite(27828)" onMouseOut="lolite()" onClick="logVariable('userdn')" href="../../_variables/userdn.html">$userdn</a>, '(objectClass=*)',
<a name="l1085"><span class="linenum">1085</span></a>                                  array('userAccountControl'));
<a name="l1086"><span class="linenum">1086</span></a>                  <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = <a class="phpfunction" onClick="logFunction('ldap_get_entries')" href="../../_functions/ldap_get_entries.html" onMouseOver="phpfuncPopup(event,'ldap_get_entries')">ldap_get_entries</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>);
<a name="l1087"><span class="linenum">1087</span></a>                  <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[0] = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>(<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[0], CASE_LOWER);
<a name="l1088"><span class="linenum">1088</span></a>                  <a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a>['userAccountControl'] = <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[0]['useraccountcontrol'][0]
<a name="l1089"><span class="linenum">1089</span></a>                                                   &amp; (~<a class="constant" onClick="logConstant('AUTH_AD_ACCOUNTDISABLE')" href="../../_constants/AUTH_AD_ACCOUNTDISABLE.html" onMouseOver="constPopup(event,'AUTH_AD_ACCOUNTDISABLE')">AUTH_AD_ACCOUNTDISABLE</a>);
<a name="l1090"><span class="linenum">1090</span></a>                  break;
<a name="l1091"><span class="linenum">1091</span></a>              default:
<a name="l1092"><span class="linenum">1092</span></a>                  <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('user_activatenotsupportusertype', 'auth_ldap', '', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type_name);
<a name="l1093"><span class="linenum">1093</span></a>          }
<a name="l1094"><span class="linenum">1094</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = ldap_modify(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it27828" onMouseOver="hilite(27828)" onMouseOut="lolite()" onClick="logVariable('userdn')" href="../../_variables/userdn.html">$userdn</a>, <a class="var it10999" onMouseOver="hilite(10999)" onMouseOut="lolite()" onClick="logVariable('newinfo')" href="../../_variables/newinfo.html">$newinfo</a>);
<a name="l1095"><span class="linenum">1095</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l1096"><span class="linenum">1096</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1097"><span class="linenum">1097</span></a>      }
<a name="l1098"><span class="linenum">1098</span></a>  
<a name="l1099"><span class="linenum">1099</span></a>      <span class="comment">/**</span>
<a name="l1100"><span class="linenum">1100</span></a>  <span class="comment">     * Returns true if user should be coursecreator.</span>
<a name="l1101"><span class="linenum">1101</span></a>  <span class="comment">     *</span>
<a name="l1102"><span class="linenum">1102</span></a>  <span class="comment">     * @param mixed $username    username (without system magic quotes)</span>
<a name="l1103"><span class="linenum">1103</span></a>  <span class="comment">     * @return mixed result      null if course creators is not configured, boolean otherwise.</span>
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment">     */</span>
<a name="l1105"><span class="linenum">1105</span></a>      function <a class="function" onClick="logFunction('iscreator')" href="../../_functions/iscreator.html" onMouseOver="funcPopup(event,'iscreator')">iscreator</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>) {
<a name="l1106"><span class="linenum">1106</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;creators) or empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;memberattribute)) {
<a name="l1107"><span class="linenum">1107</span></a>              return null;
<a name="l1108"><span class="linenum">1108</span></a>          }
<a name="l1109"><span class="linenum">1109</span></a>  
<a name="l1110"><span class="linenum">1110</span></a>          <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l1111"><span class="linenum">1111</span></a>  
<a name="l1112"><span class="linenum">1112</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l1113"><span class="linenum">1113</span></a>  
<a name="l1114"><span class="linenum">1114</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;memberattribute_isdn) {
<a name="l1115"><span class="linenum">1115</span></a>              if(!(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>))) {
<a name="l1116"><span class="linenum">1116</span></a>                  return false;
<a name="l1117"><span class="linenum">1117</span></a>              }
<a name="l1118"><span class="linenum">1118</span></a>          } else {
<a name="l1119"><span class="linenum">1119</span></a>              <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>;
<a name="l1120"><span class="linenum">1120</span></a>          }
<a name="l1121"><span class="linenum">1121</span></a>  
<a name="l1122"><span class="linenum">1122</span></a>          <a class="var it20640" onMouseOver="hilite(20640)" onMouseOut="lolite()" onClick="logVariable('group_dns')" href="../../_variables/group_dns.html">$group_dns</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(';', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;creators);
<a name="l1123"><span class="linenum">1123</span></a>          <a class="var it11440" onMouseOver="hilite(11440)" onMouseOut="lolite()" onClick="logVariable('creator')" href="../../_variables/creator.html">$creator</a> = <a class="function" onClick="logFunction('ldap_isgroupmember')" href="../../_functions/ldap_isgroupmember.html" onMouseOver="funcPopup(event,'ldap_isgroupmember')">ldap_isgroupmember</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it20640" onMouseOver="hilite(20640)" onMouseOut="lolite()" onClick="logVariable('group_dns')" href="../../_variables/group_dns.html">$group_dns</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;memberattribute);
<a name="l1124"><span class="linenum">1124</span></a>  
<a name="l1125"><span class="linenum">1125</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l1126"><span class="linenum">1126</span></a>  
<a name="l1127"><span class="linenum">1127</span></a>          return <a class="var it11440" onMouseOver="hilite(11440)" onMouseOut="lolite()" onClick="logVariable('creator')" href="../../_variables/creator.html">$creator</a>;
<a name="l1128"><span class="linenum">1128</span></a>      }
<a name="l1129"><span class="linenum">1129</span></a>  
<a name="l1130"><span class="linenum">1130</span></a>      <span class="comment">/**</span>
<a name="l1131"><span class="linenum">1131</span></a>  <span class="comment">     * Called when the user record is updated.</span>
<a name="l1132"><span class="linenum">1132</span></a>  <span class="comment">     *</span>
<a name="l1133"><span class="linenum">1133</span></a>  <span class="comment">     * Modifies user in external LDAP server. It takes olduser (before</span>
<a name="l1134"><span class="linenum">1134</span></a>  <span class="comment">     * changes) and newuser (after changes) compares information and</span>
<a name="l1135"><span class="linenum">1135</span></a>  <span class="comment">     * saves modified information to external LDAP server.</span>
<a name="l1136"><span class="linenum">1136</span></a>  <span class="comment">     *</span>
<a name="l1137"><span class="linenum">1137</span></a>  <span class="comment">     * @param mixed $olduser     Userobject before modifications    (without system magic quotes)</span>
<a name="l1138"><span class="linenum">1138</span></a>  <span class="comment">     * @param mixed $newuser     Userobject new modified userobject (without system magic quotes)</span>
<a name="l1139"><span class="linenum">1139</span></a>  <span class="comment">     * @return boolean result</span>
<a name="l1140"><span class="linenum">1140</span></a>  <span class="comment">     *</span>
<a name="l1141"><span class="linenum">1141</span></a>  <span class="comment">     */</span>
<a name="l1142"><span class="linenum">1142</span></a>      function <a class="function" onClick="logFunction('user_update')" href="../../_functions/user_update.html" onMouseOver="funcPopup(event,'user_update')">user_update</a>(<a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>, <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>) {
<a name="l1143"><span class="linenum">1143</span></a>          global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l1144"><span class="linenum">1144</span></a>  
<a name="l1145"><span class="linenum">1145</span></a>          if (isset(<a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a onClick="logVariable('username')" class="var it40303" onMouseOver="hilite(40303)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>) and isset(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>-&gt;<a onClick="logVariable('username')" class="var it39669" onMouseOver="hilite(39669)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>) and <a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a onClick="logVariable('username')" class="var it40303" onMouseOver="hilite(40303)" onMouseOut="lolite()" href="../../_variables/username.html">username</a> != <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>-&gt;<a onClick="logVariable('username')" class="var it39669" onMouseOver="hilite(39669)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>) {
<a name="l1146"><span class="linenum">1146</span></a>              <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('renamingnotallowed', 'auth_ldap'));
<a name="l1147"><span class="linenum">1147</span></a>              return false;
<a name="l1148"><span class="linenum">1148</span></a>          }
<a name="l1149"><span class="linenum">1149</span></a>  
<a name="l1150"><span class="linenum">1150</span></a>          if (isset(<a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a onClick="logVariable('auth')" class="var it40303" onMouseOver="hilite(40303)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a>) and <a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a onClick="logVariable('auth')" class="var it40303" onMouseOver="hilite(40303)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a> != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/authtype.html">authtype</a>) {
<a name="l1151"><span class="linenum">1151</span></a>              return true; <span class="comment">// just change auth and skip update</span>
<a name="l1152"><span class="linenum">1152</span></a>          }
<a name="l1153"><span class="linenum">1153</span></a>  
<a name="l1154"><span class="linenum">1154</span></a>          <a class="var it17976" onMouseOver="hilite(17976)" onMouseOut="lolite()" onClick="logVariable('attrmap')" href="../../_variables/attrmap.html">$attrmap</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_attributes')" href="../../_functions/ldap_attributes.html" onMouseOver="funcPopup(event,'ldap_attributes')">ldap_attributes</a>();
<a name="l1155"><span class="linenum">1155</span></a>  <span class="comment">        // Before doing anything else, make sure we really need to update anything</span>
<a name="l1156"><span class="linenum">1156</span></a>  <span class="comment">        // in the external LDAP server.</span>
<a name="l1157"><span class="linenum">1157</span></a>          <a class="var it37730" onMouseOver="hilite(37730)" onMouseOut="lolite()" onClick="logVariable('update_external')" href="../../_variables/update_external.html">$update_external</a> = false;
<a name="l1158"><span class="linenum">1158</span></a>          foreach (<a class="var it17976" onMouseOver="hilite(17976)" onMouseOut="lolite()" onClick="logVariable('attrmap')" href="../../_variables/attrmap.html">$attrmap</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it37731" onMouseOver="hilite(37731)" onMouseOut="lolite()" onClick="logVariable('ldapkeys')" href="../../_variables/ldapkeys.html">$ldapkeys</a>) {
<a name="l1159"><span class="linenum">1159</span></a>              if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{'field_updateremote_'.<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>})) {
<a name="l1160"><span class="linenum">1160</span></a>                  <a class="var it37730" onMouseOver="hilite(37730)" onMouseOut="lolite()" onClick="logVariable('update_external')" href="../../_variables/update_external.html">$update_external</a> = true;
<a name="l1161"><span class="linenum">1161</span></a>                  break;
<a name="l1162"><span class="linenum">1162</span></a>              }
<a name="l1163"><span class="linenum">1163</span></a>          }
<a name="l1164"><span class="linenum">1164</span></a>          if (!<a class="var it37730" onMouseOver="hilite(37730)" onMouseOut="lolite()" onClick="logVariable('update_external')" href="../../_variables/update_external.html">$update_external</a>) {
<a name="l1165"><span class="linenum">1165</span></a>              return true;
<a name="l1166"><span class="linenum">1166</span></a>          }
<a name="l1167"><span class="linenum">1167</span></a>  
<a name="l1168"><span class="linenum">1168</span></a>          <a class="var it37732" onMouseOver="hilite(37732)" onMouseOut="lolite()" onClick="logVariable('extoldusername')" href="../../_variables/extoldusername.html">$extoldusername</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a onClick="logVariable('username')" class="var it40303" onMouseOver="hilite(40303)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l1169"><span class="linenum">1169</span></a>  
<a name="l1170"><span class="linenum">1170</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l1171"><span class="linenum">1171</span></a>  
<a name="l1172"><span class="linenum">1172</span></a>          <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a> = array();
<a name="l1173"><span class="linenum">1173</span></a>          foreach (<a class="var it17976" onMouseOver="hilite(17976)" onMouseOut="lolite()" onClick="logVariable('attrmap')" href="../../_variables/attrmap.html">$attrmap</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>) {
<a name="l1174"><span class="linenum">1174</span></a>              if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>)) {
<a name="l1175"><span class="linenum">1175</span></a>                  <a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a> = array(<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>);
<a name="l1176"><span class="linenum">1176</span></a>              }
<a name="l1177"><span class="linenum">1177</span></a>              foreach (<a class="var it517" onMouseOver="hilite(517)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a> as <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l1178"><span class="linenum">1178</span></a>                  if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a>)) {
<a name="l1179"><span class="linenum">1179</span></a>                      <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a>, <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>);
<a name="l1180"><span class="linenum">1180</span></a>                  }
<a name="l1181"><span class="linenum">1181</span></a>              }
<a name="l1182"><span class="linenum">1182</span></a>          }
<a name="l1183"><span class="linenum">1183</span></a>  
<a name="l1184"><span class="linenum">1184</span></a>          if(!(<a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37732" onMouseOver="hilite(37732)" onMouseOut="lolite()" onClick="logVariable('extoldusername')" href="../../_variables/extoldusername.html">$extoldusername</a>))) {
<a name="l1185"><span class="linenum">1185</span></a>              return false;
<a name="l1186"><span class="linenum">1186</span></a>          }
<a name="l1187"><span class="linenum">1187</span></a>  
<a name="l1188"><span class="linenum">1188</span></a>          <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = true;
<a name="l1189"><span class="linenum">1189</span></a>          <a class="var it37720" onMouseOver="hilite(37720)" onMouseOut="lolite()" onClick="logVariable('user_info_result')" href="../../_variables/user_info_result.html">$user_info_result</a> = <a class="phpfunction" onClick="logFunction('ldap_read')" href="../../_functions/ldap_read.html" onMouseOver="phpfuncPopup(event,'ldap_read')">ldap_read</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, '(objectClass=*)', <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a>);
<a name="l1190"><span class="linenum">1190</span></a>          if (<a class="var it37720" onMouseOver="hilite(37720)" onMouseOut="lolite()" onClick="logVariable('user_info_result')" href="../../_variables/user_info_result.html">$user_info_result</a>) {
<a name="l1191"><span class="linenum">1191</span></a>              <a class="var it37721" onMouseOver="hilite(37721)" onMouseOut="lolite()" onClick="logVariable('user_entry')" href="../../_variables/user_entry.html">$user_entry</a> = <a class="function" onClick="logFunction('ldap_get_entries_moodle')" href="../../_functions/ldap_get_entries_moodle.html" onMouseOver="funcPopup(event,'ldap_get_entries_moodle')">ldap_get_entries_moodle</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37720" onMouseOver="hilite(37720)" onMouseOut="lolite()" onClick="logVariable('user_info_result')" href="../../_variables/user_info_result.html">$user_info_result</a>);
<a name="l1192"><span class="linenum">1192</span></a>              if (empty(<a class="var it37721" onMouseOver="hilite(37721)" onMouseOut="lolite()" onClick="logVariable('user_entry')" href="../../_variables/user_entry.html">$user_entry</a>)) {
<a name="l1193"><span class="linenum">1193</span></a>                  <a class="var it12547" onMouseOver="hilite(12547)" onMouseOut="lolite()" onClick="logVariable('attribs')" href="../../_variables/attribs.html">$attribs</a> = <a class="function" onClick="logFunction('join')" href="../../_functions/join.html" onMouseOver="funcPopup(event,'join')">join</a> (', ', <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a>);
<a name="l1194"><span class="linenum">1194</span></a>                  <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('updateusernotfound', 'auth_ldap',
<a name="l1195"><span class="linenum">1195</span></a>                                                            array('userdn'=&gt;<a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>,
<a name="l1196"><span class="linenum">1196</span></a>                                                                  'attribs'=&gt;<a class="var it12547" onMouseOver="hilite(12547)" onMouseOut="lolite()" onClick="logVariable('attribs')" href="../../_variables/attribs.html">$attribs</a>)));
<a name="l1197"><span class="linenum">1197</span></a>                  return false; <span class="comment">// old user not found!</span>
<a name="l1198"><span class="linenum">1198</span></a>              } else if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it37721" onMouseOver="hilite(37721)" onMouseOut="lolite()" onClick="logVariable('user_entry')" href="../../_variables/user_entry.html">$user_entry</a>) &gt; 1) {
<a name="l1199"><span class="linenum">1199</span></a>                  <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('morethanoneuser', 'auth_ldap'));
<a name="l1200"><span class="linenum">1200</span></a>                  return false;
<a name="l1201"><span class="linenum">1201</span></a>              }
<a name="l1202"><span class="linenum">1202</span></a>  
<a name="l1203"><span class="linenum">1203</span></a>              <a class="var it37721" onMouseOver="hilite(37721)" onMouseOut="lolite()" onClick="logVariable('user_entry')" href="../../_variables/user_entry.html">$user_entry</a> = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>(<a class="var it37721" onMouseOver="hilite(37721)" onMouseOut="lolite()" onClick="logVariable('user_entry')" href="../../_variables/user_entry.html">$user_entry</a>[0], CASE_LOWER);
<a name="l1204"><span class="linenum">1204</span></a>  
<a name="l1205"><span class="linenum">1205</span></a>              foreach (<a class="var it17976" onMouseOver="hilite(17976)" onMouseOut="lolite()" onClick="logVariable('attrmap')" href="../../_variables/attrmap.html">$attrmap</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it37731" onMouseOver="hilite(37731)" onMouseOut="lolite()" onClick="logVariable('ldapkeys')" href="../../_variables/ldapkeys.html">$ldapkeys</a>) {
<a name="l1206"><span class="linenum">1206</span></a>                  <a class="var it15514" onMouseOver="hilite(15514)" onMouseOut="lolite()" onClick="logVariable('profilefield')" href="../../_variables/profilefield.html">$profilefield</a> = '';
<a name="l1207"><span class="linenum">1207</span></a>  <span class="comment">                // Only process if the moodle field ($key) has changed and we</span>
<a name="l1208"><span class="linenum">1208</span></a>  <span class="comment">                // are set to update LDAP with it</span>
<a name="l1209"><span class="linenum">1209</span></a>                  <a class="var it37733" onMouseOver="hilite(37733)" onMouseOut="lolite()" onClick="logVariable('customprofilefield')" href="../../_variables/customprofilefield.html">$customprofilefield</a> = 'profile_field_' . <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>;
<a name="l1210"><span class="linenum">1210</span></a>                  if (isset(<a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>) and isset(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>-&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>)
<a name="l1211"><span class="linenum">1211</span></a>                      and (<a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> !== <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>-&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>)) {
<a name="l1212"><span class="linenum">1212</span></a>                      <a class="var it15514" onMouseOver="hilite(15514)" onMouseOut="lolite()" onClick="logVariable('profilefield')" href="../../_variables/profilefield.html">$profilefield</a> = <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>;
<a name="l1213"><span class="linenum">1213</span></a>                  } else if (isset(<a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a class="var it37733" onMouseOver="hilite(37733)" onMouseOut="lolite()" onClick="logVariable('customprofilefield')" href="../../_variables/customprofilefield.html">$customprofilefield</a>) &amp;&amp; isset(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>-&gt;<a class="var it37733" onMouseOver="hilite(37733)" onMouseOut="lolite()" onClick="logVariable('customprofilefield')" href="../../_variables/customprofilefield.html">$customprofilefield</a>)
<a name="l1214"><span class="linenum">1214</span></a>                      &amp;&amp; <a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a class="var it37733" onMouseOver="hilite(37733)" onMouseOut="lolite()" onClick="logVariable('customprofilefield')" href="../../_variables/customprofilefield.html">$customprofilefield</a> !== <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>-&gt;<a class="var it37733" onMouseOver="hilite(37733)" onMouseOut="lolite()" onClick="logVariable('customprofilefield')" href="../../_variables/customprofilefield.html">$customprofilefield</a>) {
<a name="l1215"><span class="linenum">1215</span></a>                      <a class="var it15514" onMouseOver="hilite(15514)" onMouseOut="lolite()" onClick="logVariable('profilefield')" href="../../_variables/profilefield.html">$profilefield</a> = <a class="var it37733" onMouseOver="hilite(37733)" onMouseOut="lolite()" onClick="logVariable('customprofilefield')" href="../../_variables/customprofilefield.html">$customprofilefield</a>;
<a name="l1216"><span class="linenum">1216</span></a>                  }
<a name="l1217"><span class="linenum">1217</span></a>  
<a name="l1218"><span class="linenum">1218</span></a>                  if (!empty(<a class="var it15514" onMouseOver="hilite(15514)" onMouseOut="lolite()" onClick="logVariable('profilefield')" href="../../_variables/profilefield.html">$profilefield</a>) &amp;&amp; !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{'field_updateremote_' . <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>})) {
<a name="l1219"><span class="linenum">1219</span></a>  <span class="comment">                    // For ldap values that could be in more than one</span>
<a name="l1220"><span class="linenum">1220</span></a>  <span class="comment">                    // ldap key, we will do our best to match</span>
<a name="l1221"><span class="linenum">1221</span></a>  <span class="comment">                    // where they came from</span>
<a name="l1222"><span class="linenum">1222</span></a>                      <a class="var it37734" onMouseOver="hilite(37734)" onMouseOut="lolite()" onClick="logVariable('ambiguous')" href="../../_variables/ambiguous.html">$ambiguous</a> = true;
<a name="l1223"><span class="linenum">1223</span></a>                      <a class="var it3069" onMouseOver="hilite(3069)" onMouseOut="lolite()" onClick="logVariable('changed')" href="../../_variables/changed.html">$changed</a>   = false;
<a name="l1224"><span class="linenum">1224</span></a>                      if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it37731" onMouseOver="hilite(37731)" onMouseOut="lolite()" onClick="logVariable('ldapkeys')" href="../../_variables/ldapkeys.html">$ldapkeys</a>)) {
<a name="l1225"><span class="linenum">1225</span></a>                          <a class="var it37731" onMouseOver="hilite(37731)" onMouseOut="lolite()" onClick="logVariable('ldapkeys')" href="../../_variables/ldapkeys.html">$ldapkeys</a> = array(<a class="var it37731" onMouseOver="hilite(37731)" onMouseOut="lolite()" onClick="logVariable('ldapkeys')" href="../../_variables/ldapkeys.html">$ldapkeys</a>);
<a name="l1226"><span class="linenum">1226</span></a>                      }
<a name="l1227"><span class="linenum">1227</span></a>                      if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it37731" onMouseOver="hilite(37731)" onMouseOut="lolite()" onClick="logVariable('ldapkeys')" href="../../_variables/ldapkeys.html">$ldapkeys</a>) &lt; 2) {
<a name="l1228"><span class="linenum">1228</span></a>                          <a class="var it37734" onMouseOver="hilite(37734)" onMouseOut="lolite()" onClick="logVariable('ambiguous')" href="../../_variables/ambiguous.html">$ambiguous</a> = false;
<a name="l1229"><span class="linenum">1229</span></a>                      }
<a name="l1230"><span class="linenum">1230</span></a>  
<a name="l1231"><span class="linenum">1231</span></a>                      <a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('newuser')" href="../../_variables/newuser.html">$newuser</a>-&gt;<a class="var it15514" onMouseOver="hilite(15514)" onMouseOut="lolite()" onClick="logVariable('profilefield')" href="../../_variables/profilefield.html">$profilefield</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l1232"><span class="linenum">1232</span></a>                      empty(<a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a>) ? <a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a> = array() : <a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a>;
<a name="l1233"><span class="linenum">1233</span></a>                      <a class="var it27827" onMouseOver="hilite(27827)" onMouseOut="lolite()" onClick="logVariable('ouvalue')" href="../../_variables/ouvalue.html">$ouvalue</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it8634" onMouseOver="hilite(8634)" onMouseOut="lolite()" onClick="logVariable('olduser')" href="../../_variables/olduser.html">$olduser</a>-&gt;<a class="var it15514" onMouseOver="hilite(15514)" onMouseOut="lolite()" onClick="logVariable('profilefield')" href="../../_variables/profilefield.html">$profilefield</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l1234"><span class="linenum">1234</span></a>  
<a name="l1235"><span class="linenum">1235</span></a>                      foreach (<a class="var it37731" onMouseOver="hilite(37731)" onMouseOut="lolite()" onClick="logVariable('ldapkeys')" href="../../_variables/ldapkeys.html">$ldapkeys</a> as <a class="var it37735" onMouseOver="hilite(37735)" onMouseOut="lolite()" onClick="logVariable('ldapkey')" href="../../_variables/ldapkey.html">$ldapkey</a>) {
<a name="l1236"><span class="linenum">1236</span></a>                          <a class="var it37735" onMouseOver="hilite(37735)" onMouseOut="lolite()" onClick="logVariable('ldapkey')" href="../../_variables/ldapkey.html">$ldapkey</a>   = <a class="var it37735" onMouseOver="hilite(37735)" onMouseOut="lolite()" onClick="logVariable('ldapkey')" href="../../_variables/ldapkey.html">$ldapkey</a>;
<a name="l1237"><span class="linenum">1237</span></a>                          <a class="var it37736" onMouseOver="hilite(37736)" onMouseOut="lolite()" onClick="logVariable('ldapvalue')" href="../../_variables/ldapvalue.html">$ldapvalue</a> = <a class="var it37721" onMouseOver="hilite(37721)" onMouseOut="lolite()" onClick="logVariable('user_entry')" href="../../_variables/user_entry.html">$user_entry</a>[<a class="var it37735" onMouseOver="hilite(37735)" onMouseOut="lolite()" onClick="logVariable('ldapkey')" href="../../_variables/ldapkey.html">$ldapkey</a>][0];
<a name="l1238"><span class="linenum">1238</span></a>                          if (!<a class="var it37734" onMouseOver="hilite(37734)" onMouseOut="lolite()" onClick="logVariable('ambiguous')" href="../../_variables/ambiguous.html">$ambiguous</a>) {
<a name="l1239"><span class="linenum">1239</span></a>  <span class="comment">                            // Skip update if the values already match</span>
<a name="l1240"><span class="linenum">1240</span></a>                              if (<a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a> !== <a class="var it37736" onMouseOver="hilite(37736)" onMouseOut="lolite()" onClick="logVariable('ldapvalue')" href="../../_variables/ldapvalue.html">$ldapvalue</a>) {
<a name="l1241"><span class="linenum">1241</span></a>  <span class="comment">                                // This might fail due to schema validation</span>
<a name="l1242"><span class="linenum">1242</span></a>                                  if (@ldap_modify(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, array(<a class="var it37735" onMouseOver="hilite(37735)" onMouseOut="lolite()" onClick="logVariable('ldapkey')" href="../../_variables/ldapkey.html">$ldapkey</a> =&gt; <a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a>))) {
<a name="l1243"><span class="linenum">1243</span></a>                                      <a class="var it3069" onMouseOver="hilite(3069)" onMouseOut="lolite()" onClick="logVariable('changed')" href="../../_variables/changed.html">$changed</a> = true;
<a name="l1244"><span class="linenum">1244</span></a>                                      continue;
<a name="l1245"><span class="linenum">1245</span></a>                                  } else {
<a name="l1246"><span class="linenum">1246</span></a>                                      <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = false;
<a name="l1247"><span class="linenum">1247</span></a>                                      <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('updateremfail', 'auth_ldap',
<a name="l1248"><span class="linenum">1248</span></a>                                                                               array('errno'=&gt;<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>),
<a name="l1249"><span class="linenum">1249</span></a>                                                                                     'errstring'=&gt;<a class="phpfunction" onClick="logFunction('ldap_err2str')" href="../../_functions/ldap_err2str.html" onMouseOver="phpfuncPopup(event,'ldap_err2str')">ldap_err2str</a>(<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>)),
<a name="l1250"><span class="linenum">1250</span></a>                                                                                     'key'=&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>,
<a name="l1251"><span class="linenum">1251</span></a>                                                                                     'ouvalue'=&gt;<a class="var it27827" onMouseOver="hilite(27827)" onMouseOut="lolite()" onClick="logVariable('ouvalue')" href="../../_variables/ouvalue.html">$ouvalue</a>,
<a name="l1252"><span class="linenum">1252</span></a>                                                                                     'nuvalue'=&gt;<a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a>)));
<a name="l1253"><span class="linenum">1253</span></a>                                      continue;
<a name="l1254"><span class="linenum">1254</span></a>                                  }
<a name="l1255"><span class="linenum">1255</span></a>                              }
<a name="l1256"><span class="linenum">1256</span></a>                          } else {
<a name="l1257"><span class="linenum">1257</span></a>  <span class="comment">                            // Ambiguous. Value empty before in Moodle (and LDAP) - use</span>
<a name="l1258"><span class="linenum">1258</span></a>  <span class="comment">                            // 1st ldap candidate field, no need to guess</span>
<a name="l1259"><span class="linenum">1259</span></a>                              if (<a class="var it27827" onMouseOver="hilite(27827)" onMouseOut="lolite()" onClick="logVariable('ouvalue')" href="../../_variables/ouvalue.html">$ouvalue</a> === '') { // value empty before - use 1st ldap candidate
<a name="l1260"><span class="linenum">1260</span></a>  <span class="comment">                                // This might fail due to schema validation</span>
<a name="l1261"><span class="linenum">1261</span></a>                                  if (@ldap_modify(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, array(<a class="var it37735" onMouseOver="hilite(37735)" onMouseOut="lolite()" onClick="logVariable('ldapkey')" href="../../_variables/ldapkey.html">$ldapkey</a> =&gt; <a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a>))) {
<a name="l1262"><span class="linenum">1262</span></a>                                      <a class="var it3069" onMouseOver="hilite(3069)" onMouseOut="lolite()" onClick="logVariable('changed')" href="../../_variables/changed.html">$changed</a> = true;
<a name="l1263"><span class="linenum">1263</span></a>                                      continue;
<a name="l1264"><span class="linenum">1264</span></a>                                  } else {
<a name="l1265"><span class="linenum">1265</span></a>                                      <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = false;
<a name="l1266"><span class="linenum">1266</span></a>                                      <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('updateremfail', 'auth_ldap',
<a name="l1267"><span class="linenum">1267</span></a>                                                                               array('errno'=&gt;<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>),
<a name="l1268"><span class="linenum">1268</span></a>                                                                                     'errstring'=&gt;<a class="phpfunction" onClick="logFunction('ldap_err2str')" href="../../_functions/ldap_err2str.html" onMouseOver="phpfuncPopup(event,'ldap_err2str')">ldap_err2str</a>(<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>)),
<a name="l1269"><span class="linenum">1269</span></a>                                                                                     'key'=&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>,
<a name="l1270"><span class="linenum">1270</span></a>                                                                                     'ouvalue'=&gt;<a class="var it27827" onMouseOver="hilite(27827)" onMouseOut="lolite()" onClick="logVariable('ouvalue')" href="../../_variables/ouvalue.html">$ouvalue</a>,
<a name="l1271"><span class="linenum">1271</span></a>                                                                                     'nuvalue'=&gt;<a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a>)));
<a name="l1272"><span class="linenum">1272</span></a>                                      continue;
<a name="l1273"><span class="linenum">1273</span></a>                                  }
<a name="l1274"><span class="linenum">1274</span></a>                              }
<a name="l1275"><span class="linenum">1275</span></a>  
<a name="l1276"><span class="linenum">1276</span></a>  <span class="comment">                            // We found which ldap key to update!</span>
<a name="l1277"><span class="linenum">1277</span></a>                              if (<a class="var it27827" onMouseOver="hilite(27827)" onMouseOut="lolite()" onClick="logVariable('ouvalue')" href="../../_variables/ouvalue.html">$ouvalue</a> !== '' and <a class="var it27827" onMouseOver="hilite(27827)" onMouseOut="lolite()" onClick="logVariable('ouvalue')" href="../../_variables/ouvalue.html">$ouvalue</a> === <a class="var it37736" onMouseOver="hilite(37736)" onMouseOut="lolite()" onClick="logVariable('ldapvalue')" href="../../_variables/ldapvalue.html">$ldapvalue</a> ) {
<a name="l1278"><span class="linenum">1278</span></a>  <span class="comment">                                // This might fail due to schema validation</span>
<a name="l1279"><span class="linenum">1279</span></a>                                  if (@ldap_modify(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, array(<a class="var it37735" onMouseOver="hilite(37735)" onMouseOut="lolite()" onClick="logVariable('ldapkey')" href="../../_variables/ldapkey.html">$ldapkey</a> =&gt; <a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a>))) {
<a name="l1280"><span class="linenum">1280</span></a>                                      <a class="var it3069" onMouseOver="hilite(3069)" onMouseOut="lolite()" onClick="logVariable('changed')" href="../../_variables/changed.html">$changed</a> = true;
<a name="l1281"><span class="linenum">1281</span></a>                                      continue;
<a name="l1282"><span class="linenum">1282</span></a>                                  } else {
<a name="l1283"><span class="linenum">1283</span></a>                                      <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = false;
<a name="l1284"><span class="linenum">1284</span></a>                                      <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('updateremfail', 'auth_ldap',
<a name="l1285"><span class="linenum">1285</span></a>                                                                               array('errno'=&gt;<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>),
<a name="l1286"><span class="linenum">1286</span></a>                                                                                     'errstring'=&gt;<a class="phpfunction" onClick="logFunction('ldap_err2str')" href="../../_functions/ldap_err2str.html" onMouseOver="phpfuncPopup(event,'ldap_err2str')">ldap_err2str</a>(<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>)),
<a name="l1287"><span class="linenum">1287</span></a>                                                                                     'key'=&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>,
<a name="l1288"><span class="linenum">1288</span></a>                                                                                     'ouvalue'=&gt;<a class="var it27827" onMouseOver="hilite(27827)" onMouseOut="lolite()" onClick="logVariable('ouvalue')" href="../../_variables/ouvalue.html">$ouvalue</a>,
<a name="l1289"><span class="linenum">1289</span></a>                                                                                     'nuvalue'=&gt;<a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a>)));
<a name="l1290"><span class="linenum">1290</span></a>                                      continue;
<a name="l1291"><span class="linenum">1291</span></a>                                  }
<a name="l1292"><span class="linenum">1292</span></a>                              }
<a name="l1293"><span class="linenum">1293</span></a>                          }
<a name="l1294"><span class="linenum">1294</span></a>                      }
<a name="l1295"><span class="linenum">1295</span></a>  
<a name="l1296"><span class="linenum">1296</span></a>                      if (<a class="var it37734" onMouseOver="hilite(37734)" onMouseOut="lolite()" onClick="logVariable('ambiguous')" href="../../_variables/ambiguous.html">$ambiguous</a> and !<a class="var it3069" onMouseOver="hilite(3069)" onMouseOut="lolite()" onClick="logVariable('changed')" href="../../_variables/changed.html">$changed</a>) {
<a name="l1297"><span class="linenum">1297</span></a>                          <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = false;
<a name="l1298"><span class="linenum">1298</span></a>                          <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('updateremfailamb', 'auth_ldap',
<a name="l1299"><span class="linenum">1299</span></a>                                                                   array('key'=&gt;<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>,
<a name="l1300"><span class="linenum">1300</span></a>                                                                         'ouvalue'=&gt;<a class="var it27827" onMouseOver="hilite(27827)" onMouseOut="lolite()" onClick="logVariable('ouvalue')" href="../../_variables/ouvalue.html">$ouvalue</a>,
<a name="l1301"><span class="linenum">1301</span></a>                                                                         'nuvalue'=&gt;<a class="var it11001" onMouseOver="hilite(11001)" onMouseOut="lolite()" onClick="logVariable('nuvalue')" href="../../_variables/nuvalue.html">$nuvalue</a>)));
<a name="l1302"><span class="linenum">1302</span></a>                      }
<a name="l1303"><span class="linenum">1303</span></a>                  }
<a name="l1304"><span class="linenum">1304</span></a>              }
<a name="l1305"><span class="linenum">1305</span></a>          } else {
<a name="l1306"><span class="linenum">1306</span></a>              <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('usernotfound', 'auth_ldap'));
<a name="l1307"><span class="linenum">1307</span></a>              <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = false;
<a name="l1308"><span class="linenum">1308</span></a>          }
<a name="l1309"><span class="linenum">1309</span></a>  
<a name="l1310"><span class="linenum">1310</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l1311"><span class="linenum">1311</span></a>          return <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l1312"><span class="linenum">1312</span></a>  
<a name="l1313"><span class="linenum">1313</span></a>      }
<a name="l1314"><span class="linenum">1314</span></a>  
<a name="l1315"><span class="linenum">1315</span></a>      <span class="comment">/**</span>
<a name="l1316"><span class="linenum">1316</span></a>  <span class="comment">     * Changes userpassword in LDAP</span>
<a name="l1317"><span class="linenum">1317</span></a>  <span class="comment">     *</span>
<a name="l1318"><span class="linenum">1318</span></a>  <span class="comment">     * Called when the user password is updated. It assumes it is</span>
<a name="l1319"><span class="linenum">1319</span></a>  <span class="comment">     * called by an admin or that you've otherwise checked the user's</span>
<a name="l1320"><span class="linenum">1320</span></a>  <span class="comment">     * credentials</span>
<a name="l1321"><span class="linenum">1321</span></a>  <span class="comment">     *</span>
<a name="l1322"><span class="linenum">1322</span></a>  <span class="comment">     * @param  object  $user        User table object</span>
<a name="l1323"><span class="linenum">1323</span></a>  <span class="comment">     * @param  string  $newpassword Plaintext password (not crypted/md5'ed)</span>
<a name="l1324"><span class="linenum">1324</span></a>  <span class="comment">     * @return boolean result</span>
<a name="l1325"><span class="linenum">1325</span></a>  <span class="comment">     *</span>
<a name="l1326"><span class="linenum">1326</span></a>  <span class="comment">     */</span>
<a name="l1327"><span class="linenum">1327</span></a>      function <a class="function" onClick="logFunction('user_update_password')" href="../../_functions/user_update_password.html" onMouseOver="funcPopup(event,'user_update_password')">user_update_password</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it8633" onMouseOver="hilite(8633)" onMouseOut="lolite()" onClick="logVariable('newpassword')" href="../../_variables/newpassword.html">$newpassword</a>) {
<a name="l1328"><span class="linenum">1328</span></a>          global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l1329"><span class="linenum">1329</span></a>  
<a name="l1330"><span class="linenum">1330</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l1331"><span class="linenum">1331</span></a>          <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>;
<a name="l1332"><span class="linenum">1332</span></a>  
<a name="l1333"><span class="linenum">1333</span></a>          <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l1334"><span class="linenum">1334</span></a>          <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it8633" onMouseOver="hilite(8633)" onMouseOut="lolite()" onClick="logVariable('newpassword')" href="../../_variables/newpassword.html">$newpassword</a>, 'utf-8', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l1335"><span class="linenum">1335</span></a>  
<a name="l1336"><span class="linenum">1336</span></a>          switch (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;passtype) {
<a name="l1337"><span class="linenum">1337</span></a>              case 'md5':
<a name="l1338"><span class="linenum">1338</span></a>                  <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a> = '{MD5}' . <a class="phpfunction" onClick="logFunction('base64_encode')" href="../../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="phpfunction" onClick="logFunction('pack')" href="../../_functions/pack.html" onMouseOver="phpfuncPopup(event,'pack')">pack</a>('H*', md5(<a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>)));
<a name="l1339"><span class="linenum">1339</span></a>                  break;
<a name="l1340"><span class="linenum">1340</span></a>              case 'sha1':
<a name="l1341"><span class="linenum">1341</span></a>                  <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a> = '{SHA}' . <a class="phpfunction" onClick="logFunction('base64_encode')" href="../../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="phpfunction" onClick="logFunction('pack')" href="../../_functions/pack.html" onMouseOver="phpfuncPopup(event,'pack')">pack</a>('H*', <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>)));
<a name="l1342"><span class="linenum">1342</span></a>                  break;
<a name="l1343"><span class="linenum">1343</span></a>              case 'plaintext':
<a name="l1344"><span class="linenum">1344</span></a>              default:
<a name="l1345"><span class="linenum">1345</span></a>                  break; <span class="comment">// plaintext</span>
<a name="l1346"><span class="linenum">1346</span></a>          }
<a name="l1347"><span class="linenum">1347</span></a>  
<a name="l1348"><span class="linenum">1348</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l1349"><span class="linenum">1349</span></a>  
<a name="l1350"><span class="linenum">1350</span></a>          <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>);
<a name="l1351"><span class="linenum">1351</span></a>  
<a name="l1352"><span class="linenum">1352</span></a>          if (!<a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>) {
<a name="l1353"><span class="linenum">1353</span></a>              <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('nodnforusername', 'auth_ldap', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>));
<a name="l1354"><span class="linenum">1354</span></a>              return false;
<a name="l1355"><span class="linenum">1355</span></a>          }
<a name="l1356"><span class="linenum">1356</span></a>  
<a name="l1357"><span class="linenum">1357</span></a>          switch (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type) {
<a name="l1358"><span class="linenum">1358</span></a>              case 'edir':
<a name="l1359"><span class="linenum">1359</span></a>  <span class="comment">                // Change password</span>
<a name="l1360"><span class="linenum">1360</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = ldap_modify(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, array('userPassword' =&gt; <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>));
<a name="l1361"><span class="linenum">1361</span></a>                  if (!<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l1362"><span class="linenum">1362</span></a>                      <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('updatepasserror', 'auth_ldap',
<a name="l1363"><span class="linenum">1363</span></a>                                                                 array('errno'=&gt;<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>),
<a name="l1364"><span class="linenum">1364</span></a>                                                                       'errstring'=&gt;<a class="phpfunction" onClick="logFunction('ldap_err2str')" href="../../_functions/ldap_err2str.html" onMouseOver="phpfuncPopup(event,'ldap_err2str')">ldap_err2str</a>(<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>)))));
<a name="l1365"><span class="linenum">1365</span></a>                  }
<a name="l1366"><span class="linenum">1366</span></a>  <span class="comment">                // Update password expiration time, grace logins count</span>
<a name="l1367"><span class="linenum">1367</span></a>                  <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a> = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;expireattr, 'passwordExpirationInterval', 'loginGraceLimit');
<a name="l1368"><span class="linenum">1368</span></a>                  <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a> = <a class="phpfunction" onClick="logFunction('ldap_read')" href="../../_functions/ldap_read.html" onMouseOver="phpfuncPopup(event,'ldap_read')">ldap_read</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, '(objectClass=*)', <a class="var it17977" onMouseOver="hilite(17977)" onMouseOut="lolite()" onClick="logVariable('search_attribs')" href="../../_variables/search_attribs.html">$search_attribs</a>);
<a name="l1369"><span class="linenum">1369</span></a>                  if (<a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>) {
<a name="l1370"><span class="linenum">1370</span></a>                      <a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a> = <a class="function" onClick="logFunction('ldap_get_entries_moodle')" href="../../_functions/ldap_get_entries_moodle.html" onMouseOver="funcPopup(event,'ldap_get_entries_moodle')">ldap_get_entries_moodle</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>);
<a name="l1371"><span class="linenum">1371</span></a>                      <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>(<a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>[0], CASE_LOWER);
<a name="l1372"><span class="linenum">1372</span></a>                      <a class="var it37737" onMouseOver="hilite(37737)" onMouseOut="lolite()" onClick="logVariable('newattrs')" href="../../_variables/newattrs.html">$newattrs</a> = array();
<a name="l1373"><span class="linenum">1373</span></a>                      if (!empty(<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;expireattr][0])) {
<a name="l1374"><span class="linenum">1374</span></a>  <span class="comment">                        // Set expiration time only if passwordExpirationInterval is defined</span>
<a name="l1375"><span class="linenum">1375</span></a>                          if (!empty(<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['passwordexpirationinterval'][0])) {
<a name="l1376"><span class="linenum">1376</span></a>                             <a class="var it24015" onMouseOver="hilite(24015)" onMouseOut="lolite()" onClick="logVariable('expirationtime')" href="../../_variables/expirationtime.html">$expirationtime</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() + <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['passwordexpirationinterval'][0];
<a name="l1377"><span class="linenum">1377</span></a>                             <a class="var it37738" onMouseOver="hilite(37738)" onMouseOut="lolite()" onClick="logVariable('ldapexpirationtime')" href="../../_variables/ldapexpirationtime.html">$ldapexpirationtime</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_unix2expirationtime')" href="../../_functions/ldap_unix2expirationtime.html" onMouseOver="funcPopup(event,'ldap_unix2expirationtime')">ldap_unix2expirationtime</a>(<a class="var it24015" onMouseOver="hilite(24015)" onMouseOut="lolite()" onClick="logVariable('expirationtime')" href="../../_variables/expirationtime.html">$expirationtime</a>);
<a name="l1378"><span class="linenum">1378</span></a>                             <a class="var it37737" onMouseOver="hilite(37737)" onMouseOut="lolite()" onClick="logVariable('newattrs')" href="../../_variables/newattrs.html">$newattrs</a>['passwordExpirationTime'] = <a class="var it37738" onMouseOver="hilite(37738)" onMouseOut="lolite()" onClick="logVariable('ldapexpirationtime')" href="../../_variables/ldapexpirationtime.html">$ldapexpirationtime</a>;
<a name="l1379"><span class="linenum">1379</span></a>                          }
<a name="l1380"><span class="linenum">1380</span></a>  
<a name="l1381"><span class="linenum">1381</span></a>  <span class="comment">                        // Set gracelogin count</span>
<a name="l1382"><span class="linenum">1382</span></a>                          if (!empty(<a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['logingracelimit'][0])) {
<a name="l1383"><span class="linenum">1383</span></a>                             <a class="var it37737" onMouseOver="hilite(37737)" onMouseOut="lolite()" onClick="logVariable('newattrs')" href="../../_variables/newattrs.html">$newattrs</a>['loginGraceRemaining']= <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['logingracelimit'][0];
<a name="l1384"><span class="linenum">1384</span></a>                          }
<a name="l1385"><span class="linenum">1385</span></a>  
<a name="l1386"><span class="linenum">1386</span></a>  <span class="comment">                        // Store attribute changes in LDAP</span>
<a name="l1387"><span class="linenum">1387</span></a>                          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = ldap_modify(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, <a class="var it37737" onMouseOver="hilite(37737)" onMouseOut="lolite()" onClick="logVariable('newattrs')" href="../../_variables/newattrs.html">$newattrs</a>);
<a name="l1388"><span class="linenum">1388</span></a>                          if (!<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l1389"><span class="linenum">1389</span></a>                              <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('updatepasserrorexpiregrace', 'auth_ldap',
<a name="l1390"><span class="linenum">1390</span></a>                                                                         array('errno'=&gt;<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>),
<a name="l1391"><span class="linenum">1391</span></a>                                                                               'errstring'=&gt;<a class="phpfunction" onClick="logFunction('ldap_err2str')" href="../../_functions/ldap_err2str.html" onMouseOver="phpfuncPopup(event,'ldap_err2str')">ldap_err2str</a>(<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>)))));
<a name="l1392"><span class="linenum">1392</span></a>                          }
<a name="l1393"><span class="linenum">1393</span></a>                      }
<a name="l1394"><span class="linenum">1394</span></a>                  }
<a name="l1395"><span class="linenum">1395</span></a>                  else {
<a name="l1396"><span class="linenum">1396</span></a>                      <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('updatepasserrorexpire', 'auth_ldap',
<a name="l1397"><span class="linenum">1397</span></a>                                                               array('errno'=&gt;<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>),
<a name="l1398"><span class="linenum">1398</span></a>                                                                     'errstring'=&gt;<a class="phpfunction" onClick="logFunction('ldap_err2str')" href="../../_functions/ldap_err2str.html" onMouseOver="phpfuncPopup(event,'ldap_err2str')">ldap_err2str</a>(<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>)))));
<a name="l1399"><span class="linenum">1399</span></a>                  }
<a name="l1400"><span class="linenum">1400</span></a>                  break;
<a name="l1401"><span class="linenum">1401</span></a>  
<a name="l1402"><span class="linenum">1402</span></a>              case 'ad':
<a name="l1403"><span class="linenum">1403</span></a>  <span class="comment">                // Passwords in Active Directory must be encoded as Unicode</span>
<a name="l1404"><span class="linenum">1404</span></a>  <span class="comment">                // strings (UCS-2 Little Endian format) and surrounded with</span>
<a name="l1405"><span class="linenum">1405</span></a>  <span class="comment">                // double quotes. See http://support.microsoft.com/?kbid=269190</span>
<a name="l1406"><span class="linenum">1406</span></a>                  if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('mb_convert_encoding')) {
<a name="l1407"><span class="linenum">1407</span></a>                      <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('needmbstring', 'auth_ldap'));
<a name="l1408"><span class="linenum">1408</span></a>                      return false;
<a name="l1409"><span class="linenum">1409</span></a>                  }
<a name="l1410"><span class="linenum">1410</span></a>                  <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a> = <a class="phpfunction" onClick="logFunction('mb_convert_encoding')" href="../../_functions/mb_convert_encoding.html" onMouseOver="phpfuncPopup(event,'mb_convert_encoding')">mb_convert_encoding</a>('&quot;'.<a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>.'&quot;', &quot;UCS-2LE&quot;, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding);
<a name="l1411"><span class="linenum">1411</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = ldap_modify(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, array('unicodePwd' =&gt; <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>));
<a name="l1412"><span class="linenum">1412</span></a>                  if (!<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l1413"><span class="linenum">1413</span></a>                      <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('updatepasserror', 'auth_ldap',
<a name="l1414"><span class="linenum">1414</span></a>                                                               array('errno'=&gt;<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>),
<a name="l1415"><span class="linenum">1415</span></a>                                                                     'errstring'=&gt;<a class="phpfunction" onClick="logFunction('ldap_err2str')" href="../../_functions/ldap_err2str.html" onMouseOver="phpfuncPopup(event,'ldap_err2str')">ldap_err2str</a>(<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>)))));
<a name="l1416"><span class="linenum">1416</span></a>                  }
<a name="l1417"><span class="linenum">1417</span></a>                  break;
<a name="l1418"><span class="linenum">1418</span></a>  
<a name="l1419"><span class="linenum">1419</span></a>              default:
<a name="l1420"><span class="linenum">1420</span></a>  <span class="comment">                // Send LDAP the password in cleartext, it will md5 it itself</span>
<a name="l1421"><span class="linenum">1421</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = ldap_modify(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, array('userPassword' =&gt; <a class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" onClick="logVariable('extpassword')" href="../../_variables/extpassword.html">$extpassword</a>));
<a name="l1422"><span class="linenum">1422</span></a>                  if (!<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l1423"><span class="linenum">1423</span></a>                      <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('updatepasserror', 'auth_ldap',
<a name="l1424"><span class="linenum">1424</span></a>                                                               array('errno'=&gt;<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>),
<a name="l1425"><span class="linenum">1425</span></a>                                                                     'errstring'=&gt;<a class="phpfunction" onClick="logFunction('ldap_err2str')" href="../../_functions/ldap_err2str.html" onMouseOver="phpfuncPopup(event,'ldap_err2str')">ldap_err2str</a>(<a class="phpfunction" onClick="logFunction('ldap_errno')" href="../../_functions/ldap_errno.html" onMouseOver="phpfuncPopup(event,'ldap_errno')">ldap_errno</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>)))));
<a name="l1426"><span class="linenum">1426</span></a>                  }
<a name="l1427"><span class="linenum">1427</span></a>  
<a name="l1428"><span class="linenum">1428</span></a>          }
<a name="l1429"><span class="linenum">1429</span></a>  
<a name="l1430"><span class="linenum">1430</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>();
<a name="l1431"><span class="linenum">1431</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1432"><span class="linenum">1432</span></a>      }
<a name="l1433"><span class="linenum">1433</span></a>  
<a name="l1434"><span class="linenum">1434</span></a>      <span class="comment">/**</span>
<a name="l1435"><span class="linenum">1435</span></a>  <span class="comment">     * Take expirationtime and return it as unix timestamp in seconds</span>
<a name="l1436"><span class="linenum">1436</span></a>  <span class="comment">     *</span>
<a name="l1437"><span class="linenum">1437</span></a>  <span class="comment">     * Takes expiration timestamp as read from LDAP and returns it as unix timestamp in seconds</span>
<a name="l1438"><span class="linenum">1438</span></a>  <span class="comment">     * Depends on $this-&gt;config-&gt;user_type variable</span>
<a name="l1439"><span class="linenum">1439</span></a>  <span class="comment">     *</span>
<a name="l1440"><span class="linenum">1440</span></a>  <span class="comment">     * @param mixed time   Time stamp read from LDAP as it is.</span>
<a name="l1441"><span class="linenum">1441</span></a>  <span class="comment">     * @param string $ldapconnection Only needed for Active Directory.</span>
<a name="l1442"><span class="linenum">1442</span></a>  <span class="comment">     * @param string $user_dn User distinguished name for the user we are checking password expiration (only needed for Active Directory).</span>
<a name="l1443"><span class="linenum">1443</span></a>  <span class="comment">     * @return timestamp</span>
<a name="l1444"><span class="linenum">1444</span></a>  <span class="comment">     */</span>
<a name="l1445"><span class="linenum">1445</span></a>      function <a class="function" onClick="logFunction('ldap_expirationtime2unix')" href="../../_functions/ldap_expirationtime2unix.html" onMouseOver="funcPopup(event,'ldap_expirationtime2unix')">ldap_expirationtime2unix</a> (<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>, <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>) {
<a name="l1446"><span class="linenum">1446</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l1447"><span class="linenum">1447</span></a>          switch (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type) {
<a name="l1448"><span class="linenum">1448</span></a>              case 'edir':
<a name="l1449"><span class="linenum">1449</span></a>                  <a class="var it7187" onMouseOver="hilite(7187)" onMouseOut="lolite()" onClick="logVariable('yr')" href="../../_variables/yr.html">$yr</a>=<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>, 0, 4);
<a name="l1450"><span class="linenum">1450</span></a>                  <a class="var it37739" onMouseOver="hilite(37739)" onMouseOut="lolite()" onClick="logVariable('mo')" href="../../_variables/mo.html">$mo</a>=<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>, 4, 2);
<a name="l1451"><span class="linenum">1451</span></a>                  <a class="var it7192" onMouseOver="hilite(7192)" onMouseOut="lolite()" onClick="logVariable('dt')" href="../../_variables/dt.html">$dt</a>=<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>, 6, 2);
<a name="l1452"><span class="linenum">1452</span></a>                  <a class="var it7220" onMouseOver="hilite(7220)" onMouseOut="lolite()" onClick="logVariable('hr')" href="../../_variables/hr.html">$hr</a>=<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>, 8, 2);
<a name="l1453"><span class="linenum">1453</span></a>                  <a class="var it1329" onMouseOver="hilite(1329)" onMouseOut="lolite()" onClick="logVariable('min')" href="../../_variables/min.html">$min</a>=<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>, 10, 2);
<a name="l1454"><span class="linenum">1454</span></a>                  <a class="var it1302" onMouseOver="hilite(1302)" onMouseOut="lolite()" onClick="logVariable('sec')" href="../../_variables/sec.html">$sec</a>=<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>, 12, 2);
<a name="l1455"><span class="linenum">1455</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="phpfunction" onClick="logFunction('mktime')" href="../../_functions/mktime.html" onMouseOver="phpfuncPopup(event,'mktime')">mktime</a>(<a class="var it7220" onMouseOver="hilite(7220)" onMouseOut="lolite()" onClick="logVariable('hr')" href="../../_variables/hr.html">$hr</a>, <a class="var it1329" onMouseOver="hilite(1329)" onMouseOut="lolite()" onClick="logVariable('min')" href="../../_variables/min.html">$min</a>, <a class="var it1302" onMouseOver="hilite(1302)" onMouseOut="lolite()" onClick="logVariable('sec')" href="../../_variables/sec.html">$sec</a>, <a class="var it37739" onMouseOver="hilite(37739)" onMouseOut="lolite()" onClick="logVariable('mo')" href="../../_variables/mo.html">$mo</a>, <a class="var it7192" onMouseOver="hilite(7192)" onMouseOut="lolite()" onClick="logVariable('dt')" href="../../_variables/dt.html">$dt</a>, <a class="var it7187" onMouseOver="hilite(7187)" onMouseOut="lolite()" onClick="logVariable('yr')" href="../../_variables/yr.html">$yr</a>);
<a name="l1456"><span class="linenum">1456</span></a>                  break;
<a name="l1457"><span class="linenum">1457</span></a>              case 'rfc2307':
<a name="l1458"><span class="linenum">1458</span></a>              case 'rfc2307bis':
<a name="l1459"><span class="linenum">1459</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a> * <a class="constant" onClick="logConstant('DAYSECS')" href="../../_constants/DAYSECS.html" onMouseOver="constPopup(event,'DAYSECS')">DAYSECS</a>; <span class="comment">// The shadowExpire contains the number of DAYS between 01/01/1970 and the actual expiration date</span>
<a name="l1460"><span class="linenum">1460</span></a>                  break;
<a name="l1461"><span class="linenum">1461</span></a>              case 'ad':
<a name="l1462"><span class="linenum">1462</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_get_ad_pwdexpire')" href="../../_functions/ldap_get_ad_pwdexpire.html" onMouseOver="funcPopup(event,'ldap_get_ad_pwdexpire')">ldap_get_ad_pwdexpire</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>, <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>);
<a name="l1463"><span class="linenum">1463</span></a>                  break;
<a name="l1464"><span class="linenum">1464</span></a>              default:
<a name="l1465"><span class="linenum">1465</span></a>                  <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldap_usertypeundefined', 'auth_ldap');
<a name="l1466"><span class="linenum">1466</span></a>          }
<a name="l1467"><span class="linenum">1467</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1468"><span class="linenum">1468</span></a>      }
<a name="l1469"><span class="linenum">1469</span></a>  
<a name="l1470"><span class="linenum">1470</span></a>      <span class="comment">/**</span>
<a name="l1471"><span class="linenum">1471</span></a>  <span class="comment">     * Takes unix timestamp and returns it formated for storing in LDAP</span>
<a name="l1472"><span class="linenum">1472</span></a>  <span class="comment">     *</span>
<a name="l1473"><span class="linenum">1473</span></a>  <span class="comment">     * @param integer unix time stamp</span>
<a name="l1474"><span class="linenum">1474</span></a>  <span class="comment">     */</span>
<a name="l1475"><span class="linenum">1475</span></a>      function <a class="function" onClick="logFunction('ldap_unix2expirationtime')" href="../../_functions/ldap_unix2expirationtime.html" onMouseOver="funcPopup(event,'ldap_unix2expirationtime')">ldap_unix2expirationtime</a>(<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>) {
<a name="l1476"><span class="linenum">1476</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = false;
<a name="l1477"><span class="linenum">1477</span></a>          switch (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type) {
<a name="l1478"><span class="linenum">1478</span></a>              case 'edir':
<a name="l1479"><span class="linenum">1479</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>=<a class="phpfunction" onClick="logFunction('date')" href="../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>('YmdHis', <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a>).'Z';
<a name="l1480"><span class="linenum">1480</span></a>                  break;
<a name="l1481"><span class="linenum">1481</span></a>              case 'rfc2307':
<a name="l1482"><span class="linenum">1482</span></a>              case 'rfc2307bis':
<a name="l1483"><span class="linenum">1483</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../../_variables/time.html">$time</a> ; <span class="comment">// Already in correct format</span>
<a name="l1484"><span class="linenum">1484</span></a>                  break;
<a name="l1485"><span class="linenum">1485</span></a>              default:
<a name="l1486"><span class="linenum">1486</span></a>                  <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldap_usertypeundefined2', 'auth_ldap');
<a name="l1487"><span class="linenum">1487</span></a>          }
<a name="l1488"><span class="linenum">1488</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1489"><span class="linenum">1489</span></a>  
<a name="l1490"><span class="linenum">1490</span></a>      }
<a name="l1491"><span class="linenum">1491</span></a>  
<a name="l1492"><span class="linenum">1492</span></a>      <span class="comment">/**</span>
<a name="l1493"><span class="linenum">1493</span></a>  <span class="comment">     * Returns user attribute mappings between moodle and LDAP</span>
<a name="l1494"><span class="linenum">1494</span></a>  <span class="comment">     *</span>
<a name="l1495"><span class="linenum">1495</span></a>  <span class="comment">     * @return array</span>
<a name="l1496"><span class="linenum">1496</span></a>  <span class="comment">     */</span>
<a name="l1497"><span class="linenum">1497</span></a>  
<a name="l1498"><span class="linenum">1498</span></a>      function <a class="function" onClick="logFunction('ldap_attributes')" href="../../_functions/ldap_attributes.html" onMouseOver="funcPopup(event,'ldap_attributes')">ldap_attributes</a> () {
<a name="l1499"><span class="linenum">1499</span></a>          <a class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" onClick="logVariable('moodleattributes')" href="../../_variables/moodleattributes.html">$moodleattributes</a> = array();
<a name="l1500"><span class="linenum">1500</span></a>  <span class="comment">        // If we have custom fields then merge them with user fields.</span>
<a name="l1501"><span class="linenum">1501</span></a>          <a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('customfields')" href="../../_variables/customfields.html">$customfields</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_custom_user_profile_fields')" href="../../_functions/get_custom_user_profile_fields.html" onMouseOver="funcPopup(event,'get_custom_user_profile_fields')">get_custom_user_profile_fields</a>();
<a name="l1502"><span class="linenum">1502</span></a>          if (!empty(<a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('customfields')" href="../../_variables/customfields.html">$customfields</a>) &amp;&amp; !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/userfields.html">userfields</a>)) {
<a name="l1503"><span class="linenum">1503</span></a>              <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/userfields.html">userfields</a>, <a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('customfields')" href="../../_variables/customfields.html">$customfields</a>);
<a name="l1504"><span class="linenum">1504</span></a>          } else {
<a name="l1505"><span class="linenum">1505</span></a>              <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/userfields.html">userfields</a>;
<a name="l1506"><span class="linenum">1506</span></a>          }
<a name="l1507"><span class="linenum">1507</span></a>  
<a name="l1508"><span class="linenum">1508</span></a>          foreach (<a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> as <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>) {
<a name="l1509"><span class="linenum">1509</span></a>              if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{&quot;field_map_<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>&quot;})) {
<a name="l1510"><span class="linenum">1510</span></a>                  <a class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" onClick="logVariable('moodleattributes')" href="../../_variables/moodleattributes.html">$moodleattributes</a>[<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>] = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;{&quot;field_map_<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>&quot;}));
<a name="l1511"><span class="linenum">1511</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/,/', <a class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" onClick="logVariable('moodleattributes')" href="../../_variables/moodleattributes.html">$moodleattributes</a>[<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>])) {
<a name="l1512"><span class="linenum">1512</span></a>                      <a class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" onClick="logVariable('moodleattributes')" href="../../_variables/moodleattributes.html">$moodleattributes</a>[<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>] = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" onClick="logVariable('moodleattributes')" href="../../_variables/moodleattributes.html">$moodleattributes</a>[<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>]); <span class="comment">// split ?</span>
<a name="l1513"><span class="linenum">1513</span></a>                  }
<a name="l1514"><span class="linenum">1514</span></a>              }
<a name="l1515"><span class="linenum">1515</span></a>          }
<a name="l1516"><span class="linenum">1516</span></a>          <a class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" onClick="logVariable('moodleattributes')" href="../../_variables/moodleattributes.html">$moodleattributes</a>['username'] = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute));
<a name="l1517"><span class="linenum">1517</span></a>          return <a class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" onClick="logVariable('moodleattributes')" href="../../_variables/moodleattributes.html">$moodleattributes</a>;
<a name="l1518"><span class="linenum">1518</span></a>      }
<a name="l1519"><span class="linenum">1519</span></a>  
<a name="l1520"><span class="linenum">1520</span></a>      <span class="comment">/**</span>
<a name="l1521"><span class="linenum">1521</span></a>  <span class="comment">     * Returns all usernames from LDAP</span>
<a name="l1522"><span class="linenum">1522</span></a>  <span class="comment">     *</span>
<a name="l1523"><span class="linenum">1523</span></a>  <span class="comment">     * @param $filter An LDAP search filter to select desired users</span>
<a name="l1524"><span class="linenum">1524</span></a>  <span class="comment">     * @return array of LDAP user names converted to UTF-8</span>
<a name="l1525"><span class="linenum">1525</span></a>  <span class="comment">     */</span>
<a name="l1526"><span class="linenum">1526</span></a>      function <a class="function" onClick="logFunction('ldap_get_userlist')" href="../../_functions/ldap_get_userlist.html" onMouseOver="funcPopup(event,'ldap_get_userlist')">ldap_get_userlist</a>(<a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>='*') {
<a name="l1527"><span class="linenum">1527</span></a>          <a class="var it37740" onMouseOver="hilite(37740)" onMouseOut="lolite()" onClick="logVariable('fresult')" href="../../_variables/fresult.html">$fresult</a> = array();
<a name="l1528"><span class="linenum">1528</span></a>  
<a name="l1529"><span class="linenum">1529</span></a>          <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="phpfuncPopup(event,'ldap_connect')">ldap_connect</a>();
<a name="l1530"><span class="linenum">1530</span></a>  
<a name="l1531"><span class="linenum">1531</span></a>          if (<a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a> == '*') {
<a name="l1532"><span class="linenum">1532</span></a>             <a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a> = '(&amp;('.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute.'=*)'.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass.')';
<a name="l1533"><span class="linenum">1533</span></a>          }
<a name="l1534"><span class="linenum">1534</span></a>  
<a name="l1535"><span class="linenum">1535</span></a>          <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(';', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;contexts);
<a name="l1536"><span class="linenum">1536</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context)) {
<a name="l1537"><span class="linenum">1537</span></a>              <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context);
<a name="l1538"><span class="linenum">1538</span></a>          }
<a name="l1539"><span class="linenum">1539</span></a>  
<a name="l1540"><span class="linenum">1540</span></a>          <a class="var it19543" onMouseOver="hilite(19543)" onMouseOut="lolite()" onClick="logVariable('ldap_cookie')" href="../../_variables/ldap_cookie.html">$ldap_cookie</a> = '';
<a name="l1541"><span class="linenum">1541</span></a>          <a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a> = <a class="function" onClick="logFunction('ldap_paged_results_supported')" href="../../_functions/ldap_paged_results_supported.html" onMouseOver="funcPopup(event,'ldap_paged_results_supported')">ldap_paged_results_supported</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldap_version);
<a name="l1542"><span class="linenum">1542</span></a>          foreach (<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> as <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l1543"><span class="linenum">1543</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l1544"><span class="linenum">1544</span></a>              if (empty(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1545"><span class="linenum">1545</span></a>                  continue;
<a name="l1546"><span class="linenum">1546</span></a>              }
<a name="l1547"><span class="linenum">1547</span></a>  
<a name="l1548"><span class="linenum">1548</span></a>              do {
<a name="l1549"><span class="linenum">1549</span></a>                  if (<a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a>) {
<a name="l1550"><span class="linenum">1550</span></a>                      ldap_control_paged_result(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;pagesize, true, <a class="var it19543" onMouseOver="hilite(19543)" onMouseOut="lolite()" onClick="logVariable('ldap_cookie')" href="../../_variables/ldap_cookie.html">$ldap_cookie</a>);
<a name="l1551"><span class="linenum">1551</span></a>                  }
<a name="l1552"><span class="linenum">1552</span></a>                  if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;search_sub) {
<a name="l1553"><span class="linenum">1553</span></a>  <span class="comment">                    // Use ldap_search to find first user from subtree.</span>
<a name="l1554"><span class="linenum">1554</span></a>                      <a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a> = <a class="phpfunction" onClick="logFunction('ldap_search')" href="../../_functions/ldap_search.html" onMouseOver="phpfuncPopup(event,'ldap_search')">ldap_search</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute));
<a name="l1555"><span class="linenum">1555</span></a>                  } else {
<a name="l1556"><span class="linenum">1556</span></a>  <span class="comment">                    // Search only in this context.</span>
<a name="l1557"><span class="linenum">1557</span></a>                      <a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a> = <a class="phpfunction" onClick="logFunction('ldap_list')" href="../../_functions/ldap_list.html" onMouseOver="phpfuncPopup(event,'ldap_list')">ldap_list</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute));
<a name="l1558"><span class="linenum">1558</span></a>                  }
<a name="l1559"><span class="linenum">1559</span></a>                  if(!<a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a>) {
<a name="l1560"><span class="linenum">1560</span></a>                      continue;
<a name="l1561"><span class="linenum">1561</span></a>                  }
<a name="l1562"><span class="linenum">1562</span></a>                  if (<a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a>) {
<a name="l1563"><span class="linenum">1563</span></a>                      ldap_control_paged_result_response(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a>, <a class="var it19543" onMouseOver="hilite(19543)" onMouseOut="lolite()" onClick="logVariable('ldap_cookie')" href="../../_variables/ldap_cookie.html">$ldap_cookie</a>);
<a name="l1564"><span class="linenum">1564</span></a>                  }
<a name="l1565"><span class="linenum">1565</span></a>                  <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="function" onClick="logFunction('ldap_get_entries_moodle')" href="../../_functions/ldap_get_entries_moodle.html" onMouseOver="funcPopup(event,'ldap_get_entries_moodle')">ldap_get_entries_moodle</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a>);
<a name="l1566"><span class="linenum">1566</span></a>  <span class="comment">                // Add found users to list.</span>
<a name="l1567"><span class="linenum">1567</span></a>                  for (<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0; <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> &lt; <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>); <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++) {
<a name="l1568"><span class="linenum">1568</span></a>                      <a class="var it37741" onMouseOver="hilite(37741)" onMouseOut="lolite()" onClick="logVariable('extuser')" href="../../_variables/extuser.html">$extuser</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>[<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>][<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute][0],
<a name="l1569"><span class="linenum">1569</span></a>                                                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldapencoding, 'utf-8');
<a name="l1570"><span class="linenum">1570</span></a>                      <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it37740" onMouseOver="hilite(37740)" onMouseOut="lolite()" onClick="logVariable('fresult')" href="../../_variables/fresult.html">$fresult</a>, <a class="var it37741" onMouseOver="hilite(37741)" onMouseOut="lolite()" onClick="logVariable('extuser')" href="../../_variables/extuser.html">$extuser</a>);
<a name="l1571"><span class="linenum">1571</span></a>                  }
<a name="l1572"><span class="linenum">1572</span></a>                  unset(<a class="var it19547" onMouseOver="hilite(19547)" onMouseOut="lolite()" onClick="logVariable('ldap_result')" href="../../_variables/ldap_result.html">$ldap_result</a>); <span class="comment">// Free mem.</span>
<a name="l1573"><span class="linenum">1573</span></a>              } while (<a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a> &amp;&amp; !empty(<a class="var it19543" onMouseOver="hilite(19543)" onMouseOut="lolite()" onClick="logVariable('ldap_cookie')" href="../../_variables/ldap_cookie.html">$ldap_cookie</a>));
<a name="l1574"><span class="linenum">1574</span></a>          }
<a name="l1575"><span class="linenum">1575</span></a>  
<a name="l1576"><span class="linenum">1576</span></a>  <span class="comment">        // If paged results were used, make sure the current connection is completely closed</span>
<a name="l1577"><span class="linenum">1577</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>(<a class="var it19538" onMouseOver="hilite(19538)" onMouseOut="lolite()" onClick="logVariable('ldap_pagedresults')" href="../../_variables/ldap_pagedresults.html">$ldap_pagedresults</a>);
<a name="l1578"><span class="linenum">1578</span></a>          return <a class="var it37740" onMouseOver="hilite(37740)" onMouseOut="lolite()" onClick="logVariable('fresult')" href="../../_variables/fresult.html">$fresult</a>;
<a name="l1579"><span class="linenum">1579</span></a>      }
<a name="l1580"><span class="linenum">1580</span></a>  
<a name="l1581"><span class="linenum">1581</span></a>      <span class="comment">/**</span>
<a name="l1582"><span class="linenum">1582</span></a>  <span class="comment">     * Indicates if password hashes should be stored in local moodle database.</span>
<a name="l1583"><span class="linenum">1583</span></a>  <span class="comment">     *</span>
<a name="l1584"><span class="linenum">1584</span></a>  <span class="comment">     * @return bool true means flag 'not_cached' stored instead of password hash</span>
<a name="l1585"><span class="linenum">1585</span></a>  <span class="comment">     */</span>
<a name="l1586"><span class="linenum">1586</span></a>      function <a class="function" onClick="logFunction('prevent_local_passwords')" href="../../_functions/prevent_local_passwords.html" onMouseOver="funcPopup(event,'prevent_local_passwords')">prevent_local_passwords</a>() {
<a name="l1587"><span class="linenum">1587</span></a>          return !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;preventpassindb);
<a name="l1588"><span class="linenum">1588</span></a>      }
<a name="l1589"><span class="linenum">1589</span></a>  
<a name="l1590"><span class="linenum">1590</span></a>      <span class="comment">/**</span>
<a name="l1591"><span class="linenum">1591</span></a>  <span class="comment">     * Returns true if this authentication plugin is 'internal'.</span>
<a name="l1592"><span class="linenum">1592</span></a>  <span class="comment">     *</span>
<a name="l1593"><span class="linenum">1593</span></a>  <span class="comment">     * @return bool</span>
<a name="l1594"><span class="linenum">1594</span></a>  <span class="comment">     */</span>
<a name="l1595"><span class="linenum">1595</span></a>      function <a class="function" onClick="logFunction('is_internal')" href="../../_functions/is_internal.html" onMouseOver="funcPopup(event,'is_internal')">is_internal</a>() {
<a name="l1596"><span class="linenum">1596</span></a>          return false;
<a name="l1597"><span class="linenum">1597</span></a>      }
<a name="l1598"><span class="linenum">1598</span></a>  
<a name="l1599"><span class="linenum">1599</span></a>      <span class="comment">/**</span>
<a name="l1600"><span class="linenum">1600</span></a>  <span class="comment">     * Returns true if this authentication plugin can change the user's</span>
<a name="l1601"><span class="linenum">1601</span></a>  <span class="comment">     * password.</span>
<a name="l1602"><span class="linenum">1602</span></a>  <span class="comment">     *</span>
<a name="l1603"><span class="linenum">1603</span></a>  <span class="comment">     * @return bool</span>
<a name="l1604"><span class="linenum">1604</span></a>  <span class="comment">     */</span>
<a name="l1605"><span class="linenum">1605</span></a>      function <a class="function" onClick="logFunction('can_change_password')" href="../../_functions/can_change_password.html" onMouseOver="funcPopup(event,'can_change_password')">can_change_password</a>() {
<a name="l1606"><span class="linenum">1606</span></a>          return !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;stdchangepassword) or !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;changepasswordurl);
<a name="l1607"><span class="linenum">1607</span></a>      }
<a name="l1608"><span class="linenum">1608</span></a>  
<a name="l1609"><span class="linenum">1609</span></a>      <span class="comment">/**</span>
<a name="l1610"><span class="linenum">1610</span></a>  <span class="comment">     * Returns the URL for changing the user's password, or empty if the default can</span>
<a name="l1611"><span class="linenum">1611</span></a>  <span class="comment">     * be used.</span>
<a name="l1612"><span class="linenum">1612</span></a>  <span class="comment">     *</span>
<a name="l1613"><span class="linenum">1613</span></a>  <span class="comment">     * @return moodle_url</span>
<a name="l1614"><span class="linenum">1614</span></a>  <span class="comment">     */</span>
<a name="l1615"><span class="linenum">1615</span></a>      function <a class="function" onClick="logFunction('change_password_url')" href="../../_functions/change_password_url.html" onMouseOver="funcPopup(event,'change_password_url')">change_password_url</a>() {
<a name="l1616"><span class="linenum">1616</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;stdchangepassword)) {
<a name="l1617"><span class="linenum">1617</span></a>              if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;changepasswordurl)) {
<a name="l1618"><span class="linenum">1618</span></a>                  return <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;changepasswordurl);
<a name="l1619"><span class="linenum">1619</span></a>              } else {
<a name="l1620"><span class="linenum">1620</span></a>                  return null;
<a name="l1621"><span class="linenum">1621</span></a>              }
<a name="l1622"><span class="linenum">1622</span></a>          } else {
<a name="l1623"><span class="linenum">1623</span></a>              return null;
<a name="l1624"><span class="linenum">1624</span></a>          }
<a name="l1625"><span class="linenum">1625</span></a>      }
<a name="l1626"><span class="linenum">1626</span></a>  
<a name="l1627"><span class="linenum">1627</span></a>      <span class="comment">/**</span>
<a name="l1628"><span class="linenum">1628</span></a>  <span class="comment">     * Will get called before the login page is shownr. Ff NTLM SSO</span>
<a name="l1629"><span class="linenum">1629</span></a>  <span class="comment">     * is enabled, and the user is in the right network, we'll redirect</span>
<a name="l1630"><span class="linenum">1630</span></a>  <span class="comment">     * to the magic NTLM page for SSO...</span>
<a name="l1631"><span class="linenum">1631</span></a>  <span class="comment">     *</span>
<a name="l1632"><span class="linenum">1632</span></a>  <span class="comment">     */</span>
<a name="l1633"><span class="linenum">1633</span></a>      function <a class="function" onClick="logFunction('loginpage_hook')" href="../../_functions/loginpage_hook.html" onMouseOver="funcPopup(event,'loginpage_hook')">loginpage_hook</a>() {
<a name="l1634"><span class="linenum">1634</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>;
<a name="l1635"><span class="linenum">1635</span></a>  
<a name="l1636"><span class="linenum">1636</span></a>  <span class="comment">        // HTTPS is potentially required</span>
<a name="l1637"><span class="linenum">1637</span></a>  <span class="comment">        //httpsrequired(); - this must be used before setting the URL, it is already done on the login/index.php</span>
<a name="l1638"><span class="linenum">1638</span></a>  
<a name="l1639"><span class="linenum">1639</span></a>          if ((<a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['REQUEST_METHOD'] === 'GET'         // Only on initial GET of loginpage
<a name="l1640"><span class="linenum">1640</span></a>               || (<a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['REQUEST_METHOD'] === 'POST'
<a name="l1641"><span class="linenum">1641</span></a>                   &amp;&amp; (<a class="function" onClick="logFunction('get_referer')" href="../../_functions/get_referer.html" onMouseOver="funcPopup(event,'get_referer')">get_referer</a>() != <a class="function" onClick="logFunction('strip_querystring')" href="../../_functions/strip_querystring.html" onMouseOver="funcPopup(event,'strip_querystring')">strip_querystring</a>(<a class="function" onClick="logFunction('qualified_me')" href="../../_functions/qualified_me.html" onMouseOver="funcPopup(event,'qualified_me')">qualified_me</a>()))))
<a name="l1642"><span class="linenum">1642</span></a>  <span class="comment">                                                          // Or when POSTed from another place</span>
<a name="l1643"><span class="linenum">1643</span></a>  <span class="comment">                                                          // See MDL-14071</span>
<a name="l1644"><span class="linenum">1644</span></a>              &amp;&amp; !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_enabled)     // SSO enabled
<a name="l1645"><span class="linenum">1645</span></a>              &amp;&amp; !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_subnet)      // have a subnet to test for
<a name="l1646"><span class="linenum">1646</span></a>              &amp;&amp; empty(<a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../../_variables/_GET.html">$_GET</a>['authldap_skipntlmsso'])       // haven't failed it yet
<a name="l1647"><span class="linenum">1647</span></a>              &amp;&amp; (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>() || !<a class="function" onClick="logFunction('isloggedin')" href="../../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>())           // guestuser or not-logged-in users
<a name="l1648"><span class="linenum">1648</span></a>              &amp;&amp; <a class="function" onClick="logFunction('address_in_subnet')" href="../../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="function" onClick="logFunction('getremoteaddr')" href="../../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_subnet)) {
<a name="l1649"><span class="linenum">1649</span></a>  
<a name="l1650"><span class="linenum">1650</span></a>  <span class="comment">            // First, let's remember where we were trying to get to before we got here</span>
<a name="l1651"><span class="linenum">1651</span></a>              if (empty(<a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../../_variables/wantsurl.html">wantsurl</a>)) {
<a name="l1652"><span class="linenum">1652</span></a>                  <a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../../_variables/wantsurl.html">wantsurl</a> = (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('HTTP_REFERER', <a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>) &amp;&amp;
<a name="l1653"><span class="linenum">1653</span></a>                                        <a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['HTTP_REFERER'] != <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a> &amp;&amp;
<a name="l1654"><span class="linenum">1654</span></a>                                        <a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['HTTP_REFERER'] != <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/' &amp;&amp;
<a name="l1655"><span class="linenum">1655</span></a>                                        <a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['HTTP_REFERER'] != <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/httpswwwroot.html">httpswwwroot</a>.'/login/' &amp;&amp;
<a name="l1656"><span class="linenum">1656</span></a>                                        <a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['HTTP_REFERER'] != <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/httpswwwroot.html">httpswwwroot</a>.'<a class="filename" href="../../login/index.php.html">/login/index.php</a>' &amp;&amp;
<a name="l1657"><span class="linenum">1657</span></a>                                        <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['HTTP_REFERER'], <a class="constant" onClick="logConstant('PARAM_LOCALURL')" href="../../_constants/PARAM_LOCALURL.html" onMouseOver="constPopup(event,'PARAM_LOCALURL')">PARAM_LOCALURL</a>) != '')
<a name="l1658"><span class="linenum">1658</span></a>                      ? <a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['HTTP_REFERER'] : NULL;
<a name="l1659"><span class="linenum">1659</span></a>              }
<a name="l1660"><span class="linenum">1660</span></a>  
<a name="l1661"><span class="linenum">1661</span></a>  <span class="comment">            // Now start the whole NTLM machinery.</span>
<a name="l1662"><span class="linenum">1662</span></a>              if(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_ie_fastpath == <a class="constant" onClick="logConstant('AUTH_NTLM_FASTPATH_YESATTEMPT')" href="../../_constants/AUTH_NTLM_FASTPATH_YESATTEMPT.html" onMouseOver="constPopup(event,'AUTH_NTLM_FASTPATH_YESATTEMPT')">AUTH_NTLM_FASTPATH_YESATTEMPT</a> ||
<a name="l1663"><span class="linenum">1663</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_ie_fastpath == <a class="constant" onClick="logConstant('AUTH_NTLM_FASTPATH_YESFORM')" href="../../_constants/AUTH_NTLM_FASTPATH_YESFORM.html" onMouseOver="constPopup(event,'AUTH_NTLM_FASTPATH_YESFORM')">AUTH_NTLM_FASTPATH_YESFORM</a>) {
<a name="l1664"><span class="linenum">1664</span></a>                  if (<a class="class" onClick="logClass('core_useragent')" href="../../_classes/core_useragent.html" onMouseOver="classPopup(event,'core_useragent')">core_useragent</a>::<a class="function" onClick="logFunction('is_ie')" href="../../_functions/is_ie.html" onMouseOver="funcPopup(event,'is_ie')">is_ie</a>()) {
<a name="l1665"><span class="linenum">1665</span></a>                      <a class="var it2860" onMouseOver="hilite(2860)" onMouseOut="lolite()" onClick="logVariable('sesskey')" href="../../_variables/sesskey.html">$sesskey</a> = <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>();
<a name="l1666"><span class="linenum">1666</span></a>                      <a class="function" onClick="logFunction('redirect')" href="../../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/auth/ldap/ntlmsso_magic.php?sesskey='.<a class="var it2860" onMouseOver="hilite(2860)" onMouseOut="lolite()" onClick="logVariable('sesskey')" href="../../_variables/sesskey.html">$sesskey</a>);
<a name="l1667"><span class="linenum">1667</span></a>                  } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_ie_fastpath == <a class="constant" onClick="logConstant('AUTH_NTLM_FASTPATH_YESFORM')" href="../../_constants/AUTH_NTLM_FASTPATH_YESFORM.html" onMouseOver="constPopup(event,'AUTH_NTLM_FASTPATH_YESFORM')">AUTH_NTLM_FASTPATH_YESFORM</a>) {
<a name="l1668"><span class="linenum">1668</span></a>                      <a class="function" onClick="logFunction('redirect')" href="../../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/httpswwwroot.html">httpswwwroot</a>.'/login/index.php?authldap_skipntlmsso=1');
<a name="l1669"><span class="linenum">1669</span></a>                  }
<a name="l1670"><span class="linenum">1670</span></a>              }
<a name="l1671"><span class="linenum">1671</span></a>              <a class="function" onClick="logFunction('redirect')" href="../../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'<a class="filename" href="../../auth/ldap/ntlmsso_attempt.php.html">/auth/ldap/ntlmsso_attempt.php</a>');
<a name="l1672"><span class="linenum">1672</span></a>          }
<a name="l1673"><span class="linenum">1673</span></a>  
<a name="l1674"><span class="linenum">1674</span></a>  <span class="comment">        // No NTLM SSO, Use the normal login page instead.</span>
<a name="l1675"><span class="linenum">1675</span></a>  
<a name="l1676"><span class="linenum">1676</span></a>  <span class="comment">        // If $SESSION-&gt;wantsurl is empty and we have a 'Referer:' header, the login</span>
<a name="l1677"><span class="linenum">1677</span></a>  <span class="comment">        // page insists on redirecting us to that page after user validation. If</span>
<a name="l1678"><span class="linenum">1678</span></a>  <span class="comment">        // we clicked on the redirect link at the ntlmsso_finish.php page (instead</span>
<a name="l1679"><span class="linenum">1679</span></a>  <span class="comment">        // of waiting for the redirection to happen) then we have a 'Referer:' header</span>
<a name="l1680"><span class="linenum">1680</span></a>  <span class="comment">        // we don't want to use at all. As we can't get rid of it, just point</span>
<a name="l1681"><span class="linenum">1681</span></a>  <span class="comment">        // $SESSION-&gt;wantsurl to $CFG-&gt;wwwroot (after all, we came from there).</span>
<a name="l1682"><span class="linenum">1682</span></a>          if (empty(<a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../../_variables/wantsurl.html">wantsurl</a>)
<a name="l1683"><span class="linenum">1683</span></a>              &amp;&amp; (<a class="function" onClick="logFunction('get_referer')" href="../../_functions/get_referer.html" onMouseOver="funcPopup(event,'get_referer')">get_referer</a>() == <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/httpswwwroot.html">httpswwwroot</a>.'<a class="filename" href="../../auth/ldap/ntlmsso_finish.php.html">/auth/ldap/ntlmsso_finish.php</a>')) {
<a name="l1684"><span class="linenum">1684</span></a>  
<a name="l1685"><span class="linenum">1685</span></a>              <a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../../_variables/wantsurl.html">wantsurl</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>;
<a name="l1686"><span class="linenum">1686</span></a>          }
<a name="l1687"><span class="linenum">1687</span></a>      }
<a name="l1688"><span class="linenum">1688</span></a>  
<a name="l1689"><span class="linenum">1689</span></a>      <span class="comment">/**</span>
<a name="l1690"><span class="linenum">1690</span></a>  <span class="comment">     * To be called from a page running under NTLM's</span>
<a name="l1691"><span class="linenum">1691</span></a>  <span class="comment">     * &quot;Integrated Windows Authentication&quot;.</span>
<a name="l1692"><span class="linenum">1692</span></a>  <span class="comment">     *</span>
<a name="l1693"><span class="linenum">1693</span></a>  <span class="comment">     * If successful, it will set a special &quot;cookie&quot; (not an HTTP cookie!)</span>
<a name="l1694"><span class="linenum">1694</span></a>  <span class="comment">     * in cache_flags under the $this-&gt;pluginconfig/ntlmsess &quot;plugin&quot; and return true.</span>
<a name="l1695"><span class="linenum">1695</span></a>  <span class="comment">     * The &quot;cookie&quot; will be picked up by ntlmsso_finish() to complete the</span>
<a name="l1696"><span class="linenum">1696</span></a>  <span class="comment">     * process.</span>
<a name="l1697"><span class="linenum">1697</span></a>  <span class="comment">     *</span>
<a name="l1698"><span class="linenum">1698</span></a>  <span class="comment">     * On failure it will return false for the caller to display an appropriate</span>
<a name="l1699"><span class="linenum">1699</span></a>  <span class="comment">     * error message (probably saying that Integrated Windows Auth isn't enabled!)</span>
<a name="l1700"><span class="linenum">1700</span></a>  <span class="comment">     *</span>
<a name="l1701"><span class="linenum">1701</span></a>  <span class="comment">     * NOTE that this code will execute under the OS user credentials,</span>
<a name="l1702"><span class="linenum">1702</span></a>  <span class="comment">     * so we MUST avoid dealing with files -- such as session files.</span>
<a name="l1703"><span class="linenum">1703</span></a>  <span class="comment">     * (The caller should define('NO_MOODLE_COOKIES', true) before including config.php)</span>
<a name="l1704"><span class="linenum">1704</span></a>  <span class="comment">     *</span>
<a name="l1705"><span class="linenum">1705</span></a>  <span class="comment">     */</span>
<a name="l1706"><span class="linenum">1706</span></a>      function <a class="function" onClick="logFunction('ntlmsso_magic')" href="../../_functions/ntlmsso_magic.html" onMouseOver="funcPopup(event,'ntlmsso_magic')">ntlmsso_magic</a>(<a class="var it2860" onMouseOver="hilite(2860)" onMouseOut="lolite()" onClick="logVariable('sesskey')" href="../../_variables/sesskey.html">$sesskey</a>) {
<a name="l1707"><span class="linenum">1707</span></a>          if (isset(<a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['REMOTE_USER']) &amp;&amp; !empty(<a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['REMOTE_USER'])) {
<a name="l1708"><span class="linenum">1708</span></a>  
<a name="l1709"><span class="linenum">1709</span></a>  <span class="comment">            // HTTP __headers__ seem to be sent in ISO-8859-1 encoding</span>
<a name="l1710"><span class="linenum">1710</span></a>  <span class="comment">            // (according to my reading of RFC-1945, RFC-2616 and RFC-2617 and</span>
<a name="l1711"><span class="linenum">1711</span></a>  <span class="comment">            // my local tests), so we need to convert the REMOTE_USER value</span>
<a name="l1712"><span class="linenum">1712</span></a>  <span class="comment">            // (i.e., what we got from the HTTP WWW-Authenticate header) into UTF-8</span>
<a name="l1713"><span class="linenum">1713</span></a>              <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it74" onMouseOver="hilite(74)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['REMOTE_USER'], 'iso-8859-1', 'utf-8');
<a name="l1714"><span class="linenum">1714</span></a>  
<a name="l1715"><span class="linenum">1715</span></a>              switch (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_type) {
<a name="l1716"><span class="linenum">1716</span></a>                  case 'ntlm':
<a name="l1717"><span class="linenum">1717</span></a>  <span class="comment">                    // The format is now configurable, so try to extract the username</span>
<a name="l1718"><span class="linenum">1718</span></a>                      <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_ntlm_remote_user')" href="../../_functions/get_ntlm_remote_user.html" onMouseOver="funcPopup(event,'get_ntlm_remote_user')">get_ntlm_remote_user</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>);
<a name="l1719"><span class="linenum">1719</span></a>                      if (empty(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>)) {
<a name="l1720"><span class="linenum">1720</span></a>                          return false;
<a name="l1721"><span class="linenum">1721</span></a>                      }
<a name="l1722"><span class="linenum">1722</span></a>                      break;
<a name="l1723"><span class="linenum">1723</span></a>                  case 'kerberos':
<a name="l1724"><span class="linenum">1724</span></a>  <span class="comment">                    // Format is username@DOMAIN</span>
<a name="l1725"><span class="linenum">1725</span></a>                      <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, 0, <a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, '@'));
<a name="l1726"><span class="linenum">1726</span></a>                      break;
<a name="l1727"><span class="linenum">1727</span></a>                  default:
<a name="l1728"><span class="linenum">1728</span></a>                      <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('ntlmsso_unknowntype', 'auth_ldap'));
<a name="l1729"><span class="linenum">1729</span></a>                      return false; <span class="comment">// Should never happen!</span>
<a name="l1730"><span class="linenum">1730</span></a>              }
<a name="l1731"><span class="linenum">1731</span></a>  
<a name="l1732"><span class="linenum">1732</span></a>              <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>); <span class="comment">// Compatibility hack</span>
<a name="l1733"><span class="linenum">1733</span></a>              <a class="function" onClick="logFunction('set_cache_flag')" href="../../_functions/set_cache_flag.html" onMouseOver="funcPopup(event,'set_cache_flag')">set_cache_flag</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>.'/ntlmsess', <a class="var it2860" onMouseOver="hilite(2860)" onMouseOut="lolite()" onClick="logVariable('sesskey')" href="../../_variables/sesskey.html">$sesskey</a>, <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, <a class="constant" onClick="logConstant('AUTH_NTLMTIMEOUT')" href="../../_constants/AUTH_NTLMTIMEOUT.html" onMouseOver="constPopup(event,'AUTH_NTLMTIMEOUT')">AUTH_NTLMTIMEOUT</a>);
<a name="l1734"><span class="linenum">1734</span></a>              return true;
<a name="l1735"><span class="linenum">1735</span></a>          }
<a name="l1736"><span class="linenum">1736</span></a>          return false;
<a name="l1737"><span class="linenum">1737</span></a>      }
<a name="l1738"><span class="linenum">1738</span></a>  
<a name="l1739"><span class="linenum">1739</span></a>      <span class="comment">/**</span>
<a name="l1740"><span class="linenum">1740</span></a>  <span class="comment">     * Find the session set by ntlmsso_magic(), validate it and</span>
<a name="l1741"><span class="linenum">1741</span></a>  <span class="comment">     * call authenticate_user_login() to authenticate the user through</span>
<a name="l1742"><span class="linenum">1742</span></a>  <span class="comment">     * the auth machinery.</span>
<a name="l1743"><span class="linenum">1743</span></a>  <span class="comment">     *</span>
<a name="l1744"><span class="linenum">1744</span></a>  <span class="comment">     * It is complemented by a similar check in user_login().</span>
<a name="l1745"><span class="linenum">1745</span></a>  <span class="comment">     *</span>
<a name="l1746"><span class="linenum">1746</span></a>  <span class="comment">     * If it succeeds, it never returns.</span>
<a name="l1747"><span class="linenum">1747</span></a>  <span class="comment">     *</span>
<a name="l1748"><span class="linenum">1748</span></a>  <span class="comment">     */</span>
<a name="l1749"><span class="linenum">1749</span></a>      function <a class="function" onClick="logFunction('ntlmsso_finish')" href="../../_functions/ntlmsso_finish.html" onMouseOver="funcPopup(event,'ntlmsso_finish')">ntlmsso_finish</a>() {
<a name="l1750"><span class="linenum">1750</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>;
<a name="l1751"><span class="linenum">1751</span></a>  
<a name="l1752"><span class="linenum">1752</span></a>          <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <a class="function" onClick="logFunction('sesskey')" href="../../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>();
<a name="l1753"><span class="linenum">1753</span></a>          <a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('cf')" href="../../_variables/cf.html">$cf</a> = <a class="function" onClick="logFunction('get_cache_flags')" href="../../_functions/get_cache_flags.html" onMouseOver="funcPopup(event,'get_cache_flags')">get_cache_flags</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>.'/ntlmsess');
<a name="l1754"><span class="linenum">1754</span></a>          if (!isset(<a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('cf')" href="../../_variables/cf.html">$cf</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>]) || <a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('cf')" href="../../_variables/cf.html">$cf</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>] === '') {
<a name="l1755"><span class="linenum">1755</span></a>              return false;
<a name="l1756"><span class="linenum">1756</span></a>          }
<a name="l1757"><span class="linenum">1757</span></a>          <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>   = <a class="var it12910" onMouseOver="hilite(12910)" onMouseOut="lolite()" onClick="logVariable('cf')" href="../../_variables/cf.html">$cf</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>];
<a name="l1758"><span class="linenum">1758</span></a>  
<a name="l1759"><span class="linenum">1759</span></a>  <span class="comment">        // Here we want to trigger the whole authentication machinery</span>
<a name="l1760"><span class="linenum">1760</span></a>  <span class="comment">        // to make sure no step is bypassed...</span>
<a name="l1761"><span class="linenum">1761</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="function" onClick="logFunction('authenticate_user_login')" href="../../_functions/authenticate_user_login.html" onMouseOver="funcPopup(event,'authenticate_user_login')">authenticate_user_login</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../_variables/username.html">$username</a>, <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l1762"><span class="linenum">1762</span></a>          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l1763"><span class="linenum">1763</span></a>              <a class="function" onClick="logFunction('complete_user_login')" href="../../_functions/complete_user_login.html" onMouseOver="funcPopup(event,'complete_user_login')">complete_user_login</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l1764"><span class="linenum">1764</span></a>  
<a name="l1765"><span class="linenum">1765</span></a>  <span class="comment">            // Cleanup the key to prevent reuse...</span>
<a name="l1766"><span class="linenum">1766</span></a>  <span class="comment">            // and to allow re-logins with normal credentials</span>
<a name="l1767"><span class="linenum">1767</span></a>              <a class="function" onClick="logFunction('unset_cache_flag')" href="../../_functions/unset_cache_flag.html" onMouseOver="funcPopup(event,'unset_cache_flag')">unset_cache_flag</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>.'/ntlmsess', <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l1768"><span class="linenum">1768</span></a>  
<a name="l1769"><span class="linenum">1769</span></a>  <span class="comment">            // Redirection</span>
<a name="l1770"><span class="linenum">1770</span></a>              if (<a class="function" onClick="logFunction('user_not_fully_set_up')" href="../../_functions/user_not_fully_set_up.html" onMouseOver="funcPopup(event,'user_not_fully_set_up')">user_not_fully_set_up</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>)) {
<a name="l1771"><span class="linenum">1771</span></a>                  <a class="var it4809" onMouseOver="hilite(4809)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../../_variables/urltogo.html">$urltogo</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'<a class="filename" href="../../user/edit.php.html">/user/edit.php</a>';
<a name="l1772"><span class="linenum">1772</span></a>  <span class="comment">                // We don't delete $SESSION-&gt;wantsurl yet, so we get there later</span>
<a name="l1773"><span class="linenum">1773</span></a>              } else if (isset(<a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../../_variables/wantsurl.html">wantsurl</a>) and (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../../_variables/wantsurl.html">wantsurl</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>) === 0)) {
<a name="l1774"><span class="linenum">1774</span></a>                  <a class="var it4809" onMouseOver="hilite(4809)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../../_variables/urltogo.html">$urltogo</a> = <a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../../_variables/wantsurl.html">wantsurl</a>;    <span class="comment">// Because it's an address in this site</span>
<a name="l1775"><span class="linenum">1775</span></a>                  unset(<a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../../_variables/wantsurl.html">wantsurl</a>);
<a name="l1776"><span class="linenum">1776</span></a>              } else {
<a name="l1777"><span class="linenum">1777</span></a>  <span class="comment">                // No wantsurl stored or external - go to homepage</span>
<a name="l1778"><span class="linenum">1778</span></a>                  <a class="var it4809" onMouseOver="hilite(4809)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../../_variables/urltogo.html">$urltogo</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>.'/';
<a name="l1779"><span class="linenum">1779</span></a>                  unset(<a class="var it584" onMouseOver="hilite(584)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it39589" onMouseOver="hilite(39589)" onMouseOut="lolite()" href="../../_variables/wantsurl.html">wantsurl</a>);
<a name="l1780"><span class="linenum">1780</span></a>              }
<a name="l1781"><span class="linenum">1781</span></a>  <span class="comment">            // We do not want to redirect if we are in a PHPUnit test.</span>
<a name="l1782"><span class="linenum">1782</span></a>              if (!<a class="constant" onClick="logConstant('PHPUNIT_TEST')" href="../../_constants/PHPUNIT_TEST.html" onMouseOver="constPopup(event,'PHPUNIT_TEST')">PHPUNIT_TEST</a>) {
<a name="l1783"><span class="linenum">1783</span></a>                  <a class="function" onClick="logFunction('redirect')" href="../../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<a class="var it4809" onMouseOver="hilite(4809)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../../_variables/urltogo.html">$urltogo</a>);
<a name="l1784"><span class="linenum">1784</span></a>              }
<a name="l1785"><span class="linenum">1785</span></a>          }
<a name="l1786"><span class="linenum">1786</span></a>  <span class="comment">        // Should never reach here.</span>
<a name="l1787"><span class="linenum">1787</span></a>          return false;
<a name="l1788"><span class="linenum">1788</span></a>      }
<a name="l1789"><span class="linenum">1789</span></a>  
<a name="l1790"><span class="linenum">1790</span></a>      <span class="comment">/**</span>
<a name="l1791"><span class="linenum">1791</span></a>  <span class="comment">     * Sync roles for this user</span>
<a name="l1792"><span class="linenum">1792</span></a>  <span class="comment">     *</span>
<a name="l1793"><span class="linenum">1793</span></a>  <span class="comment">     * @param $user object user object (without system magic quotes)</span>
<a name="l1794"><span class="linenum">1794</span></a>  <span class="comment">     */</span>
<a name="l1795"><span class="linenum">1795</span></a>      function <a class="function" onClick="logFunction('sync_roles')" href="../../_functions/sync_roles.html" onMouseOver="funcPopup(event,'sync_roles')">sync_roles</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>) {
<a name="l1796"><span class="linenum">1796</span></a>          <a class="var it25401" onMouseOver="hilite(25401)" onMouseOut="lolite()" onClick="logVariable('iscreator')" href="../../_variables/iscreator.html">$iscreator</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('iscreator')" href="../../_functions/iscreator.html" onMouseOver="funcPopup(event,'iscreator')">iscreator</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>);
<a name="l1797"><span class="linenum">1797</span></a>          if (<a class="var it25401" onMouseOver="hilite(25401)" onMouseOut="lolite()" onClick="logVariable('iscreator')" href="../../_variables/iscreator.html">$iscreator</a> === null) {
<a name="l1798"><span class="linenum">1798</span></a>              return; <span class="comment">// Nothing to sync - creators not configured</span>
<a name="l1799"><span class="linenum">1799</span></a>          }
<a name="l1800"><span class="linenum">1800</span></a>  
<a name="l1801"><span class="linenum">1801</span></a>          if (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a> = <a class="function" onClick="logFunction('get_archetype_roles')" href="../../_functions/get_archetype_roles.html" onMouseOver="funcPopup(event,'get_archetype_roles')">get_archetype_roles</a>('coursecreator')) {
<a name="l1802"><span class="linenum">1802</span></a>              <a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a>);      <span class="comment">// We can only use one, let's use the first one</span>
<a name="l1803"><span class="linenum">1803</span></a>              <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../../_variables/systemcontext.html">$systemcontext</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l1804"><span class="linenum">1804</span></a>  
<a name="l1805"><span class="linenum">1805</span></a>              if (<a class="var it25401" onMouseOver="hilite(25401)" onMouseOut="lolite()" onClick="logVariable('iscreator')" href="../../_variables/iscreator.html">$iscreator</a>) { // Following calls will not create duplicates
<a name="l1806"><span class="linenum">1806</span></a>                  <a class="function" onClick="logFunction('role_assign')" href="../../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a>-&gt;<a onClick="logVariable('id')" class="var it40805" onMouseOver="hilite(40805)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../../_variables/systemcontext.html">$systemcontext</a>-&gt;<a onClick="logVariable('id')" class="var it39845" onMouseOver="hilite(39845)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('roleauth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/roleauth.html">roleauth</a>);
<a name="l1807"><span class="linenum">1807</span></a>              } else {
<a name="l1808"><span class="linenum">1808</span></a>  <span class="comment">                // Unassign only if previously assigned by this plugin!</span>
<a name="l1809"><span class="linenum">1809</span></a>                  <a class="function" onClick="logFunction('role_unassign')" href="../../_functions/role_unassign.html" onMouseOver="funcPopup(event,'role_unassign')">role_unassign</a>(<a class="var it18645" onMouseOver="hilite(18645)" onMouseOut="lolite()" onClick="logVariable('creatorrole')" href="../../_variables/creatorrole.html">$creatorrole</a>-&gt;<a onClick="logVariable('id')" class="var it40805" onMouseOver="hilite(40805)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../../_variables/systemcontext.html">$systemcontext</a>-&gt;<a onClick="logVariable('id')" class="var it39845" onMouseOver="hilite(39845)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('roleauth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/roleauth.html">roleauth</a>);
<a name="l1810"><span class="linenum">1810</span></a>              }
<a name="l1811"><span class="linenum">1811</span></a>          }
<a name="l1812"><span class="linenum">1812</span></a>      }
<a name="l1813"><span class="linenum">1813</span></a>  
<a name="l1814"><span class="linenum">1814</span></a>      <span class="comment">/**</span>
<a name="l1815"><span class="linenum">1815</span></a>  <span class="comment">     * Prints a form for configuring this authentication plugin.</span>
<a name="l1816"><span class="linenum">1816</span></a>  <span class="comment">     *</span>
<a name="l1817"><span class="linenum">1817</span></a>  <span class="comment">     * This function is called from admin/auth.php, and outputs a full page with</span>
<a name="l1818"><span class="linenum">1818</span></a>  <span class="comment">     * a form for configuring this plugin.</span>
<a name="l1819"><span class="linenum">1819</span></a>  <span class="comment">     *</span>
<a name="l1820"><span class="linenum">1820</span></a>  <span class="comment">     * @param array $page An object containing all the data for this page.</span>
<a name="l1821"><span class="linenum">1821</span></a>  <span class="comment">     */</span>
<a name="l1822"><span class="linenum">1822</span></a>      function <a class="function" onClick="logFunction('config_form')" href="../../_functions/config_form.html" onMouseOver="funcPopup(event,'config_form')">config_form</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>, <a class="var it1340" onMouseOver="hilite(1340)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>, <a class="var it7573" onMouseOver="hilite(7573)" onMouseOut="lolite()" onClick="logVariable('user_fields')" href="../../_variables/user_fields.html">$user_fields</a>) {
<a name="l1823"><span class="linenum">1823</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l1824"><span class="linenum">1824</span></a>  
<a name="l1825"><span class="linenum">1825</span></a>          if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('ldap_connect')) { // Is php-ldap really there?
<a name="l1826"><span class="linenum">1826</span></a>              echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('auth_ldap_noextension', 'auth_ldap'));
<a name="l1827"><span class="linenum">1827</span></a>              return;
<a name="l1828"><span class="linenum">1828</span></a>          }
<a name="l1829"><span class="linenum">1829</span></a>  
<a name="l1830"><span class="linenum">1830</span></a>          include(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../auth/ldap/config.html.html">/auth/ldap/config.html</a>');
<a name="l1831"><span class="linenum">1831</span></a>      }
<a name="l1832"><span class="linenum">1832</span></a>  
<a name="l1833"><span class="linenum">1833</span></a>      <span class="comment">/**</span>
<a name="l1834"><span class="linenum">1834</span></a>  <span class="comment">     * Processes and stores configuration data for this authentication plugin.</span>
<a name="l1835"><span class="linenum">1835</span></a>  <span class="comment">     */</span>
<a name="l1836"><span class="linenum">1836</span></a>      function <a class="function" onClick="logFunction('process_config')" href="../../_functions/process_config.html" onMouseOver="funcPopup(event,'process_config')">process_config</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>) {
<a name="l1837"><span class="linenum">1837</span></a>  <span class="comment">        // Set to defaults if undefined</span>
<a name="l1838"><span class="linenum">1838</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('host_url')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/host_url.html">host_url</a>)) {
<a name="l1839"><span class="linenum">1839</span></a>               <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('host_url')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/host_url.html">host_url</a> = '';
<a name="l1840"><span class="linenum">1840</span></a>          }
<a name="l1841"><span class="linenum">1841</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('start_tls')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/start_tls.html">start_tls</a>)) {
<a name="l1842"><span class="linenum">1842</span></a>               <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('start_tls')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/start_tls.html">start_tls</a> = false;
<a name="l1843"><span class="linenum">1843</span></a>          }
<a name="l1844"><span class="linenum">1844</span></a>          if (empty(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ldapencoding')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ldapencoding.html">ldapencoding</a>)) {
<a name="l1845"><span class="linenum">1845</span></a>           <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ldapencoding')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ldapencoding.html">ldapencoding</a> = 'utf-8';
<a name="l1846"><span class="linenum">1846</span></a>          }
<a name="l1847"><span class="linenum">1847</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('pagesize')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/pagesize.html">pagesize</a>)) {
<a name="l1848"><span class="linenum">1848</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('pagesize')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/pagesize.html">pagesize</a> = <a class="constant" onClick="logConstant('LDAP_DEFAULT_PAGESIZE')" href="../../_constants/LDAP_DEFAULT_PAGESIZE.html" onMouseOver="constPopup(event,'LDAP_DEFAULT_PAGESIZE')">LDAP_DEFAULT_PAGESIZE</a>;
<a name="l1849"><span class="linenum">1849</span></a>          }
<a name="l1850"><span class="linenum">1850</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('contexts')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/contexts.html">contexts</a>)) {
<a name="l1851"><span class="linenum">1851</span></a>               <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('contexts')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/contexts.html">contexts</a> = '';
<a name="l1852"><span class="linenum">1852</span></a>          }
<a name="l1853"><span class="linenum">1853</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('user_type')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/user_type.html">user_type</a>)) {
<a name="l1854"><span class="linenum">1854</span></a>               <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('user_type')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/user_type.html">user_type</a> = 'default';
<a name="l1855"><span class="linenum">1855</span></a>          }
<a name="l1856"><span class="linenum">1856</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('user_attribute')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/user_attribute.html">user_attribute</a>)) {
<a name="l1857"><span class="linenum">1857</span></a>               <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('user_attribute')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/user_attribute.html">user_attribute</a> = '';
<a name="l1858"><span class="linenum">1858</span></a>          }
<a name="l1859"><span class="linenum">1859</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('search_sub')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/search_sub.html">search_sub</a>)) {
<a name="l1860"><span class="linenum">1860</span></a>               <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('search_sub')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/search_sub.html">search_sub</a> = '';
<a name="l1861"><span class="linenum">1861</span></a>          }
<a name="l1862"><span class="linenum">1862</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('opt_deref')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/opt_deref.html">opt_deref</a>)) {
<a name="l1863"><span class="linenum">1863</span></a>               <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('opt_deref')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/opt_deref.html">opt_deref</a> = <a class="constant" onClick="logConstant('LDAP_DEREF_NEVER')" href="../../_constants/LDAP_DEREF_NEVER.html" onMouseOver="constPopup(event,'LDAP_DEREF_NEVER')">LDAP_DEREF_NEVER</a>;
<a name="l1864"><span class="linenum">1864</span></a>          }
<a name="l1865"><span class="linenum">1865</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('preventpassindb')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/preventpassindb.html">preventpassindb</a>)) {
<a name="l1866"><span class="linenum">1866</span></a>               <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('preventpassindb')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/preventpassindb.html">preventpassindb</a> = 0;
<a name="l1867"><span class="linenum">1867</span></a>          }
<a name="l1868"><span class="linenum">1868</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('bind_dn')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/bind_dn.html">bind_dn</a>)) {
<a name="l1869"><span class="linenum">1869</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('bind_dn')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/bind_dn.html">bind_dn</a> = '';
<a name="l1870"><span class="linenum">1870</span></a>          }
<a name="l1871"><span class="linenum">1871</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('bind_pw')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/bind_pw.html">bind_pw</a>)) {
<a name="l1872"><span class="linenum">1872</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('bind_pw')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/bind_pw.html">bind_pw</a> = '';
<a name="l1873"><span class="linenum">1873</span></a>          }
<a name="l1874"><span class="linenum">1874</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ldap_version')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ldap_version.html">ldap_version</a>)) {
<a name="l1875"><span class="linenum">1875</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ldap_version')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ldap_version.html">ldap_version</a> = '3';
<a name="l1876"><span class="linenum">1876</span></a>          }
<a name="l1877"><span class="linenum">1877</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('objectclass')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/objectclass.html">objectclass</a>)) {
<a name="l1878"><span class="linenum">1878</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('objectclass')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/objectclass.html">objectclass</a> = '';
<a name="l1879"><span class="linenum">1879</span></a>          }
<a name="l1880"><span class="linenum">1880</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('memberattribute')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/memberattribute.html">memberattribute</a>)) {
<a name="l1881"><span class="linenum">1881</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('memberattribute')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/memberattribute.html">memberattribute</a> = '';
<a name="l1882"><span class="linenum">1882</span></a>          }
<a name="l1883"><span class="linenum">1883</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('memberattribute_isdn')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/memberattribute_isdn.html">memberattribute_isdn</a>)) {
<a name="l1884"><span class="linenum">1884</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('memberattribute_isdn')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/memberattribute_isdn.html">memberattribute_isdn</a> = '';
<a name="l1885"><span class="linenum">1885</span></a>          }
<a name="l1886"><span class="linenum">1886</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('creators')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/creators.html">creators</a>)) {
<a name="l1887"><span class="linenum">1887</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('creators')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/creators.html">creators</a> = '';
<a name="l1888"><span class="linenum">1888</span></a>          }
<a name="l1889"><span class="linenum">1889</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('create_context')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/create_context.html">create_context</a>)) {
<a name="l1890"><span class="linenum">1890</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('create_context')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/create_context.html">create_context</a> = '';
<a name="l1891"><span class="linenum">1891</span></a>          }
<a name="l1892"><span class="linenum">1892</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('expiration')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/expiration.html">expiration</a>)) {
<a name="l1893"><span class="linenum">1893</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('expiration')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/expiration.html">expiration</a> = '';
<a name="l1894"><span class="linenum">1894</span></a>          }
<a name="l1895"><span class="linenum">1895</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('expiration_warning')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/expiration_warning.html">expiration_warning</a>)) {
<a name="l1896"><span class="linenum">1896</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('expiration_warning')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/expiration_warning.html">expiration_warning</a> = '10';
<a name="l1897"><span class="linenum">1897</span></a>          }
<a name="l1898"><span class="linenum">1898</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('expireattr')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/expireattr.html">expireattr</a>)) {
<a name="l1899"><span class="linenum">1899</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('expireattr')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/expireattr.html">expireattr</a> = '';
<a name="l1900"><span class="linenum">1900</span></a>          }
<a name="l1901"><span class="linenum">1901</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('gracelogins')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/gracelogins.html">gracelogins</a>)) {
<a name="l1902"><span class="linenum">1902</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('gracelogins')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/gracelogins.html">gracelogins</a> = '';
<a name="l1903"><span class="linenum">1903</span></a>          }
<a name="l1904"><span class="linenum">1904</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('graceattr')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/graceattr.html">graceattr</a>)) {
<a name="l1905"><span class="linenum">1905</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('graceattr')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/graceattr.html">graceattr</a> = '';
<a name="l1906"><span class="linenum">1906</span></a>          }
<a name="l1907"><span class="linenum">1907</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('auth_user_create')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/auth_user_create.html">auth_user_create</a>)) {
<a name="l1908"><span class="linenum">1908</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('auth_user_create')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/auth_user_create.html">auth_user_create</a> = '';
<a name="l1909"><span class="linenum">1909</span></a>          }
<a name="l1910"><span class="linenum">1910</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('forcechangepassword')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/forcechangepassword.html">forcechangepassword</a>)) {
<a name="l1911"><span class="linenum">1911</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('forcechangepassword')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/forcechangepassword.html">forcechangepassword</a> = 0;
<a name="l1912"><span class="linenum">1912</span></a>          }
<a name="l1913"><span class="linenum">1913</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('stdchangepassword')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/stdchangepassword.html">stdchangepassword</a>)) {
<a name="l1914"><span class="linenum">1914</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('stdchangepassword')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/stdchangepassword.html">stdchangepassword</a> = 0;
<a name="l1915"><span class="linenum">1915</span></a>          }
<a name="l1916"><span class="linenum">1916</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('passtype')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/passtype.html">passtype</a>)) {
<a name="l1917"><span class="linenum">1917</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('passtype')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/passtype.html">passtype</a> = 'plaintext';
<a name="l1918"><span class="linenum">1918</span></a>          }
<a name="l1919"><span class="linenum">1919</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('changepasswordurl')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/changepasswordurl.html">changepasswordurl</a>)) {
<a name="l1920"><span class="linenum">1920</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('changepasswordurl')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/changepasswordurl.html">changepasswordurl</a> = '';
<a name="l1921"><span class="linenum">1921</span></a>          }
<a name="l1922"><span class="linenum">1922</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('removeuser')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/removeuser.html">removeuser</a>)) {
<a name="l1923"><span class="linenum">1923</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('removeuser')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/removeuser.html">removeuser</a> = <a class="constant" onClick="logConstant('AUTH_REMOVEUSER_KEEP')" href="../../_constants/AUTH_REMOVEUSER_KEEP.html" onMouseOver="constPopup(event,'AUTH_REMOVEUSER_KEEP')">AUTH_REMOVEUSER_KEEP</a>;
<a name="l1924"><span class="linenum">1924</span></a>          }
<a name="l1925"><span class="linenum">1925</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_enabled')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_enabled.html">ntlmsso_enabled</a>)) {
<a name="l1926"><span class="linenum">1926</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_enabled')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_enabled.html">ntlmsso_enabled</a> = 0;
<a name="l1927"><span class="linenum">1927</span></a>          }
<a name="l1928"><span class="linenum">1928</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_subnet')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_subnet.html">ntlmsso_subnet</a>)) {
<a name="l1929"><span class="linenum">1929</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_subnet')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_subnet.html">ntlmsso_subnet</a> = '';
<a name="l1930"><span class="linenum">1930</span></a>          }
<a name="l1931"><span class="linenum">1931</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_ie_fastpath')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_ie_fastpath.html">ntlmsso_ie_fastpath</a>)) {
<a name="l1932"><span class="linenum">1932</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_ie_fastpath')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_ie_fastpath.html">ntlmsso_ie_fastpath</a> = 0;
<a name="l1933"><span class="linenum">1933</span></a>          }
<a name="l1934"><span class="linenum">1934</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_type')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_type.html">ntlmsso_type</a>)) {
<a name="l1935"><span class="linenum">1935</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_type')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_type.html">ntlmsso_type</a> = 'ntlm';
<a name="l1936"><span class="linenum">1936</span></a>          }
<a name="l1937"><span class="linenum">1937</span></a>          if (!isset(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_remoteuserformat')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_remoteuserformat.html">ntlmsso_remoteuserformat</a>)) {
<a name="l1938"><span class="linenum">1938</span></a>              <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_remoteuserformat')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_remoteuserformat.html">ntlmsso_remoteuserformat</a> = '';
<a name="l1939"><span class="linenum">1939</span></a>          }
<a name="l1940"><span class="linenum">1940</span></a>  
<a name="l1941"><span class="linenum">1941</span></a>  <span class="comment">        // Try to remove duplicates before storing the contexts (to avoid problems in sync_users()).</span>
<a name="l1942"><span class="linenum">1942</span></a>          <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('contexts')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/contexts.html">contexts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(';', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('contexts')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/contexts.html">contexts</a>);
<a name="l1943"><span class="linenum">1943</span></a>          <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('contexts')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/contexts.html">contexts</a> = <a class="phpfunction" onClick="logFunction('array_map')" href="../../_functions/array_map.html" onMouseOver="phpfuncPopup(event,'array_map')">array_map</a>(<a class="phpfunction" onClick="logFunction('create_function')" href="../../_functions/create_function.html" onMouseOver="phpfuncPopup(event,'create_function')">create_function</a>('<a class="var it458" onMouseOver="hilite(458)" onMouseOut="lolite()" onClick="logVariable('x')" href="../../_variables/x.html">$x</a>', 'return <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it458" onMouseOver="hilite(458)" onMouseOut="lolite()" onClick="logVariable('x')" href="../../_variables/x.html">$x</a>));'),
<a name="l1944"><span class="linenum">1944</span></a>                                        <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('contexts')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/contexts.html">contexts</a>);
<a name="l1945"><span class="linenum">1945</span></a>          <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('contexts')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/contexts.html">contexts</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(';', <a class="phpfunction" onClick="logFunction('array_unique')" href="../../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('contexts')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/contexts.html">contexts</a>));
<a name="l1946"><span class="linenum">1946</span></a>  
<a name="l1947"><span class="linenum">1947</span></a>  <span class="comment">        // Save settings</span>
<a name="l1948"><span class="linenum">1948</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('host_url', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('host_url')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/host_url.html">host_url</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1949"><span class="linenum">1949</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('start_tls', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('start_tls')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/start_tls.html">start_tls</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1950"><span class="linenum">1950</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('ldapencoding', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ldapencoding')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ldapencoding.html">ldapencoding</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1951"><span class="linenum">1951</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('pagesize', (int)<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('pagesize')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/pagesize.html">pagesize</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1952"><span class="linenum">1952</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('contexts', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('contexts')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/contexts.html">contexts</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1953"><span class="linenum">1953</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('user_type', <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('user_type')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/user_type.html">user_type</a>)), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1954"><span class="linenum">1954</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('user_attribute', <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('user_attribute')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/user_attribute.html">user_attribute</a>)), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1955"><span class="linenum">1955</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('search_sub', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('search_sub')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/search_sub.html">search_sub</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1956"><span class="linenum">1956</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('opt_deref', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('opt_deref')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/opt_deref.html">opt_deref</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1957"><span class="linenum">1957</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('preventpassindb', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('preventpassindb')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/preventpassindb.html">preventpassindb</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1958"><span class="linenum">1958</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('bind_dn', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('bind_dn')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/bind_dn.html">bind_dn</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1959"><span class="linenum">1959</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('bind_pw', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('bind_pw')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/bind_pw.html">bind_pw</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1960"><span class="linenum">1960</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('ldap_version', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ldap_version')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ldap_version.html">ldap_version</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1961"><span class="linenum">1961</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('objectclass', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('objectclass')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/objectclass.html">objectclass</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1962"><span class="linenum">1962</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('memberattribute', <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('memberattribute')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/memberattribute.html">memberattribute</a>)), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1963"><span class="linenum">1963</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('memberattribute_isdn', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('memberattribute_isdn')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/memberattribute_isdn.html">memberattribute_isdn</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1964"><span class="linenum">1964</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('creators', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('creators')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/creators.html">creators</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1965"><span class="linenum">1965</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('create_context', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('create_context')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/create_context.html">create_context</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1966"><span class="linenum">1966</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('expiration', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('expiration')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/expiration.html">expiration</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1967"><span class="linenum">1967</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('expiration_warning', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('expiration_warning')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/expiration_warning.html">expiration_warning</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1968"><span class="linenum">1968</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('expireattr', <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('expireattr')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/expireattr.html">expireattr</a>)), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1969"><span class="linenum">1969</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('gracelogins', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('gracelogins')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/gracelogins.html">gracelogins</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1970"><span class="linenum">1970</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('graceattr', <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('graceattr')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/graceattr.html">graceattr</a>)), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1971"><span class="linenum">1971</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('auth_user_create', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('auth_user_create')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/auth_user_create.html">auth_user_create</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1972"><span class="linenum">1972</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('forcechangepassword', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('forcechangepassword')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/forcechangepassword.html">forcechangepassword</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1973"><span class="linenum">1973</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('stdchangepassword', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('stdchangepassword')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/stdchangepassword.html">stdchangepassword</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1974"><span class="linenum">1974</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('passtype', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('passtype')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/passtype.html">passtype</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1975"><span class="linenum">1975</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('changepasswordurl', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('changepasswordurl')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/changepasswordurl.html">changepasswordurl</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1976"><span class="linenum">1976</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('removeuser', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('removeuser')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/removeuser.html">removeuser</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1977"><span class="linenum">1977</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('ntlmsso_enabled', (int)<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_enabled')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_enabled.html">ntlmsso_enabled</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1978"><span class="linenum">1978</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('ntlmsso_subnet', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_subnet')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_subnet.html">ntlmsso_subnet</a>), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1979"><span class="linenum">1979</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('ntlmsso_ie_fastpath', (int)<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_ie_fastpath')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_ie_fastpath.html">ntlmsso_ie_fastpath</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pluginconfig')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/pluginconfig.html">pluginconfig</a>);
<a name="l1980"><span class="linenum">1980</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('ntlmsso_type', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_type')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_type.html">ntlmsso_type</a>, 'auth/ldap');
<a name="l1981"><span class="linenum">1981</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('ntlmsso_remoteuserformat', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>-&gt;<a onClick="logVariable('ntlmsso_remoteuserformat')" class="var it39457" onMouseOver="hilite(39457)" onMouseOut="lolite()" href="../../_variables/ntlmsso_remoteuserformat.html">ntlmsso_remoteuserformat</a>), 'auth/ldap');
<a name="l1982"><span class="linenum">1982</span></a>  
<a name="l1983"><span class="linenum">1983</span></a>          return true;
<a name="l1984"><span class="linenum">1984</span></a>      }
<a name="l1985"><span class="linenum">1985</span></a>  
<a name="l1986"><span class="linenum">1986</span></a>      <span class="comment">/**</span>
<a name="l1987"><span class="linenum">1987</span></a>  <span class="comment">     * Get password expiration time for a given user from Active Directory</span>
<a name="l1988"><span class="linenum">1988</span></a>  <span class="comment">     *</span>
<a name="l1989"><span class="linenum">1989</span></a>  <span class="comment">     * @param string $pwdlastset The time last time we changed the password.</span>
<a name="l1990"><span class="linenum">1990</span></a>  <span class="comment">     * @param resource $lcapconn The open LDAP connection.</span>
<a name="l1991"><span class="linenum">1991</span></a>  <span class="comment">     * @param string $user_dn The distinguished name of the user we are checking.</span>
<a name="l1992"><span class="linenum">1992</span></a>  <span class="comment">     *</span>
<a name="l1993"><span class="linenum">1993</span></a>  <span class="comment">     * @return string $unixtime</span>
<a name="l1994"><span class="linenum">1994</span></a>  <span class="comment">     */</span>
<a name="l1995"><span class="linenum">1995</span></a>      function <a class="function" onClick="logFunction('ldap_get_ad_pwdexpire')" href="../../_functions/ldap_get_ad_pwdexpire.html" onMouseOver="funcPopup(event,'ldap_get_ad_pwdexpire')">ldap_get_ad_pwdexpire</a>(<a class="var it37742" onMouseOver="hilite(37742)" onMouseOut="lolite()" onClick="logVariable('pwdlastset')" href="../../_variables/pwdlastset.html">$pwdlastset</a>, <a class="var it37743" onMouseOver="hilite(37743)" onMouseOut="lolite()" onClick="logVariable('ldapconn')" href="../../_variables/ldapconn.html">$ldapconn</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>){
<a name="l1996"><span class="linenum">1996</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1997"><span class="linenum">1997</span></a>  
<a name="l1998"><span class="linenum">1998</span></a>          if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('bcsub')) {
<a name="l1999"><span class="linenum">1999</span></a>              <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('needbcmath', 'auth_ldap'));
<a name="l2000"><span class="linenum">2000</span></a>              return 0;
<a name="l2001"><span class="linenum">2001</span></a>          }
<a name="l2002"><span class="linenum">2002</span></a>  
<a name="l2003"><span class="linenum">2003</span></a>  <span class="comment">        // If UF_DONT_EXPIRE_PASSWD flag is set in user's</span>
<a name="l2004"><span class="linenum">2004</span></a>  <span class="comment">        // userAccountControl attribute, the password doesn't expire.</span>
<a name="l2005"><span class="linenum">2005</span></a>          <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a> = <a class="phpfunction" onClick="logFunction('ldap_read')" href="../../_functions/ldap_read.html" onMouseOver="phpfuncPopup(event,'ldap_read')">ldap_read</a>(<a class="var it37743" onMouseOver="hilite(37743)" onMouseOut="lolite()" onClick="logVariable('ldapconn')" href="../../_variables/ldapconn.html">$ldapconn</a>, <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>, '(objectClass=*)',
<a name="l2006"><span class="linenum">2006</span></a>                          array('userAccountControl'));
<a name="l2007"><span class="linenum">2007</span></a>          if (!<a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>) {
<a name="l2008"><span class="linenum">2008</span></a>              <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('useracctctrlerror', 'auth_ldap', <a class="var it37719" onMouseOver="hilite(37719)" onMouseOut="lolite()" onClick="logVariable('user_dn')" href="../../_variables/user_dn.html">$user_dn</a>));
<a name="l2009"><span class="linenum">2009</span></a>  <span class="comment">            // Don't expire password, as we are not sure if it has to be</span>
<a name="l2010"><span class="linenum">2010</span></a>  <span class="comment">            // expired or not.</span>
<a name="l2011"><span class="linenum">2011</span></a>              return 0;
<a name="l2012"><span class="linenum">2012</span></a>          }
<a name="l2013"><span class="linenum">2013</span></a>  
<a name="l2014"><span class="linenum">2014</span></a>          <a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a> = <a class="function" onClick="logFunction('ldap_get_entries_moodle')" href="../../_functions/ldap_get_entries_moodle.html" onMouseOver="funcPopup(event,'ldap_get_entries_moodle')">ldap_get_entries_moodle</a>(<a class="var it37743" onMouseOver="hilite(37743)" onMouseOut="lolite()" onClick="logVariable('ldapconn')" href="../../_variables/ldapconn.html">$ldapconn</a>, <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>);
<a name="l2015"><span class="linenum">2015</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>(<a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>[0], CASE_LOWER);
<a name="l2016"><span class="linenum">2016</span></a>          <a class="var it37744" onMouseOver="hilite(37744)" onMouseOut="lolite()" onClick="logVariable('useraccountcontrol')" href="../../_variables/useraccountcontrol.html">$useraccountcontrol</a> = <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['useraccountcontrol'][0];
<a name="l2017"><span class="linenum">2017</span></a>          if (<a class="var it37744" onMouseOver="hilite(37744)" onMouseOut="lolite()" onClick="logVariable('useraccountcontrol')" href="../../_variables/useraccountcontrol.html">$useraccountcontrol</a> &amp; <a class="constant" onClick="logConstant('UF_DONT_EXPIRE_PASSWD')" href="../../_constants/UF_DONT_EXPIRE_PASSWD.html" onMouseOver="constPopup(event,'UF_DONT_EXPIRE_PASSWD')">UF_DONT_EXPIRE_PASSWD</a>) {
<a name="l2018"><span class="linenum">2018</span></a>  <span class="comment">            // Password doesn't expire.</span>
<a name="l2019"><span class="linenum">2019</span></a>              return 0;
<a name="l2020"><span class="linenum">2020</span></a>          }
<a name="l2021"><span class="linenum">2021</span></a>  
<a name="l2022"><span class="linenum">2022</span></a>  <span class="comment">        // If pwdLastSet is zero, the user must change his/her password now</span>
<a name="l2023"><span class="linenum">2023</span></a>  <span class="comment">        // (unless UF_DONT_EXPIRE_PASSWD flag is set, but we already</span>
<a name="l2024"><span class="linenum">2024</span></a>  <span class="comment">        // tested this above)</span>
<a name="l2025"><span class="linenum">2025</span></a>          if (<a class="var it37742" onMouseOver="hilite(37742)" onMouseOut="lolite()" onClick="logVariable('pwdlastset')" href="../../_variables/pwdlastset.html">$pwdlastset</a> === '0') {
<a name="l2026"><span class="linenum">2026</span></a>  <span class="comment">            // Password has expired</span>
<a name="l2027"><span class="linenum">2027</span></a>              return -1;
<a name="l2028"><span class="linenum">2028</span></a>          }
<a name="l2029"><span class="linenum">2029</span></a>  
<a name="l2030"><span class="linenum">2030</span></a>  <span class="comment">        // ----------------------------------------------------------------</span>
<a name="l2031"><span class="linenum">2031</span></a>  <span class="comment">        // Password expiration time in Active Directory is the composition of</span>
<a name="l2032"><span class="linenum">2032</span></a>  <span class="comment">        // two values:</span>
<a name="l2033"><span class="linenum">2033</span></a>  <span class="comment">        //</span>
<a name="l2034"><span class="linenum">2034</span></a>  <span class="comment">        //   - User's pwdLastSet attribute, that stores the last time</span>
<a name="l2035"><span class="linenum">2035</span></a>  <span class="comment">        //     the password was changed.</span>
<a name="l2036"><span class="linenum">2036</span></a>  <span class="comment">        //</span>
<a name="l2037"><span class="linenum">2037</span></a>  <span class="comment">        //   - Domain's maxPwdAge attribute, that sets how long</span>
<a name="l2038"><span class="linenum">2038</span></a>  <span class="comment">        //     passwords last in this domain.</span>
<a name="l2039"><span class="linenum">2039</span></a>  <span class="comment">        //</span>
<a name="l2040"><span class="linenum">2040</span></a>  <span class="comment">        // We already have the first value (passed in as a parameter). We</span>
<a name="l2041"><span class="linenum">2041</span></a>  <span class="comment">        // need to get the second one. As we don't know the domain DN, we</span>
<a name="l2042"><span class="linenum">2042</span></a>  <span class="comment">        // have to query rootDSE's defaultNamingContext attribute to get</span>
<a name="l2043"><span class="linenum">2043</span></a>  <span class="comment">        // it. Then we have to query that DN's maxPwdAge attribute to get</span>
<a name="l2044"><span class="linenum">2044</span></a>  <span class="comment">        // the real value.</span>
<a name="l2045"><span class="linenum">2045</span></a>  <span class="comment">        //</span>
<a name="l2046"><span class="linenum">2046</span></a>  <span class="comment">        // Once we have both values, we just need to combine them. But MS</span>
<a name="l2047"><span class="linenum">2047</span></a>  <span class="comment">        // chose to use a different base and unit for time measurements.</span>
<a name="l2048"><span class="linenum">2048</span></a>  <span class="comment">        // So we need to convert the values to Unix timestamps (see</span>
<a name="l2049"><span class="linenum">2049</span></a>  <span class="comment">        // details below).</span>
<a name="l2050"><span class="linenum">2050</span></a>  <span class="comment">        // ----------------------------------------------------------------</span>
<a name="l2051"><span class="linenum">2051</span></a>  
<a name="l2052"><span class="linenum">2052</span></a>          <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a> = <a class="phpfunction" onClick="logFunction('ldap_read')" href="../../_functions/ldap_read.html" onMouseOver="phpfuncPopup(event,'ldap_read')">ldap_read</a>(<a class="var it37743" onMouseOver="hilite(37743)" onMouseOut="lolite()" onClick="logVariable('ldapconn')" href="../../_variables/ldapconn.html">$ldapconn</a>, <a class="constant" onClick="logConstant('ROOTDSE')" href="../../_constants/ROOTDSE.html" onMouseOver="constPopup(event,'ROOTDSE')">ROOTDSE</a>, '(objectClass=*)',
<a name="l2053"><span class="linenum">2053</span></a>                          array('defaultNamingContext'));
<a name="l2054"><span class="linenum">2054</span></a>          if (!<a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>) {
<a name="l2055"><span class="linenum">2055</span></a>              <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('rootdseerror', 'auth_ldap'));
<a name="l2056"><span class="linenum">2056</span></a>              return 0;
<a name="l2057"><span class="linenum">2057</span></a>          }
<a name="l2058"><span class="linenum">2058</span></a>  
<a name="l2059"><span class="linenum">2059</span></a>          <a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a> = <a class="function" onClick="logFunction('ldap_get_entries_moodle')" href="../../_functions/ldap_get_entries_moodle.html" onMouseOver="funcPopup(event,'ldap_get_entries_moodle')">ldap_get_entries_moodle</a>(<a class="var it37743" onMouseOver="hilite(37743)" onMouseOut="lolite()" onClick="logVariable('ldapconn')" href="../../_variables/ldapconn.html">$ldapconn</a>, <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>);
<a name="l2060"><span class="linenum">2060</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>(<a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>[0], CASE_LOWER);
<a name="l2061"><span class="linenum">2061</span></a>          <a class="var it37745" onMouseOver="hilite(37745)" onMouseOut="lolite()" onClick="logVariable('domaindn')" href="../../_variables/domaindn.html">$domaindn</a> = <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['defaultnamingcontext'][0];
<a name="l2062"><span class="linenum">2062</span></a>  
<a name="l2063"><span class="linenum">2063</span></a>          <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a> = <a class="phpfunction" onClick="logFunction('ldap_read')" href="../../_functions/ldap_read.html" onMouseOver="phpfuncPopup(event,'ldap_read')">ldap_read</a> (<a class="var it37743" onMouseOver="hilite(37743)" onMouseOut="lolite()" onClick="logVariable('ldapconn')" href="../../_variables/ldapconn.html">$ldapconn</a>, <a class="var it37745" onMouseOver="hilite(37745)" onMouseOut="lolite()" onClick="logVariable('domaindn')" href="../../_variables/domaindn.html">$domaindn</a>, '(objectClass=*)',
<a name="l2064"><span class="linenum">2064</span></a>                           array('maxPwdAge'));
<a name="l2065"><span class="linenum">2065</span></a>          <a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a> = <a class="function" onClick="logFunction('ldap_get_entries_moodle')" href="../../_functions/ldap_get_entries_moodle.html" onMouseOver="funcPopup(event,'ldap_get_entries_moodle')">ldap_get_entries_moodle</a>(<a class="var it37743" onMouseOver="hilite(37743)" onMouseOut="lolite()" onClick="logVariable('ldapconn')" href="../../_variables/ldapconn.html">$ldapconn</a>, <a class="var it7914" onMouseOver="hilite(7914)" onMouseOut="lolite()" onClick="logVariable('sr')" href="../../_variables/sr.html">$sr</a>);
<a name="l2066"><span class="linenum">2066</span></a>          <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a> = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>(<a class="var it3473" onMouseOver="hilite(3473)" onMouseOut="lolite()" onClick="logVariable('entry')" href="../../_variables/entry.html">$entry</a>[0], CASE_LOWER);
<a name="l2067"><span class="linenum">2067</span></a>          <a class="var it37746" onMouseOver="hilite(37746)" onMouseOut="lolite()" onClick="logVariable('maxpwdage')" href="../../_variables/maxpwdage.html">$maxpwdage</a> = <a class="var it192" onMouseOver="hilite(192)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../_variables/info.html">$info</a>['maxpwdage'][0];
<a name="l2068"><span class="linenum">2068</span></a>  
<a name="l2069"><span class="linenum">2069</span></a>  <span class="comment">        // ----------------------------------------------------------------</span>
<a name="l2070"><span class="linenum">2070</span></a>  <span class="comment">        // MSDN says that &quot;pwdLastSet contains the number of 100 nanosecond</span>
<a name="l2071"><span class="linenum">2071</span></a>  <span class="comment">        // intervals since January 1, 1601 (UTC), stored in a 64 bit integer&quot;.</span>
<a name="l2072"><span class="linenum">2072</span></a>  <span class="comment">        //</span>
<a name="l2073"><span class="linenum">2073</span></a>  <span class="comment">        // According to Perl's Date::Manip, the number of seconds between</span>
<a name="l2074"><span class="linenum">2074</span></a>  <span class="comment">        // this date and Unix epoch is 11644473600. So we have to</span>
<a name="l2075"><span class="linenum">2075</span></a>  <span class="comment">        // substract this value to calculate a Unix time, once we have</span>
<a name="l2076"><span class="linenum">2076</span></a>  <span class="comment">        // scaled pwdLastSet to seconds. This is the script used to</span>
<a name="l2077"><span class="linenum">2077</span></a>  <span class="comment">        // calculate the value shown above:</span>
<a name="l2078"><span class="linenum">2078</span></a>  <span class="comment">        //</span>
<a name="l2079"><span class="linenum">2079</span></a>  <span class="comment">        //    #!/usr/bin/perl -w</span>
<a name="l2080"><span class="linenum">2080</span></a>  <span class="comment">        //</span>
<a name="l2081"><span class="linenum">2081</span></a>  <span class="comment">        //    use Date::Manip;</span>
<a name="l2082"><span class="linenum">2082</span></a>  <span class="comment">        //</span>
<a name="l2083"><span class="linenum">2083</span></a>  <span class="comment">        //    $date1 = ParseDate (&quot;160101010000 UTC&quot;);</span>
<a name="l2084"><span class="linenum">2084</span></a>  <span class="comment">        //    $date2 = ParseDate (&quot;197001010000 UTC&quot;);</span>
<a name="l2085"><span class="linenum">2085</span></a>  <span class="comment">        //    $delta = DateCalc($date1, $date2, \$err);</span>
<a name="l2086"><span class="linenum">2086</span></a>  <span class="comment">        //    $secs = Delta_Format($delta, 0, &quot;%st&quot;);</span>
<a name="l2087"><span class="linenum">2087</span></a>  <span class="comment">        //    print &quot;$secs \n&quot;;</span>
<a name="l2088"><span class="linenum">2088</span></a>  <span class="comment">        //</span>
<a name="l2089"><span class="linenum">2089</span></a>  <span class="comment">        // MSDN also says that &quot;maxPwdAge is stored as a large integer that</span>
<a name="l2090"><span class="linenum">2090</span></a>  <span class="comment">        // represents the number of 100 nanosecond intervals from the time</span>
<a name="l2091"><span class="linenum">2091</span></a>  <span class="comment">        // the password was set before the password expires.&quot; We also need</span>
<a name="l2092"><span class="linenum">2092</span></a>  <span class="comment">        // to scale this to seconds. Bear in mind that this value is stored</span>
<a name="l2093"><span class="linenum">2093</span></a>  <span class="comment">        // as a _negative_ quantity (at least in my AD domain).</span>
<a name="l2094"><span class="linenum">2094</span></a>  <span class="comment">        //</span>
<a name="l2095"><span class="linenum">2095</span></a>  <span class="comment">        // As a last remark, if the low 32 bits of maxPwdAge are equal to 0,</span>
<a name="l2096"><span class="linenum">2096</span></a>  <span class="comment">        // the maximum password age in the domain is set to 0, which means</span>
<a name="l2097"><span class="linenum">2097</span></a>  <span class="comment">        // passwords do not expire (see</span>
<a name="l2098"><span class="linenum">2098</span></a>  <span class="comment">        // http://msdn2.microsoft.com/en-us/library/ms974598.aspx)</span>
<a name="l2099"><span class="linenum">2099</span></a>  <span class="comment">        //</span>
<a name="l2100"><span class="linenum">2100</span></a>  <span class="comment">        // As the quantities involved are too big for PHP integers, we</span>
<a name="l2101"><span class="linenum">2101</span></a>  <span class="comment">        // need to use BCMath functions to work with arbitrary precision</span>
<a name="l2102"><span class="linenum">2102</span></a>  <span class="comment">        // numbers.</span>
<a name="l2103"><span class="linenum">2103</span></a>  <span class="comment">        // ----------------------------------------------------------------</span>
<a name="l2104"><span class="linenum">2104</span></a>  
<a name="l2105"><span class="linenum">2105</span></a>  <span class="comment">        // If the low order 32 bits are 0, then passwords do not expire in</span>
<a name="l2106"><span class="linenum">2106</span></a>  <span class="comment">        // the domain. Just do '$maxpwdage mod 2^32' and check the result</span>
<a name="l2107"><span class="linenum">2107</span></a>  <span class="comment">        // (2^32 = 4294967296)</span>
<a name="l2108"><span class="linenum">2108</span></a>          if (<a class="phpfunction" onClick="logFunction('bcmod')" href="../../_functions/bcmod.html" onMouseOver="phpfuncPopup(event,'bcmod')">bcmod</a> (<a class="var it37746" onMouseOver="hilite(37746)" onMouseOut="lolite()" onClick="logVariable('maxpwdage')" href="../../_variables/maxpwdage.html">$maxpwdage</a>, 4294967296) === '0') {
<a name="l2109"><span class="linenum">2109</span></a>              return 0;
<a name="l2110"><span class="linenum">2110</span></a>          }
<a name="l2111"><span class="linenum">2111</span></a>  
<a name="l2112"><span class="linenum">2112</span></a>  <span class="comment">        // Add up pwdLastSet and maxPwdAge to get password expiration</span>
<a name="l2113"><span class="linenum">2113</span></a>  <span class="comment">        // time, in MS time units. Remember maxPwdAge is stored as a</span>
<a name="l2114"><span class="linenum">2114</span></a>  <span class="comment">        // _negative_ quantity, so we need to substract it in fact.</span>
<a name="l2115"><span class="linenum">2115</span></a>          <a class="var it37747" onMouseOver="hilite(37747)" onMouseOut="lolite()" onClick="logVariable('pwdexpire')" href="../../_variables/pwdexpire.html">$pwdexpire</a> = <a class="phpfunction" onClick="logFunction('bcsub')" href="../../_functions/bcsub.html" onMouseOver="phpfuncPopup(event,'bcsub')">bcsub</a> (<a class="var it37742" onMouseOver="hilite(37742)" onMouseOut="lolite()" onClick="logVariable('pwdlastset')" href="../../_variables/pwdlastset.html">$pwdlastset</a>, <a class="var it37746" onMouseOver="hilite(37746)" onMouseOut="lolite()" onClick="logVariable('maxpwdage')" href="../../_variables/maxpwdage.html">$maxpwdage</a>);
<a name="l2116"><span class="linenum">2116</span></a>  
<a name="l2117"><span class="linenum">2117</span></a>  <span class="comment">        // Scale the result to convert it to Unix time units and return</span>
<a name="l2118"><span class="linenum">2118</span></a>  <span class="comment">        // that value.</span>
<a name="l2119"><span class="linenum">2119</span></a>          return <a class="phpfunction" onClick="logFunction('bcsub')" href="../../_functions/bcsub.html" onMouseOver="phpfuncPopup(event,'bcsub')">bcsub</a>( <a class="phpfunction" onClick="logFunction('bcdiv')" href="../../_functions/bcdiv.html" onMouseOver="phpfuncPopup(event,'bcdiv')">bcdiv</a>(<a class="var it37747" onMouseOver="hilite(37747)" onMouseOut="lolite()" onClick="logVariable('pwdexpire')" href="../../_variables/pwdexpire.html">$pwdexpire</a>, '10000000'), '11644473600');
<a name="l2120"><span class="linenum">2120</span></a>      }
<a name="l2121"><span class="linenum">2121</span></a>  
<a name="l2122"><span class="linenum">2122</span></a>      <span class="comment">/**</span>
<a name="l2123"><span class="linenum">2123</span></a>  <span class="comment">     * Connect to the LDAP server, using the plugin configured</span>
<a name="l2124"><span class="linenum">2124</span></a>  <span class="comment">     * settings. It's actually a wrapper around ldap_connect_moodle()</span>
<a name="l2125"><span class="linenum">2125</span></a>  <span class="comment">     *</span>
<a name="l2126"><span class="linenum">2126</span></a>  <span class="comment">     * @return resource A valid LDAP connection (or dies if it can't connect)</span>
<a name="l2127"><span class="linenum">2127</span></a>  <span class="comment">     */</span>
<a name="l2128"><span class="linenum">2128</span></a>      function <a class="function" onClick="logFunction('ldap_connect')" href="../../_functions/ldap_connect.html" onMouseOver="funcPopup(event,'ldap_connect')">ldap_connect</a>() {
<a name="l2129"><span class="linenum">2129</span></a>  <span class="comment">        // Cache ldap connections. They are expensive to set up</span>
<a name="l2130"><span class="linenum">2130</span></a>  <span class="comment">        // and can drain the TCP/IP ressources on the server if we</span>
<a name="l2131"><span class="linenum">2131</span></a>  <span class="comment">        // are syncing a lot of users (as we try to open a new connection</span>
<a name="l2132"><span class="linenum">2132</span></a>  <span class="comment">        // to get the user details). This is the least invasive way</span>
<a name="l2133"><span class="linenum">2133</span></a>  <span class="comment">        // to reuse existing connections without greater code surgery.</span>
<a name="l2134"><span class="linenum">2134</span></a>          if(!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconnection')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconnection.html">ldapconnection</a>)) {
<a name="l2135"><span class="linenum">2135</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconns')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconns.html">ldapconns</a>++;
<a name="l2136"><span class="linenum">2136</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconnection')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconnection.html">ldapconnection</a>;
<a name="l2137"><span class="linenum">2137</span></a>          }
<a name="l2138"><span class="linenum">2138</span></a>  
<a name="l2139"><span class="linenum">2139</span></a>          if(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a> = <a class="function" onClick="logFunction('ldap_connect_moodle')" href="../../_functions/ldap_connect_moodle.html" onMouseOver="funcPopup(event,'ldap_connect_moodle')">ldap_connect_moodle</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;host_url, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ldap_version,
<a name="l2140"><span class="linenum">2140</span></a>                                                   <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_type, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;bind_dn,
<a name="l2141"><span class="linenum">2141</span></a>                                                   <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;bind_pw, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;opt_deref,
<a name="l2142"><span class="linenum">2142</span></a>                                                   <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('debuginfo')" href="../../_variables/debuginfo.html">$debuginfo</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;start_tls)) {
<a name="l2143"><span class="linenum">2143</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconns')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconns.html">ldapconns</a> = 1;
<a name="l2144"><span class="linenum">2144</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconnection')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconnection.html">ldapconnection</a> = <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>;
<a name="l2145"><span class="linenum">2145</span></a>              return <a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>;
<a name="l2146"><span class="linenum">2146</span></a>          }
<a name="l2147"><span class="linenum">2147</span></a>  
<a name="l2148"><span class="linenum">2148</span></a>          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('auth_ldap_noconnect_all', 'auth_ldap', '', <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('debuginfo')" href="../../_variables/debuginfo.html">$debuginfo</a>);
<a name="l2149"><span class="linenum">2149</span></a>      }
<a name="l2150"><span class="linenum">2150</span></a>  
<a name="l2151"><span class="linenum">2151</span></a>      <span class="comment">/**</span>
<a name="l2152"><span class="linenum">2152</span></a>  <span class="comment">     * Disconnects from a LDAP server</span>
<a name="l2153"><span class="linenum">2153</span></a>  <span class="comment">     *</span>
<a name="l2154"><span class="linenum">2154</span></a>  <span class="comment">     * @param force boolean Forces closing the real connection to the LDAP server, ignoring any</span>
<a name="l2155"><span class="linenum">2155</span></a>  <span class="comment">     *                      cached connections. This is needed when we've used paged results</span>
<a name="l2156"><span class="linenum">2156</span></a>  <span class="comment">     *                      and want to use normal results again.</span>
<a name="l2157"><span class="linenum">2157</span></a>  <span class="comment">     */</span>
<a name="l2158"><span class="linenum">2158</span></a>      function <a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../../_variables/force.html">$force</a>=false) {
<a name="l2159"><span class="linenum">2159</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconns')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconns.html">ldapconns</a>--;
<a name="l2160"><span class="linenum">2160</span></a>          if ((<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconns')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconns.html">ldapconns</a> == 0) || (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../../_variables/force.html">$force</a>)) {
<a name="l2161"><span class="linenum">2161</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconns')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconns.html">ldapconns</a> = 0;
<a name="l2162"><span class="linenum">2162</span></a>              @<a class="function" onClick="logFunction('ldap_close')" href="../../_functions/ldap_close.html" onMouseOver="funcPopup(event,'ldap_close')">ldap_close</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconnection')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconnection.html">ldapconnection</a>);
<a name="l2163"><span class="linenum">2163</span></a>              unset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ldapconnection')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/ldapconnection.html">ldapconnection</a>);
<a name="l2164"><span class="linenum">2164</span></a>          }
<a name="l2165"><span class="linenum">2165</span></a>      }
<a name="l2166"><span class="linenum">2166</span></a>  
<a name="l2167"><span class="linenum">2167</span></a>      <span class="comment">/**</span>
<a name="l2168"><span class="linenum">2168</span></a>  <span class="comment">     * Search specified contexts for username and return the user dn</span>
<a name="l2169"><span class="linenum">2169</span></a>  <span class="comment">     * like: cn=username,ou=suborg,o=org. It's actually a wrapper</span>
<a name="l2170"><span class="linenum">2170</span></a>  <span class="comment">     * around ldap_find_userdn().</span>
<a name="l2171"><span class="linenum">2171</span></a>  <span class="comment">     *</span>
<a name="l2172"><span class="linenum">2172</span></a>  <span class="comment">     * @param resource $ldapconnection a valid LDAP connection</span>
<a name="l2173"><span class="linenum">2173</span></a>  <span class="comment">     * @param string $extusername the username to search (in external LDAP encoding, no db slashes)</span>
<a name="l2174"><span class="linenum">2174</span></a>  <span class="comment">     * @return mixed the user dn (external LDAP encoding) or false</span>
<a name="l2175"><span class="linenum">2175</span></a>  <span class="comment">     */</span>
<a name="l2176"><span class="linenum">2176</span></a>      function <a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>) {
<a name="l2177"><span class="linenum">2177</span></a>          <a class="var it19540" onMouseOver="hilite(19540)" onMouseOut="lolite()" onClick="logVariable('ldap_contexts')" href="../../_variables/ldap_contexts.html">$ldap_contexts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(';', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;contexts);
<a name="l2178"><span class="linenum">2178</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context)) {
<a name="l2179"><span class="linenum">2179</span></a>              <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it19540" onMouseOver="hilite(19540)" onMouseOut="lolite()" onClick="logVariable('ldap_contexts')" href="../../_variables/ldap_contexts.html">$ldap_contexts</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;create_context);
<a name="l2180"><span class="linenum">2180</span></a>          }
<a name="l2181"><span class="linenum">2181</span></a>  
<a name="l2182"><span class="linenum">2182</span></a>          return <a class="function" onClick="logFunction('ldap_find_userdn')" href="../../_functions/ldap_find_userdn.html" onMouseOver="funcPopup(event,'ldap_find_userdn')">ldap_find_userdn</a>(<a class="var it19546" onMouseOver="hilite(19546)" onMouseOut="lolite()" onClick="logVariable('ldapconnection')" href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a class="var it10980" onMouseOver="hilite(10980)" onMouseOut="lolite()" onClick="logVariable('extusername')" href="../../_variables/extusername.html">$extusername</a>, <a class="var it19540" onMouseOver="hilite(19540)" onMouseOut="lolite()" onClick="logVariable('ldap_contexts')" href="../../_variables/ldap_contexts.html">$ldap_contexts</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;objectclass,
<a name="l2183"><span class="linenum">2183</span></a>                                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;user_attribute, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;search_sub);
<a name="l2184"><span class="linenum">2184</span></a>      }
<a name="l2185"><span class="linenum">2185</span></a>  
<a name="l2186"><span class="linenum">2186</span></a>  
<a name="l2187"><span class="linenum">2187</span></a>      <span class="comment">/**</span>
<a name="l2188"><span class="linenum">2188</span></a>  <span class="comment">     * A chance to validate form data, and last chance to do stuff</span>
<a name="l2189"><span class="linenum">2189</span></a>  <span class="comment">     * before it is inserted in config_plugin</span>
<a name="l2190"><span class="linenum">2190</span></a>  <span class="comment">     *</span>
<a name="l2191"><span class="linenum">2191</span></a>  <span class="comment">     * @param object object with submitted configuration settings (without system magic quotes)</span>
<a name="l2192"><span class="linenum">2192</span></a>  <span class="comment">     * @param array $err array of error messages (passed by reference)</span>
<a name="l2193"><span class="linenum">2193</span></a>  <span class="comment">     */</span>
<a name="l2194"><span class="linenum">2194</span></a>      function <a class="function" onClick="logFunction('validate_form')" href="../../_functions/validate_form.html" onMouseOver="funcPopup(event,'validate_form')">validate_form</a>(<a class="var it596" onMouseOver="hilite(596)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../_variables/form.html">$form</a>, &amp;<a class="var it1340" onMouseOver="hilite(1340)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>) {
<a name="l2195"><span class="linenum">2195</span></a>          if (<a class="var it596" onMouseOver="hilite(596)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('ntlmsso_type')" class="var it39526" onMouseOver="hilite(39526)" onMouseOut="lolite()" href="../../_variables/ntlmsso_type.html">ntlmsso_type</a> == 'ntlm') {
<a name="l2196"><span class="linenum">2196</span></a>              <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it596" onMouseOver="hilite(596)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('ntlmsso_remoteuserformat')" class="var it39526" onMouseOver="hilite(39526)" onMouseOut="lolite()" href="../../_variables/ntlmsso_remoteuserformat.html">ntlmsso_remoteuserformat</a>);
<a name="l2197"><span class="linenum">2197</span></a>              if (!empty(<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>) &amp;&amp; !<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/%username%/i', <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>)) {
<a name="l2198"><span class="linenum">2198</span></a>                  <a class="var it1340" onMouseOver="hilite(1340)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>['ntlmsso_remoteuserformat'] = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('auth_ntlmsso_missing_username', 'auth_ldap');
<a name="l2199"><span class="linenum">2199</span></a>              }
<a name="l2200"><span class="linenum">2200</span></a>          }
<a name="l2201"><span class="linenum">2201</span></a>      }
<a name="l2202"><span class="linenum">2202</span></a>  
<a name="l2203"><span class="linenum">2203</span></a>  
<a name="l2204"><span class="linenum">2204</span></a>      <span class="comment">/**</span>
<a name="l2205"><span class="linenum">2205</span></a>  <span class="comment">     * When using NTLM SSO, the format of the remote username we get in</span>
<a name="l2206"><span class="linenum">2206</span></a>  <span class="comment">     * $_SERVER['REMOTE_USER'] may vary, depending on where from and how the web</span>
<a name="l2207"><span class="linenum">2207</span></a>  <span class="comment">     * server gets the data. So we let the admin configure the format using two</span>
<a name="l2208"><span class="linenum">2208</span></a>  <span class="comment">     * place holders (%domain% and %username%). This function tries to extract</span>
<a name="l2209"><span class="linenum">2209</span></a>  <span class="comment">     * the username (stripping the domain part and any separators if they are</span>
<a name="l2210"><span class="linenum">2210</span></a>  <span class="comment">     * present) from the value present in $_SERVER['REMOTE_USER'], using the</span>
<a name="l2211"><span class="linenum">2211</span></a>  <span class="comment">     * configured format.</span>
<a name="l2212"><span class="linenum">2212</span></a>  <span class="comment">     *</span>
<a name="l2213"><span class="linenum">2213</span></a>  <span class="comment">     * @param string $remoteuser The value from $_SERVER['REMOTE_USER'] (converted to UTF-8)</span>
<a name="l2214"><span class="linenum">2214</span></a>  <span class="comment">     *</span>
<a name="l2215"><span class="linenum">2215</span></a>  <span class="comment">     * @return string The remote username (without domain part or</span>
<a name="l2216"><span class="linenum">2216</span></a>  <span class="comment">     *                separators). Empty string if we can't extract the username.</span>
<a name="l2217"><span class="linenum">2217</span></a>  <span class="comment">     */</span>
<a name="l2218"><span class="linenum">2218</span></a>      protected function <a class="function" onClick="logFunction('get_ntlm_remote_user')" href="../../_functions/get_ntlm_remote_user.html" onMouseOver="funcPopup(event,'get_ntlm_remote_user')">get_ntlm_remote_user</a>(<a class="var it15510" onMouseOver="hilite(15510)" onMouseOut="lolite()" onClick="logVariable('remoteuser')" href="../../_variables/remoteuser.html">$remoteuser</a>) {
<a name="l2219"><span class="linenum">2219</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_remoteuserformat)) {
<a name="l2220"><span class="linenum">2220</span></a>              <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a> = <a class="constant" onClick="logConstant('AUTH_NTLM_DEFAULT_FORMAT')" href="../../_constants/AUTH_NTLM_DEFAULT_FORMAT.html" onMouseOver="constPopup(event,'AUTH_NTLM_DEFAULT_FORMAT')">AUTH_NTLM_DEFAULT_FORMAT</a>;
<a name="l2221"><span class="linenum">2221</span></a>          } else {
<a name="l2222"><span class="linenum">2222</span></a>              <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/config.html">config</a>-&gt;ntlmsso_remoteuserformat;
<a name="l2223"><span class="linenum">2223</span></a>          }
<a name="l2224"><span class="linenum">2224</span></a>  
<a name="l2225"><span class="linenum">2225</span></a>          <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a> = <a class="phpfunction" onClick="logFunction('preg_quote')" href="../../_functions/preg_quote.html" onMouseOver="phpfuncPopup(event,'preg_quote')">preg_quote</a>(<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>);
<a name="l2226"><span class="linenum">2226</span></a>          <a class="var it26730" onMouseOver="hilite(26730)" onMouseOut="lolite()" onClick="logVariable('formatregex')" href="../../_variables/formatregex.html">$formatregex</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>(array('#%domain%#', '#%username%#'),
<a name="l2227"><span class="linenum">2227</span></a>                                      array('('.<a class="constant" onClick="logConstant('AUTH_NTLM_VALID_DOMAINNAME')" href="../../_constants/AUTH_NTLM_VALID_DOMAINNAME.html" onMouseOver="constPopup(event,'AUTH_NTLM_VALID_DOMAINNAME')">AUTH_NTLM_VALID_DOMAINNAME</a>.')', '('.<a class="constant" onClick="logConstant('AUTH_NTLM_VALID_USERNAME')" href="../../_constants/AUTH_NTLM_VALID_USERNAME.html" onMouseOver="constPopup(event,'AUTH_NTLM_VALID_USERNAME')">AUTH_NTLM_VALID_USERNAME</a>.')'),
<a name="l2228"><span class="linenum">2228</span></a>                                      <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>);
<a name="l2229"><span class="linenum">2229</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('#^'.<a class="var it26730" onMouseOver="hilite(26730)" onMouseOut="lolite()" onClick="logVariable('formatregex')" href="../../_variables/formatregex.html">$formatregex</a>.'$#', <a class="var it15510" onMouseOver="hilite(15510)" onMouseOut="lolite()" onClick="logVariable('remoteuser')" href="../../_variables/remoteuser.html">$remoteuser</a>, <a class="var it79" onMouseOver="hilite(79)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l2230"><span class="linenum">2230</span></a>              <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="phpfunction" onClick="logFunction('end')" href="../../_functions/end.html" onMouseOver="phpfuncPopup(event,'end')">end</a>(<a class="var it79" onMouseOver="hilite(79)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l2231"><span class="linenum">2231</span></a>              return <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>;
<a name="l2232"><span class="linenum">2232</span></a>          }
<a name="l2233"><span class="linenum">2233</span></a>  
<a name="l2234"><span class="linenum">2234</span></a>          <span class="comment">/* We are unable to extract the username with the configured format. Probably</span>
<a name="l2235"><span class="linenum">2235</span></a>  <span class="comment">         * the format specified is wrong, so log a warning for the admin and return</span>
<a name="l2236"><span class="linenum">2236</span></a>  <span class="comment">         * an empty username.</span>
<a name="l2237"><span class="linenum">2237</span></a>  <span class="comment">         */</span>
<a name="l2238"><span class="linenum">2238</span></a>          <a class="phpfunction" onClick="logFunction('error_log')" href="../../_functions/error_log.html" onMouseOver="phpfuncPopup(event,'error_log')">error_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('errorlogtag')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/errorlogtag.html">errorlogtag</a>.<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a> ('auth_ntlmsso_maybeinvalidformat', 'auth_ldap'));
<a name="l2239"><span class="linenum">2239</span></a>          return '';
<a name="l2240"><span class="linenum">2240</span></a>      }
<a name="l2241"><span class="linenum">2241</span></a>  
<a name="l2242"><span class="linenum">2242</span></a>      <span class="comment">/**</span>
<a name="l2243"><span class="linenum">2243</span></a>  <span class="comment">     * Check if the diagnostic message for the LDAP login error tells us that the</span>
<a name="l2244"><span class="linenum">2244</span></a>  <span class="comment">     * login is denied because the user password has expired or the password needs</span>
<a name="l2245"><span class="linenum">2245</span></a>  <span class="comment">     * to be changed on first login (using interactive SMB/Windows logins, not</span>
<a name="l2246"><span class="linenum">2246</span></a>  <span class="comment">     * LDAP logins).</span>
<a name="l2247"><span class="linenum">2247</span></a>  <span class="comment">     *</span>
<a name="l2248"><span class="linenum">2248</span></a>  <span class="comment">     * @param string the diagnostic message for the LDAP login error</span>
<a name="l2249"><span class="linenum">2249</span></a>  <span class="comment">     * @return bool true if the password has expired or the password must be changed on first login</span>
<a name="l2250"><span class="linenum">2250</span></a>  <span class="comment">     */</span>
<a name="l2251"><span class="linenum">2251</span></a>      protected function <a class="function" onClick="logFunction('ldap_ad_pwdexpired_from_diagmsg')" href="../../_functions/ldap_ad_pwdexpired_from_diagmsg.html" onMouseOver="funcPopup(event,'ldap_ad_pwdexpired_from_diagmsg')">ldap_ad_pwdexpired_from_diagmsg</a>(<a class="var it37718" onMouseOver="hilite(37718)" onMouseOut="lolite()" onClick="logVariable('diagmsg')" href="../../_variables/diagmsg.html">$diagmsg</a>) {
<a name="l2252"><span class="linenum">2252</span></a>  <span class="comment">        // The format of the diagnostic message is (actual examples from W2003 and W2008):</span>
<a name="l2253"><span class="linenum">2253</span></a>  <span class="comment">        // &quot;80090308: LdapErr: DSID-0C090334, comment: AcceptSecurityContext error, data 52e, vece&quot;  (W2003)</span>
<a name="l2254"><span class="linenum">2254</span></a>  <span class="comment">        // &quot;80090308: LdapErr: DSID-0C090334, comment: AcceptSecurityContext error, data 773, vece&quot;  (W2003)</span>
<a name="l2255"><span class="linenum">2255</span></a>  <span class="comment">        // &quot;80090308: LdapErr: DSID-0C0903AA, comment: AcceptSecurityContext error, data 52e, v1771&quot; (W2008)</span>
<a name="l2256"><span class="linenum">2256</span></a>  <span class="comment">        // &quot;80090308: LdapErr: DSID-0C0903AA, comment: AcceptSecurityContext error, data 773, v1771&quot; (W2008)</span>
<a name="l2257"><span class="linenum">2257</span></a>  <span class="comment">        // We are interested in the 'data nnn' part.</span>
<a name="l2258"><span class="linenum">2258</span></a>  <span class="comment">        //   if nnn == 773 then user must change password on first login</span>
<a name="l2259"><span class="linenum">2259</span></a>  <span class="comment">        //   if nnn == 532 then user password has expired</span>
<a name="l2260"><span class="linenum">2260</span></a>          <a class="var it37718" onMouseOver="hilite(37718)" onMouseOut="lolite()" onClick="logVariable('diagmsg')" href="../../_variables/diagmsg.html">$diagmsg</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it37718" onMouseOver="hilite(37718)" onMouseOut="lolite()" onClick="logVariable('diagmsg')" href="../../_variables/diagmsg.html">$diagmsg</a>);
<a name="l2261"><span class="linenum">2261</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/<a class="function" onClick="logFunction('data')" href="../../_functions/data.html" onMouseOver="funcPopup(event,'data')">data</a> (773|532)/i', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it37718" onMouseOver="hilite(37718)" onMouseOut="lolite()" onClick="logVariable('diagmsg')" href="../../_variables/diagmsg.html">$diagmsg</a>[2]))) {
<a name="l2262"><span class="linenum">2262</span></a>              return true;
<a name="l2263"><span class="linenum">2263</span></a>          }
<a name="l2264"><span class="linenum">2264</span></a>          return false;
<a name="l2265"><span class="linenum">2265</span></a>      }
<a name="l2266"><span class="linenum">2266</span></a>  
<a name="l2267"><span class="linenum">2267</span></a>  } <span class="comment">// End of the class</span>
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'set_config': ['set_config', 'Set a configuration value for this plugin ', [['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515],['lib','moodlelib.php',1331],['lib','enrollib.php',1152],['lib/editor/tinymce/classes','plugin.php',84]], 985],
'loginpage_hook': ['loginpage_hook', 'Hook for overriding behaviour of login page. This method is called from login/index.php page for all enabled auth plugins. ', [['lib','authlib.php',424],['auth/shibboleth','auth.php',180],['auth/cas','auth.php',86],['auth/ldap','auth.php',1627]], 1],
'user_create_user': ['user_create_user', 'Creates a user ', [['user','lib.php',26]], 10],
'get_config': ['get_config', 'Get a configuration value for this plugin ', [['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546],['question/engine','bank.php',109],['lib','moodlelib.php',1404],['lib','enrollib.php',1141],['lib/editor/tinymce/classes','plugin.php',73],['admin/tool/log/classes/helper','store.php',63]], 847],
'ldap_ad_pwdexpired_from_diagmsg': ['ldap_ad_pwdexpired_from_diagmsg', 'Check if the diagnostic message for the LDAP login error tells us that the login is denied because the user password has expired or the password needs to be changed on first login (using interactive SMB/Windows logins, not LDAP logins). ', [['auth/ldap','auth.php',2242]], 1],
'user_exists': ['user_exists', 'Checks if user exists in external db ', [['lib','authlib.php',344],['auth/db','auth.php',447],['auth/ldap','auth.php',349]], 6],
'ldap_get_ad_pwdexpire': ['ldap_get_ad_pwdexpire', 'Get password expiration time for a given user from Active Directory ', [['auth/ldap','auth.php',1986]], 1],
'where': ['where', 'Add where clause ', [['lib/zend/Zend/Service/WindowsAzure/Storage','TableEntityQuery.php',120],['question/classes/bank/search','category_condition.php',96],['question/classes/bank/search','hidden_condition.php',53],['question/engine','datalib.php',1882],['question/engine','datalib.php',1964]], 61],
'ntlmsso_finish': ['ntlmsso_finish', 'Find the session set by ntlmsso_magic(), validate it and call authenticate_user_login() to authenticate the user through the auth machinery. ', [['auth/ldap','auth.php',1739]], 2],
'create_temp_table': ['create_temp_table', 'This function will create the temporary table passed as argument with all its fields/keys/indexes/sequences, everything based in the XMLDB object ', [['lib/ddl','database_manager.php',434]], 11],
'is_internal': ['is_internal', 'Returns true if this authentication plugin is \'internal\'. ', [['auth/radius','auth.php',142],['lib','authlib.php',203],['auth/pam','auth.php',92],['auth/db','auth.php',650],['auth/email','auth.php',164],['auth/shibboleth','auth.php',161],['auth/none','auth.php',80],['auth/nologin','auth.php',62],['auth/cas','auth.php',67],['auth/mnet','auth.php',579],['auth/pop3','auth.php',97],['auth/nntp','auth.php',80],['auth/manual','auth.php',103],['auth/fc','auth.php',161],['auth/imap','auth.php',101],['auth/webservice','auth.php',90],['auth/ldap','auth.php',1590]], 18],
'strip_querystring': ['strip_querystring', 'Remove query string from url. ', [['lib','weblib.php',147]], 4],
'iscreator': ['iscreator', 'Returns true if user should be coursecreator. ', [['auth/cas','auth.php',402],['auth/fc','auth.php',123],['auth/ldap','auth.php',1099]], 4],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',438],['lib/classes/event','base.php',682]], 778],
'init_plugin': ['init_plugin', 'Init plugin config from database settings depending on the plugin auth type. ', [['auth/ldap','auth.php',88]], 2],
'notification': ['notification', 'Output a notification (that is, a status message about something that has just happened). ', [['lib','outputrenderers.php',2762],['lib','outputrenderers.php',4128],['lib','outputrenderers.php',4201]], 495],
'get_userinfo_asobj': ['get_userinfo_asobj', 'Reads user information from DB and return it in an object. ', [['auth/db','auth.php',496],['auth/ldap','auth.php',319]], 2],
'user_update': ['user_update', 'Called when the user record is updated. Modifies user in external database. It takes olduser (before changes) and newuser (after changes) compares information saved modified information to external db. ', [['lib','authlib.php',251],['auth/db','auth.php',572],['auth/ldap','auth.php',1130]], 3],
'get_complete_user_data': ['get_complete_user_data', 'Get a complete user record, which includes all the info in the user record. ', [['lib','moodlelib.php',4487]], 23],
'on': ['on', '', [['lib/requirejs','require.js',506]], 3494],
'ldap_getdefaults': ['ldap_getdefaults', 'Initializes needed variables for ldap-module ', [['lib','ldaplib.php',46]], 3],
'set_url': ['set_url', 'Set the url specifics ', [['backup/cc/cc_lib','cc_weblink.php',50],['backup/util/ui','restore_ui_components.php',141],['mod/wiki','pagelib.php',246],['mod/wiki','pagelib.php',334],['mod/wiki','pagelib.php',421],['mod/wiki','pagelib.php',701],['mod/wiki','pagelib.php',726],['mod/wiki','pagelib.php',840],['mod/wiki','pagelib.php',884],['mod/wiki','pagelib.php',1013],['mod/wiki','pagelib.php',1117],['mod/wiki','pagelib.php',1224],['mod/wiki','pagelib.php',1467],['mod/wiki','pagelib.php',1869],['mod/wiki','pagelib.php',1937],['mod/wiki','pagelib.php',2111],['mod/wiki','pagelib.php',2172],['mod/wiki','pagelib.php',2228],['mod/wiki','pagelib.php',2293],['mod/wiki','pagelib.php',2341],['mod/wiki','pagelib.php',2389],['mod/wiki','pagelib.php',2493],['lib','outputcomponents.php',2823],['lib','pagelib.php',1198]], 574],
'authenticate_user_login': ['authenticate_user_login', 'Authenticates a user against the chosen authentication mechanism ', [['lib','moodlelib.php',4052]], 19],
'create_from_userid': ['create_from_userid', 'Create instance of event. ', [['lib/classes/event','user_created.php',117],['lib/classes/event','user_updated.php',117]], 17],
'validate_form': ['validate_form', 'A chance to validate form data, and last chance to do stuff before it is inserted in config_plugin ', [['lib','authlib.php',404],['auth/db','auth.php',631],['auth/cas','auth.php',246],['auth/ldap','auth.php',2187]], 1],
'role_assign': ['role_assign', 'Assigns the specified role to a user in the context. ', [['lib/testing/generator','data_generator.php',885],['lib','accesslib.php',1666],['enrol','externallib.php',1008]], 172],
'start_delegated_transaction': ['start_delegated_transaction', 'On DBs that support it, switch to transaction mode and begin a transaction you\'ll need to ensure you call allow_commit() on the returned object or your changes *will* be lost. ', [['lib/dml','moodle_database.php',2344]], 137],
'print_string': ['print_string', 'Prints out a translated string. ', [['lib','moodlelib.php',6680]], 458],
'user_activate': ['user_activate', 'Activates (enables) user in external LDAP so user can login ', [['auth/ldap','auth.php',1053]], 4],
'allow_commit': ['allow_commit', 'Commit delegated transaction. The real database commit SQL is executed only after committing all delegated transactions. ', [['lib/dml','moodle_transaction.php',78]], 127],
'ldap_addslashes': ['ldap_addslashes', 'Quote control characters in AttributeValue parts of a RelativeDistinguishedName used in LDAP distinguished names - See RFC 4514/2253 ', [['lib','ldaplib.php',358]], 4],
'get_string': ['get_string', 'Return a core get_string() call ', [['lib/external','externallib.php',112],['lib','moodlelib.php',6538],['lib','moodlelib.php',9417],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38],['lib/classes','string_manager_install.php',95],['question/behaviour','behaviourbase.php',756]], 19235],
'drop_table': ['drop_table', 'This function will drop the table passed as argument and all the associated objects (keys, indexes, constraints, sequences, triggers) will be dropped too. ', [['lib/ddl','database_manager.php',308]], 77],
'sync_users': ['sync_users', 'Synchronizes user from external db to moodle user table. ', [['auth/db','auth.php',258],['auth/cas','auth.php',473],['auth/ldap','auth.php',670]], 21],
'ldap_supported_usertypes': ['ldap_supported_usertypes', 'Returns predefined user types ', [['lib','ldaplib.php',30]], 5],
'get_ntlm_remote_user': ['get_ntlm_remote_user', 'When using NTLM SSO, the format of the remote username we get in $_SERVER[\'REMOTE_USER\'] may vary, depending on where from and how the web server gets the data. So we let the admin configure the format using two place holders (%domain% and %username%). This function tries to extract the username (stripping the domain part and any separators if they are present) from the value present in $_SERVER[\'REMOTE_USER\'], using the configured format. ', [['auth/ldap','auth.php',2204]], 1],
'get_custom_user_profile_fields': ['get_custom_user_profile_fields', 'Return custom user profile fields. ', [['lib','authlib.php',573]], 9],
'ldap_unix2expirationtime': ['ldap_unix2expirationtime', 'Takes unix timestamp and returns it formated for storing in LDAP ', [['auth/ldap','auth.php',1470]], 1],
'convert': ['convert', '', [['backup/cc/cc_lib','cc_converter_basiclti.php',36],['backup/cc/cc_lib','cc_converter_page.php',35],['backup/cc/cc_lib','cc_converter_lti.php',36],['backup/cc/cc_lib','cc_converter_url.php',36],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',63],['backup/cc/cc_lib','cc_converter_resource.php',34],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',18498],['backup/cc/cc_lib','cc_converter_quiz.php',40],['lib/lessphp','Functions.php',450],['lib/classes','text.php',162],['backup/converter','convertlib.php',119],['backup/cc/cc_lib','cc_converter_label.php',33],['backup/controller','restore_controller.class.php',437],['lib','wiki_to_markdown.php',315],['backup/cc/cc_lib','cc_convert_moodle2.php',29],['backup/cc/cc_lib','cc_converter_forum.php',36],['lib','navigationlib.php',4819],['backup/cc/cc_lib','cc_converter_folder.php',33]], 138],
'role_unassign': ['role_unassign', 'Removes one role assignment ', [['lib','accesslib.php',1775],['enrol','externallib.php',1053]], 30],
'join': ['join', 'Join a room. For internal use by the Games SDK only. Calling this method directly is unsupported. (rooms.join) ', [['lib/google/src/Google/Service','Games.php',1715],['lib/google/src/Google/Service','Games.php',2099]], 949],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'notice': ['notice', 'Print a message and exit. ', [['lib','weblib.php',2481],['lib/mustache/src/Mustache','Logger.php',102],['lib/google/src/Google/Logger','Abstract.php',224],['lib/mustache/src/Mustache/Logger','AbstractLogger.php',87]], 77],
'ldap_expirationtime2unix': ['ldap_expirationtime2unix', 'Take expirationtime and return it as unix timestamp in seconds ', [['auth/ldap','auth.php',1434]], 1],
'set_title': ['set_title', '', [['backup/cc/cc_lib','cc_basiclti.php',57],['backup/cc/cc_lib','cc_weblink.php',41],['backup/cc/cc_lib','cc_metadata.php',225],['backup/cc/cc_lib','cc_forum.php',39],['mod/wiki','pagelib.php',216],['lib','outputcomponents.php',2815],['backup/cc/cc_lib','cc_asssesment.php',595],['backup/cc/cc_lib','cc_asssesment.php',843],['backup/cc/cc_lib','cc_asssesment.php',1060],['backup/cc/cc_lib','cc_asssesment.php',1829],['lib','pagelib.php',1128],['backup/cc/cc_lib','cc_page.php',38]], 445],
'ldap_filter_addslashes': ['ldap_filter_addslashes', 'Quote control characters in texts used in LDAP filters - see RFC 4515/2254 ', [['lib','ldaplib.php',308]], 8],
'ldap_isgroupmember': ['ldap_isgroupmember', 'Checks if user belongs to specific group(s) or is in a subtree. ', [['lib','ldaplib.php',105]], 2],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 552],
'ldap_close': ['ldap_close', 'Disconnects from a LDAP server ', [['enrol/ldap','lib.php',679],['auth/ldap','auth.php',2151]], 24],
'isloggedin': ['isloggedin', 'Return true, if session is currently logged into the backend server ', [['lib/zend/Zend/Service','LiveDocx.php',293],['lib','accesslib.php',1909]], 177],
'user_not_fully_set_up': ['user_not_fully_set_up', 'Determines if a user has completed setting up their account. ', [['lib','moodlelib.php',3120]], 7],
'ldap_paged_results_supported': ['ldap_paged_results_supported', '', [['lib','ldaplib.php',417]], 6],
'profile_save_data': ['profile_save_data', 'Saves profile data for a user. ', [['user/profile','lib.php',479]], 10],
'process_config': ['process_config', 'Processes and stores configuration data for this authentication plugin. ', [['auth/radius','auth.php',175],['lib','authlib.php',414],['auth/pam','auth.php',123],['auth/db','auth.php',725],['auth/email','auth.php',223],['auth/shibboleth','auth.php',231],['auth/none','auth.php',139],['auth/cas','auth.php',269],['auth/mnet','auth.php',680],['auth/pop3','auth.php',144],['auth/nntp','auth.php',111],['auth/manual','auth.php',193],['auth/fc','auth.php',216],['auth/imap','auth.php',148],['auth/webservice','auth.php',141],['auth/ldap','auth.php',1833],['backup/moodle2','restore_stepslib.php',2118]], 3],
'address_in_subnet': ['address_in_subnet', 'Function to check the passed address is within the passed subnet ', [['lib','moodlelib.php',7996]], 80],
'user_login': ['user_login', 'Returns true if the username and password work and false if they are wrong or don\'t exist. ', [['auth/radius','auth.php',46],['lib','authlib.php',132],['auth/pam','auth.php',62],['auth/db','auth.php',50],['auth/email','auth.php',42],['auth/shibboleth','auth.php',46],['auth/none','auth.php',42],['auth/nologin','auth.php',42],['auth/cas','auth.php',53],['auth/mnet','auth.php',44],['auth/pop3','auth.php',43],['auth/nntp','auth.php',43],['auth/manual','auth.php',56],['auth/fc','auth.php',45],['auth/imap','auth.php',43],['auth/webservice','auth.php',43],['auth/ldap','auth.php',153]], 15],
'get_referer': ['get_referer', 'Returns the URL of the HTTP_REFERER, less the querystring portion if required. ', [['lib','weblib.php',164]], 7],
'truncate_userinfo': ['truncate_userinfo', 'Will truncate userinfo as it comes from auth_get_userinfo (from external auth) which may have large fields. ', [['lib','moodlelib.php',3844]], 6],
'get_cache_flags': ['get_cache_flags', 'Get volatile flags ', [['lib','moodlelib.php',1632]], 10],
'complete_user_login': ['complete_user_login', 'Call to complete the user login process after authenticate_user_login() has succeeded. It will setup the $USER variable and other required bits and pieces. ', [['lib','moodlelib.php',4261]], 10],
'ntlmsso_magic': ['ntlmsso_magic', 'To be called from a page running under NTLM\'s "Integrated Windows Authentication". ', [['auth/ldap','auth.php',1689]], 1],
'sesskey': ['sesskey', 'Makes sure that $USER->sesskey exists, if $USER itself exists. It sets a new sesskey if one does not already exist, but does not overwrite existing sesskeys. Returns the sesskey string if $USER exists, or boolean false if not. ', [['lib','sessionlib.php',28]], 631],
'count_records_sql': ['count_records_sql', 'Get the result of a SQL SELECT COUNT(...) query. ', [['lib/dml','moodle_database.php',1747]], 132],
'ldap_bulk_insert': ['ldap_bulk_insert', 'Bulk insert in SQL\'s temp table ', [['auth/ldap','auth.php',1041]], 1],
'data': ['data', 'Send an SMTP DATA command. Issues a data command and sends the msg_data to the server, finializing the mail transaction. $msg_data is the message that is to be send with the headers. Each header needs to be on a single line followed by a <CRLF> with the message headers and the message body being separated by and additional <CRLF>. Implements rfc 821: DATA <CRLF> ', [['lib/phpmailer','class.smtp.php',526]], 327],
'add': ['add', '', [['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',454],['blog','locallib.php',242],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',11],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',31],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',428],['backup/cc','validator.php',51],['lib/google/src/Google/Http','Batch.php',47],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',37],['lib/horde/framework/Horde/Support','ConsistentHash.php',148],['lib/horde/framework/Horde/Imap/Client','Ids.php',155],['lib/zend/Zend/Service/Simpy','WatchlistFilterSet.php',47],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',109],['lib/lessphp/Output','Mapped.php',50],['lib/horde/framework/Horde/Stream','TempString.php',118],['lib','licenselib.php',32],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',207],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',29],['lib/horde/framework/Horde/Mail/Rfc822','List.php',116],['lib/xhprof/xhprof_html/jquery','jquery-1.2.6.js',3450],['lib/google/src/Google/Service','Webmasters.php',375],['lib/horde/framework/Horde','Variables.php',297],['lib','outputcomponents.php',2700],['lib','outputcomponents.php',3375],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',14],['lib/zend/Zend','Date.php',1081],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',33],['comment','lib.php',675],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',86],['lib/horde/framework/Horde','Stream.php',116],['backup/cc/cc_lib/gral_lib','cssparser.php',111],['lib/lessphp','Output.php',18],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',50],['lib','adminlib.php',736],['lib','adminlib.php',895],['lib','adminlib.php',1447],['lib','csslib.php',1508],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',95],['lib','navigationlib.php',302],['lib','navigationlib.php',758],['lib','navigationlib.php',3288],['lib','navigationlib.php',3542],['lib/phpexcel/PHPExcel','HashTable.php',85],['lib/mustache/src/Mustache','HelperCollection.php',56],['lib/horde/framework/Horde/Mail/Rfc822','GroupList.php',25],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',27],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',80],['backup/cc/cc_lib','cc_utils.php',395],['backup/cc/cc_lib','cc_utils.php',454]], 5988],
'add_key': ['add_key', 'This function will create the key in the table passed as arguments ', [['lib/ddl','database_manager.php',727],['lib/xmldb','xmldb_table.php',787]], 251],
'add_field': ['add_field', 'This function will add the field to the table passed as arguments ', [['lib/ddl','database_manager.php',510],['lib/xmldb','xmldb_table.php',766]], 888],
'set_user_preference': ['set_user_preference', 'Sets a preference for the specified user. ', [['lib','moodlelib.php',1822]], 163],
'password_expire': ['password_expire', 'return number of days to user password expires ', [['lib','authlib.php',355],['auth/manual','auth.php',165],['auth/ldap','auth.php',629]], 8],
'can_confirm': ['can_confirm', 'Returns true if plugin allows confirming of new users. ', [['lib','authlib.php',323],['auth/email','auth.php',125],['auth/ldap','auth.php',589]], 1],
'ldap_connect_moodle': ['ldap_connect_moodle', 'Tries connect to specified ldap servers. Returns a valid LDAP connection or false. ', [['lib','ldaplib.php',155]], 5],
'ldap_find_userdn': ['ldap_find_userdn', 'Search specified contexts for the specified userid and return the user dn like: cn=username,ou=suborg,o=org. It\'s actually a wrapper around ldap_find_userdn(). ', [['enrol/ldap','lib.php',828],['lib','ldaplib.php',221],['auth/ldap','auth.php',2167]], 12],
'ldap_get_userlist': ['ldap_get_userlist', 'Returns all usernames from LDAP ', [['auth/ldap','auth.php',1520]], 3],
'get_manager': ['get_manager', 'Returns the sql generator used for db manipulation. Used mostly in upgrade.php scripts. ', [['lib/dml','moodle_database.php',1030]], 273],
'get_userlist': ['get_userlist', '', [['auth/db','auth.php',472],['auth/ldap','auth.php',338]], 1],
'get_archetype_roles': ['get_archetype_roles', 'Returns roles of a specified archetype ', [['lib','accesslib.php',3231]], 21],
'get_userinfo': ['get_userinfo', 'Read user information from external database and returns it as array(). Function should return all information available. If you are saving this information to moodle user-table you should honour synchronisation flags ', [['lib','authlib.php',376],['auth/db','auth.php',188],['auth/shibboleth','auth.php',86],['auth/cas','auth.php',455],['auth/fc','auth.php',73],['auth/ldap','auth.php',243]], 8],
'user_update_user': ['user_update_user', 'Update a user with a user object (will compare against the ID) ', [['user','lib.php',117]], 27],
'config_form': ['config_form', 'Prints a form for configuring this authentication plugin. ', [['auth/radius','auth.php',161],['lib','authlib.php',390],['auth/pam','auth.php',111],['message/output/popup','message_output_popup.php',68],['auth/db','auth.php',710],['auth/email','auth.php',211],['auth/shibboleth','auth.php',219],['auth/none','auth.php',127],['auth/cas','auth.php',218],['auth/mnet','auth.php',609],['auth/pop3','auth.php',130],['auth/nntp','auth.php',99],['auth/manual','auth.php',150],['auth/fc','auth.php',204],['auth/imap','auth.php',134],['auth/webservice','auth.php',130],['message/output/airnotifier','message_output_airnotifier.php',119],['message/output/jabber','message_output_jabber.php',98],['auth/ldap','auth.php',1814],['message/output/email','message_output_email.php',104]], 3],
'user_update_password': ['user_update_password', 'Updates the user\'s password. ', [['lib','authlib.php',234],['auth/db','auth.php',231],['auth/email','auth.php',58],['auth/none','auth.php',58],['auth/nologin','auth.php',50],['auth/manual','auth.php',81],['auth/webservice','auth.php',72],['auth/ldap','auth.php',1315]], 14],
'update_user_record': ['update_user_record', 'will update a local user record from an external source. is a lighter version of the one in moodlelib -- won\'t do expensive ops such as enrolment. ', [['auth/db','auth.php',511],['lib','moodlelib.php',3764],['auth/ldap','auth.php',980]], 5],
'isguestuser': ['isguestuser', 'Determines if a user is logged in as real guest user with username \'guest\'. ', [['lib','accesslib.php',1922]], 237],
'send_confirmation_email': ['send_confirmation_email', 'Send email to specified user with confirmation text and activation link. ', [['lib','moodlelib.php',5786]], 2],
'clean_param': ['clean_param', 'Used by {@link optional_param()} and {@link required_param()} to clean the variables and/or cast to specific types, based on an options field. <code> $course->format = clean_param($course->format, PARAM_ALPHA); $selectedgradeitem = clean_param($selectedgradeitem, PARAM_INT); </code> ', [['lib','moodlelib.php',768]], 607],
'can_change_password': ['can_change_password', 'Returns true if this authentication plugin can change the user\'s password. ', [['auth/radius','auth.php',151],['lib','authlib.php',151],['auth/pam','auth.php',101],['auth/db','auth.php',675],['auth/email','auth.php',173],['auth/shibboleth','auth.php',170],['auth/none','auth.php',89],['auth/nologin','auth.php',72],['auth/cas','auth.php',76],['auth/mnet','auth.php',588],['auth/pop3','auth.php',106],['auth/nntp','auth.php',89],['auth/manual','auth.php',112],['auth/fc','auth.php',170],['auth/imap','auth.php',110],['auth/webservice','auth.php',101],['auth/ldap','auth.php',1599]], 13],
'insert_record_raw': ['insert_record_raw', 'Insert new record into database, as fast as possible, no safety checks, lobs not supported. ', [['lib/dml','pgsql_native_moodle_database.php',821],['lib/dml','oci_native_moodle_database.php',1179],['lib/dml','sqlsrv_native_moodle_database.php',880],['lib/dml','mssql_native_moodle_database.php',797],['lib/dml','mysqli_native_moodle_database.php',1124],['lib/dml/tests','dml_test.php',5426],['lib/dml','pdo_moodle_database.php',342]], 38],
'kill_user_sessions': ['kill_user_sessions', 'Terminate all sessions of given user unconditionally. ', [['lib/classes/session','manager.php',608]], 14],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'unset_cache_flag': ['unset_cache_flag', 'Removes a single volatile flag ', [['lib','moodlelib.php',1724]], 2],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','oci_native_moodle_database.php',1102],['lib/dml','sqlsrv_native_moodle_database.php',823],['lib/dml','mssql_native_moodle_database.php',741],['lib/dml','mysqli_native_moodle_database.php',1049],['lib/dml/tests','dml_test.php',5424],['lib/dml','pdo_moodle_database.php',308]], 678],
'update_internal_user_password': ['update_internal_user_password', 'Update password hash in user object (if necessary). ', [['lib','moodlelib.php',4422]], 19],
'ldap_get_entries_moodle': ['ldap_get_entries_moodle', 'Returns values like ldap_get_entries but is binary compatible and returns all attributes as array. ', [['lib','ldaplib.php',273]], 9],
'user_signup': ['user_signup', 'Sign up a new user ready for confirmation. Password is passed in plaintext. ', [['lib','authlib.php',299],['auth/email','auth.php',80],['auth/ldap','auth.php',531]], 4],
'user_create': ['user_create', 'Creates a new user on LDAP. By using information in userobject Use user_exists to prevent duplicate usernames ', [['auth/ldap','auth.php',362]], 3],
'set_cache_flag': ['set_cache_flag', 'Set a volatile flag ', [['lib','moodlelib.php',1679]], 14],
'is_ie': ['is_ie', 'Checks the user agent is IE (of any version). ', [['lib/classes','useragent.php',473]], 16],
'sync_roles': ['sync_roles', 'Sync roles for this user - usually creator ', [['lib','authlib.php',367],['auth/fc','auth.php',180],['auth/ldap','auth.php',1790]], 1],
'add_index': ['add_index', 'This function will create the index in the table passed as arguments Before creating the index, the function will check it doesn\'t exists ', [['lib/ddl','database_manager.php',790],['lib/xmldb','xmldb_table.php',802]], 109],
'redirect': ['redirect', 'Redirect the browser ', [['','mdeploy.php',1474],['lib','weblib.php',2514]], 948],
'can_signup': ['can_signup', 'Returns true if plugin allows resetting of internal password. ', [['lib','authlib.php',289],['auth/email','auth.php',76],['auth/ldap','auth.php',522]], 6],
'user_add_password_history': ['user_add_password_history', 'Add password to the list of used hashes for this user. ', [['user','lib.php',908]], 28],
'change_password_url': ['change_password_url', 'Returns the URL for changing the users\' passwords, or empty if the default URL can be used. ', [['lib','authlib.php',162],['auth/db','auth.php',685],['auth/email','auth.php',183],['auth/none','auth.php',99],['auth/cas','auth.php',259],['auth/mnet','auth.php',599],['auth/pop3','auth.php',116],['auth/manual','auth.php',122],['auth/imap','auth.php',120],['auth/webservice','auth.php',111],['auth/ldap','auth.php',1609]], 9],
'delete_user': ['delete_user', 'Marks user deleted in internal user database and notifies the auth plugin. Also unenrols user from all roles and does other cleanup. ', [['lib','moodlelib.php',3879]], 29],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',449]], 1560],
'ldap_attributes': ['ldap_attributes', 'Returns user attribute mappings between moodle and LDAP ', [['auth/ldap','auth.php',1492]], 3],
'ldap_connect': ['ldap_connect', 'Connect to the LDAP server, using the plugin configured settings. It\'s actually a wrapper around ldap_connect_moodle() ', [['enrol/ldap','lib.php',647],['auth/ldap','auth.php',2122]], 20],
'can_be_manually_set': ['can_be_manually_set', 'Returns whether or not this authentication plugin can be manually set for users, for example, when bulk uploading users. ', [['lib','authlib.php',539],['auth/email','auth.php',202],['auth/none','auth.php',118],['auth/nologin','auth.php',88],['auth/manual','auth.php',141],['auth/ldap','auth.php',513]], 2],
'auth_plugin_ldap': ['auth_plugin_ldap', 'Constructor with initialisation. ', [['auth/ldap','auth.php',143]], 1],
'user_confirm': ['user_confirm', 'Confirm the new user as registered. ', [['lib','authlib.php',333],['auth/email','auth.php',134],['auth/manual','auth.php',218],['auth/webservice','auth.php',148],['auth/ldap','auth.php',598]], 5],
'prevent_local_passwords': ['prevent_local_passwords', '', [['auth/radius','auth.php',138],['lib','authlib.php',215],['auth/pam','auth.php',88],['auth/db','auth.php',646],['auth/email','auth.php',160],['auth/shibboleth','auth.php',157],['auth/none','auth.php',76],['auth/nologin','auth.php',57],['auth/cas','auth.php',49],['auth/mnet','auth.php',575],['auth/pop3','auth.php',93],['auth/nntp','auth.php',76],['auth/manual','auth.php',99],['auth/fc','auth.php',157],['auth/imap','auth.php',97],['auth/ldap','auth.php',1581]], 2],
'qualified_me': ['qualified_me', 'Guesses the full URL of the current script. ', [['lib','weblib.php',197]], 26],
'getremoteaddr': ['getremoteaddr', 'Returns most reliable client address ', [['lib','moodlelib.php',8281]], 62],
'can_reset_password': ['can_reset_password', 'Returns true if plugin allows resetting of internal password. ', [['lib','authlib.php',279],['auth/db','auth.php',701],['auth/email','auth.php',193],['auth/none','auth.php',109],['auth/nologin','auth.php',81],['auth/manual','auth.php',132],['auth/webservice','auth.php',121],['auth/ldap','auth.php',504]], 3],
'set_heading': ['set_heading', 'Sets the heading to use for the page. This is normally used as the main heading at the top of the content. ', [['lib','pagelib.php',1141]], 419],
'date': ['date', '', [], 790],
'floor': ['floor', '', [], 467],
'explode': ['explode', '', [], 1599],
'bcdiv': ['bcdiv', '', [], 8],
'is_array': ['is_array', '', [], 1820],
'count': ['count', '', [], 3984],
'trim': ['trim', '', [], 1889],
'ldap_bind': ['ldap_bind', '', [], 5],
'in_array': ['in_array', '', [], 1173],
'time': ['time', '', [], 1768],
'array_shift': ['array_shift', '', [], 607],
'implode': ['implode', '', [], 1259],
'array_map': ['array_map', '', [], 149],
'preg_quote': ['preg_quote', '', [], 207],
'create_function': ['create_function', '', [], 42],
'array_key_exists': ['array_key_exists', '', [], 1539],
'bcsub': ['bcsub', '', [], 2],
'substr': ['substr', '', [], 2883],
'strtolower': ['strtolower', '', [], 922],
'array_change_key_case': ['array_change_key_case', '', [], 32],
'stripos': ['stripos', '', [], 95],
'ldap_add': ['ldap_add', '', [], 28],
'pack': ['pack', '', [], 154],
'is_null': ['is_null', '', [], 1992],
'sha1': ['sha1', '', [], 188],
'array_keys': ['array_keys', '', [], 1152],
'base64_encode': ['base64_encode', '', [], 146],
'array_unique': ['array_unique', '', [], 173],
'ldap_search': ['ldap_search', '', [], 10],
'ldap_errno': ['ldap_errno', '', [], 17],
'mb_convert_encoding': ['mb_convert_encoding', '', [], 18],
'ldap_get_values_len': ['ldap_get_values_len', '', [], 3],
'array_merge': ['array_merge', '', [], 2320],
'ltrim': ['ltrim', '', [], 83],
'ldap_list': ['ldap_list', '', [], 7],
'mktime': ['mktime', '', [], 187],
'ldap_get_entries': ['ldap_get_entries', '', [], 10],
'ldap_get_option': ['ldap_get_option', '', [], 11],
'ldap_first_entry': ['ldap_first_entry', '', [], 8],
'ldap_connect': ['ldap_connect', '', [], 20],
'define': ['define', '', [], 2170],
'array_push': ['array_push', '', [], 214],
'ldap_read': ['ldap_read', '', [], 14],
'strpos': ['strpos', '', [], 1623],
'error_log': ['error_log', '', [], 105],
'defined': ['defined', '', [], 4098],
'preg_match': ['preg_match', '', [], 1317],
'end': ['end', '', [], 432],
'get_object_vars': ['get_object_vars', '', [], 54],
'ceil': ['ceil', '', [], 213],
'bcmod': ['bcmod', '', [], 7],
'function_exists': ['function_exists', '', [], 443],
'ldap_err2str': ['ldap_err2str', '', [], 8],
'preg_replace': ['preg_replace', '', [], 903],
'ldap_delete': ['ldap_delete', '', [], 20],
'ldap_next_entry': ['ldap_next_entry', '', [], 4],
'header': ['header', '', [], 1294]};
CLASS_DATA={
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6106]], 929],
'manager': ['manager', 'Defines MAnager class for myprofile navigation tree. ', [['user/classes/output/myprofile','manager.php',28],['lib/classes/log','manager.php',29],['admin/tool/messageinbound/classes','manager.php',29],['lib/classes/message','manager.php',31],['lib/classes/message/inbound','manager.php',29],['admin/tool/log/classes/log','manager.php',29],['lib/classes/session','manager.php',29],['lib/classes/task','manager.php',28],['lib/classes/event','manager.php',30]], 346],
'xmldb_table': ['xmldb_table', '', [['lib/xmldb','xmldb_table.php',29]], 397],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',240]], 2887],
'auth_plugin_base': ['auth_plugin_base', 'Abstract authentication plugin. ', [['lib','authlib.php',82]], 16],
'core_text': ['core_text', 'defines string api\'s for manipulating strings ', [['lib/classes','text.php',27]], 512],
'auth_plugin_ldap': ['auth_plugin_ldap', 'LDAP authentication plugin. ', [['auth/ldap','auth.php',83]], 2],
'core_useragent': ['core_useragent', 'The user agent class. ', [['lib/classes','useragent.php',25]], 149],
'user_created': ['user_created', 'Event when new user profile is created. ', [['lib/classes/event','user_created.php',29]], 8]};
CONST_DATA={
'AUTH_NTLM_FASTPATH_YESATTEMPT': ['AUTH_NTLM_FASTPATH_YESATTEMPT', '', [['auth/ldap','auth.php',71]], 4],
'AUTH_REMOVEUSER_FULLDELETE': ['AUTH_REMOVEUSER_FULLDELETE', '', [['lib','authlib.php',62]], 11],
'AUTH_NTLM_DEFAULT_FORMAT': ['AUTH_NTLM_DEFAULT_FORMAT', '', [['auth/ldap','auth.php',62]], 3],
'AUTH_CONFIRM_ALREADY': ['AUTH_CONFIRM_ALREADY', '', [['lib','authlib.php',56]], 7],
'XMLDB_KEY_PRIMARY': ['XMLDB_KEY_PRIMARY', '', [['lib/xmldb','xmldb_constants.php',64]], 198],
'XMLDB_UNSIGNED': ['XMLDB_UNSIGNED', '', [['lib/xmldb','xmldb_constants.php',76]], 11],
'DAYSECS': ['DAYSECS', '', [['lib','moodlelib.php',49]], 68],
'LDAP_DEFAULT_PAGESIZE': ['LDAP_DEFAULT_PAGESIZE', '', [['lib','ldaplib.php',27]], 7],
'AUTH_NTLM_VALID_USERNAME': ['AUTH_NTLM_VALID_USERNAME', '', [['auth/ldap','auth.php',55]], 3],
'AUTH_GID_NOGROUP': ['AUTH_GID_NOGROUP', '', [['auth/ldap','auth.php',50]], 3],
'PHPUNIT_TEST': ['PHPUNIT_TEST', '', [['admin/cli','install.php',143],['','install.php',49],['lib','setup.php',247],['lib/phpunit','bootstrap.php',63]], 54],
'PARAM_LOCALURL': ['PARAM_LOCALURL', '', [['lib','moodlelib.php',167]], 64],
'XMLDB_TYPE_INTEGER': ['XMLDB_TYPE_INTEGER', '', [['lib/xmldb','xmldb_constants.php',44]], 652],
'ROOTDSE': ['ROOTDSE', '', [['lib','ldaplib.php',22]], 3],
'AUTH_AD_NORMAL_ACCOUNT': ['AUTH_AD_NORMAL_ACCOUNT', '', [['auth/ldap','auth.php',34]], 3],
'XMLDB_SEQUENCE': ['XMLDB_SEQUENCE', '', [['lib/xmldb','xmldb_constants.php',80]], 176],
'AUTH_AD_ACCOUNTDISABLE': ['AUTH_AD_ACCOUNTDISABLE', '', [['auth/ldap','auth.php',31]], 4],
'XMLDB_NOTNULL': ['XMLDB_NOTNULL', '', [['lib/xmldb','xmldb_constants.php',78]], 683],
'AUTH_CONFIRM_OK': ['AUTH_CONFIRM_OK', '', [['lib','authlib.php',55]], 7],
'AUTH_NTLM_VALID_DOMAINNAME': ['AUTH_NTLM_VALID_DOMAINNAME', '', [['auth/ldap','auth.php',58]], 3],
'XMLDB_INDEX_UNIQUE': ['XMLDB_INDEX_UNIQUE', '', [['lib/xmldb','xmldb_constants.php',82]], 33],
'AUTH_NTLM_FASTPATH_ATTEMPT': ['AUTH_NTLM_FASTPATH_ATTEMPT', '', [['auth/ldap','auth.php',65]], 3],
'AUTH_REMOVEUSER_KEEP': ['AUTH_REMOVEUSER_KEEP', '', [['lib','authlib.php',60]], 16],
'XMLDB_TYPE_CHAR': ['XMLDB_TYPE_CHAR', '', [['lib/xmldb','xmldb_constants.php',50]], 231],
'AUTH_REMOVEUSER_SUSPEND': ['AUTH_REMOVEUSER_SUSPEND', '', [['lib','authlib.php',61]], 15],
'UF_DONT_EXPIRE_PASSWD': ['UF_DONT_EXPIRE_PASSWD', '', [['auth/ldap','auth.php',42]], 3],
'AUTH_CONFIRM_ERROR': ['AUTH_CONFIRM_ERROR', '', [['lib','authlib.php',57]], 7],
'LDAP_OPT_DIAGNOSTIC_MESSAGE': ['LDAP_OPT_DIAGNOSTIC_MESSAGE', '', [['auth/ldap','auth.php',76]], 3],
'AUTH_UID_NOBODY': ['AUTH_UID_NOBODY', '', [['auth/ldap','auth.php',47]], 3],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',138],['','install.php',93],['lib','setup.php',386]], 3532],
'AUTH_NTLM_FASTPATH_YESFORM': ['AUTH_NTLM_FASTPATH_YESFORM', '', [['auth/ldap','auth.php',68]], 5],
'AUTH_NTLMTIMEOUT': ['AUTH_NTLMTIMEOUT', '', [['auth/ldap','auth.php',37]], 4],
'AUTH_CONFIRM_FAIL': ['AUTH_CONFIRM_FAIL', '', [['lib','authlib.php',54]], 2],
'LDAP_DEREF_NEVER': ['LDAP_DEREF_NEVER', '', [['auth/cas','auth.php',236]], 18]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
