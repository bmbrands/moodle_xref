<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : Detail view of auth.php</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='auth/ldap';
filename='auth.php.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="details-heading"><a href="./index.html">/auth/ldap/</a> -> <a href="auth.php.source.html">auth.php</a> (summary)</h2>
<div class="details-summary">
<p class="viewlinks">[<a href="auth.php.source.html">Source view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="../../_stats.html">Project Stats</a>]</p>
<p><b>Authentication Plugin: LDAP Authentication Authentication using LDAP (Lightweight Directory Access Protocol).</b></p>
<table>
<tr><td align="right">Author: </td><td>Martin Dougiamas</td></tr>
<tr><td align="right">Author: </td><td>IÃ±aki Arenaza</td></tr>
<tr><td align="right">License: </td><td><a href="http://www.gnu.org/copyleft/gpl.html" target="_blank">http://www.gnu.org/copyleft/gpl.html</a> GNU Public License</td></tr>
<tr><td align="right">File Size: </td><td>2315 lines (100 kb)</td></tr>
<tr><td align="right">Included or required:</td><td>0 times</td></tr>
<tr><td align="right" valign="top">Referenced: </td><td>0 times</td></tr>
<tr><td align="right" valign="top">Includes or requires: </td><td>0 files</td></tr>
</table>
<h3>Defines 1 class</h3>
<div class="inset">
<p><b>auth_plugin_ldap::</b> (45 methods):<br>
&nbsp;&nbsp;<a href="#init_plugin">init_plugin</a>()<br>
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#auth_plugin_ldap">auth_plugin_ldap</a>()<br>
&nbsp;&nbsp;<a href="#user_login">user_login</a>()<br>
&nbsp;&nbsp;<a href="#get_userinfo">get_userinfo</a>()<br>
&nbsp;&nbsp;<a href="#get_userinfo_asobj">get_userinfo_asobj</a>()<br>
&nbsp;&nbsp;<a href="#get_userlist">get_userlist</a>()<br>
&nbsp;&nbsp;<a href="#user_exists">user_exists</a>()<br>
&nbsp;&nbsp;<a href="#user_create">user_create</a>()<br>
&nbsp;&nbsp;<a href="#can_reset_password">can_reset_password</a>()<br>
&nbsp;&nbsp;<a href="#can_be_manually_set">can_be_manually_set</a>()<br>
&nbsp;&nbsp;<a href="#can_signup">can_signup</a>()<br>
&nbsp;&nbsp;<a href="#user_signup">user_signup</a>()<br>
&nbsp;&nbsp;<a href="#can_confirm">can_confirm</a>()<br>
&nbsp;&nbsp;<a href="#user_confirm">user_confirm</a>()<br>
&nbsp;&nbsp;<a href="#password_expire">password_expire</a>()<br>
&nbsp;&nbsp;<a href="#sync_users">sync_users</a>()<br>
&nbsp;&nbsp;<a href="#update_user_record">update_user_record</a>()<br>
&nbsp;&nbsp;<a href="#ldap_bulk_insert">ldap_bulk_insert</a>()<br>
&nbsp;&nbsp;<a href="#user_activate">user_activate</a>()<br>
&nbsp;&nbsp;<a href="#iscreator">iscreator</a>()<br>
&nbsp;&nbsp;<a href="#user_update">user_update</a>()<br>
&nbsp;&nbsp;<a href="#user_update_password">user_update_password</a>()<br>
&nbsp;&nbsp;<a href="#ldap_expirationtime2unix">ldap_expirationtime2unix</a>()<br>
&nbsp;&nbsp;<a href="#ldap_unix2expirationtime">ldap_unix2expirationtime</a>()<br>
&nbsp;&nbsp;<a href="#ldap_attributes">ldap_attributes</a>()<br>
&nbsp;&nbsp;<a href="#ldap_get_userlist">ldap_get_userlist</a>()<br>
&nbsp;&nbsp;<a href="#prevent_local_passwords">prevent_local_passwords</a>()<br>
&nbsp;&nbsp;<a href="#is_internal">is_internal</a>()<br>
&nbsp;&nbsp;<a href="#can_change_password">can_change_password</a>()<br>
&nbsp;&nbsp;<a href="#change_password_url">change_password_url</a>()<br>
&nbsp;&nbsp;<a href="#loginpage_hook">loginpage_hook</a>()<br>
&nbsp;&nbsp;<a href="#ntlmsso_magic">ntlmsso_magic</a>()<br>
&nbsp;&nbsp;<a href="#ntlmsso_finish">ntlmsso_finish</a>()<br>
&nbsp;&nbsp;<a href="#sync_roles">sync_roles</a>()<br>
&nbsp;&nbsp;<a href="#config_form">config_form</a>()<br>
&nbsp;&nbsp;<a href="#process_config">process_config</a>()<br>
&nbsp;&nbsp;<a href="#ldap_get_ad_pwdexpire">ldap_get_ad_pwdexpire</a>()<br>
&nbsp;&nbsp;<a href="#ldap_connect">ldap_connect</a>()<br>
&nbsp;&nbsp;<a href="#ldap_close">ldap_close</a>()<br>
&nbsp;&nbsp;<a href="#ldap_find_userdn">ldap_find_userdn</a>()<br>
&nbsp;&nbsp;<a href="#validate_form">validate_form</a>()<br>
&nbsp;&nbsp;<a href="#get_ntlm_remote_user">get_ntlm_remote_user</a>()<br>
&nbsp;&nbsp;<a href="#ldap_ad_pwdexpired_from_diagmsg">ldap_ad_pwdexpired_from_diagmsg</a>()<br>
&nbsp;&nbsp;<a href="#is_user_suspended">is_user_suspended</a>()<br>
</p>
</div>
</div>
<br><div class="details-funclist">
<div class="details-classinfo">
<p class="details-classtitle">Class: <a name="auth_plugin_ldap"><b>auth_plugin_ldap</b></a>&nbsp;&nbsp;- <a href="../../_classes/auth_plugin_ldap.html"><small>X-Ref</small></a>
</p>
<b>LDAP authentication plugin.<BR>
</b><br>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="init_plugin" onClick="logFunction('init_plugin', 'auth.php.source.html#l88')" href="auth.php.source.html#l88">init_plugin</a>(<a href="../../_variables/authtype.html">$authtype</a>)&nbsp;&nbsp;
<a href="../../_functions/init_plugin.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Init plugin config from database settings depending on the plugin auth type.<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'auth.php.source.html#l119')" href="auth.php.source.html#l119">__construct</a>()&nbsp;&nbsp;
<a href="../../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Constructor with initialisation.<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="auth_plugin_ldap" onClick="logFunction('auth_plugin_ldap', 'auth.php.source.html#l129')" href="auth.php.source.html#l129">auth_plugin_ldap</a>()&nbsp;&nbsp;
<a href="../../_functions/auth_plugin_ldap.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Old syntax of class constructor. Deprecated in PHP7.<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_login" onClick="logFunction('user_login', 'auth.php.source.html#l139')" href="auth.php.source.html#l139">user_login</a>(<a href="../../_variables/username.html">$username</a>, <a href="../../_variables/password.html">$password</a>)&nbsp;&nbsp;
<a href="../../_functions/user_login.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns true if the username and password work and false if they are<BR>
wrong or don't exist.<BR>
</b><BR><b>param:</b> string $username The username (without system magic quotes)<br>
<b>param:</b> string $password The password (without system magic quotes)<br>
<b>return:</b> bool Authentication success or failure.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_userinfo" onClick="logFunction('get_userinfo', 'auth.php.source.html#l229')" href="auth.php.source.html#l229">get_userinfo</a>(<a href="../../_variables/username.html">$username</a>)&nbsp;&nbsp;
<a href="../../_functions/get_userinfo.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Reads user information from ldap and returns it in array()<BR>
</b><BR>Function should return all information available. If you are saving<BR>
this information to moodle user-table you should honor syncronization flags<BR>
<BR>
<b>param:</b> string $username username<br>
<b>return:</b> mixed array with no magic quotes or false on error<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_userinfo_asobj" onClick="logFunction('get_userinfo_asobj', 'auth.php.source.html#l305')" href="auth.php.source.html#l305">get_userinfo_asobj</a>(<a href="../../_variables/username.html">$username</a>)&nbsp;&nbsp;
<a href="../../_functions/get_userinfo_asobj.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Reads user information from ldap and returns it in an object<BR>
</b><BR><b>param:</b> string $username username (with system magic quotes)<br>
<b>return:</b> mixed object or false on error<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_userlist" onClick="logFunction('get_userlist', 'auth.php.source.html#l324')" href="auth.php.source.html#l324">get_userlist</a>()&nbsp;&nbsp;
<a href="../../_functions/get_userlist.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns all usernames from LDAP<BR>
</b><BR>get_userlist returns all usernames from LDAP<BR>
<BR>
<b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_exists" onClick="logFunction('user_exists', 'auth.php.source.html#l335')" href="auth.php.source.html#l335">user_exists</a>(<a href="../../_variables/username.html">$username</a>)&nbsp;&nbsp;
<a href="../../_functions/user_exists.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Checks if user exists on LDAP<BR>
</b><BR><b>param:</b> string $username<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_create" onClick="logFunction('user_create', 'auth.php.source.html#l348')" href="auth.php.source.html#l348">user_create</a>(<a href="../../_variables/userobject.html">$userobject</a>, <a href="../../_variables/plainpass.html">$plainpass</a>)&nbsp;&nbsp;
<a href="../../_functions/user_create.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Creates a new user on LDAP.<BR>
By using information in userobject<BR>
Use user_exists to prevent duplicate usernames<BR>
</b><BR><b>param:</b> mixed $userobject&nbsp;&nbsp;Moodle userobject<br>
<b>param:</b> mixed $plainpass&nbsp;&nbsp;&nbsp;Plaintext password<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="can_reset_password" onClick="logFunction('can_reset_password', 'auth.php.source.html#l490')" href="auth.php.source.html#l490">can_reset_password</a>()&nbsp;&nbsp;
<a href="../../_functions/can_reset_password.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns true if plugin allows resetting of password from moodle.<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="can_be_manually_set" onClick="logFunction('can_be_manually_set', 'auth.php.source.html#l499')" href="auth.php.source.html#l499">can_be_manually_set</a>()&nbsp;&nbsp;
<a href="../../_functions/can_be_manually_set.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns true if plugin can be manually set.<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="can_signup" onClick="logFunction('can_signup', 'auth.php.source.html#l508')" href="auth.php.source.html#l508">can_signup</a>()&nbsp;&nbsp;
<a href="../../_functions/can_signup.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns true if plugin allows signup and user creation.<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_signup" onClick="logFunction('user_signup', 'auth.php.source.html#l517')" href="auth.php.source.html#l517">user_signup</a>(<a href="../../_variables/user.html">$user</a>, <a href="../../_variables/notify.html">$notify</a>=true)&nbsp;&nbsp;
<a href="../../_functions/user_signup.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Sign up a new user ready for confirmation.<BR>
Password is passed in plaintext.<BR>
</b><BR><b>param:</b> object $user new user object<br>
<b>param:</b> boolean $notify print notice with link and terminate<br>
<b>return:</b> boolean success<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="can_confirm" onClick="logFunction('can_confirm', 'auth.php.source.html#l576')" href="auth.php.source.html#l576">can_confirm</a>()&nbsp;&nbsp;
<a href="../../_functions/can_confirm.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns true if plugin allows confirming of new users.<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_confirm" onClick="logFunction('user_confirm', 'auth.php.source.html#l585')" href="auth.php.source.html#l585">user_confirm</a>(<a href="../../_variables/username.html">$username</a>, <a href="../../_variables/confirmsecret.html">$confirmsecret</a>)&nbsp;&nbsp;
<a href="../../_functions/user_confirm.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Confirm the new user as registered.<BR>
</b><BR><b>param:</b> string $username<br>
<b>param:</b> string $confirmsecret<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="password_expire" onClick="logFunction('password_expire', 'auth.php.source.html#l616')" href="auth.php.source.html#l616">password_expire</a>(<a href="../../_variables/username.html">$username</a>)&nbsp;&nbsp;
<a href="../../_functions/password_expire.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return number of days to user password expires<BR>
</b><BR>If userpassword does not expire it should return 0. If password is already expired<BR>
it should return negative value.<BR>
<BR>
<b>param:</b> mixed $username username<br>
<b>return:</b> integer<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="sync_users" onClick="logFunction('sync_users', 'auth.php.source.html#l657')" href="auth.php.source.html#l657">sync_users</a>(<a href="../../_variables/do_updates.html">$do_updates</a>=true)&nbsp;&nbsp;
<a href="../../_functions/sync_users.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Syncronizes user fron external LDAP server to moodle user table<BR>
</b><BR>Sync is now using username attribute.<BR>
<BR>
Syncing users removes or suspends users that dont exists anymore in external LDAP.<BR>
Creates new users and updates coursecreator status of users.<BR>
<BR>
<b>param:</b> bool $do_updates will do pull in data updates from LDAP if relevant<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_user_record" onClick="logFunction('update_user_record', 'auth.php.source.html#l976')" href="auth.php.source.html#l976">update_user_record</a>(<a href="../../_variables/username.html">$username</a>, <a href="../../_variables/updatekeys.html">$updatekeys</a> = false, <a href="../../_variables/triggerevent.html">$triggerevent</a> = false)&nbsp;&nbsp;
<a href="../../_functions/update_user_record.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Update a local user record from an external source.<BR>
This is a lighter version of the one in moodlelib -- won't do<BR>
expensive ops such as enrolment.<BR>
</b><BR>If you don't pass $updatekeys, there is a performance hit and<BR>
values removed from LDAP won't be removed from moodle.<BR>
<BR>
<b>param:</b> string $username username<br>
<b>param:</b> boolean $updatekeys true to update the local record with the external LDAP values.<br>
<b>param:</b> bool $triggerevent set false if user_updated event should not be triggered.<br>
<b>return:</b> stdClass|bool updated user record or false if there is no new info to update.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_bulk_insert" onClick="logFunction('ldap_bulk_insert', 'auth.php.source.html#l1042')" href="auth.php.source.html#l1042">ldap_bulk_insert</a>(<a href="../../_variables/username.html">$username</a>)&nbsp;&nbsp;
<a href="../../_functions/ldap_bulk_insert.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Bulk insert in SQL's temp table<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_activate" onClick="logFunction('user_activate', 'auth.php.source.html#l1054')" href="auth.php.source.html#l1054">user_activate</a>(<a href="../../_variables/username.html">$username</a>)&nbsp;&nbsp;
<a href="../../_functions/user_activate.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Activates (enables) user in external LDAP so user can login<BR>
</b><BR><b>param:</b> mixed $username<br>
<b>return:</b> boolean result<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="iscreator" onClick="logFunction('iscreator', 'auth.php.source.html#l1100')" href="auth.php.source.html#l1100">iscreator</a>(<a href="../../_variables/username.html">$username</a>)&nbsp;&nbsp;
<a href="../../_functions/iscreator.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns true if user should be coursecreator.<BR>
</b><BR><b>param:</b> mixed $username&nbsp;&nbsp;&nbsp;&nbsp;username (without system magic quotes)<br>
<b>return:</b> mixed result&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null if course creators is not configured, boolean otherwise.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_update" onClick="logFunction('user_update', 'auth.php.source.html#l1131')" href="auth.php.source.html#l1131">user_update</a>(<a href="../../_variables/olduser.html">$olduser</a>, <a href="../../_variables/newuser.html">$newuser</a>)&nbsp;&nbsp;
<a href="../../_functions/user_update.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Called when the user record is updated.<BR>
</b><BR>Modifies user in external LDAP server. It takes olduser (before<BR>
changes) and newuser (after changes) compares information and<BR>
saves modified information to external LDAP server.<BR>
<BR>
<b>param:</b> mixed $olduser&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Userobject before modifications&nbsp;&nbsp;&nbsp;&nbsp;(without system magic quotes)<br>
<b>param:</b> mixed $newuser&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Userobject new modified userobject (without system magic quotes)<br>
<b>return:</b> boolean result<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_update_password" onClick="logFunction('user_update_password', 'auth.php.source.html#l1316')" href="auth.php.source.html#l1316">user_update_password</a>(<a href="../../_variables/user.html">$user</a>, <a href="../../_variables/newpassword.html">$newpassword</a>)&nbsp;&nbsp;
<a href="../../_functions/user_update_password.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Changes userpassword in LDAP<BR>
</b><BR>Called when the user password is updated. It assumes it is<BR>
called by an admin or that you've otherwise checked the user's<BR>
credentials<BR>
<BR>
<b>param:</b> object&nbsp;&nbsp;$user&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User table object<br>
<b>param:</b> string&nbsp;&nbsp;$newpassword Plaintext password (not crypted/md5'ed)<br>
<b>return:</b> boolean result<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_expirationtime2unix" onClick="logFunction('ldap_expirationtime2unix', 'auth.php.source.html#l1435')" href="auth.php.source.html#l1435">ldap_expirationtime2unix</a>(<a href="../../_variables/time.html">$time</a>, <a href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a href="../../_variables/user_dn.html">$user_dn</a>)&nbsp;&nbsp;
<a href="../../_functions/ldap_expirationtime2unix.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Take expirationtime and return it as unix timestamp in seconds<BR>
</b><BR>Takes expiration timestamp as read from LDAP and returns it as unix timestamp in seconds<BR>
Depends on $this-&gt;config-&gt;user_type variable<BR>
<BR>
<b>param:</b> mixed time&nbsp;&nbsp;&nbsp;Time stamp read from LDAP as it is.<br>
<b>param:</b> string $ldapconnection Only needed for Active Directory.<br>
<b>param:</b> string $user_dn User distinguished name for the user we are checking password expiration (only needed for Active Directory).<br>
<b>return:</b> timestamp<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_unix2expirationtime" onClick="logFunction('ldap_unix2expirationtime', 'auth.php.source.html#l1471')" href="auth.php.source.html#l1471">ldap_unix2expirationtime</a>(<a href="../../_variables/time.html">$time</a>)&nbsp;&nbsp;
<a href="../../_functions/ldap_unix2expirationtime.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Takes unix timestamp and returns it formated for storing in LDAP<BR>
</b><BR><b>param:</b> integer unix time stamp<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_attributes" onClick="logFunction('ldap_attributes', 'auth.php.source.html#l1493')" href="auth.php.source.html#l1493">ldap_attributes</a>()&nbsp;&nbsp;
<a href="../../_functions/ldap_attributes.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns user attribute mappings between moodle and LDAP<BR>
</b><BR><b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_get_userlist" onClick="logFunction('ldap_get_userlist', 'auth.php.source.html#l1522')" href="auth.php.source.html#l1522">ldap_get_userlist</a>(<a href="../../_variables/filter.html">$filter</a>='*')&nbsp;&nbsp;
<a href="../../_functions/ldap_get_userlist.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns all usernames from LDAP<BR>
</b><BR><b>param:</b> $filter An LDAP search filter to select desired users<br>
<b>return:</b> array of LDAP user names converted to UTF-8<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="prevent_local_passwords" onClick="logFunction('prevent_local_passwords', 'auth.php.source.html#l1583')" href="auth.php.source.html#l1583">prevent_local_passwords</a>()&nbsp;&nbsp;
<a href="../../_functions/prevent_local_passwords.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Indicates if password hashes should be stored in local moodle database.<BR>
</b><BR><b>return:</b> bool true means flag 'not_cached' stored instead of password hash<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="is_internal" onClick="logFunction('is_internal', 'auth.php.source.html#l1592')" href="auth.php.source.html#l1592">is_internal</a>()&nbsp;&nbsp;
<a href="../../_functions/is_internal.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns true if this authentication plugin is 'internal'.<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="can_change_password" onClick="logFunction('can_change_password', 'auth.php.source.html#l1601')" href="auth.php.source.html#l1601">can_change_password</a>()&nbsp;&nbsp;
<a href="../../_functions/can_change_password.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns true if this authentication plugin can change the user's<BR>
password.<BR>
</b><BR><b>return:</b> bool<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="change_password_url" onClick="logFunction('change_password_url', 'auth.php.source.html#l1611')" href="auth.php.source.html#l1611">change_password_url</a>()&nbsp;&nbsp;
<a href="../../_functions/change_password_url.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns the URL for changing the user's password, or empty if the default can<BR>
be used.<BR>
</b><BR><b>return:</b> moodle_url<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="loginpage_hook" onClick="logFunction('loginpage_hook', 'auth.php.source.html#l1629')" href="auth.php.source.html#l1629">loginpage_hook</a>()&nbsp;&nbsp;
<a href="../../_functions/loginpage_hook.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Will get called before the login page is shownr. Ff NTLM SSO<BR>
is enabled, and the user is in the right network, we'll redirect<BR>
to the magic NTLM page for SSO...<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ntlmsso_magic" onClick="logFunction('ntlmsso_magic', 'auth.php.source.html#l1693')" href="auth.php.source.html#l1693">ntlmsso_magic</a>(<a href="../../_variables/sesskey.html">$sesskey</a>)&nbsp;&nbsp;
<a href="../../_functions/ntlmsso_magic.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>To be called from a page running under NTLM's<BR>
&quot;Integrated Windows Authentication&quot;.<BR>
</b><BR>If successful, it will set a special &quot;cookie&quot; (not an HTTP cookie!)<BR>
in cache_flags under the $this-&gt;pluginconfig/ntlmsess &quot;plugin&quot; and return true.<BR>
The &quot;cookie&quot; will be picked up by ntlmsso_finish() to complete the<BR>
process.<BR>
<BR>
On failure it will return false for the caller to display an appropriate<BR>
error message (probably saying that Integrated Windows Auth isn't enabled!)<BR>
<BR>
NOTE that this code will execute under the OS user credentials,<BR>
so we MUST avoid dealing with files -- such as session files.<BR>
(The caller should define('NO_MOODLE_COOKIES', true) before including config.php)<BR>
<BR>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ntlmsso_finish" onClick="logFunction('ntlmsso_finish', 'auth.php.source.html#l1743')" href="auth.php.source.html#l1743">ntlmsso_finish</a>()&nbsp;&nbsp;
<a href="../../_functions/ntlmsso_finish.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Find the session set by ntlmsso_magic(), validate it and<BR>
call authenticate_user_login() to authenticate the user through<BR>
the auth machinery.<BR>
</b><BR>It is complemented by a similar check in user_login().<BR>
<BR>
If it succeeds, it never returns.<BR>
<BR>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="sync_roles" onClick="logFunction('sync_roles', 'auth.php.source.html#l1794')" href="auth.php.source.html#l1794">sync_roles</a>(<a href="../../_variables/user.html">$user</a>)&nbsp;&nbsp;
<a href="../../_functions/sync_roles.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Sync roles for this user<BR>
</b><BR><b>param:</b> $user object user object (without system magic quotes)<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="config_form" onClick="logFunction('config_form', 'auth.php.source.html#l1818')" href="auth.php.source.html#l1818">config_form</a>(<a href="../../_variables/config.html">$config</a>, <a href="../../_variables/err.html">$err</a>, <a href="../../_variables/user_fields.html">$user_fields</a>)&nbsp;&nbsp;
<a href="../../_functions/config_form.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Prints a form for configuring this authentication plugin.<BR>
</b><BR>This function is called from admin/auth.php, and outputs a full page with<BR>
a form for configuring this plugin.<BR>
<BR>
<b>param:</b> array $page An object containing all the data for this page.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="process_config" onClick="logFunction('process_config', 'auth.php.source.html#l1837')" href="auth.php.source.html#l1837">process_config</a>(<a href="../../_variables/config.html">$config</a>)&nbsp;&nbsp;
<a href="../../_functions/process_config.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Processes and stores configuration data for this authentication plugin.<BR>
</b><BR></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_get_ad_pwdexpire" onClick="logFunction('ldap_get_ad_pwdexpire', 'auth.php.source.html#l1998')" href="auth.php.source.html#l1998">ldap_get_ad_pwdexpire</a>(<a href="../../_variables/pwdlastset.html">$pwdlastset</a>, <a href="../../_variables/ldapconn.html">$ldapconn</a>, <a href="../../_variables/user_dn.html">$user_dn</a>)&nbsp;&nbsp;
<a href="../../_functions/ldap_get_ad_pwdexpire.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get password expiration time for a given user from Active Directory<BR>
</b><BR><b>param:</b> string $pwdlastset The time last time we changed the password.<br>
<b>param:</b> resource $lcapconn The open LDAP connection.<br>
<b>param:</b> string $user_dn The distinguished name of the user we are checking.<br>
<b>return:</b> string $unixtime<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_connect" onClick="logFunction('ldap_connect', 'auth.php.source.html#l2150')" href="auth.php.source.html#l2150">ldap_connect</a>()&nbsp;&nbsp;
<a href="../../_functions/ldap_connect.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Connect to the LDAP server, using the plugin configured<BR>
settings. It's actually a wrapper around ldap_connect_moodle()<BR>
</b><BR><b>return:</b> resource A valid LDAP connection (or dies if it can't connect)<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_close" onClick="logFunction('ldap_close', 'auth.php.source.html#l2179')" href="auth.php.source.html#l2179">ldap_close</a>(<a href="../../_variables/force.html">$force</a>=false)&nbsp;&nbsp;
<a href="../../_functions/ldap_close.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Disconnects from a LDAP server<BR>
</b><BR><b>param:</b> force boolean Forces closing the real connection to the LDAP server, ignoring any<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_find_userdn" onClick="logFunction('ldap_find_userdn', 'auth.php.source.html#l2195')" href="auth.php.source.html#l2195">ldap_find_userdn</a>(<a href="../../_variables/ldapconnection.html">$ldapconnection</a>, <a href="../../_variables/extusername.html">$extusername</a>)&nbsp;&nbsp;
<a href="../../_functions/ldap_find_userdn.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Search specified contexts for username and return the user dn<BR>
like: cn=username,ou=suborg,o=org. It's actually a wrapper<BR>
around ldap_find_userdn().<BR>
</b><BR><b>param:</b> resource $ldapconnection a valid LDAP connection<br>
<b>param:</b> string $extusername the username to search (in external LDAP encoding, no db slashes)<br>
<b>return:</b> mixed the user dn (external LDAP encoding) or false<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="validate_form" onClick="logFunction('validate_form', 'auth.php.source.html#l2215')" href="auth.php.source.html#l2215">validate_form</a>(<a href="../../_variables/form.html">$form</a>, &amp;<a href="../../_variables/err.html">$err</a>)&nbsp;&nbsp;
<a href="../../_functions/validate_form.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>A chance to validate form data, and last chance to do stuff<BR>
before it is inserted in config_plugin<BR>
</b><BR><b>param:</b> object object with submitted configuration settings (without system magic quotes)<br>
<b>param:</b> array $err array of error messages (passed by reference)<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_ntlm_remote_user" onClick="logFunction('get_ntlm_remote_user', 'auth.php.source.html#l2232')" href="auth.php.source.html#l2232">get_ntlm_remote_user</a>(<a href="../../_variables/remoteuser.html">$remoteuser</a>)&nbsp;&nbsp;
<a href="../../_functions/get_ntlm_remote_user.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>When using NTLM SSO, the format of the remote username we get in<BR>
$_SERVER['REMOTE_USER'] may vary, depending on where from and how the web<BR>
server gets the data. So we let the admin configure the format using two<BR>
place holders (%domain% and %username%). This function tries to extract<BR>
the username (stripping the domain part and any separators if they are<BR>
present) from the value present in $_SERVER['REMOTE_USER'], using the<BR>
configured format.<BR>
</b><BR><b>param:</b> string $remoteuser The value from $_SERVER['REMOTE_USER'] (converted to UTF-8)<br>
<b>return:</b> string The remote username (without domain part or<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="ldap_ad_pwdexpired_from_diagmsg" onClick="logFunction('ldap_ad_pwdexpired_from_diagmsg', 'auth.php.source.html#l2270')" href="auth.php.source.html#l2270">ldap_ad_pwdexpired_from_diagmsg</a>(<a href="../../_variables/diagmsg.html">$diagmsg</a>)&nbsp;&nbsp;
<a href="../../_functions/ldap_ad_pwdexpired_from_diagmsg.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Check if the diagnostic message for the LDAP login error tells us that the<BR>
login is denied because the user password has expired or the password needs<BR>
to be changed on first login (using interactive SMB/Windows logins, not<BR>
LDAP logins).<BR>
</b><BR><b>param:</b> string the diagnostic message for the LDAP login error<br>
<b>return:</b> bool true if the password has expired or the password must be changed on first login<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="is_user_suspended" onClick="logFunction('is_user_suspended', 'auth.php.source.html#l2295')" href="auth.php.source.html#l2295">is_user_suspended</a>(<a href="../../_variables/user.html">$user</a>)&nbsp;&nbsp;
<a href="../../_functions/is_user_suspended.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Check if a user is suspended. This function is intended to be used after calling<BR>
get_userinfo_asobj. This is needed because LDAP doesn't have a notion of disabled<BR>
users, however things like MS Active Directory support it and expose information<BR>
through a field.<BR>
</b><BR><b>param:</b> object $user the user object returned by get_userinfo_asobj<br>
<b>return:</b> boolean<br>
</td></tr></table>

<br>
</div>
</div>

</div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
