<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : Detail view of info.php</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='availability/classes';
filename='info.php.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="details-heading"><a href="./index.html">/availability/classes/</a> -> <a href="info.php.source.html">info.php</a> (summary)</h2>
<div class="details-summary">
<p class="viewlinks">[<a href="info.php.source.html">Source view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="../../_stats.html">Project Stats</a>]</p>
<p><b>Base class for conditional availability information (for module or section).</b></p>
<table>
<tr><td align="right">Copyright: </td><td>2014 The Open University</td></tr>
<tr><td align="right">License: </td><td><a href="http://www.gnu.org/copyleft/gpl.html" target="_blank">http://www.gnu.org/copyleft/gpl.html</a> GNU GPL v3 or later</td></tr>
<tr><td align="right">File Size: </td><td>778 lines (31 kb)</td></tr>
<tr><td align="right">Included or required:</td><td>0 times</td></tr>
<tr><td align="right" valign="top">Referenced: </td><td>0 times</td></tr>
<tr><td align="right" valign="top">Includes or requires: </td><td>0 files</td></tr>
</table>
<h3>Defines 22 functions</h3>
<div class="inset">
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#get_course">get_course</a>()<br>
&nbsp;&nbsp;<a href="#get_modinfo">get_modinfo</a>()<br>
&nbsp;&nbsp;<a href="#get_availability_tree">get_availability_tree</a>()<br>
&nbsp;&nbsp;<a href="#decode_availability">decode_availability</a>()<br>
&nbsp;&nbsp;<a href="#is_available">is_available</a>()<br>
&nbsp;&nbsp;<a href="#is_available_for_all">is_available_for_all</a>()<br>
&nbsp;&nbsp;<a href="#get_full_information">get_full_information</a>()<br>
&nbsp;&nbsp;<a href="#warn_about_invalid_availability">warn_about_invalid_availability</a>()<br>
&nbsp;&nbsp;<a href="#update_after_restore">update_after_restore</a>()<br>
&nbsp;&nbsp;<a href="#get_restore_date_offset">get_restore_date_offset</a>()<br>
&nbsp;&nbsp;<a href="#get_restore_task">get_restore_task</a>()<br>
&nbsp;&nbsp;<a href="#update_dependency_id_across_course">update_dependency_id_across_course</a>()<br>
&nbsp;&nbsp;<a href="#update_dependency_id">update_dependency_id</a>()<br>
&nbsp;&nbsp;<a href="#convert_legacy_fields">convert_legacy_fields</a>()<br>
&nbsp;&nbsp;<a href="#add_legacy_availability_condition">add_legacy_availability_condition</a>()<br>
&nbsp;&nbsp;<a href="#add_legacy_availability_field_condition">add_legacy_availability_field_condition</a>()<br>
&nbsp;&nbsp;<a href="#add_legacy_condition">add_legacy_condition</a>()<br>
&nbsp;&nbsp;<a href="#filter_user_list">filter_user_list</a>()<br>
&nbsp;&nbsp;<a href="#get_user_list_sql">get_user_list_sql</a>()<br>
&nbsp;&nbsp;<a href="#format_info">format_info</a>()<br>
&nbsp;&nbsp;<a href="#completion_value_used">completion_value_used</a>()<br>
</div>
</div>
<br><div class="details-funclist">
<div class="details-classtitle"><a name="functions"><b>Functions</b></a></div>
<div class="details-classinfo">
Functions that are not part of a class:<br><br>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'info.php.source.html#l55')" href="info.php.source.html#l55">__construct</a>(<a href="../../_variables/course.html">$course</a>, <a href="../../_variables/visible.html">$visible</a>, <a href="../../_variables/availability.html">$availability</a>)&nbsp;&nbsp;
<a href="../../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Constructs with item details.<BR>
</b><BR><b>param:</b> \stdClass $course Course object<br>
<b>param:</b> int $visible Value of visible flag (eye icon)<br>
<b>param:</b> string $availability Availability definition (JSON format) or null<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_course" onClick="logFunction('get_course', 'info.php.source.html#l70')" href="info.php.source.html#l70">get_course</a>()&nbsp;&nbsp;
<a href="../../_functions/get_course.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Obtains the course associated with this availability information.<BR>
</b><BR><b>return:</b> \stdClass Moodle course object<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_modinfo" onClick="logFunction('get_modinfo', 'info.php.source.html#l86')" href="info.php.source.html#l86">get_modinfo</a>()&nbsp;&nbsp;
<a href="../../_functions/get_modinfo.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Obtains the modinfo associated with this availability information.<BR>
</b><BR>Note: This field is available ONLY for use by conditions when calculating<BR>
availability or information.<BR>
<BR>
<b>return:</b> \course_modinfo Modinfo<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_availability_tree" onClick="logFunction('get_availability_tree', 'info.php.source.html#l103')" href="info.php.source.html#l103">get_availability_tree</a>()&nbsp;&nbsp;
<a href="../../_functions/get_availability_tree.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Gets the availability tree, decoding it if not already done.<BR>
</b><BR><b>return:</b> tree Availability tree<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="decode_availability" onClick="logFunction('decode_availability', 'info.php.source.html#l119')" href="info.php.source.html#l119">decode_availability</a>(<a href="../../_variables/availability.html">$availability</a>, <a href="../../_variables/lax.html">$lax</a>)&nbsp;&nbsp;
<a href="../../_functions/decode_availability.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Decodes availability data from JSON format.<BR>
</b><BR>This function also validates the retrieved data as follows:<BR>
1. Data that does not meet the API-defined structure causes a<BR>
coding_exception (this should be impossible unless there is<BR>
a system bug or somebody manually hacks the database).<BR>
2. Data that meets the structure but cannot be implemented (e.g.<BR>
reference to missing plugin or to module that doesn't exist) is<BR>
either silently discarded (if $lax is true) or causes a<BR>
coding_exception (if $lax is false).<BR>
<BR>
<b>param:</b> string $availability Availability string in JSON format<br>
<b>param:</b> boolean $lax If true, throw exceptions only for invalid structure<br>
<b>return:</b> tree Availability tree<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="is_available" onClick="logFunction('is_available', 'info.php.source.html#l147')" href="info.php.source.html#l147">is_available</a>(&amp;<a href="../../_variables/information.html">$information</a>, <a href="../../_variables/grabthelot.html">$grabthelot</a> = false, <a href="../../_variables/userid.html">$userid</a> = 0,\course_modinfo <a href="../../_variables/modinfo.html">$modinfo</a> = null)&nbsp;&nbsp;
<a href="../../_functions/is_available.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Determines whether this particular item is currently available<BR>
according to the availability criteria.<BR>
</b><BR>- This does not include the 'visible' setting (i.e. this might return<BR>
true even if visible is false); visible is handled independently.<BR>
- This does not take account of the viewhiddenactivities capability.<BR>
That should apply later.<BR>
<BR>
Depending on options selected, a description of the restrictions which<BR>
mean the student can't view it (in HTML format) may be stored in<BR>
$information. If there is nothing in $information and this function<BR>
returns false, then the activity should not be displayed at all.<BR>
<BR>
This function displays debugging() messages if the availability<BR>
information is invalid.<BR>
<BR>
<b>param:</b> string $information String describing restrictions in HTML format<br>
<b>param:</b> bool $grabthelot Performance hint: if true, caches information<br>
<b>param:</b> int $userid If set, specifies a different user ID to check availability for<br>
<b>param:</b> \course_modinfo $modinfo Usually leave as null for default. Specify when<br>
<b>return:</b> bool True if this item is available to the user, false otherwise<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="is_available_for_all" onClick="logFunction('is_available_for_all', 'info.php.source.html#l224')" href="info.php.source.html#l224">is_available_for_all</a>()&nbsp;&nbsp;
<a href="../../_functions/is_available_for_all.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Checks whether this activity is going to be available for all users.<BR>
</b><BR>Normally, if there are any conditions, then it may be hidden depending<BR>
on the user. However in the case of date conditions there are some<BR>
conditions which will definitely not result in it being hidden for<BR>
anyone.<BR>
<BR>
<b>return:</b> bool True if activity is available for all<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_full_information" onClick="logFunction('get_full_information', 'info.php.source.html#l247')" href="info.php.source.html#l247">get_full_information</a>(\course_modinfo <a href="../../_variables/modinfo.html">$modinfo</a> = null)&nbsp;&nbsp;
<a href="../../_functions/get_full_information.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Obtains a string describing all availability restrictions (even if<BR>
they do not apply any more). Used to display information for staff<BR>
editing the website.<BR>
</b><BR>The modinfo parameter must be specified when it is called from inside<BR>
get_fast_modinfo, to avoid infinite recursion.<BR>
<BR>
This function displays debugging() messages if the availability<BR>
information is invalid.<BR>
<BR>
<b>param:</b> \course_modinfo $modinfo Usually leave as null for default<br>
<b>return:</b> string Information string (for admin) about all restrictions on<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="warn_about_invalid_availability" onClick="logFunction('warn_about_invalid_availability', 'info.php.source.html#l284')" href="info.php.source.html#l284">warn_about_invalid_availability</a>(\coding_exception <a href="../../_variables/e.html">$e</a>)&nbsp;&nbsp;
<a href="../../_functions/warn_about_invalid_availability.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>In some places we catch coding_exception because if a bug happens, it<BR>
would be fatal for the course page GUI; instead we just show a developer<BR>
debug message.<BR>
</b><BR><b>param:</b> \coding_exception $e Exception that occurred<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_after_restore" onClick="logFunction('update_after_restore', 'info.php.source.html#l305')" href="info.php.source.html#l305">update_after_restore</a>(<a href="../../_variables/restoreid.html">$restoreid</a>, <a href="../../_variables/courseid.html">$courseid</a>, \base_logger <a href="../../_variables/logger.html">$logger</a>,<a href="../../_variables/dateoffset.html">$dateoffset</a>, \base_task <a href="../../_variables/task.html">$task</a>)&nbsp;&nbsp;
<a href="../../_functions/update_after_restore.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Called during restore (near end of restore). Updates any necessary ids<BR>
and writes the updated tree to the database. May output warnings if<BR>
necessary (e.g. if a course-module cannot be found after restore).<BR>
</b><BR><b>param:</b> string $restoreid Restore identifier<br>
<b>param:</b> int $courseid Target course id<br>
<b>param:</b> \base_logger $logger Logger for any warnings<br>
<b>param:</b> int $dateoffset Date offset to be added to any dates (0 = none)<br>
<b>param:</b> \base_task $task Restore task<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_restore_date_offset" onClick="logFunction('get_restore_date_offset', 'info.php.source.html#l336')" href="info.php.source.html#l336">get_restore_date_offset</a>(<a href="../../_variables/restoreid.html">$restoreid</a>)&nbsp;&nbsp;
<a href="../../_functions/get_restore_date_offset.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Gets the date offset (amount by which any date values should be<BR>
adjusted) for the current restore.<BR>
</b><BR><b>param:</b> string $restoreid Restore identifier<br>
<b>return:</b> int Date offset (0 if none)<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_restore_task" onClick="logFunction('get_restore_task', 'info.php.source.html#l354')" href="info.php.source.html#l354">get_restore_task</a>(<a href="../../_variables/restoreid.html">$restoreid</a>)&nbsp;&nbsp;
<a href="../../_functions/get_restore_task.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Gets the restore task (specifically, the task that calls the<BR>
update_after_restore method) for the current restore.<BR>
</b><BR><b>param:</b> string $restoreid Restore identifier<br>
<b>return:</b> \base_task Restore task<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_dependency_id_across_course" onClick="logFunction('update_dependency_id_across_course', 'info.php.source.html#l389')" href="info.php.source.html#l389">update_dependency_id_across_course</a>(<a href="../../_variables/courseorid.html">$courseorid</a>, <a href="../../_variables/table.html">$table</a>, <a href="../../_variables/oldid.html">$oldid</a>, <a href="../../_variables/newid.html">$newid</a>)&nbsp;&nbsp;
<a href="../../_functions/update_dependency_id_across_course.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>In rare cases the system may want to change all references to one ID<BR>
(e.g. one course-module ID) to another one, within a course. This<BR>
function does that for the conditional availability data for all<BR>
modules and sections on the course.<BR>
</b><BR><b>param:</b> int|\stdClass $courseorid Course id or object<br>
<b>param:</b> string $table Table name e.g. 'course_modules'<br>
<b>param:</b> int $oldid Previous ID<br>
<b>param:</b> int $newid New ID<br>
<b>return:</b> bool True if anything changed, otherwise false<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_dependency_id" onClick="logFunction('update_dependency_id', 'info.php.source.html#l424')" href="info.php.source.html#l424">update_dependency_id</a>(<a href="../../_variables/table.html">$table</a>, <a href="../../_variables/oldid.html">$oldid</a>, <a href="../../_variables/newid.html">$newid</a>)&nbsp;&nbsp;
<a href="../../_functions/update_dependency_id.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Called on a single item. If necessary, updates availability data where<BR>
it has a dependency on an item with a particular id.<BR>
</b><BR><b>param:</b> string $table Table name e.g. 'course_modules'<br>
<b>param:</b> int $oldid Previous ID<br>
<b>param:</b> int $newid New ID<br>
<b>return:</b> bool True if it changed, otherwise false<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="convert_legacy_fields" onClick="logFunction('convert_legacy_fields', 'info.php.source.html#l449')" href="info.php.source.html#l449">convert_legacy_fields</a>(<a href="../../_variables/rec.html">$rec</a>, <a href="../../_variables/section.html">$section</a>, <a href="../../_variables/modgroupmembersonlyignored.html">$modgroupmembersonlyignored</a> = false)&nbsp;&nbsp;
<a href="../../_functions/convert_legacy_fields.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Converts legacy data from fields (if provided) into the new availability<BR>
syntax.<BR>
</b><BR>Supported fields: availablefrom, availableuntil, showavailability<BR>
(and groupingid for sections).<BR>
<BR>
It also supports the groupmembersonly field for modules. This part was<BR>
optional in 2.7 but now always runs (because groupmembersonly has been<BR>
removed).<BR>
<BR>
<b>param:</b> \stdClass $rec Object possibly containing legacy fields<br>
<b>param:</b> bool $section True if this is a section<br>
<b>param:</b> bool $modgroupmembersonlyignored Ignored option, previously used<br>
<b>return:</b> string|null New availability value or null if none<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="add_legacy_availability_condition" onClick="logFunction('add_legacy_availability_condition', 'info.php.source.html#l512')" href="info.php.source.html#l512">add_legacy_availability_condition</a>(<a href="../../_variables/availability.html">$availability</a>, <a href="../../_variables/rec.html">$rec</a>, <a href="../../_variables/show.html">$show</a>)&nbsp;&nbsp;
<a href="../../_functions/add_legacy_availability_condition.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Adds a condition from the legacy availability condition.<BR>
</b><BR>(For use during restore only.)<BR>
<BR>
This function assumes that the activity either has no conditions, or<BR>
that it has an AND tree with one or more conditions.<BR>
<BR>
<b>param:</b> string|null $availability Current availability conditions<br>
<b>param:</b> \stdClass $rec Object containing information from old table<br>
<b>param:</b> bool $show True if 'show' option should be enabled<br>
<b>return:</b> string New availability conditions<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="add_legacy_availability_field_condition" onClick="logFunction('add_legacy_availability_field_condition', 'info.php.source.html#l545')" href="info.php.source.html#l545">add_legacy_availability_field_condition</a>(<a href="../../_variables/availability.html">$availability</a>, <a href="../../_variables/rec.html">$rec</a>, <a href="../../_variables/show.html">$show</a>)&nbsp;&nbsp;
<a href="../../_functions/add_legacy_availability_field_condition.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Adds a condition from the legacy availability field condition.<BR>
</b><BR>(For use during restore only.)<BR>
<BR>
This function assumes that the activity either has no conditions, or<BR>
that it has an AND tree with one or more conditions.<BR>
<BR>
<b>param:</b> string|null $availability Current availability conditions<br>
<b>param:</b> \stdClass $rec Object containing information from old table<br>
<b>param:</b> bool $show True if 'show' option should be enabled<br>
<b>return:</b> string New availability conditions<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="add_legacy_condition" onClick="logFunction('add_legacy_condition', 'info.php.source.html#l583')" href="info.php.source.html#l583">add_legacy_condition</a>(<a href="../../_variables/availability.html">$availability</a>, <a href="../../_variables/condition.html">$condition</a>, <a href="../../_variables/show.html">$show</a>)&nbsp;&nbsp;
<a href="../../_functions/add_legacy_condition.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Adds a condition to an AND group.<BR>
</b><BR>(For use during restore only.)<BR>
<BR>
This function assumes that the activity either has no conditions, or<BR>
that it has only conditions added by this function.<BR>
<BR>
<b>param:</b> string|null $availability Current availability conditions<br>
<b>param:</b> string $condition Condition text '{...}'<br>
<b>param:</b> bool $show True if 'show' option should be enabled<br>
<b>return:</b> string New availability conditions<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="filter_user_list" onClick="logFunction('filter_user_list', 'info.php.source.html#l613')" href="info.php.source.html#l613">filter_user_list</a>(array <a href="../../_variables/users.html">$users</a>)&nbsp;&nbsp;
<a href="../../_functions/filter_user_list.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Tests against a user list. Users who cannot access the activity due to<BR>
availability restrictions will be removed from the list.<BR>
</b><BR>Note this only includes availability restrictions (those handled within<BR>
this API) and not other ways of restricting access.<BR>
<BR>
This test ONLY includes conditions which are marked as being applied to<BR>
user lists. For example, group conditions are included but date<BR>
conditions are not included.<BR>
<BR>
The function operates reasonably efficiently i.e. should not do per-user<BR>
database queries. It is however likely to be fairly slow.<BR>
<BR>
<b>param:</b> array $users Array of userid =&gt; object<br>
<b>return:</b> array Filtered version of input array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_user_list_sql" onClick="logFunction('get_user_list_sql', 'info.php.source.html#l665')" href="info.php.source.html#l665">get_user_list_sql</a>(<a href="../../_variables/onlyactive.html">$onlyactive</a>)&nbsp;&nbsp;
<a href="../../_functions/get_user_list_sql.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Obtains SQL that returns a list of enrolled users that has been filtered<BR>
by the conditions applied in the availability API, similar to calling<BR>
get_enrolled_users and then filter_user_list. As for filter_user_list,<BR>
this ONLY filters out users with conditions that are marked as applying<BR>
to user lists. For example, group conditions are included but date<BR>
conditions are not included.<BR>
</b><BR>The returned SQL is a query that returns a list of user IDs. It does not<BR>
include brackets, so you neeed to add these to make it into a subquery.<BR>
You would normally use it in an SQL phrase like &quot;WHERE u.id IN ($sql)&quot;.<BR>
<BR>
The function returns an array with '' and an empty array, if there are<BR>
no restrictions on users from these conditions.<BR>
<BR>
The SQL will be complex and may be slow. It uses named parameters (sorry,<BR>
I know they are annoying, but it was unavoidable here).<BR>
<BR>
<b>param:</b> bool $onlyactive True if including only active enrolments<br>
<b>return:</b> array Array of SQL code (may be empty) and params<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="format_info" onClick="logFunction('format_info', 'info.php.source.html#l709')" href="info.php.source.html#l709">format_info</a>(<a href="../../_variables/inforenderable.html">$inforenderable</a>, <a href="../../_variables/courseorid.html">$courseorid</a>)&nbsp;&nbsp;
<a href="../../_functions/format_info.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Formats the $cm-&gt;availableinfo string for display. This includes<BR>
filling in the names of any course-modules that might be mentioned.<BR>
Should be called immediately prior to display, or at least somewhere<BR>
that we can guarantee does not happen from within building the modinfo<BR>
object.<BR>
</b><BR><b>param:</b> \renderable|string $inforenderable Info string or renderable<br>
<b>param:</b> int|\stdClass $courseorid<br>
<b>return:</b> string Correctly formatted info string<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="completion_value_used" onClick="logFunction('completion_value_used', 'info.php.source.html#l762')" href="info.php.source.html#l762">completion_value_used</a>(<a href="../../_variables/course.html">$course</a>, <a href="../../_variables/cmid.html">$cmid</a>)&nbsp;&nbsp;
<a href="../../_functions/completion_value_used.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
</div></div>

</div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
