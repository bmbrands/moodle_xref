<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /admin/tool/log/store/standard/backup/moodle2/restore_logstore_standard_subplugin.class.php source</title>
    <link rel="stylesheet" href="../../../../../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../../../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../../../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../../../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../../../../../';
subdir='admin/tool/log/store/standard/backup/moodle2';
filename='restore_logstore_standard_subplugin.class.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../../../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../../../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../../../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/admin/tool/log/store/standard/backup/moodle2/</a> -> <a href="restore_logstore_standard_subplugin.class.php.html">restore_logstore_standard_subplugin.class.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="restore_logstore_standard_subplugin.class.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="restore_logstore_standard_subplugin.class.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Restore implementation for the (tool_log) logstore_standard subplugin.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    logstore_standard</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @category   backup</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @copyright  2015 onwards Eloy Lafuente (stronk7) {@link http://stronk7.com}</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../../../../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../../../../../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('restore_logstore_standard_subplugin')" href="../../../../../../../_classes/restore_logstore_standard_subplugin.html" onMouseOver="classPopup(event,'restore_logstore_standard_subplugin')">restore_logstore_standard_subplugin</a> extends restore_tool_log_logstore_subplugin {
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>      <span class="comment">/**</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment">     * Returns the subplugin structure to attach to the 'logstore' XML element.</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment">     *</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment">     * @return restore_path_element[] array of elements to be processed on restore.</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment">     */</span>
<a name="l35"><span class="linenum">  35</span></a>      protected function <a class="function" onClick="logFunction('define_logstore_subplugin_structure')" href="../../../../../../../_functions/define_logstore_subplugin_structure.html" onMouseOver="funcPopup(event,'define_logstore_subplugin_structure')">define_logstore_subplugin_structure</a>() {
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment">        // If the logstore is not enabled we don't add structures for it.</span>
<a name="l38"><span class="linenum">  38</span></a>          <a class="var it10632" onMouseOver="hilite(10632)" onMouseOut="lolite()" onClick="logVariable('enabledlogstores')" href="../../../../../../../_variables/enabledlogstores.html">$enabledlogstores</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../../../../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="function" onClick="logFunction('get_config')" href="../../../../../../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('tool_log', 'enabled_stores'));
<a name="l39"><span class="linenum">  39</span></a>          if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../../../../../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('logstore_standard', <a class="var it10632" onMouseOver="hilite(10632)" onMouseOut="lolite()" onClick="logVariable('enabledlogstores')" href="../../../../../../../_variables/enabledlogstores.html">$enabledlogstores</a>)) {
<a name="l40"><span class="linenum">  40</span></a>              return array(); <span class="comment">// The logstore is not enabled, nothing to restore.</span>
<a name="l41"><span class="linenum">  41</span></a>          }
<a name="l42"><span class="linenum">  42</span></a>  
<a name="l43"><span class="linenum">  43</span></a>          <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../../../../../../../_variables/paths.html">$paths</a> = array();
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>          <a class="var it2518" onMouseOver="hilite(2518)" onMouseOut="lolite()" onClick="logVariable('elename')" href="../../../../../../../_variables/elename.html">$elename</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_namefor')" href="../../../../../../../_functions/get_namefor.html" onMouseOver="funcPopup(event,'get_namefor')">get_namefor</a>('log');
<a name="l46"><span class="linenum">  46</span></a>          <a class="var it2519" onMouseOver="hilite(2519)" onMouseOut="lolite()" onClick="logVariable('elepath')" href="../../../../../../../_variables/elepath.html">$elepath</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_pathfor')" href="../../../../../../../_functions/get_pathfor.html" onMouseOver="funcPopup(event,'get_pathfor')">get_pathfor</a>('/logstore_standard_log');
<a name="l47"><span class="linenum">  47</span></a>          <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../../../../../../../_variables/paths.html">$paths</a>[] = <span class="keyword">new </span><a class="class" onClick="logClass('restore_path_element')" href="../../../../../../../_classes/restore_path_element.html" onMouseOver="classPopup(event,'restore_path_element')">restore_path_element</a>(<a class="var it2518" onMouseOver="hilite(2518)" onMouseOut="lolite()" onClick="logVariable('elename')" href="../../../../../../../_variables/elename.html">$elename</a>, <a class="var it2519" onMouseOver="hilite(2519)" onMouseOut="lolite()" onClick="logVariable('elepath')" href="../../../../../../../_variables/elepath.html">$elepath</a>);
<a name="l48"><span class="linenum">  48</span></a>  
<a name="l49"><span class="linenum">  49</span></a>          return <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../../../../../../../_variables/paths.html">$paths</a>;
<a name="l50"><span class="linenum">  50</span></a>      }
<a name="l51"><span class="linenum">  51</span></a>  
<a name="l52"><span class="linenum">  52</span></a>      <span class="comment">/**</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">     * Process logstore_standard_log entries.</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     *</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment">     * This method proceeds to read, complete, remap and, finally,</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">     * discard or save every log entry.</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">     *</span>
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment">     * @param array() $data log entry.</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment">     */</span>
<a name="l60"><span class="linenum">  60</span></a>      public function <a class="function" onClick="logFunction('process_logstore_standard_log')" href="../../../../../../../_functions/process_logstore_standard_log.html" onMouseOver="funcPopup(event,'process_logstore_standard_log')">process_logstore_standard_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../../../../../_variables/data.html">$data</a>) {
<a name="l61"><span class="linenum">  61</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../../../../_variables/DB.html">$DB</a>;
<a name="l62"><span class="linenum">  62</span></a>  
<a name="l63"><span class="linenum">  63</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../../../../../_variables/data.html">$data</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_log')" href="../../../../../../../_functions/process_log.html" onMouseOver="funcPopup(event,'process_log')">process_log</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../../../../../_variables/data.html">$data</a>);
<a name="l64"><span class="linenum">  64</span></a>  
<a name="l65"><span class="linenum">  65</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../../../../../_variables/data.html">$data</a>) {
<a name="l66"><span class="linenum">  66</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../../../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('logstore_standard_log', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../../../../../_variables/data.html">$data</a>);
<a name="l67"><span class="linenum">  67</span></a>          }
<a name="l68"><span class="linenum">  68</span></a>      }
<a name="l69"><span class="linenum">  69</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'define_logstore_subplugin_structure': ['define_logstore_subplugin_structure', 'Returns the subplugin structure to attach to the \'logstore\' XML element. ', [['admin/tool/log/store/standard/backup/moodle2','restore_logstore_standard_subplugin.class.php',30],['admin/tool/log/store/database/backup/moodle2','backup_logstore_database_subplugin.class.php',31],['admin/tool/log/store/standard/backup/moodle2','backup_logstore_standard_subplugin.class.php',30],['admin/tool/log/store/database/backup/moodle2','restore_logstore_database_subplugin.class.php',60]], 0],
'get_namefor': ['get_namefor', 'Simple helper function that returns the name for the restore_path_element It\'s not mandatory to use it but recommended ;-) ', [['backup/moodle2','restore_plugin.class.php',242],['backup/moodle2','restore_subplugin.class.php',181]], 44],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'process_log': ['process_log', 'Process log entries. ', [['admin/tool/log/backup/moodle2','restore_tool_log_logstore_subplugin.class.php',38],['backup/moodle2','restore_stepslib.php',3030],['backup/moodle2','restore_stepslib.php',3077]], 2],
'process_logstore_standard_log': ['process_logstore_standard_log', 'Process logstore_standard_log entries. ', [['admin/tool/log/store/standard/backup/moodle2','restore_logstore_standard_subplugin.class.php',52]], 0],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'get_pathfor': ['get_pathfor', 'Simple helper function that returns the base (prefix) of the path for the restore_path_element Useful if we used get_recommended_name() in backup. It\'s not mandatory to use it but recommended ;-) ', [['backup/moodle2','restore_plugin.class.php',251],['backup/moodle2','restore_subplugin.class.php',190]], 63],
'defined': ['defined', '', [], 4731],
'explode': ['explode', '', [], 1572],
'in_array': ['in_array', '', [], 1234]};
CLASS_DATA={
'restore_path_element': ['restore_path_element', 'Class representing one path to be restored from XML file ', [['backup/util/structure','restore_path_element.class.php',27]], 232],
'restore_logstore_standard_subplugin': ['restore_logstore_standard_subplugin', '', [['admin/tool/log/store/standard/backup/moodle2','restore_logstore_standard_subplugin.class.php',28]], 0]};
CONST_DATA={
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
