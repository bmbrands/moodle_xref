<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /admin/tool/monitor/classes/rule_manager.php source</title>
    <link rel="stylesheet" href="../../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../../';
subdir='admin/tool/monitor/classes';
filename='rule_manager.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/admin/tool/monitor/classes/</a> -> <a href="rule_manager.php.html">rule_manager.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="rule_manager.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="rule_manager.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Rule manager class.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    tool_monitor</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright  2014 onwards Simey Lameze &lt;lameze@gmail.com&gt;</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  namespace tool_monitor;
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment">/**</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * Rule manager class.</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> *</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * @package    tool_monitor</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * @copyright  2014 onwards Simey Lameze &lt;lameze@gmail.com&gt;</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> */</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('rule_manager')" href="../../../../_classes/rule_manager.html" onMouseOver="classPopup(event,'rule_manager')">rule_manager</a> {
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>      <span class="comment">/**</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">     * Create a new rule.</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">     *</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">     * @param \stdClass $ruledata data to insert as new rule entry.</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">     *</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment">     * @return rule An instance of rule class.</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">     */</span>
<a name="l44"><span class="linenum">  44</span></a>      public static function <a class="function" onClick="logFunction('add_rule')" href="../../../../_functions/add_rule.html" onMouseOver="funcPopup(event,'add_rule')">add_rule</a>(<a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>) {
<a name="l45"><span class="linenum">  45</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l46"><span class="linenum">  46</span></a>  
<a name="l47"><span class="linenum">  47</span></a>          <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l48"><span class="linenum">  48</span></a>          <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('timecreated')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/timecreated.html">timecreated</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../../_variables/now.html">$now</a>;
<a name="l49"><span class="linenum">  49</span></a>          <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('timemodified')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/timemodified.html">timemodified</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../../../_variables/now.html">$now</a>;
<a name="l50"><span class="linenum">  50</span></a>  
<a name="l51"><span class="linenum">  51</span></a>          <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('id')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('tool_monitor_rules', <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>);
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">        // Trigger a rule created event.</span>
<a name="l54"><span class="linenum">  54</span></a>          if (<a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('id')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a>) {
<a name="l55"><span class="linenum">  55</span></a>              if (!empty(<a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('courseid')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>)) {
<a name="l56"><span class="linenum">  56</span></a>                  <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a> = <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('courseid')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>;
<a name="l57"><span class="linenum">  57</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a> = \<a class="class" onClick="logClass('context_course')" href="../../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('courseid')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>);
<a name="l58"><span class="linenum">  58</span></a>              } else {
<a name="l59"><span class="linenum">  59</span></a>                  <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a> = 0;
<a name="l60"><span class="linenum">  60</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a> = \<a class="class" onClick="logClass('context_system')" href="../../../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l61"><span class="linenum">  61</span></a>              }
<a name="l62"><span class="linenum">  62</span></a>  
<a name="l63"><span class="linenum">  63</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a> = array(
<a name="l64"><span class="linenum">  64</span></a>                  'objectid' =&gt; <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('id')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a>,
<a name="l65"><span class="linenum">  65</span></a>                  'courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a>,
<a name="l66"><span class="linenum">  66</span></a>                  'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a>
<a name="l67"><span class="linenum">  67</span></a>              );
<a name="l68"><span class="linenum">  68</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../../_variables/event.html">$event</a> = \tool_monitor\event\<a class="class" onClick="logClass('rule_created')" href="../../../../_classes/rule_created.html" onMouseOver="classPopup(event,'rule_created')">rule_created</a>::<a class="function" onClick="logFunction('create')" href="../../../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a>);
<a name="l69"><span class="linenum">  69</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l70"><span class="linenum">  70</span></a>          }
<a name="l71"><span class="linenum">  71</span></a>  
<a name="l72"><span class="linenum">  72</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('rule')" href="../../../../_classes/rule.html" onMouseOver="classPopup(event,'rule')">rule</a>(<a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>);
<a name="l73"><span class="linenum">  73</span></a>      }
<a name="l74"><span class="linenum">  74</span></a>  
<a name="l75"><span class="linenum">  75</span></a>      <span class="comment">/**</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">     * Clean data submitted by mform.</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">     *</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">     * @param \stdClass $mformdata data to insert as new rule entry.</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">     *</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">     * @return \stdClass Cleaned rule data.</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">     */</span>
<a name="l82"><span class="linenum">  82</span></a>      public static function <a class="function" onClick="logFunction('clean_ruledata_form')" href="../../../../_functions/clean_ruledata_form.html" onMouseOver="funcPopup(event,'clean_ruledata_form')">clean_ruledata_form</a>(<a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>) {
<a name="l83"><span class="linenum">  83</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../../../_variables/USER.html">$USER</a>;
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a> = new \stdClass();
<a name="l86"><span class="linenum">  86</span></a>          if (!empty(<a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('ruleid')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/ruleid.html">ruleid</a>)) {
<a name="l87"><span class="linenum">  87</span></a>              <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('id')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('ruleid')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/ruleid.html">ruleid</a>;
<a name="l88"><span class="linenum">  88</span></a>          }
<a name="l89"><span class="linenum">  89</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('userid')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/userid.html">userid</a> = empty(<a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('userid')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/userid.html">userid</a>) ? <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a> : <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('userid')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/userid.html">userid</a>;
<a name="l90"><span class="linenum">  90</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('courseid')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('courseid')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>;
<a name="l91"><span class="linenum">  91</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('name')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/name.html">name</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('name')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/name.html">name</a>;
<a name="l92"><span class="linenum">  92</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('plugin')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/plugin.html">plugin</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('plugin')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/plugin.html">plugin</a>;
<a name="l93"><span class="linenum">  93</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('eventname')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/eventname.html">eventname</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('eventname')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/eventname.html">eventname</a>;
<a name="l94"><span class="linenum">  94</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('description')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/description.html">description</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('description')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/description.html">description</a>['text'];
<a name="l95"><span class="linenum">  95</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('descriptionformat')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/descriptionformat.html">descriptionformat</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('description')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/description.html">description</a>['format'];
<a name="l96"><span class="linenum">  96</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('frequency')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/frequency.html">frequency</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('frequency')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/frequency.html">frequency</a>;
<a name="l97"><span class="linenum">  97</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('timewindow')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/timewindow.html">timewindow</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('minutes')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/minutes.html">minutes</a> * <a class="constant" onClick="logConstant('MINSECS')" href="../../../../_constants/MINSECS.html" onMouseOver="constPopup(event,'MINSECS')">MINSECS</a>;
<a name="l98"><span class="linenum">  98</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('template')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/template.html">template</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('template')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/template.html">template</a>['text'];
<a name="l99"><span class="linenum">  99</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('templateformat')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/templateformat.html">templateformat</a> = <a class="var it29579" onMouseOver="hilite(29579)" onMouseOut="lolite()" onClick="logVariable('mformdata')" href="../../../../_variables/mformdata.html">$mformdata</a>-&gt;<a onClick="logVariable('template')" class="var it45011" onMouseOver="hilite(45011)" onMouseOut="lolite()" href="../../../../_variables/template.html">template</a>['format'];
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>          return <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>;
<a name="l102"><span class="linenum"> 102</span></a>      }
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>      <span class="comment">/**</span>
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment">     * Delete a rule and associated subscriptions, by rule id.</span>
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment">     *</span>
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment">     * @param int $ruleid id of rule to be deleted.</span>
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment">     * @param \context|null $coursecontext the context of the course - this is passed when we</span>
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">     *      can not get the context via \context_course as the course has been deleted.</span>
<a name="l110"><span class="linenum"> 110</span></a>  <span class="comment">     *</span>
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment">     * @return bool</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment">     */</span>
<a name="l113"><span class="linenum"> 113</span></a>      public static function <a class="function" onClick="logFunction('delete_rule')" href="../../../../_functions/delete_rule.html" onMouseOver="funcPopup(event,'delete_rule')">delete_rule</a>(<a class="var it10030" onMouseOver="hilite(10030)" onMouseOut="lolite()" onClick="logVariable('ruleid')" href="../../../../_variables/ruleid.html">$ruleid</a>, <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../../../_variables/coursecontext.html">$coursecontext</a> = null) {
<a name="l114"><span class="linenum"> 114</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>          <a class="class" onClick="logClass('subscription_manager')" href="../../../../_classes/subscription_manager.html" onMouseOver="classPopup(event,'subscription_manager')">subscription_manager</a>::<a class="function" onClick="logFunction('remove_all_subscriptions_for_rule')" href="../../../../_functions/remove_all_subscriptions_for_rule.html" onMouseOver="funcPopup(event,'remove_all_subscriptions_for_rule')">remove_all_subscriptions_for_rule</a>(<a class="var it10030" onMouseOver="hilite(10030)" onMouseOut="lolite()" onClick="logVariable('ruleid')" href="../../../../_variables/ruleid.html">$ruleid</a>, <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../../../_variables/coursecontext.html">$coursecontext</a>);
<a name="l117"><span class="linenum"> 117</span></a>  
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment">        // Retrieve the rule from the DB before we delete it, so we have a record when we trigger a rule deleted event.</span>
<a name="l119"><span class="linenum"> 119</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('tool_monitor_rules', array('id' =&gt; <a class="var it10030" onMouseOver="hilite(10030)" onMouseOut="lolite()" onClick="logVariable('ruleid')" href="../../../../_variables/ruleid.html">$ruleid</a>));
<a name="l120"><span class="linenum"> 120</span></a>  
<a name="l121"><span class="linenum"> 121</span></a>          <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../../../_variables/success.html">$success</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('tool_monitor_rules', array('id' =&gt; <a class="var it10030" onMouseOver="hilite(10030)" onMouseOut="lolite()" onClick="logVariable('ruleid')" href="../../../../_variables/ruleid.html">$ruleid</a>));
<a name="l122"><span class="linenum"> 122</span></a>  
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment">        // If successful trigger a rule deleted event.</span>
<a name="l124"><span class="linenum"> 124</span></a>          if (<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../../../_variables/success.html">$success</a>) {
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">            // It is possible that we are deleting rules associated with a deleted course, so we should be</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">            // passing the context as the second parameter.</span>
<a name="l127"><span class="linenum"> 127</span></a>              if (!<a class="phpfunction" onClick="logFunction('is_null')" href="../../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../../../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l128"><span class="linenum"> 128</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a> = <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../../../_variables/coursecontext.html">$coursecontext</a>;
<a name="l129"><span class="linenum"> 129</span></a>                  <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a> = <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('courseid')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>;
<a name="l130"><span class="linenum"> 130</span></a>              } else if (!empty(<a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('courseid')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>) &amp;&amp; (<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a> = \<a class="class" onClick="logClass('context_course')" href="../../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('courseid')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>,
<a name="l131"><span class="linenum"> 131</span></a>                      <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../../../../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>))) {
<a name="l132"><span class="linenum"> 132</span></a>                  <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a> = <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('courseid')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>;
<a name="l133"><span class="linenum"> 133</span></a>              } else {
<a name="l134"><span class="linenum"> 134</span></a>                  <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a> = 0;
<a name="l135"><span class="linenum"> 135</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a> = \<a class="class" onClick="logClass('context_system')" href="../../../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l136"><span class="linenum"> 136</span></a>              }
<a name="l137"><span class="linenum"> 137</span></a>  
<a name="l138"><span class="linenum"> 138</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a> = array(
<a name="l139"><span class="linenum"> 139</span></a>                  'objectid' =&gt; <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>-&gt;<a onClick="logVariable('id')" class="var it43074" onMouseOver="hilite(43074)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a>,
<a name="l140"><span class="linenum"> 140</span></a>                  'courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a>,
<a name="l141"><span class="linenum"> 141</span></a>                  'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a>
<a name="l142"><span class="linenum"> 142</span></a>              );
<a name="l143"><span class="linenum"> 143</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../../_variables/event.html">$event</a> = \tool_monitor\event\<a class="class" onClick="logClass('rule_deleted')" href="../../../../_classes/rule_deleted.html" onMouseOver="classPopup(event,'rule_deleted')">rule_deleted</a>::<a class="function" onClick="logFunction('create')" href="../../../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a>);
<a name="l144"><span class="linenum"> 144</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../../../../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('tool_monitor_rules', <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>);
<a name="l145"><span class="linenum"> 145</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l146"><span class="linenum"> 146</span></a>          }
<a name="l147"><span class="linenum"> 147</span></a>  
<a name="l148"><span class="linenum"> 148</span></a>          return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../../../_variables/success.html">$success</a>;
<a name="l149"><span class="linenum"> 149</span></a>      }
<a name="l150"><span class="linenum"> 150</span></a>  
<a name="l151"><span class="linenum"> 151</span></a>      <span class="comment">/**</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment">     * Get an instance of rule class.</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment">     *</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">     * @param \stdClass|int $ruleorid A rule object from database or rule id.</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">     *</span>
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">     * @return rule object with rule id.</span>
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment">     */</span>
<a name="l158"><span class="linenum"> 158</span></a>      public static function <a class="function" onClick="logFunction('get_rule')" href="../../../../_functions/get_rule.html" onMouseOver="funcPopup(event,'get_rule')">get_rule</a>(<a class="var it29580" onMouseOver="hilite(29580)" onMouseOut="lolite()" onClick="logVariable('ruleorid')" href="../../../../_variables/ruleorid.html">$ruleorid</a>) {
<a name="l159"><span class="linenum"> 159</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l160"><span class="linenum"> 160</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it29580" onMouseOver="hilite(29580)" onMouseOut="lolite()" onClick="logVariable('ruleorid')" href="../../../../_variables/ruleorid.html">$ruleorid</a>)) {
<a name="l161"><span class="linenum"> 161</span></a>              <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('tool_monitor_rules', array('id' =&gt; <a class="var it29580" onMouseOver="hilite(29580)" onMouseOut="lolite()" onClick="logVariable('ruleorid')" href="../../../../_variables/ruleorid.html">$ruleorid</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l162"><span class="linenum"> 162</span></a>          } else {
<a name="l163"><span class="linenum"> 163</span></a>              <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a> = <a class="var it29580" onMouseOver="hilite(29580)" onMouseOut="lolite()" onClick="logVariable('ruleorid')" href="../../../../_variables/ruleorid.html">$ruleorid</a>;
<a name="l164"><span class="linenum"> 164</span></a>          }
<a name="l165"><span class="linenum"> 165</span></a>  
<a name="l166"><span class="linenum"> 166</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('rule')" href="../../../../_classes/rule.html" onMouseOver="classPopup(event,'rule')">rule</a>(<a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../../../_variables/rule.html">$rule</a>);
<a name="l167"><span class="linenum"> 167</span></a>      }
<a name="l168"><span class="linenum"> 168</span></a>  
<a name="l169"><span class="linenum"> 169</span></a>      <span class="comment">/**</span>
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment">     * Update rule data.</span>
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">     *</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment">     * @throws \coding_exception if $record-&gt;ruleid is invalid.</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">     * @param object $ruledata rule data to be updated.</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment">     *</span>
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">     * @return bool</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">     */</span>
<a name="l177"><span class="linenum"> 177</span></a>      public static function <a class="function" onClick="logFunction('update_rule')" href="../../../../_functions/update_rule.html" onMouseOver="funcPopup(event,'update_rule')">update_rule</a>(<a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>) {
<a name="l178"><span class="linenum"> 178</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l179"><span class="linenum"> 179</span></a>          if (!self::<a class="function" onClick="logFunction('get_rule')" href="../../../../_functions/get_rule.html" onMouseOver="funcPopup(event,'get_rule')">get_rule</a>(<a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('id')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a>)) {
<a name="l180"><span class="linenum"> 180</span></a>              throw new \coding_exception('Invalid rule ID.');
<a name="l181"><span class="linenum"> 181</span></a>          }
<a name="l182"><span class="linenum"> 182</span></a>          <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('timemodified')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>          <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../../../_variables/success.html">$success</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('tool_monitor_rules', <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>);
<a name="l185"><span class="linenum"> 185</span></a>  
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment">        // If successful trigger a rule updated event.</span>
<a name="l187"><span class="linenum"> 187</span></a>          if (<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../../../_variables/success.html">$success</a>) {
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment">            // If we do not have the course id we need to retrieve it.</span>
<a name="l189"><span class="linenum"> 189</span></a>              if (!isset(<a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('courseid')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>)) {
<a name="l190"><span class="linenum"> 190</span></a>                  <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('tool_monitor_rules', 'courseid', array('id' =&gt; <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('id')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a>), <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l191"><span class="linenum"> 191</span></a>              } else {
<a name="l192"><span class="linenum"> 192</span></a>                  <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a> = <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('courseid')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/courseid.html">courseid</a>;
<a name="l193"><span class="linenum"> 193</span></a>              }
<a name="l194"><span class="linenum"> 194</span></a>  
<a name="l195"><span class="linenum"> 195</span></a>              if (!empty(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a>)) {
<a name="l196"><span class="linenum"> 196</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a> = \<a class="class" onClick="logClass('context_course')" href="../../../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a>);
<a name="l197"><span class="linenum"> 197</span></a>              } else {
<a name="l198"><span class="linenum"> 198</span></a>                  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a> = \<a class="class" onClick="logClass('context_system')" href="../../../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l199"><span class="linenum"> 199</span></a>              }
<a name="l200"><span class="linenum"> 200</span></a>  
<a name="l201"><span class="linenum"> 201</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a> = array(
<a name="l202"><span class="linenum"> 202</span></a>                  'objectid' =&gt; <a class="var it18682" onMouseOver="hilite(18682)" onMouseOut="lolite()" onClick="logVariable('ruledata')" href="../../../../_variables/ruledata.html">$ruledata</a>-&gt;<a onClick="logVariable('id')" class="var it45010" onMouseOver="hilite(45010)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a>,
<a name="l203"><span class="linenum"> 203</span></a>                  'courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a>,
<a name="l204"><span class="linenum"> 204</span></a>                  'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../../_variables/context.html">$context</a>
<a name="l205"><span class="linenum"> 205</span></a>              );
<a name="l206"><span class="linenum"> 206</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../../_variables/event.html">$event</a> = \tool_monitor\event\<a class="class" onClick="logClass('rule_updated')" href="../../../../_classes/rule_updated.html" onMouseOver="classPopup(event,'rule_updated')">rule_updated</a>::<a class="function" onClick="logFunction('create')" href="../../../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a>);
<a name="l207"><span class="linenum"> 207</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l208"><span class="linenum"> 208</span></a>          }
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>          return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../../../_variables/success.html">$success</a>;
<a name="l211"><span class="linenum"> 211</span></a>      }
<a name="l212"><span class="linenum"> 212</span></a>  
<a name="l213"><span class="linenum"> 213</span></a>      <span class="comment">/**</span>
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment">     * Get rules by course id.</span>
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment">     *</span>
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment">     * @param int $courseid course id of the rule.</span>
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment">     * @param int $limitfrom Limit from which to fetch rules.</span>
<a name="l218"><span class="linenum"> 218</span></a>  <span class="comment">     * @param int $limitto  Limit to which rules need to be fetched.</span>
<a name="l219"><span class="linenum"> 219</span></a>  <span class="comment">     * @param bool $includesite Determines whether we return site wide rules or not.</span>
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment">     *</span>
<a name="l221"><span class="linenum"> 221</span></a>  <span class="comment">     * @return array List of rules for the given course id, if specified will also include site rules.</span>
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment">     */</span>
<a name="l223"><span class="linenum"> 223</span></a>      public static function <a class="function" onClick="logFunction('get_rules_by_courseid')" href="../../../../_functions/get_rules_by_courseid.html" onMouseOver="funcPopup(event,'get_rules_by_courseid')">get_rules_by_courseid</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a>, <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../../../_variables/limitfrom.html">$limitfrom</a> = 0, <a class="var it29581" onMouseOver="hilite(29581)" onMouseOut="lolite()" onClick="logVariable('limitto')" href="../../../../_variables/limitto.html">$limitto</a> = 0, <a class="var it29582" onMouseOver="hilite(29582)" onMouseOut="lolite()" onClick="logVariable('includesite')" href="../../../../_variables/includesite.html">$includesite</a> = true) {
<a name="l224"><span class="linenum"> 224</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l225"><span class="linenum"> 225</span></a>  
<a name="l226"><span class="linenum"> 226</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../../../_variables/select.html">$select</a> = 'courseid = ?';
<a name="l227"><span class="linenum"> 227</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a> = array();
<a name="l228"><span class="linenum"> 228</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a>[] = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a>;
<a name="l229"><span class="linenum"> 229</span></a>          if (<a class="var it29582" onMouseOver="hilite(29582)" onMouseOut="lolite()" onClick="logVariable('includesite')" href="../../../../_variables/includesite.html">$includesite</a>) {
<a name="l230"><span class="linenum"> 230</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../../../_variables/select.html">$select</a> .= ' OR courseid = ?';
<a name="l231"><span class="linenum"> 231</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a>[] = 0;
<a name="l232"><span class="linenum"> 232</span></a>          }
<a name="l233"><span class="linenum"> 233</span></a>          <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../../../_variables/orderby.html">$orderby</a> = 'courseid DESC, name ASC';
<a name="l234"><span class="linenum"> 234</span></a>  
<a name="l235"><span class="linenum"> 235</span></a>          return self::<a class="function" onClick="logFunction('get_instances')" href="../../../../_functions/get_instances.html" onMouseOver="funcPopup(event,'get_instances')">get_instances</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('tool_monitor_rules', <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../../../_variables/select.html">$select</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../../_variables/params.html">$params</a>, <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../../../_variables/orderby.html">$orderby</a>,
<a name="l236"><span class="linenum"> 236</span></a>                  '*', <a class="var it1013" onMouseOver="hilite(1013)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../../../../_variables/limitfrom.html">$limitfrom</a>, <a class="var it29581" onMouseOver="hilite(29581)" onMouseOut="lolite()" onClick="logVariable('limitto')" href="../../../../_variables/limitto.html">$limitto</a>));
<a name="l237"><span class="linenum"> 237</span></a>      }
<a name="l238"><span class="linenum"> 238</span></a>  
<a name="l239"><span class="linenum"> 239</span></a>      <span class="comment">/**</span>
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment">     * Get rule count by course id.</span>
<a name="l241"><span class="linenum"> 241</span></a>  <span class="comment">     *</span>
<a name="l242"><span class="linenum"> 242</span></a>  <span class="comment">     * @param int $courseid course id of the rule.</span>
<a name="l243"><span class="linenum"> 243</span></a>  <span class="comment">     *</span>
<a name="l244"><span class="linenum"> 244</span></a>  <span class="comment">     * @return int count of rules present in system visible in the given course id.</span>
<a name="l245"><span class="linenum"> 245</span></a>  <span class="comment">     */</span>
<a name="l246"><span class="linenum"> 246</span></a>      public static function <a class="function" onClick="logFunction('count_rules_by_courseid')" href="../../../../_functions/count_rules_by_courseid.html" onMouseOver="funcPopup(event,'count_rules_by_courseid')">count_rules_by_courseid</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a>) {
<a name="l247"><span class="linenum"> 247</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l248"><span class="linenum"> 248</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../../../_variables/select.html">$select</a> = &quot;courseid = ? OR courseid = ?&quot;;
<a name="l249"><span class="linenum"> 249</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_select')" href="../../../../_functions/count_records_select.html" onMouseOver="funcPopup(event,'count_records_select')">count_records_select</a>('tool_monitor_rules', <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../../../_variables/select.html">$select</a>, array(0, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../../../_variables/courseid.html">$courseid</a>));
<a name="l250"><span class="linenum"> 250</span></a>      }
<a name="l251"><span class="linenum"> 251</span></a>  
<a name="l252"><span class="linenum"> 252</span></a>      <span class="comment">/**</span>
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment">     * Get rules by plugin name.</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment">     *</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">     * @param string $plugin plugin name of the rule.</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment">     *</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">     * @return array List of rules for the given plugin name.</span>
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment">     */</span>
<a name="l259"><span class="linenum"> 259</span></a>      public static function <a class="function" onClick="logFunction('get_rules_by_plugin')" href="../../../../_functions/get_rules_by_plugin.html" onMouseOver="funcPopup(event,'get_rules_by_plugin')">get_rules_by_plugin</a>(<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../../../_variables/plugin.html">$plugin</a>) {
<a name="l260"><span class="linenum"> 260</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l261"><span class="linenum"> 261</span></a>          return self::<a class="function" onClick="logFunction('get_instances')" href="../../../../_functions/get_instances.html" onMouseOver="funcPopup(event,'get_instances')">get_instances</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('tool_monitor_rules', array('plugin' =&gt; <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../../../_variables/plugin.html">$plugin</a>)));
<a name="l262"><span class="linenum"> 262</span></a>      }
<a name="l263"><span class="linenum"> 263</span></a>  
<a name="l264"><span class="linenum"> 264</span></a>      <span class="comment">/**</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment">     * Get rules by event name.</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment">     *</span>
<a name="l267"><span class="linenum"> 267</span></a>  <span class="comment">     * @param string $eventname event name of the rule.</span>
<a name="l268"><span class="linenum"> 268</span></a>  <span class="comment">     *</span>
<a name="l269"><span class="linenum"> 269</span></a>  <span class="comment">     * @return array List of rules for the given event.</span>
<a name="l270"><span class="linenum"> 270</span></a>  <span class="comment">     */</span>
<a name="l271"><span class="linenum"> 271</span></a>      public static function <a class="function" onClick="logFunction('get_rules_by_event')" href="../../../../_functions/get_rules_by_event.html" onMouseOver="funcPopup(event,'get_rules_by_event')">get_rules_by_event</a>(<a class="var it2532" onMouseOver="hilite(2532)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../../../_variables/eventname.html">$eventname</a>) {
<a name="l272"><span class="linenum"> 272</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l273"><span class="linenum"> 273</span></a>          return self::<a class="function" onClick="logFunction('get_instances')" href="../../../../_functions/get_instances.html" onMouseOver="funcPopup(event,'get_instances')">get_instances</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('tool_monitor_rules', array('eventname' =&gt; <a class="var it2532" onMouseOver="hilite(2532)" onMouseOut="lolite()" onClick="logVariable('eventname')" href="../../../../_variables/eventname.html">$eventname</a>)));
<a name="l274"><span class="linenum"> 274</span></a>      }
<a name="l275"><span class="linenum"> 275</span></a>  
<a name="l276"><span class="linenum"> 276</span></a>      <span class="comment">/**</span>
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment">     * Helper method to convert db records to instances.</span>
<a name="l278"><span class="linenum"> 278</span></a>  <span class="comment">     *</span>
<a name="l279"><span class="linenum"> 279</span></a>  <span class="comment">     * @param array $arr of rules.</span>
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment">     *</span>
<a name="l281"><span class="linenum"> 281</span></a>  <span class="comment">     * @return array of rules as instances.</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">     */</span>
<a name="l283"><span class="linenum"> 283</span></a>      protected static function <a class="function" onClick="logFunction('get_instances')" href="../../../../_functions/get_instances.html" onMouseOver="funcPopup(event,'get_instances')">get_instances</a>(<a class="var it58" onMouseOver="hilite(58)" onMouseOut="lolite()" onClick="logVariable('arr')" href="../../../../_variables/arr.html">$arr</a>) {
<a name="l284"><span class="linenum"> 284</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../../_variables/result.html">$result</a> = array();
<a name="l285"><span class="linenum"> 285</span></a>          foreach (<a class="var it58" onMouseOver="hilite(58)" onMouseOut="lolite()" onClick="logVariable('arr')" href="../../../../_variables/arr.html">$arr</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../../_variables/key.html">$key</a> =&gt; <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('sub')" href="../../../../_variables/sub.html">$sub</a>) {
<a name="l286"><span class="linenum"> 286</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../../_variables/result.html">$result</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../../_variables/key.html">$key</a>] = <span class="keyword">new </span><a class="class" onClick="logClass('rule')" href="../../../../_classes/rule.html" onMouseOver="classPopup(event,'rule')">rule</a>(<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('sub')" href="../../../../_variables/sub.html">$sub</a>);
<a name="l287"><span class="linenum"> 287</span></a>          }
<a name="l288"><span class="linenum"> 288</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../../_variables/result.html">$result</a>;
<a name="l289"><span class="linenum"> 289</span></a>      }
<a name="l290"><span class="linenum"> 290</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',840]], 332],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'add_rule': ['add_rule', 'Adds a new CSS rule to this collection instance ', [['lib','csslib.php',1942],['backup/util/helper','restore_decode_processor.class.php',64],['admin/tool/monitor/classes','rule_manager.php',37]], 8],
'remove_all_subscriptions_for_rule': ['remove_all_subscriptions_for_rule', 'Delete all subscribers for a given rule. ', [['admin/tool/monitor/classes','subscription_manager.php',170]], 2],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'get_rule': ['get_rule', 'Get an instance of rule class. ', [['admin/tool/monitor/classes','rule_manager.php',151]], 5],
'get_rules_by_plugin': ['get_rules_by_plugin', 'Get rules by plugin name. ', [['admin/tool/monitor/classes','rule_manager.php',252]], 7],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'clean_ruledata_form': ['clean_ruledata_form', 'Clean data submitted by mform. ', [['admin/tool/monitor/classes','rule_manager.php',75]], 1],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'get_records_select': ['get_records_select', 'Load a list of records based on a select query. ', [['competency/classes','persistent.php',751],['lib/dml','moodle_database.php',1332]], 166],
'get_rules_by_courseid': ['get_rules_by_courseid', 'Get rules by course id. ', [['admin/tool/monitor/classes','rule_manager.php',213]], 7],
'delete_rule': ['delete_rule', 'Delete this rule. ', [['admin/tool/monitor/classes','rule.php',79],['admin/tool/monitor/classes','rule_manager.php',104]], 15],
'get_instances': ['get_instances', 'Obtains all module instances on this course. ', [['lib','modinfolib.php',235],['repository','lib.php',993],['admin/tool/monitor/classes','rule_manager.php',276],['admin/tool/monitor/classes','subscription_manager.php',370]], 33],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'update_rule': ['update_rule', 'Update rule data. ', [['admin/tool/monitor/classes','rule_manager.php',169]], 9],
'count_records_select': ['count_records_select', 'Count a list of records. ', [['competency/classes','persistent.php',828],['lib/dml','moodle_database.php',1779]], 73],
'get_rules_by_event': ['get_rules_by_event', 'Get rules by event name. ', [['admin/tool/monitor/classes','rule_manager.php',264]], 1],
'count_rules_by_courseid': ['count_rules_by_courseid', 'Get rule count by course id. ', [['admin/tool/monitor/classes','rule_manager.php',239]], 4],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'defined': ['defined', '', [], 4731],
'is_object': ['is_object', '', [], 544],
'is_null': ['is_null', '', [], 2003],
'time': ['time', '', [], 1959]};
CLASS_DATA={
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'rule_created': ['rule_created', 'The tool_monitor rule created event class. ', [['admin/tool/monitor/classes/event','rule_created.php',29]], 1],
'rule_manager': ['rule_manager', 'Rule manager class. ', [['admin/tool/monitor/classes','rule_manager.php',28]], 53],
'rule_deleted': ['rule_deleted', 'The tool_monitor rule deleted event class. ', [['admin/tool/monitor/classes/event','rule_deleted.php',29]], 1],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323],
'rule': ['rule', 'Class represents a single rule. ', [['admin/tool/monitor/classes','rule.php',29]], 51],
'subscription_manager': ['subscription_manager', 'Class to manage subscriptions. ', [['admin/tool/monitor/classes','subscription_manager.php',29]], 61],
'rule_updated': ['rule_updated', 'The tool_monitor rule updated event class. ', [['admin/tool/monitor/classes/event','rule_updated.php',29]], 1]};
CONST_DATA={
'MINSECS': ['MINSECS', '', [['lib','moodlelib.php',59]], 12],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'IGNORE_MISSING': ['IGNORE_MISSING', '', [['lib','dmllib.php',48]], 215]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
