<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /enrol/flatfile/lib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='enrol/flatfile';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/enrol/flatfile/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Flatfile enrolment plugin.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * This plugin lets the user specify a &quot;flatfile&quot; (CSV) containing enrolment information.</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * On a regular cron cycle, the specified file is parsed and then deleted.</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> *</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @package    enrol_flatfile</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @copyright  2010 Eugene Venter</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> */</span>
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment">/**</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * Flatfile enrolment plugin implementation.</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> *</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * Comma separated file assumed to have four or six fields per line:</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> *   operation, role, idnumber(user), idnumber(course) [, starttime [, endtime]]</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * where:</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> *   operation        = add | del</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> *   role             = student | teacher | teacheredit</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> *   idnumber(user)   = idnumber in the user table NB not id</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> *   idnumber(course) = idnumber in the course table NB not id</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment"> *   starttime        = start time (in seconds since epoch) - optional</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment"> *   endtime          = end time (in seconds since epoch) - optional</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> *</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> * @author  Eugene Venter - based on code by Petr Skoda, Martin Dougiamas, Martin Langhoff and others</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment"> * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment"> */</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('enrol_flatfile_plugin')" href="../../_classes/enrol_flatfile_plugin.html" onMouseOver="classPopup(event,'enrol_flatfile_plugin')">enrol_flatfile_plugin</a> extends enrol_plugin {
<a name="l48"><span class="linenum">  48</span></a>      protected <a class="var it4177" onMouseOver="hilite(4177)" onMouseOut="lolite()" onClick="logVariable('lasternoller')" href="../../_variables/lasternoller.html">$lasternoller</a> = null;
<a name="l49"><span class="linenum">  49</span></a>      protected <a class="var it14807" onMouseOver="hilite(14807)" onMouseOut="lolite()" onClick="logVariable('lasternollercourseid')" href="../../_variables/lasternollercourseid.html">$lasternollercourseid</a> = 0;
<a name="l50"><span class="linenum">  50</span></a>  
<a name="l51"><span class="linenum">  51</span></a>      <span class="comment">/**</span>
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment">     * Does this plugin assign protected roles are can they be manually removed?</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">     * @return bool - false means anybody may tweak roles, it does not use itemid and component when assigning roles</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     */</span>
<a name="l55"><span class="linenum">  55</span></a>      public function <a class="function" onClick="logFunction('roles_protected')" href="../../_functions/roles_protected.html" onMouseOver="funcPopup(event,'roles_protected')">roles_protected</a>() {
<a name="l56"><span class="linenum">  56</span></a>          return false;
<a name="l57"><span class="linenum">  57</span></a>      }
<a name="l58"><span class="linenum">  58</span></a>  
<a name="l59"><span class="linenum">  59</span></a>      <span class="comment">/**</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">     * Does this plugin allow manual unenrolment of all users?</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">     * All plugins allowing this must implement 'enrol/xxx:unenrol' capability</span>
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">     *</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">     * @return bool - true means user with 'enrol/xxx:unenrol' may unenrol others freely, false means nobody may touch user_enrolments</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment">     */</span>
<a name="l66"><span class="linenum">  66</span></a>      public function <a class="function" onClick="logFunction('allow_unenrol')" href="../../_functions/allow_unenrol.html" onMouseOver="funcPopup(event,'allow_unenrol')">allow_unenrol</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>) {
<a name="l67"><span class="linenum">  67</span></a>          return true;
<a name="l68"><span class="linenum">  68</span></a>      }
<a name="l69"><span class="linenum">  69</span></a>  
<a name="l70"><span class="linenum">  70</span></a>      <span class="comment">/**</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment">     * Does this plugin allow manual unenrolment of a specific user?</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment">     * All plugins allowing this must implement 'enrol/xxx:unenrol' capability</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment">     *</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">     * This is useful especially for synchronisation plugins that</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">     * do suspend instead of full unenrolment.</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">     *</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">     * @param stdClass $ue record from user_enrolments table, specifies user</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">     *</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">     * @return bool - true means user with 'enrol/xxx:unenrol' may unenrol this user, false means nobody may touch this user enrolment</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">     */</span>
<a name="l82"><span class="linenum">  82</span></a>      public function <a class="function" onClick="logFunction('allow_unenrol_user')" href="../../_functions/allow_unenrol_user.html" onMouseOver="funcPopup(event,'allow_unenrol_user')">allow_unenrol_user</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, stdClass <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a>) {
<a name="l83"><span class="linenum">  83</span></a>          return true;
<a name="l84"><span class="linenum">  84</span></a>      }
<a name="l85"><span class="linenum">  85</span></a>  
<a name="l86"><span class="linenum">  86</span></a>      <span class="comment">/**</span>
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment">     * Does this plugin allow manual changes in user_enrolments table?</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">     *</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">     * All plugins allowing this must implement 'enrol/xxx:manage' capability</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">     *</span>
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">     * @return bool - true means it is possible to change enrol period and status in user_enrolments table</span>
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">     */</span>
<a name="l94"><span class="linenum">  94</span></a>      public function <a class="function" onClick="logFunction('allow_manage')" href="../../_functions/allow_manage.html" onMouseOver="funcPopup(event,'allow_manage')">allow_manage</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>) {
<a name="l95"><span class="linenum">  95</span></a>          return true;
<a name="l96"><span class="linenum">  96</span></a>      }
<a name="l97"><span class="linenum">  97</span></a>  
<a name="l98"><span class="linenum">  98</span></a>      <span class="comment">/**</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment">     * Is it possible to delete enrol instance via standard UI?</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment">     *</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">     * @param object $instance</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">     * @return bool</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">     */</span>
<a name="l104"><span class="linenum"> 104</span></a>      public function <a class="function" onClick="logFunction('can_delete_instance')" href="../../_functions/can_delete_instance.html" onMouseOver="funcPopup(event,'can_delete_instance')">can_delete_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>) {
<a name="l105"><span class="linenum"> 105</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l106"><span class="linenum"> 106</span></a>          return <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('enrol/flatfile:manage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l107"><span class="linenum"> 107</span></a>      }
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>      <span class="comment">/**</span>
<a name="l110"><span class="linenum"> 110</span></a>  <span class="comment">     * Is it possible to hide/show enrol instance via standard UI?</span>
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment">     *</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment">     * @return bool</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment">     */</span>
<a name="l115"><span class="linenum"> 115</span></a>      public function <a class="function" onClick="logFunction('can_hide_show_instance')" href="../../_functions/can_hide_show_instance.html" onMouseOver="funcPopup(event,'can_hide_show_instance')">can_hide_show_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>) {
<a name="l116"><span class="linenum"> 116</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l117"><span class="linenum"> 117</span></a>          return <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('enrol/flatfile:manage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l118"><span class="linenum"> 118</span></a>      }
<a name="l119"><span class="linenum"> 119</span></a>  
<a name="l120"><span class="linenum"> 120</span></a>      <span class="comment">/**</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">     * Gets an array of the user enrolment actions.</span>
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment">     *</span>
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment">     * @param course_enrolment_manager $manager</span>
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">     * @param stdClass $ue A user enrolment object</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">     * @return array An array of user_enrolment_actions</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">     */</span>
<a name="l127"><span class="linenum"> 127</span></a>      public function <a class="function" onClick="logFunction('get_user_enrolment_actions')" href="../../_functions/get_user_enrolment_actions.html" onMouseOver="funcPopup(event,'get_user_enrolment_actions')">get_user_enrolment_actions</a>(course_enrolment_manager <a class="var it1045" onMouseOver="hilite(1045)" onMouseOut="lolite()" onClick="logVariable('manager')" href="../../_variables/manager.html">$manager</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a>) {
<a name="l128"><span class="linenum"> 128</span></a>          <a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('actions')" href="../../_variables/actions.html">$actions</a> = array();
<a name="l129"><span class="linenum"> 129</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it1045" onMouseOver="hilite(1045)" onMouseOut="lolite()" onClick="logVariable('manager')" href="../../_variables/manager.html">$manager</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l130"><span class="linenum"> 130</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a> = <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolmentinstance')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../../_variables/enrolmentinstance.html">enrolmentinstance</a>;
<a name="l131"><span class="linenum"> 131</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="var it1045" onMouseOver="hilite(1045)" onMouseOut="lolite()" onClick="logVariable('manager')" href="../../_variables/manager.html">$manager</a>-&gt;<a class="function" onClick="logFunction('get_moodlepage')" href="../../_functions/get_moodlepage.html" onMouseOver="funcPopup(event,'get_moodlepage')">get_moodlepage</a>()-&gt;url-&gt;<a class="function" onClick="logFunction('params')" href="../../_functions/params.html" onMouseOver="funcPopup(event,'params')">params</a>();
<a name="l132"><span class="linenum"> 132</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['ue'] = <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('id')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l133"><span class="linenum"> 133</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('allow_unenrol_user')" href="../../_functions/allow_unenrol_user.html" onMouseOver="funcPopup(event,'allow_unenrol_user')">allow_unenrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a>) &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(&quot;enrol/flatfile:unenrol&quot;, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l134"><span class="linenum"> 134</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../enrol/unenroluser.php.html">/enrol/unenroluser.php</a>', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l135"><span class="linenum"> 135</span></a>              <a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('actions')" href="../../_variables/actions.html">$actions</a>[] = <span class="keyword">new </span><a class="class" onClick="logClass('user_enrolment_action')" href="../../_classes/user_enrolment_action.html" onMouseOver="classPopup(event,'user_enrolment_action')">user_enrolment_action</a>(<span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('t/delete', ''), <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unenrol', 'enrol'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, array('class'=&gt;'unenrollink', 'rel'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('id')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l136"><span class="linenum"> 136</span></a>          }
<a name="l137"><span class="linenum"> 137</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('allow_manage')" href="../../_functions/allow_manage.html" onMouseOver="funcPopup(event,'allow_manage')">allow_manage</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>) &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(&quot;enrol/flatfile:manage&quot;, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l138"><span class="linenum"> 138</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../enrol/editenrolment.php.html">/enrol/editenrolment.php</a>', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l139"><span class="linenum"> 139</span></a>              <a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('actions')" href="../../_variables/actions.html">$actions</a>[] = <span class="keyword">new </span><a class="class" onClick="logClass('user_enrolment_action')" href="../../_classes/user_enrolment_action.html" onMouseOver="classPopup(event,'user_enrolment_action')">user_enrolment_action</a>(<span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('t/edit', ''), <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('edit'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, array('class'=&gt;'editenrollink', 'rel'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('id')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l140"><span class="linenum"> 140</span></a>          }
<a name="l141"><span class="linenum"> 141</span></a>          return <a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('actions')" href="../../_variables/actions.html">$actions</a>;
<a name="l142"><span class="linenum"> 142</span></a>      }
<a name="l143"><span class="linenum"> 143</span></a>  
<a name="l144"><span class="linenum"> 144</span></a>      <span class="comment">/**</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">     * Enrol user into course via enrol instance.</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">     *</span>
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment">     * @param int $roleid optional role id</span>
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment">     * @param int $timestart 0 means unknown</span>
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment">     * @param int $timeend 0 means forever</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment">     * @param int $status default to ENROL_USER_ACTIVE for new enrolments, no change by default in updates</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment">     * @param bool $recovergrades restore grade history</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">     * @return void</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">     */</span>
<a name="l156"><span class="linenum"> 156</span></a>      public function <a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a> = null, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a> = 0, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../../_variables/timeend.html">$timeend</a> = 0, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = null, <a class="var it4198" onMouseOver="hilite(4198)" onMouseOut="lolite()" onClick="logVariable('recovergrades')" href="../../_variables/recovergrades.html">$recovergrades</a> = null) {
<a name="l157"><span class="linenum"> 157</span></a>          parent::<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, null, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../../_variables/timeend.html">$timeend</a>, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>, <a class="var it4198" onMouseOver="hilite(4198)" onMouseOut="lolite()" onClick="logVariable('recovergrades')" href="../../_variables/recovergrades.html">$recovergrades</a>);
<a name="l158"><span class="linenum"> 158</span></a>          if (<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>) {
<a name="l159"><span class="linenum"> 159</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l160"><span class="linenum"> 160</span></a>              <a class="function" onClick="logFunction('role_assign')" href="../../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'enrol_'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>(), <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l161"><span class="linenum"> 161</span></a>          }
<a name="l162"><span class="linenum"> 162</span></a>      }
<a name="l163"><span class="linenum"> 163</span></a>  
<a name="l164"><span class="linenum"> 164</span></a>      <span class="comment">/**</span>
<a name="l165"><span class="linenum"> 165</span></a>  <span class="comment">     * Execute synchronisation.</span>
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">     * @param progress_trace</span>
<a name="l167"><span class="linenum"> 167</span></a>  <span class="comment">     * @return int exit code, 0 means ok, 2 means plugin disabled</span>
<a name="l168"><span class="linenum"> 168</span></a>  <span class="comment">     */</span>
<a name="l169"><span class="linenum"> 169</span></a>      public function <a class="function" onClick="logFunction('sync')" href="../../_functions/sync.html" onMouseOver="funcPopup(event,'sync')">sync</a>(progress_trace <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>) {
<a name="l170"><span class="linenum"> 170</span></a>          if (!<a class="function" onClick="logFunction('enrol_is_enabled')" href="../../_functions/enrol_is_enabled.html" onMouseOver="funcPopup(event,'enrol_is_enabled')">enrol_is_enabled</a>('flatfile')) {
<a name="l171"><span class="linenum"> 171</span></a>              return 2;
<a name="l172"><span class="linenum"> 172</span></a>          }
<a name="l173"><span class="linenum"> 173</span></a>  
<a name="l174"><span class="linenum"> 174</span></a>          <a class="var it14808" onMouseOver="hilite(14808)" onMouseOut="lolite()" onClick="logVariable('mailadmins')" href="../../_variables/mailadmins.html">$mailadmins</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('mailadmins', 0);
<a name="l175"><span class="linenum"> 175</span></a>  
<a name="l176"><span class="linenum"> 176</span></a>          if (<a class="var it14808" onMouseOver="hilite(14808)" onMouseOut="lolite()" onClick="logVariable('mailadmins')" href="../../_variables/mailadmins.html">$mailadmins</a>) {
<a name="l177"><span class="linenum"> 177</span></a>              <a class="var it2320" onMouseOver="hilite(2320)" onMouseOut="lolite()" onClick="logVariable('buffer')" href="../../_variables/buffer.html">$buffer</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progress_trace_buffer')" href="../../_classes/progress_trace_buffer.html" onMouseOver="classPopup(event,'progress_trace_buffer')">progress_trace_buffer</a>(<span class="keyword">new </span><a class="class" onClick="logClass('text_progress_trace')" href="../../_classes/text_progress_trace.html" onMouseOver="classPopup(event,'text_progress_trace')">text_progress_trace</a>(), false);
<a name="l178"><span class="linenum"> 178</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a> = <span class="keyword">new </span><a class="class" onClick="logClass('combined_progress_trace')" href="../../_classes/combined_progress_trace.html" onMouseOver="classPopup(event,'combined_progress_trace')">combined_progress_trace</a>(array(<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>, <a class="var it2320" onMouseOver="hilite(2320)" onMouseOut="lolite()" onClick="logVariable('buffer')" href="../../_variables/buffer.html">$buffer</a>));
<a name="l179"><span class="linenum"> 179</span></a>          }
<a name="l180"><span class="linenum"> 180</span></a>  
<a name="l181"><span class="linenum"> 181</span></a>          <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a> = false;
<a name="l182"><span class="linenum"> 182</span></a>  
<a name="l183"><span class="linenum"> 183</span></a>          <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_file')" href="../../_functions/process_file.html" onMouseOver="funcPopup(event,'process_file')">process_file</a>(<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>) || <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a>;
<a name="l184"><span class="linenum"> 184</span></a>          <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_buffer')" href="../../_functions/process_buffer.html" onMouseOver="funcPopup(event,'process_buffer')">process_buffer</a>(<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>) || <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a>;
<a name="l185"><span class="linenum"> 185</span></a>          <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_expirations')" href="../../_functions/process_expirations.html" onMouseOver="funcPopup(event,'process_expirations')">process_expirations</a>(<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>) || <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a>;
<a name="l186"><span class="linenum"> 186</span></a>  
<a name="l187"><span class="linenum"> 187</span></a>          if (<a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../../_variables/processed.html">$processed</a> and <a class="var it14808" onMouseOver="hilite(14808)" onMouseOut="lolite()" onClick="logVariable('mailadmins')" href="../../_variables/mailadmins.html">$mailadmins</a>) {
<a name="l188"><span class="linenum"> 188</span></a>              if (<a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a> = <a class="var it2320" onMouseOver="hilite(2320)" onMouseOut="lolite()" onClick="logVariable('buffer')" href="../../_variables/buffer.html">$buffer</a>-&gt;<a class="function" onClick="logFunction('get_buffer')" href="../../_functions/get_buffer.html" onMouseOver="funcPopup(event,'get_buffer')">get_buffer</a>()) {
<a name="l189"><span class="linenum"> 189</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a> = new stdClass();
<a name="l190"><span class="linenum"> 190</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('modulename')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a>        = 'moodle';
<a name="l191"><span class="linenum"> 191</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('component')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>         = 'enrol_flatfile';
<a name="l192"><span class="linenum"> 192</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('name')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>              = 'flatfile_enrolment';
<a name="l193"><span class="linenum"> 193</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userfrom.html">userfrom</a>          = <a class="function" onClick="logFunction('get_admin')" href="../../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l194"><span class="linenum"> 194</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userto.html">userto</a>            = <a class="function" onClick="logFunction('get_admin')" href="../../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l195"><span class="linenum"> 195</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('subject')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>           = 'Flatfile Enrolment Log';
<a name="l196"><span class="linenum"> 196</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessage.html">fullmessage</a>       = <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('log')" href="../../_variables/log.html">$log</a>;
<a name="l197"><span class="linenum"> 197</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessageformat.html">fullmessageformat</a> = <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>;
<a name="l198"><span class="linenum"> 198</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessagehtml.html">fullmessagehtml</a>   = '';
<a name="l199"><span class="linenum"> 199</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/smallmessage.html">smallmessage</a>      = '';
<a name="l200"><span class="linenum"> 200</span></a>                  <a class="function" onClick="logFunction('message_send')" href="../../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>);
<a name="l201"><span class="linenum"> 201</span></a>              }
<a name="l202"><span class="linenum"> 202</span></a>              <a class="var it2320" onMouseOver="hilite(2320)" onMouseOut="lolite()" onClick="logVariable('buffer')" href="../../_variables/buffer.html">$buffer</a>-&gt;<a class="function" onClick="logFunction('reset_buffer')" href="../../_functions/reset_buffer.html" onMouseOver="funcPopup(event,'reset_buffer')">reset_buffer</a>();
<a name="l203"><span class="linenum"> 203</span></a>          }
<a name="l204"><span class="linenum"> 204</span></a>  
<a name="l205"><span class="linenum"> 205</span></a>          return 0;
<a name="l206"><span class="linenum"> 206</span></a>      }
<a name="l207"><span class="linenum"> 207</span></a>  
<a name="l208"><span class="linenum"> 208</span></a>      <span class="comment">/**</span>
<a name="l209"><span class="linenum"> 209</span></a>  <span class="comment">     * Sorry, we do not want to show paths in cron output.</span>
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment">     *</span>
<a name="l211"><span class="linenum"> 211</span></a>  <span class="comment">     * @param string $filepath</span>
<a name="l212"><span class="linenum"> 212</span></a>  <span class="comment">     * @return string</span>
<a name="l213"><span class="linenum"> 213</span></a>  <span class="comment">     */</span>
<a name="l214"><span class="linenum"> 214</span></a>      protected function <a class="function" onClick="logFunction('obfuscate_filepath')" href="../../_functions/obfuscate_filepath.html" onMouseOver="funcPopup(event,'obfuscate_filepath')">obfuscate_filepath</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>) {
<a name="l215"><span class="linenum"> 215</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l216"><span class="linenum"> 216</span></a>  
<a name="l217"><span class="linenum"> 217</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dataroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dataroot.html">dataroot</a>.'/') === 0 or <a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dataroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dataroot.html">dataroot</a>.'\\') === 0) {
<a name="l218"><span class="linenum"> 218</span></a>              <a class="var it14809" onMouseOver="hilite(14809)" onMouseOut="lolite()" onClick="logVariable('disclosefile')" href="../../_variables/disclosefile.html">$disclosefile</a> = '<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dataroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dataroot.html">dataroot</a>'.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dataroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dataroot.html">dataroot</a>));
<a name="l219"><span class="linenum"> 219</span></a>  
<a name="l220"><span class="linenum"> 220</span></a>          } else if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'/') === 0 or <a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'\\') === 0) {
<a name="l221"><span class="linenum"> 221</span></a>              <a class="var it14809" onMouseOver="hilite(14809)" onMouseOut="lolite()" onClick="logVariable('disclosefile')" href="../../_variables/disclosefile.html">$disclosefile</a> = '<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>'.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>));
<a name="l222"><span class="linenum"> 222</span></a>  
<a name="l223"><span class="linenum"> 223</span></a>          } else {
<a name="l224"><span class="linenum"> 224</span></a>              <a class="var it14809" onMouseOver="hilite(14809)" onMouseOut="lolite()" onClick="logVariable('disclosefile')" href="../../_variables/disclosefile.html">$disclosefile</a> = <a class="phpfunction" onClick="logFunction('basename')" href="../../_functions/basename.html" onMouseOver="phpfuncPopup(event,'basename')">basename</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>);
<a name="l225"><span class="linenum"> 225</span></a>          }
<a name="l226"><span class="linenum"> 226</span></a>  
<a name="l227"><span class="linenum"> 227</span></a>          return <a class="var it14809" onMouseOver="hilite(14809)" onMouseOut="lolite()" onClick="logVariable('disclosefile')" href="../../_variables/disclosefile.html">$disclosefile</a>;
<a name="l228"><span class="linenum"> 228</span></a>      }
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>      <span class="comment">/**</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment">     * Process flatfile.</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment">     * @param progress_trace $trace</span>
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment">     * @return bool true if any data processed, false if not</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment">     */</span>
<a name="l235"><span class="linenum"> 235</span></a>      protected function <a class="function" onClick="logFunction('process_file')" href="../../_functions/process_file.html" onMouseOver="funcPopup(event,'process_file')">process_file</a>(progress_trace <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>) {
<a name="l236"><span class="linenum"> 236</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l237"><span class="linenum"> 237</span></a>  
<a name="l238"><span class="linenum"> 238</span></a>  <span class="comment">        // We may need more memory here.</span>
<a name="l239"><span class="linenum"> 239</span></a>          <a class="class" onClick="logClass('core_php_time_limit')" href="../../_classes/core_php_time_limit.html" onMouseOver="classPopup(event,'core_php_time_limit')">core_php_time_limit</a>::<a class="function" onClick="logFunction('raise')" href="../../_functions/raise.html" onMouseOver="funcPopup(event,'raise')">raise</a>();
<a name="l240"><span class="linenum"> 240</span></a>          <a class="function" onClick="logFunction('raise_memory_limit')" href="../../_functions/raise_memory_limit.html" onMouseOver="funcPopup(event,'raise_memory_limit')">raise_memory_limit</a>(<a class="constant" onClick="logConstant('MEMORY_HUGE')" href="../../_constants/MEMORY_HUGE.html" onMouseOver="constPopup(event,'MEMORY_HUGE')">MEMORY_HUGE</a>);
<a name="l241"><span class="linenum"> 241</span></a>  
<a name="l242"><span class="linenum"> 242</span></a>          <a class="var it14810" onMouseOver="hilite(14810)" onMouseOut="lolite()" onClick="logVariable('filelocation')" href="../../_variables/filelocation.html">$filelocation</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('location');
<a name="l243"><span class="linenum"> 243</span></a>          if (empty(<a class="var it14810" onMouseOver="hilite(14810)" onMouseOut="lolite()" onClick="logVariable('filelocation')" href="../../_variables/filelocation.html">$filelocation</a>)) {
<a name="l244"><span class="linenum"> 244</span></a>  <span class="comment">            // Default legacy location.</span>
<a name="l245"><span class="linenum"> 245</span></a>              <a class="var it14810" onMouseOver="hilite(14810)" onMouseOut="lolite()" onClick="logVariable('filelocation')" href="../../_variables/filelocation.html">$filelocation</a> = &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dataroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dataroot.html">dataroot</a>/1/enrolments.txt&quot;;
<a name="l246"><span class="linenum"> 246</span></a>          }
<a name="l247"><span class="linenum"> 247</span></a>          <a class="var it14809" onMouseOver="hilite(14809)" onMouseOut="lolite()" onClick="logVariable('disclosefile')" href="../../_variables/disclosefile.html">$disclosefile</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('obfuscate_filepath')" href="../../_functions/obfuscate_filepath.html" onMouseOver="funcPopup(event,'obfuscate_filepath')">obfuscate_filepath</a>(<a class="var it14810" onMouseOver="hilite(14810)" onMouseOut="lolite()" onClick="logVariable('filelocation')" href="../../_variables/filelocation.html">$filelocation</a>);
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it14810" onMouseOver="hilite(14810)" onMouseOut="lolite()" onClick="logVariable('filelocation')" href="../../_variables/filelocation.html">$filelocation</a>)) {
<a name="l250"><span class="linenum"> 250</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Flatfile enrolments file not found: <a class="var it14809" onMouseOver="hilite(14809)" onMouseOut="lolite()" onClick="logVariable('disclosefile')" href="../../_variables/disclosefile.html">$disclosefile</a>&quot;);
<a name="l251"><span class="linenum"> 251</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l252"><span class="linenum"> 252</span></a>              return false;
<a name="l253"><span class="linenum"> 253</span></a>          }
<a name="l254"><span class="linenum"> 254</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Processing flat file enrolments from: <a class="var it14809" onMouseOver="hilite(14809)" onMouseOut="lolite()" onClick="logVariable('disclosefile')" href="../../_variables/disclosefile.html">$disclosefile</a> ...&quot;);
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>          <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="phpfunction" onClick="logFunction('file_get_contents')" href="../../_functions/file_get_contents.html" onMouseOver="phpfuncPopup(event,'file_get_contents')">file_get_contents</a>(<a class="var it14810" onMouseOver="hilite(14810)" onMouseOut="lolite()" onClick="logVariable('filelocation')" href="../../_variables/filelocation.html">$filelocation</a>);
<a name="l257"><span class="linenum"> 257</span></a>  
<a name="l258"><span class="linenum"> 258</span></a>          if (<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> !== false) {
<a name="l259"><span class="linenum"> 259</span></a>  
<a name="l260"><span class="linenum"> 260</span></a>              <a class="var it14811" onMouseOver="hilite(14811)" onMouseOut="lolite()" onClick="logVariable('rolemap')" href="../../_variables/rolemap.html">$rolemap</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_role_map')" href="../../_functions/get_role_map.html" onMouseOver="funcPopup(event,'get_role_map')">get_role_map</a>(<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>);
<a name="l261"><span class="linenum"> 261</span></a>  
<a name="l262"><span class="linenum"> 262</span></a>              <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('convert')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">convert</a>(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('encoding', 'utf-8'), 'utf-8');
<a name="l263"><span class="linenum"> 263</span></a>              <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(&quot;\r&quot;, '', <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l264"><span class="linenum"> 264</span></a>              <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(&quot;\n&quot;, <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l265"><span class="linenum"> 265</span></a>  
<a name="l266"><span class="linenum"> 266</span></a>              <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a> = 0;
<a name="l267"><span class="linenum"> 267</span></a>              foreach(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> as <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>) {
<a name="l268"><span class="linenum"> 268</span></a>                  <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a>++;
<a name="l269"><span class="linenum"> 269</span></a>  
<a name="l270"><span class="linenum"> 270</span></a>                  if (<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>) === '') {
<a name="l271"><span class="linenum"> 271</span></a>  <span class="comment">                    // Empty lines are ignored.</span>
<a name="l272"><span class="linenum"> 272</span></a>                      continue;
<a name="l273"><span class="linenum"> 273</span></a>                  }
<a name="l274"><span class="linenum"> 274</span></a>  
<a name="l275"><span class="linenum"> 275</span></a>  <span class="comment">                // Deal with different separators.</span>
<a name="l276"><span class="linenum"> 276</span></a>                  if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>, ',') !== false) {
<a name="l277"><span class="linenum"> 277</span></a>                      <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>);
<a name="l278"><span class="linenum"> 278</span></a>                  } else {
<a name="l279"><span class="linenum"> 279</span></a>                      <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(';', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>);
<a name="l280"><span class="linenum"> 280</span></a>                  }
<a name="l281"><span class="linenum"> 281</span></a>  
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">                // If a line is incorrectly formatted ie does not have 4 comma separated fields then ignore it.</span>
<a name="l283"><span class="linenum"> 283</span></a>                  if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>) &lt; 4 or <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>) &gt; 6) {
<a name="l284"><span class="linenum"> 284</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Line incorrectly formatted - ignoring <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a>&quot;, 1);
<a name="l285"><span class="linenum"> 285</span></a>                      continue;
<a name="l286"><span class="linenum"> 286</span></a>                  }
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>                  <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[0] = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[0]));
<a name="l289"><span class="linenum"> 289</span></a>                  <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[1] = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[1]));
<a name="l290"><span class="linenum"> 290</span></a>                  <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[2] = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[2]);
<a name="l291"><span class="linenum"> 291</span></a>                  <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[3] = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[3]);
<a name="l292"><span class="linenum"> 292</span></a>                  <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[4] = isset(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[4]) ? (int)<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[4]) : 0;
<a name="l293"><span class="linenum"> 293</span></a>                  <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[5] = isset(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[5]) ? (int)<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[5]) : 0;
<a name="l294"><span class="linenum"> 294</span></a>  
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment">                // Deal with quoted values - all or nothing, we need to support &quot;' in idnumbers, sorry.</span>
<a name="l296"><span class="linenum"> 296</span></a>                  if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[0], &quot;'&quot;) === 0) {
<a name="l297"><span class="linenum"> 297</span></a>                      foreach (<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> as <a class="var it68" onMouseOver="hilite(68)" onMouseOut="lolite()" onClick="logVariable('k')" href="../../_variables/k.html">$k</a>=&gt;<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a>) {
<a name="l298"><span class="linenum"> 298</span></a>                          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[<a class="var it68" onMouseOver="hilite(68)" onMouseOut="lolite()" onClick="logVariable('k')" href="../../_variables/k.html">$k</a>] = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a>, &quot;'&quot;);
<a name="l299"><span class="linenum"> 299</span></a>                      }
<a name="l300"><span class="linenum"> 300</span></a>                  } else if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[0], '&quot;') === 0) {
<a name="l301"><span class="linenum"> 301</span></a>                      foreach (<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> as <a class="var it68" onMouseOver="hilite(68)" onMouseOut="lolite()" onClick="logVariable('k')" href="../../_variables/k.html">$k</a>=&gt;<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a>) {
<a name="l302"><span class="linenum"> 302</span></a>                          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[<a class="var it68" onMouseOver="hilite(68)" onMouseOut="lolite()" onClick="logVariable('k')" href="../../_variables/k.html">$k</a>] = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a>, '&quot;');
<a name="l303"><span class="linenum"> 303</span></a>                      }
<a name="l304"><span class="linenum"> 304</span></a>                  }
<a name="l305"><span class="linenum"> 305</span></a>  
<a name="l306"><span class="linenum"> 306</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;<a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a>: <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[0], <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[1], <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[2], <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[3], <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[4], <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[5]&quot;, 1);
<a name="l307"><span class="linenum"> 307</span></a>  
<a name="l308"><span class="linenum"> 308</span></a>  <span class="comment">                // Check correct formatting of operation field.</span>
<a name="l309"><span class="linenum"> 309</span></a>                  if (<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[0] !== &quot;add&quot; and <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[0] !== &quot;del&quot;) {
<a name="l310"><span class="linenum"> 310</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Unknown operation in field 1 - ignoring line <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a>&quot;, 1);
<a name="l311"><span class="linenum"> 311</span></a>                      continue;
<a name="l312"><span class="linenum"> 312</span></a>                  }
<a name="l313"><span class="linenum"> 313</span></a>  
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">                // Check correct formatting of role field.</span>
<a name="l315"><span class="linenum"> 315</span></a>                  if (!isset(<a class="var it14811" onMouseOver="hilite(14811)" onMouseOut="lolite()" onClick="logVariable('rolemap')" href="../../_variables/rolemap.html">$rolemap</a>[<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[1]])) {
<a name="l316"><span class="linenum"> 316</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Unknown role in field2 - ignoring line <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a>&quot;, 1);
<a name="l317"><span class="linenum"> 317</span></a>                      continue;
<a name="l318"><span class="linenum"> 318</span></a>                  }
<a name="l319"><span class="linenum"> 319</span></a>                  <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a> = <a class="var it14811" onMouseOver="hilite(14811)" onMouseOut="lolite()" onClick="logVariable('rolemap')" href="../../_variables/rolemap.html">$rolemap</a>[<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[1]];
<a name="l320"><span class="linenum"> 320</span></a>  
<a name="l321"><span class="linenum"> 321</span></a>                  if (empty(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[2]) or !<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(&quot;user&quot;, array(&quot;idnumber&quot;=&gt;<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[2], 'deleted'=&gt;0))) {
<a name="l322"><span class="linenum"> 322</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Unknown user idnumber or deleted user in field 3 - ignoring line <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a>&quot;, 1);
<a name="l323"><span class="linenum"> 323</span></a>                      continue;
<a name="l324"><span class="linenum"> 324</span></a>                  }
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>                  if (!<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(&quot;course&quot;, array(&quot;idnumber&quot;=&gt;<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[3]))) {
<a name="l327"><span class="linenum"> 327</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Unknown course idnumber in field 4 - ignoring line <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a>&quot;, 1);
<a name="l328"><span class="linenum"> 328</span></a>                      continue;
<a name="l329"><span class="linenum"> 329</span></a>                  }
<a name="l330"><span class="linenum"> 330</span></a>  
<a name="l331"><span class="linenum"> 331</span></a>                  if (<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[4] &gt; <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[5] and <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[5] != 0) {
<a name="l332"><span class="linenum"> 332</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Start time was later than end time - ignoring line <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a>&quot;, 1);
<a name="l333"><span class="linenum"> 333</span></a>                      continue;
<a name="l334"><span class="linenum"> 334</span></a>                  }
<a name="l335"><span class="linenum"> 335</span></a>  
<a name="l336"><span class="linenum"> 336</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_records')" href="../../_functions/process_records.html" onMouseOver="funcPopup(event,'process_records')">process_records</a>(<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[0], <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[4], <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[5]);
<a name="l337"><span class="linenum"> 337</span></a>              }
<a name="l338"><span class="linenum"> 338</span></a>  
<a name="l339"><span class="linenum"> 339</span></a>              unset(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l340"><span class="linenum"> 340</span></a>          }
<a name="l341"><span class="linenum"> 341</span></a>  
<a name="l342"><span class="linenum"> 342</span></a>          if (!<a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it14810" onMouseOver="hilite(14810)" onMouseOut="lolite()" onClick="logVariable('filelocation')" href="../../_variables/filelocation.html">$filelocation</a>)) {
<a name="l343"><span class="linenum"> 343</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a> = new stdClass();
<a name="l344"><span class="linenum"> 344</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('modulename')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a>        = 'moodle';
<a name="l345"><span class="linenum"> 345</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('component')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>         = 'enrol_flatfile';
<a name="l346"><span class="linenum"> 346</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('name')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>              = 'flatfile_enrolment';
<a name="l347"><span class="linenum"> 347</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userfrom.html">userfrom</a>          = <a class="function" onClick="logFunction('get_admin')" href="../../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l348"><span class="linenum"> 348</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userto.html">userto</a>            = <a class="function" onClick="logFunction('get_admin')" href="../../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l349"><span class="linenum"> 349</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('subject')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>           = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('filelockedmailsubject', 'enrol_flatfile');
<a name="l350"><span class="linenum"> 350</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessage.html">fullmessage</a>       = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('filelockedmail', 'enrol_flatfile', <a class="var it14810" onMouseOver="hilite(14810)" onMouseOut="lolite()" onClick="logVariable('filelocation')" href="../../_variables/filelocation.html">$filelocation</a>);
<a name="l351"><span class="linenum"> 351</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessageformat.html">fullmessageformat</a> = <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>;
<a name="l352"><span class="linenum"> 352</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessagehtml.html">fullmessagehtml</a>   = '';
<a name="l353"><span class="linenum"> 353</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/smallmessage.html">smallmessage</a>      = '';
<a name="l354"><span class="linenum"> 354</span></a>              <a class="function" onClick="logFunction('message_send')" href="../../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>);
<a name="l355"><span class="linenum"> 355</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Error deleting enrolment file: <a class="var it14809" onMouseOver="hilite(14809)" onMouseOut="lolite()" onClick="logVariable('disclosefile')" href="../../_variables/disclosefile.html">$disclosefile</a>&quot;, 1);
<a name="l356"><span class="linenum"> 356</span></a>          } else {
<a name="l357"><span class="linenum"> 357</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Deleted enrolment file&quot;, 1);
<a name="l358"><span class="linenum"> 358</span></a>          }
<a name="l359"><span class="linenum"> 359</span></a>  
<a name="l360"><span class="linenum"> 360</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;...finished enrolment file processing.&quot;);
<a name="l361"><span class="linenum"> 361</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l362"><span class="linenum"> 362</span></a>  
<a name="l363"><span class="linenum"> 363</span></a>          return true;
<a name="l364"><span class="linenum"> 364</span></a>      }
<a name="l365"><span class="linenum"> 365</span></a>  
<a name="l366"><span class="linenum"> 366</span></a>      <span class="comment">/**</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment">     * Process any future enrollments stored in the buffer.</span>
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment">     * @param progress_trace $trace</span>
<a name="l369"><span class="linenum"> 369</span></a>  <span class="comment">     * @return bool true if any data processed, false if not</span>
<a name="l370"><span class="linenum"> 370</span></a>  <span class="comment">     */</span>
<a name="l371"><span class="linenum"> 371</span></a>      protected function <a class="function" onClick="logFunction('process_buffer')" href="../../_functions/process_buffer.html" onMouseOver="funcPopup(event,'process_buffer')">process_buffer</a>(progress_trace <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>) {
<a name="l372"><span class="linenum"> 372</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l373"><span class="linenum"> 373</span></a>  
<a name="l374"><span class="linenum"> 374</span></a>          if (!<a class="var it14812" onMouseOver="hilite(14812)" onMouseOut="lolite()" onClick="logVariable('future_enrols')" href="../../_variables/future_enrols.html">$future_enrols</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('enrol_flatfile', &quot;timestart &lt; ?&quot;, array(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()))) {
<a name="l375"><span class="linenum"> 375</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;No enrolments to be processed in flatfile buffer&quot;);
<a name="l376"><span class="linenum"> 376</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l377"><span class="linenum"> 377</span></a>              return false;
<a name="l378"><span class="linenum"> 378</span></a>          }
<a name="l379"><span class="linenum"> 379</span></a>  
<a name="l380"><span class="linenum"> 380</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Starting processing of flatfile buffer&quot;);
<a name="l381"><span class="linenum"> 381</span></a>          foreach(<a class="var it14812" onMouseOver="hilite(14812)" onMouseOut="lolite()" onClick="logVariable('future_enrols')" href="../../_variables/future_enrols.html">$future_enrols</a> as <a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>) {
<a name="l382"><span class="linenum"> 382</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('userid')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>));
<a name="l383"><span class="linenum"> 383</span></a>              <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('courseid')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l384"><span class="linenum"> 384</span></a>              if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> and <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l385"><span class="linenum"> 385</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;buffer: <a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('action')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/action.html">action</a> <a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('roleid')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a> <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> <a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('timestart')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a> <a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('timeend')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a>&quot;, 1);
<a name="l386"><span class="linenum"> 386</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_records')" href="../../_functions/process_records.html" onMouseOver="funcPopup(event,'process_records')">process_records</a>(<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>, <a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('action')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/action.html">action</a>, <a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('roleid')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('timestart')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>, <a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('timeend')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a>, false);
<a name="l387"><span class="linenum"> 387</span></a>              }
<a name="l388"><span class="linenum"> 388</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('enrol_flatfile', array('id'=&gt;<a class="var it14813" onMouseOver="hilite(14813)" onMouseOut="lolite()" onClick="logVariable('en')" href="../../_variables/en.html">$en</a>-&gt;<a onClick="logVariable('id')" class="var it45125" onMouseOver="hilite(45125)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l389"><span class="linenum"> 389</span></a>          }
<a name="l390"><span class="linenum"> 390</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Finished processing of flatfile buffer&quot;);
<a name="l391"><span class="linenum"> 391</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l392"><span class="linenum"> 392</span></a>  
<a name="l393"><span class="linenum"> 393</span></a>          return true;
<a name="l394"><span class="linenum"> 394</span></a>      }
<a name="l395"><span class="linenum"> 395</span></a>  
<a name="l396"><span class="linenum"> 396</span></a>      <span class="comment">/**</span>
<a name="l397"><span class="linenum"> 397</span></a>  <span class="comment">     * Process user enrolment line.</span>
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">     *</span>
<a name="l399"><span class="linenum"> 399</span></a>  <span class="comment">     * @param progress_trace $trace</span>
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment">     * @param string $action</span>
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment">     * @param int $roleid</span>
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">     * @param stdClass $user</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment">     * @param stdClass $course</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment">     * @param int $timestart</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment">     * @param int $timeend</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">     * @param bool $buffer_if_future</span>
<a name="l407"><span class="linenum"> 407</span></a>  <span class="comment">     */</span>
<a name="l408"><span class="linenum"> 408</span></a>      protected function <a class="function" onClick="logFunction('process_records')" href="../../_functions/process_records.html" onMouseOver="funcPopup(event,'process_records')">process_records</a>(progress_trace <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>, <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../../_variables/timeend.html">$timeend</a>, <a class="var it14814" onMouseOver="hilite(14814)" onMouseOut="lolite()" onClick="logVariable('buffer_if_future')" href="../../_variables/buffer_if_future.html">$buffer_if_future</a> = true) {
<a name="l409"><span class="linenum"> 409</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l410"><span class="linenum"> 410</span></a>  
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment">        // Check if timestart is for future processing.</span>
<a name="l412"><span class="linenum"> 412</span></a>          if (<a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a> &gt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() and <a class="var it14814" onMouseOver="hilite(14814)" onMouseOut="lolite()" onClick="logVariable('buffer_if_future')" href="../../_variables/buffer_if_future.html">$buffer_if_future</a>) {
<a name="l413"><span class="linenum"> 413</span></a>  <span class="comment">            // Populate into enrol_flatfile table as a future role to be assigned by cron.</span>
<a name="l414"><span class="linenum"> 414</span></a>  <span class="comment">            // Note: since 2.0 future enrolments do not cause problems if you disable guest access.</span>
<a name="l415"><span class="linenum"> 415</span></a>              <a class="var it14815" onMouseOver="hilite(14815)" onMouseOut="lolite()" onClick="logVariable('future_en')" href="../../_variables/future_en.html">$future_en</a> = new stdClass();
<a name="l416"><span class="linenum"> 416</span></a>              <a class="var it14815" onMouseOver="hilite(14815)" onMouseOut="lolite()" onClick="logVariable('future_en')" href="../../_variables/future_en.html">$future_en</a>-&gt;<a onClick="logVariable('action')" class="var it45126" onMouseOver="hilite(45126)" onMouseOut="lolite()" href="../../_variables/action.html">action</a>       = <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>;
<a name="l417"><span class="linenum"> 417</span></a>              <a class="var it14815" onMouseOver="hilite(14815)" onMouseOut="lolite()" onClick="logVariable('future_en')" href="../../_variables/future_en.html">$future_en</a>-&gt;<a onClick="logVariable('roleid')" class="var it45126" onMouseOver="hilite(45126)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>       = <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>;
<a name="l418"><span class="linenum"> 418</span></a>              <a class="var it14815" onMouseOver="hilite(14815)" onMouseOut="lolite()" onClick="logVariable('future_en')" href="../../_variables/future_en.html">$future_en</a>-&gt;<a onClick="logVariable('userid')" class="var it45126" onMouseOver="hilite(45126)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>       = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l419"><span class="linenum"> 419</span></a>              <a class="var it14815" onMouseOver="hilite(14815)" onMouseOut="lolite()" onClick="logVariable('future_en')" href="../../_variables/future_en.html">$future_en</a>-&gt;<a onClick="logVariable('courseid')" class="var it45126" onMouseOver="hilite(45126)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>     = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l420"><span class="linenum"> 420</span></a>              <a class="var it14815" onMouseOver="hilite(14815)" onMouseOut="lolite()" onClick="logVariable('future_en')" href="../../_variables/future_en.html">$future_en</a>-&gt;<a onClick="logVariable('timestart')" class="var it45126" onMouseOver="hilite(45126)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>    = <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>;
<a name="l421"><span class="linenum"> 421</span></a>              <a class="var it14815" onMouseOver="hilite(14815)" onMouseOut="lolite()" onClick="logVariable('future_en')" href="../../_variables/future_en.html">$future_en</a>-&gt;<a onClick="logVariable('timeend')" class="var it45126" onMouseOver="hilite(45126)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a>      = <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../../_variables/timeend.html">$timeend</a>;
<a name="l422"><span class="linenum"> 422</span></a>              <a class="var it14815" onMouseOver="hilite(14815)" onMouseOut="lolite()" onClick="logVariable('future_en')" href="../../_variables/future_en.html">$future_en</a>-&gt;<a onClick="logVariable('timemodified')" class="var it45126" onMouseOver="hilite(45126)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l423"><span class="linenum"> 423</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('enrol_flatfile', <a class="var it14815" onMouseOver="hilite(14815)" onMouseOut="lolite()" onClick="logVariable('future_en')" href="../../_variables/future_en.html">$future_en</a>);
<a name="l424"><span class="linenum"> 424</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;User <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> will be enrolled later into course <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> using role <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a> (<a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../../_variables/timeend.html">$timeend</a>)&quot;, 1);
<a name="l425"><span class="linenum"> 425</span></a>              return;
<a name="l426"><span class="linenum"> 426</span></a>          }
<a name="l427"><span class="linenum"> 427</span></a>  
<a name="l428"><span class="linenum"> 428</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l429"><span class="linenum"> 429</span></a>  
<a name="l430"><span class="linenum"> 430</span></a>          if (<a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> === 'add') {
<a name="l431"><span class="linenum"> 431</span></a>  <span class="comment">            // Clear the buffer just in case there were some future enrolments.</span>
<a name="l432"><span class="linenum"> 432</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('enrol_flatfile', array('userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'courseid'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'roleid'=&gt;<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>));
<a name="l433"><span class="linenum"> 433</span></a>  
<a name="l434"><span class="linenum"> 434</span></a>              <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('enrol', array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'enrol' =&gt; 'flatfile'));
<a name="l435"><span class="linenum"> 435</span></a>              if (empty(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>)) {
<a name="l436"><span class="linenum"> 436</span></a>  <span class="comment">                // Only add an enrol instance to the course if non-existent.</span>
<a name="l437"><span class="linenum"> 437</span></a>                  <a class="var it1439" onMouseOver="hilite(1439)" onMouseOut="lolite()" onClick="logVariable('enrolid')" href="../../_variables/enrolid.html">$enrolid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_instance')" href="../../_functions/add_instance.html" onMouseOver="funcPopup(event,'add_instance')">add_instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l438"><span class="linenum"> 438</span></a>                  <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('enrol', array('id' =&gt; <a class="var it1439" onMouseOver="hilite(1439)" onMouseOut="lolite()" onClick="logVariable('enrolid')" href="../../_variables/enrolid.html">$enrolid</a>));
<a name="l439"><span class="linenum"> 439</span></a>              }
<a name="l440"><span class="linenum"> 440</span></a>  
<a name="l441"><span class="linenum"> 441</span></a>              <a class="var it5442" onMouseOver="hilite(5442)" onMouseOut="lolite()" onClick="logVariable('notify')" href="../../_variables/notify.html">$notify</a> = false;
<a name="l442"><span class="linenum"> 442</span></a>              if (<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">                // Update only.</span>
<a name="l444"><span class="linenum"> 444</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_user_enrol')" href="../../_functions/update_user_enrol.html" onMouseOver="funcPopup(event,'update_user_enrol')">update_user_enrol</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../../_variables/timeend.html">$timeend</a>);
<a name="l445"><span class="linenum"> 445</span></a>                  if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('role_assignments', array('contextid'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'roleid'=&gt;<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, 'userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'component'=&gt;'enrol_flatfile', 'itemid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l446"><span class="linenum"> 446</span></a>                      <a class="function" onClick="logFunction('role_assign')" href="../../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'enrol_flatfile', <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l447"><span class="linenum"> 447</span></a>                  }
<a name="l448"><span class="linenum"> 448</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;User <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> enrolment updated in course <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> using role <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a> (<a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../../_variables/timeend.html">$timeend</a>)&quot;, 1);
<a name="l449"><span class="linenum"> 449</span></a>  
<a name="l450"><span class="linenum"> 450</span></a>              } else {
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">                // Enrol the user with this plugin instance.</span>
<a name="l452"><span class="linenum"> 452</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../../_variables/timeend.html">$timeend</a>);
<a name="l453"><span class="linenum"> 453</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;User <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> enrolled in course <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> using role <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a> (<a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../../_variables/timestart.html">$timestart</a>, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../../_variables/timeend.html">$timeend</a>)&quot;, 1);
<a name="l454"><span class="linenum"> 454</span></a>                  <a class="var it5442" onMouseOver="hilite(5442)" onMouseOut="lolite()" onClick="logVariable('notify')" href="../../_variables/notify.html">$notify</a> = true;
<a name="l455"><span class="linenum"> 455</span></a>              }
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>              if (<a class="var it5442" onMouseOver="hilite(5442)" onMouseOut="lolite()" onClick="logVariable('notify')" href="../../_variables/notify.html">$notify</a> and <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('mailstudents')) {
<a name="l458"><span class="linenum"> 458</span></a>                  <a class="var it14005" onMouseOver="hilite(14005)" onMouseOut="lolite()" onClick="logVariable('oldforcelang')" href="../../_variables/oldforcelang.html">$oldforcelang</a> = <a class="function" onClick="logFunction('force_current_language')" href="../../_functions/force_current_language.html" onMouseOver="funcPopup(event,'force_current_language')">force_current_language</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lang')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a>);
<a name="l459"><span class="linenum"> 459</span></a>  
<a name="l460"><span class="linenum"> 460</span></a>  <span class="comment">                // Send welcome notification to enrolled users.</span>
<a name="l461"><span class="linenum"> 461</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a> = new stdClass();
<a name="l462"><span class="linenum"> 462</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('coursename')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/coursename.html">coursename</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('fullname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>, true, array('context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>));
<a name="l463"><span class="linenum"> 463</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('profileurl')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/profileurl.html">profileurl</a> = &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/wwwroot.html">wwwroot</a>/user/view.php?id=<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&amp;amp;course=<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&quot;;
<a name="l464"><span class="linenum"> 464</span></a>                  <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../_variables/subject.html">$subject</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('enrolmentnew', 'enrol', <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)));
<a name="l465"><span class="linenum"> 465</span></a>  
<a name="l466"><span class="linenum"> 466</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a> = new stdClass();
<a name="l467"><span class="linenum"> 467</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('modulename')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a>        = 'moodle';
<a name="l468"><span class="linenum"> 468</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('component')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>         = 'enrol_flatfile';
<a name="l469"><span class="linenum"> 469</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('name')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>              = 'flatfile_enrolment';
<a name="l470"><span class="linenum"> 470</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userfrom.html">userfrom</a>          = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enroller')" href="../../_functions/get_enroller.html" onMouseOver="funcPopup(event,'get_enroller')">get_enroller</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l471"><span class="linenum"> 471</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userto.html">userto</a>            = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>;
<a name="l472"><span class="linenum"> 472</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('subject')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>           = <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../_variables/subject.html">$subject</a>;
<a name="l473"><span class="linenum"> 473</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessage.html">fullmessage</a>       = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('welcometocoursetext', '', <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>);
<a name="l474"><span class="linenum"> 474</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessageformat.html">fullmessageformat</a> = <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>;
<a name="l475"><span class="linenum"> 475</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessagehtml.html">fullmessagehtml</a>   = '';
<a name="l476"><span class="linenum"> 476</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/smallmessage.html">smallmessage</a>      = '';
<a name="l477"><span class="linenum"> 477</span></a>                  if (<a class="function" onClick="logFunction('message_send')" href="../../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>)) {
<a name="l478"><span class="linenum"> 478</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Notified enrolled user&quot;, 1);
<a name="l479"><span class="linenum"> 479</span></a>                  } else {
<a name="l480"><span class="linenum"> 480</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Failed to notify enrolled user&quot;, 1);
<a name="l481"><span class="linenum"> 481</span></a>                  }
<a name="l482"><span class="linenum"> 482</span></a>  
<a name="l483"><span class="linenum"> 483</span></a>                  <a class="function" onClick="logFunction('force_current_language')" href="../../_functions/force_current_language.html" onMouseOver="funcPopup(event,'force_current_language')">force_current_language</a>(<a class="var it14005" onMouseOver="hilite(14005)" onMouseOut="lolite()" onClick="logVariable('oldforcelang')" href="../../_variables/oldforcelang.html">$oldforcelang</a>);
<a name="l484"><span class="linenum"> 484</span></a>              }
<a name="l485"><span class="linenum"> 485</span></a>  
<a name="l486"><span class="linenum"> 486</span></a>              if (<a class="var it5442" onMouseOver="hilite(5442)" onMouseOut="lolite()" onClick="logVariable('notify')" href="../../_variables/notify.html">$notify</a> and <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('mailteachers', 0)) {
<a name="l487"><span class="linenum"> 487</span></a>  <span class="comment">                // Notify person responsible for enrolments.</span>
<a name="l488"><span class="linenum"> 488</span></a>                  <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../../_variables/enroller.html">$enroller</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enroller')" href="../../_functions/get_enroller.html" onMouseOver="funcPopup(event,'get_enroller')">get_enroller</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l489"><span class="linenum"> 489</span></a>  
<a name="l490"><span class="linenum"> 490</span></a>                  <a class="var it14005" onMouseOver="hilite(14005)" onMouseOut="lolite()" onClick="logVariable('oldforcelang')" href="../../_variables/oldforcelang.html">$oldforcelang</a> = <a class="function" onClick="logFunction('force_current_language')" href="../../_functions/force_current_language.html" onMouseOver="funcPopup(event,'force_current_language')">force_current_language</a>(<a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../../_variables/enroller.html">$enroller</a>-&gt;<a onClick="logVariable('lang')" class="var it44240" onMouseOver="hilite(44240)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a>);
<a name="l491"><span class="linenum"> 491</span></a>  
<a name="l492"><span class="linenum"> 492</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a> = new stdClass();
<a name="l493"><span class="linenum"> 493</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('course')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('fullname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>, true, array('context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>));
<a name="l494"><span class="linenum"> 494</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('user')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../_variables/user.html">user</a> = <a class="function" onClick="logFunction('fullname')" href="../../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l495"><span class="linenum"> 495</span></a>                  <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../_variables/subject.html">$subject</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('enrolmentnew', 'enrol', <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)));
<a name="l496"><span class="linenum"> 496</span></a>  
<a name="l497"><span class="linenum"> 497</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a> = new stdClass();
<a name="l498"><span class="linenum"> 498</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('modulename')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a>        = 'moodle';
<a name="l499"><span class="linenum"> 499</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('component')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>         = 'enrol_flatfile';
<a name="l500"><span class="linenum"> 500</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('name')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>              = 'flatfile_enrolment';
<a name="l501"><span class="linenum"> 501</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userfrom.html">userfrom</a>          = <a class="function" onClick="logFunction('get_admin')" href="../../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l502"><span class="linenum"> 502</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userto.html">userto</a>            = <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../../_variables/enroller.html">$enroller</a>;
<a name="l503"><span class="linenum"> 503</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('subject')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>           = <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../_variables/subject.html">$subject</a>;
<a name="l504"><span class="linenum"> 504</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessage.html">fullmessage</a>       = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('enrolmentnewuser', 'enrol', <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>);
<a name="l505"><span class="linenum"> 505</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessageformat.html">fullmessageformat</a> = <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>;
<a name="l506"><span class="linenum"> 506</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessagehtml.html">fullmessagehtml</a>   = '';
<a name="l507"><span class="linenum"> 507</span></a>                  <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/smallmessage.html">smallmessage</a>      = '';
<a name="l508"><span class="linenum"> 508</span></a>                  if (<a class="function" onClick="logFunction('message_send')" href="../../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>)) {
<a name="l509"><span class="linenum"> 509</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Notified enroller {<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userto.html">userto</a>-&gt;id}&quot;, 1);
<a name="l510"><span class="linenum"> 510</span></a>                  } else {
<a name="l511"><span class="linenum"> 511</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Failed to notify enroller {<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userto.html">userto</a>-&gt;id}&quot;, 1);
<a name="l512"><span class="linenum"> 512</span></a>                  }
<a name="l513"><span class="linenum"> 513</span></a>  
<a name="l514"><span class="linenum"> 514</span></a>                  <a class="function" onClick="logFunction('force_current_language')" href="../../_functions/force_current_language.html" onMouseOver="funcPopup(event,'force_current_language')">force_current_language</a>(<a class="var it14005" onMouseOver="hilite(14005)" onMouseOut="lolite()" onClick="logVariable('oldforcelang')" href="../../_variables/oldforcelang.html">$oldforcelang</a>);
<a name="l515"><span class="linenum"> 515</span></a>              }
<a name="l516"><span class="linenum"> 516</span></a>              return;
<a name="l517"><span class="linenum"> 517</span></a>  
<a name="l518"><span class="linenum"> 518</span></a>          } else if (<a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> === 'del') {
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment">            // Clear the buffer just in case there were some future enrolments.</span>
<a name="l520"><span class="linenum"> 520</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('enrol_flatfile', array('userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'courseid'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'roleid'=&gt;<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>));
<a name="l521"><span class="linenum"> 521</span></a>  
<a name="l522"><span class="linenum"> 522</span></a>              <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('unenrolaction');
<a name="l523"><span class="linenum"> 523</span></a>              if (<a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> == <a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_KEEP')" href="../../_constants/ENROL_EXT_REMOVED_KEEP.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_KEEP')">ENROL_EXT_REMOVED_KEEP</a>) {
<a name="l524"><span class="linenum"> 524</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;del action is ignored&quot;, 1);
<a name="l525"><span class="linenum"> 525</span></a>                  return;
<a name="l526"><span class="linenum"> 526</span></a>              }
<a name="l527"><span class="linenum"> 527</span></a>  
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment">            // Loops through all enrolment methods, try to unenrol if roleid somehow matches.</span>
<a name="l529"><span class="linenum"> 529</span></a>              <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../../_variables/instances.html">$instances</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('enrol', array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l530"><span class="linenum"> 530</span></a>              <a class="var it13909" onMouseOver="hilite(13909)" onMouseOut="lolite()" onClick="logVariable('unenrolled')" href="../../_variables/unenrolled.html">$unenrolled</a> = false;
<a name="l531"><span class="linenum"> 531</span></a>              foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../../_variables/instances.html">$instances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>) {
<a name="l532"><span class="linenum"> 532</span></a>                  if (!<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l533"><span class="linenum"> 533</span></a>                      continue;
<a name="l534"><span class="linenum"> 534</span></a>                  }
<a name="l535"><span class="linenum"> 535</span></a>                  if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a> === 'flatfile') {
<a name="l536"><span class="linenum"> 536</span></a>                      <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>;
<a name="l537"><span class="linenum"> 537</span></a>                  } else {
<a name="l538"><span class="linenum"> 538</span></a>                      if (!<a class="function" onClick="logFunction('enrol_is_enabled')" href="../../_functions/enrol_is_enabled.html" onMouseOver="funcPopup(event,'enrol_is_enabled')">enrol_is_enabled</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>)) {
<a name="l539"><span class="linenum"> 539</span></a>                          continue;
<a name="l540"><span class="linenum"> 540</span></a>                      }
<a name="l541"><span class="linenum"> 541</span></a>                      if (!<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a> = <a class="function" onClick="logFunction('enrol_get_plugin')" href="../../_functions/enrol_get_plugin.html" onMouseOver="funcPopup(event,'enrol_get_plugin')">enrol_get_plugin</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>)) {
<a name="l542"><span class="linenum"> 542</span></a>                          continue;
<a name="l543"><span class="linenum"> 543</span></a>                      }
<a name="l544"><span class="linenum"> 544</span></a>                      if (!<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('allow_unenrol_user')" href="../../_functions/allow_unenrol_user.html" onMouseOver="funcPopup(event,'allow_unenrol_user')">allow_unenrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a>)) {
<a name="l545"><span class="linenum"> 545</span></a>                          continue;
<a name="l546"><span class="linenum"> 546</span></a>                      }
<a name="l547"><span class="linenum"> 547</span></a>                  }
<a name="l548"><span class="linenum"> 548</span></a>  
<a name="l549"><span class="linenum"> 549</span></a>  <span class="comment">                // For some reason the del action includes a role name, this complicates everything.</span>
<a name="l550"><span class="linenum"> 550</span></a>                  <a class="var it14817" onMouseOver="hilite(14817)" onMouseOut="lolite()" onClick="logVariable('componentroles')" href="../../_variables/componentroles.html">$componentroles</a> = array();
<a name="l551"><span class="linenum"> 551</span></a>                  <a class="var it14818" onMouseOver="hilite(14818)" onMouseOut="lolite()" onClick="logVariable('manualroles')" href="../../_variables/manualroles.html">$manualroles</a> = array();
<a name="l552"><span class="linenum"> 552</span></a>                  <a class="var it2995" onMouseOver="hilite(2995)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../../_variables/ras.html">$ras</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role_assignments', array('userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'contextid'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l553"><span class="linenum"> 553</span></a>                  foreach (<a class="var it2995" onMouseOver="hilite(2995)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../../_variables/ras.html">$ras</a> as <a class="var it2994" onMouseOver="hilite(2994)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../../_variables/ra.html">$ra</a>) {
<a name="l554"><span class="linenum"> 554</span></a>                      if (<a class="var it2994" onMouseOver="hilite(2994)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('component')" class="var it43058" onMouseOver="hilite(43058)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> === '') {
<a name="l555"><span class="linenum"> 555</span></a>                          <a class="var it14818" onMouseOver="hilite(14818)" onMouseOut="lolite()" onClick="logVariable('manualroles')" href="../../_variables/manualroles.html">$manualroles</a>[<a class="var it2994" onMouseOver="hilite(2994)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it43058" onMouseOver="hilite(43058)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>] = <a class="var it2994" onMouseOver="hilite(2994)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it43058" onMouseOver="hilite(43058)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>;
<a name="l556"><span class="linenum"> 556</span></a>                      } else if (<a class="var it2994" onMouseOver="hilite(2994)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('component')" class="var it43058" onMouseOver="hilite(43058)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> === 'enrol_'.<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a> and <a class="var it2994" onMouseOver="hilite(2994)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('itemid')" class="var it43058" onMouseOver="hilite(43058)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a> == <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l557"><span class="linenum"> 557</span></a>                          <a class="var it14817" onMouseOver="hilite(14817)" onMouseOut="lolite()" onClick="logVariable('componentroles')" href="../../_variables/componentroles.html">$componentroles</a>[<a class="var it2994" onMouseOver="hilite(2994)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it43058" onMouseOver="hilite(43058)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>] = <a class="var it2994" onMouseOver="hilite(2994)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it43058" onMouseOver="hilite(43058)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>;
<a name="l558"><span class="linenum"> 558</span></a>                      }
<a name="l559"><span class="linenum"> 559</span></a>                  }
<a name="l560"><span class="linenum"> 560</span></a>  
<a name="l561"><span class="linenum"> 561</span></a>                  if (<a class="var it14817" onMouseOver="hilite(14817)" onMouseOut="lolite()" onClick="logVariable('componentroles')" href="../../_variables/componentroles.html">$componentroles</a> and !isset(<a class="var it14817" onMouseOver="hilite(14817)" onMouseOut="lolite()" onClick="logVariable('componentroles')" href="../../_variables/componentroles.html">$componentroles</a>[<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>])) {
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment">                    // Do not unenrol using this method, user has some other protected role!</span>
<a name="l563"><span class="linenum"> 563</span></a>                      continue;
<a name="l564"><span class="linenum"> 564</span></a>  
<a name="l565"><span class="linenum"> 565</span></a>                  } else if (empty(<a class="var it2995" onMouseOver="hilite(2995)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../../_variables/ras.html">$ras</a>)) {
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment">                    // If user does not have any roles then let's just suspend as many methods as possible.</span>
<a name="l567"><span class="linenum"> 567</span></a>  
<a name="l568"><span class="linenum"> 568</span></a>                  } else if (!<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('roles_protected')" href="../../_functions/roles_protected.html" onMouseOver="funcPopup(event,'roles_protected')">roles_protected</a>()) {
<a name="l569"><span class="linenum"> 569</span></a>                      if (!<a class="var it14817" onMouseOver="hilite(14817)" onMouseOut="lolite()" onClick="logVariable('componentroles')" href="../../_variables/componentroles.html">$componentroles</a> and <a class="var it14818" onMouseOver="hilite(14818)" onMouseOut="lolite()" onClick="logVariable('manualroles')" href="../../_variables/manualroles.html">$manualroles</a> and !isset(<a class="var it14818" onMouseOver="hilite(14818)" onMouseOut="lolite()" onClick="logVariable('manualroles')" href="../../_variables/manualroles.html">$manualroles</a>[<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>])) {
<a name="l570"><span class="linenum"> 570</span></a>  <span class="comment">                        // Most likely we want to keep users enrolled because they have some other course roles.</span>
<a name="l571"><span class="linenum"> 571</span></a>                          continue;
<a name="l572"><span class="linenum"> 572</span></a>                      }
<a name="l573"><span class="linenum"> 573</span></a>                  }
<a name="l574"><span class="linenum"> 574</span></a>  
<a name="l575"><span class="linenum"> 575</span></a>                  if (<a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> == <a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_UNENROL')" href="../../_constants/ENROL_EXT_REMOVED_UNENROL.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_UNENROL')">ENROL_EXT_REMOVED_UNENROL</a>) {
<a name="l576"><span class="linenum"> 576</span></a>                      <a class="var it13909" onMouseOver="hilite(13909)" onMouseOut="lolite()" onClick="logVariable('unenrolled')" href="../../_variables/unenrolled.html">$unenrolled</a> = true;
<a name="l577"><span class="linenum"> 577</span></a>                      if (!<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('roles_protected')" href="../../_functions/roles_protected.html" onMouseOver="funcPopup(event,'roles_protected')">roles_protected</a>()) {
<a name="l578"><span class="linenum"> 578</span></a>                          <a class="function" onClick="logFunction('role_unassign_all')" href="../../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('contextid'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'roleid'=&gt;<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, 'component'=&gt;'', 'itemid'=&gt;0), true);
<a name="l579"><span class="linenum"> 579</span></a>                      }
<a name="l580"><span class="linenum"> 580</span></a>                      <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('unenrol_user')" href="../../_functions/unenrol_user.html" onMouseOver="funcPopup(event,'unenrol_user')">unenrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l581"><span class="linenum"> 581</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;User <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> was unenrolled from course <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> (enrol_<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>)&quot;, 1);
<a name="l582"><span class="linenum"> 582</span></a>  
<a name="l583"><span class="linenum"> 583</span></a>                  } else if (<a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> == <a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_SUSPENDNOROLES')" href="../../_constants/ENROL_EXT_REMOVED_SUSPENDNOROLES.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_SUSPENDNOROLES')">ENROL_EXT_REMOVED_SUSPENDNOROLES</a>) {
<a name="l584"><span class="linenum"> 584</span></a>                      if (<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('allow_manage')" href="../../_functions/allow_manage.html" onMouseOver="funcPopup(event,'allow_manage')">allow_manage</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>)) {
<a name="l585"><span class="linenum"> 585</span></a>                          if (<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('status')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> == <a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>) {
<a name="l586"><span class="linenum"> 586</span></a>                              <a class="var it13909" onMouseOver="hilite(13909)" onMouseOut="lolite()" onClick="logVariable('unenrolled')" href="../../_variables/unenrolled.html">$unenrolled</a> = true;
<a name="l587"><span class="linenum"> 587</span></a>                              <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('update_user_enrol')" href="../../_functions/update_user_enrol.html" onMouseOver="funcPopup(event,'update_user_enrol')">update_user_enrol</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="constant" onClick="logConstant('ENROL_USER_SUSPENDED')" href="../../_constants/ENROL_USER_SUSPENDED.html" onMouseOver="constPopup(event,'ENROL_USER_SUSPENDED')">ENROL_USER_SUSPENDED</a>);
<a name="l588"><span class="linenum"> 588</span></a>                              if (!<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('roles_protected')" href="../../_functions/roles_protected.html" onMouseOver="funcPopup(event,'roles_protected')">roles_protected</a>()) {
<a name="l589"><span class="linenum"> 589</span></a>                                  <a class="function" onClick="logFunction('role_unassign_all')" href="../../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('contextid'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'component'=&gt;'enrol_'.<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>, 'itemid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), true);
<a name="l590"><span class="linenum"> 590</span></a>                                  <a class="function" onClick="logFunction('role_unassign_all')" href="../../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('contextid'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'roleid'=&gt;<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, 'component'=&gt;'', 'itemid'=&gt;0), true);
<a name="l591"><span class="linenum"> 591</span></a>                              }
<a name="l592"><span class="linenum"> 592</span></a>                              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;User <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> enrolment was suspended in course <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> (enrol_<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>)&quot;, 1);
<a name="l593"><span class="linenum"> 593</span></a>                          }
<a name="l594"><span class="linenum"> 594</span></a>                      }
<a name="l595"><span class="linenum"> 595</span></a>                  }
<a name="l596"><span class="linenum"> 596</span></a>              }
<a name="l597"><span class="linenum"> 597</span></a>  
<a name="l598"><span class="linenum"> 598</span></a>              if (!<a class="var it13909" onMouseOver="hilite(13909)" onMouseOut="lolite()" onClick="logVariable('unenrolled')" href="../../_variables/unenrolled.html">$unenrolled</a>) {
<a name="l599"><span class="linenum"> 599</span></a>                  if (0 == <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('role_assignments', array('userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'contextid'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l600"><span class="linenum"> 600</span></a>                      <a class="function" onClick="logFunction('role_unassign_all')" href="../../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('contextid'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'component'=&gt;'', 'itemid'=&gt;0), true);
<a name="l601"><span class="linenum"> 601</span></a>                  }
<a name="l602"><span class="linenum"> 602</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;User <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> (with role <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>) not unenrolled from course <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>&quot;, 1);
<a name="l603"><span class="linenum"> 603</span></a>              }
<a name="l604"><span class="linenum"> 604</span></a>  
<a name="l605"><span class="linenum"> 605</span></a>              return;
<a name="l606"><span class="linenum"> 606</span></a>          }
<a name="l607"><span class="linenum"> 607</span></a>      }
<a name="l608"><span class="linenum"> 608</span></a>  
<a name="l609"><span class="linenum"> 609</span></a>      <span class="comment">/**</span>
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment">     * Returns the user who is responsible for flatfile enrolments in given curse.</span>
<a name="l611"><span class="linenum"> 611</span></a>  <span class="comment">     *</span>
<a name="l612"><span class="linenum"> 612</span></a>  <span class="comment">     * Usually it is the first editing teacher - the person with &quot;highest authority&quot;</span>
<a name="l613"><span class="linenum"> 613</span></a>  <span class="comment">     * as defined by sort_by_roleassignment_authority() having 'enrol/flatfile:manage'</span>
<a name="l614"><span class="linenum"> 614</span></a>  <span class="comment">     * or 'moodle/role:assign' capability.</span>
<a name="l615"><span class="linenum"> 615</span></a>  <span class="comment">     *</span>
<a name="l616"><span class="linenum"> 616</span></a>  <span class="comment">     * @param int $courseid enrolment instance id</span>
<a name="l617"><span class="linenum"> 617</span></a>  <span class="comment">     * @return stdClass user record</span>
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment">     */</span>
<a name="l619"><span class="linenum"> 619</span></a>      protected function <a class="function" onClick="logFunction('get_enroller')" href="../../_functions/get_enroller.html" onMouseOver="funcPopup(event,'get_enroller')">get_enroller</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l620"><span class="linenum"> 620</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lasternollercourseid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/lasternollercourseid.html">lasternollercourseid</a> == <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> and <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lasternoller')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/lasternoller.html">lasternoller</a>) {
<a name="l621"><span class="linenum"> 621</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lasternoller')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/lasternoller.html">lasternoller</a>;
<a name="l622"><span class="linenum"> 622</span></a>          }
<a name="l623"><span class="linenum"> 623</span></a>  
<a name="l624"><span class="linenum"> 624</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l625"><span class="linenum"> 625</span></a>  
<a name="l626"><span class="linenum"> 626</span></a>          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="function" onClick="logFunction('get_enrolled_users')" href="../../_functions/get_enrolled_users.html" onMouseOver="funcPopup(event,'get_enrolled_users')">get_enrolled_users</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'enrol/flatfile:manage');
<a name="l627"><span class="linenum"> 627</span></a>          if (!<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>) {
<a name="l628"><span class="linenum"> 628</span></a>              <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="function" onClick="logFunction('get_enrolled_users')" href="../../_functions/get_enrolled_users.html" onMouseOver="funcPopup(event,'get_enrolled_users')">get_enrolled_users</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/role:assign');
<a name="l629"><span class="linenum"> 629</span></a>          }
<a name="l630"><span class="linenum"> 630</span></a>  
<a name="l631"><span class="linenum"> 631</span></a>          if (<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>) {
<a name="l632"><span class="linenum"> 632</span></a>              <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="function" onClick="logFunction('sort_by_roleassignment_authority')" href="../../_functions/sort_by_roleassignment_authority.html" onMouseOver="funcPopup(event,'sort_by_roleassignment_authority')">sort_by_roleassignment_authority</a>(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l633"><span class="linenum"> 633</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lasternoller')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/lasternoller.html">lasternoller</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>);
<a name="l634"><span class="linenum"> 634</span></a>              unset(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a>);
<a name="l635"><span class="linenum"> 635</span></a>          } else {
<a name="l636"><span class="linenum"> 636</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lasternoller')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/lasternoller.html">lasternoller</a> = <a class="function" onClick="logFunction('get_admin')" href="../../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l637"><span class="linenum"> 637</span></a>          }
<a name="l638"><span class="linenum"> 638</span></a>  
<a name="l639"><span class="linenum"> 639</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lasternollercourseid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/lasternollercourseid.html">lasternollercourseid</a> == <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l640"><span class="linenum"> 640</span></a>  
<a name="l641"><span class="linenum"> 641</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lasternoller')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/lasternoller.html">lasternoller</a>;
<a name="l642"><span class="linenum"> 642</span></a>      }
<a name="l643"><span class="linenum"> 643</span></a>  
<a name="l644"><span class="linenum"> 644</span></a>      <span class="comment">/**</span>
<a name="l645"><span class="linenum"> 645</span></a>  <span class="comment">     * Returns a mapping of ims roles to role ids.</span>
<a name="l646"><span class="linenum"> 646</span></a>  <span class="comment">     *</span>
<a name="l647"><span class="linenum"> 647</span></a>  <span class="comment">     * @param progress_trace $trace</span>
<a name="l648"><span class="linenum"> 648</span></a>  <span class="comment">     * @return array imsrolename=&gt;roleid</span>
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment">     */</span>
<a name="l650"><span class="linenum"> 650</span></a>      protected function <a class="function" onClick="logFunction('get_role_map')" href="../../_functions/get_role_map.html" onMouseOver="funcPopup(event,'get_role_map')">get_role_map</a>(progress_trace <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>) {
<a name="l651"><span class="linenum"> 651</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l652"><span class="linenum"> 652</span></a>  
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment">        // Get all roles.</span>
<a name="l654"><span class="linenum"> 654</span></a>          <a class="var it14811" onMouseOver="hilite(14811)" onMouseOut="lolite()" onClick="logVariable('rolemap')" href="../../_variables/rolemap.html">$rolemap</a> = array();
<a name="l655"><span class="linenum"> 655</span></a>          <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role', null, '', 'id, name, shortname');
<a name="l656"><span class="linenum"> 656</span></a>          foreach (<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../../_variables/roles.html">$roles</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>=&gt;<a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../_variables/role.html">$role</a>) {
<a name="l657"><span class="linenum"> 657</span></a>              <a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../../_variables/alias.html">$alias</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('map_'.<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>, <a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it42915" onMouseOver="hilite(42915)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>, '');
<a name="l658"><span class="linenum"> 658</span></a>              <a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../../_variables/alias.html">$alias</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../../_variables/alias.html">$alias</a>));
<a name="l659"><span class="linenum"> 659</span></a>              if (<a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../../_variables/alias.html">$alias</a> === '') {
<a name="l660"><span class="linenum"> 660</span></a>  <span class="comment">                // Either not configured yet or somebody wants to skip these intentionally.</span>
<a name="l661"><span class="linenum"> 661</span></a>                  continue;
<a name="l662"><span class="linenum"> 662</span></a>              }
<a name="l663"><span class="linenum"> 663</span></a>              if (isset(<a class="var it14811" onMouseOver="hilite(14811)" onMouseOut="lolite()" onClick="logVariable('rolemap')" href="../../_variables/rolemap.html">$rolemap</a>[<a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../../_variables/alias.html">$alias</a>])) {
<a name="l664"><span class="linenum"> 664</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Duplicate role alias <a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../../_variables/alias.html">$alias</a> detected!&quot;);
<a name="l665"><span class="linenum"> 665</span></a>              } else {
<a name="l666"><span class="linenum"> 666</span></a>                  <a class="var it14811" onMouseOver="hilite(14811)" onMouseOut="lolite()" onClick="logVariable('rolemap')" href="../../_variables/rolemap.html">$rolemap</a>[<a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../../_variables/alias.html">$alias</a>] = <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>;
<a name="l667"><span class="linenum"> 667</span></a>              }
<a name="l668"><span class="linenum"> 668</span></a>          }
<a name="l669"><span class="linenum"> 669</span></a>  
<a name="l670"><span class="linenum"> 670</span></a>          return <a class="var it14811" onMouseOver="hilite(14811)" onMouseOut="lolite()" onClick="logVariable('rolemap')" href="../../_variables/rolemap.html">$rolemap</a>;
<a name="l671"><span class="linenum"> 671</span></a>      }
<a name="l672"><span class="linenum"> 672</span></a>  
<a name="l673"><span class="linenum"> 673</span></a>      <span class="comment">/**</span>
<a name="l674"><span class="linenum"> 674</span></a>  <span class="comment">     * Restore instance and map settings.</span>
<a name="l675"><span class="linenum"> 675</span></a>  <span class="comment">     *</span>
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment">     * @param restore_enrolments_structure_step $step</span>
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment">     * @param stdClass $data</span>
<a name="l678"><span class="linenum"> 678</span></a>  <span class="comment">     * @param stdClass $course</span>
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment">     * @param int $oldid</span>
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment">     */</span>
<a name="l681"><span class="linenum"> 681</span></a>      public function <a class="function" onClick="logFunction('restore_instance')" href="../../_functions/restore_instance.html" onMouseOver="funcPopup(event,'restore_instance')">restore_instance</a>(restore_enrolments_structure_step <a class="var it763" onMouseOver="hilite(763)" onMouseOut="lolite()" onClick="logVariable('step')" href="../../_variables/step.html">$step</a>, stdClass <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, <a class="var it6" onMouseOver="hilite(6)" onMouseOut="lolite()" onClick="logVariable('oldid')" href="../../_variables/oldid.html">$oldid</a>) {
<a name="l682"><span class="linenum"> 682</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l683"><span class="linenum"> 683</span></a>  
<a name="l684"><span class="linenum"> 684</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('enrol', array('courseid'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'enrol'=&gt;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>()))) {
<a name="l685"><span class="linenum"> 685</span></a>              <a class="var it1184" onMouseOver="hilite(1184)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../../_variables/instanceid.html">$instanceid</a> = <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l686"><span class="linenum"> 686</span></a>          } else {
<a name="l687"><span class="linenum"> 687</span></a>              <a class="var it1184" onMouseOver="hilite(1184)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../../_variables/instanceid.html">$instanceid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_instance')" href="../../_functions/add_instance.html" onMouseOver="funcPopup(event,'add_instance')">add_instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l688"><span class="linenum"> 688</span></a>          }
<a name="l689"><span class="linenum"> 689</span></a>          <a class="var it763" onMouseOver="hilite(763)" onMouseOut="lolite()" onClick="logVariable('step')" href="../../_variables/step.html">$step</a>-&gt;<a class="function" onClick="logFunction('set_mapping')" href="../../_functions/set_mapping.html" onMouseOver="funcPopup(event,'set_mapping')">set_mapping</a>('enrol', <a class="var it6" onMouseOver="hilite(6)" onMouseOut="lolite()" onClick="logVariable('oldid')" href="../../_variables/oldid.html">$oldid</a>, <a class="var it1184" onMouseOver="hilite(1184)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../../_variables/instanceid.html">$instanceid</a>);
<a name="l690"><span class="linenum"> 690</span></a>      }
<a name="l691"><span class="linenum"> 691</span></a>  
<a name="l692"><span class="linenum"> 692</span></a>      <span class="comment">/**</span>
<a name="l693"><span class="linenum"> 693</span></a>  <span class="comment">     * Restore user enrolment.</span>
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment">     *</span>
<a name="l695"><span class="linenum"> 695</span></a>  <span class="comment">     * @param restore_enrolments_structure_step $step</span>
<a name="l696"><span class="linenum"> 696</span></a>  <span class="comment">     * @param stdClass $data</span>
<a name="l697"><span class="linenum"> 697</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l698"><span class="linenum"> 698</span></a>  <span class="comment">     * @param int $oldinstancestatus</span>
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment">     */</span>
<a name="l701"><span class="linenum"> 701</span></a>      public function <a class="function" onClick="logFunction('restore_user_enrolment')" href="../../_functions/restore_user_enrolment.html" onMouseOver="funcPopup(event,'restore_user_enrolment')">restore_user_enrolment</a>(restore_enrolments_structure_step <a class="var it763" onMouseOver="hilite(763)" onMouseOut="lolite()" onClick="logVariable('step')" href="../../_variables/step.html">$step</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4197" onMouseOver="hilite(4197)" onMouseOut="lolite()" onClick="logVariable('oldinstancestatus')" href="../../_variables/oldinstancestatus.html">$oldinstancestatus</a>) {
<a name="l702"><span class="linenum"> 702</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, null, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timestart')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timestart.html">timestart</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('timeend')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/timeend.html">timeend</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('status')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>);
<a name="l703"><span class="linenum"> 703</span></a>      }
<a name="l704"><span class="linenum"> 704</span></a>  
<a name="l705"><span class="linenum"> 705</span></a>      <span class="comment">/**</span>
<a name="l706"><span class="linenum"> 706</span></a>  <span class="comment">     * Restore role assignment.</span>
<a name="l707"><span class="linenum"> 707</span></a>  <span class="comment">     *</span>
<a name="l708"><span class="linenum"> 708</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l709"><span class="linenum"> 709</span></a>  <span class="comment">     * @param int $roleid</span>
<a name="l710"><span class="linenum"> 710</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l711"><span class="linenum"> 711</span></a>  <span class="comment">     * @param int $contextid</span>
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment">     */</span>
<a name="l713"><span class="linenum"> 713</span></a>      public function <a class="function" onClick="logFunction('restore_role_assignment')" href="../../_functions/restore_role_assignment.html" onMouseOver="funcPopup(event,'restore_role_assignment')">restore_role_assignment</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>) {
<a name="l714"><span class="linenum"> 714</span></a>          <a class="function" onClick="logFunction('role_assign')" href="../../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, 'enrol_'.<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>, <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l715"><span class="linenum"> 715</span></a>      }
<a name="l716"><span class="linenum"> 716</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'unenrol_user': ['unenrol_user', 'Unenrol user from course, the last unenrolment removes all remaining roles. ', [['lib','enrollib.php',1434],['enrol','locallib.php',641],['enrol/lti','lib.php',167],['enrol/mnet','enrol.php',198],['enrol/guest','lib.php',76]], 59],
'sync': ['sync', 'Sync all meta course links. ', [['enrol/manual','lib.php',294],['enrol/flatfile','lib.php',164],['enrol/self','lib.php',433],['lib/horde/framework/Horde/Imap/Client','Base.php',3550],['lib/google/src/Google/Service','Games.php',2210],['enrol/paypal','lib.php',428]], 63],
'get_records_select': ['get_records_select', 'Load a list of records based on a select query. ', [['competency/classes','persistent.php',751],['lib/dml','moodle_database.php',1332]], 166],
'get_context': ['get_context', 'Return the course context for new modules, or the module context for existing modules. ', [['course','moodleform_mod.php',148],['availability/classes','info_module.php',72],['availability/classes','info_section.php',55],['competency/classes','user_competency_plan.php',83],['availability/tests/fixtures','mock_info.php',59],['mod/feedback/classes','responses_table.php',146],['competency/classes','competency.php',730],['competency/classes','plan.php',258],['mod/quiz','attemptlib.php',220],['competency/classes','user_competency.php',216],['grade/grading','lib.php',107],['lib','modinfolib.php',1486],['lib','badgeslib.php',157],['competency/classes/external','exporter.php',172],['comment','lib.php',994],['grade/grading/form','lib.php',102],['mod/assign','locallib.php',1307],['competency/classes','user_evidence.php',90],['competency/classes','user_competency_course.php',80],['lib/classes/event','base.php',627],['enrol','locallib.php',921],['lib','coursecatlib.php',2369],['lib','coursecatlib.php',3065],['competency/classes','course_competency_settings.php',133],['lib/tests/behat','behat_data_generators.php',769],['competency/classes','competency_framework.php',70],['competency/classes','template.php',139]], 1033],
'restore_user_enrolment': ['restore_user_enrolment', 'Restore user enrolment. ', [['enrol/manual','lib.php',481],['enrol/flatfile','lib.php',692],['lib','enrollib.php',2444],['enrol/self','lib.php',600],['enrol/ldap','lib.php',1129],['enrol/cohort','lib.php',301],['enrol/database','lib.php',960],['enrol/paypal','lib.php',266],['enrol/meta','lib.php',432]], 1],
'enrol_user': ['enrol_user', 'Enrol user into course via enrol instance. ', [['enrol/flatfile','lib.php',144],['lib','enrollib.php',1270],['lib/testing/generator','data_generator.php',891],['enrol/lti/classes','helper.php',233],['enrol/self','externallib.php',122],['enrol/mnet','enrol.php',115],['enrol/guest','lib.php',60]], 745],
'process_records': ['process_records', 'Process user enrolment line. ', [['enrol/flatfile','lib.php',396]], 2],
'convert': ['convert', '', [['lib','wiki_to_markdown.php',314],['backup/converter','convertlib.php',119],['backup/cc/cc_lib','cc_converter_url.php',36],['backup/cc/cc_lib','cc_converter_forum.php',36],['backup/cc/cc_lib','cc_converter_basiclti.php',36],['lib/html2text','Html2Text.php',325],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',18498],['backup/cc/cc_lib','cc_converter_quiz.php',40],['lib','navigationlib.php',4932],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',63],['backup/cc/cc_lib','cc_converter_resource.php',34],['backup/cc/cc_lib','cc_convert_moodle2.php',29],['backup/cc/cc_lib','cc_converter_lti.php',36],['lib/classes','text.php',162],['backup/cc/cc_lib','cc_converter_label.php',33],['backup/cc/cc_lib','cc_converter_page.php',35],['backup/cc/cc_lib','cc_converter_folder.php',33],['lib/lessphp','Functions.php',569],['backup/controller','restore_controller.class.php',439]], 141],
'fullname': ['fullname', 'Returns a persons full name ', [['lib','moodlelib.php',3249],['mod/assign','locallib.php',3915]], 546],
'enrol_get_plugin': ['enrol_get_plugin', 'Returns instance of enrol plugin ', [['lib','enrollib.php',111]], 156],
'get_user_enrolment_actions': ['get_user_enrolment_actions', 'Gets an array of the user enrolment actions. ', [['enrol/manual','lib.php',418],['enrol/flatfile','lib.php',120],['lib','enrollib.php',2022],['enrol/self','lib.php',539],['enrol/cohort','lib.php',224],['enrol/database','lib.php',85],['enrol/lti','lib.php',362],['enrol/paypal','lib.php',279],['enrol/meta','lib.php',98]], 1],
'raise': ['raise', 'Sets the PHP time limit to a number of seconds from now. ', [['lib/classes','php_time_limit.php',41]], 90],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'process_file': ['process_file', 'Given the full path of a file, try to find the user the file corresponds to and assign him/her this file as his/her picture. Make extensive checks to make sure we don\'t open any security holes and report back any success/error. ', [['admin/tool/uploaduser','picture.php',185],['enrol/flatfile','lib.php',230],['backup/moodle2','restore_stepslib.php',1041]], 2],
'get_admin': ['get_admin', 'Returns $user object of the main admin user ', [['lib','datalib.php',53]], 61],
'get_enrolled_users': ['get_enrolled_users', 'Returns list of users enrolled into course. ', [['lib','accesslib.php',2439],['enrol','externallib.php',409]], 61],
'sort_by_roleassignment_authority': ['sort_by_roleassignment_authority', 'Re-sort a users array based on a sorting policy ', [['lib','accesslib.php',4021]], 5],
'update_user_enrol': ['update_user_enrol', 'Store user_enrolments changes and trigger event. ', [['lib','enrollib.php',1367]], 25],
'reset_buffer': ['reset_buffer', 'Reset internal text buffer. ', [['lib','weblib.php',3562]], 2],
'raise_memory_limit': ['raise_memory_limit', 'Function to raise the memory limit to a new value. Will respect the memory limit if it is higher, thus allowing settings in php.ini, apache conf or command line switches to override it. ', [['lib','setuplib.php',1206]], 59],
'restore_role_assignment': ['restore_role_assignment', 'Restore role assignment. ', [['enrol/manual','lib.php',532],['enrol/flatfile','lib.php',705],['lib','enrollib.php',2457],['enrol/self','lib.php',613],['enrol/ldap','lib.php',1156],['enrol/database','lib.php',981]], 1],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'roles_protected': ['roles_protected', '', [['enrol/manual','lib.php',32],['enrol/flatfile','lib.php',51],['lib','enrollib.php',1170],['enrol/self','lib.php',96],['enrol/paypal','lib.php',80]], 9],
'restore_instance': ['restore_instance', 'Restore instance and map settings. ', [['enrol/manual','lib.php',461],['enrol/flatfile','lib.php',673],['lib','enrollib.php',2431],['enrol/self','lib.php',563],['enrol/ldap','lib.php',1109],['enrol/cohort','lib.php',244],['enrol/database','lib.php',941],['enrol/lti','lib.php',388],['enrol/paypal','lib.php',236],['enrol/guest','lib.php',278],['enrol/meta','lib.php',393]], 1],
'force_current_language': ['force_current_language', 'Force the current language to get strings and dates localised in the given language. ', [['lib','moodlelib.php',6656]], 12],
'output': ['output', 'Specific output method for the memory XML sink. ', [['lib/dtl','string_xml_database_exporter.php',34],['lib/tcpdf','tcpdf.php',7537],['lib','weblib.php',3368],['lib','weblib.php',3387],['lib','weblib.php',3408],['lib','weblib.php',3432],['lib','weblib.php',3491],['lib','weblib.php',3530],['lib','weblib.php',3602],['backup/util/output','output_controller.class.php',67],['lib','pdflib.php',178],['lib/amd/src','chart_output_chartjs.js',46],['comment','lib.php',420],['lib/amd/src','chart_output_htmltable.js',29],['lib/minify/lib/HTTP','Encoder.php',285],['lib/dtl','file_xml_database_exporter.php',51],['lib','graphlib.php',1485],['grade/report/singleview','lib.php',104],['admin/tool/uploadcourse/classes','tracker.php',135]], 218],
'get_moodlepage': ['get_moodlepage', 'Returns the current moodle page ', [['enrol','locallib.php',148]], 18],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'strlen': ['strlen', 'Counts the number of characters. Unit-tested by Kasper (single byte charsets only) ', [['lib/typo3','class.t3lib_cs.php',1520],['lib/classes','text.php',305]], 1649],
'record_exists': ['record_exists', 'Check if a record exists by ID. ', [['competency/classes','persistent.php',842],['lib/dml','moodle_database.php',1817]], 901],
'params': ['params', 'Add an array of params to the params for this url. ', [['lib','weblib.php',392],['question/classes/bank/search','condition.php',43],['question/classes/bank/search','category_condition.php',100]], 93],
'allow_manage': ['allow_manage', '', [['enrol/manual','lib.php',47],['enrol/flatfile','lib.php',86],['lib','enrollib.php',1217],['enrol/self','lib.php',106],['enrol/paypal','lib.php',90]], 9],
'count_records': ['count_records', 'Count a list of records. ', [['competency/classes','persistent.php',815],['mod/glossary/classes','entry_query_builder.php',152],['lib/dml','moodle_database.php',1766]], 1630],
'get_enroller': ['get_enroller', 'Returns the user who is responsible for manual enrolments in given instance. ', [['enrol/manual','lib.php',385],['enrol/flatfile','lib.php',609],['lib','enrollib.php',2286],['enrol/self','lib.php',506]], 7],
'allow_unenrol': ['allow_unenrol', '', [['enrol/manual','lib.php',42],['enrol/flatfile','lib.php',59],['lib','enrollib.php',1190],['enrol/self','lib.php',101],['enrol/lti','lib.php',69],['enrol/paypal','lib.php',85]], 5],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1379]], 880],
'get_role_map': ['get_role_map', 'Returns a mapping of ims roles to role ids. ', [['enrol/flatfile','lib.php',644]], 1],
'role_assign': ['role_assign', 'Assigns the specified role to a user in the context. ', [['lib/testing/generator','data_generator.php',936],['lib','accesslib.php',1661]], 269],
'get_name': ['get_name', 'Return localised event name. ', [['lib/classes/event','competency_plan_unlinked.php',72],['admin/tool/langimport/classes/task','update_langpacks_task.php',35],['lib/simplepie/library/SimplePie','Author.php',106],['portfolio/download','lib.php',10],['backup/util/structure','restore_path_element.class.php',98],['lib/classes/message/inbound','private_files_handler.php',56],['lib/classes/event','grouping_group_assigned.php',48],['calendar/tests','calendartype_test_example.php',32],['lib/classes/event','enrol_instance_deleted.php',70],['report/log/classes/event','user_report_viewed.php',54],['lib/classes/task','blog_cron_task.php',31],['mod/quiz/classes/event','attempt_reviewed.php',53],['lib/classes/event','tag_unflagged.php',55],['lib/classes/task','send_new_user_passwords_task.php',31],['lib/classes/event','role_unassigned.php',53],['mod/assign/classes/event','grading_form_viewed.php',82],['question/classes/bank','edit_action_column.php',35],['admin/tool/log/store/standard/classes/task','cleanup_task.php',31],['mod/workshop/classes/event','submission_deleted.php',63],['mod/forum/classes/event','discussion_updated.php',65],['lib/classes/event','course_module_instance_list_viewed.php',75],['lib/classes/event','course_created.php',55],['lib/dml','pdo_moodle_database.php',113],['mod/assign/classes/event','extension_granted.php',77],['lib/classes/task','tag_cron_task.php',33],['enrol/imsenterprise/classes/task','cron_task.php',34],['lib/classes/event','course_deleted.php',56],['lib/classes/task','completion_daily_task.php',33],['mod/forum/classes/event','readtracking_enabled.php',64],['mod/wiki/classes/event','page_created.php',48],['lib/dml','oci_native_moodle_database.php',94],['lib/classes/event','competency_viewed.php',70],['mod/choice/classes/event','answer_updated.php',72],['lib/classes/event','search_indexed.php',47],['lib/classes/event','badge_criteria_updated.php',53],['question/classes/bank','question_type_column.php',26],['mod/wiki/classes/event','page_version_deleted.php',54],['lib/grade','grade_item.php',1384],['lib/classes/event','competency_user_competency_rated_in_plan.php',88],['lib/classes/event','webservice_token_sent.php',56],['mod/glossary/classes/event','entry_deleted.php',54],['admin/tool/messageinbound/classes/message/inbound','invalid_recipient_handler.php',60],['lib/classes/event','competency_template_viewed.php',63],['lib/classes/task','context_cleanup_task.php',32],['mod/assign/tests/fixtures','event_mod_assign_fixtures.php',62],['admin/tool/langimport/classes/event','langpack_removed.php',89],['mod/glossary/classes/event','category_deleted.php',46],['mod/forum/classes/message/inbound','reply_handler.php',51],['competency/classes','competency_rule.php',84],['mod/lti/classes/event','unknown_service_api_called.php',82],['lib/classes/event','badge_deleted.php',49],['mod/quiz/classes/event','user_override_updated.php',54],['lib/classes/event','message_contact_added.php',48],['lib/classes/event','cohort_member_added.php',49],['backup/util/ui','restore_ui.class.php',351],['lib/classes/event','blog_entry_updated.php',74],['mod/assign/classes/event','workflow_state_updated.php',88],['mod/forum/classes/event','assessable_uploaded.php',86],['mod/assign/classes/event','submission_created.php',57],['lib/classes/event','group_deleted.php',65],['lib/classes/event','role_allow_assign_updated.php',47],['mod/lesson/classes/event','highscore_added.php',59],['mod/forum/classes/event','discussion_pinned.php',55],['lib/classes/event','webservice_function_called.php',67],['lib/classes/event','competency_plan_reopened.php',75],['mod/lesson/classes/event','essay_attempt_viewed.php',48],['mod/wiki/classes/event','page_locks_deleted.php',54],['lib/classes/event','webservice_service_deleted.php',59],['mod/forum/classes/event','discussion_subscription_created.php',66],['admin/tool/log/store/database/tests/fixtures','event.php',31],['mod/workshop/classes/event','assessable_uploaded.php',93],['lib','csslib.php',2155],['lib','csslib.php',2283],['lib/classes/event','user_loggedout.php',54],['lib/classes/event','webservice_token_created.php',65],['lib/classes/event','tag_collection_updated.php',65],['competency/classes','competency_rule_all.php',84],['backup/util/settings','base_setting.class.php',145],['mod/data/classes/event','field_deleted.php',57],['mod/book/classes/event','chapter_created.php',79],['lib/classes/event','email_failed.php',56],['lib/classes/task','stats_cron_task.php',31],['mod/survey/classes/event','report_downloaded.php',55],['mod/workshop/classes/event','phase_switched.php',75],['lib/grade','grade_category.php',2300],['lib/grade','grade_scale.php',156],['lib/classes/event','course_reset_started.php',53],['mod/workshop/classes/event','assessment_evaluated.php',66],['lib/classes/event','blog_association_created.php',56],['backup/converter','convertlib.php',109],['report/outline/classes/event','activity_report_viewed.php',48],['lib/classes/task','legacy_plugin_cron_task.php',33],['lib/classes/event','competency_plan_updated.php',75],['mod/choice/classes/event','answer_submitted.php',72],['mod/lesson/classes/event','lesson_ended.php',49],['lib/classes/event','role_allow_switch_updated.php',47],['lib/classes/task','portfolio_cron_task.php',31],['lib/classes/event','competency_user_competency_rated_in_course.php',88],['question/classes/bank','question_text_row.php',35],['lib/classes/event','tag_created.php',75],['report/participation/classes/event','report_viewed.php',58],['lib/classes/event','role_capabilities_updated.php',51],['mod/survey/classes/event','response_submitted.php',53],['lib/classes/event','badge_archived.php',47],['mod/workshop/classes/event','assessment_reevaluated.php',76],['mod/assign/classes/event','submission_locked.php',78],['report/outline/classes/event','report_viewed.php',54],['lib/classes/event','user_deleted.php',57],['lib/classes/event','mnet_access_control_updated.php',57],['mod/lesson/classes/event','essay_assessed.php',78],['mod/book/tool/print/classes/event','book_printed.php',76],['lib/classes/event','grouping_deleted.php',72],['admin/tool/monitor/classes','rule.php',239],['lib/classes/event','course_viewed.php',75],['mod/forum/classes/event','user_report_viewed.php',65],['user/selector','lib.php',309],['mod/quiz/classes/event','attempt_summary_viewed.php',56],['lib/classes/event','webservice_service_user_added.php',59],['mod/forum/classes/event','discussion_unpinned.php',55],['lib/classes/event','grouping_group_unassigned.php',48],['lib/grade','grade_outcome.php',272],['mod/chat/classes/event','message_sent.php',59],['lib/classes/event','role_assigned.php',56],['mod/quiz/classes/question/bank','question_name_text_column.php',37],['question/classes/bank','modifier_name_column.php',27],['mod/glossary/classes/event','entry_viewed.php',48],['mod/data/classes/event','record_created.php',56],['lib/classes/event','course_category_deleted.php',59],['lib/dml','mariadb_native_moodle_database.php',41],['lib/classes/event','role_deleted.php',55],['lib/classes/task','question_cron_task.php',31],['portfolio/flickr','lib.php',41],['lib/classes/task','cache_cron_task.php',31],['mod/wiki/classes/event','page_version_viewed.php',54],['admin/tool/recyclebin/classes/event','category_bin_item_deleted.php',47],['admin/tool/log/store/standard/tests/fixtures','event.php',31],['mod/scorm/classes/event','status_submitted.php',46],['admin/tool/monitor/classes/event','rule_created.php',50],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',31],['question/classes/bank','checkbox_column.php',32],['lib/classes/event','competency_user_competency_plan_viewed.php',81],['mod/assign/feedback/offline','locallib.php',42],['admin/tool/messageinbound/classes/task','cleanup_task.php',38],['mod/workshop/classes/event','submission_updated.php',63],['lib/editor/atto/classes/task','autosave_cleanup_task.php',33],['mod/choice/classes/event','report_viewed.php',53],['mod/lesson/classes/event','group_override_deleted.php',54],['mod/wiki/classes/event','page_map_viewed.php',54],['admin/tool/log/store/legacy/tests/fixtures','event.php',31],['mod/lesson/classes/event','question_answered.php',54],['mod/choice/classes/event','report_downloaded.php',54],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',36],['backup/util/ui','backup_ui_setting.class.php',86],['lib/classes/event','competency_user_evidence_created.php',64],['lib/classes/event','course_module_completion_updated.php',54],['repository/coursefiles','lib.php',183],['lib/classes/event','note_updated.php',56],['lib/classes/event','note_created.php',56],['lib/classes/event','competency_framework_created.php',63],['lib/classes/event','course_resources_list_viewed.php',60],['lib/classes/event','tag_updated.php',58],['mod/forum/classes/event','subscribers_viewed.php',65],['mod/book/tool/exportimscp/classes/event','book_exported.php',76],['mod/quiz/classes/question/bank','add_action_column.php',45],['lib/classes/task','completion_regular_task.php',33],['lib/classes/event','user_enrolment_deleted.php',54],['grade/report/grader/classes/event','grade_report_viewed.php',39],['lib','enrollib.php',1076],['admin/tool/recyclebin/classes/event','course_bin_item_restored.php',47],['lib/classes/event','webservice_service_updated.php',59],['lib/editor/tinymce/classes','plugin.php',101],['mod/lesson/classes/event','group_override_created.php',55],['mod/scorm/classes/event','attempt_deleted.php',62],['lib/classes/event','competency_user_competency_review_request_cancelled.php',72],['lib/classes/event','webservice_service_created.php',65],['lib/classes/task','events_cron_task.php',31],['mod/wiki/classes/event','page_version_restored.php',54],['mod/forum/classes/event','discussion_deleted.php',66],['lib/classes/event','competency_framework_updated.php',73],['mod/lesson/classes/event','lesson_restarted.php',48],['mod/wiki/classes/event','page_updated.php',54],['mod/assign/classes/event','marker_updated.php',89],['lib','modinfolib.php',1270],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',38],['lib/classes/event','course_module_updated.php',57],['repository','lib.php',1834],['auth/cas/classes/task','sync_task.php',34],['lib/classes/event','competency_template_deleted.php',73],['mod/assign/classes/event','submission_confirmation_form_viewed.php',79],['lib/bennu','iCalendar_components.php',37],['report/questioninstances/classes/event','report_viewed.php',55],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',36],['lib/classes/event','message_contact_blocked.php',48],['lib/classes/event','competency_template_updated.php',75],['question/behaviour','behaviourbase.php',83],['grade/report/history/classes/event','grade_report_viewed.php',39],['lib/classes/event','badge_disabled.php',47],['mod/assign/classes/event','grading_table_viewed.php',79],['lib/classes/event','badge_enabled.php',47],['mod/lti','OAuth.php',122],['mod/lti','OAuth.php',149],['mod/lti','OAuth.php',173],['calendar/type/gregorian/classes','structure.php',29],['mod/quiz/classes/event','edit_page_viewed.php',53],['lib/simplepie/library/SimplePie','Credit.php',139],['mod/scorm/classes/event','tracks_viewed.php',64],['mod/wiki/classes/event','page_diff_viewed.php',55],['message/tests/fixtures','inbound_fixtures.php',41],['lib/classes/event','grouping_created.php',65],['lib/classes/event','calendar_event_deleted.php',58],['enrol/flatfile/classes/task','flatfile_sync_task.php',37],['lib/classes/event','group_updated.php',65],['lib/classes/task','registration_cron_task.php',31],['mod/book/classes/event','chapter_updated.php',79],['lib/classes/event','grade_deleted.php',94],['admin/tool/recyclebin/classes/event','course_bin_item_created.php',47],['lib/classes/event','user_loggedin.php',64],['lib/classes/task','check_for_updates_task.php',31],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',56],['mod/assign/submission/file','locallib.php',44],['mod/forum/classes/task','cron_task.php',30],['mod/forum/classes/event','subscription_created.php',65],['lib/classes/event','tag_collection_created.php',65],['grade/report/overview/classes/event','grade_report_viewed.php',48],['mod/assign/classes/event','batch_set_marker_allocation_viewed.php',79],['mod/quiz/classes/event','group_override_updated.php',54],['lib/classes/event','competency_plan_created.php',63],['mod/glossary/classes/event','entry_disapproved.php',46],['lib/classes/task','send_failed_login_notifications_task.php',34],['enrol/lti/classes/task','sync_grades.php',36],['lib/classes/event','message_viewed.php',54],['portfolio/boxnet','lib.php',14],['lib/classes/event','comment_created.php',58],['question/classes/bank','preview_action_column.php',26],['lib/classes/event','course_content_deleted.php',54],['lib/dml','pgsql_native_moodle_database.php',87],['mod/feedback/classes/event','response_deleted.php',83],['lib/classes/event','competency_evidence_created.php',98],['lib/classes/event','comment_deleted.php',58],['lib/classes/event','competency_user_competency_review_requested.php',72],['mod/quiz/classes/event','attempt_abandoned.php',63],['mod/scorm/classes/event','user_report_viewed.php',62],['lib/dml','mssql_native_moodle_database.php',88],['mod/quiz/classes/event','attempt_becameoverdue.php',66],['mod/quiz/classes/event','group_override_created.php',55],['lib/dml','mysqli_native_moodle_database.php',352],['backup/util/ui','backup_ui.class.php',194],['mod/book/tool/print/classes/event','chapter_printed.php',79],['mod/data/classes/event','record_deleted.php',56],['competency/classes','competency_rule_points.php',185],['lib/classes/event','competency_user_competency_viewed.php',81],['lib/classes/event','dashboard_viewed.php',59],['mod/lesson/classes/event','question_viewed.php',54],['lib/classes/event','user_profile_viewed.php',56],['lib','medialib.php',345],['admin/tool/monitor/classes/task','clean_events.php',32],['mod/lesson/classes/event','user_override_deleted.php',53],['lib/classes/event','cohort_member_removed.php',50],['mod/lesson/classes/event','lesson_started.php',48],['mod/lesson/classes/event','page_updated.php',73],['mod/workshop/classes/event','submission_viewed.php',63],['question/classes/bank','question_name_column.php',28],['lib/classes/event','competency_deleted.php',87],['admin/tool/monitor/classes','subscription.php',132],['lib/classes/task','grade_cron_task.php',31],['mod/glossary/classes/event','entry_created.php',52],['lib/classes/task','file_temp_cleanup_task.php',31],['lib/classes/event','dashboard_reset.php',60],['backup/util/structure','base_atom.class.php',71],['portfolio/googledocs','lib.php',54],['mod/assign/feedback/comments','locallib.php',36],['mod/wiki/classes/event','page_history_viewed.php',48],['lib/classes/event','competency_plan_review_request_cancelled.php',75],['lib/classes/event','competency_plan_deleted.php',73],['mod/quiz/classes/event','attempt_viewed.php',54],['mod/data/classes/event','field_updated.php',57],['lib/classes/event','grouping_updated.php',65],['cache/classes','definition.php',621],['lib/classes/task','plagiarism_cron_task.php',31],['backup/converter/moodle1','lib.php',1033],['lib/classes/event','question_category_created.php',48],['grade/report/user/classes/event','grade_report_viewed.php',48],['lib/classes/event','user_login_failed.php',56],['mod/scorm/classes/event','report_viewed.php',63],['mod/chat/classes/event','sessions_viewed.php',65],['admin/tool/recyclebin/classes/event','course_bin_item_deleted.php',47],['mod/quiz/classes/event','user_override_deleted.php',53],['portfolio/mahara','lib.php',61],['mod/quiz/classes/event','attempt_submitted.php',63],['grade/report/outcomes/classes/event','grade_report_viewed.php',39],['mod/lesson/classes/event','group_override_updated.php',54],['mod/workshop/classes/event','submission_created.php',63],['mod/assign/classes/event','submission_updated.php',57],['mod/assign/submission/onlinetext/classes/event','assessable_uploaded.php',83],['lib/classes/event','competency_updated.php',70],['lib/classes/event','note_deleted.php',56],['mod/lesson/classes/event','page_moved.php',56],['lib/classes/event','course_completed.php',73],['lib/classes/event','tag_added.php',58],['lib/classes/event','competency_created.php',70],['mod/lesson/classes/event','highscores_viewed.php',51],['lib/classes/event','message_contact_unblocked.php',48],['lib/classes/event','user_enrolment_created.php',53],['lib/classes/task','search_index_task.php',35],['lib/classes/event','course_module_created.php',86],['lib/classes/event','webservice_service_user_removed.php',59],['report/log/classes/event','report_viewed.php',58],['mod/assign/submission/file/classes/event','assessable_uploaded.php',85],['lib/classes/event','group_member_added.php',78],['mod/forum/classes/event','discussion_viewed.php',60],['mod/assign/classes/event','submission_viewed.php',76],['mod/lti/classes/local/ltiservice','service_base.php',87],['enrol/lti/classes/task','sync_members.php',46],['mod/workshop/classes/event','submission_reassessed.php',77],['lib/classes/task','session_cleanup_task.php',31],['lib/tests','messageinbound_test.php',166],['lib/classes/task','backup_cleanup_task.php',31],['mod/workshop/classes/event','assessment_evaluations_reset.php',75],['mod/scorm/classes/event','scoreraw_submitted.php',46],['mod/assign/classes/event','statement_accepted.php',77],['mod/assign/classes/event','feedback_viewed.php',76],['lib/classes/task','delete_unconfirmed_users_task.php',31],['mod/forum/classes/event','discussion_moved.php',66],['lib/classes/event','competency_user_evidence_deleted.php',64],['mod/assign/classes/event','batch_set_workflow_state_viewed.php',79],['mod/lesson/classes/event','lesson_resumed.php',48],['lib/classes/task','badges_cron_task.php',31],['lib/classes/event','comments_viewed.php',51],['mod/data/classes/event','template_viewed.php',55],['mod/wiki/classes/event','page_deleted.php',54],['mod/quiz/classes/event','report_viewed.php',56],['mod/scorm/classes/event','sco_launched.php',64],['mod/glossary/classes/event','entry_updated.php',52],['mod/lesson/classes/event','user_override_created.php',53],['mod/glossary/classes/event','category_updated.php',46],['lib/classes/event','course_updated.php',58],['grade/report/singleview/classes/event','grade_report_viewed.php',39],['mod/feedback/classes/event','response_submitted.php',83],['lib/classes/event','blog_entry_deleted.php',53],['mod/book/classes/event','chapter_deleted.php',79],['report/completion/classes/event','report_viewed.php',49],['lib/classes/event','recent_activity_viewed.php',49],['mod/quiz/classes/event','question_manually_graded.php',55],['mod/assign/classes/event','submission_status_updated.php',79],['lib/classes/event','user_enrolment_updated.php',53],['lib/classes/event','tag_deleted.php',55],['report/completion/classes/event','user_report_viewed.php',49],['report/stats/classes/event','report_viewed.php',56],['lib/classes/event','calendar_event_created.php',58],['mod/assign/classes/event','submission_duplicated.php',77],['lib/classes/event','competency_framework_deleted.php',73],['lib/classes/event','course_section_updated.php',56],['lib/classes/event','message_sent.php',82],['lib/classes/event','calendar_subscription_deleted.php',56],['lib/classes/event','course_category_updated.php',51],['lib/classes/event','user_password_updated.php',70],['enrol/lti/ims-blti','OAuth.php',65],['enrol/lti/ims-blti','OAuth.php',92],['enrol/lti/ims-blti','OAuth.php',116],['mod/forum/classes/event','subscription_deleted.php',65],['mod/assign/classes/event','reveal_identities_confirmation_page_viewed.php',79],['lib/classes/event','user_loggedinas.php',57],['lib/classes/event','competency_template_created.php',63],['lib/classes/event','user_created.php',48],['admin/tool/recyclebin/classes/event','category_bin_item_restored.php',47],['report/loglive/classes/event','report_viewed.php',48],['admin/tool/monitor/classes/event','subscription_created.php',50],['mod/book/classes/event','chapter_viewed.php',79],['lib/classes/event','badge_awarded.php',54],['lib/classes/event','calendar_subscription_created.php',57],['lib/classes/event','enrol_instance_created.php',69],['lib/classes/event','user_list_viewed.php',56],['lib/classes/task','calendar_cron_task.php',31],['mod/forum/classes/event','post_deleted.php',67],['mod/quiz/classes/event','group_override_deleted.php',54],['lib/classes/event','badge_created.php',47],['backup/util/plan','base_plan.class.php',50],['lib/classes/event','base.php',292],['lib/classes/event','competency_framework_viewed.php',69],['lib/classes/event','tag_collection_deleted.php',65],['lib/classes/event','group_member_removed.php',69],['lib/classes/event','grade_report_viewed.php',54],['lib/classes/event','calendar_event_updated.php',58],['mod/assign/submission/onlinetext','locallib.php',40],['lib/classes/event','user_updated.php',48],['mod/lesson/classes/event','page_created.php',54],['backup/util/ui','base_ui_stage.class.php',110],['mod/assign/classes/event','submission_form_viewed.php',82],['auth/ldap/classes/task','sync_task.php',34],['lib/classes/event','course_completion_updated.php',47],['lib/classes/event','competency_plan_review_started.php',75],['lib/classes/event','course_user_report_viewed.php',66],['mod/folder/classes/event','all_files_downloaded.php',60],['mod/workshop/classes/event','assessments_reset.php',74],['lib/tests/fixtures','task_fixtures.php',35],['lib/tests/fixtures','task_fixtures.php',44],['lib/tests/fixtures','task_fixtures.php',53],['mod/data/classes/event','template_updated.php',56],['mod/assign/classes/event','identities_revealed.php',75],['question/classes/bank','copy_action_column.php',35],['admin/tool/log/store/legacy/classes/event','legacy_logged.php',35],['lib/classes/event','notes_viewed.php',49],['admin/tool/recyclebin/classes/event','category_bin_item_created.php',47],['lib/classes/event','competency_plan_viewed.php',63],['mod/data/classes/event','record_updated.php',56],['mod/assign/feedback/file','locallib.php',45],['lib/classes/event','competency_plan_unapproved.php',75],['mod/lesson/classes/event','content_page_viewed.php',48],['mod/assign/feedback/editpdf','locallib.php',43],['lib/dml','sqlsrv_native_moodle_database.php',108],['admin/tool/monitor/classes/event','subscription_deleted.php',50],['mod/assign/classes/event','assessable_submitted.php',109],['mod/quiz/classes/event','attempt_started.php',62],['lib/classes/task','create_contexts_task.php',31],['lib/classes/task','file_trash_cleanup_task.php',31],['lib/classes/event','competency_user_competency_rated.php',82],['mod/forum/classes/event','post_updated.php',67],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',37],['lib/classes/event','course_module_deleted.php',56],['mod/assign/submission/comments','locallib.php',39],['lib/classes/event','competency_plan_review_requested.php',75],['lib/classes/event','user_graded.php',96],['lib/classes/event','webservice_login_failed.php',71],['mod/forum/classes/event','post_created.php',67],['lib/classes/task','complete_plans_task.php',43],['mod/assign/classes/event','submission_status_viewed.php',81],['lib/classes/event','enrol_instance_updated.php',70],['lib/classes/task','messaging_cleanup_task.php',31],['portfolio/picasa','lib.php',33],['admin/tool/capability/classes/event','report_viewed.php',47],['grade/report/singleview/classes/local/ui','unique_name.php',38],['mod/data/classes/event','field_created.php',58],['mod/folder/classes/event','folder_updated.php',48],['lib/classes/event','badge_updated.php',47],['lib/tests/fixtures','event_fixtures.php',34],['lib/classes/task','cache_cleanup_task.php',31],['mod/survey/classes/event','report_viewed.php',55],['mod/quiz/classes/event','attempt_deleted.php',53],['mod/glossary/classes/event','entry_approved.php',46],['mod/wiki/classes/event','page_viewed.php',57],['lib/classes/log','reader.php',30],['lib/classes/task','password_reset_cleanup_task.php',31],['mod/forum/classes/event','readtracking_disabled.php',64],['admin/tool/langimport/classes/event','langpack_imported.php',80],['lib/classes/event','competency_plan_review_stopped.php',75],['admin/tool/langimport/classes/event','langpack_updated.php',80],['lib/classes/event','unknown_logged.php',43],['lib/classes/event','competency_user_competency_viewed_in_plan.php',85],['lib/classes/event','competency_user_competency_viewed_in_course.php',84],['lib/classes/task','search_optimize_task.php',38],['mod/glossary/classes/event','category_created.php',46],['lib/portfolio','plugin.php',120],['report/stats/classes/event','user_report_viewed.php',48],['lib/classes/event','dashboards_reset.php',59],['lib/classes/event','calendar_subscription_updated.php',57],['lib/classes/event','cohort_updated.php',49],['admin/tool/monitor/classes/event','rule_updated.php',50],['mod/lesson/classes/event','page_deleted.php',54],['lib/classes/event','course_section_deleted.php',57],['lib/classes/task','delete_incomplete_users_task.php',31],['lib/classes/task','automated_backup_task.php',31],['admin/tool/monitor/classes/event','subscription_criteria_met.php',55],['lib/classes/event','mnet_access_control_created.php',57],['admin/tool/messageinbound/classes/task','pickup_task.php',38],['mod/forum/classes/event','discussion_created.php',65],['question/classes/bank','creator_name_column.php',28],['lib/classes/event','blog_entries_viewed.php',62],['lib/classes/task','sync_plans_from_template_cohorts_task.php',41],['mod/quiz/classes/event','attempt_preview_started.php',54],['lib/classes/event','content_viewed.php',80],['lib/classes/event','competency_user_evidence_updated.php',64],['lib/dml/tests','dml_test.php',5530],['mod/assign/classes/event','submission_graded.php',78],['mod/assign/classes/event','all_submissions_downloaded.php',75],['lib/classes/event','course_restored.php',58],['lib/classes/event','group_created.php',65],['lib/classes/event','badge_criteria_deleted.php',52],['lib/classes/event','tag_flagged.php',55],['lib/classes/event','competency_plan_completed.php',75],['mod/lesson/classes/event','user_override_updated.php',54],['lib/classes/event','role_allow_override_updated.php',47],['mod/forum/classes/event','discussion_subscription_deleted.php',66],['lib/classes/event','cohort_deleted.php',49],['lib/classes/event','badge_criteria_created.php',52],['admin/tool/log/classes/helper','reader.php',41],['admin/tool/monitor/classes/task','check_subscriptions.php',50],['lib/classes/event','blog_entry_created.php',76],['mod/scorm/classes/event','interactions_viewed.php',63],['mod/workshop/classes/event','submission_assessed.php',76],['lib/classes/event','badge_duplicated.php',47],['backup/util/plan','base_step.class.php',49],['lib/classes/event','course_category_created.php',48],['lib/classes/event','cohort_created.php',49],['lib/classes/event','tag_removed.php',58],['lib/classes/event','competency_plan_approved.php',75],['mod/choice/classes/event','answer_deleted.php',56],['backup/util/ui','restore_ui_stage.class.php',75],['lib/classes/event','competency_user_competency_review_started.php',72],['lib/classes/event','course_reset_ended.php',53],['mod/quiz/classes/event','user_override_created.php',53],['mod/forum/classes/event','course_searched.php',66],['lib/classes/event','message_contact_removed.php',48],['admin/tool/monitor/classes/event','rule_deleted.php',50],['lib/classes/event','message_deleted.php',91],['mod/assign/classes/event','submission_unlocked.php',78],['lib/classes/event','competency_user_competency_review_stopped.php',72],['lib/classes/event','course_module_viewed.php',62],['backup/util/plan','base_task.class.php',58],['question/classes/bank','delete_action_column.php',36]], 469],
'role_unassign_all': ['role_unassign_all', 'Removes multiple role assignments, parameters may contain: \'roleid\', \'userid\', \'contextid\', \'component\', \'enrolid\'. ', [['lib','accesslib.php',1803]], 45],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'get_buffer': ['get_buffer', 'Return internal text buffer. ', [['lib','weblib.php',3569]], 9],
'allow_unenrol_user': ['allow_unenrol_user', 'Does this plugin allow manual unenrolment of a specific user? All plugins allowing this must implement \'enrol/xxx:unenrol\' capability ', [['enrol/flatfile','lib.php',70],['lib','enrollib.php',1201],['enrol/cohort','lib.php',207],['enrol/database','lib.php',68],['enrol/meta','lib.php',81]], 12],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'can_delete_instance': ['can_delete_instance', 'Is it possible to delete enrol instance via standard UI? ', [['enrol/manual','lib.php',561],['enrol/flatfile','lib.php',98],['enrol/imsenterprise','lib.php',974],['lib','enrollib.php',1599],['enrol/self','lib.php',627],['enrol/ldap','lib.php',103],['enrol/cohort','lib.php',39],['enrol/category','lib.php',35],['enrol/database','lib.php',35],['enrol/lti','lib.php',47],['enrol/mnet','lib.php',92],['enrol/paypal','lib.php',438],['enrol/guest','lib.php',297],['enrol/meta','lib.php',217]], 6],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'enrol_is_enabled': ['enrol_is_enabled', 'Checks if a given plugin is in the list of enabled enrolment plugins. ', [['lib','enrollib.php',171]], 60],
'can_hide_show_instance': ['can_hide_show_instance', 'Is it possible to hide/show enrol instance via standard UI? ', [['enrol/manual','lib.php',572],['enrol/flatfile','lib.php',109],['enrol/imsenterprise','lib.php',985],['lib','enrollib.php',1609],['enrol/self','lib.php',638],['enrol/ldap','lib.php',127],['enrol/cohort','lib.php',337],['enrol/category','lib.php',56],['enrol/database','lib.php',57],['enrol/lti','lib.php',58],['enrol/mnet','lib.php',103],['enrol/paypal','lib.php',449],['enrol/guest','lib.php',308],['enrol/meta','lib.php',228]], 8],
'finished': ['finished', 'Called when the processing is finished. ', [['lib','weblib.php',3353],['lib','weblib.php',3461],['lib','weblib.php',3548],['lib','weblib.php',3614]], 56],
'set_mapping': ['set_mapping', 'To send ids pairs to backup_ids_table and to store them into paths ', [['backup/moodle2','restore_plugin.class.php',169],['backup/moodle2','restore_subplugin.class.php',101],['backup/util/plan','restore_structure_step.class.php',158]], 131],
'process_buffer': ['process_buffer', 'Process any future enrollments stored in the buffer. ', [['enrol/flatfile','lib.php',366],['admin/tool/monitor/classes','eventobservers.php',121],['lib/classes/message','manager.php',180]], 3],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'obfuscate_filepath': ['obfuscate_filepath', 'Sorry, we do not want to show paths in cron output. ', [['enrol/flatfile','lib.php',208]], 1],
'process_expirations': ['process_expirations', 'Do any enrolments need expiration processing. ', [['lib','enrollib.php',2055]], 4],
'message_send': ['message_send', 'Called when a message provider wants to send a message. This functions checks the message recipient\'s message processor configuration then sends the message to the configured processors ', [['lib','messagelib.php',29]], 94],
'add_instance': ['add_instance', 'Add new instance of enrol plugin. ', [['enrol/manual','lib.php',147],['lib','enrollib.php',1745],['enrol/self','lib.php',958],['enrol/cohort','lib.php',99],['mod/assign','locallib.php',600],['tag/classes','tag.php',543],['enrol/lti','lib.php',88],['enrol/paypal','lib.php',124],['enrol/guest','lib.php',247],['enrol/meta','lib.php',131]], 91],
'trim': ['trim', '', [], 1948],
'time': ['time', '', [], 1959],
'file_exists': ['file_exists', '', [], 867],
'count': ['count', '', [], 4095],
'strpos': ['strpos', '', [], 1604],
'file_get_contents': ['file_get_contents', '', [], 228],
'explode': ['explode', '', [], 1572],
'unlink': ['unlink', '', [], 256],
'strtolower': ['strtolower', '', [], 817],
'substr': ['substr', '', [], 2823],
'basename': ['basename', '', [], 153],
'defined': ['defined', '', [], 4731],
'reset': ['reset', '', [], 1213],
'str_replace': ['str_replace', '', [], 1648]};
CLASS_DATA={
'enrol_flatfile_plugin': ['enrol_flatfile_plugin', 'Flatfile enrolment plugin implementation. ', [['enrol/flatfile','lib.php',31]], 0],
'text_progress_trace': ['text_progress_trace', 'This subclass of progress_trace outputs to plain text. ', [['lib','weblib.php',3379]], 21],
'user_enrolment_action': ['user_enrolment_action', 'User enrolment action ', [['enrol','locallib.php',1344]], 13],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',238]], 3088],
'progress_trace_buffer': ['progress_trace_buffer', 'Special type of trace that can be used for catching of output of other traces. ', [['lib','weblib.php',3503]], 9],
'pix_icon': ['pix_icon', 'Data structure representing an icon. ', [['lib','outputcomponents.php',497]], 275],
'core_text': ['core_text', 'defines string api\'s for manipulating strings ', [['lib/classes','text.php',27]], 566],
'combined_progress_trace': ['combined_progress_trace', 'Special type of trace that can be used for redirecting to multiple other traces. ', [['lib','weblib.php',3578]], 2],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323],
'core_php_time_limit': ['core_php_time_limit', 'Utility class to manage PHP time limit. ', [['lib/classes','php_time_limit.php',27]], 92]};
CONST_DATA={
'ENROL_USER_ACTIVE': ['ENROL_USER_ACTIVE', '', [['lib','enrollib.php',37]], 210],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'ENROL_EXT_REMOVED_UNENROL': ['ENROL_EXT_REMOVED_UNENROL', '', [['lib','enrollib.php',49]], 57],
'ENROL_USER_SUSPENDED': ['ENROL_USER_SUSPENDED', '', [['lib','enrollib.php',40]], 105],
'ENROL_EXT_REMOVED_KEEP': ['ENROL_EXT_REMOVED_KEEP', '', [['lib','enrollib.php',52]], 29],
'FORMAT_PLAIN': ['FORMAT_PLAIN', '', [['lib','weblib.php',52]], 152],
'ENROL_EXT_REMOVED_SUSPENDNOROLES': ['ENROL_EXT_REMOVED_SUSPENDNOROLES', '', [['lib','enrollib.php',68]], 62],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'MEMORY_HUGE': ['MEMORY_HUGE', '', [['lib','setuplib.php',52]], 20]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
