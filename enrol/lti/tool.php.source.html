<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /enrol/lti/tool.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='enrol/lti';
filename='tool.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/enrol/lti/</a> -> <a href="tool.php.html">tool.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="tool.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="tool.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * The main entry point for the external system.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    enrol_lti</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright  2016 Mark Nelson &lt;markn@moodle.com&gt;</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  require_once(__DIR__ . '/../../config.php');
<a name="l26"><span class="linenum">  26</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../user/lib.php.html">/user/lib.php</a>');
<a name="l27"><span class="linenum">  27</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../enrol/lti/ims-blti/blti.php.html">/enrol/lti/ims-blti/blti.php</a>');
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <a class="var it3754" onMouseOver="hilite(3754)" onMouseOut="lolite()" onClick="logVariable('toolid')" href="../../_variables/toolid.html">$toolid</a> = <a class="function" onClick="logFunction('required_param')" href="../../_functions/required_param.html" onMouseOver="funcPopup(event,'required_param')">required_param</a>('id', <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>);
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment">// Get the tool.</span>
<a name="l32"><span class="linenum">  32</span></a>  <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a> = \enrol_lti\<a class="class" onClick="logClass('helper')" href="../../_classes/helper.html" onMouseOver="classPopup(event,'helper')">helper</a>::<a class="function" onClick="logFunction('get_lti_tool')" href="../../_functions/get_lti_tool.html" onMouseOver="funcPopup(event,'get_lti_tool')">get_lti_tool</a>(<a class="var it3754" onMouseOver="hilite(3754)" onMouseOut="lolite()" onClick="logVariable('toolid')" href="../../_variables/toolid.html">$toolid</a>);
<a name="l33"><span class="linenum">  33</span></a>  
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment">// Create the BLTI request.</span>
<a name="l35"><span class="linenum">  35</span></a>  <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a> = <span class="keyword">new </span><a class="class" onClick="logClass('BLTI')" href="../../_classes/blti.html" onMouseOver="classPopup(event,'blti')">BLTI</a>(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>-&gt;<a onClick="logVariable('secret')" class="var it43021" onMouseOver="hilite(43021)" onMouseOut="lolite()" href="../../_variables/secret.html">secret</a>, false, false);
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment">// Correct launch request.</span>
<a name="l38"><span class="linenum">  38</span></a>  if (<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('valid')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/valid.html">valid</a>) {
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">    // Check if the authentication plugin is disabled.</span>
<a name="l40"><span class="linenum">  40</span></a>      if (!<a class="function" onClick="logFunction('is_enabled_auth')" href="../../_functions/is_enabled_auth.html" onMouseOver="funcPopup(event,'is_enabled_auth')">is_enabled_auth</a>('lti')) {
<a name="l41"><span class="linenum">  41</span></a>          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('pluginnotenabled', 'auth', '', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', 'auth_lti'));
<a name="l42"><span class="linenum">  42</span></a>          exit();
<a name="l43"><span class="linenum">  43</span></a>      }
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">    // Check if the enrolment plugin is disabled.</span>
<a name="l46"><span class="linenum">  46</span></a>      if (!<a class="function" onClick="logFunction('enrol_is_enabled')" href="../../_functions/enrol_is_enabled.html" onMouseOver="funcPopup(event,'enrol_is_enabled')">enrol_is_enabled</a>('lti')) {
<a name="l47"><span class="linenum">  47</span></a>          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('enrolisdisabled', 'enrol_lti');
<a name="l48"><span class="linenum">  48</span></a>          exit();
<a name="l49"><span class="linenum">  49</span></a>      }
<a name="l50"><span class="linenum">  50</span></a>  
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment">    // Check if the enrolment instance is disabled.</span>
<a name="l52"><span class="linenum">  52</span></a>      if (<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>-&gt;<a onClick="logVariable('status')" class="var it43021" onMouseOver="hilite(43021)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> != <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>) {
<a name="l53"><span class="linenum">  53</span></a>          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('enrolisdisabled', 'enrol_lti');
<a name="l54"><span class="linenum">  54</span></a>          exit();
<a name="l55"><span class="linenum">  55</span></a>      }
<a name="l56"><span class="linenum">  56</span></a>  
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">    // Before we do anything check that the context is valid.</span>
<a name="l58"><span class="linenum">  58</span></a>      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>-&gt;<a onClick="logVariable('contextid')" class="var it43021" onMouseOver="hilite(43021)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>);
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">    // Set the user data.</span>
<a name="l61"><span class="linenum">  61</span></a>      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = new stdClass();
<a name="l62"><span class="linenum">  62</span></a>      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/username.html">username</a> = \enrol_lti\<a class="class" onClick="logClass('helper')" href="../../_classes/helper.html" onMouseOver="classPopup(event,'helper')">helper</a>::<a class="function" onClick="logFunction('create_username')" href="../../_functions/create_username.html" onMouseOver="funcPopup(event,'create_username')">create_username</a>(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['oauth_consumer_key'], <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['user_id']);
<a name="l63"><span class="linenum">  63</span></a>      if (!empty(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['lis_person_name_given'])) {
<a name="l64"><span class="linenum">  64</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstname')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['lis_person_name_given'];
<a name="l65"><span class="linenum">  65</span></a>      } else {
<a name="l66"><span class="linenum">  66</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('firstname')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['user_id'];
<a name="l67"><span class="linenum">  67</span></a>      }
<a name="l68"><span class="linenum">  68</span></a>      if (!empty(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['lis_person_name_family'])) {
<a name="l69"><span class="linenum">  69</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lastname')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/lastname.html">lastname</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['lis_person_name_family'];
<a name="l70"><span class="linenum">  70</span></a>      } else {
<a name="l71"><span class="linenum">  71</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lastname')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/lastname.html">lastname</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['context_id'];
<a name="l72"><span class="linenum">  72</span></a>      }
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/email.html">email</a> = \<a class="class" onClick="logClass('core_user')" href="../../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('clean_field')" href="../../_functions/clean_field.html" onMouseOver="funcPopup(event,'clean_field')">clean_field</a>(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a class="function" onClick="logFunction('getUserEmail')" href="../../_functions/getuseremail.html" onMouseOver="funcPopup(event,'getuseremail')">getUserEmail</a>(), 'email');
<a name="l75"><span class="linenum">  75</span></a>  
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">    // Get the user data from the LTI consumer.</span>
<a name="l77"><span class="linenum">  77</span></a>      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = \enrol_lti\<a class="class" onClick="logClass('helper')" href="../../_classes/helper.html" onMouseOver="classPopup(event,'helper')">helper</a>::<a class="function" onClick="logFunction('assign_user_tool_data')" href="../../_functions/assign_user_tool_data.html" onMouseOver="funcPopup(event,'assign_user_tool_data')">assign_user_tool_data</a>(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l78"><span class="linenum">  78</span></a>  
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">    // Check if the user exists.</span>
<a name="l80"><span class="linenum">  80</span></a>      if (!<a class="var it3458" onMouseOver="hilite(3458)" onMouseOut="lolite()" onClick="logVariable('dbuser')" href="../../_variables/dbuser.html">$dbuser</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('username' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, 'deleted' =&gt; 0))) {
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">        // If the email was stripped/not set then fill it with a default one. This</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment">        // stops the user from being redirected to edit their profile page.</span>
<a name="l83"><span class="linenum">  83</span></a>          if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/email.html">email</a>)) {
<a name="l84"><span class="linenum">  84</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/email.html">email</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/username.html">username</a> .  &quot;@example.com&quot;;
<a name="l85"><span class="linenum">  85</span></a>          }
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a> = 'lti';
<a name="l88"><span class="linenum">  88</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="function" onClick="logFunction('user_create_user')" href="../../_functions/user_create_user.html" onMouseOver="funcPopup(event,'user_create_user')">user_create_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l89"><span class="linenum">  89</span></a>  
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">        // Get the updated user record.</span>
<a name="l91"><span class="linenum">  91</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l92"><span class="linenum">  92</span></a>      } else {
<a name="l93"><span class="linenum">  93</span></a>          if (\enrol_lti\<a class="class" onClick="logClass('helper')" href="../../_classes/helper.html" onMouseOver="classPopup(event,'helper')">helper</a>::<a class="function" onClick="logFunction('user_match')" href="../../_functions/user_match.html" onMouseOver="funcPopup(event,'user_match')">user_match</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>, <a class="var it3458" onMouseOver="hilite(3458)" onMouseOut="lolite()" onClick="logVariable('dbuser')" href="../../_variables/dbuser.html">$dbuser</a>)) {
<a name="l94"><span class="linenum">  94</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it3458" onMouseOver="hilite(3458)" onMouseOut="lolite()" onClick="logVariable('dbuser')" href="../../_variables/dbuser.html">$dbuser</a>;
<a name="l95"><span class="linenum">  95</span></a>          } else {
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment">            // If email is empty remove it, so we don't update the user with an empty email.</span>
<a name="l97"><span class="linenum">  97</span></a>              if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/email.html">email</a>)) {
<a name="l98"><span class="linenum">  98</span></a>                  unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/email.html">email</a>);
<a name="l99"><span class="linenum">  99</span></a>              }
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it3458" onMouseOver="hilite(3458)" onMouseOut="lolite()" onClick="logVariable('dbuser')" href="../../_variables/dbuser.html">$dbuser</a>-&gt;<a onClick="logVariable('id')" class="var it43827" onMouseOver="hilite(43827)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l102"><span class="linenum"> 102</span></a>              <a class="function" onClick="logFunction('user_update_user')" href="../../_functions/user_update_user.html" onMouseOver="funcPopup(event,'user_update_user')">user_update_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment">            // Get the updated user record.</span>
<a name="l105"><span class="linenum"> 105</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l106"><span class="linenum"> 106</span></a>          }
<a name="l107"><span class="linenum"> 107</span></a>      }
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">    // Update user image.</span>
<a name="l110"><span class="linenum"> 110</span></a>      <a class="var it872" onMouseOver="hilite(872)" onMouseOut="lolite()" onClick="logVariable('image')" href="../../_variables/image.html">$image</a> = false;
<a name="l111"><span class="linenum"> 111</span></a>      if (!empty(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['user_image'])) {
<a name="l112"><span class="linenum"> 112</span></a>          <a class="var it872" onMouseOver="hilite(872)" onMouseOut="lolite()" onClick="logVariable('image')" href="../../_variables/image.html">$image</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['user_image'];
<a name="l113"><span class="linenum"> 113</span></a>      } else if (!empty(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['custom_user_image'])) {
<a name="l114"><span class="linenum"> 114</span></a>          <a class="var it872" onMouseOver="hilite(872)" onMouseOut="lolite()" onClick="logVariable('image')" href="../../_variables/image.html">$image</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['custom_user_image'];
<a name="l115"><span class="linenum"> 115</span></a>      }
<a name="l116"><span class="linenum"> 116</span></a>  
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">    // Check if there is an image to process.</span>
<a name="l118"><span class="linenum"> 118</span></a>      if (<a class="var it872" onMouseOver="hilite(872)" onMouseOut="lolite()" onClick="logVariable('image')" href="../../_variables/image.html">$image</a>) {
<a name="l119"><span class="linenum"> 119</span></a>          \enrol_lti\<a class="class" onClick="logClass('helper')" href="../../_classes/helper.html" onMouseOver="classPopup(event,'helper')">helper</a>::<a class="function" onClick="logFunction('update_user_profile_image')" href="../../_functions/update_user_profile_image.html" onMouseOver="funcPopup(event,'update_user_profile_image')">update_user_profile_image</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it872" onMouseOver="hilite(872)" onMouseOut="lolite()" onClick="logVariable('image')" href="../../_variables/image.html">$image</a>);
<a name="l120"><span class="linenum"> 120</span></a>      }
<a name="l121"><span class="linenum"> 121</span></a>  
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment">    // Check if we are an instructor.</span>
<a name="l123"><span class="linenum"> 123</span></a>      <a class="var it15817" onMouseOver="hilite(15817)" onMouseOut="lolite()" onClick="logVariable('isinstructor')" href="../../_variables/isinstructor.html">$isinstructor</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a class="function" onClick="logFunction('isInstructor')" href="../../_functions/isinstructor.html" onMouseOver="funcPopup(event,'isinstructor')">isInstructor</a>();
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>      if (<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>) {
<a name="l126"><span class="linenum"> 126</span></a>          <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/instanceid.html">instanceid</a>;
<a name="l127"><span class="linenum"> 127</span></a>          <a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../../_variables/urltogo.html">$urltogo</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../../course/view.php.html">/course/view.php</a>', array('id' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>));
<a name="l128"><span class="linenum"> 128</span></a>  
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">        // May still be set from previous session, so unset it.</span>
<a name="l130"><span class="linenum"> 130</span></a>          unset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('forcepagelayout')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/forcepagelayout.html">forcepagelayout</a>);
<a name="l131"><span class="linenum"> 131</span></a>      } else if (<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l132"><span class="linenum"> 132</span></a>          <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/instanceid.html">instanceid</a>;
<a name="l133"><span class="linenum"> 133</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>(false, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/instanceid.html">instanceid</a>, 0, false, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l134"><span class="linenum"> 134</span></a>          <a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../../_variables/urltogo.html">$urltogo</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/mod/' . <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('modname')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/modname.html">modname</a> . '/view.php', array('id' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l135"><span class="linenum"> 135</span></a>  
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">        // If we are a student in the course module context we do not want to display blocks.</span>
<a name="l137"><span class="linenum"> 137</span></a>          if (!<a class="var it15817" onMouseOver="hilite(15817)" onMouseOut="lolite()" onClick="logVariable('isinstructor')" href="../../_variables/isinstructor.html">$isinstructor</a>) {
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment">            // Force the page layout.</span>
<a name="l139"><span class="linenum"> 139</span></a>              <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('forcepagelayout')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/forcepagelayout.html">forcepagelayout</a> = 'embedded';
<a name="l140"><span class="linenum"> 140</span></a>          } else {
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment">            // May still be set from previous session, so unset it.</span>
<a name="l142"><span class="linenum"> 142</span></a>              unset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('forcepagelayout')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../_variables/forcepagelayout.html">forcepagelayout</a>);
<a name="l143"><span class="linenum"> 143</span></a>          }
<a name="l144"><span class="linenum"> 144</span></a>      } else {
<a name="l145"><span class="linenum"> 145</span></a>          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidcontext');
<a name="l146"><span class="linenum"> 146</span></a>          exit();
<a name="l147"><span class="linenum"> 147</span></a>      }
<a name="l148"><span class="linenum"> 148</span></a>  
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment">    // Enrol the user in the course with no role.</span>
<a name="l150"><span class="linenum"> 150</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = \enrol_lti\<a class="class" onClick="logClass('helper')" href="../../_classes/helper.html" onMouseOver="classPopup(event,'helper')">helper</a>::<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l151"><span class="linenum"> 151</span></a>  
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment">    // Display an error, if there is one.</span>
<a name="l153"><span class="linenum"> 153</span></a>      if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> !== \enrol_lti\<a class="class" onClick="logClass('helper')" href="../../_classes/helper.html" onMouseOver="classPopup(event,'helper')">helper</a>::ENROLMENT_SUCCESSFUL) {
<a name="l154"><span class="linenum"> 154</span></a>          <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>, 'enrol_lti');
<a name="l155"><span class="linenum"> 155</span></a>          exit();
<a name="l156"><span class="linenum"> 156</span></a>      }
<a name="l157"><span class="linenum"> 157</span></a>  
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">    // Give the user the role in the given context.</span>
<a name="l159"><span class="linenum"> 159</span></a>      <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a> = <a class="var it15817" onMouseOver="hilite(15817)" onMouseOut="lolite()" onClick="logVariable('isinstructor')" href="../../_variables/isinstructor.html">$isinstructor</a> ? <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>-&gt;<a onClick="logVariable('roleinstructor')" class="var it43021" onMouseOver="hilite(43021)" onMouseOut="lolite()" href="../../_variables/roleinstructor.html">roleinstructor</a> : <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>-&gt;<a onClick="logVariable('rolelearner')" class="var it43021" onMouseOver="hilite(43021)" onMouseOut="lolite()" href="../../_variables/rolelearner.html">rolelearner</a>;
<a name="l160"><span class="linenum"> 160</span></a>      <a class="function" onClick="logFunction('role_assign')" href="../../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>-&gt;<a onClick="logVariable('contextid')" class="var it43021" onMouseOver="hilite(43021)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>);
<a name="l161"><span class="linenum"> 161</span></a>  
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment">    // Login user.</span>
<a name="l163"><span class="linenum"> 163</span></a>      <a class="var it4766" onMouseOver="hilite(4766)" onMouseOut="lolite()" onClick="logVariable('sourceid')" href="../../_variables/sourceid.html">$sourceid</a> = (!empty(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['lis_result_sourcedid'])) ? <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['lis_result_sourcedid'] : '';
<a name="l164"><span class="linenum"> 164</span></a>      <a class="var it15821" onMouseOver="hilite(15821)" onMouseOut="lolite()" onClick="logVariable('serviceurl')" href="../../_variables/serviceurl.html">$serviceurl</a> = (!empty(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['lis_outcome_service_url'])) ? <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['lis_outcome_service_url'] : '';
<a name="l165"><span class="linenum"> 165</span></a>  
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">    // Check if we have recorded this user before.</span>
<a name="l167"><span class="linenum"> 167</span></a>      if (<a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('enrol_lti_users', array('toolid' =&gt; <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>-&gt;<a onClick="logVariable('id')" class="var it43021" onMouseOver="hilite(43021)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l168"><span class="linenum"> 168</span></a>          if (<a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('sourceid')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/sourceid.html">sourceid</a> != <a class="var it4766" onMouseOver="hilite(4766)" onMouseOut="lolite()" onClick="logVariable('sourceid')" href="../../_variables/sourceid.html">$sourceid</a>) {
<a name="l169"><span class="linenum"> 169</span></a>              <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('sourceid')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/sourceid.html">sourceid</a> = <a class="var it4766" onMouseOver="hilite(4766)" onMouseOut="lolite()" onClick="logVariable('sourceid')" href="../../_variables/sourceid.html">$sourceid</a>;
<a name="l170"><span class="linenum"> 170</span></a>          }
<a name="l171"><span class="linenum"> 171</span></a>          if (<a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('serviceurl')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/serviceurl.html">serviceurl</a> != <a class="var it15821" onMouseOver="hilite(15821)" onMouseOut="lolite()" onClick="logVariable('serviceurl')" href="../../_variables/serviceurl.html">$serviceurl</a>) {
<a name="l172"><span class="linenum"> 172</span></a>              <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('serviceurl')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/serviceurl.html">serviceurl</a> = <a class="var it15821" onMouseOver="hilite(15821)" onMouseOut="lolite()" onClick="logVariable('serviceurl')" href="../../_variables/serviceurl.html">$serviceurl</a>;
<a name="l173"><span class="linenum"> 173</span></a>          }
<a name="l174"><span class="linenum"> 174</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('lastaccess')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/lastaccess.html">lastaccess</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l175"><span class="linenum"> 175</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('enrol_lti_users', <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>);
<a name="l176"><span class="linenum"> 176</span></a>      } else {
<a name="l177"><span class="linenum"> 177</span></a>  <span class="comment">        // Add the user details so we can use it later when syncing grades and members.</span>
<a name="l178"><span class="linenum"> 178</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a> = new stdClass();
<a name="l179"><span class="linenum"> 179</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('userid')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l180"><span class="linenum"> 180</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('toolid')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/toolid.html">toolid</a> = <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>-&gt;<a onClick="logVariable('id')" class="var it43021" onMouseOver="hilite(43021)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l181"><span class="linenum"> 181</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('serviceurl')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/serviceurl.html">serviceurl</a> = <a class="var it15821" onMouseOver="hilite(15821)" onMouseOut="lolite()" onClick="logVariable('serviceurl')" href="../../_variables/serviceurl.html">$serviceurl</a>;
<a name="l182"><span class="linenum"> 182</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('sourceid')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/sourceid.html">sourceid</a> = <a class="var it4766" onMouseOver="hilite(4766)" onMouseOut="lolite()" onClick="logVariable('sourceid')" href="../../_variables/sourceid.html">$sourceid</a>;
<a name="l183"><span class="linenum"> 183</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('consumerkey')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/consumerkey.html">consumerkey</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['oauth_consumer_key'];
<a name="l184"><span class="linenum"> 184</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('consumersecret')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/consumersecret.html">consumersecret</a> = <a class="var it3113" onMouseOver="hilite(3113)" onMouseOut="lolite()" onClick="logVariable('tool')" href="../../_variables/tool.html">$tool</a>-&gt;<a onClick="logVariable('secret')" class="var it43021" onMouseOver="hilite(43021)" onMouseOut="lolite()" href="../../_variables/secret.html">secret</a>;
<a name="l185"><span class="linenum"> 185</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('lastgrade')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/lastgrade.html">lastgrade</a> = 0;
<a name="l186"><span class="linenum"> 186</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('lastaccess')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/lastaccess.html">lastaccess</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l187"><span class="linenum"> 187</span></a>          <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l188"><span class="linenum"> 188</span></a>  
<a name="l189"><span class="linenum"> 189</span></a>          if (!empty(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['ext_ims_lis_memberships_url'])) {
<a name="l190"><span class="linenum"> 190</span></a>              <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('membershipsurl')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/membershipsurl.html">membershipsurl</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['ext_ims_lis_memberships_url'];
<a name="l191"><span class="linenum"> 191</span></a>          } else {
<a name="l192"><span class="linenum"> 192</span></a>              <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('membershipsurl')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/membershipsurl.html">membershipsurl</a> = '';
<a name="l193"><span class="linenum"> 193</span></a>          }
<a name="l194"><span class="linenum"> 194</span></a>  
<a name="l195"><span class="linenum"> 195</span></a>          if (!empty(<a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['ext_ims_lis_memberships_id'])) {
<a name="l196"><span class="linenum"> 196</span></a>              <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('membershipsid')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/membershipsid.html">membershipsid</a> = <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('info')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/info.html">info</a>['ext_ims_lis_memberships_id'];
<a name="l197"><span class="linenum"> 197</span></a>          } else {
<a name="l198"><span class="linenum"> 198</span></a>              <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>-&gt;<a onClick="logVariable('membershipsid')" class="var it43875" onMouseOver="hilite(43875)" onMouseOut="lolite()" href="../../_variables/membershipsid.html">membershipsid</a> = '';
<a name="l199"><span class="linenum"> 199</span></a>          }
<a name="l200"><span class="linenum"> 200</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('enrol_lti_users', <a class="var it15822" onMouseOver="hilite(15822)" onMouseOut="lolite()" onClick="logVariable('userlog')" href="../../_variables/userlog.html">$userlog</a>);
<a name="l201"><span class="linenum"> 201</span></a>      }
<a name="l202"><span class="linenum"> 202</span></a>  
<a name="l203"><span class="linenum"> 203</span></a>  <span class="comment">    // Finalise the user log in.</span>
<a name="l204"><span class="linenum"> 204</span></a>      <a class="function" onClick="logFunction('complete_user_login')" href="../../_functions/complete_user_login.html" onMouseOver="funcPopup(event,'complete_user_login')">complete_user_login</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l205"><span class="linenum"> 205</span></a>  
<a name="l206"><span class="linenum"> 206</span></a>      if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('allowframembedding')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/allowframembedding.html">allowframembedding</a>)) {
<a name="l207"><span class="linenum"> 207</span></a>  <span class="comment">        // Provide an alternative link.</span>
<a name="l208"><span class="linenum"> 208</span></a>          <a class="var it15829" onMouseOver="hilite(15829)" onMouseOut="lolite()" onClick="logVariable('stropentool')" href="../../_variables/stropentool.html">$stropentool</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('opentool', 'enrol_lti');
<a name="l209"><span class="linenum"> 209</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('p', <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('frameembeddingnotenabled', 'enrol_lti'));
<a name="l210"><span class="linenum"> 210</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="phpfunction" onClick="logFunction('link')" href="../../_functions/link.html" onMouseOver="phpfuncPopup(event,'link')">link</a>(<a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../../_variables/urltogo.html">$urltogo</a>, <a class="var it15829" onMouseOver="hilite(15829)" onMouseOut="lolite()" onClick="logVariable('stropentool')" href="../../_variables/stropentool.html">$stropentool</a>, array('target' =&gt; '_blank'));
<a name="l211"><span class="linenum"> 211</span></a>      } else {
<a name="l212"><span class="linenum"> 212</span></a>  <span class="comment">        // All done, redirect the user to where they want to go.</span>
<a name="l213"><span class="linenum"> 213</span></a>          <a class="function" onClick="logFunction('redirect')" href="../../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../../_variables/urltogo.html">$urltogo</a>);
<a name="l214"><span class="linenum"> 214</span></a>      }
<a name="l215"><span class="linenum"> 215</span></a>  } else {
<a name="l216"><span class="linenum"> 216</span></a>      echo <a class="var it15816" onMouseOver="hilite(15816)" onMouseOut="lolite()" onClick="logVariable('ltirequest')" href="../../_variables/ltirequest.html">$ltirequest</a>-&gt;<a onClick="logVariable('message')" class="var it43874" onMouseOver="hilite(43874)" onMouseOut="lolite()" href="../../_variables/message.html">message</a>;
<a name="l217"><span class="linenum"> 217</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'tag': ['tag', 'Outputs a tag with attributes and contents ', [['lib','outputcomponents.php',1073]], 1292],
'user_match': ['user_match', 'Compares two users. ', [['enrol/lti/classes','helper.php',127]], 1],
'isinstructor': ['isinstructor', '', [['enrol/lti/ims-blti','blti.php',136]], 4],
'instance_by_id': ['instance_by_id', 'Get a context instance as an object, from a given context id. ', [['lib','accesslib.php',5434]], 235],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'user_update_user': ['user_update_user', 'Update a user with a user object (will compare against the ID) ', [['user','lib.php',121]], 31],
'getuseremail': ['getuseremail', '', [['enrol/lti/ims-blti','blti.php',144],['lib/google/src/Google/Service','Bigquery.php',1655],['lib/google/src/Google/Service','Bigquery.php',2355],['lib/google/src/Google/Service','Clouddebugger.php',599],['lib/google/src/Google/Service','Reports.php',946]], 6],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'assign_user_tool_data': ['assign_user_tool_data', 'Adds default values for the user object based on the tool provided. ', [['enrol/lti/classes','helper.php',99]], 2],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'is_enabled_auth': ['is_enabled_auth', 'Checks if a given plugin is in the list of enabled authentication plugins. ', [['lib','moodlelib.php',3592]], 38],
'required_param': ['required_param', 'Returns a particular value for the named variable, taken from POST or GET.  If the parameter doesn\'t exist then an error is thrown because we require this variable. ', [['lib','moodlelib.php',525]], 815],
'complete_user_login': ['complete_user_login', 'Call to complete the user login process after authenticate_user_login() has succeeded. It will setup the $USER variable and other required bits and pieces. ', [['lib','moodlelib.php',4292]], 11],
'update_user_profile_image': ['update_user_profile_image', 'Updates the users profile image. ', [['enrol/lti/classes','helper.php',172]], 3],
'get_lti_tool': ['get_lti_tool', 'Returns the LTI tool. ', [['enrol/lti/classes','helper.php',281]], 4],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',481]], 1488],
'user_create_user': ['user_create_user', 'Creates a user ', [['user','lib.php',25]], 15],
'create_username': ['create_username', 'Creates a unique username. ', [['enrol/lti/classes','helper.php',82]], 2],
'enrol_user': ['enrol_user', 'Enrol user into course via enrol instance. ', [['enrol/flatfile','lib.php',144],['lib','enrollib.php',1270],['lib/testing/generator','data_generator.php',891],['enrol/lti/classes','helper.php',233],['enrol/self','externallib.php',122],['enrol/mnet','enrol.php',115],['enrol/guest','lib.php',60]], 745],
'clean_field': ['clean_field', 'Clean a specific user field. ', [['lib/classes','user.php',519]], 26],
'enrol_is_enabled': ['enrol_is_enabled', 'Checks if a given plugin is in the list of enabled enrolment plugins. ', [['lib','enrollib.php',171]], 60],
'role_assign': ['role_assign', 'Assigns the specified role to a user in the context. ', [['lib/testing/generator','data_generator.php',936],['lib','accesslib.php',1661]], 269],
'get_coursemodule_from_id': ['get_coursemodule_from_id', 'Given an id of a course module, finds the coursemodule description ', [['lib','datalib.php',1238]], 212],
'redirect': ['redirect', '', [['enrol/lti/ims-blti','blti.php',230],['lib','weblib.php',2659]], 999],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'time': ['time', '', [], 1959],
'link': ['link', '', [], 695]};
CLASS_DATA={
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',238]], 3088],
'blti': ['blti', '', [['enrol/lti/ims-blti','blti.php',18]], 1],
'core_user': ['core_user', 'User class to access user details. ', [['lib/classes','user.php',27]], 457],
'html_writer': ['html_writer', 'Simple html output class ', [['lib','outputcomponents.php',1062]], 5120],
'helper': ['helper', 'Helper class locally used. ', [['admin/tool/log/store/database/classes','helper.php',29],['course/classes/management','helper.php',29],['enrol/lti/classes','helper.php',29],['grade/report/history/classes','helper.php',29]], 180]};
CONST_DATA={
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 466],
'ENROL_INSTANCE_ENABLED': ['ENROL_INSTANCE_ENABLED', '', [['lib','enrollib.php',31]], 115],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'PARAM_INT': ['PARAM_INT', '', [['lib','moodlelib.php',156]], 3812],
'CONTEXT_COURSE': ['CONTEXT_COURSE', '', [['lib','accesslib.php',148]], 441]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
