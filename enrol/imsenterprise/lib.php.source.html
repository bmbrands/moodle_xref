<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /enrol/imsenterprise/lib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='enrol/imsenterprise';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/enrol/imsenterprise/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * IMS Enterprise file enrolment plugin.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * This plugin lets the user specify an IMS Enterprise file to be processed.</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * The IMS Enterprise file is mainly parsed on a regular cron,</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * but can also be imported via the UI (Admin Settings).</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @package    enrol_imsenterprise</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @copyright  2010 Eugene Venter</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @author     Eugene Venter - based on code by Dan Stowell</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> */</span>
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../group/lib.php.html">/group/lib.php</a>');
<a name="l32"><span class="linenum">  32</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../lib/coursecatlib.php.html">/lib/coursecatlib.php</a>');
<a name="l33"><span class="linenum">  33</span></a>  
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment">/**</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * IMS Enterprise file enrolment plugin.</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> *</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @copyright  2010 Eugene Venter</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> */</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('enrol_imsenterprise_plugin')" href="../../_classes/enrol_imsenterprise_plugin.html" onMouseOver="classPopup(event,'enrol_imsenterprise_plugin')">enrol_imsenterprise_plugin</a> extends enrol_plugin {
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>      <span class="comment">/**</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">     * @var IMSENTERPRISE_ADD imsenterprise add action.</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment">     */</span>
<a name="l45"><span class="linenum">  45</span></a>      const IMSENTERPRISE_ADD = 1;
<a name="l46"><span class="linenum">  46</span></a>  
<a name="l47"><span class="linenum">  47</span></a>      <span class="comment">/**</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">     * @var IMSENTERPRISE_UPDATE imsenterprise update action.</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">     */</span>
<a name="l50"><span class="linenum">  50</span></a>      const IMSENTERPRISE_UPDATE = 2;
<a name="l51"><span class="linenum">  51</span></a>  
<a name="l52"><span class="linenum">  52</span></a>      <span class="comment">/**</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">     * @var IMSENTERPRISE_DELETE imsenterprise delete action.</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     */</span>
<a name="l55"><span class="linenum">  55</span></a>      const IMSENTERPRISE_DELETE = 3;
<a name="l56"><span class="linenum">  56</span></a>  
<a name="l57"><span class="linenum">  57</span></a>      <span class="comment">/**</span>
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment">     * @var $logfp resource file pointer for writing log data to.</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment">     */</span>
<a name="l60"><span class="linenum">  60</span></a>      protected <a class="var it16134" onMouseOver="hilite(16134)" onMouseOut="lolite()" onClick="logVariable('logfp')" href="../../_variables/logfp.html">$logfp</a>;
<a name="l61"><span class="linenum">  61</span></a>  
<a name="l62"><span class="linenum">  62</span></a>      <span class="comment">/**</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">     * @var $continueprocessing bool flag to determine if processing should continue.</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">     */</span>
<a name="l65"><span class="linenum">  65</span></a>      protected <a class="var it16135" onMouseOver="hilite(16135)" onMouseOut="lolite()" onClick="logVariable('continueprocessing')" href="../../_variables/continueprocessing.html">$continueprocessing</a>;
<a name="l66"><span class="linenum">  66</span></a>  
<a name="l67"><span class="linenum">  67</span></a>      <span class="comment">/**</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">     * @var $xmlcache string cache of xml lines.</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment">     */</span>
<a name="l70"><span class="linenum">  70</span></a>      protected <a class="var it16136" onMouseOver="hilite(16136)" onMouseOut="lolite()" onClick="logVariable('xmlcache')" href="../../_variables/xmlcache.html">$xmlcache</a>;
<a name="l71"><span class="linenum">  71</span></a>  
<a name="l72"><span class="linenum">  72</span></a>      <span class="comment">/**</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment">     * @var $coursemappings array of mappings between IMS data fields and moodle course fields.</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">     */</span>
<a name="l75"><span class="linenum">  75</span></a>      protected <a class="var it16137" onMouseOver="hilite(16137)" onMouseOut="lolite()" onClick="logVariable('coursemappings')" href="../../_variables/coursemappings.html">$coursemappings</a>;
<a name="l76"><span class="linenum">  76</span></a>  
<a name="l77"><span class="linenum">  77</span></a>      <span class="comment">/**</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">     * @var $rolemappings array of mappings between IMS roles and moodle roles.</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">     */</span>
<a name="l80"><span class="linenum">  80</span></a>      protected <a class="var it6034" onMouseOver="hilite(6034)" onMouseOut="lolite()" onClick="logVariable('rolemappings')" href="../../_variables/rolemappings.html">$rolemappings</a>;
<a name="l81"><span class="linenum">  81</span></a>  
<a name="l82"><span class="linenum">  82</span></a>      <span class="comment">/**</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">     * @var $defaultcategoryid id of default category.</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment">     */</span>
<a name="l85"><span class="linenum">  85</span></a>      protected <a class="var it16138" onMouseOver="hilite(16138)" onMouseOut="lolite()" onClick="logVariable('defaultcategoryid')" href="../../_variables/defaultcategoryid.html">$defaultcategoryid</a>;
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>      <span class="comment">/**</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">     * Read in an IMS Enterprise file.</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">     * Originally designed to handle v1.1 files but should be able to handle</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">     * earlier types as well, I believe.</span>
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment">     * This cron feature has been converted to a scheduled task and it can now be scheduled</span>
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">     * from the UI.</span>
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">     */</span>
<a name="l94"><span class="linenum">  94</span></a>      public function <a class="function" onClick="logFunction('cron')" href="../../_functions/cron.html" onMouseOver="funcPopup(event,'cron')">cron</a>() {
<a name="l95"><span class="linenum">  95</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l96"><span class="linenum">  96</span></a>  
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">        // Get configs.</span>
<a name="l98"><span class="linenum">  98</span></a>          <a class="var it16139" onMouseOver="hilite(16139)" onMouseOut="lolite()" onClick="logVariable('imsfilelocation')" href="../../_variables/imsfilelocation.html">$imsfilelocation</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('imsfilelocation');
<a name="l99"><span class="linenum">  99</span></a>          <a class="var it16140" onMouseOver="hilite(16140)" onMouseOut="lolite()" onClick="logVariable('logtolocation')" href="../../_variables/logtolocation.html">$logtolocation</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('logtolocation');
<a name="l100"><span class="linenum"> 100</span></a>          <a class="var it14808" onMouseOver="hilite(14808)" onMouseOut="lolite()" onClick="logVariable('mailadmins')" href="../../_variables/mailadmins.html">$mailadmins</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('mailadmins');
<a name="l101"><span class="linenum"> 101</span></a>          <a class="var it16141" onMouseOver="hilite(16141)" onMouseOut="lolite()" onClick="logVariable('prevtime')" href="../../_variables/prevtime.html">$prevtime</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('prev_time');
<a name="l102"><span class="linenum"> 102</span></a>          <a class="var it16142" onMouseOver="hilite(16142)" onMouseOut="lolite()" onClick="logVariable('prevmd5')" href="../../_variables/prevmd5.html">$prevmd5</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('prev_md5');
<a name="l103"><span class="linenum"> 103</span></a>          <a class="var it16143" onMouseOver="hilite(16143)" onMouseOut="lolite()" onClick="logVariable('prevpath')" href="../../_variables/prevpath.html">$prevpath</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('prev_path');
<a name="l104"><span class="linenum"> 104</span></a>  
<a name="l105"><span class="linenum"> 105</span></a>          if (empty(<a class="var it16139" onMouseOver="hilite(16139)" onMouseOut="lolite()" onClick="logVariable('imsfilelocation')" href="../../_variables/imsfilelocation.html">$imsfilelocation</a>)) {
<a name="l106"><span class="linenum"> 106</span></a>              <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dataroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dataroot.html">dataroot</a>/1/imsenterprise-enrol.xml&quot;;  <span class="comment">// Default location.</span>
<a name="l107"><span class="linenum"> 107</span></a>          } else {
<a name="l108"><span class="linenum"> 108</span></a>              <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="var it16139" onMouseOver="hilite(16139)" onMouseOut="lolite()" onClick="logVariable('imsfilelocation')" href="../../_variables/imsfilelocation.html">$imsfilelocation</a>;
<a name="l109"><span class="linenum"> 109</span></a>          }
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('logfp')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/logfp.html">logfp</a> = false;
<a name="l112"><span class="linenum"> 112</span></a>          if (!empty(<a class="var it16140" onMouseOver="hilite(16140)" onMouseOut="lolite()" onClick="logVariable('logtolocation')" href="../../_variables/logtolocation.html">$logtolocation</a>)) {
<a name="l113"><span class="linenum"> 113</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('logfp')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/logfp.html">logfp</a> = <a class="function" onClick="logFunction('fopen')" href="../../_functions/fopen.html" onMouseOver="funcPopup(event,'fopen')">fopen</a>(<a class="var it16140" onMouseOver="hilite(16140)" onMouseOut="lolite()" onClick="logVariable('logtolocation')" href="../../_variables/logtolocation.html">$logtolocation</a>, 'a');
<a name="l114"><span class="linenum"> 114</span></a>          }
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('defaultcategoryid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/defaultcategoryid.html">defaultcategoryid</a> = null;
<a name="l117"><span class="linenum"> 117</span></a>  
<a name="l118"><span class="linenum"> 118</span></a>          <a class="var it16144" onMouseOver="hilite(16144)" onMouseOut="lolite()" onClick="logVariable('fileisnew')" href="../../_variables/fileisnew.html">$fileisnew</a> = false;
<a name="l119"><span class="linenum"> 119</span></a>          if ( <a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) ) {
<a name="l120"><span class="linenum"> 120</span></a>              <a class="class" onClick="logClass('core_php_time_limit')" href="../../_classes/core_php_time_limit.html" onMouseOver="classPopup(event,'core_php_time_limit')">core_php_time_limit</a>::<a class="function" onClick="logFunction('raise')" href="../../_functions/raise.html" onMouseOver="funcPopup(event,'raise')">raise</a>();
<a name="l121"><span class="linenum"> 121</span></a>              <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('starttime')" href="../../_variables/starttime.html">$starttime</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l122"><span class="linenum"> 122</span></a>  
<a name="l123"><span class="linenum"> 123</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('----------------------------------------------------------------------');
<a name="l124"><span class="linenum"> 124</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;IMS Enterprise enrol cron process launched at &quot; . <a class="function" onClick="logFunction('userdate')" href="../../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()));
<a name="l125"><span class="linenum"> 125</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('Found file '.<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l126"><span class="linenum"> 126</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('xmlcache')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/xmlcache.html">xmlcache</a> = '';
<a name="l127"><span class="linenum"> 127</span></a>  
<a name="l128"><span class="linenum"> 128</span></a>              <a class="var it16145" onMouseOver="hilite(16145)" onMouseOut="lolite()" onClick="logVariable('categoryseparator')" href="../../_variables/categoryseparator.html">$categoryseparator</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('categoryseparator'));
<a name="l129"><span class="linenum"> 129</span></a>              <a class="var it16146" onMouseOver="hilite(16146)" onMouseOut="lolite()" onClick="logVariable('categoryidnumber')" href="../../_variables/categoryidnumber.html">$categoryidnumber</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('categoryidnumber');
<a name="l130"><span class="linenum"> 130</span></a>  
<a name="l131"><span class="linenum"> 131</span></a>  <span class="comment">            // Make sure we understand how to map the IMS-E roles to Moodle roles.</span>
<a name="l132"><span class="linenum"> 132</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_role_mappings')" href="../../_functions/load_role_mappings.html" onMouseOver="funcPopup(event,'load_role_mappings')">load_role_mappings</a>();
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">            // Make sure we understand how to map the IMS-E course names to Moodle course names.</span>
<a name="l134"><span class="linenum"> 134</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_course_mappings')" href="../../_functions/load_course_mappings.html" onMouseOver="funcPopup(event,'load_course_mappings')">load_course_mappings</a>();
<a name="l135"><span class="linenum"> 135</span></a>  
<a name="l136"><span class="linenum"> 136</span></a>              <a class="var it3167" onMouseOver="hilite(3167)" onMouseOut="lolite()" onClick="logVariable('md5')" href="../../_variables/md5.html">$md5</a> = md5_file(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>); <span class="comment">// NB We'll write this value back to the database at the end of the cron.</span>
<a name="l137"><span class="linenum"> 137</span></a>              <a class="var it15634" onMouseOver="hilite(15634)" onMouseOut="lolite()" onClick="logVariable('filemtime')" href="../../_variables/filemtime.html">$filemtime</a> = <a class="phpfunction" onClick="logFunction('filemtime')" href="../../_functions/filemtime.html" onMouseOver="phpfuncPopup(event,'filemtime')">filemtime</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l138"><span class="linenum"> 138</span></a>  
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment">            // Decide if we want to process the file (based on filepath, modification time, and MD5 hash)</span>
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">            // This is so we avoid wasting the server's efforts processing a file unnecessarily.</span>
<a name="l141"><span class="linenum"> 141</span></a>              if (<a class="var it16146" onMouseOver="hilite(16146)" onMouseOut="lolite()" onClick="logVariable('categoryidnumber')" href="../../_variables/categoryidnumber.html">$categoryidnumber</a> &amp;&amp; empty(<a class="var it16145" onMouseOver="hilite(16145)" onMouseOut="lolite()" onClick="logVariable('categoryseparator')" href="../../_variables/categoryseparator.html">$categoryseparator</a>)) {
<a name="l142"><span class="linenum"> 142</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('Category idnumber is enabled but category separator is not defined - skipping processing.');
<a name="l143"><span class="linenum"> 143</span></a>              } else if (empty(<a class="var it16143" onMouseOver="hilite(16143)" onMouseOut="lolite()" onClick="logVariable('prevpath')" href="../../_variables/prevpath.html">$prevpath</a>)  || (<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> != <a class="var it16143" onMouseOver="hilite(16143)" onMouseOut="lolite()" onClick="logVariable('prevpath')" href="../../_variables/prevpath.html">$prevpath</a>)) {
<a name="l144"><span class="linenum"> 144</span></a>                  <a class="var it16144" onMouseOver="hilite(16144)" onMouseOut="lolite()" onClick="logVariable('fileisnew')" href="../../_variables/fileisnew.html">$fileisnew</a> = true;
<a name="l145"><span class="linenum"> 145</span></a>              } else if (isset(<a class="var it16141" onMouseOver="hilite(16141)" onMouseOut="lolite()" onClick="logVariable('prevtime')" href="../../_variables/prevtime.html">$prevtime</a>) &amp;&amp; (<a class="var it15634" onMouseOver="hilite(15634)" onMouseOut="lolite()" onClick="logVariable('filemtime')" href="../../_variables/filemtime.html">$filemtime</a> &lt;= <a class="var it16141" onMouseOver="hilite(16141)" onMouseOut="lolite()" onClick="logVariable('prevtime')" href="../../_variables/prevtime.html">$prevtime</a>)) {
<a name="l146"><span class="linenum"> 146</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('File modification time is not more recent than last update - skipping processing.');
<a name="l147"><span class="linenum"> 147</span></a>              } else if (isset(<a class="var it16142" onMouseOver="hilite(16142)" onMouseOut="lolite()" onClick="logVariable('prevmd5')" href="../../_variables/prevmd5.html">$prevmd5</a>) &amp;&amp; (<a class="var it3167" onMouseOver="hilite(3167)" onMouseOut="lolite()" onClick="logVariable('md5')" href="../../_variables/md5.html">$md5</a> == <a class="var it16142" onMouseOver="hilite(16142)" onMouseOut="lolite()" onClick="logVariable('prevmd5')" href="../../_variables/prevmd5.html">$prevmd5</a>)) {
<a name="l148"><span class="linenum"> 148</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('File MD5 hash is same as on last update - skipping processing.');
<a name="l149"><span class="linenum"> 149</span></a>              } else {
<a name="l150"><span class="linenum"> 150</span></a>                  <a class="var it16144" onMouseOver="hilite(16144)" onMouseOut="lolite()" onClick="logVariable('fileisnew')" href="../../_variables/fileisnew.html">$fileisnew</a> = true; <span class="comment">// Let's process it!</span>
<a name="l151"><span class="linenum"> 151</span></a>              }
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>              if (<a class="var it16144" onMouseOver="hilite(16144)" onMouseOut="lolite()" onClick="logVariable('fileisnew')" href="../../_variables/fileisnew.html">$fileisnew</a>) {
<a name="l154"><span class="linenum"> 154</span></a>  
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">                // The &lt;properties&gt; tag is allowed to halt processing if we're demanding a matching target.</span>
<a name="l156"><span class="linenum"> 156</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('continueprocessing')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/continueprocessing.html">continueprocessing</a> = true;
<a name="l157"><span class="linenum"> 157</span></a>  
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">                // Run through the file and process the group/person entries.</span>
<a name="l159"><span class="linenum"> 159</span></a>                  if ((<a class="var it2039" onMouseOver="hilite(2039)" onMouseOut="lolite()" onClick="logVariable('fh')" href="../../_variables/fh.html">$fh</a> = <a class="function" onClick="logFunction('fopen')" href="../../_functions/fopen.html" onMouseOver="funcPopup(event,'fopen')">fopen</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>, &quot;r&quot;)) != false) {
<a name="l160"><span class="linenum"> 160</span></a>  
<a name="l161"><span class="linenum"> 161</span></a>                      <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a> = 0;
<a name="l162"><span class="linenum"> 162</span></a>                      while ((!<a class="phpfunction" onClick="logFunction('feof')" href="../../_functions/feof.html" onMouseOver="phpfuncPopup(event,'feof')">feof</a>(<a class="var it2039" onMouseOver="hilite(2039)" onMouseOut="lolite()" onClick="logVariable('fh')" href="../../_variables/fh.html">$fh</a>)) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('continueprocessing')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/continueprocessing.html">continueprocessing</a>) {
<a name="l163"><span class="linenum"> 163</span></a>  
<a name="l164"><span class="linenum"> 164</span></a>                          <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../_variables/line.html">$line</a>++;
<a name="l165"><span class="linenum"> 165</span></a>                          <a class="var it16147" onMouseOver="hilite(16147)" onMouseOut="lolite()" onClick="logVariable('curline')" href="../../_variables/curline.html">$curline</a> = <a class="phpfunction" onClick="logFunction('fgets')" href="../../_functions/fgets.html" onMouseOver="phpfuncPopup(event,'fgets')">fgets</a>(<a class="var it2039" onMouseOver="hilite(2039)" onMouseOut="lolite()" onClick="logVariable('fh')" href="../../_variables/fh.html">$fh</a>);
<a name="l166"><span class="linenum"> 166</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('xmlcache')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/xmlcache.html">xmlcache</a> .= <a class="var it16147" onMouseOver="hilite(16147)" onMouseOut="lolite()" onClick="logVariable('curline')" href="../../_variables/curline.html">$curline</a>; <span class="comment">// Add a line onto the XML cache.</span>
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>                          while (true) {
<a name="l169"><span class="linenum"> 169</span></a>  <span class="comment">                            // If we've got a full tag (i.e. the most recent line has closed the tag) then process-it-and-forget-it.</span>
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment">                            // Must always make sure to remove tags from cache so they don't clog up our memory.</span>
<a name="l171"><span class="linenum"> 171</span></a>                              if (<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('full_tag_found_in_cache')" href="../../_functions/full_tag_found_in_cache.html" onMouseOver="funcPopup(event,'full_tag_found_in_cache')">full_tag_found_in_cache</a>('group', <a class="var it16147" onMouseOver="hilite(16147)" onMouseOut="lolite()" onClick="logVariable('curline')" href="../../_variables/curline.html">$curline</a>)) {
<a name="l172"><span class="linenum"> 172</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_group_tag')" href="../../_functions/process_group_tag.html" onMouseOver="funcPopup(event,'process_group_tag')">process_group_tag</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>);
<a name="l173"><span class="linenum"> 173</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('remove_tag_from_cache')" href="../../_functions/remove_tag_from_cache.html" onMouseOver="funcPopup(event,'remove_tag_from_cache')">remove_tag_from_cache</a>('group');
<a name="l174"><span class="linenum"> 174</span></a>                              } else if (<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('full_tag_found_in_cache')" href="../../_functions/full_tag_found_in_cache.html" onMouseOver="funcPopup(event,'full_tag_found_in_cache')">full_tag_found_in_cache</a>('person', <a class="var it16147" onMouseOver="hilite(16147)" onMouseOut="lolite()" onClick="logVariable('curline')" href="../../_variables/curline.html">$curline</a>)) {
<a name="l175"><span class="linenum"> 175</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_person_tag')" href="../../_functions/process_person_tag.html" onMouseOver="funcPopup(event,'process_person_tag')">process_person_tag</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>);
<a name="l176"><span class="linenum"> 176</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('remove_tag_from_cache')" href="../../_functions/remove_tag_from_cache.html" onMouseOver="funcPopup(event,'remove_tag_from_cache')">remove_tag_from_cache</a>('person');
<a name="l177"><span class="linenum"> 177</span></a>                              } else if (<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('full_tag_found_in_cache')" href="../../_functions/full_tag_found_in_cache.html" onMouseOver="funcPopup(event,'full_tag_found_in_cache')">full_tag_found_in_cache</a>('membership', <a class="var it16147" onMouseOver="hilite(16147)" onMouseOut="lolite()" onClick="logVariable('curline')" href="../../_variables/curline.html">$curline</a>)) {
<a name="l178"><span class="linenum"> 178</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_membership_tag')" href="../../_functions/process_membership_tag.html" onMouseOver="funcPopup(event,'process_membership_tag')">process_membership_tag</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>);
<a name="l179"><span class="linenum"> 179</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('remove_tag_from_cache')" href="../../_functions/remove_tag_from_cache.html" onMouseOver="funcPopup(event,'remove_tag_from_cache')">remove_tag_from_cache</a>('membership');
<a name="l180"><span class="linenum"> 180</span></a>                              } else if (<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('full_tag_found_in_cache')" href="../../_functions/full_tag_found_in_cache.html" onMouseOver="funcPopup(event,'full_tag_found_in_cache')">full_tag_found_in_cache</a>('comments', <a class="var it16147" onMouseOver="hilite(16147)" onMouseOut="lolite()" onClick="logVariable('curline')" href="../../_variables/curline.html">$curline</a>)) {
<a name="l181"><span class="linenum"> 181</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('remove_tag_from_cache')" href="../../_functions/remove_tag_from_cache.html" onMouseOver="funcPopup(event,'remove_tag_from_cache')">remove_tag_from_cache</a>('comments');
<a name="l182"><span class="linenum"> 182</span></a>                              } else if (<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('full_tag_found_in_cache')" href="../../_functions/full_tag_found_in_cache.html" onMouseOver="funcPopup(event,'full_tag_found_in_cache')">full_tag_found_in_cache</a>('properties', <a class="var it16147" onMouseOver="hilite(16147)" onMouseOut="lolite()" onClick="logVariable('curline')" href="../../_variables/curline.html">$curline</a>)) {
<a name="l183"><span class="linenum"> 183</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('process_properties_tag')" href="../../_functions/process_properties_tag.html" onMouseOver="funcPopup(event,'process_properties_tag')">process_properties_tag</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>);
<a name="l184"><span class="linenum"> 184</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('remove_tag_from_cache')" href="../../_functions/remove_tag_from_cache.html" onMouseOver="funcPopup(event,'remove_tag_from_cache')">remove_tag_from_cache</a>('properties');
<a name="l185"><span class="linenum"> 185</span></a>                              } else {
<a name="l186"><span class="linenum"> 186</span></a>                                  break;
<a name="l187"><span class="linenum"> 187</span></a>                              }
<a name="l188"><span class="linenum"> 188</span></a>                          }
<a name="l189"><span class="linenum"> 189</span></a>                      }
<a name="l190"><span class="linenum"> 190</span></a>                      <a class="phpfunction" onClick="logFunction('fclose')" href="../../_functions/fclose.html" onMouseOver="phpfuncPopup(event,'fclose')">fclose</a>(<a class="var it2039" onMouseOver="hilite(2039)" onMouseOut="lolite()" onClick="logVariable('fh')" href="../../_variables/fh.html">$fh</a>);
<a name="l191"><span class="linenum"> 191</span></a>                      <a class="function" onClick="logFunction('fix_course_sortorder')" href="../../_functions/fix_course_sortorder.html" onMouseOver="funcPopup(event,'fix_course_sortorder')">fix_course_sortorder</a>();
<a name="l192"><span class="linenum"> 192</span></a>                  }
<a name="l193"><span class="linenum"> 193</span></a>  
<a name="l194"><span class="linenum"> 194</span></a>                  <a class="var it16149" onMouseOver="hilite(16149)" onMouseOut="lolite()" onClick="logVariable('timeelapsed')" href="../../_variables/timeelapsed.html">$timeelapsed</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('starttime')" href="../../_variables/starttime.html">$starttime</a>;
<a name="l195"><span class="linenum"> 195</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('Process has completed. Time taken: '.<a class="var it16149" onMouseOver="hilite(16149)" onMouseOut="lolite()" onClick="logVariable('timeelapsed')" href="../../_variables/timeelapsed.html">$timeelapsed</a>.' seconds.');
<a name="l196"><span class="linenum"> 196</span></a>  
<a name="l197"><span class="linenum"> 197</span></a>              }
<a name="l198"><span class="linenum"> 198</span></a>  
<a name="l199"><span class="linenum"> 199</span></a>  <span class="comment">            // These variables are stored so we can compare them against the IMS file, next time round.</span>
<a name="l200"><span class="linenum"> 200</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('prev_time', <a class="var it15634" onMouseOver="hilite(15634)" onMouseOut="lolite()" onClick="logVariable('filemtime')" href="../../_variables/filemtime.html">$filemtime</a>);
<a name="l201"><span class="linenum"> 201</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('prev_md5',  <a class="var it3167" onMouseOver="hilite(3167)" onMouseOut="lolite()" onClick="logVariable('md5')" href="../../_variables/md5.html">$md5</a>);
<a name="l202"><span class="linenum"> 202</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('prev_path', <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l203"><span class="linenum"> 203</span></a>  
<a name="l204"><span class="linenum"> 204</span></a>          } else {
<a name="l205"><span class="linenum"> 205</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('File not found: '.<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l206"><span class="linenum"> 206</span></a>          }
<a name="l207"><span class="linenum"> 207</span></a>  
<a name="l208"><span class="linenum"> 208</span></a>          if (!empty(<a class="var it14808" onMouseOver="hilite(14808)" onMouseOut="lolite()" onClick="logVariable('mailadmins')" href="../../_variables/mailadmins.html">$mailadmins</a>) &amp;&amp; <a class="var it16144" onMouseOver="hilite(16144)" onMouseOut="lolite()" onClick="logVariable('fileisnew')" href="../../_variables/fileisnew.html">$fileisnew</a>) {
<a name="l209"><span class="linenum"> 209</span></a>              <a class="var it16149" onMouseOver="hilite(16149)" onMouseOut="lolite()" onClick="logVariable('timeelapsed')" href="../../_variables/timeelapsed.html">$timeelapsed</a> = isset(<a class="var it16149" onMouseOver="hilite(16149)" onMouseOut="lolite()" onClick="logVariable('timeelapsed')" href="../../_variables/timeelapsed.html">$timeelapsed</a>) ? <a class="var it16149" onMouseOver="hilite(16149)" onMouseOut="lolite()" onClick="logVariable('timeelapsed')" href="../../_variables/timeelapsed.html">$timeelapsed</a> : 0;
<a name="l210"><span class="linenum"> 210</span></a>              <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a> = &quot;An IMS enrolment has been carried out within Moodle.\nTime taken: <a class="var it16149" onMouseOver="hilite(16149)" onMouseOut="lolite()" onClick="logVariable('timeelapsed')" href="../../_variables/timeelapsed.html">$timeelapsed</a> seconds.\n\n&quot;;
<a name="l211"><span class="linenum"> 211</span></a>              if (!empty(<a class="var it16140" onMouseOver="hilite(16140)" onMouseOut="lolite()" onClick="logVariable('logtolocation')" href="../../_variables/logtolocation.html">$logtolocation</a>)) {
<a name="l212"><span class="linenum"> 212</span></a>                  if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('logfp')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/logfp.html">logfp</a>) {
<a name="l213"><span class="linenum"> 213</span></a>                      <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a> .= &quot;Log data has been written to:\n&quot;;
<a name="l214"><span class="linenum"> 214</span></a>                      <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a> .= &quot;<a class="var it16140" onMouseOver="hilite(16140)" onMouseOut="lolite()" onClick="logVariable('logtolocation')" href="../../_variables/logtolocation.html">$logtolocation</a>\n&quot;;
<a name="l215"><span class="linenum"> 215</span></a>                      <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a> .= &quot;(Log file size: &quot;.<a class="phpfunction" onClick="logFunction('ceil')" href="../../_functions/ceil.html" onMouseOver="phpfuncPopup(event,'ceil')">ceil</a>(<a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>(<a class="var it16140" onMouseOver="hilite(16140)" onMouseOut="lolite()" onClick="logVariable('logtolocation')" href="../../_variables/logtolocation.html">$logtolocation</a>) / 1024).&quot;Kb)\n\n&quot;;
<a name="l216"><span class="linenum"> 216</span></a>                  } else {
<a name="l217"><span class="linenum"> 217</span></a>                      <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a> .= &quot;The log file appears not to have been successfully written.\n&quot;;
<a name="l218"><span class="linenum"> 218</span></a>                      <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a> .= &quot;Check that the file is writeable by the server:\n&quot;;
<a name="l219"><span class="linenum"> 219</span></a>                      <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a> .= &quot;<a class="var it16140" onMouseOver="hilite(16140)" onMouseOut="lolite()" onClick="logVariable('logtolocation')" href="../../_variables/logtolocation.html">$logtolocation</a>\n\n&quot;;
<a name="l220"><span class="linenum"> 220</span></a>                  }
<a name="l221"><span class="linenum"> 221</span></a>              } else {
<a name="l222"><span class="linenum"> 222</span></a>                  <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a> .= &quot;Logging is currently not active.&quot;;
<a name="l223"><span class="linenum"> 223</span></a>              }
<a name="l224"><span class="linenum"> 224</span></a>  
<a name="l225"><span class="linenum"> 225</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a> = new stdClass();
<a name="l226"><span class="linenum"> 226</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('modulename')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/modulename.html">modulename</a>        = 'moodle';
<a name="l227"><span class="linenum"> 227</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('component')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>         = 'enrol_imsenterprise';
<a name="l228"><span class="linenum"> 228</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('name')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>              = 'imsenterprise_enrolment';
<a name="l229"><span class="linenum"> 229</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userfrom.html">userfrom</a>          = <a class="function" onClick="logFunction('get_admin')" href="../../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l230"><span class="linenum"> 230</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/userto.html">userto</a>            = <a class="function" onClick="logFunction('get_admin')" href="../../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l231"><span class="linenum"> 231</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('subject')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/subject.html">subject</a>           = &quot;Moodle IMS Enterprise enrolment notification&quot;;
<a name="l232"><span class="linenum"> 232</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessage.html">fullmessage</a>       = <a class="var it2085" onMouseOver="hilite(2085)" onMouseOut="lolite()" onClick="logVariable('msg')" href="../../_variables/msg.html">$msg</a>;
<a name="l233"><span class="linenum"> 233</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessageformat.html">fullmessageformat</a> = <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>;
<a name="l234"><span class="linenum"> 234</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/fullmessagehtml.html">fullmessagehtml</a>   = '';
<a name="l235"><span class="linenum"> 235</span></a>              <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/smallmessage.html">smallmessage</a>      = '';
<a name="l236"><span class="linenum"> 236</span></a>              <a class="function" onClick="logFunction('message_send')" href="../../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>);
<a name="l237"><span class="linenum"> 237</span></a>  
<a name="l238"><span class="linenum"> 238</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('Notification email sent to administrator.');
<a name="l239"><span class="linenum"> 239</span></a>  
<a name="l240"><span class="linenum"> 240</span></a>          }
<a name="l241"><span class="linenum"> 241</span></a>  
<a name="l242"><span class="linenum"> 242</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('logfp')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/logfp.html">logfp</a>) {
<a name="l243"><span class="linenum"> 243</span></a>              <a class="phpfunction" onClick="logFunction('fclose')" href="../../_functions/fclose.html" onMouseOver="phpfuncPopup(event,'fclose')">fclose</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('logfp')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/logfp.html">logfp</a>);
<a name="l244"><span class="linenum"> 244</span></a>          }
<a name="l245"><span class="linenum"> 245</span></a>  
<a name="l246"><span class="linenum"> 246</span></a>      }
<a name="l247"><span class="linenum"> 247</span></a>  
<a name="l248"><span class="linenum"> 248</span></a>      <span class="comment">/**</span>
<a name="l249"><span class="linenum"> 249</span></a>  <span class="comment">     * Check if a complete tag is found in the cached data, which usually happens</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">     * when the end of the tag has only just been loaded into the cache.</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment">     *</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment">     * @param string $tagname Name of tag to look for</span>
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment">     * @param string $latestline The very last line in the cache (used for speeding up the match)</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment">     * @return bool|string false, or the contents of the tag (including start and end).</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">     */</span>
<a name="l256"><span class="linenum"> 256</span></a>      protected function <a class="function" onClick="logFunction('full_tag_found_in_cache')" href="../../_functions/full_tag_found_in_cache.html" onMouseOver="funcPopup(event,'full_tag_found_in_cache')">full_tag_found_in_cache</a>(<a class="var it2390" onMouseOver="hilite(2390)" onMouseOut="lolite()" onClick="logVariable('tagname')" href="../../_variables/tagname.html">$tagname</a>, <a class="var it16150" onMouseOver="hilite(16150)" onMouseOut="lolite()" onClick="logVariable('latestline')" href="../../_variables/latestline.html">$latestline</a>) {
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">        // Return entire element if found. Otherwise return false.</span>
<a name="l258"><span class="linenum"> 258</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it16150" onMouseOver="hilite(16150)" onMouseOut="lolite()" onClick="logVariable('latestline')" href="../../_variables/latestline.html">$latestline</a>), '&lt;/'.<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it2390" onMouseOver="hilite(2390)" onMouseOut="lolite()" onClick="logVariable('tagname')" href="../../_variables/tagname.html">$tagname</a>).'&gt;') === false) {
<a name="l259"><span class="linenum"> 259</span></a>              return false;
<a name="l260"><span class="linenum"> 260</span></a>          } else if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{(&lt;'.<a class="var it2390" onMouseOver="hilite(2390)" onMouseOut="lolite()" onClick="logVariable('tagname')" href="../../_variables/tagname.html">$tagname</a>.'\b.*?&gt;.*?&lt;/'.<a class="var it2390" onMouseOver="hilite(2390)" onMouseOut="lolite()" onClick="logVariable('tagname')" href="../../_variables/tagname.html">$tagname</a>.'&gt;)}is', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('xmlcache')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/xmlcache.html">xmlcache</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l261"><span class="linenum"> 261</span></a>              return <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1];
<a name="l262"><span class="linenum"> 262</span></a>          } else {
<a name="l263"><span class="linenum"> 263</span></a>              return false;
<a name="l264"><span class="linenum"> 264</span></a>          }
<a name="l265"><span class="linenum"> 265</span></a>      }
<a name="l266"><span class="linenum"> 266</span></a>  
<a name="l267"><span class="linenum"> 267</span></a>      <span class="comment">/**</span>
<a name="l268"><span class="linenum"> 268</span></a>  <span class="comment">     * Remove complete tag from the cached data (including all its contents) - so</span>
<a name="l269"><span class="linenum"> 269</span></a>  <span class="comment">     * that the cache doesn't grow to unmanageable size</span>
<a name="l270"><span class="linenum"> 270</span></a>  <span class="comment">     *</span>
<a name="l271"><span class="linenum"> 271</span></a>  <span class="comment">     * @param string $tagname Name of tag to look for</span>
<a name="l272"><span class="linenum"> 272</span></a>  <span class="comment">     */</span>
<a name="l273"><span class="linenum"> 273</span></a>      protected function <a class="function" onClick="logFunction('remove_tag_from_cache')" href="../../_functions/remove_tag_from_cache.html" onMouseOver="funcPopup(event,'remove_tag_from_cache')">remove_tag_from_cache</a>(<a class="var it2390" onMouseOver="hilite(2390)" onMouseOut="lolite()" onClick="logVariable('tagname')" href="../../_variables/tagname.html">$tagname</a>) {
<a name="l274"><span class="linenum"> 274</span></a>  <span class="comment">        // Trim the cache so we're not in danger of running out of memory.</span>
<a name="l275"><span class="linenum"> 275</span></a>  <span class="comment">        // &quot;1&quot; so that we replace only the FIRST instance.</span>
<a name="l276"><span class="linenum"> 276</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('xmlcache')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/xmlcache.html">xmlcache</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('{&lt;'.<a class="var it2390" onMouseOver="hilite(2390)" onMouseOut="lolite()" onClick="logVariable('tagname')" href="../../_variables/tagname.html">$tagname</a>.'\b.*?&gt;.*?&lt;/'.<a class="var it2390" onMouseOver="hilite(2390)" onMouseOut="lolite()" onClick="logVariable('tagname')" href="../../_variables/tagname.html">$tagname</a>.'&gt;}is', '', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('xmlcache')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/xmlcache.html">xmlcache</a>, 1));
<a name="l277"><span class="linenum"> 277</span></a>      }
<a name="l278"><span class="linenum"> 278</span></a>  
<a name="l279"><span class="linenum"> 279</span></a>      <span class="comment">/**</span>
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment">     * Very simple convenience function to return the &quot;recstatus&quot; found in person/group/role tags.</span>
<a name="l281"><span class="linenum"> 281</span></a>  <span class="comment">     * 1=Add, 2=Update, 3=Delete, as specified by IMS, and we also use 0 to indicate &quot;unspecified&quot;.</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">     *</span>
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment">     * @param string $tagdata the tag XML data</span>
<a name="l284"><span class="linenum"> 284</span></a>  <span class="comment">     * @param string $tagname the name of the tag we're interested in</span>
<a name="l285"><span class="linenum"> 285</span></a>  <span class="comment">     * @return int recstatus value</span>
<a name="l286"><span class="linenum"> 286</span></a>  <span class="comment">     */</span>
<a name="l287"><span class="linenum"> 287</span></a>      protected static function <a class="function" onClick="logFunction('get_recstatus')" href="../../_functions/get_recstatus.html" onMouseOver="funcPopup(event,'get_recstatus')">get_recstatus</a>(<a class="var it16151" onMouseOver="hilite(16151)" onMouseOut="lolite()" onClick="logVariable('tagdata')" href="../../_variables/tagdata.html">$tagdata</a>, <a class="var it2390" onMouseOver="hilite(2390)" onMouseOut="lolite()" onClick="logVariable('tagname')" href="../../_variables/tagname.html">$tagname</a>) {
<a name="l288"><span class="linenum"> 288</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;'.<a class="var it2390" onMouseOver="hilite(2390)" onMouseOut="lolite()" onClick="logVariable('tagname')" href="../../_variables/tagname.html">$tagname</a>.'\b[^&gt;]*recstatus\s*=\s*[&quot;\'](\d)[&quot;\']}is', <a class="var it16151" onMouseOver="hilite(16151)" onMouseOut="lolite()" onClick="logVariable('tagdata')" href="../../_variables/tagdata.html">$tagdata</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l289"><span class="linenum"> 289</span></a>              return <a class="phpfunction" onClick="logFunction('intval')" href="../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l290"><span class="linenum"> 290</span></a>          } else {
<a name="l291"><span class="linenum"> 291</span></a>              return 0; <span class="comment">// Unspecified.</span>
<a name="l292"><span class="linenum"> 292</span></a>          }
<a name="l293"><span class="linenum"> 293</span></a>      }
<a name="l294"><span class="linenum"> 294</span></a>  
<a name="l295"><span class="linenum"> 295</span></a>      <span class="comment">/**</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment">     * Process the group tag. This defines a Moodle course.</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment">     *</span>
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment">     * @param string $tagcontents The raw contents of the XML element</span>
<a name="l299"><span class="linenum"> 299</span></a>  <span class="comment">     */</span>
<a name="l300"><span class="linenum"> 300</span></a>      protected function <a class="function" onClick="logFunction('process_group_tag')" href="../../_functions/process_group_tag.html" onMouseOver="funcPopup(event,'process_group_tag')">process_group_tag</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>) {
<a name="l301"><span class="linenum"> 301</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l302"><span class="linenum"> 302</span></a>  
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment">        // Get configs.</span>
<a name="l304"><span class="linenum"> 304</span></a>          <a class="var it16152" onMouseOver="hilite(16152)" onMouseOut="lolite()" onClick="logVariable('truncatecoursecodes')" href="../../_variables/truncatecoursecodes.html">$truncatecoursecodes</a>    = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('truncatecoursecodes');
<a name="l305"><span class="linenum"> 305</span></a>          <a class="var it16153" onMouseOver="hilite(16153)" onMouseOut="lolite()" onClick="logVariable('createnewcourses')" href="../../_variables/createnewcourses.html">$createnewcourses</a>       = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('createnewcourses');
<a name="l306"><span class="linenum"> 306</span></a>          <a class="var it16154" onMouseOver="hilite(16154)" onMouseOut="lolite()" onClick="logVariable('updatecourses')" href="../../_variables/updatecourses.html">$updatecourses</a>          = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('updatecourses');
<a name="l307"><span class="linenum"> 307</span></a>  
<a name="l308"><span class="linenum"> 308</span></a>          if (<a class="var it16153" onMouseOver="hilite(16153)" onMouseOut="lolite()" onClick="logVariable('createnewcourses')" href="../../_variables/createnewcourses.html">$createnewcourses</a>) {
<a name="l309"><span class="linenum"> 309</span></a>              require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>/course/lib.php&quot;);
<a name="l310"><span class="linenum"> 310</span></a>          }
<a name="l311"><span class="linenum"> 311</span></a>  
<a name="l312"><span class="linenum"> 312</span></a>  <span class="comment">        // Process tag contents.</span>
<a name="l313"><span class="linenum"> 313</span></a>          <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a> = new stdClass();
<a name="l314"><span class="linenum"> 314</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;sourcedid&gt;.*?&lt;id&gt;(.+?)&lt;/id&gt;.*?&lt;/sourcedid&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l315"><span class="linenum"> 315</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('coursecode')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l316"><span class="linenum"> 316</span></a>          }
<a name="l317"><span class="linenum"> 317</span></a>  
<a name="l318"><span class="linenum"> 318</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l319"><span class="linenum"> 319</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;description&gt;.*?&lt;long&gt;(.*?)&lt;/long&gt;.*?&lt;/description&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l320"><span class="linenum"> 320</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('long')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/long.html">long</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l321"><span class="linenum"> 321</span></a>          }
<a name="l322"><span class="linenum"> 322</span></a>  
<a name="l323"><span class="linenum"> 323</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l324"><span class="linenum"> 324</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;description&gt;.*?&lt;short&gt;(.*?)&lt;/short&gt;.*?&lt;/description&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l325"><span class="linenum"> 325</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('short')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/short.html">short</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l326"><span class="linenum"> 326</span></a>          }
<a name="l327"><span class="linenum"> 327</span></a>  
<a name="l328"><span class="linenum"> 328</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l329"><span class="linenum"> 329</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;description&gt;.*?&lt;full&gt;(.*?)&lt;/full&gt;.*?&lt;/description&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l330"><span class="linenum"> 330</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('full')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/full.html">full</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l331"><span class="linenum"> 331</span></a>          }
<a name="l332"><span class="linenum"> 332</span></a>  
<a name="l333"><span class="linenum"> 333</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;org&gt;(.*?)&lt;/org&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it16156" onMouseOver="hilite(16156)" onMouseOut="lolite()" onClick="logVariable('matchesorg')" href="../../_variables/matchesorg.html">$matchesorg</a>)) {
<a name="l334"><span class="linenum"> 334</span></a>              if (<a class="phpfunction" onClick="logFunction('preg_match_all')" href="../../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>('{&lt;orgunit&gt;(.*?)&lt;/orgunit&gt;}is', <a class="var it16156" onMouseOver="hilite(16156)" onMouseOut="lolite()" onClick="logVariable('matchesorg')" href="../../_variables/matchesorg.html">$matchesorg</a>[1], <a class="var it16157" onMouseOver="hilite(16157)" onMouseOut="lolite()" onClick="logVariable('matchesorgunit')" href="../../_variables/matchesorgunit.html">$matchesorgunit</a>)) {
<a name="l335"><span class="linenum"> 335</span></a>                  <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('categories')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/categories.html">categories</a> = <a class="phpfunction" onClick="logFunction('array_map')" href="../../_functions/array_map.html" onMouseOver="phpfuncPopup(event,'array_map')">array_map</a>('trim', <a class="var it16157" onMouseOver="hilite(16157)" onMouseOut="lolite()" onClick="logVariable('matchesorgunit')" href="../../_variables/matchesorgunit.html">$matchesorgunit</a>[1]);
<a name="l336"><span class="linenum"> 336</span></a>              }
<a name="l337"><span class="linenum"> 337</span></a>          }
<a name="l338"><span class="linenum"> 338</span></a>  
<a name="l339"><span class="linenum"> 339</span></a>          <a class="var it16158" onMouseOver="hilite(16158)" onMouseOut="lolite()" onClick="logVariable('recstatus')" href="../../_variables/recstatus.html">$recstatus</a> = (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_recstatus')" href="../../_functions/get_recstatus.html" onMouseOver="funcPopup(event,'get_recstatus')">get_recstatus</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, 'group'));
<a name="l340"><span class="linenum"> 340</span></a>  
<a name="l341"><span class="linenum"> 341</span></a>          if (empty(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('coursecode')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a>)) {
<a name="l342"><span class="linenum"> 342</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('Error: Unable to find course code in \'group\' element.');
<a name="l343"><span class="linenum"> 343</span></a>          } else {
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment">            // First, truncate the course code if desired.</span>
<a name="l345"><span class="linenum"> 345</span></a>              if (<a class="phpfunction" onClick="logFunction('intval')" href="../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it16152" onMouseOver="hilite(16152)" onMouseOut="lolite()" onClick="logVariable('truncatecoursecodes')" href="../../_variables/truncatecoursecodes.html">$truncatecoursecodes</a>) &gt; 0) {
<a name="l346"><span class="linenum"> 346</span></a>                  <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('coursecode')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a> = (<a class="var it16152" onMouseOver="hilite(16152)" onMouseOut="lolite()" onClick="logVariable('truncatecoursecodes')" href="../../_variables/truncatecoursecodes.html">$truncatecoursecodes</a> &gt; 0)
<a name="l347"><span class="linenum"> 347</span></a>                      ? <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('coursecode')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a>, 0, <a class="phpfunction" onClick="logFunction('intval')" href="../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it16152" onMouseOver="hilite(16152)" onMouseOut="lolite()" onClick="logVariable('truncatecoursecodes')" href="../../_variables/truncatecoursecodes.html">$truncatecoursecodes</a>))
<a name="l348"><span class="linenum"> 348</span></a>                      : <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('coursecode')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a>;
<a name="l349"><span class="linenum"> 349</span></a>              }
<a name="l350"><span class="linenum"> 350</span></a>  
<a name="l351"><span class="linenum"> 351</span></a>  <span class="comment">            // For compatibility with the (currently inactive) course aliasing, we need this to be an array.</span>
<a name="l352"><span class="linenum"> 352</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('coursecode')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a> = array(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('coursecode')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a>);
<a name="l353"><span class="linenum"> 353</span></a>  
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment">            // Third, check if the course(s) exist.</span>
<a name="l355"><span class="linenum"> 355</span></a>              foreach (<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('coursecode')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a> as <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a>) {
<a name="l356"><span class="linenum"> 356</span></a>                  <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a>);
<a name="l357"><span class="linenum"> 357</span></a>                  <a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('idnumber' =&gt; <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a>));
<a name="l358"><span class="linenum"> 358</span></a>                  if (!<a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>) {
<a name="l359"><span class="linenum"> 359</span></a>                      if (!<a class="var it16153" onMouseOver="hilite(16153)" onMouseOut="lolite()" onClick="logVariable('createnewcourses')" href="../../_variables/createnewcourses.html">$createnewcourses</a>) {
<a name="l360"><span class="linenum"> 360</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Course <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a> not found in Moodle's course idnumbers.&quot;);
<a name="l361"><span class="linenum"> 361</span></a>                      } else {
<a name="l362"><span class="linenum"> 362</span></a>  
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment">                        // Create the (hidden) course(s) if not found.</span>
<a name="l364"><span class="linenum"> 364</span></a>                          <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('moodlecourse'); <span class="comment">// Load Moodle Course shell defaults.</span>
<a name="l365"><span class="linenum"> 365</span></a>  
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment">                        // New course.</span>
<a name="l367"><span class="linenum"> 367</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = new stdClass();
<a name="l368"><span class="linenum"> 368</span></a>                          foreach (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('coursemappings')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/coursemappings.html">coursemappings</a> as <a class="var it16159" onMouseOver="hilite(16159)" onMouseOut="lolite()" onClick="logVariable('courseattr')" href="../../_variables/courseattr.html">$courseattr</a> =&gt; <a class="var it16160" onMouseOver="hilite(16160)" onMouseOut="lolite()" onClick="logVariable('imsname')" href="../../_variables/imsname.html">$imsname</a>) {
<a name="l369"><span class="linenum"> 369</span></a>  
<a name="l370"><span class="linenum"> 370</span></a>                              if (<a class="var it16160" onMouseOver="hilite(16160)" onMouseOut="lolite()" onClick="logVariable('imsname')" href="../../_variables/imsname.html">$imsname</a> == 'ignore') {
<a name="l371"><span class="linenum"> 371</span></a>                                  continue;
<a name="l372"><span class="linenum"> 372</span></a>                              }
<a name="l373"><span class="linenum"> 373</span></a>  
<a name="l374"><span class="linenum"> 374</span></a>  <span class="comment">                            // Check if the IMS file contains the mapped tag, otherwise fallback on coursecode.</span>
<a name="l375"><span class="linenum"> 375</span></a>                              if (<a class="var it16160" onMouseOver="hilite(16160)" onMouseOut="lolite()" onClick="logVariable('imsname')" href="../../_variables/imsname.html">$imsname</a> == 'coursecode') {
<a name="l376"><span class="linenum"> 376</span></a>                                  <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;{<a class="var it16159" onMouseOver="hilite(16159)" onMouseOut="lolite()" onClick="logVariable('courseattr')" href="../../_variables/courseattr.html">$courseattr</a>} = <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a>;
<a name="l377"><span class="linenum"> 377</span></a>                              } else if (!empty(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;{<a class="var it16160" onMouseOver="hilite(16160)" onMouseOut="lolite()" onClick="logVariable('imsname')" href="../../_variables/imsname.html">$imsname</a>})) {
<a name="l378"><span class="linenum"> 378</span></a>                                  <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;{<a class="var it16159" onMouseOver="hilite(16159)" onMouseOut="lolite()" onClick="logVariable('courseattr')" href="../../_variables/courseattr.html">$courseattr</a>} = <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;{<a class="var it16160" onMouseOver="hilite(16160)" onMouseOut="lolite()" onClick="logVariable('imsname')" href="../../_variables/imsname.html">$imsname</a>};
<a name="l379"><span class="linenum"> 379</span></a>                              } else {
<a name="l380"><span class="linenum"> 380</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('No ' . <a class="var it16160" onMouseOver="hilite(16160)" onMouseOut="lolite()" onClick="logVariable('imsname')" href="../../_variables/imsname.html">$imsname</a> . ' description tag found for '
<a name="l381"><span class="linenum"> 381</span></a>                                      .<a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a> . ' coursecode, using ' . <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a> . ' instead');
<a name="l382"><span class="linenum"> 382</span></a>                                  <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;{<a class="var it16159" onMouseOver="hilite(16159)" onMouseOut="lolite()" onClick="logVariable('courseattr')" href="../../_variables/courseattr.html">$courseattr</a>} = <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a>;
<a name="l383"><span class="linenum"> 383</span></a>                              }
<a name="l384"><span class="linenum"> 384</span></a>                          }
<a name="l385"><span class="linenum"> 385</span></a>  
<a name="l386"><span class="linenum"> 386</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('idnumber')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a> = <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a>;
<a name="l387"><span class="linenum"> 387</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('format')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/format.html">format</a> = <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a>-&gt;<a onClick="logVariable('format')" class="var it43447" onMouseOver="hilite(43447)" onMouseOut="lolite()" href="../../_variables/format.html">format</a>;
<a name="l388"><span class="linenum"> 388</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('visible')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a> = <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a>-&gt;<a onClick="logVariable('visible')" class="var it43447" onMouseOver="hilite(43447)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a>;
<a name="l389"><span class="linenum"> 389</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('newsitems')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/newsitems.html">newsitems</a> = <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a>-&gt;<a onClick="logVariable('newsitems')" class="var it43447" onMouseOver="hilite(43447)" onMouseOut="lolite()" href="../../_variables/newsitems.html">newsitems</a>;
<a name="l390"><span class="linenum"> 390</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('showgrades')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/showgrades.html">showgrades</a> = <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a>-&gt;<a onClick="logVariable('showgrades')" class="var it43447" onMouseOver="hilite(43447)" onMouseOut="lolite()" href="../../_variables/showgrades.html">showgrades</a>;
<a name="l391"><span class="linenum"> 391</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('showreports')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/showreports.html">showreports</a> = <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a>-&gt;<a onClick="logVariable('showreports')" class="var it43447" onMouseOver="hilite(43447)" onMouseOut="lolite()" href="../../_variables/showreports.html">showreports</a>;
<a name="l392"><span class="linenum"> 392</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('maxbytes')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/maxbytes.html">maxbytes</a> = <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a>-&gt;<a onClick="logVariable('maxbytes')" class="var it43447" onMouseOver="hilite(43447)" onMouseOut="lolite()" href="../../_variables/maxbytes.html">maxbytes</a>;
<a name="l393"><span class="linenum"> 393</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('groupmode')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/groupmode.html">groupmode</a> = <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a>-&gt;<a onClick="logVariable('groupmode')" class="var it43447" onMouseOver="hilite(43447)" onMouseOut="lolite()" href="../../_variables/groupmode.html">groupmode</a>;
<a name="l394"><span class="linenum"> 394</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('groupmodeforce')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/groupmodeforce.html">groupmodeforce</a> = <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a>-&gt;<a onClick="logVariable('groupmodeforce')" class="var it43447" onMouseOver="hilite(43447)" onMouseOut="lolite()" href="../../_variables/groupmodeforce.html">groupmodeforce</a>;
<a name="l395"><span class="linenum"> 395</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('enablecompletion')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/enablecompletion.html">enablecompletion</a> = <a class="var it554" onMouseOver="hilite(554)" onMouseOut="lolite()" onClick="logVariable('courseconfig')" href="../../_variables/courseconfig.html">$courseconfig</a>-&gt;<a onClick="logVariable('enablecompletion')" class="var it43447" onMouseOver="hilite(43447)" onMouseOut="lolite()" href="../../_variables/enablecompletion.html">enablecompletion</a>;
<a name="l396"><span class="linenum"> 396</span></a>  <span class="comment">                        // Insert default names for teachers/students, from the current language.</span>
<a name="l397"><span class="linenum"> 397</span></a>  
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">                        // Handle course categorisation (taken from the group.org.orgunit or group.org.id fields if present).</span>
<a name="l399"><span class="linenum"> 399</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('category')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/category.html">category</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_category_from_group')" href="../../_functions/get_category_from_group.html" onMouseOver="funcPopup(event,'get_category_from_group')">get_category_from_group</a>(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('categories')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/categories.html">categories</a>);
<a name="l400"><span class="linenum"> 400</span></a>  
<a name="l401"><span class="linenum"> 401</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('startdate')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/startdate.html">startdate</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">                        // Choose a sort order that puts us at the start of the list!</span>
<a name="l403"><span class="linenum"> 403</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = 0;
<a name="l404"><span class="linenum"> 404</span></a>  
<a name="l405"><span class="linenum"> 405</span></a>                          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="function" onClick="logFunction('create_course')" href="../../_functions/create_course.html" onMouseOver="funcPopup(event,'create_course')">create_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l406"><span class="linenum"> 406</span></a>  
<a name="l407"><span class="linenum"> 407</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Created course <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a> in Moodle (Moodle ID is <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)&quot;);
<a name="l408"><span class="linenum"> 408</span></a>                      }
<a name="l409"><span class="linenum"> 409</span></a>                  } else if ((<a class="var it16158" onMouseOver="hilite(16158)" onMouseOut="lolite()" onClick="logVariable('recstatus')" href="../../_variables/recstatus.html">$recstatus</a> == self::IMSENTERPRISE_UPDATE) &amp;&amp; <a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>) {
<a name="l410"><span class="linenum"> 410</span></a>                      if (<a class="var it16154" onMouseOver="hilite(16154)" onMouseOut="lolite()" onClick="logVariable('updatecourses')" href="../../_variables/updatecourses.html">$updatecourses</a>) {
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment">                        // Update course. Allowed fields to be updated are:</span>
<a name="l412"><span class="linenum"> 412</span></a>  <span class="comment">                        // Short Name, and Full Name.</span>
<a name="l413"><span class="linenum"> 413</span></a>                          <a class="var it16161" onMouseOver="hilite(16161)" onMouseOut="lolite()" onClick="logVariable('hasupdates')" href="../../_variables/hasupdates.html">$hasupdates</a> = false;
<a name="l414"><span class="linenum"> 414</span></a>                          if (!empty(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('short')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/short.html">short</a>)) {
<a name="l415"><span class="linenum"> 415</span></a>                              if (<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('short')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/short.html">short</a> != <a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>-&gt;<a onClick="logVariable('shortname')" class="var it43943" onMouseOver="hilite(43943)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>) {
<a name="l416"><span class="linenum"> 416</span></a>                                  <a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>-&gt;<a onClick="logVariable('shortname')" class="var it43943" onMouseOver="hilite(43943)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a> = <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('short')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/short.html">short</a>;
<a name="l417"><span class="linenum"> 417</span></a>                                  <a class="var it16161" onMouseOver="hilite(16161)" onMouseOut="lolite()" onClick="logVariable('hasupdates')" href="../../_variables/hasupdates.html">$hasupdates</a> = true;
<a name="l418"><span class="linenum"> 418</span></a>                              }
<a name="l419"><span class="linenum"> 419</span></a>                          }
<a name="l420"><span class="linenum"> 420</span></a>                          if (!empty(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('full')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/full.html">full</a>)) {
<a name="l421"><span class="linenum"> 421</span></a>                              if (<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('full')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/full.html">full</a> != <a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>-&gt;<a onClick="logVariable('fullname')" class="var it43943" onMouseOver="hilite(43943)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>) {
<a name="l422"><span class="linenum"> 422</span></a>                                  <a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>-&gt;<a onClick="logVariable('fullname')" class="var it43943" onMouseOver="hilite(43943)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a> = <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('full')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/full.html">full</a>;
<a name="l423"><span class="linenum"> 423</span></a>                                  <a class="var it16161" onMouseOver="hilite(16161)" onMouseOut="lolite()" onClick="logVariable('hasupdates')" href="../../_variables/hasupdates.html">$hasupdates</a> = true;
<a name="l424"><span class="linenum"> 424</span></a>                              }
<a name="l425"><span class="linenum"> 425</span></a>                          }
<a name="l426"><span class="linenum"> 426</span></a>                          if (<a class="var it16161" onMouseOver="hilite(16161)" onMouseOut="lolite()" onClick="logVariable('hasupdates')" href="../../_variables/hasupdates.html">$hasupdates</a>) {
<a name="l427"><span class="linenum"> 427</span></a>                              <a class="function" onClick="logFunction('update_course')" href="../../_functions/update_course.html" onMouseOver="funcPopup(event,'update_course')">update_course</a>(<a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>);
<a name="l428"><span class="linenum"> 428</span></a>                              <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>-&gt;<a onClick="logVariable('id')" class="var it43943" onMouseOver="hilite(43943)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l429"><span class="linenum"> 429</span></a>                              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Updated course <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a> in Moodle (Moodle ID is <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)&quot;);
<a name="l430"><span class="linenum"> 430</span></a>                          }
<a name="l431"><span class="linenum"> 431</span></a>                      } else {
<a name="l432"><span class="linenum"> 432</span></a>  <span class="comment">                        // Update courses option is not enabled. Ignore.</span>
<a name="l433"><span class="linenum"> 433</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Ignoring update to course <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a>&quot;);
<a name="l434"><span class="linenum"> 434</span></a>                      }
<a name="l435"><span class="linenum"> 435</span></a>                  } else if ((<a class="var it16158" onMouseOver="hilite(16158)" onMouseOut="lolite()" onClick="logVariable('recstatus')" href="../../_variables/recstatus.html">$recstatus</a> == self::IMSENTERPRISE_DELETE) &amp;&amp; <a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>) {
<a name="l436"><span class="linenum"> 436</span></a>  <span class="comment">                    // If course does exist, but recstatus==3 (delete), then set the course as hidden.</span>
<a name="l437"><span class="linenum"> 437</span></a>                      <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it8357" onMouseOver="hilite(8357)" onMouseOut="lolite()" onClick="logVariable('dbcourse')" href="../../_variables/dbcourse.html">$dbcourse</a>-&gt;<a onClick="logVariable('id')" class="var it43943" onMouseOver="hilite(43943)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l438"><span class="linenum"> 438</span></a>                      <a class="var it1794" onMouseOver="hilite(1794)" onMouseOut="lolite()" onClick="logVariable('show')" href="../../_variables/show.html">$show</a> = false;
<a name="l439"><span class="linenum"> 439</span></a>                      <a class="function" onClick="logFunction('course_change_visibility')" href="../../_functions/course_change_visibility.html" onMouseOver="funcPopup(event,'course_change_visibility')">course_change_visibility</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it1794" onMouseOver="hilite(1794)" onMouseOut="lolite()" onClick="logVariable('show')" href="../../_variables/show.html">$show</a>);
<a name="l440"><span class="linenum"> 440</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Updated (set to hidden) course <a class="var it16155" onMouseOver="hilite(16155)" onMouseOut="lolite()" onClick="logVariable('coursecode')" href="../../_variables/coursecode.html">$coursecode</a> in Moodle (Moodle ID is <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)&quot;);
<a name="l441"><span class="linenum"> 441</span></a>                  }
<a name="l442"><span class="linenum"> 442</span></a>              }
<a name="l443"><span class="linenum"> 443</span></a>          }
<a name="l444"><span class="linenum"> 444</span></a>      }
<a name="l445"><span class="linenum"> 445</span></a>  
<a name="l446"><span class="linenum"> 446</span></a>      <span class="comment">/**</span>
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">     * Process the person tag. This defines a Moodle user.</span>
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment">     *</span>
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment">     * @param string $tagcontents The raw contents of the XML element</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment">     */</span>
<a name="l451"><span class="linenum"> 451</span></a>      protected function <a class="function" onClick="logFunction('process_person_tag')" href="../../_functions/process_person_tag.html" onMouseOver="funcPopup(event,'process_person_tag')">process_person_tag</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>) {
<a name="l452"><span class="linenum"> 452</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l453"><span class="linenum"> 453</span></a>  
<a name="l454"><span class="linenum"> 454</span></a>  <span class="comment">        // Get plugin configs.</span>
<a name="l455"><span class="linenum"> 455</span></a>          <a class="var it16162" onMouseOver="hilite(16162)" onMouseOut="lolite()" onClick="logVariable('imssourcedidfallback')" href="../../_variables/imssourcedidfallback.html">$imssourcedidfallback</a>   = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('imssourcedidfallback');
<a name="l456"><span class="linenum"> 456</span></a>          <a class="var it16163" onMouseOver="hilite(16163)" onMouseOut="lolite()" onClick="logVariable('fixcaseusernames')" href="../../_variables/fixcaseusernames.html">$fixcaseusernames</a>       = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('fixcaseusernames');
<a name="l457"><span class="linenum"> 457</span></a>          <a class="var it16164" onMouseOver="hilite(16164)" onMouseOut="lolite()" onClick="logVariable('fixcasepersonalnames')" href="../../_variables/fixcasepersonalnames.html">$fixcasepersonalnames</a>   = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('fixcasepersonalnames');
<a name="l458"><span class="linenum"> 458</span></a>          <a class="var it16165" onMouseOver="hilite(16165)" onMouseOut="lolite()" onClick="logVariable('imsdeleteusers')" href="../../_variables/imsdeleteusers.html">$imsdeleteusers</a>         = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('imsdeleteusers');
<a name="l459"><span class="linenum"> 459</span></a>          <a class="var it16166" onMouseOver="hilite(16166)" onMouseOut="lolite()" onClick="logVariable('createnewusers')" href="../../_variables/createnewusers.html">$createnewusers</a>         = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('createnewusers');
<a name="l460"><span class="linenum"> 460</span></a>          <a class="var it16167" onMouseOver="hilite(16167)" onMouseOut="lolite()" onClick="logVariable('imsupdateusers')" href="../../_variables/imsupdateusers.html">$imsupdateusers</a>         = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('imsupdateusers');
<a name="l461"><span class="linenum"> 461</span></a>  
<a name="l462"><span class="linenum"> 462</span></a>          <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a> = new stdClass();
<a name="l463"><span class="linenum"> 463</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;sourcedid&gt;.*?&lt;id&gt;(.+?)&lt;/id&gt;.*?&lt;/sourcedid&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l464"><span class="linenum"> 464</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l465"><span class="linenum"> 465</span></a>          }
<a name="l466"><span class="linenum"> 466</span></a>  
<a name="l467"><span class="linenum"> 467</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l468"><span class="linenum"> 468</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;name&gt;.*?&lt;n&gt;.*?&lt;given&gt;(.+?)&lt;/given&gt;.*?&lt;/n&gt;.*?&lt;/name&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l469"><span class="linenum"> 469</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('firstname')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l470"><span class="linenum"> 470</span></a>          }
<a name="l471"><span class="linenum"> 471</span></a>  
<a name="l472"><span class="linenum"> 472</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l473"><span class="linenum"> 473</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;name&gt;.*?&lt;n&gt;.*?&lt;family&gt;(.+?)&lt;/family&gt;.*?&lt;/n&gt;.*?&lt;/name&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l474"><span class="linenum"> 474</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('lastname')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/lastname.html">lastname</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l475"><span class="linenum"> 475</span></a>          }
<a name="l476"><span class="linenum"> 476</span></a>  
<a name="l477"><span class="linenum"> 477</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l478"><span class="linenum"> 478</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;userid.*?&gt;(.*?)&lt;/userid&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l479"><span class="linenum"> 479</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l480"><span class="linenum"> 480</span></a>          }
<a name="l481"><span class="linenum"> 481</span></a>  
<a name="l482"><span class="linenum"> 482</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l483"><span class="linenum"> 483</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;userid\s+authenticationtype\s*=\s*&quot;*(.+?)&quot;*&gt;.*?&lt;/userid&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l484"><span class="linenum"> 484</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('auth')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l485"><span class="linenum"> 485</span></a>          }
<a name="l486"><span class="linenum"> 486</span></a>  
<a name="l487"><span class="linenum"> 487</span></a>          if (<a class="var it16162" onMouseOver="hilite(16162)" onMouseOut="lolite()" onClick="logVariable('imssourcedidfallback')" href="../../_variables/imssourcedidfallback.html">$imssourcedidfallback</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>) == '') {
<a name="l488"><span class="linenum"> 488</span></a>  <span class="comment">            // This is the point where we can fall back to useing the &quot;sourcedid&quot; if &quot;userid&quot; is not supplied.</span>
<a name="l489"><span class="linenum"> 489</span></a>  <span class="comment">            // NB We don't use an &quot;elseif&quot; because the tag may be supplied-but-empty.</span>
<a name="l490"><span class="linenum"> 490</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a> = <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>;
<a name="l491"><span class="linenum"> 491</span></a>          }
<a name="l492"><span class="linenum"> 492</span></a>  
<a name="l493"><span class="linenum"> 493</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l494"><span class="linenum"> 494</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;email&gt;(.*?)&lt;/email&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l495"><span class="linenum"> 495</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('email')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/email.html">email</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l496"><span class="linenum"> 496</span></a>          }
<a name="l497"><span class="linenum"> 497</span></a>  
<a name="l498"><span class="linenum"> 498</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l499"><span class="linenum"> 499</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;url&gt;(.*?)&lt;/url&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l500"><span class="linenum"> 500</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('url')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/url.html">url</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l501"><span class="linenum"> 501</span></a>          }
<a name="l502"><span class="linenum"> 502</span></a>  
<a name="l503"><span class="linenum"> 503</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l504"><span class="linenum"> 504</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;adr&gt;.*?&lt;locality&gt;(.+?)&lt;/locality&gt;.*?&lt;/adr&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l505"><span class="linenum"> 505</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('city')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/city.html">city</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l506"><span class="linenum"> 506</span></a>          }
<a name="l507"><span class="linenum"> 507</span></a>  
<a name="l508"><span class="linenum"> 508</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l509"><span class="linenum"> 509</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;adr&gt;.*?&lt;country&gt;(.+?)&lt;/country&gt;.*?&lt;/adr&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l510"><span class="linenum"> 510</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('country')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/country.html">country</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l511"><span class="linenum"> 511</span></a>          }
<a name="l512"><span class="linenum"> 512</span></a>  
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment">        // Fix case of some of the fields if required.</span>
<a name="l514"><span class="linenum"> 514</span></a>          if (<a class="var it16163" onMouseOver="hilite(16163)" onMouseOut="lolite()" onClick="logVariable('fixcaseusernames')" href="../../_variables/fixcaseusernames.html">$fixcaseusernames</a> &amp;&amp; isset(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>)) {
<a name="l515"><span class="linenum"> 515</span></a>              <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a> = <a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>);
<a name="l516"><span class="linenum"> 516</span></a>          }
<a name="l517"><span class="linenum"> 517</span></a>          if (<a class="var it16164" onMouseOver="hilite(16164)" onMouseOut="lolite()" onClick="logVariable('fixcasepersonalnames')" href="../../_variables/fixcasepersonalnames.html">$fixcasepersonalnames</a>) {
<a name="l518"><span class="linenum"> 518</span></a>              if (isset(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('firstname')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a>)) {
<a name="l519"><span class="linenum"> 519</span></a>                  <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('firstname')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a> = <a class="phpfunction" onClick="logFunction('ucwords')" href="../../_functions/ucwords.html" onMouseOver="phpfuncPopup(event,'ucwords')">ucwords</a>(<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('firstname')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/firstname.html">firstname</a>));
<a name="l520"><span class="linenum"> 520</span></a>              }
<a name="l521"><span class="linenum"> 521</span></a>              if (isset(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('lastname')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/lastname.html">lastname</a>)) {
<a name="l522"><span class="linenum"> 522</span></a>                  <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('lastname')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/lastname.html">lastname</a> = <a class="phpfunction" onClick="logFunction('ucwords')" href="../../_functions/ucwords.html" onMouseOver="phpfuncPopup(event,'ucwords')">ucwords</a>(<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('lastname')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/lastname.html">lastname</a>));
<a name="l523"><span class="linenum"> 523</span></a>              }
<a name="l524"><span class="linenum"> 524</span></a>          }
<a name="l525"><span class="linenum"> 525</span></a>  
<a name="l526"><span class="linenum"> 526</span></a>          <a class="var it16158" onMouseOver="hilite(16158)" onMouseOut="lolite()" onClick="logVariable('recstatus')" href="../../_variables/recstatus.html">$recstatus</a> = (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_recstatus')" href="../../_functions/get_recstatus.html" onMouseOver="funcPopup(event,'get_recstatus')">get_recstatus</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, 'person'));
<a name="l527"><span class="linenum"> 527</span></a>  
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment">        // Now if the recstatus is 3, we should delete the user if-and-only-if the setting for delete users is turned on.</span>
<a name="l529"><span class="linenum"> 529</span></a>          if (<a class="var it16158" onMouseOver="hilite(16158)" onMouseOut="lolite()" onClick="logVariable('recstatus')" href="../../_variables/recstatus.html">$recstatus</a> == self::IMSENTERPRISE_DELETE) {
<a name="l530"><span class="linenum"> 530</span></a>  
<a name="l531"><span class="linenum"> 531</span></a>              if (<a class="var it16165" onMouseOver="hilite(16165)" onMouseOut="lolite()" onClick="logVariable('imsdeleteusers')" href="../../_variables/imsdeleteusers.html">$imsdeleteusers</a>) { // If we're allowed to delete user records.
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment">                // Do not dare to hack the user.deleted field directly in database!!!</span>
<a name="l533"><span class="linenum"> 533</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('username' =&gt; <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>, 'mnethostid' =&gt; <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>, 'deleted' =&gt; 0);
<a name="l534"><span class="linenum"> 534</span></a>                  if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l535"><span class="linenum"> 535</span></a>                      if (<a class="function" onClick="logFunction('delete_user')" href="../../_functions/delete_user.html" onMouseOver="funcPopup(event,'delete_user')">delete_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>)) {
<a name="l536"><span class="linenum"> 536</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Deleted user '<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>' (ID number <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>).&quot;);
<a name="l537"><span class="linenum"> 537</span></a>                      } else {
<a name="l538"><span class="linenum"> 538</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Error deleting '<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>' (ID number <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>).&quot;);
<a name="l539"><span class="linenum"> 539</span></a>                      }
<a name="l540"><span class="linenum"> 540</span></a>                  } else {
<a name="l541"><span class="linenum"> 541</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Can not delete user '<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>' (ID number <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>) - user does not exist.&quot;);
<a name="l542"><span class="linenum"> 542</span></a>                  }
<a name="l543"><span class="linenum"> 543</span></a>              } else {
<a name="l544"><span class="linenum"> 544</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Ignoring deletion request for user '<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>' (ID number <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>).&quot;);
<a name="l545"><span class="linenum"> 545</span></a>              }
<a name="l546"><span class="linenum"> 546</span></a>          } else if (<a class="var it16158" onMouseOver="hilite(16158)" onMouseOut="lolite()" onClick="logVariable('recstatus')" href="../../_variables/recstatus.html">$recstatus</a> == self::IMSENTERPRISE_UPDATE) { // Update user.
<a name="l547"><span class="linenum"> 547</span></a>              if (<a class="var it16167" onMouseOver="hilite(16167)" onMouseOut="lolite()" onClick="logVariable('imsupdateusers')" href="../../_variables/imsupdateusers.html">$imsupdateusers</a>) {
<a name="l548"><span class="linenum"> 548</span></a>                  if (<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('user', 'id', array('idnumber' =&gt; <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>))) {
<a name="l549"><span class="linenum"> 549</span></a>                      <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('id')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>;
<a name="l550"><span class="linenum"> 550</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('user', <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>);
<a name="l551"><span class="linenum"> 551</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Updated user <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>&quot;);
<a name="l552"><span class="linenum"> 552</span></a>                  } else {
<a name="l553"><span class="linenum"> 553</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Ignoring update request for non-existent user <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>&quot;);
<a name="l554"><span class="linenum"> 554</span></a>                  }
<a name="l555"><span class="linenum"> 555</span></a>              } else {
<a name="l556"><span class="linenum"> 556</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Ignoring update request for user <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>&quot;);
<a name="l557"><span class="linenum"> 557</span></a>              }
<a name="l558"><span class="linenum"> 558</span></a>  
<a name="l559"><span class="linenum"> 559</span></a>          } else { // Add or update record.
<a name="l560"><span class="linenum"> 560</span></a>  
<a name="l561"><span class="linenum"> 561</span></a>  <span class="comment">            // If the user exists (matching sourcedid) then we don't need to do anything.</span>
<a name="l562"><span class="linenum"> 562</span></a>              if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('user', 'id', array('idnumber' =&gt; <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>)) &amp;&amp; <a class="var it16166" onMouseOver="hilite(16166)" onMouseOut="lolite()" onClick="logVariable('createnewusers')" href="../../_variables/createnewusers.html">$createnewusers</a>) {
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment">                // If they don't exist and haven't a defined username, we log this as a potential problem.</span>
<a name="l564"><span class="linenum"> 564</span></a>                  if ((!isset(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>)) || (<a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>) == 0)) {
<a name="l565"><span class="linenum"> 565</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Cannot create <span class="keyword">new </span><a class="class" onClick="logClass('user')" href="../../_classes/user.html" onMouseOver="classPopup(event,'user')">user</a> for ID # <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>&quot;.
<a name="l566"><span class="linenum"> 566</span></a>                          &quot;- no username listed in IMS data for this person.&quot;);
<a name="l567"><span class="linenum"> 567</span></a>                  } else if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('user', 'id', array('username' =&gt; <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>))) {
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment">                    // If their idnumber is not registered but their user ID is, then add their idnumber to their record.</span>
<a name="l569"><span class="linenum"> 569</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('user', 'idnumber', <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>, array('username' =&gt; <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>));
<a name="l570"><span class="linenum"> 570</span></a>                  } else {
<a name="l571"><span class="linenum"> 571</span></a>  
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment">                    // If they don't exist and they have a defined username, and $createnewusers == true, we create them.</span>
<a name="l573"><span class="linenum"> 573</span></a>                      <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('lang')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('lang')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/lang.html">lang</a>;
<a name="l574"><span class="linenum"> 574</span></a>  <span class="comment">                    // TODO: MDL-15863 this needs more work due to multiauth changes, use first auth for now.</span>
<a name="l575"><span class="linenum"> 575</span></a>                      if (empty(<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('auth')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a>)) {
<a name="l576"><span class="linenum"> 576</span></a>                          <a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../../_variables/auth.html">$auth</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('auth')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a>);
<a name="l577"><span class="linenum"> 577</span></a>                          <a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../../_variables/auth.html">$auth</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../../_variables/auth.html">$auth</a>);
<a name="l578"><span class="linenum"> 578</span></a>                          <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('auth')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/auth.html">auth</a> = <a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../../_variables/auth.html">$auth</a>;
<a name="l579"><span class="linenum"> 579</span></a>                      }
<a name="l580"><span class="linenum"> 580</span></a>                      <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('confirmed')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/confirmed.html">confirmed</a> = 1;
<a name="l581"><span class="linenum"> 581</span></a>                      <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('timemodified')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l582"><span class="linenum"> 582</span></a>                      <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('mnethostid')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/mnethostid.html">mnethostid</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/mnet_localhost_id.html">mnet_localhost_id</a>;
<a name="l583"><span class="linenum"> 583</span></a>                      <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('user', <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>);
<a name="l584"><span class="linenum"> 584</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Created user <a class="function" onClick="logFunction('record')" href="../../_functions/record.html" onMouseOver="funcPopup(event,'record')">record</a> ('.<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>.') for user '<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>' (ID number <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>).&quot;);
<a name="l585"><span class="linenum"> 585</span></a>                  }
<a name="l586"><span class="linenum"> 586</span></a>              } else if (<a class="var it16166" onMouseOver="hilite(16166)" onMouseOut="lolite()" onClick="logVariable('createnewusers')" href="../../_variables/createnewusers.html">$createnewusers</a>) {
<a name="l587"><span class="linenum"> 587</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;User record already exists for user '<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>' (ID number <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>).&quot;);
<a name="l588"><span class="linenum"> 588</span></a>  
<a name="l589"><span class="linenum"> 589</span></a>  <span class="comment">                // It is totally wrong to mess with deleted users flag directly in database!!!</span>
<a name="l590"><span class="linenum"> 590</span></a>  <span class="comment">                // There is no official way to undelete user, sorry..</span>
<a name="l591"><span class="linenum"> 591</span></a>              } else {
<a name="l592"><span class="linenum"> 592</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;No user record found for '<a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('username')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>' (ID number <a class="var it16168" onMouseOver="hilite(16168)" onMouseOut="lolite()" onClick="logVariable('person')" href="../../_variables/person.html">$person</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44923" onMouseOver="hilite(44923)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>).&quot;);
<a name="l593"><span class="linenum"> 593</span></a>              }
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>          }
<a name="l596"><span class="linenum"> 596</span></a>  
<a name="l597"><span class="linenum"> 597</span></a>      }
<a name="l598"><span class="linenum"> 598</span></a>  
<a name="l599"><span class="linenum"> 599</span></a>      <span class="comment">/**</span>
<a name="l600"><span class="linenum"> 600</span></a>  <span class="comment">     * Process the membership tag. This defines whether the specified Moodle users</span>
<a name="l601"><span class="linenum"> 601</span></a>  <span class="comment">     * should be added/removed as teachers/students.</span>
<a name="l602"><span class="linenum"> 602</span></a>  <span class="comment">     *</span>
<a name="l603"><span class="linenum"> 603</span></a>  <span class="comment">     * @param string $tagcontents The raw contents of the XML element</span>
<a name="l604"><span class="linenum"> 604</span></a>  <span class="comment">     */</span>
<a name="l605"><span class="linenum"> 605</span></a>      protected function <a class="function" onClick="logFunction('process_membership_tag')" href="../../_functions/process_membership_tag.html" onMouseOver="funcPopup(event,'process_membership_tag')">process_membership_tag</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>) {
<a name="l606"><span class="linenum"> 606</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l607"><span class="linenum"> 607</span></a>  
<a name="l608"><span class="linenum"> 608</span></a>  <span class="comment">        // Get plugin configs.</span>
<a name="l609"><span class="linenum"> 609</span></a>          <a class="var it16152" onMouseOver="hilite(16152)" onMouseOut="lolite()" onClick="logVariable('truncatecoursecodes')" href="../../_variables/truncatecoursecodes.html">$truncatecoursecodes</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('truncatecoursecodes');
<a name="l610"><span class="linenum"> 610</span></a>          <a class="var it16169" onMouseOver="hilite(16169)" onMouseOut="lolite()" onClick="logVariable('imscapitafix')" href="../../_variables/imscapitafix.html">$imscapitafix</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('imscapitafix');
<a name="l611"><span class="linenum"> 611</span></a>  
<a name="l612"><span class="linenum"> 612</span></a>          <a class="var it16170" onMouseOver="hilite(16170)" onMouseOut="lolite()" onClick="logVariable('memberstally')" href="../../_variables/memberstally.html">$memberstally</a> = 0;
<a name="l613"><span class="linenum"> 613</span></a>          <a class="var it16171" onMouseOver="hilite(16171)" onMouseOut="lolite()" onClick="logVariable('membersuntally')" href="../../_variables/membersuntally.html">$membersuntally</a> = 0;
<a name="l614"><span class="linenum"> 614</span></a>  
<a name="l615"><span class="linenum"> 615</span></a>  <span class="comment">        // In order to reduce the number of db queries required, group name/id associations are cached in this array.</span>
<a name="l616"><span class="linenum"> 616</span></a>          <a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a> = array();
<a name="l617"><span class="linenum"> 617</span></a>  
<a name="l618"><span class="linenum"> 618</span></a>          <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a> = new stdClass();
<a name="l619"><span class="linenum"> 619</span></a>  
<a name="l620"><span class="linenum"> 620</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;sourcedid&gt;.*?&lt;id&gt;(.+?)&lt;/id&gt;.*?&lt;/sourcedid&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l621"><span class="linenum"> 621</span></a>              <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('coursecode')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a> = (<a class="var it16152" onMouseOver="hilite(16152)" onMouseOut="lolite()" onClick="logVariable('truncatecoursecodes')" href="../../_variables/truncatecoursecodes.html">$truncatecoursecodes</a> &gt; 0)
<a name="l622"><span class="linenum"> 622</span></a>                  ? <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]), 0, <a class="phpfunction" onClick="logFunction('intval')" href="../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it16152" onMouseOver="hilite(16152)" onMouseOut="lolite()" onClick="logVariable('truncatecoursecodes')" href="../../_variables/truncatecoursecodes.html">$truncatecoursecodes</a>))
<a name="l623"><span class="linenum"> 623</span></a>                  : <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l624"><span class="linenum"> 624</span></a>              <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('courseid')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('course', 'id', array('idnumber' =&gt; <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('coursecode')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a>));
<a name="l625"><span class="linenum"> 625</span></a>          }
<a name="l626"><span class="linenum"> 626</span></a>          if (<a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('courseid')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('preg_match_all')" href="../../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>('{&lt;member&gt;(.*?)&lt;/member&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it16173" onMouseOver="hilite(16173)" onMouseOut="lolite()" onClick="logVariable('membermatches')" href="../../_variables/membermatches.html">$membermatches</a>, PREG_SET_ORDER)) {
<a name="l627"><span class="linenum"> 627</span></a>              <a class="var it16174" onMouseOver="hilite(16174)" onMouseOut="lolite()" onClick="logVariable('courseobj')" href="../../_variables/courseobj.html">$courseobj</a> = new stdClass();
<a name="l628"><span class="linenum"> 628</span></a>              <a class="var it16174" onMouseOver="hilite(16174)" onMouseOut="lolite()" onClick="logVariable('courseobj')" href="../../_variables/courseobj.html">$courseobj</a>-&gt;<a onClick="logVariable('id')" class="var it44925" onMouseOver="hilite(44925)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('courseid')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>;
<a name="l629"><span class="linenum"> 629</span></a>  
<a name="l630"><span class="linenum"> 630</span></a>              foreach (<a class="var it16173" onMouseOver="hilite(16173)" onMouseOut="lolite()" onClick="logVariable('membermatches')" href="../../_variables/membermatches.html">$membermatches</a> as <a class="var it16175" onMouseOver="hilite(16175)" onMouseOut="lolite()" onClick="logVariable('mmatch')" href="../../_variables/mmatch.html">$mmatch</a>) {
<a name="l631"><span class="linenum"> 631</span></a>                  <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a> = new stdClass();
<a name="l632"><span class="linenum"> 632</span></a>                  <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a> = new stdClass();
<a name="l633"><span class="linenum"> 633</span></a>                  <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l634"><span class="linenum"> 634</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;sourcedid&gt;.*?&lt;id&gt;(.+?)&lt;/id&gt;.*?&lt;/sourcedid&gt;}is', <a class="var it16175" onMouseOver="hilite(16175)" onMouseOut="lolite()" onClick="logVariable('mmatch')" href="../../_variables/mmatch.html">$mmatch</a>[1], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l635"><span class="linenum"> 635</span></a>                      <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('idnumber')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l636"><span class="linenum"> 636</span></a>                  }
<a name="l637"><span class="linenum"> 637</span></a>  
<a name="l638"><span class="linenum"> 638</span></a>                  <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l639"><span class="linenum"> 639</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;role\s+roletype=[&quot;\'](.+?)[&quot;\'].*?&gt;}is', <a class="var it16175" onMouseOver="hilite(16175)" onMouseOut="lolite()" onClick="logVariable('mmatch')" href="../../_variables/mmatch.html">$mmatch</a>[1], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l640"><span class="linenum"> 640</span></a>  <span class="comment">                    // 01 means Student, 02 means Instructor, 3 means ContentDeveloper, and there are more besides.</span>
<a name="l641"><span class="linenum"> 641</span></a>                      <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('roletype')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/roletype.html">roletype</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l642"><span class="linenum"> 642</span></a>                  } else if (<a class="var it16169" onMouseOver="hilite(16169)" onMouseOut="lolite()" onClick="logVariable('imscapitafix')" href="../../_variables/imscapitafix.html">$imscapitafix</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;roletype&gt;(.+?)&lt;/roletype&gt;}is', <a class="var it16175" onMouseOver="hilite(16175)" onMouseOut="lolite()" onClick="logVariable('mmatch')" href="../../_variables/mmatch.html">$mmatch</a>[1], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l643"><span class="linenum"> 643</span></a>  <span class="comment">                    // The XML that comes out of Capita Student Records seems to contain a misinterpretation of</span>
<a name="l644"><span class="linenum"> 644</span></a>  <span class="comment">                    // the IMS specification! 01 means Student, 02 means Instructor, 3 means ContentDeveloper,</span>
<a name="l645"><span class="linenum"> 645</span></a>  <span class="comment">                    // and there are more besides.</span>
<a name="l646"><span class="linenum"> 646</span></a>                      <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('roletype')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/roletype.html">roletype</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l647"><span class="linenum"> 647</span></a>                  }
<a name="l648"><span class="linenum"> 648</span></a>  
<a name="l649"><span class="linenum"> 649</span></a>                  <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l650"><span class="linenum"> 650</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;role\b.*?&lt;status&gt;(.+?)&lt;/status&gt;.*?&lt;/role&gt;}is', <a class="var it16175" onMouseOver="hilite(16175)" onMouseOut="lolite()" onClick="logVariable('mmatch')" href="../../_variables/mmatch.html">$mmatch</a>[1], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">                    // 1 means active, 0 means inactive - treat this as enrol vs unenrol.</span>
<a name="l652"><span class="linenum"> 652</span></a>                      <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('status')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l653"><span class="linenum"> 653</span></a>                  }
<a name="l654"><span class="linenum"> 654</span></a>  
<a name="l655"><span class="linenum"> 655</span></a>                  <a class="var it16158" onMouseOver="hilite(16158)" onMouseOut="lolite()" onClick="logVariable('recstatus')" href="../../_variables/recstatus.html">$recstatus</a> = (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_recstatus')" href="../../_functions/get_recstatus.html" onMouseOver="funcPopup(event,'get_recstatus')">get_recstatus</a>(<a class="var it16175" onMouseOver="hilite(16175)" onMouseOut="lolite()" onClick="logVariable('mmatch')" href="../../_variables/mmatch.html">$mmatch</a>[1], 'role'));
<a name="l656"><span class="linenum"> 656</span></a>                  if (<a class="var it16158" onMouseOver="hilite(16158)" onMouseOut="lolite()" onClick="logVariable('recstatus')" href="../../_variables/recstatus.html">$recstatus</a> == self::IMSENTERPRISE_DELETE) {
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment">                    // See above - recstatus of 3 (==delete) is treated the same as status of 0.</span>
<a name="l658"><span class="linenum"> 658</span></a>                      <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('status')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = 0;
<a name="l659"><span class="linenum"> 659</span></a>                  }
<a name="l660"><span class="linenum"> 660</span></a>  
<a name="l661"><span class="linenum"> 661</span></a>                  <a class="var it16179" onMouseOver="hilite(16179)" onMouseOut="lolite()" onClick="logVariable('timeframe')" href="../../_variables/timeframe.html">$timeframe</a> = new stdClass();
<a name="l662"><span class="linenum"> 662</span></a>                  <a class="var it16179" onMouseOver="hilite(16179)" onMouseOut="lolite()" onClick="logVariable('timeframe')" href="../../_variables/timeframe.html">$timeframe</a>-&gt;<a onClick="logVariable('begin')" class="var it44926" onMouseOver="hilite(44926)" onMouseOut="lolite()" href="../../_variables/begin.html">begin</a> = 0;
<a name="l663"><span class="linenum"> 663</span></a>                  <a class="var it16179" onMouseOver="hilite(16179)" onMouseOut="lolite()" onClick="logVariable('timeframe')" href="../../_variables/timeframe.html">$timeframe</a>-&gt;<a onClick="logVariable('end')" class="var it44926" onMouseOver="hilite(44926)" onMouseOut="lolite()" href="../../_variables/end.html">end</a> = 0;
<a name="l664"><span class="linenum"> 664</span></a>                  <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l665"><span class="linenum"> 665</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;role\b.*?&lt;timeframe&gt;(.+?)&lt;/timeframe&gt;.*?&lt;/role&gt;}is', <a class="var it16175" onMouseOver="hilite(16175)" onMouseOut="lolite()" onClick="logVariable('mmatch')" href="../../_variables/mmatch.html">$mmatch</a>[1], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l666"><span class="linenum"> 666</span></a>                      <a class="var it16179" onMouseOver="hilite(16179)" onMouseOut="lolite()" onClick="logVariable('timeframe')" href="../../_variables/timeframe.html">$timeframe</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('decode_timeframe')" href="../../_functions/decode_timeframe.html" onMouseOver="funcPopup(event,'decode_timeframe')">decode_timeframe</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l667"><span class="linenum"> 667</span></a>                  }
<a name="l668"><span class="linenum"> 668</span></a>  
<a name="l669"><span class="linenum"> 669</span></a>                  <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l670"><span class="linenum"> 670</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;role\b.*?&lt;extension&gt;.*?&lt;cohort&gt;(.+?)&lt;/cohort&gt;.*?&lt;/extension&gt;.*?&lt;/role&gt;}is',
<a name="l671"><span class="linenum"> 671</span></a>                          <a class="var it16175" onMouseOver="hilite(16175)" onMouseOut="lolite()" onClick="logVariable('mmatch')" href="../../_variables/mmatch.html">$mmatch</a>[1], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l672"><span class="linenum"> 672</span></a>                      <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupname')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupname.html">groupname</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l673"><span class="linenum"> 673</span></a>  <span class="comment">                    // The actual processing (ensuring a group record exists, etc) occurs below, in the enrol-a-student clause.</span>
<a name="l674"><span class="linenum"> 674</span></a>                  }
<a name="l675"><span class="linenum"> 675</span></a>  
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment">                // Add or remove this student or teacher to the course...</span>
<a name="l677"><span class="linenum"> 677</span></a>                  <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('userid')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('user', 'id', array('idnumber' =&gt; <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('idnumber')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>));
<a name="l678"><span class="linenum"> 678</span></a>                  <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('enrol')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a> = 'imsenterprise';
<a name="l679"><span class="linenum"> 679</span></a>                  <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('course')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> = <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('courseid')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>;
<a name="l680"><span class="linenum"> 680</span></a>                  <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('time')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/time.html">time</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l681"><span class="linenum"> 681</span></a>                  <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('timemodified')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l682"><span class="linenum"> 682</span></a>                  if (<a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('userid')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>) {
<a name="l683"><span class="linenum"> 683</span></a>  
<a name="l684"><span class="linenum"> 684</span></a>  <span class="comment">                    // Decide the &quot;real&quot; role (i.e. the Moodle role) that this user should be assigned to.</span>
<a name="l685"><span class="linenum"> 685</span></a>  <span class="comment">                    // Zero means this roletype is supposed to be skipped.</span>
<a name="l686"><span class="linenum"> 686</span></a>                      <a class="var it16181" onMouseOver="hilite(16181)" onMouseOut="lolite()" onClick="logVariable('moodleroleid')" href="../../_variables/moodleroleid.html">$moodleroleid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('rolemappings')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/rolemappings.html">rolemappings</a>[<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('roletype')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/roletype.html">roletype</a>];
<a name="l687"><span class="linenum"> 687</span></a>                      if (!<a class="var it16181" onMouseOver="hilite(16181)" onMouseOut="lolite()" onClick="logVariable('moodleroleid')" href="../../_variables/moodleroleid.html">$moodleroleid</a>) {
<a name="l688"><span class="linenum"> 688</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;SKIPPING role <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('roletype')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/roletype.html">roletype</a> for <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('userid')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> &quot;
<a name="l689"><span class="linenum"> 689</span></a>                              .&quot;(<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('idnumber')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>) in course <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('course')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>&quot;);
<a name="l690"><span class="linenum"> 690</span></a>                          continue;
<a name="l691"><span class="linenum"> 691</span></a>                      }
<a name="l692"><span class="linenum"> 692</span></a>  
<a name="l693"><span class="linenum"> 693</span></a>                      if (<a class="phpfunction" onClick="logFunction('intval')" href="../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('status')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>) == 1) {
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment">                        // Enrol the member.</span>
<a name="l695"><span class="linenum"> 695</span></a>  
<a name="l696"><span class="linenum"> 696</span></a>                          <a class="var it16182" onMouseOver="hilite(16182)" onMouseOut="lolite()" onClick="logVariable('einstance')" href="../../_variables/einstance.html">$einstance</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('enrol',
<a name="l697"><span class="linenum"> 697</span></a>                              array('courseid' =&gt; <a class="var it16174" onMouseOver="hilite(16174)" onMouseOut="lolite()" onClick="logVariable('courseobj')" href="../../_variables/courseobj.html">$courseobj</a>-&gt;<a onClick="logVariable('id')" class="var it44925" onMouseOver="hilite(44925)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'enrol' =&gt; <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('enrol')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>));
<a name="l698"><span class="linenum"> 698</span></a>                          if (empty(<a class="var it16182" onMouseOver="hilite(16182)" onMouseOut="lolite()" onClick="logVariable('einstance')" href="../../_variables/einstance.html">$einstance</a>)) {
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment">                            // Only add an enrol instance to the course if non-existent.</span>
<a name="l700"><span class="linenum"> 700</span></a>                              <a class="var it1439" onMouseOver="hilite(1439)" onMouseOut="lolite()" onClick="logVariable('enrolid')" href="../../_variables/enrolid.html">$enrolid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_instance')" href="../../_functions/add_instance.html" onMouseOver="funcPopup(event,'add_instance')">add_instance</a>(<a class="var it16174" onMouseOver="hilite(16174)" onMouseOut="lolite()" onClick="logVariable('courseobj')" href="../../_variables/courseobj.html">$courseobj</a>);
<a name="l701"><span class="linenum"> 701</span></a>                              <a class="var it16182" onMouseOver="hilite(16182)" onMouseOut="lolite()" onClick="logVariable('einstance')" href="../../_variables/einstance.html">$einstance</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('enrol', array('id' =&gt; <a class="var it1439" onMouseOver="hilite(1439)" onMouseOut="lolite()" onClick="logVariable('enrolid')" href="../../_variables/enrolid.html">$enrolid</a>));
<a name="l702"><span class="linenum"> 702</span></a>                          }
<a name="l703"><span class="linenum"> 703</span></a>  
<a name="l704"><span class="linenum"> 704</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it16182" onMouseOver="hilite(16182)" onMouseOut="lolite()" onClick="logVariable('einstance')" href="../../_variables/einstance.html">$einstance</a>, <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('userid')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, <a class="var it16181" onMouseOver="hilite(16181)" onMouseOut="lolite()" onClick="logVariable('moodleroleid')" href="../../_variables/moodleroleid.html">$moodleroleid</a>, <a class="var it16179" onMouseOver="hilite(16179)" onMouseOut="lolite()" onClick="logVariable('timeframe')" href="../../_variables/timeframe.html">$timeframe</a>-&gt;<a onClick="logVariable('begin')" class="var it44926" onMouseOver="hilite(44926)" onMouseOut="lolite()" href="../../_variables/begin.html">begin</a>, <a class="var it16179" onMouseOver="hilite(16179)" onMouseOut="lolite()" onClick="logVariable('timeframe')" href="../../_variables/timeframe.html">$timeframe</a>-&gt;<a onClick="logVariable('end')" class="var it44926" onMouseOver="hilite(44926)" onMouseOut="lolite()" href="../../_variables/end.html">end</a>);
<a name="l705"><span class="linenum"> 705</span></a>  
<a name="l706"><span class="linenum"> 706</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Enrolled user #<a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('userid')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> (<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('idnumber')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>) &quot;
<a name="l707"><span class="linenum"> 707</span></a>                              .&quot;to role <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('roletype')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/roletype.html">roletype</a> in course <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('course')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>&quot;);
<a name="l708"><span class="linenum"> 708</span></a>                          <a class="var it16170" onMouseOver="hilite(16170)" onMouseOut="lolite()" onClick="logVariable('memberstally')" href="../../_variables/memberstally.html">$memberstally</a>++;
<a name="l709"><span class="linenum"> 709</span></a>  
<a name="l710"><span class="linenum"> 710</span></a>  <span class="comment">                        // At this point we can also ensure the group membership is recorded if present.</span>
<a name="l711"><span class="linenum"> 711</span></a>                          if (isset(<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupname')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupname.html">groupname</a>)) {
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment">                            // Create the group if it doesn't exist - either way, make sure we know the group ID.</span>
<a name="l713"><span class="linenum"> 713</span></a>                              if (isset(<a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a>[<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupname')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupname.html">groupname</a>])) {
<a name="l714"><span class="linenum"> 714</span></a>                                  <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupid')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> = <a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a>[<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupname')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupname.html">groupname</a>]; <span class="comment">// Recall the group ID from cache if available.</span>
<a name="l715"><span class="linenum"> 715</span></a>                              } else {
<a name="l716"><span class="linenum"> 716</span></a>                                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('courseid' =&gt; <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('courseid')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, 'name' =&gt; <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupname')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupname.html">groupname</a>);
<a name="l717"><span class="linenum"> 717</span></a>                                  if (<a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('groups', 'id', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l718"><span class="linenum"> 718</span></a>                                      <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupid')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l719"><span class="linenum"> 719</span></a>                                      <a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a>[<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupname')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupname.html">groupname</a>] = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>; <span class="comment">// Store ID in cache.</span>
<a name="l720"><span class="linenum"> 720</span></a>                                  } else {
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment">                                    // Attempt to create the group.</span>
<a name="l722"><span class="linenum"> 722</span></a>                                      <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a> = new stdClass();
<a name="l723"><span class="linenum"> 723</span></a>                                      <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('name')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupname')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupname.html">groupname</a>;
<a name="l724"><span class="linenum"> 724</span></a>                                      <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('courseid')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a> = <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('courseid')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>;
<a name="l725"><span class="linenum"> 725</span></a>                                      <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l726"><span class="linenum"> 726</span></a>                                      <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l727"><span class="linenum"> 727</span></a>                                      <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('groups', <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>);
<a name="l728"><span class="linenum"> 728</span></a>                                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('Added a new group for this course: '.<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('name')" class="var it42906" onMouseOver="hilite(42906)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>);
<a name="l729"><span class="linenum"> 729</span></a>                                      <a class="var it1979" onMouseOver="hilite(1979)" onMouseOut="lolite()" onClick="logVariable('groupids')" href="../../_variables/groupids.html">$groupids</a>[<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupname')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupname.html">groupname</a>] = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>; <span class="comment">// Store ID in cache.</span>
<a name="l730"><span class="linenum"> 730</span></a>                                      <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupid')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a> = <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>;
<a name="l731"><span class="linenum"> 731</span></a>  <span class="comment">                                    // Invalidate the course group data cache just in case.</span>
<a name="l732"><span class="linenum"> 732</span></a>                                      <a class="class" onClick="logClass('cache_helper')" href="../../_classes/cache_helper.html" onMouseOver="classPopup(event,'cache_helper')">cache_helper</a>::<a class="function" onClick="logFunction('invalidate_by_definition')" href="../../_functions/invalidate_by_definition.html" onMouseOver="funcPopup(event,'invalidate_by_definition')">invalidate_by_definition</a>('core', 'groupdata', array(), array(<a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('courseid')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l733"><span class="linenum"> 733</span></a>                                  }
<a name="l734"><span class="linenum"> 734</span></a>                              }
<a name="l735"><span class="linenum"> 735</span></a>  <span class="comment">                            // Add the user-to-group association if it doesn't already exist.</span>
<a name="l736"><span class="linenum"> 736</span></a>                              if (<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupid')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>) {
<a name="l737"><span class="linenum"> 737</span></a>                                  <a class="function" onClick="logFunction('groups_add_member')" href="../../_functions/groups_add_member.html" onMouseOver="funcPopup(event,'groups_add_member')">groups_add_member</a>(<a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('groupid')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/groupid.html">groupid</a>, <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('userid')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>,
<a name="l738"><span class="linenum"> 738</span></a>                                      'enrol_imsenterprise', <a class="var it16182" onMouseOver="hilite(16182)" onMouseOut="lolite()" onClick="logVariable('einstance')" href="../../_variables/einstance.html">$einstance</a>-&gt;<a onClick="logVariable('id')" class="var it44928" onMouseOver="hilite(44928)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l739"><span class="linenum"> 739</span></a>                              }
<a name="l740"><span class="linenum"> 740</span></a>                          }
<a name="l741"><span class="linenum"> 741</span></a>  
<a name="l742"><span class="linenum"> 742</span></a>                      } else if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('imsunenrol')) {
<a name="l743"><span class="linenum"> 743</span></a>  <span class="comment">                        // Unenrol member.</span>
<a name="l744"><span class="linenum"> 744</span></a>  
<a name="l745"><span class="linenum"> 745</span></a>                          <a class="var it16183" onMouseOver="hilite(16183)" onMouseOut="lolite()" onClick="logVariable('einstances')" href="../../_variables/einstances.html">$einstances</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('enrol',
<a name="l746"><span class="linenum"> 746</span></a>                              array('enrol' =&gt; <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('enrol')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/enrol.html">enrol</a>, 'courseid' =&gt; <a class="var it16174" onMouseOver="hilite(16174)" onMouseOut="lolite()" onClick="logVariable('courseobj')" href="../../_variables/courseobj.html">$courseobj</a>-&gt;<a onClick="logVariable('id')" class="var it44925" onMouseOver="hilite(44925)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l747"><span class="linenum"> 747</span></a>                          foreach (<a class="var it16183" onMouseOver="hilite(16183)" onMouseOut="lolite()" onClick="logVariable('einstances')" href="../../_variables/einstances.html">$einstances</a> as <a class="var it16182" onMouseOver="hilite(16182)" onMouseOut="lolite()" onClick="logVariable('einstance')" href="../../_variables/einstance.html">$einstance</a>) {
<a name="l748"><span class="linenum"> 748</span></a>  <span class="comment">                            // Unenrol the user from all imsenterprise enrolment instances.</span>
<a name="l749"><span class="linenum"> 749</span></a>                              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('unenrol_user')" href="../../_functions/unenrol_user.html" onMouseOver="funcPopup(event,'unenrol_user')">unenrol_user</a>(<a class="var it16182" onMouseOver="hilite(16182)" onMouseOut="lolite()" onClick="logVariable('einstance')" href="../../_variables/einstance.html">$einstance</a>, <a class="var it16177" onMouseOver="hilite(16177)" onMouseOut="lolite()" onClick="logVariable('memberstoreobj')" href="../../_variables/memberstoreobj.html">$memberstoreobj</a>-&gt;<a onClick="logVariable('userid')" class="var it44927" onMouseOver="hilite(44927)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l750"><span class="linenum"> 750</span></a>                          }
<a name="l751"><span class="linenum"> 751</span></a>  
<a name="l752"><span class="linenum"> 752</span></a>                          <a class="var it16171" onMouseOver="hilite(16171)" onMouseOut="lolite()" onClick="logVariable('membersuntally')" href="../../_variables/membersuntally.html">$membersuntally</a>++;
<a name="l753"><span class="linenum"> 753</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Unenrolled <a class="var it16176" onMouseOver="hilite(16176)" onMouseOut="lolite()" onClick="logVariable('member')" href="../../_variables/member.html">$member</a>-&gt;<a onClick="logVariable('idnumber')" class="var it43826" onMouseOver="hilite(43826)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a> from role <a class="var it16181" onMouseOver="hilite(16181)" onMouseOut="lolite()" onClick="logVariable('moodleroleid')" href="../../_variables/moodleroleid.html">$moodleroleid</a> in course&quot;);
<a name="l754"><span class="linenum"> 754</span></a>                      }
<a name="l755"><span class="linenum"> 755</span></a>  
<a name="l756"><span class="linenum"> 756</span></a>                  }
<a name="l757"><span class="linenum"> 757</span></a>              }
<a name="l758"><span class="linenum"> 758</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Added <a class="var it16170" onMouseOver="hilite(16170)" onMouseOut="lolite()" onClick="logVariable('memberstally')" href="../../_variables/memberstally.html">$memberstally</a> users to course <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('coursecode')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a>&quot;);
<a name="l759"><span class="linenum"> 759</span></a>              if (<a class="var it16171" onMouseOver="hilite(16171)" onMouseOut="lolite()" onClick="logVariable('membersuntally')" href="../../_variables/membersuntally.html">$membersuntally</a> &gt; 0) {
<a name="l760"><span class="linenum"> 760</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Removed <a class="var it16171" onMouseOver="hilite(16171)" onMouseOut="lolite()" onClick="logVariable('membersuntally')" href="../../_variables/membersuntally.html">$membersuntally</a> users from course <a class="var it16172" onMouseOver="hilite(16172)" onMouseOut="lolite()" onClick="logVariable('ship')" href="../../_variables/ship.html">$ship</a>-&gt;<a onClick="logVariable('coursecode')" class="var it44924" onMouseOver="hilite(44924)" onMouseOut="lolite()" href="../../_variables/coursecode.html">coursecode</a>&quot;);
<a name="l761"><span class="linenum"> 761</span></a>              }
<a name="l762"><span class="linenum"> 762</span></a>          }
<a name="l763"><span class="linenum"> 763</span></a>      } <span class="comment">// End process_membership_tag().</span>
<a name="l764"><span class="linenum"> 764</span></a>  
<a name="l765"><span class="linenum"> 765</span></a>      <span class="comment">/**</span>
<a name="l766"><span class="linenum"> 766</span></a>  <span class="comment">     * Process the properties tag. The only data from this element</span>
<a name="l767"><span class="linenum"> 767</span></a>  <span class="comment">     * that is relevant is whether a &lt;target&gt; is specified.</span>
<a name="l768"><span class="linenum"> 768</span></a>  <span class="comment">     *</span>
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment">     * @param string $tagcontents The raw contents of the XML element</span>
<a name="l770"><span class="linenum"> 770</span></a>  <span class="comment">     */</span>
<a name="l771"><span class="linenum"> 771</span></a>      protected function <a class="function" onClick="logFunction('process_properties_tag')" href="../../_functions/process_properties_tag.html" onMouseOver="funcPopup(event,'process_properties_tag')">process_properties_tag</a>(<a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>) {
<a name="l772"><span class="linenum"> 772</span></a>          <a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('imsrestricttarget')" href="../../_variables/imsrestricttarget.html">$imsrestricttarget</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('imsrestricttarget');
<a name="l773"><span class="linenum"> 773</span></a>  
<a name="l774"><span class="linenum"> 774</span></a>          if (<a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('imsrestricttarget')" href="../../_variables/imsrestricttarget.html">$imsrestricttarget</a>) {
<a name="l775"><span class="linenum"> 775</span></a>              if (!(<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;target&gt;'.<a class="phpfunction" onClick="logFunction('preg_quote')" href="../../_functions/preg_quote.html" onMouseOver="phpfuncPopup(event,'preg_quote')">preg_quote</a>(<a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('imsrestricttarget')" href="../../_variables/imsrestricttarget.html">$imsrestricttarget</a>).'&lt;/target&gt;}is', <a class="var it16148" onMouseOver="hilite(16148)" onMouseOut="lolite()" onClick="logVariable('tagcontents')" href="../../_variables/tagcontents.html">$tagcontents</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>))) {
<a name="l776"><span class="linenum"> 776</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Skipping processing: required target \&quot;<a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('imsrestricttarget')" href="../../_variables/imsrestricttarget.html">$imsrestricttarget</a>\&quot; not specified in this data.&quot;);
<a name="l777"><span class="linenum"> 777</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('continueprocessing')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/continueprocessing.html">continueprocessing</a> = false;
<a name="l778"><span class="linenum"> 778</span></a>              }
<a name="l779"><span class="linenum"> 779</span></a>          }
<a name="l780"><span class="linenum"> 780</span></a>      }
<a name="l781"><span class="linenum"> 781</span></a>  
<a name="l782"><span class="linenum"> 782</span></a>      <span class="comment">/**</span>
<a name="l783"><span class="linenum"> 783</span></a>  <span class="comment">     * Store logging information. This does two things: uses the {@link mtrace()}</span>
<a name="l784"><span class="linenum"> 784</span></a>  <span class="comment">     * function to print info to screen/STDOUT, and also writes log to a text file</span>
<a name="l785"><span class="linenum"> 785</span></a>  <span class="comment">     * if a path has been specified.</span>
<a name="l786"><span class="linenum"> 786</span></a>  <span class="comment">     * @param string $string Text to write (newline will be added automatically)</span>
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment">     */</span>
<a name="l788"><span class="linenum"> 788</span></a>      protected function <a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(<a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>) {
<a name="l789"><span class="linenum"> 789</span></a>  
<a name="l790"><span class="linenum"> 790</span></a>          if (!<a class="constant" onClick="logConstant('PHPUNIT_TEST')" href="../../_constants/PHPUNIT_TEST.html" onMouseOver="constPopup(event,'PHPUNIT_TEST')">PHPUNIT_TEST</a>) {
<a name="l791"><span class="linenum"> 791</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>(<a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>);
<a name="l792"><span class="linenum"> 792</span></a>          }
<a name="l793"><span class="linenum"> 793</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('logfp')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/logfp.html">logfp</a>) {
<a name="l794"><span class="linenum"> 794</span></a>              <a class="phpfunction" onClick="logFunction('fwrite')" href="../../_functions/fwrite.html" onMouseOver="phpfuncPopup(event,'fwrite')">fwrite</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('logfp')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/logfp.html">logfp</a>, <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a> . &quot;\n&quot;);
<a name="l795"><span class="linenum"> 795</span></a>          }
<a name="l796"><span class="linenum"> 796</span></a>      }
<a name="l797"><span class="linenum"> 797</span></a>  
<a name="l798"><span class="linenum"> 798</span></a>      <span class="comment">/**</span>
<a name="l799"><span class="linenum"> 799</span></a>  <span class="comment">     * Process the INNER contents of a &lt;timeframe&gt; tag, to return beginning/ending dates.</span>
<a name="l800"><span class="linenum"> 800</span></a>  <span class="comment">     *</span>
<a name="l801"><span class="linenum"> 801</span></a>  <span class="comment">     * @param string $string tag to decode.</span>
<a name="l802"><span class="linenum"> 802</span></a>  <span class="comment">     * @return stdClass beginning and/or ending is returned, in unix time, zero indicating not specified.</span>
<a name="l803"><span class="linenum"> 803</span></a>  <span class="comment">     */</span>
<a name="l804"><span class="linenum"> 804</span></a>      protected static function <a class="function" onClick="logFunction('decode_timeframe')" href="../../_functions/decode_timeframe.html" onMouseOver="funcPopup(event,'decode_timeframe')">decode_timeframe</a>(<a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>) {
<a name="l805"><span class="linenum"> 805</span></a>          <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a> = new stdClass();
<a name="l806"><span class="linenum"> 806</span></a>          <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('begin')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/begin.html">begin</a> = <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('end')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/end.html">end</a> = 0;
<a name="l807"><span class="linenum"> 807</span></a>  <span class="comment">        // Explanatory note: The matching will ONLY match if the attribute restrict=&quot;1&quot;</span>
<a name="l808"><span class="linenum"> 808</span></a>  <span class="comment">        // because otherwise the time markers should be ignored (participation should be</span>
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment">        // allowed outside the period).</span>
<a name="l810"><span class="linenum"> 810</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;begin\s+restrict=&quot;1&quot;&gt;(\d\d\d\d)-(\d\d)-(\d\d)&lt;/begin&gt;}is', <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l811"><span class="linenum"> 811</span></a>              <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('begin')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/begin.html">begin</a> = <a class="phpfunction" onClick="logFunction('mktime')" href="../../_functions/mktime.html" onMouseOver="phpfuncPopup(event,'mktime')">mktime</a>(0, 0, 0, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[3], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l812"><span class="linenum"> 812</span></a>          }
<a name="l813"><span class="linenum"> 813</span></a>  
<a name="l814"><span class="linenum"> 814</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l815"><span class="linenum"> 815</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('{&lt;end\s+restrict=&quot;1&quot;&gt;(\d\d\d\d)-(\d\d)-(\d\d)&lt;/end&gt;}is', <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('string')" href="../../_variables/string.html">$string</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l816"><span class="linenum"> 816</span></a>              <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('end')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/end.html">end</a> = <a class="phpfunction" onClick="logFunction('mktime')" href="../../_functions/mktime.html" onMouseOver="phpfuncPopup(event,'mktime')">mktime</a>(0, 0, 0, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[3], <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]);
<a name="l817"><span class="linenum"> 817</span></a>          }
<a name="l818"><span class="linenum"> 818</span></a>          return <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>;
<a name="l819"><span class="linenum"> 819</span></a>      }
<a name="l820"><span class="linenum"> 820</span></a>  
<a name="l821"><span class="linenum"> 821</span></a>      <span class="comment">/**</span>
<a name="l822"><span class="linenum"> 822</span></a>  <span class="comment">     * Load the role mappings (from the config), so we can easily refer to</span>
<a name="l823"><span class="linenum"> 823</span></a>  <span class="comment">     * how an IMS-E role corresponds to a Moodle role</span>
<a name="l824"><span class="linenum"> 824</span></a>  <span class="comment">     */</span>
<a name="l825"><span class="linenum"> 825</span></a>      protected function <a class="function" onClick="logFunction('load_role_mappings')" href="../../_functions/load_role_mappings.html" onMouseOver="funcPopup(event,'load_role_mappings')">load_role_mappings</a>() {
<a name="l826"><span class="linenum"> 826</span></a>          <span class="keyword">require_once</span> <a class="filename" href="../../admin/tool/dbtransfer/locallib.php.html" onMouseOver="reqPopup(event, 'locallib.php', '../../admin/tool/dbtransfer/locallib.php')">('locallib.php')</a>;
<a name="l827"><span class="linenum"> 827</span></a>  
<a name="l828"><span class="linenum"> 828</span></a>          <a class="var it16185" onMouseOver="hilite(16185)" onMouseOut="lolite()" onClick="logVariable('imsroles')" href="../../_variables/imsroles.html">$imsroles</a> = <span class="keyword">new </span><a class="class" onClick="logClass('imsenterprise_roles')" href="../../_classes/imsenterprise_roles.html" onMouseOver="classPopup(event,'imsenterprise_roles')">imsenterprise_roles</a>();
<a name="l829"><span class="linenum"> 829</span></a>          <a class="var it16185" onMouseOver="hilite(16185)" onMouseOut="lolite()" onClick="logVariable('imsroles')" href="../../_variables/imsroles.html">$imsroles</a> = <a class="var it16185" onMouseOver="hilite(16185)" onMouseOut="lolite()" onClick="logVariable('imsroles')" href="../../_variables/imsroles.html">$imsroles</a>-&gt;<a class="function" onClick="logFunction('get_imsroles')" href="../../_functions/get_imsroles.html" onMouseOver="funcPopup(event,'get_imsroles')">get_imsroles</a>();
<a name="l830"><span class="linenum"> 830</span></a>  
<a name="l831"><span class="linenum"> 831</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('rolemappings')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/rolemappings.html">rolemappings</a> = array();
<a name="l832"><span class="linenum"> 832</span></a>          foreach (<a class="var it16185" onMouseOver="hilite(16185)" onMouseOut="lolite()" onClick="logVariable('imsroles')" href="../../_variables/imsroles.html">$imsroles</a> as <a class="var it16186" onMouseOver="hilite(16186)" onMouseOut="lolite()" onClick="logVariable('imsrolenum')" href="../../_variables/imsrolenum.html">$imsrolenum</a> =&gt; <a class="var it16187" onMouseOver="hilite(16187)" onMouseOut="lolite()" onClick="logVariable('imsrolename')" href="../../_variables/imsrolename.html">$imsrolename</a>) {
<a name="l833"><span class="linenum"> 833</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('rolemappings')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/rolemappings.html">rolemappings</a>[<a class="var it16186" onMouseOver="hilite(16186)" onMouseOut="lolite()" onClick="logVariable('imsrolenum')" href="../../_variables/imsrolenum.html">$imsrolenum</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('rolemappings')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/rolemappings.html">rolemappings</a>[<a class="var it16187" onMouseOver="hilite(16187)" onMouseOut="lolite()" onClick="logVariable('imsrolename')" href="../../_variables/imsrolename.html">$imsrolename</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('imsrolemap' . <a class="var it16186" onMouseOver="hilite(16186)" onMouseOut="lolite()" onClick="logVariable('imsrolenum')" href="../../_variables/imsrolenum.html">$imsrolenum</a>);
<a name="l834"><span class="linenum"> 834</span></a>          }
<a name="l835"><span class="linenum"> 835</span></a>      }
<a name="l836"><span class="linenum"> 836</span></a>  
<a name="l837"><span class="linenum"> 837</span></a>      <span class="comment">/**</span>
<a name="l838"><span class="linenum"> 838</span></a>  <span class="comment">     * Load the name mappings (from the config), so we can easily refer to</span>
<a name="l839"><span class="linenum"> 839</span></a>  <span class="comment">     * how an IMS-E course properties corresponds to a Moodle course properties</span>
<a name="l840"><span class="linenum"> 840</span></a>  <span class="comment">     */</span>
<a name="l841"><span class="linenum"> 841</span></a>      protected function <a class="function" onClick="logFunction('load_course_mappings')" href="../../_functions/load_course_mappings.html" onMouseOver="funcPopup(event,'load_course_mappings')">load_course_mappings</a>() {
<a name="l842"><span class="linenum"> 842</span></a>          <span class="keyword">require_once</span> <a class="filename" href="../../admin/tool/dbtransfer/locallib.php.html" onMouseOver="reqPopup(event, 'locallib.php', '../../admin/tool/dbtransfer/locallib.php')">('locallib.php')</a>;
<a name="l843"><span class="linenum"> 843</span></a>  
<a name="l844"><span class="linenum"> 844</span></a>          <a class="var it16188" onMouseOver="hilite(16188)" onMouseOut="lolite()" onClick="logVariable('imsnames')" href="../../_variables/imsnames.html">$imsnames</a> = <span class="keyword">new </span><a class="class" onClick="logClass('imsenterprise_courses')" href="../../_classes/imsenterprise_courses.html" onMouseOver="classPopup(event,'imsenterprise_courses')">imsenterprise_courses</a>();
<a name="l845"><span class="linenum"> 845</span></a>          <a class="var it16189" onMouseOver="hilite(16189)" onMouseOut="lolite()" onClick="logVariable('courseattrs')" href="../../_variables/courseattrs.html">$courseattrs</a> = <a class="var it16188" onMouseOver="hilite(16188)" onMouseOut="lolite()" onClick="logVariable('imsnames')" href="../../_variables/imsnames.html">$imsnames</a>-&gt;<a class="function" onClick="logFunction('get_courseattrs')" href="../../_functions/get_courseattrs.html" onMouseOver="funcPopup(event,'get_courseattrs')">get_courseattrs</a>();
<a name="l846"><span class="linenum"> 846</span></a>  
<a name="l847"><span class="linenum"> 847</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('coursemappings')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/coursemappings.html">coursemappings</a> = array();
<a name="l848"><span class="linenum"> 848</span></a>          foreach (<a class="var it16189" onMouseOver="hilite(16189)" onMouseOut="lolite()" onClick="logVariable('courseattrs')" href="../../_variables/courseattrs.html">$courseattrs</a> as <a class="var it16159" onMouseOver="hilite(16159)" onMouseOut="lolite()" onClick="logVariable('courseattr')" href="../../_variables/courseattr.html">$courseattr</a>) {
<a name="l849"><span class="linenum"> 849</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('coursemappings')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/coursemappings.html">coursemappings</a>[<a class="var it16159" onMouseOver="hilite(16159)" onMouseOut="lolite()" onClick="logVariable('courseattr')" href="../../_variables/courseattr.html">$courseattr</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('imscoursemap' . <a class="var it16159" onMouseOver="hilite(16159)" onMouseOut="lolite()" onClick="logVariable('courseattr')" href="../../_variables/courseattr.html">$courseattr</a>);
<a name="l850"><span class="linenum"> 850</span></a>          }
<a name="l851"><span class="linenum"> 851</span></a>      }
<a name="l852"><span class="linenum"> 852</span></a>  
<a name="l853"><span class="linenum"> 853</span></a>      <span class="comment">/**</span>
<a name="l854"><span class="linenum"> 854</span></a>  <span class="comment">     * Called whenever anybody tries (from the normal interface) to remove a group</span>
<a name="l855"><span class="linenum"> 855</span></a>  <span class="comment">     * member which is registered as being created by this component. (Not called</span>
<a name="l856"><span class="linenum"> 856</span></a>  <span class="comment">     * when deleting an entire group or course at once.)</span>
<a name="l857"><span class="linenum"> 857</span></a>  <span class="comment">     * @param int $itemid Item ID that was stored in the group_members entry</span>
<a name="l858"><span class="linenum"> 858</span></a>  <span class="comment">     * @param int $groupid Group ID</span>
<a name="l859"><span class="linenum"> 859</span></a>  <span class="comment">     * @param int $userid User ID being removed from group</span>
<a name="l860"><span class="linenum"> 860</span></a>  <span class="comment">     * @return bool True if the remove is permitted, false to give an error</span>
<a name="l861"><span class="linenum"> 861</span></a>  <span class="comment">     */</span>
<a name="l862"><span class="linenum"> 862</span></a>      public function <a class="function" onClick="logFunction('enrol_imsenterprise_allow_group_member_remove')" href="../../_functions/enrol_imsenterprise_allow_group_member_remove.html" onMouseOver="funcPopup(event,'enrol_imsenterprise_allow_group_member_remove')">enrol_imsenterprise_allow_group_member_remove</a>(<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l863"><span class="linenum"> 863</span></a>          return false;
<a name="l864"><span class="linenum"> 864</span></a>      }
<a name="l865"><span class="linenum"> 865</span></a>  
<a name="l866"><span class="linenum"> 866</span></a>  
<a name="l867"><span class="linenum"> 867</span></a>      <span class="comment">/**</span>
<a name="l868"><span class="linenum"> 868</span></a>  <span class="comment">     * Get the default category id (often known as 'Miscellaneous'),</span>
<a name="l869"><span class="linenum"> 869</span></a>  <span class="comment">     * statically cached to avoid multiple DB lookups on big imports.</span>
<a name="l870"><span class="linenum"> 870</span></a>  <span class="comment">     *</span>
<a name="l871"><span class="linenum"> 871</span></a>  <span class="comment">     * @return int id of default category.</span>
<a name="l872"><span class="linenum"> 872</span></a>  <span class="comment">     */</span>
<a name="l873"><span class="linenum"> 873</span></a>      private function <a class="function" onClick="logFunction('get_default_category_id')" href="../../_functions/get_default_category_id.html" onMouseOver="funcPopup(event,'get_default_category_id')">get_default_category_id</a>() {
<a name="l874"><span class="linenum"> 874</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l875"><span class="linenum"> 875</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/coursecatlib.php');
<a name="l876"><span class="linenum"> 876</span></a>  
<a name="l877"><span class="linenum"> 877</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('defaultcategoryid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/defaultcategoryid.html">defaultcategoryid</a> === null) {
<a name="l878"><span class="linenum"> 878</span></a>              <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a> = <a class="class" onClick="logClass('coursecat')" href="../../_classes/coursecat.html" onMouseOver="classPopup(event,'coursecat')">coursecat</a>::<a class="function" onClick="logFunction('get_default')" href="../../_functions/get_default.html" onMouseOver="funcPopup(event,'get_default')">get_default</a>();
<a name="l879"><span class="linenum"> 879</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('defaultcategoryid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/defaultcategoryid.html">defaultcategoryid</a> = <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('id')" class="var it42970" onMouseOver="hilite(42970)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l880"><span class="linenum"> 880</span></a>          }
<a name="l881"><span class="linenum"> 881</span></a>  
<a name="l882"><span class="linenum"> 882</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('defaultcategoryid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/defaultcategoryid.html">defaultcategoryid</a>;
<a name="l883"><span class="linenum"> 883</span></a>      }
<a name="l884"><span class="linenum"> 884</span></a>  
<a name="l885"><span class="linenum"> 885</span></a>      <span class="comment">/**</span>
<a name="l886"><span class="linenum"> 886</span></a>  <span class="comment">     * Find the category using idnumber or name.</span>
<a name="l887"><span class="linenum"> 887</span></a>  <span class="comment">     *</span>
<a name="l888"><span class="linenum"> 888</span></a>  <span class="comment">     * @param array $categories List of categories</span>
<a name="l889"><span class="linenum"> 889</span></a>  <span class="comment">     *</span>
<a name="l890"><span class="linenum"> 890</span></a>  <span class="comment">     * @return int id of category found.</span>
<a name="l891"><span class="linenum"> 891</span></a>  <span class="comment">     */</span>
<a name="l892"><span class="linenum"> 892</span></a>      private function <a class="function" onClick="logFunction('get_category_from_group')" href="../../_functions/get_category_from_group.html" onMouseOver="funcPopup(event,'get_category_from_group')">get_category_from_group</a>(<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../_variables/categories.html">$categories</a>) {
<a name="l893"><span class="linenum"> 893</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l894"><span class="linenum"> 894</span></a>  
<a name="l895"><span class="linenum"> 895</span></a>          if (empty(<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../_variables/categories.html">$categories</a>)) {
<a name="l896"><span class="linenum"> 896</span></a>              <a class="var it2604" onMouseOver="hilite(2604)" onMouseOut="lolite()" onClick="logVariable('catid')" href="../../_variables/catid.html">$catid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_default_category_id')" href="../../_functions/get_default_category_id.html" onMouseOver="funcPopup(event,'get_default_category_id')">get_default_category_id</a>();
<a name="l897"><span class="linenum"> 897</span></a>          } else {
<a name="l898"><span class="linenum"> 898</span></a>              <a class="var it16190" onMouseOver="hilite(16190)" onMouseOut="lolite()" onClick="logVariable('createnewcategories')" href="../../_variables/createnewcategories.html">$createnewcategories</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('createnewcategories');
<a name="l899"><span class="linenum"> 899</span></a>              <a class="var it16145" onMouseOver="hilite(16145)" onMouseOut="lolite()" onClick="logVariable('categoryseparator')" href="../../_variables/categoryseparator.html">$categoryseparator</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('categoryseparator'));
<a name="l900"><span class="linenum"> 900</span></a>              <a class="var it16191" onMouseOver="hilite(16191)" onMouseOut="lolite()" onClick="logVariable('nestedcategories')" href="../../_variables/nestedcategories.html">$nestedcategories</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('nestedcategories'));
<a name="l901"><span class="linenum"> 901</span></a>              <a class="var it16192" onMouseOver="hilite(16192)" onMouseOut="lolite()" onClick="logVariable('searchbyidnumber')" href="../../_variables/searchbyidnumber.html">$searchbyidnumber</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('categoryidnumber'));
<a name="l902"><span class="linenum"> 902</span></a>  
<a name="l903"><span class="linenum"> 903</span></a>              if (!empty(<a class="var it16145" onMouseOver="hilite(16145)" onMouseOut="lolite()" onClick="logVariable('categoryseparator')" href="../../_variables/categoryseparator.html">$categoryseparator</a>)) {
<a name="l904"><span class="linenum"> 904</span></a>                  <a class="var it2302" onMouseOver="hilite(2302)" onMouseOut="lolite()" onClick="logVariable('sep')" href="../../_variables/sep.html">$sep</a> = '{\\'.<a class="var it16145" onMouseOver="hilite(16145)" onMouseOut="lolite()" onClick="logVariable('categoryseparator')" href="../../_variables/categoryseparator.html">$categoryseparator</a>.'}';
<a name="l905"><span class="linenum"> 905</span></a>              }
<a name="l906"><span class="linenum"> 906</span></a>  
<a name="l907"><span class="linenum"> 907</span></a>              <a class="var it2604" onMouseOver="hilite(2604)" onMouseOut="lolite()" onClick="logVariable('catid')" href="../../_variables/catid.html">$catid</a> = 0;
<a name="l908"><span class="linenum"> 908</span></a>              <a class="var it16193" onMouseOver="hilite(16193)" onMouseOut="lolite()" onClick="logVariable('fullnestedcatname')" href="../../_variables/fullnestedcatname.html">$fullnestedcatname</a> = '';
<a name="l909"><span class="linenum"> 909</span></a>  
<a name="l910"><span class="linenum"> 910</span></a>              foreach (<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../_variables/categories.html">$categories</a> as <a class="var it16194" onMouseOver="hilite(16194)" onMouseOut="lolite()" onClick="logVariable('categoryinfo')" href="../../_variables/categoryinfo.html">$categoryinfo</a>) {
<a name="l911"><span class="linenum"> 911</span></a>                  if (<a class="var it16192" onMouseOver="hilite(16192)" onMouseOut="lolite()" onClick="logVariable('searchbyidnumber')" href="../../_variables/searchbyidnumber.html">$searchbyidnumber</a>) {
<a name="l912"><span class="linenum"> 912</span></a>                      <a class="var it753" onMouseOver="hilite(753)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a> = <a class="phpfunction" onClick="logFunction('preg_split')" href="../../_functions/preg_split.html" onMouseOver="phpfuncPopup(event,'preg_split')">preg_split</a>(<a class="var it2302" onMouseOver="hilite(2302)" onMouseOut="lolite()" onClick="logVariable('sep')" href="../../_variables/sep.html">$sep</a>, <a class="var it16194" onMouseOver="hilite(16194)" onMouseOut="lolite()" onClick="logVariable('categoryinfo')" href="../../_variables/categoryinfo.html">$categoryinfo</a>, -1, PREG_SPLIT_NO_EMPTY);
<a name="l913"><span class="linenum"> 913</span></a>                      if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it753" onMouseOver="hilite(753)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>) &lt; 2) {
<a name="l914"><span class="linenum"> 914</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('Category ' . <a class="var it16194" onMouseOver="hilite(16194)" onMouseOut="lolite()" onClick="logVariable('categoryinfo')" href="../../_variables/categoryinfo.html">$categoryinfo</a> . ' missing name or idnumber. Using default category instead.');
<a name="l915"><span class="linenum"> 915</span></a>                          <a class="var it2604" onMouseOver="hilite(2604)" onMouseOut="lolite()" onClick="logVariable('catid')" href="../../_variables/catid.html">$catid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_default_category_id')" href="../../_functions/get_default_category_id.html" onMouseOver="funcPopup(event,'get_default_category_id')">get_default_category_id</a>();
<a name="l916"><span class="linenum"> 916</span></a>                          break;
<a name="l917"><span class="linenum"> 917</span></a>                      }
<a name="l918"><span class="linenum"> 918</span></a>                      <a class="var it906" onMouseOver="hilite(906)" onMouseOut="lolite()" onClick="logVariable('categoryname')" href="../../_variables/categoryname.html">$categoryname</a> = <a class="var it753" onMouseOver="hilite(753)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>[0];
<a name="l919"><span class="linenum"> 919</span></a>                      <a class="var it16146" onMouseOver="hilite(16146)" onMouseOut="lolite()" onClick="logVariable('categoryidnumber')" href="../../_variables/categoryidnumber.html">$categoryidnumber</a> = <a class="var it753" onMouseOver="hilite(753)" onMouseOut="lolite()" onClick="logVariable('values')" href="../../_variables/values.html">$values</a>[1];
<a name="l920"><span class="linenum"> 920</span></a>                  } else {
<a name="l921"><span class="linenum"> 921</span></a>                      <a class="var it906" onMouseOver="hilite(906)" onMouseOut="lolite()" onClick="logVariable('categoryname')" href="../../_variables/categoryname.html">$categoryname</a> = <a class="var it16194" onMouseOver="hilite(16194)" onMouseOut="lolite()" onClick="logVariable('categoryinfo')" href="../../_variables/categoryinfo.html">$categoryinfo</a>;
<a name="l922"><span class="linenum"> 922</span></a>                      <a class="var it16146" onMouseOver="hilite(16146)" onMouseOut="lolite()" onClick="logVariable('categoryidnumber')" href="../../_variables/categoryidnumber.html">$categoryidnumber</a> = null;
<a name="l923"><span class="linenum"> 923</span></a>                      if (empty(<a class="var it906" onMouseOver="hilite(906)" onMouseOut="lolite()" onClick="logVariable('categoryname')" href="../../_variables/categoryname.html">$categoryname</a>)) {
<a name="l924"><span class="linenum"> 924</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('Category ' . <a class="var it16194" onMouseOver="hilite(16194)" onMouseOut="lolite()" onClick="logVariable('categoryinfo')" href="../../_variables/categoryinfo.html">$categoryinfo</a> . ' missing name. Using default category instead.');
<a name="l925"><span class="linenum"> 925</span></a>                          <a class="var it2604" onMouseOver="hilite(2604)" onMouseOut="lolite()" onClick="logVariable('catid')" href="../../_variables/catid.html">$catid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_default_category_id')" href="../../_functions/get_default_category_id.html" onMouseOver="funcPopup(event,'get_default_category_id')">get_default_category_id</a>();
<a name="l926"><span class="linenum"> 926</span></a>                          break;
<a name="l927"><span class="linenum"> 927</span></a>                      }
<a name="l928"><span class="linenum"> 928</span></a>                  }
<a name="l929"><span class="linenum"> 929</span></a>  
<a name="l930"><span class="linenum"> 930</span></a>                  if (!empty(<a class="var it16193" onMouseOver="hilite(16193)" onMouseOut="lolite()" onClick="logVariable('fullnestedcatname')" href="../../_variables/fullnestedcatname.html">$fullnestedcatname</a>)) {
<a name="l931"><span class="linenum"> 931</span></a>                      <a class="var it16193" onMouseOver="hilite(16193)" onMouseOut="lolite()" onClick="logVariable('fullnestedcatname')" href="../../_variables/fullnestedcatname.html">$fullnestedcatname</a> .= ' / ';
<a name="l932"><span class="linenum"> 932</span></a>                  }
<a name="l933"><span class="linenum"> 933</span></a>  
<a name="l934"><span class="linenum"> 934</span></a>                  <a class="var it16193" onMouseOver="hilite(16193)" onMouseOut="lolite()" onClick="logVariable('fullnestedcatname')" href="../../_variables/fullnestedcatname.html">$fullnestedcatname</a> .= <a class="var it906" onMouseOver="hilite(906)" onMouseOut="lolite()" onClick="logVariable('categoryname')" href="../../_variables/categoryname.html">$categoryname</a>;
<a name="l935"><span class="linenum"> 935</span></a>                  <a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a> = <a class="var it2604" onMouseOver="hilite(2604)" onMouseOut="lolite()" onClick="logVariable('catid')" href="../../_variables/catid.html">$catid</a>;
<a name="l936"><span class="linenum"> 936</span></a>  
<a name="l937"><span class="linenum"> 937</span></a>  <span class="comment">                // Check if category exist.</span>
<a name="l938"><span class="linenum"> 938</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l939"><span class="linenum"> 939</span></a>                  if (<a class="var it16192" onMouseOver="hilite(16192)" onMouseOut="lolite()" onClick="logVariable('searchbyidnumber')" href="../../_variables/searchbyidnumber.html">$searchbyidnumber</a>) {
<a name="l940"><span class="linenum"> 940</span></a>                      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['idnumber'] = <a class="var it16146" onMouseOver="hilite(16146)" onMouseOut="lolite()" onClick="logVariable('categoryidnumber')" href="../../_variables/categoryidnumber.html">$categoryidnumber</a>;
<a name="l941"><span class="linenum"> 941</span></a>                  } else {
<a name="l942"><span class="linenum"> 942</span></a>                      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['name'] = <a class="var it906" onMouseOver="hilite(906)" onMouseOut="lolite()" onClick="logVariable('categoryname')" href="../../_variables/categoryname.html">$categoryname</a>;
<a name="l943"><span class="linenum"> 943</span></a>                  }
<a name="l944"><span class="linenum"> 944</span></a>                  if (<a class="var it16191" onMouseOver="hilite(16191)" onMouseOut="lolite()" onClick="logVariable('nestedcategories')" href="../../_variables/nestedcategories.html">$nestedcategories</a>) {
<a name="l945"><span class="linenum"> 945</span></a>                      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['parent'] = <a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>;
<a name="l946"><span class="linenum"> 946</span></a>                  }
<a name="l947"><span class="linenum"> 947</span></a>  
<a name="l948"><span class="linenum"> 948</span></a>                  if (<a class="var it2604" onMouseOver="hilite(2604)" onMouseOut="lolite()" onClick="logVariable('catid')" href="../../_variables/catid.html">$catid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('course_categories', 'id', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l949"><span class="linenum"> 949</span></a>                      continue; <span class="comment">// This category already exists.</span>
<a name="l950"><span class="linenum"> 950</span></a>                  }
<a name="l951"><span class="linenum"> 951</span></a>  
<a name="l952"><span class="linenum"> 952</span></a>  <span class="comment">                // If we're allowed to create new categories, let's create this one.</span>
<a name="l953"><span class="linenum"> 953</span></a>                  if (<a class="var it16190" onMouseOver="hilite(16190)" onMouseOut="lolite()" onClick="logVariable('createnewcategories')" href="../../_variables/createnewcategories.html">$createnewcategories</a>) {
<a name="l954"><span class="linenum"> 954</span></a>                      <a class="var it16195" onMouseOver="hilite(16195)" onMouseOut="lolite()" onClick="logVariable('newcat')" href="../../_variables/newcat.html">$newcat</a> = new stdClass();
<a name="l955"><span class="linenum"> 955</span></a>                      <a class="var it16195" onMouseOver="hilite(16195)" onMouseOut="lolite()" onClick="logVariable('newcat')" href="../../_variables/newcat.html">$newcat</a>-&gt;<a onClick="logVariable('name')" class="var it44346" onMouseOver="hilite(44346)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="var it906" onMouseOver="hilite(906)" onMouseOut="lolite()" onClick="logVariable('categoryname')" href="../../_variables/categoryname.html">$categoryname</a>;
<a name="l956"><span class="linenum"> 956</span></a>                      <a class="var it16195" onMouseOver="hilite(16195)" onMouseOut="lolite()" onClick="logVariable('newcat')" href="../../_variables/newcat.html">$newcat</a>-&gt;<a onClick="logVariable('visible')" class="var it44346" onMouseOver="hilite(44346)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a> = 0;
<a name="l957"><span class="linenum"> 957</span></a>                      <a class="var it16195" onMouseOver="hilite(16195)" onMouseOut="lolite()" onClick="logVariable('newcat')" href="../../_variables/newcat.html">$newcat</a>-&gt;<a onClick="logVariable('parent')" class="var it44346" onMouseOver="hilite(44346)" onMouseOut="lolite()" href="../../_variables/parent.html">parent</a> = <a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>;
<a name="l958"><span class="linenum"> 958</span></a>                      <a class="var it16195" onMouseOver="hilite(16195)" onMouseOut="lolite()" onClick="logVariable('newcat')" href="../../_variables/newcat.html">$newcat</a>-&gt;<a onClick="logVariable('idnumber')" class="var it44346" onMouseOver="hilite(44346)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a> = <a class="var it16146" onMouseOver="hilite(16146)" onMouseOut="lolite()" onClick="logVariable('categoryidnumber')" href="../../_variables/categoryidnumber.html">$categoryidnumber</a>;
<a name="l959"><span class="linenum"> 959</span></a>                      <a class="var it16195" onMouseOver="hilite(16195)" onMouseOut="lolite()" onClick="logVariable('newcat')" href="../../_variables/newcat.html">$newcat</a> = <a class="class" onClick="logClass('coursecat')" href="../../_classes/coursecat.html" onMouseOver="classPopup(event,'coursecat')">coursecat</a>::<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it16195" onMouseOver="hilite(16195)" onMouseOut="lolite()" onClick="logVariable('newcat')" href="../../_variables/newcat.html">$newcat</a>);
<a name="l960"><span class="linenum"> 960</span></a>                      <a class="var it2604" onMouseOver="hilite(2604)" onMouseOut="lolite()" onClick="logVariable('catid')" href="../../_variables/catid.html">$catid</a> = <a class="var it16195" onMouseOver="hilite(16195)" onMouseOut="lolite()" onClick="logVariable('newcat')" href="../../_variables/newcat.html">$newcat</a>-&gt;<a onClick="logVariable('id')" class="var it44346" onMouseOver="hilite(44346)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l961"><span class="linenum"> 961</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>(&quot;Created new (hidden) category '<a class="var it16193" onMouseOver="hilite(16193)" onMouseOut="lolite()" onClick="logVariable('fullnestedcatname')" href="../../_variables/fullnestedcatname.html">$fullnestedcatname</a>'&quot;);
<a name="l962"><span class="linenum"> 962</span></a>                  } else {
<a name="l963"><span class="linenum"> 963</span></a>  <span class="comment">                    // If not found and not allowed to create, stick with default.</span>
<a name="l964"><span class="linenum"> 964</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('log_line')" href="../../_functions/log_line.html" onMouseOver="funcPopup(event,'log_line')">log_line</a>('Category ' . <a class="var it16194" onMouseOver="hilite(16194)" onMouseOut="lolite()" onClick="logVariable('categoryinfo')" href="../../_variables/categoryinfo.html">$categoryinfo</a> . ' not found in Moodle database. Using default category instead.');
<a name="l965"><span class="linenum"> 965</span></a>                      <a class="var it2604" onMouseOver="hilite(2604)" onMouseOut="lolite()" onClick="logVariable('catid')" href="../../_variables/catid.html">$catid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_default_category_id')" href="../../_functions/get_default_category_id.html" onMouseOver="funcPopup(event,'get_default_category_id')">get_default_category_id</a>();
<a name="l966"><span class="linenum"> 966</span></a>                      break;
<a name="l967"><span class="linenum"> 967</span></a>                  }
<a name="l968"><span class="linenum"> 968</span></a>              }
<a name="l969"><span class="linenum"> 969</span></a>          }
<a name="l970"><span class="linenum"> 970</span></a>  
<a name="l971"><span class="linenum"> 971</span></a>          return <a class="var it2604" onMouseOver="hilite(2604)" onMouseOut="lolite()" onClick="logVariable('catid')" href="../../_variables/catid.html">$catid</a>;
<a name="l972"><span class="linenum"> 972</span></a>      }
<a name="l973"><span class="linenum"> 973</span></a>  
<a name="l974"><span class="linenum"> 974</span></a>      <span class="comment">/**</span>
<a name="l975"><span class="linenum"> 975</span></a>  <span class="comment">     * Is it possible to delete enrol instance via standard UI?</span>
<a name="l976"><span class="linenum"> 976</span></a>  <span class="comment">     *</span>
<a name="l977"><span class="linenum"> 977</span></a>  <span class="comment">     * @param object $instance</span>
<a name="l978"><span class="linenum"> 978</span></a>  <span class="comment">     * @return bool</span>
<a name="l979"><span class="linenum"> 979</span></a>  <span class="comment">     */</span>
<a name="l980"><span class="linenum"> 980</span></a>      public function <a class="function" onClick="logFunction('can_delete_instance')" href="../../_functions/can_delete_instance.html" onMouseOver="funcPopup(event,'can_delete_instance')">can_delete_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>) {
<a name="l981"><span class="linenum"> 981</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l982"><span class="linenum"> 982</span></a>          return <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('enrol/imsenterprise:config', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l983"><span class="linenum"> 983</span></a>      }
<a name="l984"><span class="linenum"> 984</span></a>  
<a name="l985"><span class="linenum"> 985</span></a>      <span class="comment">/**</span>
<a name="l986"><span class="linenum"> 986</span></a>  <span class="comment">     * Is it possible to hide/show enrol instance via standard UI?</span>
<a name="l987"><span class="linenum"> 987</span></a>  <span class="comment">     *</span>
<a name="l988"><span class="linenum"> 988</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l989"><span class="linenum"> 989</span></a>  <span class="comment">     * @return bool</span>
<a name="l990"><span class="linenum"> 990</span></a>  <span class="comment">     */</span>
<a name="l991"><span class="linenum"> 991</span></a>      public function <a class="function" onClick="logFunction('can_hide_show_instance')" href="../../_functions/can_hide_show_instance.html" onMouseOver="funcPopup(event,'can_hide_show_instance')">can_hide_show_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>) {
<a name="l992"><span class="linenum"> 992</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l993"><span class="linenum"> 993</span></a>          return <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('enrol/imsenterprise:config', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l994"><span class="linenum"> 994</span></a>      }
<a name="l995"><span class="linenum"> 995</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'delete_user': ['delete_user', 'Marks user deleted in internal user database and notifies the auth plugin. Also unenrols user from all roles and does other cleanup. ', [['lib','moodlelib.php',3893]], 43],
'can_hide_show_instance': ['can_hide_show_instance', 'Is it possible to hide/show enrol instance via standard UI? ', [['enrol/manual','lib.php',572],['enrol/flatfile','lib.php',109],['enrol/imsenterprise','lib.php',985],['lib','enrollib.php',1609],['enrol/self','lib.php',638],['enrol/ldap','lib.php',127],['enrol/cohort','lib.php',337],['enrol/category','lib.php',56],['enrol/database','lib.php',57],['enrol/lti','lib.php',58],['enrol/mnet','lib.php',103],['enrol/paypal','lib.php',449],['enrol/guest','lib.php',308],['enrol/meta','lib.php',228]], 8],
'decode_timeframe': ['decode_timeframe', 'Process the INNER contents of a <timeframe> tag, to return beginning/ending dates. ', [['enrol/imsenterprise','lib.php',798]], 1],
'enrol_imsenterprise_allow_group_member_remove': ['enrol_imsenterprise_allow_group_member_remove', 'Called whenever anybody tries (from the normal interface) to remove a group member which is registered as being created by this component. (Not called when deleting an entire group or course at once.) ', [['enrol/imsenterprise','lib.php',853]], 0],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'raise': ['raise', 'Sets the PHP time limit to a number of seconds from now. ', [['lib/classes','php_time_limit.php',41]], 90],
'invalidate_by_definition': ['invalidate_by_definition', 'Invalidates a given set of keys from a given definition. ', [['cache/classes','helper.php',206]], 35],
'fopen': ['fopen', 'Return a stream handle to this stream. ', [['lib/horde/framework/Horde/Support','CombineStream.php',41],['lib/spout/src/Spout/Common/Helper','GlobalFunctionsHelper.php',15],['lib/horde/framework/Horde/Support','StringStream.php',41]], 221],
'set_config': ['set_config', 'Set a key in global configuration ', [['lib','moodlelib.php',1336],['lib','enrollib.php',1153],['lib/editor/tinymce/classes','plugin.php',84],['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515]], 1119],
'process_properties_tag': ['process_properties_tag', 'Process the properties tag. The only data from this element that is relevant is whether a <target> is specified. ', [['enrol/imsenterprise','lib.php',765]], 1],
'cron': ['cron', 'Find user\'s who have completed this criteria ', [['completion/criteria','completion_criteria_course.php',152],['enrol/manual','lib.php',284],['admin/registration','lib.php',50],['question/engine','bank.php',415],['completion/criteria','completion_criteria_date.php',144],['repository/dropbox','lib.php',704],['lib/classes/update','checker.php',193],['enrol/imsenterprise','lib.php',87],['lib','enrollib.php',1980],['repository','lib.php',2357],['auth/mnet','auth.php',832],['enrol/self','lib.php',423],['cache/classes','helper.php',659],['enrol/cohort','lib.php',164],['lib/filestorage','file_storage.php',2494],['enrol/category','lib.php',77],['mod/assign','assignmentplugin.php',534],['mod/assign','locallib.php',1880],['completion/criteria','completion_criteria_grade.php',185],['blocks/recent_activity','block_recent_activity.php',231],['completion/criteria','completion_criteria_activity.php',198],['enrol/paypal','lib.php',303],['completion/criteria','completion_criteria_duration.php',197],['blocks/rss_client','block_rss_client.php',262],['enrol/meta','lib.php',206]], 71],
'create_course': ['create_course', 'Creates the actual course. ', [['admin/tool/generator/classes','course_backend.php',246],['lib/testing/generator','data_generator.php',366],['enrol/ldap','lib.php',949],['course','lib.php',2654]], 1178],
'can_delete_instance': ['can_delete_instance', 'Is it possible to delete enrol instance via standard UI? ', [['enrol/manual','lib.php',561],['enrol/flatfile','lib.php',98],['enrol/imsenterprise','lib.php',974],['lib','enrollib.php',1599],['enrol/self','lib.php',627],['enrol/ldap','lib.php',103],['enrol/cohort','lib.php',39],['enrol/category','lib.php',35],['enrol/database','lib.php',35],['enrol/lti','lib.php',47],['enrol/mnet','lib.php',92],['enrol/paypal','lib.php',438],['enrol/guest','lib.php',297],['enrol/meta','lib.php',217]], 6],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'unenrol_user': ['unenrol_user', 'Unenrol user from course, the last unenrolment removes all remaining roles. ', [['lib','enrollib.php',1434],['enrol','locallib.php',641],['enrol/lti','lib.php',167],['enrol/mnet','enrol.php',198],['enrol/guest','lib.php',76]], 59],
'course_change_visibility': ['course_change_visibility', 'Changes the visibility of a course. ', [['course','lib.php',3779]], 6],
'mtrace': ['mtrace', 'Outputs the given message via {@link mtrace()}. ', [['lib/classes','plugin_manager.php',1376],['lib','moodlelib.php',8509]], 406],
'enrol_user': ['enrol_user', 'Enrol user into course via enrol instance. ', [['enrol/flatfile','lib.php',144],['lib','enrollib.php',1270],['lib/testing/generator','data_generator.php',891],['enrol/lti/classes','helper.php',233],['enrol/self','externallib.php',122],['enrol/mnet','enrol.php',115],['enrol/guest','lib.php',60]], 745],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'userdate': ['userdate', 'Returns a formatted string that represents a date in user time. ', [['lib','moodlelib.php',2155],['lib/adodb','adodb.inc.php',2842],['lib/adodb','adodb.inc.php',3569]], 525],
'get_default': ['get_default', 'Returns id of the default tag collection ', [['tag/classes','collection.php',117],['lib','adminlib.php',1964],['lib','coursecatlib.php',294]], 32],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'process_person_tag': ['process_person_tag', 'Process the person tag. This defines a Moodle user. ', [['enrol/imsenterprise','lib.php',446]], 1],
'full_tag_found_in_cache': ['full_tag_found_in_cache', 'Check if a complete tag is found in the cached data, which usually happens when the end of the tag has only just been loaded into the cache. ', [['enrol/imsenterprise','lib.php',248]], 5],
'update_course': ['update_course', 'Will update a moodle course with new values from LDAP A field will be updated only if it is marked to be updated on sync in plugin settings ', [['enrol/ldap','lib.php',1025],['course','lib.php',2758]], 44],
'load_role_mappings': ['load_role_mappings', 'Load the role mappings (from the config), so we can easily refer to how an IMS-E role corresponds to a Moodle role ', [['enrol/imsenterprise','lib.php',821]], 1],
'remove_tag_from_cache': ['remove_tag_from_cache', 'Remove complete tag from the cached data (including all its contents) - so that the cache doesn\'t grow to unmanageable size ', [['enrol/imsenterprise','lib.php',267]], 5],
'get_imsroles': ['get_imsroles', 'Returns the mapped roles ', [['enrol/imsenterprise','locallib.php',56]], 2],
'groups_add_member': ['groups_add_member', 'Adds a specified user to a group ', [['group','lib.php',31]], 101],
'record': ['record', 'Records a batch of changes to the number of times events have occurred for the currently authenticated user of this application. (events.record) ', [['lib/google/src/Google/Service','Games.php',1309]], 6],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'get_courseattrs': ['get_courseattrs', 'courseattrs getter ', [['enrol/imsenterprise','locallib.php',141]], 2],
'fix_course_sortorder': ['fix_course_sortorder', 'Fixes course category and course sortorder, also verifies category and course parents and paths. (circular references are not fixed) ', [['lib','datalib.php',854]], 19],
'strlen': ['strlen', 'Counts the number of characters. Unit-tested by Kasper (single byte charsets only) ', [['lib/typo3','class.t3lib_cs.php',1520],['lib/classes','text.php',305]], 1649],
'message_send': ['message_send', 'Called when a message provider wants to send a message. This functions checks the message recipient\'s message processor configuration then sends the message to the configured processors ', [['lib','messagelib.php',29]], 94],
'add_instance': ['add_instance', 'Add new instance of enrol plugin. ', [['enrol/manual','lib.php',147],['lib','enrollib.php',1745],['enrol/self','lib.php',958],['enrol/cohort','lib.php',99],['mod/assign','locallib.php',600],['tag/classes','tag.php',543],['enrol/lti','lib.php',88],['enrol/paypal','lib.php',124],['enrol/guest','lib.php',247],['enrol/meta','lib.php',131]], 91],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'load_course_mappings': ['load_course_mappings', 'Load the name mappings (from the config), so we can easily refer to how an IMS-E course properties corresponds to a Moodle course properties ', [['enrol/imsenterprise','lib.php',837]], 1],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'get_category_from_group': ['get_category_from_group', 'Find the category using idnumber or name. ', [['enrol/imsenterprise','lib.php',885]], 1],
'get_admin': ['get_admin', 'Returns $user object of the main admin user ', [['lib','datalib.php',53]], 61],
'log_line': ['log_line', 'Store logging information. This does two things: uses the {@link mtrace()} function to print info to screen/STDOUT, and also writes log to a text file if a path has been specified. ', [['enrol/imsenterprise','lib.php',782]], 38],
'process_group_tag': ['process_group_tag', 'Process the group tag. This defines a Moodle course. ', [['enrol/imsenterprise','lib.php',295]], 1],
'get_recstatus': ['get_recstatus', 'Very simple convenience function to return the "recstatus" found in person/group/role tags. 1=Add, 2=Update, 3=Delete, as specified by IMS, and we also use 0 to indicate "unspecified". ', [['enrol/imsenterprise','lib.php',279]], 3],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'process_membership_tag': ['process_membership_tag', 'Process the membership tag. This defines whether the specified Moodle users should be added/removed as teachers/students. ', [['enrol/imsenterprise','lib.php',599]], 1],
'get_default_category_id': ['get_default_category_id', 'Get the default category id (often known as \'Miscellaneous\'), statically cached to avoid multiple DB lookups on big imports. ', [['enrol/imsenterprise','lib.php',867]], 4],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'explode': ['explode', '', [], 1572],
'filesize': ['filesize', '', [], 82],
'feof': ['feof', '', [], 52],
'intval': ['intval', '', [], 455],
'strtolower': ['strtolower', '', [], 817],
'fgets': ['fgets', '', [], 44],
'substr': ['substr', '', [], 2823],
'mktime': ['mktime', '', [], 50],
'array_map': ['array_map', '', [], 169],
'preg_quote': ['preg_quote', '', [], 205],
'trim': ['trim', '', [], 1948],
'time': ['time', '', [], 1959],
'count': ['count', '', [], 4095],
'file_exists': ['file_exists', '', [], 867],
'preg_split': ['preg_split', '', [], 146],
'strpos': ['strpos', '', [], 1604],
'reset': ['reset', '', [], 1213],
'preg_replace': ['preg_replace', '', [], 917],
'filemtime': ['filemtime', '', [], 70],
'preg_match': ['preg_match', '', [], 1286],
'fwrite': ['fwrite', '', [], 227],
'fclose': ['fclose', '', [], 275],
'ceil': ['ceil', '', [], 236],
'ucwords': ['ucwords', '', [], 12],
'defined': ['defined', '', [], 4731],
'preg_match_all': ['preg_match_all', '', [], 161]};
CLASS_DATA={
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323],
'imsenterprise_courses': ['imsenterprise_courses', 'Mapping between Moodle course attributes and IMS enterprise group description tags ', [['enrol/imsenterprise','locallib.php',102]], 2],
'user': ['user', 'Search area for Users for whom I have access to view profile. ', [['user/classes/search','user.php',31],['grade/report/singleview/classes/local/screen','user.php',40]], 27],
'enrol_imsenterprise_plugin': ['enrol_imsenterprise_plugin', 'IMS Enterprise file enrolment plugin. ', [['enrol/imsenterprise','lib.php',34]], 34],
'core_php_time_limit': ['core_php_time_limit', 'Utility class to manage PHP time limit. ', [['lib/classes','php_time_limit.php',27]], 92],
'coursecat': ['coursecat', 'Class to store, cache, render and manage course category ', [['lib','coursecatlib.php',28]], 276],
'cache_helper': ['cache_helper', 'The cache helper class. ', [['cache/classes','helper.php',31]], 139],
'imsenterprise_roles': ['imsenterprise_roles', 'Class for dealing with role mappings in IMS Enterprise. ', [['enrol/imsenterprise','locallib.php',28]], 2]};
CONST_DATA={
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'FORMAT_PLAIN': ['FORMAT_PLAIN', '', [['lib','weblib.php',52]], 152],
'PHPUNIT_TEST': ['PHPUNIT_TEST', '', [['admin/cli','install.php',145],['','install.php',49],['lib/phpunit','bootstrap.php',63],['lib','setup.php',247]], 59]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
