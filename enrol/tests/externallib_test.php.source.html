<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /enrol/tests/externallib_test.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='enrol/tests';
filename='externallib_test.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/enrol/tests/</a> -> <a href="externallib_test.php.html">externallib_test.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="externallib_test.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="externallib_test.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l18"><span class="linenum">  18</span></a>  
<a name="l19"><span class="linenum">  19</span></a>  global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l20"><span class="linenum">  20</span></a>  
<a name="l21"><span class="linenum">  21</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../webservice/tests/helpers.php.html">/webservice/tests/helpers.php</a>');
<a name="l22"><span class="linenum">  22</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../enrol/externallib.php.html">/enrol/externallib.php</a>');
<a name="l23"><span class="linenum">  23</span></a>  
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment">/**</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * Enrol external PHPunit tests</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> *</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * @package    core_enrol</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * @category   external</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * @copyright  2012 Jerome Mouneyrac</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * @since Moodle 2.4</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> */</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('core_enrol_externallib_testcase')" href="../../_classes/core_enrol_externallib_testcase.html" onMouseOver="classPopup(event,'core_enrol_externallib_testcase')">core_enrol_externallib_testcase</a> extends externallib_advanced_testcase {
<a name="l34"><span class="linenum">  34</span></a>  
<a name="l35"><span class="linenum">  35</span></a>      <span class="comment">/**</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment">     * dataProvider for test_get_enrolled_users_visibility().</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment">     */</span>
<a name="l38"><span class="linenum">  38</span></a>      public function <a class="function" onClick="logFunction('get_enrolled_users_visibility_provider')" href="../../_functions/get_enrolled_users_visibility_provider.html" onMouseOver="funcPopup(event,'get_enrolled_users_visibility_provider')">get_enrolled_users_visibility_provider</a>() {
<a name="l39"><span class="linenum">  39</span></a>          return array(
<a name="l40"><span class="linenum">  40</span></a>              'Course without groups, default behavior (not filtering by cap, group, active)' =&gt;
<a name="l41"><span class="linenum">  41</span></a>              array(
<a name="l42"><span class="linenum">  42</span></a>                  'settings' =&gt; array(
<a name="l43"><span class="linenum">  43</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('NOGROUPS')" href="../../_constants/NOGROUPS.html" onMouseOver="constPopup(event,'NOGROUPS')">NOGROUPS</a>,
<a name="l44"><span class="linenum">  44</span></a>                      'withcapability' =&gt; null,
<a name="l45"><span class="linenum">  45</span></a>                      'groupid' =&gt; null,
<a name="l46"><span class="linenum">  46</span></a>                      'onlyactive' =&gt; false,
<a name="l47"><span class="linenum">  47</span></a>                      'allowedcaps' =&gt; array(),
<a name="l48"><span class="linenum">  48</span></a>                  ),
<a name="l49"><span class="linenum">  49</span></a>                  'results' =&gt; array( // Everybody can view everybody.
<a name="l50"><span class="linenum">  50</span></a>                      'user0' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l51"><span class="linenum">  51</span></a>                      'user1' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l52"><span class="linenum">  52</span></a>                      'user2' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l53"><span class="linenum">  53</span></a>                      'user31' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l54"><span class="linenum">  54</span></a>                      'userall' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l55"><span class="linenum">  55</span></a>                  ),
<a name="l56"><span class="linenum">  56</span></a>              ),
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>              'Course with visible groups, default behavior (not filtering by cap, group, active)' =&gt;
<a name="l59"><span class="linenum">  59</span></a>              array(
<a name="l60"><span class="linenum">  60</span></a>                  'settings' =&gt; array(
<a name="l61"><span class="linenum">  61</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('VISIBLEGROUPS')" href="../../_constants/VISIBLEGROUPS.html" onMouseOver="constPopup(event,'VISIBLEGROUPS')">VISIBLEGROUPS</a>,
<a name="l62"><span class="linenum">  62</span></a>                      'withcapability' =&gt; null,
<a name="l63"><span class="linenum">  63</span></a>                      'groupid' =&gt; null,
<a name="l64"><span class="linenum">  64</span></a>                      'onlyactive' =&gt; false,
<a name="l65"><span class="linenum">  65</span></a>                      'allowedcaps' =&gt; array(),
<a name="l66"><span class="linenum">  66</span></a>                  ),
<a name="l67"><span class="linenum">  67</span></a>                  'results' =&gt; array( // Everybody can view everybody.
<a name="l68"><span class="linenum">  68</span></a>                      'user0' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l69"><span class="linenum">  69</span></a>                      'user1' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l70"><span class="linenum">  70</span></a>                      'user2' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l71"><span class="linenum">  71</span></a>                      'user31' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l72"><span class="linenum">  72</span></a>                      'userall' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l73"><span class="linenum">  73</span></a>                  ),
<a name="l74"><span class="linenum">  74</span></a>              ),
<a name="l75"><span class="linenum">  75</span></a>  
<a name="l76"><span class="linenum">  76</span></a>              'Course with separate groups, default behavior (not filtering by cap, group, active)' =&gt;
<a name="l77"><span class="linenum">  77</span></a>              array(
<a name="l78"><span class="linenum">  78</span></a>                  'settings' =&gt; array(
<a name="l79"><span class="linenum">  79</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>,
<a name="l80"><span class="linenum">  80</span></a>                      'withcapability' =&gt; null,
<a name="l81"><span class="linenum">  81</span></a>                      'groupid' =&gt; null,
<a name="l82"><span class="linenum">  82</span></a>                      'onlyactive' =&gt; false,
<a name="l83"><span class="linenum">  83</span></a>                      'allowedcaps' =&gt; array(),
<a name="l84"><span class="linenum">  84</span></a>                  ),
<a name="l85"><span class="linenum">  85</span></a>                  'results' =&gt; array( // Only users from own groups are visible.
<a name="l86"><span class="linenum">  86</span></a>                      'user0' =&gt; array('canview' =&gt; array()), // Poor guy, cannot see anybody, himself included.
<a name="l87"><span class="linenum">  87</span></a>                      'user1' =&gt; array('canview' =&gt; array('user1', 'userall')),
<a name="l88"><span class="linenum">  88</span></a>                      'user2' =&gt; array('canview' =&gt; array('user2', 'user2su', 'userall')),
<a name="l89"><span class="linenum">  89</span></a>                      'user31' =&gt; array('canview' =&gt; array('user31', 'user32', 'userall')),
<a name="l90"><span class="linenum">  90</span></a>                      'userall' =&gt; array('canview' =&gt; array('user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l91"><span class="linenum">  91</span></a>                  ),
<a name="l92"><span class="linenum">  92</span></a>              ),
<a name="l93"><span class="linenum">  93</span></a>  
<a name="l94"><span class="linenum">  94</span></a>              'Course with separate groups, default behavior (not filtering but having moodle/site:accessallgroups)' =&gt;
<a name="l95"><span class="linenum">  95</span></a>              array(
<a name="l96"><span class="linenum">  96</span></a>                  'settings' =&gt; array(
<a name="l97"><span class="linenum">  97</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('VISIBLEGROUPS')" href="../../_constants/VISIBLEGROUPS.html" onMouseOver="constPopup(event,'VISIBLEGROUPS')">VISIBLEGROUPS</a>,
<a name="l98"><span class="linenum">  98</span></a>                      'withcapability' =&gt; null,
<a name="l99"><span class="linenum">  99</span></a>                      'groupid' =&gt; null,
<a name="l100"><span class="linenum"> 100</span></a>                      'onlyactive' =&gt; false,
<a name="l101"><span class="linenum"> 101</span></a>                      'allowedcaps' =&gt; array('moodle/site:accessallgroups'),
<a name="l102"><span class="linenum"> 102</span></a>                  ),
<a name="l103"><span class="linenum"> 103</span></a>                  'results' =&gt; array( // Everybody can view everybody.
<a name="l104"><span class="linenum"> 104</span></a>                      'user0' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l105"><span class="linenum"> 105</span></a>                      'user1' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l106"><span class="linenum"> 106</span></a>                      'user2' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l107"><span class="linenum"> 107</span></a>                      'user31' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l108"><span class="linenum"> 108</span></a>                      'userall' =&gt; array('canview' =&gt; array('user0', 'user1', 'user2', 'user2su', 'user31', 'user32', 'userall')),
<a name="l109"><span class="linenum"> 109</span></a>                  ),
<a name="l110"><span class="linenum"> 110</span></a>              ),
<a name="l111"><span class="linenum"> 111</span></a>  
<a name="l112"><span class="linenum"> 112</span></a>              'Course with separate groups, filtering onlyactive (missing moodle/course:enrolreview)' =&gt;
<a name="l113"><span class="linenum"> 113</span></a>              array(
<a name="l114"><span class="linenum"> 114</span></a>                  'settings' =&gt; array(
<a name="l115"><span class="linenum"> 115</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>,
<a name="l116"><span class="linenum"> 116</span></a>                      'withcapability' =&gt; null,
<a name="l117"><span class="linenum"> 117</span></a>                      'groupid' =&gt; null,
<a name="l118"><span class="linenum"> 118</span></a>                      'onlyactive' =&gt; true,
<a name="l119"><span class="linenum"> 119</span></a>                      'allowedcaps' =&gt; array(),
<a name="l120"><span class="linenum"> 120</span></a>                  ),
<a name="l121"><span class="linenum"> 121</span></a>                  'results' =&gt; array( // returns exception, cannot view anybody without the cap.
<a name="l122"><span class="linenum"> 122</span></a>                      'user2' =&gt; array('exception' =&gt; array(
<a name="l123"><span class="linenum"> 123</span></a>                          'type' =&gt; 'required_capability_exception',
<a name="l124"><span class="linenum"> 124</span></a>                          'message' =&gt; 'Review course enrolments')),
<a name="l125"><span class="linenum"> 125</span></a>                      'userall' =&gt; array('exception' =&gt; array(
<a name="l126"><span class="linenum"> 126</span></a>                          'type' =&gt; 'required_capability_exception',
<a name="l127"><span class="linenum"> 127</span></a>                          'message' =&gt; 'Review course enrolments')),
<a name="l128"><span class="linenum"> 128</span></a>                  ),
<a name="l129"><span class="linenum"> 129</span></a>              ),
<a name="l130"><span class="linenum"> 130</span></a>  
<a name="l131"><span class="linenum"> 131</span></a>              'Course with separate groups, filtering onlyactive (having moodle/course:enrolreview)' =&gt;
<a name="l132"><span class="linenum"> 132</span></a>              array(
<a name="l133"><span class="linenum"> 133</span></a>                  'settings' =&gt; array(
<a name="l134"><span class="linenum"> 134</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>,
<a name="l135"><span class="linenum"> 135</span></a>                      'withcapability' =&gt; null,
<a name="l136"><span class="linenum"> 136</span></a>                      'groupid' =&gt; null,
<a name="l137"><span class="linenum"> 137</span></a>                      'onlyactive' =&gt; true,
<a name="l138"><span class="linenum"> 138</span></a>                      'allowedcaps' =&gt; array('moodle/course:enrolreview'),
<a name="l139"><span class="linenum"> 139</span></a>                  ),
<a name="l140"><span class="linenum"> 140</span></a>                  'results' =&gt; array( // Suspended are not returned.
<a name="l141"><span class="linenum"> 141</span></a>                      'user2' =&gt; array('canview' =&gt; array('user2', 'userall')),
<a name="l142"><span class="linenum"> 142</span></a>                      'user31' =&gt; array('canview' =&gt; array('user31', 'user32', 'userall')),
<a name="l143"><span class="linenum"> 143</span></a>                      'userall' =&gt; array('canview' =&gt; array('user1', 'user2', 'user31', 'user32', 'userall')),
<a name="l144"><span class="linenum"> 144</span></a>                  ),
<a name="l145"><span class="linenum"> 145</span></a>              ),
<a name="l146"><span class="linenum"> 146</span></a>  
<a name="l147"><span class="linenum"> 147</span></a>              'Course with separate groups, filtering by groupid (not having moodle/site:accessallgroups)' =&gt;
<a name="l148"><span class="linenum"> 148</span></a>              array(
<a name="l149"><span class="linenum"> 149</span></a>                  'settings' =&gt; array(
<a name="l150"><span class="linenum"> 150</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>,
<a name="l151"><span class="linenum"> 151</span></a>                      'withcapability' =&gt; null,
<a name="l152"><span class="linenum"> 152</span></a>                      'groupid' =&gt; 'group2',
<a name="l153"><span class="linenum"> 153</span></a>                      'onlyactive' =&gt; false,
<a name="l154"><span class="linenum"> 154</span></a>                      'allowedcaps' =&gt; array(),
<a name="l155"><span class="linenum"> 155</span></a>                  ),
<a name="l156"><span class="linenum"> 156</span></a>                  'results' =&gt; array( // Only group 2 members and only for members. Exception for non-members.
<a name="l157"><span class="linenum"> 157</span></a>                      'user0' =&gt; array('exception' =&gt; array(
<a name="l158"><span class="linenum"> 158</span></a>                          'type' =&gt; 'required_capability_exception',
<a name="l159"><span class="linenum"> 159</span></a>                          'message' =&gt; 'Access all groups')),
<a name="l160"><span class="linenum"> 160</span></a>                      'user1' =&gt; array('exception' =&gt; array(
<a name="l161"><span class="linenum"> 161</span></a>                          'type' =&gt; 'required_capability_exception',
<a name="l162"><span class="linenum"> 162</span></a>                          'message' =&gt; 'Access all groups')),
<a name="l163"><span class="linenum"> 163</span></a>                      'user2' =&gt; array('canview' =&gt; array('user2', 'user2su', 'userall')),
<a name="l164"><span class="linenum"> 164</span></a>                      'userall' =&gt; array('canview' =&gt; array('user2', 'user2su', 'userall')),
<a name="l165"><span class="linenum"> 165</span></a>                  ),
<a name="l166"><span class="linenum"> 166</span></a>              ),
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>              'Course with separate groups, filtering by groupid (having moodle/site:accessallgroups)' =&gt;
<a name="l169"><span class="linenum"> 169</span></a>              array(
<a name="l170"><span class="linenum"> 170</span></a>                  'settings' =&gt; array(
<a name="l171"><span class="linenum"> 171</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>,
<a name="l172"><span class="linenum"> 172</span></a>                      'withcapability' =&gt; null,
<a name="l173"><span class="linenum"> 173</span></a>                      'groupid' =&gt; 'group2',
<a name="l174"><span class="linenum"> 174</span></a>                      'onlyactive' =&gt; false,
<a name="l175"><span class="linenum"> 175</span></a>                      'allowedcaps' =&gt; array('moodle/site:accessallgroups'),
<a name="l176"><span class="linenum"> 176</span></a>                  ),
<a name="l177"><span class="linenum"> 177</span></a>                  'results' =&gt; array( // All users with 'moodle/site:accessallgroups' can view group 2
<a name="l178"><span class="linenum"> 178</span></a>                      'user0' =&gt; array('canview' =&gt; array('user2', 'user2su', 'userall')),
<a name="l179"><span class="linenum"> 179</span></a>                      'user1' =&gt; array('canview' =&gt; array('user2', 'user2su', 'userall')),
<a name="l180"><span class="linenum"> 180</span></a>                      'user2' =&gt; array('canview' =&gt; array('user2', 'user2su', 'userall')),
<a name="l181"><span class="linenum"> 181</span></a>                      'userall' =&gt; array('canview' =&gt; array('user2', 'user2su', 'userall')),
<a name="l182"><span class="linenum"> 182</span></a>                  ),
<a name="l183"><span class="linenum"> 183</span></a>              ),
<a name="l184"><span class="linenum"> 184</span></a>  
<a name="l185"><span class="linenum"> 185</span></a>              'Course with separate groups, filtering by withcapability (not having moodle/role:review)' =&gt;
<a name="l186"><span class="linenum"> 186</span></a>              array(
<a name="l187"><span class="linenum"> 187</span></a>                  'settings' =&gt; array(
<a name="l188"><span class="linenum"> 188</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>,
<a name="l189"><span class="linenum"> 189</span></a>                      'withcapability' =&gt; 'moodle/course:bulkmessaging',
<a name="l190"><span class="linenum"> 190</span></a>                      'groupid' =&gt; null,
<a name="l191"><span class="linenum"> 191</span></a>                      'onlyactive' =&gt; false,
<a name="l192"><span class="linenum"> 192</span></a>                      'allowedcaps' =&gt; array(),
<a name="l193"><span class="linenum"> 193</span></a>                  ),
<a name="l194"><span class="linenum"> 194</span></a>                  'results' =&gt; array( // No user has 'moodle/role:review' so exception.
<a name="l195"><span class="linenum"> 195</span></a>                      'user0' =&gt; array('exception' =&gt; array(
<a name="l196"><span class="linenum"> 196</span></a>                          'type' =&gt; 'required_capability_exception',
<a name="l197"><span class="linenum"> 197</span></a>                          'message' =&gt; 'Review permissions for others')),
<a name="l198"><span class="linenum"> 198</span></a>                      'user1' =&gt; array('exception' =&gt; array(
<a name="l199"><span class="linenum"> 199</span></a>                          'type' =&gt; 'required_capability_exception',
<a name="l200"><span class="linenum"> 200</span></a>                          'message' =&gt; 'Review permissions for others')),
<a name="l201"><span class="linenum"> 201</span></a>                      'user2' =&gt; array('exception' =&gt; array(
<a name="l202"><span class="linenum"> 202</span></a>                          'type' =&gt; 'required_capability_exception',
<a name="l203"><span class="linenum"> 203</span></a>                          'message' =&gt; 'Review permissions for others')),
<a name="l204"><span class="linenum"> 204</span></a>                      'userall' =&gt; array('exception' =&gt; array(
<a name="l205"><span class="linenum"> 205</span></a>                          'type' =&gt; 'required_capability_exception',
<a name="l206"><span class="linenum"> 206</span></a>                          'message' =&gt; 'Review permissions for others')),
<a name="l207"><span class="linenum"> 207</span></a>                  ),
<a name="l208"><span class="linenum"> 208</span></a>              ),
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>              'Course with separate groups, filtering by withcapability (having moodle/role:review)' =&gt;
<a name="l211"><span class="linenum"> 211</span></a>              array(
<a name="l212"><span class="linenum"> 212</span></a>                  'settings' =&gt; array(
<a name="l213"><span class="linenum"> 213</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>,
<a name="l214"><span class="linenum"> 214</span></a>                      'withcapability' =&gt; 'moodle/course:bulkmessaging',
<a name="l215"><span class="linenum"> 215</span></a>                      'groupid' =&gt; null,
<a name="l216"><span class="linenum"> 216</span></a>                      'onlyactive' =&gt; false,
<a name="l217"><span class="linenum"> 217</span></a>                      'allowedcaps' =&gt; array('moodle/role:review'),
<a name="l218"><span class="linenum"> 218</span></a>                  ),
<a name="l219"><span class="linenum"> 219</span></a>                  'results' =&gt; array( // No user has withcapability, but all have 'moodle/role:review'. Empties.
<a name="l220"><span class="linenum"> 220</span></a>                      'user0' =&gt; array('canview' =&gt; array()),
<a name="l221"><span class="linenum"> 221</span></a>                      'user1' =&gt; array('canview' =&gt; array()),
<a name="l222"><span class="linenum"> 222</span></a>                      'user2' =&gt; array('canview' =&gt; array()),
<a name="l223"><span class="linenum"> 223</span></a>                      'userall' =&gt; array('canview' =&gt; array()),
<a name="l224"><span class="linenum"> 224</span></a>                  ),
<a name="l225"><span class="linenum"> 225</span></a>              ),
<a name="l226"><span class="linenum"> 226</span></a>  
<a name="l227"><span class="linenum"> 227</span></a>              'Course with separate groups, filtering by withcapability (having moodle/role:review)' =&gt;
<a name="l228"><span class="linenum"> 228</span></a>              array(
<a name="l229"><span class="linenum"> 229</span></a>                  'settings' =&gt; array(
<a name="l230"><span class="linenum"> 230</span></a>                      'coursegroupmode' =&gt; <a class="constant" onClick="logConstant('SEPARATEGROUPS')" href="../../_constants/SEPARATEGROUPS.html" onMouseOver="constPopup(event,'SEPARATEGROUPS')">SEPARATEGROUPS</a>,
<a name="l231"><span class="linenum"> 231</span></a>                      'withcapability' =&gt; 'moodle/course:bulkmessaging',
<a name="l232"><span class="linenum"> 232</span></a>                      'groupid' =&gt; null,
<a name="l233"><span class="linenum"> 233</span></a>                      'onlyactive' =&gt; false,
<a name="l234"><span class="linenum"> 234</span></a>                      'allowedcaps' =&gt; array('moodle/role:review', 'moodle/course:bulkmessaging'),
<a name="l235"><span class="linenum"> 235</span></a>                  ),
<a name="l236"><span class="linenum"> 236</span></a>                  'results' =&gt; array( // Users (previous) have withcapability, and all have 'moodle/role:review'.
<a name="l237"><span class="linenum"> 237</span></a>                      'user0' =&gt; array('canview' =&gt; array()),
<a name="l238"><span class="linenum"> 238</span></a>                      'user1' =&gt; array('canview' =&gt; array('user1')),
<a name="l239"><span class="linenum"> 239</span></a>                      'user2' =&gt; array('canview' =&gt; array('user2')),
<a name="l240"><span class="linenum"> 240</span></a>                      'userall' =&gt; array('canview' =&gt; array('user1', 'user2', 'userall')),
<a name="l241"><span class="linenum"> 241</span></a>                  ),
<a name="l242"><span class="linenum"> 242</span></a>              ),
<a name="l243"><span class="linenum"> 243</span></a>          );
<a name="l244"><span class="linenum"> 244</span></a>      }
<a name="l245"><span class="linenum"> 245</span></a>  
<a name="l246"><span class="linenum"> 246</span></a>      <span class="comment">/**</span>
<a name="l247"><span class="linenum"> 247</span></a>  <span class="comment">     * Verify get_enrolled_users() returned users are the expected in every situation.</span>
<a name="l248"><span class="linenum"> 248</span></a>  <span class="comment">     *</span>
<a name="l249"><span class="linenum"> 249</span></a>  <span class="comment">     * @dataProvider get_enrolled_users_visibility_provider</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">     */</span>
<a name="l251"><span class="linenum"> 251</span></a>      public function <a class="function" onClick="logFunction('test_get_enrolled_users_visibility')" href="../../_functions/test_get_enrolled_users_visibility.html" onMouseOver="funcPopup(event,'test_get_enrolled_users_visibility')">test_get_enrolled_users_visibility</a>(<a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>, <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../_variables/results.html">$results</a>) {
<a name="l252"><span class="linenum"> 252</span></a>  
<a name="l253"><span class="linenum"> 253</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l254"><span class="linenum"> 254</span></a>  
<a name="l255"><span class="linenum"> 255</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('resetAfterTest')" href="../../_functions/resetaftertest.html" onMouseOver="funcPopup(event,'resetaftertest')">resetAfterTest</a>();
<a name="l256"><span class="linenum"> 256</span></a>  
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">        // Create the course and the users.</span>
<a name="l258"><span class="linenum"> 258</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_course')" href="../../_functions/create_course.html" onMouseOver="funcPopup(event,'create_course')">create_course</a>(array('groupmode' =&gt; <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>['coursegroupmode']));
<a name="l259"><span class="linenum"> 259</span></a>          <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l260"><span class="linenum"> 260</span></a>          <a class="var it28569" onMouseOver="hilite(28569)" onMouseOut="lolite()" onClick="logVariable('user0')" href="../../_variables/user0.html">$user0</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>(array('username' =&gt; 'user0'));     <span class="comment">// A user without group.</span>
<a name="l261"><span class="linenum"> 261</span></a>          <a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../../_variables/user1.html">$user1</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>(array('username' =&gt; 'user1'));     <span class="comment">// User for group 1.</span>
<a name="l262"><span class="linenum"> 262</span></a>          <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../../_variables/user2.html">$user2</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>(array('username' =&gt; 'user2'));     <span class="comment">// Two users for group 2.</span>
<a name="l263"><span class="linenum"> 263</span></a>          <a class="var it28570" onMouseOver="hilite(28570)" onMouseOut="lolite()" onClick="logVariable('user2su')" href="../../_variables/user2su.html">$user2su</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>(array('username' =&gt; 'user2su')); <span class="comment">// (one suspended).</span>
<a name="l264"><span class="linenum"> 264</span></a>          <a class="var it28571" onMouseOver="hilite(28571)" onMouseOut="lolite()" onClick="logVariable('user31')" href="../../_variables/user31.html">$user31</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>(array('username' =&gt; 'user31'));   <span class="comment">// Two users for group 3.</span>
<a name="l265"><span class="linenum"> 265</span></a>          <a class="var it28572" onMouseOver="hilite(28572)" onMouseOut="lolite()" onClick="logVariable('user32')" href="../../_variables/user32.html">$user32</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>(array('username' =&gt; 'user32'));   <span class="comment">// (both enabled).</span>
<a name="l266"><span class="linenum"> 266</span></a>          <a class="var it28573" onMouseOver="hilite(28573)" onMouseOut="lolite()" onClick="logVariable('userall')" href="../../_variables/userall.html">$userall</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>(array('username' =&gt; 'userall')); <span class="comment">// A user in all groups.</span>
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>  <span class="comment">        // Create utility array of created users, to produce better assertion messages.</span>
<a name="l269"><span class="linenum"> 269</span></a>          <a class="var it28574" onMouseOver="hilite(28574)" onMouseOut="lolite()" onClick="logVariable('createdusers')" href="../../_variables/createdusers.html">$createdusers</a> = array();
<a name="l270"><span class="linenum"> 270</span></a>          foreach (array(<a class="var it28569" onMouseOver="hilite(28569)" onMouseOut="lolite()" onClick="logVariable('user0')" href="../../_variables/user0.html">$user0</a>, <a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../../_variables/user1.html">$user1</a>, <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../../_variables/user2.html">$user2</a>, <a class="var it28570" onMouseOver="hilite(28570)" onMouseOut="lolite()" onClick="logVariable('user2su')" href="../../_variables/user2su.html">$user2su</a>, <a class="var it28571" onMouseOver="hilite(28571)" onMouseOut="lolite()" onClick="logVariable('user31')" href="../../_variables/user31.html">$user31</a>, <a class="var it28572" onMouseOver="hilite(28572)" onMouseOut="lolite()" onClick="logVariable('user32')" href="../../_variables/user32.html">$user32</a>, <a class="var it28573" onMouseOver="hilite(28573)" onMouseOut="lolite()" onClick="logVariable('userall')" href="../../_variables/userall.html">$userall</a>) as <a class="var it28575" onMouseOver="hilite(28575)" onMouseOut="lolite()" onClick="logVariable('createduser')" href="../../_variables/createduser.html">$createduser</a>) {
<a name="l271"><span class="linenum"> 271</span></a>              <a class="var it28574" onMouseOver="hilite(28574)" onMouseOut="lolite()" onClick="logVariable('createdusers')" href="../../_variables/createdusers.html">$createdusers</a>[<a class="var it28575" onMouseOver="hilite(28575)" onMouseOut="lolite()" onClick="logVariable('createduser')" href="../../_variables/createduser.html">$createduser</a>-&gt;<a onClick="logVariable('id')" class="var it45573" onMouseOver="hilite(45573)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it28575" onMouseOver="hilite(28575)" onMouseOut="lolite()" onClick="logVariable('createduser')" href="../../_variables/createduser.html">$createduser</a>-&gt;<a onClick="logVariable('username')" class="var it45573" onMouseOver="hilite(45573)" onMouseOut="lolite()" href="../../_variables/username.html">username</a>;
<a name="l272"><span class="linenum"> 272</span></a>          }
<a name="l273"><span class="linenum"> 273</span></a>  
<a name="l274"><span class="linenum"> 274</span></a>  <span class="comment">        // Enrol the users in the course.</span>
<a name="l275"><span class="linenum"> 275</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it28569" onMouseOver="hilite(28569)" onMouseOut="lolite()" onClick="logVariable('user0')" href="../../_variables/user0.html">$user0</a>-&gt;<a onClick="logVariable('id')" class="var it45574" onMouseOver="hilite(45574)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l276"><span class="linenum"> 276</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it42951" onMouseOver="hilite(42951)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l277"><span class="linenum"> 277</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it42952" onMouseOver="hilite(42952)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l278"><span class="linenum"> 278</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it28570" onMouseOver="hilite(28570)" onMouseOut="lolite()" onClick="logVariable('user2su')" href="../../_variables/user2su.html">$user2su</a>-&gt;<a onClick="logVariable('id')" class="var it45575" onMouseOver="hilite(45575)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, null, 'manual', 0, 0, <a class="constant" onClick="logConstant('ENROL_USER_SUSPENDED')" href="../../_constants/ENROL_USER_SUSPENDED.html" onMouseOver="constPopup(event,'ENROL_USER_SUSPENDED')">ENROL_USER_SUSPENDED</a>);
<a name="l279"><span class="linenum"> 279</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it28571" onMouseOver="hilite(28571)" onMouseOut="lolite()" onClick="logVariable('user31')" href="../../_variables/user31.html">$user31</a>-&gt;<a onClick="logVariable('id')" class="var it45576" onMouseOver="hilite(45576)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l280"><span class="linenum"> 280</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it28572" onMouseOver="hilite(28572)" onMouseOut="lolite()" onClick="logVariable('user32')" href="../../_variables/user32.html">$user32</a>-&gt;<a onClick="logVariable('id')" class="var it45577" onMouseOver="hilite(45577)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l281"><span class="linenum"> 281</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it28573" onMouseOver="hilite(28573)" onMouseOut="lolite()" onClick="logVariable('userall')" href="../../_variables/userall.html">$userall</a>-&gt;<a onClick="logVariable('id')" class="var it45578" onMouseOver="hilite(45578)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l282"><span class="linenum"> 282</span></a>  
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment">        // Create 3 groups.</span>
<a name="l284"><span class="linenum"> 284</span></a>          <a class="var it664" onMouseOver="hilite(664)" onMouseOut="lolite()" onClick="logVariable('group1')" href="../../_variables/group1.html">$group1</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group')" href="../../_functions/create_group.html" onMouseOver="funcPopup(event,'create_group')">create_group</a>(array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l285"><span class="linenum"> 285</span></a>          <a class="var it665" onMouseOver="hilite(665)" onMouseOut="lolite()" onClick="logVariable('group2')" href="../../_variables/group2.html">$group2</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group')" href="../../_functions/create_group.html" onMouseOver="funcPopup(event,'create_group')">create_group</a>(array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l286"><span class="linenum"> 286</span></a>          <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('group3')" href="../../_variables/group3.html">$group3</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group')" href="../../_functions/create_group.html" onMouseOver="funcPopup(event,'create_group')">create_group</a>(array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment">        // Add the users to the groups.</span>
<a name="l289"><span class="linenum"> 289</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group_member')" href="../../_functions/create_group_member.html" onMouseOver="funcPopup(event,'create_group_member')">create_group_member</a>(array('groupid' =&gt; <a class="var it664" onMouseOver="hilite(664)" onMouseOut="lolite()" onClick="logVariable('group1')" href="../../_variables/group1.html">$group1</a>-&gt;<a onClick="logVariable('id')" class="var it42926" onMouseOver="hilite(42926)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it42951" onMouseOver="hilite(42951)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l290"><span class="linenum"> 290</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group_member')" href="../../_functions/create_group_member.html" onMouseOver="funcPopup(event,'create_group_member')">create_group_member</a>(array('groupid' =&gt; <a class="var it665" onMouseOver="hilite(665)" onMouseOut="lolite()" onClick="logVariable('group2')" href="../../_variables/group2.html">$group2</a>-&gt;<a onClick="logVariable('id')" class="var it42927" onMouseOver="hilite(42927)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it42952" onMouseOver="hilite(42952)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l291"><span class="linenum"> 291</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group_member')" href="../../_functions/create_group_member.html" onMouseOver="funcPopup(event,'create_group_member')">create_group_member</a>(array('groupid' =&gt; <a class="var it665" onMouseOver="hilite(665)" onMouseOut="lolite()" onClick="logVariable('group2')" href="../../_variables/group2.html">$group2</a>-&gt;<a onClick="logVariable('id')" class="var it42927" onMouseOver="hilite(42927)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it28570" onMouseOver="hilite(28570)" onMouseOut="lolite()" onClick="logVariable('user2su')" href="../../_variables/user2su.html">$user2su</a>-&gt;<a onClick="logVariable('id')" class="var it45575" onMouseOver="hilite(45575)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l292"><span class="linenum"> 292</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group_member')" href="../../_functions/create_group_member.html" onMouseOver="funcPopup(event,'create_group_member')">create_group_member</a>(array('groupid' =&gt; <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('group3')" href="../../_variables/group3.html">$group3</a>-&gt;<a onClick="logVariable('id')" class="var it42928" onMouseOver="hilite(42928)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it28571" onMouseOver="hilite(28571)" onMouseOut="lolite()" onClick="logVariable('user31')" href="../../_variables/user31.html">$user31</a>-&gt;<a onClick="logVariable('id')" class="var it45576" onMouseOver="hilite(45576)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l293"><span class="linenum"> 293</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group_member')" href="../../_functions/create_group_member.html" onMouseOver="funcPopup(event,'create_group_member')">create_group_member</a>(array('groupid' =&gt; <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('group3')" href="../../_variables/group3.html">$group3</a>-&gt;<a onClick="logVariable('id')" class="var it42928" onMouseOver="hilite(42928)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it28572" onMouseOver="hilite(28572)" onMouseOut="lolite()" onClick="logVariable('user32')" href="../../_variables/user32.html">$user32</a>-&gt;<a onClick="logVariable('id')" class="var it45577" onMouseOver="hilite(45577)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l294"><span class="linenum"> 294</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group_member')" href="../../_functions/create_group_member.html" onMouseOver="funcPopup(event,'create_group_member')">create_group_member</a>(array('groupid' =&gt; <a class="var it664" onMouseOver="hilite(664)" onMouseOut="lolite()" onClick="logVariable('group1')" href="../../_variables/group1.html">$group1</a>-&gt;<a onClick="logVariable('id')" class="var it42926" onMouseOver="hilite(42926)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it28573" onMouseOver="hilite(28573)" onMouseOut="lolite()" onClick="logVariable('userall')" href="../../_variables/userall.html">$userall</a>-&gt;<a onClick="logVariable('id')" class="var it45578" onMouseOver="hilite(45578)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l295"><span class="linenum"> 295</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group_member')" href="../../_functions/create_group_member.html" onMouseOver="funcPopup(event,'create_group_member')">create_group_member</a>(array('groupid' =&gt; <a class="var it665" onMouseOver="hilite(665)" onMouseOut="lolite()" onClick="logVariable('group2')" href="../../_variables/group2.html">$group2</a>-&gt;<a onClick="logVariable('id')" class="var it42927" onMouseOver="hilite(42927)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it28573" onMouseOver="hilite(28573)" onMouseOut="lolite()" onClick="logVariable('userall')" href="../../_variables/userall.html">$userall</a>-&gt;<a onClick="logVariable('id')" class="var it45578" onMouseOver="hilite(45578)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l296"><span class="linenum"> 296</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_group_member')" href="../../_functions/create_group_member.html" onMouseOver="funcPopup(event,'create_group_member')">create_group_member</a>(array('groupid' =&gt; <a class="var it668" onMouseOver="hilite(668)" onMouseOut="lolite()" onClick="logVariable('group3')" href="../../_variables/group3.html">$group3</a>-&gt;<a onClick="logVariable('id')" class="var it42928" onMouseOver="hilite(42928)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it28573" onMouseOver="hilite(28573)" onMouseOut="lolite()" onClick="logVariable('userall')" href="../../_variables/userall.html">$userall</a>-&gt;<a onClick="logVariable('id')" class="var it45578" onMouseOver="hilite(45578)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l297"><span class="linenum"> 297</span></a>  
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment">        // Create a role to add the allowedcaps. Users will have this role assigned.</span>
<a name="l299"><span class="linenum"> 299</span></a>          <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_role')" href="../../_functions/create_role.html" onMouseOver="funcPopup(event,'create_role')">create_role</a>();
<a name="l300"><span class="linenum"> 300</span></a>  <span class="comment">        // Allow the specified capabilities.</span>
<a name="l301"><span class="linenum"> 301</span></a>          if (!empty(<a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>['allowedcaps'])) {
<a name="l302"><span class="linenum"> 302</span></a>              foreach (<a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>['allowedcaps'] as <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>) {
<a name="l303"><span class="linenum"> 303</span></a>                  <a class="function" onClick="logFunction('assign_capability')" href="../../_functions/assign_capability.html" onMouseOver="funcPopup(event,'assign_capability')">assign_capability</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="constant" onClick="logConstant('CAP_ALLOW')" href="../../_constants/CAP_ALLOW.html" onMouseOver="constPopup(event,'CAP_ALLOW')">CAP_ALLOW</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>);
<a name="l304"><span class="linenum"> 304</span></a>              }
<a name="l305"><span class="linenum"> 305</span></a>          }
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">        // For each of the users, configure everything, perform the call, and assert results.</span>
<a name="l308"><span class="linenum"> 308</span></a>          foreach (<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../_variables/results.html">$results</a> as <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> =&gt; <a class="var it23497" onMouseOver="hilite(23497)" onMouseOut="lolite()" onClick="logVariable('expectations')" href="../../_variables/expectations.html">$expectations</a>) {
<a name="l309"><span class="linenum"> 309</span></a>  <span class="comment">            // Convert canview expectations into a nice array of ids for easier handling.</span>
<a name="l310"><span class="linenum"> 310</span></a>              <a class="var it9517" onMouseOver="hilite(9517)" onMouseOut="lolite()" onClick="logVariable('canview')" href="../../_variables/canview.html">$canview</a> = array();
<a name="l311"><span class="linenum"> 311</span></a>              <a class="var it2248" onMouseOver="hilite(2248)" onMouseOut="lolite()" onClick="logVariable('exception')" href="../../_variables/exception.html">$exception</a> = null;
<a name="l312"><span class="linenum"> 312</span></a>  <span class="comment">            // Analyse the expectations.</span>
<a name="l313"><span class="linenum"> 313</span></a>              if (isset(<a class="var it23497" onMouseOver="hilite(23497)" onMouseOut="lolite()" onClick="logVariable('expectations')" href="../../_variables/expectations.html">$expectations</a>['canview'])) {
<a name="l314"><span class="linenum"> 314</span></a>                  foreach (<a class="var it23497" onMouseOver="hilite(23497)" onMouseOut="lolite()" onClick="logVariable('expectations')" href="../../_variables/expectations.html">$expectations</a>['canview'] as <a class="var it16028" onMouseOver="hilite(16028)" onMouseOut="lolite()" onClick="logVariable('canviewuser')" href="../../_variables/canviewuser.html">$canviewuser</a>) {
<a name="l315"><span class="linenum"> 315</span></a>                      <a class="var it9517" onMouseOver="hilite(9517)" onMouseOut="lolite()" onClick="logVariable('canview')" href="../../_variables/canview.html">$canview</a>[] = <a class="var it28574" onMouseOver="hilite(28574)" onMouseOut="lolite()" onClick="logVariable('createdusers')" href="../../_variables/createdusers.html">$createdusers</a>[${<a class="var it16028" onMouseOver="hilite(16028)" onMouseOut="lolite()" onClick="logVariable('canviewuser')" href="../../_variables/canviewuser.html">$canviewuser</a>}-&gt;id];
<a name="l316"><span class="linenum"> 316</span></a>                  }
<a name="l317"><span class="linenum"> 317</span></a>              } else if (isset(<a class="var it23497" onMouseOver="hilite(23497)" onMouseOut="lolite()" onClick="logVariable('expectations')" href="../../_variables/expectations.html">$expectations</a>['exception'])) {
<a name="l318"><span class="linenum"> 318</span></a>                  <a class="var it2248" onMouseOver="hilite(2248)" onMouseOut="lolite()" onClick="logVariable('exception')" href="../../_variables/exception.html">$exception</a> = <a class="var it23497" onMouseOver="hilite(23497)" onMouseOut="lolite()" onClick="logVariable('expectations')" href="../../_variables/expectations.html">$expectations</a>['exception'];
<a name="l319"><span class="linenum"> 319</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;expectException(<a class="var it2248" onMouseOver="hilite(2248)" onMouseOut="lolite()" onClick="logVariable('exception')" href="../../_variables/exception.html">$exception</a>['type']);
<a name="l320"><span class="linenum"> 320</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;expectExceptionMessage(<a class="var it2248" onMouseOver="hilite(2248)" onMouseOut="lolite()" onClick="logVariable('exception')" href="../../_variables/exception.html">$exception</a>['message']);
<a name="l321"><span class="linenum"> 321</span></a>              } else {
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment">                // Failed, only canview and exception are supported.</span>
<a name="l323"><span class="linenum"> 323</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;markTestIncomplete('Incomplete, only canview and exception are supported');
<a name="l324"><span class="linenum"> 324</span></a>              }
<a name="l325"><span class="linenum"> 325</span></a>  <span class="comment">            // Switch to the user and assign the role.</span>
<a name="l326"><span class="linenum"> 326</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('setUser')" href="../../_functions/setuser.html" onMouseOver="funcPopup(event,'setuser')">setUser</a>(${<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>});
<a name="l327"><span class="linenum"> 327</span></a>              <a class="function" onClick="logFunction('role_assign')" href="../../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>);
<a name="l328"><span class="linenum"> 328</span></a>  
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment">            // Convert groupid to proper id.</span>
<a name="l330"><span class="linenum"> 330</span></a>              <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> = 0;
<a name="l331"><span class="linenum"> 331</span></a>              if (isset(<a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>['groupid'])) {
<a name="l332"><span class="linenum"> 332</span></a>                  <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a> = ${<a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>['groupid']}-&gt;id;
<a name="l333"><span class="linenum"> 333</span></a>              }
<a name="l334"><span class="linenum"> 334</span></a>  
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment">            // Call to the function.</span>
<a name="l336"><span class="linenum"> 336</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = array(
<a name="l337"><span class="linenum"> 337</span></a>                  array('name' =&gt; 'withcapability', 'value' =&gt; <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>['withcapability']),
<a name="l338"><span class="linenum"> 338</span></a>                  array('name' =&gt; 'groupid', 'value' =&gt; <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../../_variables/groupid.html">$groupid</a>),
<a name="l339"><span class="linenum"> 339</span></a>                  array('name' =&gt; 'onlyactive', 'value' =&gt; <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>['onlyactive']),
<a name="l340"><span class="linenum"> 340</span></a>                  array('name' =&gt; 'userfields', 'value' =&gt; 'id')
<a name="l341"><span class="linenum"> 341</span></a>              );
<a name="l342"><span class="linenum"> 342</span></a>              <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a> = <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users')" href="../../_functions/get_enrolled_users.html" onMouseOver="funcPopup(event,'get_enrolled_users')">get_enrolled_users</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>);
<a name="l343"><span class="linenum"> 343</span></a>  
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment">            // We need to execute the return values cleaning process to simulate the web service server.</span>
<a name="l345"><span class="linenum"> 345</span></a>              <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a> = <a class="class" onClick="logClass('external_api')" href="../../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>(<a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users_returns')" href="../../_functions/get_enrolled_users_returns.html" onMouseOver="funcPopup(event,'get_enrolled_users_returns')">get_enrolled_users_returns</a>(), <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a>);
<a name="l346"><span class="linenum"> 346</span></a>  
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment">            // We are only interested in ids to check visibility.</span>
<a name="l348"><span class="linenum"> 348</span></a>              <a class="var it8651" onMouseOver="hilite(8651)" onMouseOut="lolite()" onClick="logVariable('viewed')" href="../../_variables/viewed.html">$viewed</a> = array();
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment">            // Verify the user canview the expected users.</span>
<a name="l350"><span class="linenum"> 350</span></a>              foreach (<a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a> as <a class="var it23992" onMouseOver="hilite(23992)" onMouseOut="lolite()" onClick="logVariable('enrolleduser')" href="../../_variables/enrolleduser.html">$enrolleduser</a>) {
<a name="l351"><span class="linenum"> 351</span></a>                  <a class="var it8651" onMouseOver="hilite(8651)" onMouseOut="lolite()" onClick="logVariable('viewed')" href="../../_variables/viewed.html">$viewed</a>[] = <a class="var it28574" onMouseOver="hilite(28574)" onMouseOut="lolite()" onClick="logVariable('createdusers')" href="../../_variables/createdusers.html">$createdusers</a>[<a class="var it23992" onMouseOver="hilite(23992)" onMouseOut="lolite()" onClick="logVariable('enrolleduser')" href="../../_variables/enrolleduser.html">$enrolleduser</a>['id']];
<a name="l352"><span class="linenum"> 352</span></a>              }
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment">            // Verify viewed matches canview expectation (using canonicalize to ignore ordering).</span>
<a name="l354"><span class="linenum"> 354</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(<a class="var it9517" onMouseOver="hilite(9517)" onMouseOut="lolite()" onClick="logVariable('canview')" href="../../_variables/canview.html">$canview</a>, <a class="var it8651" onMouseOver="hilite(8651)" onMouseOut="lolite()" onClick="logVariable('viewed')" href="../../_variables/viewed.html">$viewed</a>, &quot;Problem checking visible users for '{<a class="var it28574" onMouseOver="hilite(28574)" onMouseOut="lolite()" onClick="logVariable('createdusers')" href="../../_variables/createdusers.html">$createdusers</a>[<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]}'&quot;, 0, 1, true);
<a name="l355"><span class="linenum"> 355</span></a>          }
<a name="l356"><span class="linenum"> 356</span></a>      }
<a name="l357"><span class="linenum"> 357</span></a>  
<a name="l358"><span class="linenum"> 358</span></a>      <span class="comment">/**</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment">     * Test get_users_courses</span>
<a name="l360"><span class="linenum"> 360</span></a>  <span class="comment">     */</span>
<a name="l361"><span class="linenum"> 361</span></a>      public function <a class="function" onClick="logFunction('test_get_users_courses')" href="../../_functions/test_get_users_courses.html" onMouseOver="funcPopup(event,'test_get_users_courses')">test_get_users_courses</a>() {
<a name="l362"><span class="linenum"> 362</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l363"><span class="linenum"> 363</span></a>  
<a name="l364"><span class="linenum"> 364</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('resetAfterTest')" href="../../_functions/resetaftertest.html" onMouseOver="funcPopup(event,'resetaftertest')">resetAfterTest</a>(true);
<a name="l365"><span class="linenum"> 365</span></a>  
<a name="l366"><span class="linenum"> 366</span></a>          <a class="var it8358" onMouseOver="hilite(8358)" onMouseOut="lolite()" onClick="logVariable('coursedata1')" href="../../_variables/coursedata1.html">$coursedata1</a> = array(
<a name="l367"><span class="linenum"> 367</span></a>              'fullname'         =&gt; '&lt;b&gt;Course 1&lt;/b&gt;',                // Adding tags here to check that external_format_string works.
<a name="l368"><span class="linenum"> 368</span></a>              'shortname'         =&gt; '&lt;b&gt;Course 1&lt;/b&gt;',               // Adding tags here to check that external_format_string works.
<a name="l369"><span class="linenum"> 369</span></a>              'summary'          =&gt; 'Lightwork Course 1 description',
<a name="l370"><span class="linenum"> 370</span></a>              'summaryformat'    =&gt; <a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a>,
<a name="l371"><span class="linenum"> 371</span></a>              'lang'             =&gt; 'en',
<a name="l372"><span class="linenum"> 372</span></a>              'enablecompletion' =&gt; true,
<a name="l373"><span class="linenum"> 373</span></a>              'showgrades'       =&gt; true
<a name="l374"><span class="linenum"> 374</span></a>          );
<a name="l375"><span class="linenum"> 375</span></a>  
<a name="l376"><span class="linenum"> 376</span></a>          <a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_course')" href="../../_functions/create_course.html" onMouseOver="funcPopup(event,'create_course')">create_course</a>(<a class="var it8358" onMouseOver="hilite(8358)" onMouseOut="lolite()" onClick="logVariable('coursedata1')" href="../../_variables/coursedata1.html">$coursedata1</a>);
<a name="l377"><span class="linenum"> 377</span></a>          <a class="var it703" onMouseOver="hilite(703)" onMouseOut="lolite()" onClick="logVariable('course2')" href="../../_variables/course2.html">$course2</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_course')" href="../../_functions/create_course.html" onMouseOver="funcPopup(event,'create_course')">create_course</a>();
<a name="l378"><span class="linenum"> 378</span></a>          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = array(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>, <a class="var it703" onMouseOver="hilite(703)" onMouseOut="lolite()" onClick="logVariable('course2')" href="../../_variables/course2.html">$course2</a>);
<a name="l379"><span class="linenum"> 379</span></a>  
<a name="l380"><span class="linenum"> 380</span></a>  <span class="comment">        // Enrol $USER in the courses.</span>
<a name="l381"><span class="linenum"> 381</span></a>  <span class="comment">        // We use the manual plugin.</span>
<a name="l382"><span class="linenum"> 382</span></a>          <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a> = null;
<a name="l383"><span class="linenum"> 383</span></a>          <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> = array();
<a name="l384"><span class="linenum"> 384</span></a>          foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l385"><span class="linenum"> 385</span></a>              <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l386"><span class="linenum"> 386</span></a>              <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assignUserCapability')" href="../../_functions/assignusercapability.html" onMouseOver="funcPopup(event,'assignusercapability')">assignUserCapability</a>('moodle/course:viewparticipants',
<a name="l387"><span class="linenum"> 387</span></a>                      <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;id, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>);
<a name="l388"><span class="linenum"> 388</span></a>  
<a name="l389"><span class="linenum"> 389</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, 'manual');
<a name="l390"><span class="linenum"> 390</span></a>          }
<a name="l391"><span class="linenum"> 391</span></a>  
<a name="l392"><span class="linenum"> 392</span></a>  <span class="comment">        // Call the external function.</span>
<a name="l393"><span class="linenum"> 393</span></a>          <a class="var it28577" onMouseOver="hilite(28577)" onMouseOut="lolite()" onClick="logVariable('enrolledincourses')" href="../../_variables/enrolledincourses.html">$enrolledincourses</a> = <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_users_courses')" href="../../_functions/get_users_courses.html" onMouseOver="funcPopup(event,'get_users_courses')">get_users_courses</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l394"><span class="linenum"> 394</span></a>  
<a name="l395"><span class="linenum"> 395</span></a>  <span class="comment">        // We need to execute the return values cleaning process to simulate the web service server.</span>
<a name="l396"><span class="linenum"> 396</span></a>          <a class="var it28577" onMouseOver="hilite(28577)" onMouseOut="lolite()" onClick="logVariable('enrolledincourses')" href="../../_variables/enrolledincourses.html">$enrolledincourses</a> = <a class="class" onClick="logClass('external_api')" href="../../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>(<a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_users_courses_returns')" href="../../_functions/get_users_courses_returns.html" onMouseOver="funcPopup(event,'get_users_courses_returns')">get_users_courses_returns</a>(), <a class="var it28577" onMouseOver="hilite(28577)" onMouseOut="lolite()" onClick="logVariable('enrolledincourses')" href="../../_variables/enrolledincourses.html">$enrolledincourses</a>);
<a name="l397"><span class="linenum"> 397</span></a>  
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">        // Check we retrieve the good total number of enrolled users.</span>
<a name="l399"><span class="linenum"> 399</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(2, <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it28577" onMouseOver="hilite(28577)" onMouseOut="lolite()" onClick="logVariable('enrolledincourses')" href="../../_variables/enrolledincourses.html">$enrolledincourses</a>));
<a name="l400"><span class="linenum"> 400</span></a>  
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment">        // We need to format summary and summaryformat before to compare them with those values returned by the webservice.</span>
<a name="l402"><span class="linenum"> 402</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('summary')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/summary.html">summary</a>, <a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('summaryformat')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/summaryformat.html">summaryformat</a>) =
<a name="l403"><span class="linenum"> 403</span></a>               <a class="function" onClick="logFunction('external_format_text')" href="../../_functions/external_format_text.html" onMouseOver="funcPopup(event,'external_format_text')">external_format_text</a>(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('summary')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/summary.html">summary</a>, <a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('summaryformat')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/summaryformat.html">summaryformat</a>, <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>[<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('id')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;id, 'course', 'summary', 0);
<a name="l404"><span class="linenum"> 404</span></a>  
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment">        // Check there are no differences between $course1 properties and course values returned by the webservice</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">        // only for those fields listed in the $coursedata1 array.</span>
<a name="l407"><span class="linenum"> 407</span></a>          <a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('fullname')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a> = <a class="function" onClick="logFunction('external_format_string')" href="../../_functions/external_format_string.html" onMouseOver="funcPopup(event,'external_format_string')">external_format_string</a>(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('fullname')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/fullname.html">fullname</a>, <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>[<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('id')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;id);
<a name="l408"><span class="linenum"> 408</span></a>          <a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('shortname')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a> = <a class="function" onClick="logFunction('external_format_string')" href="../../_functions/external_format_string.html" onMouseOver="funcPopup(event,'external_format_string')">external_format_string</a>(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('shortname')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>, <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>[<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('id')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]-&gt;id);
<a name="l409"><span class="linenum"> 409</span></a>          foreach (<a class="var it28577" onMouseOver="hilite(28577)" onMouseOut="lolite()" onClick="logVariable('enrolledincourses')" href="../../_variables/enrolledincourses.html">$enrolledincourses</a> as <a class="var it28578" onMouseOver="hilite(28578)" onMouseOut="lolite()" onClick="logVariable('courseenrol')" href="../../_variables/courseenrol.html">$courseenrol</a>) {
<a name="l410"><span class="linenum"> 410</span></a>              if (<a class="var it28578" onMouseOver="hilite(28578)" onMouseOut="lolite()" onClick="logVariable('courseenrol')" href="../../_variables/courseenrol.html">$courseenrol</a>['id'] == <a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('id')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l411"><span class="linenum"> 411</span></a>                  foreach (<a class="var it8358" onMouseOver="hilite(8358)" onMouseOut="lolite()" onClick="logVariable('coursedata1')" href="../../_variables/coursedata1.html">$coursedata1</a> as <a class="var it2227" onMouseOver="hilite(2227)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../../_variables/fieldname.html">$fieldname</a> =&gt; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l412"><span class="linenum"> 412</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(<a class="var it28578" onMouseOver="hilite(28578)" onMouseOut="lolite()" onClick="logVariable('courseenrol')" href="../../_variables/courseenrol.html">$courseenrol</a>[<a class="var it2227" onMouseOver="hilite(2227)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../../_variables/fieldname.html">$fieldname</a>], <a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a class="var it2227" onMouseOver="hilite(2227)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../../_variables/fieldname.html">$fieldname</a>);
<a name="l413"><span class="linenum"> 413</span></a>                  }
<a name="l414"><span class="linenum"> 414</span></a>              }
<a name="l415"><span class="linenum"> 415</span></a>          }
<a name="l416"><span class="linenum"> 416</span></a>      }
<a name="l417"><span class="linenum"> 417</span></a>  
<a name="l418"><span class="linenum"> 418</span></a>      <span class="comment">/**</span>
<a name="l419"><span class="linenum"> 419</span></a>  <span class="comment">     * Test get_course_enrolment_methods</span>
<a name="l420"><span class="linenum"> 420</span></a>  <span class="comment">     */</span>
<a name="l421"><span class="linenum"> 421</span></a>      public function <a class="function" onClick="logFunction('test_get_course_enrolment_methods')" href="../../_functions/test_get_course_enrolment_methods.html" onMouseOver="funcPopup(event,'test_get_course_enrolment_methods')">test_get_course_enrolment_methods</a>() {
<a name="l422"><span class="linenum"> 422</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('resetAfterTest')" href="../../_functions/resetaftertest.html" onMouseOver="funcPopup(event,'resetaftertest')">resetAfterTest</a>(true);
<a name="l425"><span class="linenum"> 425</span></a>  
<a name="l426"><span class="linenum"> 426</span></a>  <span class="comment">        // Get enrolment plugins.</span>
<a name="l427"><span class="linenum"> 427</span></a>          <a class="var it4717" onMouseOver="hilite(4717)" onMouseOut="lolite()" onClick="logVariable('selfplugin')" href="../../_variables/selfplugin.html">$selfplugin</a> = <a class="function" onClick="logFunction('enrol_get_plugin')" href="../../_functions/enrol_get_plugin.html" onMouseOver="funcPopup(event,'enrol_get_plugin')">enrol_get_plugin</a>('self');
<a name="l428"><span class="linenum"> 428</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertNotEmpty')" href="../../_functions/assertnotempty.html" onMouseOver="funcPopup(event,'assertnotempty')">assertNotEmpty</a>(<a class="var it4717" onMouseOver="hilite(4717)" onMouseOut="lolite()" onClick="logVariable('selfplugin')" href="../../_variables/selfplugin.html">$selfplugin</a>);
<a name="l429"><span class="linenum"> 429</span></a>          <a class="var it3179" onMouseOver="hilite(3179)" onMouseOut="lolite()" onClick="logVariable('manualplugin')" href="../../_variables/manualplugin.html">$manualplugin</a> = <a class="function" onClick="logFunction('enrol_get_plugin')" href="../../_functions/enrol_get_plugin.html" onMouseOver="funcPopup(event,'enrol_get_plugin')">enrol_get_plugin</a>('manual');
<a name="l430"><span class="linenum"> 430</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertNotEmpty')" href="../../_functions/assertnotempty.html" onMouseOver="funcPopup(event,'assertnotempty')">assertNotEmpty</a>(<a class="var it3179" onMouseOver="hilite(3179)" onMouseOut="lolite()" onClick="logVariable('manualplugin')" href="../../_variables/manualplugin.html">$manualplugin</a>);
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>          <a class="var it1111" onMouseOver="hilite(1111)" onMouseOut="lolite()" onClick="logVariable('studentrole')" href="../../_variables/studentrole.html">$studentrole</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('role', array('shortname'=&gt;'student'));
<a name="l433"><span class="linenum"> 433</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertNotEmpty')" href="../../_functions/assertnotempty.html" onMouseOver="funcPopup(event,'assertnotempty')">assertNotEmpty</a>(<a class="var it1111" onMouseOver="hilite(1111)" onMouseOut="lolite()" onClick="logVariable('studentrole')" href="../../_variables/studentrole.html">$studentrole</a>);
<a name="l434"><span class="linenum"> 434</span></a>  
<a name="l435"><span class="linenum"> 435</span></a>          <a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_course')" href="../../_functions/create_course.html" onMouseOver="funcPopup(event,'create_course')">create_course</a>();
<a name="l436"><span class="linenum"> 436</span></a>          <a class="var it4718" onMouseOver="hilite(4718)" onMouseOut="lolite()" onClick="logVariable('coursedata')" href="../../_variables/coursedata.html">$coursedata</a> = new stdClass();
<a name="l437"><span class="linenum"> 437</span></a>          <a class="var it4718" onMouseOver="hilite(4718)" onMouseOut="lolite()" onClick="logVariable('coursedata')" href="../../_variables/coursedata.html">$coursedata</a>-&gt;<a onClick="logVariable('visible')" class="var it43728" onMouseOver="hilite(43728)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a> = 0;
<a name="l438"><span class="linenum"> 438</span></a>          <a class="var it703" onMouseOver="hilite(703)" onMouseOut="lolite()" onClick="logVariable('course2')" href="../../_variables/course2.html">$course2</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_course')" href="../../_functions/create_course.html" onMouseOver="funcPopup(event,'create_course')">create_course</a>(<a class="var it4718" onMouseOver="hilite(4718)" onMouseOut="lolite()" onClick="logVariable('coursedata')" href="../../_variables/coursedata.html">$coursedata</a>);
<a name="l439"><span class="linenum"> 439</span></a>  
<a name="l440"><span class="linenum"> 440</span></a>  <span class="comment">        // Add enrolment methods for course.</span>
<a name="l441"><span class="linenum"> 441</span></a>          <a class="var it4719" onMouseOver="hilite(4719)" onMouseOut="lolite()" onClick="logVariable('instanceid1')" href="../../_variables/instanceid1.html">$instanceid1</a> = <a class="var it4717" onMouseOver="hilite(4717)" onMouseOut="lolite()" onClick="logVariable('selfplugin')" href="../../_variables/selfplugin.html">$selfplugin</a>-&gt;<a class="function" onClick="logFunction('add_instance')" href="../../_functions/add_instance.html" onMouseOver="funcPopup(event,'add_instance')">add_instance</a>(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>, array('status' =&gt; <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>,
<a name="l442"><span class="linenum"> 442</span></a>                                                                  'name' =&gt; 'Test instance 1',
<a name="l443"><span class="linenum"> 443</span></a>                                                                  'customint6' =&gt; 1,
<a name="l444"><span class="linenum"> 444</span></a>                                                                  'roleid' =&gt; <a class="var it1111" onMouseOver="hilite(1111)" onMouseOut="lolite()" onClick="logVariable('studentrole')" href="../../_variables/studentrole.html">$studentrole</a>-&gt;<a onClick="logVariable('id')" class="var it42933" onMouseOver="hilite(42933)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l445"><span class="linenum"> 445</span></a>          <a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('instanceid2')" href="../../_variables/instanceid2.html">$instanceid2</a> = <a class="var it4717" onMouseOver="hilite(4717)" onMouseOut="lolite()" onClick="logVariable('selfplugin')" href="../../_variables/selfplugin.html">$selfplugin</a>-&gt;<a class="function" onClick="logFunction('add_instance')" href="../../_functions/add_instance.html" onMouseOver="funcPopup(event,'add_instance')">add_instance</a>(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>, array('status' =&gt; <a class="constant" onClick="logConstant('ENROL_INSTANCE_DISABLED')" href="../../_constants/ENROL_INSTANCE_DISABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_DISABLED')">ENROL_INSTANCE_DISABLED</a>,
<a name="l446"><span class="linenum"> 446</span></a>                                                                  'name' =&gt; 'Test instance 2',
<a name="l447"><span class="linenum"> 447</span></a>                                                                  'roleid' =&gt; <a class="var it1111" onMouseOver="hilite(1111)" onMouseOut="lolite()" onClick="logVariable('studentrole')" href="../../_variables/studentrole.html">$studentrole</a>-&gt;<a onClick="logVariable('id')" class="var it42933" onMouseOver="hilite(42933)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l448"><span class="linenum"> 448</span></a>  
<a name="l449"><span class="linenum"> 449</span></a>          <a class="var it4721" onMouseOver="hilite(4721)" onMouseOut="lolite()" onClick="logVariable('instanceid3')" href="../../_variables/instanceid3.html">$instanceid3</a> = <a class="var it3179" onMouseOver="hilite(3179)" onMouseOut="lolite()" onClick="logVariable('manualplugin')" href="../../_variables/manualplugin.html">$manualplugin</a>-&gt;<a class="function" onClick="logFunction('add_instance')" href="../../_functions/add_instance.html" onMouseOver="funcPopup(event,'add_instance')">add_instance</a>(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>, array('status' =&gt; <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>,
<a name="l450"><span class="linenum"> 450</span></a>                                                                  'name' =&gt; 'Test instance 3'));
<a name="l451"><span class="linenum"> 451</span></a>  
<a name="l452"><span class="linenum"> 452</span></a>          <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('enrol', array('courseid' =&gt; <a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('id')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'status' =&gt; <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>));
<a name="l453"><span class="linenum"> 453</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertCount(2, <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a>);
<a name="l454"><span class="linenum"> 454</span></a>  
<a name="l455"><span class="linenum"> 455</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('setAdminUser')" href="../../_functions/setadminuser.html" onMouseOver="funcPopup(event,'setadminuser')">setAdminUser</a>();
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">        // Check if information is returned.</span>
<a name="l458"><span class="linenum"> 458</span></a>          <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a> = <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_course_enrolment_methods')" href="../../_functions/get_course_enrolment_methods.html" onMouseOver="funcPopup(event,'get_course_enrolment_methods')">get_course_enrolment_methods</a>(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('id')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l459"><span class="linenum"> 459</span></a>          <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a> = <a class="class" onClick="logClass('external_api')" href="../../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>(<a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_course_enrolment_methods_returns')" href="../../_functions/get_course_enrolment_methods_returns.html" onMouseOver="funcPopup(event,'get_course_enrolment_methods_returns')">get_course_enrolment_methods_returns</a>(),
<a name="l460"><span class="linenum"> 460</span></a>                                                              <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a>);
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">        // Enrolment information is currently returned by self enrolment plugin, so count == 1.</span>
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment">        // This should be changed as we implement get_enrol_info() for other enrolment plugins.</span>
<a name="l463"><span class="linenum"> 463</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertCount(1, <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a>);
<a name="l464"><span class="linenum"> 464</span></a>  
<a name="l465"><span class="linenum"> 465</span></a>          <a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a> = <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a>[0];
<a name="l466"><span class="linenum"> 466</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(<a class="var it690" onMouseOver="hilite(690)" onMouseOut="lolite()" onClick="logVariable('course1')" href="../../_variables/course1.html">$course1</a>-&gt;<a onClick="logVariable('id')" class="var it43179" onMouseOver="hilite(43179)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a>['courseid']);
<a name="l467"><span class="linenum"> 467</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>('self', <a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a>['type']);
<a name="l468"><span class="linenum"> 468</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertTrue(<a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a>['status']);
<a name="l469"><span class="linenum"> 469</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertFalse(isset(<a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a>['wsfunction']));
<a name="l470"><span class="linenum"> 470</span></a>  
<a name="l471"><span class="linenum"> 471</span></a>          <a class="var it28580" onMouseOver="hilite(28580)" onMouseOut="lolite()" onClick="logVariable('instanceid4')" href="../../_variables/instanceid4.html">$instanceid4</a> = <a class="var it4717" onMouseOver="hilite(4717)" onMouseOut="lolite()" onClick="logVariable('selfplugin')" href="../../_variables/selfplugin.html">$selfplugin</a>-&gt;<a class="function" onClick="logFunction('add_instance')" href="../../_functions/add_instance.html" onMouseOver="funcPopup(event,'add_instance')">add_instance</a>(<a class="var it703" onMouseOver="hilite(703)" onMouseOut="lolite()" onClick="logVariable('course2')" href="../../_variables/course2.html">$course2</a>, array('status' =&gt; <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>,
<a name="l472"><span class="linenum"> 472</span></a>                                                                  'name' =&gt; 'Test instance 4',
<a name="l473"><span class="linenum"> 473</span></a>                                                                  'roleid' =&gt; <a class="var it1111" onMouseOver="hilite(1111)" onMouseOut="lolite()" onClick="logVariable('studentrole')" href="../../_variables/studentrole.html">$studentrole</a>-&gt;<a onClick="logVariable('id')" class="var it42933" onMouseOver="hilite(42933)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l474"><span class="linenum"> 474</span></a>                                                                  'customint6' =&gt; 1,
<a name="l475"><span class="linenum"> 475</span></a>                                                                  'password' =&gt; 'test'));
<a name="l476"><span class="linenum"> 476</span></a>          <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a> = <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_course_enrolment_methods')" href="../../_functions/get_course_enrolment_methods.html" onMouseOver="funcPopup(event,'get_course_enrolment_methods')">get_course_enrolment_methods</a>(<a class="var it703" onMouseOver="hilite(703)" onMouseOut="lolite()" onClick="logVariable('course2')" href="../../_variables/course2.html">$course2</a>-&gt;<a onClick="logVariable('id')" class="var it42953" onMouseOver="hilite(42953)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l477"><span class="linenum"> 477</span></a>          <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a> = <a class="class" onClick="logClass('external_api')" href="../../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>(<a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_course_enrolment_methods_returns')" href="../../_functions/get_course_enrolment_methods_returns.html" onMouseOver="funcPopup(event,'get_course_enrolment_methods_returns')">get_course_enrolment_methods_returns</a>(),
<a name="l478"><span class="linenum"> 478</span></a>                                                              <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a>);
<a name="l479"><span class="linenum"> 479</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertCount(1, <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a>);
<a name="l480"><span class="linenum"> 480</span></a>  
<a name="l481"><span class="linenum"> 481</span></a>          <a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a> = <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethods')" href="../../_variables/enrolmentmethods.html">$enrolmentmethods</a>[0];
<a name="l482"><span class="linenum"> 482</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(<a class="var it703" onMouseOver="hilite(703)" onMouseOut="lolite()" onClick="logVariable('course2')" href="../../_variables/course2.html">$course2</a>-&gt;<a onClick="logVariable('id')" class="var it42953" onMouseOver="hilite(42953)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a>['courseid']);
<a name="l483"><span class="linenum"> 483</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>('self', <a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a>['type']);
<a name="l484"><span class="linenum"> 484</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertTrue(<a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a>['status']);
<a name="l485"><span class="linenum"> 485</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>('enrol_self_get_instance_info', <a class="var it28579" onMouseOver="hilite(28579)" onMouseOut="lolite()" onClick="logVariable('enrolmentmethod')" href="../../_variables/enrolmentmethod.html">$enrolmentmethod</a>['wsfunction']);
<a name="l486"><span class="linenum"> 486</span></a>  
<a name="l487"><span class="linenum"> 487</span></a>  <span class="comment">        // Try to retrieve information using a normal user for a hidden course.</span>
<a name="l488"><span class="linenum"> 488</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>();
<a name="l489"><span class="linenum"> 489</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('setUser')" href="../../_functions/setuser.html" onMouseOver="funcPopup(event,'setuser')">setUser</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>);
<a name="l490"><span class="linenum"> 490</span></a>          try {
<a name="l491"><span class="linenum"> 491</span></a>              <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_course_enrolment_methods')" href="../../_functions/get_course_enrolment_methods.html" onMouseOver="funcPopup(event,'get_course_enrolment_methods')">get_course_enrolment_methods</a>(<a class="var it703" onMouseOver="hilite(703)" onMouseOut="lolite()" onClick="logVariable('course2')" href="../../_variables/course2.html">$course2</a>-&gt;<a onClick="logVariable('id')" class="var it42953" onMouseOver="hilite(42953)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l492"><span class="linenum"> 492</span></a>          } catch (moodle_exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l493"><span class="linenum"> 493</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>('coursehidden', <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('errorcode')" class="var it42938" onMouseOver="hilite(42938)" onMouseOut="lolite()" href="../../_variables/errorcode.html">errorcode</a>);
<a name="l494"><span class="linenum"> 494</span></a>          }
<a name="l495"><span class="linenum"> 495</span></a>      }
<a name="l496"><span class="linenum"> 496</span></a>  
<a name="l497"><span class="linenum"> 497</span></a>      public function <a class="function" onClick="logFunction('get_enrolled_users_setup')" href="../../_functions/get_enrolled_users_setup.html" onMouseOver="funcPopup(event,'get_enrolled_users_setup')">get_enrolled_users_setup</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>) {
<a name="l498"><span class="linenum"> 498</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l499"><span class="linenum"> 499</span></a>  
<a name="l500"><span class="linenum"> 500</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('resetAfterTest')" href="../../_functions/resetaftertest.html" onMouseOver="funcPopup(event,'resetaftertest')">resetAfterTest</a>(true);
<a name="l501"><span class="linenum"> 501</span></a>  
<a name="l502"><span class="linenum"> 502</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = new stdClass();
<a name="l503"><span class="linenum"> 503</span></a>  
<a name="l504"><span class="linenum"> 504</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_course')" href="../../_functions/create_course.html" onMouseOver="funcPopup(event,'create_course')">create_course</a>();
<a name="l505"><span class="linenum"> 505</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('user1')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/user1.html">user1</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>();
<a name="l506"><span class="linenum"> 506</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('user2')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/user2.html">user2</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>();
<a name="l507"><span class="linenum"> 507</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('user3')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/user3.html">user3</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>();
<a name="l508"><span class="linenum"> 508</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('setUser')" href="../../_functions/setuser.html" onMouseOver="funcPopup(event,'setuser')">setUser</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('user3')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/user3.html">user3</a>);
<a name="l509"><span class="linenum"> 509</span></a>  
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment">        // Set the required capabilities by the external function.</span>
<a name="l511"><span class="linenum"> 511</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('context')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/context.html">context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id);
<a name="l512"><span class="linenum"> 512</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('roleid')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assignUserCapability')" href="../../_functions/assignusercapability.html" onMouseOver="funcPopup(event,'assignusercapability')">assignUserCapability</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('context')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>-&gt;id);
<a name="l513"><span class="linenum"> 513</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assignUserCapability')" href="../../_functions/assignusercapability.html" onMouseOver="funcPopup(event,'assignusercapability')">assignUserCapability</a>('moodle/user:viewdetails', <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('context')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('roleid')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>);
<a name="l514"><span class="linenum"> 514</span></a>  
<a name="l515"><span class="linenum"> 515</span></a>  <span class="comment">        // Enrol the users in the course.</span>
<a name="l516"><span class="linenum"> 516</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('user1')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/user1.html">user1</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('roleid')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>, 'manual');
<a name="l517"><span class="linenum"> 517</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('user2')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/user2.html">user2</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('roleid')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>, 'manual');
<a name="l518"><span class="linenum"> 518</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('user3')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/user3.html">user3</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('roleid')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>, 'manual');
<a name="l519"><span class="linenum"> 519</span></a>  
<a name="l520"><span class="linenum"> 520</span></a>          return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l521"><span class="linenum"> 521</span></a>      }
<a name="l522"><span class="linenum"> 522</span></a>  
<a name="l523"><span class="linenum"> 523</span></a>      <span class="comment">/**</span>
<a name="l524"><span class="linenum"> 524</span></a>  <span class="comment">     * Test get_enrolled_users from core_enrol_external without additional</span>
<a name="l525"><span class="linenum"> 525</span></a>  <span class="comment">     * parameters.</span>
<a name="l526"><span class="linenum"> 526</span></a>  <span class="comment">     */</span>
<a name="l527"><span class="linenum"> 527</span></a>      public function <a class="function" onClick="logFunction('test_get_enrolled_users_without_parameters')" href="../../_functions/test_get_enrolled_users_without_parameters.html" onMouseOver="funcPopup(event,'test_get_enrolled_users_without_parameters')">test_get_enrolled_users_without_parameters</a>() {
<a name="l528"><span class="linenum"> 528</span></a>          <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a> = 'moodle/course:viewparticipants';
<a name="l529"><span class="linenum"> 529</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enrolled_users_setup')" href="../../_functions/get_enrolled_users_setup.html" onMouseOver="funcPopup(event,'get_enrolled_users_setup')">get_enrolled_users_setup</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>);
<a name="l530"><span class="linenum"> 530</span></a>  
<a name="l531"><span class="linenum"> 531</span></a>  <span class="comment">        // Call the external function.</span>
<a name="l532"><span class="linenum"> 532</span></a>          <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a> = <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users')" href="../../_functions/get_enrolled_users.html" onMouseOver="funcPopup(event,'get_enrolled_users')">get_enrolled_users</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('course')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id);
<a name="l533"><span class="linenum"> 533</span></a>  
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment">        // We need to execute the return values cleaning process to simulate the web service server.</span>
<a name="l535"><span class="linenum"> 535</span></a>          <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a> = <a class="class" onClick="logClass('external_api')" href="../../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>(<a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users_returns')" href="../../_functions/get_enrolled_users_returns.html" onMouseOver="funcPopup(event,'get_enrolled_users_returns')">get_enrolled_users_returns</a>(), <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a>);
<a name="l536"><span class="linenum"> 536</span></a>  
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment">        // Check the result set.</span>
<a name="l538"><span class="linenum"> 538</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(3, <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a>));
<a name="l539"><span class="linenum"> 539</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertArrayHasKey('email', <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a>[0]);
<a name="l540"><span class="linenum"> 540</span></a>      }
<a name="l541"><span class="linenum"> 541</span></a>  
<a name="l542"><span class="linenum"> 542</span></a>      <span class="comment">/**</span>
<a name="l543"><span class="linenum"> 543</span></a>  <span class="comment">     * Test get_enrolled_users from core_enrol_external with some parameters set.</span>
<a name="l544"><span class="linenum"> 544</span></a>  <span class="comment">     */</span>
<a name="l545"><span class="linenum"> 545</span></a>      public function <a class="function" onClick="logFunction('test_get_enrolled_users_with_parameters')" href="../../_functions/test_get_enrolled_users_with_parameters.html" onMouseOver="funcPopup(event,'test_get_enrolled_users_with_parameters')">test_get_enrolled_users_with_parameters</a>() {
<a name="l546"><span class="linenum"> 546</span></a>          <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a> = 'moodle/course:viewparticipants';
<a name="l547"><span class="linenum"> 547</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enrolled_users_setup')" href="../../_functions/get_enrolled_users_setup.html" onMouseOver="funcPopup(event,'get_enrolled_users_setup')">get_enrolled_users_setup</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>);
<a name="l548"><span class="linenum"> 548</span></a>  
<a name="l549"><span class="linenum"> 549</span></a>  <span class="comment">        // Call the function with some parameters set.</span>
<a name="l550"><span class="linenum"> 550</span></a>          <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a> = <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users')" href="../../_functions/get_enrolled_users.html" onMouseOver="funcPopup(event,'get_enrolled_users')">get_enrolled_users</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('course')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id, array(
<a name="l551"><span class="linenum"> 551</span></a>              array('name' =&gt; 'limitfrom', 'value' =&gt; 2),
<a name="l552"><span class="linenum"> 552</span></a>              array('name' =&gt; 'limitnumber', 'value' =&gt; 1),
<a name="l553"><span class="linenum"> 553</span></a>              array('name' =&gt; 'userfields', 'value' =&gt; 'id')
<a name="l554"><span class="linenum"> 554</span></a>          ));
<a name="l555"><span class="linenum"> 555</span></a>  
<a name="l556"><span class="linenum"> 556</span></a>  <span class="comment">        // We need to execute the return values cleaning process to simulate the web service server.</span>
<a name="l557"><span class="linenum"> 557</span></a>          <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a> = <a class="class" onClick="logClass('external_api')" href="../../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>(<a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users_returns')" href="../../_functions/get_enrolled_users_returns.html" onMouseOver="funcPopup(event,'get_enrolled_users_returns')">get_enrolled_users_returns</a>(), <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a>);
<a name="l558"><span class="linenum"> 558</span></a>  
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">        // Check the result set, we should only get the 3rd result, which is $user3.</span>
<a name="l560"><span class="linenum"> 560</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertCount(1, <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a>);
<a name="l561"><span class="linenum"> 561</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('user3')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/user3.html">user3</a>-&gt;id, <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a>[0]['id']);
<a name="l562"><span class="linenum"> 562</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertArrayHasKey('id', <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a>[0]);
<a name="l563"><span class="linenum"> 563</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;assertArrayNotHasKey('email', <a class="var it28576" onMouseOver="hilite(28576)" onMouseOut="lolite()" onClick="logVariable('enrolledusers')" href="../../_variables/enrolledusers.html">$enrolledusers</a>[0]);
<a name="l564"><span class="linenum"> 564</span></a>      }
<a name="l565"><span class="linenum"> 565</span></a>  
<a name="l566"><span class="linenum"> 566</span></a>      <span class="comment">/**</span>
<a name="l567"><span class="linenum"> 567</span></a>  <span class="comment">     * Test get_enrolled_users from core_enrol_external with capability to</span>
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment">     * viewparticipants removed.</span>
<a name="l569"><span class="linenum"> 569</span></a>  <span class="comment">     *</span>
<a name="l570"><span class="linenum"> 570</span></a>  <span class="comment">     * @expectedException moodle_exception</span>
<a name="l571"><span class="linenum"> 571</span></a>  <span class="comment">     */</span>
<a name="l572"><span class="linenum"> 572</span></a>      public function <a class="function" onClick="logFunction('test_get_enrolled_users_without_capability')" href="../../_functions/test_get_enrolled_users_without_capability.html" onMouseOver="funcPopup(event,'test_get_enrolled_users_without_capability')">test_get_enrolled_users_without_capability</a>() {
<a name="l573"><span class="linenum"> 573</span></a>          <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a> = 'moodle/course:viewparticipants';
<a name="l574"><span class="linenum"> 574</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enrolled_users_setup')" href="../../_functions/get_enrolled_users_setup.html" onMouseOver="funcPopup(event,'get_enrolled_users_setup')">get_enrolled_users_setup</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>);
<a name="l575"><span class="linenum"> 575</span></a>  
<a name="l576"><span class="linenum"> 576</span></a>  <span class="comment">        // Call without required capability.</span>
<a name="l577"><span class="linenum"> 577</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('unassignUserCapability')" href="../../_functions/unassignusercapability.html" onMouseOver="funcPopup(event,'unassignusercapability')">unassignUserCapability</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('context')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/context.html">context</a>-&gt;id, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('roleid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/roleid.html">roleid</a>);
<a name="l578"><span class="linenum"> 578</span></a>          <a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('categories')" href="../../_variables/categories.html">$categories</a> = <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users')" href="../../_functions/get_enrolled_users.html" onMouseOver="funcPopup(event,'get_enrolled_users')">get_enrolled_users</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('course')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id);
<a name="l579"><span class="linenum"> 579</span></a>      }
<a name="l580"><span class="linenum"> 580</span></a>  
<a name="l581"><span class="linenum"> 581</span></a>      public function <a class="function" onClick="logFunction('get_enrolled_users_with_capability_setup')" href="../../_functions/get_enrolled_users_with_capability_setup.html" onMouseOver="funcPopup(event,'get_enrolled_users_with_capability_setup')">get_enrolled_users_with_capability_setup</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>) {
<a name="l582"><span class="linenum"> 582</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l583"><span class="linenum"> 583</span></a>  
<a name="l584"><span class="linenum"> 584</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('resetAfterTest')" href="../../_functions/resetaftertest.html" onMouseOver="funcPopup(event,'resetaftertest')">resetAfterTest</a>(true);
<a name="l585"><span class="linenum"> 585</span></a>  
<a name="l586"><span class="linenum"> 586</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = new stdClass();
<a name="l587"><span class="linenum"> 587</span></a>  
<a name="l588"><span class="linenum"> 588</span></a>  <span class="comment">        // Create the course and fetch its context.</span>
<a name="l589"><span class="linenum"> 589</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_course')" href="../../_functions/create_course.html" onMouseOver="funcPopup(event,'create_course')">create_course</a>();
<a name="l590"><span class="linenum"> 590</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id);
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">        // Create one teacher, and two students.</span>
<a name="l593"><span class="linenum"> 593</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('teacher')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/teacher.html">teacher</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>();
<a name="l594"><span class="linenum"> 594</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('student1')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/student1.html">student1</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>();
<a name="l595"><span class="linenum"> 595</span></a>          <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('student2')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/student2.html">student2</a> = self::<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('create_user')" href="../../_functions/create_user.html" onMouseOver="funcPopup(event,'create_user')">create_user</a>();
<a name="l596"><span class="linenum"> 596</span></a>  
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment">        // Create a new student role based on the student archetype but with the capability prohibitted.</span>
<a name="l598"><span class="linenum"> 598</span></a>          <a class="var it28581" onMouseOver="hilite(28581)" onMouseOut="lolite()" onClick="logVariable('fakestudentroleid')" href="../../_variables/fakestudentroleid.html">$fakestudentroleid</a> = <a class="function" onClick="logFunction('create_role')" href="../../_functions/create_role.html" onMouseOver="funcPopup(event,'create_role')">create_role</a>('Fake student role', 'fakestudent', 'Fake student role', 'student');
<a name="l599"><span class="linenum"> 599</span></a>          <a class="function" onClick="logFunction('assign_capability')" href="../../_functions/assign_capability.html" onMouseOver="funcPopup(event,'assign_capability')">assign_capability</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>, <a class="var it28581" onMouseOver="hilite(28581)" onMouseOut="lolite()" onClick="logVariable('fakestudentroleid')" href="../../_variables/fakestudentroleid.html">$fakestudentroleid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l600"><span class="linenum"> 600</span></a>  
<a name="l601"><span class="linenum"> 601</span></a>  <span class="comment">        // Enrol all of the users in the course.</span>
<a name="l602"><span class="linenum"> 602</span></a>  <span class="comment">        // * 'teacher'  is an editing teacher.</span>
<a name="l603"><span class="linenum"> 603</span></a>  <span class="comment">        // * 'student1' is a standard student.</span>
<a name="l604"><span class="linenum"> 604</span></a>  <span class="comment">        // * 'student2' is a student with the capability prohibitted.</span>
<a name="l605"><span class="linenum"> 605</span></a>          <a class="var it28582" onMouseOver="hilite(28582)" onMouseOut="lolite()" onClick="logVariable('editingteacherroleid')" href="../../_variables/editingteacherroleid.html">$editingteacherroleid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('role', 'id', array('shortname' =&gt; 'editingteacher'));
<a name="l606"><span class="linenum"> 606</span></a>          <a class="var it6511" onMouseOver="hilite(6511)" onMouseOut="lolite()" onClick="logVariable('studentroleid')" href="../../_variables/studentroleid.html">$studentroleid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('role', 'id', array('shortname' =&gt; 'student'));
<a name="l607"><span class="linenum"> 607</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('teacher')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/teacher.html">teacher</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id, <a class="var it28582" onMouseOver="hilite(28582)" onMouseOut="lolite()" onClick="logVariable('editingteacherroleid')" href="../../_variables/editingteacherroleid.html">$editingteacherroleid</a>);
<a name="l608"><span class="linenum"> 608</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('student1')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/student1.html">student1</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id, <a class="var it6511" onMouseOver="hilite(6511)" onMouseOut="lolite()" onClick="logVariable('studentroleid')" href="../../_variables/studentroleid.html">$studentroleid</a>);
<a name="l609"><span class="linenum"> 609</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('getDataGenerator')" href="../../_functions/getdatagenerator.html" onMouseOver="funcPopup(event,'getdatagenerator')">getDataGenerator</a>()-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('student2')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/student2.html">student2</a>-&gt;id, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('course')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id, <a class="var it28581" onMouseOver="hilite(28581)" onMouseOut="lolite()" onClick="logVariable('fakestudentroleid')" href="../../_variables/fakestudentroleid.html">$fakestudentroleid</a>);
<a name="l610"><span class="linenum"> 610</span></a>  
<a name="l611"><span class="linenum"> 611</span></a>  <span class="comment">        // Log in as the teacher.</span>
<a name="l612"><span class="linenum"> 612</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('setUser')" href="../../_functions/setuser.html" onMouseOver="funcPopup(event,'setuser')">setUser</a>(<a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>-&gt;<a onClick="logVariable('teacher')" class="var it44198" onMouseOver="hilite(44198)" onMouseOut="lolite()" href="../../_variables/teacher.html">teacher</a>);
<a name="l613"><span class="linenum"> 613</span></a>  
<a name="l614"><span class="linenum"> 614</span></a>  <span class="comment">        // Clear caches.</span>
<a name="l615"><span class="linenum"> 615</span></a>          <a class="function" onClick="logFunction('accesslib_clear_all_caches_for_unit_testing')" href="../../_functions/accesslib_clear_all_caches_for_unit_testing.html" onMouseOver="funcPopup(event,'accesslib_clear_all_caches_for_unit_testing')">accesslib_clear_all_caches_for_unit_testing</a>();
<a name="l616"><span class="linenum"> 616</span></a>  
<a name="l617"><span class="linenum"> 617</span></a>          return <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l618"><span class="linenum"> 618</span></a>      }
<a name="l619"><span class="linenum"> 619</span></a>  
<a name="l620"><span class="linenum"> 620</span></a>      <span class="comment">/**</span>
<a name="l621"><span class="linenum"> 621</span></a>  <span class="comment">     * Test get_enrolled_users_with_capability without additional paramaters.</span>
<a name="l622"><span class="linenum"> 622</span></a>  <span class="comment">     */</span>
<a name="l623"><span class="linenum"> 623</span></a>      public function <a class="function" onClick="logFunction('test_get_enrolled_users_with_capability_without_parameters')" href="../../_functions/test_get_enrolled_users_with_capability_without_parameters.html" onMouseOver="funcPopup(event,'test_get_enrolled_users_with_capability_without_parameters')">test_get_enrolled_users_with_capability_without_parameters</a>() {
<a name="l624"><span class="linenum"> 624</span></a>          <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a> = 'moodle/course:viewparticipants';
<a name="l625"><span class="linenum"> 625</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enrolled_users_with_capability_setup')" href="../../_functions/get_enrolled_users_with_capability_setup.html" onMouseOver="funcPopup(event,'get_enrolled_users_with_capability_setup')">get_enrolled_users_with_capability_setup</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>);
<a name="l626"><span class="linenum"> 626</span></a>  
<a name="l627"><span class="linenum"> 627</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users_with_capability')" href="../../_functions/get_enrolled_users_with_capability.html" onMouseOver="funcPopup(event,'get_enrolled_users_with_capability')">get_enrolled_users_with_capability</a>(
<a name="l628"><span class="linenum"> 628</span></a>              array(
<a name="l629"><span class="linenum"> 629</span></a>                  'coursecapabilities' =&gt; array(
<a name="l630"><span class="linenum"> 630</span></a>                      'courseid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('course')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id,
<a name="l631"><span class="linenum"> 631</span></a>                      'capabilities' =&gt; array(
<a name="l632"><span class="linenum"> 632</span></a>                          <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>,
<a name="l633"><span class="linenum"> 633</span></a>                      ),
<a name="l634"><span class="linenum"> 634</span></a>                  ),
<a name="l635"><span class="linenum"> 635</span></a>              ),
<a name="l636"><span class="linenum"> 636</span></a>              array()
<a name="l637"><span class="linenum"> 637</span></a>          );
<a name="l638"><span class="linenum"> 638</span></a>  
<a name="l639"><span class="linenum"> 639</span></a>  <span class="comment">        // We need to execute the return values cleaning process to simulate the web service server.</span>
<a name="l640"><span class="linenum"> 640</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="class" onClick="logClass('external_api')" href="../../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>(<a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users_with_capability_returns')" href="../../_functions/get_enrolled_users_with_capability_returns.html" onMouseOver="funcPopup(event,'get_enrolled_users_with_capability_returns')">get_enrolled_users_with_capability_returns</a>(), <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>);
<a name="l641"><span class="linenum"> 641</span></a>  
<a name="l642"><span class="linenum"> 642</span></a>  <span class="comment">        // Check an array containing the expected user for the course capability is returned.</span>
<a name="l643"><span class="linenum"> 643</span></a>          <a class="var it28583" onMouseOver="hilite(28583)" onMouseOut="lolite()" onClick="logVariable('expecteduserlist')" href="../../_variables/expecteduserlist.html">$expecteduserlist</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[0];
<a name="l644"><span class="linenum"> 644</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('course')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id, <a class="var it28583" onMouseOver="hilite(28583)" onMouseOut="lolite()" onClick="logVariable('expecteduserlist')" href="../../_variables/expecteduserlist.html">$expecteduserlist</a>['courseid']);
<a name="l645"><span class="linenum"> 645</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="var it28583" onMouseOver="hilite(28583)" onMouseOut="lolite()" onClick="logVariable('expecteduserlist')" href="../../_variables/expecteduserlist.html">$expecteduserlist</a>['capability']);
<a name="l646"><span class="linenum"> 646</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(2, <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it28583" onMouseOver="hilite(28583)" onMouseOut="lolite()" onClick="logVariable('expecteduserlist')" href="../../_variables/expecteduserlist.html">$expecteduserlist</a>['users']));
<a name="l647"><span class="linenum"> 647</span></a>      }
<a name="l648"><span class="linenum"> 648</span></a>  
<a name="l649"><span class="linenum"> 649</span></a>      <span class="comment">/**</span>
<a name="l650"><span class="linenum"> 650</span></a>  <span class="comment">     * Test get_enrolled_users_with_capability</span>
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">     */</span>
<a name="l652"><span class="linenum"> 652</span></a>      public function <a class="function" onClick="logFunction('test_get_enrolled_users_with_capability_with_parameters')" href="../../_functions/test_get_enrolled_users_with_capability_with_parameters.html" onMouseOver="funcPopup(event,'test_get_enrolled_users_with_capability_with_parameters')">test_get_enrolled_users_with_capability_with_parameters</a> () {
<a name="l653"><span class="linenum"> 653</span></a>          <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a> = 'moodle/course:viewparticipants';
<a name="l654"><span class="linenum"> 654</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enrolled_users_with_capability_setup')" href="../../_functions/get_enrolled_users_with_capability_setup.html" onMouseOver="funcPopup(event,'get_enrolled_users_with_capability_setup')">get_enrolled_users_with_capability_setup</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>);
<a name="l655"><span class="linenum"> 655</span></a>  
<a name="l656"><span class="linenum"> 656</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users_with_capability')" href="../../_functions/get_enrolled_users_with_capability.html" onMouseOver="funcPopup(event,'get_enrolled_users_with_capability')">get_enrolled_users_with_capability</a>(
<a name="l657"><span class="linenum"> 657</span></a>              array(
<a name="l658"><span class="linenum"> 658</span></a>                  'coursecapabilities' =&gt; array(
<a name="l659"><span class="linenum"> 659</span></a>                      'courseid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('course')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>-&gt;id,
<a name="l660"><span class="linenum"> 660</span></a>                      'capabilities' =&gt; array(
<a name="l661"><span class="linenum"> 661</span></a>                          <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>,
<a name="l662"><span class="linenum"> 662</span></a>                      ),
<a name="l663"><span class="linenum"> 663</span></a>                  ),
<a name="l664"><span class="linenum"> 664</span></a>              ),
<a name="l665"><span class="linenum"> 665</span></a>              array(
<a name="l666"><span class="linenum"> 666</span></a>                  array('name' =&gt; 'limitfrom', 'value' =&gt; 1),
<a name="l667"><span class="linenum"> 667</span></a>                  array('name' =&gt; 'limitnumber', 'value' =&gt; 1),
<a name="l668"><span class="linenum"> 668</span></a>                  array('name' =&gt; 'userfields', 'value' =&gt; 'id')
<a name="l669"><span class="linenum"> 669</span></a>              )
<a name="l670"><span class="linenum"> 670</span></a>          );
<a name="l671"><span class="linenum"> 671</span></a>  
<a name="l672"><span class="linenum"> 672</span></a>  <span class="comment">        // We need to execute the return values cleaning process to simulate the web service server.</span>
<a name="l673"><span class="linenum"> 673</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="class" onClick="logClass('external_api')" href="../../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>(<a class="class" onClick="logClass('core_enrol_external')" href="../../_classes/core_enrol_external.html" onMouseOver="classPopup(event,'core_enrol_external')">core_enrol_external</a>::<a class="function" onClick="logFunction('get_enrolled_users_with_capability_returns')" href="../../_functions/get_enrolled_users_with_capability_returns.html" onMouseOver="funcPopup(event,'get_enrolled_users_with_capability_returns')">get_enrolled_users_with_capability_returns</a>(), <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>);
<a name="l674"><span class="linenum"> 674</span></a>  
<a name="l675"><span class="linenum"> 675</span></a>  <span class="comment">        // Check an array containing the expected user for the course capability is returned.</span>
<a name="l676"><span class="linenum"> 676</span></a>          <a class="var it28583" onMouseOver="hilite(28583)" onMouseOut="lolite()" onClick="logVariable('expecteduserlist')" href="../../_variables/expecteduserlist.html">$expecteduserlist</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[0]['users'];
<a name="l677"><span class="linenum"> 677</span></a>          <a class="var it28584" onMouseOver="hilite(28584)" onMouseOut="lolite()" onClick="logVariable('expecteduser')" href="../../_variables/expecteduser.html">$expecteduser</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it28583" onMouseOver="hilite(28583)" onMouseOut="lolite()" onClick="logVariable('expecteduserlist')" href="../../_variables/expecteduserlist.html">$expecteduserlist</a>);
<a name="l678"><span class="linenum"> 678</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(1, <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it28583" onMouseOver="hilite(28583)" onMouseOut="lolite()" onClick="logVariable('expecteduserlist')" href="../../_variables/expecteduserlist.html">$expecteduserlist</a>));
<a name="l679"><span class="linenum"> 679</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('assertEquals')" href="../../_functions/assertequals.html" onMouseOver="funcPopup(event,'assertequals')">assertEquals</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('student1')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/student1.html">student1</a>-&gt;id, <a class="var it28584" onMouseOver="hilite(28584)" onMouseOut="lolite()" onClick="logVariable('expecteduser')" href="../../_variables/expecteduser.html">$expecteduser</a>['id']);
<a name="l680"><span class="linenum"> 680</span></a>      }
<a name="l681"><span class="linenum"> 681</span></a>  
<a name="l682"><span class="linenum"> 682</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'test_get_enrolled_users_with_capability_with_parameters': ['test_get_enrolled_users_with_capability_with_parameters', 'Test get_enrolled_users_with_capability ', [['enrol/tests','externallib_test.php',649]], 0],
'test_get_course_enrolment_methods': ['test_get_course_enrolment_methods', 'Test get_course_enrolment_methods ', [['enrol/tests','externallib_test.php',418]], 0],
'get_enrolled_users_with_capability_setup': ['get_enrolled_users_with_capability_setup', '', [['enrol/tests','externallib_test.php',581]], 2],
'test_get_enrolled_users_without_parameters': ['test_get_enrolled_users_without_parameters', 'Test get_enrolled_users from core_enrol_external without additional parameters. ', [['enrol/tests','externallib_test.php',523]], 0],
'get_enrolled_users_with_capability_returns': ['get_enrolled_users_with_capability_returns', 'Returns description of method result value ', [['enrol','externallib.php',187]], 2],
'resetaftertest': ['resetaftertest', 'Reset everything after current test. ', [['lib/phpunit/classes','advanced_testcase.php',246]], 1528],
'external_format_text': ['external_format_text', 'Format the text to be returned properly as requested by the either the web service server, either by an internally call. The caller can change the format (raw, filter, file, fileurl) with the external_settings singleton All web service servers must set this singleton when parsing the $_GET and $_POST. ', [['lib','externallib.php',887]], 61],
'test_get_enrolled_users_with_capability_without_parameters': ['test_get_enrolled_users_with_capability_without_parameters', 'Test get_enrolled_users_with_capability without additional paramaters. ', [['enrol/tests','externallib_test.php',620]], 0],
'test_get_enrolled_users_without_capability': ['test_get_enrolled_users_without_capability', 'Test get_enrolled_users from core_enrol_external with capability to viewparticipants removed. ', [['enrol/tests','externallib_test.php',566]], 0],
'get_users_courses': ['get_users_courses', 'Get list of courses user is enrolled in (only active enrolments are returned). Please note the current user must be able to access the course, otherwise the course is not included. ', [['enrol','externallib.php',288]], 1],
'enrol_user': ['enrol_user', 'Enrol user into course via enrol instance. ', [['enrol/flatfile','lib.php',144],['lib','enrollib.php',1270],['lib/testing/generator','data_generator.php',891],['enrol/lti/classes','helper.php',233],['enrol/self','externallib.php',122],['enrol/mnet','enrol.php',115],['enrol/guest','lib.php',60]], 745],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'enrol_get_plugin': ['enrol_get_plugin', 'Returns instance of enrol plugin ', [['lib','enrollib.php',111]], 156],
'test_get_users_courses': ['test_get_users_courses', 'Test get_users_courses ', [['enrol/tests','externallib_test.php',358]], 0],
'unassignusercapability': ['unassignusercapability', 'Unassign a capability to $USER. ', [['webservice/tests','helpers.php',67]], 40],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'assertnotempty': ['assertnotempty', '', [['lib/htmlpurifier/HTMLPurifier/ConfigSchema','ValidatorAtom.php',98]], 402],
'getdatagenerator': ['getdatagenerator', 'Get data generator ', [['lib/phpunit/classes','advanced_testcase.php',570]], 4450],
'test_get_enrolled_users_with_parameters': ['test_get_enrolled_users_with_parameters', 'Test get_enrolled_users from core_enrol_external with some parameters set. ', [['enrol/tests','externallib_test.php',542]], 0],
'get_course_enrolment_methods': ['get_course_enrolment_methods', 'Get list of active course enrolment methods for current user. ', [['enrol','externallib.php',656]], 3],
'external_format_string': ['external_format_string', 'Format the string to be returned properly as requested by the either the web service server, either by an internally call. The caller can change the format (raw) with the external_settings singleton All web service servers must set this singleton when parsing the $_GET and $_POST. ', [['lib','externallib.php',850]], 48],
'clean_returnvalue': ['clean_returnvalue', 'Clean response If a response attribute is unknown from the description, we just ignore the attribute. If a response attribute is incorrect, invalid_response_exception is thrown. Note: this function is similar to validate parameters, however it is distinct because parameters validation must be distinct from cleaning return values. ', [['lib','externallib.php',358]], 733],
'get_enrolled_users': ['get_enrolled_users', 'Returns list of users enrolled into course. ', [['lib','accesslib.php',2439],['enrol','externallib.php',409]], 61],
'get_enrolled_users_with_capability': ['get_enrolled_users_with_capability', 'Return users that have the capabilities for each course specified. For each course and capability specified, a list of the users that are enrolled in the course and have that capability are returned. ', [['enrol','externallib.php',79]], 2],
'assignusercapability': ['assignusercapability', 'Assign a capability to $USER The function creates a student $USER if $USER->id is empty ', [['webservice/tests','helpers.php',36]], 134],
'create_group': ['create_group', 'Create a test group for the specified course ', [['lib/testing/generator','data_generator.php',505]], 154],
'get_enrolled_users_returns': ['get_enrolled_users_returns', 'Returns description of method result value ', [['enrol','externallib.php',560]], 3],
'get_enrolled_users_visibility_provider': ['get_enrolled_users_visibility_provider', 'dataProvider for test_get_enrolled_users_visibility(). ', [['enrol/tests','externallib_test.php',35]], 0],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'assign_capability': ['assign_capability', '', [['lib/tests','coursecatlib_test.php',66],['lib','accesslib.php',1538]], 303],
'add_instance': ['add_instance', 'Add new instance of enrol plugin. ', [['enrol/manual','lib.php',147],['lib','enrollib.php',1745],['enrol/self','lib.php',958],['enrol/cohort','lib.php',99],['mod/assign','locallib.php',600],['tag/classes','tag.php',543],['enrol/lti','lib.php',88],['enrol/paypal','lib.php',124],['enrol/guest','lib.php',247],['enrol/meta','lib.php',131]], 91],
'assertequals': ['assertequals', 'Asserts that two variables are equal. ', [['lib/tests','completionlib_test.php',68]], 12471],
'create_course': ['create_course', 'Creates the actual course. ', [['admin/tool/generator/classes','course_backend.php',246],['lib/testing/generator','data_generator.php',366],['enrol/ldap','lib.php',949],['course','lib.php',2654]], 1178],
'get_course_enrolment_methods_returns': ['get_course_enrolment_methods_returns', 'Returns description of get_course_enrolment_methods() result value ', [['enrol','externallib.php',687]], 2],
'accesslib_clear_all_caches_for_unit_testing': ['accesslib_clear_all_caches_for_unit_testing', 'Clears accesslib\'s private caches. ONLY BE USED BY UNIT TESTS ', [['lib','accesslib.php',207]], 118],
'test_get_enrolled_users_visibility': ['test_get_enrolled_users_visibility', 'Verify get_enrolled_users() returned users are the expected in every situation. ', [['enrol/tests','externallib_test.php',246]], 0],
'role_assign': ['role_assign', 'Assigns the specified role to a user in the context. ', [['lib/testing/generator','data_generator.php',936],['lib','accesslib.php',1661]], 269],
'get_enrolled_users_setup': ['get_enrolled_users_setup', '', [['enrol/tests','externallib_test.php',497]], 3],
'setadminuser': ['setadminuser', 'Set current $USER to admin account, reset access cache. ', [['lib/phpunit/classes','advanced_testcase.php',539]], 597],
'create_user': ['create_user', 'Create a test user ', [['lib/testing/generator','data_generator.php',137]], 1376],
'create_role': ['create_role', 'Creates a new role in the system. ', [['lib/testing/generator','data_generator.php',726],['lib','accesslib.php',1453]], 100],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'setuser': ['setuser', '', [['lib/google/src/Google/Service','Replicapool.php',1091],['lib/google/src/Google/Service','Computeaccounts.php',1294],['lib/google/src/Google/Service','Appengine.php',1341],['lib/google/src/Google/Service','DeploymentManager.php',1530],['lib/google/src/Google/Service','CloudUserAccounts.php',1733],['lib/google/src/Google/Service','Replicapoolupdater.php',852],['lib/google/src/Google/Service','Replicapoolupdater.php',1194],['lib/google/src/Google/Service','Autoscaler.php',1005],['lib/google/src/Google/Service','Appsactivity.php',273],['lib/google/src/Google/Service','Appsactivity.php',420],['lib/google/src/Google/Service','Drive.php',2824],['lib/phpunit/classes','advanced_testcase.php',511],['lib/google/src/Google/Service','AndroidEnterprise.php',2240],['lib/google/src/Google/Service','AndroidEnterprise.php',2634],['lib/google/src/Google/Service','AndroidEnterprise.php',3101],['lib/google/src/Google/Service','Resourceviews.php',820],['lib/google/src/Google/Service','SQLAdmin.php',2990],['lib/google/src/Google/Service','Compute.php',14264]], 1070],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'get_users_courses_returns': ['get_users_courses_returns', 'Returns description of method result value ', [['enrol','externallib.php',349]], 1],
'create_group_member': ['create_group_member', 'Create a test group member ', [['lib/testing/generator','data_generator.php',548]], 77],
'count': ['count', '', [], 4095],
'defined': ['defined', '', [], 4731],
'reset': ['reset', '', [], 1213]};
CLASS_DATA={
'core_enrol_external': ['core_enrol_external', 'Enrol external functions ', [['enrol','externallib.php',34]], 22],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323],
'core_enrol_externallib_testcase': ['core_enrol_externallib_testcase', 'Enrol external PHPunit tests ', [['enrol/tests','externallib_test.php',24]], 0],
'external_api': ['external_api', 'Base class for external api methods. ', [['lib','externallib.php',47]], 808]};
CONST_DATA={
'CAP_ALLOW': ['CAP_ALLOW', '', [['lib','accesslib.php',135]], 1484],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'VISIBLEGROUPS': ['VISIBLEGROUPS', '', [['lib','grouplib.php',39]], 113],
'NOGROUPS': ['NOGROUPS', '', [['lib','grouplib.php',29]], 58],
'ENROL_INSTANCE_DISABLED': ['ENROL_INSTANCE_DISABLED', '', [['lib','enrollib.php',34]], 56],
'CAP_PROHIBIT': ['CAP_PROHIBIT', '', [['lib','accesslib.php',139]], 130],
'ENROL_INSTANCE_ENABLED': ['ENROL_INSTANCE_ENABLED', '', [['lib','enrollib.php',31]], 115],
'FORMAT_MOODLE': ['FORMAT_MOODLE', '', [['lib','weblib.php',42]], 506],
'ENROL_USER_SUSPENDED': ['ENROL_USER_SUSPENDED', '', [['lib','enrollib.php',40]], 105],
'SEPARATEGROUPS': ['SEPARATEGROUPS', '', [['lib','grouplib.php',34]], 190]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
