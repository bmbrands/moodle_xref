<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /message/lib.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='message';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/message/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Library functions for messaging</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package   core_message</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright 2008 Luis Rodrigues</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  
<a name="l25"><span class="linenum">  25</span></a>  require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>.'/eventslib.php');
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a> ('<a class="constant" onClick="logConstant('MESSAGE_SHORTLENGTH')" href="../_constants/MESSAGE_SHORTLENGTH.html" onMouseOver="constPopup(event,'MESSAGE_SHORTLENGTH')">MESSAGE_SHORTLENGTH</a>', 300);
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a> ('<a class="constant" onClick="logConstant('MESSAGE_DISCUSSION_WIDTH')" href="../_constants/MESSAGE_DISCUSSION_WIDTH.html" onMouseOver="constPopup(event,'MESSAGE_DISCUSSION_WIDTH')">MESSAGE_DISCUSSION_WIDTH</a>',600);
<a name="l30"><span class="linenum">  30</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a> ('<a class="constant" onClick="logConstant('MESSAGE_DISCUSSION_HEIGHT')" href="../_constants/MESSAGE_DISCUSSION_HEIGHT.html" onMouseOver="constPopup(event,'MESSAGE_DISCUSSION_HEIGHT')">MESSAGE_DISCUSSION_HEIGHT</a>',500);
<a name="l31"><span class="linenum">  31</span></a>  
<a name="l32"><span class="linenum">  32</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a> ('<a class="constant" onClick="logConstant('MESSAGE_SHORTVIEW_LIMIT')" href="../_constants/MESSAGE_SHORTVIEW_LIMIT.html" onMouseOver="constPopup(event,'MESSAGE_SHORTVIEW_LIMIT')">MESSAGE_SHORTVIEW_LIMIT</a>', 8);<span class="comment">//the maximum number of messages to show on the short message history</span>
<a name="l33"><span class="linenum">  33</span></a>  
<a name="l34"><span class="linenum">  34</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_HISTORY_SHORT')" href="../_constants/MESSAGE_HISTORY_SHORT.html" onMouseOver="constPopup(event,'MESSAGE_HISTORY_SHORT')">MESSAGE_HISTORY_SHORT</a>',0);
<a name="l35"><span class="linenum">  35</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_HISTORY_ALL')" href="../_constants/MESSAGE_HISTORY_ALL.html" onMouseOver="constPopup(event,'MESSAGE_HISTORY_ALL')">MESSAGE_HISTORY_ALL</a>',1);
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_VIEW_UNREAD_MESSAGES')" href="../_constants/MESSAGE_VIEW_UNREAD_MESSAGES.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_UNREAD_MESSAGES')">MESSAGE_VIEW_UNREAD_MESSAGES</a>','unread');
<a name="l38"><span class="linenum">  38</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_VIEW_RECENT_CONVERSATIONS')" href="../_constants/MESSAGE_VIEW_RECENT_CONVERSATIONS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_RECENT_CONVERSATIONS')">MESSAGE_VIEW_RECENT_CONVERSATIONS</a>','recentconversations');
<a name="l39"><span class="linenum">  39</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_VIEW_RECENT_NOTIFICATIONS')" href="../_constants/MESSAGE_VIEW_RECENT_NOTIFICATIONS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_RECENT_NOTIFICATIONS')">MESSAGE_VIEW_RECENT_NOTIFICATIONS</a>','recentnotifications');
<a name="l40"><span class="linenum">  40</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_VIEW_CONTACTS')" href="../_constants/MESSAGE_VIEW_CONTACTS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_CONTACTS')">MESSAGE_VIEW_CONTACTS</a>','contacts');
<a name="l41"><span class="linenum">  41</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_VIEW_BLOCKED')" href="../_constants/MESSAGE_VIEW_BLOCKED.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_BLOCKED')">MESSAGE_VIEW_BLOCKED</a>','blockedusers');
<a name="l42"><span class="linenum">  42</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_VIEW_COURSE')" href="../_constants/MESSAGE_VIEW_COURSE.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_COURSE')">MESSAGE_VIEW_COURSE</a>','course_');
<a name="l43"><span class="linenum">  43</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_VIEW_SEARCH')" href="../_constants/MESSAGE_VIEW_SEARCH.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_SEARCH')">MESSAGE_VIEW_SEARCH</a>','search');
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_SEARCH_MAX_RESULTS')" href="../_constants/MESSAGE_SEARCH_MAX_RESULTS.html" onMouseOver="constPopup(event,'MESSAGE_SEARCH_MAX_RESULTS')">MESSAGE_SEARCH_MAX_RESULTS</a>', 200);
<a name="l46"><span class="linenum">  46</span></a>  
<a name="l47"><span class="linenum">  47</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_CONTACTS_PER_PAGE')" href="../_constants/MESSAGE_CONTACTS_PER_PAGE.html" onMouseOver="constPopup(event,'MESSAGE_CONTACTS_PER_PAGE')">MESSAGE_CONTACTS_PER_PAGE</a>',10);
<a name="l48"><span class="linenum">  48</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_MAX_COURSE_NAME_LENGTH')" href="../_constants/MESSAGE_MAX_COURSE_NAME_LENGTH.html" onMouseOver="constPopup(event,'MESSAGE_MAX_COURSE_NAME_LENGTH')">MESSAGE_MAX_COURSE_NAME_LENGTH</a>', 30);
<a name="l49"><span class="linenum">  49</span></a>  
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">/**</span>
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment"> * Define contants for messaging default settings population. For unambiguity of</span>
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment"> * plugin developer intentions we use 4-bit value (LSB numbering):</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment"> * bit 0 - whether to send message when user is loggedin (MESSAGE_DEFAULT_LOGGEDIN)</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment"> * bit 1 - whether to send message when user is loggedoff (MESSAGE_DEFAULT_LOGGEDOFF)</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment"> * bit 2..3 - messaging permission (MESSAGE_DISALLOWED|MESSAGE_PERMITTED|MESSAGE_FORCED)</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment"> *</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment"> * MESSAGE_PERMITTED_MASK contains the mask we use to distinguish permission setting</span>
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment"> */</span>
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_DEFAULT_LOGGEDIN')" href="../_constants/MESSAGE_DEFAULT_LOGGEDIN.html" onMouseOver="constPopup(event,'MESSAGE_DEFAULT_LOGGEDIN')">MESSAGE_DEFAULT_LOGGEDIN</a>', 0x01); <span class="comment">// 0001</span>
<a name="l61"><span class="linenum">  61</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_DEFAULT_LOGGEDOFF')" href="../_constants/MESSAGE_DEFAULT_LOGGEDOFF.html" onMouseOver="constPopup(event,'MESSAGE_DEFAULT_LOGGEDOFF')">MESSAGE_DEFAULT_LOGGEDOFF</a>', 0x02); <span class="comment">// 0010</span>
<a name="l62"><span class="linenum">  62</span></a>  
<a name="l63"><span class="linenum">  63</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_DISALLOWED')" href="../_constants/MESSAGE_DISALLOWED.html" onMouseOver="constPopup(event,'MESSAGE_DISALLOWED')">MESSAGE_DISALLOWED</a>', 0x04); <span class="comment">// 0100</span>
<a name="l64"><span class="linenum">  64</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_PERMITTED')" href="../_constants/MESSAGE_PERMITTED.html" onMouseOver="constPopup(event,'MESSAGE_PERMITTED')">MESSAGE_PERMITTED</a>', 0x08); <span class="comment">// 1000</span>
<a name="l65"><span class="linenum">  65</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_FORCED')" href="../_constants/MESSAGE_FORCED.html" onMouseOver="constPopup(event,'MESSAGE_FORCED')">MESSAGE_FORCED</a>', 0x0c); <span class="comment">// 1100</span>
<a name="l66"><span class="linenum">  66</span></a>  
<a name="l67"><span class="linenum">  67</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_PERMITTED_MASK')" href="../_constants/MESSAGE_PERMITTED_MASK.html" onMouseOver="constPopup(event,'MESSAGE_PERMITTED_MASK')">MESSAGE_PERMITTED_MASK</a>', 0x0c); <span class="comment">// 1100</span>
<a name="l68"><span class="linenum">  68</span></a>  
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment">/**</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment"> * Set default value for default outputs permitted setting</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment"> */</span>
<a name="l72"><span class="linenum">  72</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('MESSAGE_DEFAULT_PERMITTED')" href="../_constants/MESSAGE_DEFAULT_PERMITTED.html" onMouseOver="constPopup(event,'MESSAGE_DEFAULT_PERMITTED')">MESSAGE_DEFAULT_PERMITTED</a>', 'permitted');
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">/**</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment"> * Print the selector that allows the user to view their contacts, course participants, their recent</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment"> * conversations etc</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment"> *</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment"> * @param int $countunreadtotal how many unread messages does the user have?</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment"> * @param int $viewing What is the user viewing? ie MESSAGE_VIEW_UNREAD_MESSAGES, MESSAGE_VIEW_SEARCH etc</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> * @param object $user1 the user whose messages are being viewed</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment"> * @param object $user2 the user $user1 is talking to</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment"> * @param array $blockedusers an array of users blocked by $user1</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment"> * @param array $onlinecontacts an array of $user1's online contacts</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment"> * @param array $offlinecontacts an array of $user1's offline contacts</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment"> * @param array $strangers an array of users who have messaged $user1 who aren't contacts</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="comment"> * @param bool $showactionlinks show action links (add/remove contact etc)</span>
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment"> * @param int $page if there are so many users listed that they have to be split into pages what page are we viewing</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment"> * @return void</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment"> */</span>
<a name="l90"><span class="linenum">  90</span></a>  function <a class="function" onClick="logFunction('message_print_contact_selector')" href="../_functions/message_print_contact_selector.html" onMouseOver="funcPopup(event,'message_print_contact_selector')">message_print_contact_selector</a>(<a class="var it1524" onMouseOver="hilite(1524)" onMouseOut="lolite()" onClick="logVariable('countunreadtotal')" href="../_variables/countunreadtotal.html">$countunreadtotal</a>, <a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>, <a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a>, <a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('onlinecontacts')" href="../_variables/onlinecontacts.html">$onlinecontacts</a>, <a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('offlinecontacts')" href="../_variables/offlinecontacts.html">$offlinecontacts</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>, <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>=0) {
<a name="l91"><span class="linenum">  91</span></a>      global <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>;
<a name="l92"><span class="linenum">  92</span></a>  
<a name="l93"><span class="linenum">  93</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class' =&gt; 'contactselector mdl-align'));
<a name="l94"><span class="linenum">  94</span></a>  
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">    //if 0 unread messages and they've requested unread messages then show contacts</span>
<a name="l96"><span class="linenum">  96</span></a>      if (<a class="var it1524" onMouseOver="hilite(1524)" onMouseOut="lolite()" onClick="logVariable('countunreadtotal')" href="../_variables/countunreadtotal.html">$countunreadtotal</a> == 0 &amp;&amp; <a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> == <a class="constant" onClick="logConstant('MESSAGE_VIEW_UNREAD_MESSAGES')" href="../_constants/MESSAGE_VIEW_UNREAD_MESSAGES.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_UNREAD_MESSAGES')">MESSAGE_VIEW_UNREAD_MESSAGES</a>) {
<a name="l97"><span class="linenum">  97</span></a>          <a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> = <a class="constant" onClick="logConstant('MESSAGE_VIEW_CONTACTS')" href="../_constants/MESSAGE_VIEW_CONTACTS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_CONTACTS')">MESSAGE_VIEW_CONTACTS</a>;
<a name="l98"><span class="linenum">  98</span></a>      }
<a name="l99"><span class="linenum">  99</span></a>  
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment">    //if they have no blocked users and they've requested blocked users switch them over to contacts</span>
<a name="l101"><span class="linenum"> 101</span></a>      if (<a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a>) == 0 &amp;&amp; <a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> == <a class="constant" onClick="logConstant('MESSAGE_VIEW_BLOCKED')" href="../_constants/MESSAGE_VIEW_BLOCKED.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_BLOCKED')">MESSAGE_VIEW_BLOCKED</a>) {
<a name="l102"><span class="linenum"> 102</span></a>          <a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> = <a class="constant" onClick="logConstant('MESSAGE_VIEW_CONTACTS')" href="../_constants/MESSAGE_VIEW_CONTACTS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_CONTACTS')">MESSAGE_VIEW_CONTACTS</a>;
<a name="l103"><span class="linenum"> 103</span></a>      }
<a name="l104"><span class="linenum"> 104</span></a>  
<a name="l105"><span class="linenum"> 105</span></a>      <a class="var it21251" onMouseOver="hilite(21251)" onMouseOut="lolite()" onClick="logVariable('onlyactivecourses')" href="../_variables/onlyactivecourses.html">$onlyactivecourses</a> = true;
<a name="l106"><span class="linenum"> 106</span></a>      <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> = <a class="function" onClick="logFunction('enrol_get_users_courses')" href="../_functions/enrol_get_users_courses.html" onMouseOver="funcPopup(event,'enrol_get_users_courses')">enrol_get_users_courses</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it21251" onMouseOver="hilite(21251)" onMouseOut="lolite()" onClick="logVariable('onlyactivecourses')" href="../_variables/onlyactivecourses.html">$onlyactivecourses</a>);
<a name="l107"><span class="linenum"> 107</span></a>      <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a> = <a class="function" onClick="logFunction('message_get_course_contexts')" href="../_functions/message_get_course_contexts.html" onMouseOver="funcPopup(event,'message_get_course_contexts')">message_get_course_contexts</a>(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>);<span class="comment">//we need one of these again so holding on to them</span>
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>      <a class="var it21253" onMouseOver="hilite(21253)" onMouseOut="lolite()" onClick="logVariable('strunreadmessages')" href="../_variables/strunreadmessages.html">$strunreadmessages</a> = null;
<a name="l110"><span class="linenum"> 110</span></a>      if (<a class="var it1524" onMouseOver="hilite(1524)" onMouseOut="lolite()" onClick="logVariable('countunreadtotal')" href="../_variables/countunreadtotal.html">$countunreadtotal</a>&gt;0) { //if there are unread messages
<a name="l111"><span class="linenum"> 111</span></a>          <a class="var it21253" onMouseOver="hilite(21253)" onMouseOut="lolite()" onClick="logVariable('strunreadmessages')" href="../_variables/strunreadmessages.html">$strunreadmessages</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unreadmessages','message', <a class="var it1524" onMouseOver="hilite(1524)" onMouseOut="lolite()" onClick="logVariable('countunreadtotal')" href="../_variables/countunreadtotal.html">$countunreadtotal</a>);
<a name="l112"><span class="linenum"> 112</span></a>      }
<a name="l113"><span class="linenum"> 113</span></a>  
<a name="l114"><span class="linenum"> 114</span></a>      <a class="function" onClick="logFunction('message_print_usergroup_selector')" href="../_functions/message_print_usergroup_selector.html" onMouseOver="funcPopup(event,'message_print_usergroup_selector')">message_print_usergroup_selector</a>(<a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a>, <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>, <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a>, <a class="var it1524" onMouseOver="hilite(1524)" onMouseOut="lolite()" onClick="logVariable('countunreadtotal')" href="../_variables/countunreadtotal.html">$countunreadtotal</a>, <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a>), <a class="var it21253" onMouseOver="hilite(21253)" onMouseOut="lolite()" onClick="logVariable('strunreadmessages')" href="../_variables/strunreadmessages.html">$strunreadmessages</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>);
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>      if (<a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> == <a class="constant" onClick="logConstant('MESSAGE_VIEW_UNREAD_MESSAGES')" href="../_constants/MESSAGE_VIEW_UNREAD_MESSAGES.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_UNREAD_MESSAGES')">MESSAGE_VIEW_UNREAD_MESSAGES</a>) {
<a name="l117"><span class="linenum"> 117</span></a>          <a class="function" onClick="logFunction('message_print_contacts')" href="../_functions/message_print_contacts.html" onMouseOver="funcPopup(event,'message_print_contacts')">message_print_contacts</a>(<a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('onlinecontacts')" href="../_variables/onlinecontacts.html">$onlinecontacts</a>, <a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('offlinecontacts')" href="../_variables/offlinecontacts.html">$offlinecontacts</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a>, 1, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>,<a class="var it21253" onMouseOver="hilite(21253)" onMouseOut="lolite()" onClick="logVariable('strunreadmessages')" href="../_variables/strunreadmessages.html">$strunreadmessages</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>);
<a name="l118"><span class="linenum"> 118</span></a>      } else if (<a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> == <a class="constant" onClick="logConstant('MESSAGE_VIEW_CONTACTS')" href="../_constants/MESSAGE_VIEW_CONTACTS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_CONTACTS')">MESSAGE_VIEW_CONTACTS</a> || <a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> == <a class="constant" onClick="logConstant('MESSAGE_VIEW_SEARCH')" href="../_constants/MESSAGE_VIEW_SEARCH.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_SEARCH')">MESSAGE_VIEW_SEARCH</a> || <a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> == <a class="constant" onClick="logConstant('MESSAGE_VIEW_RECENT_CONVERSATIONS')" href="../_constants/MESSAGE_VIEW_RECENT_CONVERSATIONS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_RECENT_CONVERSATIONS')">MESSAGE_VIEW_RECENT_CONVERSATIONS</a> || <a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> == <a class="constant" onClick="logConstant('MESSAGE_VIEW_RECENT_NOTIFICATIONS')" href="../_constants/MESSAGE_VIEW_RECENT_NOTIFICATIONS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_RECENT_NOTIFICATIONS')">MESSAGE_VIEW_RECENT_NOTIFICATIONS</a>) {
<a name="l119"><span class="linenum"> 119</span></a>          <a class="function" onClick="logFunction('message_print_contacts')" href="../_functions/message_print_contacts.html" onMouseOver="funcPopup(event,'message_print_contacts')">message_print_contacts</a>(<a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('onlinecontacts')" href="../_variables/onlinecontacts.html">$onlinecontacts</a>, <a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('offlinecontacts')" href="../_variables/offlinecontacts.html">$offlinecontacts</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a>, 0, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>, <a class="var it21253" onMouseOver="hilite(21253)" onMouseOut="lolite()" onClick="logVariable('strunreadmessages')" href="../_variables/strunreadmessages.html">$strunreadmessages</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>);
<a name="l120"><span class="linenum"> 120</span></a>      } else if (<a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> == <a class="constant" onClick="logConstant('MESSAGE_VIEW_BLOCKED')" href="../_constants/MESSAGE_VIEW_BLOCKED.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_BLOCKED')">MESSAGE_VIEW_BLOCKED</a>) {
<a name="l121"><span class="linenum"> 121</span></a>          <a class="function" onClick="logFunction('message_print_blocked_users')" href="../_functions/message_print_blocked_users.html" onMouseOver="funcPopup(event,'message_print_blocked_users')">message_print_blocked_users</a>(<a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a>, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>, null, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>);
<a name="l122"><span class="linenum"> 122</span></a>      } else if (<a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a>, 0, 7) == <a class="constant" onClick="logConstant('MESSAGE_VIEW_COURSE')" href="../_constants/MESSAGE_VIEW_COURSE.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_COURSE')">MESSAGE_VIEW_COURSE</a>) {
<a name="l123"><span class="linenum"> 123</span></a>          <a class="var it21254" onMouseOver="hilite(21254)" onMouseOut="lolite()" onClick="logVariable('courseidtoshow')" href="../_variables/courseidtoshow.html">$courseidtoshow</a> = <a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a>, 7));
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>          if (!empty(<a class="var it21254" onMouseOver="hilite(21254)" onMouseOut="lolite()" onClick="logVariable('courseidtoshow')" href="../_variables/courseidtoshow.html">$courseidtoshow</a>)
<a name="l126"><span class="linenum"> 126</span></a>              &amp;&amp; <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it21254" onMouseOver="hilite(21254)" onMouseOut="lolite()" onClick="logVariable('courseidtoshow')" href="../_variables/courseidtoshow.html">$courseidtoshow</a>, <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a>)
<a name="l127"><span class="linenum"> 127</span></a>              &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewparticipants', <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a>[<a class="var it21254" onMouseOver="hilite(21254)" onMouseOut="lolite()" onClick="logVariable('courseidtoshow')" href="../_variables/courseidtoshow.html">$courseidtoshow</a>])) {
<a name="l128"><span class="linenum"> 128</span></a>  
<a name="l129"><span class="linenum"> 129</span></a>              <a class="function" onClick="logFunction('message_print_participants')" href="../_functions/message_print_participants.html" onMouseOver="funcPopup(event,'message_print_participants')">message_print_participants</a>(<a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a>[<a class="var it21254" onMouseOver="hilite(21254)" onMouseOut="lolite()" onClick="logVariable('courseidtoshow')" href="../_variables/courseidtoshow.html">$courseidtoshow</a>], <a class="var it21254" onMouseOver="hilite(21254)" onMouseOut="lolite()" onClick="logVariable('courseidtoshow')" href="../_variables/courseidtoshow.html">$courseidtoshow</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a>, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>, null, <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>);
<a name="l130"><span class="linenum"> 130</span></a>          }
<a name="l131"><span class="linenum"> 131</span></a>      }
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">    // Only show the search button if we're viewing our own contacts.</span>
<a name="l134"><span class="linenum"> 134</span></a>      if (<a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a> == <a class="constant" onClick="logConstant('MESSAGE_VIEW_CONTACTS')" href="../_constants/MESSAGE_VIEW_CONTACTS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_CONTACTS')">MESSAGE_VIEW_CONTACTS</a> &amp;&amp; <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a> == null) {
<a name="l135"><span class="linenum"> 135</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('form', array('action' =&gt; '<a class="filename" href="../index.php.html">index.php</a>','method' =&gt; 'GET'));
<a name="l136"><span class="linenum"> 136</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('fieldset');
<a name="l137"><span class="linenum"> 137</span></a>          <a class="var it21255" onMouseOver="hilite(21255)" onMouseOut="lolite()" onClick="logVariable('managebuttonclass')" href="../_variables/managebuttonclass.html">$managebuttonclass</a> = 'visible';
<a name="l138"><span class="linenum"> 138</span></a>          <a class="var it21256" onMouseOver="hilite(21256)" onMouseOut="lolite()" onClick="logVariable('strmanagecontacts')" href="../_variables/strmanagecontacts.html">$strmanagecontacts</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('search','message');
<a name="l139"><span class="linenum"> 139</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('empty_tag')" href="../_functions/empty_tag.html" onMouseOver="funcPopup(event,'empty_tag')">empty_tag</a>('input', array('type' =&gt; 'hidden','name' =&gt; 'viewing','value' =&gt; <a class="constant" onClick="logConstant('MESSAGE_VIEW_SEARCH')" href="../_constants/MESSAGE_VIEW_SEARCH.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_SEARCH')">MESSAGE_VIEW_SEARCH</a>));
<a name="l140"><span class="linenum"> 140</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('empty_tag')" href="../_functions/empty_tag.html" onMouseOver="funcPopup(event,'empty_tag')">empty_tag</a>('input', array('type' =&gt; 'submit','value' =&gt; <a class="var it21256" onMouseOver="hilite(21256)" onMouseOut="lolite()" onClick="logVariable('strmanagecontacts')" href="../_variables/strmanagecontacts.html">$strmanagecontacts</a>,'class' =&gt; <a class="var it21255" onMouseOver="hilite(21255)" onMouseOut="lolite()" onClick="logVariable('managebuttonclass')" href="../_variables/managebuttonclass.html">$managebuttonclass</a>));
<a name="l141"><span class="linenum"> 141</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('fieldset');
<a name="l142"><span class="linenum"> 142</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('form');
<a name="l143"><span class="linenum"> 143</span></a>      }
<a name="l144"><span class="linenum"> 144</span></a>  
<a name="l145"><span class="linenum"> 145</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l146"><span class="linenum"> 146</span></a>  }
<a name="l147"><span class="linenum"> 147</span></a>  
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">/**</span>
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment"> * Print course participants. Called by message_print_contact_selector()</span>
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment"> *</span>
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment"> * @param object $context the course context</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment"> * @param int $courseid the course ID</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment"> * @param string $contactselecturl the url to send the user to when a contact's name is clicked</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment"> * @param bool $showactionlinks show action links (add/remove contact etc) next to the users</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment"> * @param string $titletodisplay Optionally specify a title to display above the participants</span>
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment"> * @param int $page if there are so many users listed that they have to be split into pages what page are we viewing</span>
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment"> * @param object $user2 the user $user1 is talking to. They will be highlighted if they appear in the list of participants</span>
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment"> * @return void</span>
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment"> */</span>
<a name="l160"><span class="linenum"> 160</span></a>  function <a class="function" onClick="logFunction('message_print_participants')" href="../_functions/message_print_participants.html" onMouseOver="funcPopup(event,'message_print_participants')">message_print_participants</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, <a class="var it21257" onMouseOver="hilite(21257)" onMouseOut="lolite()" onClick="logVariable('contactselecturl')" href="../_variables/contactselecturl.html">$contactselecturl</a>=null, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>=true, <a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>=null, <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>=0, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>=null) {
<a name="l161"><span class="linenum"> 161</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l162"><span class="linenum"> 162</span></a>  
<a name="l163"><span class="linenum"> 163</span></a>      if (empty(<a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>)) {
<a name="l164"><span class="linenum"> 164</span></a>          <a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('participants');
<a name="l165"><span class="linenum"> 165</span></a>      }
<a name="l166"><span class="linenum"> 166</span></a>  
<a name="l167"><span class="linenum"> 167</span></a>      <a class="var it20477" onMouseOver="hilite(20477)" onMouseOut="lolite()" onClick="logVariable('countparticipants')" href="../_variables/countparticipants.html">$countparticipants</a> = <a class="function" onClick="logFunction('count_enrolled_users')" href="../_functions/count_enrolled_users.html" onMouseOver="funcPopup(event,'count_enrolled_users')">count_enrolled_users</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l168"><span class="linenum"> 168</span></a>  
<a name="l169"><span class="linenum"> 169</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it9245" onMouseOver="hilite(9245)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../_variables/esql.html">$esql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="function" onClick="logFunction('get_enrolled_sql')" href="../_functions/get_enrolled_sql.html" onMouseOver="funcPopup(event,'get_enrolled_sql')">get_enrolled_sql</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l170"><span class="linenum"> 170</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['mcuserid'] = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l171"><span class="linenum"> 171</span></a>      <a class="var it21259" onMouseOver="hilite(21259)" onMouseOut="lolite()" onClick="logVariable('ufields')" href="../_variables/ufields.html">$ufields</a> = <a class="class" onClick="logClass('user_picture')" href="../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('u');
<a name="l172"><span class="linenum"> 172</span></a>  
<a name="l173"><span class="linenum"> 173</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it21259" onMouseOver="hilite(21259)" onMouseOut="lolite()" onClick="logVariable('ufields')" href="../_variables/ufields.html">$ufields</a>, mc.id as contactlistid, mc.blocked
<a name="l174"><span class="linenum"> 174</span></a>                FROM {user} u
<a name="l175"><span class="linenum"> 175</span></a>                <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (<a class="var it9245" onMouseOver="hilite(9245)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../_variables/esql.html">$esql</a>) je ON je.id = u.id
<a name="l176"><span class="linenum"> 176</span></a>                LEFT JOIN {message_contacts} mc ON mc.contactid = u.id AND mc.userid = :mcuserid
<a name="l177"><span class="linenum"> 177</span></a>               WHERE u.deleted = 0&quot;;
<a name="l178"><span class="linenum"> 178</span></a>  
<a name="l179"><span class="linenum"> 179</span></a>      <a class="var it10377" onMouseOver="hilite(10377)" onMouseOut="lolite()" onClick="logVariable('participants')" href="../_variables/participants.html">$participants</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a> * <a class="constant" onClick="logConstant('MESSAGE_CONTACTS_PER_PAGE')" href="../_constants/MESSAGE_CONTACTS_PER_PAGE.html" onMouseOver="constPopup(event,'MESSAGE_CONTACTS_PER_PAGE')">MESSAGE_CONTACTS_PER_PAGE</a>, <a class="constant" onClick="logConstant('MESSAGE_CONTACTS_PER_PAGE')" href="../_constants/MESSAGE_CONTACTS_PER_PAGE.html" onMouseOver="constPopup(event,'MESSAGE_CONTACTS_PER_PAGE')">MESSAGE_CONTACTS_PER_PAGE</a>);
<a name="l180"><span class="linenum"> 180</span></a>  
<a name="l181"><span class="linenum"> 181</span></a>      <a class="var it4276" onMouseOver="hilite(4276)" onMouseOut="lolite()" onClick="logVariable('pagingbar')" href="../_variables/pagingbar.html">$pagingbar</a> = <span class="keyword">new </span><a class="class" onClick="logClass('paging_bar')" href="../_classes/paging_bar.html" onMouseOver="classPopup(event,'paging_bar')">paging_bar</a>(<a class="var it20477" onMouseOver="hilite(20477)" onMouseOut="lolite()" onClick="logVariable('countparticipants')" href="../_variables/countparticipants.html">$countparticipants</a>, <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('page')" href="../_variables/page.html">$page</a>, <a class="constant" onClick="logConstant('MESSAGE_CONTACTS_PER_PAGE')" href="../_constants/MESSAGE_CONTACTS_PER_PAGE.html" onMouseOver="constPopup(event,'MESSAGE_CONTACTS_PER_PAGE')">MESSAGE_CONTACTS_PER_PAGE</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a>, 'page');
<a name="l182"><span class="linenum"> 182</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('render')" href="../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it4276" onMouseOver="hilite(4276)" onMouseOut="lolite()" onClick="logVariable('pagingbar')" href="../_variables/pagingbar.html">$pagingbar</a>);
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('id' =&gt; 'message_participants', 'class' =&gt; 'boxaligncenter'));
<a name="l185"><span class="linenum"> 185</span></a>  
<a name="l186"><span class="linenum"> 186</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div' , <a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>, array('class' =&gt; 'heading'));
<a name="l187"><span class="linenum"> 187</span></a>  
<a name="l188"><span class="linenum"> 188</span></a>      <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = '';
<a name="l189"><span class="linenum"> 189</span></a>      foreach (<a class="var it10377" onMouseOver="hilite(10377)" onMouseOut="lolite()" onClick="logVariable('participants')" href="../_variables/participants.html">$participants</a> as <a class="var it12484" onMouseOver="hilite(12484)" onMouseOut="lolite()" onClick="logVariable('participant')" href="../_variables/participant.html">$participant</a>) {
<a name="l190"><span class="linenum"> 190</span></a>          if (<a class="var it12484" onMouseOver="hilite(12484)" onMouseOut="lolite()" onClick="logVariable('participant')" href="../_variables/participant.html">$participant</a>-&gt;<a onClick="logVariable('id')" class="var it39891" onMouseOver="hilite(39891)" onMouseOut="lolite()" href="../_variables/id.html">id</a> != <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l191"><span class="linenum"> 191</span></a>  
<a name="l192"><span class="linenum"> 192</span></a>              <a class="var it21260" onMouseOver="hilite(21260)" onMouseOut="lolite()" onClick="logVariable('iscontact')" href="../_variables/iscontact.html">$iscontact</a> = false;
<a name="l193"><span class="linenum"> 193</span></a>              <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a> = false;
<a name="l194"><span class="linenum"> 194</span></a>              if ( <a class="var it12484" onMouseOver="hilite(12484)" onMouseOut="lolite()" onClick="logVariable('participant')" href="../_variables/participant.html">$participant</a>-&gt;<a onClick="logVariable('contactlistid')" class="var it39891" onMouseOver="hilite(39891)" onMouseOut="lolite()" href="../_variables/contactlistid.html">contactlistid</a> )  {
<a name="l195"><span class="linenum"> 195</span></a>                  if (<a class="var it12484" onMouseOver="hilite(12484)" onMouseOut="lolite()" onClick="logVariable('participant')" href="../_variables/participant.html">$participant</a>-&gt;<a onClick="logVariable('blocked')" class="var it39891" onMouseOver="hilite(39891)" onMouseOut="lolite()" href="../_variables/blocked.html">blocked</a> == 0) {
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">                    // Is contact. Is not blocked.</span>
<a name="l197"><span class="linenum"> 197</span></a>                      <a class="var it21260" onMouseOver="hilite(21260)" onMouseOut="lolite()" onClick="logVariable('iscontact')" href="../_variables/iscontact.html">$iscontact</a> = true;
<a name="l198"><span class="linenum"> 198</span></a>                      <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a> = false;
<a name="l199"><span class="linenum"> 199</span></a>                  } else {
<a name="l200"><span class="linenum"> 200</span></a>  <span class="comment">                    // Is blocked.</span>
<a name="l201"><span class="linenum"> 201</span></a>                      <a class="var it21260" onMouseOver="hilite(21260)" onMouseOut="lolite()" onClick="logVariable('iscontact')" href="../_variables/iscontact.html">$iscontact</a> = false;
<a name="l202"><span class="linenum"> 202</span></a>                      <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a> = true;
<a name="l203"><span class="linenum"> 203</span></a>                  }
<a name="l204"><span class="linenum"> 204</span></a>              }
<a name="l205"><span class="linenum"> 205</span></a>  
<a name="l206"><span class="linenum"> 206</span></a>              <a class="var it12484" onMouseOver="hilite(12484)" onMouseOut="lolite()" onClick="logVariable('participant')" href="../_variables/participant.html">$participant</a>-&gt;<a onClick="logVariable('messagecount')" class="var it39891" onMouseOver="hilite(39891)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a> = 0;<span class="comment">//todo it would be nice if the course participant could report new messages</span>
<a name="l207"><span class="linenum"> 207</span></a>              <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('message_print_contactlist_user')" href="../_functions/message_print_contactlist_user.html" onMouseOver="funcPopup(event,'message_print_contactlist_user')">message_print_contactlist_user</a>(<a class="var it12484" onMouseOver="hilite(12484)" onMouseOut="lolite()" onClick="logVariable('participant')" href="../_variables/participant.html">$participant</a>, <a class="var it21260" onMouseOver="hilite(21260)" onMouseOut="lolite()" onClick="logVariable('iscontact')" href="../_variables/iscontact.html">$iscontact</a>, <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a>,
<a name="l208"><span class="linenum"> 208</span></a>                  <a class="var it21257" onMouseOver="hilite(21257)" onMouseOut="lolite()" onClick="logVariable('contactselecturl')" href="../_variables/contactselecturl.html">$contactselecturl</a>, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>);
<a name="l209"><span class="linenum"> 209</span></a>              <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('li', <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a>);
<a name="l210"><span class="linenum"> 210</span></a>          }
<a name="l211"><span class="linenum"> 211</span></a>      }
<a name="l212"><span class="linenum"> 212</span></a>      if (<a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>) &gt; 0) {
<a name="l213"><span class="linenum"> 213</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('ul', <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>, array('id' =&gt; 'message-courseparticipants', 'class' =&gt; 'message-contacts'));
<a name="l214"><span class="linenum"> 214</span></a>      }
<a name="l215"><span class="linenum"> 215</span></a>  
<a name="l216"><span class="linenum"> 216</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l217"><span class="linenum"> 217</span></a>  }
<a name="l218"><span class="linenum"> 218</span></a>  
<a name="l219"><span class="linenum"> 219</span></a>  <span class="comment">/**</span>
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment"> * Retrieve users blocked by $user1</span>
<a name="l221"><span class="linenum"> 221</span></a>  <span class="comment"> *</span>
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment"> * @param object $user1 the user whose messages are being viewed</span>
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment"> * @param object $user2 the user $user1 is talking to. If they are being blocked</span>
<a name="l224"><span class="linenum"> 224</span></a>  <span class="comment"> *                      they will have a variable called 'isblocked' added to their user object</span>
<a name="l225"><span class="linenum"> 225</span></a>  <span class="comment"> * @return array the users blocked by $user1</span>
<a name="l226"><span class="linenum"> 226</span></a>  <span class="comment"> */</span>
<a name="l227"><span class="linenum"> 227</span></a>  function <a class="function" onClick="logFunction('message_get_blocked_users')" href="../_functions/message_get_blocked_users.html" onMouseOver="funcPopup(event,'message_get_blocked_users')">message_get_blocked_users</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>=null, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>=null) {
<a name="l228"><span class="linenum"> 228</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>      if (empty(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>)) {
<a name="l231"><span class="linenum"> 231</span></a>          <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l232"><span class="linenum"> 232</span></a>      }
<a name="l233"><span class="linenum"> 233</span></a>  
<a name="l234"><span class="linenum"> 234</span></a>      if (!empty(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>)) {
<a name="l235"><span class="linenum"> 235</span></a>          <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('isblocked')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/isblocked.html">isblocked</a> = false;
<a name="l236"><span class="linenum"> 236</span></a>      }
<a name="l237"><span class="linenum"> 237</span></a>  
<a name="l238"><span class="linenum"> 238</span></a>      <a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a> = array();
<a name="l239"><span class="linenum"> 239</span></a>  
<a name="l240"><span class="linenum"> 240</span></a>      <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> = <a class="class" onClick="logClass('user_picture')" href="../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('u', array('lastaccess'));
<a name="l241"><span class="linenum"> 241</span></a>      <a class="var it21263" onMouseOver="hilite(21263)" onMouseOut="lolite()" onClick="logVariable('blockeduserssql')" href="../_variables/blockeduserssql.html">$blockeduserssql</a> = &quot;SELECT <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>, <a class="phpfunction" onClick="logFunction('COUNT')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(m.id) AS messagecount
<a name="l242"><span class="linenum"> 242</span></a>                            FROM {message_contacts} mc
<a name="l243"><span class="linenum"> 243</span></a>                            JOIN {user} u ON u.id = mc.contactid
<a name="l244"><span class="linenum"> 244</span></a>                            LEFT OUTER JOIN {message} m ON m.useridfrom = mc.contactid AND m.useridto = :user1id1
<a name="l245"><span class="linenum"> 245</span></a>                           WHERE mc.userid = :user1id2 AND mc.blocked = 1
<a name="l246"><span class="linenum"> 246</span></a>                        GROUP BY <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>
<a name="l247"><span class="linenum"> 247</span></a>                        ORDER BY u.firstname ASC&quot;;
<a name="l248"><span class="linenum"> 248</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> =  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it21263" onMouseOver="hilite(21263)" onMouseOut="lolite()" onClick="logVariable('blockeduserssql')" href="../_variables/blockeduserssql.html">$blockeduserssql</a>, array('user1id1' =&gt; <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'user1id2' =&gt; <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l249"><span class="linenum"> 249</span></a>  
<a name="l250"><span class="linenum"> 250</span></a>      foreach(<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>) {
<a name="l251"><span class="linenum"> 251</span></a>          <a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a>[] = <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>;
<a name="l252"><span class="linenum"> 252</span></a>  
<a name="l253"><span class="linenum"> 253</span></a>          if (!empty(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>) &amp;&amp; <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('id')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l254"><span class="linenum"> 254</span></a>              <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('isblocked')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/isblocked.html">isblocked</a> = true;
<a name="l255"><span class="linenum"> 255</span></a>          }
<a name="l256"><span class="linenum"> 256</span></a>      }
<a name="l257"><span class="linenum"> 257</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l258"><span class="linenum"> 258</span></a>  
<a name="l259"><span class="linenum"> 259</span></a>      return <a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a>;
<a name="l260"><span class="linenum"> 260</span></a>  }
<a name="l261"><span class="linenum"> 261</span></a>  
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">/**</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment"> * Print users blocked by $user1. Called by message_print_contact_selector()</span>
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment"> *</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment"> * @param array $blockedusers the users blocked by $user1</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment"> * @param string $contactselecturl the url to send the user to when a contact's name is clicked</span>
<a name="l267"><span class="linenum"> 267</span></a>  <span class="comment"> * @param bool $showactionlinks show action links (add/remove contact etc) next to the users</span>
<a name="l268"><span class="linenum"> 268</span></a>  <span class="comment"> * @param string $titletodisplay Optionally specify a title to display above the participants</span>
<a name="l269"><span class="linenum"> 269</span></a>  <span class="comment"> * @param object $user2 the user $user1 is talking to. They will be highlighted if they appear in the list of blocked users</span>
<a name="l270"><span class="linenum"> 270</span></a>  <span class="comment"> * @return void</span>
<a name="l271"><span class="linenum"> 271</span></a>  <span class="comment"> */</span>
<a name="l272"><span class="linenum"> 272</span></a>  function <a class="function" onClick="logFunction('message_print_blocked_users')" href="../_functions/message_print_blocked_users.html" onMouseOver="funcPopup(event,'message_print_blocked_users')">message_print_blocked_users</a>(<a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a>, <a class="var it21257" onMouseOver="hilite(21257)" onMouseOut="lolite()" onClick="logVariable('contactselecturl')" href="../_variables/contactselecturl.html">$contactselecturl</a>=null, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>=true, <a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>=null, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>=null) {
<a name="l273"><span class="linenum"> 273</span></a>      global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l274"><span class="linenum"> 274</span></a>  
<a name="l275"><span class="linenum"> 275</span></a>      <a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('countblocked')" href="../_variables/countblocked.html">$countblocked</a> = <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a>);
<a name="l276"><span class="linenum"> 276</span></a>  
<a name="l277"><span class="linenum"> 277</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('id' =&gt; 'message_contacts', 'class' =&gt; 'boxaligncenter'));
<a name="l278"><span class="linenum"> 278</span></a>  
<a name="l279"><span class="linenum"> 279</span></a>      if (!empty(<a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>)) {
<a name="l280"><span class="linenum"> 280</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>, array('class' =&gt; 'heading'));
<a name="l281"><span class="linenum"> 281</span></a>      }
<a name="l282"><span class="linenum"> 282</span></a>  
<a name="l283"><span class="linenum"> 283</span></a>      if (<a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('countblocked')" href="../_variables/countblocked.html">$countblocked</a>) {
<a name="l284"><span class="linenum"> 284</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('blockedusers', 'message', <a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('countblocked')" href="../_variables/countblocked.html">$countblocked</a>), array('class' =&gt; 'heading'));
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>          <a class="var it21264" onMouseOver="hilite(21264)" onMouseOut="lolite()" onClick="logVariable('isuserblocked')" href="../_variables/isuserblocked.html">$isuserblocked</a> = true;
<a name="l287"><span class="linenum"> 287</span></a>          <a class="var it21265" onMouseOver="hilite(21265)" onMouseOut="lolite()" onClick="logVariable('isusercontact')" href="../_variables/isusercontact.html">$isusercontact</a> = false;
<a name="l288"><span class="linenum"> 288</span></a>          <a class="var it21266" onMouseOver="hilite(21266)" onMouseOut="lolite()" onClick="logVariable('blockeduserslist')" href="../_variables/blockeduserslist.html">$blockeduserslist</a> = '';
<a name="l289"><span class="linenum"> 289</span></a>          foreach (<a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('blockedusers')" href="../_variables/blockedusers.html">$blockedusers</a> as <a class="var it21267" onMouseOver="hilite(21267)" onMouseOut="lolite()" onClick="logVariable('blockeduser')" href="../_variables/blockeduser.html">$blockeduser</a>) {
<a name="l290"><span class="linenum"> 290</span></a>              <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('message_print_contactlist_user')" href="../_functions/message_print_contactlist_user.html" onMouseOver="funcPopup(event,'message_print_contactlist_user')">message_print_contactlist_user</a>(<a class="var it21267" onMouseOver="hilite(21267)" onMouseOut="lolite()" onClick="logVariable('blockeduser')" href="../_variables/blockeduser.html">$blockeduser</a>, <a class="var it21265" onMouseOver="hilite(21265)" onMouseOut="lolite()" onClick="logVariable('isusercontact')" href="../_variables/isusercontact.html">$isusercontact</a>, <a class="var it21264" onMouseOver="hilite(21264)" onMouseOut="lolite()" onClick="logVariable('isuserblocked')" href="../_variables/isuserblocked.html">$isuserblocked</a>,
<a name="l291"><span class="linenum"> 291</span></a>                  <a class="var it21257" onMouseOver="hilite(21257)" onMouseOut="lolite()" onClick="logVariable('contactselecturl')" href="../_variables/contactselecturl.html">$contactselecturl</a>, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>);
<a name="l292"><span class="linenum"> 292</span></a>              <a class="var it21266" onMouseOver="hilite(21266)" onMouseOut="lolite()" onClick="logVariable('blockeduserslist')" href="../_variables/blockeduserslist.html">$blockeduserslist</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('li', <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a>);
<a name="l293"><span class="linenum"> 293</span></a>          }
<a name="l294"><span class="linenum"> 294</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('ul', <a class="var it21266" onMouseOver="hilite(21266)" onMouseOut="lolite()" onClick="logVariable('blockeduserslist')" href="../_variables/blockeduserslist.html">$blockeduserslist</a>, array('id' =&gt; 'message-blockedusers', 'class' =&gt; 'message-contacts'));
<a name="l295"><span class="linenum"> 295</span></a>      }
<a name="l296"><span class="linenum"> 296</span></a>  
<a name="l297"><span class="linenum"> 297</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l298"><span class="linenum"> 298</span></a>  }
<a name="l299"><span class="linenum"> 299</span></a>  
<a name="l300"><span class="linenum"> 300</span></a>  <span class="comment">/**</span>
<a name="l301"><span class="linenum"> 301</span></a>  <span class="comment"> * Retrieve $user1's contacts (online, offline and strangers)</span>
<a name="l302"><span class="linenum"> 302</span></a>  <span class="comment"> *</span>
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment"> * @param object $user1 the user whose messages are being viewed</span>
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment"> * @param object $user2 the user $user1 is talking to. If they are a contact</span>
<a name="l305"><span class="linenum"> 305</span></a>  <span class="comment"> *                      they will have a variable called 'iscontact' added to their user object</span>
<a name="l306"><span class="linenum"> 306</span></a>  <span class="comment"> * @return array containing 3 arrays. array($onlinecontacts, $offlinecontacts, $strangers)</span>
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment"> */</span>
<a name="l308"><span class="linenum"> 308</span></a>  function <a class="function" onClick="logFunction('message_get_contacts')" href="../_functions/message_get_contacts.html" onMouseOver="funcPopup(event,'message_get_contacts')">message_get_contacts</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>=null, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>=null) {
<a name="l309"><span class="linenum"> 309</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l310"><span class="linenum"> 310</span></a>  
<a name="l311"><span class="linenum"> 311</span></a>      if (empty(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>)) {
<a name="l312"><span class="linenum"> 312</span></a>          <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l313"><span class="linenum"> 313</span></a>      }
<a name="l314"><span class="linenum"> 314</span></a>  
<a name="l315"><span class="linenum"> 315</span></a>      if (!empty(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>)) {
<a name="l316"><span class="linenum"> 316</span></a>          <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('iscontact')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/iscontact.html">iscontact</a> = false;
<a name="l317"><span class="linenum"> 317</span></a>      }
<a name="l318"><span class="linenum"> 318</span></a>  
<a name="l319"><span class="linenum"> 319</span></a>      <a class="var it17324" onMouseOver="hilite(17324)" onMouseOut="lolite()" onClick="logVariable('timetoshowusers')" href="../_variables/timetoshowusers.html">$timetoshowusers</a> = 300; <span class="comment">//Seconds default</span>
<a name="l320"><span class="linenum"> 320</span></a>      if (isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('block_online_users_timetosee')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/block_online_users_timetosee.html">block_online_users_timetosee</a>)) {
<a name="l321"><span class="linenum"> 321</span></a>          <a class="var it17324" onMouseOver="hilite(17324)" onMouseOut="lolite()" onClick="logVariable('timetoshowusers')" href="../_variables/timetoshowusers.html">$timetoshowusers</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('block_online_users_timetosee')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/block_online_users_timetosee.html">block_online_users_timetosee</a> * 60;
<a name="l322"><span class="linenum"> 322</span></a>      }
<a name="l323"><span class="linenum"> 323</span></a>  
<a name="l324"><span class="linenum"> 324</span></a>  <span class="comment">    // time which a user is counting as being active since</span>
<a name="l325"><span class="linenum"> 325</span></a>      <a class="var it21268" onMouseOver="hilite(21268)" onMouseOut="lolite()" onClick="logVariable('timefrom')" href="../_variables/timefrom.html">$timefrom</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()-<a class="var it17324" onMouseOver="hilite(17324)" onMouseOut="lolite()" onClick="logVariable('timetoshowusers')" href="../_variables/timetoshowusers.html">$timetoshowusers</a>;
<a name="l326"><span class="linenum"> 326</span></a>  
<a name="l327"><span class="linenum"> 327</span></a>  <span class="comment">    // people in our contactlist who are online</span>
<a name="l328"><span class="linenum"> 328</span></a>      <a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('onlinecontacts')" href="../_variables/onlinecontacts.html">$onlinecontacts</a>  = array();
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment">    // people in our contactlist who are offline</span>
<a name="l330"><span class="linenum"> 330</span></a>      <a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('offlinecontacts')" href="../_variables/offlinecontacts.html">$offlinecontacts</a> = array();
<a name="l331"><span class="linenum"> 331</span></a>  <span class="comment">    // people who are not in our contactlist but have sent us a message</span>
<a name="l332"><span class="linenum"> 332</span></a>      <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>       = array();
<a name="l333"><span class="linenum"> 333</span></a>  
<a name="l334"><span class="linenum"> 334</span></a>      <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> = <a class="class" onClick="logClass('user_picture')" href="../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('u', array('lastaccess'));
<a name="l335"><span class="linenum"> 335</span></a>  
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">    // get all in our contactlist who are not blocked in our contact list</span>
<a name="l337"><span class="linenum"> 337</span></a>  <span class="comment">    // and count messages we have waiting from each of them</span>
<a name="l338"><span class="linenum"> 338</span></a>      <a class="var it21269" onMouseOver="hilite(21269)" onMouseOut="lolite()" onClick="logVariable('contactsql')" href="../_variables/contactsql.html">$contactsql</a> = &quot;SELECT <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>, <a class="phpfunction" onClick="logFunction('COUNT')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(m.id) AS messagecount
<a name="l339"><span class="linenum"> 339</span></a>                       FROM {message_contacts} mc
<a name="l340"><span class="linenum"> 340</span></a>                       JOIN {user} u ON u.id = mc.contactid
<a name="l341"><span class="linenum"> 341</span></a>                       LEFT OUTER JOIN {message} m ON m.useridfrom = mc.contactid AND m.useridto = ?
<a name="l342"><span class="linenum"> 342</span></a>                      WHERE mc.userid = ? AND mc.blocked = 0
<a name="l343"><span class="linenum"> 343</span></a>                   GROUP BY <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>
<a name="l344"><span class="linenum"> 344</span></a>                   ORDER BY u.firstname ASC&quot;;
<a name="l345"><span class="linenum"> 345</span></a>  
<a name="l346"><span class="linenum"> 346</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it21269" onMouseOver="hilite(21269)" onMouseOut="lolite()" onClick="logVariable('contactsql')" href="../_variables/contactsql.html">$contactsql</a>, array(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l347"><span class="linenum"> 347</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>) {
<a name="l348"><span class="linenum"> 348</span></a>          if (<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('lastaccess')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/lastaccess.html">lastaccess</a> &gt;= <a class="var it21268" onMouseOver="hilite(21268)" onMouseOut="lolite()" onClick="logVariable('timefrom')" href="../_variables/timefrom.html">$timefrom</a>) {
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment">            // they have been active recently, so are counted online</span>
<a name="l350"><span class="linenum"> 350</span></a>              <a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('onlinecontacts')" href="../_variables/onlinecontacts.html">$onlinecontacts</a>[] = <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>;
<a name="l351"><span class="linenum"> 351</span></a>  
<a name="l352"><span class="linenum"> 352</span></a>          } else {
<a name="l353"><span class="linenum"> 353</span></a>              <a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('offlinecontacts')" href="../_variables/offlinecontacts.html">$offlinecontacts</a>[] = <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>;
<a name="l354"><span class="linenum"> 354</span></a>          }
<a name="l355"><span class="linenum"> 355</span></a>  
<a name="l356"><span class="linenum"> 356</span></a>          if (!empty(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>) &amp;&amp; <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('id')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l357"><span class="linenum"> 357</span></a>              <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('iscontact')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/iscontact.html">iscontact</a> = true;
<a name="l358"><span class="linenum"> 358</span></a>          }
<a name="l359"><span class="linenum"> 359</span></a>      }
<a name="l360"><span class="linenum"> 360</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment">    // get messages from anyone who isn't in our contact list and count the number</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment">    // of messages we have from each of them</span>
<a name="l364"><span class="linenum"> 364</span></a>      <a class="var it21270" onMouseOver="hilite(21270)" onMouseOut="lolite()" onClick="logVariable('strangersql')" href="../_variables/strangersql.html">$strangersql</a> = &quot;SELECT <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>, <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(m.id) as messagecount
<a name="l365"><span class="linenum"> 365</span></a>                        FROM {message} m
<a name="l366"><span class="linenum"> 366</span></a>                        JOIN {user} u  ON u.id = m.useridfrom
<a name="l367"><span class="linenum"> 367</span></a>                        LEFT OUTER JOIN {message_contacts} mc ON mc.contactid = m.useridfrom AND mc.userid = m.useridto
<a name="l368"><span class="linenum"> 368</span></a>                       WHERE mc.id IS NULL AND m.useridto = ?
<a name="l369"><span class="linenum"> 369</span></a>                    GROUP BY <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>
<a name="l370"><span class="linenum"> 370</span></a>                    ORDER BY u.firstname ASC&quot;;
<a name="l371"><span class="linenum"> 371</span></a>  
<a name="l372"><span class="linenum"> 372</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it21270" onMouseOver="hilite(21270)" onMouseOut="lolite()" onClick="logVariable('strangersql')" href="../_variables/strangersql.html">$strangersql</a>, array(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l373"><span class="linenum"> 373</span></a>  <span class="comment">    // Add user id as array index, so supportuser and noreply user don't get duplicated (if they are real users).</span>
<a name="l374"><span class="linenum"> 374</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>) {
<a name="l375"><span class="linenum"> 375</span></a>          <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>[<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('id')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>;
<a name="l376"><span class="linenum"> 376</span></a>      }
<a name="l377"><span class="linenum"> 377</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l378"><span class="linenum"> 378</span></a>  
<a name="l379"><span class="linenum"> 379</span></a>  <span class="comment">    // Add noreply user and support user to the list, if they don't exist.</span>
<a name="l380"><span class="linenum"> 380</span></a>      <a class="var it4026" onMouseOver="hilite(4026)" onMouseOut="lolite()" onClick="logVariable('supportuser')" href="../_variables/supportuser.html">$supportuser</a> = <a class="class" onClick="logClass('core_user')" href="../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('get_support_user')" href="../_functions/get_support_user.html" onMouseOver="funcPopup(event,'get_support_user')">get_support_user</a>();
<a name="l381"><span class="linenum"> 381</span></a>      if (!isset(<a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>[<a class="var it4026" onMouseOver="hilite(4026)" onMouseOut="lolite()" onClick="logVariable('supportuser')" href="../_variables/supportuser.html">$supportuser</a>-&gt;<a onClick="logVariable('id')" class="var it41076" onMouseOver="hilite(41076)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l382"><span class="linenum"> 382</span></a>          <a class="var it4026" onMouseOver="hilite(4026)" onMouseOut="lolite()" onClick="logVariable('supportuser')" href="../_variables/supportuser.html">$supportuser</a>-&gt;<a onClick="logVariable('messagecount')" class="var it41076" onMouseOver="hilite(41076)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a> = <a class="function" onClick="logFunction('message_count_unread_messages')" href="../_functions/message_count_unread_messages.html" onMouseOver="funcPopup(event,'message_count_unread_messages')">message_count_unread_messages</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it4026" onMouseOver="hilite(4026)" onMouseOut="lolite()" onClick="logVariable('supportuser')" href="../_variables/supportuser.html">$supportuser</a>);
<a name="l383"><span class="linenum"> 383</span></a>          if (<a class="var it4026" onMouseOver="hilite(4026)" onMouseOut="lolite()" onClick="logVariable('supportuser')" href="../_variables/supportuser.html">$supportuser</a>-&gt;<a onClick="logVariable('messagecount')" class="var it41076" onMouseOver="hilite(41076)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a> &gt; 0) {
<a name="l384"><span class="linenum"> 384</span></a>              <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>[<a class="var it4026" onMouseOver="hilite(4026)" onMouseOut="lolite()" onClick="logVariable('supportuser')" href="../_variables/supportuser.html">$supportuser</a>-&gt;<a onClick="logVariable('id')" class="var it41076" onMouseOver="hilite(41076)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it4026" onMouseOver="hilite(4026)" onMouseOut="lolite()" onClick="logVariable('supportuser')" href="../_variables/supportuser.html">$supportuser</a>;
<a name="l385"><span class="linenum"> 385</span></a>          }
<a name="l386"><span class="linenum"> 386</span></a>      }
<a name="l387"><span class="linenum"> 387</span></a>  
<a name="l388"><span class="linenum"> 388</span></a>      <a class="var it9812" onMouseOver="hilite(9812)" onMouseOut="lolite()" onClick="logVariable('noreplyuser')" href="../_variables/noreplyuser.html">$noreplyuser</a> = <a class="class" onClick="logClass('core_user')" href="../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('get_noreply_user')" href="../_functions/get_noreply_user.html" onMouseOver="funcPopup(event,'get_noreply_user')">get_noreply_user</a>();
<a name="l389"><span class="linenum"> 389</span></a>      if (!isset(<a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>[<a class="var it9812" onMouseOver="hilite(9812)" onMouseOut="lolite()" onClick="logVariable('noreplyuser')" href="../_variables/noreplyuser.html">$noreplyuser</a>-&gt;<a onClick="logVariable('id')" class="var it41890" onMouseOver="hilite(41890)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l390"><span class="linenum"> 390</span></a>          <a class="var it9812" onMouseOver="hilite(9812)" onMouseOut="lolite()" onClick="logVariable('noreplyuser')" href="../_variables/noreplyuser.html">$noreplyuser</a>-&gt;<a onClick="logVariable('messagecount')" class="var it41890" onMouseOver="hilite(41890)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a> = <a class="function" onClick="logFunction('message_count_unread_messages')" href="../_functions/message_count_unread_messages.html" onMouseOver="funcPopup(event,'message_count_unread_messages')">message_count_unread_messages</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it9812" onMouseOver="hilite(9812)" onMouseOut="lolite()" onClick="logVariable('noreplyuser')" href="../_variables/noreplyuser.html">$noreplyuser</a>);
<a name="l391"><span class="linenum"> 391</span></a>          if (<a class="var it9812" onMouseOver="hilite(9812)" onMouseOut="lolite()" onClick="logVariable('noreplyuser')" href="../_variables/noreplyuser.html">$noreplyuser</a>-&gt;<a onClick="logVariable('messagecount')" class="var it41890" onMouseOver="hilite(41890)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a> &gt; 0) {
<a name="l392"><span class="linenum"> 392</span></a>              <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>[<a class="var it9812" onMouseOver="hilite(9812)" onMouseOut="lolite()" onClick="logVariable('noreplyuser')" href="../_variables/noreplyuser.html">$noreplyuser</a>-&gt;<a onClick="logVariable('id')" class="var it41890" onMouseOver="hilite(41890)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it9812" onMouseOver="hilite(9812)" onMouseOut="lolite()" onClick="logVariable('noreplyuser')" href="../_variables/noreplyuser.html">$noreplyuser</a>;
<a name="l393"><span class="linenum"> 393</span></a>          }
<a name="l394"><span class="linenum"> 394</span></a>      }
<a name="l395"><span class="linenum"> 395</span></a>      return array(<a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('onlinecontacts')" href="../_variables/onlinecontacts.html">$onlinecontacts</a>, <a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('offlinecontacts')" href="../_variables/offlinecontacts.html">$offlinecontacts</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>);
<a name="l396"><span class="linenum"> 396</span></a>  }
<a name="l397"><span class="linenum"> 397</span></a>  
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">/**</span>
<a name="l399"><span class="linenum"> 399</span></a>  <span class="comment"> * Print $user1's contacts. Called by message_print_contact_selector()</span>
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment"> *</span>
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment"> * @param array $onlinecontacts $user1's contacts which are online</span>
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment"> * @param array $offlinecontacts $user1's contacts which are offline</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment"> * @param array $strangers users which are not contacts but who have messaged $user1</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment"> * @param string $contactselecturl the url to send the user to when a contact's name is clicked</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment"> * @param int $minmessages The minimum number of unread messages required from a user for them to be displayed</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment"> *                         Typically 0 (show all contacts) or 1 (only show contacts from whom we have a new message)</span>
<a name="l407"><span class="linenum"> 407</span></a>  <span class="comment"> * @param bool $showactionlinks show action links (add/remove contact etc) next to the users</span>
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment"> * @param string $titletodisplay Optionally specify a title to display above the participants</span>
<a name="l409"><span class="linenum"> 409</span></a>  <span class="comment"> * @param object $user2 the user $user1 is talking to. They will be highlighted if they appear in the list of contacts</span>
<a name="l410"><span class="linenum"> 410</span></a>  <span class="comment"> * @return void</span>
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment"> */</span>
<a name="l412"><span class="linenum"> 412</span></a>  function <a class="function" onClick="logFunction('message_print_contacts')" href="../_functions/message_print_contacts.html" onMouseOver="funcPopup(event,'message_print_contacts')">message_print_contacts</a>(<a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('onlinecontacts')" href="../_variables/onlinecontacts.html">$onlinecontacts</a>, <a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('offlinecontacts')" href="../_variables/offlinecontacts.html">$offlinecontacts</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>, <a class="var it21257" onMouseOver="hilite(21257)" onMouseOut="lolite()" onClick="logVariable('contactselecturl')" href="../_variables/contactselecturl.html">$contactselecturl</a>=null, <a class="var it21271" onMouseOver="hilite(21271)" onMouseOut="lolite()" onClick="logVariable('minmessages')" href="../_variables/minmessages.html">$minmessages</a>=0, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>=true, <a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>=null, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>=null) {
<a name="l413"><span class="linenum"> 413</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l414"><span class="linenum"> 414</span></a>  
<a name="l415"><span class="linenum"> 415</span></a>      <a class="var it21272" onMouseOver="hilite(21272)" onMouseOut="lolite()" onClick="logVariable('countonlinecontacts')" href="../_variables/countonlinecontacts.html">$countonlinecontacts</a>  = <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('onlinecontacts')" href="../_variables/onlinecontacts.html">$onlinecontacts</a>);
<a name="l416"><span class="linenum"> 416</span></a>      <a class="var it21273" onMouseOver="hilite(21273)" onMouseOut="lolite()" onClick="logVariable('countofflinecontacts')" href="../_variables/countofflinecontacts.html">$countofflinecontacts</a> = <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('offlinecontacts')" href="../_variables/offlinecontacts.html">$offlinecontacts</a>);
<a name="l417"><span class="linenum"> 417</span></a>      <a class="var it21274" onMouseOver="hilite(21274)" onMouseOut="lolite()" onClick="logVariable('countstrangers')" href="../_variables/countstrangers.html">$countstrangers</a>       = <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a>);
<a name="l418"><span class="linenum"> 418</span></a>      <a class="var it21264" onMouseOver="hilite(21264)" onMouseOut="lolite()" onClick="logVariable('isuserblocked')" href="../_variables/isuserblocked.html">$isuserblocked</a> = null;
<a name="l419"><span class="linenum"> 419</span></a>  
<a name="l420"><span class="linenum"> 420</span></a>      if (<a class="var it21272" onMouseOver="hilite(21272)" onMouseOut="lolite()" onClick="logVariable('countonlinecontacts')" href="../_variables/countonlinecontacts.html">$countonlinecontacts</a> + <a class="var it21273" onMouseOver="hilite(21273)" onMouseOut="lolite()" onClick="logVariable('countofflinecontacts')" href="../_variables/countofflinecontacts.html">$countofflinecontacts</a> == 0) {
<a name="l421"><span class="linenum"> 421</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('contactlistempty', 'message'), array('class' =&gt; 'heading'));
<a name="l422"><span class="linenum"> 422</span></a>      }
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>      if (!empty(<a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>)) {
<a name="l425"><span class="linenum"> 425</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>, array('class' =&gt; 'heading'));
<a name="l426"><span class="linenum"> 426</span></a>      }
<a name="l427"><span class="linenum"> 427</span></a>  
<a name="l428"><span class="linenum"> 428</span></a>      if(<a class="var it21272" onMouseOver="hilite(21272)" onMouseOut="lolite()" onClick="logVariable('countonlinecontacts')" href="../_variables/countonlinecontacts.html">$countonlinecontacts</a>) {
<a name="l429"><span class="linenum"> 429</span></a>  <span class="comment">        // Print out list of online contacts.</span>
<a name="l430"><span class="linenum"> 430</span></a>  
<a name="l431"><span class="linenum"> 431</span></a>          if (empty(<a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>)) {
<a name="l432"><span class="linenum"> 432</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div',
<a name="l433"><span class="linenum"> 433</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('onlinecontacts', 'message', <a class="var it21272" onMouseOver="hilite(21272)" onMouseOut="lolite()" onClick="logVariable('countonlinecontacts')" href="../_variables/countonlinecontacts.html">$countonlinecontacts</a>),
<a name="l434"><span class="linenum"> 434</span></a>                  array('class' =&gt; 'heading'));
<a name="l435"><span class="linenum"> 435</span></a>          }
<a name="l436"><span class="linenum"> 436</span></a>  
<a name="l437"><span class="linenum"> 437</span></a>          <a class="var it21264" onMouseOver="hilite(21264)" onMouseOut="lolite()" onClick="logVariable('isuserblocked')" href="../_variables/isuserblocked.html">$isuserblocked</a> = false;
<a name="l438"><span class="linenum"> 438</span></a>          <a class="var it21265" onMouseOver="hilite(21265)" onMouseOut="lolite()" onClick="logVariable('isusercontact')" href="../_variables/isusercontact.html">$isusercontact</a> = true;
<a name="l439"><span class="linenum"> 439</span></a>          <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a> = '';
<a name="l440"><span class="linenum"> 440</span></a>          foreach (<a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('onlinecontacts')" href="../_variables/onlinecontacts.html">$onlinecontacts</a> as <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>) {
<a name="l441"><span class="linenum"> 441</span></a>              if (<a class="var it21271" onMouseOver="hilite(21271)" onMouseOut="lolite()" onClick="logVariable('minmessages')" href="../_variables/minmessages.html">$minmessages</a> == 0 || <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('messagecount')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a> &gt;= <a class="var it21271" onMouseOver="hilite(21271)" onMouseOut="lolite()" onClick="logVariable('minmessages')" href="../_variables/minmessages.html">$minmessages</a>) {
<a name="l442"><span class="linenum"> 442</span></a>                  <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('message_print_contactlist_user')" href="../_functions/message_print_contactlist_user.html" onMouseOver="funcPopup(event,'message_print_contactlist_user')">message_print_contactlist_user</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>, <a class="var it21265" onMouseOver="hilite(21265)" onMouseOut="lolite()" onClick="logVariable('isusercontact')" href="../_variables/isusercontact.html">$isusercontact</a>, <a class="var it21264" onMouseOver="hilite(21264)" onMouseOut="lolite()" onClick="logVariable('isuserblocked')" href="../_variables/isuserblocked.html">$isuserblocked</a>,
<a name="l443"><span class="linenum"> 443</span></a>                      <a class="var it21257" onMouseOver="hilite(21257)" onMouseOut="lolite()" onClick="logVariable('contactselecturl')" href="../_variables/contactselecturl.html">$contactselecturl</a>, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>);
<a name="l444"><span class="linenum"> 444</span></a>                  <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('li', <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a>);
<a name="l445"><span class="linenum"> 445</span></a>              }
<a name="l446"><span class="linenum"> 446</span></a>          }
<a name="l447"><span class="linenum"> 447</span></a>          if (<a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>) &gt; 0) {
<a name="l448"><span class="linenum"> 448</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('ul', <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>, array('id' =&gt; 'message-onlinecontacts', 'class' =&gt; 'message-contacts'));
<a name="l449"><span class="linenum"> 449</span></a>          }
<a name="l450"><span class="linenum"> 450</span></a>      }
<a name="l451"><span class="linenum"> 451</span></a>  
<a name="l452"><span class="linenum"> 452</span></a>      if (<a class="var it21273" onMouseOver="hilite(21273)" onMouseOut="lolite()" onClick="logVariable('countofflinecontacts')" href="../_variables/countofflinecontacts.html">$countofflinecontacts</a>) {
<a name="l453"><span class="linenum"> 453</span></a>  <span class="comment">        // Print out list of offline contacts.</span>
<a name="l454"><span class="linenum"> 454</span></a>  
<a name="l455"><span class="linenum"> 455</span></a>          if (empty(<a class="var it21258" onMouseOver="hilite(21258)" onMouseOut="lolite()" onClick="logVariable('titletodisplay')" href="../_variables/titletodisplay.html">$titletodisplay</a>)) {
<a name="l456"><span class="linenum"> 456</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div',
<a name="l457"><span class="linenum"> 457</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('offlinecontacts', 'message', <a class="var it21273" onMouseOver="hilite(21273)" onMouseOut="lolite()" onClick="logVariable('countofflinecontacts')" href="../_variables/countofflinecontacts.html">$countofflinecontacts</a>),
<a name="l458"><span class="linenum"> 458</span></a>                  array('class' =&gt; 'heading'));
<a name="l459"><span class="linenum"> 459</span></a>          }
<a name="l460"><span class="linenum"> 460</span></a>  
<a name="l461"><span class="linenum"> 461</span></a>          <a class="var it21264" onMouseOver="hilite(21264)" onMouseOut="lolite()" onClick="logVariable('isuserblocked')" href="../_variables/isuserblocked.html">$isuserblocked</a> = false;
<a name="l462"><span class="linenum"> 462</span></a>          <a class="var it21265" onMouseOver="hilite(21265)" onMouseOut="lolite()" onClick="logVariable('isusercontact')" href="../_variables/isusercontact.html">$isusercontact</a> = true;
<a name="l463"><span class="linenum"> 463</span></a>          <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a> = '';
<a name="l464"><span class="linenum"> 464</span></a>          foreach (<a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('offlinecontacts')" href="../_variables/offlinecontacts.html">$offlinecontacts</a> as <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>) {
<a name="l465"><span class="linenum"> 465</span></a>              if (<a class="var it21271" onMouseOver="hilite(21271)" onMouseOut="lolite()" onClick="logVariable('minmessages')" href="../_variables/minmessages.html">$minmessages</a> == 0 || <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('messagecount')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a> &gt;= <a class="var it21271" onMouseOver="hilite(21271)" onMouseOut="lolite()" onClick="logVariable('minmessages')" href="../_variables/minmessages.html">$minmessages</a>) {
<a name="l466"><span class="linenum"> 466</span></a>                  <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('message_print_contactlist_user')" href="../_functions/message_print_contactlist_user.html" onMouseOver="funcPopup(event,'message_print_contactlist_user')">message_print_contactlist_user</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>, <a class="var it21265" onMouseOver="hilite(21265)" onMouseOut="lolite()" onClick="logVariable('isusercontact')" href="../_variables/isusercontact.html">$isusercontact</a>, <a class="var it21264" onMouseOver="hilite(21264)" onMouseOut="lolite()" onClick="logVariable('isuserblocked')" href="../_variables/isuserblocked.html">$isuserblocked</a>,
<a name="l467"><span class="linenum"> 467</span></a>                      <a class="var it21257" onMouseOver="hilite(21257)" onMouseOut="lolite()" onClick="logVariable('contactselecturl')" href="../_variables/contactselecturl.html">$contactselecturl</a>, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>);
<a name="l468"><span class="linenum"> 468</span></a>                  <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('li', <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a>);
<a name="l469"><span class="linenum"> 469</span></a>              }
<a name="l470"><span class="linenum"> 470</span></a>          }
<a name="l471"><span class="linenum"> 471</span></a>          if (<a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>) &gt; 0) {
<a name="l472"><span class="linenum"> 472</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('ul', <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>, array('id' =&gt; 'message-offlinecontacts', 'class' =&gt; 'message-contacts'));
<a name="l473"><span class="linenum"> 473</span></a>          }
<a name="l474"><span class="linenum"> 474</span></a>  
<a name="l475"><span class="linenum"> 475</span></a>      }
<a name="l476"><span class="linenum"> 476</span></a>  
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">    // Print out list of incoming contacts.</span>
<a name="l478"><span class="linenum"> 478</span></a>      if (<a class="var it21274" onMouseOver="hilite(21274)" onMouseOut="lolite()" onClick="logVariable('countstrangers')" href="../_variables/countstrangers.html">$countstrangers</a>) {
<a name="l479"><span class="linenum"> 479</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('incomingcontacts', 'message', <a class="var it21274" onMouseOver="hilite(21274)" onMouseOut="lolite()" onClick="logVariable('countstrangers')" href="../_variables/countstrangers.html">$countstrangers</a>), array('class' =&gt; 'heading'));
<a name="l480"><span class="linenum"> 480</span></a>  
<a name="l481"><span class="linenum"> 481</span></a>          <a class="var it21264" onMouseOver="hilite(21264)" onMouseOut="lolite()" onClick="logVariable('isuserblocked')" href="../_variables/isuserblocked.html">$isuserblocked</a> = false;
<a name="l482"><span class="linenum"> 482</span></a>          <a class="var it21265" onMouseOver="hilite(21265)" onMouseOut="lolite()" onClick="logVariable('isusercontact')" href="../_variables/isusercontact.html">$isusercontact</a> = false;
<a name="l483"><span class="linenum"> 483</span></a>          <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a> = '';
<a name="l484"><span class="linenum"> 484</span></a>          foreach (<a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('strangers')" href="../_variables/strangers.html">$strangers</a> as <a class="var it21275" onMouseOver="hilite(21275)" onMouseOut="lolite()" onClick="logVariable('stranger')" href="../_variables/stranger.html">$stranger</a>) {
<a name="l485"><span class="linenum"> 485</span></a>              if (<a class="var it21271" onMouseOver="hilite(21271)" onMouseOut="lolite()" onClick="logVariable('minmessages')" href="../_variables/minmessages.html">$minmessages</a> == 0 || <a class="var it21275" onMouseOver="hilite(21275)" onMouseOut="lolite()" onClick="logVariable('stranger')" href="../_variables/stranger.html">$stranger</a>-&gt;<a onClick="logVariable('messagecount')" class="var it42196" onMouseOver="hilite(42196)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a> &gt;= <a class="var it21271" onMouseOver="hilite(21271)" onMouseOut="lolite()" onClick="logVariable('minmessages')" href="../_variables/minmessages.html">$minmessages</a>) {
<a name="l486"><span class="linenum"> 486</span></a>                  <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('message_print_contactlist_user')" href="../_functions/message_print_contactlist_user.html" onMouseOver="funcPopup(event,'message_print_contactlist_user')">message_print_contactlist_user</a>(<a class="var it21275" onMouseOver="hilite(21275)" onMouseOut="lolite()" onClick="logVariable('stranger')" href="../_variables/stranger.html">$stranger</a>, <a class="var it21265" onMouseOver="hilite(21265)" onMouseOut="lolite()" onClick="logVariable('isusercontact')" href="../_variables/isusercontact.html">$isusercontact</a>, <a class="var it21264" onMouseOver="hilite(21264)" onMouseOut="lolite()" onClick="logVariable('isuserblocked')" href="../_variables/isuserblocked.html">$isuserblocked</a>,
<a name="l487"><span class="linenum"> 487</span></a>                      <a class="var it21257" onMouseOver="hilite(21257)" onMouseOut="lolite()" onClick="logVariable('contactselecturl')" href="../_variables/contactselecturl.html">$contactselecturl</a>, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>);
<a name="l488"><span class="linenum"> 488</span></a>                  <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('li', <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('content')" href="../_variables/content.html">$content</a>);
<a name="l489"><span class="linenum"> 489</span></a>              }
<a name="l490"><span class="linenum"> 490</span></a>          }
<a name="l491"><span class="linenum"> 491</span></a>          if (<a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>) &gt; 0) {
<a name="l492"><span class="linenum"> 492</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('ul', <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>, array('id' =&gt; 'message-incommingcontacts', 'class' =&gt; 'message-contacts'));
<a name="l493"><span class="linenum"> 493</span></a>          }
<a name="l494"><span class="linenum"> 494</span></a>  
<a name="l495"><span class="linenum"> 495</span></a>      }
<a name="l496"><span class="linenum"> 496</span></a>  
<a name="l497"><span class="linenum"> 497</span></a>      if (<a class="var it21274" onMouseOver="hilite(21274)" onMouseOut="lolite()" onClick="logVariable('countstrangers')" href="../_variables/countstrangers.html">$countstrangers</a> &amp;&amp; (<a class="var it21272" onMouseOver="hilite(21272)" onMouseOut="lolite()" onClick="logVariable('countonlinecontacts')" href="../_variables/countonlinecontacts.html">$countonlinecontacts</a> + <a class="var it21273" onMouseOver="hilite(21273)" onMouseOut="lolite()" onClick="logVariable('countofflinecontacts')" href="../_variables/countofflinecontacts.html">$countofflinecontacts</a> == 0)) {  // Extra help
<a name="l498"><span class="linenum"> 498</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div','('.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('addsomecontactsincoming', 'message').')',array('class' =&gt; 'note'));
<a name="l499"><span class="linenum"> 499</span></a>      }
<a name="l500"><span class="linenum"> 500</span></a>  }
<a name="l501"><span class="linenum"> 501</span></a>  
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment">/**</span>
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment"> * Print a select box allowing the user to choose to view new messages, course participants etc.</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment"> *</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment"> * Called by message_print_contact_selector()</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment"> * @param int $viewing What page is the user viewing ie MESSAGE_VIEW_UNREAD_MESSAGES, MESSAGE_VIEW_RECENT_CONVERSATIONS etc</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment"> * @param array $courses array of course objects. The courses the user is enrolled in.</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment"> * @param array $coursecontexts array of course contexts. Keyed on course id.</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment"> * @param int $countunreadtotal how many unread messages does the user have?</span>
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment"> * @param int $countblocked how many users has the current user blocked?</span>
<a name="l511"><span class="linenum"> 511</span></a>  <span class="comment"> * @param stdClass $user1 The user whose messages we are viewing.</span>
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment"> * @param string $strunreadmessages a preconstructed message about the number of unread messages the user has</span>
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment"> * @return void</span>
<a name="l514"><span class="linenum"> 514</span></a>  <span class="comment"> */</span>
<a name="l515"><span class="linenum"> 515</span></a>  function <a class="function" onClick="logFunction('message_print_usergroup_selector')" href="../_functions/message_print_usergroup_selector.html" onMouseOver="funcPopup(event,'message_print_usergroup_selector')">message_print_usergroup_selector</a>(<a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a>, <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>, <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a>, <a class="var it1524" onMouseOver="hilite(1524)" onMouseOut="lolite()" onClick="logVariable('countunreadtotal')" href="../_variables/countunreadtotal.html">$countunreadtotal</a>, <a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('countblocked')" href="../_variables/countblocked.html">$countblocked</a>, <a class="var it21253" onMouseOver="hilite(21253)" onMouseOut="lolite()" onClick="logVariable('strunreadmessages')" href="../_variables/strunreadmessages.html">$strunreadmessages</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a> = null) {
<a name="l516"><span class="linenum"> 516</span></a>      global <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>;
<a name="l517"><span class="linenum"> 517</span></a>      <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a> = array();
<a name="l518"><span class="linenum"> 518</span></a>  
<a name="l519"><span class="linenum"> 519</span></a>      if (<a class="var it1524" onMouseOver="hilite(1524)" onMouseOut="lolite()" onClick="logVariable('countunreadtotal')" href="../_variables/countunreadtotal.html">$countunreadtotal</a>&gt;0) { //if there are unread messages
<a name="l520"><span class="linenum"> 520</span></a>          <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a>[<a class="constant" onClick="logConstant('MESSAGE_VIEW_UNREAD_MESSAGES')" href="../_constants/MESSAGE_VIEW_UNREAD_MESSAGES.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_UNREAD_MESSAGES')">MESSAGE_VIEW_UNREAD_MESSAGES</a>] = <a class="var it21253" onMouseOver="hilite(21253)" onMouseOut="lolite()" onClick="logVariable('strunreadmessages')" href="../_variables/strunreadmessages.html">$strunreadmessages</a>;
<a name="l521"><span class="linenum"> 521</span></a>      }
<a name="l522"><span class="linenum"> 522</span></a>  
<a name="l523"><span class="linenum"> 523</span></a>      <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('contacts', 'message');
<a name="l524"><span class="linenum"> 524</span></a>      <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a>[<a class="constant" onClick="logConstant('MESSAGE_VIEW_CONTACTS')" href="../_constants/MESSAGE_VIEW_CONTACTS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_CONTACTS')">MESSAGE_VIEW_CONTACTS</a>] = <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>;
<a name="l525"><span class="linenum"> 525</span></a>  
<a name="l526"><span class="linenum"> 526</span></a>      <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a>[<a class="constant" onClick="logConstant('MESSAGE_VIEW_RECENT_CONVERSATIONS')" href="../_constants/MESSAGE_VIEW_RECENT_CONVERSATIONS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_RECENT_CONVERSATIONS')">MESSAGE_VIEW_RECENT_CONVERSATIONS</a>] = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('mostrecentconversations', 'message');
<a name="l527"><span class="linenum"> 527</span></a>      <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a>[<a class="constant" onClick="logConstant('MESSAGE_VIEW_RECENT_NOTIFICATIONS')" href="../_constants/MESSAGE_VIEW_RECENT_NOTIFICATIONS.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_RECENT_NOTIFICATIONS')">MESSAGE_VIEW_RECENT_NOTIFICATIONS</a>] = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('mostrecentnotifications', 'message');
<a name="l528"><span class="linenum"> 528</span></a>  
<a name="l529"><span class="linenum"> 529</span></a>      if (!empty(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>)) {
<a name="l530"><span class="linenum"> 530</span></a>          <a class="var it21276" onMouseOver="hilite(21276)" onMouseOut="lolite()" onClick="logVariable('courses_options')" href="../_variables/courses_options.html">$courses_options</a> = array();
<a name="l531"><span class="linenum"> 531</span></a>  
<a name="l532"><span class="linenum"> 532</span></a>          foreach(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> as <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l533"><span class="linenum"> 533</span></a>              if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewparticipants', <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a>[<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment">                //Not using short_text() as we want the end of the course name. Not the beginning.</span>
<a name="l535"><span class="linenum"> 535</span></a>                  <a class="var it1256" onMouseOver="hilite(1256)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a> = <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a>[<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]));
<a name="l536"><span class="linenum"> 536</span></a>                  if (<a class="class" onClick="logClass('core_text')" href="../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it1256" onMouseOver="hilite(1256)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>) &gt; <a class="constant" onClick="logConstant('MESSAGE_MAX_COURSE_NAME_LENGTH')" href="../_constants/MESSAGE_MAX_COURSE_NAME_LENGTH.html" onMouseOver="constPopup(event,'MESSAGE_MAX_COURSE_NAME_LENGTH')">MESSAGE_MAX_COURSE_NAME_LENGTH</a>) {
<a name="l537"><span class="linenum"> 537</span></a>                      <a class="var it21276" onMouseOver="hilite(21276)" onMouseOut="lolite()" onClick="logVariable('courses_options')" href="../_variables/courses_options.html">$courses_options</a>[<a class="constant" onClick="logConstant('MESSAGE_VIEW_COURSE')" href="../_constants/MESSAGE_VIEW_COURSE.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_COURSE')">MESSAGE_VIEW_COURSE</a>.<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = '...'.<a class="class" onClick="logClass('core_text')" href="../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it1256" onMouseOver="hilite(1256)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>, -<a class="constant" onClick="logConstant('MESSAGE_MAX_COURSE_NAME_LENGTH')" href="../_constants/MESSAGE_MAX_COURSE_NAME_LENGTH.html" onMouseOver="constPopup(event,'MESSAGE_MAX_COURSE_NAME_LENGTH')">MESSAGE_MAX_COURSE_NAME_LENGTH</a>);
<a name="l538"><span class="linenum"> 538</span></a>                  } else {
<a name="l539"><span class="linenum"> 539</span></a>                      <a class="var it21276" onMouseOver="hilite(21276)" onMouseOut="lolite()" onClick="logVariable('courses_options')" href="../_variables/courses_options.html">$courses_options</a>[<a class="constant" onClick="logConstant('MESSAGE_VIEW_COURSE')" href="../_constants/MESSAGE_VIEW_COURSE.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_COURSE')">MESSAGE_VIEW_COURSE</a>.<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it1256" onMouseOver="hilite(1256)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>;
<a name="l540"><span class="linenum"> 540</span></a>                  }
<a name="l541"><span class="linenum"> 541</span></a>              }
<a name="l542"><span class="linenum"> 542</span></a>          }
<a name="l543"><span class="linenum"> 543</span></a>  
<a name="l544"><span class="linenum"> 544</span></a>          if (!empty(<a class="var it21276" onMouseOver="hilite(21276)" onMouseOut="lolite()" onClick="logVariable('courses_options')" href="../_variables/courses_options.html">$courses_options</a>)) {
<a name="l545"><span class="linenum"> 545</span></a>              <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a>[] = array(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('courses') =&gt; <a class="var it21276" onMouseOver="hilite(21276)" onMouseOut="lolite()" onClick="logVariable('courses_options')" href="../_variables/courses_options.html">$courses_options</a>);
<a name="l546"><span class="linenum"> 546</span></a>          }
<a name="l547"><span class="linenum"> 547</span></a>      }
<a name="l548"><span class="linenum"> 548</span></a>  
<a name="l549"><span class="linenum"> 549</span></a>      if (<a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('countblocked')" href="../_variables/countblocked.html">$countblocked</a>&gt;0) {
<a name="l550"><span class="linenum"> 550</span></a>          <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('blockedusers','message', <a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('countblocked')" href="../_variables/countblocked.html">$countblocked</a>);
<a name="l551"><span class="linenum"> 551</span></a>          <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a>[<a class="constant" onClick="logConstant('MESSAGE_VIEW_BLOCKED')" href="../_constants/MESSAGE_VIEW_BLOCKED.html" onMouseOver="constPopup(event,'MESSAGE_VIEW_BLOCKED')">MESSAGE_VIEW_BLOCKED</a>] = <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>;
<a name="l552"><span class="linenum"> 552</span></a>      }
<a name="l553"><span class="linenum"> 553</span></a>  
<a name="l554"><span class="linenum"> 554</span></a>      <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a> = <span class="keyword">new </span><a class="class" onClick="logClass('single_select')" href="../_classes/single_select.html" onMouseOver="classPopup(event,'single_select')">single_select</a>(<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a>, 'viewing', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a>, <a class="var it1500" onMouseOver="hilite(1500)" onMouseOut="lolite()" onClick="logVariable('viewing')" href="../_variables/viewing.html">$viewing</a>, false);
<a name="l555"><span class="linenum"> 555</span></a>      <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a>-&gt;<a class="function" onClick="logFunction('set_label')" href="../_functions/set_label.html" onMouseOver="funcPopup(event,'set_label')">set_label</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('messagenavigation', 'message'));
<a name="l556"><span class="linenum"> 556</span></a>  
<a name="l557"><span class="linenum"> 557</span></a>      <a class="var it1689" onMouseOver="hilite(1689)" onMouseOut="lolite()" onClick="logVariable('renderer')" href="../_variables/renderer.html">$renderer</a> = <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('get_renderer')" href="../_functions/get_renderer.html" onMouseOver="funcPopup(event,'get_renderer')">get_renderer</a>('core');
<a name="l558"><span class="linenum"> 558</span></a>      echo <a class="var it1689" onMouseOver="hilite(1689)" onMouseOut="lolite()" onClick="logVariable('renderer')" href="../_variables/renderer.html">$renderer</a>-&gt;<a class="function" onClick="logFunction('render')" href="../_functions/render.html" onMouseOver="funcPopup(event,'render')">render</a>(<a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a>);
<a name="l559"><span class="linenum"> 559</span></a>  }
<a name="l560"><span class="linenum"> 560</span></a>  
<a name="l561"><span class="linenum"> 561</span></a>  <span class="comment">/**</span>
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment"> * Load the course contexts for all of the users courses</span>
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment"> *</span>
<a name="l564"><span class="linenum"> 564</span></a>  <span class="comment"> * @param array $courses array of course objects. The courses the user is enrolled in.</span>
<a name="l565"><span class="linenum"> 565</span></a>  <span class="comment"> * @return array of course contexts</span>
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment"> */</span>
<a name="l567"><span class="linenum"> 567</span></a>  function <a class="function" onClick="logFunction('message_get_course_contexts')" href="../_functions/message_get_course_contexts.html" onMouseOver="funcPopup(event,'message_get_course_contexts')">message_get_course_contexts</a>(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>) {
<a name="l568"><span class="linenum"> 568</span></a>      <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a> = array();
<a name="l569"><span class="linenum"> 569</span></a>  
<a name="l570"><span class="linenum"> 570</span></a>      foreach(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> as <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l571"><span class="linenum"> 571</span></a>          <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a>[<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l572"><span class="linenum"> 572</span></a>      }
<a name="l573"><span class="linenum"> 573</span></a>  
<a name="l574"><span class="linenum"> 574</span></a>      return <a class="var it21252" onMouseOver="hilite(21252)" onMouseOut="lolite()" onClick="logVariable('coursecontexts')" href="../_variables/coursecontexts.html">$coursecontexts</a>;
<a name="l575"><span class="linenum"> 575</span></a>  }
<a name="l576"><span class="linenum"> 576</span></a>  
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment">/**</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment"> * strip off action parameters like 'removecontact'</span>
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment"> *</span>
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment"> * @param moodle_url/string $moodleurl a URL. Typically the current page URL.</span>
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment"> * @return string the URL minus parameters that perform actions (like adding/removing/blocking a contact).</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment"> */</span>
<a name="l583"><span class="linenum"> 583</span></a>  function <a class="function" onClick="logFunction('message_remove_url_params')" href="../_functions/message_remove_url_params.html" onMouseOver="funcPopup(event,'message_remove_url_params')">message_remove_url_params</a>(<a class="var it12695" onMouseOver="hilite(12695)" onMouseOut="lolite()" onClick="logVariable('moodleurl')" href="../_variables/moodleurl.html">$moodleurl</a>) {
<a name="l584"><span class="linenum"> 584</span></a>      <a class="var it21277" onMouseOver="hilite(21277)" onMouseOut="lolite()" onClick="logVariable('newurl')" href="../_variables/newurl.html">$newurl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it12695" onMouseOver="hilite(12695)" onMouseOut="lolite()" onClick="logVariable('moodleurl')" href="../_variables/moodleurl.html">$moodleurl</a>);
<a name="l585"><span class="linenum"> 585</span></a>      <a class="var it21277" onMouseOver="hilite(21277)" onMouseOut="lolite()" onClick="logVariable('newurl')" href="../_variables/newurl.html">$newurl</a>-&gt;<a class="function" onClick="logFunction('remove_params')" href="../_functions/remove_params.html" onMouseOver="funcPopup(event,'remove_params')">remove_params</a>('addcontact','removecontact','blockcontact','unblockcontact');
<a name="l586"><span class="linenum"> 586</span></a>      return <a class="var it21277" onMouseOver="hilite(21277)" onMouseOut="lolite()" onClick="logVariable('newurl')" href="../_variables/newurl.html">$newurl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>();
<a name="l587"><span class="linenum"> 587</span></a>  }
<a name="l588"><span class="linenum"> 588</span></a>  
<a name="l589"><span class="linenum"> 589</span></a>  <span class="comment">/**</span>
<a name="l590"><span class="linenum"> 590</span></a>  <span class="comment"> * Count the number of messages with a field having a specified value.</span>
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment"> * if $field is empty then return count of the whole array</span>
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment"> * if $field is non-existent then return 0</span>
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment"> *</span>
<a name="l594"><span class="linenum"> 594</span></a>  <span class="comment"> * @param array $messagearray array of message objects</span>
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment"> * @param string $field the field to inspect on the message objects</span>
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment"> * @param string $value the value to test the field against</span>
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment"> */</span>
<a name="l598"><span class="linenum"> 598</span></a>  function <a class="function" onClick="logFunction('message_count_messages')" href="../_functions/message_count_messages.html" onMouseOver="funcPopup(event,'message_count_messages')">message_count_messages</a>(<a class="var it21278" onMouseOver="hilite(21278)" onMouseOut="lolite()" onClick="logVariable('messagearray')" href="../_variables/messagearray.html">$messagearray</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>='', <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>='') {
<a name="l599"><span class="linenum"> 599</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it21278" onMouseOver="hilite(21278)" onMouseOut="lolite()" onClick="logVariable('messagearray')" href="../_variables/messagearray.html">$messagearray</a>)) return 0;
<a name="l600"><span class="linenum"> 600</span></a>      if (<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a> == '' or empty(<a class="var it21278" onMouseOver="hilite(21278)" onMouseOut="lolite()" onClick="logVariable('messagearray')" href="../_variables/messagearray.html">$messagearray</a>)) return <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it21278" onMouseOver="hilite(21278)" onMouseOut="lolite()" onClick="logVariable('messagearray')" href="../_variables/messagearray.html">$messagearray</a>);
<a name="l601"><span class="linenum"> 601</span></a>  
<a name="l602"><span class="linenum"> 602</span></a>      <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> = 0;
<a name="l603"><span class="linenum"> 603</span></a>      foreach (<a class="var it21278" onMouseOver="hilite(21278)" onMouseOut="lolite()" onClick="logVariable('messagearray')" href="../_variables/messagearray.html">$messagearray</a> as <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>) {
<a name="l604"><span class="linenum"> 604</span></a>          <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> += (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a> == <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>) ? 1 : 0;
<a name="l605"><span class="linenum"> 605</span></a>      }
<a name="l606"><span class="linenum"> 606</span></a>      return <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a>;
<a name="l607"><span class="linenum"> 607</span></a>  }
<a name="l608"><span class="linenum"> 608</span></a>  
<a name="l609"><span class="linenum"> 609</span></a>  <span class="comment">/**</span>
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment"> * Returns the count of unread messages for user. Either from a specific user or from all users.</span>
<a name="l611"><span class="linenum"> 611</span></a>  <span class="comment"> *</span>
<a name="l612"><span class="linenum"> 612</span></a>  <span class="comment"> * @param object $user1 the first user. Defaults to $USER</span>
<a name="l613"><span class="linenum"> 613</span></a>  <span class="comment"> * @param object $user2 the second user. If null this function will count all of user 1's unread messages.</span>
<a name="l614"><span class="linenum"> 614</span></a>  <span class="comment"> * @return int the count of $user1's unread messages</span>
<a name="l615"><span class="linenum"> 615</span></a>  <span class="comment"> */</span>
<a name="l616"><span class="linenum"> 616</span></a>  function <a class="function" onClick="logFunction('message_count_unread_messages')" href="../_functions/message_count_unread_messages.html" onMouseOver="funcPopup(event,'message_count_unread_messages')">message_count_unread_messages</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>=null, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>=null) {
<a name="l617"><span class="linenum"> 617</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l618"><span class="linenum"> 618</span></a>  
<a name="l619"><span class="linenum"> 619</span></a>      if (empty(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>)) {
<a name="l620"><span class="linenum"> 620</span></a>          <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l621"><span class="linenum"> 621</span></a>      }
<a name="l622"><span class="linenum"> 622</span></a>  
<a name="l623"><span class="linenum"> 623</span></a>      if (!empty(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>)) {
<a name="l624"><span class="linenum"> 624</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_select')" href="../_functions/count_records_select.html" onMouseOver="funcPopup(event,'count_records_select')">count_records_select</a>('message', &quot;useridto = ? AND useridfrom = ?&quot;,
<a name="l625"><span class="linenum"> 625</span></a>              array(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/id.html">id</a>), &quot;<a class="phpfunction" onClick="logFunction('COUNT')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>('id')&quot;);
<a name="l626"><span class="linenum"> 626</span></a>      } else {
<a name="l627"><span class="linenum"> 627</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_select')" href="../_functions/count_records_select.html" onMouseOver="funcPopup(event,'count_records_select')">count_records_select</a>('message', &quot;useridto = ?&quot;,
<a name="l628"><span class="linenum"> 628</span></a>              array(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>), &quot;<a class="phpfunction" onClick="logFunction('COUNT')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>('id')&quot;);
<a name="l629"><span class="linenum"> 629</span></a>      }
<a name="l630"><span class="linenum"> 630</span></a>  }
<a name="l631"><span class="linenum"> 631</span></a>  
<a name="l632"><span class="linenum"> 632</span></a>  <span class="comment">/**</span>
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment"> * Count the number of users blocked by $user1</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment"> *</span>
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment"> * @param object $user1 user object</span>
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment"> * @return int the number of blocked users</span>
<a name="l637"><span class="linenum"> 637</span></a>  <span class="comment"> */</span>
<a name="l638"><span class="linenum"> 638</span></a>  function <a class="function" onClick="logFunction('message_count_blocked_users')" href="../_functions/message_count_blocked_users.html" onMouseOver="funcPopup(event,'message_count_blocked_users')">message_count_blocked_users</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>=null) {
<a name="l639"><span class="linenum"> 639</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l640"><span class="linenum"> 640</span></a>  
<a name="l641"><span class="linenum"> 641</span></a>      if (empty(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>)) {
<a name="l642"><span class="linenum"> 642</span></a>          <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l643"><span class="linenum"> 643</span></a>      }
<a name="l644"><span class="linenum"> 644</span></a>  
<a name="l645"><span class="linenum"> 645</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(mc.id)
<a name="l646"><span class="linenum"> 646</span></a>              FROM {message_contacts} mc
<a name="l647"><span class="linenum"> 647</span></a>              WHERE mc.userid = :userid AND mc.blocked = 1&quot;;
<a name="l648"><span class="linenum"> 648</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('userid' =&gt; <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l649"><span class="linenum"> 649</span></a>  
<a name="l650"><span class="linenum"> 650</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l651"><span class="linenum"> 651</span></a>  }
<a name="l652"><span class="linenum"> 652</span></a>  
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment">/**</span>
<a name="l654"><span class="linenum"> 654</span></a>  <span class="comment"> * Print the search form and search results if a search has been performed</span>
<a name="l655"><span class="linenum"> 655</span></a>  <span class="comment"> *</span>
<a name="l656"><span class="linenum"> 656</span></a>  <span class="comment"> * @param  boolean $advancedsearch show basic or advanced search form</span>
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment"> * @param  object $user1 the current user</span>
<a name="l658"><span class="linenum"> 658</span></a>  <span class="comment"> * @return boolean true if a search was performed</span>
<a name="l659"><span class="linenum"> 659</span></a>  <span class="comment"> */</span>
<a name="l660"><span class="linenum"> 660</span></a>  function <a class="function" onClick="logFunction('message_print_search')" href="../_functions/message_print_search.html" onMouseOver="funcPopup(event,'message_print_search')">message_print_search</a>(<a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('advancedsearch')" href="../_variables/advancedsearch.html">$advancedsearch</a> = false, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>=null) {
<a name="l661"><span class="linenum"> 661</span></a>      <a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a> = <a class="function" onClick="logFunction('data_submitted')" href="../_functions/data_submitted.html" onMouseOver="funcPopup(event,'data_submitted')">data_submitted</a>();
<a name="l662"><span class="linenum"> 662</span></a>  
<a name="l663"><span class="linenum"> 663</span></a>      <a class="var it21279" onMouseOver="hilite(21279)" onMouseOut="lolite()" onClick="logVariable('doingsearch')" href="../_variables/doingsearch.html">$doingsearch</a> = false;
<a name="l664"><span class="linenum"> 664</span></a>      if (<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>) {
<a name="l665"><span class="linenum"> 665</span></a>          if (<a class="function" onClick="logFunction('confirm_sesskey')" href="../_functions/confirm_sesskey.html" onMouseOver="funcPopup(event,'confirm_sesskey')">confirm_sesskey</a>()) {
<a name="l666"><span class="linenum"> 666</span></a>              <a class="var it21279" onMouseOver="hilite(21279)" onMouseOut="lolite()" onClick="logVariable('doingsearch')" href="../_variables/doingsearch.html">$doingsearch</a> = !empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('combinedsubmit')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/combinedsubmit.html">combinedsubmit</a>) || !empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('keywords')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/keywords.html">keywords</a>) || (!empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('personsubmit')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/personsubmit.html">personsubmit</a>) and !empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('name')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/name.html">name</a>));
<a name="l667"><span class="linenum"> 667</span></a>          } else {
<a name="l668"><span class="linenum"> 668</span></a>              <a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a> = false;
<a name="l669"><span class="linenum"> 669</span></a>          }
<a name="l670"><span class="linenum"> 670</span></a>      }
<a name="l671"><span class="linenum"> 671</span></a>  
<a name="l672"><span class="linenum"> 672</span></a>      if (!empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('combinedsearch')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/combinedsearch.html">combinedsearch</a>)) {
<a name="l673"><span class="linenum"> 673</span></a>          <a class="var it21283" onMouseOver="hilite(21283)" onMouseOut="lolite()" onClick="logVariable('combinedsearchstring')" href="../_variables/combinedsearchstring.html">$combinedsearchstring</a> = <a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('combinedsearch')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/combinedsearch.html">combinedsearch</a>;
<a name="l674"><span class="linenum"> 674</span></a>      } else {
<a name="l675"><span class="linenum"> 675</span></a>  <span class="comment">        //$combinedsearchstring = get_string('searchcombined','message').'...';</span>
<a name="l676"><span class="linenum"> 676</span></a>          <a class="var it21283" onMouseOver="hilite(21283)" onMouseOut="lolite()" onClick="logVariable('combinedsearchstring')" href="../_variables/combinedsearchstring.html">$combinedsearchstring</a> = '';
<a name="l677"><span class="linenum"> 677</span></a>      }
<a name="l678"><span class="linenum"> 678</span></a>  
<a name="l679"><span class="linenum"> 679</span></a>      if (<a class="var it21279" onMouseOver="hilite(21279)" onMouseOut="lolite()" onClick="logVariable('doingsearch')" href="../_variables/doingsearch.html">$doingsearch</a>) {
<a name="l680"><span class="linenum"> 680</span></a>          if (<a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('advancedsearch')" href="../_variables/advancedsearch.html">$advancedsearch</a>) {
<a name="l681"><span class="linenum"> 681</span></a>  
<a name="l682"><span class="linenum"> 682</span></a>              <a class="var it11314" onMouseOver="hilite(11314)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../_variables/messagesearch.html">$messagesearch</a> = '';
<a name="l683"><span class="linenum"> 683</span></a>              if (!empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('keywords')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/keywords.html">keywords</a>)) {
<a name="l684"><span class="linenum"> 684</span></a>                  <a class="var it11314" onMouseOver="hilite(11314)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../_variables/messagesearch.html">$messagesearch</a> = <a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('keywords')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/keywords.html">keywords</a>;
<a name="l685"><span class="linenum"> 685</span></a>              }
<a name="l686"><span class="linenum"> 686</span></a>              <a class="var it11313" onMouseOver="hilite(11313)" onMouseOut="lolite()" onClick="logVariable('personsearch')" href="../_variables/personsearch.html">$personsearch</a> = '';
<a name="l687"><span class="linenum"> 687</span></a>              if (!empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('name')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/name.html">name</a>)) {
<a name="l688"><span class="linenum"> 688</span></a>                  <a class="var it11313" onMouseOver="hilite(11313)" onMouseOut="lolite()" onClick="logVariable('personsearch')" href="../_variables/personsearch.html">$personsearch</a> = <a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('name')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l689"><span class="linenum"> 689</span></a>              }
<a name="l690"><span class="linenum"> 690</span></a>              <span class="keyword">include</span> <a class="filename" href="../message/search_advanced.html.html" onMouseOver="reqPopup(event, 'search_advanced.html', '../message/search_advanced.html')">('search_advanced.html')</a>;
<a name="l691"><span class="linenum"> 691</span></a>          } else {
<a name="l692"><span class="linenum"> 692</span></a>              <span class="keyword">include</span> <a class="filename" href="../message/search.html.html" onMouseOver="reqPopup(event, 'search.html', '../message/search.html')">('search.html')</a>;
<a name="l693"><span class="linenum"> 693</span></a>          }
<a name="l694"><span class="linenum"> 694</span></a>  
<a name="l695"><span class="linenum"> 695</span></a>          <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a> = false;
<a name="l696"><span class="linenum"> 696</span></a>          <a class="function" onClick="logFunction('message_print_search_results')" href="../_functions/message_print_search_results.html" onMouseOver="funcPopup(event,'message_print_search_results')">message_print_search_results</a>(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>);
<a name="l697"><span class="linenum"> 697</span></a>  
<a name="l698"><span class="linenum"> 698</span></a>          return true;
<a name="l699"><span class="linenum"> 699</span></a>      } else {
<a name="l700"><span class="linenum"> 700</span></a>  
<a name="l701"><span class="linenum"> 701</span></a>          if (<a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('advancedsearch')" href="../_variables/advancedsearch.html">$advancedsearch</a>) {
<a name="l702"><span class="linenum"> 702</span></a>              <a class="var it11313" onMouseOver="hilite(11313)" onMouseOut="lolite()" onClick="logVariable('personsearch')" href="../_variables/personsearch.html">$personsearch</a> = <a class="var it11314" onMouseOver="hilite(11314)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../_variables/messagesearch.html">$messagesearch</a> = '';
<a name="l703"><span class="linenum"> 703</span></a>              <span class="keyword">include</span> <a class="filename" href="../message/search_advanced.html.html" onMouseOver="reqPopup(event, 'search_advanced.html', '../message/search_advanced.html')">('search_advanced.html')</a>;
<a name="l704"><span class="linenum"> 704</span></a>          } else {
<a name="l705"><span class="linenum"> 705</span></a>              <span class="keyword">include</span> <a class="filename" href="../message/search.html.html" onMouseOver="reqPopup(event, 'search.html', '../message/search.html')">('search.html')</a>;
<a name="l706"><span class="linenum"> 706</span></a>          }
<a name="l707"><span class="linenum"> 707</span></a>          return false;
<a name="l708"><span class="linenum"> 708</span></a>      }
<a name="l709"><span class="linenum"> 709</span></a>  }
<a name="l710"><span class="linenum"> 710</span></a>  
<a name="l711"><span class="linenum"> 711</span></a>  <span class="comment">/**</span>
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment"> * Get the users recent conversations meaning all the people they've recently</span>
<a name="l713"><span class="linenum"> 713</span></a>  <span class="comment"> * sent or received a message from plus the most recent message sent to or received from each other user</span>
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment"> *</span>
<a name="l715"><span class="linenum"> 715</span></a>  <span class="comment"> * @param object $user the current user</span>
<a name="l716"><span class="linenum"> 716</span></a>  <span class="comment"> * @param int $limitfrom can be used for paging</span>
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment"> * @param int $limitto can be used for paging</span>
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment"> * @return array</span>
<a name="l719"><span class="linenum"> 719</span></a>  <span class="comment"> */</span>
<a name="l720"><span class="linenum"> 720</span></a>  function <a class="function" onClick="logFunction('message_get_recent_conversations')" href="../_functions/message_get_recent_conversations.html" onMouseOver="funcPopup(event,'message_get_recent_conversations')">message_get_recent_conversations</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>=0, <a class="var it7831" onMouseOver="hilite(7831)" onMouseOut="lolite()" onClick="logVariable('limitto')" href="../_variables/limitto.html">$limitto</a>=100) {
<a name="l721"><span class="linenum"> 721</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l722"><span class="linenum"> 722</span></a>  
<a name="l723"><span class="linenum"> 723</span></a>      <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> = <a class="class" onClick="logClass('user_picture')" href="../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('otheruser', array('lastaccess'));
<a name="l724"><span class="linenum"> 724</span></a>  
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment">    // This query retrieves the most recent message received from or sent to</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment">    // seach other user.</span>
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment">    //</span>
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment">    // If two messages have the same timecreated, we take the one with the</span>
<a name="l729"><span class="linenum"> 729</span></a>  <span class="comment">    // larger id.</span>
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment">    //</span>
<a name="l731"><span class="linenum"> 731</span></a>  <span class="comment">    // There is a separate query for read and unread messages as they are stored</span>
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment">    // in different tables. They were originally retrieved in one query but it</span>
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment">    // was so large that it was difficult to be confident in its correctness.</span>
<a name="l734"><span class="linenum"> 734</span></a>      <a class="var it21285" onMouseOver="hilite(21285)" onMouseOut="lolite()" onClick="logVariable('uniquefield')" href="../_variables/uniquefield.html">$uniquefield</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('message.useridfrom', &quot;'-'&quot;, 'message.useridto');
<a name="l735"><span class="linenum"> 735</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it21285" onMouseOver="hilite(21285)" onMouseOut="lolite()" onClick="logVariable('uniquefield')" href="../_variables/uniquefield.html">$uniquefield</a>, <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>,
<a name="l736"><span class="linenum"> 736</span></a>                     message.id as mid, message.notification, message.smallmessage, message.fullmessage,
<a name="l737"><span class="linenum"> 737</span></a>                     message.fullmessagehtml, message.fullmessageformat, message.timecreated,
<a name="l738"><span class="linenum"> 738</span></a>                     contact.id as contactlistid, contact.blocked
<a name="l739"><span class="linenum"> 739</span></a>                FROM {message_read} message
<a name="l740"><span class="linenum"> 740</span></a>                <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (
<a name="l741"><span class="linenum"> 741</span></a>                          SELECT <a class="phpfunction" onClick="logFunction('MAX')" href="../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(id) AS messageid,
<a name="l742"><span class="linenum"> 742</span></a>                                 matchedmessage.useridto,
<a name="l743"><span class="linenum"> 743</span></a>                                 matchedmessage.useridfrom
<a name="l744"><span class="linenum"> 744</span></a>                           FROM {message_read} matchedmessage
<a name="l745"><span class="linenum"> 745</span></a>                     INNER <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (
<a name="l746"><span class="linenum"> 746</span></a>                                 SELECT <a class="phpfunction" onClick="logFunction('MAX')" href="../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(recentmessages.timecreated) timecreated,
<a name="l747"><span class="linenum"> 747</span></a>                                        recentmessages.useridfrom,
<a name="l748"><span class="linenum"> 748</span></a>                                        recentmessages.useridto
<a name="l749"><span class="linenum"> 749</span></a>                                   FROM {message_read} recentmessages
<a name="l750"><span class="linenum"> 750</span></a>                                  <a class="function" onClick="logFunction('WHERE')" href="../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (recentmessages.useridfrom = :userid1 OR recentmessages.useridto = :userid2)
<a name="l751"><span class="linenum"> 751</span></a>                               GROUP BY recentmessages.useridfrom, recentmessages.useridto
<a name="l752"><span class="linenum"> 752</span></a>                                ) recent ON matchedmessage.useridto     = recent.useridto
<a name="l753"><span class="linenum"> 753</span></a>                             AND matchedmessage.useridfrom   = recent.useridfrom
<a name="l754"><span class="linenum"> 754</span></a>                             AND matchedmessage.timecreated  = recent.timecreated
<a name="l755"><span class="linenum"> 755</span></a>                        GROUP BY matchedmessage.useridto, matchedmessage.useridfrom
<a name="l756"><span class="linenum"> 756</span></a>                     ) messagesubset ON messagesubset.messageid = message.id
<a name="l757"><span class="linenum"> 757</span></a>                JOIN {user} otheruser <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (message.useridfrom = :userid4 AND message.useridto = otheruser.id)
<a name="l758"><span class="linenum"> 758</span></a>                  <a class="function" onClick="logFunction('OR')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (message.useridto   = :userid5 AND message.useridfrom   = otheruser.id)
<a name="l759"><span class="linenum"> 759</span></a>           LEFT JOIN {message_contacts} contact ON contact.userid  = :userid3 AND contact.userid = otheruser.id
<a name="l760"><span class="linenum"> 760</span></a>               WHERE otheruser.deleted = 0 AND message.notification = 0
<a name="l761"><span class="linenum"> 761</span></a>            ORDER BY message.timecreated DESC&quot;;
<a name="l762"><span class="linenum"> 762</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(
<a name="l763"><span class="linenum"> 763</span></a>              'userid1' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l764"><span class="linenum"> 764</span></a>              'userid2' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l765"><span class="linenum"> 765</span></a>              'userid3' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l766"><span class="linenum"> 766</span></a>              'userid4' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l767"><span class="linenum"> 767</span></a>              'userid5' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l768"><span class="linenum"> 768</span></a>          );
<a name="l769"><span class="linenum"> 769</span></a>      <a class="var it3118" onMouseOver="hilite(3118)" onMouseOut="lolite()" onClick="logVariable('read')" href="../_variables/read.html">$read</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>, <a class="var it7831" onMouseOver="hilite(7831)" onMouseOut="lolite()" onClick="logVariable('limitto')" href="../_variables/limitto.html">$limitto</a>);
<a name="l770"><span class="linenum"> 770</span></a>  
<a name="l771"><span class="linenum"> 771</span></a>  <span class="comment">    // We want to get the messages that have not been read. These are stored in the 'message' table. It is the</span>
<a name="l772"><span class="linenum"> 772</span></a>  <span class="comment">    // exact same query as the one above, except for the table we are querying. So, simply replace references to</span>
<a name="l773"><span class="linenum"> 773</span></a>  <span class="comment">    // the 'message_read' table with the 'message' table.</span>
<a name="l774"><span class="linenum"> 774</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('{message_read}', '{message}', <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l775"><span class="linenum"> 775</span></a>      <a class="var it21286" onMouseOver="hilite(21286)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../_variables/unread.html">$unread</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>, <a class="var it7831" onMouseOver="hilite(7831)" onMouseOut="lolite()" onClick="logVariable('limitto')" href="../_variables/limitto.html">$limitto</a>);
<a name="l776"><span class="linenum"> 776</span></a>  
<a name="l777"><span class="linenum"> 777</span></a>  <span class="comment">    // Union the 2 result sets together looking for the message with the most</span>
<a name="l778"><span class="linenum"> 778</span></a>  <span class="comment">    // recent timecreated for each other user.</span>
<a name="l779"><span class="linenum"> 779</span></a>  <span class="comment">    // $conversation-&gt;id (the array key) is the other user's ID.</span>
<a name="l780"><span class="linenum"> 780</span></a>      <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a> = array();
<a name="l781"><span class="linenum"> 781</span></a>      <a class="var it21287" onMouseOver="hilite(21287)" onMouseOut="lolite()" onClick="logVariable('conversation_arrays')" href="../_variables/conversation_arrays.html">$conversation_arrays</a> = array(<a class="var it21286" onMouseOver="hilite(21286)" onMouseOut="lolite()" onClick="logVariable('unread')" href="../_variables/unread.html">$unread</a>, <a class="var it3118" onMouseOver="hilite(3118)" onMouseOut="lolite()" onClick="logVariable('read')" href="../_variables/read.html">$read</a>);
<a name="l782"><span class="linenum"> 782</span></a>      foreach (<a class="var it21287" onMouseOver="hilite(21287)" onMouseOut="lolite()" onClick="logVariable('conversation_arrays')" href="../_variables/conversation_arrays.html">$conversation_arrays</a> as <a class="var it21288" onMouseOver="hilite(21288)" onMouseOut="lolite()" onClick="logVariable('conversation_array')" href="../_variables/conversation_array.html">$conversation_array</a>) {
<a name="l783"><span class="linenum"> 783</span></a>          foreach (<a class="var it21288" onMouseOver="hilite(21288)" onMouseOut="lolite()" onClick="logVariable('conversation_array')" href="../_variables/conversation_array.html">$conversation_array</a> as <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>) {
<a name="l784"><span class="linenum"> 784</span></a>              if (!isset(<a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a>[<a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('id')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l785"><span class="linenum"> 785</span></a>                  <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a>[<a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('id')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>;
<a name="l786"><span class="linenum"> 786</span></a>              } else {
<a name="l787"><span class="linenum"> 787</span></a>                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a> = <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a>[<a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('id')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/id.html">id</a>];
<a name="l788"><span class="linenum"> 788</span></a>                  if (<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> &lt; <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('timecreated')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>) {
<a name="l789"><span class="linenum"> 789</span></a>                      <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a>[<a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('id')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>;
<a name="l790"><span class="linenum"> 790</span></a>                  } else if (<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> == <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('timecreated')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>) {
<a name="l791"><span class="linenum"> 791</span></a>                      if (<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('mid')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/mid.html">mid</a> &lt; <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('mid')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/mid.html">mid</a>) {
<a name="l792"><span class="linenum"> 792</span></a>                          <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a>[<a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('id')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>;
<a name="l793"><span class="linenum"> 793</span></a>                      }
<a name="l794"><span class="linenum"> 794</span></a>                  }
<a name="l795"><span class="linenum"> 795</span></a>              }
<a name="l796"><span class="linenum"> 796</span></a>          }
<a name="l797"><span class="linenum"> 797</span></a>      }
<a name="l798"><span class="linenum"> 798</span></a>  
<a name="l799"><span class="linenum"> 799</span></a>  <span class="comment">    // Sort the conversations by $conversation-&gt;timecreated, newest to oldest</span>
<a name="l800"><span class="linenum"> 800</span></a>  <span class="comment">    // There may be multiple conversations with the same timecreated</span>
<a name="l801"><span class="linenum"> 801</span></a>  <span class="comment">    // The conversations array contains both read and unread messages (different tables) so sorting by ID won't work</span>
<a name="l802"><span class="linenum"> 802</span></a>      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="class" onClick="logClass('core_collator')" href="../_classes/core_collator.html" onMouseOver="classPopup(event,'core_collator')">core_collator</a>::<a class="function" onClick="logFunction('asort_objects_by_property')" href="../_functions/asort_objects_by_property.html" onMouseOver="funcPopup(event,'asort_objects_by_property')">asort_objects_by_property</a>(<a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a>, 'timecreated', <a class="class" onClick="logClass('core_collator')" href="../_classes/core_collator.html" onMouseOver="classPopup(event,'core_collator')">core_collator</a>::SORT_NUMERIC);
<a name="l803"><span class="linenum"> 803</span></a>      <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a> = <a class="phpfunction" onClick="logFunction('array_reverse')" href="../_functions/array_reverse.html" onMouseOver="phpfuncPopup(event,'array_reverse')">array_reverse</a>(<a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a>);
<a name="l804"><span class="linenum"> 804</span></a>  
<a name="l805"><span class="linenum"> 805</span></a>      return <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a>;
<a name="l806"><span class="linenum"> 806</span></a>  }
<a name="l807"><span class="linenum"> 807</span></a>  
<a name="l808"><span class="linenum"> 808</span></a>  <span class="comment">/**</span>
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment"> * Get the users recent event notifications</span>
<a name="l810"><span class="linenum"> 810</span></a>  <span class="comment"> *</span>
<a name="l811"><span class="linenum"> 811</span></a>  <span class="comment"> * @param object $user the current user</span>
<a name="l812"><span class="linenum"> 812</span></a>  <span class="comment"> * @param int $limitfrom can be used for paging</span>
<a name="l813"><span class="linenum"> 813</span></a>  <span class="comment"> * @param int $limitto can be used for paging</span>
<a name="l814"><span class="linenum"> 814</span></a>  <span class="comment"> * @return array</span>
<a name="l815"><span class="linenum"> 815</span></a>  <span class="comment"> */</span>
<a name="l816"><span class="linenum"> 816</span></a>  function <a class="function" onClick="logFunction('message_get_recent_notifications')" href="../_functions/message_get_recent_notifications.html" onMouseOver="funcPopup(event,'message_get_recent_notifications')">message_get_recent_notifications</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>=0, <a class="var it7831" onMouseOver="hilite(7831)" onMouseOut="lolite()" onClick="logVariable('limitto')" href="../_variables/limitto.html">$limitto</a>=100) {
<a name="l817"><span class="linenum"> 817</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l818"><span class="linenum"> 818</span></a>  
<a name="l819"><span class="linenum"> 819</span></a>      <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> = <a class="class" onClick="logClass('user_picture')" href="../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('u', array('lastaccess'));
<a name="l820"><span class="linenum"> 820</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT mr.id AS message_read_id, <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>, mr.notification, mr.smallmessage, mr.fullmessage, mr.fullmessagehtml, mr.fullmessageformat, mr.timecreated as timecreated, mr.contexturl, mr.contexturlname
<a name="l821"><span class="linenum"> 821</span></a>                FROM {message_read} mr
<a name="l822"><span class="linenum"> 822</span></a>                     JOIN {user} u ON u.id=mr.useridfrom
<a name="l823"><span class="linenum"> 823</span></a>               WHERE mr.useridto = :userid1 AND u.deleted = '0' AND mr.notification = :notification
<a name="l824"><span class="linenum"> 824</span></a>               ORDER BY mr.timecreated DESC&quot;;
<a name="l825"><span class="linenum"> 825</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('userid1' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'notification' =&gt; 1);
<a name="l826"><span class="linenum"> 826</span></a>  
<a name="l827"><span class="linenum"> 827</span></a>      <a class="var it1836" onMouseOver="hilite(1836)" onMouseOut="lolite()" onClick="logVariable('notifications')" href="../_variables/notifications.html">$notifications</a> =  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>, <a class="var it7831" onMouseOver="hilite(7831)" onMouseOut="lolite()" onClick="logVariable('limitto')" href="../_variables/limitto.html">$limitto</a>);
<a name="l828"><span class="linenum"> 828</span></a>      return <a class="var it1836" onMouseOver="hilite(1836)" onMouseOut="lolite()" onClick="logVariable('notifications')" href="../_variables/notifications.html">$notifications</a>;
<a name="l829"><span class="linenum"> 829</span></a>  }
<a name="l830"><span class="linenum"> 830</span></a>  
<a name="l831"><span class="linenum"> 831</span></a>  <span class="comment">/**</span>
<a name="l832"><span class="linenum"> 832</span></a>  <span class="comment"> * Print the user's recent conversations</span>
<a name="l833"><span class="linenum"> 833</span></a>  <span class="comment"> *</span>
<a name="l834"><span class="linenum"> 834</span></a>  <span class="comment"> * @param stdClass $user the current user</span>
<a name="l835"><span class="linenum"> 835</span></a>  <span class="comment"> * @param bool $showicontext flag indicating whether or not to show text next to the action icons</span>
<a name="l836"><span class="linenum"> 836</span></a>  <span class="comment"> */</span>
<a name="l837"><span class="linenum"> 837</span></a>  function <a class="function" onClick="logFunction('message_print_recent_conversations')" href="../_functions/message_print_recent_conversations.html" onMouseOver="funcPopup(event,'message_print_recent_conversations')">message_print_recent_conversations</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a> = null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a> = false, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a> = true) {
<a name="l838"><span class="linenum"> 838</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l839"><span class="linenum"> 839</span></a>  
<a name="l840"><span class="linenum"> 840</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('p', array('class' =&gt; 'heading'));
<a name="l841"><span class="linenum"> 841</span></a>      echo <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('mostrecentconversations', 'message');
<a name="l842"><span class="linenum"> 842</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('p');
<a name="l843"><span class="linenum"> 843</span></a>  
<a name="l844"><span class="linenum"> 844</span></a>      if (empty(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>)) {
<a name="l845"><span class="linenum"> 845</span></a>          <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l846"><span class="linenum"> 846</span></a>      }
<a name="l847"><span class="linenum"> 847</span></a>  
<a name="l848"><span class="linenum"> 848</span></a>      <a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a> = <a class="function" onClick="logFunction('message_get_recent_conversations')" href="../_functions/message_get_recent_conversations.html" onMouseOver="funcPopup(event,'message_get_recent_conversations')">message_get_recent_conversations</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>);
<a name="l849"><span class="linenum"> 849</span></a>  
<a name="l850"><span class="linenum"> 850</span></a>  <span class="comment">    // Attach context url information to create the &quot;View this conversation&quot; type links</span>
<a name="l851"><span class="linenum"> 851</span></a>      foreach(<a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a> as <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>) {
<a name="l852"><span class="linenum"> 852</span></a>          <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('contexturl')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/contexturl.html">contexturl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(&quot;/message/index.php?user1={<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>}&amp;user2={<a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('id')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/id.html">id</a>}&quot;);
<a name="l853"><span class="linenum"> 853</span></a>          <a class="var it9824" onMouseOver="hilite(9824)" onMouseOut="lolite()" onClick="logVariable('conversation')" href="../_variables/conversation.html">$conversation</a>-&gt;<a onClick="logVariable('contexturlname')" class="var it40915" onMouseOver="hilite(40915)" onMouseOut="lolite()" href="../_variables/contexturlname.html">contexturlname</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('thisconversation', 'message');
<a name="l854"><span class="linenum"> 854</span></a>      }
<a name="l855"><span class="linenum"> 855</span></a>  
<a name="l856"><span class="linenum"> 856</span></a>      <a class="var it21289" onMouseOver="hilite(21289)" onMouseOut="lolite()" onClick="logVariable('showotheruser')" href="../_variables/showotheruser.html">$showotheruser</a> = true;
<a name="l857"><span class="linenum"> 857</span></a>      <a class="function" onClick="logFunction('message_print_recent_messages_table')" href="../_functions/message_print_recent_messages_table.html" onMouseOver="funcPopup(event,'message_print_recent_messages_table')">message_print_recent_messages_table</a>(<a class="var it9821" onMouseOver="hilite(9821)" onMouseOut="lolite()" onClick="logVariable('conversations')" href="../_variables/conversations.html">$conversations</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>, <a class="var it21289" onMouseOver="hilite(21289)" onMouseOut="lolite()" onClick="logVariable('showotheruser')" href="../_variables/showotheruser.html">$showotheruser</a>, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>, false, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>);
<a name="l858"><span class="linenum"> 858</span></a>  }
<a name="l859"><span class="linenum"> 859</span></a>  
<a name="l860"><span class="linenum"> 860</span></a>  <span class="comment">/**</span>
<a name="l861"><span class="linenum"> 861</span></a>  <span class="comment"> * Print the user's recent notifications</span>
<a name="l862"><span class="linenum"> 862</span></a>  <span class="comment"> *</span>
<a name="l863"><span class="linenum"> 863</span></a>  <span class="comment"> * @param stdClass $user the current user</span>
<a name="l864"><span class="linenum"> 864</span></a>  <span class="comment"> */</span>
<a name="l865"><span class="linenum"> 865</span></a>  function <a class="function" onClick="logFunction('message_print_recent_notifications')" href="../_functions/message_print_recent_notifications.html" onMouseOver="funcPopup(event,'message_print_recent_notifications')">message_print_recent_notifications</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>=null) {
<a name="l866"><span class="linenum"> 866</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l867"><span class="linenum"> 867</span></a>  
<a name="l868"><span class="linenum"> 868</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('p', array('class' =&gt; 'heading'));
<a name="l869"><span class="linenum"> 869</span></a>      echo <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('mostrecentnotifications', 'message');
<a name="l870"><span class="linenum"> 870</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('p');
<a name="l871"><span class="linenum"> 871</span></a>  
<a name="l872"><span class="linenum"> 872</span></a>      if (empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l873"><span class="linenum"> 873</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l874"><span class="linenum"> 874</span></a>      }
<a name="l875"><span class="linenum"> 875</span></a>  
<a name="l876"><span class="linenum"> 876</span></a>      <a class="var it1836" onMouseOver="hilite(1836)" onMouseOut="lolite()" onClick="logVariable('notifications')" href="../_variables/notifications.html">$notifications</a> = <a class="function" onClick="logFunction('message_get_recent_notifications')" href="../_functions/message_get_recent_notifications.html" onMouseOver="funcPopup(event,'message_get_recent_notifications')">message_get_recent_notifications</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l877"><span class="linenum"> 877</span></a>  
<a name="l878"><span class="linenum"> 878</span></a>      <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a> = false;
<a name="l879"><span class="linenum"> 879</span></a>      <a class="var it21289" onMouseOver="hilite(21289)" onMouseOut="lolite()" onClick="logVariable('showotheruser')" href="../_variables/showotheruser.html">$showotheruser</a> = false;
<a name="l880"><span class="linenum"> 880</span></a>      <a class="function" onClick="logFunction('message_print_recent_messages_table')" href="../_functions/message_print_recent_messages_table.html" onMouseOver="funcPopup(event,'message_print_recent_messages_table')">message_print_recent_messages_table</a>(<a class="var it1836" onMouseOver="hilite(1836)" onMouseOut="lolite()" onClick="logVariable('notifications')" href="../_variables/notifications.html">$notifications</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it21289" onMouseOver="hilite(21289)" onMouseOut="lolite()" onClick="logVariable('showotheruser')" href="../_variables/showotheruser.html">$showotheruser</a>, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>, true);
<a name="l881"><span class="linenum"> 881</span></a>  }
<a name="l882"><span class="linenum"> 882</span></a>  
<a name="l883"><span class="linenum"> 883</span></a>  <span class="comment">/**</span>
<a name="l884"><span class="linenum"> 884</span></a>  <span class="comment"> * Print a list of recent messages</span>
<a name="l885"><span class="linenum"> 885</span></a>  <span class="comment"> *</span>
<a name="l886"><span class="linenum"> 886</span></a>  <span class="comment"> * @access private</span>
<a name="l887"><span class="linenum"> 887</span></a>  <span class="comment"> *</span>
<a name="l888"><span class="linenum"> 888</span></a>  <span class="comment"> * @param array $messages the messages to display</span>
<a name="l889"><span class="linenum"> 889</span></a>  <span class="comment"> * @param stdClass $user the current user</span>
<a name="l890"><span class="linenum"> 890</span></a>  <span class="comment"> * @param bool $showotheruser display information on the other user?</span>
<a name="l891"><span class="linenum"> 891</span></a>  <span class="comment"> * @param bool $showicontext show text next to the action icons?</span>
<a name="l892"><span class="linenum"> 892</span></a>  <span class="comment"> * @param bool $forcetexttohtml Force text to go through @see text_to_html() via @see format_text()</span>
<a name="l893"><span class="linenum"> 893</span></a>  <span class="comment"> * @param bool $showactionlinks</span>
<a name="l894"><span class="linenum"> 894</span></a>  <span class="comment"> * @return void</span>
<a name="l895"><span class="linenum"> 895</span></a>  <span class="comment"> */</span>
<a name="l896"><span class="linenum"> 896</span></a>  function <a class="function" onClick="logFunction('message_print_recent_messages_table')" href="../_functions/message_print_recent_messages_table.html" onMouseOver="funcPopup(event,'message_print_recent_messages_table')">message_print_recent_messages_table</a>(<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null, <a class="var it21289" onMouseOver="hilite(21289)" onMouseOut="lolite()" onClick="logVariable('showotheruser')" href="../_variables/showotheruser.html">$showotheruser</a> = true, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a> = false, <a class="var it21290" onMouseOver="hilite(21290)" onMouseOut="lolite()" onClick="logVariable('forcetexttohtml')" href="../_variables/forcetexttohtml.html">$forcetexttohtml</a> = false, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a> = true) {
<a name="l897"><span class="linenum"> 897</span></a>      global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l898"><span class="linenum"> 898</span></a>      static <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a>;
<a name="l899"><span class="linenum"> 899</span></a>  
<a name="l900"><span class="linenum"> 900</span></a>      if (empty(<a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a>)) {
<a name="l901"><span class="linenum"> 901</span></a>          <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimedatetimeshort');
<a name="l902"><span class="linenum"> 902</span></a>      }
<a name="l903"><span class="linenum"> 903</span></a>  
<a name="l904"><span class="linenum"> 904</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class' =&gt; 'messagerecent'));
<a name="l905"><span class="linenum"> 905</span></a>      foreach (<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> as <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>) {
<a name="l906"><span class="linenum"> 906</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class' =&gt; 'singlemessage'));
<a name="l907"><span class="linenum"> 907</span></a>  
<a name="l908"><span class="linenum"> 908</span></a>          if (<a class="var it21289" onMouseOver="hilite(21289)" onMouseOut="lolite()" onClick="logVariable('showotheruser')" href="../_variables/showotheruser.html">$showotheruser</a>) {
<a name="l909"><span class="linenum"> 909</span></a>              <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a> = <a class="var it21293" onMouseOver="hilite(21293)" onMouseOut="lolite()" onClick="logVariable('strhistory')" href="../_variables/strhistory.html">$strhistory</a> = null;
<a name="l910"><span class="linenum"> 910</span></a>  
<a name="l911"><span class="linenum"> 911</span></a>              if (<a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>) {
<a name="l912"><span class="linenum"> 912</span></a>                  if ( <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contactlistid')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/contactlistid.html">contactlistid</a> )  {
<a name="l913"><span class="linenum"> 913</span></a>                      if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('blocked')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/blocked.html">blocked</a> == 0) { // The other user isn't blocked.
<a name="l914"><span class="linenum"> 914</span></a>                          <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'remove', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l915"><span class="linenum"> 915</span></a>                          <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'block', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l916"><span class="linenum"> 916</span></a>                      } else { // The other user is blocked.
<a name="l917"><span class="linenum"> 917</span></a>                          <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'add', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l918"><span class="linenum"> 918</span></a>                          <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'unblock', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l919"><span class="linenum"> 919</span></a>                      }
<a name="l920"><span class="linenum"> 920</span></a>                  } else {
<a name="l921"><span class="linenum"> 921</span></a>                      <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'add', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l922"><span class="linenum"> 922</span></a>                      <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'block', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l923"><span class="linenum"> 923</span></a>                  }
<a name="l924"><span class="linenum"> 924</span></a>  
<a name="l925"><span class="linenum"> 925</span></a>  <span class="comment">                //should we show just the icon or icon and text?</span>
<a name="l926"><span class="linenum"> 926</span></a>                  <a class="var it21294" onMouseOver="hilite(21294)" onMouseOut="lolite()" onClick="logVariable('histicontext')" href="../_variables/histicontext.html">$histicontext</a> = 'icon';
<a name="l927"><span class="linenum"> 927</span></a>                  if (<a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>) {
<a name="l928"><span class="linenum"> 928</span></a>                      <a class="var it21294" onMouseOver="hilite(21294)" onMouseOut="lolite()" onClick="logVariable('histicontext')" href="../_variables/histicontext.html">$histicontext</a> = 'both';
<a name="l929"><span class="linenum"> 929</span></a>                  }
<a name="l930"><span class="linenum"> 930</span></a>                  <a class="var it21293" onMouseOver="hilite(21293)" onMouseOut="lolite()" onClick="logVariable('strhistory')" href="../_variables/strhistory.html">$strhistory</a> = <a class="function" onClick="logFunction('message_history_link')" href="../_functions/message_history_link.html" onMouseOver="funcPopup(event,'message_history_link')">message_history_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true, '', '', <a class="var it21294" onMouseOver="hilite(21294)" onMouseOut="lolite()" onClick="logVariable('histicontext')" href="../_variables/histicontext.html">$histicontext</a>);
<a name="l931"><span class="linenum"> 931</span></a>              }
<a name="l932"><span class="linenum"> 932</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('span', array('class' =&gt; 'otheruser'));
<a name="l933"><span class="linenum"> 933</span></a>  
<a name="l934"><span class="linenum"> 934</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('span', array('class' =&gt; 'pix'));
<a name="l935"><span class="linenum"> 935</span></a>              echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, array('size' =&gt; 20, 'courseid' =&gt; <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>));
<a name="l936"><span class="linenum"> 936</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('span');
<a name="l937"><span class="linenum"> 937</span></a>  
<a name="l938"><span class="linenum"> 938</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('span', array('class' =&gt; 'contact'));
<a name="l939"><span class="linenum"> 939</span></a>  
<a name="l940"><span class="linenum"> 940</span></a>              <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(&quot;/message/index.php?user1={<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>}&amp;user2=<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>&quot;);
<a name="l941"><span class="linenum"> 941</span></a>              <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> = null;
<a name="l942"><span class="linenum"> 942</span></a>              echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('action_link')" href="../_functions/action_link.html" onMouseOver="funcPopup(event,'action_link')">action_link</a>(<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a>, <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>), <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a>, array('title' =&gt; <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('sendmessageto', 'message', <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>))));
<a name="l943"><span class="linenum"> 943</span></a>  
<a name="l944"><span class="linenum"> 944</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('span');<span class="comment">//end contact</span>
<a name="l945"><span class="linenum"> 945</span></a>  
<a name="l946"><span class="linenum"> 946</span></a>              if (<a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>) {
<a name="l947"><span class="linenum"> 947</span></a>                  echo <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a>.<a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>.<a class="var it21293" onMouseOver="hilite(21293)" onMouseOut="lolite()" onClick="logVariable('strhistory')" href="../_variables/strhistory.html">$strhistory</a>;
<a name="l948"><span class="linenum"> 948</span></a>              }
<a name="l949"><span class="linenum"> 949</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('span');<span class="comment">//end otheruser</span>
<a name="l950"><span class="linenum"> 950</span></a>          }
<a name="l951"><span class="linenum"> 951</span></a>  
<a name="l952"><span class="linenum"> 952</span></a>          <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> = <a class="function" onClick="logFunction('message_format_message_text')" href="../_functions/message_format_message_text.html" onMouseOver="funcPopup(event,'message_format_message_text')">message_format_message_text</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it21290" onMouseOver="hilite(21290)" onMouseOut="lolite()" onClick="logVariable('forcetexttohtml')" href="../_variables/forcetexttohtml.html">$forcetexttohtml</a>);
<a name="l953"><span class="linenum"> 953</span></a>  
<a name="l954"><span class="linenum"> 954</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('span', <a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>, <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a>), array('class' =&gt; 'messagedate'));
<a name="l955"><span class="linenum"> 955</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('span', <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a>, array('class' =&gt; 'themessage'));
<a name="l956"><span class="linenum"> 956</span></a>          echo <a class="function" onClick="logFunction('message_format_contexturl')" href="../_functions/message_format_contexturl.html" onMouseOver="funcPopup(event,'message_format_contexturl')">message_format_contexturl</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>);
<a name="l957"><span class="linenum"> 957</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');<span class="comment">//end singlemessage</span>
<a name="l958"><span class="linenum"> 958</span></a>      }
<a name="l959"><span class="linenum"> 959</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');<span class="comment">//end messagerecent</span>
<a name="l960"><span class="linenum"> 960</span></a>  }
<a name="l961"><span class="linenum"> 961</span></a>  
<a name="l962"><span class="linenum"> 962</span></a>  <span class="comment">/**</span>
<a name="l963"><span class="linenum"> 963</span></a>  <span class="comment"> * Try to guess how to convert the message to html.</span>
<a name="l964"><span class="linenum"> 964</span></a>  <span class="comment"> *</span>
<a name="l965"><span class="linenum"> 965</span></a>  <span class="comment"> * @access private</span>
<a name="l966"><span class="linenum"> 966</span></a>  <span class="comment"> *</span>
<a name="l967"><span class="linenum"> 967</span></a>  <span class="comment"> * @param stdClass $message</span>
<a name="l968"><span class="linenum"> 968</span></a>  <span class="comment"> * @param bool $forcetexttohtml</span>
<a name="l969"><span class="linenum"> 969</span></a>  <span class="comment"> * @return string html fragment</span>
<a name="l970"><span class="linenum"> 970</span></a>  <span class="comment"> */</span>
<a name="l971"><span class="linenum"> 971</span></a>  function <a class="function" onClick="logFunction('message_format_message_text')" href="../_functions/message_format_message_text.html" onMouseOver="funcPopup(event,'message_format_message_text')">message_format_message_text</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it21290" onMouseOver="hilite(21290)" onMouseOut="lolite()" onClick="logVariable('forcetexttohtml')" href="../_variables/forcetexttohtml.html">$forcetexttohtml</a> = false) {
<a name="l972"><span class="linenum"> 972</span></a>  <span class="comment">    // Note: this is a very nasty hack that tries to work around the weird messaging rules and design.</span>
<a name="l973"><span class="linenum"> 973</span></a>  
<a name="l974"><span class="linenum"> 974</span></a>      <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a> = new stdClass();
<a name="l975"><span class="linenum"> 975</span></a>      <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('para')" class="var it39524" onMouseOver="hilite(39524)" onMouseOut="lolite()" href="../_variables/para.html">para</a> = false;
<a name="l976"><span class="linenum"> 976</span></a>  
<a name="l977"><span class="linenum"> 977</span></a>      <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessageformat.html">fullmessageformat</a>;
<a name="l978"><span class="linenum"> 978</span></a>  
<a name="l979"><span class="linenum"> 979</span></a>      if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/smallmessage.html">smallmessage</a> !== '') {
<a name="l980"><span class="linenum"> 980</span></a>          if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('notification')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/notification.html">notification</a> == 1) {
<a name="l981"><span class="linenum"> 981</span></a>              if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a> !== '' or <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a> !== '') {
<a name="l982"><span class="linenum"> 982</span></a>                  <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a> = <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>;
<a name="l983"><span class="linenum"> 983</span></a>              }
<a name="l984"><span class="linenum"> 984</span></a>          }
<a name="l985"><span class="linenum"> 985</span></a>          <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/smallmessage.html">smallmessage</a>;
<a name="l986"><span class="linenum"> 986</span></a>  
<a name="l987"><span class="linenum"> 987</span></a>      } else if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessageformat.html">fullmessageformat</a> == <a class="constant" onClick="logConstant('FORMAT_HTML')" href="../_constants/FORMAT_HTML.html" onMouseOver="constPopup(event,'FORMAT_HTML')">FORMAT_HTML</a>) {
<a name="l988"><span class="linenum"> 988</span></a>          if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a> !== '') {
<a name="l989"><span class="linenum"> 989</span></a>              <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a>;
<a name="l990"><span class="linenum"> 990</span></a>          } else {
<a name="l991"><span class="linenum"> 991</span></a>              <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a>;
<a name="l992"><span class="linenum"> 992</span></a>              <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a> = <a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a>;
<a name="l993"><span class="linenum"> 993</span></a>          }
<a name="l994"><span class="linenum"> 994</span></a>  
<a name="l995"><span class="linenum"> 995</span></a>      } else {
<a name="l996"><span class="linenum"> 996</span></a>          if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a> !== '') {
<a name="l997"><span class="linenum"> 997</span></a>              <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a>;
<a name="l998"><span class="linenum"> 998</span></a>          } else {
<a name="l999"><span class="linenum"> 999</span></a>              <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a>;
<a name="l1000"><span class="linenum">1000</span></a>              <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a> = <a class="constant" onClick="logConstant('FORMAT_HTML')" href="../_constants/FORMAT_HTML.html" onMouseOver="constPopup(event,'FORMAT_HTML')">FORMAT_HTML</a>;
<a name="l1001"><span class="linenum">1001</span></a>          }
<a name="l1002"><span class="linenum">1002</span></a>      }
<a name="l1003"><span class="linenum">1003</span></a>  
<a name="l1004"><span class="linenum">1004</span></a>      if (<a class="var it21290" onMouseOver="hilite(21290)" onMouseOut="lolite()" onClick="logVariable('forcetexttohtml')" href="../_variables/forcetexttohtml.html">$forcetexttohtml</a>) {
<a name="l1005"><span class="linenum">1005</span></a>  <span class="comment">        // This is a crazy hack, why not set proper format when creating the notifications?</span>
<a name="l1006"><span class="linenum">1006</span></a>          if (<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a> === <a class="constant" onClick="logConstant('FORMAT_PLAIN')" href="../_constants/FORMAT_PLAIN.html" onMouseOver="constPopup(event,'FORMAT_PLAIN')">FORMAT_PLAIN</a>) {
<a name="l1007"><span class="linenum">1007</span></a>              <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a> = <a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a>;
<a name="l1008"><span class="linenum">1008</span></a>          }
<a name="l1009"><span class="linenum">1009</span></a>      }
<a name="l1010"><span class="linenum">1010</span></a>      return <a class="function" onClick="logFunction('format_text')" href="../_functions/format_text.html" onMouseOver="funcPopup(event,'format_text')">format_text</a>(<a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('options')" href="../_variables/options.html">$options</a>);
<a name="l1011"><span class="linenum">1011</span></a>  }
<a name="l1012"><span class="linenum">1012</span></a>  
<a name="l1013"><span class="linenum">1013</span></a>  <span class="comment">/**</span>
<a name="l1014"><span class="linenum">1014</span></a>  <span class="comment"> * Add the selected user as a contact for the current user</span>
<a name="l1015"><span class="linenum">1015</span></a>  <span class="comment"> *</span>
<a name="l1016"><span class="linenum">1016</span></a>  <span class="comment"> * @param int $contactid the ID of the user to add as a contact</span>
<a name="l1017"><span class="linenum">1017</span></a>  <span class="comment"> * @param int $blocked 1 if you wish to block the contact</span>
<a name="l1018"><span class="linenum">1018</span></a>  <span class="comment"> * @return bool/int false if the $contactid isnt a valid user id. True if no changes made.</span>
<a name="l1019"><span class="linenum">1019</span></a>  <span class="comment"> *                  Otherwise returns the result of update_record() or insert_record()</span>
<a name="l1020"><span class="linenum">1020</span></a>  <span class="comment"> */</span>
<a name="l1021"><span class="linenum">1021</span></a>  function <a class="function" onClick="logFunction('message_add_contact')" href="../_functions/message_add_contact.html" onMouseOver="funcPopup(event,'message_add_contact')">message_add_contact</a>(<a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>, <a class="var it1516" onMouseOver="hilite(1516)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../_variables/blocked.html">$blocked</a>=0) {
<a name="l1022"><span class="linenum">1022</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1023"><span class="linenum">1023</span></a>  
<a name="l1024"><span class="linenum">1024</span></a>      if (!<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('user', array('id' =&gt; <a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>))) { // invalid userid
<a name="l1025"><span class="linenum">1025</span></a>          return false;
<a name="l1026"><span class="linenum">1026</span></a>      }
<a name="l1027"><span class="linenum">1027</span></a>  
<a name="l1028"><span class="linenum">1028</span></a>  <span class="comment">    // Check if a record already exists as we may be changing blocking status.</span>
<a name="l1029"><span class="linenum">1029</span></a>      if ((<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('message_contacts', array('userid' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'contactid' =&gt; <a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>))) !== false) {
<a name="l1030"><span class="linenum">1030</span></a>  <span class="comment">        // Check if blocking status has been changed.</span>
<a name="l1031"><span class="linenum">1031</span></a>          if (<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('blocked')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/blocked.html">blocked</a> !== <a class="var it1516" onMouseOver="hilite(1516)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../_variables/blocked.html">$blocked</a>) {
<a name="l1032"><span class="linenum">1032</span></a>              <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('blocked')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/blocked.html">blocked</a> = <a class="var it1516" onMouseOver="hilite(1516)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../_variables/blocked.html">$blocked</a>;
<a name="l1033"><span class="linenum">1033</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('message_contacts', <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>);
<a name="l1034"><span class="linenum">1034</span></a>  
<a name="l1035"><span class="linenum">1035</span></a>              if (<a class="var it1516" onMouseOver="hilite(1516)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../_variables/blocked.html">$blocked</a> == 1) {
<a name="l1036"><span class="linenum">1036</span></a>  <span class="comment">                // Trigger event for blocking a contact.</span>
<a name="l1037"><span class="linenum">1037</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('message_contact_blocked')" href="../_classes/message_contact_blocked.html" onMouseOver="classPopup(event,'message_contact_blocked')">message_contact_blocked</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(array(
<a name="l1038"><span class="linenum">1038</span></a>                      'objectid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1039"><span class="linenum">1039</span></a>                      'userid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('userid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1040"><span class="linenum">1040</span></a>                      'relateduserid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('contactid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/contactid.html">contactid</a>,
<a name="l1041"><span class="linenum">1041</span></a>                      'context'  =&gt; <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('userid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>)
<a name="l1042"><span class="linenum">1042</span></a>                  ));
<a name="l1043"><span class="linenum">1043</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('message_contacts', <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>);
<a name="l1044"><span class="linenum">1044</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1045"><span class="linenum">1045</span></a>              } else {
<a name="l1046"><span class="linenum">1046</span></a>  <span class="comment">                // Trigger event for unblocking a contact.</span>
<a name="l1047"><span class="linenum">1047</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('message_contact_unblocked')" href="../_classes/message_contact_unblocked.html" onMouseOver="classPopup(event,'message_contact_unblocked')">message_contact_unblocked</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(array(
<a name="l1048"><span class="linenum">1048</span></a>                      'objectid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1049"><span class="linenum">1049</span></a>                      'userid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('userid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1050"><span class="linenum">1050</span></a>                      'relateduserid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('contactid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/contactid.html">contactid</a>,
<a name="l1051"><span class="linenum">1051</span></a>                      'context'  =&gt; <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('userid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>)
<a name="l1052"><span class="linenum">1052</span></a>                  ));
<a name="l1053"><span class="linenum">1053</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('message_contacts', <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>);
<a name="l1054"><span class="linenum">1054</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1055"><span class="linenum">1055</span></a>              }
<a name="l1056"><span class="linenum">1056</span></a>  
<a name="l1057"><span class="linenum">1057</span></a>              return true;
<a name="l1058"><span class="linenum">1058</span></a>          } else {
<a name="l1059"><span class="linenum">1059</span></a>  <span class="comment">            // No change to blocking status.</span>
<a name="l1060"><span class="linenum">1060</span></a>              return true;
<a name="l1061"><span class="linenum">1061</span></a>          }
<a name="l1062"><span class="linenum">1062</span></a>  
<a name="l1063"><span class="linenum">1063</span></a>      } else {
<a name="l1064"><span class="linenum">1064</span></a>  <span class="comment">        // New contact record.</span>
<a name="l1065"><span class="linenum">1065</span></a>          <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a> = new stdClass();
<a name="l1066"><span class="linenum">1066</span></a>          <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('userid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1067"><span class="linenum">1067</span></a>          <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('contactid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/contactid.html">contactid</a> = <a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>;
<a name="l1068"><span class="linenum">1068</span></a>          <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('blocked')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/blocked.html">blocked</a> = <a class="var it1516" onMouseOver="hilite(1516)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../_variables/blocked.html">$blocked</a>;
<a name="l1069"><span class="linenum">1069</span></a>          <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('message_contacts', <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>);
<a name="l1070"><span class="linenum">1070</span></a>  
<a name="l1071"><span class="linenum">1071</span></a>          <a class="var it1765" onMouseOver="hilite(1765)" onMouseOut="lolite()" onClick="logVariable('eventparams')" href="../_variables/eventparams.html">$eventparams</a> = array(
<a name="l1072"><span class="linenum">1072</span></a>              'objectid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1073"><span class="linenum">1073</span></a>              'userid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('userid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1074"><span class="linenum">1074</span></a>              'relateduserid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('contactid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/contactid.html">contactid</a>,
<a name="l1075"><span class="linenum">1075</span></a>              'context'  =&gt; <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('userid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>)
<a name="l1076"><span class="linenum">1076</span></a>          );
<a name="l1077"><span class="linenum">1077</span></a>  
<a name="l1078"><span class="linenum">1078</span></a>          if (<a class="var it1516" onMouseOver="hilite(1516)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../_variables/blocked.html">$blocked</a>) {
<a name="l1079"><span class="linenum">1079</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('message_contact_blocked')" href="../_classes/message_contact_blocked.html" onMouseOver="classPopup(event,'message_contact_blocked')">message_contact_blocked</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it1765" onMouseOver="hilite(1765)" onMouseOut="lolite()" onClick="logVariable('eventparams')" href="../_variables/eventparams.html">$eventparams</a>);
<a name="l1080"><span class="linenum">1080</span></a>          } else {
<a name="l1081"><span class="linenum">1081</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('message_contact_added')" href="../_classes/message_contact_added.html" onMouseOver="classPopup(event,'message_contact_added')">message_contact_added</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it1765" onMouseOver="hilite(1765)" onMouseOut="lolite()" onClick="logVariable('eventparams')" href="../_variables/eventparams.html">$eventparams</a>);
<a name="l1082"><span class="linenum">1082</span></a>          }
<a name="l1083"><span class="linenum">1083</span></a>  <span class="comment">        // Trigger event.</span>
<a name="l1084"><span class="linenum">1084</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1085"><span class="linenum">1085</span></a>  
<a name="l1086"><span class="linenum">1086</span></a>          return true;
<a name="l1087"><span class="linenum">1087</span></a>      }
<a name="l1088"><span class="linenum">1088</span></a>  }
<a name="l1089"><span class="linenum">1089</span></a>  
<a name="l1090"><span class="linenum">1090</span></a>  <span class="comment">/**</span>
<a name="l1091"><span class="linenum">1091</span></a>  <span class="comment"> * remove a contact</span>
<a name="l1092"><span class="linenum">1092</span></a>  <span class="comment"> *</span>
<a name="l1093"><span class="linenum">1093</span></a>  <span class="comment"> * @param int $contactid the user ID of the contact to remove</span>
<a name="l1094"><span class="linenum">1094</span></a>  <span class="comment"> * @return bool returns the result of delete_records()</span>
<a name="l1095"><span class="linenum">1095</span></a>  <span class="comment"> */</span>
<a name="l1096"><span class="linenum">1096</span></a>  function <a class="function" onClick="logFunction('message_remove_contact')" href="../_functions/message_remove_contact.html" onMouseOver="funcPopup(event,'message_remove_contact')">message_remove_contact</a>(<a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>) {
<a name="l1097"><span class="linenum">1097</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1098"><span class="linenum">1098</span></a>  
<a name="l1099"><span class="linenum">1099</span></a>      if (<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('message_contacts', array('userid' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'contactid' =&gt; <a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>))) {
<a name="l1100"><span class="linenum">1100</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('message_contacts', array('id' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1101"><span class="linenum">1101</span></a>  
<a name="l1102"><span class="linenum">1102</span></a>  <span class="comment">        // Trigger event for removing a contact.</span>
<a name="l1103"><span class="linenum">1103</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('message_contact_removed')" href="../_classes/message_contact_removed.html" onMouseOver="classPopup(event,'message_contact_removed')">message_contact_removed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(array(
<a name="l1104"><span class="linenum">1104</span></a>              'objectid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1105"><span class="linenum">1105</span></a>              'userid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('userid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1106"><span class="linenum">1106</span></a>              'relateduserid' =&gt; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('contactid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/contactid.html">contactid</a>,
<a name="l1107"><span class="linenum">1107</span></a>              'context'  =&gt; <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('userid')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>)
<a name="l1108"><span class="linenum">1108</span></a>          ));
<a name="l1109"><span class="linenum">1109</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('message_contacts', <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>);
<a name="l1110"><span class="linenum">1110</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1111"><span class="linenum">1111</span></a>  
<a name="l1112"><span class="linenum">1112</span></a>          return true;
<a name="l1113"><span class="linenum">1113</span></a>      }
<a name="l1114"><span class="linenum">1114</span></a>  
<a name="l1115"><span class="linenum">1115</span></a>      return false;
<a name="l1116"><span class="linenum">1116</span></a>  }
<a name="l1117"><span class="linenum">1117</span></a>  
<a name="l1118"><span class="linenum">1118</span></a>  <span class="comment">/**</span>
<a name="l1119"><span class="linenum">1119</span></a>  <span class="comment"> * Unblock a contact. Note that this reverts the previously blocked user back to a non-contact.</span>
<a name="l1120"><span class="linenum">1120</span></a>  <span class="comment"> *</span>
<a name="l1121"><span class="linenum">1121</span></a>  <span class="comment"> * @param int $contactid the user ID of the contact to unblock</span>
<a name="l1122"><span class="linenum">1122</span></a>  <span class="comment"> * @return bool returns the result of delete_records()</span>
<a name="l1123"><span class="linenum">1123</span></a>  <span class="comment"> */</span>
<a name="l1124"><span class="linenum">1124</span></a>  function <a class="function" onClick="logFunction('message_unblock_contact')" href="../_functions/message_unblock_contact.html" onMouseOver="funcPopup(event,'message_unblock_contact')">message_unblock_contact</a>(<a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>) {
<a name="l1125"><span class="linenum">1125</span></a>      return <a class="function" onClick="logFunction('message_add_contact')" href="../_functions/message_add_contact.html" onMouseOver="funcPopup(event,'message_add_contact')">message_add_contact</a>(<a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>, 0);
<a name="l1126"><span class="linenum">1126</span></a>  }
<a name="l1127"><span class="linenum">1127</span></a>  
<a name="l1128"><span class="linenum">1128</span></a>  <span class="comment">/**</span>
<a name="l1129"><span class="linenum">1129</span></a>  <span class="comment"> * Block a user.</span>
<a name="l1130"><span class="linenum">1130</span></a>  <span class="comment"> *</span>
<a name="l1131"><span class="linenum">1131</span></a>  <span class="comment"> * @param int $contactid the user ID of the user to block</span>
<a name="l1132"><span class="linenum">1132</span></a>  <span class="comment"> * @return bool</span>
<a name="l1133"><span class="linenum">1133</span></a>  <span class="comment"> */</span>
<a name="l1134"><span class="linenum">1134</span></a>  function <a class="function" onClick="logFunction('message_block_contact')" href="../_functions/message_block_contact.html" onMouseOver="funcPopup(event,'message_block_contact')">message_block_contact</a>(<a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>) {
<a name="l1135"><span class="linenum">1135</span></a>      return <a class="function" onClick="logFunction('message_add_contact')" href="../_functions/message_add_contact.html" onMouseOver="funcPopup(event,'message_add_contact')">message_add_contact</a>(<a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>, 1);
<a name="l1136"><span class="linenum">1136</span></a>  }
<a name="l1137"><span class="linenum">1137</span></a>  
<a name="l1138"><span class="linenum">1138</span></a>  <span class="comment">/**</span>
<a name="l1139"><span class="linenum">1139</span></a>  <span class="comment"> * Load a user's contact record</span>
<a name="l1140"><span class="linenum">1140</span></a>  <span class="comment"> *</span>
<a name="l1141"><span class="linenum">1141</span></a>  <span class="comment"> * @param int $contactid the user ID of the user whose contact record you want</span>
<a name="l1142"><span class="linenum">1142</span></a>  <span class="comment"> * @return array message contacts</span>
<a name="l1143"><span class="linenum">1143</span></a>  <span class="comment"> */</span>
<a name="l1144"><span class="linenum">1144</span></a>  function <a class="function" onClick="logFunction('message_get_contact')" href="../_functions/message_get_contact.html" onMouseOver="funcPopup(event,'message_get_contact')">message_get_contact</a>(<a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>) {
<a name="l1145"><span class="linenum">1145</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1146"><span class="linenum">1146</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('message_contacts', array('userid' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'contactid' =&gt; <a class="var it21295" onMouseOver="hilite(21295)" onMouseOut="lolite()" onClick="logVariable('contactid')" href="../_variables/contactid.html">$contactid</a>));
<a name="l1147"><span class="linenum">1147</span></a>  }
<a name="l1148"><span class="linenum">1148</span></a>  
<a name="l1149"><span class="linenum">1149</span></a>  <span class="comment">/**</span>
<a name="l1150"><span class="linenum">1150</span></a>  <span class="comment"> * Print the results of a message search</span>
<a name="l1151"><span class="linenum">1151</span></a>  <span class="comment"> *</span>
<a name="l1152"><span class="linenum">1152</span></a>  <span class="comment"> * @param mixed $frm submitted form data</span>
<a name="l1153"><span class="linenum">1153</span></a>  <span class="comment"> * @param bool $showicontext show text next to action icons?</span>
<a name="l1154"><span class="linenum">1154</span></a>  <span class="comment"> * @param object $currentuser the current user</span>
<a name="l1155"><span class="linenum">1155</span></a>  <span class="comment"> * @return void</span>
<a name="l1156"><span class="linenum">1156</span></a>  <span class="comment"> */</span>
<a name="l1157"><span class="linenum">1157</span></a>  function <a class="function" onClick="logFunction('message_print_search_results')" href="../_functions/message_print_search_results.html" onMouseOver="funcPopup(event,'message_print_search_results')">message_print_search_results</a>(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>=false, <a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a>=null) {
<a name="l1158"><span class="linenum">1158</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l1159"><span class="linenum">1159</span></a>  
<a name="l1160"><span class="linenum">1160</span></a>      if (empty(<a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a>)) {
<a name="l1161"><span class="linenum">1161</span></a>          <a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1162"><span class="linenum">1162</span></a>      }
<a name="l1163"><span class="linenum">1163</span></a>  
<a name="l1164"><span class="linenum">1164</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class' =&gt; 'mdl-left'));
<a name="l1165"><span class="linenum">1165</span></a>  
<a name="l1166"><span class="linenum">1166</span></a>      <a class="var it11313" onMouseOver="hilite(11313)" onMouseOut="lolite()" onClick="logVariable('personsearch')" href="../_variables/personsearch.html">$personsearch</a> = false;
<a name="l1167"><span class="linenum">1167</span></a>      <a class="var it21296" onMouseOver="hilite(21296)" onMouseOut="lolite()" onClick="logVariable('personsearchstring')" href="../_variables/personsearchstring.html">$personsearchstring</a> = null;
<a name="l1168"><span class="linenum">1168</span></a>      if (!empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('personsubmit')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/personsubmit.html">personsubmit</a>) and !empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('name')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/name.html">name</a>)) {
<a name="l1169"><span class="linenum">1169</span></a>          <a class="var it11313" onMouseOver="hilite(11313)" onMouseOut="lolite()" onClick="logVariable('personsearch')" href="../_variables/personsearch.html">$personsearch</a> = true;
<a name="l1170"><span class="linenum">1170</span></a>          <a class="var it21296" onMouseOver="hilite(21296)" onMouseOut="lolite()" onClick="logVariable('personsearchstring')" href="../_variables/personsearchstring.html">$personsearchstring</a> = <a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('name')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l1171"><span class="linenum">1171</span></a>      } else if (!empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('combinedsubmit')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/combinedsubmit.html">combinedsubmit</a>) and !empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('combinedsearch')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/combinedsearch.html">combinedsearch</a>)) {
<a name="l1172"><span class="linenum">1172</span></a>          <a class="var it11313" onMouseOver="hilite(11313)" onMouseOut="lolite()" onClick="logVariable('personsearch')" href="../_variables/personsearch.html">$personsearch</a> = true;
<a name="l1173"><span class="linenum">1173</span></a>          <a class="var it21296" onMouseOver="hilite(21296)" onMouseOut="lolite()" onClick="logVariable('personsearchstring')" href="../_variables/personsearchstring.html">$personsearchstring</a> = <a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('combinedsearch')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/combinedsearch.html">combinedsearch</a>;
<a name="l1174"><span class="linenum">1174</span></a>      }
<a name="l1175"><span class="linenum">1175</span></a>  
<a name="l1176"><span class="linenum">1176</span></a>  <span class="comment">    // Search for person.</span>
<a name="l1177"><span class="linenum">1177</span></a>      if (<a class="var it11313" onMouseOver="hilite(11313)" onMouseOut="lolite()" onClick="logVariable('personsearch')" href="../_variables/personsearch.html">$personsearch</a>) {
<a name="l1178"><span class="linenum">1178</span></a>          if (<a class="function" onClick="logFunction('optional_param')" href="../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>('mycourses', 0, <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>)) {
<a name="l1179"><span class="linenum">1179</span></a>              <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = array();
<a name="l1180"><span class="linenum">1180</span></a>              <a class="var it3111" onMouseOver="hilite(3111)" onMouseOut="lolite()" onClick="logVariable('mycourses')" href="../_variables/mycourses.html">$mycourses</a> = <a class="function" onClick="logFunction('enrol_get_my_courses')" href="../_functions/enrol_get_my_courses.html" onMouseOver="funcPopup(event,'enrol_get_my_courses')">enrol_get_my_courses</a>('id');
<a name="l1181"><span class="linenum">1181</span></a>              <a class="var it21297" onMouseOver="hilite(21297)" onMouseOut="lolite()" onClick="logVariable('mycoursesids')" href="../_variables/mycoursesids.html">$mycoursesids</a> = array();
<a name="l1182"><span class="linenum">1182</span></a>              foreach (<a class="var it3111" onMouseOver="hilite(3111)" onMouseOut="lolite()" onClick="logVariable('mycourses')" href="../_variables/mycourses.html">$mycourses</a> as <a class="var it3112" onMouseOver="hilite(3112)" onMouseOut="lolite()" onClick="logVariable('mycourse')" href="../_variables/mycourse.html">$mycourse</a>) {
<a name="l1183"><span class="linenum">1183</span></a>                  <a class="var it21297" onMouseOver="hilite(21297)" onMouseOut="lolite()" onClick="logVariable('mycoursesids')" href="../_variables/mycoursesids.html">$mycoursesids</a>[] = <a class="var it3112" onMouseOver="hilite(3112)" onMouseOut="lolite()" onClick="logVariable('mycourse')" href="../_variables/mycourse.html">$mycourse</a>-&gt;<a onClick="logVariable('id')" class="var it39661" onMouseOver="hilite(39661)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1184"><span class="linenum">1184</span></a>              }
<a name="l1185"><span class="linenum">1185</span></a>              <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a> = <a class="function" onClick="logFunction('message_search_users')" href="../_functions/message_search_users.html" onMouseOver="funcPopup(event,'message_search_users')">message_search_users</a>(<a class="var it21297" onMouseOver="hilite(21297)" onMouseOut="lolite()" onClick="logVariable('mycoursesids')" href="../_variables/mycoursesids.html">$mycoursesids</a>, <a class="var it21296" onMouseOver="hilite(21296)" onMouseOut="lolite()" onClick="logVariable('personsearchstring')" href="../_variables/personsearchstring.html">$personsearchstring</a>);
<a name="l1186"><span class="linenum">1186</span></a>              foreach (<a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a> as <a class="var it21298" onMouseOver="hilite(21298)" onMouseOut="lolite()" onClick="logVariable('suser')" href="../_variables/suser.html">$suser</a>) {
<a name="l1187"><span class="linenum">1187</span></a>                  <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>[<a class="var it21298" onMouseOver="hilite(21298)" onMouseOut="lolite()" onClick="logVariable('suser')" href="../_variables/suser.html">$suser</a>-&gt;<a onClick="logVariable('id')" class="var it42197" onMouseOver="hilite(42197)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it21298" onMouseOver="hilite(21298)" onMouseOut="lolite()" onClick="logVariable('suser')" href="../_variables/suser.html">$suser</a>;
<a name="l1188"><span class="linenum">1188</span></a>              }
<a name="l1189"><span class="linenum">1189</span></a>          } else {
<a name="l1190"><span class="linenum">1190</span></a>              <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = <a class="function" onClick="logFunction('message_search_users')" href="../_functions/message_search_users.html" onMouseOver="funcPopup(event,'message_search_users')">message_search_users</a>(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, <a class="var it21296" onMouseOver="hilite(21296)" onMouseOut="lolite()" onClick="logVariable('personsearchstring')" href="../_variables/personsearchstring.html">$personsearchstring</a>);
<a name="l1191"><span class="linenum">1191</span></a>          }
<a name="l1192"><span class="linenum">1192</span></a>  
<a name="l1193"><span class="linenum">1193</span></a>          if (!empty(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>)) {
<a name="l1194"><span class="linenum">1194</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('p', array('class' =&gt; 'heading searchresultcount'));
<a name="l1195"><span class="linenum">1195</span></a>              echo <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('userssearchresults', 'message', <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>));
<a name="l1196"><span class="linenum">1196</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('p');
<a name="l1197"><span class="linenum">1197</span></a>  
<a name="l1198"><span class="linenum">1198</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('table', array('class' =&gt; 'messagesearchresults'));
<a name="l1199"><span class="linenum">1199</span></a>              foreach (<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> as <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l1200"><span class="linenum">1200</span></a>  
<a name="l1201"><span class="linenum">1201</span></a>                  if ( <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('contactlistid')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/contactlistid.html">contactlistid</a> )  {
<a name="l1202"><span class="linenum">1202</span></a>                      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('blocked')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/blocked.html">blocked</a> == 0) { // User is not blocked.
<a name="l1203"><span class="linenum">1203</span></a>                          <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'remove', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l1204"><span class="linenum">1204</span></a>                          <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'block', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l1205"><span class="linenum">1205</span></a>                      } else { // blocked
<a name="l1206"><span class="linenum">1206</span></a>                          <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'add', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l1207"><span class="linenum">1207</span></a>                          <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'unblock', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l1208"><span class="linenum">1208</span></a>                      }
<a name="l1209"><span class="linenum">1209</span></a>                  } else {
<a name="l1210"><span class="linenum">1210</span></a>                      <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'add', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l1211"><span class="linenum">1211</span></a>                      <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'block', true, null, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l1212"><span class="linenum">1212</span></a>                  }
<a name="l1213"><span class="linenum">1213</span></a>  
<a name="l1214"><span class="linenum">1214</span></a>  <span class="comment">                // Should we show just the icon or icon and text?</span>
<a name="l1215"><span class="linenum">1215</span></a>                  <a class="var it21294" onMouseOver="hilite(21294)" onMouseOut="lolite()" onClick="logVariable('histicontext')" href="../_variables/histicontext.html">$histicontext</a> = 'icon';
<a name="l1216"><span class="linenum">1216</span></a>                  if (<a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>) {
<a name="l1217"><span class="linenum">1217</span></a>                      <a class="var it21294" onMouseOver="hilite(21294)" onMouseOut="lolite()" onClick="logVariable('histicontext')" href="../_variables/histicontext.html">$histicontext</a> = 'both';
<a name="l1218"><span class="linenum">1218</span></a>                  }
<a name="l1219"><span class="linenum">1219</span></a>                  <a class="var it21293" onMouseOver="hilite(21293)" onMouseOut="lolite()" onClick="logVariable('strhistory')" href="../_variables/strhistory.html">$strhistory</a> = <a class="function" onClick="logFunction('message_history_link')" href="../_functions/message_history_link.html" onMouseOver="funcPopup(event,'message_history_link')">message_history_link</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true, '', '', <a class="var it21294" onMouseOver="hilite(21294)" onMouseOut="lolite()" onClick="logVariable('histicontext')" href="../_variables/histicontext.html">$histicontext</a>);
<a name="l1220"><span class="linenum">1220</span></a>  
<a name="l1221"><span class="linenum">1221</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('tr');
<a name="l1222"><span class="linenum">1222</span></a>  
<a name="l1223"><span class="linenum">1223</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('td', array('class' =&gt; 'pix'));
<a name="l1224"><span class="linenum">1224</span></a>                  echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, array('size' =&gt; 20, 'courseid' =&gt; <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>));
<a name="l1225"><span class="linenum">1225</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('td');
<a name="l1226"><span class="linenum">1226</span></a>  
<a name="l1227"><span class="linenum">1227</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('td',array('class' =&gt; 'contact'));
<a name="l1228"><span class="linenum">1228</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> = null;
<a name="l1229"><span class="linenum">1229</span></a>                  <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(&quot;/message/index.php?id=<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>&quot;);
<a name="l1230"><span class="linenum">1230</span></a>                  echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('action_link')" href="../_functions/action_link.html" onMouseOver="funcPopup(event,'action_link')">action_link</a>(<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a>, <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>), <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a>, array('title' =&gt; <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('sendmessageto', 'message', <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>))));
<a name="l1231"><span class="linenum">1231</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('td');
<a name="l1232"><span class="linenum">1232</span></a>  
<a name="l1233"><span class="linenum">1233</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('td', <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a>, array('class' =&gt; 'link'));
<a name="l1234"><span class="linenum">1234</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('td', <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>, array('class' =&gt; 'link'));
<a name="l1235"><span class="linenum">1235</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('td', <a class="var it21293" onMouseOver="hilite(21293)" onMouseOut="lolite()" onClick="logVariable('strhistory')" href="../_variables/strhistory.html">$strhistory</a>, array('class' =&gt; 'link'));
<a name="l1236"><span class="linenum">1236</span></a>  
<a name="l1237"><span class="linenum">1237</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('tr');
<a name="l1238"><span class="linenum">1238</span></a>              }
<a name="l1239"><span class="linenum">1239</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('table');
<a name="l1240"><span class="linenum">1240</span></a>  
<a name="l1241"><span class="linenum">1241</span></a>          } else {
<a name="l1242"><span class="linenum">1242</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('p', array('class' =&gt; 'heading searchresultcount'));
<a name="l1243"><span class="linenum">1243</span></a>              echo <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('userssearchresults', 'message', 0).'&lt;br /&gt;&lt;br /&gt;';
<a name="l1244"><span class="linenum">1244</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('p');
<a name="l1245"><span class="linenum">1245</span></a>          }
<a name="l1246"><span class="linenum">1246</span></a>      }
<a name="l1247"><span class="linenum">1247</span></a>  
<a name="l1248"><span class="linenum">1248</span></a>  <span class="comment">    // search messages for keywords</span>
<a name="l1249"><span class="linenum">1249</span></a>      <a class="var it11314" onMouseOver="hilite(11314)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../_variables/messagesearch.html">$messagesearch</a> = false;
<a name="l1250"><span class="linenum">1250</span></a>      <a class="var it21299" onMouseOver="hilite(21299)" onMouseOut="lolite()" onClick="logVariable('messagesearchstring')" href="../_variables/messagesearchstring.html">$messagesearchstring</a> = null;
<a name="l1251"><span class="linenum">1251</span></a>      if (!empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('keywords')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/keywords.html">keywords</a>)) {
<a name="l1252"><span class="linenum">1252</span></a>          <a class="var it11314" onMouseOver="hilite(11314)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../_variables/messagesearch.html">$messagesearch</a> = true;
<a name="l1253"><span class="linenum">1253</span></a>          <a class="var it21299" onMouseOver="hilite(21299)" onMouseOut="lolite()" onClick="logVariable('messagesearchstring')" href="../_variables/messagesearchstring.html">$messagesearchstring</a> = <a class="function" onClick="logFunction('clean_text')" href="../_functions/clean_text.html" onMouseOver="funcPopup(event,'clean_text')">clean_text</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('keywords')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/keywords.html">keywords</a>));
<a name="l1254"><span class="linenum">1254</span></a>      } else if (!empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('combinedsubmit')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/combinedsubmit.html">combinedsubmit</a>) and !empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('combinedsearch')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/combinedsearch.html">combinedsearch</a>)) {
<a name="l1255"><span class="linenum">1255</span></a>          <a class="var it11314" onMouseOver="hilite(11314)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../_variables/messagesearch.html">$messagesearch</a> = true;
<a name="l1256"><span class="linenum">1256</span></a>          <a class="var it21299" onMouseOver="hilite(21299)" onMouseOut="lolite()" onClick="logVariable('messagesearchstring')" href="../_variables/messagesearchstring.html">$messagesearchstring</a> = <a class="function" onClick="logFunction('clean_text')" href="../_functions/clean_text.html" onMouseOver="funcPopup(event,'clean_text')">clean_text</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('combinedsearch')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/combinedsearch.html">combinedsearch</a>));
<a name="l1257"><span class="linenum">1257</span></a>      }
<a name="l1258"><span class="linenum">1258</span></a>  
<a name="l1259"><span class="linenum">1259</span></a>      if (<a class="var it11314" onMouseOver="hilite(11314)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../_variables/messagesearch.html">$messagesearch</a>) {
<a name="l1260"><span class="linenum">1260</span></a>          if (<a class="var it21299" onMouseOver="hilite(21299)" onMouseOut="lolite()" onClick="logVariable('messagesearchstring')" href="../_variables/messagesearchstring.html">$messagesearchstring</a>) {
<a name="l1261"><span class="linenum">1261</span></a>              <a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(' ', <a class="var it21299" onMouseOver="hilite(21299)" onMouseOut="lolite()" onClick="logVariable('messagesearchstring')" href="../_variables/messagesearchstring.html">$messagesearchstring</a>);
<a name="l1262"><span class="linenum">1262</span></a>          } else {
<a name="l1263"><span class="linenum">1263</span></a>              <a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a> = array();
<a name="l1264"><span class="linenum">1264</span></a>          }
<a name="l1265"><span class="linenum">1265</span></a>          <a class="var it21300" onMouseOver="hilite(21300)" onMouseOut="lolite()" onClick="logVariable('tome')" href="../_variables/tome.html">$tome</a>     = false;
<a name="l1266"><span class="linenum">1266</span></a>          <a class="var it21301" onMouseOver="hilite(21301)" onMouseOut="lolite()" onClick="logVariable('fromme')" href="../_variables/fromme.html">$fromme</a>   = false;
<a name="l1267"><span class="linenum">1267</span></a>          <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> = 'none';
<a name="l1268"><span class="linenum">1268</span></a>  
<a name="l1269"><span class="linenum">1269</span></a>          if (empty(<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('keywordsoption')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/keywordsoption.html">keywordsoption</a>)) {
<a name="l1270"><span class="linenum">1270</span></a>              <a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('keywordsoption')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/keywordsoption.html">keywordsoption</a> = 'allmine';
<a name="l1271"><span class="linenum">1271</span></a>          }
<a name="l1272"><span class="linenum">1272</span></a>  
<a name="l1273"><span class="linenum">1273</span></a>          switch (<a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('keywordsoption')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/keywordsoption.html">keywordsoption</a>) {
<a name="l1274"><span class="linenum">1274</span></a>              case 'tome':
<a name="l1275"><span class="linenum">1275</span></a>                  <a class="var it21300" onMouseOver="hilite(21300)" onMouseOut="lolite()" onClick="logVariable('tome')" href="../_variables/tome.html">$tome</a>   = true;
<a name="l1276"><span class="linenum">1276</span></a>                  break;
<a name="l1277"><span class="linenum">1277</span></a>              case 'fromme':
<a name="l1278"><span class="linenum">1278</span></a>                  <a class="var it21301" onMouseOver="hilite(21301)" onMouseOut="lolite()" onClick="logVariable('fromme')" href="../_variables/fromme.html">$fromme</a> = true;
<a name="l1279"><span class="linenum">1279</span></a>                  break;
<a name="l1280"><span class="linenum">1280</span></a>              case 'allmine':
<a name="l1281"><span class="linenum">1281</span></a>                  <a class="var it21300" onMouseOver="hilite(21300)" onMouseOut="lolite()" onClick="logVariable('tome')" href="../_variables/tome.html">$tome</a>   = true;
<a name="l1282"><span class="linenum">1282</span></a>                  <a class="var it21301" onMouseOver="hilite(21301)" onMouseOut="lolite()" onClick="logVariable('fromme')" href="../_variables/fromme.html">$fromme</a> = true;
<a name="l1283"><span class="linenum">1283</span></a>                  break;
<a name="l1284"><span class="linenum">1284</span></a>              case 'allusers':
<a name="l1285"><span class="linenum">1285</span></a>                  <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> = <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>;
<a name="l1286"><span class="linenum">1286</span></a>                  break;
<a name="l1287"><span class="linenum">1287</span></a>              case 'courseusers':
<a name="l1288"><span class="linenum">1288</span></a>                  <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> = <a class="var it4812" onMouseOver="hilite(4812)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('courseid')" class="var it41395" onMouseOver="hilite(41395)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>;
<a name="l1289"><span class="linenum">1289</span></a>                  break;
<a name="l1290"><span class="linenum">1290</span></a>              default:
<a name="l1291"><span class="linenum">1291</span></a>                  <a class="var it21300" onMouseOver="hilite(21300)" onMouseOut="lolite()" onClick="logVariable('tome')" href="../_variables/tome.html">$tome</a>   = true;
<a name="l1292"><span class="linenum">1292</span></a>                  <a class="var it21301" onMouseOver="hilite(21301)" onMouseOut="lolite()" onClick="logVariable('fromme')" href="../_variables/fromme.html">$fromme</a> = true;
<a name="l1293"><span class="linenum">1293</span></a>          }
<a name="l1294"><span class="linenum">1294</span></a>  
<a name="l1295"><span class="linenum">1295</span></a>          if ((<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> = <a class="function" onClick="logFunction('message_search')" href="../_functions/message_search.html" onMouseOver="funcPopup(event,'message_search')">message_search</a>(<a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>, <a class="var it21301" onMouseOver="hilite(21301)" onMouseOut="lolite()" onClick="logVariable('fromme')" href="../_variables/fromme.html">$fromme</a>, <a class="var it21300" onMouseOver="hilite(21300)" onMouseOut="lolite()" onClick="logVariable('tome')" href="../_variables/tome.html">$tome</a>, <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>)) !== false) {
<a name="l1296"><span class="linenum">1296</span></a>  
<a name="l1297"><span class="linenum">1297</span></a>  <span class="comment">            // Get a list of contacts.</span>
<a name="l1298"><span class="linenum">1298</span></a>              if ((<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('message_contacts', array('userid' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>), '', 'contactid, blocked') ) === false) {
<a name="l1299"><span class="linenum">1299</span></a>                  <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a> = array();
<a name="l1300"><span class="linenum">1300</span></a>              }
<a name="l1301"><span class="linenum">1301</span></a>  
<a name="l1302"><span class="linenum">1302</span></a>  <span class="comment">            // Print heading with number of results.</span>
<a name="l1303"><span class="linenum">1303</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('p', array('class' =&gt; 'heading searchresultcount'));
<a name="l1304"><span class="linenum">1304</span></a>              <a class="var it21303" onMouseOver="hilite(21303)" onMouseOut="lolite()" onClick="logVariable('countresults')" href="../_variables/countresults.html">$countresults</a> = <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>);
<a name="l1305"><span class="linenum">1305</span></a>              if (<a class="var it21303" onMouseOver="hilite(21303)" onMouseOut="lolite()" onClick="logVariable('countresults')" href="../_variables/countresults.html">$countresults</a> == <a class="constant" onClick="logConstant('MESSAGE_SEARCH_MAX_RESULTS')" href="../_constants/MESSAGE_SEARCH_MAX_RESULTS.html" onMouseOver="constPopup(event,'MESSAGE_SEARCH_MAX_RESULTS')">MESSAGE_SEARCH_MAX_RESULTS</a>) {
<a name="l1306"><span class="linenum">1306</span></a>                  echo <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('keywordssearchresultstoomany', 'message', <a class="var it21303" onMouseOver="hilite(21303)" onMouseOut="lolite()" onClick="logVariable('countresults')" href="../_variables/countresults.html">$countresults</a>).' (&quot;'.<a class="function" onClick="logFunction('s')" href="../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="var it21299" onMouseOver="hilite(21299)" onMouseOut="lolite()" onClick="logVariable('messagesearchstring')" href="../_variables/messagesearchstring.html">$messagesearchstring</a>).'&quot;)';
<a name="l1307"><span class="linenum">1307</span></a>              } else {
<a name="l1308"><span class="linenum">1308</span></a>                  echo <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('keywordssearchresults', 'message', <a class="var it21303" onMouseOver="hilite(21303)" onMouseOut="lolite()" onClick="logVariable('countresults')" href="../_variables/countresults.html">$countresults</a>);
<a name="l1309"><span class="linenum">1309</span></a>              }
<a name="l1310"><span class="linenum">1310</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('p');
<a name="l1311"><span class="linenum">1311</span></a>  
<a name="l1312"><span class="linenum">1312</span></a>  <span class="comment">            // Print table headings.</span>
<a name="l1313"><span class="linenum">1313</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('table', array('class' =&gt; 'messagesearchresults', 'cellspacing' =&gt; '0'));
<a name="l1314"><span class="linenum">1314</span></a>  
<a name="l1315"><span class="linenum">1315</span></a>              <a class="var it21304" onMouseOver="hilite(21304)" onMouseOut="lolite()" onClick="logVariable('headertdstart')" href="../_variables/headertdstart.html">$headertdstart</a> = <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('td', array('class' =&gt; 'messagesearchresultscol'));
<a name="l1316"><span class="linenum">1316</span></a>              <a class="var it21305" onMouseOver="hilite(21305)" onMouseOut="lolite()" onClick="logVariable('headertdend')" href="../_variables/headertdend.html">$headertdend</a>   = <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('td');
<a name="l1317"><span class="linenum">1317</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('tr');
<a name="l1318"><span class="linenum">1318</span></a>              echo <a class="var it21304" onMouseOver="hilite(21304)" onMouseOut="lolite()" onClick="logVariable('headertdstart')" href="../_variables/headertdstart.html">$headertdstart</a>.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('from').<a class="var it21305" onMouseOver="hilite(21305)" onMouseOut="lolite()" onClick="logVariable('headertdend')" href="../_variables/headertdend.html">$headertdend</a>;
<a name="l1319"><span class="linenum">1319</span></a>              echo <a class="var it21304" onMouseOver="hilite(21304)" onMouseOut="lolite()" onClick="logVariable('headertdstart')" href="../_variables/headertdstart.html">$headertdstart</a>.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('to').<a class="var it21305" onMouseOver="hilite(21305)" onMouseOut="lolite()" onClick="logVariable('headertdend')" href="../_variables/headertdend.html">$headertdend</a>;
<a name="l1320"><span class="linenum">1320</span></a>              echo <a class="var it21304" onMouseOver="hilite(21304)" onMouseOut="lolite()" onClick="logVariable('headertdstart')" href="../_variables/headertdstart.html">$headertdstart</a>.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('message', 'message').<a class="var it21305" onMouseOver="hilite(21305)" onMouseOut="lolite()" onClick="logVariable('headertdend')" href="../_variables/headertdend.html">$headertdend</a>;
<a name="l1321"><span class="linenum">1321</span></a>              echo <a class="var it21304" onMouseOver="hilite(21304)" onMouseOut="lolite()" onClick="logVariable('headertdstart')" href="../_variables/headertdstart.html">$headertdstart</a>.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('timesent', 'message').<a class="var it21305" onMouseOver="hilite(21305)" onMouseOut="lolite()" onClick="logVariable('headertdend')" href="../_variables/headertdend.html">$headertdend</a>;
<a name="l1322"><span class="linenum">1322</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('tr');
<a name="l1323"><span class="linenum">1323</span></a>  
<a name="l1324"><span class="linenum">1324</span></a>              <a class="var it21306" onMouseOver="hilite(21306)" onMouseOut="lolite()" onClick="logVariable('blockedcount')" href="../_variables/blockedcount.html">$blockedcount</a> = 0;
<a name="l1325"><span class="linenum">1325</span></a>              <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimedatetimeshort');
<a name="l1326"><span class="linenum">1326</span></a>              <a class="var it21307" onMouseOver="hilite(21307)" onMouseOut="lolite()" onClick="logVariable('strcontext')" href="../_variables/strcontext.html">$strcontext</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('context', 'message');
<a name="l1327"><span class="linenum">1327</span></a>              foreach (<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> as <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>) {
<a name="l1328"><span class="linenum">1328</span></a>  
<a name="l1329"><span class="linenum">1329</span></a>  <span class="comment">                // Ignore messages to and from blocked users unless $frm-&gt;includeblocked is set.</span>
<a name="l1330"><span class="linenum">1330</span></a>                  if (!<a class="function" onClick="logFunction('optional_param')" href="../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>('includeblocked', 0, <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>) and (
<a name="l1331"><span class="linenum">1331</span></a>                        ( isset(<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>[<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>]) and (<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>[<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>]-&gt;blocked == 1)) or
<a name="l1332"><span class="linenum">1332</span></a>                        ( isset(<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>[<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>]  ) and (<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>[<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>]-&gt;blocked   == 1))
<a name="l1333"><span class="linenum">1333</span></a>                                                  )
<a name="l1334"><span class="linenum">1334</span></a>                     ) {
<a name="l1335"><span class="linenum">1335</span></a>                      <a class="var it21306" onMouseOver="hilite(21306)" onMouseOut="lolite()" onClick="logVariable('blockedcount')" href="../_variables/blockedcount.html">$blockedcount</a> ++;
<a name="l1336"><span class="linenum">1336</span></a>                      continue;
<a name="l1337"><span class="linenum">1337</span></a>                  }
<a name="l1338"><span class="linenum">1338</span></a>  
<a name="l1339"><span class="linenum">1339</span></a>  <span class="comment">                // Load user-to record.</span>
<a name="l1340"><span class="linenum">1340</span></a>                  if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a> !== <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l1341"><span class="linenum">1341</span></a>                      <a class="var it1854" onMouseOver="hilite(1854)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../_variables/userto.html">$userto</a> = <a class="class" onClick="logClass('core_user')" href="../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('get_user')" href="../_functions/get_user.html" onMouseOver="funcPopup(event,'get_user')">get_user</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>);
<a name="l1342"><span class="linenum">1342</span></a>                      <a class="var it21308" onMouseOver="hilite(21308)" onMouseOut="lolite()" onClick="logVariable('tocontact')" href="../_variables/tocontact.html">$tocontact</a> = (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>, <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>) and
<a name="l1343"><span class="linenum">1343</span></a>                                      (<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>[<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>]-&gt;blocked == 0) );
<a name="l1344"><span class="linenum">1344</span></a>                      <a class="var it21309" onMouseOver="hilite(21309)" onMouseOut="lolite()" onClick="logVariable('toblocked')" href="../_variables/toblocked.html">$toblocked</a> = (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>, <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>) and
<a name="l1345"><span class="linenum">1345</span></a>                                      (<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>[<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>]-&gt;blocked == 1) );
<a name="l1346"><span class="linenum">1346</span></a>                  } else {
<a name="l1347"><span class="linenum">1347</span></a>                      <a class="var it1854" onMouseOver="hilite(1854)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../_variables/userto.html">$userto</a> = false;
<a name="l1348"><span class="linenum">1348</span></a>                      <a class="var it21308" onMouseOver="hilite(21308)" onMouseOut="lolite()" onClick="logVariable('tocontact')" href="../_variables/tocontact.html">$tocontact</a> = false;
<a name="l1349"><span class="linenum">1349</span></a>                      <a class="var it21309" onMouseOver="hilite(21309)" onMouseOut="lolite()" onClick="logVariable('toblocked')" href="../_variables/toblocked.html">$toblocked</a> = false;
<a name="l1350"><span class="linenum">1350</span></a>                  }
<a name="l1351"><span class="linenum">1351</span></a>  
<a name="l1352"><span class="linenum">1352</span></a>  <span class="comment">                // Load user-from record.</span>
<a name="l1353"><span class="linenum">1353</span></a>                  if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a> !== <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l1354"><span class="linenum">1354</span></a>                      <a class="var it1853" onMouseOver="hilite(1853)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../_variables/userfrom.html">$userfrom</a> = <a class="class" onClick="logClass('core_user')" href="../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('get_user')" href="../_functions/get_user.html" onMouseOver="funcPopup(event,'get_user')">get_user</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>);
<a name="l1355"><span class="linenum">1355</span></a>                      <a class="var it21310" onMouseOver="hilite(21310)" onMouseOut="lolite()" onClick="logVariable('fromcontact')" href="../_variables/fromcontact.html">$fromcontact</a> = (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>, <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>) and
<a name="l1356"><span class="linenum">1356</span></a>                                      (<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>[<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>]-&gt;blocked == 0) );
<a name="l1357"><span class="linenum">1357</span></a>                      <a class="var it21311" onMouseOver="hilite(21311)" onMouseOut="lolite()" onClick="logVariable('fromblocked')" href="../_variables/fromblocked.html">$fromblocked</a> = (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>, <a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>) and
<a name="l1358"><span class="linenum">1358</span></a>                                      (<a class="var it3106" onMouseOver="hilite(3106)" onMouseOut="lolite()" onClick="logVariable('contacts')" href="../_variables/contacts.html">$contacts</a>[<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>]-&gt;blocked == 1) );
<a name="l1359"><span class="linenum">1359</span></a>                  } else {
<a name="l1360"><span class="linenum">1360</span></a>                      <a class="var it1853" onMouseOver="hilite(1853)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../_variables/userfrom.html">$userfrom</a> = false;
<a name="l1361"><span class="linenum">1361</span></a>                      <a class="var it21310" onMouseOver="hilite(21310)" onMouseOut="lolite()" onClick="logVariable('fromcontact')" href="../_variables/fromcontact.html">$fromcontact</a> = false;
<a name="l1362"><span class="linenum">1362</span></a>                      <a class="var it21311" onMouseOver="hilite(21311)" onMouseOut="lolite()" onClick="logVariable('fromblocked')" href="../_variables/fromblocked.html">$fromblocked</a> = false;
<a name="l1363"><span class="linenum">1363</span></a>                  }
<a name="l1364"><span class="linenum">1364</span></a>  
<a name="l1365"><span class="linenum">1365</span></a>  <span class="comment">                // Find date string for this message.</span>
<a name="l1366"><span class="linenum">1366</span></a>                  <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a> = <a class="function" onClick="logFunction('usergetdate')" href="../_functions/usergetdate.html" onMouseOver="funcPopup(event,'usergetdate')">usergetdate</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>);
<a name="l1367"><span class="linenum">1367</span></a>                  <a class="var it12930" onMouseOver="hilite(12930)" onMouseOut="lolite()" onClick="logVariable('datestring')" href="../_variables/datestring.html">$datestring</a> = <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['year'].<a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['mon'].<a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['mday'];
<a name="l1368"><span class="linenum">1368</span></a>  
<a name="l1369"><span class="linenum">1369</span></a>  <span class="comment">                // Print out message row.</span>
<a name="l1370"><span class="linenum">1370</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('tr', array('valign' =&gt; 'top'));
<a name="l1371"><span class="linenum">1371</span></a>  
<a name="l1372"><span class="linenum">1372</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('td', array('class' =&gt; 'contact'));
<a name="l1373"><span class="linenum">1373</span></a>                  <a class="function" onClick="logFunction('message_print_user')" href="../_functions/message_print_user.html" onMouseOver="funcPopup(event,'message_print_user')">message_print_user</a>(<a class="var it1853" onMouseOver="hilite(1853)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../_variables/userfrom.html">$userfrom</a>, <a class="var it21310" onMouseOver="hilite(21310)" onMouseOut="lolite()" onClick="logVariable('fromcontact')" href="../_variables/fromcontact.html">$fromcontact</a>, <a class="var it21311" onMouseOver="hilite(21311)" onMouseOut="lolite()" onClick="logVariable('fromblocked')" href="../_variables/fromblocked.html">$fromblocked</a>, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l1374"><span class="linenum">1374</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('td');
<a name="l1375"><span class="linenum">1375</span></a>  
<a name="l1376"><span class="linenum">1376</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('td', array('class' =&gt; 'contact'));
<a name="l1377"><span class="linenum">1377</span></a>                  <a class="function" onClick="logFunction('message_print_user')" href="../_functions/message_print_user.html" onMouseOver="funcPopup(event,'message_print_user')">message_print_user</a>(<a class="var it1854" onMouseOver="hilite(1854)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../_variables/userto.html">$userto</a>, <a class="var it21308" onMouseOver="hilite(21308)" onMouseOut="lolite()" onClick="logVariable('tocontact')" href="../_variables/tocontact.html">$tocontact</a>, <a class="var it21309" onMouseOver="hilite(21309)" onMouseOut="lolite()" onClick="logVariable('toblocked')" href="../_variables/toblocked.html">$toblocked</a>, <a class="var it21284" onMouseOver="hilite(21284)" onMouseOut="lolite()" onClick="logVariable('showicontext')" href="../_variables/showicontext.html">$showicontext</a>);
<a name="l1378"><span class="linenum">1378</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('td');
<a name="l1379"><span class="linenum">1379</span></a>  
<a name="l1380"><span class="linenum">1380</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('td', array('class' =&gt; 'summary'));
<a name="l1381"><span class="linenum">1381</span></a>                  echo <a class="function" onClick="logFunction('message_get_fragment')" href="../_functions/message_get_fragment.html" onMouseOver="funcPopup(event,'message_get_fragment')">message_get_fragment</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/smallmessage.html">smallmessage</a>, <a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>);
<a name="l1382"><span class="linenum">1382</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class' =&gt; 'link'));
<a name="l1383"><span class="linenum">1383</span></a>  
<a name="l1384"><span class="linenum">1384</span></a>  <span class="comment">                // If the user clicks the context link display message sender on the left.</span>
<a name="l1385"><span class="linenum">1385</span></a>  <span class="comment">                // EXCEPT if the current user is in the conversation. Current user == always on the left.</span>
<a name="l1386"><span class="linenum">1386</span></a>                  <a class="var it21312" onMouseOver="hilite(21312)" onMouseOut="lolite()" onClick="logVariable('leftsideuserid')" href="../_variables/leftsideuserid.html">$leftsideuserid</a> = <a class="var it21313" onMouseOver="hilite(21313)" onMouseOut="lolite()" onClick="logVariable('rightsideuserid')" href="../_variables/rightsideuserid.html">$rightsideuserid</a> = null;
<a name="l1387"><span class="linenum">1387</span></a>                  if (<a class="var it1510" onMouseOver="hilite(1510)" onMouseOut="lolite()" onClick="logVariable('currentuser')" href="../_variables/currentuser.html">$currentuser</a>-&gt;<a onClick="logVariable('id')" class="var it40368" onMouseOver="hilite(40368)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>) {
<a name="l1388"><span class="linenum">1388</span></a>                      <a class="var it21312" onMouseOver="hilite(21312)" onMouseOut="lolite()" onClick="logVariable('leftsideuserid')" href="../_variables/leftsideuserid.html">$leftsideuserid</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>;
<a name="l1389"><span class="linenum">1389</span></a>                      <a class="var it21313" onMouseOver="hilite(21313)" onMouseOut="lolite()" onClick="logVariable('rightsideuserid')" href="../_variables/rightsideuserid.html">$rightsideuserid</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>;
<a name="l1390"><span class="linenum">1390</span></a>                  } else {
<a name="l1391"><span class="linenum">1391</span></a>                      <a class="var it21312" onMouseOver="hilite(21312)" onMouseOut="lolite()" onClick="logVariable('leftsideuserid')" href="../_variables/leftsideuserid.html">$leftsideuserid</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>;
<a name="l1392"><span class="linenum">1392</span></a>                      <a class="var it21313" onMouseOver="hilite(21313)" onMouseOut="lolite()" onClick="logVariable('rightsideuserid')" href="../_variables/rightsideuserid.html">$rightsideuserid</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>;
<a name="l1393"><span class="linenum">1393</span></a>                  }
<a name="l1394"><span class="linenum">1394</span></a>                  <a class="function" onClick="logFunction('message_history_link')" href="../_functions/message_history_link.html" onMouseOver="funcPopup(event,'message_history_link')">message_history_link</a>(<a class="var it21312" onMouseOver="hilite(21312)" onMouseOut="lolite()" onClick="logVariable('leftsideuserid')" href="../_variables/leftsideuserid.html">$leftsideuserid</a>, <a class="var it21313" onMouseOver="hilite(21313)" onMouseOut="lolite()" onClick="logVariable('rightsideuserid')" href="../_variables/rightsideuserid.html">$rightsideuserid</a>, false,
<a name="l1395"><span class="linenum">1395</span></a>                                       <a class="var it21299" onMouseOver="hilite(21299)" onMouseOut="lolite()" onClick="logVariable('messagesearchstring')" href="../_variables/messagesearchstring.html">$messagesearchstring</a>, 'm'.<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it21307" onMouseOver="hilite(21307)" onMouseOut="lolite()" onClick="logVariable('strcontext')" href="../_variables/strcontext.html">$strcontext</a>);
<a name="l1396"><span class="linenum">1396</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l1397"><span class="linenum">1397</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('td');
<a name="l1398"><span class="linenum">1398</span></a>  
<a name="l1399"><span class="linenum">1399</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('td', <a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>, <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a>), array('class' =&gt; 'date'));
<a name="l1400"><span class="linenum">1400</span></a>  
<a name="l1401"><span class="linenum">1401</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('tr');
<a name="l1402"><span class="linenum">1402</span></a>              }
<a name="l1403"><span class="linenum">1403</span></a>  
<a name="l1404"><span class="linenum">1404</span></a>  
<a name="l1405"><span class="linenum">1405</span></a>              if (<a class="var it21306" onMouseOver="hilite(21306)" onMouseOut="lolite()" onClick="logVariable('blockedcount')" href="../_variables/blockedcount.html">$blockedcount</a> &gt; 0) {
<a name="l1406"><span class="linenum">1406</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('tr');
<a name="l1407"><span class="linenum">1407</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('td', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('blockedmessages', 'message', <a class="var it21306" onMouseOver="hilite(21306)" onMouseOut="lolite()" onClick="logVariable('blockedcount')" href="../_variables/blockedcount.html">$blockedcount</a>), array('colspan' =&gt; 4, 'align' =&gt; 'center'));
<a name="l1408"><span class="linenum">1408</span></a>                  echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('tr');
<a name="l1409"><span class="linenum">1409</span></a>              }
<a name="l1410"><span class="linenum">1410</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('table');
<a name="l1411"><span class="linenum">1411</span></a>  
<a name="l1412"><span class="linenum">1412</span></a>          } else {
<a name="l1413"><span class="linenum">1413</span></a>              echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('p', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('keywordssearchresults', 'message', 0), array('class' =&gt; 'heading'));
<a name="l1414"><span class="linenum">1414</span></a>          }
<a name="l1415"><span class="linenum">1415</span></a>      }
<a name="l1416"><span class="linenum">1416</span></a>  
<a name="l1417"><span class="linenum">1417</span></a>      if (!<a class="var it11313" onMouseOver="hilite(11313)" onMouseOut="lolite()" onClick="logVariable('personsearch')" href="../_variables/personsearch.html">$personsearch</a> &amp;&amp; !<a class="var it11314" onMouseOver="hilite(11314)" onMouseOut="lolite()" onClick="logVariable('messagesearch')" href="../_variables/messagesearch.html">$messagesearch</a>) {
<a name="l1418"><span class="linenum">1418</span></a>  <span class="comment">        //they didn't enter any search terms</span>
<a name="l1419"><span class="linenum">1419</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('emptysearchstring', 'message'));
<a name="l1420"><span class="linenum">1420</span></a>      }
<a name="l1421"><span class="linenum">1421</span></a>  
<a name="l1422"><span class="linenum">1422</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l1423"><span class="linenum">1423</span></a>  }
<a name="l1424"><span class="linenum">1424</span></a>  
<a name="l1425"><span class="linenum">1425</span></a>  <span class="comment">/**</span>
<a name="l1426"><span class="linenum">1426</span></a>  <span class="comment"> * Print information on a user. Used when printing search results.</span>
<a name="l1427"><span class="linenum">1427</span></a>  <span class="comment"> *</span>
<a name="l1428"><span class="linenum">1428</span></a>  <span class="comment"> * @param object/bool $user the user to display or false if you just want $USER</span>
<a name="l1429"><span class="linenum">1429</span></a>  <span class="comment"> * @param bool $iscontact is the user being displayed a contact?</span>
<a name="l1430"><span class="linenum">1430</span></a>  <span class="comment"> * @param bool $isblocked is the user being displayed blocked?</span>
<a name="l1431"><span class="linenum">1431</span></a>  <span class="comment"> * @param bool $includeicontext include text next to the action icons?</span>
<a name="l1432"><span class="linenum">1432</span></a>  <span class="comment"> * @return void</span>
<a name="l1433"><span class="linenum">1433</span></a>  <span class="comment"> */</span>
<a name="l1434"><span class="linenum">1434</span></a>  function <a class="function" onClick="logFunction('message_print_user')" href="../_functions/message_print_user.html" onMouseOver="funcPopup(event,'message_print_user')">message_print_user</a> (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>=false, <a class="var it21260" onMouseOver="hilite(21260)" onMouseOut="lolite()" onClick="logVariable('iscontact')" href="../_variables/iscontact.html">$iscontact</a>=false, <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a>=false, <a class="var it21314" onMouseOver="hilite(21314)" onMouseOut="lolite()" onClick="logVariable('includeicontext')" href="../_variables/includeicontext.html">$includeicontext</a>=false) {
<a name="l1435"><span class="linenum">1435</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l1436"><span class="linenum">1436</span></a>  
<a name="l1437"><span class="linenum">1437</span></a>      <a class="var it21315" onMouseOver="hilite(21315)" onMouseOut="lolite()" onClick="logVariable('userpictureparams')" href="../_variables/userpictureparams.html">$userpictureparams</a> = array('size' =&gt; 20, 'courseid' =&gt; <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l1438"><span class="linenum">1438</span></a>  
<a name="l1439"><span class="linenum">1439</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> === false) {
<a name="l1440"><span class="linenum">1440</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it21315" onMouseOver="hilite(21315)" onMouseOut="lolite()" onClick="logVariable('userpictureparams')" href="../_variables/userpictureparams.html">$userpictureparams</a>);
<a name="l1441"><span class="linenum">1441</span></a>      } else if (<a class="class" onClick="logClass('core_user')" href="../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('is_real_user')" href="../_functions/is_real_user.html" onMouseOver="funcPopup(event,'is_real_user')">is_real_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) { // If not real user, then don't show any links.
<a name="l1442"><span class="linenum">1442</span></a>          <a class="var it21315" onMouseOver="hilite(21315)" onMouseOut="lolite()" onClick="logVariable('userpictureparams')" href="../_variables/userpictureparams.html">$userpictureparams</a>['link'] = false;
<a name="l1443"><span class="linenum">1443</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it21315" onMouseOver="hilite(21315)" onMouseOut="lolite()" onClick="logVariable('userpictureparams')" href="../_variables/userpictureparams.html">$userpictureparams</a>);
<a name="l1444"><span class="linenum">1444</span></a>          echo <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l1445"><span class="linenum">1445</span></a>      } else {
<a name="l1446"><span class="linenum">1446</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it21315" onMouseOver="hilite(21315)" onMouseOut="lolite()" onClick="logVariable('userpictureparams')" href="../_variables/userpictureparams.html">$userpictureparams</a>);
<a name="l1447"><span class="linenum">1447</span></a>  
<a name="l1448"><span class="linenum">1448</span></a>          <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(&quot;/message/index.php?id=<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>&quot;);
<a name="l1449"><span class="linenum">1449</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('action_link')" href="../_functions/action_link.html" onMouseOver="funcPopup(event,'action_link')">action_link</a>(<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a>, <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>), null, array('title' =&gt;
<a name="l1450"><span class="linenum">1450</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('sendmessageto', 'message', <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>))));
<a name="l1451"><span class="linenum">1451</span></a>  
<a name="l1452"><span class="linenum">1452</span></a>          <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a> = false;
<a name="l1453"><span class="linenum">1453</span></a>          <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a> = null;
<a name="l1454"><span class="linenum">1454</span></a>          if (<a class="var it21260" onMouseOver="hilite(21260)" onMouseOut="lolite()" onClick="logVariable('iscontact')" href="../_variables/iscontact.html">$iscontact</a>) {
<a name="l1455"><span class="linenum">1455</span></a>              <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'remove', <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it21314" onMouseOver="hilite(21314)" onMouseOut="lolite()" onClick="logVariable('includeicontext')" href="../_variables/includeicontext.html">$includeicontext</a>);
<a name="l1456"><span class="linenum">1456</span></a>          } else {
<a name="l1457"><span class="linenum">1457</span></a>              <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'add', <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it21314" onMouseOver="hilite(21314)" onMouseOut="lolite()" onClick="logVariable('includeicontext')" href="../_variables/includeicontext.html">$includeicontext</a>);
<a name="l1458"><span class="linenum">1458</span></a>          }
<a name="l1459"><span class="linenum">1459</span></a>  
<a name="l1460"><span class="linenum">1460</span></a>          if (<a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a>) {
<a name="l1461"><span class="linenum">1461</span></a>              <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'unblock', <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it21314" onMouseOver="hilite(21314)" onMouseOut="lolite()" onClick="logVariable('includeicontext')" href="../_variables/includeicontext.html">$includeicontext</a>);
<a name="l1462"><span class="linenum">1462</span></a>          } else {
<a name="l1463"><span class="linenum">1463</span></a>              <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'block', <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it21314" onMouseOver="hilite(21314)" onMouseOut="lolite()" onClick="logVariable('includeicontext')" href="../_variables/includeicontext.html">$includeicontext</a>);
<a name="l1464"><span class="linenum">1464</span></a>          }
<a name="l1465"><span class="linenum">1465</span></a>      }
<a name="l1466"><span class="linenum">1466</span></a>  }
<a name="l1467"><span class="linenum">1467</span></a>  
<a name="l1468"><span class="linenum">1468</span></a>  <span class="comment">/**</span>
<a name="l1469"><span class="linenum">1469</span></a>  <span class="comment"> * Print a message contact link</span>
<a name="l1470"><span class="linenum">1470</span></a>  <span class="comment"> *</span>
<a name="l1471"><span class="linenum">1471</span></a>  <span class="comment"> * @param int $userid the ID of the user to apply to action to</span>
<a name="l1472"><span class="linenum">1472</span></a>  <span class="comment"> * @param string $linktype can be add, remove, block or unblock</span>
<a name="l1473"><span class="linenum">1473</span></a>  <span class="comment"> * @param bool $return if true return the link as a string. If false echo the link.</span>
<a name="l1474"><span class="linenum">1474</span></a>  <span class="comment"> * @param string $script the URL to send the user to when the link is clicked. If null, the current page.</span>
<a name="l1475"><span class="linenum">1475</span></a>  <span class="comment"> * @param bool $text include text next to the icons?</span>
<a name="l1476"><span class="linenum">1476</span></a>  <span class="comment"> * @param bool $icon include a graphical icon?</span>
<a name="l1477"><span class="linenum">1477</span></a>  <span class="comment"> * @return string  if $return is true otherwise bool</span>
<a name="l1478"><span class="linenum">1478</span></a>  <span class="comment"> */</span>
<a name="l1479"><span class="linenum">1479</span></a>  function <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it21316" onMouseOver="hilite(21316)" onMouseOut="lolite()" onClick="logVariable('linktype')" href="../_variables/linktype.html">$linktype</a>='add', <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>=false, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>=null, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>=false, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>=true) {
<a name="l1480"><span class="linenum">1480</span></a>      global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>;
<a name="l1481"><span class="linenum">1481</span></a>  
<a name="l1482"><span class="linenum">1482</span></a>  <span class="comment">    //hold onto the strings as we're probably creating a bunch of links</span>
<a name="l1483"><span class="linenum">1483</span></a>      static <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>;
<a name="l1484"><span class="linenum">1484</span></a>  
<a name="l1485"><span class="linenum">1485</span></a>      if (empty(<a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>)) {
<a name="l1486"><span class="linenum">1486</span></a>  <span class="comment">        //strip off previous action params like 'removecontact'</span>
<a name="l1487"><span class="linenum">1487</span></a>          <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a> = <a class="function" onClick="logFunction('message_remove_url_params')" href="../_functions/message_remove_url_params.html" onMouseOver="funcPopup(event,'message_remove_url_params')">message_remove_url_params</a>(<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a>);
<a name="l1488"><span class="linenum">1488</span></a>      }
<a name="l1489"><span class="linenum">1489</span></a>  
<a name="l1490"><span class="linenum">1490</span></a>      if (empty(<a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('blockcontact')" class="var it40152" onMouseOver="hilite(40152)" onMouseOut="lolite()" href="../_variables/blockcontact.html">blockcontact</a>)) {
<a name="l1491"><span class="linenum">1491</span></a>         <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a> = new stdClass();
<a name="l1492"><span class="linenum">1492</span></a>         <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('blockcontact')" class="var it40152" onMouseOver="hilite(40152)" onMouseOut="lolite()" href="../_variables/blockcontact.html">blockcontact</a>   =  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('blockcontact', 'message');
<a name="l1493"><span class="linenum">1493</span></a>         <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('unblockcontact')" class="var it40152" onMouseOver="hilite(40152)" onMouseOut="lolite()" href="../_variables/unblockcontact.html">unblockcontact</a> =  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unblockcontact', 'message');
<a name="l1494"><span class="linenum">1494</span></a>         <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('removecontact')" class="var it40152" onMouseOver="hilite(40152)" onMouseOut="lolite()" href="../_variables/removecontact.html">removecontact</a>  =  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('removecontact', 'message');
<a name="l1495"><span class="linenum">1495</span></a>         <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>-&gt;<a onClick="logVariable('addcontact')" class="var it40152" onMouseOver="hilite(40152)" onMouseOut="lolite()" href="../_variables/addcontact.html">addcontact</a>     =  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('addcontact', 'message');
<a name="l1496"><span class="linenum">1496</span></a>      }
<a name="l1497"><span class="linenum">1497</span></a>  
<a name="l1498"><span class="linenum">1498</span></a>      <a class="var it2835" onMouseOver="hilite(2835)" onMouseOut="lolite()" onClick="logVariable('command')" href="../_variables/command.html">$command</a> = <a class="var it21316" onMouseOver="hilite(21316)" onMouseOut="lolite()" onClick="logVariable('linktype')" href="../_variables/linktype.html">$linktype</a>.'contact';
<a name="l1499"><span class="linenum">1499</span></a>      <a class="var it160" onMouseOver="hilite(160)" onMouseOut="lolite()" onClick="logVariable('string')" href="../_variables/string.html">$string</a>  = <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>-&gt;{<a class="var it2835" onMouseOver="hilite(2835)" onMouseOut="lolite()" onClick="logVariable('command')" href="../_variables/command.html">$command</a>};
<a name="l1500"><span class="linenum">1500</span></a>  
<a name="l1501"><span class="linenum">1501</span></a>      <a class="var it21317" onMouseOver="hilite(21317)" onMouseOut="lolite()" onClick="logVariable('safealttext')" href="../_variables/safealttext.html">$safealttext</a> = <a class="function" onClick="logFunction('s')" href="../_functions/s.html" onMouseOver="funcPopup(event,'s')">s</a>(<a class="var it160" onMouseOver="hilite(160)" onMouseOut="lolite()" onClick="logVariable('string')" href="../_variables/string.html">$string</a>);
<a name="l1502"><span class="linenum">1502</span></a>  
<a name="l1503"><span class="linenum">1503</span></a>      <a class="var it21318" onMouseOver="hilite(21318)" onMouseOut="lolite()" onClick="logVariable('safestring')" href="../_variables/safestring.html">$safestring</a> = '';
<a name="l1504"><span class="linenum">1504</span></a>      if (!empty(<a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>)) {
<a name="l1505"><span class="linenum">1505</span></a>          <a class="var it21318" onMouseOver="hilite(21318)" onMouseOut="lolite()" onClick="logVariable('safestring')" href="../_variables/safestring.html">$safestring</a> = <a class="var it21317" onMouseOver="hilite(21317)" onMouseOut="lolite()" onClick="logVariable('safealttext')" href="../_variables/safealttext.html">$safealttext</a>;
<a name="l1506"><span class="linenum">1506</span></a>      }
<a name="l1507"><span class="linenum">1507</span></a>  
<a name="l1508"><span class="linenum">1508</span></a>      <a class="var it2843" onMouseOver="hilite(2843)" onMouseOut="lolite()" onClick="logVariable('img')" href="../_variables/img.html">$img</a> = '';
<a name="l1509"><span class="linenum">1509</span></a>      if (<a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>) {
<a name="l1510"><span class="linenum">1510</span></a>          <a class="var it20836" onMouseOver="hilite(20836)" onMouseOut="lolite()" onClick="logVariable('iconpath')" href="../_variables/iconpath.html">$iconpath</a> = null;
<a name="l1511"><span class="linenum">1511</span></a>          switch (<a class="var it21316" onMouseOver="hilite(21316)" onMouseOut="lolite()" onClick="logVariable('linktype')" href="../_variables/linktype.html">$linktype</a>) {
<a name="l1512"><span class="linenum">1512</span></a>              case 'block':
<a name="l1513"><span class="linenum">1513</span></a>                  <a class="var it20836" onMouseOver="hilite(20836)" onMouseOut="lolite()" onClick="logVariable('iconpath')" href="../_variables/iconpath.html">$iconpath</a> = 't/block';
<a name="l1514"><span class="linenum">1514</span></a>                  break;
<a name="l1515"><span class="linenum">1515</span></a>              case 'unblock':
<a name="l1516"><span class="linenum">1516</span></a>                  <a class="var it20836" onMouseOver="hilite(20836)" onMouseOut="lolite()" onClick="logVariable('iconpath')" href="../_variables/iconpath.html">$iconpath</a> = 't/unblock';
<a name="l1517"><span class="linenum">1517</span></a>                  break;
<a name="l1518"><span class="linenum">1518</span></a>              case 'remove':
<a name="l1519"><span class="linenum">1519</span></a>                  <a class="var it20836" onMouseOver="hilite(20836)" onMouseOut="lolite()" onClick="logVariable('iconpath')" href="../_variables/iconpath.html">$iconpath</a> = 't/removecontact';
<a name="l1520"><span class="linenum">1520</span></a>                  break;
<a name="l1521"><span class="linenum">1521</span></a>              case 'add':
<a name="l1522"><span class="linenum">1522</span></a>              default:
<a name="l1523"><span class="linenum">1523</span></a>                  <a class="var it20836" onMouseOver="hilite(20836)" onMouseOut="lolite()" onClick="logVariable('iconpath')" href="../_variables/iconpath.html">$iconpath</a> = 't/addcontact';
<a name="l1524"><span class="linenum">1524</span></a>          }
<a name="l1525"><span class="linenum">1525</span></a>  
<a name="l1526"><span class="linenum">1526</span></a>          <a class="var it2843" onMouseOver="hilite(2843)" onMouseOut="lolite()" onClick="logVariable('img')" href="../_variables/img.html">$img</a> = '&lt;img src=&quot;'.<a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_url')" href="../_functions/pix_url.html" onMouseOver="funcPopup(event,'pix_url')">pix_url</a>(<a class="var it20836" onMouseOver="hilite(20836)" onMouseOut="lolite()" onClick="logVariable('iconpath')" href="../_variables/iconpath.html">$iconpath</a>).'&quot; class=&quot;iconsmall&quot; alt=&quot;'.<a class="var it21317" onMouseOver="hilite(21317)" onMouseOut="lolite()" onClick="logVariable('safealttext')" href="../_variables/safealttext.html">$safealttext</a>.'&quot; /&gt;';
<a name="l1527"><span class="linenum">1527</span></a>      }
<a name="l1528"><span class="linenum">1528</span></a>  
<a name="l1529"><span class="linenum">1529</span></a>      <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> = '&lt;span class=&quot;'.<a class="var it21316" onMouseOver="hilite(21316)" onMouseOut="lolite()" onClick="logVariable('linktype')" href="../_variables/linktype.html">$linktype</a>.'contact&quot;&gt;'.
<a name="l1530"><span class="linenum">1530</span></a>                '&lt;a href=&quot;'.<a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>.'&amp;amp;'.<a class="var it2835" onMouseOver="hilite(2835)" onMouseOut="lolite()" onClick="logVariable('command')" href="../_variables/command.html">$command</a>.'='.<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>.
<a name="l1531"><span class="linenum">1531</span></a>                '&amp;amp;sesskey='.<a class="function" onClick="logFunction('sesskey')" href="../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>().'&quot; title=&quot;'.<a class="var it21317" onMouseOver="hilite(21317)" onMouseOut="lolite()" onClick="logVariable('safealttext')" href="../_variables/safealttext.html">$safealttext</a>.'&quot;&gt;'.
<a name="l1532"><span class="linenum">1532</span></a>                <a class="var it2843" onMouseOver="hilite(2843)" onMouseOut="lolite()" onClick="logVariable('img')" href="../_variables/img.html">$img</a>.
<a name="l1533"><span class="linenum">1533</span></a>                <a class="var it21318" onMouseOver="hilite(21318)" onMouseOut="lolite()" onClick="logVariable('safestring')" href="../_variables/safestring.html">$safestring</a>.'&lt;/a&gt;&lt;/span&gt;';
<a name="l1534"><span class="linenum">1534</span></a>  
<a name="l1535"><span class="linenum">1535</span></a>      if (<a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>) {
<a name="l1536"><span class="linenum">1536</span></a>          return <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a>;
<a name="l1537"><span class="linenum">1537</span></a>      } else {
<a name="l1538"><span class="linenum">1538</span></a>          echo <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a>;
<a name="l1539"><span class="linenum">1539</span></a>          return true;
<a name="l1540"><span class="linenum">1540</span></a>      }
<a name="l1541"><span class="linenum">1541</span></a>  }
<a name="l1542"><span class="linenum">1542</span></a>  
<a name="l1543"><span class="linenum">1543</span></a>  <span class="comment">/**</span>
<a name="l1544"><span class="linenum">1544</span></a>  <span class="comment"> * echo or return a link to take the user to the full message history between themselves and another user</span>
<a name="l1545"><span class="linenum">1545</span></a>  <span class="comment"> *</span>
<a name="l1546"><span class="linenum">1546</span></a>  <span class="comment"> * @param int $userid1 the ID of the user displayed on the left (usually the current user)</span>
<a name="l1547"><span class="linenum">1547</span></a>  <span class="comment"> * @param int $userid2 the ID of the other user</span>
<a name="l1548"><span class="linenum">1548</span></a>  <span class="comment"> * @param bool $return true to return the link as a string. False to echo the link.</span>
<a name="l1549"><span class="linenum">1549</span></a>  <span class="comment"> * @param string $keywords any keywords to highlight in the message history</span>
<a name="l1550"><span class="linenum">1550</span></a>  <span class="comment"> * @param string $position anchor name to jump to within the message history</span>
<a name="l1551"><span class="linenum">1551</span></a>  <span class="comment"> * @param string $linktext optionally specify the link text</span>
<a name="l1552"><span class="linenum">1552</span></a>  <span class="comment"> * @return string|bool. Returns a string if $return is true. Otherwise returns a boolean.</span>
<a name="l1553"><span class="linenum">1553</span></a>  <span class="comment"> */</span>
<a name="l1554"><span class="linenum">1554</span></a>  function <a class="function" onClick="logFunction('message_history_link')" href="../_functions/message_history_link.html" onMouseOver="funcPopup(event,'message_history_link')">message_history_link</a>(<a class="var it21319" onMouseOver="hilite(21319)" onMouseOut="lolite()" onClick="logVariable('userid1')" href="../_variables/userid1.html">$userid1</a>, <a class="var it21320" onMouseOver="hilite(21320)" onMouseOut="lolite()" onClick="logVariable('userid2')" href="../_variables/userid2.html">$userid2</a>, <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>=false, <a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>='', <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('position')" href="../_variables/position.html">$position</a>='', <a class="var it2915" onMouseOver="hilite(2915)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../_variables/linktext.html">$linktext</a>='') {
<a name="l1555"><span class="linenum">1555</span></a>      global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>;
<a name="l1556"><span class="linenum">1556</span></a>      static <a class="var it21321" onMouseOver="hilite(21321)" onMouseOut="lolite()" onClick="logVariable('strmessagehistory')" href="../_variables/strmessagehistory.html">$strmessagehistory</a>;
<a name="l1557"><span class="linenum">1557</span></a>  
<a name="l1558"><span class="linenum">1558</span></a>      if (empty(<a class="var it21321" onMouseOver="hilite(21321)" onMouseOut="lolite()" onClick="logVariable('strmessagehistory')" href="../_variables/strmessagehistory.html">$strmessagehistory</a>)) {
<a name="l1559"><span class="linenum">1559</span></a>          <a class="var it21321" onMouseOver="hilite(21321)" onMouseOut="lolite()" onClick="logVariable('strmessagehistory')" href="../_variables/strmessagehistory.html">$strmessagehistory</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('messagehistory', 'message');
<a name="l1560"><span class="linenum">1560</span></a>      }
<a name="l1561"><span class="linenum">1561</span></a>  
<a name="l1562"><span class="linenum">1562</span></a>      if (<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('position')" href="../_variables/position.html">$position</a>) {
<a name="l1563"><span class="linenum">1563</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('position')" href="../_variables/position.html">$position</a> = &quot;#<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('position')" href="../_variables/position.html">$position</a>&quot;;
<a name="l1564"><span class="linenum">1564</span></a>      }
<a name="l1565"><span class="linenum">1565</span></a>      if (<a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>) {
<a name="l1566"><span class="linenum">1566</span></a>          <a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a> = &quot;&amp;search=&quot;.<a class="phpfunction" onClick="logFunction('urlencode')" href="../_functions/urlencode.html" onMouseOver="phpfuncPopup(event,'urlencode')">urlencode</a>(<a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>);
<a name="l1567"><span class="linenum">1567</span></a>      }
<a name="l1568"><span class="linenum">1568</span></a>  
<a name="l1569"><span class="linenum">1569</span></a>      if (<a class="var it2915" onMouseOver="hilite(2915)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../_variables/linktext.html">$linktext</a> == 'icon') {  // Icon only
<a name="l1570"><span class="linenum">1570</span></a>          <a class="var it21322" onMouseOver="hilite(21322)" onMouseOut="lolite()" onClick="logVariable('fulllink')" href="../_variables/fulllink.html">$fulllink</a> = '&lt;img src=&quot;'.<a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_url')" href="../_functions/pix_url.html" onMouseOver="funcPopup(event,'pix_url')">pix_url</a>('t/messages') . '&quot; class=&quot;iconsmall&quot; alt=&quot;'.<a class="var it21321" onMouseOver="hilite(21321)" onMouseOut="lolite()" onClick="logVariable('strmessagehistory')" href="../_variables/strmessagehistory.html">$strmessagehistory</a>.'&quot; /&gt;';
<a name="l1571"><span class="linenum">1571</span></a>      } else if (<a class="var it2915" onMouseOver="hilite(2915)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../_variables/linktext.html">$linktext</a> == 'both') {  // Icon and standard name
<a name="l1572"><span class="linenum">1572</span></a>          <a class="var it21322" onMouseOver="hilite(21322)" onMouseOut="lolite()" onClick="logVariable('fulllink')" href="../_variables/fulllink.html">$fulllink</a> = '&lt;img src=&quot;'.<a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_url')" href="../_functions/pix_url.html" onMouseOver="funcPopup(event,'pix_url')">pix_url</a>('t/messages') . '&quot; class=&quot;iconsmall&quot; alt=&quot;&quot; /&gt;';
<a name="l1573"><span class="linenum">1573</span></a>          <a class="var it21322" onMouseOver="hilite(21322)" onMouseOut="lolite()" onClick="logVariable('fulllink')" href="../_variables/fulllink.html">$fulllink</a> .= '&amp;nbsp;'.<a class="var it21321" onMouseOver="hilite(21321)" onMouseOut="lolite()" onClick="logVariable('strmessagehistory')" href="../_variables/strmessagehistory.html">$strmessagehistory</a>;
<a name="l1574"><span class="linenum">1574</span></a>      } else if (<a class="var it2915" onMouseOver="hilite(2915)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../_variables/linktext.html">$linktext</a>) {    // Custom name
<a name="l1575"><span class="linenum">1575</span></a>          <a class="var it21322" onMouseOver="hilite(21322)" onMouseOut="lolite()" onClick="logVariable('fulllink')" href="../_variables/fulllink.html">$fulllink</a> = <a class="var it2915" onMouseOver="hilite(2915)" onMouseOut="lolite()" onClick="logVariable('linktext')" href="../_variables/linktext.html">$linktext</a>;
<a name="l1576"><span class="linenum">1576</span></a>      } else {                   // Standard name only
<a name="l1577"><span class="linenum">1577</span></a>          <a class="var it21322" onMouseOver="hilite(21322)" onMouseOut="lolite()" onClick="logVariable('fulllink')" href="../_variables/fulllink.html">$fulllink</a> = <a class="var it21321" onMouseOver="hilite(21321)" onMouseOut="lolite()" onClick="logVariable('strmessagehistory')" href="../_variables/strmessagehistory.html">$strmessagehistory</a>;
<a name="l1578"><span class="linenum">1578</span></a>      }
<a name="l1579"><span class="linenum">1579</span></a>  
<a name="l1580"><span class="linenum">1580</span></a>      <a class="var it13445" onMouseOver="hilite(13445)" onMouseOut="lolite()" onClick="logVariable('popupoptions')" href="../_variables/popupoptions.html">$popupoptions</a> = array(
<a name="l1581"><span class="linenum">1581</span></a>              'height' =&gt; 500,
<a name="l1582"><span class="linenum">1582</span></a>              'width' =&gt; 500,
<a name="l1583"><span class="linenum">1583</span></a>              'menubar' =&gt; false,
<a name="l1584"><span class="linenum">1584</span></a>              'location' =&gt; false,
<a name="l1585"><span class="linenum">1585</span></a>              'status' =&gt; true,
<a name="l1586"><span class="linenum">1586</span></a>              'scrollbars' =&gt; true,
<a name="l1587"><span class="linenum">1587</span></a>              'resizable' =&gt; true);
<a name="l1588"><span class="linenum">1588</span></a>  
<a name="l1589"><span class="linenum">1589</span></a>      <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/message/index.php?history='.<a class="constant" onClick="logConstant('MESSAGE_HISTORY_ALL')" href="../_constants/MESSAGE_HISTORY_ALL.html" onMouseOver="constPopup(event,'MESSAGE_HISTORY_ALL')">MESSAGE_HISTORY_ALL</a>.&quot;&amp;user1=<a class="var it21319" onMouseOver="hilite(21319)" onMouseOut="lolite()" onClick="logVariable('userid1')" href="../_variables/userid1.html">$userid1</a>&amp;user2=<a class="var it21320" onMouseOver="hilite(21320)" onMouseOut="lolite()" onClick="logVariable('userid2')" href="../_variables/userid2.html">$userid2</a><a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a><a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('position')" href="../_variables/position.html">$position</a>&quot;);
<a name="l1590"><span class="linenum">1590</span></a>      if (<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a> &amp;&amp; <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a>-&gt;<a class="function" onClick="logFunction('get_param')" href="../_functions/get_param.html" onMouseOver="funcPopup(event,'get_param')">get_param</a>('viewing')) {
<a name="l1591"><span class="linenum">1591</span></a>          <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a>-&gt;<a class="function" onClick="logFunction('param')" href="../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>('viewing', <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('url')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/url.html">url</a>-&gt;<a class="function" onClick="logFunction('get_param')" href="../_functions/get_param.html" onMouseOver="funcPopup(event,'get_param')">get_param</a>('viewing'));
<a name="l1592"><span class="linenum">1592</span></a>      }
<a name="l1593"><span class="linenum">1593</span></a>      <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> = null;
<a name="l1594"><span class="linenum">1594</span></a>      <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a> = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('action_link')" href="../_functions/action_link.html" onMouseOver="funcPopup(event,'action_link')">action_link</a>(<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a>, <a class="var it21322" onMouseOver="hilite(21322)" onMouseOut="lolite()" onClick="logVariable('fulllink')" href="../_variables/fulllink.html">$fulllink</a>, <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a>, array('title' =&gt; <a class="var it21321" onMouseOver="hilite(21321)" onMouseOut="lolite()" onClick="logVariable('strmessagehistory')" href="../_variables/strmessagehistory.html">$strmessagehistory</a>));
<a name="l1595"><span class="linenum">1595</span></a>  
<a name="l1596"><span class="linenum">1596</span></a>      <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a> = '&lt;span class=&quot;history&quot;&gt;'.<a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>.'&lt;/span&gt;';
<a name="l1597"><span class="linenum">1597</span></a>  
<a name="l1598"><span class="linenum">1598</span></a>      if (<a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>) {
<a name="l1599"><span class="linenum">1599</span></a>          return <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>;
<a name="l1600"><span class="linenum">1600</span></a>      } else {
<a name="l1601"><span class="linenum">1601</span></a>          echo <a class="var it332" onMouseOver="hilite(332)" onMouseOut="lolite()" onClick="logVariable('str')" href="../_variables/str.html">$str</a>;
<a name="l1602"><span class="linenum">1602</span></a>          return true;
<a name="l1603"><span class="linenum">1603</span></a>      }
<a name="l1604"><span class="linenum">1604</span></a>  }
<a name="l1605"><span class="linenum">1605</span></a>  
<a name="l1606"><span class="linenum">1606</span></a>  
<a name="l1607"><span class="linenum">1607</span></a>  <span class="comment">/**</span>
<a name="l1608"><span class="linenum">1608</span></a>  <span class="comment"> * Search through course users.</span>
<a name="l1609"><span class="linenum">1609</span></a>  <span class="comment"> *</span>
<a name="l1610"><span class="linenum">1610</span></a>  <span class="comment"> * If $courseids contains the site course then this function searches</span>
<a name="l1611"><span class="linenum">1611</span></a>  <span class="comment"> * through all undeleted and confirmed users.</span>
<a name="l1612"><span class="linenum">1612</span></a>  <span class="comment"> *</span>
<a name="l1613"><span class="linenum">1613</span></a>  <span class="comment"> * @param int|array $courseids Course ID or array of course IDs.</span>
<a name="l1614"><span class="linenum">1614</span></a>  <span class="comment"> * @param string $searchtext the text to search for.</span>
<a name="l1615"><span class="linenum">1615</span></a>  <span class="comment"> * @param string $sort the column name to order by.</span>
<a name="l1616"><span class="linenum">1616</span></a>  <span class="comment"> * @param string|array $exceptions comma separated list or array of user IDs to exclude.</span>
<a name="l1617"><span class="linenum">1617</span></a>  <span class="comment"> * @return array An array of {@link $USER} records.</span>
<a name="l1618"><span class="linenum">1618</span></a>  <span class="comment"> */</span>
<a name="l1619"><span class="linenum">1619</span></a>  function <a class="function" onClick="logFunction('message_search_users')" href="../_functions/message_search_users.html" onMouseOver="funcPopup(event,'message_search_users')">message_search_users</a>(<a class="var it2977" onMouseOver="hilite(2977)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../_variables/courseids.html">$courseids</a>, <a class="var it3109" onMouseOver="hilite(3109)" onMouseOut="lolite()" onClick="logVariable('searchtext')" href="../_variables/searchtext.html">$searchtext</a>, <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>='', <a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>='') {
<a name="l1620"><span class="linenum">1620</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1621"><span class="linenum">1621</span></a>  
<a name="l1622"><span class="linenum">1622</span></a>  <span class="comment">    // Basic validation to ensure that the parameter $courseids is not an empty array or an empty value.</span>
<a name="l1623"><span class="linenum">1623</span></a>      if (!<a class="var it2977" onMouseOver="hilite(2977)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../_variables/courseids.html">$courseids</a>) {
<a name="l1624"><span class="linenum">1624</span></a>          <a class="var it2977" onMouseOver="hilite(2977)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../_variables/courseids.html">$courseids</a> = array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l1625"><span class="linenum">1625</span></a>      }
<a name="l1626"><span class="linenum">1626</span></a>  
<a name="l1627"><span class="linenum">1627</span></a>  <span class="comment">    // Allow an integer to be passed.</span>
<a name="l1628"><span class="linenum">1628</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it2977" onMouseOver="hilite(2977)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../_variables/courseids.html">$courseids</a>)) {
<a name="l1629"><span class="linenum">1629</span></a>          <a class="var it2977" onMouseOver="hilite(2977)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../_variables/courseids.html">$courseids</a> = array(<a class="var it2977" onMouseOver="hilite(2977)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../_variables/courseids.html">$courseids</a>);
<a name="l1630"><span class="linenum">1630</span></a>      }
<a name="l1631"><span class="linenum">1631</span></a>  
<a name="l1632"><span class="linenum">1632</span></a>      <a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../_variables/fullname.html">$fullname</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_fullname')" href="../_functions/sql_fullname.html" onMouseOver="funcPopup(event,'sql_fullname')">sql_fullname</a>();
<a name="l1633"><span class="linenum">1633</span></a>      <a class="var it21259" onMouseOver="hilite(21259)" onMouseOut="lolite()" onClick="logVariable('ufields')" href="../_variables/ufields.html">$ufields</a> = <a class="class" onClick="logClass('user_picture')" href="../_classes/user_picture.html" onMouseOver="classPopup(event,'user_picture')">user_picture</a>::<a class="function" onClick="logFunction('fields')" href="../_functions/fields.html" onMouseOver="funcPopup(event,'fields')">fields</a>('u');
<a name="l1634"><span class="linenum">1634</span></a>  
<a name="l1635"><span class="linenum">1635</span></a>      if (!empty(<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>)) {
<a name="l1636"><span class="linenum">1636</span></a>          <a class="var it2283" onMouseOver="hilite(2283)" onMouseOut="lolite()" onClick="logVariable('order')" href="../_variables/order.html">$order</a> = ' ORDER BY '. <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>;
<a name="l1637"><span class="linenum">1637</span></a>      } else {
<a name="l1638"><span class="linenum">1638</span></a>          <a class="var it2283" onMouseOver="hilite(2283)" onMouseOut="lolite()" onClick="logVariable('order')" href="../_variables/order.html">$order</a> = '';
<a name="l1639"><span class="linenum">1639</span></a>      }
<a name="l1640"><span class="linenum">1640</span></a>  
<a name="l1641"><span class="linenum">1641</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(
<a name="l1642"><span class="linenum">1642</span></a>          'userid' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1643"><span class="linenum">1643</span></a>          'query' =&gt; &quot;%<a class="var it3109" onMouseOver="hilite(3109)" onMouseOut="lolite()" onClick="logVariable('searchtext')" href="../_variables/searchtext.html">$searchtext</a>%&quot;
<a name="l1644"><span class="linenum">1644</span></a>      );
<a name="l1645"><span class="linenum">1645</span></a>  
<a name="l1646"><span class="linenum">1646</span></a>      if (empty(<a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>)) {
<a name="l1647"><span class="linenum">1647</span></a>          <a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a> = array();
<a name="l1648"><span class="linenum">1648</span></a>      } else if (!empty(<a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_string')" href="../_functions/is_string.html" onMouseOver="phpfuncPopup(event,'is_string')">is_string</a>(<a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>)) {
<a name="l1649"><span class="linenum">1649</span></a>          <a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>);
<a name="l1650"><span class="linenum">1650</span></a>      }
<a name="l1651"><span class="linenum">1651</span></a>  
<a name="l1652"><span class="linenum">1652</span></a>  <span class="comment">    // Ignore self and guest account.</span>
<a name="l1653"><span class="linenum">1653</span></a>      <a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>[] = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1654"><span class="linenum">1654</span></a>      <a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>[] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a>;
<a name="l1655"><span class="linenum">1655</span></a>  
<a name="l1656"><span class="linenum">1656</span></a>  <span class="comment">    // Exclude exceptions from the search result.</span>
<a name="l1657"><span class="linenum">1657</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it7803" onMouseOver="hilite(7803)" onMouseOut="lolite()" onClick="logVariable('except')" href="../_variables/except.html">$except</a>, <a class="var it21323" onMouseOver="hilite(21323)" onMouseOut="lolite()" onClick="logVariable('params_except')" href="../_variables/params_except.html">$params_except</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'param', false);
<a name="l1658"><span class="linenum">1658</span></a>      <a class="var it7803" onMouseOver="hilite(7803)" onMouseOut="lolite()" onClick="logVariable('except')" href="../_variables/except.html">$except</a> = ' AND u.id ' . <a class="var it7803" onMouseOver="hilite(7803)" onMouseOut="lolite()" onClick="logVariable('except')" href="../_variables/except.html">$except</a>;
<a name="l1659"><span class="linenum">1659</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it21323" onMouseOver="hilite(21323)" onMouseOut="lolite()" onClick="logVariable('params_except')" href="../_variables/params_except.html">$params_except</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1660"><span class="linenum">1660</span></a>  
<a name="l1661"><span class="linenum">1661</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, <a class="var it2977" onMouseOver="hilite(2977)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../_variables/courseids.html">$courseids</a>)) {
<a name="l1662"><span class="linenum">1662</span></a>  <span class="comment">        // Search on site level.</span>
<a name="l1663"><span class="linenum">1663</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT <a class="var it21259" onMouseOver="hilite(21259)" onMouseOut="lolite()" onClick="logVariable('ufields')" href="../_variables/ufields.html">$ufields</a>, mc.id as contactlistid, mc.blocked
<a name="l1664"><span class="linenum">1664</span></a>                                         FROM {user} u
<a name="l1665"><span class="linenum">1665</span></a>                                         LEFT JOIN {message_contacts} mc
<a name="l1666"><span class="linenum">1666</span></a>                                              ON mc.contactid = u.id AND mc.userid = :userid
<a name="l1667"><span class="linenum">1667</span></a>                                        WHERE u.deleted = '0' AND u.confirmed = '1'
<a name="l1668"><span class="linenum">1668</span></a>                                              AND (&quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>(<a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../_variables/fullname.html">$fullname</a>, ':query', false).&quot;)
<a name="l1669"><span class="linenum">1669</span></a>                                              <a class="var it7803" onMouseOver="hilite(7803)" onMouseOut="lolite()" onClick="logVariable('except')" href="../_variables/except.html">$except</a>
<a name="l1670"><span class="linenum">1670</span></a>                                       <a class="var it2283" onMouseOver="hilite(2283)" onMouseOut="lolite()" onClick="logVariable('order')" href="../_variables/order.html">$order</a>&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1671"><span class="linenum">1671</span></a>      } else {
<a name="l1672"><span class="linenum">1672</span></a>  <span class="comment">        // Search in courses.</span>
<a name="l1673"><span class="linenum">1673</span></a>  
<a name="l1674"><span class="linenum">1674</span></a>  <span class="comment">        // Getting the context IDs or each course.</span>
<a name="l1675"><span class="linenum">1675</span></a>          <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a> = array();
<a name="l1676"><span class="linenum">1676</span></a>          foreach (<a class="var it2977" onMouseOver="hilite(2977)" onMouseOut="lolite()" onClick="logVariable('courseids')" href="../_variables/courseids.html">$courseids</a> as <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>) {
<a name="l1677"><span class="linenum">1677</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>);
<a name="l1678"><span class="linenum">1678</span></a>              <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true));
<a name="l1679"><span class="linenum">1679</span></a>          }
<a name="l1680"><span class="linenum">1680</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it21324" onMouseOver="hilite(21324)" onMouseOut="lolite()" onClick="logVariable('contextwhere')" href="../_variables/contextwhere.html">$contextwhere</a>, <a class="var it12555" onMouseOver="hilite(12555)" onMouseOut="lolite()" onClick="logVariable('contextparams')" href="../_variables/contextparams.html">$contextparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="phpfunction" onClick="logFunction('array_unique')" href="../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'context');
<a name="l1681"><span class="linenum">1681</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it12555" onMouseOver="hilite(12555)" onMouseOut="lolite()" onClick="logVariable('contextparams')" href="../_variables/contextparams.html">$contextparams</a>);
<a name="l1682"><span class="linenum">1682</span></a>  
<a name="l1683"><span class="linenum">1683</span></a>  <span class="comment">        // Everyone who has a role assignment in this course or higher.</span>
<a name="l1684"><span class="linenum">1684</span></a>  <span class="comment">        // TODO: add enabled enrolment join here (skodak)</span>
<a name="l1685"><span class="linenum">1685</span></a>          <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT DISTINCT <a class="var it21259" onMouseOver="hilite(21259)" onMouseOut="lolite()" onClick="logVariable('ufields')" href="../_variables/ufields.html">$ufields</a>, mc.id as contactlistid, mc.blocked
<a name="l1686"><span class="linenum">1686</span></a>                                           FROM {user} u
<a name="l1687"><span class="linenum">1687</span></a>                                           JOIN {role_assignments} ra ON ra.userid = u.id
<a name="l1688"><span class="linenum">1688</span></a>                                           LEFT JOIN {message_contacts} mc
<a name="l1689"><span class="linenum">1689</span></a>                                                ON mc.contactid = u.id AND mc.userid = :userid
<a name="l1690"><span class="linenum">1690</span></a>                                          WHERE u.deleted = '0' AND u.confirmed = '1'
<a name="l1691"><span class="linenum">1691</span></a>                                                AND (&quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>(<a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../_variables/fullname.html">$fullname</a>, ':query', false).&quot;)
<a name="l1692"><span class="linenum">1692</span></a>                                                AND ra.contextid <a class="var it21324" onMouseOver="hilite(21324)" onMouseOut="lolite()" onClick="logVariable('contextwhere')" href="../_variables/contextwhere.html">$contextwhere</a>
<a name="l1693"><span class="linenum">1693</span></a>                                                <a class="var it7803" onMouseOver="hilite(7803)" onMouseOut="lolite()" onClick="logVariable('except')" href="../_variables/except.html">$except</a>
<a name="l1694"><span class="linenum">1694</span></a>                                         <a class="var it2283" onMouseOver="hilite(2283)" onMouseOut="lolite()" onClick="logVariable('order')" href="../_variables/order.html">$order</a>&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1695"><span class="linenum">1695</span></a>  
<a name="l1696"><span class="linenum">1696</span></a>          return <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>;
<a name="l1697"><span class="linenum">1697</span></a>      }
<a name="l1698"><span class="linenum">1698</span></a>  }
<a name="l1699"><span class="linenum">1699</span></a>  
<a name="l1700"><span class="linenum">1700</span></a>  <span class="comment">/**</span>
<a name="l1701"><span class="linenum">1701</span></a>  <span class="comment"> * Search a user's messages</span>
<a name="l1702"><span class="linenum">1702</span></a>  <span class="comment"> *</span>
<a name="l1703"><span class="linenum">1703</span></a>  <span class="comment"> * Returns a list of posts found using an array of search terms</span>
<a name="l1704"><span class="linenum">1704</span></a>  <span class="comment"> * eg   word  +word -word</span>
<a name="l1705"><span class="linenum">1705</span></a>  <span class="comment"> *</span>
<a name="l1706"><span class="linenum">1706</span></a>  <span class="comment"> * @param array $searchterms an array of search terms (strings)</span>
<a name="l1707"><span class="linenum">1707</span></a>  <span class="comment"> * @param bool $fromme include messages from the user?</span>
<a name="l1708"><span class="linenum">1708</span></a>  <span class="comment"> * @param bool $tome include messages to the user?</span>
<a name="l1709"><span class="linenum">1709</span></a>  <span class="comment"> * @param mixed $courseid SITEID for admins searching all messages. Other behaviour not yet implemented</span>
<a name="l1710"><span class="linenum">1710</span></a>  <span class="comment"> * @param int $userid the user ID of the current user</span>
<a name="l1711"><span class="linenum">1711</span></a>  <span class="comment"> * @return mixed An array of messages or false if no matching messages were found</span>
<a name="l1712"><span class="linenum">1712</span></a>  <span class="comment"> */</span>
<a name="l1713"><span class="linenum">1713</span></a>  function <a class="function" onClick="logFunction('message_search')" href="../_functions/message_search.html" onMouseOver="funcPopup(event,'message_search')">message_search</a>(<a class="var it7826" onMouseOver="hilite(7826)" onMouseOut="lolite()" onClick="logVariable('searchterms')" href="../_variables/searchterms.html">$searchterms</a>, <a class="var it21301" onMouseOver="hilite(21301)" onMouseOut="lolite()" onClick="logVariable('fromme')" href="../_variables/fromme.html">$fromme</a>=true, <a class="var it21300" onMouseOver="hilite(21300)" onMouseOut="lolite()" onClick="logVariable('tome')" href="../_variables/tome.html">$tome</a>=true, <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>='none', <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>=0) {
<a name="l1714"><span class="linenum">1714</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1715"><span class="linenum">1715</span></a>  
<a name="l1716"><span class="linenum">1716</span></a>  <span class="comment">    // If user is searching all messages check they are allowed to before doing anything else.</span>
<a name="l1717"><span class="linenum">1717</span></a>      if (<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a> &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:readallmessages', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>())) {
<a name="l1718"><span class="linenum">1718</span></a>          <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('accessdenied','admin');
<a name="l1719"><span class="linenum">1719</span></a>      }
<a name="l1720"><span class="linenum">1720</span></a>  
<a name="l1721"><span class="linenum">1721</span></a>  <span class="comment">    // If no userid sent then assume current user.</span>
<a name="l1722"><span class="linenum">1722</span></a>      if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> == 0) <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1723"><span class="linenum">1723</span></a>  
<a name="l1724"><span class="linenum">1724</span></a>  <span class="comment">    // Some differences in SQL syntax.</span>
<a name="l1725"><span class="linenum">1725</span></a>      if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_regex_supported')" href="../_functions/sql_regex_supported.html" onMouseOver="funcPopup(event,'sql_regex_supported')">sql_regex_supported</a>()) {
<a name="l1726"><span class="linenum">1726</span></a>          <a class="var it7827" onMouseOver="hilite(7827)" onMouseOut="lolite()" onClick="logVariable('REGEXP')" href="../_variables/REGEXP.html">$REGEXP</a>    = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_regex')" href="../_functions/sql_regex.html" onMouseOver="funcPopup(event,'sql_regex')">sql_regex</a>(true);
<a name="l1727"><span class="linenum">1727</span></a>          <a class="var it7828" onMouseOver="hilite(7828)" onMouseOut="lolite()" onClick="logVariable('NOTREGEXP')" href="../_variables/NOTREGEXP.html">$NOTREGEXP</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_regex')" href="../_functions/sql_regex.html" onMouseOver="funcPopup(event,'sql_regex')">sql_regex</a>(false);
<a name="l1728"><span class="linenum">1728</span></a>      }
<a name="l1729"><span class="linenum">1729</span></a>  
<a name="l1730"><span class="linenum">1730</span></a>      <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a> = array();
<a name="l1731"><span class="linenum">1731</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l1732"><span class="linenum">1732</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> = 0;
<a name="l1733"><span class="linenum">1733</span></a>  
<a name="l1734"><span class="linenum">1734</span></a>  <span class="comment">    // Preprocess search terms to check whether we have at least 1 eligible search term.</span>
<a name="l1735"><span class="linenum">1735</span></a>  <span class="comment">    // If we do we can drop words around it like 'a'.</span>
<a name="l1736"><span class="linenum">1736</span></a>      <a class="var it21325" onMouseOver="hilite(21325)" onMouseOut="lolite()" onClick="logVariable('dropshortwords')" href="../_variables/dropshortwords.html">$dropshortwords</a> = false;
<a name="l1737"><span class="linenum">1737</span></a>      foreach (<a class="var it7826" onMouseOver="hilite(7826)" onMouseOut="lolite()" onClick="logVariable('searchterms')" href="../_variables/searchterms.html">$searchterms</a> as <a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>) {
<a name="l1738"><span class="linenum">1738</span></a>          if (<a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>) &gt;= 2) {
<a name="l1739"><span class="linenum">1739</span></a>              <a class="var it21325" onMouseOver="hilite(21325)" onMouseOut="lolite()" onClick="logVariable('dropshortwords')" href="../_variables/dropshortwords.html">$dropshortwords</a> = true;
<a name="l1740"><span class="linenum">1740</span></a>          }
<a name="l1741"><span class="linenum">1741</span></a>      }
<a name="l1742"><span class="linenum">1742</span></a>  
<a name="l1743"><span class="linenum">1743</span></a>      foreach (<a class="var it7826" onMouseOver="hilite(7826)" onMouseOut="lolite()" onClick="logVariable('searchterms')" href="../_variables/searchterms.html">$searchterms</a> as <a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>) {
<a name="l1744"><span class="linenum">1744</span></a>          <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>++;
<a name="l1745"><span class="linenum">1745</span></a>  
<a name="l1746"><span class="linenum">1746</span></a>          <a class="var it7830" onMouseOver="hilite(7830)" onMouseOut="lolite()" onClick="logVariable('NOT')" href="../_variables/NOT.html">$NOT</a> = false; <span class="comment">// Initially we aren't going to perform NOT LIKE searches, only MSSQL and Oracle.</span>
<a name="l1747"><span class="linenum">1747</span></a>  
<a name="l1748"><span class="linenum">1748</span></a>          if (<a class="var it21325" onMouseOver="hilite(21325)" onMouseOut="lolite()" onClick="logVariable('dropshortwords')" href="../_variables/dropshortwords.html">$dropshortwords</a> &amp;&amp; <a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>) &lt; 2) {
<a name="l1749"><span class="linenum">1749</span></a>              continue;
<a name="l1750"><span class="linenum">1750</span></a>          }
<a name="l1751"><span class="linenum">1751</span></a>  <span class="comment">        // Under Oracle and MSSQL, trim the + and - operators and perform simpler LIKE search.</span>
<a name="l1752"><span class="linenum">1752</span></a>          if (!<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_regex_supported')" href="../_functions/sql_regex_supported.html" onMouseOver="funcPopup(event,'sql_regex_supported')">sql_regex_supported</a>()) {
<a name="l1753"><span class="linenum">1753</span></a>              if (<a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>, 0, 1) == '-') {
<a name="l1754"><span class="linenum">1754</span></a>                  <a class="var it7830" onMouseOver="hilite(7830)" onMouseOut="lolite()" onClick="logVariable('NOT')" href="../_variables/NOT.html">$NOT</a> = true;
<a name="l1755"><span class="linenum">1755</span></a>              }
<a name="l1756"><span class="linenum">1756</span></a>              <a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>, '+-');
<a name="l1757"><span class="linenum">1757</span></a>          }
<a name="l1758"><span class="linenum">1758</span></a>  
<a name="l1759"><span class="linenum">1759</span></a>          if (<a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>,0,1) == &quot;+&quot;) {
<a name="l1760"><span class="linenum">1760</span></a>              <a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>,1);
<a name="l1761"><span class="linenum">1761</span></a>              <a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a> = <a class="phpfunction" onClick="logFunction('preg_quote')" href="../_functions/preg_quote.html" onMouseOver="phpfuncPopup(event,'preg_quote')">preg_quote</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>, '|');
<a name="l1762"><span class="linenum">1762</span></a>              <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a>[] = &quot;m.fullmessage <a class="var it7827" onMouseOver="hilite(7827)" onMouseOut="lolite()" onClick="logVariable('REGEXP')" href="../_variables/REGEXP.html">$REGEXP</a> :ss<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>&quot;;
<a name="l1763"><span class="linenum">1763</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['ss'.<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>] = &quot;(^|[^a-zA-Z0-9])<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>([^a-zA-Z0-9]|$)&quot;;
<a name="l1764"><span class="linenum">1764</span></a>  
<a name="l1765"><span class="linenum">1765</span></a>          } else if (<a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>,0,1) == &quot;-&quot;) {
<a name="l1766"><span class="linenum">1766</span></a>              <a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>,1);
<a name="l1767"><span class="linenum">1767</span></a>              <a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a> = <a class="phpfunction" onClick="logFunction('preg_quote')" href="../_functions/preg_quote.html" onMouseOver="phpfuncPopup(event,'preg_quote')">preg_quote</a>(<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>, '|');
<a name="l1768"><span class="linenum">1768</span></a>              <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a>[] = &quot;m.fullmessage <a class="var it7828" onMouseOver="hilite(7828)" onMouseOut="lolite()" onClick="logVariable('NOTREGEXP')" href="../_variables/NOTREGEXP.html">$NOTREGEXP</a> :ss<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>&quot;;
<a name="l1769"><span class="linenum">1769</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['ss'.<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>] = &quot;(^|[^a-zA-Z0-9])<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>([^a-zA-Z0-9]|$)&quot;;
<a name="l1770"><span class="linenum">1770</span></a>  
<a name="l1771"><span class="linenum">1771</span></a>          } else {
<a name="l1772"><span class="linenum">1772</span></a>              <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a>[] = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>(&quot;m.fullmessage&quot;, &quot;:ss<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>&quot;, false, true, <a class="var it7830" onMouseOver="hilite(7830)" onMouseOut="lolite()" onClick="logVariable('NOT')" href="../_variables/NOT.html">$NOT</a>);
<a name="l1773"><span class="linenum">1773</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['ss'.<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>] = &quot;%<a class="var it5872" onMouseOver="hilite(5872)" onMouseOut="lolite()" onClick="logVariable('searchterm')" href="../_variables/searchterm.html">$searchterm</a>%&quot;;
<a name="l1774"><span class="linenum">1774</span></a>          }
<a name="l1775"><span class="linenum">1775</span></a>      }
<a name="l1776"><span class="linenum">1776</span></a>  
<a name="l1777"><span class="linenum">1777</span></a>      if (empty(<a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a>)) {
<a name="l1778"><span class="linenum">1778</span></a>          <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a> = &quot; &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('m.fullmessage', ':ss1', false);
<a name="l1779"><span class="linenum">1779</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['ss1'] = &quot;%&quot;;
<a name="l1780"><span class="linenum">1780</span></a>      } else {
<a name="l1781"><span class="linenum">1781</span></a>          <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot; AND &quot;, <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a>);
<a name="l1782"><span class="linenum">1782</span></a>      }
<a name="l1783"><span class="linenum">1783</span></a>  
<a name="l1784"><span class="linenum">1784</span></a>  <span class="comment">    // There are several possibilities</span>
<a name="l1785"><span class="linenum">1785</span></a>  <span class="comment">    // 1. courseid = SITEID : The admin is searching messages by all users</span>
<a name="l1786"><span class="linenum">1786</span></a>  <span class="comment">    // 2. courseid = ??     : A teacher is searching messages by users in</span>
<a name="l1787"><span class="linenum">1787</span></a>  <span class="comment">    //                        one of their courses - currently disabled</span>
<a name="l1788"><span class="linenum">1788</span></a>  <span class="comment">    // 3. courseid = none   : User is searching their own messages;</span>
<a name="l1789"><span class="linenum">1789</span></a>  <span class="comment">    //    a.  Messages from user</span>
<a name="l1790"><span class="linenum">1790</span></a>  <span class="comment">    //    b.  Messages to user</span>
<a name="l1791"><span class="linenum">1791</span></a>  <span class="comment">    //    c.  Messages to and from user</span>
<a name="l1792"><span class="linenum">1792</span></a>  
<a name="l1793"><span class="linenum">1793</span></a>      if (<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) { // Admin is searching all messages.
<a name="l1794"><span class="linenum">1794</span></a>          <a class="var it21326" onMouseOver="hilite(21326)" onMouseOut="lolite()" onClick="logVariable('m_read')" href="../_variables/m_read.html">$m_read</a>   = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT m.id, m.useridto, m.useridfrom, m.smallmessage, m.fullmessage, m.timecreated
<a name="l1795"><span class="linenum">1795</span></a>                                              FROM {message_read} m
<a name="l1796"><span class="linenum">1796</span></a>                                             WHERE <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a>&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, 0, <a class="constant" onClick="logConstant('MESSAGE_SEARCH_MAX_RESULTS')" href="../_constants/MESSAGE_SEARCH_MAX_RESULTS.html" onMouseOver="constPopup(event,'MESSAGE_SEARCH_MAX_RESULTS')">MESSAGE_SEARCH_MAX_RESULTS</a>);
<a name="l1797"><span class="linenum">1797</span></a>          <a class="var it21327" onMouseOver="hilite(21327)" onMouseOut="lolite()" onClick="logVariable('m_unread')" href="../_variables/m_unread.html">$m_unread</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT m.id, m.useridto, m.useridfrom, m.smallmessage, m.fullmessage, m.timecreated
<a name="l1798"><span class="linenum">1798</span></a>                                              FROM {message} m
<a name="l1799"><span class="linenum">1799</span></a>                                             WHERE <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a>&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, 0, <a class="constant" onClick="logConstant('MESSAGE_SEARCH_MAX_RESULTS')" href="../_constants/MESSAGE_SEARCH_MAX_RESULTS.html" onMouseOver="constPopup(event,'MESSAGE_SEARCH_MAX_RESULTS')">MESSAGE_SEARCH_MAX_RESULTS</a>);
<a name="l1800"><span class="linenum">1800</span></a>  
<a name="l1801"><span class="linenum">1801</span></a>      } else if (<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> !== 'none') {
<a name="l1802"><span class="linenum">1802</span></a>  <span class="comment">        // This has not been implemented due to security concerns.</span>
<a name="l1803"><span class="linenum">1803</span></a>          <a class="var it21326" onMouseOver="hilite(21326)" onMouseOut="lolite()" onClick="logVariable('m_read')" href="../_variables/m_read.html">$m_read</a>   = array();
<a name="l1804"><span class="linenum">1804</span></a>          <a class="var it21327" onMouseOver="hilite(21327)" onMouseOut="lolite()" onClick="logVariable('m_unread')" href="../_variables/m_unread.html">$m_unread</a> = array();
<a name="l1805"><span class="linenum">1805</span></a>  
<a name="l1806"><span class="linenum">1806</span></a>      } else {
<a name="l1807"><span class="linenum">1807</span></a>  
<a name="l1808"><span class="linenum">1808</span></a>          if (<a class="var it21301" onMouseOver="hilite(21301)" onMouseOut="lolite()" onClick="logVariable('fromme')" href="../_variables/fromme.html">$fromme</a> and <a class="var it21300" onMouseOver="hilite(21300)" onMouseOut="lolite()" onClick="logVariable('tome')" href="../_variables/tome.html">$tome</a>) {
<a name="l1809"><span class="linenum">1809</span></a>              <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a> .= &quot; AND (m.useridfrom=:userid1 OR m.useridto=:userid2)&quot;;
<a name="l1810"><span class="linenum">1810</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid1'] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l1811"><span class="linenum">1811</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid2'] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l1812"><span class="linenum">1812</span></a>  
<a name="l1813"><span class="linenum">1813</span></a>          } else if (<a class="var it21301" onMouseOver="hilite(21301)" onMouseOut="lolite()" onClick="logVariable('fromme')" href="../_variables/fromme.html">$fromme</a>) {
<a name="l1814"><span class="linenum">1814</span></a>              <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a> .= &quot; AND m.useridfrom=:userid&quot;;
<a name="l1815"><span class="linenum">1815</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid'] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l1816"><span class="linenum">1816</span></a>  
<a name="l1817"><span class="linenum">1817</span></a>          } else if (<a class="var it21300" onMouseOver="hilite(21300)" onMouseOut="lolite()" onClick="logVariable('tome')" href="../_variables/tome.html">$tome</a>) {
<a name="l1818"><span class="linenum">1818</span></a>              <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a> .= &quot; AND m.useridto=:userid&quot;;
<a name="l1819"><span class="linenum">1819</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid'] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l1820"><span class="linenum">1820</span></a>          }
<a name="l1821"><span class="linenum">1821</span></a>  
<a name="l1822"><span class="linenum">1822</span></a>          <a class="var it21326" onMouseOver="hilite(21326)" onMouseOut="lolite()" onClick="logVariable('m_read')" href="../_variables/m_read.html">$m_read</a>   = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT m.id, m.useridto, m.useridfrom, m.smallmessage, m.fullmessage, m.timecreated
<a name="l1823"><span class="linenum">1823</span></a>                                              FROM {message_read} m
<a name="l1824"><span class="linenum">1824</span></a>                                             WHERE <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a>&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, 0, <a class="constant" onClick="logConstant('MESSAGE_SEARCH_MAX_RESULTS')" href="../_constants/MESSAGE_SEARCH_MAX_RESULTS.html" onMouseOver="constPopup(event,'MESSAGE_SEARCH_MAX_RESULTS')">MESSAGE_SEARCH_MAX_RESULTS</a>);
<a name="l1825"><span class="linenum">1825</span></a>          <a class="var it21327" onMouseOver="hilite(21327)" onMouseOut="lolite()" onClick="logVariable('m_unread')" href="../_variables/m_unread.html">$m_unread</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT m.id, m.useridto, m.useridfrom, m.smallmessage, m.fullmessage, m.timecreated
<a name="l1826"><span class="linenum">1826</span></a>                                              FROM {message} m
<a name="l1827"><span class="linenum">1827</span></a>                                             WHERE <a class="var it7829" onMouseOver="hilite(7829)" onMouseOut="lolite()" onClick="logVariable('searchcond')" href="../_variables/searchcond.html">$searchcond</a>&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, 0, <a class="constant" onClick="logConstant('MESSAGE_SEARCH_MAX_RESULTS')" href="../_constants/MESSAGE_SEARCH_MAX_RESULTS.html" onMouseOver="constPopup(event,'MESSAGE_SEARCH_MAX_RESULTS')">MESSAGE_SEARCH_MAX_RESULTS</a>);
<a name="l1828"><span class="linenum">1828</span></a>  
<a name="l1829"><span class="linenum">1829</span></a>      }
<a name="l1830"><span class="linenum">1830</span></a>  
<a name="l1831"><span class="linenum">1831</span></a>  <span class="comment">    /// The keys may be duplicated in $m_read and $m_unread so we can't</span>
<a name="l1832"><span class="linenum">1832</span></a>  <span class="comment">    /// do a simple concatenation</span>
<a name="l1833"><span class="linenum">1833</span></a>      <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> = array();
<a name="l1834"><span class="linenum">1834</span></a>      foreach (<a class="var it21326" onMouseOver="hilite(21326)" onMouseOut="lolite()" onClick="logVariable('m_read')" href="../_variables/m_read.html">$m_read</a> as <a class="var it1752" onMouseOver="hilite(1752)" onMouseOut="lolite()" onClick="logVariable('m')" href="../_variables/m.html">$m</a>) {
<a name="l1835"><span class="linenum">1835</span></a>          <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>[] = <a class="var it1752" onMouseOver="hilite(1752)" onMouseOut="lolite()" onClick="logVariable('m')" href="../_variables/m.html">$m</a>;
<a name="l1836"><span class="linenum">1836</span></a>      }
<a name="l1837"><span class="linenum">1837</span></a>      foreach (<a class="var it21327" onMouseOver="hilite(21327)" onMouseOut="lolite()" onClick="logVariable('m_unread')" href="../_variables/m_unread.html">$m_unread</a> as <a class="var it1752" onMouseOver="hilite(1752)" onMouseOut="lolite()" onClick="logVariable('m')" href="../_variables/m.html">$m</a>) {
<a name="l1838"><span class="linenum">1838</span></a>          <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>[] = <a class="var it1752" onMouseOver="hilite(1752)" onMouseOut="lolite()" onClick="logVariable('m')" href="../_variables/m.html">$m</a>;
<a name="l1839"><span class="linenum">1839</span></a>      }
<a name="l1840"><span class="linenum">1840</span></a>  
<a name="l1841"><span class="linenum">1841</span></a>      return (empty(<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>)) ? false : <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>;
<a name="l1842"><span class="linenum">1842</span></a>  }
<a name="l1843"><span class="linenum">1843</span></a>  
<a name="l1844"><span class="linenum">1844</span></a>  <span class="comment">/**</span>
<a name="l1845"><span class="linenum">1845</span></a>  <span class="comment"> * Given a message object that we already know has a long message</span>
<a name="l1846"><span class="linenum">1846</span></a>  <span class="comment"> * this function truncates the message nicely to the first</span>
<a name="l1847"><span class="linenum">1847</span></a>  <span class="comment"> * sane place between $CFG-&gt;forum_longpost and $CFG-&gt;forum_shortpost</span>
<a name="l1848"><span class="linenum">1848</span></a>  <span class="comment"> *</span>
<a name="l1849"><span class="linenum">1849</span></a>  <span class="comment"> * @param string $message the message</span>
<a name="l1850"><span class="linenum">1850</span></a>  <span class="comment"> * @param int $minlength the minimum length to trim the message to</span>
<a name="l1851"><span class="linenum">1851</span></a>  <span class="comment"> * @return string the shortened message</span>
<a name="l1852"><span class="linenum">1852</span></a>  <span class="comment"> */</span>
<a name="l1853"><span class="linenum">1853</span></a>  function <a class="function" onClick="logFunction('message_shorten_message')" href="../_functions/message_shorten_message.html" onMouseOver="funcPopup(event,'message_shorten_message')">message_shorten_message</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it21328" onMouseOver="hilite(21328)" onMouseOut="lolite()" onClick="logVariable('minlength')" href="../_variables/minlength.html">$minlength</a> = 0) {
<a name="l1854"><span class="linenum">1854</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> = 0;
<a name="l1855"><span class="linenum">1855</span></a>      <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../_variables/tag.html">$tag</a> = false;
<a name="l1856"><span class="linenum">1856</span></a>      <a class="var it1293" onMouseOver="hilite(1293)" onMouseOut="lolite()" onClick="logVariable('length')" href="../_variables/length.html">$length</a> = <a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>);
<a name="l1857"><span class="linenum">1857</span></a>      <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> = 0;
<a name="l1858"><span class="linenum">1858</span></a>      <a class="var it21329" onMouseOver="hilite(21329)" onMouseOut="lolite()" onClick="logVariable('stopzone')" href="../_variables/stopzone.html">$stopzone</a> = false;
<a name="l1859"><span class="linenum">1859</span></a>      <a class="var it13166" onMouseOver="hilite(13166)" onMouseOut="lolite()" onClick="logVariable('truncate')" href="../_variables/truncate.html">$truncate</a> = 0;
<a name="l1860"><span class="linenum">1860</span></a>      if (<a class="var it21328" onMouseOver="hilite(21328)" onMouseOut="lolite()" onClick="logVariable('minlength')" href="../_variables/minlength.html">$minlength</a> == 0) <a class="var it21328" onMouseOver="hilite(21328)" onMouseOut="lolite()" onClick="logVariable('minlength')" href="../_variables/minlength.html">$minlength</a> = <a class="constant" onClick="logConstant('MESSAGE_SHORTLENGTH')" href="../_constants/MESSAGE_SHORTLENGTH.html" onMouseOver="constPopup(event,'MESSAGE_SHORTLENGTH')">MESSAGE_SHORTLENGTH</a>;
<a name="l1861"><span class="linenum">1861</span></a>  
<a name="l1862"><span class="linenum">1862</span></a>  
<a name="l1863"><span class="linenum">1863</span></a>      for (<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>=0; <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>&lt;<a class="var it1293" onMouseOver="hilite(1293)" onMouseOut="lolite()" onClick="logVariable('length')" href="../_variables/length.html">$length</a>; <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>++) {
<a name="l1864"><span class="linenum">1864</span></a>          <a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('char')" href="../_variables/char.html">$char</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>[<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>];
<a name="l1865"><span class="linenum">1865</span></a>  
<a name="l1866"><span class="linenum">1866</span></a>          switch (<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('char')" href="../_variables/char.html">$char</a>) {
<a name="l1867"><span class="linenum">1867</span></a>              case &quot;&lt;&quot;:
<a name="l1868"><span class="linenum">1868</span></a>                  <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../_variables/tag.html">$tag</a> = true;
<a name="l1869"><span class="linenum">1869</span></a>                  break;
<a name="l1870"><span class="linenum">1870</span></a>              case &quot;&gt;&quot;:
<a name="l1871"><span class="linenum">1871</span></a>                  <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../_variables/tag.html">$tag</a> = false;
<a name="l1872"><span class="linenum">1872</span></a>                  break;
<a name="l1873"><span class="linenum">1873</span></a>              default:
<a name="l1874"><span class="linenum">1874</span></a>                  if (!<a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('tag')" href="../_variables/tag.html">$tag</a>) {
<a name="l1875"><span class="linenum">1875</span></a>                      if (<a class="var it21329" onMouseOver="hilite(21329)" onMouseOut="lolite()" onClick="logVariable('stopzone')" href="../_variables/stopzone.html">$stopzone</a>) {
<a name="l1876"><span class="linenum">1876</span></a>                          if (<a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('char')" href="../_variables/char.html">$char</a> == '.' or <a class="var it2425" onMouseOver="hilite(2425)" onMouseOut="lolite()" onClick="logVariable('char')" href="../_variables/char.html">$char</a> == ' ') {
<a name="l1877"><span class="linenum">1877</span></a>                              <a class="var it13166" onMouseOver="hilite(13166)" onMouseOut="lolite()" onClick="logVariable('truncate')" href="../_variables/truncate.html">$truncate</a> = <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>+1;
<a name="l1878"><span class="linenum">1878</span></a>                              break 2;
<a name="l1879"><span class="linenum">1879</span></a>                          }
<a name="l1880"><span class="linenum">1880</span></a>                      }
<a name="l1881"><span class="linenum">1881</span></a>                      <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a>++;
<a name="l1882"><span class="linenum">1882</span></a>                  }
<a name="l1883"><span class="linenum">1883</span></a>                  break;
<a name="l1884"><span class="linenum">1884</span></a>          }
<a name="l1885"><span class="linenum">1885</span></a>          if (!<a class="var it21329" onMouseOver="hilite(21329)" onMouseOut="lolite()" onClick="logVariable('stopzone')" href="../_variables/stopzone.html">$stopzone</a>) {
<a name="l1886"><span class="linenum">1886</span></a>              if (<a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> &gt; <a class="var it21328" onMouseOver="hilite(21328)" onMouseOut="lolite()" onClick="logVariable('minlength')" href="../_variables/minlength.html">$minlength</a>) {
<a name="l1887"><span class="linenum">1887</span></a>                  <a class="var it21329" onMouseOver="hilite(21329)" onMouseOut="lolite()" onClick="logVariable('stopzone')" href="../_variables/stopzone.html">$stopzone</a> = true;
<a name="l1888"><span class="linenum">1888</span></a>              }
<a name="l1889"><span class="linenum">1889</span></a>          }
<a name="l1890"><span class="linenum">1890</span></a>      }
<a name="l1891"><span class="linenum">1891</span></a>  
<a name="l1892"><span class="linenum">1892</span></a>      if (!<a class="var it13166" onMouseOver="hilite(13166)" onMouseOut="lolite()" onClick="logVariable('truncate')" href="../_variables/truncate.html">$truncate</a>) {
<a name="l1893"><span class="linenum">1893</span></a>          <a class="var it13166" onMouseOver="hilite(13166)" onMouseOut="lolite()" onClick="logVariable('truncate')" href="../_variables/truncate.html">$truncate</a> = <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>;
<a name="l1894"><span class="linenum">1894</span></a>      }
<a name="l1895"><span class="linenum">1895</span></a>  
<a name="l1896"><span class="linenum">1896</span></a>      return <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, 0, <a class="var it13166" onMouseOver="hilite(13166)" onMouseOut="lolite()" onClick="logVariable('truncate')" href="../_variables/truncate.html">$truncate</a>);
<a name="l1897"><span class="linenum">1897</span></a>  }
<a name="l1898"><span class="linenum">1898</span></a>  
<a name="l1899"><span class="linenum">1899</span></a>  
<a name="l1900"><span class="linenum">1900</span></a>  <span class="comment">/**</span>
<a name="l1901"><span class="linenum">1901</span></a>  <span class="comment"> * Given a string and an array of keywords, this function looks</span>
<a name="l1902"><span class="linenum">1902</span></a>  <span class="comment"> * for the first keyword in the string, and then chops out a</span>
<a name="l1903"><span class="linenum">1903</span></a>  <span class="comment"> * small section from the text that shows that word in context.</span>
<a name="l1904"><span class="linenum">1904</span></a>  <span class="comment"> *</span>
<a name="l1905"><span class="linenum">1905</span></a>  <span class="comment"> * @param string $message the text to search</span>
<a name="l1906"><span class="linenum">1906</span></a>  <span class="comment"> * @param array $keywords array of keywords to find</span>
<a name="l1907"><span class="linenum">1907</span></a>  <span class="comment"> */</span>
<a name="l1908"><span class="linenum">1908</span></a>  function <a class="function" onClick="logFunction('message_get_fragment')" href="../_functions/message_get_fragment.html" onMouseOver="funcPopup(event,'message_get_fragment')">message_get_fragment</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>) {
<a name="l1909"><span class="linenum">1909</span></a>  
<a name="l1910"><span class="linenum">1910</span></a>      <a class="var it21330" onMouseOver="hilite(21330)" onMouseOut="lolite()" onClick="logVariable('fullsize')" href="../_variables/fullsize.html">$fullsize</a> = 160;
<a name="l1911"><span class="linenum">1911</span></a>      <a class="var it21331" onMouseOver="hilite(21331)" onMouseOut="lolite()" onClick="logVariable('halfsize')" href="../_variables/halfsize.html">$halfsize</a> = (int)(<a class="var it21330" onMouseOver="hilite(21330)" onMouseOut="lolite()" onClick="logVariable('fullsize')" href="../_variables/fullsize.html">$fullsize</a>/2);
<a name="l1912"><span class="linenum">1912</span></a>  
<a name="l1913"><span class="linenum">1913</span></a>      <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('strip_tags')" href="../_functions/strip_tags.html" onMouseOver="phpfuncPopup(event,'strip_tags')">strip_tags</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>);
<a name="l1914"><span class="linenum">1914</span></a>  
<a name="l1915"><span class="linenum">1915</span></a>      foreach (<a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a> as <a class="var it476" onMouseOver="hilite(476)" onMouseOut="lolite()" onClick="logVariable('keyword')" href="../_variables/keyword.html">$keyword</a>) {  // Just get the first one
<a name="l1916"><span class="linenum">1916</span></a>          if (<a class="var it476" onMouseOver="hilite(476)" onMouseOut="lolite()" onClick="logVariable('keyword')" href="../_variables/keyword.html">$keyword</a> !== '') {
<a name="l1917"><span class="linenum">1917</span></a>              break;
<a name="l1918"><span class="linenum">1918</span></a>          }
<a name="l1919"><span class="linenum">1919</span></a>      }
<a name="l1920"><span class="linenum">1920</span></a>      if (empty(<a class="var it476" onMouseOver="hilite(476)" onMouseOut="lolite()" onClick="logVariable('keyword')" href="../_variables/keyword.html">$keyword</a>)) {   // None found, so just return start of message
<a name="l1921"><span class="linenum">1921</span></a>          return <a class="function" onClick="logFunction('message_shorten_message')" href="../_functions/message_shorten_message.html" onMouseOver="funcPopup(event,'message_shorten_message')">message_shorten_message</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, 30);
<a name="l1922"><span class="linenum">1922</span></a>      }
<a name="l1923"><span class="linenum">1923</span></a>  
<a name="l1924"><span class="linenum">1924</span></a>      <a class="var it21332" onMouseOver="hilite(21332)" onMouseOut="lolite()" onClick="logVariable('leadin')" href="../_variables/leadin.html">$leadin</a> = <a class="var it21333" onMouseOver="hilite(21333)" onMouseOut="lolite()" onClick="logVariable('leadout')" href="../_variables/leadout.html">$leadout</a> = '';
<a name="l1925"><span class="linenum">1925</span></a>  
<a name="l1926"><span class="linenum">1926</span></a>  <span class="comment">/// Find the start of the fragment</span>
<a name="l1927"><span class="linenum">1927</span></a>      <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a> = 0;
<a name="l1928"><span class="linenum">1928</span></a>      <a class="var it1293" onMouseOver="hilite(1293)" onMouseOut="lolite()" onClick="logVariable('length')" href="../_variables/length.html">$length</a> = <a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>);
<a name="l1929"><span class="linenum">1929</span></a>  
<a name="l1930"><span class="linenum">1930</span></a>      <a class="var it3230" onMouseOver="hilite(3230)" onMouseOut="lolite()" onClick="logVariable('pos')" href="../_variables/pos.html">$pos</a> = <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it476" onMouseOver="hilite(476)" onMouseOut="lolite()" onClick="logVariable('keyword')" href="../_variables/keyword.html">$keyword</a>);
<a name="l1931"><span class="linenum">1931</span></a>      if (<a class="var it3230" onMouseOver="hilite(3230)" onMouseOut="lolite()" onClick="logVariable('pos')" href="../_variables/pos.html">$pos</a> &gt; <a class="var it21331" onMouseOver="hilite(21331)" onMouseOut="lolite()" onClick="logVariable('halfsize')" href="../_variables/halfsize.html">$halfsize</a>) {
<a name="l1932"><span class="linenum">1932</span></a>          <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a> = <a class="var it3230" onMouseOver="hilite(3230)" onMouseOut="lolite()" onClick="logVariable('pos')" href="../_variables/pos.html">$pos</a> - <a class="var it21331" onMouseOver="hilite(21331)" onMouseOut="lolite()" onClick="logVariable('halfsize')" href="../_variables/halfsize.html">$halfsize</a>;
<a name="l1933"><span class="linenum">1933</span></a>          <a class="var it21332" onMouseOver="hilite(21332)" onMouseOut="lolite()" onClick="logVariable('leadin')" href="../_variables/leadin.html">$leadin</a> = '...';
<a name="l1934"><span class="linenum">1934</span></a>      }
<a name="l1935"><span class="linenum">1935</span></a>  <span class="comment">/// Find the end of the fragment</span>
<a name="l1936"><span class="linenum">1936</span></a>      <a class="var it1658" onMouseOver="hilite(1658)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a> = <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a> + <a class="var it21330" onMouseOver="hilite(21330)" onMouseOut="lolite()" onClick="logVariable('fullsize')" href="../_variables/fullsize.html">$fullsize</a>;
<a name="l1937"><span class="linenum">1937</span></a>      if (<a class="var it1658" onMouseOver="hilite(1658)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a> &gt; <a class="var it1293" onMouseOver="hilite(1293)" onMouseOut="lolite()" onClick="logVariable('length')" href="../_variables/length.html">$length</a>) {
<a name="l1938"><span class="linenum">1938</span></a>          <a class="var it1658" onMouseOver="hilite(1658)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a> = <a class="var it1293" onMouseOver="hilite(1293)" onMouseOut="lolite()" onClick="logVariable('length')" href="../_variables/length.html">$length</a>;
<a name="l1939"><span class="linenum">1939</span></a>      } else {
<a name="l1940"><span class="linenum">1940</span></a>          <a class="var it21333" onMouseOver="hilite(21333)" onMouseOut="lolite()" onClick="logVariable('leadout')" href="../_variables/leadout.html">$leadout</a> = '...';
<a name="l1941"><span class="linenum">1941</span></a>      }
<a name="l1942"><span class="linenum">1942</span></a>  
<a name="l1943"><span class="linenum">1943</span></a>  <span class="comment">/// Pull out the fragment and format it</span>
<a name="l1944"><span class="linenum">1944</span></a>  
<a name="l1945"><span class="linenum">1945</span></a>      <a class="var it2264" onMouseOver="hilite(2264)" onMouseOut="lolite()" onClick="logVariable('fragment')" href="../_variables/fragment.html">$fragment</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a>, <a class="var it1658" onMouseOver="hilite(1658)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a> - <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a>);
<a name="l1946"><span class="linenum">1946</span></a>      <a class="var it2264" onMouseOver="hilite(2264)" onMouseOut="lolite()" onClick="logVariable('fragment')" href="../_variables/fragment.html">$fragment</a> = <a class="var it21332" onMouseOver="hilite(21332)" onMouseOut="lolite()" onClick="logVariable('leadin')" href="../_variables/leadin.html">$leadin</a>.<a class="function" onClick="logFunction('highlight')" href="../_functions/highlight.html" onMouseOver="funcPopup(event,'highlight')">highlight</a>(<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(' ',<a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>), <a class="var it2264" onMouseOver="hilite(2264)" onMouseOut="lolite()" onClick="logVariable('fragment')" href="../_variables/fragment.html">$fragment</a>).<a class="var it21333" onMouseOver="hilite(21333)" onMouseOut="lolite()" onClick="logVariable('leadout')" href="../_variables/leadout.html">$leadout</a>;
<a name="l1947"><span class="linenum">1947</span></a>      return <a class="var it2264" onMouseOver="hilite(2264)" onMouseOut="lolite()" onClick="logVariable('fragment')" href="../_variables/fragment.html">$fragment</a>;
<a name="l1948"><span class="linenum">1948</span></a>  }
<a name="l1949"><span class="linenum">1949</span></a>  
<a name="l1950"><span class="linenum">1950</span></a>  <span class="comment">/**</span>
<a name="l1951"><span class="linenum">1951</span></a>  <span class="comment"> * Retrieve the messages between two users</span>
<a name="l1952"><span class="linenum">1952</span></a>  <span class="comment"> *</span>
<a name="l1953"><span class="linenum">1953</span></a>  <span class="comment"> * @param object $user1 the current user</span>
<a name="l1954"><span class="linenum">1954</span></a>  <span class="comment"> * @param object $user2 the other user</span>
<a name="l1955"><span class="linenum">1955</span></a>  <span class="comment"> * @param int $limitnum the maximum number of messages to retrieve</span>
<a name="l1956"><span class="linenum">1956</span></a>  <span class="comment"> * @param bool $viewingnewmessages are we currently viewing new messages?</span>
<a name="l1957"><span class="linenum">1957</span></a>  <span class="comment"> */</span>
<a name="l1958"><span class="linenum">1958</span></a>  function <a class="function" onClick="logFunction('message_get_history')" href="../_functions/message_get_history.html" onMouseOver="funcPopup(event,'message_get_history')">message_get_history</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>=0, <a class="var it1525" onMouseOver="hilite(1525)" onMouseOut="lolite()" onClick="logVariable('viewingnewmessages')" href="../_variables/viewingnewmessages.html">$viewingnewmessages</a>=false) {
<a name="l1959"><span class="linenum">1959</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l1960"><span class="linenum">1960</span></a>  
<a name="l1961"><span class="linenum">1961</span></a>      <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> = array();
<a name="l1962"><span class="linenum">1962</span></a>  
<a name="l1963"><span class="linenum">1963</span></a>  <span class="comment">    //we want messages sorted oldest to newest but if getting a subset of messages we need to sort</span>
<a name="l1964"><span class="linenum">1964</span></a>  <span class="comment">    //desc to get the last $limitnum messages then flip the order in php</span>
<a name="l1965"><span class="linenum">1965</span></a>      <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'asc';
<a name="l1966"><span class="linenum">1966</span></a>      if (<a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>&gt;0) {
<a name="l1967"><span class="linenum">1967</span></a>          <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'desc';
<a name="l1968"><span class="linenum">1968</span></a>      }
<a name="l1969"><span class="linenum">1969</span></a>  
<a name="l1970"><span class="linenum">1970</span></a>      <a class="var it21334" onMouseOver="hilite(21334)" onMouseOut="lolite()" onClick="logVariable('notificationswhere')" href="../_variables/notificationswhere.html">$notificationswhere</a> = null;
<a name="l1971"><span class="linenum">1971</span></a>  <span class="comment">    //we have just moved new messages to read. If theyre here to see new messages dont hide notifications</span>
<a name="l1972"><span class="linenum">1972</span></a>      if (!<a class="var it1525" onMouseOver="hilite(1525)" onMouseOut="lolite()" onClick="logVariable('viewingnewmessages')" href="../_variables/viewingnewmessages.html">$viewingnewmessages</a> &amp;&amp; <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('messaginghidereadnotifications')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/messaginghidereadnotifications.html">messaginghidereadnotifications</a>) {
<a name="l1973"><span class="linenum">1973</span></a>          <a class="var it21334" onMouseOver="hilite(21334)" onMouseOut="lolite()" onClick="logVariable('notificationswhere')" href="../_variables/notificationswhere.html">$notificationswhere</a> = 'AND notification=0';
<a name="l1974"><span class="linenum">1974</span></a>      }
<a name="l1975"><span class="linenum">1975</span></a>  
<a name="l1976"><span class="linenum">1976</span></a>  <span class="comment">    //prevent notifications of your own actions appearing in your own message history</span>
<a name="l1977"><span class="linenum">1977</span></a>      <a class="var it21336" onMouseOver="hilite(21336)" onMouseOut="lolite()" onClick="logVariable('ownnotificationwhere')" href="../_variables/ownnotificationwhere.html">$ownnotificationwhere</a> = ' AND <a class="function" onClick="logFunction('NOT')" href="../_functions/not.html" onMouseOver="funcPopup(event,'not')">NOT</a> (useridfrom=? AND notification=1)';
<a name="l1978"><span class="linenum">1978</span></a>  
<a name="l1979"><span class="linenum">1979</span></a>      if (<a class="var it21337" onMouseOver="hilite(21337)" onMouseOut="lolite()" onClick="logVariable('messages_read')" href="../_variables/messages_read.html">$messages_read</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('message_read', &quot;((useridto = ? AND useridfrom = ?) OR
<a name="l1980"><span class="linenum">1980</span></a>                                                      (useridto = ? AND useridfrom = ?)) <a class="var it21334" onMouseOver="hilite(21334)" onMouseOut="lolite()" onClick="logVariable('notificationswhere')" href="../_variables/notificationswhere.html">$notificationswhere</a> <a class="var it21336" onMouseOver="hilite(21336)" onMouseOut="lolite()" onClick="logVariable('ownnotificationwhere')" href="../_variables/ownnotificationwhere.html">$ownnotificationwhere</a>&quot;,
<a name="l1981"><span class="linenum">1981</span></a>                                                      array(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>),
<a name="l1982"><span class="linenum">1982</span></a>                                                      &quot;timecreated <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>&quot;, '*', 0, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>)) {
<a name="l1983"><span class="linenum">1983</span></a>          foreach (<a class="var it21337" onMouseOver="hilite(21337)" onMouseOut="lolite()" onClick="logVariable('messages_read')" href="../_variables/messages_read.html">$messages_read</a> as <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>) {
<a name="l1984"><span class="linenum">1984</span></a>              <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>[] = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>;
<a name="l1985"><span class="linenum">1985</span></a>          }
<a name="l1986"><span class="linenum">1986</span></a>      }
<a name="l1987"><span class="linenum">1987</span></a>      if (<a class="var it21338" onMouseOver="hilite(21338)" onMouseOut="lolite()" onClick="logVariable('messages_new')" href="../_variables/messages_new.html">$messages_new</a> =  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('message', &quot;((useridto = ? AND useridfrom = ?) OR
<a name="l1988"><span class="linenum">1988</span></a>                                                      (useridto = ? AND useridfrom = ?)) <a class="var it21336" onMouseOver="hilite(21336)" onMouseOut="lolite()" onClick="logVariable('ownnotificationwhere')" href="../_variables/ownnotificationwhere.html">$ownnotificationwhere</a>&quot;,
<a name="l1989"><span class="linenum">1989</span></a>                                                      array(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>),
<a name="l1990"><span class="linenum">1990</span></a>                                                      &quot;timecreated <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>&quot;, '*', 0, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>)) {
<a name="l1991"><span class="linenum">1991</span></a>          foreach (<a class="var it21338" onMouseOver="hilite(21338)" onMouseOut="lolite()" onClick="logVariable('messages_new')" href="../_variables/messages_new.html">$messages_new</a> as <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>) {
<a name="l1992"><span class="linenum">1992</span></a>              <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>[] = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>;
<a name="l1993"><span class="linenum">1993</span></a>          }
<a name="l1994"><span class="linenum">1994</span></a>      }
<a name="l1995"><span class="linenum">1995</span></a>  
<a name="l1996"><span class="linenum">1996</span></a>      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="class" onClick="logClass('core_collator')" href="../_classes/core_collator.html" onMouseOver="classPopup(event,'core_collator')">core_collator</a>::<a class="function" onClick="logFunction('asort_objects_by_property')" href="../_functions/asort_objects_by_property.html" onMouseOver="funcPopup(event,'asort_objects_by_property')">asort_objects_by_property</a>(<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>, 'timecreated', <a class="class" onClick="logClass('core_collator')" href="../_classes/core_collator.html" onMouseOver="classPopup(event,'core_collator')">core_collator</a>::SORT_NUMERIC);
<a name="l1997"><span class="linenum">1997</span></a>  
<a name="l1998"><span class="linenum">1998</span></a>  <span class="comment">    //if we only want the last $limitnum messages</span>
<a name="l1999"><span class="linenum">1999</span></a>      <a class="var it13228" onMouseOver="hilite(13228)" onMouseOut="lolite()" onClick="logVariable('messagecount')" href="../_variables/messagecount.html">$messagecount</a> = <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>);
<a name="l2000"><span class="linenum">2000</span></a>      if (<a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a> &gt; 0 &amp;&amp; <a class="var it13228" onMouseOver="hilite(13228)" onMouseOut="lolite()" onClick="logVariable('messagecount')" href="../_variables/messagecount.html">$messagecount</a> &gt; <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>) {
<a name="l2001"><span class="linenum">2001</span></a>          <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> = <a class="phpfunction" onClick="logFunction('array_slice')" href="../_functions/array_slice.html" onMouseOver="phpfuncPopup(event,'array_slice')">array_slice</a>(<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>, <a class="var it13228" onMouseOver="hilite(13228)" onMouseOut="lolite()" onClick="logVariable('messagecount')" href="../_variables/messagecount.html">$messagecount</a> - <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>, true);
<a name="l2002"><span class="linenum">2002</span></a>      }
<a name="l2003"><span class="linenum">2003</span></a>  
<a name="l2004"><span class="linenum">2004</span></a>      return <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>;
<a name="l2005"><span class="linenum">2005</span></a>  }
<a name="l2006"><span class="linenum">2006</span></a>  
<a name="l2007"><span class="linenum">2007</span></a>  <span class="comment">/**</span>
<a name="l2008"><span class="linenum">2008</span></a>  <span class="comment"> * Print the message history between two users</span>
<a name="l2009"><span class="linenum">2009</span></a>  <span class="comment"> *</span>
<a name="l2010"><span class="linenum">2010</span></a>  <span class="comment"> * @param object $user1 the current user</span>
<a name="l2011"><span class="linenum">2011</span></a>  <span class="comment"> * @param object $user2 the other user</span>
<a name="l2012"><span class="linenum">2012</span></a>  <span class="comment"> * @param string $search search terms to highlight</span>
<a name="l2013"><span class="linenum">2013</span></a>  <span class="comment"> * @param int $messagelimit maximum number of messages to return</span>
<a name="l2014"><span class="linenum">2014</span></a>  <span class="comment"> * @param string $messagehistorylink the html for the message history link or false</span>
<a name="l2015"><span class="linenum">2015</span></a>  <span class="comment"> * @param bool $viewingnewmessages are we currently viewing new messages?</span>
<a name="l2016"><span class="linenum">2016</span></a>  <span class="comment"> */</span>
<a name="l2017"><span class="linenum">2017</span></a>  function <a class="function" onClick="logFunction('message_print_message_history')" href="../_functions/message_print_message_history.html" onMouseOver="funcPopup(event,'message_print_message_history')">message_print_message_history</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a> ,<a class="var it1502" onMouseOver="hilite(1502)" onMouseOut="lolite()" onClick="logVariable('search')" href="../_variables/search.html">$search</a> = '', <a class="var it21339" onMouseOver="hilite(21339)" onMouseOut="lolite()" onClick="logVariable('messagelimit')" href="../_variables/messagelimit.html">$messagelimit</a> = 0, <a class="var it1538" onMouseOver="hilite(1538)" onMouseOut="lolite()" onClick="logVariable('messagehistorylink')" href="../_variables/messagehistorylink.html">$messagehistorylink</a> = false, <a class="var it1525" onMouseOver="hilite(1525)" onMouseOut="lolite()" onClick="logVariable('viewingnewmessages')" href="../_variables/viewingnewmessages.html">$viewingnewmessages</a> = false, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a> = true) {
<a name="l2018"><span class="linenum">2018</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l2019"><span class="linenum">2019</span></a>  
<a name="l2020"><span class="linenum">2020</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_start')" href="../_functions/box_start.html" onMouseOver="funcPopup(event,'box_start')">box_start</a>('center', 'message_user_pictures');
<a name="l2021"><span class="linenum">2021</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_start')" href="../_functions/box_start.html" onMouseOver="funcPopup(event,'box_start')">box_start</a>('user');
<a name="l2022"><span class="linenum">2022</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_start')" href="../_functions/box_start.html" onMouseOver="funcPopup(event,'box_start')">box_start</a>('generalbox', 'user1');
<a name="l2023"><span class="linenum">2023</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>, array('size' =&gt; 100, 'courseid' =&gt; <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>));
<a name="l2024"><span class="linenum">2024</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>), array('class' =&gt; 'heading'));
<a name="l2025"><span class="linenum">2025</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_end')" href="../_functions/box_end.html" onMouseOver="funcPopup(event,'box_end')">box_end</a>();
<a name="l2026"><span class="linenum">2026</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_end')" href="../_functions/box_end.html" onMouseOver="funcPopup(event,'box_end')">box_end</a>();
<a name="l2027"><span class="linenum">2027</span></a>  
<a name="l2028"><span class="linenum">2028</span></a>      <a class="var it21340" onMouseOver="hilite(21340)" onMouseOut="lolite()" onClick="logVariable('imgattr')" href="../_variables/imgattr.html">$imgattr</a> = array('src' =&gt; <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('pix_url')" href="../_functions/pix_url.html" onMouseOver="funcPopup(event,'pix_url')">pix_url</a>('i/twoway'), 'alt' =&gt; '', 'width' =&gt; 16, 'height' =&gt; 16);
<a name="l2029"><span class="linenum">2029</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('empty_tag')" href="../_functions/empty_tag.html" onMouseOver="funcPopup(event,'empty_tag')">empty_tag</a>('img', <a class="var it21340" onMouseOver="hilite(21340)" onMouseOut="lolite()" onClick="logVariable('imgattr')" href="../_variables/imgattr.html">$imgattr</a>), 'between');
<a name="l2030"><span class="linenum">2030</span></a>  
<a name="l2031"><span class="linenum">2031</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_start')" href="../_functions/box_start.html" onMouseOver="funcPopup(event,'box_start')">box_start</a>('user');
<a name="l2032"><span class="linenum">2032</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_start')" href="../_functions/box_start.html" onMouseOver="funcPopup(event,'box_start')">box_start</a>('generalbox', 'user2');
<a name="l2033"><span class="linenum">2033</span></a>  <span class="comment">    // Show user picture with link is real user else without link.</span>
<a name="l2034"><span class="linenum">2034</span></a>      if (<a class="class" onClick="logClass('core_user')" href="../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('is_real_user')" href="../_functions/is_real_user.html" onMouseOver="funcPopup(event,'is_real_user')">is_real_user</a>(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l2035"><span class="linenum">2035</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>, array('size' =&gt; 100, 'courseid' =&gt; <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>));
<a name="l2036"><span class="linenum">2036</span></a>      } else {
<a name="l2037"><span class="linenum">2037</span></a>          echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>, array('size' =&gt; 100, 'courseid' =&gt; <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'link' =&gt; false));
<a name="l2038"><span class="linenum">2038</span></a>      }
<a name="l2039"><span class="linenum">2039</span></a>      echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>), array('class' =&gt; 'heading'));
<a name="l2040"><span class="linenum">2040</span></a>  
<a name="l2041"><span class="linenum">2041</span></a>      if (<a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a> &amp;&amp; isset(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('iscontact')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/iscontact.html">iscontact</a>) &amp;&amp; isset(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('isblocked')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/isblocked.html">isblocked</a>)) {
<a name="l2042"><span class="linenum">2042</span></a>  
<a name="l2043"><span class="linenum">2043</span></a>          <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a> = null;
<a name="l2044"><span class="linenum">2044</span></a>          <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a> = true;
<a name="l2045"><span class="linenum">2045</span></a>          <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a> = false;
<a name="l2046"><span class="linenum">2046</span></a>  
<a name="l2047"><span class="linenum">2047</span></a>          <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_get_contact_add_remove_link')" href="../_functions/message_get_contact_add_remove_link.html" onMouseOver="funcPopup(event,'message_get_contact_add_remove_link')">message_get_contact_add_remove_link</a>(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('iscontact')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/iscontact.html">iscontact</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('isblocked')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/isblocked.html">isblocked</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>);
<a name="l2048"><span class="linenum">2048</span></a>          <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_get_contact_block_link')" href="../_functions/message_get_contact_block_link.html" onMouseOver="funcPopup(event,'message_get_contact_block_link')">message_get_contact_block_link</a>(<a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('iscontact')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/iscontact.html">iscontact</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('isblocked')" class="var it39847" onMouseOver="hilite(39847)" onMouseOut="lolite()" href="../_variables/isblocked.html">isblocked</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>);
<a name="l2049"><span class="linenum">2049</span></a>          <a class="var it21341" onMouseOver="hilite(21341)" onMouseOut="lolite()" onClick="logVariable('useractionlinks')" href="../_variables/useractionlinks.html">$useractionlinks</a> = <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a>.'&amp;nbsp;|&amp;nbsp;'.<a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>;
<a name="l2050"><span class="linenum">2050</span></a>  
<a name="l2051"><span class="linenum">2051</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it21341" onMouseOver="hilite(21341)" onMouseOut="lolite()" onClick="logVariable('useractionlinks')" href="../_variables/useractionlinks.html">$useractionlinks</a>, array('class' =&gt; 'useractionlinks'));
<a name="l2052"><span class="linenum">2052</span></a>      }
<a name="l2053"><span class="linenum">2053</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_end')" href="../_functions/box_end.html" onMouseOver="funcPopup(event,'box_end')">box_end</a>();
<a name="l2054"><span class="linenum">2054</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_end')" href="../_functions/box_end.html" onMouseOver="funcPopup(event,'box_end')">box_end</a>();
<a name="l2055"><span class="linenum">2055</span></a>      echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_end')" href="../_functions/box_end.html" onMouseOver="funcPopup(event,'box_end')">box_end</a>();
<a name="l2056"><span class="linenum">2056</span></a>  
<a name="l2057"><span class="linenum">2057</span></a>      if (!empty(<a class="var it1538" onMouseOver="hilite(1538)" onMouseOut="lolite()" onClick="logVariable('messagehistorylink')" href="../_variables/messagehistorylink.html">$messagehistorylink</a>)) {
<a name="l2058"><span class="linenum">2058</span></a>          echo <a class="var it1538" onMouseOver="hilite(1538)" onMouseOut="lolite()" onClick="logVariable('messagehistorylink')" href="../_variables/messagehistorylink.html">$messagehistorylink</a>;
<a name="l2059"><span class="linenum">2059</span></a>      }
<a name="l2060"><span class="linenum">2060</span></a>  
<a name="l2061"><span class="linenum">2061</span></a>  <span class="comment">    /// Get all the messages and print them</span>
<a name="l2062"><span class="linenum">2062</span></a>      if (<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> = <a class="function" onClick="logFunction('message_get_history')" href="../_functions/message_get_history.html" onMouseOver="funcPopup(event,'message_get_history')">message_get_history</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>, <a class="var it168" onMouseOver="hilite(168)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>, <a class="var it21339" onMouseOver="hilite(21339)" onMouseOut="lolite()" onClick="logVariable('messagelimit')" href="../_variables/messagelimit.html">$messagelimit</a>, <a class="var it1525" onMouseOver="hilite(1525)" onMouseOut="lolite()" onClick="logVariable('viewingnewmessages')" href="../_variables/viewingnewmessages.html">$viewingnewmessages</a>)) {
<a name="l2063"><span class="linenum">2063</span></a>          <a class="var it21342" onMouseOver="hilite(21342)" onMouseOut="lolite()" onClick="logVariable('tablecontents')" href="../_variables/tablecontents.html">$tablecontents</a> = '';
<a name="l2064"><span class="linenum">2064</span></a>  
<a name="l2065"><span class="linenum">2065</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a> = new stdClass();
<a name="l2066"><span class="linenum">2066</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('mday')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/mday.html">mday</a> = '';
<a name="l2067"><span class="linenum">2067</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('month')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/month.html">month</a> = '';
<a name="l2068"><span class="linenum">2068</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('year')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/year.html">year</a> = '';
<a name="l2069"><span class="linenum">2069</span></a>          <a class="var it21344" onMouseOver="hilite(21344)" onMouseOut="lolite()" onClick="logVariable('messagedate')" href="../_variables/messagedate.html">$messagedate</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimetime');
<a name="l2070"><span class="linenum">2070</span></a>          <a class="var it21345" onMouseOver="hilite(21345)" onMouseOut="lolite()" onClick="logVariable('blockdate')" href="../_variables/blockdate.html">$blockdate</a>   = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimedaydate');
<a name="l2071"><span class="linenum">2071</span></a>          foreach (<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> as <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>) {
<a name="l2072"><span class="linenum">2072</span></a>              if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('notification')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/notification.html">notification</a>) {
<a name="l2073"><span class="linenum">2073</span></a>                  <a class="var it21346" onMouseOver="hilite(21346)" onMouseOut="lolite()" onClick="logVariable('notificationclass')" href="../_variables/notificationclass.html">$notificationclass</a> = ' notification';
<a name="l2074"><span class="linenum">2074</span></a>              } else {
<a name="l2075"><span class="linenum">2075</span></a>                  <a class="var it21346" onMouseOver="hilite(21346)" onMouseOut="lolite()" onClick="logVariable('notificationclass')" href="../_variables/notificationclass.html">$notificationclass</a> = null;
<a name="l2076"><span class="linenum">2076</span></a>              }
<a name="l2077"><span class="linenum">2077</span></a>              <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a> = <a class="function" onClick="logFunction('usergetdate')" href="../_functions/usergetdate.html" onMouseOver="funcPopup(event,'usergetdate')">usergetdate</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>);
<a name="l2078"><span class="linenum">2078</span></a>              if (<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('mday')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/mday.html">mday</a> != <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['mday'] | <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('month')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/month.html">month</a> != <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['month'] | <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('year')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/year.html">year</a> != <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['year']) {
<a name="l2079"><span class="linenum">2079</span></a>                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('mday')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/mday.html">mday</a> = <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['mday'];
<a name="l2080"><span class="linenum">2080</span></a>                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('month')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/month.html">month</a> = <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['month'];
<a name="l2081"><span class="linenum">2081</span></a>                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>-&gt;<a onClick="logVariable('year')" class="var it39467" onMouseOver="hilite(39467)" onMouseOut="lolite()" href="../_variables/year.html">year</a> = <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['year'];
<a name="l2082"><span class="linenum">2082</span></a>  
<a name="l2083"><span class="linenum">2083</span></a>                  <a class="var it12930" onMouseOver="hilite(12930)" onMouseOut="lolite()" onClick="logVariable('datestring')" href="../_variables/datestring.html">$datestring</a> = <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('empty_tag')" href="../_functions/empty_tag.html" onMouseOver="funcPopup(event,'empty_tag')">empty_tag</a>('a', array('name' =&gt; <a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['year'].<a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['mon'].<a class="var it1284" onMouseOver="hilite(1284)" onMouseOut="lolite()" onClick="logVariable('date')" href="../_variables/date.html">$date</a>['mday']));
<a name="l2084"><span class="linenum">2084</span></a>                  <a class="var it21342" onMouseOver="hilite(21342)" onMouseOut="lolite()" onClick="logVariable('tablecontents')" href="../_variables/tablecontents.html">$tablecontents</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it12930" onMouseOver="hilite(12930)" onMouseOut="lolite()" onClick="logVariable('datestring')" href="../_variables/datestring.html">$datestring</a>, array('class' =&gt; 'mdl-align heading'));
<a name="l2085"><span class="linenum">2085</span></a>  
<a name="l2086"><span class="linenum">2086</span></a>                  <a class="var it21342" onMouseOver="hilite(21342)" onMouseOut="lolite()" onClick="logVariable('tablecontents')" href="../_variables/tablecontents.html">$tablecontents</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('heading')" href="../_functions/heading.html" onMouseOver="funcPopup(event,'heading')">heading</a>(<a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>, <a class="var it21345" onMouseOver="hilite(21345)" onMouseOut="lolite()" onClick="logVariable('blockdate')" href="../_variables/blockdate.html">$blockdate</a>), 4, 'mdl-align');
<a name="l2087"><span class="linenum">2087</span></a>              }
<a name="l2088"><span class="linenum">2088</span></a>  
<a name="l2089"><span class="linenum">2089</span></a>              <a class="var it21347" onMouseOver="hilite(21347)" onMouseOut="lolite()" onClick="logVariable('formatted_message')" href="../_variables/formatted_message.html">$formatted_message</a> = <a class="var it21348" onMouseOver="hilite(21348)" onMouseOut="lolite()" onClick="logVariable('side')" href="../_variables/side.html">$side</a> = null;
<a name="l2090"><span class="linenum">2090</span></a>              if (<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a> == <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it39641" onMouseOver="hilite(39641)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l2091"><span class="linenum">2091</span></a>                  <a class="var it21347" onMouseOver="hilite(21347)" onMouseOut="lolite()" onClick="logVariable('formatted_message')" href="../_variables/formatted_message.html">$formatted_message</a> = <a class="function" onClick="logFunction('message_format_message')" href="../_functions/message_format_message.html" onMouseOver="funcPopup(event,'message_format_message')">message_format_message</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it21344" onMouseOver="hilite(21344)" onMouseOut="lolite()" onClick="logVariable('messagedate')" href="../_variables/messagedate.html">$messagedate</a>, <a class="var it1502" onMouseOver="hilite(1502)" onMouseOut="lolite()" onClick="logVariable('search')" href="../_variables/search.html">$search</a>, 'me');
<a name="l2092"><span class="linenum">2092</span></a>                  <a class="var it21348" onMouseOver="hilite(21348)" onMouseOut="lolite()" onClick="logVariable('side')" href="../_variables/side.html">$side</a> = 'left';
<a name="l2093"><span class="linenum">2093</span></a>              } else {
<a name="l2094"><span class="linenum">2094</span></a>                  <a class="var it21347" onMouseOver="hilite(21347)" onMouseOut="lolite()" onClick="logVariable('formatted_message')" href="../_variables/formatted_message.html">$formatted_message</a> = <a class="function" onClick="logFunction('message_format_message')" href="../_functions/message_format_message.html" onMouseOver="funcPopup(event,'message_format_message')">message_format_message</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it21344" onMouseOver="hilite(21344)" onMouseOut="lolite()" onClick="logVariable('messagedate')" href="../_variables/messagedate.html">$messagedate</a>, <a class="var it1502" onMouseOver="hilite(1502)" onMouseOut="lolite()" onClick="logVariable('search')" href="../_variables/search.html">$search</a>, 'other');
<a name="l2095"><span class="linenum">2095</span></a>                  <a class="var it21348" onMouseOver="hilite(21348)" onMouseOut="lolite()" onClick="logVariable('side')" href="../_variables/side.html">$side</a> = 'right';
<a name="l2096"><span class="linenum">2096</span></a>              }
<a name="l2097"><span class="linenum">2097</span></a>              <a class="var it21342" onMouseOver="hilite(21342)" onMouseOut="lolite()" onClick="logVariable('tablecontents')" href="../_variables/tablecontents.html">$tablecontents</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it21347" onMouseOver="hilite(21347)" onMouseOut="lolite()" onClick="logVariable('formatted_message')" href="../_variables/formatted_message.html">$formatted_message</a>, array('class' =&gt; &quot;mdl-left <a class="var it21348" onMouseOver="hilite(21348)" onMouseOut="lolite()" onClick="logVariable('side')" href="../_variables/side.html">$side</a> <a class="var it21346" onMouseOver="hilite(21346)" onMouseOut="lolite()" onClick="logVariable('notificationclass')" href="../_variables/notificationclass.html">$notificationclass</a>&quot;));
<a name="l2098"><span class="linenum">2098</span></a>          }
<a name="l2099"><span class="linenum">2099</span></a>  
<a name="l2100"><span class="linenum">2100</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('nonempty_tag')" href="../_functions/nonempty_tag.html" onMouseOver="funcPopup(event,'nonempty_tag')">nonempty_tag</a>('div', <a class="var it21342" onMouseOver="hilite(21342)" onMouseOut="lolite()" onClick="logVariable('tablecontents')" href="../_variables/tablecontents.html">$tablecontents</a>, array('class' =&gt; 'mdl-left messagehistory'));
<a name="l2101"><span class="linenum">2101</span></a>      } else {
<a name="l2102"><span class="linenum">2102</span></a>          echo <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('nonempty_tag')" href="../_functions/nonempty_tag.html" onMouseOver="funcPopup(event,'nonempty_tag')">nonempty_tag</a>('div', '('.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nomessagesfound', 'message').')', array('class' =&gt; 'mdl-align messagehistory'));
<a name="l2103"><span class="linenum">2103</span></a>      }
<a name="l2104"><span class="linenum">2104</span></a>  }
<a name="l2105"><span class="linenum">2105</span></a>  
<a name="l2106"><span class="linenum">2106</span></a>  <span class="comment">/**</span>
<a name="l2107"><span class="linenum">2107</span></a>  <span class="comment"> * Format a message for display in the message history</span>
<a name="l2108"><span class="linenum">2108</span></a>  <span class="comment"> *</span>
<a name="l2109"><span class="linenum">2109</span></a>  <span class="comment"> * @param object $message the message object</span>
<a name="l2110"><span class="linenum">2110</span></a>  <span class="comment"> * @param string $format optional date format</span>
<a name="l2111"><span class="linenum">2111</span></a>  <span class="comment"> * @param string $keywords keywords to highlight</span>
<a name="l2112"><span class="linenum">2112</span></a>  <span class="comment"> * @param string $class CSS class to apply to the div around the message</span>
<a name="l2113"><span class="linenum">2113</span></a>  <span class="comment"> * @return string the formatted message</span>
<a name="l2114"><span class="linenum">2114</span></a>  <span class="comment"> */</span>
<a name="l2115"><span class="linenum">2115</span></a>  function <a class="function" onClick="logFunction('message_format_message')" href="../_functions/message_format_message.html" onMouseOver="funcPopup(event,'message_format_message')">message_format_message</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a>='', <a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>='', <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('class')" href="../_variables/class.html">$class</a>='other') {
<a name="l2116"><span class="linenum">2116</span></a>  
<a name="l2117"><span class="linenum">2117</span></a>      static <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a>;
<a name="l2118"><span class="linenum">2118</span></a>  
<a name="l2119"><span class="linenum">2119</span></a>  <span class="comment">    //if we haven't previously set the date format or they've supplied a new one</span>
<a name="l2120"><span class="linenum">2120</span></a>      if ( empty(<a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a>) || (!empty(<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a>) &amp;&amp; <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a> != <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a>) ) {
<a name="l2121"><span class="linenum">2121</span></a>          if (<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a>) {
<a name="l2122"><span class="linenum">2122</span></a>              <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a> = <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a>;
<a name="l2123"><span class="linenum">2123</span></a>          } else {
<a name="l2124"><span class="linenum">2124</span></a>              <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('strftimedatetimeshort');
<a name="l2125"><span class="linenum">2125</span></a>          }
<a name="l2126"><span class="linenum">2126</span></a>      }
<a name="l2127"><span class="linenum">2127</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../_variables/time.html">$time</a> = <a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>, <a class="var it7911" onMouseOver="hilite(7911)" onMouseOut="lolite()" onClick="logVariable('dateformat')" href="../_variables/dateformat.html">$dateformat</a>);
<a name="l2128"><span class="linenum">2128</span></a>  
<a name="l2129"><span class="linenum">2129</span></a>      <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> = <a class="function" onClick="logFunction('message_format_message_text')" href="../_functions/message_format_message_text.html" onMouseOver="funcPopup(event,'message_format_message_text')">message_format_message_text</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, false);
<a name="l2130"><span class="linenum">2130</span></a>  
<a name="l2131"><span class="linenum">2131</span></a>      if (<a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>) {
<a name="l2132"><span class="linenum">2132</span></a>          <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> = <a class="function" onClick="logFunction('highlight')" href="../_functions/highlight.html" onMouseOver="funcPopup(event,'highlight')">highlight</a>(<a class="var it8815" onMouseOver="hilite(8815)" onMouseOut="lolite()" onClick="logVariable('keywords')" href="../_variables/keywords.html">$keywords</a>, <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a>);
<a name="l2133"><span class="linenum">2133</span></a>      }
<a name="l2134"><span class="linenum">2134</span></a>  
<a name="l2135"><span class="linenum">2135</span></a>      <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> .= <a class="function" onClick="logFunction('message_format_contexturl')" href="../_functions/message_format_contexturl.html" onMouseOver="funcPopup(event,'message_format_contexturl')">message_format_contexturl</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>);
<a name="l2136"><span class="linenum">2136</span></a>  
<a name="l2137"><span class="linenum">2137</span></a>      <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a> = <a class="function" onClick="logFunction('clean_text')" href="../_functions/clean_text.html" onMouseOver="funcPopup(event,'clean_text')">clean_text</a>(<a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a>, <a class="constant" onClick="logConstant('FORMAT_HTML')" href="../_constants/FORMAT_HTML.html" onMouseOver="constPopup(event,'FORMAT_HTML')">FORMAT_HTML</a>);
<a name="l2138"><span class="linenum">2138</span></a>  
<a name="l2139"><span class="linenum">2139</span></a>      return &lt;&lt;&lt;TEMPLATE
<a name="l2140"><span class="linenum">2140</span></a>  &lt;div class='message <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('class')" href="../_variables/class.html">$class</a>'&gt;
<a name="l2141"><span class="linenum">2141</span></a>      &lt;a name=&quot;m{<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>}&quot;&gt;&lt;/a&gt;
<a name="l2142"><span class="linenum">2142</span></a>      &lt;span class=&quot;message-meta&quot;&gt;&lt;span class=&quot;time&quot;&gt;<a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('time')" href="../_variables/time.html">$time</a>&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;text&quot;&gt;<a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('messagetext')" href="../_variables/messagetext.html">$messagetext</a>&lt;/span&gt;
<a name="l2143"><span class="linenum">2143</span></a>  &lt;/div&gt;
<a name="l2144"><span class="linenum">2144</span></a>  TEMPLATE;
<a name="l2145"><span class="linenum">2145</span></a>  }
<a name="l2146"><span class="linenum">2146</span></a>  
<a name="l2147"><span class="linenum">2147</span></a>  <span class="comment">/**</span>
<a name="l2148"><span class="linenum">2148</span></a>  <span class="comment"> * Format a the context url and context url name of a message for display</span>
<a name="l2149"><span class="linenum">2149</span></a>  <span class="comment"> *</span>
<a name="l2150"><span class="linenum">2150</span></a>  <span class="comment"> * @param object $message the message object</span>
<a name="l2151"><span class="linenum">2151</span></a>  <span class="comment"> * @return string the formatted string</span>
<a name="l2152"><span class="linenum">2152</span></a>  <span class="comment"> */</span>
<a name="l2153"><span class="linenum">2153</span></a>  function <a class="function" onClick="logFunction('message_format_contexturl')" href="../_functions/message_format_contexturl.html" onMouseOver="funcPopup(event,'message_format_contexturl')">message_format_contexturl</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>) {
<a name="l2154"><span class="linenum">2154</span></a>      <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('s')" href="../_variables/s.html">$s</a> = null;
<a name="l2155"><span class="linenum">2155</span></a>  
<a name="l2156"><span class="linenum">2156</span></a>      if (!empty(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contexturl')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/contexturl.html">contexturl</a>)) {
<a name="l2157"><span class="linenum">2157</span></a>          <a class="var it21349" onMouseOver="hilite(21349)" onMouseOut="lolite()" onClick="logVariable('displaytext')" href="../_variables/displaytext.html">$displaytext</a> = null;
<a name="l2158"><span class="linenum">2158</span></a>          if (!empty(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contexturlname')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/contexturlname.html">contexturlname</a>)) {
<a name="l2159"><span class="linenum">2159</span></a>              <a class="var it21349" onMouseOver="hilite(21349)" onMouseOut="lolite()" onClick="logVariable('displaytext')" href="../_variables/displaytext.html">$displaytext</a>= <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contexturlname')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/contexturlname.html">contexturlname</a>;
<a name="l2160"><span class="linenum">2160</span></a>          } else {
<a name="l2161"><span class="linenum">2161</span></a>              <a class="var it21349" onMouseOver="hilite(21349)" onMouseOut="lolite()" onClick="logVariable('displaytext')" href="../_variables/displaytext.html">$displaytext</a>= <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contexturl')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/contexturl.html">contexturl</a>;
<a name="l2162"><span class="linenum">2162</span></a>          }
<a name="l2163"><span class="linenum">2163</span></a>          <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('s')" href="../_variables/s.html">$s</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div',array('class' =&gt; 'messagecontext'));
<a name="l2164"><span class="linenum">2164</span></a>              <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('s')" href="../_variables/s.html">$s</a> .= <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('view').': '.<a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('a', <a class="var it21349" onMouseOver="hilite(21349)" onMouseOut="lolite()" onClick="logVariable('displaytext')" href="../_variables/displaytext.html">$displaytext</a>, array('href' =&gt; <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contexturl')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/contexturl.html">contexturl</a>));
<a name="l2165"><span class="linenum">2165</span></a>          <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('s')" href="../_variables/s.html">$s</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l2166"><span class="linenum">2166</span></a>      }
<a name="l2167"><span class="linenum">2167</span></a>  
<a name="l2168"><span class="linenum">2168</span></a>      return <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('s')" href="../_variables/s.html">$s</a>;
<a name="l2169"><span class="linenum">2169</span></a>  }
<a name="l2170"><span class="linenum">2170</span></a>  
<a name="l2171"><span class="linenum">2171</span></a>  <span class="comment">/**</span>
<a name="l2172"><span class="linenum">2172</span></a>  <span class="comment"> * Send a message from one user to another. Will be delivered according to the message recipients messaging preferences</span>
<a name="l2173"><span class="linenum">2173</span></a>  <span class="comment"> *</span>
<a name="l2174"><span class="linenum">2174</span></a>  <span class="comment"> * @param object $userfrom the message sender</span>
<a name="l2175"><span class="linenum">2175</span></a>  <span class="comment"> * @param object $userto the message recipient</span>
<a name="l2176"><span class="linenum">2176</span></a>  <span class="comment"> * @param string $message the message</span>
<a name="l2177"><span class="linenum">2177</span></a>  <span class="comment"> * @param int $format message format such as FORMAT_PLAIN or FORMAT_HTML</span>
<a name="l2178"><span class="linenum">2178</span></a>  <span class="comment"> * @return int|false the ID of the new message or false</span>
<a name="l2179"><span class="linenum">2179</span></a>  <span class="comment"> */</span>
<a name="l2180"><span class="linenum">2180</span></a>  function <a class="function" onClick="logFunction('message_post_message')" href="../_functions/message_post_message.html" onMouseOver="funcPopup(event,'message_post_message')">message_post_message</a>(<a class="var it1853" onMouseOver="hilite(1853)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../_variables/userfrom.html">$userfrom</a>, <a class="var it1854" onMouseOver="hilite(1854)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../_variables/userto.html">$userto</a>, <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a>) {
<a name="l2181"><span class="linenum">2181</span></a>      global <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../_variables/SITE.html">$SITE</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l2182"><span class="linenum">2182</span></a>  
<a name="l2183"><span class="linenum">2183</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a> = new stdClass();
<a name="l2184"><span class="linenum">2184</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('component')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/component.html">component</a>        = 'moodle';
<a name="l2185"><span class="linenum">2185</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('name')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/name.html">name</a>             = 'instantmessage';
<a name="l2186"><span class="linenum">2186</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userfrom')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/userfrom.html">userfrom</a>         = <a class="var it1853" onMouseOver="hilite(1853)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../_variables/userfrom.html">$userfrom</a>;
<a name="l2187"><span class="linenum">2187</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('userto')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/userto.html">userto</a>           = <a class="var it1854" onMouseOver="hilite(1854)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../_variables/userto.html">$userto</a>;
<a name="l2188"><span class="linenum">2188</span></a>  
<a name="l2189"><span class="linenum">2189</span></a>  <span class="comment">    //using string manager directly so that strings in the message will be in the message recipients language rather than the senders</span>
<a name="l2190"><span class="linenum">2190</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('subject')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/subject.html">subject</a>          = <a class="function" onClick="logFunction('get_string_manager')" href="../_functions/get_string_manager.html" onMouseOver="funcPopup(event,'get_string_manager')">get_string_manager</a>()-&gt;<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unreadnewmessage', 'message', <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it1853" onMouseOver="hilite(1853)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../_variables/userfrom.html">$userfrom</a>), <a class="var it1854" onMouseOver="hilite(1854)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('lang')" class="var it40696" onMouseOver="hilite(40696)" onMouseOut="lolite()" href="../_variables/lang.html">lang</a>);
<a name="l2191"><span class="linenum">2191</span></a>  
<a name="l2192"><span class="linenum">2192</span></a>      if (<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a> == <a class="constant" onClick="logConstant('FORMAT_HTML')" href="../_constants/FORMAT_HTML.html" onMouseOver="constPopup(event,'FORMAT_HTML')">FORMAT_HTML</a>) {
<a name="l2193"><span class="linenum">2193</span></a>          <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a>  = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>;
<a name="l2194"><span class="linenum">2194</span></a>  <span class="comment">        //some message processors may revert to sending plain text even if html is supplied</span>
<a name="l2195"><span class="linenum">2195</span></a>  <span class="comment">        //so we keep both plain and html versions if we're intending to send html</span>
<a name="l2196"><span class="linenum">2196</span></a>          <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a> = <a class="function" onClick="logFunction('html_to_text')" href="../_functions/html_to_text.html" onMouseOver="funcPopup(event,'html_to_text')">html_to_text</a>(<a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a>);
<a name="l2197"><span class="linenum">2197</span></a>      } else {
<a name="l2198"><span class="linenum">2198</span></a>          <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a>      = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>;
<a name="l2199"><span class="linenum">2199</span></a>          <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a>  = '';
<a name="l2200"><span class="linenum">2200</span></a>      }
<a name="l2201"><span class="linenum">2201</span></a>  
<a name="l2202"><span class="linenum">2202</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessageformat.html">fullmessageformat</a> = <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('format')" href="../_variables/format.html">$format</a>;
<a name="l2203"><span class="linenum">2203</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/smallmessage.html">smallmessage</a>     = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>;<span class="comment">//store the message unfiltered. Clean up on output.</span>
<a name="l2204"><span class="linenum">2204</span></a>  
<a name="l2205"><span class="linenum">2205</span></a>      <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('s')" href="../_variables/s.html">$s</a> = new stdClass();
<a name="l2206"><span class="linenum">2206</span></a>      <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('s')" href="../_variables/s.html">$s</a>-&gt;<a onClick="logVariable('sitename')" class="var it40212" onMouseOver="hilite(40212)" onMouseOut="lolite()" href="../_variables/sitename.html">sitename</a> = <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('shortname')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>)));
<a name="l2207"><span class="linenum">2207</span></a>      <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('s')" href="../_variables/s.html">$s</a>-&gt;<a onClick="logVariable('url')" class="var it40212" onMouseOver="hilite(40212)" onMouseOut="lolite()" href="../_variables/url.html">url</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>.'/message/index.php?user='.<a class="var it1854" onMouseOver="hilite(1854)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('id')" class="var it40696" onMouseOver="hilite(40696)" onMouseOut="lolite()" href="../_variables/id.html">id</a>.'&amp;id='.<a class="var it1853" onMouseOver="hilite(1853)" onMouseOut="lolite()" onClick="logVariable('userfrom')" href="../_variables/userfrom.html">$userfrom</a>-&gt;<a onClick="logVariable('id')" class="var it39716" onMouseOver="hilite(39716)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l2208"><span class="linenum">2208</span></a>  
<a name="l2209"><span class="linenum">2209</span></a>      <a class="var it21350" onMouseOver="hilite(21350)" onMouseOut="lolite()" onClick="logVariable('emailtagline')" href="../_variables/emailtagline.html">$emailtagline</a> = <a class="function" onClick="logFunction('get_string_manager')" href="../_functions/get_string_manager.html" onMouseOver="funcPopup(event,'get_string_manager')">get_string_manager</a>()-&gt;<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('emailtagline', 'message', <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('s')" href="../_variables/s.html">$s</a>, <a class="var it1854" onMouseOver="hilite(1854)" onMouseOut="lolite()" onClick="logVariable('userto')" href="../_variables/userto.html">$userto</a>-&gt;<a onClick="logVariable('lang')" class="var it40696" onMouseOver="hilite(40696)" onMouseOut="lolite()" href="../_variables/lang.html">lang</a>);
<a name="l2210"><span class="linenum">2210</span></a>      if (!empty(<a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a>)) {
<a name="l2211"><span class="linenum">2211</span></a>          <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a> .= &quot;\n\n---------------------------------------------------------------------\n&quot;.<a class="var it21350" onMouseOver="hilite(21350)" onMouseOut="lolite()" onClick="logVariable('emailtagline')" href="../_variables/emailtagline.html">$emailtagline</a>;
<a name="l2212"><span class="linenum">2212</span></a>      }
<a name="l2213"><span class="linenum">2213</span></a>      if (!empty(<a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a>)) {
<a name="l2214"><span class="linenum">2214</span></a>          <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a> .= &quot;&lt;br /&gt;&lt;br /&gt;---------------------------------------------------------------------&lt;br /&gt;&quot;.<a class="var it21350" onMouseOver="hilite(21350)" onMouseOut="lolite()" onClick="logVariable('emailtagline')" href="../_variables/emailtagline.html">$emailtagline</a>;
<a name="l2215"><span class="linenum">2215</span></a>      }
<a name="l2216"><span class="linenum">2216</span></a>  
<a name="l2217"><span class="linenum">2217</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>     = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l2218"><span class="linenum">2218</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('notification')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/notification.html">notification</a>    = 0;
<a name="l2219"><span class="linenum">2219</span></a>      return <a class="function" onClick="logFunction('message_send')" href="../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>);
<a name="l2220"><span class="linenum">2220</span></a>  }
<a name="l2221"><span class="linenum">2221</span></a>  
<a name="l2222"><span class="linenum">2222</span></a>  <span class="comment">/**</span>
<a name="l2223"><span class="linenum">2223</span></a>  <span class="comment"> * Print a row of contactlist displaying user picture, messages waiting and</span>
<a name="l2224"><span class="linenum">2224</span></a>  <span class="comment"> * block links etc</span>
<a name="l2225"><span class="linenum">2225</span></a>  <span class="comment"> *</span>
<a name="l2226"><span class="linenum">2226</span></a>  <span class="comment"> * @param object $contact contact object containing all fields required for $OUTPUT-&gt;user_picture()</span>
<a name="l2227"><span class="linenum">2227</span></a>  <span class="comment"> * @param bool $incontactlist is the user a contact of ours?</span>
<a name="l2228"><span class="linenum">2228</span></a>  <span class="comment"> * @param bool $isblocked is the user blocked?</span>
<a name="l2229"><span class="linenum">2229</span></a>  <span class="comment"> * @param string $selectcontacturl the url to send the user to when a contact's name is clicked</span>
<a name="l2230"><span class="linenum">2230</span></a>  <span class="comment"> * @param bool $showactionlinks display action links next to the other users (add contact, block user etc)</span>
<a name="l2231"><span class="linenum">2231</span></a>  <span class="comment"> * @param object $selecteduser the user the current user is viewing (if any). They will be highlighted.</span>
<a name="l2232"><span class="linenum">2232</span></a>  <span class="comment"> * @return void</span>
<a name="l2233"><span class="linenum">2233</span></a>  <span class="comment"> */</span>
<a name="l2234"><span class="linenum">2234</span></a>  function <a class="function" onClick="logFunction('message_print_contactlist_user')" href="../_functions/message_print_contactlist_user.html" onMouseOver="funcPopup(event,'message_print_contactlist_user')">message_print_contactlist_user</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>, <a class="var it21351" onMouseOver="hilite(21351)" onMouseOut="lolite()" onClick="logVariable('incontactlist')" href="../_variables/incontactlist.html">$incontactlist</a> = true, <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a> = false, <a class="var it21352" onMouseOver="hilite(21352)" onMouseOut="lolite()" onClick="logVariable('selectcontacturl')" href="../_variables/selectcontacturl.html">$selectcontacturl</a> = null, <a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a> = true, <a class="var it21353" onMouseOver="hilite(21353)" onMouseOut="lolite()" onClick="logVariable('selecteduser')" href="../_variables/selecteduser.html">$selecteduser</a>=null) {
<a name="l2235"><span class="linenum">2235</span></a>      global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../_variables/COURSE.html">$COURSE</a>;
<a name="l2236"><span class="linenum">2236</span></a>      <a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../_variables/fullname.html">$fullname</a>  = <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>);
<a name="l2237"><span class="linenum">2237</span></a>      <a class="var it21354" onMouseOver="hilite(21354)" onMouseOut="lolite()" onClick="logVariable('fullnamelink')" href="../_variables/fullnamelink.html">$fullnamelink</a>  = <a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../_variables/fullname.html">$fullname</a>;
<a name="l2238"><span class="linenum">2238</span></a>      <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> = '';
<a name="l2239"><span class="linenum">2239</span></a>  
<a name="l2240"><span class="linenum">2240</span></a>      <a class="var it21355" onMouseOver="hilite(21355)" onMouseOut="lolite()" onClick="logVariable('linkclass')" href="../_variables/linkclass.html">$linkclass</a> = '';
<a name="l2241"><span class="linenum">2241</span></a>      if (!empty(<a class="var it21353" onMouseOver="hilite(21353)" onMouseOut="lolite()" onClick="logVariable('selecteduser')" href="../_variables/selecteduser.html">$selecteduser</a>) &amp;&amp; <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it21353" onMouseOver="hilite(21353)" onMouseOut="lolite()" onClick="logVariable('selecteduser')" href="../_variables/selecteduser.html">$selecteduser</a>-&gt;<a onClick="logVariable('id')" class="var it42198" onMouseOver="hilite(42198)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l2242"><span class="linenum">2242</span></a>          <a class="var it21355" onMouseOver="hilite(21355)" onMouseOut="lolite()" onClick="logVariable('linkclass')" href="../_variables/linkclass.html">$linkclass</a> = 'messageselecteduser';
<a name="l2243"><span class="linenum">2243</span></a>      }
<a name="l2244"><span class="linenum">2244</span></a>  
<a name="l2245"><span class="linenum">2245</span></a>  <span class="comment">    // Are there any unread messages for this contact?</span>
<a name="l2246"><span class="linenum">2246</span></a>      if (<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('messagecount')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a> &gt; 0 ){
<a name="l2247"><span class="linenum">2247</span></a>          <a class="var it21354" onMouseOver="hilite(21354)" onMouseOut="lolite()" onClick="logVariable('fullnamelink')" href="../_variables/fullnamelink.html">$fullnamelink</a> = '&lt;strong&gt;'.<a class="var it21354" onMouseOver="hilite(21354)" onMouseOut="lolite()" onClick="logVariable('fullnamelink')" href="../_variables/fullnamelink.html">$fullnamelink</a>.' ('.<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('messagecount')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/messagecount.html">messagecount</a>.')&lt;/strong&gt;';
<a name="l2248"><span class="linenum">2248</span></a>      }
<a name="l2249"><span class="linenum">2249</span></a>  
<a name="l2250"><span class="linenum">2250</span></a>      <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a> = <a class="var it21293" onMouseOver="hilite(21293)" onMouseOut="lolite()" onClick="logVariable('strhistory')" href="../_variables/strhistory.html">$strhistory</a> = null;
<a name="l2251"><span class="linenum">2251</span></a>  
<a name="l2252"><span class="linenum">2252</span></a>      if (<a class="var it1511" onMouseOver="hilite(1511)" onMouseOut="lolite()" onClick="logVariable('showactionlinks')" href="../_variables/showactionlinks.html">$showactionlinks</a>) {
<a name="l2253"><span class="linenum">2253</span></a>  <span class="comment">        // Show block and delete links if user is real user.</span>
<a name="l2254"><span class="linenum">2254</span></a>          if (<a class="class" onClick="logClass('core_user')" href="../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('is_real_user')" href="../_functions/is_real_user.html" onMouseOver="funcPopup(event,'is_real_user')">is_real_user</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l2255"><span class="linenum">2255</span></a>              <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_get_contact_add_remove_link')" href="../_functions/message_get_contact_add_remove_link.html" onMouseOver="funcPopup(event,'message_get_contact_add_remove_link')">message_get_contact_add_remove_link</a>(<a class="var it21351" onMouseOver="hilite(21351)" onMouseOut="lolite()" onClick="logVariable('incontactlist')" href="../_variables/incontactlist.html">$incontactlist</a>, <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a>, <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>);
<a name="l2256"><span class="linenum">2256</span></a>              <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_get_contact_block_link')" href="../_functions/message_get_contact_block_link.html" onMouseOver="funcPopup(event,'message_get_contact_block_link')">message_get_contact_block_link</a>(<a class="var it21351" onMouseOver="hilite(21351)" onMouseOut="lolite()" onClick="logVariable('incontactlist')" href="../_variables/incontactlist.html">$incontactlist</a>, <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a>, <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>);
<a name="l2257"><span class="linenum">2257</span></a>          }
<a name="l2258"><span class="linenum">2258</span></a>          <a class="var it21293" onMouseOver="hilite(21293)" onMouseOut="lolite()" onClick="logVariable('strhistory')" href="../_variables/strhistory.html">$strhistory</a> = <a class="function" onClick="logFunction('message_history_link')" href="../_functions/message_history_link.html" onMouseOver="funcPopup(event,'message_history_link')">message_history_link</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true, '', '', 'icon');
<a name="l2259"><span class="linenum">2259</span></a>      }
<a name="l2260"><span class="linenum">2260</span></a>  
<a name="l2261"><span class="linenum">2261</span></a>      <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class' =&gt; 'pix'));
<a name="l2262"><span class="linenum">2262</span></a>      <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('user_picture')" href="../_functions/user_picture.html" onMouseOver="funcPopup(event,'user_picture')">user_picture</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>, array('size' =&gt; 20, 'courseid' =&gt; <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('id')" class="var it39504" onMouseOver="hilite(39504)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l2263"><span class="linenum">2263</span></a>      <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l2264"><span class="linenum">2264</span></a>  
<a name="l2265"><span class="linenum">2265</span></a>      <a class="var it13445" onMouseOver="hilite(13445)" onMouseOut="lolite()" onClick="logVariable('popupoptions')" href="../_variables/popupoptions.html">$popupoptions</a> = array(
<a name="l2266"><span class="linenum">2266</span></a>              'height' =&gt; <a class="constant" onClick="logConstant('MESSAGE_DISCUSSION_HEIGHT')" href="../_constants/MESSAGE_DISCUSSION_HEIGHT.html" onMouseOver="constPopup(event,'MESSAGE_DISCUSSION_HEIGHT')">MESSAGE_DISCUSSION_HEIGHT</a>,
<a name="l2267"><span class="linenum">2267</span></a>              'width' =&gt; <a class="constant" onClick="logConstant('MESSAGE_DISCUSSION_WIDTH')" href="../_constants/MESSAGE_DISCUSSION_WIDTH.html" onMouseOver="constPopup(event,'MESSAGE_DISCUSSION_WIDTH')">MESSAGE_DISCUSSION_WIDTH</a>,
<a name="l2268"><span class="linenum">2268</span></a>              'menubar' =&gt; false,
<a name="l2269"><span class="linenum">2269</span></a>              'location' =&gt; false,
<a name="l2270"><span class="linenum">2270</span></a>              'status' =&gt; true,
<a name="l2271"><span class="linenum">2271</span></a>              'scrollbars' =&gt; true,
<a name="l2272"><span class="linenum">2272</span></a>              'resizable' =&gt; true);
<a name="l2273"><span class="linenum">2273</span></a>  
<a name="l2274"><span class="linenum">2274</span></a>      <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a> = <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> = null;
<a name="l2275"><span class="linenum">2275</span></a>      if (!empty(<a class="var it21352" onMouseOver="hilite(21352)" onMouseOut="lolite()" onClick="logVariable('selectcontacturl')" href="../_variables/selectcontacturl.html">$selectcontacturl</a>)) {
<a name="l2276"><span class="linenum">2276</span></a>          <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it21352" onMouseOver="hilite(21352)" onMouseOut="lolite()" onClick="logVariable('selectcontacturl')" href="../_variables/selectcontacturl.html">$selectcontacturl</a>.'&amp;user2='.<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l2277"><span class="linenum">2277</span></a>      } else {
<a name="l2278"><span class="linenum">2278</span></a>  <span class="comment">        //can $selectcontacturl be removed and maybe the be removed and hardcoded?</span>
<a name="l2279"><span class="linenum">2279</span></a>          <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(&quot;/message/index.php?id=<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>&quot;);
<a name="l2280"><span class="linenum">2280</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> = <span class="keyword">new </span><a class="class" onClick="logClass('popup_action')" href="../_classes/popup_action.html" onMouseOver="classPopup(event,'popup_action')">popup_action</a>('click', <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a>, &quot;message_<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>&quot;, <a class="var it13445" onMouseOver="hilite(13445)" onMouseOut="lolite()" onClick="logVariable('popupoptions')" href="../_variables/popupoptions.html">$popupoptions</a>);
<a name="l2281"><span class="linenum">2281</span></a>      }
<a name="l2282"><span class="linenum">2282</span></a>  
<a name="l2283"><span class="linenum">2283</span></a>  
<a name="l2284"><span class="linenum">2284</span></a>      if (<a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> . <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a> . <a class="var it21293" onMouseOver="hilite(21293)" onMouseOut="lolite()" onClick="logVariable('strhistory')" href="../_variables/strhistory.html">$strhistory</a>) &gt; 0) {
<a name="l2285"><span class="linenum">2285</span></a>          <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('tag')" href="../_functions/tag.html" onMouseOver="funcPopup(event,'tag')">tag</a>('div', <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> . <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a> . <a class="var it21293" onMouseOver="hilite(21293)" onMouseOut="lolite()" onClick="logVariable('strhistory')" href="../_variables/strhistory.html">$strhistory</a>, array('class' =&gt; 'link'));
<a name="l2286"><span class="linenum">2286</span></a>  
<a name="l2287"><span class="linenum">2287</span></a>          <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class' =&gt; 'contact'));
<a name="l2288"><span class="linenum">2288</span></a>          <a class="var it21356" onMouseOver="hilite(21356)" onMouseOut="lolite()" onClick="logVariable('linkattr')" href="../_variables/linkattr.html">$linkattr</a> = array('class' =&gt; <a class="var it21355" onMouseOver="hilite(21355)" onMouseOut="lolite()" onClick="logVariable('linkclass')" href="../_variables/linkclass.html">$linkclass</a>, 'title' =&gt; <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('sendmessageto', 'message', <a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../_variables/fullname.html">$fullname</a>));
<a name="l2289"><span class="linenum">2289</span></a>          <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('action_link')" href="../_functions/action_link.html" onMouseOver="funcPopup(event,'action_link')">action_link</a>(<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a>, <a class="var it21354" onMouseOver="hilite(21354)" onMouseOut="lolite()" onClick="logVariable('fullnamelink')" href="../_variables/fullnamelink.html">$fullnamelink</a>, <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a>, <a class="var it21356" onMouseOver="hilite(21356)" onMouseOut="lolite()" onClick="logVariable('linkattr')" href="../_variables/linkattr.html">$linkattr</a>);
<a name="l2290"><span class="linenum">2290</span></a>          <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l2291"><span class="linenum">2291</span></a>      } else {
<a name="l2292"><span class="linenum">2292</span></a>          <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('start_tag')" href="../_functions/start_tag.html" onMouseOver="funcPopup(event,'start_tag')">start_tag</a>('div', array('class' =&gt; 'contact nolinks'));
<a name="l2293"><span class="linenum">2293</span></a>          <a class="var it21356" onMouseOver="hilite(21356)" onMouseOut="lolite()" onClick="logVariable('linkattr')" href="../_variables/linkattr.html">$linkattr</a> = array('class' =&gt; <a class="var it21355" onMouseOver="hilite(21355)" onMouseOut="lolite()" onClick="logVariable('linkclass')" href="../_variables/linkclass.html">$linkclass</a>, 'title' =&gt; <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('sendmessageto', 'message', <a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../_variables/fullname.html">$fullname</a>));
<a name="l2294"><span class="linenum">2294</span></a>          <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('action_link')" href="../_functions/action_link.html" onMouseOver="funcPopup(event,'action_link')">action_link</a>(<a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a>, <a class="var it21354" onMouseOver="hilite(21354)" onMouseOut="lolite()" onClick="logVariable('fullnamelink')" href="../_variables/fullnamelink.html">$fullnamelink</a>, <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a>, <a class="var it21356" onMouseOver="hilite(21356)" onMouseOut="lolite()" onClick="logVariable('linkattr')" href="../_variables/linkattr.html">$linkattr</a>);
<a name="l2295"><span class="linenum">2295</span></a>          <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a> .= <a class="class" onClick="logClass('html_writer')" href="../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('end_tag')" href="../_functions/end_tag.html" onMouseOver="funcPopup(event,'end_tag')">end_tag</a>('div');
<a name="l2296"><span class="linenum">2296</span></a>      }
<a name="l2297"><span class="linenum">2297</span></a>  
<a name="l2298"><span class="linenum">2298</span></a>      return <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('output')" href="../_variables/output.html">$output</a>;
<a name="l2299"><span class="linenum">2299</span></a>  }
<a name="l2300"><span class="linenum">2300</span></a>  
<a name="l2301"><span class="linenum">2301</span></a>  <span class="comment">/**</span>
<a name="l2302"><span class="linenum">2302</span></a>  <span class="comment"> * Constructs the add/remove contact link to display next to other users</span>
<a name="l2303"><span class="linenum">2303</span></a>  <span class="comment"> *</span>
<a name="l2304"><span class="linenum">2304</span></a>  <span class="comment"> * @param bool $incontactlist is the user a contact</span>
<a name="l2305"><span class="linenum">2305</span></a>  <span class="comment"> * @param bool $isblocked is the user blocked</span>
<a name="l2306"><span class="linenum">2306</span></a>  <span class="comment"> * @param stdClass $contact contact object</span>
<a name="l2307"><span class="linenum">2307</span></a>  <span class="comment"> * @param string $script the URL to send the user to when the link is clicked. If null, the current page.</span>
<a name="l2308"><span class="linenum">2308</span></a>  <span class="comment"> * @param bool $text include text next to the icons?</span>
<a name="l2309"><span class="linenum">2309</span></a>  <span class="comment"> * @param bool $icon include a graphical icon?</span>
<a name="l2310"><span class="linenum">2310</span></a>  <span class="comment"> * @return string</span>
<a name="l2311"><span class="linenum">2311</span></a>  <span class="comment"> */</span>
<a name="l2312"><span class="linenum">2312</span></a>  function <a class="function" onClick="logFunction('message_get_contact_add_remove_link')" href="../_functions/message_get_contact_add_remove_link.html" onMouseOver="funcPopup(event,'message_get_contact_add_remove_link')">message_get_contact_add_remove_link</a>(<a class="var it21351" onMouseOver="hilite(21351)" onMouseOut="lolite()" onClick="logVariable('incontactlist')" href="../_variables/incontactlist.html">$incontactlist</a>, <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a>, <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>=null, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>=false, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>=true) {
<a name="l2313"><span class="linenum">2313</span></a>      <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = '';
<a name="l2314"><span class="linenum">2314</span></a>  
<a name="l2315"><span class="linenum">2315</span></a>      if(<a class="var it21351" onMouseOver="hilite(21351)" onMouseOut="lolite()" onClick="logVariable('incontactlist')" href="../_variables/incontactlist.html">$incontactlist</a>){
<a name="l2316"><span class="linenum">2316</span></a>          <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'remove', true, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>);
<a name="l2317"><span class="linenum">2317</span></a>      } else if (<a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a>) {
<a name="l2318"><span class="linenum">2318</span></a>          <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'add', true, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>);
<a name="l2319"><span class="linenum">2319</span></a>      } else{
<a name="l2320"><span class="linenum">2320</span></a>          <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a> = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'add', true, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>);
<a name="l2321"><span class="linenum">2321</span></a>      }
<a name="l2322"><span class="linenum">2322</span></a>  
<a name="l2323"><span class="linenum">2323</span></a>      return <a class="var it21291" onMouseOver="hilite(21291)" onMouseOut="lolite()" onClick="logVariable('strcontact')" href="../_variables/strcontact.html">$strcontact</a>;
<a name="l2324"><span class="linenum">2324</span></a>  }
<a name="l2325"><span class="linenum">2325</span></a>  
<a name="l2326"><span class="linenum">2326</span></a>  <span class="comment">/**</span>
<a name="l2327"><span class="linenum">2327</span></a>  <span class="comment"> * Constructs the block contact link to display next to other users</span>
<a name="l2328"><span class="linenum">2328</span></a>  <span class="comment"> *</span>
<a name="l2329"><span class="linenum">2329</span></a>  <span class="comment"> * @param bool $incontactlist is the user a contact?</span>
<a name="l2330"><span class="linenum">2330</span></a>  <span class="comment"> * @param bool $isblocked is the user blocked?</span>
<a name="l2331"><span class="linenum">2331</span></a>  <span class="comment"> * @param stdClass $contact contact object</span>
<a name="l2332"><span class="linenum">2332</span></a>  <span class="comment"> * @param string $script the URL to send the user to when the link is clicked. If null, the current page.</span>
<a name="l2333"><span class="linenum">2333</span></a>  <span class="comment"> * @param bool $text include text next to the icons?</span>
<a name="l2334"><span class="linenum">2334</span></a>  <span class="comment"> * @param bool $icon include a graphical icon?</span>
<a name="l2335"><span class="linenum">2335</span></a>  <span class="comment"> * @return string</span>
<a name="l2336"><span class="linenum">2336</span></a>  <span class="comment"> */</span>
<a name="l2337"><span class="linenum">2337</span></a>  function <a class="function" onClick="logFunction('message_get_contact_block_link')" href="../_functions/message_get_contact_block_link.html" onMouseOver="funcPopup(event,'message_get_contact_block_link')">message_get_contact_block_link</a>(<a class="var it21351" onMouseOver="hilite(21351)" onMouseOut="lolite()" onClick="logVariable('incontactlist')" href="../_variables/incontactlist.html">$incontactlist</a>, <a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a>, <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>=null, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>=false, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>=true) {
<a name="l2338"><span class="linenum">2338</span></a>      <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = '';
<a name="l2339"><span class="linenum">2339</span></a>  
<a name="l2340"><span class="linenum">2340</span></a>  <span class="comment">    //commented out to allow the user to block a contact without having to remove them first</span>
<a name="l2341"><span class="linenum">2341</span></a>      <span class="comment">/*if ($incontactlist) {</span>
<a name="l2342"><span class="linenum">2342</span></a>  <span class="comment">        //$strblock = '';</span>
<a name="l2343"><span class="linenum">2343</span></a>  <span class="comment">    } else*/</span>
<a name="l2344"><span class="linenum">2344</span></a>      if (<a class="var it21261" onMouseOver="hilite(21261)" onMouseOut="lolite()" onClick="logVariable('isblocked')" href="../_variables/isblocked.html">$isblocked</a>) {
<a name="l2345"><span class="linenum">2345</span></a>          <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'unblock', true, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>);
<a name="l2346"><span class="linenum">2346</span></a>      } else{
<a name="l2347"><span class="linenum">2347</span></a>          <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>   = <a class="function" onClick="logFunction('message_contact_link')" href="../_functions/message_contact_link.html" onMouseOver="funcPopup(event,'message_contact_link')">message_contact_link</a>(<a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../_variables/contact.html">$contact</a>-&gt;<a onClick="logVariable('id')" class="var it42194" onMouseOver="hilite(42194)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'block', true, <a class="var it1385" onMouseOver="hilite(1385)" onMouseOut="lolite()" onClick="logVariable('script')" href="../_variables/script.html">$script</a>, <a class="var it72" onMouseOver="hilite(72)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it103" onMouseOver="hilite(103)" onMouseOut="lolite()" onClick="logVariable('icon')" href="../_variables/icon.html">$icon</a>);
<a name="l2348"><span class="linenum">2348</span></a>      }
<a name="l2349"><span class="linenum">2349</span></a>  
<a name="l2350"><span class="linenum">2350</span></a>      return <a class="var it21292" onMouseOver="hilite(21292)" onMouseOut="lolite()" onClick="logVariable('strblock')" href="../_variables/strblock.html">$strblock</a>;
<a name="l2351"><span class="linenum">2351</span></a>  }
<a name="l2352"><span class="linenum">2352</span></a>  
<a name="l2353"><span class="linenum">2353</span></a>  <span class="comment">/**</span>
<a name="l2354"><span class="linenum">2354</span></a>  <span class="comment"> * Moves messages from a particular user from the message table (unread messages) to message_read</span>
<a name="l2355"><span class="linenum">2355</span></a>  <span class="comment"> * This is typically only used when a user is deleted</span>
<a name="l2356"><span class="linenum">2356</span></a>  <span class="comment"> *</span>
<a name="l2357"><span class="linenum">2357</span></a>  <span class="comment"> * @param object $userid User id</span>
<a name="l2358"><span class="linenum">2358</span></a>  <span class="comment"> * @return boolean success</span>
<a name="l2359"><span class="linenum">2359</span></a>  <span class="comment"> */</span>
<a name="l2360"><span class="linenum">2360</span></a>  function <a class="function" onClick="logFunction('message_move_userfrom_unread2read')" href="../_functions/message_move_userfrom_unread2read.html" onMouseOver="funcPopup(event,'message_move_userfrom_unread2read')">message_move_userfrom_unread2read</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l2361"><span class="linenum">2361</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2362"><span class="linenum">2362</span></a>  
<a name="l2363"><span class="linenum">2363</span></a>  <span class="comment">    // move all unread messages from message table to message_read</span>
<a name="l2364"><span class="linenum">2364</span></a>      if (<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('message', 'useridfrom = ?', array(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>), 'timecreated')) {
<a name="l2365"><span class="linenum">2365</span></a>          foreach (<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> as <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>) {
<a name="l2366"><span class="linenum">2366</span></a>              <a class="function" onClick="logFunction('message_mark_message_read')" href="../_functions/message_mark_message_read.html" onMouseOver="funcPopup(event,'message_mark_message_read')">message_mark_message_read</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, 0); <span class="comment">//set timeread to 0 as the message was never read</span>
<a name="l2367"><span class="linenum">2367</span></a>          }
<a name="l2368"><span class="linenum">2368</span></a>      }
<a name="l2369"><span class="linenum">2369</span></a>      return true;
<a name="l2370"><span class="linenum">2370</span></a>  }
<a name="l2371"><span class="linenum">2371</span></a>  
<a name="l2372"><span class="linenum">2372</span></a>  <span class="comment">/**</span>
<a name="l2373"><span class="linenum">2373</span></a>  <span class="comment"> * marks ALL messages being sent from $fromuserid to $touserid as read</span>
<a name="l2374"><span class="linenum">2374</span></a>  <span class="comment"> *</span>
<a name="l2375"><span class="linenum">2375</span></a>  <span class="comment"> * @param int $touserid the id of the message recipient</span>
<a name="l2376"><span class="linenum">2376</span></a>  <span class="comment"> * @param int $fromuserid the id of the message sender</span>
<a name="l2377"><span class="linenum">2377</span></a>  <span class="comment"> * @return void</span>
<a name="l2378"><span class="linenum">2378</span></a>  <span class="comment"> */</span>
<a name="l2379"><span class="linenum">2379</span></a>  function <a class="function" onClick="logFunction('message_mark_messages_read')" href="../_functions/message_mark_messages_read.html" onMouseOver="funcPopup(event,'message_mark_messages_read')">message_mark_messages_read</a>(<a class="var it21357" onMouseOver="hilite(21357)" onMouseOut="lolite()" onClick="logVariable('touserid')" href="../_variables/touserid.html">$touserid</a>, <a class="var it21358" onMouseOver="hilite(21358)" onMouseOut="lolite()" onClick="logVariable('fromuserid')" href="../_variables/fromuserid.html">$fromuserid</a>) {
<a name="l2380"><span class="linenum">2380</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2381"><span class="linenum">2381</span></a>  
<a name="l2382"><span class="linenum">2382</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = 'SELECT m.* FROM {message} m WHERE m.useridto=:useridto AND m.useridfrom=:useridfrom';
<a name="l2383"><span class="linenum">2383</span></a>      <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array('useridto' =&gt; <a class="var it21357" onMouseOver="hilite(21357)" onMouseOut="lolite()" onClick="logVariable('touserid')" href="../_variables/touserid.html">$touserid</a>,'useridfrom' =&gt; <a class="var it21358" onMouseOver="hilite(21358)" onMouseOut="lolite()" onClick="logVariable('fromuserid')" href="../_variables/fromuserid.html">$fromuserid</a>));
<a name="l2384"><span class="linenum">2384</span></a>  
<a name="l2385"><span class="linenum">2385</span></a>      foreach (<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> as <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>) {
<a name="l2386"><span class="linenum">2386</span></a>          <a class="function" onClick="logFunction('message_mark_message_read')" href="../_functions/message_mark_message_read.html" onMouseOver="funcPopup(event,'message_mark_message_read')">message_mark_message_read</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>());
<a name="l2387"><span class="linenum">2387</span></a>      }
<a name="l2388"><span class="linenum">2388</span></a>  
<a name="l2389"><span class="linenum">2389</span></a>      <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2390"><span class="linenum">2390</span></a>  }
<a name="l2391"><span class="linenum">2391</span></a>  
<a name="l2392"><span class="linenum">2392</span></a>  <span class="comment">/**</span>
<a name="l2393"><span class="linenum">2393</span></a>  <span class="comment"> * Mark a single message as read</span>
<a name="l2394"><span class="linenum">2394</span></a>  <span class="comment"> *</span>
<a name="l2395"><span class="linenum">2395</span></a>  <span class="comment"> * @param stdClass $message An object with an object property ie $message-&gt;id which is an id in the message table</span>
<a name="l2396"><span class="linenum">2396</span></a>  <span class="comment"> * @param int $timeread the timestamp for when the message should be marked read. Usually time().</span>
<a name="l2397"><span class="linenum">2397</span></a>  <span class="comment"> * @param bool $messageworkingempty Is the message_working table already confirmed empty for this message?</span>
<a name="l2398"><span class="linenum">2398</span></a>  <span class="comment"> * @return int the ID of the message in the message_read table</span>
<a name="l2399"><span class="linenum">2399</span></a>  <span class="comment"> */</span>
<a name="l2400"><span class="linenum">2400</span></a>  function <a class="function" onClick="logFunction('message_mark_message_read')" href="../_functions/message_mark_message_read.html" onMouseOver="funcPopup(event,'message_mark_message_read')">message_mark_message_read</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it3128" onMouseOver="hilite(3128)" onMouseOut="lolite()" onClick="logVariable('timeread')" href="../_variables/timeread.html">$timeread</a>, <a class="var it21359" onMouseOver="hilite(21359)" onMouseOut="lolite()" onClick="logVariable('messageworkingempty')" href="../_variables/messageworkingempty.html">$messageworkingempty</a>=false) {
<a name="l2401"><span class="linenum">2401</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2402"><span class="linenum">2402</span></a>  
<a name="l2403"><span class="linenum">2403</span></a>      <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('timeread')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/timeread.html">timeread</a> = <a class="var it3128" onMouseOver="hilite(3128)" onMouseOut="lolite()" onClick="logVariable('timeread')" href="../_variables/timeread.html">$timeread</a>;
<a name="l2404"><span class="linenum">2404</span></a>  
<a name="l2405"><span class="linenum">2405</span></a>      <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('messageid')" href="../_variables/messageid.html">$messageid</a> = <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l2406"><span class="linenum">2406</span></a>      unset(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('id')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);<span class="comment">//unset because it will get a new id on insert into message_read</span>
<a name="l2407"><span class="linenum">2407</span></a>  
<a name="l2408"><span class="linenum">2408</span></a>  <span class="comment">    //If any processors have pending actions abort them</span>
<a name="l2409"><span class="linenum">2409</span></a>      if (!<a class="var it21359" onMouseOver="hilite(21359)" onMouseOut="lolite()" onClick="logVariable('messageworkingempty')" href="../_variables/messageworkingempty.html">$messageworkingempty</a>) {
<a name="l2410"><span class="linenum">2410</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('message_working', array('unreadmessageid' =&gt; <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('messageid')" href="../_variables/messageid.html">$messageid</a>));
<a name="l2411"><span class="linenum">2411</span></a>      }
<a name="l2412"><span class="linenum">2412</span></a>      <a class="var it21360" onMouseOver="hilite(21360)" onMouseOut="lolite()" onClick="logVariable('messagereadid')" href="../_variables/messagereadid.html">$messagereadid</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('message_read', <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>);
<a name="l2413"><span class="linenum">2413</span></a>  
<a name="l2414"><span class="linenum">2414</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('message', array('id' =&gt; <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('messageid')" href="../_variables/messageid.html">$messageid</a>));
<a name="l2415"><span class="linenum">2415</span></a>  
<a name="l2416"><span class="linenum">2416</span></a>  <span class="comment">    // Get the context for the user who received the message.</span>
<a name="l2417"><span class="linenum">2417</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>, <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>);
<a name="l2418"><span class="linenum">2418</span></a>  <span class="comment">    // If the user no longer exists the context value will be false, in this case use the system context.</span>
<a name="l2419"><span class="linenum">2419</span></a>      if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> === false) {
<a name="l2420"><span class="linenum">2420</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l2421"><span class="linenum">2421</span></a>      }
<a name="l2422"><span class="linenum">2422</span></a>  
<a name="l2423"><span class="linenum">2423</span></a>  <span class="comment">    // Trigger event for reading a message.</span>
<a name="l2424"><span class="linenum">2424</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('message_viewed')" href="../_classes/message_viewed.html" onMouseOver="classPopup(event,'message_viewed')">message_viewed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(array(
<a name="l2425"><span class="linenum">2425</span></a>          'objectid' =&gt; <a class="var it21360" onMouseOver="hilite(21360)" onMouseOut="lolite()" onClick="logVariable('messagereadid')" href="../_variables/messagereadid.html">$messagereadid</a>,
<a name="l2426"><span class="linenum">2426</span></a>          'userid' =&gt; <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridto')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridto.html">useridto</a>, // Using the user who read the message as they are the ones performing the action.
<a name="l2427"><span class="linenum">2427</span></a>          'context' =&gt; <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>,
<a name="l2428"><span class="linenum">2428</span></a>          'relateduserid' =&gt; <a class="var it643" onMouseOver="hilite(643)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('useridfrom')" class="var it39615" onMouseOver="hilite(39615)" onMouseOut="lolite()" href="../_variables/useridfrom.html">useridfrom</a>,
<a name="l2429"><span class="linenum">2429</span></a>          'other' =&gt; array(
<a name="l2430"><span class="linenum">2430</span></a>              'messageid' =&gt; <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('messageid')" href="../_variables/messageid.html">$messageid</a>
<a name="l2431"><span class="linenum">2431</span></a>          )
<a name="l2432"><span class="linenum">2432</span></a>      ));
<a name="l2433"><span class="linenum">2433</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2434"><span class="linenum">2434</span></a>  
<a name="l2435"><span class="linenum">2435</span></a>      return <a class="var it21360" onMouseOver="hilite(21360)" onMouseOut="lolite()" onClick="logVariable('messagereadid')" href="../_variables/messagereadid.html">$messagereadid</a>;
<a name="l2436"><span class="linenum">2436</span></a>  }
<a name="l2437"><span class="linenum">2437</span></a>  
<a name="l2438"><span class="linenum">2438</span></a>  <span class="comment">/**</span>
<a name="l2439"><span class="linenum">2439</span></a>  <span class="comment"> * Get all message processors, validate corresponding plugin existance and</span>
<a name="l2440"><span class="linenum">2440</span></a>  <span class="comment"> * system configuration</span>
<a name="l2441"><span class="linenum">2441</span></a>  <span class="comment"> *</span>
<a name="l2442"><span class="linenum">2442</span></a>  <span class="comment"> * @param bool $ready only return ready-to-use processors</span>
<a name="l2443"><span class="linenum">2443</span></a>  <span class="comment"> * @param bool $reset Reset list of message processors (used in unit tests)</span>
<a name="l2444"><span class="linenum">2444</span></a>  <span class="comment"> * @return mixed $processors array of objects containing information on message processors</span>
<a name="l2445"><span class="linenum">2445</span></a>  <span class="comment"> */</span>
<a name="l2446"><span class="linenum">2446</span></a>  function <a class="function" onClick="logFunction('get_message_processors')" href="../_functions/get_message_processors.html" onMouseOver="funcPopup(event,'get_message_processors')">get_message_processors</a>(<a class="var it21361" onMouseOver="hilite(21361)" onMouseOut="lolite()" onClick="logVariable('ready')" href="../_variables/ready.html">$ready</a> = false, <a class="var it1022" onMouseOver="hilite(1022)" onMouseOut="lolite()" onClick="logVariable('reset')" href="../_variables/reset.html">$reset</a> = false) {
<a name="l2447"><span class="linenum">2447</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l2448"><span class="linenum">2448</span></a>  
<a name="l2449"><span class="linenum">2449</span></a>      static <a class="var it17330" onMouseOver="hilite(17330)" onMouseOut="lolite()" onClick="logVariable('processors')" href="../_variables/processors.html">$processors</a>;
<a name="l2450"><span class="linenum">2450</span></a>      if (<a class="var it1022" onMouseOver="hilite(1022)" onMouseOut="lolite()" onClick="logVariable('reset')" href="../_variables/reset.html">$reset</a>) {
<a name="l2451"><span class="linenum">2451</span></a>          <a class="var it17330" onMouseOver="hilite(17330)" onMouseOut="lolite()" onClick="logVariable('processors')" href="../_variables/processors.html">$processors</a> = array();
<a name="l2452"><span class="linenum">2452</span></a>      }
<a name="l2453"><span class="linenum">2453</span></a>  
<a name="l2454"><span class="linenum">2454</span></a>      if (empty(<a class="var it17330" onMouseOver="hilite(17330)" onMouseOut="lolite()" onClick="logVariable('processors')" href="../_variables/processors.html">$processors</a>)) {
<a name="l2455"><span class="linenum">2455</span></a>  <span class="comment">        // Get all processors, ensure the name column is the first so it will be the array key</span>
<a name="l2456"><span class="linenum">2456</span></a>          <a class="var it17330" onMouseOver="hilite(17330)" onMouseOut="lolite()" onClick="logVariable('processors')" href="../_variables/processors.html">$processors</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('message_processors', null, 'name DESC', 'name, id, enabled');
<a name="l2457"><span class="linenum">2457</span></a>          foreach (<a class="var it17330" onMouseOver="hilite(17330)" onMouseOut="lolite()" onClick="logVariable('processors')" href="../_variables/processors.html">$processors</a> as &amp;<a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>){
<a name="l2458"><span class="linenum">2458</span></a>              <a class="var it21362" onMouseOver="hilite(21362)" onMouseOut="lolite()" onClick="logVariable('processorfile')" href="../_variables/processorfile.html">$processorfile</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>. '/message/output/'.<a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('name')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/name.html">name</a>.'/message_output_'.<a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('name')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/name.html">name</a>.'.php';
<a name="l2459"><span class="linenum">2459</span></a>              if (<a class="phpfunction" onClick="logFunction('is_readable')" href="../_functions/is_readable.html" onMouseOver="phpfuncPopup(event,'is_readable')">is_readable</a>(<a class="var it21362" onMouseOver="hilite(21362)" onMouseOut="lolite()" onClick="logVariable('processorfile')" href="../_variables/processorfile.html">$processorfile</a>)) {
<a name="l2460"><span class="linenum">2460</span></a>                  include_once(<a class="var it21362" onMouseOver="hilite(21362)" onMouseOut="lolite()" onClick="logVariable('processorfile')" href="../_variables/processorfile.html">$processorfile</a>);
<a name="l2461"><span class="linenum">2461</span></a>                  <a class="var it21363" onMouseOver="hilite(21363)" onMouseOut="lolite()" onClick="logVariable('processclass')" href="../_variables/processclass.html">$processclass</a> = 'message_output_' . <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('name')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l2462"><span class="linenum">2462</span></a>                  if (<a class="phpfunction" onClick="logFunction('class_exists')" href="../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>(<a class="var it21363" onMouseOver="hilite(21363)" onMouseOut="lolite()" onClick="logVariable('processclass')" href="../_variables/processclass.html">$processclass</a>)) {
<a name="l2463"><span class="linenum">2463</span></a>                      <a class="var it21364" onMouseOver="hilite(21364)" onMouseOut="lolite()" onClick="logVariable('pclass')" href="../_variables/pclass.html">$pclass</a> = new <a class="var it21363" onMouseOver="hilite(21363)" onMouseOut="lolite()" onClick="logVariable('processclass')" href="../_variables/processclass.html">$processclass</a>();
<a name="l2464"><span class="linenum">2464</span></a>                      <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('object')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/object.html">object</a> = <a class="var it21364" onMouseOver="hilite(21364)" onMouseOut="lolite()" onClick="logVariable('pclass')" href="../_variables/pclass.html">$pclass</a>;
<a name="l2465"><span class="linenum">2465</span></a>                      <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('configured')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/configured.html">configured</a> = 0;
<a name="l2466"><span class="linenum">2466</span></a>                      if (<a class="var it21364" onMouseOver="hilite(21364)" onMouseOut="lolite()" onClick="logVariable('pclass')" href="../_variables/pclass.html">$pclass</a>-&gt;<a class="function" onClick="logFunction('is_system_configured')" href="../_functions/is_system_configured.html" onMouseOver="funcPopup(event,'is_system_configured')">is_system_configured</a>()) {
<a name="l2467"><span class="linenum">2467</span></a>                          <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('configured')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/configured.html">configured</a> = 1;
<a name="l2468"><span class="linenum">2468</span></a>                      }
<a name="l2469"><span class="linenum">2469</span></a>                      <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('hassettings')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/hassettings.html">hassettings</a> = 0;
<a name="l2470"><span class="linenum">2470</span></a>                      if (<a class="phpfunction" onClick="logFunction('is_readable')" href="../_functions/is_readable.html" onMouseOver="phpfuncPopup(event,'is_readable')">is_readable</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'/message/output/'.<a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('name')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/name.html">name</a>.'/settings.php')) {
<a name="l2471"><span class="linenum">2471</span></a>                          <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('hassettings')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/hassettings.html">hassettings</a> = 1;
<a name="l2472"><span class="linenum">2472</span></a>                      }
<a name="l2473"><span class="linenum">2473</span></a>                      <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('available')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/available.html">available</a> = 1;
<a name="l2474"><span class="linenum">2474</span></a>                  } else {
<a name="l2475"><span class="linenum">2475</span></a>                      <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('errorcallingprocessor', 'message');
<a name="l2476"><span class="linenum">2476</span></a>                  }
<a name="l2477"><span class="linenum">2477</span></a>              } else {
<a name="l2478"><span class="linenum">2478</span></a>                  <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a onClick="logVariable('available')" class="var it40115" onMouseOver="hilite(40115)" onMouseOut="lolite()" href="../_variables/available.html">available</a> = 0;
<a name="l2479"><span class="linenum">2479</span></a>              }
<a name="l2480"><span class="linenum">2480</span></a>          }
<a name="l2481"><span class="linenum">2481</span></a>      }
<a name="l2482"><span class="linenum">2482</span></a>      if (<a class="var it21361" onMouseOver="hilite(21361)" onMouseOut="lolite()" onClick="logVariable('ready')" href="../_variables/ready.html">$ready</a>) {
<a name="l2483"><span class="linenum">2483</span></a>  <span class="comment">        // Filter out enabled and system_configured processors</span>
<a name="l2484"><span class="linenum">2484</span></a>          <a class="var it21365" onMouseOver="hilite(21365)" onMouseOut="lolite()" onClick="logVariable('readyprocessors')" href="../_variables/readyprocessors.html">$readyprocessors</a> = <a class="var it17330" onMouseOver="hilite(17330)" onMouseOut="lolite()" onClick="logVariable('processors')" href="../_variables/processors.html">$processors</a>;
<a name="l2485"><span class="linenum">2485</span></a>          foreach (<a class="var it21365" onMouseOver="hilite(21365)" onMouseOut="lolite()" onClick="logVariable('readyprocessors')" href="../_variables/readyprocessors.html">$readyprocessors</a> as <a class="var it21366" onMouseOver="hilite(21366)" onMouseOut="lolite()" onClick="logVariable('readyprocessor')" href="../_variables/readyprocessor.html">$readyprocessor</a>) {
<a name="l2486"><span class="linenum">2486</span></a>              if (!(<a class="var it21366" onMouseOver="hilite(21366)" onMouseOut="lolite()" onClick="logVariable('readyprocessor')" href="../_variables/readyprocessor.html">$readyprocessor</a>-&gt;<a onClick="logVariable('enabled')" class="var it42199" onMouseOver="hilite(42199)" onMouseOut="lolite()" href="../_variables/enabled.html">enabled</a> &amp;&amp; <a class="var it21366" onMouseOver="hilite(21366)" onMouseOut="lolite()" onClick="logVariable('readyprocessor')" href="../_variables/readyprocessor.html">$readyprocessor</a>-&gt;<a onClick="logVariable('configured')" class="var it42199" onMouseOver="hilite(42199)" onMouseOut="lolite()" href="../_variables/configured.html">configured</a>)) {
<a name="l2487"><span class="linenum">2487</span></a>                  unset(<a class="var it21365" onMouseOver="hilite(21365)" onMouseOut="lolite()" onClick="logVariable('readyprocessors')" href="../_variables/readyprocessors.html">$readyprocessors</a>[<a class="var it21366" onMouseOver="hilite(21366)" onMouseOut="lolite()" onClick="logVariable('readyprocessor')" href="../_variables/readyprocessor.html">$readyprocessor</a>-&gt;<a onClick="logVariable('name')" class="var it42199" onMouseOver="hilite(42199)" onMouseOut="lolite()" href="../_variables/name.html">name</a>]);
<a name="l2488"><span class="linenum">2488</span></a>              }
<a name="l2489"><span class="linenum">2489</span></a>          }
<a name="l2490"><span class="linenum">2490</span></a>          return <a class="var it21365" onMouseOver="hilite(21365)" onMouseOut="lolite()" onClick="logVariable('readyprocessors')" href="../_variables/readyprocessors.html">$readyprocessors</a>;
<a name="l2491"><span class="linenum">2491</span></a>      }
<a name="l2492"><span class="linenum">2492</span></a>  
<a name="l2493"><span class="linenum">2493</span></a>      return <a class="var it17330" onMouseOver="hilite(17330)" onMouseOut="lolite()" onClick="logVariable('processors')" href="../_variables/processors.html">$processors</a>;
<a name="l2494"><span class="linenum">2494</span></a>  }
<a name="l2495"><span class="linenum">2495</span></a>  
<a name="l2496"><span class="linenum">2496</span></a>  <span class="comment">/**</span>
<a name="l2497"><span class="linenum">2497</span></a>  <span class="comment"> * Get all message providers, validate their plugin existance and</span>
<a name="l2498"><span class="linenum">2498</span></a>  <span class="comment"> * system configuration</span>
<a name="l2499"><span class="linenum">2499</span></a>  <span class="comment"> *</span>
<a name="l2500"><span class="linenum">2500</span></a>  <span class="comment"> * @return mixed $processors array of objects containing information on message processors</span>
<a name="l2501"><span class="linenum">2501</span></a>  <span class="comment"> */</span>
<a name="l2502"><span class="linenum">2502</span></a>  function <a class="function" onClick="logFunction('get_message_providers')" href="../_functions/get_message_providers.html" onMouseOver="funcPopup(event,'get_message_providers')">get_message_providers</a>() {
<a name="l2503"><span class="linenum">2503</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2504"><span class="linenum">2504</span></a>  
<a name="l2505"><span class="linenum">2505</span></a>      <a class="var it1829" onMouseOver="hilite(1829)" onMouseOut="lolite()" onClick="logVariable('pluginman')" href="../_variables/pluginman.html">$pluginman</a> = <a class="class" onClick="logClass('core_plugin_manager')" href="../_classes/core_plugin_manager.html" onMouseOver="classPopup(event,'core_plugin_manager')">core_plugin_manager</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l2506"><span class="linenum">2506</span></a>  
<a name="l2507"><span class="linenum">2507</span></a>      <a class="var it17344" onMouseOver="hilite(17344)" onMouseOut="lolite()" onClick="logVariable('providers')" href="../_variables/providers.html">$providers</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('message_providers', null, 'name');
<a name="l2508"><span class="linenum">2508</span></a>  
<a name="l2509"><span class="linenum">2509</span></a>  <span class="comment">    // Remove all the providers whose plugins are disabled or don't exist</span>
<a name="l2510"><span class="linenum">2510</span></a>      foreach (<a class="var it17344" onMouseOver="hilite(17344)" onMouseOut="lolite()" onClick="logVariable('providers')" href="../_variables/providers.html">$providers</a> as <a class="var it17351" onMouseOver="hilite(17351)" onMouseOut="lolite()" onClick="logVariable('providerid')" href="../_variables/providerid.html">$providerid</a> =&gt; <a class="var it4130" onMouseOver="hilite(4130)" onMouseOut="lolite()" onClick="logVariable('provider')" href="../_variables/provider.html">$provider</a>) {
<a name="l2511"><span class="linenum">2511</span></a>          <a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a> = <a class="var it1829" onMouseOver="hilite(1829)" onMouseOut="lolite()" onClick="logVariable('pluginman')" href="../_variables/pluginman.html">$pluginman</a>-&gt;<a class="function" onClick="logFunction('get_plugin_info')" href="../_functions/get_plugin_info.html" onMouseOver="funcPopup(event,'get_plugin_info')">get_plugin_info</a>(<a class="var it4130" onMouseOver="hilite(4130)" onMouseOut="lolite()" onClick="logVariable('provider')" href="../_variables/provider.html">$provider</a>-&gt;<a onClick="logVariable('component')" class="var it39611" onMouseOver="hilite(39611)" onMouseOut="lolite()" href="../_variables/component.html">component</a>);
<a name="l2512"><span class="linenum">2512</span></a>          if (<a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>) {
<a name="l2513"><span class="linenum">2513</span></a>              if (<a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() === <a class="class" onClick="logClass('core_plugin_manager')" href="../_classes/core_plugin_manager.html" onMouseOver="classPopup(event,'core_plugin_manager')">core_plugin_manager</a>::PLUGIN_STATUS_MISSING) {
<a name="l2514"><span class="linenum">2514</span></a>                  unset(<a class="var it17344" onMouseOver="hilite(17344)" onMouseOut="lolite()" onClick="logVariable('providers')" href="../_variables/providers.html">$providers</a>[<a class="var it17351" onMouseOver="hilite(17351)" onMouseOut="lolite()" onClick="logVariable('providerid')" href="../_variables/providerid.html">$providerid</a>]);   <span class="comment">// Plugins does not exist</span>
<a name="l2515"><span class="linenum">2515</span></a>                  continue;
<a name="l2516"><span class="linenum">2516</span></a>              }
<a name="l2517"><span class="linenum">2517</span></a>              if (<a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('is_enabled')" href="../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>() === false) {
<a name="l2518"><span class="linenum">2518</span></a>                  unset(<a class="var it17344" onMouseOver="hilite(17344)" onMouseOut="lolite()" onClick="logVariable('providers')" href="../_variables/providers.html">$providers</a>[<a class="var it17351" onMouseOver="hilite(17351)" onMouseOut="lolite()" onClick="logVariable('providerid')" href="../_variables/providerid.html">$providerid</a>]);   <span class="comment">// Plugin disabled</span>
<a name="l2519"><span class="linenum">2519</span></a>                  continue;
<a name="l2520"><span class="linenum">2520</span></a>              }
<a name="l2521"><span class="linenum">2521</span></a>          }
<a name="l2522"><span class="linenum">2522</span></a>      }
<a name="l2523"><span class="linenum">2523</span></a>      return <a class="var it17344" onMouseOver="hilite(17344)" onMouseOut="lolite()" onClick="logVariable('providers')" href="../_variables/providers.html">$providers</a>;
<a name="l2524"><span class="linenum">2524</span></a>  }
<a name="l2525"><span class="linenum">2525</span></a>  
<a name="l2526"><span class="linenum">2526</span></a>  <span class="comment">/**</span>
<a name="l2527"><span class="linenum">2527</span></a>  <span class="comment"> * Get an instance of the message_output class for one of the output plugins.</span>
<a name="l2528"><span class="linenum">2528</span></a>  <span class="comment"> * @param string $type the message output type. E.g. 'email' or 'jabber'.</span>
<a name="l2529"><span class="linenum">2529</span></a>  <span class="comment"> * @return message_output message_output the requested class.</span>
<a name="l2530"><span class="linenum">2530</span></a>  <span class="comment"> */</span>
<a name="l2531"><span class="linenum">2531</span></a>  function <a class="function" onClick="logFunction('get_message_processor')" href="../_functions/get_message_processor.html" onMouseOver="funcPopup(event,'get_message_processor')">get_message_processor</a>(<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>) {
<a name="l2532"><span class="linenum">2532</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l2533"><span class="linenum">2533</span></a>  
<a name="l2534"><span class="linenum">2534</span></a>  <span class="comment">    // Note, we cannot use the get_message_processors function here, becaues this</span>
<a name="l2535"><span class="linenum">2535</span></a>  <span class="comment">    // code is called during install after installing each messaging plugin, and</span>
<a name="l2536"><span class="linenum">2536</span></a>  <span class="comment">    // get_message_processors caches the list of installed plugins.</span>
<a name="l2537"><span class="linenum">2537</span></a>  
<a name="l2538"><span class="linenum">2538</span></a>      <a class="var it21362" onMouseOver="hilite(21362)" onMouseOut="lolite()" onClick="logVariable('processorfile')" href="../_variables/processorfile.html">$processorfile</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a> . &quot;/message/output/{<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>}/message_output_{<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>}.php&quot;;
<a name="l2539"><span class="linenum">2539</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_readable')" href="../_functions/is_readable.html" onMouseOver="phpfuncPopup(event,'is_readable')">is_readable</a>(<a class="var it21362" onMouseOver="hilite(21362)" onMouseOut="lolite()" onClick="logVariable('processorfile')" href="../_variables/processorfile.html">$processorfile</a>)) {
<a name="l2540"><span class="linenum">2540</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Unknown message processor type ' . <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>);
<a name="l2541"><span class="linenum">2541</span></a>      }
<a name="l2542"><span class="linenum">2542</span></a>  
<a name="l2543"><span class="linenum">2543</span></a>      include_once(<a class="var it21362" onMouseOver="hilite(21362)" onMouseOut="lolite()" onClick="logVariable('processorfile')" href="../_variables/processorfile.html">$processorfile</a>);
<a name="l2544"><span class="linenum">2544</span></a>  
<a name="l2545"><span class="linenum">2545</span></a>      <a class="var it21363" onMouseOver="hilite(21363)" onMouseOut="lolite()" onClick="logVariable('processclass')" href="../_variables/processclass.html">$processclass</a> = 'message_output_' . <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>;
<a name="l2546"><span class="linenum">2546</span></a>      if (!<a class="phpfunction" onClick="logFunction('class_exists')" href="../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>(<a class="var it21363" onMouseOver="hilite(21363)" onMouseOut="lolite()" onClick="logVariable('processclass')" href="../_variables/processclass.html">$processclass</a>)) {
<a name="l2547"><span class="linenum">2547</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Message processor ' . <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> .
<a name="l2548"><span class="linenum">2548</span></a>                  ' does not define the right class');
<a name="l2549"><span class="linenum">2549</span></a>      }
<a name="l2550"><span class="linenum">2550</span></a>  
<a name="l2551"><span class="linenum">2551</span></a>      return new <a class="var it21363" onMouseOver="hilite(21363)" onMouseOut="lolite()" onClick="logVariable('processclass')" href="../_variables/processclass.html">$processclass</a>();
<a name="l2552"><span class="linenum">2552</span></a>  }
<a name="l2553"><span class="linenum">2553</span></a>  
<a name="l2554"><span class="linenum">2554</span></a>  <span class="comment">/**</span>
<a name="l2555"><span class="linenum">2555</span></a>  <span class="comment"> * Get messaging outputs default (site) preferences</span>
<a name="l2556"><span class="linenum">2556</span></a>  <span class="comment"> *</span>
<a name="l2557"><span class="linenum">2557</span></a>  <span class="comment"> * @return object $processors object containing information on message processors</span>
<a name="l2558"><span class="linenum">2558</span></a>  <span class="comment"> */</span>
<a name="l2559"><span class="linenum">2559</span></a>  function <a class="function" onClick="logFunction('get_message_output_default_preferences')" href="../_functions/get_message_output_default_preferences.html" onMouseOver="funcPopup(event,'get_message_output_default_preferences')">get_message_output_default_preferences</a>() {
<a name="l2560"><span class="linenum">2560</span></a>      return <a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('message');
<a name="l2561"><span class="linenum">2561</span></a>  }
<a name="l2562"><span class="linenum">2562</span></a>  
<a name="l2563"><span class="linenum">2563</span></a>  <span class="comment">/**</span>
<a name="l2564"><span class="linenum">2564</span></a>  <span class="comment"> * Translate message default settings from binary value to the array of string</span>
<a name="l2565"><span class="linenum">2565</span></a>  <span class="comment"> * representing the settings to be stored. Also validate the provided value and</span>
<a name="l2566"><span class="linenum">2566</span></a>  <span class="comment"> * use default if it is malformed.</span>
<a name="l2567"><span class="linenum">2567</span></a>  <span class="comment"> *</span>
<a name="l2568"><span class="linenum">2568</span></a>  <span class="comment"> * @param  int    $plugindefault Default setting suggested by plugin</span>
<a name="l2569"><span class="linenum">2569</span></a>  <span class="comment"> * @param  string $processorname The name of processor</span>
<a name="l2570"><span class="linenum">2570</span></a>  <span class="comment"> * @return array  $settings array of strings in the order: $permitted, $loggedin, $loggedoff.</span>
<a name="l2571"><span class="linenum">2571</span></a>  <span class="comment"> */</span>
<a name="l2572"><span class="linenum">2572</span></a>  function <a class="function" onClick="logFunction('translate_message_default_setting')" href="../_functions/translate_message_default_setting.html" onMouseOver="funcPopup(event,'translate_message_default_setting')">translate_message_default_setting</a>(<a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a>, <a class="var it17343" onMouseOver="hilite(17343)" onMouseOut="lolite()" onClick="logVariable('processorname')" href="../_variables/processorname.html">$processorname</a>) {
<a name="l2573"><span class="linenum">2573</span></a>  <span class="comment">    // Preset translation arrays</span>
<a name="l2574"><span class="linenum">2574</span></a>      <a class="var it21367" onMouseOver="hilite(21367)" onMouseOut="lolite()" onClick="logVariable('permittedvalues')" href="../_variables/permittedvalues.html">$permittedvalues</a> = array(
<a name="l2575"><span class="linenum">2575</span></a>          0x04 =&gt; 'disallowed',
<a name="l2576"><span class="linenum">2576</span></a>          0x08 =&gt; 'permitted',
<a name="l2577"><span class="linenum">2577</span></a>          0x0c =&gt; 'forced',
<a name="l2578"><span class="linenum">2578</span></a>      );
<a name="l2579"><span class="linenum">2579</span></a>  
<a name="l2580"><span class="linenum">2580</span></a>      <a class="var it21368" onMouseOver="hilite(21368)" onMouseOut="lolite()" onClick="logVariable('loggedinstatusvalues')" href="../_variables/loggedinstatusvalues.html">$loggedinstatusvalues</a> = array(
<a name="l2581"><span class="linenum">2581</span></a>          0x00 =&gt; null, // use null if loggedin/loggedoff is not defined
<a name="l2582"><span class="linenum">2582</span></a>          0x01 =&gt; 'loggedin',
<a name="l2583"><span class="linenum">2583</span></a>          0x02 =&gt; 'loggedoff',
<a name="l2584"><span class="linenum">2584</span></a>      );
<a name="l2585"><span class="linenum">2585</span></a>  
<a name="l2586"><span class="linenum">2586</span></a>  <span class="comment">    // define the default setting</span>
<a name="l2587"><span class="linenum">2587</span></a>      <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a> = <a class="function" onClick="logFunction('get_message_processor')" href="../_functions/get_message_processor.html" onMouseOver="funcPopup(event,'get_message_processor')">get_message_processor</a>(<a class="var it17343" onMouseOver="hilite(17343)" onMouseOut="lolite()" onClick="logVariable('processorname')" href="../_variables/processorname.html">$processorname</a>);
<a name="l2588"><span class="linenum">2588</span></a>      <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a> = <a class="var it7620" onMouseOver="hilite(7620)" onMouseOut="lolite()" onClick="logVariable('processor')" href="../_variables/processor.html">$processor</a>-&gt;<a class="function" onClick="logFunction('get_default_messaging_settings')" href="../_functions/get_default_messaging_settings.html" onMouseOver="funcPopup(event,'get_default_messaging_settings')">get_default_messaging_settings</a>();
<a name="l2589"><span class="linenum">2589</span></a>  
<a name="l2590"><span class="linenum">2590</span></a>  <span class="comment">    // Validate the value. It should not exceed the maximum size</span>
<a name="l2591"><span class="linenum">2591</span></a>      if (!is_int(<a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a>) || (<a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a> &gt; 0x0f)) {
<a name="l2592"><span class="linenum">2592</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('errortranslatingdefault', 'message'));
<a name="l2593"><span class="linenum">2593</span></a>          <a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a> = <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a>;
<a name="l2594"><span class="linenum">2594</span></a>      }
<a name="l2595"><span class="linenum">2595</span></a>  <span class="comment">    // Use plugin default setting of 'permitted' is 0</span>
<a name="l2596"><span class="linenum">2596</span></a>      if (!(<a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a> &amp; <a class="constant" onClick="logConstant('MESSAGE_PERMITTED_MASK')" href="../_constants/MESSAGE_PERMITTED_MASK.html" onMouseOver="constPopup(event,'MESSAGE_PERMITTED_MASK')">MESSAGE_PERMITTED_MASK</a>)) {
<a name="l2597"><span class="linenum">2597</span></a>          <a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a> = <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a>;
<a name="l2598"><span class="linenum">2598</span></a>      }
<a name="l2599"><span class="linenum">2599</span></a>  
<a name="l2600"><span class="linenum">2600</span></a>      <a class="var it17333" onMouseOver="hilite(17333)" onMouseOut="lolite()" onClick="logVariable('permitted')" href="../_variables/permitted.html">$permitted</a> = <a class="var it21367" onMouseOver="hilite(21367)" onMouseOut="lolite()" onClick="logVariable('permittedvalues')" href="../_variables/permittedvalues.html">$permittedvalues</a>[<a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a> &amp; <a class="constant" onClick="logConstant('MESSAGE_PERMITTED_MASK')" href="../_constants/MESSAGE_PERMITTED_MASK.html" onMouseOver="constPopup(event,'MESSAGE_PERMITTED_MASK')">MESSAGE_PERMITTED_MASK</a>];
<a name="l2601"><span class="linenum">2601</span></a>      <a class="var it11930" onMouseOver="hilite(11930)" onMouseOut="lolite()" onClick="logVariable('loggedin')" href="../_variables/loggedin.html">$loggedin</a> = <a class="var it17350" onMouseOver="hilite(17350)" onMouseOut="lolite()" onClick="logVariable('loggedoff')" href="../_variables/loggedoff.html">$loggedoff</a> = null;
<a name="l2602"><span class="linenum">2602</span></a>  
<a name="l2603"><span class="linenum">2603</span></a>      if ((<a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a> &amp; <a class="constant" onClick="logConstant('MESSAGE_PERMITTED_MASK')" href="../_constants/MESSAGE_PERMITTED_MASK.html" onMouseOver="constPopup(event,'MESSAGE_PERMITTED_MASK')">MESSAGE_PERMITTED_MASK</a>) == <a class="constant" onClick="logConstant('MESSAGE_PERMITTED')" href="../_constants/MESSAGE_PERMITTED.html" onMouseOver="constPopup(event,'MESSAGE_PERMITTED')">MESSAGE_PERMITTED</a>) {
<a name="l2604"><span class="linenum">2604</span></a>          <a class="var it11930" onMouseOver="hilite(11930)" onMouseOut="lolite()" onClick="logVariable('loggedin')" href="../_variables/loggedin.html">$loggedin</a> = <a class="var it21368" onMouseOver="hilite(21368)" onMouseOut="lolite()" onClick="logVariable('loggedinstatusvalues')" href="../_variables/loggedinstatusvalues.html">$loggedinstatusvalues</a>[<a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a> &amp; <a class="constant" onClick="logConstant('MESSAGE_DEFAULT_LOGGEDIN')" href="../_constants/MESSAGE_DEFAULT_LOGGEDIN.html" onMouseOver="constPopup(event,'MESSAGE_DEFAULT_LOGGEDIN')">MESSAGE_DEFAULT_LOGGEDIN</a>];
<a name="l2605"><span class="linenum">2605</span></a>          <a class="var it17350" onMouseOver="hilite(17350)" onMouseOut="lolite()" onClick="logVariable('loggedoff')" href="../_variables/loggedoff.html">$loggedoff</a> = <a class="var it21368" onMouseOver="hilite(21368)" onMouseOut="lolite()" onClick="logVariable('loggedinstatusvalues')" href="../_variables/loggedinstatusvalues.html">$loggedinstatusvalues</a>[<a class="var it17349" onMouseOver="hilite(17349)" onMouseOut="lolite()" onClick="logVariable('plugindefault')" href="../_variables/plugindefault.html">$plugindefault</a> &amp; <a class="constant" onClick="logConstant('MESSAGE_DEFAULT_LOGGEDOFF')" href="../_constants/MESSAGE_DEFAULT_LOGGEDOFF.html" onMouseOver="constPopup(event,'MESSAGE_DEFAULT_LOGGEDOFF')">MESSAGE_DEFAULT_LOGGEDOFF</a>];
<a name="l2606"><span class="linenum">2606</span></a>      }
<a name="l2607"><span class="linenum">2607</span></a>  
<a name="l2608"><span class="linenum">2608</span></a>      return array(<a class="var it17333" onMouseOver="hilite(17333)" onMouseOut="lolite()" onClick="logVariable('permitted')" href="../_variables/permitted.html">$permitted</a>, <a class="var it11930" onMouseOver="hilite(11930)" onMouseOut="lolite()" onClick="logVariable('loggedin')" href="../_variables/loggedin.html">$loggedin</a>, <a class="var it17350" onMouseOver="hilite(17350)" onMouseOut="lolite()" onClick="logVariable('loggedoff')" href="../_variables/loggedoff.html">$loggedoff</a>);
<a name="l2609"><span class="linenum">2609</span></a>  }
<a name="l2610"><span class="linenum">2610</span></a>  
<a name="l2611"><span class="linenum">2611</span></a>  <span class="comment">/**</span>
<a name="l2612"><span class="linenum">2612</span></a>  <span class="comment"> * Return a list of page types</span>
<a name="l2613"><span class="linenum">2613</span></a>  <span class="comment"> * @param string $pagetype current page type</span>
<a name="l2614"><span class="linenum">2614</span></a>  <span class="comment"> * @param stdClass $parentcontext Block's parent context</span>
<a name="l2615"><span class="linenum">2615</span></a>  <span class="comment"> * @param stdClass $currentcontext Current context of block</span>
<a name="l2616"><span class="linenum">2616</span></a>  <span class="comment"> */</span>
<a name="l2617"><span class="linenum">2617</span></a>  function <a class="function" onClick="logFunction('message_page_type_list')" href="../_functions/message_page_type_list.html" onMouseOver="funcPopup(event,'message_page_type_list')">message_page_type_list</a>(<a class="var it3667" onMouseOver="hilite(3667)" onMouseOut="lolite()" onClick="logVariable('pagetype')" href="../_variables/pagetype.html">$pagetype</a>, <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a>, <a class="var it5093" onMouseOver="hilite(5093)" onMouseOut="lolite()" onClick="logVariable('currentcontext')" href="../_variables/currentcontext.html">$currentcontext</a>) {
<a name="l2618"><span class="linenum">2618</span></a>      return array('messages-*'=&gt;<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('page-message-x', 'message'));
<a name="l2619"><span class="linenum">2619</span></a>  }
<a name="l2620"><span class="linenum">2620</span></a>  
<a name="l2621"><span class="linenum">2621</span></a>  <span class="comment">/**</span>
<a name="l2622"><span class="linenum">2622</span></a>  <span class="comment"> * Get messages sent or/and received by the specified users.</span>
<a name="l2623"><span class="linenum">2623</span></a>  <span class="comment"> *</span>
<a name="l2624"><span class="linenum">2624</span></a>  <span class="comment"> * @param  int      $useridto       the user id who received the message</span>
<a name="l2625"><span class="linenum">2625</span></a>  <span class="comment"> * @param  int      $useridfrom     the user id who sent the message. -10 or -20 for no-reply or support user</span>
<a name="l2626"><span class="linenum">2626</span></a>  <span class="comment"> * @param  int      $notifications  1 for retrieving notifications, 0 for messages, -1 for both</span>
<a name="l2627"><span class="linenum">2627</span></a>  <span class="comment"> * @param  bool     $read           true for retrieving read messages, false for unread</span>
<a name="l2628"><span class="linenum">2628</span></a>  <span class="comment"> * @param  string   $sort           the column name to order by including optionally direction</span>
<a name="l2629"><span class="linenum">2629</span></a>  <span class="comment"> * @param  int      $limitfrom      limit from</span>
<a name="l2630"><span class="linenum">2630</span></a>  <span class="comment"> * @param  int      $limitnum       limit num</span>
<a name="l2631"><span class="linenum">2631</span></a>  <span class="comment"> * @return external_description</span>
<a name="l2632"><span class="linenum">2632</span></a>  <span class="comment"> * @since  2.8</span>
<a name="l2633"><span class="linenum">2633</span></a>  <span class="comment"> */</span>
<a name="l2634"><span class="linenum">2634</span></a>  function <a class="function" onClick="logFunction('message_get_messages')" href="../_functions/message_get_messages.html" onMouseOver="funcPopup(event,'message_get_messages')">message_get_messages</a>(<a class="var it3116" onMouseOver="hilite(3116)" onMouseOut="lolite()" onClick="logVariable('useridto')" href="../_variables/useridto.html">$useridto</a>, <a class="var it3117" onMouseOver="hilite(3117)" onMouseOut="lolite()" onClick="logVariable('useridfrom')" href="../_variables/useridfrom.html">$useridfrom</a> = 0, <a class="var it1836" onMouseOver="hilite(1836)" onMouseOut="lolite()" onClick="logVariable('notifications')" href="../_variables/notifications.html">$notifications</a> = -1, <a class="var it3118" onMouseOver="hilite(3118)" onMouseOut="lolite()" onClick="logVariable('read')" href="../_variables/read.html">$read</a> = true,
<a name="l2635"><span class="linenum">2635</span></a>                                  <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'mr.timecreated DESC', <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a> = 0, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a> = 0) {
<a name="l2636"><span class="linenum">2636</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2637"><span class="linenum">2637</span></a>  
<a name="l2638"><span class="linenum">2638</span></a>      <a class="var it21369" onMouseOver="hilite(21369)" onMouseOut="lolite()" onClick="logVariable('messagetable')" href="../_variables/messagetable.html">$messagetable</a> = <a class="var it3118" onMouseOver="hilite(3118)" onMouseOut="lolite()" onClick="logVariable('read')" href="../_variables/read.html">$read</a> ? '{message_read}' : '{message}';
<a name="l2639"><span class="linenum">2639</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('deleted' =&gt; 0);
<a name="l2640"><span class="linenum">2640</span></a>  
<a name="l2641"><span class="linenum">2641</span></a>  <span class="comment">    // Empty useridto means that we are going to retrieve messages send by the useridfrom to any user.</span>
<a name="l2642"><span class="linenum">2642</span></a>      if (empty(<a class="var it3116" onMouseOver="hilite(3116)" onMouseOut="lolite()" onClick="logVariable('useridto')" href="../_variables/useridto.html">$useridto</a>)) {
<a name="l2643"><span class="linenum">2643</span></a>          <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u', '', 'userto');
<a name="l2644"><span class="linenum">2644</span></a>          <a class="var it21370" onMouseOver="hilite(21370)" onMouseOut="lolite()" onClick="logVariable('joinsql')" href="../_variables/joinsql.html">$joinsql</a> = &quot;JOIN {user} u ON u.id = mr.useridto&quot;;
<a name="l2645"><span class="linenum">2645</span></a>          <a class="var it2971" onMouseOver="hilite(2971)" onMouseOut="lolite()" onClick="logVariable('usersql')" href="../_variables/usersql.html">$usersql</a> = &quot;mr.useridfrom = :useridfrom AND u.deleted = :deleted&quot;;
<a name="l2646"><span class="linenum">2646</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['useridfrom'] = <a class="var it3117" onMouseOver="hilite(3117)" onMouseOut="lolite()" onClick="logVariable('useridfrom')" href="../_variables/useridfrom.html">$useridfrom</a>;
<a name="l2647"><span class="linenum">2647</span></a>      } else {
<a name="l2648"><span class="linenum">2648</span></a>          <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u', '', 'userfrom');
<a name="l2649"><span class="linenum">2649</span></a>  <span class="comment">        // Left join because useridfrom may be -10 or -20 (no-reply and support users).</span>
<a name="l2650"><span class="linenum">2650</span></a>          <a class="var it21370" onMouseOver="hilite(21370)" onMouseOut="lolite()" onClick="logVariable('joinsql')" href="../_variables/joinsql.html">$joinsql</a> = &quot;LEFT JOIN {user} u ON u.id = mr.useridfrom&quot;;
<a name="l2651"><span class="linenum">2651</span></a>          <a class="var it2971" onMouseOver="hilite(2971)" onMouseOut="lolite()" onClick="logVariable('usersql')" href="../_variables/usersql.html">$usersql</a> = &quot;mr.useridto = :useridto AND (u.deleted IS NULL OR u.deleted = :deleted)&quot;;
<a name="l2652"><span class="linenum">2652</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['useridto'] = <a class="var it3116" onMouseOver="hilite(3116)" onMouseOut="lolite()" onClick="logVariable('useridto')" href="../_variables/useridto.html">$useridto</a>;
<a name="l2653"><span class="linenum">2653</span></a>          if (!empty(<a class="var it3117" onMouseOver="hilite(3117)" onMouseOut="lolite()" onClick="logVariable('useridfrom')" href="../_variables/useridfrom.html">$useridfrom</a>)) {
<a name="l2654"><span class="linenum">2654</span></a>              <a class="var it2971" onMouseOver="hilite(2971)" onMouseOut="lolite()" onClick="logVariable('usersql')" href="../_variables/usersql.html">$usersql</a> .= &quot; AND mr.useridfrom = :useridfrom&quot;;
<a name="l2655"><span class="linenum">2655</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['useridfrom'] = <a class="var it3117" onMouseOver="hilite(3117)" onMouseOut="lolite()" onClick="logVariable('useridfrom')" href="../_variables/useridfrom.html">$useridfrom</a>;
<a name="l2656"><span class="linenum">2656</span></a>          }
<a name="l2657"><span class="linenum">2657</span></a>      }
<a name="l2658"><span class="linenum">2658</span></a>  
<a name="l2659"><span class="linenum">2659</span></a>  <span class="comment">    // Now, if retrieve notifications, conversations or both.</span>
<a name="l2660"><span class="linenum">2660</span></a>      <a class="var it21371" onMouseOver="hilite(21371)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../_variables/typesql.html">$typesql</a> = &quot;&quot;;
<a name="l2661"><span class="linenum">2661</span></a>      if (<a class="var it1836" onMouseOver="hilite(1836)" onMouseOut="lolite()" onClick="logVariable('notifications')" href="../_variables/notifications.html">$notifications</a> !== -1) {
<a name="l2662"><span class="linenum">2662</span></a>          <a class="var it21371" onMouseOver="hilite(21371)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../_variables/typesql.html">$typesql</a> = &quot;AND mr.notification = :notification&quot;;
<a name="l2663"><span class="linenum">2663</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['notification'] = (<a class="var it1836" onMouseOver="hilite(1836)" onMouseOut="lolite()" onClick="logVariable('notifications')" href="../_variables/notifications.html">$notifications</a>) ? 1 : 0;
<a name="l2664"><span class="linenum">2664</span></a>      }
<a name="l2665"><span class="linenum">2665</span></a>  
<a name="l2666"><span class="linenum">2666</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT mr.*, <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>
<a name="l2667"><span class="linenum">2667</span></a>                FROM <a class="var it21369" onMouseOver="hilite(21369)" onMouseOut="lolite()" onClick="logVariable('messagetable')" href="../_variables/messagetable.html">$messagetable</a> mr
<a name="l2668"><span class="linenum">2668</span></a>                     <a class="var it21370" onMouseOver="hilite(21370)" onMouseOut="lolite()" onClick="logVariable('joinsql')" href="../_variables/joinsql.html">$joinsql</a>
<a name="l2669"><span class="linenum">2669</span></a>               WHERE <a class="var it2971" onMouseOver="hilite(2971)" onMouseOut="lolite()" onClick="logVariable('usersql')" href="../_variables/usersql.html">$usersql</a>
<a name="l2670"><span class="linenum">2670</span></a>                     <a class="var it21371" onMouseOver="hilite(21371)" onMouseOut="lolite()" onClick="logVariable('typesql')" href="../_variables/typesql.html">$typesql</a>
<a name="l2671"><span class="linenum">2671</span></a>               ORDER BY <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>&quot;;
<a name="l2672"><span class="linenum">2672</span></a>  
<a name="l2673"><span class="linenum">2673</span></a>      <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>);
<a name="l2674"><span class="linenum">2674</span></a>      return <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('messages')" href="../_variables/messages.html">$messages</a>;
<a name="l2675"><span class="linenum">2675</span></a>  }
<a name="l2676"><span class="linenum">2676</span></a>  
<a name="l2677"><span class="linenum">2677</span></a>  <span class="comment">/**</span>
<a name="l2678"><span class="linenum">2678</span></a>  <span class="comment"> * Requires the JS libraries to send a message using a dialog.</span>
<a name="l2679"><span class="linenum">2679</span></a>  <span class="comment"> *</span>
<a name="l2680"><span class="linenum">2680</span></a>  <span class="comment"> * @return void</span>
<a name="l2681"><span class="linenum">2681</span></a>  <span class="comment"> */</span>
<a name="l2682"><span class="linenum">2682</span></a>  function <a class="function" onClick="logFunction('message_messenger_requirejs')" href="../_functions/message_messenger_requirejs.html" onMouseOver="funcPopup(event,'message_messenger_requirejs')">message_messenger_requirejs</a>() {
<a name="l2683"><span class="linenum">2683</span></a>      global <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>;
<a name="l2684"><span class="linenum">2684</span></a>  
<a name="l2685"><span class="linenum">2685</span></a>      static <a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../_variables/done.html">$done</a> = false;
<a name="l2686"><span class="linenum">2686</span></a>      if (<a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../_variables/done.html">$done</a>) {
<a name="l2687"><span class="linenum">2687</span></a>          return;
<a name="l2688"><span class="linenum">2688</span></a>      }
<a name="l2689"><span class="linenum">2689</span></a>  
<a name="l2690"><span class="linenum">2690</span></a>      <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('requires')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/requires.html">requires</a>-&gt;<a class="function" onClick="logFunction('yui_module')" href="../_functions/yui_module.html" onMouseOver="funcPopup(event,'yui_module')">yui_module</a>(
<a name="l2691"><span class="linenum">2691</span></a>          array('moodle-core_message-messenger'),
<a name="l2692"><span class="linenum">2692</span></a>          'Y.M.core_message.messenger.init',
<a name="l2693"><span class="linenum">2693</span></a>          array(array())
<a name="l2694"><span class="linenum">2694</span></a>      );
<a name="l2695"><span class="linenum">2695</span></a>      <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('requires')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/requires.html">requires</a>-&gt;<a class="function" onClick="logFunction('strings_for_js')" href="../_functions/strings_for_js.html" onMouseOver="funcPopup(event,'strings_for_js')">strings_for_js</a>(array(
<a name="l2696"><span class="linenum">2696</span></a>          'errorwhilesendingmessage',
<a name="l2697"><span class="linenum">2697</span></a>          'messagesent',
<a name="l2698"><span class="linenum">2698</span></a>          'messagetosend',
<a name="l2699"><span class="linenum">2699</span></a>          'sendingmessage',
<a name="l2700"><span class="linenum">2700</span></a>          'sendmessage',
<a name="l2701"><span class="linenum">2701</span></a>          'viewconversation',
<a name="l2702"><span class="linenum">2702</span></a>      ), 'core_message');
<a name="l2703"><span class="linenum">2703</span></a>      <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('requires')" class="var it39443" onMouseOver="hilite(39443)" onMouseOut="lolite()" href="../_variables/requires.html">requires</a>-&gt;<a class="function" onClick="logFunction('string_for_js')" href="../_functions/string_for_js.html" onMouseOver="funcPopup(event,'string_for_js')">string_for_js</a>('error', 'core');
<a name="l2704"><span class="linenum">2704</span></a>  
<a name="l2705"><span class="linenum">2705</span></a>      <a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../_variables/done.html">$done</a> = true;
<a name="l2706"><span class="linenum">2706</span></a>  }
<a name="l2707"><span class="linenum">2707</span></a>  
<a name="l2708"><span class="linenum">2708</span></a>  <span class="comment">/**</span>
<a name="l2709"><span class="linenum">2709</span></a>  <span class="comment"> * Returns the attributes to place on a link to open the 'Send message' dialog.</span>
<a name="l2710"><span class="linenum">2710</span></a>  <span class="comment"> *</span>
<a name="l2711"><span class="linenum">2711</span></a>  <span class="comment"> * @param object $user User object.</span>
<a name="l2712"><span class="linenum">2712</span></a>  <span class="comment"> * @return void</span>
<a name="l2713"><span class="linenum">2713</span></a>  <span class="comment"> */</span>
<a name="l2714"><span class="linenum">2714</span></a>  function <a class="function" onClick="logFunction('message_messenger_sendmessage_link_params')" href="../_functions/message_messenger_sendmessage_link_params.html" onMouseOver="funcPopup(event,'message_messenger_sendmessage_link_params')">message_messenger_sendmessage_link_params</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l2715"><span class="linenum">2715</span></a>      return array(
<a name="l2716"><span class="linenum">2716</span></a>          'data-trigger' =&gt; 'core_message-messenger::sendmessage',
<a name="l2717"><span class="linenum">2717</span></a>          'data-fullname' =&gt; <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>),
<a name="l2718"><span class="linenum">2718</span></a>          'data-userid' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l2719"><span class="linenum">2719</span></a>          'role' =&gt; 'button'
<a name="l2720"><span class="linenum">2720</span></a>      );
<a name="l2721"><span class="linenum">2721</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'message_count_messages': ['message_count_messages', 'Count the number of messages with a field having a specified value. if $field is empty then return count of the whole array if $field is non-existent then return 0 ', [['message','lib.php',589]], 3],
'message_format_message_text': ['message_format_message_text', 'Try to guess how to convert the message to html. ', [['message','lib.php',962]], 3],
'render': ['render', 'Render TeX string into gif/png ', [['filter/tex','latex.php',78],['lib/adodb','adodb-pager.inc.php',239],['lib/htmlpurifier/HTMLPurifier/Printer','CSSDefinition.php',14],['lib/mustache/src/Mustache','Engine.php',202],['lib/phpexcel/PHPExcel/Chart/Renderer','jpgraph.php',768],['lib/htmlpurifier/HTMLPurifier/Printer','HTMLDefinition.php',15],['lib','formslib.php',926],['question/engine/tests','helpers.php',797],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/fullscreen','fullscreen.htm',82],['lib','outputrenderers.php',167],['lib','outputrenderers.php',299],['mod/quiz/classes/question/bank','custom_view.php',133],['question/behaviour','behaviourbase.php',97],['lib/mustache/src/Mustache','Template.php',57],['question/engine','questionattempt.php',815],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',85],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',235],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',298],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',391],['lib','portfoliolib.php',241],['lib/phpexcel/PHPExcel','Chart.php',527],['lib/mustache/src/Mustache','LambdaHelper.php',36]], 757],
'message_get_contact': ['message_get_contact', 'Load a user\'s contact record ', [['message','lib.php',1138]], 5],
'get_renderer': ['get_renderer', 'Get the renderer for a part of Moodle for this theme. ', [['lib','outputlib.php',1790],['mod/assign','locallib.php',2734],['lib','outputfactories.php',70],['lib','outputfactories.php',292],['lib','outputfactories.php',377],['course/format','lib.php',889],['question/type/multichoice','question.php',137],['question/type/multichoice','question.php',259],['question/type','questionbase.php',275],['grade/grading/form/guide','lib.php',482],['question/behaviour','behaviourbase.php',135],['lib','pagelib.php',797],['grade/grading/form/rubric','lib.php',486],['lib/tests/fixtures','test_renderer_factory.php',49]], 339],
'get_config': ['get_config', 'Get a configuration value for this plugin ', [['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546],['question/engine','bank.php',109],['lib','moodlelib.php',1404],['lib','enrollib.php',1141],['lib/editor/tinymce/classes','plugin.php',73],['admin/tool/log/classes/helper','store.php',63]], 847],
'data_submitted': ['data_submitted', 'Determine if there is data waiting to be processed from a form ', [['lib','weblib.php',904]], 83],
'message_print_user': ['message_print_user', 'Print information on a user. Used when printing search results. ', [['message','lib.php',1425]], 2],
'where': ['where', 'Add where clause ', [['lib/zend/Zend/Service/WindowsAzure/Storage','TableEntityQuery.php',120],['question/classes/bank/search','category_condition.php',96],['question/classes/bank/search','hidden_condition.php',53],['question/engine','datalib.php',1882],['question/engine','datalib.php',1964]], 61],
'get_message_processor': ['get_message_processor', 'Get an instance of the message_output class for one of the output plugins. ', [['message','lib.php',2526]], 1],
'message_search': ['message_search', 'Search a user\'s messages ', [['message','lib.php',1700]], 8],
'message_format_contexturl': ['message_format_contexturl', 'Format a the context url and context url name of a message for display ', [['message','lib.php',2147]], 2],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1318]], 854],
'message_search_users': ['message_search_users', 'Search through course users. ', [['message','lib.php',1607]], 7],
'message_get_contacts': ['message_get_contacts', 'Retrieve $user1\'s contacts (online, offline and strangers) ', [['message','lib.php',300]], 6],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',438],['lib/classes/event','base.php',682]], 778],
'message_print_contacts': ['message_print_contacts', 'Print $user1\'s contacts. Called by message_print_contact_selector() ', [['message','lib.php',398]], 2],
'notification': ['notification', 'Output a notification (that is, a status message about something that has just happened). ', [['lib','outputrenderers.php',2762],['lib','outputrenderers.php',4128],['lib','outputrenderers.php',4201]], 495],
'box_start': ['box_start', 'Outputs the opening section of a box. ', [['lib','outputrenderers.php',2987]], 351],
'enrol_get_users_courses': ['enrol_get_users_courses', 'Returns list of courses user is enrolled into. (Note: use enrol_get_all_users_courses if you want to use the list wihtout any cap checks ) ', [['lib','enrollib.php',679]], 18],
'message_count_blocked_users': ['message_count_blocked_users', 'Count the number of users blocked by $user1 ', [['message','lib.php',632]], 8],
'on': ['on', '', [['lib/requirejs','require.js',506]], 3494],
'get_param': ['get_param', 'Returns a given parameter value from the URL. ', [['lib','weblib.php',856]], 9],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',2854]], 853],
'message_print_usergroup_selector': ['message_print_usergroup_selector', 'Print a select box allowing the user to choose to view new messages, course participants etc. ', [['message','lib.php',502]], 1],
'box_end': ['box_end', 'Outputs the closing section of a box. ', [['lib','outputrenderers.php',3002]], 351],
'strlen': ['strlen', 'Multibyte safe strlen() function, uses mbstring or iconv for UTF-8, falls back to typo3. ', [['lib/classes','text.php',281],['lib/typo3','class.t3lib_cs.php',1520]], 1698],
'get_user': ['get_user', 'Return user object from db or create noreply or support user, if userid matches corse_user::NOREPLY_USER or corse_user::SUPPORT_USER respectively. If userid is not found, then return false. ', [['lib/classes','user.php',52]], 27],
'empty_tag': ['empty_tag', 'Outputs an empty tag with attributes ', [['lib','outputcomponents.php',1096]], 511],
'message_remove_url_params': ['message_remove_url_params', 'strip off action parameters like \'removecontact\' ', [['message','lib.php',577]], 1],
'get_message_processors': ['get_message_processors', 'Get all message processors, validate corresponding plugin existance and system configuration ', [['message','lib.php',2438]], 14],
'fullname': ['fullname', 'Returns a persons full name ', [['lib','moodlelib.php',3234],['mod/assign','locallib.php',3440]], 532],
'param': ['param', 'Returns a placeholder for query parameters e.g. $DB->Param(\'a\') will return - \'?\' for most databases - \':a\' for Oracle - \'$1\', \'$2\', etc. for PostgreSQL ', [['lib/adodb','adodb.inc.php',815],['lib/adodb/drivers','adodb-postgres64.inc.php',591],['lib','weblib.php',455],['lib/adodb/drivers','adodb-oci8po.inc.php',37],['lib/adodb/drivers','adodb-db2oci.inc.php',166],['lib/adodb/drivers','adodb-oci8.inc.php',1014]], 641],
'get_plugin_info': ['get_plugin_info', 'Returns information about the known plugin, or null ', [['lib/classes','plugin_manager.php',620]], 30],
'strings_for_js': ['strings_for_js', 'Make an array of language strings available for JS. ', [['lib','outputrequirementslib.php',1167],['enrol','locallib.php',1295]], 69],
'message_mark_message_read': ['message_mark_message_read', 'Mark a single message as read ', [['message','lib.php',2392]], 8],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required. ', [['lib/dml','pgsql_native_moodle_database.php',883],['lib/dml','oci_native_moodle_database.php',1249],['lib/dml','sqlsrv_native_moodle_database.php',978],['lib/dml','mssql_native_moodle_database.php',898],['lib/dml','mysqli_native_moodle_database.php',1177],['lib/dml/tests','dml_test.php',5427],['lib/dml','pdo_moodle_database.php',386],['question/engine/upgrade','upgradelib.php',121]], 1512],
'message_get_recent_conversations': ['message_get_recent_conversations', 'Get the users recent conversations meaning all the people they\'ve recently sent or received a message from plus the most recent message sent to or received from each other user ', [['message','lib.php',711]], 2],
'sql_like': ['sql_like', 'Returns \'LIKE\' part of a query. ', [['lib/dml','pgsql_native_moodle_database.php',1273],['lib/dml','oci_native_moodle_database.php',1523],['lib/dml','sqlsrv_native_moodle_database.php',1224],['lib/dml','moodle_database.php',2004],['lib/dml','mssql_native_moodle_database.php',1160],['lib/dml','mysqli_native_moodle_database.php',1502]], 158],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',884],['lib','accesslib.php',346]], 1929],
'highlight': ['highlight', '', [['lib/yuilib/3.17.2/datatable-highlight','datatable-highlight-debug.js',25],['lib/yuilib/3.17.2/datatable-highlight','datatable-highlight.js',25],['lib','weblib.php',1864]], 65],
'message_print_search': ['message_print_search', 'Print the search form and search results if a search has been performed ', [['message','lib.php',653]], 1],
'message_block_contact': ['message_block_contact', 'Block a user. ', [['message','lib.php',1128]], 7],
'get_string': ['get_string', 'Return a core get_string() call ', [['lib/external','externallib.php',112],['lib','moodlelib.php',6538],['lib','moodlelib.php',9417],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38],['lib/classes','string_manager_install.php',95],['question/behaviour','behaviourbase.php',756]], 19235],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as a moodle_recordset using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','oci_native_moodle_database.php',1065],['lib/dml','sqlsrv_native_moodle_database.php',761],['lib/dml','mssql_native_moodle_database.php',687],['lib/dml','mysqli_native_moodle_database.php',985],['lib/dml/tests','dml_test.php',5423],['lib/dml','pdo_moodle_database.php',251]], 279],
'get_string_manager': ['get_string_manager', 'Returns current string_manager instance. ', [['lib','moodlelib.php',6481]], 147],
'message_print_recent_notifications': ['message_print_recent_notifications', 'Print the user\'s recent notifications ', [['message','lib.php',860]], 1],
'get_records_select': ['get_records_select', 'Get a number of records as an array of objects which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1283]], 163],
'clean_text': ['clean_text', 'Cleans raw text removing nasties. ', [['lib','weblib.php',1568]], 43],
'is_system_configured': ['is_system_configured', 'Tests whether the airnotifier settings have been configured ', [['message/output/airnotifier/classes','manager.php',175],['message/output/airnotifier','externallib.php',53],['message/output/airnotifier','message_output_airnotifier.php',198],['message/output','lib.php',64],['message/output/jabber','message_output_jabber.php',135]], 8],
'get_records': ['get_records', 'Get a number of records as an array of objects where all the given conditions met. ', [['lib/dml','moodle_database.php',1236],['lib','coursecatlib.php',654],['question','category_class.php',63]], 860],
'userdate': ['userdate', 'Also in ADORecordSet. ', [['lib/adodb','adodb.inc.php',2607],['lib/adodb','adodb.inc.php',3271],['lib','moodlelib.php',2150]], 496],
'message_get_history': ['message_get_history', 'Retrieve the messages between two users ', [['message','lib.php',1950]], 1],
'sql_regex': ['sql_regex', '', [['lib/dml','pgsql_native_moodle_database.php',1341],['lib/dml','moodle_database.php',2221],['lib/dml','mysqli_native_moodle_database.php',1581]], 12],
'message_move_userfrom_unread2read': ['message_move_userfrom_unread2read', 'Moves messages from a particular user from the message table (unread messages) to message_read This is typically only used when a user is deleted ', [['message','lib.php',2353]], 1],
'yui_module': ['yui_module', 'Creates a JavaScript function call that requires one or more modules to be loaded. ', [['lib','outputrequirementslib.php',1016]], 76],
'user_picture': ['user_picture', '', [['mod/quiz','attemptlib.php',2188],['lib','outputrenderers.php',2367],['lib','outputrenderers.php',4702]], 114],
'remove_params': ['remove_params', 'Remove all params if no arguments passed. Remove selected params if arguments are passed. ', [['lib','weblib.php',423]], 32],
'join': ['join', 'Join a room. For internal use by the Games SDK only. Calling this method directly is unsupported. (rooms.join) ', [['lib/google/src/Google/Service','Games.php',1715],['lib/google/src/Google/Service','Games.php',2099]], 949],
'string_for_js': ['string_for_js', 'Make a language string available to JavaScript. ', [['lib','outputrequirementslib.php',1104]], 56],
'get_support_user': ['get_support_user', 'Return support user record, this is currently used in messaging system only for sending messages to support email. $CFG->supportuserid is set then returns user record $CFG->supportemail is set then return dummy record with $CFG->supportemail else return admin user record with hard-coded $user->emailstop = 0, so user gets support message. ', [['lib/classes','user.php',162]], 21],
'sql_concat': ['sql_concat', '', [['lib/dml','pgsql_native_moodle_database.php',1315],['lib/dml','oci_native_moodle_database.php',1550],['lib/dml','sqlsrv_native_moodle_database.php',1257],['lib/dml','sqlite3_pdo_moodle_database.php',353],['lib/dml','mssql_native_moodle_database.php',1194],['lib/dml','mysqli_native_moodle_database.php',1531],['lib/dml/tests','dml_test.php',5433],['lib/dml','pdo_moodle_database.php',536]], 73],
'start_tag': ['start_tag', '', [['backup/util/xml/parser','progressive_parser.class.php',215],['lib','outputcomponents.php',1075]], 694],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'record_exists': ['record_exists', 'Test whether a record exists in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1768]], 735],
'asort_objects_by_property': ['asort_objects_by_property', 'Locale aware sort of objects by a property in common to all objects ', [['lib/classes','collator.php',249]], 17],
'get_parent_context_ids': ['get_parent_context_ids', 'Returns parent contexts of this context in reversed order, i.e. parent first, then grand parent, etc. ', [['lib','accesslib.php',5674]], 58],
'message_messenger_sendmessage_link_params': ['message_messenger_sendmessage_link_params', 'Returns the attributes to place on a link to open the \'Send message\' dialog. ', [['message','lib.php',2708]], 2],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 552],
'is_enabled': ['is_enabled', 'Allows hiding this plugin from the submission/feedback screen if it is not enabled. ', [['mod/assign','assignmentplugin.php',223],['lib/classes/plugininfo','orphaned.php',37],['lib','completionlib.php',269],['mod/assign/submission/comments','locallib.php',172],['mod/assign/feedback/editpdf','locallib.php',276],['lib/classes/plugininfo','base.php',371],['lib/classes/plugininfo','tool.php',39],['admin/tool/health','index.php',393],['admin/tool/log/classes/plugininfo','logstore.php',35],['lib/classes/message/inbound','manager.php',37],['lib/classes/plugininfo','mnetservice.php',33],['mod/assignment/classes/plugininfo','assignment.php',32],['lib','adminlib.php',1952],['mod/assign/feedback/offline','locallib.php',365],['lib','medialib.php',318],['lib','medialib.php',634],['lib','medialib.php',1265]], 200],
'get_default_messaging_settings': ['get_default_messaging_settings', 'Returns the message processors default settings Should the processor be enabled for logged in users by default? Should the processor be enabled for logged off users by default? Is enabling it disallowed, permitted or forced? ', [['message/output','lib.php',83],['message/output/email','message_output_email.php',171]], 1],
'get_noreply_user': ['get_noreply_user', 'Return noreply user record, this is currently used in messaging system only for sending messages from noreply email. It will return record of $CFG->noreplyuserid if set else return dummy user object with hard-coded $user->emailstop = 1 so noreply can be sent to user. ', [['lib/classes','user.php',134]], 17],
'sql_fullname': ['sql_fullname', 'Returns the proper SQL (for the dbms in use) to concatenate $firstname and $lastname ', [['lib/dml','moodle_database.php',2057]], 21],
'message_format_message': ['message_format_message', 'Format a message for display in the message history ', [['message','lib.php',2106]], 2],
'nonempty_tag': ['nonempty_tag', 'Outputs a tag, but only if the contents are not empty ', [['lib','outputcomponents.php',1107]], 38],
'confirm_sesskey': ['confirm_sesskey', 'Check the sesskey and return true of false for whether it is valid. (You might like to imagine this function is called sesskey_is_valid().) ', [['lib','sessionlib.php',52]], 315],
'message_get_messages': ['message_get_messages', 'Get messages sent or/and received by the specified users. ', [['message','lib.php',2621]], 5],
'message_contact_link': ['message_contact_link', 'Print a message contact link ', [['message','lib.php',1468]], 21],
'sesskey': ['sesskey', 'Makes sure that $USER->sesskey exists, if $USER itself exists. It sets a new sesskey if one does not already exist, but does not overwrite existing sesskeys. Returns the sesskey string if $USER exists, or boolean false if not. ', [['lib','sessionlib.php',28]], 631],
'count_records_sql': ['count_records_sql', 'Get the result of a SQL SELECT COUNT(...) query. ', [['lib/dml','moodle_database.php',1747]], 132],
'tag': ['tag', 'Outputs a tag with attributes and contents ', [['lib','outputcomponents.php',1063],['lib/zend/Zend/Service','Technorati.php',228]], 1254],
'message_get_recent_notifications': ['message_get_recent_notifications', 'Get the users recent event notifications ', [['message','lib.php',808]], 2],
'message_shorten_message': ['message_shorten_message', 'Given a message object that we already know has a long message this function truncates the message nicely to the first sane place between $CFG->forum_longpost and $CFG->forum_shortpost ', [['message','lib.php',1844]], 1],
'message_print_blocked_users': ['message_print_blocked_users', 'Print users blocked by $user1. Called by message_print_contact_selector() ', [['message','lib.php',262]], 1],
'message_page_type_list': ['message_page_type_list', 'Return a list of page types ', [['message','lib.php',2611]], 0],
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',757]], 262],
'end_tag': ['end_tag', '', [['backup/util/xml/parser','progressive_parser.class.php',261],['lib','outputcomponents.php',1086],['backup/util/xml','xml_writer.class.php',177]], 858],
'pix_url': ['pix_url', 'Return the URL for an image ', [['lib','outputlib.php',1356],['lib','outputrenderers.php',234]], 406],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 1891],
'out': ['out', 'Returns the string ', [['lib','moodlelib.php',9451],['lib','weblib.php',547],['lib','tablelib.php',1526],['lib','csslib.php',1540],['lib','csslib.php',1698],['lib','csslib.php',2078],['lib','csslib.php',2162],['lib','csslib.php',2306],['lib','csslib.php',2495],['lib','csslib.php',3240],['report/loglive/classes','table_log_ajax.php',37]], 549],
'message_print_message_history': ['message_print_message_history', 'Print the message history between two users ', [['message','lib.php',2007]], 1],
'message_get_contact_add_remove_link': ['message_get_contact_add_remove_link', 'Constructs the add/remove contact link to display next to other users ', [['message','lib.php',2301]], 2],
'create': ['create', 'Creates a new 2048 bit RSA key pair and returns a unique ID that can be used to reference this key pair when launching new instances. ', [['lib/zend/Zend/Service/Amazon/Ec2','Keypair.php',39],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',271],['repository/filesystem','lib.php',283],['lib/zend/Zend/Service/Amazon/Ec2','Securitygroups.php',39],['lib/google/src/Google/Service','Gmail.php',670],['lib/google/src/Google/Service','Gmail.php',827],['course','lib.php',2874],['lib/classes/event','base.php',139],['lib/google/src/Google/Service','Genomics.php',618],['lib/google/src/Google/Service','Genomics.php',717],['lib/google/src/Google/Service','Genomics.php',850],['lib/google/src/Google/Service','Genomics.php',1313],['lib','modinfolib.php',1747],['calendar','lib.php',2651],['lib/zend/Zend/Service/Amazon','Sqs.php',82],['lib','weblib.php',3048],['mod/lesson','locallib.php',1013],['mod/lesson','locallib.php',2166],['mod/lesson','locallib.php',3203],['lib/google/src/Google/Service','Fitness.php',340],['lib/google/src/Google/Service','TagManager.php',1034],['lib/google/src/Google/Service','TagManager.php',1124],['lib/google/src/Google/Service','TagManager.php',1217],['lib/google/src/Google/Service','TagManager.php',1310],['lib/google/src/Google/Service','TagManager.php',1403],['lib/google/src/Google/Service','TagManager.php',1497],['lib/google/src/Google/Service','TagManager.php',1591],['lib/google/src/Google/Service','TagManager.php',1742],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Container.php',314],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['repository','lib.php',206],['repository','lib.php',1960],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',555],['lib/google/src/Google/Service','Games.php',1648],['lib/google/src/Google/Service','Games.php',2012],['lib/google/src/Google/Service','MapsEngine.php',1676],['lib/google/src/Google/Service','MapsEngine.php',1976],['lib/google/src/Google/Service','MapsEngine.php',2252],['lib/google/src/Google/Service','MapsEngine.php',2329],['lib/google/src/Google/Service','MapsEngine.php',2897],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Pubsub.php',219],['lib/google/src/Google/Service','Pubsub.php',364],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/simplepie/library/SimplePie','Registry.php',153],['lib','navigationlib.php',266],['lib/google/src/Google/Service','Dns.php',282],['lib/google/src/Google/Service','Dns.php',355],['lib','coursecatlib.php',328],['mod/quiz/classes','structure.php',65]], 3074],
'count_records_select': ['count_records_select', 'Count the records in a table which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1730]], 52],
'message_print_recent_messages_table': ['message_print_recent_messages_table', 'Print a list of recent messages ', [['message','lib.php',883]], 2],
'optional_param': ['optional_param', 'Returns a particular value for the named variable, taken from POST or GET, otherwise returning a given default. ', [['lib','moodlelib.php',605]], 2167],
'message_history_link': ['message_history_link', 'echo or return a link to take the user to the full message history between themselves and another user ', [['message','lib.php',1543]], 4],
'usergetdate': ['usergetdate', 'Given a $time timestamp in GMT (seconds since epoch), returns an array that represents the date in user time ', [['lib','moodlelib.php',2208]], 15],
'message_print_contact_selector': ['message_print_contact_selector', 'Print the selector that allows the user to view their contacts, course participants, their recent conversations etc ', [['message','lib.php',74]], 1],
'message_print_search_results': ['message_print_search_results', 'Print the results of a message search ', [['message','lib.php',1149]], 1],
'message_print_participants': ['message_print_participants', 'Print course participants. Called by message_print_contact_selector() ', [['message','lib.php',148]], 1],
'message_add_contact': ['message_add_contact', 'Add the selected user as a contact for the current user ', [['message','lib.php',1013]], 24],
'message_get_contact_block_link': ['message_get_contact_block_link', 'Constructs the block contact link to display next to other users ', [['message','lib.php',2326]], 2],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','oci_native_moodle_database.php',1102],['lib/dml','sqlsrv_native_moodle_database.php',823],['lib/dml','mssql_native_moodle_database.php',741],['lib/dml','mysqli_native_moodle_database.php',1049],['lib/dml/tests','dml_test.php',5424],['lib/dml','pdo_moodle_database.php',308]], 678],
'box': ['box', 'Outputs a box. ', [['lib','outputrenderers.php',2974]], 295],
'message_post_message': ['message_post_message', 'Send a message from one user to another. Will be delivered according to the message recipients messaging preferences ', [['message','lib.php',2171]], 19],
'action_link': ['action_link', 'Method to create a link with popup action. ', [['report/log/classes','table_log.php',344],['report/loglive/classes','table_log.php',285],['lib','outputrenderers.php',1586]], 71],
'html_to_text': ['html_to_text', 'Given HTML text, make it into plain text using external function ', [['lib','weblib.php',1841],['question/type','questionbase.php',367]], 52],
'message_unblock_contact': ['message_unblock_contact', 'Unblock a contact. Note that this reverts the previously blocked user back to a non-contact. ', [['message','lib.php',1118]], 4],
'message_print_contactlist_user': ['message_print_contactlist_user', 'Print a row of contactlist displaying user picture, messages waiting and block links etc ', [['message','lib.php',2222]], 5],
'fields': ['fields', 'Get the value of a field in the current row by column name. Will not work if ADODB_FETCH_MODE is set to ADODB_FETCH_NUM. ', [['lib/adodb','adodb.inc.php',3469],['lib/adodb','adodb.inc.php',4073],['lib/adodb/drivers','adodb-odbtp.inc.php',718],['lib/adodb/drivers','adodb-sqlite.inc.php',369],['lib/adodb/drivers','adodb-pdo.inc.php',611],['lib/adodb/drivers','adodb-mysqli.inc.php',963],['lib/adodb/drivers','adodb-mssql.inc.php',904],['mod/quiz/classes','admin_review_setting.php',65],['lib/adodb/drivers','adodb-postgres64.inc.php',951],['lib/adodb/drivers','adodb-oracle.inc.php',265],['lib/adodb/drivers','adodb-ado.inc.php',373],['lib','outputcomponents.php',235],['lib/adodb/drivers','adodb-ado5.inc.php',410],['lib/adodb/drivers','adodb-db2.inc.php',754],['lib/adodb/drivers','adodb-sqlite3.inc.php',399],['lib/adodb/drivers','adodb-mssqlnative.inc.php',888],['lib/adodb/drivers','adodb-ibase.inc.php',833],['lib/adodb/drivers','adodb-oci8po.inc.php',91],['lib/adodb/drivers','adodb-ads.inc.php',690],['lib/adodb/drivers','adodb-odbc.inc.php',642],['lib/adodb/drivers','adodb-mysql.inc.php',764],['lib/adodb/drivers','adodb-oci8.inc.php',1549]], 145],
'heading': ['heading', 'Get the heading for this page. ', [['grade/report/singleview/classes/local/screen','grade.php',283],['grade/report/singleview/classes/local/screen','user.php',281],['lib','outputrenderers.php',2957],['lib','outputrenderers.php',4080],['lib','outputrenderers.php',4254],['grade/report/singleview/classes/local/screen','screen.php',197]], 763],
's': ['s', 'Count of attempts selected by $this->whichattempts ', [['mod/quiz/report/statistics/classes','calculated.php',91],['lib','weblib.php',84]], 988],
'set_label': ['set_label', 'Sets select\'s label ', [['lib','outputcomponents.php',829],['lib','outputcomponents.php',951],['backup/util/ui','backup_ui_setting.class.php',143],['backup/cc/cc_lib','cc_asssesment.php',378],['backup/cc/cc_lib','cc_asssesment.php',492],['backup/cc/cc_lib','cc_asssesment.php',1725]], 46],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pgsql_native_moodle_database.php',1137],['lib/dml','oci_native_moodle_database.php',1355],['lib/dml','sqlsrv_native_moodle_database.php',1081],['lib/dml','mssql_native_moodle_database.php',1003],['lib/dml','mysqli_native_moodle_database.php',1397],['lib/dml/tests','dml_test.php',5430],['lib/dml','pdo_moodle_database.php',460]], 565],
'message_remove_contact': ['message_remove_contact', 'remove a contact ', [['message','lib.php',1090]], 4],
'close': ['close', 'Close the connection to the server ', [['lib/zend/Zend/Http/Client/Adapter','Socket.php',486],['lib/tests','completionlib_test.php',888],['lib/adodb','adodb.inc.php',2164],['lib/adodb','adodb.inc.php',2844],['lib/adodb','adodb.inc.php',3536],['lib','webdavlib.php',176],['admin/tool/uploaduser','locallib.php',149],['lib/dml','oci_native_moodle_recordset.php',80],['lib/tcpdf','tcpdf.php',2943],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['lib','excellib.class.php',93],['lib/zend/Zend/Http/Client/Adapter','Test.php',187],['lib/classes/dml','recordset_walk.php',153],['mod/assign/feedback/offline','importgradeslib.php',178],['lib/pear/Net','GeoIP.php',556],['backup/util/helper','backup_array_iterator.class.php',63],['lib/zend/Zend/Gdata/App','LoggingHttpClientAdapterSocket.php',109],['lib/zend/Zend/Http/Client/Adapter','Proxy.php',266],['lib/dml','mssql_native_moodle_recordset.php',87],['lib/pear/Auth','RADIUS.php',542],['lib/pear/Auth','RADIUS.php',703],['lib/pear/Auth','RADIUS.php',824],['lib/phpmailer','class.smtp.php',507],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',80],['lib/phpunit/classes','event_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Interface.php',73],['lib/dml','pgsql_native_moodle_recordset.php',104],['auth/fc','fcFPP.php',72],['lib/filestorage','zip_archive.php',183],['lib','odslib.class.php',71],['lib/horde/framework/Horde/Socket','Client.php',135],['question/engine/tests','helpers.php',1225],['grade','lib.php',323],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib','csvlib.class.php',256],['lib/google/src/Google/Logger','File.php',130],['lib/horde/framework/Horde','Stream.php',585],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpunit/classes','message_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Curl.php',460],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',109],['backup/util/helper','backup_null_iterator.class.php',53],['grade/export','lib.php',662],['lib/dml','pdo_moodle_recordset.php',79]], 1036],
'count_enrolled_users': ['count_enrolled_users', 'Counts list of users enrolled into course (as per above function) ', [['lib','accesslib.php',2475]], 1],
'get_status': ['get_status', 'Returns instance status ', [['grade/grading/form','lib.php',863],['completion/criteria','completion_criteria_grade.php',157],['backup/util/settings','base_setting.class.php',157],['completion/criteria','completion_criteria.php',235],['lib/classes/plugininfo','base.php',334],['completion','completion_criteria_completion.php',158],['completion/criteria','completion_criteria_date.php',134],['backup/controller','restore_controller.class.php',295],['backup/controller','backup_controller.class.php',285],['lib/filestorage','stored_file.php',777],['lib/filebrowser','virtual_root_file.php',281],['mod/workshop/allocation','lib.php',128],['lib/filebrowser','file_info.php',348],['lib/filebrowser','file_info_stored.php',321],['completion/criteria','completion_criteria_duration.php',180]], 89],
'message_get_blocked_users': ['message_get_blocked_users', 'Retrieve users blocked by $user1 ', [['message','lib.php',219]], 4],
'message_send': ['message_send', 'Called when a message provider wants to send a message. This functions checks the message recipient\'s message processor configuration then sends the message to the configured processors ', [['lib','messagelib.php',29]], 99],
'message_messenger_requirejs': ['message_messenger_requirejs', 'Requires the JS libraries to send a message using a dialog. ', [['message','lib.php',2677]], 2],
'not': ['not', 'NOT ', [['lib/phpexcel/PHPExcel/Calculation','Logical.php',192]], 301],
'get_all_user_name_fields': ['get_all_user_name_fields', 'A centralised location for the all name fields. Returns an array / sql string snippet. ', [['lib','moodlelib.php',3345]], 94],
'get_message_output_default_preferences': ['get_message_output_default_preferences', 'Get messaging outputs default (site) preferences ', [['message','lib.php',2554]], 6],
'is_real_user': ['is_real_user', 'Return true is user id is greater than self::NOREPLY_USER and alternatively check db. ', [['lib/classes','user.php',220]], 16],
'message_mark_messages_read': ['message_mark_messages_read', 'marks ALL messages being sent from $fromuserid to $touserid as read ', [['message','lib.php',2372]], 1],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1583],['lib/dml','moodle_database.php',678]], 375],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',449]], 1560],
'message_get_fragment': ['message_get_fragment', 'Given a string and an array of keywords, this function looks for the first keyword in the string, and then chops out a small section from the text that shows that word in context. ', [['message','lib.php',1900]], 1],
'message_print_recent_conversations': ['message_print_recent_conversations', 'Print the user\'s recent conversations ', [['message','lib.php',831]], 1],
'message_get_course_contexts': ['message_get_course_contexts', 'Load the course contexts for all of the users courses ', [['message','lib.php',561]], 1],
'get_enrolled_sql': ['get_enrolled_sql', 'Returns array with sql code and parameters returning all ids of users enrolled into course. ', [['lib','accesslib.php',2246]], 48],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','moodle_database.php',1815],['lib/dml','sqlite3_pdo_moodle_database.php',337]], 778],
'enrol_get_my_courses': ['enrol_get_my_courses', 'Returns list of courses current $USER is enrolled in and can access ', [['lib','enrollib.php',512]], 16],
'translate_message_default_setting': ['translate_message_default_setting', 'Translate message default settings from binary value to the array of string representing the settings to be stored. Also validate the provided value and use default if it is malformed. ', [['message','lib.php',2563]], 1],
'get_message_providers': ['get_message_providers', 'Get all message providers, validate their plugin existance and system configuration ', [['message','lib.php',2496]], 2],
'message_count_unread_messages': ['message_count_unread_messages', 'Returns the count of unread messages for user. Either from a specific user or from all users. ', [['message','lib.php',609]], 8],
'sql_regex_supported': ['sql_regex_supported', '', [['lib/dml','pgsql_native_moodle_database.php',1337],['lib/dml','moodle_database.php',2213],['lib/dml','mysqli_native_moodle_database.php',1574]], 12],
'format_text': ['format_text', 'Given text in a variety of format codings, this function returns the text as safe HTML. ', [['lib','weblib.php',1115],['lib','tablelib.php',846],['lib','tablelib.php',1583],['lib','tablelib.php',1900],['question/type','questionbase.php',345],['lib/classes','grading_external.php',182]], 325],
'is_readable': ['is_readable', '', [], 207],
'explode': ['explode', '', [], 1599],
'is_array': ['is_array', '', [], 1820],
'count': ['count', '', [], 3984],
'class_exists': ['class_exists', '', [], 273],
'trim': ['trim', '', [], 1889],
'in_array': ['in_array', '', [], 1173],
'time': ['time', '', [], 1768],
'implode': ['implode', '', [], 1259],
'array_slice': ['array_slice', '', [], 169],
'preg_quote': ['preg_quote', '', [], 207],
'array_key_exists': ['array_key_exists', '', [], 1539],
'substr': ['substr', '', [], 2883],
'str_replace': ['str_replace', '', [], 1667],
'array_unique': ['array_unique', '', [], 173],
'urlencode': ['urlencode', '', [], 234],
'array_merge': ['array_merge', '', [], 2320],
'strip_tags': ['strip_tags', '', [], 149],
'is_string': ['is_string', '', [], 680],
'array_reverse': ['array_reverse', '', [], 127],
'intval': ['intval', '', [], 484],
'define': ['define', '', [], 2170],
'max': ['max', '', [], 1096],
'strpos': ['strpos', '', [], 1623]};
CLASS_DATA={
'message_viewed': ['message_viewed', 'Message viewed event class. ', [['lib/classes/event','message_viewed.php',29]], 1],
'core_user': ['core_user', 'User class to access user details. ', [['lib/classes','user.php',27]], 143],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6106]], 929],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',214]], 867],
'core_collator': ['core_collator', 'A collator class with static methods that can be used for sorting. ', [['lib/classes','collator.php',28]], 130],
'message_contact_unblocked': ['message_contact_unblocked', 'Message contact unblocked event class. ', [['lib/classes/event','message_contact_unblocked.php',29]], 1],
'paging_bar': ['paging_bar', 'Component representing a paging bar. ', [['lib','outputcomponents.php',2301]], 22],
'message_contact_added': ['message_contact_added', 'Message contact added event class. ', [['lib/classes/event','message_contact_added.php',29]], 1],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',240]], 2887],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6766]], 1197],
'user_picture': ['user_picture', 'Data structure representing a user picture. ', [['lib','outputcomponents.php',142]], 135],
'core_plugin_manager': ['core_plugin_manager', 'Singleton class providing general plugins management functionality. ', [['lib/classes','plugin_manager.php',31]], 187],
'message_contact_blocked': ['message_contact_blocked', 'Message contact blocked event class. ', [['lib/classes/event','message_contact_blocked.php',29]], 2],
'context_user': ['context_user', 'User context class ', [['lib','accesslib.php',6347]], 288],
'core_text': ['core_text', 'defines string api\'s for manipulating strings ', [['lib/classes','text.php',27]], 512],
'html_writer': ['html_writer', 'Simple html output class ', [['lib','outputcomponents.php',1052]], 4832],
'message_contact_removed': ['message_contact_removed', 'Message contact removed event class. ', [['lib/classes/event','message_contact_removed.php',29]], 1],
'popup_action': ['popup_action', 'Component action for a popup window. ', [['lib','outputactions.php',114]], 32],
'single_select': ['single_select', 'Simple form with just one select field that gets submitted automatically. ', [['lib','outputcomponents.php',687]], 49]};
CONST_DATA={
'MESSAGE_VIEW_RECENT_CONVERSATIONS': ['MESSAGE_VIEW_RECENT_CONVERSATIONS', '', [['message','lib.php',38]], 4],
'MESSAGE_VIEW_CONTACTS': ['MESSAGE_VIEW_CONTACTS', '', [['message','lib.php',40]], 7],
'MESSAGE_VIEW_BLOCKED': ['MESSAGE_VIEW_BLOCKED', '', [['message','lib.php',41]], 4],
'MESSAGE_SEARCH_MAX_RESULTS': ['MESSAGE_SEARCH_MAX_RESULTS', '', [['message','lib.php',45]], 6],
'MESSAGE_FORCED': ['MESSAGE_FORCED', '', [['message','lib.php',65]], 1],
'MESSAGE_VIEW_COURSE': ['MESSAGE_VIEW_COURSE', '', [['message','lib.php',42]], 7],
'MESSAGE_VIEW_UNREAD_MESSAGES': ['MESSAGE_VIEW_UNREAD_MESSAGES', '', [['message','lib.php',37]], 8],
'FORMAT_MOODLE': ['FORMAT_MOODLE', '', [['lib','weblib.php',42]], 378],
'IGNORE_MISSING': ['IGNORE_MISSING', '', [['lib','dmllib.php',48]], 204],
'MESSAGE_DEFAULT_PERMITTED': ['MESSAGE_DEFAULT_PERMITTED', '', [['message','lib.php',72]], 3],
'SITEID': ['SITEID', '', [['admin/cli','install.php',217],['','install.php',244],['lib/db','install.php',87],['lib','setup.php',748]], 612],
'MESSAGE_HISTORY_ALL': ['MESSAGE_HISTORY_ALL', '', [['message','lib.php',35]], 4],
'MESSAGE_VIEW_SEARCH': ['MESSAGE_VIEW_SEARCH', '', [['message','lib.php',43]], 8],
'MESSAGE_DEFAULT_LOGGEDIN': ['MESSAGE_DEFAULT_LOGGEDIN', '', [['message','lib.php',60]], 6],
'FORMAT_HTML': ['FORMAT_HTML', '', [['lib','weblib.php',47]], 999],
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 271],
'MESSAGE_DISCUSSION_WIDTH': ['MESSAGE_DISCUSSION_WIDTH', '', [['message','lib.php',29]], 2],
'MESSAGE_DEFAULT_LOGGEDOFF': ['MESSAGE_DEFAULT_LOGGEDOFF', '', [['message','lib.php',61]], 9],
'MESSAGE_PERMITTED_MASK': ['MESSAGE_PERMITTED_MASK', '', [['message','lib.php',67]], 4],
'MESSAGE_HISTORY_SHORT': ['MESSAGE_HISTORY_SHORT', '', [['message','lib.php',34]], 3],
'MESSAGE_SHORTVIEW_LIMIT': ['MESSAGE_SHORTVIEW_LIMIT', '', [['message','lib.php',32]], 3],
'MESSAGE_PERMITTED': ['MESSAGE_PERMITTED', '', [['message','lib.php',64]], 10],
'MESSAGE_MAX_COURSE_NAME_LENGTH': ['MESSAGE_MAX_COURSE_NAME_LENGTH', '', [['message','lib.php',48]], 3],
'MESSAGE_DISALLOWED': ['MESSAGE_DISALLOWED', '', [['message','lib.php',63]], 2],
'MESSAGE_VIEW_RECENT_NOTIFICATIONS': ['MESSAGE_VIEW_RECENT_NOTIFICATIONS', '', [['message','lib.php',39]], 5],
'FORMAT_PLAIN': ['FORMAT_PLAIN', '', [['lib','weblib.php',52]], 124],
'MESSAGE_DISCUSSION_HEIGHT': ['MESSAGE_DISCUSSION_HEIGHT', '', [['message','lib.php',30]], 2],
'MESSAGE_SHORTLENGTH': ['MESSAGE_SHORTLENGTH', '', [['message','lib.php',27]], 2],
'MESSAGE_CONTACTS_PER_PAGE': ['MESSAGE_CONTACTS_PER_PAGE', '', [['message','lib.php',47]], 4],
'PARAM_BOOL': ['PARAM_BOOL', '', [['lib','moodlelib.php',108]], 502]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
