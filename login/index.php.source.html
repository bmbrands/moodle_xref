<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /login/index.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='login';
filename='index.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/login/</a> -> <a href="index.php.html">index.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="index.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="index.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">//</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">//</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">//</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Main login page.</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package    core</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @subpackage auth</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @copyright  1999 onwards Martin Dougiamas  http://dougiamas.com</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> */</span>
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  <a class="function" onClick="logFunction('require')" href="../_functions/require.html" onMouseOver="funcPopup(event,'require')">require</a>('../config.php');
<a name="l28"><span class="linenum">  28</span></a>  <span class="keyword">require_once</span> <a class="filename" href="../group/lib.php.html" onMouseOver="reqPopup(event, 'lib.php', '../group/lib.php')">('lib.php')</a>;
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">// Try to prevent searching for sites that allow sign-up.</span>
<a name="l31"><span class="linenum">  31</span></a>  if (!isset(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('additionalhtmlhead')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/additionalhtmlhead.html">additionalhtmlhead</a>)) {
<a name="l32"><span class="linenum">  32</span></a>      <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('additionalhtmlhead')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/additionalhtmlhead.html">additionalhtmlhead</a> = '';
<a name="l33"><span class="linenum">  33</span></a>  }
<a name="l34"><span class="linenum">  34</span></a>  <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('additionalhtmlhead')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/additionalhtmlhead.html">additionalhtmlhead</a> .= '&lt;meta name=&quot;robots&quot; content=&quot;noindex&quot; /&gt;';
<a name="l35"><span class="linenum">  35</span></a>  
<a name="l36"><span class="linenum">  36</span></a>  <a class="function" onClick="logFunction('redirect_if_major_upgrade_required')" href="../_functions/redirect_if_major_upgrade_required.html" onMouseOver="funcPopup(event,'redirect_if_major_upgrade_required')">redirect_if_major_upgrade_required</a>();
<a name="l37"><span class="linenum">  37</span></a>  
<a name="l38"><span class="linenum">  38</span></a>  <a class="var it350" onMouseOver="hilite(350)" onMouseOut="lolite()" onClick="logVariable('testsession')" href="../_variables/testsession.html">$testsession</a> = <a class="function" onClick="logFunction('optional_param')" href="../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>('testsession', 0, <a class="constant" onClick="logConstant('PARAM_INT')" href="../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>); <span class="comment">// test session works properly</span>
<a name="l39"><span class="linenum">  39</span></a>  <a class="var it351" onMouseOver="hilite(351)" onMouseOut="lolite()" onClick="logVariable('cancel')" href="../_variables/cancel.html">$cancel</a>      = <a class="function" onClick="logFunction('optional_param')" href="../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>('cancel', 0, <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>);      <span class="comment">// redirect to frontpage, needed for loginhttps</span>
<a name="l40"><span class="linenum">  40</span></a>  <a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('anchor')" href="../_variables/anchor.html">$anchor</a>      = <a class="function" onClick="logFunction('optional_param')" href="../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>('anchor', '', <a class="constant" onClick="logConstant('PARAM_RAW')" href="../_constants/PARAM_RAW.html" onMouseOver="constPopup(event,'PARAM_RAW')">PARAM_RAW</a>);      <span class="comment">// Used to restore hash anchor to wantsurl.</span>
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>  if (<a class="var it351" onMouseOver="hilite(351)" onMouseOut="lolite()" onClick="logVariable('cancel')" href="../_variables/cancel.html">$cancel</a>) {
<a name="l43"><span class="linenum">  43</span></a>      <a class="function" onClick="logFunction('redirect')" href="../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/'));
<a name="l44"><span class="linenum">  44</span></a>  }
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment">//HTTPS is required in this page when $CFG-&gt;loginhttps enabled</span>
<a name="l47"><span class="linenum">  47</span></a>  <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('https_required')" href="../_functions/https_required.html" onMouseOver="funcPopup(event,'https_required')">https_required</a>();
<a name="l48"><span class="linenum">  48</span></a>  
<a name="l49"><span class="linenum">  49</span></a>  <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l50"><span class="linenum">  50</span></a>  <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_url')" href="../_functions/set_url.html" onMouseOver="funcPopup(event,'set_url')">set_url</a>(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/httpswwwroot.html">httpswwwroot</a>/login/index.php&quot;);
<a name="l51"><span class="linenum">  51</span></a>  <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_context')" href="../_functions/set_context.html" onMouseOver="funcPopup(event,'set_context')">set_context</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l52"><span class="linenum">  52</span></a>  <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_pagelayout')" href="../_functions/set_pagelayout.html" onMouseOver="funcPopup(event,'set_pagelayout')">set_pagelayout</a>('login');
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">/// Initialize variables</span>
<a name="l55"><span class="linenum">  55</span></a>  <a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a> = '';
<a name="l56"><span class="linenum">  56</span></a>  <a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../_variables/errorcode.html">$errorcode</a> = 0;
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment">// login page requested session test</span>
<a name="l59"><span class="linenum">  59</span></a>  if (<a class="var it350" onMouseOver="hilite(350)" onMouseOut="lolite()" onClick="logVariable('testsession')" href="../_variables/testsession.html">$testsession</a>) {
<a name="l60"><span class="linenum">  60</span></a>      if (<a class="var it350" onMouseOver="hilite(350)" onMouseOut="lolite()" onClick="logVariable('testsession')" href="../_variables/testsession.html">$testsession</a> == <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l61"><span class="linenum">  61</span></a>          if (isset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>)) {
<a name="l62"><span class="linenum">  62</span></a>              <a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../_variables/urltogo.html">$urltogo</a> = <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>;
<a name="l63"><span class="linenum">  63</span></a>          } else {
<a name="l64"><span class="linenum">  64</span></a>              <a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../_variables/urltogo.html">$urltogo</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>.'/';
<a name="l65"><span class="linenum">  65</span></a>          }
<a name="l66"><span class="linenum">  66</span></a>          unset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>);
<a name="l67"><span class="linenum">  67</span></a>          <a class="function" onClick="logFunction('redirect')" href="../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../_variables/urltogo.html">$urltogo</a>);
<a name="l68"><span class="linenum">  68</span></a>      } else {
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment">        // TODO: try to find out what is the exact reason why sessions do not work</span>
<a name="l70"><span class="linenum">  70</span></a>          <a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;cookiesnotenabled&quot;);
<a name="l71"><span class="linenum">  71</span></a>          <a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../_variables/errorcode.html">$errorcode</a> = 1;
<a name="l72"><span class="linenum">  72</span></a>      }
<a name="l73"><span class="linenum">  73</span></a>  }
<a name="l74"><span class="linenum">  74</span></a>  
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">/// Check for timed out sessions</span>
<a name="l76"><span class="linenum">  76</span></a>  if (!empty(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('has_timed_out')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/has_timed_out.html">has_timed_out</a>)) {
<a name="l77"><span class="linenum">  77</span></a>      <a class="var it360" onMouseOver="hilite(360)" onMouseOut="lolite()" onClick="logVariable('session_has_timed_out')" href="../_variables/session_has_timed_out.html">$session_has_timed_out</a> = true;
<a name="l78"><span class="linenum">  78</span></a>      unset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('has_timed_out')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/has_timed_out.html">has_timed_out</a>);
<a name="l79"><span class="linenum">  79</span></a>  } else {
<a name="l80"><span class="linenum">  80</span></a>      <a class="var it360" onMouseOver="hilite(360)" onMouseOut="lolite()" onClick="logVariable('session_has_timed_out')" href="../_variables/session_has_timed_out.html">$session_has_timed_out</a> = false;
<a name="l81"><span class="linenum">  81</span></a>  }
<a name="l82"><span class="linenum">  82</span></a>  
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">/// auth plugins may override these - SSO anyone?</span>
<a name="l84"><span class="linenum">  84</span></a>  <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>  = false;
<a name="l85"><span class="linenum">  85</span></a>  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = false;
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>  <a class="var it363" onMouseOver="hilite(363)" onMouseOut="lolite()" onClick="logVariable('authsequence')" href="../_variables/authsequence.html">$authsequence</a> = <a class="function" onClick="logFunction('get_enabled_auth_plugins')" href="../_functions/get_enabled_auth_plugins.html" onMouseOver="funcPopup(event,'get_enabled_auth_plugins')">get_enabled_auth_plugins</a>(true); <span class="comment">// auths, in sequence</span>
<a name="l88"><span class="linenum">  88</span></a>  foreach(<a class="var it363" onMouseOver="hilite(363)" onMouseOut="lolite()" onClick="logVariable('authsequence')" href="../_variables/authsequence.html">$authsequence</a> as <a class="var it364" onMouseOver="hilite(364)" onMouseOut="lolite()" onClick="logVariable('authname')" href="../_variables/authname.html">$authname</a>) {
<a name="l89"><span class="linenum">  89</span></a>      <a class="var it365" onMouseOver="hilite(365)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../_variables/authplugin.html">$authplugin</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it364" onMouseOver="hilite(364)" onMouseOut="lolite()" onClick="logVariable('authname')" href="../_variables/authname.html">$authname</a>);
<a name="l90"><span class="linenum">  90</span></a>      <a class="var it365" onMouseOver="hilite(365)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../_variables/authplugin.html">$authplugin</a>-&gt;<a class="function" onClick="logFunction('loginpage_hook')" href="../_functions/loginpage_hook.html" onMouseOver="funcPopup(event,'loginpage_hook')">loginpage_hook</a>();
<a name="l91"><span class="linenum">  91</span></a>  }
<a name="l92"><span class="linenum">  92</span></a>  
<a name="l93"><span class="linenum">  93</span></a>  
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment">/// Define variables used in page</span>
<a name="l95"><span class="linenum">  95</span></a>  <a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../_variables/site.html">$site</a> = <a class="function" onClick="logFunction('get_site')" href="../_functions/get_site.html" onMouseOver="funcPopup(event,'get_site')">get_site</a>();
<a name="l96"><span class="linenum">  96</span></a>  
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">// Ignore any active pages in the navigation/settings.</span>
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">// We do this because there won't be an active page there, and by ignoring the active pages the</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment">// navigation and settings won't be initialised unless something else needs them.</span>
<a name="l100"><span class="linenum"> 100</span></a>  <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('navbar')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../_variables/navbar.html">navbar</a>-&gt;<a class="function" onClick="logFunction('ignore_active')" href="../_functions/ignore_active.html" onMouseOver="funcPopup(event,'ignore_active')">ignore_active</a>();
<a name="l101"><span class="linenum"> 101</span></a>  <a class="var it368" onMouseOver="hilite(368)" onMouseOut="lolite()" onClick="logVariable('loginsite')" href="../_variables/loginsite.html">$loginsite</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;loginsite&quot;);
<a name="l102"><span class="linenum"> 102</span></a>  <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('navbar')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../_variables/navbar.html">navbar</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="var it368" onMouseOver="hilite(368)" onMouseOut="lolite()" onClick="logVariable('loginsite')" href="../_variables/loginsite.html">$loginsite</a>);
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>  if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> !== false or <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a> !== false or <a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a> !== '') {
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment">    // some auth plugin already supplied full user, fake form data or prevented user login with error message</span>
<a name="l106"><span class="linenum"> 106</span></a>  
<a name="l107"><span class="linenum"> 107</span></a>  } else if (!empty(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'/login/weblinkauth.php')) {
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment">    // Handles the case of another Moodle site linking into a page on this site</span>
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">    //TODO: move weblink into own auth plugin</span>
<a name="l110"><span class="linenum"> 110</span></a>      include(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'/login/weblinkauth.php');
<a name="l111"><span class="linenum"> 111</span></a>      if (<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('weblink_auth')) {
<a name="l112"><span class="linenum"> 112</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = weblink_auth(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>);
<a name="l113"><span class="linenum"> 113</span></a>      }
<a name="l114"><span class="linenum"> 114</span></a>      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l115"><span class="linenum"> 115</span></a>          <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l116"><span class="linenum"> 116</span></a>      } else {
<a name="l117"><span class="linenum"> 117</span></a>          <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a> = <a class="function" onClick="logFunction('data_submitted')" href="../_functions/data_submitted.html" onMouseOver="funcPopup(event,'data_submitted')">data_submitted</a>();
<a name="l118"><span class="linenum"> 118</span></a>      }
<a name="l119"><span class="linenum"> 119</span></a>  
<a name="l120"><span class="linenum"> 120</span></a>  } else {
<a name="l121"><span class="linenum"> 121</span></a>      <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a> = <a class="function" onClick="logFunction('data_submitted')" href="../_functions/data_submitted.html" onMouseOver="funcPopup(event,'data_submitted')">data_submitted</a>();
<a name="l122"><span class="linenum"> 122</span></a>  }
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">// Restore the #anchor to the original wantsurl. Note that this</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">// will only work for internal auth plugins, SSO plugins such as</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">// SAML / CAS / OIDC will have to handle this correctly directly.</span>
<a name="l127"><span class="linenum"> 127</span></a>  if (<a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('anchor')" href="../_variables/anchor.html">$anchor</a> &amp;&amp; isset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>, '#') === false) {
<a name="l128"><span class="linenum"> 128</span></a>      <a class="var it356" onMouseOver="hilite(356)" onMouseOut="lolite()" onClick="logVariable('wantsurl')" href="../_variables/wantsurl.html">$wantsurl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>);
<a name="l129"><span class="linenum"> 129</span></a>      <a class="var it356" onMouseOver="hilite(356)" onMouseOut="lolite()" onClick="logVariable('wantsurl')" href="../_variables/wantsurl.html">$wantsurl</a>-&gt;<a class="function" onClick="logFunction('set_anchor')" href="../_functions/set_anchor.html" onMouseOver="funcPopup(event,'set_anchor')">set_anchor</a>(<a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('anchor')" href="../_variables/anchor.html">$anchor</a>, 1));
<a name="l130"><span class="linenum"> 130</span></a>      <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a> = <a class="var it356" onMouseOver="hilite(356)" onMouseOut="lolite()" onClick="logVariable('wantsurl')" href="../_variables/wantsurl.html">$wantsurl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>();
<a name="l131"><span class="linenum"> 131</span></a>  }
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">/// Check if the user has actually submitted login data to us</span>
<a name="l134"><span class="linenum"> 134</span></a>  
<a name="l135"><span class="linenum"> 135</span></a>  if (<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a> and isset(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a>)) {                             // Login WITH cookies
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>      <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="class" onClick="logClass('core_text')" href="../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l138"><span class="linenum"> 138</span></a>  
<a name="l139"><span class="linenum"> 139</span></a>      if (<a class="function" onClick="logFunction('is_enabled_auth')" href="../_functions/is_enabled_auth.html" onMouseOver="funcPopup(event,'is_enabled_auth')">is_enabled_auth</a>('none') ) {
<a name="l140"><span class="linenum"> 140</span></a>          if (<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a> !== <a class="class" onClick="logClass('core_user')" href="../_classes/core_user.html" onMouseOver="classPopup(event,'core_user')">core_user</a>::<a class="function" onClick="logFunction('clean_field')" href="../_functions/clean_field.html" onMouseOver="funcPopup(event,'clean_field')">clean_field</a>(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a>, 'username')) {
<a name="l141"><span class="linenum"> 141</span></a>              <a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('username').': '.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;invalidusername&quot;);
<a name="l142"><span class="linenum"> 142</span></a>              <a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../_variables/errorcode.html">$errorcode</a> = 2;
<a name="l143"><span class="linenum"> 143</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null;
<a name="l144"><span class="linenum"> 144</span></a>          }
<a name="l145"><span class="linenum"> 145</span></a>      }
<a name="l146"><span class="linenum"> 146</span></a>  
<a name="l147"><span class="linenum"> 147</span></a>      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">        //user already supplied by aut plugin prelogin hook</span>
<a name="l149"><span class="linenum"> 149</span></a>      } else if ((<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a> == 'guest') and empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('guestloginbutton')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/guestloginbutton.html">guestloginbutton</a>)) {
<a name="l150"><span class="linenum"> 150</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = false;    <span class="comment">/// Can't log in as guest if guest button is disabled</span>
<a name="l151"><span class="linenum"> 151</span></a>          <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a> = false;
<a name="l152"><span class="linenum"> 152</span></a>      } else {
<a name="l153"><span class="linenum"> 153</span></a>          if (empty(<a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a>)) {
<a name="l154"><span class="linenum"> 154</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="function" onClick="logFunction('authenticate_user_login')" href="../_functions/authenticate_user_login.html" onMouseOver="funcPopup(event,'authenticate_user_login')">authenticate_user_login</a>(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a>, <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('password')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/password.html">password</a>, false, <a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../_variables/errorcode.html">$errorcode</a>);
<a name="l155"><span class="linenum"> 155</span></a>          }
<a name="l156"><span class="linenum"> 156</span></a>      }
<a name="l157"><span class="linenum"> 157</span></a>  
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">    // Intercept 'restored' users to provide them with info &amp; reset password</span>
<a name="l159"><span class="linenum"> 159</span></a>      if (!<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> and <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a> and <a class="function" onClick="logFunction('is_restored_user')" href="../_functions/is_restored_user.html" onMouseOver="funcPopup(event,'is_restored_user')">is_restored_user</a>(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a>)) {
<a name="l160"><span class="linenum"> 160</span></a>          <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_title')" href="../_functions/set_title.html" onMouseOver="funcPopup(event,'set_title')">set_title</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('restoredaccount'));
<a name="l161"><span class="linenum"> 161</span></a>          <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_heading')" href="../_functions/set_heading.html" onMouseOver="funcPopup(event,'set_heading')">set_heading</a>(<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('fullname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>);
<a name="l162"><span class="linenum"> 162</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>();
<a name="l163"><span class="linenum"> 163</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('heading')" href="../_functions/heading.html" onMouseOver="funcPopup(event,'heading')">heading</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('restoredaccount'));
<a name="l164"><span class="linenum"> 164</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('restoredaccountinfo'), 'generalbox boxaligncenter');
<a name="l165"><span class="linenum"> 165</span></a>          <span class="keyword">require_once</span> <a class="filename" href="../login/restored_password_form.php.html" onMouseOver="reqPopup(event, 'restored_password_form.php', '../login/restored_password_form.php')">('restored_password_form.php')</a>; <span class="comment">// Use our &quot;supplanter&quot; login_forgot_password_form. MDL-20846</span>
<a name="l166"><span class="linenum"> 166</span></a>          <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../_variables/form.html">$form</a> = <span class="keyword">new </span><a class="class" onClick="logClass('login_forgot_password_form')" href="../_classes/login_forgot_password_form.html" onMouseOver="classPopup(event,'login_forgot_password_form')">login_forgot_password_form</a>('forgot_password.php', array('username' =&gt; <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l167"><span class="linenum"> 167</span></a>          <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../_variables/form.html">$form</a>-&gt;<a class="function" onClick="logFunction('display')" href="../_functions/display.html" onMouseOver="funcPopup(event,'display')">display</a>();
<a name="l168"><span class="linenum"> 168</span></a>          echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('footer')" href="../_functions/footer.html" onMouseOver="funcPopup(event,'footer')">footer</a>();
<a name="l169"><span class="linenum"> 169</span></a>          die;
<a name="l170"><span class="linenum"> 170</span></a>      }
<a name="l171"><span class="linenum"> 171</span></a>  
<a name="l172"><span class="linenum"> 172</span></a>      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l173"><span class="linenum"> 173</span></a>  
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment">        // language setup</span>
<a name="l175"><span class="linenum"> 175</span></a>          if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">            // no predefined language for guests - use existing session or default site lang</span>
<a name="l177"><span class="linenum"> 177</span></a>              unset(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lang')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/lang.html">lang</a>);
<a name="l178"><span class="linenum"> 178</span></a>  
<a name="l179"><span class="linenum"> 179</span></a>          } else if (!empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lang')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/lang.html">lang</a>)) {
<a name="l180"><span class="linenum"> 180</span></a>  <span class="comment">            // unset previous session language - use user preference instead</span>
<a name="l181"><span class="linenum"> 181</span></a>              unset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('lang')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/lang.html">lang</a>);
<a name="l182"><span class="linenum"> 182</span></a>          }
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>          if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('confirmed')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/confirmed.html">confirmed</a>)) {       // This account was never confirmed
<a name="l185"><span class="linenum"> 185</span></a>              <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_title')" href="../_functions/set_title.html" onMouseOver="funcPopup(event,'set_title')">set_title</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;mustconfirm&quot;));
<a name="l186"><span class="linenum"> 186</span></a>              <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_heading')" href="../_functions/set_heading.html" onMouseOver="funcPopup(event,'set_heading')">set_heading</a>(<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('fullname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>);
<a name="l187"><span class="linenum"> 187</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>();
<a name="l188"><span class="linenum"> 188</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('heading')" href="../_functions/heading.html" onMouseOver="funcPopup(event,'heading')">heading</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;mustconfirm&quot;));
<a name="l189"><span class="linenum"> 189</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box')" href="../_functions/box.html" onMouseOver="funcPopup(event,'box')">box</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;emailconfirmsent&quot;, &quot;&quot;, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('email')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/email.html">email</a>), &quot;generalbox boxaligncenter&quot;);
<a name="l190"><span class="linenum"> 190</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('footer')" href="../_functions/footer.html" onMouseOver="funcPopup(event,'footer')">footer</a>();
<a name="l191"><span class="linenum"> 191</span></a>              die;
<a name="l192"><span class="linenum"> 192</span></a>          }
<a name="l193"><span class="linenum"> 193</span></a>  
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment">    /// Let's get them all set up.</span>
<a name="l195"><span class="linenum"> 195</span></a>          <a class="function" onClick="logFunction('complete_user_login')" href="../_functions/complete_user_login.html" onMouseOver="funcPopup(event,'complete_user_login')">complete_user_login</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l196"><span class="linenum"> 196</span></a>  
<a name="l197"><span class="linenum"> 197</span></a>          \core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('apply_concurrent_login_limit')" href="../_functions/apply_concurrent_login_limit.html" onMouseOver="funcPopup(event,'apply_concurrent_login_limit')">apply_concurrent_login_limit</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="phpfunction" onClick="logFunction('session_id')" href="../_functions/session_id.html" onMouseOver="phpfuncPopup(event,'session_id')">session_id</a>());
<a name="l198"><span class="linenum"> 198</span></a>  
<a name="l199"><span class="linenum"> 199</span></a>  <span class="comment">        // sets the username cookie</span>
<a name="l200"><span class="linenum"> 200</span></a>          if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('nolastloggedin')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/nolastloggedin.html">nolastloggedin</a>)) {
<a name="l201"><span class="linenum"> 201</span></a>  <span class="comment">            // do not store last logged in user in cookie</span>
<a name="l202"><span class="linenum"> 202</span></a>  <span class="comment">            // auth plugins can temporarily override this from loginpage_hook()</span>
<a name="l203"><span class="linenum"> 203</span></a>  <span class="comment">            // do not save $CFG-&gt;nolastloggedin in database!</span>
<a name="l204"><span class="linenum"> 204</span></a>  
<a name="l205"><span class="linenum"> 205</span></a>          } else if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('rememberusername')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/rememberusername.html">rememberusername</a>) <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('rememberusername')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/rememberusername.html">rememberusername</a> == 2 and empty(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('rememberusername')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/rememberusername.html">rememberusername</a>))) {
<a name="l206"><span class="linenum"> 206</span></a>  <span class="comment">            // no permanent cookies, delete old one if exists</span>
<a name="l207"><span class="linenum"> 207</span></a>              <a class="function" onClick="logFunction('set_moodle_cookie')" href="../_functions/set_moodle_cookie.html" onMouseOver="funcPopup(event,'set_moodle_cookie')">set_moodle_cookie</a>('');
<a name="l208"><span class="linenum"> 208</span></a>  
<a name="l209"><span class="linenum"> 209</span></a>          } else {
<a name="l210"><span class="linenum"> 210</span></a>              <a class="function" onClick="logFunction('set_moodle_cookie')" href="../_functions/set_moodle_cookie.html" onMouseOver="funcPopup(event,'set_moodle_cookie')">set_moodle_cookie</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('username')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l211"><span class="linenum"> 211</span></a>          }
<a name="l212"><span class="linenum"> 212</span></a>  
<a name="l213"><span class="linenum"> 213</span></a>          <a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../_variables/urltogo.html">$urltogo</a> = <a class="function" onClick="logFunction('core_login_get_return_url')" href="../_functions/core_login_get_return_url.html" onMouseOver="funcPopup(event,'core_login_get_return_url')">core_login_get_return_url</a>();
<a name="l214"><span class="linenum"> 214</span></a>  
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment">    /// check if user password has expired</span>
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment">    /// Currently supported only for ldap-authentication module</span>
<a name="l217"><span class="linenum"> 217</span></a>          <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('auth')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>);
<a name="l218"><span class="linenum"> 218</span></a>          if (!<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>() and !empty(<a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('config')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration) and <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('config')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration == 1) {
<a name="l219"><span class="linenum"> 219</span></a>              if (<a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a class="function" onClick="logFunction('can_change_password')" href="../_functions/can_change_password.html" onMouseOver="funcPopup(event,'can_change_password')">can_change_password</a>()) {
<a name="l220"><span class="linenum"> 220</span></a>                  <a class="var it379" onMouseOver="hilite(379)" onMouseOut="lolite()" onClick="logVariable('passwordchangeurl')" href="../_variables/passwordchangeurl.html">$passwordchangeurl</a> = <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a class="function" onClick="logFunction('change_password_url')" href="../_functions/change_password_url.html" onMouseOver="funcPopup(event,'change_password_url')">change_password_url</a>();
<a name="l221"><span class="linenum"> 221</span></a>                  if (!<a class="var it379" onMouseOver="hilite(379)" onMouseOut="lolite()" onClick="logVariable('passwordchangeurl')" href="../_variables/passwordchangeurl.html">$passwordchangeurl</a>) {
<a name="l222"><span class="linenum"> 222</span></a>                      <a class="var it379" onMouseOver="hilite(379)" onMouseOut="lolite()" onClick="logVariable('passwordchangeurl')" href="../_variables/passwordchangeurl.html">$passwordchangeurl</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/httpswwwroot.html">httpswwwroot</a>.'<a class="filename" href="../login/change_password.php.html">/login/change_password.php</a>';
<a name="l223"><span class="linenum"> 223</span></a>                  }
<a name="l224"><span class="linenum"> 224</span></a>              } else {
<a name="l225"><span class="linenum"> 225</span></a>                  <a class="var it379" onMouseOver="hilite(379)" onMouseOut="lolite()" onClick="logVariable('passwordchangeurl')" href="../_variables/passwordchangeurl.html">$passwordchangeurl</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/httpswwwroot.html">httpswwwroot</a>.'<a class="filename" href="../login/change_password.php.html">/login/change_password.php</a>';
<a name="l226"><span class="linenum"> 226</span></a>              }
<a name="l227"><span class="linenum"> 227</span></a>              <a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a> = <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a class="function" onClick="logFunction('password_expire')" href="../_functions/password_expire.html" onMouseOver="funcPopup(event,'password_expire')">password_expire</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('username')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l228"><span class="linenum"> 228</span></a>              <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_title')" href="../_functions/set_title.html" onMouseOver="funcPopup(event,'set_title')">set_title</a>(&quot;<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('fullname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>: <a class="var it368" onMouseOver="hilite(368)" onMouseOut="lolite()" onClick="logVariable('loginsite')" href="../_variables/loginsite.html">$loginsite</a>&quot;);
<a name="l229"><span class="linenum"> 229</span></a>              <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_heading')" href="../_functions/set_heading.html" onMouseOver="funcPopup(event,'set_heading')">set_heading</a>(&quot;<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('fullname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>&quot;);
<a name="l230"><span class="linenum"> 230</span></a>              if (<a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a>) &gt; 0 &amp;&amp; <a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a>) &lt; <a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('config')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration_warning)) {
<a name="l231"><span class="linenum"> 231</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>();
<a name="l232"><span class="linenum"> 232</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('confirm')" href="../_functions/confirm.html" onMouseOver="funcPopup(event,'confirm')">confirm</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('auth_passwordwillexpire', 'auth', <a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a>), <a class="var it379" onMouseOver="hilite(379)" onMouseOut="lolite()" onClick="logVariable('passwordchangeurl')" href="../_variables/passwordchangeurl.html">$passwordchangeurl</a>, <a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../_variables/urltogo.html">$urltogo</a>);
<a name="l233"><span class="linenum"> 233</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('footer')" href="../_functions/footer.html" onMouseOver="funcPopup(event,'footer')">footer</a>();
<a name="l234"><span class="linenum"> 234</span></a>                  exit;
<a name="l235"><span class="linenum"> 235</span></a>              } elseif (<a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a>) &lt; 0 ) {
<a name="l236"><span class="linenum"> 236</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>();
<a name="l237"><span class="linenum"> 237</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('confirm')" href="../_functions/confirm.html" onMouseOver="funcPopup(event,'confirm')">confirm</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('auth_passwordisexpired', 'auth'), <a class="var it379" onMouseOver="hilite(379)" onMouseOut="lolite()" onClick="logVariable('passwordchangeurl')" href="../_variables/passwordchangeurl.html">$passwordchangeurl</a>, <a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../_variables/urltogo.html">$urltogo</a>);
<a name="l238"><span class="linenum"> 238</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('footer')" href="../_functions/footer.html" onMouseOver="funcPopup(event,'footer')">footer</a>();
<a name="l239"><span class="linenum"> 239</span></a>                  exit;
<a name="l240"><span class="linenum"> 240</span></a>              }
<a name="l241"><span class="linenum"> 241</span></a>          }
<a name="l242"><span class="linenum"> 242</span></a>  
<a name="l243"><span class="linenum"> 243</span></a>  <span class="comment">        // Discard any errors before the last redirect.</span>
<a name="l244"><span class="linenum"> 244</span></a>          unset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('loginerrormsg')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/loginerrormsg.html">loginerrormsg</a>);
<a name="l245"><span class="linenum"> 245</span></a>  
<a name="l246"><span class="linenum"> 246</span></a>  <span class="comment">        // test the session actually works by redirecting to self</span>
<a name="l247"><span class="linenum"> 247</span></a>          <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a> = <a class="var it357" onMouseOver="hilite(357)" onMouseOut="lolite()" onClick="logVariable('urltogo')" href="../_variables/urltogo.html">$urltogo</a>;
<a name="l248"><span class="linenum"> 248</span></a>          <a class="function" onClick="logFunction('redirect')" href="../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="function" onClick="logFunction('get_login_url')" href="../_functions/get_login_url.html" onMouseOver="funcPopup(event,'get_login_url')">get_login_url</a>(), array('testsession'=&gt;<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)));
<a name="l249"><span class="linenum"> 249</span></a>  
<a name="l250"><span class="linenum"> 250</span></a>      } else {
<a name="l251"><span class="linenum"> 251</span></a>          if (empty(<a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a>)) {
<a name="l252"><span class="linenum"> 252</span></a>              if (<a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../_variables/errorcode.html">$errorcode</a> == <a class="constant" onClick="logConstant('AUTH_LOGIN_UNAUTHORISED')" href="../_constants/AUTH_LOGIN_UNAUTHORISED.html" onMouseOver="constPopup(event,'AUTH_LOGIN_UNAUTHORISED')">AUTH_LOGIN_UNAUTHORISED</a>) {
<a name="l253"><span class="linenum"> 253</span></a>                  <a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;unauthorisedlogin&quot;, &quot;&quot;, <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l254"><span class="linenum"> 254</span></a>              } else {
<a name="l255"><span class="linenum"> 255</span></a>                  <a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(&quot;invalidlogin&quot;);
<a name="l256"><span class="linenum"> 256</span></a>                  <a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../_variables/errorcode.html">$errorcode</a> = 3;
<a name="l257"><span class="linenum"> 257</span></a>              }
<a name="l258"><span class="linenum"> 258</span></a>          }
<a name="l259"><span class="linenum"> 259</span></a>      }
<a name="l260"><span class="linenum"> 260</span></a>  }
<a name="l261"><span class="linenum"> 261</span></a>  
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">/// Detect problems with timedout sessions</span>
<a name="l263"><span class="linenum"> 263</span></a>  if (<a class="var it360" onMouseOver="hilite(360)" onMouseOut="lolite()" onClick="logVariable('session_has_timed_out')" href="../_variables/session_has_timed_out.html">$session_has_timed_out</a> and !<a class="function" onClick="logFunction('data_submitted')" href="../_functions/data_submitted.html" onMouseOver="funcPopup(event,'data_submitted')">data_submitted</a>()) {
<a name="l264"><span class="linenum"> 264</span></a>      <a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('sessionerroruser', 'error');
<a name="l265"><span class="linenum"> 265</span></a>      <a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../_variables/errorcode.html">$errorcode</a> = 4;
<a name="l266"><span class="linenum"> 266</span></a>  }
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>  <span class="comment">/// First, let's remember where the user was trying to get to before they got here</span>
<a name="l269"><span class="linenum"> 269</span></a>  
<a name="l270"><span class="linenum"> 270</span></a>  if (empty(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>)) {
<a name="l271"><span class="linenum"> 271</span></a>      <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a> = null;
<a name="l272"><span class="linenum"> 272</span></a>      <a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../_variables/referer.html">$referer</a> = <a class="function" onClick="logFunction('get_local_referer')" href="../_functions/get_local_referer.html" onMouseOver="funcPopup(event,'get_local_referer')">get_local_referer</a>(false);
<a name="l273"><span class="linenum"> 273</span></a>      if (<a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../_variables/referer.html">$referer</a> &amp;&amp;
<a name="l274"><span class="linenum"> 274</span></a>              <a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../_variables/referer.html">$referer</a> != <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a> &amp;&amp;
<a name="l275"><span class="linenum"> 275</span></a>              <a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../_variables/referer.html">$referer</a> != <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a> . '/' &amp;&amp;
<a name="l276"><span class="linenum"> 276</span></a>              <a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../_variables/referer.html">$referer</a> != <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/httpswwwroot.html">httpswwwroot</a> . '/login/' &amp;&amp;
<a name="l277"><span class="linenum"> 277</span></a>              <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../_variables/referer.html">$referer</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/httpswwwroot.html">httpswwwroot</a> . '/login/?') !== 0 &amp;&amp;
<a name="l278"><span class="linenum"> 278</span></a>              <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../_variables/referer.html">$referer</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/httpswwwroot.html">httpswwwroot</a> . '<a class="filename" href="../login/index.php.html">/login/index.php</a>') !== 0) { // There might be some extra params such as ?lang=.
<a name="l279"><span class="linenum"> 279</span></a>          <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a> = <a class="var it382" onMouseOver="hilite(382)" onMouseOut="lolite()" onClick="logVariable('referer')" href="../_variables/referer.html">$referer</a>;
<a name="l280"><span class="linenum"> 280</span></a>      }
<a name="l281"><span class="linenum"> 281</span></a>  }
<a name="l282"><span class="linenum"> 282</span></a>  
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment">/// Redirect to alternative login URL if needed</span>
<a name="l284"><span class="linenum"> 284</span></a>  if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('alternateloginurl')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/alternateloginurl.html">alternateloginurl</a>)) {
<a name="l285"><span class="linenum"> 285</span></a>      <a class="var it384" onMouseOver="hilite(384)" onMouseOut="lolite()" onClick="logVariable('loginurl')" href="../_variables/loginurl.html">$loginurl</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('alternateloginurl')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/alternateloginurl.html">alternateloginurl</a>;
<a name="l286"><span class="linenum"> 286</span></a>  
<a name="l287"><span class="linenum"> 287</span></a>      if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>, <a class="var it384" onMouseOver="hilite(384)" onMouseOut="lolite()" onClick="logVariable('loginurl')" href="../_variables/loginurl.html">$loginurl</a>) === 0) {
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment">        //we do not want to return to alternate url</span>
<a name="l289"><span class="linenum"> 289</span></a>          <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a> = NULL;
<a name="l290"><span class="linenum"> 290</span></a>      }
<a name="l291"><span class="linenum"> 291</span></a>  
<a name="l292"><span class="linenum"> 292</span></a>      if (<a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../_variables/errorcode.html">$errorcode</a>) {
<a name="l293"><span class="linenum"> 293</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it384" onMouseOver="hilite(384)" onMouseOut="lolite()" onClick="logVariable('loginurl')" href="../_variables/loginurl.html">$loginurl</a>, '?') === false) {
<a name="l294"><span class="linenum"> 294</span></a>              <a class="var it384" onMouseOver="hilite(384)" onMouseOut="lolite()" onClick="logVariable('loginurl')" href="../_variables/loginurl.html">$loginurl</a> .= '?';
<a name="l295"><span class="linenum"> 295</span></a>          } else {
<a name="l296"><span class="linenum"> 296</span></a>              <a class="var it384" onMouseOver="hilite(384)" onMouseOut="lolite()" onClick="logVariable('loginurl')" href="../_variables/loginurl.html">$loginurl</a> .= '&amp;';
<a name="l297"><span class="linenum"> 297</span></a>          }
<a name="l298"><span class="linenum"> 298</span></a>          <a class="var it384" onMouseOver="hilite(384)" onMouseOut="lolite()" onClick="logVariable('loginurl')" href="../_variables/loginurl.html">$loginurl</a> .= 'errorcode='.<a class="var it262" onMouseOver="hilite(262)" onMouseOut="lolite()" onClick="logVariable('errorcode')" href="../_variables/errorcode.html">$errorcode</a>;
<a name="l299"><span class="linenum"> 299</span></a>      }
<a name="l300"><span class="linenum"> 300</span></a>  
<a name="l301"><span class="linenum"> 301</span></a>      <a class="function" onClick="logFunction('redirect')" href="../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<a class="var it384" onMouseOver="hilite(384)" onMouseOut="lolite()" onClick="logVariable('loginurl')" href="../_variables/loginurl.html">$loginurl</a>);
<a name="l302"><span class="linenum"> 302</span></a>  }
<a name="l303"><span class="linenum"> 303</span></a>  
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment">// make sure we really are on the https page when https login required</span>
<a name="l305"><span class="linenum"> 305</span></a>  <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('verify_https_required')" href="../_functions/verify_https_required.html" onMouseOver="funcPopup(event,'verify_https_required')">verify_https_required</a>();
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">/// Generate the login page with forms</span>
<a name="l308"><span class="linenum"> 308</span></a>  
<a name="l309"><span class="linenum"> 309</span></a>  if (!isset(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>) or !<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>)) {
<a name="l310"><span class="linenum"> 310</span></a>      <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a> = new stdClass();
<a name="l311"><span class="linenum"> 311</span></a>  }
<a name="l312"><span class="linenum"> 312</span></a>  
<a name="l313"><span class="linenum"> 313</span></a>  if (empty(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) &amp;&amp; <a class="var it363" onMouseOver="hilite(363)" onMouseOut="lolite()" onClick="logVariable('authsequence')" href="../_variables/authsequence.html">$authsequence</a>[0] != 'shibboleth') {  // See bug 5184
<a name="l314"><span class="linenum"> 314</span></a>      if (!empty(<a class="var it385" onMouseOver="hilite(385)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../_variables/_GET.html">$_GET</a>[&quot;username&quot;])) {
<a name="l315"><span class="linenum"> 315</span></a>  <span class="comment">        // we do not want data from _POST here</span>
<a name="l316"><span class="linenum"> 316</span></a>          <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a> = <a class="function" onClick="logFunction('clean_param')" href="../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it385" onMouseOver="hilite(385)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../_variables/_GET.html">$_GET</a>[&quot;username&quot;], <a class="constant" onClick="logConstant('PARAM_RAW')" href="../_constants/PARAM_RAW.html" onMouseOver="constPopup(event,'PARAM_RAW')">PARAM_RAW</a>); <span class="comment">// we do not want data from _POST here</span>
<a name="l317"><span class="linenum"> 317</span></a>      } else {
<a name="l318"><span class="linenum"> 318</span></a>          <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a> = <a class="function" onClick="logFunction('get_moodle_cookie')" href="../_functions/get_moodle_cookie.html" onMouseOver="funcPopup(event,'get_moodle_cookie')">get_moodle_cookie</a>();
<a name="l319"><span class="linenum"> 319</span></a>      }
<a name="l320"><span class="linenum"> 320</span></a>  
<a name="l321"><span class="linenum"> 321</span></a>      <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('password')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/password.html">password</a> = &quot;&quot;;
<a name="l322"><span class="linenum"> 322</span></a>  }
<a name="l323"><span class="linenum"> 323</span></a>  
<a name="l324"><span class="linenum"> 324</span></a>  if (!empty(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('username')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/username.html">username</a>)) {
<a name="l325"><span class="linenum"> 325</span></a>      <a class="var it386" onMouseOver="hilite(386)" onMouseOut="lolite()" onClick="logVariable('focus')" href="../_variables/focus.html">$focus</a> = &quot;password&quot;;
<a name="l326"><span class="linenum"> 326</span></a>  } else {
<a name="l327"><span class="linenum"> 327</span></a>      <a class="var it386" onMouseOver="hilite(386)" onMouseOut="lolite()" onClick="logVariable('focus')" href="../_variables/focus.html">$focus</a> = &quot;username&quot;;
<a name="l328"><span class="linenum"> 328</span></a>  }
<a name="l329"><span class="linenum"> 329</span></a>  
<a name="l330"><span class="linenum"> 330</span></a>  if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('registerauth')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/registerauth.html">registerauth</a>) or <a class="function" onClick="logFunction('is_enabled_auth')" href="../_functions/is_enabled_auth.html" onMouseOver="funcPopup(event,'is_enabled_auth')">is_enabled_auth</a>('none') or !empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('auth_instructions')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/auth_instructions.html">auth_instructions</a>)) {
<a name="l331"><span class="linenum"> 331</span></a>      <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('show_instructions')" href="../_variables/show_instructions.html">$show_instructions</a> = true;
<a name="l332"><span class="linenum"> 332</span></a>  } else {
<a name="l333"><span class="linenum"> 333</span></a>      <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('show_instructions')" href="../_variables/show_instructions.html">$show_instructions</a> = false;
<a name="l334"><span class="linenum"> 334</span></a>  }
<a name="l335"><span class="linenum"> 335</span></a>  
<a name="l336"><span class="linenum"> 336</span></a>  <a class="var it390" onMouseOver="hilite(390)" onMouseOut="lolite()" onClick="logVariable('potentialidps')" href="../_variables/potentialidps.html">$potentialidps</a> = array();
<a name="l337"><span class="linenum"> 337</span></a>  foreach(<a class="var it363" onMouseOver="hilite(363)" onMouseOut="lolite()" onClick="logVariable('authsequence')" href="../_variables/authsequence.html">$authsequence</a> as <a class="var it364" onMouseOver="hilite(364)" onMouseOut="lolite()" onClick="logVariable('authname')" href="../_variables/authname.html">$authname</a>) {
<a name="l338"><span class="linenum"> 338</span></a>      <a class="var it365" onMouseOver="hilite(365)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../_variables/authplugin.html">$authplugin</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it364" onMouseOver="hilite(364)" onMouseOut="lolite()" onClick="logVariable('authname')" href="../_variables/authname.html">$authname</a>);
<a name="l339"><span class="linenum"> 339</span></a>      <a class="var it390" onMouseOver="hilite(390)" onMouseOut="lolite()" onClick="logVariable('potentialidps')" href="../_variables/potentialidps.html">$potentialidps</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it390" onMouseOver="hilite(390)" onMouseOut="lolite()" onClick="logVariable('potentialidps')" href="../_variables/potentialidps.html">$potentialidps</a>, <a class="var it365" onMouseOver="hilite(365)" onMouseOut="lolite()" onClick="logVariable('authplugin')" href="../_variables/authplugin.html">$authplugin</a>-&gt;<a class="function" onClick="logFunction('loginpage_idp_list')" href="../_functions/loginpage_idp_list.html" onMouseOver="funcPopup(event,'loginpage_idp_list')">loginpage_idp_list</a>(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('wantsurl')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/wantsurl.html">wantsurl</a>));
<a name="l340"><span class="linenum"> 340</span></a>  }
<a name="l341"><span class="linenum"> 341</span></a>  
<a name="l342"><span class="linenum"> 342</span></a>  if (!empty(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('loginerrormsg')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/loginerrormsg.html">loginerrormsg</a>)) {
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment">    // We had some errors before redirect, show them now.</span>
<a name="l344"><span class="linenum"> 344</span></a>      <a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a> = <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('loginerrormsg')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/loginerrormsg.html">loginerrormsg</a>;
<a name="l345"><span class="linenum"> 345</span></a>      unset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('loginerrormsg')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/loginerrormsg.html">loginerrormsg</a>);
<a name="l346"><span class="linenum"> 346</span></a>  
<a name="l347"><span class="linenum"> 347</span></a>  } else if (<a class="var it350" onMouseOver="hilite(350)" onMouseOut="lolite()" onClick="logVariable('testsession')" href="../_variables/testsession.html">$testsession</a>) {
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment">    // No need to redirect here.</span>
<a name="l349"><span class="linenum"> 349</span></a>      unset(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('loginerrormsg')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/loginerrormsg.html">loginerrormsg</a>);
<a name="l350"><span class="linenum"> 350</span></a>  
<a name="l351"><span class="linenum"> 351</span></a>  } else if (<a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a> or !empty(<a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('frm')" href="../_variables/frm.html">$frm</a>-&gt;<a onClick="logVariable('password')" class="var it43067" onMouseOver="hilite(43067)" onMouseOut="lolite()" href="../_variables/password.html">password</a>)) {
<a name="l352"><span class="linenum"> 352</span></a>  <span class="comment">    // We must redirect after every password submission.</span>
<a name="l353"><span class="linenum"> 353</span></a>      if (<a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a>) {
<a name="l354"><span class="linenum"> 354</span></a>          <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('loginerrormsg')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../_variables/loginerrormsg.html">loginerrormsg</a> = <a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a>;
<a name="l355"><span class="linenum"> 355</span></a>      }
<a name="l356"><span class="linenum"> 356</span></a>      <a class="function" onClick="logFunction('redirect')" href="../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/httpswwwroot.html">httpswwwroot</a> . '<a class="filename" href="../login/index.php.html">/login/index.php</a>'));
<a name="l357"><span class="linenum"> 357</span></a>  }
<a name="l358"><span class="linenum"> 358</span></a>  
<a name="l359"><span class="linenum"> 359</span></a>  <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_title')" href="../_functions/set_title.html" onMouseOver="funcPopup(event,'set_title')">set_title</a>(&quot;<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('fullname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>: <a class="var it368" onMouseOver="hilite(368)" onMouseOut="lolite()" onClick="logVariable('loginsite')" href="../_variables/loginsite.html">$loginsite</a>&quot;);
<a name="l360"><span class="linenum"> 360</span></a>  <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a class="function" onClick="logFunction('set_heading')" href="../_functions/set_heading.html" onMouseOver="funcPopup(event,'set_heading')">set_heading</a>(&quot;<a class="var it366" onMouseOver="hilite(366)" onMouseOut="lolite()" onClick="logVariable('site')" href="../_variables/site.html">$site</a>-&gt;<a onClick="logVariable('fullname')" class="var it42988" onMouseOver="hilite(42988)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>&quot;);
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>();
<a name="l363"><span class="linenum"> 363</span></a>  
<a name="l364"><span class="linenum"> 364</span></a>  if (<a class="function" onClick="logFunction('isloggedin')" href="../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>() and !<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>()) {
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment">    // prevent logging when already logged in, we do not want them to relogin by accident because sesskey would be changed</span>
<a name="l366"><span class="linenum"> 366</span></a>      echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_start')" href="../_functions/box_start.html" onMouseOver="funcPopup(event,'box_start')">box_start</a>();
<a name="l367"><span class="linenum"> 367</span></a>      <a class="var it391" onMouseOver="hilite(391)" onMouseOut="lolite()" onClick="logVariable('logout')" href="../_variables/logout.html">$logout</a> = <span class="keyword">new </span><a class="class" onClick="logClass('single_button')" href="../_classes/single_button.html" onMouseOver="classPopup(event,'single_button')">single_button</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/httpswwwroot.html">httpswwwroot</a>.'<a class="filename" href="../login/logout.php.html">/login/logout.php</a>', array('sesskey'=&gt;<a class="function" onClick="logFunction('sesskey')" href="../_functions/sesskey.html" onMouseOver="funcPopup(event,'sesskey')">sesskey</a>(),'loginpage'=&gt;1)), <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('logout'), 'post');
<a name="l368"><span class="linenum"> 368</span></a>      <a class="var it392" onMouseOver="hilite(392)" onMouseOut="lolite()" onClick="logVariable('continue')" href="../_variables/continue.html">$continue</a> = <span class="keyword">new </span><a class="class" onClick="logClass('single_button')" href="../_classes/single_button.html" onMouseOver="classPopup(event,'single_button')">single_button</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('httpswwwroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/httpswwwroot.html">httpswwwroot</a>.'<a class="filename" href="../login/index.php.html">/login/index.php</a>', array('cancel'=&gt;1)), <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('cancel'), 'get');
<a name="l369"><span class="linenum"> 369</span></a>      echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('confirm')" href="../_functions/confirm.html" onMouseOver="funcPopup(event,'confirm')">confirm</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('alreadyloggedin', 'error', <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>)), <a class="var it391" onMouseOver="hilite(391)" onMouseOut="lolite()" onClick="logVariable('logout')" href="../_variables/logout.html">$logout</a>, <a class="var it392" onMouseOver="hilite(392)" onMouseOut="lolite()" onClick="logVariable('continue')" href="../_variables/continue.html">$continue</a>);
<a name="l370"><span class="linenum"> 370</span></a>      echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('box_end')" href="../_functions/box_end.html" onMouseOver="funcPopup(event,'box_end')">box_end</a>();
<a name="l371"><span class="linenum"> 371</span></a>  } else {
<a name="l372"><span class="linenum"> 372</span></a>      <span class="keyword">include</span> <a class="filename" href="../auth/shibboleth/index_form.html.html" onMouseOver="reqPopup(event, 'index_form.html', '../auth/shibboleth/index_form.html')">(&quot;index_form.html&quot;)</a>;
<a name="l373"><span class="linenum"> 373</span></a>      if (<a class="var it274" onMouseOver="hilite(274)" onMouseOut="lolite()" onClick="logVariable('errormsg')" href="../_variables/errormsg.html">$errormsg</a>) {
<a name="l374"><span class="linenum"> 374</span></a>          <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('requires')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../_variables/requires.html">requires</a>-&gt;<a class="function" onClick="logFunction('js_init_call')" href="../_functions/js_init_call.html" onMouseOver="funcPopup(event,'js_init_call')">js_init_call</a>('M.util.focus_login_error', null, true);
<a name="l375"><span class="linenum"> 375</span></a>      } else if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('loginpageautofocus')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/loginpageautofocus.html">loginpageautofocus</a>)) {
<a name="l376"><span class="linenum"> 376</span></a>  <span class="comment">        //focus username or password</span>
<a name="l377"><span class="linenum"> 377</span></a>          <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('PAGE')" href="../_variables/PAGE.html">$PAGE</a>-&gt;<a onClick="logVariable('requires')" class="var it42916" onMouseOver="hilite(42916)" onMouseOut="lolite()" href="../_variables/requires.html">requires</a>-&gt;<a class="function" onClick="logFunction('js_init_call')" href="../_functions/js_init_call.html" onMouseOver="funcPopup(event,'js_init_call')">js_init_call</a>('M.util.focus_login_form', null, true);
<a name="l378"><span class="linenum"> 378</span></a>      }
<a name="l379"><span class="linenum"> 379</span></a>  }
<a name="l380"><span class="linenum"> 380</span></a>  
<a name="l381"><span class="linenum"> 381</span></a>  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('footer')" href="../_functions/footer.html" onMouseOver="funcPopup(event,'footer')">footer</a>();
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'box_start': ['box_start', 'Outputs the opening section of a box. ', [['lib','outputrenderers.php',3102]], 259],
'can_change_password': ['can_change_password', 'Returns true if this authentication plugin can change the user\'s password. ', [['auth/radius','auth.php',161],['auth/nntp','auth.php',99],['auth/email','auth.php',183],['auth/mnet','auth.php',598],['auth/imap','auth.php',120],['auth/webservice','auth.php',111],['auth/shibboleth','auth.php',180],['auth/pam','auth.php',111],['auth/manual','auth.php',122],['auth/none','auth.php',99],['auth/ldap','auth.php',1601],['lib','authlib.php',151],['auth/fc','auth.php',180],['auth/pop3','auth.php',116],['auth/nologin','auth.php',82],['auth/cas','auth.php',86],['auth/db','auth.php',714]], 13],
'ignore_active': ['ignore_active', 'Turn on/off ignore active ', [['lib','navigationlib.php',3130]], 4],
'out': ['out', 'Returns the selector for use in a CSS rule ', [['lib','csslib.php',1540],['lib','csslib.php',1698],['lib','csslib.php',2078],['lib','csslib.php',2162],['lib','csslib.php',2306],['lib','csslib.php',2495],['lib','csslib.php',3240],['mod/feedback/classes','responses_table.php',332],['lib','moodlelib.php',9729],['lib','weblib.php',545],['lib','tablelib.php',1594],['report/loglive/classes','table_log_ajax.php',37]], 626],
'box': ['box', 'Outputs a box. ', [['lib','outputrenderers.php',3089]], 288],
'get_login_url': ['get_login_url', 'Returns full login url. ', [['lib','moodlelib.php',2432],['lib','oauthlib.php',466]], 48],
'set_pagelayout': ['set_pagelayout', 'Sets the layout to use for this page. ', [['lib','pagelib.php',1086]], 293],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 556],
'redirect_if_major_upgrade_required': ['redirect_if_major_upgrade_required', 'Check whether a major upgrade is needed. That is defined as an upgrade that changes something really fundamental in the database, so nothing can possibly work until the database has been updated, and that is defined by the hard-coded version number in this function. ', [['lib','setuplib.php',1382]], 3],
'set_anchor': ['set_anchor', 'Sets the anchor for the URI (the bit after the hash) ', [['lib','weblib.php',686]], 39],
'heading': ['heading', 'Outputs a heading ', [['lib','outputrenderers.php',3072],['lib','outputrenderers.php',4364],['lib','outputrenderers.php',4552],['grade/report/singleview/classes/local/screen','screen.php',197],['grade/report/singleview/classes/local/screen','user.php',264],['grade/report/singleview/classes/local/screen','grade.php',283]], 796],
'password_expire': ['password_expire', 'Return number of days to user password expires. ', [['auth/manual','auth.php',175],['auth/ldap','auth.php',616],['lib','authlib.php',364]], 8],
'core_login_get_return_url': ['core_login_get_return_url', '', [['login','lib.php',285]], 3],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'apply_concurrent_login_limit': ['apply_concurrent_login_limit', 'Terminate other sessions of current user depending on $CFG->limitconcurrentlogins restriction. ', [['lib/classes/session','manager.php',650]], 21],
'set_url': ['set_url', 'Convenience method handling moodle_urls. ', [['competency/classes','evidence.php',151],['lib','outputcomponents.php',2828],['backup/cc/cc_lib','cc_weblink.php',50],['lib','pagelib.php',1227],['blocks/rss_client/classes/output','channel_image.php',89],['backup/util/ui','restore_ui_components.php',141],['mod/wiki','pagelib.php',245],['mod/wiki','pagelib.php',333],['mod/wiki','pagelib.php',425],['mod/wiki','pagelib.php',696],['mod/wiki','pagelib.php',721],['mod/wiki','pagelib.php',835],['mod/wiki','pagelib.php',879],['mod/wiki','pagelib.php',1008],['mod/wiki','pagelib.php',1112],['mod/wiki','pagelib.php',1219],['mod/wiki','pagelib.php',1462],['mod/wiki','pagelib.php',1864],['mod/wiki','pagelib.php',1932],['mod/wiki','pagelib.php',2104],['mod/wiki','pagelib.php',2165],['mod/wiki','pagelib.php',2221],['mod/wiki','pagelib.php',2286],['mod/wiki','pagelib.php',2334],['mod/wiki','pagelib.php',2382],['mod/wiki','pagelib.php',2486]], 596],
'clean_param': ['clean_param', 'Used by {@link optional_param()} and {@link required_param()} to clean the variables and/or cast to specific types, based on an options field. <code> $course->format = clean_param($course->format, PARAM_ALPHA); $selectedgradeitem = clean_param($selectedgradeitem, PARAM_INT); </code> ', [['lib','moodlelib.php',769]], 635],
'sesskey': ['sesskey', 'Makes sure that $USER->sesskey exists, if $USER itself exists. It sets a new sesskey if one does not already exist, but does not overwrite existing sesskeys. Returns the sesskey string if $USER exists, or boolean false if not. ', [['lib','sessionlib.php',28]], 641],
'display': ['display', 'Displays the form ', [['backup/util/ui','base_moodleform.class.php',365],['mod/feedback/classes','complete_form.php',536],['lib/minify/lib/Minify/Cache','APC.php',79],['mod/lesson/pagetypes','numerical.php',50],['mod/scorm/report/interactions/classes','report.php',31],['mod/scorm/report/basic/classes','report.php',30],['backup/util/ui','restore_ui.class.php',375],['mod/scorm/report/objectives/classes','report.php',37],['mod/lesson/pagetypes','endofcluster.php',39],['mod/lesson/pagetypes','matching.php',50],['mod/feedback/classes','responses_table.php',344],['user/selector','lib.php',205],['lib/minify/lib/Minify/Cache','File.php',72],['lib','formslib.php',935],['backup/util/ui','base_ui.class.php',169],['mod/lesson/pagetypes','multichoice.php',87],['question/classes/bank','column_base.php',164],['cohort','upload_form.php',316],['mod/quiz/report/statistics','report.php',51],['admin/roles/classes','capability_table_with_risks.php',131],['mod/lesson/pagetypes','truefalse.php',50],['admin/roles/classes','capability_table_base.php',71],['mod/quiz/report/overview','report.php',42],['mod/feedback/classes','templates_table.php',62],['lib/minify/lib/Minify/Cache','ZendPlatform.php',84],['mod/lesson/pagetypes','endofbranch.php',39],['mod/scorm/classes','report.php',39],['backup/util/ui','import_extensions.php',154],['question/classes/bank','view.php',451],['backup/util/ui','backup_ui_stage.class.php',545],['backup/util/ui','backup_ui_stage.class.php',588],['mod/quiz/report/grading','report.php',51],['mod/lesson/pagetypes','shortanswer.php',50],['lib/pear/HTML','Common.php',438],['mod/lesson/pagetypes','essay.php',67],['lib/minify/lib/Minify/Cache','Memcache.php',85],['backup/util/ui','base_ui_stage.class.php',126],['mod/scorm/report/graphs/classes','report.php',127],['mod/lesson/pagetypes','branchtable.php',105],['repository/flickr_public','image.php',149],['admin/roles/classes','define_role_table_advanced.php',612],['mod/quiz/report/responses','report.php',51],['mod/lesson/pagetypes','cluster.php',39],['lib/minify/lib/Minify/Cache','WinCache.php',79],['lib/minify/lib/Minify/Cache','XCache.php',74],['course/format/singleactivity','renderer.php',36],['backup/util/ui','restore_ui_stage.class.php',355],['backup/util/ui','restore_ui_stage.class.php',497],['backup/util/ui','restore_ui_stage.class.php',1025],['backup/util/ui','restore_ui_stage.class.php',1112]], 320],
'clean_field': ['clean_field', 'Clean a specific user field. ', [['lib/classes','user.php',519]], 26],
'require': ['require', '', [['lib/yuilib/3.17.2/timers','timers.js',27],['lib/yuilib/3.17.2/timers','timers-debug.js',27]], 615],
'is_enabled_auth': ['is_enabled_auth', 'Checks if a given plugin is in the list of enabled authentication plugins. ', [['lib','moodlelib.php',3592]], 38],
'optional_param': ['optional_param', 'Returns a particular value for the named variable, taken from POST or GET, otherwise returning a given default. ', [['lib','moodlelib.php',609]], 2210],
'set_title': ['set_title', 'Sets the title for the node ', [['lib','outputcomponents.php',2820],['backup/cc/cc_lib','cc_weblink.php',41],['backup/cc/cc_lib','cc_basiclti.php',57],['lib','pagelib.php',1157],['blocks/rss_client/classes/output','channel_image.php',110],['blocks/rss_client/classes/output','item.php',182],['backup/cc/cc_lib','cc_asssesment.php',595],['backup/cc/cc_lib','cc_asssesment.php',843],['backup/cc/cc_lib','cc_asssesment.php',1060],['backup/cc/cc_lib','cc_asssesment.php',1829],['backup/cc/cc_lib','cc_page.php',38],['lib/classes','chart_base.php',222],['blocks/rss_client/classes/output','feed.php',113],['backup/cc/cc_lib','cc_metadata.php',225],['mod/wiki','pagelib.php',215],['backup/cc/cc_lib','cc_forum.php',39]], 460],
'verify_https_required': ['verify_https_required', 'Makes sure that page previously marked with https_required() is really using https://, if not it redirects to https:// ', [['lib','pagelib.php',1430]], 9],
'box_end': ['box_end', 'Outputs the closing section of a box. ', [['lib','outputrenderers.php',3117]], 257],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'loginpage_idp_list': ['loginpage_idp_list', 'Returns a list of potential IdPs that this authentication plugin supports. This is used to provide links on the login page. ', [['auth/mnet','auth.php',1158],['lib','authlib.php',575]], 1],
'https_required': ['https_required', 'This function indicates that current page requires the https when $CFG->loginhttps enabled. ', [['lib','pagelib.php',1403]], 15],
'js_init_call': ['js_init_call', 'Ensure that the specified JavaScript function is called from an inline script from page footer. ', [['lib','outputrequirementslib.php',1066]], 95],
'get_enabled_auth_plugins': ['get_enabled_auth_plugins', 'Returns array of active auth plugins. ', [['lib','moodlelib.php',3628]], 18],
'get_site': ['get_site', 'Returns $course object of the top-level site. ', [['lib','datalib.php',547]], 77],
'isguestuser': ['isguestuser', 'Determines if a user is logged in as real guest user with username \'guest\'. ', [['lib','accesslib.php',1923]], 260],
'footer': ['footer', 'This method is used to render the page footer. It is automatically called by AddPage() and could be overwritten in your own inherited class. ', [['lib/tcpdf','tcpdf.php',3464],['lib','outputrenderers.php',1034],['lib','outputrenderers.php',4427],['lib','outputrenderers.php',4546],['mod/lesson','renderer.php',78]], 810],
'get_local_referer': ['get_local_referer', 'Returns the cleaned local URL of the HTTP_REFERER less the URL query string parameters if required. ', [['lib','weblib.php',219]], 31],
'get_auth_plugin': ['get_auth_plugin', 'Returns an authentication plugin instance. ', [['lib','moodlelib.php',3608]], 81],
'confirm': ['confirm', 'Print a message along with button choices for Continue/Cancel ', [['lib','outputrenderers.php',1734]], 204],
'complete_user_login': ['complete_user_login', 'Call to complete the user login process after authenticate_user_login() has succeeded. It will setup the $USER variable and other required bits and pieces. ', [['lib','moodlelib.php',4292]], 11],
'authenticate_user_login': ['authenticate_user_login', 'Authenticates a user against the chosen authentication mechanism ', [['lib','moodlelib.php',4077]], 19],
'loginpage_hook': ['loginpage_hook', 'Hook for login page ', [['auth/shibboleth','auth.php',190],['auth/ldap','auth.php',1629],['lib','authlib.php',433],['auth/cas','auth.php',96]], 1],
'is_restored_user': ['is_restored_user', 'Returns true if the user is a \'restored\' one. ', [['lib','moodlelib.php',3674]], 2],
'set_context': ['set_context', 'Sets the context the manager operates on ', [['grade/grading','lib.php',116],['lib','pagelib.php',970],['mod/assign','locallib.php',274],['lib/portfolio','caller.php',568]], 278],
'data_submitted': ['data_submitted', 'Determine if there is data waiting to be processed from a form ', [['lib','weblib.php',947]], 69],
'redirect': ['redirect', '', [['enrol/lti/ims-blti','blti.php',230],['lib','weblib.php',2659]], 999],
'isloggedin': ['isloggedin', 'Determines if a user is currently logged in ', [['lib','accesslib.php',1910]], 184],
'fullname': ['fullname', 'Returns a persons full name ', [['lib','moodlelib.php',3249],['mod/assign','locallib.php',3915]], 546],
'set_moodle_cookie': ['set_moodle_cookie', 'Sets a moodle cookie with a weakly encrypted username ', [['lib','sessionlib.php',89]], 2],
'get_moodle_cookie': ['get_moodle_cookie', 'Gets a moodle cookie with a weakly encrypted username ', [['lib','sessionlib.php',123]], 2],
'set_heading': ['set_heading', 'Sets the heading to use for the page. This is normally used as the main heading at the top of the content. ', [['lib','pagelib.php',1170]], 426],
'change_password_url': ['change_password_url', 'Returns the URL for changing the user\'s pw, or empty if the default can be used. ', [['auth/email','auth.php',193],['auth/mnet','auth.php',609],['auth/imap','auth.php',130],['auth/webservice','auth.php',121],['auth/manual','auth.php',132],['auth/none','auth.php',109],['auth/ldap','auth.php',1611],['lib','authlib.php',162],['auth/pop3','auth.php',126],['auth/cas','auth.php',274],['auth/db','auth.php',724]], 9],
'add': ['add', 'Add HashTable item ', [['lib/phpexcel/PHPExcel','HashTable.php',78],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',95],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',109],['lib/google/src/Google/Http','Batch.php',52],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',37],['lib','csslib.php',1508],['lib/horde/framework/Horde/Mail/Rfc822','List.php',116],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',33],['lib/horde/framework/Horde/Support','ConsistentHash.php',148],['lib/horde/framework/Horde','Variables.php',297],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',29],['lib','outputcomponents.php',2705],['lib','outputcomponents.php',3380],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',436],['lib','adminlib.php',735],['lib','adminlib.php',894],['lib','adminlib.php',1446],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',27],['lib/xhprof/xhprof_html/jquery','jquery-1.2.6.js',3450],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',80],['lib/google/src/Google/Service','Webmasters.php',436],['lib','navigationlib.php',304],['lib','navigationlib.php',761],['lib','navigationlib.php',3305],['lib','navigationlib.php',3583],['lib/horde/framework/Horde/Imap/Client','Ids.php',155],['backup/cc/cc_lib/gral_lib','cssparser.php',121],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',428],['lib/horde/framework/Horde','Stream.php',116],['comment','lib.php',679],['lib/mustache/src/Mustache','HelperCollection.php',56],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',207],['backup/cc/cc_lib','cc_utils.php',395],['backup/cc/cc_lib','cc_utils.php',454],['lib/lessphp/Output','Mapped.php',50],['lib','licenselib.php',32],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',50],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',74],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',14],['lib/horde/framework/Horde/Mail/Rfc822','GroupList.php',25],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',31],['tag/classes','tag.php',152],['blog','locallib.php',242],['lib/classes','notification.php',50],['lib/lessphp','Output.php',18],['tag/classes/output','tagfeed.php',61],['backup/cc','validator.php',51],['lib/horde/framework/Horde/Stream','TempString.php',118],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',11]], 6188],
'substr': ['substr', '', [], 2823],
'is_object': ['is_object', '', [], 544],
'strtolower': ['strtolower', '', [], 817],
'intval': ['intval', '', [], 455],
'strpos': ['strpos', '', [], 1604],
'file_exists': ['file_exists', '', [], 867],
'trim': ['trim', '', [], 1948],
'session_id': ['session_id', '', [], 37],
'header': ['header', '', [], 1355],
'array_merge': ['array_merge', '', [], 2944],
'function_exists': ['function_exists', '', [], 419]};
CLASS_DATA={
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',238]], 3088],
'single_button': ['single_button', 'Data structure representing a simple form with only one button. ', [['lib','outputcomponents.php',604]], 121],
'core_text': ['core_text', 'defines string api\'s for manipulating strings ', [['lib/classes','text.php',27]], 566],
'manager': ['manager', 'Search subsystem manager. ', [['search/classes','manager.php',31],['user/classes/output/myprofile','manager.php',28],['lib/classes/antivirus','manager.php',29],['lib/classes/event','manager.php',30],['lib/classes/task','manager.php',28],['admin/tool/messageinbound/classes','manager.php',29],['lib/classes/message/inbound','manager.php',29],['admin/tool/log/classes/log','manager.php',29],['lib/classes/log','manager.php',29],['lib/classes/session','manager.php',29],['lib/classes/message','manager.php',31]], 585],
'core_user': ['core_user', 'User class to access user details. ', [['lib/classes','user.php',27]], 457],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'login_forgot_password_form': ['login_forgot_password_form', 'Reset forgotten password form definition. ', [['login','forgot_password_form.php',29],['login','restored_password_form.php',42]], 2]};
CONST_DATA={
'PARAM_RAW': ['PARAM_RAW', '', [['lib','moodlelib.php',193]], 921],
'PARAM_BOOL': ['PARAM_BOOL', '', [['lib','moodlelib.php',108]], 802],
'PARAM_INT': ['PARAM_INT', '', [['lib','moodlelib.php',156]], 3812],
'AUTH_LOGIN_UNAUTHORISED': ['AUTH_LOGIN_UNAUTHORISED', '', [['lib','authlib.php',80]], 3]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
