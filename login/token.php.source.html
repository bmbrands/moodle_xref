<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /login/token.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='login';
filename='token.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/login/</a> -> <a href="token.php.html">token.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="token.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="token.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Return token</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * @package    moodlecore</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @copyright  2011 Dongsheng Cai &lt;dongsheng@moodle.com&gt;</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> */</span>
<a name="l23"><span class="linenum">  23</span></a>  
<a name="l24"><span class="linenum">  24</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('AJAX_SCRIPT')" href="../_constants/AJAX_SCRIPT.html" onMouseOver="constPopup(event,'AJAX_SCRIPT')">AJAX_SCRIPT</a>', true);
<a name="l25"><span class="linenum">  25</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('REQUIRE_CORRECT_ACCESS')" href="../_constants/REQUIRE_CORRECT_ACCESS.html" onMouseOver="constPopup(event,'REQUIRE_CORRECT_ACCESS')">REQUIRE_CORRECT_ACCESS</a>', true);
<a name="l26"><span class="linenum">  26</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('NO_MOODLE_COOKIES')" href="../_constants/NO_MOODLE_COOKIES.html" onMouseOver="constPopup(event,'NO_MOODLE_COOKIES')">NO_MOODLE_COOKIES</a>', true);
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  require_once(__DIR__ . '/../config.php');
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">// Allow CORS requests.</span>
<a name="l31"><span class="linenum">  31</span></a>  <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Access-Control-Allow-Origin: *');
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a> = <a class="function" onClick="logFunction('required_param')" href="../_functions/required_param.html" onMouseOver="funcPopup(event,'required_param')">required_param</a>('username', <a class="constant" onClick="logConstant('PARAM_USERNAME')" href="../_constants/PARAM_USERNAME.html" onMouseOver="constPopup(event,'PARAM_USERNAME')">PARAM_USERNAME</a>);
<a name="l34"><span class="linenum">  34</span></a>  <a class="var it201" onMouseOver="hilite(201)" onMouseOut="lolite()" onClick="logVariable('password')" href="../_variables/password.html">$password</a> = <a class="function" onClick="logFunction('required_param')" href="../_functions/required_param.html" onMouseOver="funcPopup(event,'required_param')">required_param</a>('password', <a class="constant" onClick="logConstant('PARAM_RAW')" href="../_constants/PARAM_RAW.html" onMouseOver="constPopup(event,'PARAM_RAW')">PARAM_RAW</a>);
<a name="l35"><span class="linenum">  35</span></a>  <a class="var it5789" onMouseOver="hilite(5789)" onMouseOut="lolite()" onClick="logVariable('serviceshortname')" href="../_variables/serviceshortname.html">$serviceshortname</a>  = <a class="function" onClick="logFunction('required_param')" href="../_functions/required_param.html" onMouseOver="funcPopup(event,'required_param')">required_param</a>('service',  <a class="constant" onClick="logConstant('PARAM_ALPHANUMEXT')" href="../_constants/PARAM_ALPHANUMEXT.html" onMouseOver="constPopup(event,'PARAM_ALPHANUMEXT')">PARAM_ALPHANUMEXT</a>);
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>();
<a name="l38"><span class="linenum">  38</span></a>  
<a name="l39"><span class="linenum">  39</span></a>  if (!<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablewebservices')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/enablewebservices.html">enablewebservices</a>) {
<a name="l40"><span class="linenum">  40</span></a>      throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('enablewsdescription', 'webservice');
<a name="l41"><span class="linenum">  41</span></a>  }
<a name="l42"><span class="linenum">  42</span></a>  <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="class" onClick="logClass('core_text')" href="../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a>));
<a name="l43"><span class="linenum">  43</span></a>  if (<a class="function" onClick="logFunction('is_restored_user')" href="../_functions/is_restored_user.html" onMouseOver="funcPopup(event,'is_restored_user')">is_restored_user</a>(<a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a>)) {
<a name="l44"><span class="linenum">  44</span></a>      throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('restoredaccountresetpassword', 'webservice');
<a name="l45"><span class="linenum">  45</span></a>  }
<a name="l46"><span class="linenum">  46</span></a>  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="function" onClick="logFunction('authenticate_user_login')" href="../_functions/authenticate_user_login.html" onMouseOver="funcPopup(event,'authenticate_user_login')">authenticate_user_login</a>(<a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a>, <a class="var it201" onMouseOver="hilite(201)" onMouseOut="lolite()" onClick="logVariable('password')" href="../_variables/password.html">$password</a>);
<a name="l47"><span class="linenum">  47</span></a>  if (!empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l48"><span class="linenum">  48</span></a>  
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">    //Non admin can not authenticate if maintenance mode</span>
<a name="l50"><span class="linenum">  50</span></a>      <a class="var it2523" onMouseOver="hilite(2523)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:config', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l51"><span class="linenum">  51</span></a>      if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('maintenance_enabled')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/maintenance_enabled.html">maintenance_enabled</a>) and !<a class="var it2523" onMouseOver="hilite(2523)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a>) {
<a name="l52"><span class="linenum">  52</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('sitemaintenance', 'admin');
<a name="l53"><span class="linenum">  53</span></a>      }
<a name="l54"><span class="linenum">  54</span></a>  
<a name="l55"><span class="linenum">  55</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l56"><span class="linenum">  56</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('noguest');
<a name="l57"><span class="linenum">  57</span></a>      }
<a name="l58"><span class="linenum">  58</span></a>      if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('confirmed')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/confirmed.html">confirmed</a>)) {
<a name="l59"><span class="linenum">  59</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('usernotconfirmed', 'moodle', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l60"><span class="linenum">  60</span></a>      }
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">    // check credential expiry</span>
<a name="l62"><span class="linenum">  62</span></a>      <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>);
<a name="l63"><span class="linenum">  63</span></a>      if (!empty(<a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('config')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration) and <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a onClick="logVariable('config')" class="var it44288" onMouseOver="hilite(44288)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration == 1) {
<a name="l64"><span class="linenum">  64</span></a>          <a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a> = <a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a class="function" onClick="logFunction('password_expire')" href="../_functions/password_expire.html" onMouseOver="funcPopup(event,'password_expire')">password_expire</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l65"><span class="linenum">  65</span></a>          if (<a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a>) &lt; 0 ) {
<a name="l66"><span class="linenum">  66</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('passwordisexpired', 'webservice');
<a name="l67"><span class="linenum">  67</span></a>          }
<a name="l68"><span class="linenum">  68</span></a>      }
<a name="l69"><span class="linenum">  69</span></a>  
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">    // Check whether the user should be changing password.</span>
<a name="l71"><span class="linenum">  71</span></a>      if (<a class="function" onClick="logFunction('get_user_preferences')" href="../_functions/get_user_preferences.html" onMouseOver="funcPopup(event,'get_user_preferences')">get_user_preferences</a>('auth_forcepasswordchange', false, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l72"><span class="linenum">  72</span></a>          if (<a class="var it377" onMouseOver="hilite(377)" onMouseOut="lolite()" onClick="logVariable('userauth')" href="../_variables/userauth.html">$userauth</a>-&gt;<a class="function" onClick="logFunction('can_change_password')" href="../_functions/can_change_password.html" onMouseOver="funcPopup(event,'can_change_password')">can_change_password</a>()) {
<a name="l73"><span class="linenum">  73</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('forcepasswordchangenotice');
<a name="l74"><span class="linenum">  74</span></a>          } else {
<a name="l75"><span class="linenum">  75</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('nopasswordchangeforced', 'auth');
<a name="l76"><span class="linenum">  76</span></a>          }
<a name="l77"><span class="linenum">  77</span></a>      }
<a name="l78"><span class="linenum">  78</span></a>  
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">    // let enrol plugins deal with new enrolments if necessary</span>
<a name="l80"><span class="linenum">  80</span></a>      <a class="function" onClick="logFunction('enrol_check_plugins')" href="../_functions/enrol_check_plugins.html" onMouseOver="funcPopup(event,'enrol_check_plugins')">enrol_check_plugins</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l81"><span class="linenum">  81</span></a>  
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment">    // setup user session to check capability</span>
<a name="l83"><span class="linenum">  83</span></a>      \core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('set_user')" href="../_functions/set_user.html" onMouseOver="funcPopup(event,'set_user')">set_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment">    //check if the service exists and is enabled</span>
<a name="l86"><span class="linenum">  86</span></a>      <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services', array('shortname' =&gt; <a class="var it5789" onMouseOver="hilite(5789)" onMouseOut="lolite()" onClick="logVariable('serviceshortname')" href="../_variables/serviceshortname.html">$serviceshortname</a>, 'enabled' =&gt; 1));
<a name="l87"><span class="linenum">  87</span></a>      if (empty(<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>)) {
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">        // will throw exception if no token found</span>
<a name="l89"><span class="linenum">  89</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('servicenotavailable', 'webservice');
<a name="l90"><span class="linenum">  90</span></a>      }
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">    //check if there is any required system capability</span>
<a name="l93"><span class="linenum">  93</span></a>      if (<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a>, <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l94"><span class="linenum">  94</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('missingrequiredcapability', 'webservice', '', <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a>);
<a name="l95"><span class="linenum">  95</span></a>      }
<a name="l96"><span class="linenum">  96</span></a>  
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">    //specific checks related to user restricted service</span>
<a name="l98"><span class="linenum">  98</span></a>      if (<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('restrictedusers')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/restrictedusers.html">restrictedusers</a>) {
<a name="l99"><span class="linenum">  99</span></a>          <a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services_users',
<a name="l100"><span class="linenum"> 100</span></a>              array('externalserviceid' =&gt; <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l101"><span class="linenum"> 101</span></a>  
<a name="l102"><span class="linenum"> 102</span></a>          if (empty(<a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>)) {
<a name="l103"><span class="linenum"> 103</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('usernotallowed', 'webservice', '', <a class="var it5789" onMouseOver="hilite(5789)" onMouseOut="lolite()" onClick="logVariable('serviceshortname')" href="../_variables/serviceshortname.html">$serviceshortname</a>);
<a name="l104"><span class="linenum"> 104</span></a>          }
<a name="l105"><span class="linenum"> 105</span></a>  
<a name="l106"><span class="linenum"> 106</span></a>          if (!empty(<a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('validuntil')" class="var it45261" onMouseOver="hilite(45261)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a>) and <a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('validuntil')" class="var it45261" onMouseOver="hilite(45261)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l107"><span class="linenum"> 107</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invalidtimedtoken', 'webservice');
<a name="l108"><span class="linenum"> 108</span></a>          }
<a name="l109"><span class="linenum"> 109</span></a>  
<a name="l110"><span class="linenum"> 110</span></a>          if (!empty(<a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it45261" onMouseOver="hilite(45261)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>) and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), <a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it45261" onMouseOver="hilite(45261)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l111"><span class="linenum"> 111</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invalidiptoken', 'webservice');
<a name="l112"><span class="linenum"> 112</span></a>          }
<a name="l113"><span class="linenum"> 113</span></a>      }
<a name="l114"><span class="linenum"> 114</span></a>  
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment">    //Check if a token has already been created for this user and this service</span>
<a name="l116"><span class="linenum"> 116</span></a>  <span class="comment">    //Note: this could be an admin created or an user created token.</span>
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">    //      It does not really matter we take the first one that is valid.</span>
<a name="l118"><span class="linenum"> 118</span></a>      <a class="var it5794" onMouseOver="hilite(5794)" onMouseOut="lolite()" onClick="logVariable('tokenssql')" href="../_variables/tokenssql.html">$tokenssql</a> = &quot;SELECT t.id, t.sid, t.token, t.validuntil, t.iprestriction
<a name="l119"><span class="linenum"> 119</span></a>                FROM {external_tokens} t
<a name="l120"><span class="linenum"> 120</span></a>               WHERE t.userid = ? AND t.externalserviceid = ? AND t.tokentype = ?
<a name="l121"><span class="linenum"> 121</span></a>            ORDER BY t.timecreated ASC&quot;;
<a name="l122"><span class="linenum"> 122</span></a>      <a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('tokens')" href="../_variables/tokens.html">$tokens</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it5794" onMouseOver="hilite(5794)" onMouseOut="lolite()" onClick="logVariable('tokenssql')" href="../_variables/tokenssql.html">$tokenssql</a>, array(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>));
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">    //A bit of sanity checks</span>
<a name="l125"><span class="linenum"> 125</span></a>      foreach (<a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('tokens')" href="../_variables/tokens.html">$tokens</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>=&gt;<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>) {
<a name="l126"><span class="linenum"> 126</span></a>  
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment">        /// Checks related to a specific token. (script execution continue)</span>
<a name="l128"><span class="linenum"> 128</span></a>          <a class="var it5795" onMouseOver="hilite(5795)" onMouseOut="lolite()" onClick="logVariable('unsettoken')" href="../_variables/unsettoken.html">$unsettoken</a> = false;
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">        //if sid is set then there must be a valid associated session no matter the token type</span>
<a name="l130"><span class="linenum"> 130</span></a>          if (!empty(<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>)) {
<a name="l131"><span class="linenum"> 131</span></a>              if (!\core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('session_exists')" href="../_functions/session_exists.html" onMouseOver="funcPopup(event,'session_exists')">session_exists</a>(<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>)){
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">                //this token will never be valid anymore, delete it</span>
<a name="l133"><span class="linenum"> 133</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('sid'=&gt;<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>));
<a name="l134"><span class="linenum"> 134</span></a>                  <a class="var it5795" onMouseOver="hilite(5795)" onMouseOut="lolite()" onClick="logVariable('unsettoken')" href="../_variables/unsettoken.html">$unsettoken</a> = true;
<a name="l135"><span class="linenum"> 135</span></a>              }
<a name="l136"><span class="linenum"> 136</span></a>          }
<a name="l137"><span class="linenum"> 137</span></a>  
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment">        //remove token if no valid anymore</span>
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment">        //Also delete this wrong token (similar logic to the web service servers</span>
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">        //    /webservice/lib.php/webservice_server::authenticate_by_token())</span>
<a name="l141"><span class="linenum"> 141</span></a>          if (!empty(<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a>) and <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l142"><span class="linenum"> 142</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('token'=&gt;<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('token')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/token.html">token</a>, 'tokentype'=&gt; <a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>));
<a name="l143"><span class="linenum"> 143</span></a>              <a class="var it5795" onMouseOver="hilite(5795)" onMouseOut="lolite()" onClick="logVariable('unsettoken')" href="../_variables/unsettoken.html">$unsettoken</a> = true;
<a name="l144"><span class="linenum"> 144</span></a>          }
<a name="l145"><span class="linenum"> 145</span></a>  
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">        // remove token if its ip not in whitelist</span>
<a name="l147"><span class="linenum"> 147</span></a>          if (isset(<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>) and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l148"><span class="linenum"> 148</span></a>              <a class="var it5795" onMouseOver="hilite(5795)" onMouseOut="lolite()" onClick="logVariable('unsettoken')" href="../_variables/unsettoken.html">$unsettoken</a> = true;
<a name="l149"><span class="linenum"> 149</span></a>          }
<a name="l150"><span class="linenum"> 150</span></a>  
<a name="l151"><span class="linenum"> 151</span></a>          if (<a class="var it5795" onMouseOver="hilite(5795)" onMouseOut="lolite()" onClick="logVariable('unsettoken')" href="../_variables/unsettoken.html">$unsettoken</a>) {
<a name="l152"><span class="linenum"> 152</span></a>              unset(<a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('tokens')" href="../_variables/tokens.html">$tokens</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>]);
<a name="l153"><span class="linenum"> 153</span></a>          }
<a name="l154"><span class="linenum"> 154</span></a>      }
<a name="l155"><span class="linenum"> 155</span></a>  
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">    // if some valid tokens exist then use the most recent</span>
<a name="l157"><span class="linenum"> 157</span></a>      if (<a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('tokens')" href="../_variables/tokens.html">$tokens</a>) &gt; 0) {
<a name="l158"><span class="linenum"> 158</span></a>          <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('tokens')" href="../_variables/tokens.html">$tokens</a>);
<a name="l159"><span class="linenum"> 159</span></a>      } else {
<a name="l160"><span class="linenum"> 160</span></a>          if ( (<a class="var it5789" onMouseOver="hilite(5789)" onMouseOut="lolite()" onClick="logVariable('serviceshortname')" href="../_variables/serviceshortname.html">$serviceshortname</a> == <a class="constant" onClick="logConstant('MOODLE_OFFICIAL_MOBILE_SERVICE')" href="../_constants/MOODLE_OFFICIAL_MOBILE_SERVICE.html" onMouseOver="constPopup(event,'MOODLE_OFFICIAL_MOBILE_SERVICE')">MOODLE_OFFICIAL_MOBILE_SERVICE</a> and <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/webservice:createmobiletoken', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()))
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment">                //Note: automatically token generation is not available to admin (they must create a token manually)</span>
<a name="l162"><span class="linenum"> 162</span></a>                  <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (!<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/webservice:createtoken', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()))) {
<a name="l163"><span class="linenum"> 163</span></a>  <span class="comment">            // if service doesn't exist, dml will throw exception</span>
<a name="l164"><span class="linenum"> 164</span></a>              <a class="var it5796" onMouseOver="hilite(5796)" onMouseOut="lolite()" onClick="logVariable('service_record')" href="../_variables/service_record.html">$service_record</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services', array('shortname'=&gt;<a class="var it5789" onMouseOver="hilite(5789)" onMouseOut="lolite()" onClick="logVariable('serviceshortname')" href="../_variables/serviceshortname.html">$serviceshortname</a>, 'enabled'=&gt;1), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l165"><span class="linenum"> 165</span></a>  
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">            // Create a new token.</span>
<a name="l167"><span class="linenum"> 167</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = new stdClass;
<a name="l168"><span class="linenum"> 168</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('token')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/token.html">token</a> = md5(<a class="phpfunction" onClick="logFunction('uniqid')" href="../_functions/uniqid.html" onMouseOver="phpfuncPopup(event,'uniqid')">uniqid</a>(<a class="phpfunction" onClick="logFunction('rand')" href="../_functions/rand.html" onMouseOver="phpfuncPopup(event,'rand')">rand</a>(), 1));
<a name="l169"><span class="linenum"> 169</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('userid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l170"><span class="linenum"> 170</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('tokentype')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/tokentype.html">tokentype</a> = <a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>;
<a name="l171"><span class="linenum"> 171</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('contextid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;id;
<a name="l172"><span class="linenum"> 172</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('creatorid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/creatorid.html">creatorid</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l173"><span class="linenum"> 173</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l174"><span class="linenum"> 174</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a> = <a class="var it5796" onMouseOver="hilite(5796)" onMouseOut="lolite()" onClick="logVariable('service_record')" href="../_variables/service_record.html">$service_record</a>-&gt;<a onClick="logVariable('id')" class="var it45262" onMouseOver="hilite(45262)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">            // MDL-43119 Token valid for 3 months (12 weeks).</span>
<a name="l176"><span class="linenum"> 176</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> = <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> + 12 * <a class="constant" onClick="logConstant('WEEKSECS')" href="../_constants/WEEKSECS.html" onMouseOver="constPopup(event,'WEEKSECS')">WEEKSECS</a>;
<a name="l177"><span class="linenum"> 177</span></a>              <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l178"><span class="linenum"> 178</span></a>  
<a name="l179"><span class="linenum"> 179</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(
<a name="l180"><span class="linenum"> 180</span></a>                  'objectid' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l181"><span class="linenum"> 181</span></a>                  'relateduserid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l182"><span class="linenum"> 182</span></a>                  'other' =&gt; array(
<a name="l183"><span class="linenum"> 183</span></a>                      'auto' =&gt; true
<a name="l184"><span class="linenum"> 184</span></a>                  )
<a name="l185"><span class="linenum"> 185</span></a>              );
<a name="l186"><span class="linenum"> 186</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_token_created')" href="../_classes/webservice_token_created.html" onMouseOver="classPopup(event,'webservice_token_created')">webservice_token_created</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l187"><span class="linenum"> 187</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l188"><span class="linenum"> 188</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l189"><span class="linenum"> 189</span></a>          } else {
<a name="l190"><span class="linenum"> 190</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('cannotcreatetoken', 'webservice', '', <a class="var it5789" onMouseOver="hilite(5789)" onMouseOut="lolite()" onClick="logVariable('serviceshortname')" href="../_variables/serviceshortname.html">$serviceshortname</a>);
<a name="l191"><span class="linenum"> 191</span></a>          }
<a name="l192"><span class="linenum"> 192</span></a>      }
<a name="l193"><span class="linenum"> 193</span></a>  
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment">    // log token access</span>
<a name="l195"><span class="linenum"> 195</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('external_tokens', 'lastaccess', <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), array('id'=&gt;<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l196"><span class="linenum"> 196</span></a>  
<a name="l197"><span class="linenum"> 197</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(
<a name="l198"><span class="linenum"> 198</span></a>          'objectid' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l199"><span class="linenum"> 199</span></a>      );
<a name="l200"><span class="linenum"> 200</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_token_sent')" href="../_classes/webservice_token_sent.html" onMouseOver="classPopup(event,'webservice_token_sent')">webservice_token_sent</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l201"><span class="linenum"> 201</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l202"><span class="linenum"> 202</span></a>      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l203"><span class="linenum"> 203</span></a>  
<a name="l204"><span class="linenum"> 204</span></a>      <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('usertoken')" href="../_variables/usertoken.html">$usertoken</a> = new stdClass;
<a name="l205"><span class="linenum"> 205</span></a>      <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('usertoken')" href="../_variables/usertoken.html">$usertoken</a>-&gt;<a onClick="logVariable('token')" class="var it45263" onMouseOver="hilite(45263)" onMouseOut="lolite()" href="../_variables/token.html">token</a> = <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('token')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/token.html">token</a>;
<a name="l206"><span class="linenum"> 206</span></a>      echo <a class="function" onClick="logFunction('json_encode')" href="../_functions/json_encode.html" onMouseOver="funcPopup(event,'json_encode')">json_encode</a>(<a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('usertoken')" href="../_variables/usertoken.html">$usertoken</a>);
<a name="l207"><span class="linenum"> 207</span></a>  } else {
<a name="l208"><span class="linenum"> 208</span></a>      throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invalidlogin');
<a name="l209"><span class="linenum"> 209</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',840]], 332],
'set_user': ['set_user', 'Set current user. ', [['lib/classes/session','manager.php',706]], 28],
'is_siteadmin': ['is_siteadmin', 'Check if the user is an admin at the site level. ', [['lib','accesslib.php',602]], 95],
'required_param': ['required_param', 'Returns a particular value for the named variable, taken from POST or GET.  If the parameter doesn\'t exist then an error is thrown because we require this variable. ', [['lib','moodlelib.php',525]], 815],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 556],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'password_expire': ['password_expire', 'Return number of days to user password expires. ', [['auth/manual','auth.php',175],['auth/ldap','auth.php',616],['lib','authlib.php',364]], 8],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'json_encode': ['json_encode', 'encodes an arbitrary variable into JSON format ', [['lib/minify/lib','FirePHP.php',1124]], 307],
'can_change_password': ['can_change_password', 'Returns true if this authentication plugin can change the user\'s password. ', [['auth/radius','auth.php',161],['auth/nntp','auth.php',99],['auth/email','auth.php',183],['auth/mnet','auth.php',598],['auth/imap','auth.php',120],['auth/webservice','auth.php',111],['auth/shibboleth','auth.php',180],['auth/pam','auth.php',111],['auth/manual','auth.php',122],['auth/none','auth.php',99],['auth/ldap','auth.php',1601],['lib','authlib.php',151],['auth/fc','auth.php',180],['auth/pop3','auth.php',116],['auth/nologin','auth.php',82],['auth/cas','auth.php',86],['auth/db','auth.php',714]], 13],
'enrol_check_plugins': ['enrol_check_plugins', 'Check all the login enrolment information for the given user object by querying the enrolment plugins ', [['lib','enrollib.php',186]], 8],
'getremoteaddr': ['getremoteaddr', 'Returns most reliable client address ', [['lib','moodlelib.php',8569]], 61],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'get_user_preferences': ['get_user_preferences', 'Used to fetch user preference(s) ', [['lib','moodlelib.php',1974],['user','externallib.php',1381]], 188],
'authenticate_user_login': ['authenticate_user_login', 'Authenticates a user against the chosen authentication mechanism ', [['lib','moodlelib.php',4077]], 19],
'is_restored_user': ['is_restored_user', 'Returns true if the user is a \'restored\' one. ', [['lib','moodlelib.php',3674]], 2],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'isguestuser': ['isguestuser', 'Determines if a user is logged in as real guest user with username \'guest\'. ', [['lib','accesslib.php',1923]], 260],
'address_in_subnet': ['address_in_subnet', 'Function to check the passed address is within the passed subnet ', [['lib','moodlelib.php',8284]], 80],
'session_exists': ['session_exists', 'Check the backend contains data for this session id. ', [['lib/classes/session','file.php',78],['lib/classes/session','memcache.php',123],['lib/classes/session','memcached.php',148],['lib/classes/session','database.php',84],['lib/classes/session','manager.php',549]], 13],
'get_auth_plugin': ['get_auth_plugin', 'Returns an authentication plugin instance. ', [['lib','moodlelib.php',3608]], 81],
'array_pop': ['array_pop', '', [], 483],
'count': ['count', '', [], 4095],
'define': ['define', '', [], 2373],
'uniqid': ['uniqid', '', [], 86],
'time': ['time', '', [], 1959],
'trim': ['trim', '', [], 1948],
'strtolower': ['strtolower', '', [], 817],
'rand': ['rand', '', [], 99],
'intval': ['intval', '', [], 455],
'header': ['header', '', [], 1355]};
CLASS_DATA={
'webservice_token_sent': ['webservice_token_sent', 'Webservice token sent event class. ', [['lib/classes/event','webservice_token_sent.php',28]], 2],
'webservice_token_created': ['webservice_token_created', 'Web service token created event class. ', [['lib/classes/event','webservice_token_created.php',28]], 2],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'core_text': ['core_text', 'defines string api\'s for manipulating strings ', [['lib/classes','text.php',27]], 566],
'moodle_exception': ['moodle_exception', 'Base Moodle Exception class ', [['lib','setuplib.php',75]], 606],
'manager': ['manager', 'Search subsystem manager. ', [['search/classes','manager.php',31],['user/classes/output/myprofile','manager.php',28],['lib/classes/antivirus','manager.php',29],['lib/classes/event','manager.php',30],['lib/classes/task','manager.php',28],['admin/tool/messageinbound/classes','manager.php',29],['lib/classes/message/inbound','manager.php',29],['admin/tool/log/classes/log','manager.php',29],['lib/classes/log','manager.php',29],['lib/classes/session','manager.php',29],['lib/classes/message','manager.php',31]], 585]};
CONST_DATA={
'NO_MOODLE_COOKIES': ['NO_MOODLE_COOKIES', '', [['rss','file.php',34],['grade/export/xml','dump.php',18],['login','token.php',26],['','help.php',29],['grade/import/xml','fetch.php',18],['lib/ajax','service-nologin.php',30],['webservice','upload.php',42],['mod/data','js.php',26],['theme','font.php',124],['mod/data','css.php',26],['grade/export/txt','dump.php',18],['grade/export/xls','dump.php',18],['auth/ldap','ntlmsso_magic.php',7],['lib/editor/tinymce','all_strings.php',25],['lib/flowplayer','flowplayer-3.2.18.swf.php',26],['theme','image.php',127],['mod/lti','services.php',27],['mod/assign/feedback/editpdf','ajax_progress.php',28],['mod/chat/gui_header_js','chatinput.php',17],['','help_ajax.php',26],['user','grouppix.php',30],['mod/chat/gui_sockets','chatinput.php',17],['theme','javascript.php',83],['badges','assertion.php',28],['lib/editor/tinymce/plugins','loader.php',32],['filter/tex','pix.php',8],['mod/lti','service.php',27],['mod/chat/gui_header_js','jsupdated.php',33],['filter/algebra','pix.php',8],['grade/export/ods','dump.php',18],['theme','styles_debug.php',29],['mod/chat/gui_header_js','users.php',17],['lib/flowplayer','flowplayer.audio-3.2.11.swf.php',26],['lib','setuplib.php',863],['mnet/xmlrpc','server.php',16],['mod/chat/gui_header_js','jsupdate.php',17],['filter/tex','displaytex.php',28],['webservice','pluginfile.php',34],['theme','styles.php',112],['lib','setup.php',760],['lib','setup.php',764],['lib','setup.php',769],['lib','setup.php',772],['lib','setup.php',774],['lib/flowplayer','flowplayer.controls-3.2.16.swf.php',26],['lib/editor/tinymce/plugins/moodleemoticon','dialog.php',25]], 57],
'MOODLE_OFFICIAL_MOBILE_SERVICE': ['MOODLE_OFFICIAL_MOBILE_SERVICE', '', [['lib','moodlelib.php',502]], 189],
'WEEKSECS': ['WEEKSECS', '', [['lib','moodlelib.php',44]], 46],
'AJAX_SCRIPT': ['AJAX_SCRIPT', '', [['mod/assign/feedback/editpdf','ajax.php',29],['admin/roles','ajax.php',26],['repository','draftfiles_ajax.php',27],['enrol','ajax.php',28],['lib/ajax','blocks.php',25],['comment','comment_ajax.php',24],['lib/ajax','service.php',30],['login','token.php',24],['badges','backpackconnect.php',27],['webservice','upload.php',37],['mod/chat','chat_ajax.php',17],['user/selector','search.php',25],['lib/editor/atto/plugins/equation','ajax.php',26],['lib','sessionkeepalive_ajax.php',25],['mod/forum','subscribe_ajax.php',25],['repository','repository_ajax.php',27],['admin/tool/installaddon','permcheck.php',27],['question','toggleflag.php',27],['mod/quiz','edit_rest.php',26],['mod/assign/feedback/editpdf','ajax_progress.php',26],['','help_ajax.php',27],['grade/report/history','users_ajax.php',26],['lib/ajax','getnavbranch.php',28],['badges','assertion.php',27],['mod/quiz','questionbank.ajax.php',26],['badges','ajax.php',27],['course/ajax','management.php',27],['mod/lti','ajax.php',29],['rating','rate_ajax.php',28],['enrol/manual','ajax.php',28],['availability/condition/date','ajax.php',25],['lib/ajax','getsiteadminbranch.php',28],['','install.php',47],['course','category.ajax.php',28],['course','dndupload.php',26],['message','ajax.php',25],['mod/feedback','ajax.php',26],['webservice','pluginfile.php',29],['course','rest.php',27],['lib','setup.php',351],['mod/glossary','showentry_ajax.php',2],['lib/editor/atto','autosave-ajax.php',25],['mod/quiz','autosave.ajax.php',25],['report/loglive','loglive_ajax.php',25],['message/output/airnotifier','rest.php',26],['blocks/course_overview','save.php',24]], 74],
'PARAM_USERNAME': ['PARAM_USERNAME', '', [['lib','moodlelib.php',245]], 29],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'PARAM_RAW': ['PARAM_RAW', '', [['lib','moodlelib.php',193]], 921],
'PARAM_ALPHANUMEXT': ['PARAM_ALPHANUMEXT', '', [['lib','moodlelib.php',93]], 200],
'EXTERNAL_TOKEN_PERMANENT': ['EXTERNAL_TOKEN_PERMANENT', '', [['lib','moodlelib.php',465]], 11],
'REQUIRE_CORRECT_ACCESS': ['REQUIRE_CORRECT_ACCESS', '', [['login','token.php',25]], 3]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
